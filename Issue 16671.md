# Issue 16671: Upgrade Maxima to 5.34.0

archive/issues_016671.json:
```json
{
    "body": "CC:  zimmerma jpflori was\n\nKeywords: maxima\n\nTarball: \u200bhttp://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.34.0.tar.bz2\n\nIssue created by migration from https://trac.sagemath.org/ticket/16908\n\n",
    "created_at": "2014-08-29T23:29:15Z",
    "labels": [
        "packages: standard",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Upgrade Maxima to 5.34.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16671",
    "user": "pbruin"
}
```
CC:  zimmerma jpflori was

Keywords: maxima

Tarball: â€‹http://homepages.warwick.ac.uk/staff/P.Bruin/sage/maxima-5.34.0.tar.bz2

Issue created by migration from https://trac.sagemath.org/ticket/16908





---

archive/issue_comments_220094.json:
```json
{
    "body": "Any tix this fixes, btw?",
    "created_at": "2014-08-31T01:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220094",
    "user": "kcrisman"
}
```

Any tix this fixes, btw?



---

archive/issue_comments_220095.json:
```json
{
    "body": "Replying to [comment:1 kcrisman]:\n> Any tix this fixes, btw?\nI haven't had the time to investigate this in detail.  It doesn't fix any of the tickets listed in #13973 that are still open, but I haven't looked at other open Maxima-related tickets.  The update shouldn't be too difficult, but there are some problems, such as my fix for the matrix exponentation bug (see #13973) not working anymore.",
    "created_at": "2014-09-03T11:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220095",
    "user": "pbruin"
}
```

Replying to [comment:1 kcrisman]:
> Any tix this fixes, btw?
I haven't had the time to investigate this in detail.  It doesn't fix any of the tickets listed in #13973 that are still open, but I haven't looked at other open Maxima-related tickets.  The update shouldn't be too difficult, but there are some problems, such as my fix for the matrix exponentation bug (see #13973) not working anymore.



---

archive/issue_comments_220096.json:
```json
{
    "body": "Changelog is here: https://sourceforge.net/p/maxima/code/ci/master/tree/ChangeLog-5.34",
    "created_at": "2014-09-04T08:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220096",
    "user": "rws"
}
```

Changelog is here: https://sourceforge.net/p/maxima/code/ci/master/tree/ChangeLog-5.34



---

archive/issue_comments_220097.json:
```json
{
    "body": "Replying to [comment:1 kcrisman]:\n> Any tix this fixes, btw?\n#14965 claims to be fixed by Maxima 5.34",
    "created_at": "2014-09-04T19:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220097",
    "user": "jdemeyer"
}
```

Replying to [comment:1 kcrisman]:
> Any tix this fixes, btw?
#14965 claims to be fixed by Maxima 5.34



---

archive/issue_comments_220098.json:
```json
{
    "body": "How many patches can we drop with this version?",
    "created_at": "2014-09-04T21:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220098",
    "user": "fbissey"
}
```

How many patches can we drop with this version?



---

archive/issue_comments_220099.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-05T08:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220099",
    "user": "pbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_220100.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> Replying to [comment:1 kcrisman]:\n> > Any tix this fixes, btw?\n> #14965 claims to be fixed by Maxima 5.34\nIt does appear to be fixed; I am not getting an error, but haven't checked if the answer is correct.\n\n[Edit: actually I couldn't reproduce the error with Maxima 5.33.0.]",
    "created_at": "2014-09-05T08:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220100",
    "user": "pbruin"
}
```

Replying to [comment:4 jdemeyer]:
> Replying to [comment:1 kcrisman]:
> > Any tix this fixes, btw?
> #14965 claims to be fixed by Maxima 5.34
It does appear to be fixed; I am not getting an error, but haven't checked if the answer is correct.

[Edit: actually I couldn't reproduce the error with Maxima 5.33.0.]



---

archive/issue_comments_220101.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> How many patches can we drop with this version?\nThis branch removes two patches and updates another one.\n\n[Edit: the one added patch was not necessary after all, there was a better solution.]",
    "created_at": "2014-09-05T08:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220101",
    "user": "pbruin"
}
```

Replying to [comment:5 fbissey]:
> How many patches can we drop with this version?
This branch removes two patches and updates another one.

[Edit: the one added patch was not necessary after all, there was a better solution.]



---

archive/issue_comments_220102.json:
```json
{
    "body": "I have tested this (and all tests pass) on x86_64 and ARM 32-bit.",
    "created_at": "2014-09-05T08:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220102",
    "user": "pbruin"
}
```

I have tested this (and all tests pass) on x86_64 and ARM 32-bit.



---

archive/issue_comments_220103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-06T10:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220103",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220104.json:
```json
{
    "body": "Maxima 5.34.1 has been released, an updated branch is coming soon.",
    "created_at": "2014-09-10T08:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220104",
    "user": "pbruin"
}
```

Maxima 5.34.1 has been released, an updated branch is coming soon.



---

archive/issue_comments_220105.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-10T08:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220105",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_220106.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-10T09:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220106",
    "user": "pbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_220107.json:
```json
{
    "body": "Could you justify this change?\n\n```diff\n- sage: latex(integrate(1/(1+sqrt(x)),x,0,1))\n- \\int_{0}^{1} \\frac{1}{\\sqrt{x} + 1}\\,{d x}\n```\n\n\nI think the purpose of this test is to show an integral that Maxima cannot compute. You could replace this by a different integral...",
    "created_at": "2014-09-10T12:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220107",
    "user": "jdemeyer"
}
```

Could you justify this change?

```diff
- sage: latex(integrate(1/(1+sqrt(x)),x,0,1))
- \int_{0}^{1} \frac{1}{\sqrt{x} + 1}\,{d x}
```


I think the purpose of this test is to show an integral that Maxima cannot compute. You could replace this by a different integral...



---

archive/issue_comments_220108.json:
```json
{
    "body": "Maxima is now able to compute the integral (it equals 2 - 2 log(2)), so the doctest did not test the `_print_latex_()` method anymore.  Of course we could put in another doctest with an integral that Maxima isn't able to evaluate, but I thought this `_print_latex_()` method was simple enough that it wasn't necessary to keep a second doctest.",
    "created_at": "2014-09-10T12:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220108",
    "user": "pbruin"
}
```

Maxima is now able to compute the integral (it equals 2 - 2 log(2)), so the doctest did not test the `_print_latex_()` method anymore.  Of course we could put in another doctest with an integral that Maxima isn't able to evaluate, but I thought this `_print_latex_()` method was simple enough that it wasn't necessary to keep a second doctest.



---

archive/issue_comments_220109.json:
```json
{
    "body": "Replying to [comment:15 pbruin]:\n> Maxima is now able to compute the integral (it equals 2 - 2 log(2)), so the doctest did not test the `_print_latex_()` method anymore.  Of course we could put in another doctest with an integral that Maxima isn't able to evaluate, but I thought this `_print_latex_()` method was simple enough that it wasn't necessary to keep a second doctest.\nWell, the 2 doctests are somewhat different, one calls directly `print_latex` while the removed one uses `latex()`. So yes, please but back a second doctests.\n\nApart from this trivial thing, this ticket looks good to me.",
    "created_at": "2014-09-10T12:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220109",
    "user": "jdemeyer"
}
```

Replying to [comment:15 pbruin]:
> Maxima is now able to compute the integral (it equals 2 - 2 log(2)), so the doctest did not test the `_print_latex_()` method anymore.  Of course we could put in another doctest with an integral that Maxima isn't able to evaluate, but I thought this `_print_latex_()` method was simple enough that it wasn't necessary to keep a second doctest.
Well, the 2 doctests are somewhat different, one calls directly `print_latex` while the removed one uses `latex()`. So yes, please but back a second doctests.

Apart from this trivial thing, this ticket looks good to me.



---

archive/issue_comments_220110.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-10T12:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220110",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220111.json:
```json
{
    "body": "I amended the existing commit instead of adding a new one, because the commit message mentioned the wrong Maxima version.  I added the following doctests:\n\n```diff\n--- a/src/sage/symbolic/integration/integral.py\n+++ b/src/sage/symbolic/integration/integral.py\n@@ -116,6 +116,8 @@ class IndefiniteIntegral(BuiltinFunction):\n             sage: f = function('f')\n             sage: print_latex(f(x),x)\n             '\\\\int f\\\\left(x\\\\right)\\\\,{d x}'\n+            sage: latex(integrate(tan(x)/x, x))\n+            \\int \\frac{\\tan\\left(x\\right)}{x}\\,{d x}\n         \"\"\"\n         from sage.misc.latex import latex\n         if not is_SymbolicVariable(x):\n@@ -236,8 +238,8 @@ class DefiniteIntegral(BuiltinFunction):\n             sage: f = function('f')\n             sage: print_latex(f(x),x,0,1)\n             '\\\\int_{0}^{1} f\\\\left(x\\\\right)\\\\,{d x}'\n-            sage: latex(integrate(1/(1+sqrt(x)),x,0,1))\n-            \\int_{0}^{1} \\frac{1}{\\sqrt{x} + 1}\\,{d x}\n+            sage: latex(integrate(tan(x)/x, x, 0, 1))\n+            \\int_{0}^{1} \\frac{\\tan\\left(x\\right)}{x}\\,{d x}\n         \"\"\"\n         from sage.misc.latex import latex\n         if not is_SymbolicVariable(x):\n```\n",
    "created_at": "2014-09-10T13:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220111",
    "user": "pbruin"
}
```

I amended the existing commit instead of adding a new one, because the commit message mentioned the wrong Maxima version.  I added the following doctests:

```diff
--- a/src/sage/symbolic/integration/integral.py
+++ b/src/sage/symbolic/integration/integral.py
@@ -116,6 +116,8 @@ class IndefiniteIntegral(BuiltinFunction):
             sage: f = function('f')
             sage: print_latex(f(x),x)
             '\\int f\\left(x\\right)\\,{d x}'
+            sage: latex(integrate(tan(x)/x, x))
+            \int \frac{\tan\left(x\right)}{x}\,{d x}
         """
         from sage.misc.latex import latex
         if not is_SymbolicVariable(x):
@@ -236,8 +238,8 @@ class DefiniteIntegral(BuiltinFunction):
             sage: f = function('f')
             sage: print_latex(f(x),x,0,1)
             '\\int_{0}^{1} f\\left(x\\right)\\,{d x}'
-            sage: latex(integrate(1/(1+sqrt(x)),x,0,1))
-            \int_{0}^{1} \frac{1}{\sqrt{x} + 1}\,{d x}
+            sage: latex(integrate(tan(x)/x, x, 0, 1))
+            \int_{0}^{1} \frac{\tan\left(x\right)}{x}\,{d x}
         """
         from sage.misc.latex import latex
         if not is_SymbolicVariable(x):
```




---

archive/issue_comments_220112.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-10T14:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220112",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_220113.json:
```json
{
    "body": "Conflicts with #16651 or #16858",
    "created_at": "2014-09-10T21:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220113",
    "user": "vbraun"
}
```

Conflicts with #16651 or #16858



---

archive/issue_comments_220114.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-09-10T21:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220114",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_220115.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-11T11:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220115",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220116.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-09-11T11:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220116",
    "user": "pbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_220117.json:
```json
{
    "body": "I get various doctest failures on top of 6.4.beta3:\n\n```\nsage -t --long --warn-long 40.1 src/sage/calculus/desolvers.py  # 2 doctests failed\nsage -t --long --warn-long 40.1 src/sage/rings/number_field/number_field_element.pyx  # 1 doctest failed\nsage -t --long --warn-long 40.1 src/sage/tests/french_book/integration_doctest.py  # 1 doctest failed\nsage -t --long --warn-long 40.1 src/sage/modules/free_module_element.pyx  # 1 doctest failed\nsage -t --long --warn-long 40.1 src/sage/symbolic/relation.py  # 1 doctest failed\nsage -t --long --warn-long 40.1 src/sage/functions/other.py  # 1 doctest failed\nsage -t --long --warn-long 40.1 src/sage/functions/special.py  # 2 doctests failed\n```\n\nLooks like it is all due to changed precision of floats",
    "created_at": "2014-09-11T14:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220117",
    "user": "vbraun"
}
```

I get various doctest failures on top of 6.4.beta3:

```
sage -t --long --warn-long 40.1 src/sage/calculus/desolvers.py  # 2 doctests failed
sage -t --long --warn-long 40.1 src/sage/rings/number_field/number_field_element.pyx  # 1 doctest failed
sage -t --long --warn-long 40.1 src/sage/tests/french_book/integration_doctest.py  # 1 doctest failed
sage -t --long --warn-long 40.1 src/sage/modules/free_module_element.pyx  # 1 doctest failed
sage -t --long --warn-long 40.1 src/sage/symbolic/relation.py  # 1 doctest failed
sage -t --long --warn-long 40.1 src/sage/functions/other.py  # 1 doctest failed
sage -t --long --warn-long 40.1 src/sage/functions/special.py  # 2 doctests failed
```

Looks like it is all due to changed precision of floats



---

archive/issue_comments_220118.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-09-11T14:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220118",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_220119.json:
```json
{
    "body": "I'll have a look at the doctest failures.",
    "created_at": "2014-09-12T07:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220119",
    "user": "jdemeyer"
}
```

I'll have a look at the doctest failures.



---

archive/issue_comments_220120.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> I'll have a look at the doctest failures.\nThere is no need to, I just fixed them and only have to test them on 32-bit.",
    "created_at": "2014-09-12T07:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220120",
    "user": "pbruin"
}
```

Replying to [comment:25 jdemeyer]:
> I'll have a look at the doctest failures.
There is no need to, I just fixed them and only have to test them on 32-bit.



---

archive/issue_comments_220121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-12T07:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220121",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_220122.json:
```json
{
    "body": "Another trivial change to a French book test.",
    "created_at": "2014-09-12T07:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220122",
    "user": "jdemeyer"
}
```

Another trivial change to a French book test.



---

archive/issue_comments_220123.json:
```json
{
    "body": "Do you understand why floats from Maxima are now printed with one digit less of precision???",
    "created_at": "2014-09-12T08:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220123",
    "user": "jdemeyer"
}
```

Do you understand why floats from Maxima are now printed with one digit less of precision???



---

archive/issue_comments_220124.json:
```json
{
    "body": "Replying to [comment:29 jdemeyer]:\n> Do you understand why floats from Maxima are now printed with one digit less of precision???\nThis is because of recent changes (between 5.33.0 and 5.34.0) to Maxima's `exploden-format-float` function.  In fact, on certain Lisp implementations and platforms (including ECL on x86_64), Maxima used to often print one digit too many; see #15921 for details.",
    "created_at": "2014-09-12T08:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220124",
    "user": "pbruin"
}
```

Replying to [comment:29 jdemeyer]:
> Do you understand why floats from Maxima are now printed with one digit less of precision???
This is because of recent changes (between 5.33.0 and 5.34.0) to Maxima's `exploden-format-float` function.  In fact, on certain Lisp implementations and platforms (including ECL on x86_64), Maxima used to often print one digit too many; see #15921 for details.



---

archive/issue_comments_220125.json:
```json
{
    "body": "All relevant doctests (the failed ones above, and everything in `sage/interfaces/maxima_*`, `sage/calculus`, `sage/functions`, `sage/symbolic`) pass on x86_64 and ARM.  Since I ran all long doctests before, I now leave it to the buildbot to catch any unlikely remaining failures...",
    "created_at": "2014-09-12T09:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220125",
    "user": "pbruin"
}
```

All relevant doctests (the failed ones above, and everything in `sage/interfaces/maxima_*`, `sage/calculus`, `sage/functions`, `sage/symbolic`) pass on x86_64 and ARM.  Since I ran all long doctests before, I now leave it to the buildbot to catch any unlikely remaining failures...



---

archive/issue_comments_220126.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-09-12T09:38:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220126",
    "user": "pbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_220127.json:
```json
{
    "body": "I'm not happy with the changes in the French book tests. In some places you use `...`\nwhich should make tests pass both with the previous versions of Sage (this should be checked), in some places more digits are printed, which will fail with previous versions,\nand might fail with future versions, for example:\n\n```\n     sage: t, y = var('t, y')\n     sage: desolve_rk4(t*y*(2-y), y, ics=[0,1], end_points=[0, 1], step=0.5)\n-    [[0, 1], [0.5, 1.12419127425], [1.0, 1.46159016229]]\n+    [[0, 1], [0.5, 1.12419127424558], [1.0, 1.4615901622888245]]\n```\n\nPaul",
    "created_at": "2014-09-12T09:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220127",
    "user": "zimmerma"
}
```

I'm not happy with the changes in the French book tests. In some places you use `...`
which should make tests pass both with the previous versions of Sage (this should be checked), in some places more digits are printed, which will fail with previous versions,
and might fail with future versions, for example:

```
     sage: t, y = var('t, y')
     sage: desolve_rk4(t*y*(2-y), y, ics=[0,1], end_points=[0, 1], step=0.5)
-    [[0, 1], [0.5, 1.12419127425], [1.0, 1.46159016229]]
+    [[0, 1], [0.5, 1.12419127424558], [1.0, 1.4615901622888245]]
```

Paul



---

archive/issue_comments_220128.json:
```json
{
    "body": "Replying to [comment:32 zimmerma]:\n> I'm not happy with the changes in the French book tests.\nI assume you are mostly referring to the changes made by #16858; this ticket only removes one digit.\n\n> In some places you use `...`\n> which should make tests pass both with the previous versions of Sage (this should be checked), in some places more digits are printed, which will fail with previous versions,\n> and might fail with future versions, for example:\n> {{{\n>      sage: t, y = var('t, y')\n>      sage: desolve_rk4(t*y*(2-y), y, ics=[0,1], end_points=[0, 1], step=0.5)\n> -    [[0, 1], [0.5, 1.12419127425], [1.0, 1.46159016229]]\n> +    [[0, 1], [0.5, 1.12419127424558], [1.0, 1.4615901622888245]]\n> }}}\nDo I understand correctly that you propose to always use `...` and only keep the minimum among the various numbers of digits that are output by all existing versions of Sage?\n\nCould you explain more precisely why you object to showing the output of the doctests with the (increased) precision used by the current Sage version?  Does it cause more work for you to keep them updated, or do you expect it may cause confusion among users with different versions of Sage?",
    "created_at": "2014-09-12T10:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220128",
    "user": "pbruin"
}
```

Replying to [comment:32 zimmerma]:
> I'm not happy with the changes in the French book tests.
I assume you are mostly referring to the changes made by #16858; this ticket only removes one digit.

> In some places you use `...`
> which should make tests pass both with the previous versions of Sage (this should be checked), in some places more digits are printed, which will fail with previous versions,
> and might fail with future versions, for example:
> {{{
>      sage: t, y = var('t, y')
>      sage: desolve_rk4(t*y*(2-y), y, ics=[0,1], end_points=[0, 1], step=0.5)
> -    [[0, 1], [0.5, 1.12419127425], [1.0, 1.46159016229]]
> +    [[0, 1], [0.5, 1.12419127424558], [1.0, 1.4615901622888245]]
> }}}
Do I understand correctly that you propose to always use `...` and only keep the minimum among the various numbers of digits that are output by all existing versions of Sage?

Could you explain more precisely why you object to showing the output of the doctests with the (increased) precision used by the current Sage version?  Does it cause more work for you to keep them updated, or do you expect it may cause confusion among users with different versions of Sage?



---

archive/issue_comments_220129.json:
```json
{
    "body": "> I assume you are mostly referring to the changes made by #16858; this ticket only removes one digit.\n\nI refer to changeset `e216b6f` in comment [comment:27].\n\nYes it would be better to only keep the minimum number of digits output by all versions of Sage (since the one we use in our book, i.e., 5.9).\n\nThe intent of those doctests is to only to check the examples that were **printed** in the book still work in versions of Sage after 5.9. Thus it makes no sense to add more digits than those that were actually printed on http://sagebook.gforge.inria.fr/. Any doctests with a different intent should go elsewhere in my opinion.\n\nPaul",
    "created_at": "2014-09-12T10:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220129",
    "user": "zimmerma"
}
```

> I assume you are mostly referring to the changes made by #16858; this ticket only removes one digit.

I refer to changeset `e216b6f` in comment [comment:27].

Yes it would be better to only keep the minimum number of digits output by all versions of Sage (since the one we use in our book, i.e., 5.9).

The intent of those doctests is to only to check the examples that were **printed** in the book still work in versions of Sage after 5.9. Thus it makes no sense to add more digits than those that were actually printed on http://sagebook.gforge.inria.fr/. Any doctests with a different intent should go elsewhere in my opinion.

Paul



---

archive/issue_comments_220130.json:
```json
{
    "body": "Replying to [comment:34 zimmerma]:\n> > I assume you are mostly referring to the changes made by #16858; this ticket only removes one digit.\n> \n> I refer to changeset `e216b6f` in comment [comment:27].\nThe only change made by that changeset in the `french_book` directory is\n\n```diff\n--- a/src/sage/tests/french_book/integration_doctest.py\n+++ b/src/sage/tests/french_book/integration_doctest.py\n@@ -180,7 +180,7 @@ Sage example in ./integration.tex, line 838::\n \n     sage: t, y = var('t, y')\n     sage: desolve_rk4(t*y*(2-y), y, ics=[0,1], end_points=[0, 1], step=0.5)\n-    [[0, 1], [0.5, 1.12419127424558], [1.0, 1.4615901622888245]]\n+    [[0, 1], [0.5, 1.12419127424558], [1.0, 1.461590162288825]]\n \n     Sage example in ./integration.tex, line 861::\n \n```\n\nThe (earlier) commit that added the extra digits was 7cb1dd50 in #16858.\n> Yes it would be better to only keep the minimum number of digits output by all versions of Sage (since the one we use in our book, i.e., 5.9).\n> \n> The intent of those doctests is to only to check the examples that were **printed** in the book still work in versions of Sage after 5.9.\nOK, but surely a doctest where the only change is an increased precision should be classified as \"still working\"?  In any case, a user who types the doctest in a newer version of Sage will also see the extra digits.\n> Thus it makes no sense to add more digits than those that were actually printed on http://sagebook.gforge.inria.fr/. Any doctests with a different intent should go elsewhere in my opinion.\nI don't disagree, but given that the doctests need to be updated in any case, I don't understand why adding the extra digits is bad and adding `...` is better.  Feel free to open a ticket for it, though!",
    "created_at": "2014-09-12T11:12:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220130",
    "user": "pbruin"
}
```

Replying to [comment:34 zimmerma]:
> > I assume you are mostly referring to the changes made by #16858; this ticket only removes one digit.
> 
> I refer to changeset `e216b6f` in comment [comment:27].
The only change made by that changeset in the `french_book` directory is

```diff
--- a/src/sage/tests/french_book/integration_doctest.py
+++ b/src/sage/tests/french_book/integration_doctest.py
@@ -180,7 +180,7 @@ Sage example in ./integration.tex, line 838::
 
     sage: t, y = var('t, y')
     sage: desolve_rk4(t*y*(2-y), y, ics=[0,1], end_points=[0, 1], step=0.5)
-    [[0, 1], [0.5, 1.12419127424558], [1.0, 1.4615901622888245]]
+    [[0, 1], [0.5, 1.12419127424558], [1.0, 1.461590162288825]]
 
     Sage example in ./integration.tex, line 861::
 
```

The (earlier) commit that added the extra digits was 7cb1dd50 in #16858.
> Yes it would be better to only keep the minimum number of digits output by all versions of Sage (since the one we use in our book, i.e., 5.9).
> 
> The intent of those doctests is to only to check the examples that were **printed** in the book still work in versions of Sage after 5.9.
OK, but surely a doctest where the only change is an increased precision should be classified as "still working"?  In any case, a user who types the doctest in a newer version of Sage will also see the extra digits.
> Thus it makes no sense to add more digits than those that were actually printed on http://sagebook.gforge.inria.fr/. Any doctests with a different intent should go elsewhere in my opinion.
I don't disagree, but given that the doctests need to be updated in any case, I don't understand why adding the extra digits is bad and adding `...` is better.  Feel free to open a ticket for it, though!



---

archive/issue_comments_220131.json:
```json
{
    "body": "I won't spend more time on this, please remove the tests corresponding to examples in our book that you break, it makes no sense to maintain them since the original goal is lost.\n\nPaul",
    "created_at": "2014-09-12T11:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220131",
    "user": "zimmerma"
}
```

I won't spend more time on this, please remove the tests corresponding to examples in our book that you break, it makes no sense to maintain them since the original goal is lost.

Paul



---

archive/issue_comments_220132.json:
```json
{
    "body": "Replying to [comment:36 zimmerma]:\n> I won't spend more time on this, please remove the tests corresponding to examples in our book that you break, it makes no sense to maintain them since the original goal is lost.\n\nI agree with Peter Bruin that printing a few less or more digits doesn't really \"break\" the test. Even if the goal of reproducing the *exact output* of the book cannot be achieved, at least the goal of having output *reasonably close* to the book can be maintained.",
    "created_at": "2014-09-12T11:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220132",
    "user": "jdemeyer"
}
```

Replying to [comment:36 zimmerma]:
> I won't spend more time on this, please remove the tests corresponding to examples in our book that you break, it makes no sense to maintain them since the original goal is lost.

I agree with Peter Bruin that printing a few less or more digits doesn't really "break" the test. Even if the goal of reproducing the *exact output* of the book cannot be achieved, at least the goal of having output *reasonably close* to the book can be maintained.



---

archive/issue_comments_220133.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-16T18:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16671",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16671#issuecomment-220133",
    "user": "vbraun"
}
```

Resolution: fixed
