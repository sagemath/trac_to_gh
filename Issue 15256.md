# Issue 15256: Memory leak in QQbar

Issue created by migration from Trac.

Original creator: mmezzarobba

Original creation time: 2013-12-07 20:48:24

`sage.rings.qqbar.ANRoot._interval_fast()` creates new interval fields by `type(self._interval.parent())(prec)`, thus bypassing the cache provided by `RealIntervalField()`. Computations with algebraic numbers sometimes need gigabytes of memory to store these parents and the associated coercion structures.

The best (natural) example I have is ,using [ore_algebra](http://www.risc.jku.at/research/combinat/software/ore_algebra/index.php):

```
sage: from ore_algebra import *; R.<n> = QQ[]; A.<Sn> = OreAlgebra(R)
sage: rec = (n^2+10*n+24)*Sn^6 + (-16*n-64)*Sn^4 + (-4*n-14)*Sn^3 + 64*Sn^2 + 32*Sn
sage: rec.generalized_series_solutions(1, infolevel=5)
```



---

Comment by mmezzarobba created at 2013-12-07 21:22:51

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2013-12-07 21:22:51

New commits:


---

Comment by jdemeyer created at 2013-12-08 09:01:10

Please use the correct doctest syntax:

```
EXAMPLES::

    sage: 1 + 1
    2

More text::

    sage: 2 + 2
    4
```



---

Comment by jdemeyer created at 2013-12-08 09:01:10

Changing status from needs_review to needs_work.


---

Comment by git created at 2013-12-08 09:09:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2013-12-08 09:11:59

Replying to [comment:2 jdemeyer]:
> Please use the correct doctest syntax:

Oops. Thanks!


---

Comment by mmezzarobba created at 2013-12-08 09:11:59

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2013-12-20 09:35:25

Note that  #14711 and #15367 likely avoid or at least mitigate the memory leak--but it does not hurt to fix `interval_fast()` in any case!


---

Comment by mmezzarobba created at 2014-03-04 09:38:38

Changing keywords from "" to "memory, qqbar".


---

Comment by zimmerma created at 2014-03-25 10:44:02

I just tried your example with version 0.1 of ore_algebra (from the RISC homepage), but got an error:

```
sage: rec.generalized_series_solutions(1, infolevel=5)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-ebd2bbf4a9be> in <module>()
----> 1 rec.generalized_series_solutions(Integer(1), infolevel=Integer(5))

TypeError: generalized_series_solutions() got an unexpected keyword argument 'infolevel'
```

Maybe you did use a more recent version of ore_algebra?

Paul


---

Comment by mmezzarobba created at 2014-03-25 10:48:15

Replying to [comment:9 zimmerma]:
> Maybe you did use a more recent version of ore_algebra?

It could be that I used the git version, yes. Does it work without `infolevel`?


---

Comment by zimmerma created at 2014-03-25 21:10:09

> Does it work without infolevel? 

yes and no (with Sage 6.1 and ore_algebra 0.1):

```
sage: rec.generalized_series_solutions(1)
...
ValueError: factorization of 0 not defined
```

Paul


---

Comment by mmezzarobba created at 2014-03-28 15:24:27

Replying to [comment:11 zimmerma]:
> > Does it work without infolevel? 
> 
> yes and no (with Sage 6.1 and ore_algebra 0.1):

You are right, my example did not work with ore_algebraÂ 0.1 (I used a development version that does not seem to be publicly available yet).


---

Comment by vdelecroix created at 2014-06-13 23:02:17

Hi Marc,

To mention a trac ticket, use :trac:`15493` instead of #15493. That way, there is a nice hyperlink in the documentation!

Once that done, it is ready for positive review.

Vincent


---

Comment by vdelecroix created at 2014-06-13 23:02:28

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-06-14 06:08:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2014-06-14 06:10:48

Replying to [comment:14 vdelecroix]:
> To mention a trac ticket, use :trac:`15493` instead of #15493. That way, there is a nice hyperlink in the documentation!

Yes, I keep forgetting! Thanks!


---

Comment by mmezzarobba created at 2014-06-14 06:11:00

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2014-06-14 07:49:31

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2014-06-14 07:49:31

Hello,

Wonderful. Thanks.

Vincent


---

Comment by vbraun created at 2014-06-15 15:24:25

Resolution: fixed
