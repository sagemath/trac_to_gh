# Issue 12795: comparison of pi and infinity wrong

archive/issues_012795.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  kcrisman\n\nKeywords: compare pi infinity bool\n\nWe have \n\n```\nsage: bool(pi<Infinity)\nFalse\nsage: bool(pi>Infinity)\nTrue\n```\n\nwhich is obviously wrong. It seems that the problem only occurs with `pi`, because the following give correct results\n\n```\nsage: bool(pi<2*pi)\nTrue\nsage: bool(2*pi<Infinity)\nTrue\nsage: bool(e<Infinity)  \nTrue\nsage: bool(e<pi)\nTrue\n```\n\n\nThis was reported on [sage-support](https://groups.google.com/d/topic/sage-support/2GlgJKOfK3g/discussion) by Robert Samal.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12967\n\n",
    "created_at": "2012-05-18T08:16:35Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "comparison of pi and infinity wrong",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12795",
    "user": "dkrenn"
}
```
Assignee: burcin

CC:  kcrisman

Keywords: compare pi infinity bool

We have 

```
sage: bool(pi<Infinity)
False
sage: bool(pi>Infinity)
True
```

which is obviously wrong. It seems that the problem only occurs with `pi`, because the following give correct results

```
sage: bool(pi<2*pi)
True
sage: bool(2*pi<Infinity)
True
sage: bool(e<Infinity)  
True
sage: bool(e<pi)
True
```


This was reported on [sage-support](https://groups.google.com/d/topic/sage-support/2GlgJKOfK3g/discussion) by Robert Samal.

Issue created by migration from https://trac.sagemath.org/ticket/12967





---

archive/issue_comments_153555.json:
```json
{
    "body": "ATM, this is caused by #11506:\n\n\n```\nsage: pi.pyobject()\npi\nsage: type(pi.pyobject())\n<class 'sage.symbolic.constants.Pi'>\nsage: pi.pyobject() < oo        \nFalse\nsage: pi.pyobject() > oo\nTrue\n```\n\n\nWith #12950,  comparison of infinities in Pynac changed. Now I get:\n\n\n```\nsage: bool(pi>Infinity)\nFalse\nsage: bool(pi<Infinity) \nFalse\n```\n\n\nwhich is better. I hope with the ordering patches in the Pynac queue this will improve.\n\nThe results of comparison with `e` is not relevant in this case. `e` is not a constant in Pynac, it is the `exp()` function. Once you form the relational expression `e < Infinity`, the comparison is handled differently.\n\nI suggest adding a patch with doctests reflecting the new behavior with #12950 and closing this ticket when #12950 is merged.",
    "created_at": "2012-05-18T09:13:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153555",
    "user": "burcin"
}
```

ATM, this is caused by #11506:


```
sage: pi.pyobject()
pi
sage: type(pi.pyobject())
<class 'sage.symbolic.constants.Pi'>
sage: pi.pyobject() < oo        
False
sage: pi.pyobject() > oo
True
```


With #12950,  comparison of infinities in Pynac changed. Now I get:


```
sage: bool(pi>Infinity)
False
sage: bool(pi<Infinity) 
False
```


which is better. I hope with the ordering patches in the Pynac queue this will improve.

The results of comparison with `e` is not relevant in this case. `e` is not a constant in Pynac, it is the `exp()` function. Once you form the relational expression `e < Infinity`, the comparison is handled differently.

I suggest adding a patch with doctests reflecting the new behavior with #12950 and closing this ticket when #12950 is merged.



---

archive/issue_comments_153556.json:
```json
{
    "body": "Here's the quick patch with some doctests reflecting the new behavior.",
    "created_at": "2012-12-10T22:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153556",
    "user": "tscrim"
}
```

Here's the quick patch with some doctests reflecting the new behavior.



---

archive/issue_comments_153557.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-12-10T22:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153557",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_153558.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-12-10T22:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153558",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_153559.json:
```json
{
    "body": "\n```\n\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nsage: bool(pi < infinity)\nFalse\nsage: bool(oo < pi)\nFalse\n```\n\nThat is what should actually be tested, as Burcin points out.  Also, I feel like this is unintuitive enough of behavior (that pi is more or less incomparable with infinity and not like this)\n\n```\nsage: bool(2< oo)\nTrue\n```\n\nthat we should say something to that effect here, maybe even elsewhere in comparison doc where we have other examples saying that `>` gives `False` if we can't prove it's `True`.\n| Sage Version 5.4.1, Release Date: 2012-11-15                       |\n| Type \"notebook()\" for the browser-based notebook interface.        |\n| Type \"help()\" for help.                                            |\nI'm also wondering whether this is really \"fixed\" and deserves that doctest status.",
    "created_at": "2012-12-10T22:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153559",
    "user": "kcrisman"
}
```


```

----------------------------------------------------------------------
----------------------------------------------------------------------
sage: bool(pi < infinity)
False
sage: bool(oo < pi)
False
```

That is what should actually be tested, as Burcin points out.  Also, I feel like this is unintuitive enough of behavior (that pi is more or less incomparable with infinity and not like this)

```
sage: bool(2< oo)
True
```

that we should say something to that effect here, maybe even elsewhere in comparison doc where we have other examples saying that `>` gives `False` if we can't prove it's `True`.
| Sage Version 5.4.1, Release Date: 2012-11-15                       |
| Type "notebook()" for the browser-based notebook interface.        |
| Type "help()" for help.                                            |
I'm also wondering whether this is really "fixed" and deserves that doctest status.



---

archive/issue_comments_153560.json:
```json
{
    "body": "How about this? Can you think of any other places to put the warning about symbolic ring comparisons? Thanks.",
    "created_at": "2012-12-10T22:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153560",
    "user": "tscrim"
}
```

How about this? Can you think of any other places to put the warning about symbolic ring comparisons? Thanks.



---

archive/issue_comments_153561.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-10T22:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153561",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_153562.json:
```json
{
    "body": "There is a typo I am fixing in a review patch.\n\nOtherwise I'll give the patch qua patch positive review - I don't think there is more you can do here, this seems fine and passes tests etc. - but wait on a comment from Burcin or someone else as to whether this should count as a fix before pressing the button.  I guess I'm just a little uncomfortable with that, though I understand the sentiment and could be easily persuaded by a third party.",
    "created_at": "2012-12-11T03:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153562",
    "user": "kcrisman"
}
```

There is a typo I am fixing in a review patch.

Otherwise I'll give the patch qua patch positive review - I don't think there is more you can do here, this seems fine and passes tests etc. - but wait on a comment from Burcin or someone else as to whether this should count as a fix before pressing the button.  I guess I'm just a little uncomfortable with that, though I understand the sentiment and could be easily persuaded by a third party.



---

archive/issue_comments_153563.json:
```json
{
    "body": "Apply only this patch",
    "created_at": "2012-12-11T03:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153563",
    "user": "kcrisman"
}
```

Apply only this patch



---

archive/issue_comments_153564.json:
```json
{
    "body": "Attachment [trac_12967-symbolic_ring-review.patch](tarball://root/attachments/some-uuid/ticket12967/trac_12967-symbolic_ring-review.patch) by kcrisman created at 2012-12-11 03:24:22\n\nPatchbot, apply trac_12967-symbolic_ring-review.patch",
    "created_at": "2012-12-11T03:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153564",
    "user": "kcrisman"
}
```

Attachment [trac_12967-symbolic_ring-review.patch](tarball://root/attachments/some-uuid/ticket12967/trac_12967-symbolic_ring-review.patch) by kcrisman created at 2012-12-11 03:24:22

Patchbot, apply trac_12967-symbolic_ring-review.patch



---

archive/issue_comments_153565.json:
```json
{
    "body": "I'll let someone else set this to positive review, and I do understand your discomfort. Thank you for the review.",
    "created_at": "2012-12-11T04:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153565",
    "user": "tscrim"
}
```

I'll let someone else set this to positive review, and I do understand your discomfort. Thank you for the review.



---

archive/issue_comments_153566.json:
```json
{
    "body": "This is absurd. Why should `bool(pi < oo)` return `False`? If we have symbolic *constants*, then we should be able to coerce them to some ring, possibly RR, and do the comparison.",
    "created_at": "2012-12-11T07:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153566",
    "user": "ppurka"
}
```

This is absurd. Why should `bool(pi < oo)` return `False`? If we have symbolic *constants*, then we should be able to coerce them to some ring, possibly RR, and do the comparison.



---

archive/issue_comments_153567.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-06-18T19:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153567",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_153568.json:
```json
{
    "body": "Replying to [comment:9 ppurka]:\n> This is absurd. Why should `bool(pi < oo)` return `False`? If we have symbolic *constants*, then we should be able to coerce them to some ring, possibly RR, and do the comparison.\nI agree.  This comparison is apparently done by Pynac.  Using Maxima gives the correct result:\n\n```\nsage: e = (SR(pi) < SR(Infinity)); e\npi < +Infinity\nsage: bool(e)\nFalse\nsage: maxima(e)\n%pi<inf\nsage: bool(maxima(e))\nTrue\n```\n\n(This is not fixed by #11506, by the way.)",
    "created_at": "2014-05-22T19:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153568",
    "user": "pbruin"
}
```

Replying to [comment:9 ppurka]:
> This is absurd. Why should `bool(pi < oo)` return `False`? If we have symbolic *constants*, then we should be able to coerce them to some ring, possibly RR, and do the comparison.
I agree.  This comparison is apparently done by Pynac.  Using Maxima gives the correct result:

```
sage: e = (SR(pi) < SR(Infinity)); e
pi < +Infinity
sage: bool(e)
False
sage: maxima(e)
%pi<inf
sage: bool(maxima(e))
True
```

(This is not fixed by #11506, by the way.)



---

archive/issue_comments_153569.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2014-05-22T19:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153569",
    "user": "pbruin"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_153570.json:
```json
{
    "body": "See #16397 for more (but unrelated, I think) SR comparison issues.",
    "created_at": "2014-05-25T17:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153570",
    "user": "vbraun"
}
```

See #16397 for more (but unrelated, I think) SR comparison issues.



---

archive/issue_comments_153571.json:
```json
{
    "body": "Also interesting:\n\n```\nsage: cmp(SR(oo), sqrt(2))\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-7-aaaac68122b2> in <module>()\n----> 1 cmp(SR(oo), sqrt(Integer(2)))\n\n/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.__cmp__ (sage/symbolic/expression.cpp:16780)()\n\n/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element._cmp (sage/structure/element.c:8490)()\n\n/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._cmp_c_impl (sage/symbolic/expression.cpp:16834)()\n\nRuntimeError: comparing typeid's\n```\n\nPrint order is broken for some combination of symbolic ex'es.",
    "created_at": "2014-05-25T21:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153571",
    "user": "vbraun"
}
```

Also interesting:

```
sage: cmp(SR(oo), sqrt(2))
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-7-aaaac68122b2> in <module>()
----> 1 cmp(SR(oo), sqrt(Integer(2)))

/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.__cmp__ (sage/symbolic/expression.cpp:16780)()

/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element._cmp (sage/structure/element.c:8490)()

/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._cmp_c_impl (sage/symbolic/expression.cpp:16834)()

RuntimeError: comparing typeid's
```

Print order is broken for some combination of symbolic ex'es.



---

archive/issue_comments_153572.json:
```json
{
    "body": "Replying to [comment:1 burcin]:\n> {{{\n> sage: bool(pi>Infinity)\n> False\n> sage: bool(pi<Infinity) \n> False\n> }}}\n> \n> which is better. I hope with the ordering patches in the Pynac queue this will improve.\nStill not improved. What is meant exactly here? Does someone have a link to a ticket somewhere?",
    "created_at": "2015-02-22T08:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153572",
    "user": "rws"
}
```

Replying to [comment:1 burcin]:
> {{{
> sage: bool(pi>Infinity)
> False
> sage: bool(pi<Infinity) 
> False
> }}}
> 
> which is better. I hope with the ordering patches in the Pynac queue this will improve.
Still not improved. What is meant exactly here? Does someone have a link to a ticket somewhere?



---

archive/issue_comments_153573.json:
```json
{
    "body": "if something is incomparable or the answer is not known \nthe way to go is an exception; see discussion at \nhttps://groups.google.com/forum/#!msg/sage-devel/vNxnHSeRBW4/0OpeL0yv9YUJ\n(or a multistate result, which cannot be converted or compared with a bool (`True/False`);\n\nEverything else is in my opinion a major design flaw and will lead to plethora of bugs !!!",
    "created_at": "2015-02-22T13:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153573",
    "user": "jakobkroeker"
}
```

if something is incomparable or the answer is not known 
the way to go is an exception; see discussion at 
https://groups.google.com/forum/#!msg/sage-devel/vNxnHSeRBW4/0OpeL0yv9YUJ
(or a multistate result, which cannot be converted or compared with a bool (`True/False`);

Everything else is in my opinion a major design flaw and will lead to plethora of bugs !!!



---

archive/issue_comments_153574.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-23T08:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153574",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_153575.json:
```json
{
    "body": "This utilizes the `InfinityRing` for comparison. Doctest failures related to infinities show there is more to do.\n\nReplying to [comment:19 jakobkroeker]:\n> if something is incomparable or the answer is not known \n> the way to go is an exception\nYou will understand this all cannot be part of this ticket.\nEDIT: Actually the failing doctests support your opinion, and probably I better adapt the tests to the new behaviour.\n----\nNew commits:",
    "created_at": "2015-02-23T08:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153575",
    "user": "rws"
}
```

This utilizes the `InfinityRing` for comparison. Doctest failures related to infinities show there is more to do.

Replying to [comment:19 jakobkroeker]:
> if something is incomparable or the answer is not known 
> the way to go is an exception
You will understand this all cannot be part of this ticket.
EDIT: Actually the failing doctests support your opinion, and probably I better adapt the tests to the new behaviour.
----
New commits:



---

archive/issue_comments_153576.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-23T09:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153576",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_153577.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/structure/parent.pyx\n**********************************************************************\nFile \"src/sage/structure/parent.pyx\", line 1224, in sage.structure.parent.Parent.__contains__\nFailed example:\n    pi in RIF # there is no element of RIF equal to pi\nExpected:\n    False\nGot:\n    True\n```\n",
    "created_at": "2015-02-24T07:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153577",
    "user": "rws"
}
```


```
sage -t --long src/sage/structure/parent.pyx
**********************************************************************
File "src/sage/structure/parent.pyx", line 1224, in sage.structure.parent.Parent.__contains__
Failed example:
    pi in RIF # there is no element of RIF equal to pi
Expected:
    False
Got:
    True
```




---

archive/issue_comments_153578.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-24T07:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153578",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_153579.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-25T07:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153579",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_153580.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-25T07:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153580",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_153581.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-26T08:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153581",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_153582.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-26T08:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153582",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_153583.json:
```json
{
    "body": "It was wrong to always raise an exception when an interval was compared. The reason why `pi in RIF` was `True` rather lies in `structure.parent.py:Parent.contains()` where the line\n\n```\nEQ = (x2 == x)\n```\n\ndidn't account for symbolics and should read\n\n```\nEQ = bool(x2 == x)\n```\n\nThis uncovers another bug in `Expression.nonzero()` which shows as\n\n```\nsage: bool(sqrt(2)==CC(sqrt(2)))\nFalse\n```\n\nbecause `sqrt(2) == 1.41421356237309` is `False`. Any ideas how to fit this in the current code?\n\nEDIT: See also https://groups.google.com/forum/?hl=en#!topic/sage-devel/QBAipylR6iM",
    "created_at": "2015-02-26T08:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153583",
    "user": "rws"
}
```

It was wrong to always raise an exception when an interval was compared. The reason why `pi in RIF` was `True` rather lies in `structure.parent.py:Parent.contains()` where the line

```
EQ = (x2 == x)
```

didn't account for symbolics and should read

```
EQ = bool(x2 == x)
```

This uncovers another bug in `Expression.nonzero()` which shows as

```
sage: bool(sqrt(2)==CC(sqrt(2)))
False
```

because `sqrt(2) == 1.41421356237309` is `False`. Any ideas how to fit this in the current code?

EDIT: See also https://groups.google.com/forum/?hl=en#!topic/sage-devel/QBAipylR6iM



---

archive/issue_comments_153584.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-26T17:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153584",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_153585.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-26T17:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153585",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_153586.json:
```json
{
    "body": "Resolved by a dedicated `CC.__contains__`.",
    "created_at": "2015-02-26T17:36:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153586",
    "user": "rws"
}
```

Resolved by a dedicated `CC.__contains__`.



---

archive/issue_comments_153587.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-04T16:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153587",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_153588.json:
```json
{
    "body": "No, I give up. Better fix pynac.",
    "created_at": "2015-03-04T16:14:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153588",
    "user": "rws"
}
```

No, I give up. Better fix pynac.



---

archive/issue_comments_153589.json:
```json
{
    "body": "Reboot. This branch has clean logic handling all relations that can be decided without Maxima. I have left in the call to Pynac's `relational_to_bool` although it could possibly replaced too. The branch depends on #17984.\n\nHowever, there is one doctest failure:\n\n```\nFile \"src/sage/structure/parent.pyx\", line 1224, in sage.structure.parent.Parent.__contains__\nFailed example:\n    pi in RIF # there is no element of RIF equal to pi\nExpected:\n    False\nGot:\n    True\n```\n\nIt is caused because `Parent.__contains__` assumes wrongly that all\nequations that are of type `Expression` must be true, and `pi == RIF(pi)` isn't.\nIn develop this is masked by code catching all kinds of exceptions that hides the fact that the conversion of the relation to Maxima throws an exception. The code takes this to mean that `pi == RIF(pi)` is `False`. In contrast this branch determines without invoking Maxima correctly that the relation is `False` but the fact no exception is thrown leads to `Parent.__contains__` returning `True`! Since it's clearly wrong here to throw an exception just to oblige `Parent.__contains__` that method in turn must be fixed.\n----\nNew commits:",
    "created_at": "2015-03-19T09:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153589",
    "user": "rws"
}
```

Reboot. This branch has clean logic handling all relations that can be decided without Maxima. I have left in the call to Pynac's `relational_to_bool` although it could possibly replaced too. The branch depends on #17984.

However, there is one doctest failure:

```
File "src/sage/structure/parent.pyx", line 1224, in sage.structure.parent.Parent.__contains__
Failed example:
    pi in RIF # there is no element of RIF equal to pi
Expected:
    False
Got:
    True
```

It is caused because `Parent.__contains__` assumes wrongly that all
equations that are of type `Expression` must be true, and `pi == RIF(pi)` isn't.
In develop this is masked by code catching all kinds of exceptions that hides the fact that the conversion of the relation to Maxima throws an exception. The code takes this to mean that `pi == RIF(pi)` is `False`. In contrast this branch determines without invoking Maxima correctly that the relation is `False` but the fact no exception is thrown leads to `Parent.__contains__` returning `True`! Since it's clearly wrong here to throw an exception just to oblige `Parent.__contains__` that method in turn must be fixed.
----
New commits:



---

archive/issue_comments_153590.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-19T09:08:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153590",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_153591.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-19T09:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153591",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_153592.json:
```json
{
    "body": "I'm afraid this implementation of `__contains__()` will make `Mod(1, 2) in RR` return `True`, which is obviously wrong.  This is probably the reason why the nonsense input in the Chebyshev doctests is no longer detected.\n\nI am in general hesitant about the idea of needing a custom `__contains__()` method; the strategy to implement `x in P` as `bool(P(x) == x)` basically seems a good one to me.  How about fixing `__cmp__()` (or similar) when comparing symbolic expressions with numerical approximations so that (for example)  `bool(pi == 3.14[...])` returns `True` if the approximation is correct to the given precision?",
    "created_at": "2015-03-19T09:48:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153592",
    "user": "pbruin"
}
```

I'm afraid this implementation of `__contains__()` will make `Mod(1, 2) in RR` return `True`, which is obviously wrong.  This is probably the reason why the nonsense input in the Chebyshev doctests is no longer detected.

I am in general hesitant about the idea of needing a custom `__contains__()` method; the strategy to implement `x in P` as `bool(P(x) == x)` basically seems a good one to me.  How about fixing `__cmp__()` (or similar) when comparing symbolic expressions with numerical approximations so that (for example)  `bool(pi == 3.14[...])` returns `True` if the approximation is correct to the given precision?



---

archive/issue_comments_153593.json:
```json
{
    "body": "Na\u00efve question: what would be the problem with simply making `SR` coerce into `InfinityRing` instead of the reverse?",
    "created_at": "2015-03-19T13:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153593",
    "user": "mmezzarobba"
}
```

NaÃ¯ve question: what would be the problem with simply making `SR` coerce into `InfinityRing` instead of the reverse?



---

archive/issue_comments_153594.json:
```json
{
    "body": "Replying to [comment:35 pbruin]:\n> `bool(pi == 3.14[...])` returns `True` if the approximation is correct to the given precision?\n\nThis sounds very dangerous to me.",
    "created_at": "2015-03-19T13:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153594",
    "user": "mmezzarobba"
}
```

Replying to [comment:35 pbruin]:
> `bool(pi == 3.14[...])` returns `True` if the approximation is correct to the given precision?

This sounds very dangerous to me.



---

archive/issue_comments_153595.json:
```json
{
    "body": "Replying to [comment:35 pbruin]:\n>...the strategy to implement `x in P` as `bool(P(x) == x)` basically seems a good one to me.\nIt would be if users wanted `x in RR/CC` to mean `x element of real/complex field of exactly this precision` but the overwhelming majority want it to mean `x element of real/complex field regardless of precision`. And that's also the use cases within Sage that I have seen, and so I reflected it in the method description.",
    "created_at": "2015-03-19T13:43:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153595",
    "user": "rws"
}
```

Replying to [comment:35 pbruin]:
>...the strategy to implement `x in P` as `bool(P(x) == x)` basically seems a good one to me.
It would be if users wanted `x in RR/CC` to mean `x element of real/complex field of exactly this precision` but the overwhelming majority want it to mean `x element of real/complex field regardless of precision`. And that's also the use cases within Sage that I have seen, and so I reflected it in the method description.



---

archive/issue_comments_153596.json:
```json
{
    "body": "Replying to [comment:38 rws]:\n> Replying to [comment:35 pbruin]:\n> >...the strategy to implement `x in P` as `bool(P(x) == x)` basically seems a good one to me.\n> It would be if users wanted `x in RR/CC` to mean `x element of real/complex field of exactly this precision` but the overwhelming majority want it to mean `x element of real/complex field regardless of precision`. And that's also the use cases within Sage that I have seen, and so I reflected it in the method description.\nBut currently the precision is already taken care of in this way:\n\n```\nsage: pi.n(10) in RR\nTrue\nsage: pi.n(100) in RealField(50)\nTrue\n```\n\nIsn't this what you want to keep as the correct behaviour?",
    "created_at": "2015-03-19T13:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153596",
    "user": "pbruin"
}
```

Replying to [comment:38 rws]:
> Replying to [comment:35 pbruin]:
> >...the strategy to implement `x in P` as `bool(P(x) == x)` basically seems a good one to me.
> It would be if users wanted `x in RR/CC` to mean `x element of real/complex field of exactly this precision` but the overwhelming majority want it to mean `x element of real/complex field regardless of precision`. And that's also the use cases within Sage that I have seen, and so I reflected it in the method description.
But currently the precision is already taken care of in this way:

```
sage: pi.n(10) in RR
True
sage: pi.n(100) in RealField(50)
True
```

Isn't this what you want to keep as the correct behaviour?



---

archive/issue_comments_153597.json:
```json
{
    "body": "Replying to [comment:38 rws]:\n> the overwhelming majority want it to mean `x element of real/complex field regardless of precision`. And that's also the use cases within Sage that I have seen, and so I reflected it in the method description.\n\nI view that as a misunderstanding due to the unfortunate use of the name `RR` in sage for what actually is the set of 53-bit floating-point numbers (with some exponent bounds). In almost all other respects, the elements of `RR` do not behave like \"the reals\", and it would be wrong to view them as such!",
    "created_at": "2015-03-19T13:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153597",
    "user": "mmezzarobba"
}
```

Replying to [comment:38 rws]:
> the overwhelming majority want it to mean `x element of real/complex field regardless of precision`. And that's also the use cases within Sage that I have seen, and so I reflected it in the method description.

I view that as a misunderstanding due to the unfortunate use of the name `RR` in sage for what actually is the set of 53-bit floating-point numbers (with some exponent bounds). In almost all other respects, the elements of `RR` do not behave like "the reals", and it would be wrong to view them as such!



---

archive/issue_comments_153598.json:
```json
{
    "body": "Replying to [comment:37 mmezzarobba]:\n> Replying to [comment:35 pbruin]:\n> > `bool(pi == 3.14[...])` returns `True` if the approximation is correct to the given precision?\n> \n> This sounds very dangerous to me.\nIn fact, `bool(pi == pi.n())` already returns `True`, which I think is reasonable.  In any case it is consistent with how elements of real fields of different precisions are compared.\n\nThe question is whether we also want to use this for `x in RR`.  I currently cannot think of a natural way of implementing this.  Just checking whether `x` can be converted in to `RR` is not enough (as the example with `Mod(1, 2)` in comment:35 shows); one would at least expect that `x` can be converted into `RR` *and* that the result is \"sufficiently equal\" to the original `x`.",
    "created_at": "2015-03-19T13:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153598",
    "user": "pbruin"
}
```

Replying to [comment:37 mmezzarobba]:
> Replying to [comment:35 pbruin]:
> > `bool(pi == 3.14[...])` returns `True` if the approximation is correct to the given precision?
> 
> This sounds very dangerous to me.
In fact, `bool(pi == pi.n())` already returns `True`, which I think is reasonable.  In any case it is consistent with how elements of real fields of different precisions are compared.

The question is whether we also want to use this for `x in RR`.  I currently cannot think of a natural way of implementing this.  Just checking whether `x` can be converted in to `RR` is not enough (as the example with `Mod(1, 2)` in comment:35 shows); one would at least expect that `x` can be converted into `RR` *and* that the result is "sufficiently equal" to the original `x`.



---

archive/issue_comments_153599.json:
```json
{
    "body": "Replying to [comment:40 mmezzarobba]:\n> I view that as a misunderstanding\nWrong perspective. Rather a bad design decision.",
    "created_at": "2015-03-19T13:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153599",
    "user": "rws"
}
```

Replying to [comment:40 mmezzarobba]:
> I view that as a misunderstanding
Wrong perspective. Rather a bad design decision.



---

archive/issue_comments_153600.json:
```json
{
    "body": "Replying to [comment:40 mmezzarobba]:\n> Replying to [comment:38 rws]:\n> > the overwhelming majority want it to mean `x element of real/complex field regardless of precision`. And that's also the use cases within Sage that I have seen, and so I reflected it in the method description.\n> \n> I view that as a misunderstanding due to the unfortunate use of the name `RR` in sage for what actually is the set of 53-bit floating-point numbers (with some exponent bounds). In almost all other respects, the elements of `RR` do not behave like \"the reals\", and it would be wrong to view them as such!\nFrom that perspective, `pi in RR` should return `False`.  I personally wouldn't be opposed to this, but since there is some subtlety involved, I would expect many users won't like this.",
    "created_at": "2015-03-19T13:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153600",
    "user": "pbruin"
}
```

Replying to [comment:40 mmezzarobba]:
> Replying to [comment:38 rws]:
> > the overwhelming majority want it to mean `x element of real/complex field regardless of precision`. And that's also the use cases within Sage that I have seen, and so I reflected it in the method description.
> 
> I view that as a misunderstanding due to the unfortunate use of the name `RR` in sage for what actually is the set of 53-bit floating-point numbers (with some exponent bounds). In almost all other respects, the elements of `RR` do not behave like "the reals", and it would be wrong to view them as such!
From that perspective, `pi in RR` should return `False`.  I personally wouldn't be opposed to this, but since there is some subtlety involved, I would expect many users won't like this.



---

archive/issue_comments_153601.json:
```json
{
    "body": "Maybe we should discourage users from using `x in RR`.  There is the following alternative:\n\n```\nsage: pi.is_real()\nTrue\n```\n",
    "created_at": "2015-03-19T13:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153601",
    "user": "pbruin"
}
```

Maybe we should discourage users from using `x in RR`.  There is the following alternative:

```
sage: pi.is_real()
True
```




---

archive/issue_comments_153602.json:
```json
{
    "body": "Replying to [comment:41 pbruin]:\n>I currently cannot think of a natural way of implementing this. \nWhy generalize? The method could check if `item` has a method `is_in_RR()` which implementation in a new set is the responsibility of its author.",
    "created_at": "2015-03-19T13:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153602",
    "user": "rws"
}
```

Replying to [comment:41 pbruin]:
>I currently cannot think of a natural way of implementing this. 
Why generalize? The method could check if `item` has a method `is_in_RR()` which implementation in a new set is the responsibility of its author.



---

archive/issue_comments_153603.json:
```json
{
    "body": "Replying to [comment:44 pbruin]:\n> Maybe we should discourage users from using `x in RR`.  There is the following alternative:\n> {{{\n> sage: pi.is_real()\n> True\n> }}}\nI'm fine with that too. `RR.__contains__()` is then used for the error.",
    "created_at": "2015-03-19T14:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153603",
    "user": "rws"
}
```

Replying to [comment:44 pbruin]:
> Maybe we should discourage users from using `x in RR`.  There is the following alternative:
> {{{
> sage: pi.is_real()
> True
> }}}
I'm fine with that too. `RR.__contains__()` is then used for the error.



---

archive/issue_comments_153604.json:
```json
{
    "body": "Replying to [comment:44 pbruin]:\n> Maybe we should discourage users from using `x in RR`.  There is the following alternative:\n> {{{\n> sage: pi.is_real()\n> True\n> }}}\n\nI don't think this is a good idea. This breaks consistency across the different fields. Sage is quite inconsistent already from a user point of view, we shouldn't introduce more such inconsistencies.",
    "created_at": "2015-03-19T14:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153604",
    "user": "ppurka"
}
```

Replying to [comment:44 pbruin]:
> Maybe we should discourage users from using `x in RR`.  There is the following alternative:
> {{{
> sage: pi.is_real()
> True
> }}}

I don't think this is a good idea. This breaks consistency across the different fields. Sage is quite inconsistent already from a user point of view, we shouldn't introduce more such inconsistencies.



---

archive/issue_comments_153605.json:
```json
{
    "body": "Replying to [comment:45 rws]:\n> Replying to [comment:41 pbruin]:\n> >I currently cannot think of a natural way of implementing this. \n> Why generalize? The method could check if `item` has a method `is_in_RR()` which implementation in a new set is the responsibility of its author.\nI meant I cannot think of a better way than `bool(RR(x) == x)`.  What you propose sounds rather ad hoc; if we need a special method for `RR`, then we would also need special cases for other inexact rings like `CC`, *p*-adic rings and power series rings...  At most we could use the `is_real()` method, but looking a bit more into this, I think it does not work very well either:\n\n```\nsage: e.is_real()\nFalse\n```\n",
    "created_at": "2015-03-19T14:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153605",
    "user": "pbruin"
}
```

Replying to [comment:45 rws]:
> Replying to [comment:41 pbruin]:
> >I currently cannot think of a natural way of implementing this. 
> Why generalize? The method could check if `item` has a method `is_in_RR()` which implementation in a new set is the responsibility of its author.
I meant I cannot think of a better way than `bool(RR(x) == x)`.  What you propose sounds rather ad hoc; if we need a special method for `RR`, then we would also need special cases for other inexact rings like `CC`, *p*-adic rings and power series rings...  At most we could use the `is_real()` method, but looking a bit more into this, I think it does not work very well either:

```
sage: e.is_real()
False
```




---

archive/issue_comments_153606.json:
```json
{
    "body": "Replying to [comment:47 ppurka]:\n> Replying to [comment:44 pbruin]:\n> > Maybe we should discourage users from using `x in RR`.  There is the following alternative:\n> > {{{\n> > sage: pi.is_real()\n> > True\n> > }}}\n> \n> I don't think this is a good idea. This breaks consistency across the different fields.\nOnly if you identify `RR` with the mathematical field **R** of real numbers.  If we are serious about presenting `RR` as a certain set of numbers that is quite different from the mathematical field **R** (for example, `Infinity in RR` already returns `True`), then we can just let `pi in RR` return `False`, emphatically warn users about this, and say that different methods are needed to decide if an expression represents a mathematical real number.",
    "created_at": "2015-03-19T14:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153606",
    "user": "pbruin"
}
```

Replying to [comment:47 ppurka]:
> Replying to [comment:44 pbruin]:
> > Maybe we should discourage users from using `x in RR`.  There is the following alternative:
> > {{{
> > sage: pi.is_real()
> > True
> > }}}
> 
> I don't think this is a good idea. This breaks consistency across the different fields.
Only if you identify `RR` with the mathematical field **R** of real numbers.  If we are serious about presenting `RR` as a certain set of numbers that is quite different from the mathematical field **R** (for example, `Infinity in RR` already returns `True`), then we can just let `pi in RR` return `False`, emphatically warn users about this, and say that different methods are needed to decide if an expression represents a mathematical real number.



---

archive/issue_comments_153607.json:
```json
{
    "body": "Replying to [comment:49 pbruin]:\n> Only if you identify `RR` with the mathematical field **R** of real numbers.  If we are serious about presenting `RR` as a certain set of numbers that is quite different from the mathematical field **R** (for example, `Infinity in RR` already returns `True`), then we can just let `pi in RR` return `False`, emphatically warn users about this, and say that different methods are needed to decide if an expression represents a mathematical real number.\n\nExactly. If we want consistency across Sage, then the semantics of `x in RR` *cannot* be \"`x` is a real number\"; it must be \"`x` is an element of the parent `RR`\" or something similar.",
    "created_at": "2015-03-19T14:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153607",
    "user": "mmezzarobba"
}
```

Replying to [comment:49 pbruin]:
> Only if you identify `RR` with the mathematical field **R** of real numbers.  If we are serious about presenting `RR` as a certain set of numbers that is quite different from the mathematical field **R** (for example, `Infinity in RR` already returns `True`), then we can just let `pi in RR` return `False`, emphatically warn users about this, and say that different methods are needed to decide if an expression represents a mathematical real number.

Exactly. If we want consistency across Sage, then the semantics of `x in RR` *cannot* be "`x` is a real number"; it must be "`x` is an element of the parent `RR`" or something similar.



---

archive/issue_comments_153608.json:
```json
{
    "body": "Replying to [comment:48 pbruin]:\n> ...  What you propose sounds rather ad hoc; if we need a special method for `RR`, then we would also need special cases for other inexact rings like `CC`, *p*-adic rings and power series rings...\nBug fixing is always ad hoc. You can only make it easier (but by a huge amount) with good design and a well thought out model. Since no good model presents itself and delegating the task to the item is good design this would be an ansatz.",
    "created_at": "2015-03-19T14:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153608",
    "user": "rws"
}
```

Replying to [comment:48 pbruin]:
> ...  What you propose sounds rather ad hoc; if we need a special method for `RR`, then we would also need special cases for other inexact rings like `CC`, *p*-adic rings and power series rings...
Bug fixing is always ad hoc. You can only make it easier (but by a huge amount) with good design and a well thought out model. Since no good model presents itself and delegating the task to the item is good design this would be an ansatz.



---

archive/issue_comments_153609.json:
```json
{
    "body": "Replying to [comment:38 rws]:\n> Replying to [comment:35 pbruin]:\n> >...the strategy to implement `x in P` as `bool(P(x) == x)` basically seems a good one to me.\n> It would be if users wanted `x in RR/CC` to mean `x element of real/complex field of exactly this precision`.\n\nI don't get why you say this. Doesn't `bool(P(x) == x)` work regardless of precision?",
    "created_at": "2015-03-19T14:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153609",
    "user": "jdemeyer"
}
```

Replying to [comment:38 rws]:
> Replying to [comment:35 pbruin]:
> >...the strategy to implement `x in P` as `bool(P(x) == x)` basically seems a good one to me.
> It would be if users wanted `x in RR/CC` to mean `x element of real/complex field of exactly this precision`.

I don't get why you say this. Doesn't `bool(P(x) == x)` work regardless of precision?



---

archive/issue_comments_153610.json:
```json
{
    "body": "Replying to [comment:51 rws]:\n> Replying to [comment:48 pbruin]:\n> > ...  What you propose sounds rather ad hoc; if we need a special method for `RR`, then we would also need special cases for other inexact rings like `CC`, *p*-adic rings and power series rings...\n> Bug fixing is always ad hoc.\nNot at all; I often find that a good first step towards fundamentally fixing a bug is trying to *remove* hacks that someone else put in to make a specific example work.\n> You can only make it easier (but by a huge amount) with good design and a well thought out model. Since no good model presents itself and delegating the task to the item is good design this would be an ansatz.\nI disagree that no good model presents itself; defining `x in P` as `bool(P(x) == x)` seems like a good programming model to me, since it is simple and predictable.\n\nThe more I think about it, the more the fundamental problem does not seem to be membership testing, but *comparison* between real numbers defined in different approximations of the real numbers.  Do we want `RR(sqrt(2))` to be equal to `SR(sqrt(2))` or not?  And what about `RR(1/3)` and `QQ(1/3)`?",
    "created_at": "2015-03-19T14:53:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153610",
    "user": "pbruin"
}
```

Replying to [comment:51 rws]:
> Replying to [comment:48 pbruin]:
> > ...  What you propose sounds rather ad hoc; if we need a special method for `RR`, then we would also need special cases for other inexact rings like `CC`, *p*-adic rings and power series rings...
> Bug fixing is always ad hoc.
Not at all; I often find that a good first step towards fundamentally fixing a bug is trying to *remove* hacks that someone else put in to make a specific example work.
> You can only make it easier (but by a huge amount) with good design and a well thought out model. Since no good model presents itself and delegating the task to the item is good design this would be an ansatz.
I disagree that no good model presents itself; defining `x in P` as `bool(P(x) == x)` seems like a good programming model to me, since it is simple and predictable.

The more I think about it, the more the fundamental problem does not seem to be membership testing, but *comparison* between real numbers defined in different approximations of the real numbers.  Do we want `RR(sqrt(2))` to be equal to `SR(sqrt(2))` or not?  And what about `RR(1/3)` and `QQ(1/3)`?



---

archive/issue_comments_153611.json:
```json
{
    "body": "Replying to [comment:52 jdemeyer]:\n> I don't get why you say this. Doesn't `bool(P(x) == x)` work regardless of precision?\nThere seemed to be a precision problem:\nhttps://groups.google.com/d/topic/sage-devel/QBAipylR6iM/discussion",
    "created_at": "2015-03-19T15:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153611",
    "user": "rws"
}
```

Replying to [comment:52 jdemeyer]:
> I don't get why you say this. Doesn't `bool(P(x) == x)` work regardless of precision?
There seemed to be a precision problem:
https://groups.google.com/d/topic/sage-devel/QBAipylR6iM/discussion



---

archive/issue_comments_153612.json:
```json
{
    "body": "Replying to [comment:53 pbruin]:\n> Not at all; I often find that a good first step towards fundamentally fixing a bug is trying to *remove* hacks that someone else put in to make a specific example work.\n\nI strongly agree with that. Making specific examples work with no regard for global consistency usually means introducing bugs, not fixing them.\n\n> > You can only make it easier (but by a huge amount) with good design and a well thought out model. Since no good model presents itself and delegating the task to the item is good design this would be an ansatz.\n> I disagree that no good model presents itself; defining `x in P` as `bool(P(x) == x)` seems like a good programming model to me, since it is simple and predictable.\n\nI tend to agree. Note however that the current definition is more along the lines of `parent(x) == P or P(x) == x`, which may not be the same (think of intervals or objects that may not compare as equal to copies of themselves).\n\n> The more I think about it, the more the fundamental problem does not seem to be membership testing, but *comparison* between real numbers defined in different approximations of the real numbers.  Do we want `RR(sqrt(2))` to be equal to `SR(sqrt(2))` or not?  And what about `RR(1/3)` and `QQ(1/3)`?\n\nAs I repeat on every possible occasion, comparisons in sage are broken in more ways than I can count. One of the fundamental reasons IMHO is that there should be at least two kinds of comparisons (in addition to `is`), call them *strict* comparisons and *semantic* comparisons. Under *strict* equality, for instance, elements of different parents would always compare as unequal, and elements of a parent with no normal form would typically compare as equal only if they have the same syntactic representation. *Semantic* equality however could attempt coercing the elements in a common parent much like `==` currently does. (I believe that `==` should refer to the *strict* equality since, among other things, that would avoid many of the problems with hashing. But I know that many people disagree.)\n\nClearly we are talking about *semantic* equality here, but I believe making the previous distinction (at least conceptually) helps separating the issues. Now about your examples: with the current model with a single equality predicate, my answer is **NOOO!!! ** in both cases. With a separate *strict* equality, it is less clear-cut, but intuitively I would still expect both results to be `False`.",
    "created_at": "2015-03-19T15:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153612",
    "user": "mmezzarobba"
}
```

Replying to [comment:53 pbruin]:
> Not at all; I often find that a good first step towards fundamentally fixing a bug is trying to *remove* hacks that someone else put in to make a specific example work.

I strongly agree with that. Making specific examples work with no regard for global consistency usually means introducing bugs, not fixing them.

> > You can only make it easier (but by a huge amount) with good design and a well thought out model. Since no good model presents itself and delegating the task to the item is good design this would be an ansatz.
> I disagree that no good model presents itself; defining `x in P` as `bool(P(x) == x)` seems like a good programming model to me, since it is simple and predictable.

I tend to agree. Note however that the current definition is more along the lines of `parent(x) == P or P(x) == x`, which may not be the same (think of intervals or objects that may not compare as equal to copies of themselves).

> The more I think about it, the more the fundamental problem does not seem to be membership testing, but *comparison* between real numbers defined in different approximations of the real numbers.  Do we want `RR(sqrt(2))` to be equal to `SR(sqrt(2))` or not?  And what about `RR(1/3)` and `QQ(1/3)`?

As I repeat on every possible occasion, comparisons in sage are broken in more ways than I can count. One of the fundamental reasons IMHO is that there should be at least two kinds of comparisons (in addition to `is`), call them *strict* comparisons and *semantic* comparisons. Under *strict* equality, for instance, elements of different parents would always compare as unequal, and elements of a parent with no normal form would typically compare as equal only if they have the same syntactic representation. *Semantic* equality however could attempt coercing the elements in a common parent much like `==` currently does. (I believe that `==` should refer to the *strict* equality since, among other things, that would avoid many of the problems with hashing. But I know that many people disagree.)

Clearly we are talking about *semantic* equality here, but I believe making the previous distinction (at least conceptually) helps separating the issues. Now about your examples: with the current model with a single equality predicate, my answer is **NOOO!!! ** in both cases. With a separate *strict* equality, it is less clear-cut, but intuitively I would still expect both results to be `False`.



---

archive/issue_comments_153613.json:
```json
{
    "body": "Given that it would be more consistent (but less user-friendly) to not mix **R** with `RR`, and `item.is_real()` is buggy, the fix of that is critical (#16436, #17117 are aspects). The `Parent.__contains__` method would have to be adapted and a warning added. Maybe this even leads to a more consistent `Parent.__contains__`. The fix of the behaviour of `bool(item==P(item))` is then less urgent (because it's rarely used otherwise). As to this ticket where failing comparisons with `oo` are described, the code does fix these but leaves at least the `pi in RIF` doctest failing (explanation in comment:33), and possibly more if I remove the `RR/CC.__contains__`. This could benefit from a more consistent `Parent.__contains__` so let's go on.",
    "created_at": "2015-03-19T16:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153613",
    "user": "rws"
}
```

Given that it would be more consistent (but less user-friendly) to not mix **R** with `RR`, and `item.is_real()` is buggy, the fix of that is critical (#16436, #17117 are aspects). The `Parent.__contains__` method would have to be adapted and a warning added. Maybe this even leads to a more consistent `Parent.__contains__`. The fix of the behaviour of `bool(item==P(item))` is then less urgent (because it's rarely used otherwise). As to this ticket where failing comparisons with `oo` are described, the code does fix these but leaves at least the `pi in RIF` doctest failing (explanation in comment:33), and possibly more if I remove the `RR/CC.__contains__`. This could benefit from a more consistent `Parent.__contains__` so let's go on.



---

archive/issue_comments_153614.json:
```json
{
    "body": "The symbolic constants, like `pi.pyobject()`, should be elements in some parent set. The symbolic constants can then coerce into the infinity ring, solving the `pi.pyobject() < oo == False` issue.",
    "created_at": "2015-04-01T16:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153614",
    "user": "vbraun"
}
```

The symbolic constants, like `pi.pyobject()`, should be elements in some parent set. The symbolic constants can then coerce into the infinity ring, solving the `pi.pyobject() < oo == False` issue.



---

archive/issue_comments_153615.json:
```json
{
    "body": "So we need another ticket for\n\n```\nsage: bool(sqrt(2)<oo)\nFalse\n```\n",
    "created_at": "2015-04-01T16:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153615",
    "user": "rws"
}
```

So we need another ticket for

```
sage: bool(sqrt(2)<oo)
False
```




---

archive/issue_comments_153616.json:
```json
{
    "body": "As I have now a better overview, at least some cases could and should be fixed in Pynac. This is https://github.com/pynac/pynac/issues/69",
    "created_at": "2015-06-10T15:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153616",
    "user": "rws"
}
```

As I have now a better overview, at least some cases could and should be fixed in Pynac. This is https://github.com/pynac/pynac/issues/69



---

archive/issue_comments_153617.json:
```json
{
    "body": "Replying to [comment:57 vbraun]:\n> The symbolic constants, like `pi.pyobject()`, should be elements in some parent set. The symbolic constants can then coerce into the infinity ring, solving the `pi.pyobject() < oo == False` issue.\nHow would `NaN` be coerced? Or a future `Aleph2`?",
    "created_at": "2015-06-18T13:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153617",
    "user": "rws"
}
```

Replying to [comment:57 vbraun]:
> The symbolic constants, like `pi.pyobject()`, should be elements in some parent set. The symbolic constants can then coerce into the infinity ring, solving the `pi.pyobject() < oo == False` issue.
How would `NaN` be coerced? Or a future `Aleph2`?



---

archive/issue_comments_153618.json:
```json
{
    "body": "Pynac git master has a fix that does this:\n\n```\nsage: bool(SR(oo) > 5)\nTrue\nsage: bool(5 < SR(oo))\nTrue\nsage: bool(SR(2)<Infinity)\nTrue\nsage: bool(pi<Infinity)\nTrue\nsage: bool(pi>Infinity)\nFalse\nsage: bool(2*pi<Infinity)\nTrue\nsage: bool(SR(pi) < SR(Infinity))\nTrue\nsage: bool(sqrt(2)<oo)\nTrue\nsage: bool(log(2)<oo)\nTrue\nsage: bool(e<oo)\nTrue\nsage: bool(e+pi<oo)\nTrue\nsage: bool(e^pi<oo)\nTrue\nsage: bool(SR(2)<-oo)\nFalse\nsage: bool(SR(2)>-oo)\nTrue\nsage: bool(exp(2)>-oo)\nTrue\nsage: bool(SR(oo) > sqrt(2))\nTrue\nsage: bool(sqrt(2) < SR(oo))\nTrue\nsage: bool(SR(-oo) < sqrt(2))\nTrue\nsage: bool(sqrt(2) > SR(-oo))\nTrue\n```\n\nIt uses info flags and evalf where applicable. Some function info flags were introduced earlier in Pynac.",
    "created_at": "2015-06-19T16:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153618",
    "user": "rws"
}
```

Pynac git master has a fix that does this:

```
sage: bool(SR(oo) > 5)
True
sage: bool(5 < SR(oo))
True
sage: bool(SR(2)<Infinity)
True
sage: bool(pi<Infinity)
True
sage: bool(pi>Infinity)
False
sage: bool(2*pi<Infinity)
True
sage: bool(SR(pi) < SR(Infinity))
True
sage: bool(sqrt(2)<oo)
True
sage: bool(log(2)<oo)
True
sage: bool(e<oo)
True
sage: bool(e+pi<oo)
True
sage: bool(e^pi<oo)
True
sage: bool(SR(2)<-oo)
False
sage: bool(SR(2)>-oo)
True
sage: bool(exp(2)>-oo)
True
sage: bool(SR(oo) > sqrt(2))
True
sage: bool(sqrt(2) < SR(oo))
True
sage: bool(SR(-oo) < sqrt(2))
True
sage: bool(sqrt(2) > SR(-oo))
True
```

It uses info flags and evalf where applicable. Some function info flags were introduced earlier in Pynac.



---

archive/issue_comments_153619.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2015-07-16T06:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153619",
    "user": "rws"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_153620.json:
```json
{
    "body": "The above is doctested in #17321 so what remains here that is not #16397?",
    "created_at": "2015-07-16T06:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153620",
    "user": "rws"
}
```

The above is doctested in #17321 so what remains here that is not #16397?



---

archive/issue_comments_153621.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-12-20T08:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153621",
    "user": "rws"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_153622.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-12-20T13:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153622",
    "user": "dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_153623.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2015-12-20T18:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12795#issuecomment-153623",
    "user": "vbraun"
}
```

Resolution: duplicate
