# Issue 14130: integral of multivariate polynomial

archive/issues_014130.json:
```json
{
    "body": "Assignee: @malb\n\nKeywords: integral of polynomials\n\nSo far (in sage 5.7), the integral of multivariable polynomial is not clean, and belongs to the symbolic ring\n\n```\nsage: x,y = polygen(ZZ,['x','y'])\nsage: (x*y).integral()\nTraceback (most recent call last)\n...\nAttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular' object has no attribute 'integral'\n\nsage: integrate(x*y,x)\n1/2*x^2*y\nsage: integrate(x*y,x).parent()\nSymbolic Ring\n```\n\n\nIt would be much better to have a .integral attribute and to stay within polynomial rings, like it happens with just one variable\n\n```\nsage: x = polygen(ZZ,'x')\nsage: x.integral().parent()\nUnivariate Polynomial Ring in x over Rational Field\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14334\n\n",
    "created_at": "2013-03-22T08:59:04Z",
    "labels": [
        "commutative algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.12",
    "title": "integral of multivariate polynomial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14130",
    "user": "@fchapoton"
}
```
Assignee: @malb

Keywords: integral of polynomials

So far (in sage 5.7), the integral of multivariable polynomial is not clean, and belongs to the symbolic ring

```
sage: x,y = polygen(ZZ,['x','y'])
sage: (x*y).integral()
Traceback (most recent call last)
...
AttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular' object has no attribute 'integral'

sage: integrate(x*y,x)
1/2*x^2*y
sage: integrate(x*y,x).parent()
Symbolic Ring
```


It would be much better to have a .integral attribute and to stay within polynomial rings, like it happens with just one variable

```
sage: x = polygen(ZZ,'x')
sage: x.integral().parent()
Univariate Polynomial Ring in x over Rational Field
```


Issue created by migration from https://trac.sagemath.org/ticket/14334





---

archive/issue_comments_177282.json:
```json
{
    "body": "Here is a patch.\n\n* implements integration in multi-polynomials\n* implements integration with respect to any variable in polynomials and power series",
    "created_at": "2013-03-22T14:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177282",
    "user": "@fchapoton"
}
```

Here is a patch.

* implements integration in multi-polynomials
* implements integration with respect to any variable in polynomials and power series



---

archive/issue_comments_177283.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-22T14:20:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177283",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_177284.json:
```json
{
    "body": "What is the desired (and actual) behaviour if the variable does not belong to the base rings as well? I.e. can I integrate an element of `QQ[x,y]` with respect to `z`?",
    "created_at": "2013-03-24T05:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177284",
    "user": "@novoselt"
}
```

What is the desired (and actual) behaviour if the variable does not belong to the base rings as well? I.e. can I integrate an element of `QQ[x,y]` with respect to `z`?



---

archive/issue_comments_177285.json:
```json
{
    "body": "With the patch applied, this gives :\n\n```\nAttributeError: 'AlgebraicNumber' object has no attribute 'integral'\n```\n\nor\n\n```\nAttributeError: 'sage.rings.rational.Rational' object has no attribute 'integral'\n```\n\nWhich means that once the bottom ring is reached, it just fails to provide an integral method. Do you think it is necessary to implement an integral method **for any ring** ? Maybe one just saying `\"NotImplemented\"` ?",
    "created_at": "2013-03-25T14:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177285",
    "user": "@fchapoton"
}
```

With the patch applied, this gives :

```
AttributeError: 'AlgebraicNumber' object has no attribute 'integral'
```

or

```
AttributeError: 'sage.rings.rational.Rational' object has no attribute 'integral'
```

Which means that once the bottom ring is reached, it just fails to provide an integral method. Do you think it is necessary to implement an integral method **for any ring** ? Maybe one just saying `"NotImplemented"` ?



---

archive/issue_comments_177286.json:
```json
{
    "body": "Well, I think that top level function `integral` should work in this case, perhaps with symbolic ring as parent. If integral method is called directly, it still would be better to have a less cryptic message than that rationals cannot be integrated.\n\nAlso, with the patch I get\n\n```\nsage: ZZ[\"x, y\"](\"x*y+x-y\").integral(x)                 \n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-5-c6379f42d83e> in <module>()\n----> 1 ZZ[\"x, y\"](\"x*y+x-y\").integral(x)\n\n/home/novoselt/sage-5.9.beta0/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3637)()\n\n/home/novoselt/sage-5.9.beta0/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1507)()\n\nAttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular' object has no attribute 'integral'\n```\n\nand somehow here it feels that the method should succeed, since\n\n```\nsage: integrate(ZZ[\"x, y\"](\"x*y+x-y\"), x)\n1/2*x^2*y + 1/2*x^2 - x*y\n```\n",
    "created_at": "2013-03-25T14:47:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177286",
    "user": "@novoselt"
}
```

Well, I think that top level function `integral` should work in this case, perhaps with symbolic ring as parent. If integral method is called directly, it still would be better to have a less cryptic message than that rationals cannot be integrated.

Also, with the patch I get

```
sage: ZZ["x, y"]("x*y+x-y").integral(x)                 
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-5-c6379f42d83e> in <module>()
----> 1 ZZ["x, y"]("x*y+x-y").integral(x)

/home/novoselt/sage-5.9.beta0/local/lib/python2.7/site-packages/sage/structure/element.so in sage.structure.element.Element.__getattr__ (sage/structure/element.c:3637)()

/home/novoselt/sage-5.9.beta0/local/lib/python2.7/site-packages/sage/structure/misc.so in sage.structure.misc.getattr_from_other_class (sage/structure/misc.c:1507)()

AttributeError: 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular' object has no attribute 'integral'
```

and somehow here it feels that the method should succeed, since

```
sage: integrate(ZZ["x, y"]("x*y+x-y"), x)
1/2*x^2*y + 1/2*x^2 - x*y
```




---

archive/issue_comments_177287.json:
```json
{
    "body": "ok, one should also add an integral method in multi_polynomial_libsingular.pyx (TODO)\n\nas far as I can tell, this does not exist in Singular, so it will not just be a matter of wrapping an existing method",
    "created_at": "2013-03-25T15:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177287",
    "user": "@fchapoton"
}
```

ok, one should also add an integral method in multi_polynomial_libsingular.pyx (TODO)

as far as I can tell, this does not exist in Singular, so it will not just be a matter of wrapping an existing method



---

archive/issue_comments_177288.json:
```json
{
    "body": "Part of the problem is that the result is not living in the original ring. Maybe, afterall, the best approach is to keep things as is, letting integral method fail if there are issues with coefficients. Those who want to integrate a potentially problematic polynomial should use integral function which will drop to symbolic ring if calling methods fails.",
    "created_at": "2013-03-25T17:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177288",
    "user": "@novoselt"
}
```

Part of the problem is that the result is not living in the original ring. Maybe, afterall, the best approach is to keep things as is, letting integral method fail if there are issues with coefficients. Those who want to integrate a potentially problematic polynomial should use integral function which will drop to symbolic ring if calling methods fails.



---

archive/issue_comments_177289.json:
```json
{
    "body": "I did not manage to make the following example work\n\n```\nsage: x,y = polygen(ZZ,['x','y'])\nsage: (x*y).integral(x)\n```\n\nThe problem is that this is handled by singular. If the base ring is **more complicated**, everything works well.\n\nIf somebody is able to implement a working integral method in multi_polynomial_libsingular.pyx, please do !",
    "created_at": "2013-03-26T21:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177289",
    "user": "@fchapoton"
}
```

I did not manage to make the following example work

```
sage: x,y = polygen(ZZ,['x','y'])
sage: (x*y).integral(x)
```

The problem is that this is handled by singular. If the base ring is **more complicated**, everything works well.

If somebody is able to implement a working integral method in multi_polynomial_libsingular.pyx, please do !



---

archive/issue_comments_177290.json:
```json
{
    "body": "ok, here is a patch that is doing the job. Needs review, please !\n\nI have chosen to impose that the ring contains QQ, which seems a reasonable thing to do.",
    "created_at": "2013-07-17T14:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177290",
    "user": "@fchapoton"
}
```

ok, here is a patch that is doing the job. Needs review, please !

I have chosen to impose that the ring contains QQ, which seems a reasonable thing to do.



---

archive/issue_comments_177291.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-07-18T21:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177291",
    "user": "@novoselt"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_177292.json:
```json
{
    "body": "The patch does not apply for me on 5.11.rc1 because of empty lines conflict - probably needs rebasing!",
    "created_at": "2013-08-13T20:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177292",
    "user": "@novoselt"
}
```

The patch does not apply for me on 5.11.rc1 because of empty lines conflict - probably needs rebasing!



---

archive/issue_comments_177293.json:
```json
{
    "body": "Attachment [trac_14334_integration_multipoly-fc.patch](tarball://root/attachments/some-uuid/ticket14334/trac_14334_integration_multipoly-fc.patch) by @fchapoton created at 2013-08-15 13:50:36",
    "created_at": "2013-08-15T13:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177293",
    "user": "@fchapoton"
}
```

Attachment [trac_14334_integration_multipoly-fc.patch](tarball://root/attachments/some-uuid/ticket14334/trac_14334_integration_multipoly-fc.patch) by @fchapoton created at 2013-08-15 13:50:36



---

archive/issue_comments_177294.json:
```json
{
    "body": "rebased on 5.12.beta0",
    "created_at": "2013-08-15T13:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177294",
    "user": "@fchapoton"
}
```

rebased on 5.12.beta0



---

archive/issue_comments_177295.json:
```json
{
    "body": "This can be done later as well: Isn't it a bit overly restrictive to demand QQ is a subfield? Everything should be fine as long as factorial(degree(f,x)) is invertible in the base ring.\n\nPerhaps just try the computation:\n- If you end up with an exponent that is divisible by the characteristic, you'll get a `ZeroDivisionError`.\n- If you try to convert the newly computed coefficient into the base ring, you'll get an error for things like `integrate(5*x^2*y,y)` in `ZZ[x,y]`, because `ZZ(5/3)` will fail.\nYou could catch these errors and raise a `ValueError: polynomial does not have an antiderivative over this ring`.",
    "created_at": "2013-08-15T15:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177295",
    "user": "@nbruin"
}
```

This can be done later as well: Isn't it a bit overly restrictive to demand QQ is a subfield? Everything should be fine as long as factorial(degree(f,x)) is invertible in the base ring.

Perhaps just try the computation:
- If you end up with an exponent that is divisible by the characteristic, you'll get a `ZeroDivisionError`.
- If you try to convert the newly computed coefficient into the base ring, you'll get an error for things like `integrate(5*x^2*y,y)` in `ZZ[x,y]`, because `ZZ(5/3)` will fail.
You could catch these errors and raise a `ValueError: polynomial does not have an antiderivative over this ring`.



---

archive/issue_comments_177296.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-08-28T06:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14130#issuecomment-177296",
    "user": "@jdemeyer"
}
```

Resolution: fixed
