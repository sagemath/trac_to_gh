# Issue 20967: guessing k-regular sequences

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2016-08-10 13:12:40

CC:  rws

Code for guessing the parameters of k-regular sequences from the first few entries of a list/sequence/etc.

See also Meta ticket #21202.


---

Comment by mantepse created at 2016-08-10 14:36:51

Is it correct that (the generating function ```f``` of) every k-regular sequence satisfies a Mahler-type functional equation?  That is, a polynomial ```p``` such that ```p(f(x), f(x<sup>2),...,f(x</sup>k)) = 0```?

If so, then you could reuse the guessing functionality in FriCAS.  Of course, FriCAS is not a standard package, although I think it should be, for many reasons.  In any case, the guessing package within is fast and well tested, and covers a lot of ground - essentially everything which is available for 1-dimensional guessing.  For example:


```
sage: l = [0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0, 4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0, 5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0, 4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0, 6, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0, 4, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0, 5, 0, 1, 0, 2, 0, 1, 0, 3, 0, 1, 0, 2, 0, 1, 0]
sage: fricas.guessFE(l)
      n         3        2        2                             3      4
  [[[x ]f(x): (x  - x)f(x ) + (- x  + 1)f(x) - x= 0,f(x)= x + 2x  + O(x )]]
```



---

Comment by dkrenn created at 2016-08-10 15:25:00

Replying to [comment:2 mantepse]:
> Is it correct that (the generating function ```f``` of) every k-regular sequence satisfies a Mahler-type functional equation?  That is, a polynomial ```p``` such that ```p(f(x), f(x<sup>2),...,f(x</sup>k)) = 0```?

I've found in the book of Allouche and Shallit:

   "It is known that k-regular power series satisfy Mahler functional equations; see Rand ́e [1992], Dumas [1993a], and Becker [1994]."

so I believe the answer to your question is affirmative.

> If so, then you could reuse the guessing functionality in FriCAS.  Of course, FriCAS is not a standard package, although I think it should be, for many reasons.  In any case, the guessing package within is fast and well tested, and covers a lot of ground - essentially everything which is available for 1-dimensional guessing. 

I didn't know about this feature of FriCAS, but looks good :)

Are there any plans to make FriCAS standard (I tried with `sage -i fricas`, but installation fails :(


---

Comment by mantepse created at 2016-08-10 15:34:16

Replying to [comment:3 dkrenn]:

> Are there any plans to make FriCAS standard (I tried with `sage -i fricas`, but installation fails :(

How does it fail?  That's very bad indeed!


---

Comment by dkrenn created at 2016-08-10 15:44:45

Replying to [comment:4 mantepse]:
> > Are there any plans to make FriCAS standard (I tried with `sage -i fricas`, but installation fails :(
> 
> How does it fail?  That's very bad indeed!

Posted on https://groups.google.com/forum/#!topic/sage-devel/6_rBQvKdGPo


---

Comment by dimpase created at 2016-08-10 16:54:27

this is to update FriCAS: #21209

probably the current version of FriCAS (1.2.7) should compile with current ECL just fine.


---

Comment by mantepse created at 2016-08-21 15:37:09

The new fricas interface is #21231.  It would be very easy to add a dedicated command for guessing k-regular sequences to FriCAS.  If this is interesting, I could probably further improve the interface to avoid `pexpect` and communicate with FriCAS more directly, Waldek Hebisch has already done the work on the FriCAS-side.

(Currently, passing long lists to FriCAS is very very slow.  But I would like to have at least some confirmation of interest before I spend more time on the interface)


---

Comment by git created at 2016-08-21 16:51:44

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2016-08-21 17:12:42

Replying to [comment:8 mantepse]:
> The new fricas interface is #21231.  It would be very easy to add a dedicated command for guessing k-regular sequences to FriCAS. 

You mean guessing the Mahler functional equation, right? 

> If this is interesting, I could probably further improve the interface to avoid `pexpect` and communicate with FriCAS more directly, Waldek Hebisch has already done the work on the FriCAS-side.

I think having this would be interesting and good. I am still not sure how exactly I would get the k-regular sequence out of it; I have to dig into this topic a bit further, I guess. (At the moment, I do not see directly, where the parameter k comes into play, as the FriCAS guessing works without this parameter.)
This is not my top priority at the moment (as the simple implementation of guessing of this ticket satisfies my needs and gives exactly the kind of representation I need.

As FriCAS is an optional package, I would guess, when having the interface you speak about, would be used as an alternative choice which guessing-algorithm was used. (Maybe even if FriCAS was a standard package...not sure at the moment...)

> (Currently, passing long lists to FriCAS is very very slow.  But I would like to have at least some confirmation of interest before I spend more time on the interface)

From what you can suggest by reading the above, I am not sure what the implications for this ticket are. However, having such a functionality of guessing the functional equation would definitely something nice to have in [SageMath](SageMath).


---

Comment by mantepse created at 2016-08-21 18:22:35

Replying to [comment:10 dkrenn]:
> Replying to [comment:8 mantepse]:
> > The new fricas interface is #21231.  It would be very easy to add a dedicated command for guessing k-regular sequences to FriCAS. 
> 
> You mean guessing the Mahler functional equation, right? 

Hm.  I actually meant to add a command that guesses the equation for the k-regular sequence.  But I just found out that I was slightly mistaken about the nature of k-regular sequences: apparently there is no single equation determining it, but rather a bunch of them, right?  It should still be possible to reuse the machinery.


---

Comment by git created at 2016-08-22 13:17:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-22 15:23:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-22 15:26:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-25 11:33:41

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2016-08-25 11:53:00

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2016-08-25 18:20:07

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2016-08-25 18:24:48

Changing status from new to needs_review.


---

Comment by dkrenn created at 2016-08-25 18:24:48

- Merged in #21325 to avoid a trivial merge conflict.
- Merged in #21319 to have equality testing in the doctests, but not needed for the actual code.
- Thus, this ticket essentially depends only on #21203.


---

Comment by git created at 2016-08-26 12:00:09

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by cheuberg created at 2017-01-05 12:16:41

patchbot doctest failure, python3 plugin failure


---

Comment by cheuberg created at 2017-01-05 12:16:41

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-01-24 13:26:46

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2017-01-24 13:27:09

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2017-01-24 13:27:09

Replying to [comment:20 cheuberg]:
> patchbot doctest failure, python3 plugin failure

Fixed.


---

Comment by git created at 2018-04-06 07:44:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-03-29 08:51:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-05-11 14:52:41

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2021-06-25 13:04:37

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2021-06-25 13:14:05

Merged dependencies; ready for review.


---

Comment by git created at 2022-01-05 21:39:47

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2022-01-05 21:41:15

Merged dependencies, now based on 9.4


---

Comment by dimpase created at 2022-01-06 11:37:20

A a rule, ticket branches should be based on the latest beta, not on the latest stable version.


---

Comment by dkrenn created at 2022-01-06 12:17:51

Replying to [comment:31 dimpase]:
> A a rule, ticket branches should be based on the latest beta, not on the latest stable version. 

The current beta merges automatically and cleanly, so there is no difference on which branch to put it (as the patchbot runs it in the latest beta anyways). 

The reason for putting it on the latest stable is that this code is loosely related to a mathematical paper, so might be used by someone now and putting it on a stable version makes this using easier (as no beta needs to be compiled separately).

(And, the reason for merging in a newer version of [SageMath](SageMath) at all was a non-tivial merge conflict. If that would not have been, then it would still be 9.3.)


---

Comment by chapoton created at 2022-05-12 09:32:41

red branch => needs work


---

Comment by chapoton created at 2022-05-12 09:32:41

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2022-06-24 16:21:57

Unfortunately, rebasing this in a straightforward way over the latest beta (9.7.beta3) proves impossible (it leads to missing pieces for some reason).

And merging the latest beta does not work any more, either. 

What's the latest develop branch where it still worked?


---

Comment by cheuberg created at 2022-10-02 08:27:19

Clean merge of the latest beta (9.8.beta1)
----
New commits:


---

Comment by cheuberg created at 2022-10-02 08:30:00

Sorry, that was a wrong push. I'll fix it soon.


---

Comment by git created at 2022-10-02 08:33:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2022-10-02 18:48:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-10-11 17:00:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2022-10-11 17:09:43

Changing status from needs_work to needs_info.


---

Comment by cheuberg created at 2022-10-11 17:09:43

I started reading this and have a lot of questions. I might then have to reread the code because I am not yet confident that I understand everything, so I apologise in advance if some further questions pop up at a later iteration.

While reading the code, I tried to make some notes on what the various routines are doing; I pushed those notes to branch `u/cheuberg/sequences/k-regular-guess-documentation`; after polishing those, it might be worthwhile to include these.
Due to my question 16 below, these notes might still require substantial rewrite (I am not sure about left/right).

1. `k_regular_sequence.value` in the docstring: the `\operator` does not yield the desired output in the HTML documentation.
2. `k_regular_sequence.split_interlace`: from the description, I do not understand what "split a digit into `p` parts" shall mean. Instead of the many examples (which might be moved to `TESTS`) I'd prefer to see fewer examples with an explanation what the output means. Perhaps "split into `p` parts" could be made explicit into saying that it will be expanded as a `k/p`-ary expansion? And also say that "value of the expansion" means expansion in base `k/p`?
3. `kRegularSequenceSpace.guess`: One-sentence description: perhaps "Guess a k-regular sequence whose first terms coincide with ..."?
4. `kRegularSequenceSpace.guess`: it is unclear to me what "bootstrapping this guessing" means.
5. `kRegularSequenceSpace.guess`: please use the "new" method `linear_representation` for all examples
6. `kRegularSequenceSpace.guess`: In the first example, it may be helpful to explain what "variant 1" and "variant 2" are (variant 1: without a bootstrapping sequence; variant 2: with the constant sequence as a bootstrapping sequence).
7. `kRegularSequenceSpace.guess`: I suggest to compare the outputs of Variant 1 and Variant 2 (that they yield the same sequence).
8. `kRegularSequenceSpace.guess`: it would be helpful to indicate the vector valued sequences used in the various examples (Sum of digits, variant 1: (s(n), s(2n+1)); variant 2: (1, s(n)), all natural numbers: (n, 2n+1), indicator function of even integers: ([n even], 1), indicator function of odd integers: )
9. `kRegularSequenceSpace.guess`: I suggest to rename all functions containing `linear_dependence` in their name to `linear_combination` (we are actually interested in the coefficients, not the existence of coefficients)
10. `kRegularSequenceSpace.guess`: I suggest to rename `guess_linear_dependence` to `linear_combination_candidate`: we are not guessing here, but we are deriving the only candidate and are checking it in the next step.
11. `kRegularSequenceSpace.guess`: I am surprised that `verify_linear_dependence` has `(n_max - r_L) // k**t_L + 1` as an upper bound for the loop. I think that the code does not guarantee that it will never evaluate `f` for some higher values than `n_max`, that might happen in `some_inverse_U_matrix`. On the other hand, something might be considered to be linearly dependent on the available functions while in truth it is not; this should not cause real problems.
12. `kRegularSequenceSpace.guess`: I do not understand the `if seq(0):` part: Why does it make a difference whether the zeroth element of the given sequence vanishes or not? I do not know whether it is related, but the following is not what I expect:
    {{{
sage: def s(k):
sage:     return k
sage: Seq2 = kRegularSequenceSpace(2, ZZ)
sage: S1 = Seq2.guess(s)
sage: S2 = Seq2.guess(s, sequence=S1)
sage: S1
2-regular sequence 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, ...
sage: S2
2-regular sequence 0, -2, -2, -6, -2, -6, -10, -14, -2, -6, ...
}}}
13. `kRegularSequenceSpace.guess`: I am surprised by `if t_R >= max_dimension:`: I thought that `max_dimension` will be the dimension of the matrices of the resulting regular sequence, but it seems to be the exponent? Shouldn't it be called like that in this case?
14. `kRegularSequenceSpace.guess`: I do not understand why the parameter s is actually stored into `lines`, I do not think it is ever used.
15. I do not understand why `k_regular_sequence.split_interlace` is defined in this ticket, it do not see a usage of it.
16. I find it puzzling that the `values` function contains `seq` which in turn has the `left` vector of the given sequence times the matrix product, and this at the very end ends up in `right`.
