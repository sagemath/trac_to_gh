# Issue 10029: Interrupt testing

Issue created by migration from https://trac.sagemath.org/ticket/10030

Original creator: jdemeyer

Original creation time: 2010-09-29 12:44:16

Assignee: tba

CC:  leif wjp

Keywords: interrupt doctest




---

Comment by jdemeyer created at 2010-10-02 18:05:51

Changing keywords from "interrupt doctest" to "interrupt signal doctest".


---

Comment by jdemeyer created at 2010-11-11 23:09:58

Changing status from new to needs_work.


---

Comment by jdemeyer created at 2011-01-14 17:41:28

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2011-01-15 17:29:10

On OS X, I get doctest "failures"::

```
**********************************************************************
File "/Users/jdemeyer/sage-4.6.2.alpha0/devel/sage/sage/tests/interrupt.pyx", line 502:
    sage: print '---'; print Popen(['sage', '-c', cmd], stdout=PIPE, stderr=PIPE).communicate()[1]  # long time
Expected:
    ---
    ...
    ------------------------------------------------------------------------
    Unhandled SIGABRT: An abort() occurred in Sage.
    This probably occurred because a *compiled* component of Sage has a bug
    in it and is not properly wrapped with sig_on(), sig_off(). You might
    want to run Sage under gdb with 'sage -gdb' to debug this.
    Sage will now terminate.
    ------------------------------------------------------------------------
    ...
Got:
    ---
    <BLANKLINE>
    ------------------------------------------------------------------------
    Unhandled SIGABRT: An abort() occurred in Sage.
    This probably occurred because a *compiled* component of Sage has a bug
    in it and is not properly wrapped with sig_on(), sig_off(). You might
    want to run Sage under gdb with 'sage -gdb' to debug this.
    Sage will now terminate.
    ------------------------------------------------------------------------
    /Users/jdemeyer/sage-4.6.2.alpha0/local/bin/sage-sage: line 783: 61015 Abort trap              sage-eval "$@"
    <BLANKLINE>
**********************************************************************
```


It looks to me that the "Got" text matches the "Expected" text, so why is this a failure?


---

Comment by vbraun created at 2011-01-21 23:29:48

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2011-01-21 23:29:48

I think the issue is that "``...``" expects to match something but does not match the empty line ``<BLANKLINE>``. Note the difference between 
  * Linux: will print stack backtrace before "Unhandled SIGABRT", and
  * OSX: does not print stack backtrace.

For example, changing

```
sage: print '---'; print Popen(['sage', '-c', cmd], stdout=PIPE, stderr=PIPE).communicate()[1]  # long time
```

to 

```
sage: print '---'; print 'backtrace:'; print Popen(['sage', '-c', cmd], stdout=PIPE, stderr=PIPE).communicate()[1]  # long time
```

fixes the doctest on OSX, as now at least ``'backtrace:'`` gets matched by the "``...``".


---

Attachment

SCRIPTS patch, patch for sage-doctest


---

Comment by jdemeyer created at 2011-01-22 15:00:36

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2011-01-22 15:00:36

Okay, I didn't know that `...` needs to match at least one non-blank character (apparently).  I fixed it in the most simple way by replacing `---\n...` by `-...`


---

Comment by vbraun created at 2011-01-31 01:07:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2011-01-31 01:07:23

Looks good! I tested it on bsd.math and all doctests pass.


---

Comment by jdemeyer created at 2011-02-07 08:05:18

SAGELIB patch


---

Attachment


---

Comment by jdemeyer created at 2011-02-08 09:52:39

Changing status from positive_review to needs_work.


---

Attachment

Additional SAGELIB patch


---

Comment by jdemeyer created at 2011-02-08 11:14:57

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2011-02-08 20:48:57

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2011-02-08 20:48:57

Looks good.


---

Comment by jdemeyer created at 2011-03-08 21:45:24

Resolution: fixed
