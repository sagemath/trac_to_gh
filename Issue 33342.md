# Issue 33342: Ensure that random graph generators uses parameter seed

Issue created by migration from https://trac.sagemath.org/ticket/33579

Original creator: dcoudert

Original creation time: 2022-03-27 15:14:40

CC:  @kliem tscrim vbraun




---

Comment by dcoudert created at 2022-03-27 16:09:32

This might break multiple doctests using random graphs.
----
New commits:


---

Comment by git created at 2022-03-27 17:12:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-03-27 17:18:03

Changing status from new to needs_review.


---

Comment by dcoudert created at 2022-03-27 17:18:03

I'm not sure it's the right way to do it and I don't understand why some doctests have to be modified...

Also, we have some doctest errors in `src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py` that we will have to fix in the `graphtheory.tex` (I don't know where it is yet).

```
**********************************************************************
File "src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py", line 221, in sage.tests.books.computational-mathematics-with-sage\
math.graphtheory_doctest
Failed example:
    max(color.values()) + 1
Expected:
    6
Got:
    5
**********************************************************************
File "src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py", line 226, in sage.tests.books.computational-mathematics-with-sage\
math.graphtheory_doctest
Failed example:
    P = Permutations([0,1,2,3]); P.random_element()
Expected:
    [2, 0, 1, 3]
Got:
    [3, 2, 1, 0]
**********************************************************************
...
```



---

Comment by tscrim created at 2022-03-27 22:05:29

My guess as to why doctests are needed to be changed is `current_randstate()` is not called as often. So all of those doctests that are depending on a specific state are changed. The 32-bit tests will also need to be updated.

For those book tests, you are using a different method of constructing the seed I believe. Hence, it is doing something on a different graph and changing the seed in a different way for the second doctest. So these are essentially trivial failures.


---

Comment by dcoudert created at 2022-03-27 23:02:33

> For those book tests, you are using a different method of constructing the seed I believe. Hence, it is doing something on a different graph and changing the seed in a different way for the second doctest. So these are essentially trivial failures.

I agree these are trivial failures, but I don't know where is to tex file to correct.


---

Comment by tscrim created at 2022-03-27 23:18:35

I don't know where the tex file is either. Perhaps we can cc (or directly email?) some of the authors to ask?


---

Comment by git created at 2022-04-05 16:59:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-04-05 17:01:10

I have corrected the doctests in `src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py`. In parallel I have reported the changes in file `graph theory.tex` from the sage book (I know have access).


---

Comment by tscrim created at 2022-04-06 00:49:17

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-04-06 00:49:17

Thanks. Then LGTM.


---

Comment by dcoudert created at 2022-04-06 06:44:12

One issue remains: I'm unable to check the 32 bits doctests. So we might still have an error.


---

Comment by tscrim created at 2022-04-06 06:51:54

Volker, if/when this fails on 32-bit, could you please provide what the results should be? We will then fix it right away.


---

Comment by @kliem created at 2022-04-06 07:00:43

Replying to [comment:8 dcoudert]:
> I have corrected the doctests in `src/sage/tests/books/computational-mathematics-with-sagemath/graphtheory_doctest.py`. In parallel I have reported the changes in file `graph theory.tex` from the sage book (I know have access).

`@`dcoudert: Could you perhaps apply the same for #32850.


---

Comment by dcoudert created at 2022-04-06 08:54:13

I will.


---

Comment by vbraun created at 2022-04-10 09:41:04

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-04-10 09:41:04

I'm getting this on 32-bit:

```
**********************************************************************
File "src/sage/graphs/generators/random.py", line 99, in sage.graphs.generators.random.RandomGNP
Failed example:
    graphs.RandomGNP(50,.2, algorithm="networkx").size()
Expected:
    260     
Got:
    279
**********************************************************************
1 item had failures:
   1 of  16 in sage.graphs.generators.random.RandomGNP
    [208 tests, 1 failure, 5.27 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/graphs/generators/random.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by git created at 2022-04-10 10:55:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2022-04-10 10:56:20

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2022-04-10 10:56:20

Thank you Volker for the value. Should be ok now.


---

Comment by tscrim created at 2022-04-11 02:23:54

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-05-20 22:27:10

Resolution: fixed
