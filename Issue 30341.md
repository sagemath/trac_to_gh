# Issue 30341: Add src/requirements.txt for installation of sagelib in a venv

Issue created by migration from https://trac.sagemath.org/ticket/30578

Original creator: mkoeppe

Original creation time: 2020-09-15 20:20:49

CC:  @tobiasdiez fbissey jhpalmieri vdelecroix

After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  

In this ticket, we create `src/requirements.txt` to facilitate this.

We add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.

The existing `src/setup.py` is copied into `build/pkgs/sagelib/src`  to replace the symlink. In this way, the changes to `src/setup.py` made in this ticket do not affect the existing build process of the Sage library.


Related:
 - #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
 - #28752 Make sagelib pip-installable in a conda environment

Follow-up tickets:
 - #30371 In-place (editable) installs of sagelib in a venv
 - #29041 at `./bootstrap` time, generate `requirements.txt`, `constraints.txt`, `setup.cfg [install_requires]`, `Pipfile` from `build/pkgs`


---

Comment by @tobiasdiez created at 2020-09-15 20:45:09

What do you think about generating the requirements.txt file from a pipfile: https://pipenv-fork.readthedocs.io/en/latest/advanced.html#generating-a-requirements-txt? (Maybe as part of this ticket or as #29041)
----
Last 10 new commits:


---

Comment by mkoeppe created at 2020-09-15 20:50:22

Yes, I started to play a bit with pipenv, and this looks like a possible route.

I would like to keep that for #29041 though.

On the present ticket I would only want to do the most rudimentary thing - basically to try out the adjustments that sagelib will need (see #22731).


---

Comment by git created at 2020-09-15 21:25:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-15 22:30:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-17 02:37:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-21 01:32:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-26 00:41:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-26 00:45:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-10-16 21:28:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-11 02:51:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2020-11-11 03:23:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-11 05:26:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-13 06:51:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2020-11-13 07:24:57

Now, with #30013 merged, the correct sage script is executed in the venv created by tox.

What remains to be done is to add more packages to requirements.txt - in particular `ipywidgets` so that the doctester can run.


---

Comment by git created at 2020-11-14 01:05:40

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2020-11-14 02:20:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-11-14 02:21:01

This works; only minor issues in doctests remain.

```
File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/interfaces/gap_workspace.py", line 55, in sage.interfaces.gap_workspace.gap_workspace_file
Failed example:
    name1 = Popen([sys.executable, '-c', cmd], stdout=PIPE).communicate()[0]
Expected nothing
Got:
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/sage/all.py", line 125, in <module>
        import sage.misc.lazy_import
    ModuleNotFoundError: No module named 'sage.misc.lazy_import'
```

There are also some doctest errors in the pexpect interfaces for singular and gap.


---

Comment by mkoeppe created at 2020-11-14 02:21:01

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-11-14 03:18:56

The `fpylll` package unfortunately does not install because it does not declare its build dependencies correctly. Reported upstream: https://github.com/fplll/fpylll/issues/185


---

Comment by git created at 2020-11-14 03:21:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-14 04:01:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-06 17:44:18

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2021-01-18 04:46:29

Let's skip this ticket and do #30913 directly.


---

Comment by chapoton created at 2021-07-29 19:13:51

Resolution: duplicate
