# Issue 30341: Add src/requirements.txt for installation of sagelib in a venv

archive/issues_030341.json:
```json
{
    "body": "CC:  @tobiasdiez @kiwifb @jhpalmieri @videlec\n\nAfter #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n\nIn this ticket, we create `src/requirements.txt` to facilitate this.\n\nWe add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n\nThe existing `src/setup.py` is copied into `build/pkgs/sagelib/src`  to replace the symlink. In this way, the changes to `src/setup.py` made in this ticket do not affect the existing build process of the Sage library.\n\n\nRelated:\n- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n- #28752 Make sagelib pip-installable in a conda environment\n\nFollow-up tickets:\n- #30371 In-place (editable) installs of sagelib in a venv\n- #29041 at `./bootstrap` time, generate `requirements.txt`, `constraints.txt`, `setup.cfg [install_requires]`, `Pipfile` from `build/pkgs`\n\nIssue created by migration from https://trac.sagemath.org/ticket/30578\n\n",
    "created_at": "2020-09-15T20:20:49Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Add src/requirements.txt for installation of sagelib in a venv",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30341",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tobiasdiez @kiwifb @jhpalmieri @videlec

After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  

In this ticket, we create `src/requirements.txt` to facilitate this.

We add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.

The existing `src/setup.py` is copied into `build/pkgs/sagelib/src`  to replace the symlink. In this way, the changes to `src/setup.py` made in this ticket do not affect the existing build process of the Sage library.


Related:
- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
- #28752 Make sagelib pip-installable in a conda environment

Follow-up tickets:
- #30371 In-place (editable) installs of sagelib in a venv
- #29041 at `./bootstrap` time, generate `requirements.txt`, `constraints.txt`, `setup.cfg [install_requires]`, `Pipfile` from `build/pkgs`

Issue created by migration from https://trac.sagemath.org/ticket/30578





---

archive/issue_comments_432214.json:
```json
{
    "body": "What do you think about generating the requirements.txt file from a pipfile: https://pipenv-fork.readthedocs.io/en/latest/advanced.html#generating-a-requirements-txt? (Maybe as part of this ticket or as #29041)\n----\nLast 10 new commits:",
    "created_at": "2020-09-15T20:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432214",
    "user": "https://github.com/tobiasdiez"
}
```

What do you think about generating the requirements.txt file from a pipfile: https://pipenv-fork.readthedocs.io/en/latest/advanced.html#generating-a-requirements-txt? (Maybe as part of this ticket or as #29041)
----
Last 10 new commits:



---

archive/issue_comments_432215.json:
```json
{
    "body": "Yes, I started to play a bit with pipenv, and this looks like a possible route.\n\nI would like to keep that for #29041 though.\n\nOn the present ticket I would only want to do the most rudimentary thing - basically to try out the adjustments that sagelib will need (see #22731).",
    "created_at": "2020-09-15T20:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432215",
    "user": "https://github.com/mkoeppe"
}
```

Yes, I started to play a bit with pipenv, and this looks like a possible route.

I would like to keep that for #29041 though.

On the present ticket I would only want to do the most rudimentary thing - basically to try out the adjustments that sagelib will need (see #22731).



---

archive/issue_comments_432216.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-15T21:25:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432217.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-15T22:30:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432218.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-17T02:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432218",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432219.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-21T01:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432220.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-26T00:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432221.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-26T00:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432221",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432222.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-16T21:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432223.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-11-11T02:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_432224.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-11T03:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432224",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432225.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-11T05:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432226.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-11-13T06:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_432227.json:
```json
{
    "body": "Now, with #30013 merged, the correct sage script is executed in the venv created by tox.\n\nWhat remains to be done is to add more packages to requirements.txt - in particular `ipywidgets` so that the doctester can run.",
    "created_at": "2020-11-13T07:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432227",
    "user": "https://github.com/mkoeppe"
}
```

Now, with #30013 merged, the correct sage script is executed in the venv created by tox.

What remains to be done is to add more packages to requirements.txt - in particular `ipywidgets` so that the doctester can run.



---

archive/issue_comments_432228.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-11-14T01:05:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432228",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_432229.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-14T02:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_432230.json:
```json
{
    "body": "This works; only minor issues in doctests remain.\n\n```\nFile \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/interfaces/gap_workspace.py\", line 55, in sage.interfaces.gap_workspace.gap_workspace_file\nFailed example:\n    name1 = Popen([sys.executable, '-c', cmd], stdout=PIPE).communicate()[0]\nExpected nothing\nGot:\n    Traceback (most recent call last):\n      File \"<string>\", line 1, in <module>\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/sage/all.py\", line 125, in <module>\n        import sage.misc.lazy_import\n    ModuleNotFoundError: No module named 'sage.misc.lazy_import'\n```\n\nThere are also some doctest errors in the pexpect interfaces for singular and gap.",
    "created_at": "2020-11-14T02:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432230",
    "user": "https://github.com/mkoeppe"
}
```

This works; only minor issues in doctests remain.

```
File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/src/sage/interfaces/gap_workspace.py", line 55, in sage.interfaces.gap_workspace.gap_workspace_file
Failed example:
    name1 = Popen([sys.executable, '-c', cmd], stdout=PIPE).communicate()[0]
Expected nothing
Got:
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/sage/all.py", line 125, in <module>
        import sage.misc.lazy_import
    ModuleNotFoundError: No module named 'sage.misc.lazy_import'
```

There are also some doctest errors in the pexpect interfaces for singular and gap.



---

archive/issue_comments_432231.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-14T02:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432231",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_432232.json:
```json
{
    "body": "The `fpylll` package unfortunately does not install because it does not declare its build dependencies correctly. Reported upstream: https://github.com/fplll/fpylll/issues/185",
    "created_at": "2020-11-14T03:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432232",
    "user": "https://github.com/mkoeppe"
}
```

The `fpylll` package unfortunately does not install because it does not declare its build dependencies correctly. Reported upstream: https://github.com/fplll/fpylll/issues/185



---

archive/issue_comments_432233.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-14T03:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432233",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-14T04:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432235.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T17:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432235",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_432236.json:
```json
{
    "body": "Let's skip this ticket and do #30913 directly.",
    "created_at": "2021-01-18T04:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432236",
    "user": "https://github.com/mkoeppe"
}
```

Let's skip this ticket and do #30913 directly.



---

archive/issue_events_027880.json:
```json
{
    "actor": "@fchapoton",
    "created_at": "2021-07-29T19:13:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30341#event-27880"
}
```



---

archive/issue_comments_432237.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2021-07-29T19:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30341",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30341#issuecomment-432237",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate
