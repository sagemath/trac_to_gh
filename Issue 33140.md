# Issue 33140: Use numpy_integer_dense for adjacency matrices

Issue created by migration from https://trac.sagemath.org/ticket/33377

Original creator: mkoeppe

Original creation time: 2022-02-19 01:21:36

CC:  dcoudert




---

Comment by mkoeppe created at 2022-02-19 07:53:55

Last 10 new commits:


---

Comment by dcoudert created at 2022-02-19 12:22:42

I'm OK with this improvement, but the same should be done for `weighted_adjacency_matrix`.

These methods could benefit further improvements. So far we first feed a dictionary and then build the matrix. It might be faster to directly feed the matrix.


---

Comment by mkoeppe created at 2022-02-19 17:49:39

Thanks for the feedback! Here's the corresponding change for `weighted_adjacency_matrix`.


---

Comment by git created at 2022-02-19 17:49:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-19 17:55:42

Replying to [comment:3 dcoudert]:
> These methods could benefit further improvements. So far we first feed a dictionary and then build the matrix. It might be faster to directly feed the matrix.

Yes, but I won't work on it in this ticket


---

Comment by git created at 2022-02-19 17:57:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-19 18:07:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-19 18:10:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-19 18:16:14

I'll stop here, but the same could be done to `BipartiteGraph.reduced_adjacency_matrix` and some other methods that I see in `git grep ' def.*_matrix' src/sage/graphs/`

For `distance_matrix`, `kirchhoff_matrix` it is trickier because these methods already accept `**kwds` that they pass on to some other method.


---

Comment by mkoeppe created at 2022-02-19 18:16:14

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-02-19 18:16:35

Changing component from refactoring to graph theory.


---

Comment by dcoudert created at 2022-02-20 13:15:41

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2022-02-20 13:15:41

LGTM.

I will check the other cases.


---

Comment by dcoudert created at 2022-02-20 15:15:28

For `kirchhoff_matrix`, all arguments in `**kwds` are passed to `adjacency_matrix` or `weighted_adjacency_matrix`. So it is now possible to specify the base ring.

A question is whether we should allow passing arguments for the matrix constructor to methods calling `adjacency_matrix` and similar methods.


---

Comment by mkoeppe created at 2022-02-20 17:29:06

Replying to [comment:13 dcoudert]:
> For `kirchhoff_matrix`, all arguments in `**kwds` are passed to `adjacency_matrix` or `weighted_adjacency_matrix`. So it is now possible to specify the base ring.

Thanks for checking! If `immutable=True` is passed, the result matrix will have to be `set_immutable`. Could be done in #33388


---

Comment by mkoeppe created at 2022-02-20 17:29:29

Thanks for reviewing!


---

Comment by vbraun created at 2022-02-21 21:55:31

Resolution: fixed
