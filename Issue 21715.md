# Issue 21715: Update cddlib's autotooling

Issue created by migration from https://trac.sagemath.org/ticket/21952

Original creator: embray

Original creation time: 2016-11-23 15:14:42

Keywords: cddlib autotools

As discussed in [this thread](https://groups.google.com/d/msg/sage-devel/uHsTOd5sTxY/ivpNHT1MAwAJ), cddlib's autotools files are quite outdated and in due for modernization.  In fact, somehow, its `configure.in` is not even compatible with the version of `automake` that the `Makefile.in`s were generated with.  This makes it difficult/impossible to make update cddlib's Makefiles (see #15872).

I reworked the latest version of cddlib (0.94h, though this work would also apply to at least the previous version, 0.94g) to use automake 1.14.1 (currently the highest version in sage, though #21196 would update that to 1.15).

I also cleaned up the contents of the tarball (removed .DS_Store files and other crud), and made it so that `make distcheck` works.

I've attached an updated upstream tarball, as well as a set of patches to the original upstream that should reproduce it.


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Attachment


---

Comment by mkoeppe created at 2016-11-23 18:42:57

Do you have a git repository from which you created this?


---

Comment by fbissey created at 2016-11-23 21:18:47

I wouldn't have thought that `ACLOCAL_AMFLAGS = -I m4` was necessary once you have `AC_CONFIG_MACRO_DIR([m4])` but I could be wrong.

There are other things I am thinking off that can be done (VPATH) but we may not want to do everything at once.


---

Comment by embray created at 2016-11-24 10:19:32

Replying to [comment:2 fbissey]:
> I wouldn't have thought that `ACLOCAL_AMFLAGS = -I m4` was necessary once you have `AC_CONFIG_MACRO_DIR([m4])` but I could be wrong.

I'm fairly sure myself that it isn't strictly necessary, but I put it because autoconf suggested that I do anyways.


---

Comment by embray created at 2016-11-24 10:23:29

Or maybe it was libtoolize that told me that. I can't remember for sure.  From https://www.gnu.org/software/libtool/manual/html_node/Invoking-libtoolize.html

"In the future other Autotools will automatically check the contents of AC_CONFIG_MACRO_DIRS, but at the moment it is more portable to add the macro directory to ACLOCAL_AMFLAGS in Makefile.am, which is where the tools currently look."

That future is now, but I guess it still suggests it just in case.


---

Comment by mkoeppe created at 2017-03-02 11:04:48

See also older tickets #15871, #15872.


---

Comment by embray created at 2017-03-03 13:48:40

Changing type from PLEASE CHANGE to defect.


---

Comment by embray created at 2017-03-03 13:52:25

I think this is actually ready to go. I just don't know what the process is for adding a new tarball to the sage package mirrors.  For this particular case I don't see a better workaround than a new source package since the original is a bit broken.


---

Comment by embray created at 2017-03-03 13:52:25

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2017-03-03 18:59:46

There's no branch, what is to be reviewed?

Also, could you just share the git from which these patches are generated? (comment 1)

Also, "cddlib-0.94.tar.gz" does not seem to have an unambiguous version number.


---

Comment by mkoeppe created at 2017-03-03 19:00:43

Changing status from needs_review to needs_work.


---

Comment by embray created at 2017-03-14 15:11:33

Changing status from needs_work to needs_info.


---

Comment by embray created at 2017-03-14 15:11:33

What I don't understand is what the process is (though it seems like there is one?) of providing an alternative upstream tarball for one of the packages in Sage, such that is distributed to all the mirrors, etc.

I've attached such a tarball, as well as the patches that reproduce it from the original upstream tarball.

The problem here was that the source tarball itself was broken in various ways.


---

Comment by mkoeppe created at 2017-03-15 19:28:00

Most of the process is described here: http://doc.sagemath.org/html/en/developer/packaging.html#when-to-patch-when-to-repackage-when-to-autoconfiscate (and in the following sections).

The release manager adds the "upstream tar ball" to the server when the ticket is merged. Usually people just provide an URL in the description, rather than attaching it to trac. 

Instead of attaching patches here, use a public git repository. Make an `spkg-src` that can regenerate your "upstream tar ball" from the repository. See `bliss/spkg-src` for an example.


---

Comment by embray created at 2017-04-13 10:14:33

Forgot about this until now, but thanks for the info.  I'll follow the process you described then.


---

Comment by saraedum created at 2018-04-03 20:43:49

embray: are you planning to work on this again anytime soon? I just stumbled upon this because Debian has some patches to fix Sage's integration of cddlib for version 0.94h.

If you think that the patches proposed here are still the way this should be done, should we propose them upstream?


---

Comment by fbissey created at 2018-04-03 21:13:48

Just a note, from my experience in sage-on-gentoo, the debian patches are insufficient - as in I have doctest failures even with the debian patches. 

Otherwise I am all for pushing updated autotooling upstream.


---

Comment by embray created at 2018-04-04 09:07:35

This really needs #21196.  IIRC I ran into some stumbling blocks with that, but I forget--it was a long time ago.


---

Comment by saraedum created at 2018-04-04 20:38:25

So, that's a dependency if I understood you correctly.


---

Comment by saraedum created at 2018-04-21 18:47:56

I'm dropping that dependency again, as I am in favor of dropping autotools from our SPKGs.


---

Comment by saraedum created at 2018-04-22 05:32:48

I wrote a mail to upstream, offering my help with this. Let's see what they say.


---

Comment by embray created at 2018-04-23 14:46:01

I think the series of patches I originally attached to this ticket should do it.  I forget why I just added a bunch of patches here as opposed to some other way of doing it...


---

Comment by saraedum created at 2018-04-23 15:40:49

Some of the patches don't apply anymore so I rebase them. I am trying to convince the author of the beauty of github (or similar) and he wants to have a look. I proposed a new home for upstream here: https://github.com/cddlib/cddlib.

And a modified version of your patches is here: https://github.com/cddlib/cddlib/pull/1

Let's continue the discussion there.


---

Comment by saraedum created at 2018-05-11 15:25:20

Upstream has upgraded their autotooling. Now we just need to package the next release #25344.


---

Comment by saraedum created at 2018-05-11 15:25:20

Changing status from needs_info to positive_review.


---

Comment by saraedum created at 2018-05-11 15:25:41

(feel free to reopen this, if you think that I am missing something here.)


---

Comment by vdelecroix created at 2018-05-18 17:16:26

closing positively reviewed duplicates


---

Comment by vdelecroix created at 2018-05-18 17:16:26

Resolution: wontfix
