# Issue 27858: Add --enable-OPTIONALSPKG options to configure

Issue created by migration from https://trac.sagemath.org/ticket/28095

Original creator: mkoeppe

Original creation time: 2019-07-01 19:35:54

CC:  dimpase embray saraedum jhpalmieri

This ticket adds options such as `--enable-lrslib`, `--enable-topcom` for all optional and experimental packages to `configure`. 

Subsequent `make` will then install these packages.

This will simplify installations of sage with a list of optional packages. 

(This was previously discussed in #21538, which did not clearly enough distinguish this proposal from the topic of using system packages, #27567.)


---

Comment by embray created at 2019-07-02 12:03:25

+1 that's a good idea.


---

Comment by mkoeppe created at 2019-07-26 16:03:23

It seems tricky to generate AC_ARG_ENABLE macro invocations for all packages: it would have to be done during `bootstrap` (not sure if we want this), or perhaps using m4 loops (https://www.gnu.org/software/autoconf/manual/autoconf-2.62/html_node/Looping-constructs.html).


---

Comment by dimpase created at 2019-07-26 18:32:17

well, we do things like collecting spkg-configure.m4 files for each package in ./bootstrap, nothing wrong with doing more at this stage...


---

Comment by embray created at 2019-08-13 08:51:37

Yes, you could do it during bootstrap, in principle.

I have tried in the past to get m4 itself to loop over package directories and generate this stuff (as opposed to the current approach of generating bits of m4 in `./bootstrap`).  And in principle that can work, but other, higher-level tools like automake get terribly confused when you try to do too much weird stuff like this.


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-01-22 22:08:14

New commits:


---

Comment by dimpase created at 2020-01-22 22:16:28

how is the actual installation of the enabled packages triggered?


---

Comment by mkoeppe created at 2020-01-22 22:44:05

Oh, the ticket is not ready for review. So far there is only a sufficiently pretty interface.


---

Comment by git created at 2020-01-23 01:15:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-01-23 01:18:55

Now it's ready.


---

Comment by mkoeppe created at 2020-01-23 01:18:55

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-01-30 15:48:09

Anyone interested in reviewing this?


---

Comment by dimpase created at 2020-01-30 19:42:30

Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.
Can we have a follow-up ticket on this?
Otherwise, positive review.


---

Comment by dimpase created at 2020-01-30 19:42:30

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-01-30 19:46:59

Changing status from positive_review to needs_info.


---

Comment by dimpase created at 2020-01-30 19:46:59

Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.


---

Comment by jhpalmieri created at 2020-01-30 19:51:55

Replying to [comment:17 dimpase]:
> Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.
> Can we have a follow-up ticket on this?

Is #28788 the right place?


---

Comment by mkoeppe created at 2020-01-30 19:54:33

Replying to [comment:19 jhpalmieri]:
> Replying to [comment:17 dimpase]:
> > Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.
> > Can we have a follow-up ticket on this?
> 
> Is #28788 the right place?

Yes.


---

Comment by mkoeppe created at 2020-01-30 20:01:26

Replying to [comment:18 dimpase]:
> Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.
That's caused by another misclassification, for historical reasons, of package types (like the one for `gfortran` fixed in #29053).

```
$ cat build/pkgs/gmp/type 
optional
$ cat build/pkgs/mpir/type 
optional
```

These should actually be `standard` - they are mutually exclusive standard packages.


---

Comment by mkoeppe created at 2020-01-30 20:02:21

Fix on this ticket or follow up?


---

Comment by dimpase created at 2020-01-30 20:10:22

here, I guess.

It would be good to check that this change in the package types won't cause broken builds, with both gmp and mpir getting installed...


---

Comment by git created at 2020-01-30 20:45:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-01-30 20:46:23

Changing status from needs_info to needs_review.


---

Comment by mkoeppe created at 2020-01-30 20:46:23

Done. Works for me


---

Comment by dimpase created at 2020-01-30 21:49:30

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-01-30 22:35:59

Thanks for reviewing!


---

Comment by embray created at 2020-01-31 11:40:01

Interesting, I didn't know this syntax:


```
+OPTIONAL_CLEANED_PACKAGES_CLEANS = $(OPTIONAL_CLEANED_PACKAGES:%=%-clean)
```


+1 from me.  This is an idea that had crossed my mind before but I wasn't really sure how to go about it.  Thanks!


---

Comment by embray created at 2020-01-31 11:40:54

Replying to [comment:21 mkoeppe]:
> Replying to [comment:18 dimpase]:
> > Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.
> That's caused by another misclassification, for historical reasons, of package types (like the one for `gfortran` fixed in #29053).
> {{{
> $ cat build/pkgs/gmp/type 
> optional
> $ cat build/pkgs/mpir/type 
> optional
> }}}
> These should actually be `standard` - they are mutually exclusive standard packages.

This has always annoyed me too.  I tried to fix it a while ago but I think my approach to the problem was too complicated at the time.  I think now we have a better solution.


---

Comment by vbraun created at 2020-01-31 23:49:45

Resolution: fixed
