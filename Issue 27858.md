# Issue 27858: Add --enable-OPTIONALSPKG options to configure

archive/issues_027858.json:
```json
{
    "body": "CC:  @dimpase @embray @saraedum @jhpalmieri\n\nThis ticket adds options such as `--enable-lrslib`, `--enable-topcom` for all optional and experimental packages to `configure`. \n\nSubsequent `make` will then install these packages.\n\nThis will simplify installations of sage with a list of optional packages. \n\n(This was previously discussed in #21538, which did not clearly enough distinguish this proposal from the topic of using system packages, #27567.)\n\nIssue created by migration from https://trac.sagemath.org/ticket/28095\n\n",
    "created_at": "2019-07-01T19:35:54Z",
    "labels": [
        "build: configure",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Add --enable-OPTIONALSPKG options to configure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27858",
    "user": "@mkoeppe"
}
```
CC:  @dimpase @embray @saraedum @jhpalmieri

This ticket adds options such as `--enable-lrslib`, `--enable-topcom` for all optional and experimental packages to `configure`. 

Subsequent `make` will then install these packages.

This will simplify installations of sage with a list of optional packages. 

(This was previously discussed in #21538, which did not clearly enough distinguish this proposal from the topic of using system packages, #27567.)

Issue created by migration from https://trac.sagemath.org/ticket/28095





---

archive/issue_comments_393409.json:
```json
{
    "body": "+1 that's a good idea.",
    "created_at": "2019-07-02T12:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393409",
    "user": "@embray"
}
```

+1 that's a good idea.



---

archive/issue_comments_393410.json:
```json
{
    "body": "It seems tricky to generate AC_ARG_ENABLE macro invocations for all packages: it would have to be done during `bootstrap` (not sure if we want this), or perhaps using m4 loops (https://www.gnu.org/software/autoconf/manual/autoconf-2.62/html_node/Looping-constructs.html).",
    "created_at": "2019-07-26T16:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393410",
    "user": "@mkoeppe"
}
```

It seems tricky to generate AC_ARG_ENABLE macro invocations for all packages: it would have to be done during `bootstrap` (not sure if we want this), or perhaps using m4 loops (https://www.gnu.org/software/autoconf/manual/autoconf-2.62/html_node/Looping-constructs.html).



---

archive/issue_comments_393411.json:
```json
{
    "body": "well, we do things like collecting spkg-configure.m4 files for each package in ./bootstrap, nothing wrong with doing more at this stage...",
    "created_at": "2019-07-26T18:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393411",
    "user": "@dimpase"
}
```

well, we do things like collecting spkg-configure.m4 files for each package in ./bootstrap, nothing wrong with doing more at this stage...



---

archive/issue_comments_393412.json:
```json
{
    "body": "Yes, you could do it during bootstrap, in principle.\n\nI have tried in the past to get m4 itself to loop over package directories and generate this stuff (as opposed to the current approach of generating bits of m4 in `./bootstrap`).  And in principle that can work, but other, higher-level tools like automake get terribly confused when you try to do too much weird stuff like this.",
    "created_at": "2019-08-13T08:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393412",
    "user": "@embray"
}
```

Yes, you could do it during bootstrap, in principle.

I have tried in the past to get m4 itself to loop over package directories and generate this stuff (as opposed to the current approach of generating bits of m4 in `./bootstrap`).  And in principle that can work, but other, higher-level tools like automake get terribly confused when you try to do too much weird stuff like this.



---

archive/issue_comments_393413.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393413",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_393414.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-01-22T22:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393414",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_393415.json:
```json
{
    "body": "how is the actual installation of the enabled packages triggered?",
    "created_at": "2020-01-22T22:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393415",
    "user": "@dimpase"
}
```

how is the actual installation of the enabled packages triggered?



---

archive/issue_comments_393416.json:
```json
{
    "body": "Oh, the ticket is not ready for review. So far there is only a sufficiently pretty interface.",
    "created_at": "2020-01-22T22:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393416",
    "user": "@mkoeppe"
}
```

Oh, the ticket is not ready for review. So far there is only a sufficiently pretty interface.



---

archive/issue_comments_393417.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-23T01:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393417",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393418.json:
```json
{
    "body": "Now it's ready.",
    "created_at": "2020-01-23T01:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393418",
    "user": "@mkoeppe"
}
```

Now it's ready.



---

archive/issue_comments_393419.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-23T01:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393419",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_393420.json:
```json
{
    "body": "Anyone interested in reviewing this?",
    "created_at": "2020-01-30T15:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393420",
    "user": "@mkoeppe"
}
```

Anyone interested in reviewing this?



---

archive/issue_comments_393421.json:
```json
{
    "body": "Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.\nCan we have a follow-up ticket on this?\nOtherwise, positive review.",
    "created_at": "2020-01-30T19:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393421",
    "user": "@dimpase"
}
```

Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.
Can we have a follow-up ticket on this?
Otherwise, positive review.



---

archive/issue_comments_393422.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-30T19:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393422",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_393423.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2020-01-30T19:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393423",
    "user": "@dimpase"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_393424.json:
```json
{
    "body": "Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.",
    "created_at": "2020-01-30T19:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393424",
    "user": "@dimpase"
}
```

Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.



---

archive/issue_comments_393425.json:
```json
{
    "body": "Replying to [comment:17 dimpase]:\n> Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.\n> Can we have a follow-up ticket on this?\n\nIs #28788 the right place?",
    "created_at": "2020-01-30T19:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393425",
    "user": "@jhpalmieri"
}
```

Replying to [comment:17 dimpase]:
> Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.
> Can we have a follow-up ticket on this?

Is #28788 the right place?



---

archive/issue_comments_393426.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> Replying to [comment:17 dimpase]:\n> > Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.\n> > Can we have a follow-up ticket on this?\n> \n> Is #28788 the right place?\n\nYes.",
    "created_at": "2020-01-30T19:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393426",
    "user": "@mkoeppe"
}
```

Replying to [comment:19 jhpalmieri]:
> Replying to [comment:17 dimpase]:
> > Very nice! It works, but I don't like that ./configure does not output which packages are tagged for installation/deletion.
> > Can we have a follow-up ticket on this?
> 
> Is #28788 the right place?

Yes.



---

archive/issue_comments_393427.json:
```json
{
    "body": "Replying to [comment:18 dimpase]:\n> Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.\nThat's caused by another misclassification, for historical reasons, of package types (like the one for `gfortran` fixed in #29053).\n\n```\n$ cat build/pkgs/gmp/type \noptional\n$ cat build/pkgs/mpir/type \noptional\n```\n\nThese should actually be `standard` - they are mutually exclusive standard packages.",
    "created_at": "2020-01-30T20:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393427",
    "user": "@mkoeppe"
}
```

Replying to [comment:18 dimpase]:
> Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.
That's caused by another misclassification, for historical reasons, of package types (like the one for `gfortran` fixed in #29053).

```
$ cat build/pkgs/gmp/type 
optional
$ cat build/pkgs/mpir/type 
optional
```

These should actually be `standard` - they are mutually exclusive standard packages.



---

archive/issue_comments_393428.json:
```json
{
    "body": "Fix on this ticket or follow up?",
    "created_at": "2020-01-30T20:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393428",
    "user": "@mkoeppe"
}
```

Fix on this ticket or follow up?



---

archive/issue_comments_393429.json:
```json
{
    "body": "here, I guess.\n\nIt would be good to check that this change in the package types won't cause broken builds, with both gmp and mpir getting installed...",
    "created_at": "2020-01-30T20:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393429",
    "user": "@dimpase"
}
```

here, I guess.

It would be good to check that this change in the package types won't cause broken builds, with both gmp and mpir getting installed...



---

archive/issue_comments_393430.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-30T20:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393430",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393431.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-01-30T20:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393431",
    "user": "@mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_393432.json:
```json
{
    "body": "Done. Works for me",
    "created_at": "2020-01-30T20:46:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393432",
    "user": "@mkoeppe"
}
```

Done. Works for me



---

archive/issue_comments_393433.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-30T21:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393433",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_393434.json:
```json
{
    "body": "Thanks for reviewing!",
    "created_at": "2020-01-30T22:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393434",
    "user": "@mkoeppe"
}
```

Thanks for reviewing!



---

archive/issue_comments_393435.json:
```json
{
    "body": "Interesting, I didn't know this syntax:\n\n\n```\n+OPTIONAL_CLEANED_PACKAGES_CLEANS = $(OPTIONAL_CLEANED_PACKAGES:%=%-clean)\n```\n\n\n+1 from me.  This is an idea that had crossed my mind before but I wasn't really sure how to go about it.  Thanks!",
    "created_at": "2020-01-31T11:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393435",
    "user": "@embray"
}
```

Interesting, I didn't know this syntax:


```
+OPTIONAL_CLEANED_PACKAGES_CLEANS = $(OPTIONAL_CLEANED_PACKAGES:%=%-clean)
```


+1 from me.  This is an idea that had crossed my mind before but I wasn't really sure how to go about it.  Thanks!



---

archive/issue_comments_393436.json:
```json
{
    "body": "Replying to [comment:21 mkoeppe]:\n> Replying to [comment:18 dimpase]:\n> > Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.\n> That's caused by another misclassification, for historical reasons, of package types (like the one for `gfortran` fixed in #29053).\n> {{{\n> $ cat build/pkgs/gmp/type \n> optional\n> $ cat build/pkgs/mpir/type \n> optional\n> }}}\n> These should actually be `standard` - they are mutually exclusive standard packages.\n\nThis has always annoyed me too.  I tried to fix it a while ago but I think my approach to the problem was too complicated at the time.  I think now we have a better solution.",
    "created_at": "2020-01-31T11:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393436",
    "user": "@embray"
}
```

Replying to [comment:21 mkoeppe]:
> Replying to [comment:18 dimpase]:
> > Also, I don't  understand the difference between `--with-system-gmp=force` and `--enable-gmp`. These appear to conflict each other.
> That's caused by another misclassification, for historical reasons, of package types (like the one for `gfortran` fixed in #29053).
> {{{
> $ cat build/pkgs/gmp/type 
> optional
> $ cat build/pkgs/mpir/type 
> optional
> }}}
> These should actually be `standard` - they are mutually exclusive standard packages.

This has always annoyed me too.  I tried to fix it a while ago but I think my approach to the problem was too complicated at the time.  I think now we have a better solution.



---

archive/issue_comments_393437.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-31T23:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27858",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27858#issuecomment-393437",
    "user": "@vbraun"
}
```

Resolution: fixed
