# Issue 34048: User bases in direct sums

archive/issues_034048.json:
```json
{
    "body": "It is possible to specify custom bases for free modules in Sage with functions such as `submodule_with_basis` or `span_of_basis`. For example,\n\n\n```python\nV = (QQ^3).span_of_basis([[1,2,0], [0,1,0]]); V\n```\n\n\noutputs the following: \n\n\n``` \nVector space of degree 3 and dimension 2 over Rational Field\nUser basis matrix:\n[1 2 0]\n[0 1 0]\n```\n\n\nHowever, this custom basis is lost when the vector space is direct summed with another. For example, running \n\n\n```python\nV.direct_sum(QQ^2)\n```\n\n\nresults in the following, where the custom basis of `V` has been forgotten and only the echelonized basis is remembered: \n\n\n``` \nVector space of degree 5 and dimension 4 over Rational Field\nBasis matrix:\n[1 0 0 0 0]\n[0 1 0 0 0]\n[0 0 0 1 0]\n[0 0 0 0 1]\n```\n\n\nI propose some minor edits to the `direct_sum` method so that the output is instead as follows: \n\n\n```\nVector space of degree 5 and dimension 4 over Rational Field\nUser basis matrix:\n[1 2 0 0 0]\n[0 1 0 0 0]\n[0 0 0 1 0]\n[0 0 0 0 1]\n```\n\n\nThis is accomplished by the following redefinition of `direct_sum`:\n\n\n```python\ndef direct_sum(self, other):\n    if not is_FreeModule(other):\n            raise TypeError(\"other must be a free module\")\n    if other.base_ring() != self.base_ring():\n        raise TypeError(\"base rings of self and other must be the same\")\n    M = FreeModule(self.base_ring(), self.degree() + other.degree())\n    A = self.basis_matrix().block_sum(other.basis_matrix())\n    if self.has_user_basis() or other.has_user_basis():\n        return M.span_of_basis(A)\n    else:\n        return M.span(A)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34285\n\n",
    "created_at": "2022-08-05T21:42:49Z",
    "labels": [
        "component: linear algebra",
        "trivial"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "User bases in direct sums",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34048",
    "user": "https://github.com/sagrawalx"
}
```
It is possible to specify custom bases for free modules in Sage with functions such as `submodule_with_basis` or `span_of_basis`. For example,


```python
V = (QQ^3).span_of_basis([[1,2,0], [0,1,0]]); V
```


outputs the following: 


``` 
Vector space of degree 3 and dimension 2 over Rational Field
User basis matrix:
[1 2 0]
[0 1 0]
```


However, this custom basis is lost when the vector space is direct summed with another. For example, running 


```python
V.direct_sum(QQ^2)
```


results in the following, where the custom basis of `V` has been forgotten and only the echelonized basis is remembered: 


``` 
Vector space of degree 5 and dimension 4 over Rational Field
Basis matrix:
[1 0 0 0 0]
[0 1 0 0 0]
[0 0 0 1 0]
[0 0 0 0 1]
```


I propose some minor edits to the `direct_sum` method so that the output is instead as follows: 


```
Vector space of degree 5 and dimension 4 over Rational Field
User basis matrix:
[1 2 0 0 0]
[0 1 0 0 0]
[0 0 0 1 0]
[0 0 0 0 1]
```


This is accomplished by the following redefinition of `direct_sum`:


```python
def direct_sum(self, other):
    if not is_FreeModule(other):
            raise TypeError("other must be a free module")
    if other.base_ring() != self.base_ring():
        raise TypeError("base rings of self and other must be the same")
    M = FreeModule(self.base_ring(), self.degree() + other.degree())
    A = self.basis_matrix().block_sum(other.basis_matrix())
    if self.has_user_basis() or other.has_user_basis():
        return M.span_of_basis(A)
    else:
        return M.span(A)
```


Issue created by migration from https://trac.sagemath.org/ticket/34285





---

archive/issue_comments_482660.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-05T21:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34048#issuecomment-482660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_482661.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-06T01:00:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34048",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34048#issuecomment-482661",
    "user": "https://github.com/sagrawalx"
}
```

Changing status from new to needs_review.



---

archive/issue_events_089333.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/34048",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/34048#event-89333"
}
```
