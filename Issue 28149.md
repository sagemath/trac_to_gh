# Issue 28149: singular.invariant_ring fails because the return type (tuple/list) is not recognized

Issue created by migration from https://trac.sagemath.org/ticket/28386

Original creator: rburing

Original creation time: 2019-08-22 19:05:42

Keywords: Singular,finvar,invariant_ring

As reported in [Ask SageMath question #47562](https://ask.sagemath.org/question/47562/calling-singularinvariant_ring/), this fails:


```
sage: singular.lib('finvar.lib')
sage: R = singular.ring(3, '(x0,x1)', 'dp')
sage: g = singular.matrix(2,2,'1,0,1,1')
sage: singular.invariant_ring(g)
...
TypeError: Singular error:
   ? assign not impl.
   ? error occurred in or before STDIN line 16: `        return(P,S);`
```


The reason is that the return type (tuple/list) is not understood.

Workaround (which suggests a solution):


```
sage: from sage.interfaces.singular import SingularElement
sage: SingularElement(singular, 'list', 'invariant_ring(%s)' % g.name(), False).sage()
[[            x0 x0^2*x1 - x1^3], [1]]
```



---

Comment by chapoton created at 2019-08-23 19:32:22

possibly related:

```
sage: m = singular(matrix(ZZ,2,2,[2,3,5,7]))
sage: m['1,1..2']
...

sage: from sage.interfaces.singular import SingularElement
sage: SingularElement(singular, 'list','%s[1,1..2]' % m.name(),False)
[1]:
   2
[2]:
   3
```



---

Comment by rburing created at 2019-08-24 09:50:20

Indeed, `SingularElement.__getitem__` is inherited from `ExpectElement`; it calls `Singular.new` (inherited from `Expect`) which is a wrapper around `Singular.__call__`, but it doesn't pass any extra arguments like the `type` that `Singular.__call__` supports, so the `type` defaults to `'def'`, while it should be something like `type='list'` in this case (?).

So maybe `SingularElement.__getitem__` should overridden to be smarter and pass a `type` argument to `Singular.__call__` when appropriate (instead of calling `Singular.new`)?

Further, `singular.invariant_ring` is a `SingularFunction` with a `__call__` method (inherited from `ExpectFunction`) which calls `Singular.function_call` (inherited from `Expect.function_call`) which does some string conversion and then calls `Singular.new`; again there is no `type` argument passed to `Singular.__call__` so it defaults to `'def'`. So maybe `SingularFunction.__call__` should be overridden (to pass a `type`) as well?

In both cases, it could be tricky to decide what `type` to pass based on the input.


---

Comment by chapoton created at 2019-08-25 06:16:57

somewhat similar issue in #25253


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.
