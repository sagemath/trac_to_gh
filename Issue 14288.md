# Issue 14288: Modular group cohomology, version 2.1.4

archive/issues_014288.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  david.green@uni-jena.de jhpalmieri\n\nKeywords: group cohomology\n\nBecause of several backward incompatible internal changes in Sage (e.g., removing SAGE_DATA and moving it to SAGE_SHARE), the current version of the optional group cohomology package `p_group_cohomology` did not work.\n\nMoreover, tmp_dir used to return a string, but now it also creates a directory; for this reason, many tests failed.\n\nAnd also some random generators (in GAP?) seem to have changed. For this reason, some ring presentations have changed (i.e., the rings are isomorphic, but a different presentation is obtained with an old or with a new Sage version). Hence, doctests needed to change.\n\nIn any case: The new group cohomology spkg copes with these changes. However, it will therefore *not* work with old Sage versions.\n\n__Further implementation changes__\n\n* Since this spkg *is* the upstream source, the source code is still contained in the mercurial repository. Change: Now, mercurial queues are used (this made it a bit easier for me to manage the changes while developing).\n* urllib2 is used, which to me seems to work a bit better than urllib.\n* The new version uses `os.path.join` and `os.path.split`, rather than string concatenation using a non-portable path separator `'/'`.\n* The old version had a bug related with pickling: In order to keep the data base created by a user separate from the data base that is shared by all users of an installation, soft links were used. But when one saves new data into a file that used to be the name of a soft link, one should unlink the link first. This is fixed in the new version.\n* The protocol output has changed. In a typical cohomology computation, several cohomology rings are involved (the ring to-be-computed, the cohomology ring of a Sylow subgroup, or of a maximal elementary abelian subgroup, etc). The new protocol output tells in which ring the current computation happens.\n\n__Change of algorithms__\n\nThe first change: If no new relation has been found in degree n-1, then a *complete* Gr\u00f6bner basis of the relation ideal is computed, even if a completeness criterion can not be applied yet. This simple change reduces the computation time for the mod-3 cohomology of J3 by several days.\n\nThe second change: By mistake, the old version would attempt to prove completeness with the Hilbert-Poincar\u00e9 criterion, even if the Symonds criterion has already shown that the ring is incomplete. Now, the Hilbert-Poincar\u00e9 criterion is only used if the Symonds criterion has not been conclusive.\n\nThe third change: In the old version, it was first tested that the current ring approximation contains parameters for the complete cohomology ring, and then such parameters have been constructed using the relations in the ring approximation. These relations can be rather complicated. Therefore, we now compute parameters via restriction to maximal elementary abelian subgroups. It is known that a set of elements of the ring approximation yields parameters for the cohomology ring, if and only if the cohomology of the maximal elementary abelian subgroups is finite over the restriction of these elements.\n\nHence, we can detect parameters even if the ring approximation is far from being complete, and we can compute in rings that are much easier to deal with. By consequence, it is now in most cases possible to prove completeness by the Symonds criterion, which relies on the explicit construction of parameters in small degrees. Our other criteria, which are able to use an *existence proof* for parameters of small degrees (without the need of their explicit construction) are of course still part of the package, but it became difficult to show examples in which they are actually used.\n\n__New features__\n\nThere is no substantially new functionality. However, depending on how fast the reviewing goes, I could imagine to soon add a method so that `gap(H)` returns an algebra in the GAP interface, isomorphic to a cohomology ring H.\n\n__SPKG__\n\n[p_group_cohomology-2.1.4.spkg](http://sage.math.washington.edu/home/SimonKing/Cohomology/p_group_cohomology-2.1.4.spkg)\n\nIssue created by migration from https://trac.sagemath.org/ticket/14492\n\n",
    "created_at": "2013-04-26T09:35:15Z",
    "labels": [
        "packages: optional",
        "major",
        "bug"
    ],
    "title": "Modular group cohomology, version 2.1.4",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14288",
    "user": "SimonKing"
}
```
Assignee: tbd

CC:  david.green@uni-jena.de jhpalmieri

Keywords: group cohomology

Because of several backward incompatible internal changes in Sage (e.g., removing SAGE_DATA and moving it to SAGE_SHARE), the current version of the optional group cohomology package `p_group_cohomology` did not work.

Moreover, tmp_dir used to return a string, but now it also creates a directory; for this reason, many tests failed.

And also some random generators (in GAP?) seem to have changed. For this reason, some ring presentations have changed (i.e., the rings are isomorphic, but a different presentation is obtained with an old or with a new Sage version). Hence, doctests needed to change.

In any case: The new group cohomology spkg copes with these changes. However, it will therefore *not* work with old Sage versions.

__Further implementation changes__

* Since this spkg *is* the upstream source, the source code is still contained in the mercurial repository. Change: Now, mercurial queues are used (this made it a bit easier for me to manage the changes while developing).
* urllib2 is used, which to me seems to work a bit better than urllib.
* The new version uses `os.path.join` and `os.path.split`, rather than string concatenation using a non-portable path separator `'/'`.
* The old version had a bug related with pickling: In order to keep the data base created by a user separate from the data base that is shared by all users of an installation, soft links were used. But when one saves new data into a file that used to be the name of a soft link, one should unlink the link first. This is fixed in the new version.
* The protocol output has changed. In a typical cohomology computation, several cohomology rings are involved (the ring to-be-computed, the cohomology ring of a Sylow subgroup, or of a maximal elementary abelian subgroup, etc). The new protocol output tells in which ring the current computation happens.

__Change of algorithms__

The first change: If no new relation has been found in degree n-1, then a *complete* Gröbner basis of the relation ideal is computed, even if a completeness criterion can not be applied yet. This simple change reduces the computation time for the mod-3 cohomology of J3 by several days.

The second change: By mistake, the old version would attempt to prove completeness with the Hilbert-Poincaré criterion, even if the Symonds criterion has already shown that the ring is incomplete. Now, the Hilbert-Poincaré criterion is only used if the Symonds criterion has not been conclusive.

The third change: In the old version, it was first tested that the current ring approximation contains parameters for the complete cohomology ring, and then such parameters have been constructed using the relations in the ring approximation. These relations can be rather complicated. Therefore, we now compute parameters via restriction to maximal elementary abelian subgroups. It is known that a set of elements of the ring approximation yields parameters for the cohomology ring, if and only if the cohomology of the maximal elementary abelian subgroups is finite over the restriction of these elements.

Hence, we can detect parameters even if the ring approximation is far from being complete, and we can compute in rings that are much easier to deal with. By consequence, it is now in most cases possible to prove completeness by the Symonds criterion, which relies on the explicit construction of parameters in small degrees. Our other criteria, which are able to use an *existence proof* for parameters of small degrees (without the need of their explicit construction) are of course still part of the package, but it became difficult to show examples in which they are actually used.

__New features__

There is no substantially new functionality. However, depending on how fast the reviewing goes, I could imagine to soon add a method so that `gap(H)` returns an algebra in the GAP interface, isomorphic to a cohomology ring H.

__SPKG__

[p_group_cohomology-2.1.4.spkg](http://sage.math.washington.edu/home/SimonKing/Cohomology/p_group_cohomology-2.1.4.spkg)

Issue created by migration from https://trac.sagemath.org/ticket/14492





---

archive/issue_comments_180119.json:
```json
{
    "body": "I did not test the package on OS X yet, but only on my `openSuse` laptop.\n\nThe new package version should be able to compute the mod-3 cohomology of the third Janko group without manual intervention, but the verification will take a couple of more days.\n\nIn any case, it needs review!",
    "created_at": "2013-04-26T09:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180119",
    "user": "SimonKing"
}
```

I did not test the package on OS X yet, but only on my `openSuse` laptop.

The new package version should be able to compute the mod-3 cohomology of the third Janko group without manual intervention, but the verification will take a couple of more days.

In any case, it needs review!



---

archive/issue_comments_180120.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-26T09:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180120",
    "user": "SimonKing"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_180121.json:
```json
{
    "body": "I get this error with the doctests:\n\n```\n$ sage -bt local/lib/python/site-packages/pGroupCohomology/\n...\nFile \"local/lib/python/site-packages/pGroupCohomology/factory.py\", line 897, in pGroupCohomology.factory.CohomologyRingFactory._get_p_group_from_cache_or_db\nFailed example:\n    CohomologyRing._get_p_group_from_cache_or_db('8gp3',(8,3), from_scratch=True)\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: You requested a computation from scratch. Please remove .../8gp3\nGot:\n    <BLANKLINE>\n```\n\nMaybe something wrong with the temp directory? The actual functionality seems to work, though.",
    "created_at": "2013-04-26T13:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180121",
    "user": "vbraun"
}
```

I get this error with the doctests:

```
$ sage -bt local/lib/python/site-packages/pGroupCohomology/
...
File "local/lib/python/site-packages/pGroupCohomology/factory.py", line 897, in pGroupCohomology.factory.CohomologyRingFactory._get_p_group_from_cache_or_db
Failed example:
    CohomologyRing._get_p_group_from_cache_or_db('8gp3',(8,3), from_scratch=True)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: You requested a computation from scratch. Please remove .../8gp3
Got:
    <BLANKLINE>
```

Maybe something wrong with the temp directory? The actual functionality seems to work, though.



---

archive/issue_comments_180122.json:
```json
{
    "body": "Hm. This should work. But there is something much more urgent concerning \"should work\":\n\nI tested the package on my laptop by running the test script explicitly, which worked. But When I run it as part of the installation procedure (i.e., by `export SAGE_CHECK=yes` before `sage -i ...`), I get a *total* failure! There was not even a single test that passed.\n\nReason:\n\n```\nsage-runtests: error: no such option: -o\nlist index out of range\nUsage: sage -t [options] filenames\n```\n\n\nI don't know where the \"-o\" comes from. To be investigated.",
    "created_at": "2013-04-26T14:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180122",
    "user": "SimonKing"
}
```

Hm. This should work. But there is something much more urgent concerning "should work":

I tested the package on my laptop by running the test script explicitly, which worked. But When I run it as part of the installation procedure (i.e., by `export SAGE_CHECK=yes` before `sage -i ...`), I get a *total* failure! There was not even a single test that passed.

Reason:

```
sage-runtests: error: no such option: -o
list index out of range
Usage: sage -t [options] filenames
```


I don't know where the "-o" comes from. To be investigated.



---

archive/issue_comments_180123.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-04-26T14:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180123",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_180124.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n> I get this error with the doctests:\n> {{{\n> $ sage -bt local/lib/python/site-packages/pGroupCohomology/\n> ...\n> File \"local/lib/python/site-packages/pGroupCohomology/factory.py\", line 897, in pGroupCohomology.factory.CohomologyRingFactory._get_p_group_from_cache_or_db\n> Failed example:\n>     CohomologyRing._get_p_group_from_cache_or_db('8gp3',(8,3), from_scratch=True)\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     RuntimeError: You requested a computation from scratch. Please remove .../8gp3\n> Got:\n>     <BLANKLINE>\n> }}}\n> Maybe something wrong with the temp directory? The actual functionality seems to work, though.\n\nAha. So, here I check against an error that is supposed to occur in certain settings. Hm.\n\nI don't understand why the result is just a blank line, not the error that is actually due in this case. The line preceding this test removes the existing cohomology ring from memory but not from disk; and a computation from scratch should then fail, because it does not like to find the data in a location in which new data are supposed to be written.",
    "created_at": "2013-04-26T14:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180124",
    "user": "SimonKing"
}
```

Replying to [comment:3 vbraun]:
> I get this error with the doctests:
> {{{
> $ sage -bt local/lib/python/site-packages/pGroupCohomology/
> ...
> File "local/lib/python/site-packages/pGroupCohomology/factory.py", line 897, in pGroupCohomology.factory.CohomologyRingFactory._get_p_group_from_cache_or_db
> Failed example:
>     CohomologyRing._get_p_group_from_cache_or_db('8gp3',(8,3), from_scratch=True)
> Expected:
>     Traceback (most recent call last):
>     ...
>     RuntimeError: You requested a computation from scratch. Please remove .../8gp3
> Got:
>     <BLANKLINE>
> }}}
> Maybe something wrong with the temp directory? The actual functionality seems to work, though.

Aha. So, here I check against an error that is supposed to occur in certain settings. Hm.

I don't understand why the result is just a blank line, not the error that is actually due in this case. The line preceding this test removes the existing cohomology ring from memory but not from disk; and a computation from scratch should then fail, because it does not like to find the data in a location in which new data are supposed to be written.



---

archive/issue_comments_180125.json:
```json
{
    "body": "I think here is the problem:\n\n```\n    Res = os.popen('sage -t -optional -long '+f.name).read()\n```\n\nCould it be that in the most recent Sage version one should instead write `sage -t --optional --long`?",
    "created_at": "2013-04-26T14:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180125",
    "user": "SimonKing"
}
```

I think here is the problem:

```
    Res = os.popen('sage -t -optional -long '+f.name).read()
```

Could it be that in the most recent Sage version one should instead write `sage -t --optional --long`?



---

archive/issue_comments_180126.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-26T14:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180126",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_180127.json:
```json
{
    "body": "OK, I have just posted a new spkg which uses double-minus for the command line options, and just started re-installation and test.",
    "created_at": "2013-04-26T14:15:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180127",
    "user": "SimonKing"
}
```

OK, I have just posted a new spkg which uses double-minus for the command line options, and just started re-installation and test.



---

archive/issue_comments_180128.json:
```json
{
    "body": "No. Still *all* tests fail. This is with sage-5.9.rc0.",
    "created_at": "2013-04-26T14:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180128",
    "user": "SimonKing"
}
```

No. Still *all* tests fail. This is with sage-5.9.rc0.



---

archive/issue_comments_180129.json:
```json
{
    "body": "The failures that I get for *every* single test looks like this:\n\n```\npGroupCohomology.resolution.makeSpecialGroupData:\nRunning doctests with ID 2013-04-26-16-31-00-2eee1fc7.\nDoctesting 1 file.\nsage -t /home/simon/.sage/temp/linux-sqwp.site/11900/dir_vpH6Jb/file_5.py\n    [0 tests, 0.00 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.0 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```\n\n\nSo, does this look like an error in the doctest framework? I can reproduce it when I directly run the spkg-check script under sage-5.9.rc0.\n\nI tried to run the tests verbously, but it didn't help, the tests won't even start, but no reason is given.",
    "created_at": "2013-04-26T16:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180129",
    "user": "SimonKing"
}
```

The failures that I get for *every* single test looks like this:

```
pGroupCohomology.resolution.makeSpecialGroupData:
Running doctests with ID 2013-04-26-16-31-00-2eee1fc7.
Doctesting 1 file.
sage -t /home/simon/.sage/temp/linux-sqwp.site/11900/dir_vpH6Jb/file_5.py
    [0 tests, 0.00 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.0 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```


So, does this look like an error in the doctest framework? I can reproduce it when I directly run the spkg-check script under sage-5.9.rc0.

I tried to run the tests verbously, but it didn't help, the tests won't even start, but no reason is given.



---

archive/issue_comments_180130.json:
```json
{
    "body": "The tests of each function are written into a temporary file. One of the files looks like this:\n\n```\n# -*- coding: utf-8 -*-\nr\"\"\"\n        Return a hash value of self\n\n        TESTS:\n\n        The example produces files. For safety reasons, we choose files\n        in a temporary directory; it will be removed as soon as Sage is quit::\n\n            sage: tmp_root = tmp_dir()\n            sage: from pGroupCohomology import CohomologyRing\n            sage: CohomologyRing.set_user_db(tmp_root)\n            sage: H = CohomologyRing(8,3)\n            sage: H.make()\n            sage: C = H.2\n            sage: hash(C)==hash(copy(C))   # indirect doctest\n            True\n            sage: hash(C)==hash(loads(dumps(C)))\n            True\n            sage: D = {C:1, C^2:2}\n            sage: D[copy(C)]\n            1\n            sage: D[copy(C)*C]\n            2\n\n\"\"\"\n```\n\nwithout a line break at the end. I am testing now if the missing line break is to blame.",
    "created_at": "2013-04-26T17:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180130",
    "user": "SimonKing"
}
```

The tests of each function are written into a temporary file. One of the files looks like this:

```
# -*- coding: utf-8 -*-
r"""
        Return a hash value of self

        TESTS:

        The example produces files. For safety reasons, we choose files
        in a temporary directory; it will be removed as soon as Sage is quit::

            sage: tmp_root = tmp_dir()
            sage: from pGroupCohomology import CohomologyRing
            sage: CohomologyRing.set_user_db(tmp_root)
            sage: H = CohomologyRing(8,3)
            sage: H.make()
            sage: C = H.2
            sage: hash(C)==hash(copy(C))   # indirect doctest
            True
            sage: hash(C)==hash(loads(dumps(C)))
            True
            sage: D = {C:1, C^2:2}
            sage: D[copy(C)]
            1
            sage: D[copy(C)*C]
            2

"""
```

without a line break at the end. I am testing now if the missing line break is to blame.



---

archive/issue_comments_180131.json:
```json
{
    "body": "No, adding the line break did change nothing.",
    "created_at": "2013-04-26T17:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180131",
    "user": "SimonKing"
}
```

No, adding the line break did change nothing.



---

archive/issue_comments_180132.json:
```json
{
    "body": "One could say that I was misusing the \"# optional\" tag: The tests were supposed to be part of the test suite, but the tag was only in order to tell the *user* (not to tell the *test bot*): \"If you don't have internet access then this test is supposed to fail; don't worry\".\n\nIn the new version, that I just put on-line, the tag is replaced by \"# needs internet access\", which is informative to the user in case of an error, but will not interfere with the test framework.",
    "created_at": "2013-04-26T19:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180132",
    "user": "SimonKing"
}
```

One could say that I was misusing the "# optional" tag: The tests were supposed to be part of the test suite, but the tag was only in order to tell the *user* (not to tell the *test bot*): "If you don't have internet access then this test is supposed to fail; don't worry".

In the new version, that I just put on-line, the tag is replaced by "# needs internet access", which is informative to the user in case of an error, but will not interfere with the test framework.



---

archive/issue_comments_180133.json:
```json
{
    "body": "And I forgot to mention one thing: In contrast to previous versions of the spkg, it is now not required to have internet access for running the test suite. The only exceptions are the tests of two methods whose actual purpose is internet access.",
    "created_at": "2013-04-26T19:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180133",
    "user": "SimonKing"
}
```

And I forgot to mention one thing: In contrast to previous versions of the spkg, it is now not required to have internet access for running the test suite. The only exceptions are the tests of two methods whose actual purpose is internet access.



---

archive/issue_comments_180134.json:
```json
{
    "body": "In spkg-check, `SAGE_NUMBER_THREADS` should be changed to `SAGE_NUM_THREADS`.",
    "created_at": "2013-04-26T20:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180134",
    "user": "jhpalmieri"
}
```

In spkg-check, `SAGE_NUMBER_THREADS` should be changed to `SAGE_NUM_THREADS`.



---

archive/issue_comments_180135.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> In spkg-check, `SAGE_NUMBER_THREADS` should be changed to `SAGE_NUM_THREADS`.\n\nThank you for spotting this! I have already been wondering why setting `MAKE=\"make -j4\"` had no effect on the number of parallel threads in the tests.",
    "created_at": "2013-04-26T20:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180135",
    "user": "SimonKing"
}
```

Replying to [comment:14 jhpalmieri]:
> In spkg-check, `SAGE_NUMBER_THREADS` should be changed to `SAGE_NUM_THREADS`.

Thank you for spotting this! I have already been wondering why setting `MAKE="make -j4"` had no effect on the number of parallel threads in the tests.



---

archive/issue_comments_180136.json:
```json
{
    "body": "OK, fixed, and setting `MAKE=\"make -j2\"` is now enough to start tests in parallel.",
    "created_at": "2013-04-26T20:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180136",
    "user": "SimonKing"
}
```

OK, fixed, and setting `MAKE="make -j2"` is now enough to start tests in parallel.



---

archive/issue_comments_180137.json:
```json
{
    "body": "On my OS X 10.8 machine, all tests passed!",
    "created_at": "2013-04-26T22:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180137",
    "user": "jhpalmieri"
}
```

On my OS X 10.8 machine, all tests passed!



---

archive/issue_comments_180138.json:
```json
{
    "body": "Replying to [comment:3 vbraun]:\n> I get this error with the doctests:\n> {{{\n> $ sage -bt local/lib/python/site-packages/pGroupCohomology/\n> ...\n> File \"local/lib/python/site-packages/pGroupCohomology/factory.py\", line 897, in pGroupCohomology.factory.CohomologyRingFactory._get_p_group_from_cache_or_db\n> Failed example:\n>     CohomologyRing._get_p_group_from_cache_or_db('8gp3',(8,3), from_scratch=True)\n> Expected:\n>     Traceback (most recent call last):\n>     ...\n>     RuntimeError: You requested a computation from scratch. Please remove .../8gp3\n> Got:\n>     <BLANKLINE>\n> }}}\n\nIs it reproducible?",
    "created_at": "2013-04-27T07:08:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180138",
    "user": "SimonKing"
}
```

Replying to [comment:3 vbraun]:
> I get this error with the doctests:
> {{{
> $ sage -bt local/lib/python/site-packages/pGroupCohomology/
> ...
> File "local/lib/python/site-packages/pGroupCohomology/factory.py", line 897, in pGroupCohomology.factory.CohomologyRingFactory._get_p_group_from_cache_or_db
> Failed example:
>     CohomologyRing._get_p_group_from_cache_or_db('8gp3',(8,3), from_scratch=True)
> Expected:
>     Traceback (most recent call last):
>     ...
>     RuntimeError: You requested a computation from scratch. Please remove .../8gp3
> Got:
>     <BLANKLINE>
> }}}

Is it reproducible?



---

archive/issue_comments_180139.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> On my OS X 10.8 machine, all tests passed!\n\nAnd on my `openSuse` laptop, all tests passed both with sage-5.8 and sage-5.9.rc0.",
    "created_at": "2013-04-27T07:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180139",
    "user": "SimonKing"
}
```

Replying to [comment:17 jhpalmieri]:
> On my OS X 10.8 machine, all tests passed!

And on my `openSuse` laptop, all tests passed both with sage-5.8 and sage-5.9.rc0.



---

archive/issue_comments_180140.json:
```json
{
    "body": "A question: At some point I had a syntax error in the code. Of course, the code did not compile---but `sage -i ...` still reported a successful installation. So, I could imagine that my spkg-install script is not correctly propagating the error.\n\nCould you have a look if spkg-install is doing something wrong?",
    "created_at": "2013-04-27T07:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180140",
    "user": "SimonKing"
}
```

A question: At some point I had a syntax error in the code. Of course, the code did not compile---but `sage -i ...` still reported a successful installation. So, I could imagine that my spkg-install script is not correctly propagating the error.

Could you have a look if spkg-install is doing something wrong?



---

archive/issue_comments_180141.json:
```json
{
    "body": "I still get the `from_scratch=True` error, and its completely reproducible. Installation works fine (and the doctests that actually perform computations seem to be working, too). I'll attach a more complete log.",
    "created_at": "2013-04-27T09:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180141",
    "user": "vbraun"
}
```

I still get the `from_scratch=True` error, and its completely reproducible. Installation works fine (and the doctests that actually perform computations seem to be working, too). I'll attach a more complete log.



---

archive/issue_comments_180142.json:
```json
{
    "body": "Attachment [factory-doctests.txt](tarball://root/attachments/some-uuid/ticket14492/factory-doctests.txt) by vbraun created at 2013-04-27 09:43:09\n\nDoctest output",
    "created_at": "2013-04-27T09:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180142",
    "user": "vbraun"
}
```

Attachment [factory-doctests.txt](tarball://root/attachments/some-uuid/ticket14492/factory-doctests.txt) by vbraun created at 2013-04-27 09:43:09

Doctest output



---

archive/issue_comments_180143.json:
```json
{
    "body": "Replying to [comment:21 vbraun]:\n> I still get the `from_scratch=True` error, and its completely reproducible. Installation works fine (and the doctests that actually perform computations seem to be working, too). I'll attach a more complete log.\n\nAha, now I think I understand what is happening!\n\nThe output looks as if you did not run the test suite (by `export SAGE_CHECK=yes` before installing the package), but you did run `sage -t` on the source files (or on their copies in local/lib/python/site-packages).\n\nThe test suite considers each doc string separately. Hence, it recursively finds out which modules, classes functions and methods are defined, extracts the doc of one item after the other, each time writing one doc string into a temporary file, and running sage -t on this temporary file. But it is *not* supposed to run sage -t on, say, `pGroupcCohomology/factory.py`.\n\nReason: The doc tests are supposed to demonstrate how the different sub-problems of cohomology computations are done. Hence, in the vast majority of cases, we want a computation from scratch. But if the first test puts a result into the cache, then the second test might be disturbed.\n\nExample: One test creates the computational set-up for the cohomology of the `SmallGroup(8,3)` (that's the dihedral group) from scratch, but does *not* complete the computation. This test will create an item in the cache that is only computed out to degree zero. Another test might then demonstrate that some *completely* computed cohomology rings can be found in the data base, accessible by, say, `CohomologyRing(8,3)`.\n\nHowever, the factory `CohomologyRing` would first try to find the result in the cache, before accessing the data base on disk or in internet. Hence, it will return the degree-zero approximation of the ring. This explains why you got\n\n```\n45\t    print H0\n46\tExpected:\n47\t    Cohomology ring of Dihedral group of order 8 with coefficients in GF(2)\n48\t    <BLANKLINE>\n49\t    Computation complete\n50\t    Minimal list of generators:\n51\t    [c_2_2: 2-Cocycle in H^*(D8; GF(2)),\n52\t     b_1_0: 1-Cocycle in H^*(D8; GF(2)),\n53\t     b_1_1: 1-Cocycle in H^*(D8; GF(2))]\n54\t    Minimal list of algebraic relations:\n55\t    [b_1_0*b_1_1]\n56\tGot:\n57\t    <BLANKLINE>\n58\t    Cohomology ring of Dihedral group of order 8 with coefficients in GF(2)\n59\t    <BLANKLINE>\n60\t    Computed up to degree 0\n61\t    Minimal list of generators:\n62\t    []\n63\t    Minimal list of algebraic relations:\n64\t    []\n65\t    <BLANKLINE>\n66\t\n```\n",
    "created_at": "2013-04-27T10:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180143",
    "user": "SimonKing"
}
```

Replying to [comment:21 vbraun]:
> I still get the `from_scratch=True` error, and its completely reproducible. Installation works fine (and the doctests that actually perform computations seem to be working, too). I'll attach a more complete log.

Aha, now I think I understand what is happening!

The output looks as if you did not run the test suite (by `export SAGE_CHECK=yes` before installing the package), but you did run `sage -t` on the source files (or on their copies in local/lib/python/site-packages).

The test suite considers each doc string separately. Hence, it recursively finds out which modules, classes functions and methods are defined, extracts the doc of one item after the other, each time writing one doc string into a temporary file, and running sage -t on this temporary file. But it is *not* supposed to run sage -t on, say, `pGroupcCohomology/factory.py`.

Reason: The doc tests are supposed to demonstrate how the different sub-problems of cohomology computations are done. Hence, in the vast majority of cases, we want a computation from scratch. But if the first test puts a result into the cache, then the second test might be disturbed.

Example: One test creates the computational set-up for the cohomology of the `SmallGroup(8,3)` (that's the dihedral group) from scratch, but does *not* complete the computation. This test will create an item in the cache that is only computed out to degree zero. Another test might then demonstrate that some *completely* computed cohomology rings can be found in the data base, accessible by, say, `CohomologyRing(8,3)`.

However, the factory `CohomologyRing` would first try to find the result in the cache, before accessing the data base on disk or in internet. Hence, it will return the degree-zero approximation of the ring. This explains why you got

```
45	    print H0
46	Expected:
47	    Cohomology ring of Dihedral group of order 8 with coefficients in GF(2)
48	    <BLANKLINE>
49	    Computation complete
50	    Minimal list of generators:
51	    [c_2_2: 2-Cocycle in H^*(D8; GF(2)),
52	     b_1_0: 1-Cocycle in H^*(D8; GF(2)),
53	     b_1_1: 1-Cocycle in H^*(D8; GF(2))]
54	    Minimal list of algebraic relations:
55	    [b_1_0*b_1_1]
56	Got:
57	    <BLANKLINE>
58	    Cohomology ring of Dihedral group of order 8 with coefficients in GF(2)
59	    <BLANKLINE>
60	    Computed up to degree 0
61	    Minimal list of generators:
62	    []
63	    Minimal list of algebraic relations:
64	    []
65	    <BLANKLINE>
66	
```




---

archive/issue_comments_180144.json:
```json
{
    "body": "Replying to [comment:22 SimonKing]:\n> The test suite considers each doc string separately. Hence, it recursively finds out which modules, classes functions and methods are defined, extracts the doc of one item after the other, each time writing one doc string into a temporary file, and running sage -t on this temporary file.\n\nPS: And it would complain if a function or a method has no doc string or no test in the doc string or a test that does not contain the name of the function/method.",
    "created_at": "2013-04-27T10:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180144",
    "user": "SimonKing"
}
```

Replying to [comment:22 SimonKing]:
> The test suite considers each doc string separately. Hence, it recursively finds out which modules, classes functions and methods are defined, extracts the doc of one item after the other, each time writing one doc string into a temporary file, and running sage -t on this temporary file.

PS: And it would complain if a function or a method has no doc string or no test in the doc string or a test that does not contain the name of the function/method.



---

archive/issue_comments_180145.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-27T11:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180145",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_180146.json:
```json
{
    "body": "Fair enough. If you want to merge this into the sage library at one point then the doctests will have to run independently, but I guess that'll still take some time.",
    "created_at": "2013-04-27T11:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180146",
    "user": "vbraun"
}
```

Fair enough. If you want to merge this into the sage library at one point then the doctests will have to run independently, but I guess that'll still take some time.



---

archive/issue_comments_180147.json:
```json
{
    "body": "Replying to [comment:24 vbraun]:\n> Fair enough. If you want to merge this into the sage library at one point then the doctests will have to run independently, but I guess that'll still take some time.\n\nIt can not be part of the sage library, since it strongly depends on the Small Groups library, which can only be in an optional package, since it is not GPL.\n\nBut before you set it to positive review: Could you see if my spkg-install script is correct? As I have stated above, it happened to me (in preliminary versions) that there was a compilation error, but the installation script happily unpacked the data base and finished by claiming that installation of the package was successful.",
    "created_at": "2013-04-27T11:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180147",
    "user": "SimonKing"
}
```

Replying to [comment:24 vbraun]:
> Fair enough. If you want to merge this into the sage library at one point then the doctests will have to run independently, but I guess that'll still take some time.

It can not be part of the sage library, since it strongly depends on the Small Groups library, which can only be in an optional package, since it is not GPL.

But before you set it to positive review: Could you see if my spkg-install script is correct? As I have stated above, it happened to me (in preliminary versions) that there was a compilation error, but the installation script happily unpacked the data base and finished by claiming that installation of the package was successful.



---

archive/issue_comments_180148.json:
```json
{
    "body": "Do you actually need anything fancy from the SGL or just the list of the first N groups? I'm getting more annoyed about this stupid licensing issue, so I'll probably write a GPL replacement at one point ;-)\n\nThe `spkg_install` looks good to me.",
    "created_at": "2013-04-28T11:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180148",
    "user": "vbraun"
}
```

Do you actually need anything fancy from the SGL or just the list of the first N groups? I'm getting more annoyed about this stupid licensing issue, so I'll probably write a GPL replacement at one point ;-)

The `spkg_install` looks good to me.



---

archive/issue_comments_180149.json:
```json
{
    "body": "Replying to [comment:26 vbraun]:\n> Do you actually need anything fancy from the SGL or just the list of the first N groups?\n\nI guess the main reason for using it is: Get a concise identifier of a group with a fixed set of generators.\n\nIf I want to know the cohomology of a group G, then I need to consider restrictions to \"interesting\" subgroups: Maximal p-elementary abelian subgroups; Sylow p-subgroup; normalizer in G of the centre of a Sylow p-subgroup; intersection of two conjugates of a Sylow p-subgroup; ...\n\nIf I know the small groups library address of the interesting group, then I can easily look up in my data base whether the cohomology of this particular group has already been computed. Otherwise, I needed to compute the cohomology of multiple isomorphic copies of one group repeatedly.\n\nMathematically, it would of course be possible to lift the dependency on the small groups library. In fact, if the address in the small groups library can not be found, then a \"descriptive\" name (that describes the construction of this group) is chosen to access the data base. So, in these cases, my code is independent of the small groups libary.\n\nMaking it totally independent would require...\n* to rewrite a couple of constructions; this would, in particular, be needed if the use of the small groups library should become optional.\n* to totally rewrite the code that accesses my data bases; but actually I would like to use a \"real\" data base (sql?), so that rewriting will sooner or later be needed anyway.\n* to rewrite almost *all* doctests. Since all functions and methods are tested, this would be a long and very annoying task.\n\n> The `spkg_install` looks good to me.\n\nSo, there is no reason why I saw it happily continue to install the package after a compilation error? Strange.",
    "created_at": "2013-04-28T12:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180149",
    "user": "SimonKing"
}
```

Replying to [comment:26 vbraun]:
> Do you actually need anything fancy from the SGL or just the list of the first N groups?

I guess the main reason for using it is: Get a concise identifier of a group with a fixed set of generators.

If I want to know the cohomology of a group G, then I need to consider restrictions to "interesting" subgroups: Maximal p-elementary abelian subgroups; Sylow p-subgroup; normalizer in G of the centre of a Sylow p-subgroup; intersection of two conjugates of a Sylow p-subgroup; ...

If I know the small groups library address of the interesting group, then I can easily look up in my data base whether the cohomology of this particular group has already been computed. Otherwise, I needed to compute the cohomology of multiple isomorphic copies of one group repeatedly.

Mathematically, it would of course be possible to lift the dependency on the small groups library. In fact, if the address in the small groups library can not be found, then a "descriptive" name (that describes the construction of this group) is chosen to access the data base. So, in these cases, my code is independent of the small groups libary.

Making it totally independent would require...
* to rewrite a couple of constructions; this would, in particular, be needed if the use of the small groups library should become optional.
* to totally rewrite the code that accesses my data bases; but actually I would like to use a "real" data base (sql?), so that rewriting will sooner or later be needed anyway.
* to rewrite almost *all* doctests. Since all functions and methods are tested, this would be a long and very annoying task.

> The `spkg_install` looks good to me.

So, there is no reason why I saw it happily continue to install the package after a compilation error? Strange.



---

archive/issue_comments_180150.json:
```json
{
    "body": "The `spkg_install` seems to handle errors. If you had the log then we could investigate further ;-)",
    "created_at": "2013-04-28T14:18:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180150",
    "user": "vbraun"
}
```

The `spkg_install` seems to handle errors. If you had the log then we could investigate further ;-)



---

archive/issue_comments_180151.json:
```json
{
    "body": "For the following test, I added the command \"bla\" into cohomology.pyx, right after \"import os\". The attempt to install the resulting spkg was reported to be successful, even though of course there is an error:\n\n```\n...\ngcc -pthread -shared -L/home/simon/SAGE/prerelease/sage-5.9.rc0/local/lib build/temp.linux-x86_64-2.7/pGroupCohomology/resolution.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/aufloesung.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/aufnahme.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/djgerr.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/fileplus.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/nBuchberger.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/pgroup.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/pincl.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/slice.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/urbild.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/uvr.o -L/home/simon/SAGE/prerelease/sage-5.9.rc0/local/lib -lmtx -lcsage -lpython2.7 -o build/lib.linux-x86_64-2.7/pGroupCohomology/resolution.so\ncythoning pGroupCohomology/cohomology.pyx to pGroupCohomology/cohomology.c\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n\n###########################################################\n## Imports\n\nimport os\nbla\n  ^\n------------------------------------------------------------\n\npGroupCohomology/cohomology.pyx:44:3: undeclared name not builtin: bla\nbuilding 'pGroupCohomology.cohomology' extension\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/home/simon/SAGE/prerelease/sage-5.9.rc0/local/include/csage -I/home/simon/SAGE/prerelease/sage-5.9.rc0/devel/sage -Imtx2.2.4/src -IpGroupCohomology/c_sources -IpGroupCohomology -I/home/simon/SAGE/prerelease/sage-5.9.rc0/local/include/python2.7 -c pGroupCohomology/cohomology.c -o build/temp.linux-x86_64-2.7/pGroupCohomology/cohomology.o\npGroupCohomology/cohomology.c:1:2: error: #error Do not use this file, it is the result of a failed Cython compilation.\nerror: command 'gcc' failed with exit status 1\n\nreal    0m51.516s\nuser    0m18.015s\nsys     0m3.186s\nSuccessfully installed p_group_cohomology-2.1.4\nDeleting temporary build directory\n```\n\nSo, perhaps this is not a problem of my script but a problem of the script of Sage that is called by \"sage -i\".",
    "created_at": "2013-04-28T16:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180151",
    "user": "SimonKing"
}
```

For the following test, I added the command "bla" into cohomology.pyx, right after "import os". The attempt to install the resulting spkg was reported to be successful, even though of course there is an error:

```
...
gcc -pthread -shared -L/home/simon/SAGE/prerelease/sage-5.9.rc0/local/lib build/temp.linux-x86_64-2.7/pGroupCohomology/resolution.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/aufloesung.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/aufnahme.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/djgerr.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/fileplus.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/nBuchberger.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/pgroup.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/pincl.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/slice.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/urbild.o build/temp.linux-x86_64-2.7/pGroupCohomology/c_sources/uvr.o -L/home/simon/SAGE/prerelease/sage-5.9.rc0/local/lib -lmtx -lcsage -lpython2.7 -o build/lib.linux-x86_64-2.7/pGroupCohomology/resolution.so
cythoning pGroupCohomology/cohomology.pyx to pGroupCohomology/cohomology.c

Error compiling Cython file:
------------------------------------------------------------
...

###########################################################
## Imports

import os
bla
  ^
------------------------------------------------------------

pGroupCohomology/cohomology.pyx:44:3: undeclared name not builtin: bla
building 'pGroupCohomology.cohomology' extension
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/home/simon/SAGE/prerelease/sage-5.9.rc0/local/include/csage -I/home/simon/SAGE/prerelease/sage-5.9.rc0/devel/sage -Imtx2.2.4/src -IpGroupCohomology/c_sources -IpGroupCohomology -I/home/simon/SAGE/prerelease/sage-5.9.rc0/local/include/python2.7 -c pGroupCohomology/cohomology.c -o build/temp.linux-x86_64-2.7/pGroupCohomology/cohomology.o
pGroupCohomology/cohomology.c:1:2: error: #error Do not use this file, it is the result of a failed Cython compilation.
error: command 'gcc' failed with exit status 1

real    0m51.516s
user    0m18.015s
sys     0m3.186s
Successfully installed p_group_cohomology-2.1.4
Deleting temporary build directory
```

So, perhaps this is not a problem of my script but a problem of the script of Sage that is called by "sage -i".



---

archive/issue_comments_180152.json:
```json
{
    "body": "Instead of setting `$MAKE` to `make` (which you should **never** do), build with `$MAKE -j1`:\n\n```\n$MAKE -j1\nif [ $? -ne 0 ]; then\n   echo \"Error building pGroupCohomology.\"\n   exit 1\nfi\n\n$MAKE -j1 install\nif [ $? -ne 0 ]; then\n   echo \"Error installing pGroupCohomology.\"\n   exit 1\nfi\n```\n",
    "created_at": "2013-04-29T11:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180152",
    "user": "jdemeyer"
}
```

Instead of setting `$MAKE` to `make` (which you should **never** do), build with `$MAKE -j1`:

```
$MAKE -j1
if [ $? -ne 0 ]; then
   echo "Error building pGroupCohomology."
   exit 1
fi

$MAKE -j1 install
if [ $? -ne 0 ]; then
   echo "Error installing pGroupCohomology."
   exit 1
fi
```




---

archive/issue_comments_180153.json:
```json
{
    "body": "There is no error check for\n\n```\npython setup.py install\n```\n\nPerhaps this is why success is reported if Cython fails?",
    "created_at": "2013-04-29T11:55:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180153",
    "user": "jdemeyer"
}
```

There is no error check for

```
python setup.py install
```

Perhaps this is why success is reported if Cython fails?



---

archive/issue_comments_180154.json:
```json
{
    "body": "Replying to [comment:28 vbraun]:\n> If you had the log then we could investigate further ;-) \nStill no full log has been reported...",
    "created_at": "2013-04-29T12:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180154",
    "user": "jdemeyer"
}
```

Replying to [comment:28 vbraun]:
> If you had the log then we could investigate further ;-) 
Still no full log has been reported...



---

archive/issue_comments_180155.json:
```json
{
    "body": "Also: please try with sage-5.9.rc0 or later, since that includes a new version of Cython (#14452).",
    "created_at": "2013-04-29T12:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180155",
    "user": "jdemeyer"
}
```

Also: please try with sage-5.9.rc0 or later, since that includes a new version of Cython (#14452).



---

archive/issue_comments_180156.json:
```json
{
    "body": "Replying to [comment:32 jdemeyer]:\n> Replying to [comment:28 vbraun]:\n> > If you had the log then we could investigate further ;-) \n> Still no full log has been reported...\n\nThe part that failed has been reported.",
    "created_at": "2013-04-29T12:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180156",
    "user": "SimonKing"
}
```

Replying to [comment:32 jdemeyer]:
> Replying to [comment:28 vbraun]:
> > If you had the log then we could investigate further ;-) 
> Still no full log has been reported...

The part that failed has been reported.



---

archive/issue_comments_180157.json:
```json
{
    "body": "Replying to [comment:33 jdemeyer]:\n> Also: please try with sage-5.9.rc0 or later, since that includes a new version of Cython (#14452).\n\nIt was with sage-5.9.rc0",
    "created_at": "2013-04-29T12:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180157",
    "user": "SimonKing"
}
```

Replying to [comment:33 jdemeyer]:
> Also: please try with sage-5.9.rc0 or later, since that includes a new version of Cython (#14452).

It was with sage-5.9.rc0



---

archive/issue_comments_180158.json:
```json
{
    "body": "Replying to [comment:34 SimonKing]:\n> The part that failed has been reported.\nI agree, but never underestimate the amount of useful information thrown away when posting only part of a log file.",
    "created_at": "2013-04-29T12:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180158",
    "user": "jdemeyer"
}
```

Replying to [comment:34 SimonKing]:
> The part that failed has been reported.
I agree, but never underestimate the amount of useful information thrown away when posting only part of a log file.



---

archive/issue_comments_180159.json:
```json
{
    "body": "Replying to [comment:31 jdemeyer]:\n> There is no error check for\n> {{{\n> python setup.py install\n> }}}\n> Perhaps this is why success is reported if Cython fails?\n\nI thought this could be it. However, if I put the following into an spkg, then the error is correctly reported, even though the exit code of setup.py is not checked:\n\nspkg-install:\n\n```/usr/bin/env bash\n\nif [ \"$SAGE_LOCAL\" = \"\" ]; then\n   echo \"SAGE_LOCAL undefined ... exiting\";\n   echo \"Maybe run 'sage -sh'?\"\n   exit 1\nfi\n\n# test whether we are on an intel mac\nif [ `uname` = \"Darwin\" -a \"$SAGE64\" = \"yes\" ]; then\n   echo \"64 bit MacIntel\"\n   DARWIN64=-m64; export DARWIN64;\nelse\n   DARWIN64=\"\"; export DARWIN64;\nfi\n\ncd src\n\nDISTUTILS_DEBUG='debug'\npython setup.py install\n```\n\nsrc/setup.py\n\n```python\nfrom distutils.core import setup\nfrom distutils.extension import Extension\nfrom Cython.Distutils import build_ext\n\nimport shutil\nimport os\nimport subprocess\n\nsetup(\n  name = \"bad\",\n  version = \"0.0\",\n  author = \"Simon A. King\",\n  author_email = \"simon.king@uni-jena.de\",\n  maintainer = \"Simon A. King\", \n  maintainer_email = \"simon.king@uni-jena.de\",\n  description = \"A bad example\",\n  ext_modules=[ \n    Extension(\"bad\",\n              sources = [\"bad.pyx\"],\n              ),\n  ],\n  cmdclass = {'build_ext': build_ext}\n)\n```\n\nsrc/bad.pyx\n\n```python\nimport os\nbad\n```\n\n\nIf I remove the last line of src/bad.pyx, then the mock package does install, and I can then do\n\n```\nsage: from bad import os\n```\n",
    "created_at": "2013-04-29T12:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180159",
    "user": "SimonKing"
}
```

Replying to [comment:31 jdemeyer]:
> There is no error check for
> {{{
> python setup.py install
> }}}
> Perhaps this is why success is reported if Cython fails?

I thought this could be it. However, if I put the following into an spkg, then the error is correctly reported, even though the exit code of setup.py is not checked:

spkg-install:

```/usr/bin/env bash

if [ "$SAGE_LOCAL" = "" ]; then
   echo "SAGE_LOCAL undefined ... exiting";
   echo "Maybe run 'sage -sh'?"
   exit 1
fi

# test whether we are on an intel mac
if [ `uname` = "Darwin" -a "$SAGE64" = "yes" ]; then
   echo "64 bit MacIntel"
   DARWIN64=-m64; export DARWIN64;
else
   DARWIN64=""; export DARWIN64;
fi

cd src

DISTUTILS_DEBUG='debug'
python setup.py install
```

src/setup.py

```python
from distutils.core import setup
from distutils.extension import Extension
from Cython.Distutils import build_ext

import shutil
import os
import subprocess

setup(
  name = "bad",
  version = "0.0",
  author = "Simon A. King",
  author_email = "simon.king@uni-jena.de",
  maintainer = "Simon A. King", 
  maintainer_email = "simon.king@uni-jena.de",
  description = "A bad example",
  ext_modules=[ 
    Extension("bad",
              sources = ["bad.pyx"],
              ),
  ],
  cmdclass = {'build_ext': build_ext}
)
```

src/bad.pyx

```python
import os
bad
```


If I remove the last line of src/bad.pyx, then the mock package does install, and I can then do

```
sage: from bad import os
```




---

archive/issue_comments_180160.json:
```json
{
    "body": "Replying to [comment:37 SimonKing]:\n> even though the exit code of setup.py is not checked.\nThe exit code is checked implicitly in `spkg/bin/sage-spkg` because it's simply the last command in the script. Try putting `echo Hello` or something after `python setup.py install` to see the difference.",
    "created_at": "2013-04-29T12:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180160",
    "user": "jdemeyer"
}
```

Replying to [comment:37 SimonKing]:
> even though the exit code of setup.py is not checked.
The exit code is checked implicitly in `spkg/bin/sage-spkg` because it's simply the last command in the script. Try putting `echo Hello` or something after `python setup.py install` to see the difference.



---

archive/issue_comments_180161.json:
```json
{
    "body": "Something else: the line\n\n```\nDISTUTILS_DEBUG='debug'\n```\n\nhas no effect since the variable `DISTUTILS_DEBUG` is not exported.",
    "created_at": "2013-04-29T12:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180161",
    "user": "jdemeyer"
}
```

Something else: the line

```
DISTUTILS_DEBUG='debug'
```

has no effect since the variable `DISTUTILS_DEBUG` is not exported.



---

archive/issue_comments_180162.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-04-29T12:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180162",
    "user": "SimonKing"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_180163.json:
```json
{
    "body": "Replying to [comment:38 jdemeyer]:\n> Replying to [comment:37 SimonKing]:\n> > even though the exit code of setup.py is not checked.\n> The exit code is checked implicitly in `spkg/bin/sage-spkg` because it's simply the last command in the script. Try putting `echo Hello` or something after `python setup.py install` to see the difference.\n\nGreat, that's it!\n\nSo, I put it to \"needs work\" until I fixed it.",
    "created_at": "2013-04-29T12:43:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180163",
    "user": "SimonKing"
}
```

Replying to [comment:38 jdemeyer]:
> Replying to [comment:37 SimonKing]:
> > even though the exit code of setup.py is not checked.
> The exit code is checked implicitly in `spkg/bin/sage-spkg` because it's simply the last command in the script. Try putting `echo Hello` or something after `python setup.py install` to see the difference.

Great, that's it!

So, I put it to "needs work" until I fixed it.



---

archive/issue_comments_180164.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-04-29T12:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180164",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_180165.json:
```json
{
    "body": "OK, should be fixed now.",
    "created_at": "2013-04-29T12:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180165",
    "user": "SimonKing"
}
```

OK, should be fixed now.



---

archive/issue_comments_180166.json:
```json
{
    "body": "\"Should be fixed\" means: When I broke the code on purpose, then it correctly failed to install. I am now trying to install the unbroken spkg again.",
    "created_at": "2013-04-29T12:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180166",
    "user": "SimonKing"
}
```

"Should be fixed" means: When I broke the code on purpose, then it correctly failed to install. I am now trying to install the unbroken spkg again.



---

archive/issue_comments_180167.json:
```json
{
    "body": "I wouldn't like to revert the status to \"positive review\" myself. Could someone see if the potential trouble with spkg-install has been fixed?",
    "created_at": "2013-05-06T07:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180167",
    "user": "SimonKing"
}
```

I wouldn't like to revert the status to "positive review" myself. Could someone see if the potential trouble with spkg-install has been fixed?



---

archive/issue_comments_180168.json:
```json
{
    "body": "The error checking looks good.\n\nYou might want to add some stuff (like `doc/`) to `.hgignore`. Also, you probably don't want to keep `spkg-check.orig` around.",
    "created_at": "2013-05-06T15:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180168",
    "user": "vbraun"
}
```

The error checking looks good.

You might want to add some stuff (like `doc/`) to `.hgignore`. Also, you probably don't want to keep `spkg-check.orig` around.



---

archive/issue_comments_180169.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-06T15:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180169",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_180170.json:
```json
{
    "body": "There is a lot of garbage in the spkg (check out `hg status`).\n\nIn `spkg-install`, there is still the messing with `$MAKE` and this redundant line:\n\n```\nDISTUTILS_DEBUG='debug'\n```\n",
    "created_at": "2013-05-06T15:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180170",
    "user": "jdemeyer"
}
```

There is a lot of garbage in the spkg (check out `hg status`).

In `spkg-install`, there is still the messing with `$MAKE` and this redundant line:

```
DISTUTILS_DEBUG='debug'
```




---

archive/issue_comments_180171.json:
```json
{
    "body": "As John mentioned, replace\n\n```\nNCPUS = os.environ.get('SAGE_NUMBER_THREADS')\nif not NCPUS:\n    NCPUS = int(multiprocessing.cpu_count()/3)+1\nelse:\n    try:\n        NCPUS = int(NCPUS)\n    except:\n        NCPUS = int(multiprocessing.cpu_count()/3)+1\n```\n\nby\n\n```\nNCPUS = int(os.environ.get('SAGE_NUM_THREADS', 1))\n```\n\nand adjust the documentation accordingly.",
    "created_at": "2013-05-06T15:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180171",
    "user": "jdemeyer"
}
```

As John mentioned, replace

```
NCPUS = os.environ.get('SAGE_NUMBER_THREADS')
if not NCPUS:
    NCPUS = int(multiprocessing.cpu_count()/3)+1
else:
    try:
        NCPUS = int(NCPUS)
    except:
        NCPUS = int(multiprocessing.cpu_count()/3)+1
```

by

```
NCPUS = int(os.environ.get('SAGE_NUM_THREADS', 1))
```

and adjust the documentation accordingly.



---

archive/issue_comments_180172.json:
```json
{
    "body": "It seems to me that `spkg-check` is essentially reinventing the doctest framework. Why aren't you using the standard Sage doctest framework?",
    "created_at": "2013-05-06T15:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180172",
    "user": "jdemeyer"
}
```

It seems to me that `spkg-check` is essentially reinventing the doctest framework. Why aren't you using the standard Sage doctest framework?



---

archive/issue_comments_180173.json:
```json
{
    "body": "In `spkg-install`, replace\n\n```\n$SAGE_ROOT/sage -gap\n```\n\nby\n\n```\ngap\n```\n",
    "created_at": "2013-05-06T15:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180173",
    "user": "jdemeyer"
}
```

In `spkg-install`, replace

```
$SAGE_ROOT/sage -gap
```

by

```
gap
```




---

archive/issue_comments_180174.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> There is a lot of garbage in the spkg (check out `hg status`).\n\nReally??? Actually I already wondered about Volker's comment about spkg-check.orig. Anyway, I just posted a version that should be garbage free.\n\n> In `spkg-install`, there is still the messing with `$MAKE`\n\nYou mean: Defining `MAKE` temporarily as `make`? How should it be done to temporarily disallow `make -jN` with `N>1`?\n\n> and this redundant line:\n> {{{\n> DISTUTILS_DEBUG='debug'\n> }}}\n\nSo, I can remove it? Actually I can't recall where I copied this line from (probably it came from another spkg...)",
    "created_at": "2013-05-06T15:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180174",
    "user": "SimonKing"
}
```

Replying to [comment:45 jdemeyer]:
> There is a lot of garbage in the spkg (check out `hg status`).

Really??? Actually I already wondered about Volker's comment about spkg-check.orig. Anyway, I just posted a version that should be garbage free.

> In `spkg-install`, there is still the messing with `$MAKE`

You mean: Defining `MAKE` temporarily as `make`? How should it be done to temporarily disallow `make -jN` with `N>1`?

> and this redundant line:
> {{{
> DISTUTILS_DEBUG='debug'
> }}}

So, I can remove it? Actually I can't recall where I copied this line from (probably it came from another spkg...)



---

archive/issue_comments_180175.json:
```json
{
    "body": "Replying to [comment:46 jdemeyer]:\n> As John mentioned, replace\n> {{{\n> NCPUS = os.environ.get('SAGE_NUMBER_THREADS')\n> if not NCPUS:\n>     NCPUS = int(multiprocessing.cpu_count()/3)+1\n> else:\n>     try:\n>         NCPUS = int(NCPUS)\n>     except:\n>         NCPUS = int(multiprocessing.cpu_count()/3)+1\n> }}}\n> by\n> {{{\n> NCPUS = int(os.environ.get('SAGE_NUM_THREADS', 1))\n> }}}\n> and adjust the documentation accordingly.\n\nBut I did!!! Very strange.",
    "created_at": "2013-05-06T15:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180175",
    "user": "SimonKing"
}
```

Replying to [comment:46 jdemeyer]:
> As John mentioned, replace
> {{{
> NCPUS = os.environ.get('SAGE_NUMBER_THREADS')
> if not NCPUS:
>     NCPUS = int(multiprocessing.cpu_count()/3)+1
> else:
>     try:
>         NCPUS = int(NCPUS)
>     except:
>         NCPUS = int(multiprocessing.cpu_count()/3)+1
> }}}
> by
> {{{
> NCPUS = int(os.environ.get('SAGE_NUM_THREADS', 1))
> }}}
> and adjust the documentation accordingly.

But I did!!! Very strange.



---

archive/issue_comments_180176.json:
```json
{
    "body": "What's the point of the empty directories\n\n```\nsrc/lib\nsrc/bin\n```\n\n\nIf they are truly required in the spkg, at least remove them from `.hgignore` (you probably want to ship them empty!)",
    "created_at": "2013-05-06T15:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180176",
    "user": "jdemeyer"
}
```

What's the point of the empty directories

```
src/lib
src/bin
```


If they are truly required in the spkg, at least remove them from `.hgignore` (you probably want to ship them empty!)



---

archive/issue_comments_180177.json:
```json
{
    "body": "OK, I see `SAGE_NUM_THREADS` now in `spkg-check`. Still, you could replace\n\n```\nNCPUS = os.environ.get('SAGE_NUM_THREADS')\nif not NCPUS:\n    NCPUS = int(multiprocessing.cpu_count()/3)+1\nelse:\n    try:\n        NCPUS = int(NCPUS)\n    except:\n        NCPUS = int(multiprocessing.cpu_count()/3)+1\n```\n\nby the one-liner\n\n```\nNCPUS = int(os.environ.get('SAGE_NUM_THREADS', 1))\n```\n\n\n(or replace the whole file by a call to the doctest framework).",
    "created_at": "2013-05-06T15:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180177",
    "user": "jdemeyer"
}
```

OK, I see `SAGE_NUM_THREADS` now in `spkg-check`. Still, you could replace

```
NCPUS = os.environ.get('SAGE_NUM_THREADS')
if not NCPUS:
    NCPUS = int(multiprocessing.cpu_count()/3)+1
else:
    try:
        NCPUS = int(NCPUS)
    except:
        NCPUS = int(multiprocessing.cpu_count()/3)+1
```

by the one-liner

```
NCPUS = int(os.environ.get('SAGE_NUM_THREADS', 1))
```


(or replace the whole file by a call to the doctest framework).



---

archive/issue_comments_180178.json:
```json
{
    "body": "Replying to [comment:49 SimonKing]:\n\n> Really??? Actually I already wondered about Volker's comment about spkg-check.orig. Anyway, I just posted a version that should be garbage free.\nProbably you posted the wrong version last time.\n\n> You mean: Defining `MAKE` temporarily as `make`? How should it be done to temporarily disallow `make -jN` with `N>1`?\nReplace\n\n```\n# MeatAxe would fail to build parallely. Therefore, although it is probably bad style:\nOLD_MAKE=\"$MAKE\";\nMAKE=make; export MAKE;\n\ncd src\n\n$MAKE\nif [ $? -ne 0 ]; then\n   echo \"Error building pGroupCohomology.\"\n   exit 1\nfi\n\n$MAKE install\nif [ $? -ne 0 ]; then\n   echo \"Error installing pGroupCohomology.\"\n   exit 1\nfi\n\n#rm pGroupCohomology/*.c\nMAKE=\"$OLDMAKE\"; export MAKE;\n```\n\nby\n\n```\ncd src\n\n# MeatAxe fails to build in parallel, so we build with only 1 thread:\n$MAKE -j1\nif [ $? -ne 0 ]; then\n   echo \"Error building pGroupCohomology.\"\n   exit 1\nfi\n\n$MAKE -j1 install\nif [ $? -ne 0 ]; then\n   echo \"Error installing pGroupCohomology.\"\n   exit 1\nfi\n```\n\n\n> > and this redundant line:\n> > {{{\n> > DISTUTILS_DEBUG='debug'\n> > }}}\n> \n> So, I can remove it?\nYes, it doesn't do anything since the variable isn't exported.",
    "created_at": "2013-05-06T15:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180178",
    "user": "jdemeyer"
}
```

Replying to [comment:49 SimonKing]:

> Really??? Actually I already wondered about Volker's comment about spkg-check.orig. Anyway, I just posted a version that should be garbage free.
Probably you posted the wrong version last time.

> You mean: Defining `MAKE` temporarily as `make`? How should it be done to temporarily disallow `make -jN` with `N>1`?
Replace

```
# MeatAxe would fail to build parallely. Therefore, although it is probably bad style:
OLD_MAKE="$MAKE";
MAKE=make; export MAKE;

cd src

$MAKE
if [ $? -ne 0 ]; then
   echo "Error building pGroupCohomology."
   exit 1
fi

$MAKE install
if [ $? -ne 0 ]; then
   echo "Error installing pGroupCohomology."
   exit 1
fi

#rm pGroupCohomology/*.c
MAKE="$OLDMAKE"; export MAKE;
```

by

```
cd src

# MeatAxe fails to build in parallel, so we build with only 1 thread:
$MAKE -j1
if [ $? -ne 0 ]; then
   echo "Error building pGroupCohomology."
   exit 1
fi

$MAKE -j1 install
if [ $? -ne 0 ]; then
   echo "Error installing pGroupCohomology."
   exit 1
fi
```


> > and this redundant line:
> > {{{
> > DISTUTILS_DEBUG='debug'
> > }}}
> 
> So, I can remove it?
Yes, it doesn't do anything since the variable isn't exported.



---

archive/issue_comments_180179.json:
```json
{
    "body": "Replying to [comment:47 jdemeyer]:\n> It seems to me that `spkg-check` is essentially reinventing the doctest framework. Why aren't you using the standard Sage doctest framework?\n\nOriginally, my main reason has been to run the tests on a per-method basis, not on a per-file basis. This concerns\n- running tests in parallel, \n- the summary of test failures (I would like that the test suite ends with a list of methods whose tests fail or which appear not to be tested)\n- execution time for each test\n\nAlso I originally wanted to work around some bugs in the sage-coverage script: Sometimes the coverage script could not correctly determine the functions defined in a module.\n\nIt could be that in the last three years the doctest and coverage framework of Sage has improved.",
    "created_at": "2013-05-06T15:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180179",
    "user": "SimonKing"
}
```

Replying to [comment:47 jdemeyer]:
> It seems to me that `spkg-check` is essentially reinventing the doctest framework. Why aren't you using the standard Sage doctest framework?

Originally, my main reason has been to run the tests on a per-method basis, not on a per-file basis. This concerns
- running tests in parallel, 
- the summary of test failures (I would like that the test suite ends with a list of methods whose tests fail or which appear not to be tested)
- execution time for each test

Also I originally wanted to work around some bugs in the sage-coverage script: Sometimes the coverage script could not correctly determine the functions defined in a module.

It could be that in the last three years the doctest and coverage framework of Sage has improved.



---

archive/issue_comments_180180.json:
```json
{
    "body": "I don't know why, but when I try to implement your suggestions, the package installation totally breaks :/",
    "created_at": "2013-05-06T16:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180180",
    "user": "SimonKing"
}
```

I don't know why, but when I try to implement your suggestions, the package installation totally breaks :/



---

archive/issue_comments_180181.json:
```json
{
    "body": "I just tested: Meataxe does not build with `MAKE=\"make -j2`, even if you then say `$MAKE -j1`. Apparently, `$MAKE` is called internally, in some of the makefiles of `MeatAxe`. Since I patch these makefiles, it could be that I am to blame...",
    "created_at": "2013-05-06T16:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180181",
    "user": "SimonKing"
}
```

I just tested: Meataxe does not build with `MAKE="make -j2`, even if you then say `$MAKE -j1`. Apparently, `$MAKE` is called internally, in some of the makefiles of `MeatAxe`. Since I patch these makefiles, it could be that I am to blame...



---

archive/issue_comments_180182.json:
```json
{
    "body": "ARRGH! I call `$MAKE` in src/Makefile. So, forbidding to build in parallel should be done there.",
    "created_at": "2013-05-06T16:24:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180182",
    "user": "SimonKing"
}
```

ARRGH! I call `$MAKE` in src/Makefile. So, forbidding to build in parallel should be done there.



---

archive/issue_comments_180183.json:
```json
{
    "body": "Replying to [comment:57 SimonKing]:\n> ARRGH! I call `$MAKE` in src/Makefile.\nIn that case, there is a simple solution: change the `Makefile` to use\n\n```\n$(MAKE) -j1 ...\n```\n",
    "created_at": "2013-05-07T06:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180183",
    "user": "jdemeyer"
}
```

Replying to [comment:57 SimonKing]:
> ARRGH! I call `$MAKE` in src/Makefile.
In that case, there is a simple solution: change the `Makefile` to use

```
$(MAKE) -j1 ...
```




---

archive/issue_comments_180184.json:
```json
{
    "body": "Replying to [comment:54 SimonKing]:\n> It could be that in the last three years the doctest and coverage framework of Sage has improved.\nThey certainly did. I think everything in your list now works correctly, except for the per-method testing and modulo the fact that doctests and coverage are a different script.\n\nI least I understand your motivation now, perhaps you should document this in the `spkg-check` file (\"for historical reasons, this reimplements part of the doctest and coverage scripts, but these could (should?) be replaced by calls to the standard doctest and coverage frameworks.\")",
    "created_at": "2013-05-07T06:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180184",
    "user": "jdemeyer"
}
```

Replying to [comment:54 SimonKing]:
> It could be that in the last three years the doctest and coverage framework of Sage has improved.
They certainly did. I think everything in your list now works correctly, except for the per-method testing and modulo the fact that doctests and coverage are a different script.

I least I understand your motivation now, perhaps you should document this in the `spkg-check` file ("for historical reasons, this reimplements part of the doctest and coverage scripts, but these could (should?) be replaced by calls to the standard doctest and coverage frameworks.")



---

archive/issue_comments_180185.json:
```json
{
    "body": "Replying to [comment:58 jdemeyer]:\n> Replying to [comment:57 SimonKing]:\n> > ARRGH! I call `$MAKE` in src/Makefile.\n> In that case, there is a simple solution: change the `Makefile` to use\n> {{{\n> $(MAKE) -j1 ...\n> }}}\n\nI wish it were so easy... I tried this yesterday, but it didn't work.",
    "created_at": "2013-05-07T08:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180185",
    "user": "SimonKing"
}
```

Replying to [comment:58 jdemeyer]:
> Replying to [comment:57 SimonKing]:
> > ARRGH! I call `$MAKE` in src/Makefile.
> In that case, there is a simple solution: change the `Makefile` to use
> {{{
> $(MAKE) -j1 ...
> }}}

I wish it were so easy... I tried this yesterday, but it didn't work.



---

archive/issue_comments_180186.json:
```json
{
    "body": "Replying to [comment:59 jdemeyer]:\n> Replying to [comment:54 SimonKing]:\n> > It could be that in the last three years the doctest and coverage framework of Sage has improved.\n> They certainly did. I think everything in your list now works correctly, except for the per-method testing and modulo the fact that doctests and coverage are a different script.\n\nComputing group cohomology is difficult. Therefore, this package does a lot of effort to recycle previous computations. But in the tests, I typically need to use a fresh computation, for otherwise I couldn't demonstrate the effect of the method being tested.\n\nTherefore, testing on a per module basis won't be easy. I suggest that I will try to find a solution for version 3.0 of the spkg.\n\n> I least I understand your motivation now, perhaps you should document this in the `spkg-check` file\n\nOK.",
    "created_at": "2013-05-07T08:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180186",
    "user": "SimonKing"
}
```

Replying to [comment:59 jdemeyer]:
> Replying to [comment:54 SimonKing]:
> > It could be that in the last three years the doctest and coverage framework of Sage has improved.
> They certainly did. I think everything in your list now works correctly, except for the per-method testing and modulo the fact that doctests and coverage are a different script.

Computing group cohomology is difficult. Therefore, this package does a lot of effort to recycle previous computations. But in the tests, I typically need to use a fresh computation, for otherwise I couldn't demonstrate the effect of the method being tested.

Therefore, testing on a per module basis won't be easy. I suggest that I will try to find a solution for version 3.0 of the spkg.

> I least I understand your motivation now, perhaps you should document this in the `spkg-check` file

OK.



---

archive/issue_comments_180187.json:
```json
{
    "body": "I found another place where MAKE is used. As it turns out, it is enough to add -j1 there and *only* there.\n\nMoreover, it seems that we can now build `MeatAxe` and David Green's programs with -O3 optimization. In previous versions, building `MeatAxe` with -O1 used to be faster than -O3, and David Green's programs did not work when building `MeatAxe` with -O3.\n\nBut now, it seems to work, presumably due to changes in gcc. I think it would make sense to test whether -O3 brings brings better speed, too.",
    "created_at": "2013-05-07T09:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180187",
    "user": "SimonKing"
}
```

I found another place where MAKE is used. As it turns out, it is enough to add -j1 there and *only* there.

Moreover, it seems that we can now build `MeatAxe` and David Green's programs with -O3 optimization. In previous versions, building `MeatAxe` with -O1 used to be faster than -O3, and David Green's programs did not work when building `MeatAxe` with -O3.

But now, it seems to work, presumably due to changes in gcc. I think it would make sense to test whether -O3 brings brings better speed, too.



---

archive/issue_comments_180188.json:
```json
{
    "body": "Replying to [comment:62 SimonKing]:\n> I think it would make sense to test whether -O3 brings brings better speed, too.\nYou might want to try `-O2` and `-Os` too.",
    "created_at": "2013-05-07T10:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180188",
    "user": "jdemeyer"
}
```

Replying to [comment:62 SimonKing]:
> I think it would make sense to test whether -O3 brings brings better speed, too.
You might want to try `-O2` and `-Os` too.



---

archive/issue_comments_180189.json:
```json
{
    "body": "Replying to [comment:61 SimonKing]:\n> Therefore, testing on a per module basis won't be easy. I suggest that I will try to find a solution for version 3.0 of the spkg.\nSuggestion (absolutely not a requirement for this ticket): simply add a command to clear the cache before every test.",
    "created_at": "2013-05-07T10:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180189",
    "user": "jdemeyer"
}
```

Replying to [comment:61 SimonKing]:
> Therefore, testing on a per module basis won't be easy. I suggest that I will try to find a solution for version 3.0 of the spkg.
Suggestion (absolutely not a requirement for this ticket): simply add a command to clear the cache before every test.



---

archive/issue_comments_180190.json:
```json
{
    "body": "Replying to [comment:64 jdemeyer]:\n> Replying to [comment:61 SimonKing]:\n> > Therefore, testing on a per module basis won't be easy. I suggest that I will try to find a solution for version 3.0 of the spkg.\n> Suggestion (absolutely not a requirement for this ticket): simply add a command to clear the cache before every test.\n\nSure, this would be one possible solution (for version 3.0). Question: Would it be possible to ask the doctest framework to put this clean-up function in front of every docstring? Or would I need to insert this function myself?",
    "created_at": "2013-05-07T10:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180190",
    "user": "SimonKing"
}
```

Replying to [comment:64 jdemeyer]:
> Replying to [comment:61 SimonKing]:
> > Therefore, testing on a per module basis won't be easy. I suggest that I will try to find a solution for version 3.0 of the spkg.
> Suggestion (absolutely not a requirement for this ticket): simply add a command to clear the cache before every test.

Sure, this would be one possible solution (for version 3.0). Question: Would it be possible to ask the doctest framework to put this clean-up function in front of every docstring? Or would I need to insert this function myself?



---

archive/issue_comments_180191.json:
```json
{
    "body": "Replying to [comment:63 jdemeyer]:\n> Replying to [comment:62 SimonKing]:\n> > I think it would make sense to test whether -O3 brings brings better speed, too.\n> You might want to try `-O2` and `-Os` too.\n\nI am currently waiting for `pGroupCohomology.factory.unit_test64` to finish with `-O3`, and will later try to compare the result with the other options.\n\nQuestion: Is it OK to hard-code `OO=\"-O3\"` in the Makefile? Or shall this be at the choice of the user? Is there a default optimization level used by Sage when installing an spkg?",
    "created_at": "2013-05-07T10:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180191",
    "user": "SimonKing"
}
```

Replying to [comment:63 jdemeyer]:
> Replying to [comment:62 SimonKing]:
> > I think it would make sense to test whether -O3 brings brings better speed, too.
> You might want to try `-O2` and `-Os` too.

I am currently waiting for `pGroupCohomology.factory.unit_test64` to finish with `-O3`, and will later try to compare the result with the other options.

Question: Is it OK to hard-code `OO="-O3"` in the Makefile? Or shall this be at the choice of the user? Is there a default optimization level used by Sage when installing an spkg?



---

archive/issue_comments_180192.json:
```json
{
    "body": "First timing, with `-O3`:\n\n```\n...\n#267: Walltime  59:31.94 min\n      CPU-time  28:07.53 min\n      Singular   2:54.90 min\n      Gap-time   0:40.17 min\n```\n",
    "created_at": "2013-05-07T10:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180192",
    "user": "SimonKing"
}
```

First timing, with `-O3`:

```
...
#267: Walltime  59:31.94 min
      CPU-time  28:07.53 min
      Singular   2:54.90 min
      Gap-time   0:40.17 min
```




---

archive/issue_comments_180193.json:
```json
{
    "body": "Remark on the timing: As much as I know, the huge difference between CPU and wall time comes from reading and writing to disk. If I am not mistaken, this does not count for CPU time, but plays a substantial role here.",
    "created_at": "2013-05-07T10:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180193",
    "user": "SimonKing"
}
```

Remark on the timing: As much as I know, the huge difference between CPU and wall time comes from reading and writing to disk. If I am not mistaken, this does not count for CPU time, but plays a substantial role here.



---

archive/issue_comments_180194.json:
```json
{
    "body": "When installing the `-O2` version, I noticed that `-O3` is still used on the Cython files (but it is `-O2` on the files of David Green and of `MeatAxe`).\n\nQuestion: How can I ask for using `-O2` when compiling Cython generated code?",
    "created_at": "2013-05-07T10:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180194",
    "user": "SimonKing"
}
```

When installing the `-O2` version, I noticed that `-O3` is still used on the Cython files (but it is `-O2` on the files of David Green and of `MeatAxe`).

Question: How can I ask for using `-O2` when compiling Cython generated code?



---

archive/issue_comments_180195.json:
```json
{
    "body": "Second timing, with `-O2`:\n\n```\n...\n#267: Walltime  54:26.91 min\n      CPU-time  25:50.69 min\n      Singular   2:57.31 min\n      Gap-time   0:40.97 min\n```\n",
    "created_at": "2013-05-07T12:03:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180195",
    "user": "SimonKing"
}
```

Second timing, with `-O2`:

```
...
#267: Walltime  54:26.91 min
      CPU-time  25:50.69 min
      Singular   2:57.31 min
      Gap-time   0:40.97 min
```




---

archive/issue_comments_180196.json:
```json
{
    "body": "Replying to [comment:66 SimonKing]:\n\n> Question: Is it OK to hard-code `OO=\"-O3\"` in the Makefile? Or shall this be at the choice of the user?\nIdeally, it should be at the choice of the user. The easiest solution is probably to use\n\n```\n$(CC) $(OO) $(CFLAGS) somefile.c -o somefile.o\n```\n\nin the `Makefile`. However, I wouldn't require this for positive review.\n\n> Is there a default optimization level used by Sage when installing an spkg?\nNo, every package handles this independently.",
    "created_at": "2013-05-07T12:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180196",
    "user": "jdemeyer"
}
```

Replying to [comment:66 SimonKing]:

> Question: Is it OK to hard-code `OO="-O3"` in the Makefile? Or shall this be at the choice of the user?
Ideally, it should be at the choice of the user. The easiest solution is probably to use

```
$(CC) $(OO) $(CFLAGS) somefile.c -o somefile.o
```

in the `Makefile`. However, I wouldn't require this for positive review.

> Is there a default optimization level used by Sage when installing an spkg?
No, every package handles this independently.



---

archive/issue_comments_180197.json:
```json
{
    "body": "Replying to [comment:69 SimonKing]:\n> Question: How can I ask for using `-O2` when compiling Cython generated code?\nI think you would need to edit `devel/sage/module_list.py`",
    "created_at": "2013-05-07T12:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180197",
    "user": "jdemeyer"
}
```

Replying to [comment:69 SimonKing]:
> Question: How can I ask for using `-O2` when compiling Cython generated code?
I think you would need to edit `devel/sage/module_list.py`



---

archive/issue_comments_180198.json:
```json
{
    "body": "Replying to [comment:72 jdemeyer]:\n> Replying to [comment:69 SimonKing]:\n> > Question: How can I ask for using `-O2` when compiling Cython generated code?\n> I think you would need to edit `devel/sage/module_list.py`\n\nOK, so, for my package, I should look into setup.py, then...\n\nTiming with `-O1`:\n\n```\n#267: Walltime  55:21.78 min\n      CPU-time  26:29.22 min\n      Singular   2:52.77 min\n      Gap-time   0:39.63 min\n```\n\n\nSo, currently, `-O2` seems best. But we still have `-Os`...",
    "created_at": "2013-05-07T13:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180198",
    "user": "SimonKing"
}
```

Replying to [comment:72 jdemeyer]:
> Replying to [comment:69 SimonKing]:
> > Question: How can I ask for using `-O2` when compiling Cython generated code?
> I think you would need to edit `devel/sage/module_list.py`

OK, so, for my package, I should look into setup.py, then...

Timing with `-O1`:

```
#267: Walltime  55:21.78 min
      CPU-time  26:29.22 min
      Singular   2:52.77 min
      Gap-time   0:39.63 min
```


So, currently, `-O2` seems best. But we still have `-Os`...



---

archive/issue_comments_180199.json:
```json
{
    "body": "Replying to [comment:73 SimonKing]:\n> OK, so, for my package, I should look into setup.py, then...\nExactly, you should add\n\n```\nextra_compile_args=[\"-O2\"]\n```\n\nfor the modules you want.",
    "created_at": "2013-05-07T13:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180199",
    "user": "jdemeyer"
}
```

Replying to [comment:73 SimonKing]:
> OK, so, for my package, I should look into setup.py, then...
Exactly, you should add

```
extra_compile_args=["-O2"]
```

for the modules you want.



---

archive/issue_comments_180200.json:
```json
{
    "body": "Last timing (`-Os`):\n\n```\n#267: Walltime  55:35.73 min\n      CPU-time  26:30.57 min\n      Singular   2:54.52 min\n      Gap-time   0:40.40 min\n```\n\n\nAnd the winner is `-O2` for the non-Cython part.",
    "created_at": "2013-05-07T14:51:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180200",
    "user": "SimonKing"
}
```

Last timing (`-Os`):

```
#267: Walltime  55:35.73 min
      CPU-time  26:30.57 min
      Singular   2:54.52 min
      Gap-time   0:40.40 min
```


And the winner is `-O2` for the non-Cython part.



---

archive/issue_comments_180201.json:
```json
{
    "body": "Argh. Forgot to re-compile the package... So, the last timing was another example of `-O1`.",
    "created_at": "2013-05-07T14:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180201",
    "user": "SimonKing"
}
```

Argh. Forgot to re-compile the package... So, the last timing was another example of `-O1`.



---

archive/issue_comments_180202.json:
```json
{
    "body": "By the way, it is good to see that the two timings with `-O1` are almost the same. Here it is with `-Os`:\n\n```\n...\n#267: Walltime  57:08.61 min\n      CPU-time  27:15.55 min\n      Singular   2:46.68 min\n      Gap-time   0:40.22 min\n```\n\n\nTomorrow, I'll see what happens when choosing different options for the Cython part of the code.",
    "created_at": "2013-05-07T18:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180202",
    "user": "SimonKing"
}
```

By the way, it is good to see that the two timings with `-O1` are almost the same. Here it is with `-Os`:

```
...
#267: Walltime  57:08.61 min
      CPU-time  27:15.55 min
      Singular   2:46.68 min
      Gap-time   0:40.22 min
```


Tomorrow, I'll see what happens when choosing different options for the Cython part of the code.



---

archive/issue_comments_180203.json:
```json
{
    "body": "`OO=-O2` and `extra_compile_args=['-O3']`:\n\n```\n...\n#267: Walltime  46:29.31 min\n      CPU-time  22:45.55 min\n      Singular   2:49.84 min\n      Gap-time   0:40.10 min\n```\n",
    "created_at": "2013-05-07T21:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180203",
    "user": "SimonKing"
}
```

`OO=-O2` and `extra_compile_args=['-O3']`:

```
...
#267: Walltime  46:29.31 min
      CPU-time  22:45.55 min
      Singular   2:49.84 min
      Gap-time   0:40.10 min
```




---

archive/issue_comments_180204.json:
```json
{
    "body": "Here are the remaining timings.\n\n`OO=-O2`, `extra_compile_args=['-O2']`:\n\n```\n...\n#267: Walltime  50:08.55 min\n      CPU-time  24:06.87 min\n      Singular   2:51.00 min\n      Gap-time   0:40.32 min\n```\n\n\n`OO=-O2`, `extra_compile_args=['-O1']`:\n\n```\n...\n#267: Walltime  51:33.45 min\n      CPU-time  24:48.10 min\n      Singular   2:49.59 min\n      Gap-time   0:39.57 min\n```\n\n\n`OO=-O2`, `extra_compile_args=['-Os']`:\n\n```\n...\n#267: Walltime  54:59.40 min\n      CPU-time  26:07.43 min\n      Singular   2:50.38 min\n      Gap-time   0:40.53 min\n```\n\n\nSo, at least on my laptop, it seems like a good idea to use -O2 on `MeatAxe` and David Green's programs, while -O3 seems best on the Cython code.\n\nI will now try to incorporate all your remarks and update my spkg accordingly.",
    "created_at": "2013-05-08T15:15:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180204",
    "user": "SimonKing"
}
```

Here are the remaining timings.

`OO=-O2`, `extra_compile_args=['-O2']`:

```
...
#267: Walltime  50:08.55 min
      CPU-time  24:06.87 min
      Singular   2:51.00 min
      Gap-time   0:40.32 min
```


`OO=-O2`, `extra_compile_args=['-O1']`:

```
...
#267: Walltime  51:33.45 min
      CPU-time  24:48.10 min
      Singular   2:49.59 min
      Gap-time   0:39.57 min
```


`OO=-O2`, `extra_compile_args=['-Os']`:

```
...
#267: Walltime  54:59.40 min
      CPU-time  26:07.43 min
      Singular   2:50.38 min
      Gap-time   0:40.53 min
```


So, at least on my laptop, it seems like a good idea to use -O2 on `MeatAxe` and David Green's programs, while -O3 seems best on the Cython code.

I will now try to incorporate all your remarks and update my spkg accordingly.



---

archive/issue_comments_180205.json:
```json
{
    "body": "I just posted an updated spkg, which addresses the following:\n\n* Fine tuning of compiler options. Caveat: I am not sure if it could be overridden by the user, but I think I should not care at this point.\n* spkg-install should exit with an error if setup.py throws an error, comment:38\n* Remove DISTUTILS_DEBUG, do not mess with MAKE, comment:45 et al.\n* Use gap, not `$SAGE_ROOT/sage -gap`, comment:48\n* An empty src/lib and src/bin should not be shipped, comment:51\n* Improve use of SAGE_NUM_THREADS, comment:52\n* A note in spkg-check commenting on the reasons for replicating sage -t, comment:59\n\nIt could be that I should improve the Makefiles, but I hope this can be left for the next version.",
    "created_at": "2013-05-08T15:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180205",
    "user": "SimonKing"
}
```

I just posted an updated spkg, which addresses the following:

* Fine tuning of compiler options. Caveat: I am not sure if it could be overridden by the user, but I think I should not care at this point.
* spkg-install should exit with an error if setup.py throws an error, comment:38
* Remove DISTUTILS_DEBUG, do not mess with MAKE, comment:45 et al.
* Use gap, not `$SAGE_ROOT/sage -gap`, comment:48
* An empty src/lib and src/bin should not be shipped, comment:51
* Improve use of SAGE_NUM_THREADS, comment:52
* A note in spkg-check commenting on the reasons for replicating sage -t, comment:59

It could be that I should improve the Makefiles, but I hope this can be left for the next version.



---

archive/issue_comments_180206.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-08T15:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180206",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_180207.json:
```json
{
    "body": "PS: The latest changes are provided by the patch `reviewer-2.1.4.patch` in the package.",
    "created_at": "2013-05-08T15:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180207",
    "user": "SimonKing"
}
```

PS: The latest changes are provided by the patch `reviewer-2.1.4.patch` in the package.



---

archive/issue_comments_180208.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-09T18:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180208",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_180209.json:
```json
{
    "body": "spkg looks good.",
    "created_at": "2013-05-09T18:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180209",
    "user": "jdemeyer"
}
```

spkg looks good.



---

archive/issue_comments_180210.json:
```json
{
    "body": "It has turned out that, with the increased optimization level, the package won't build with old compiler versions (e.g., not with gcc 4.4.5).\n\nSince this spkg version does not seem to be copied to the \"official\" list of optional spkgs: Is there still time to add a test that makes sure to install the package only when it works with the available gcc? In later versions (but not in 2.1.4 yet), I could imagine to make the optimization level depend on the available compiler.",
    "created_at": "2013-05-12T21:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180210",
    "user": "SimonKing"
}
```

It has turned out that, with the increased optimization level, the package won't build with old compiler versions (e.g., not with gcc 4.4.5).

Since this spkg version does not seem to be copied to the "official" list of optional spkgs: Is there still time to add a test that makes sure to install the package only when it works with the available gcc? In later versions (but not in 2.1.4 yet), I could imagine to make the optimization level depend on the available compiler.



---

archive/issue_comments_180211.json:
```json
{
    "body": "I did preserve a copy of the spkg that has been reviewed here. But I am now posting a new version that tests whether some underlying programs appear to work. If they don't, I am printing a hint concerning gcc version, and exit with an error.\n\nIf you think that this should better be done on a new ticket, then I'll do so. But I think it would be simpler to keep it here, because p_group_cohomology-2.1.4.spkg has not been put in the official repository of optional packages, yet.",
    "created_at": "2013-05-12T21:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180211",
    "user": "SimonKing"
}
```

I did preserve a copy of the spkg that has been reviewed here. But I am now posting a new version that tests whether some underlying programs appear to work. If they don't, I am printing a hint concerning gcc version, and exit with an error.

If you think that this should better be done on a new ticket, then I'll do so. But I think it would be simpler to keep it here, because p_group_cohomology-2.1.4.spkg has not been put in the official repository of optional packages, yet.



---

archive/issue_comments_180212.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-05-12T21:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180212",
    "user": "SimonKing"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_180213.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-12T22:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180213",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_180214.json:
```json
{
    "body": "It seems to work (i.e., to fail) correctly.\n\nWhen installing the updated spkg version in a Sage version that was built with gcc 4.4.5, it ends with\n\n```\n...\nTesting makeNontips\nmakeNontips -ORLL 2 /mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/present/src/test\nsh: maketab: not found\nsh: maketab: not found\np002.zzz: No such file or directory\nmake[1]: *** [makeNontips] Gleitkomma-Ausnahme\nmake[1]: *** Datei \u00bbmakeNontips\u00ab wird gel\u00f6scht\nmake[1]: Leaving directory `/mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/bin'\nmake: *** [all] Fehler 2\nError building pGroupCohomology.\nYou are using gcc 4.4.5\nIf this is older than gcc 4.6, then please consider upgrading your system-wide gcc,\nor install Sage with its gcc spkg.\nIf your gcc version is more recent, then please inform the author.\n\nreal    0m14.620s\nuser    0m12.601s\nsys     0m1.112s\n************************************************************************\nError installing package p_group_cohomology-2.1.4\n************************************************************************\n...\n```\n\n\nBut it installs fine on a system with gcc 4.6.\n\nIf you think that we can include this last minute change, then please review it. Otherwise, please tell me to put back the previous spkg.",
    "created_at": "2013-05-12T22:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180214",
    "user": "SimonKing"
}
```

It seems to work (i.e., to fail) correctly.

When installing the updated spkg version in a Sage version that was built with gcc 4.4.5, it ends with

```
...
Testing makeNontips
makeNontips -ORLL 2 /mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/present/src/test
sh: maketab: not found
sh: maketab: not found
p002.zzz: No such file or directory
make[1]: *** [makeNontips] Gleitkomma-Ausnahme
make[1]: *** Datei »makeNontips« wird gelöscht
make[1]: Leaving directory `/mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/bin'
make: *** [all] Fehler 2
Error building pGroupCohomology.
You are using gcc 4.4.5
If this is older than gcc 4.6, then please consider upgrading your system-wide gcc,
or install Sage with its gcc spkg.
If your gcc version is more recent, then please inform the author.

real    0m14.620s
user    0m12.601s
sys     0m1.112s
************************************************************************
Error installing package p_group_cohomology-2.1.4
************************************************************************
...
```


But it installs fine on a system with gcc 4.6.

If you think that we can include this last minute change, then please review it. Otherwise, please tell me to put back the previous spkg.



---

archive/issue_comments_180215.json:
```json
{
    "body": "Sorry, one small file is still missing.",
    "created_at": "2013-05-12T22:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180215",
    "user": "SimonKing"
}
```

Sorry, one small file is still missing.



---

archive/issue_comments_180216.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-12T22:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180216",
    "user": "SimonKing"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_180217.json:
```json
{
    "body": "OK, the spkg is updated. I verified that it does build on two systems with gcc 4.6 resp. 4.7.2, but correctly refuses to build with gcc 4.4.5, reporting a segmentation fault in `makeNontips`, namely\n\n```\nTesting makeNontips\n/mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/bin/maketab 2\nMAKETAB Revision 1.2 (1997/09/11)\nWriting tables to p002.zzz\nmakeNontips -ORLL 2 /mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/present/src/test\nmake[1]: *** [makeNontips] Speicherzugriffsfehler\nmake[1]: *** Datei \u00bbmakeNontips\u00ab wird gel\u00f6scht\nmake[1]: Leaving directory `/mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/bin'\nmake: *** [all] Fehler 2\nError building pGroupCohomology.\nYou are using gcc 4.4.5\nIf this is older than gcc 4.6, then please consider upgrading your system-wide gcc,\nor install Sage with its gcc spkg.\nIf your gcc version is more recent, then please inform the author.\n```\n\n\nThe difference to the previous test is this: The test is now creating the previously missing data file p002.zzz before calling `makeNontips`.",
    "created_at": "2013-05-12T22:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180217",
    "user": "SimonKing"
}
```

OK, the spkg is updated. I verified that it does build on two systems with gcc 4.6 resp. 4.7.2, but correctly refuses to build with gcc 4.4.5, reporting a segmentation fault in `makeNontips`, namely

```
Testing makeNontips
/mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/bin/maketab 2
MAKETAB Revision 1.2 (1997/09/11)
Writing tables to p002.zzz
makeNontips -ORLL 2 /mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/present/src/test
make[1]: *** [makeNontips] Speicherzugriffsfehler
make[1]: *** Datei »makeNontips« wird gelöscht
make[1]: Leaving directory `/mnt/local/king/SAGE/prereleases/sage-5.9.rc0.system-gcc/spkg/build/p_group_cohomology-2.1.4/src/bin'
make: *** [all] Fehler 2
Error building pGroupCohomology.
You are using gcc 4.4.5
If this is older than gcc 4.6, then please consider upgrading your system-wide gcc,
or install Sage with its gcc spkg.
If your gcc version is more recent, then please inform the author.
```


The difference to the previous test is this: The test is now creating the previously missing data file p002.zzz before calling `makeNontips`.



---

archive/issue_comments_180218.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-12T22:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180218",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_180219.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-17T12:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180219",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_180220.json:
```json
{
    "body": "It doesn't seem to work, due to the file `makeNontips` being missing:\n\n```\necho \"Testing makeNontips\"\nTesting makeNontips\n/mazur/release/merger/sage-5.10.beta0/spkg/build/p_group_cohomology-2.1.4/src/bin/maketab 2\nMAKETAB Revision 1.2 (1997/09/11)\nWriting tables to p002.zzz\nmakeNontips -ORLL 2 /mazur/release/merger/sage-5.10.beta0/spkg/build/p_group_cohomology-2.1.4/src/present/src/test\nmake[1]: makeNontips: Command not found\nmake[1]: *** [makeNontips] Error 127\nmake[1]: Leaving directory `/mazur/release/merger/sage-5.10.beta0/spkg/build/p_group_cohomology-2.1.4/src/bin'\nmake: *** [all] Error 2\nError building pGroupCohomology.\nYou are using gcc 4.8.0\nIf this is older than gcc 4.6, then please consider upgrading your system-wide gcc,\nor install Sage with its gcc spkg.\nIf your gcc version is more recent, then please inform the author.\n```\n",
    "created_at": "2013-05-17T12:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180220",
    "user": "jdemeyer"
}
```

It doesn't seem to work, due to the file `makeNontips` being missing:

```
echo "Testing makeNontips"
Testing makeNontips
/mazur/release/merger/sage-5.10.beta0/spkg/build/p_group_cohomology-2.1.4/src/bin/maketab 2
MAKETAB Revision 1.2 (1997/09/11)
Writing tables to p002.zzz
makeNontips -ORLL 2 /mazur/release/merger/sage-5.10.beta0/spkg/build/p_group_cohomology-2.1.4/src/present/src/test
make[1]: makeNontips: Command not found
make[1]: *** [makeNontips] Error 127
make[1]: Leaving directory `/mazur/release/merger/sage-5.10.beta0/spkg/build/p_group_cohomology-2.1.4/src/bin'
make: *** [all] Error 2
Error building pGroupCohomology.
You are using gcc 4.8.0
If this is older than gcc 4.6, then please consider upgrading your system-wide gcc,
or install Sage with its gcc spkg.
If your gcc version is more recent, then please inform the author.
```




---

archive/issue_comments_180221.json:
```json
{
    "body": "Perhaps you meant\n\n```\n./makeNontips\n```\n\ninstead of\n\n```\nmakeNontips\n```\n",
    "created_at": "2013-05-17T12:19:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180221",
    "user": "jdemeyer"
}
```

Perhaps you meant

```
./makeNontips
```

instead of

```
makeNontips
```




---

archive/issue_comments_180222.json:
```json
{
    "body": "Replying to [comment:90 jdemeyer]:\n> Perhaps you meant\n> {{{\n> ./makeNontips\n> }}}\n> instead of\n> {{{\n> makeNontips\n> }}}\n\nI have updated my spkg accordingly.\n\nCould you try it again? I guess the problem on my machine has been that there was a `makeNontips` in the path (either broken or working, hence, the Makefile correctly detected the problem, but based on a previous installation).",
    "created_at": "2013-05-17T12:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180222",
    "user": "SimonKing"
}
```

Replying to [comment:90 jdemeyer]:
> Perhaps you meant
> {{{
> ./makeNontips
> }}}
> instead of
> {{{
> makeNontips
> }}}

I have updated my spkg accordingly.

Could you try it again? I guess the problem on my machine has been that there was a `makeNontips` in the path (either broken or working, hence, the Makefile correctly detected the problem, but based on a previous installation).



---

archive/issue_comments_180223.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-05-17T12:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180223",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_180224.json:
```json
{
    "body": "Seems to work now.",
    "created_at": "2013-05-17T18:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180224",
    "user": "jdemeyer"
}
```

Seems to work now.



---

archive/issue_comments_180225.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-05-17T18:55:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180225",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_180226.json:
```json
{
    "body": "i've put the spkg on the server.",
    "created_at": "2013-05-19T10:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180226",
    "user": "schilly"
}
```

i've put the spkg on the server.



---

archive/issue_comments_180227.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-05-19T12:07:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14288",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14288#issuecomment-180227",
    "user": "jdemeyer"
}
```

Resolution: fixed
