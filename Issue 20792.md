# Issue 20792: cat: .../local/bin/sage-banner: No such file or directory

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2016-07-15 09:43:20

CC:  embray chapoton

Sage 7.3.beta8 is giving me a lot of errors of the form

```
[atlas-3.10.2.p2] cat: /usr/local/src/sage-config/local/bin/sage-banner: No such file or directory
```


The reason is that the file `local/bin/sage-banner` is installed at some point but it is always read by `sage-env`.


---

Comment by embray created at 2016-07-15 09:55:53

Right...see #20897.  I guess that should check if the file exists first before setting that environment variable.  It looks like that could happen from a fresh build.

(Do the patch bots really not test fresh builds from scratch?)


---

Comment by jdemeyer created at 2016-07-15 09:57:44

For the record, this does not cause the build to fail, just the error message gets printed.


---

Comment by jdemeyer created at 2016-07-15 10:00:17

Do we really need `SAGE_BANNER_TEXT` as variable? I suggest to use a shell function instead, such that the banner text gets computed only when needed, not every time that `sage-env` is sourced.


---

Comment by embray created at 2016-07-15 10:05:12

A shell function would be fine.  Thanks for the suggestion.


---

Comment by embray created at 2016-07-15 10:17:55

New commits:


---

Comment by embray created at 2016-07-15 10:17:55

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-07-15 11:42:29

I would replace

```
    if [ -n "$banner_file" -a -f "$banner_file" ]; then
        cat "$banner_file"
    fi
```

by

```
    cat "$banner_file"
```

since we want to see an error message when we ask for the banner but it doesn't exist.


---

Comment by jdemeyer created at 2016-07-15 11:42:39

Changing status from needs_review to needs_work.


---

Comment by embray created at 2016-07-15 12:26:54

I'm not sure about that.  I think it's of such minor importance that it should just be silent in that case.  The banner files doesn't exist yet when someone first checks out the source, but if they run, for example, `./sage --help` (incorrectly, of course) they would get an error.  I think it's not worth the panic that any error inevitably causes.


---

Comment by jdemeyer created at 2016-07-15 12:45:46

Replying to [comment:8 embray]:
> I think it's not worth the panic that any error inevitably causes.

In that case, just use `cat >&2 file` to silence error message because it's simpler.


---

Comment by embray created at 2016-07-15 13:50:42

I think this is fine as-is.  That looks like line noise to me even though I know what it means.


---

Comment by embray created at 2016-07-26 11:47:55

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2016-07-26 15:31:24

Replying to [comment:10 embray]:
> I think this is fine as-is.  That looks like line noise to me even though I know what it means.

I don't understand this comment. There are many instances of using `>&2` in Sage scripts; one might even say that it is approved (or at least standard) style for shell scripts in Sage. Why not listen to a conscientious reviewer and make the simple change he requests?


---

Comment by embray created at 2016-07-26 15:36:39

Why call an executable just to throw its output away when you can be certain, using shell built-ins, that it's not going to work anyways?


---

Comment by git created at 2016-07-26 15:58:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2016-07-26 15:58:59

Look, this is hardly the hill I want to die on :)


---

Comment by git created at 2016-07-26 16:17:40

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-07-26 16:21:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2016-07-26 16:26:02

Actually, decided to undo that.  I don't know if it's just that I'm tired and keep making mistake or what but `cat` even with errors suppressed still outputs a pointless newline so that's undesirable.


---

Comment by jdemeyer created at 2016-07-27 09:03:54

I agree it's not all that important, but for me `2>/dev/null cat no_such_file` outputs nothing, not a newline. I see no reason at all why `cat` would randomly output newlines, so I guess you must have made a mistake somewhere.

Anyway, leave the branch alone for now, I wanted to make some further simplifications anyway.


---

Comment by embray created at 2016-07-27 09:12:14

No, it doesn't output a newline.  I had a bit flipped incorrectly in my head somewhere.


---

Comment by jdemeyer created at 2016-07-27 10:26:15

If you agree, you can set this to positive_review.
----
New commits:


---

Comment by embray created at 2016-07-27 10:59:38

> +        cat "$SAGE_ROOT/VERSION.txt"

Correct me if I'm wrong, but I think it's possible for `$SAGE_ROOT/VERSION.txt` to be missing if building for the first time as well.  That's why it was done the way I had it.


---

Comment by jdemeyer created at 2016-07-27 12:28:53

`$SAGE_ROOT/VERSION.txt` is tracked by `git`, so it should always be present.


---

Comment by embray created at 2016-07-28 08:36:33

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-08-08 19:12:52

Various failures of the form

```
sage -t --long src/sage/doctest/test.py
**********************************************************************
File "src/sage/doctest/test.py", line 26, in sage.doctest.test
Failed example:
    subprocess.call(["sage", "-t", "--warn-long", "0", "longtime.rst"], **kwds)  # long time
Expected:
    Running doctests...
    Doctesting 1 file.
    sage -t --warn-long 0.0 longtime.rst
    [0 tests, ...s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    ...
    0
Got:
    /Users/buildslave-sage/slave/sage_git/build/src/bin/sage: line 368: sage_banner: command not found
    Running doctests with ID 2016-08-07-23-12-09-44d630e7.
    Git branch: develop
    Using --optional=mpir,python2,sage
    Doctesting 1 file.
    sage -t --warn-long 0.0 longtime.rst
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    0
**********************************************************************
```



---

Comment by vbraun created at 2016-08-08 19:12:52

Changing status from positive_review to needs_work.


---

Comment by embray created at 2016-08-09 09:47:32

Something seems fishy there.  I don't think that would happen unless somehow `sage-env` weren't updated.


---

Comment by jdemeyer created at 2016-08-10 07:37:24

I think I know what's wrong... commit coming up.


---

Comment by git created at 2016-08-10 09:04:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-08-10 09:27:22

Changing status from needs_work to needs_review.


---

Comment by embray created at 2016-08-10 09:29:42

Changing status from needs_review to positive_review.


---

Comment by embray created at 2016-08-10 09:29:42

Ah, I see what happened there.  Thanks, that makes sense.


---

Comment by vbraun created at 2016-08-13 22:50:42

Resolution: fixed
