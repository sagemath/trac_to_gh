# Issue 29145: Compute the centroid of a polytope

Issue created by migration from https://trac.sagemath.org/ticket/29382

Original creator: @kliem

Original creation time: 2020-03-20 20:39:50

CC:  jipilab @laisrast vbraun

Keywords: polytopes, centroid

This ticket implements a method to compute the center of the mass of a polytope.

It is motivated by

https://ask.sagemath.org/question/8092/compute-the-centroid-of-a-polytope/


---

Comment by @kliem created at 2020-03-20 20:40:47

New commits:


---

Comment by @kliem created at 2020-03-20 20:40:47

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-03-22 07:56:46

typo in the sentence "the induces Lebesgue measure"


---

Comment by git created at 2020-03-22 09:54:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-03-22 14:15:14

Ok.


---

Comment by jipilab created at 2020-03-27 10:47:04

You should add a comment to the asksage question and point to this ticket.


---

Comment by @kliem created at 2020-03-27 10:52:16

Ok, did that.


---

Comment by @DaveWitteMorris created at 2020-03-28 09:15:09

Thanks for doing this.

One small comment (and I apologize if this is noise) is that the code seems to give an error on 0-dimensional polytopes (i.e., a single vertex), even though they have an obvious centroid. (One reason for the error seems to be that sage cannot triangulate them. Should this be considered a bug?)

```
sage: P = Polyhedron(vertices=[(1.0,2.0)], base_ring=RDF)
sage: P
A 0-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex
sage: P.centroid()
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10139)()
   1942             try:
-> 1943                 return cache[k]
   1944             except TypeError:  # k is not hashable

KeyError: (('auto',), ())

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
<ipython-input-34-3e9b24a83d1c> in <module>()
----> 1 P.centroid()

    [snip]

/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/geometry/triangulation/point_configuration.py in facets_of_simplex(simplex)
   2001             facet = frozenset(rest)
   2002             normal = -sum(normals)
-> 2003             normal.set_immutable()
   2004             facet_normals[facet] = normal
   2005             facets.append(facet)

AttributeError: 'int' object has no attribute 'set_immutable'
sage: P.triangulate()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-35-9c7468245456> in <module>()
----> 1 P.triangulate()

    [snip]

/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/geometry/triangulation/point_configuration.py in facets_of_simplex(simplex)
   2001             facet = frozenset(rest)
   2002             normal = -sum(normals)
-> 2003             normal.set_immutable()
   2004             facet_normals[facet] = normal
   2005             facets.append(facet)

AttributeError: 'int' object has no attribute 'set_immutable'
```



---

Comment by git created at 2020-03-28 10:03:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-03-28 10:04:25

I opened some tickets because of small cases. They should work.

In case of empty polyhedron, there should be a reasonable error as well.
I'm passing the case of d+1 vertices down to `center` now.


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by @LaisRast created at 2020-04-17 09:49:02

`affine_hull` is deprecated. Use `affine_hull_projection` instead.
See ticket #29326 (which you reported and authored)


---

Comment by jipilab created at 2020-04-19 13:43:23

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2020-04-19 13:43:23

The following code should appear before the INPUT/OUTPUT I think


```diff
+        If the polyhedron is not compact, a ``NotImplementedError`` is
+        raised.
```


Otherwise, it looks good. It might benefit from a rebase just to have clean bots go through it.


---

Comment by @kliem created at 2020-04-19 14:44:53

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-04-19 14:44:53

Last 10 new commits:


---

Comment by git created at 2020-04-19 14:47:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jipilab created at 2020-04-19 15:40:38

Did you squash commits?


---

Comment by @kliem created at 2020-04-19 16:38:48

Just ignore the commit messages in comment 13. I didn't use develop as a base. I thought it was clear from the commit messages (I based the branch on #28873, which is of course not needed).


---

Comment by jipilab created at 2020-04-20 09:18:14

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2020-04-20 09:18:14

LGTM!


---

Comment by vbraun created at 2020-04-23 22:32:50

Resolution: fixed
