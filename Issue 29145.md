# Issue 29145: Compute the centroid of a polytope

archive/issues_029145.json:
```json
{
    "body": "CC:  jipilab @laisrast vbraun\n\nKeywords: polytopes, centroid\n\nThis ticket implements a method to compute the center of the mass of a polytope.\n\nIt is motivated by\n\nhttps://ask.sagemath.org/question/8092/compute-the-centroid-of-a-polytope/\n\nIssue created by migration from https://trac.sagemath.org/ticket/29382\n\n",
    "created_at": "2020-03-20T20:39:50Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Compute the centroid of a polytope",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29145",
    "user": "@kliem"
}
```
CC:  jipilab @laisrast vbraun

Keywords: polytopes, centroid

This ticket implements a method to compute the center of the mass of a polytope.

It is motivated by

https://ask.sagemath.org/question/8092/compute-the-centroid-of-a-polytope/

Issue created by migration from https://trac.sagemath.org/ticket/29382





---

archive/issue_comments_412615.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-03-20T20:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412615",
    "user": "@kliem"
}
```

New commits:



---

archive/issue_comments_412616.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-03-20T20:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412616",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_412617.json:
```json
{
    "body": "typo in the sentence \"the induces Lebesgue measure\"",
    "created_at": "2020-03-22T07:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412617",
    "user": "chapoton"
}
```

typo in the sentence "the induces Lebesgue measure"



---

archive/issue_comments_412618.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-22T09:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412618",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412619.json:
```json
{
    "body": "Ok.",
    "created_at": "2020-03-22T14:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412619",
    "user": "@kliem"
}
```

Ok.



---

archive/issue_comments_412620.json:
```json
{
    "body": "You should add a comment to the asksage question and point to this ticket.",
    "created_at": "2020-03-27T10:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412620",
    "user": "jipilab"
}
```

You should add a comment to the asksage question and point to this ticket.



---

archive/issue_comments_412621.json:
```json
{
    "body": "Ok, did that.",
    "created_at": "2020-03-27T10:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412621",
    "user": "@kliem"
}
```

Ok, did that.



---

archive/issue_comments_412622.json:
```json
{
    "body": "Thanks for doing this.\n\nOne small comment (and I apologize if this is noise) is that the code seems to give an error on 0-dimensional polytopes (i.e., a single vertex), even though they have an obvious centroid. (One reason for the error seems to be that sage cannot triangulate them. Should this be considered a bug?)\n\n```\nsage: P = Polyhedron(vertices=[(1.0,2.0)], base_ring=RDF)\nsage: P\nA 0-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex\nsage: P.centroid()\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10139)()\n   1942             try:\n-> 1943                 return cache[k]\n   1944             except TypeError:  # k is not hashable\n\nKeyError: (('auto',), ())\n\nDuring handling of the above exception, another exception occurred:\n\nAttributeError                            Traceback (most recent call last)\n<ipython-input-34-3e9b24a83d1c> in <module>()\n----> 1 P.centroid()\n\n    [snip]\n\n/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/geometry/triangulation/point_configuration.py in facets_of_simplex(simplex)\n   2001             facet = frozenset(rest)\n   2002             normal = -sum(normals)\n-> 2003             normal.set_immutable()\n   2004             facet_normals[facet] = normal\n   2005             facets.append(facet)\n\nAttributeError: 'int' object has no attribute 'set_immutable'\nsage: P.triangulate()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-35-9c7468245456> in <module>()\n----> 1 P.triangulate()\n\n    [snip]\n\n/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/geometry/triangulation/point_configuration.py in facets_of_simplex(simplex)\n   2001             facet = frozenset(rest)\n   2002             normal = -sum(normals)\n-> 2003             normal.set_immutable()\n   2004             facet_normals[facet] = normal\n   2005             facets.append(facet)\n\nAttributeError: 'int' object has no attribute 'set_immutable'\n```\n",
    "created_at": "2020-03-28T09:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412622",
    "user": "@DaveWitteMorris"
}
```

Thanks for doing this.

One small comment (and I apologize if this is noise) is that the code seems to give an error on 0-dimensional polytopes (i.e., a single vertex), even though they have an obvious centroid. (One reason for the error seems to be that sage cannot triangulate them. Should this be considered a bug?)

```
sage: P = Polyhedron(vertices=[(1.0,2.0)], base_ring=RDF)
sage: P
A 0-dimensional polyhedron in RDF^2 defined as the convex hull of 1 vertex
sage: P.centroid()
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/misc/cachefunc.pyx in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10139)()
   1942             try:
-> 1943                 return cache[k]
   1944             except TypeError:  # k is not hashable

KeyError: (('auto',), ())

During handling of the above exception, another exception occurred:

AttributeError                            Traceback (most recent call last)
<ipython-input-34-3e9b24a83d1c> in <module>()
----> 1 P.centroid()

    [snip]

/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/geometry/triangulation/point_configuration.py in facets_of_simplex(simplex)
   2001             facet = frozenset(rest)
   2002             normal = -sum(normals)
-> 2003             normal.set_immutable()
   2004             facet_normals[facet] = normal
   2005             facets.append(facet)

AttributeError: 'int' object has no attribute 'set_immutable'
sage: P.triangulate()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-35-9c7468245456> in <module>()
----> 1 P.triangulate()

    [snip]

/Users/dmorris/Documents/misc/Programs/sage3/local/lib/python3.7/site-packages/sage/geometry/triangulation/point_configuration.py in facets_of_simplex(simplex)
   2001             facet = frozenset(rest)
   2002             normal = -sum(normals)
-> 2003             normal.set_immutable()
   2004             facet_normals[facet] = normal
   2005             facets.append(facet)

AttributeError: 'int' object has no attribute 'set_immutable'
```




---

archive/issue_comments_412623.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-03-28T10:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412623",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_412624.json:
```json
{
    "body": "I opened some tickets because of small cases. They should work.\n\nIn case of empty polyhedron, there should be a reasonable error as well.\nI'm passing the case of d+1 vertices down to `center` now.",
    "created_at": "2020-03-28T10:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412624",
    "user": "@kliem"
}
```

I opened some tickets because of small cases. They should work.

In case of empty polyhedron, there should be a reasonable error as well.
I'm passing the case of d+1 vertices down to `center` now.



---

archive/issue_comments_412625.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412625",
    "user": "mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_412626.json:
```json
{
    "body": "`affine_hull` is deprecated. Use `affine_hull_projection` instead.\nSee ticket #29326 (which you reported and authored)",
    "created_at": "2020-04-17T09:49:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412626",
    "user": "@LaisRast"
}
```

`affine_hull` is deprecated. Use `affine_hull_projection` instead.
See ticket #29326 (which you reported and authored)



---

archive/issue_comments_412627.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-19T13:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412627",
    "user": "jipilab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_412628.json:
```json
{
    "body": "The following code should appear before the INPUT/OUTPUT I think\n\n\n```diff\n+        If the polyhedron is not compact, a ``NotImplementedError`` is\n+        raised.\n```\n\n\nOtherwise, it looks good. It might benefit from a rebase just to have clean bots go through it.",
    "created_at": "2020-04-19T13:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412628",
    "user": "jipilab"
}
```

The following code should appear before the INPUT/OUTPUT I think


```diff
+        If the polyhedron is not compact, a ``NotImplementedError`` is
+        raised.
```


Otherwise, it looks good. It might benefit from a rebase just to have clean bots go through it.



---

archive/issue_comments_412629.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-19T14:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412629",
    "user": "@kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_412630.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-04-19T14:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412630",
    "user": "@kliem"
}
```

Last 10 new commits:



---

archive/issue_comments_412631.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-19T14:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412631",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_412632.json:
```json
{
    "body": "Did you squash commits?",
    "created_at": "2020-04-19T15:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412632",
    "user": "jipilab"
}
```

Did you squash commits?



---

archive/issue_comments_412633.json:
```json
{
    "body": "Just ignore the commit messages in comment 13. I didn't use develop as a base. I thought it was clear from the commit messages (I based the branch on #28873, which is of course not needed).",
    "created_at": "2020-04-19T16:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412633",
    "user": "@kliem"
}
```

Just ignore the commit messages in comment 13. I didn't use develop as a base. I thought it was clear from the commit messages (I based the branch on #28873, which is of course not needed).



---

archive/issue_comments_412634.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-20T09:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412634",
    "user": "jipilab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_412635.json:
```json
{
    "body": "LGTM!",
    "created_at": "2020-04-20T09:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412635",
    "user": "jipilab"
}
```

LGTM!



---

archive/issue_comments_412636.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-23T22:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29145",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29145#issuecomment-412636",
    "user": "vbraun"
}
```

Resolution: fixed
