# Issue 30314: Drop Python 3.6 support

Issue created by migration from https://trac.sagemath.org/ticket/30551

Original creator: slelievre

Original creation time: 2020-09-10 18:15:01

CC:  chapoton mkoeppe mjo dimpase vbraun

This can be a dependency for other tickets.

For instance tickets updating dependencies to
versions that dropped support for Python 3.6.

And if we adopt the policy in #30384 then
we should soon drop support for Python 3.6.

Related:

- #30384: Adopt "time window-based" Python versions support policy


---

Comment by mkoeppe created at 2020-09-10 18:21:19

I don't think there is anything that says that we "should" drop Python 3.6 support.


---

Comment by slelievre created at 2020-09-10 19:02:11

Replying to [comment:1 mkoeppe]:
> I don't think there is anything that says
> that we "should" drop Python 3.6 support.

Oh good, then let's support it as long as we can.

By the way #15530 and #15980 which started support
for Python 3.6 are almost ready to be closed.


---

Comment by dimpase created at 2020-09-15 11:56:10

#30053 says that we must drop Python 3.6 - unless you want to have a go at it.

it seems that some of our code related to docbuilding is too new for 3.6, and perhaps our Sphinx is too new too. 

Besides, the EOL for 3.6 is late 2021, which is soon.


---

Comment by @tobiasdiez created at 2020-12-05 12:18:39

What do you think about adopting the [Python version strategy](https://numpy.org/neps/nep-0029-deprecation_policy.html) of numpy, according to which "a project with a major or minor version release in November 2020 should support Python 3.7 and newer"?


---

Comment by mkoeppe created at 2020-12-05 17:33:53

Replying to [comment:6 gh-tobiasdiez]:
> What do you think about adopting the [Python version strategy](https://numpy.org/neps/nep-0029-deprecation_policy.html) of numpy, according to which "a project with a major or minor version release in November 2020 should support Python 3.7 and newer"?
That's #30384


---

Comment by @tobiasdiez created at 2020-12-07 22:04:16

According to NEP 29, "a project with a major or minor version release in November 2020 should support Python 3.7 and newer." and thus this ticket can be closed in my opinion.

(Documentation for following NEP 29 is added in #30384.)


---

Comment by @tobiasdiez created at 2020-12-07 22:04:16

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-12-07 22:14:49

??!

This ticket is for **dropping** support for Python 3.6 -- this involves changing what system python versions we accept (`build/pkgs/python3/spkg-configure.m4`) and removing python3.6 workarounds from the code.

NEP 29 would already allow us to drop support now -- but I don't think we want to do it now (because of Sage's traditional role of providing a distribution that people can install onto ancient machines) -- hence the milestone is set to "pending".


---

Comment by mkoeppe created at 2020-12-07 22:15:15

Changing status from needs_review to needs_work.


---

Comment by @tobiasdiez created at 2020-12-07 23:15:57

Sorry, it wasn't clear to me from the ticket description that this is more than a placeholder to mark dependencies on Python 3.6.

NEP 29 is actually quite explicit about that one should drop support after the 42 months, e.g "On Jun 23, 2020 drop support for Python 3.6 (initially released on Dec 23, 2016)". Of course, it could be sage's policy to support also older python versions, but that's then no longer NEP 29 (in it's strict form). However, one should also keep in mind that supporting old Python versions results in technical debt that might be bigger than the gains from supporting old systems.

Also correct me if I'm wrong, but since sage is also installing its own python version, sage can still be used on older systems, right? It is just that the system python is not used.

Anyway, I've tried to locate all workarounds that are in place for Python 3.6 support, and removed them (I've probably missed a few, but maybe its good anyway to pay of the technical debt in follow up tickets). Moreover, I've upgraded the requirements to 3.7 (again, I might have missed something).
----
New commits:


---

Comment by @tobiasdiez created at 2020-12-07 23:15:57

Changing status from needs_work to needs_review.


---

Comment by slelievre created at 2020-12-17 20:29:30

Other projects dropping support for Python 3.6:

- Networkx,
  see [Networkx PR #4469 "Drop Py3.6 support per NEP 29"](https://github.com/networkx/networkx/pull/4469)
  merged 2020-12-17
- NumPy 1.20, see NumPy 1.20.rc1 released 2020-12-03
- SciPy 1.6.0, see SciPy 1.6.0rc1 released 2020-12-11


---

Comment by mkoeppe created at 2020-12-19 00:31:21

In this change:

```
 - **ar** and **ranlib**: can be obtained as part of GNU binutils.
 - **tar**: GNU tar version 1.17 or later, or BSD tar.
-- **python**: Python 3, 3.6 or later, or Python 2.7 (deprecated).
+- **python**: Python 3.7 or later (Python 2.7 or Python <= 3.6 support is deprecated).
```

Both the original text and the new one are not correct. This part refers to the `sage-bootstrap-python` which has much wider range of supported python versions, including Python >= 2.6 and Python >= 3.4 - according to `build/tox.ini`.


---

Comment by git created at 2020-12-19 09:18:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2020-12-19 09:18:31

Replying to [comment:13 mkoeppe]:
> In this change:
> {{{
>  - **ar** and **ranlib**: can be obtained as part of GNU binutils.
>  - **tar**: GNU tar version 1.17 or later, or BSD tar.
> -- **python**: Python 3, 3.6 or later, or Python 2.7 (deprecated).
> +- **python**: Python 3.7 or later (Python 2.7 or Python <= 3.6 support is deprecated).
> }}}
> Both the original text and the new one are not correct. This part refers to the `sage-bootstrap-python` which has much wider range of supported python versions, including Python >= 2.6 and Python >= 3.4 - according to `build/tox.ini`.
> 

I've changed the versions now.


---

Comment by mkoeppe created at 2020-12-19 17:22:38


```
--- a/src/doc/en/installation/source.rst
+++ b/src/doc/en/installation/source.rst
@@ -88,7 +88,7 @@ computer:
 - **perl**: version 5.8.0 or later.
 - **ar** and **ranlib**: can be obtained as part of GNU binutils.
 - **tar**: GNU tar version 1.17 or later, or BSD tar.
-- **python**: Python 3, 3.6 or later, or Python 2.7 (deprecated).
+- **python**: Python 3.7 or later (Python >= 2.6 and <= 3.6 support is deprecated).
 
 Other versions of these may work, but they are untested.
```

I don't think we have deprecated anything regarding `sage-bootstrap-python` versions.
(see #20023 - which proposes to drop support for 2.6)


---

Comment by mkoeppe created at 2020-12-23 19:37:15

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-01-06 22:37:33

I'm splitting this documentation update out to #31192 to get it into Sage 9.3


---

Comment by git created at 2021-01-07 01:52:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2021-01-12 21:49:19

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2021-01-15 14:32:32

what's going on in src/sage/combinat/subset.py change in this branch?


---

Comment by @tobiasdiez created at 2021-01-15 15:16:07

That's a revert of commit "Allow Sage to work with a system Python 3.6." abb5607710a2a5cc5415423489fa452965cbef68 which is introduced a workaround that is no longer required for Python 3.7.


---

Comment by dimpase created at 2021-01-16 08:47:03

Replying to [comment:25 gh-tobiasdiez]:
> That's a revert of commit "Allow Sage to work with a system Python 3.6." abb5607710a2a5cc5415423489fa452965cbef68 which is introduced a workaround that is no longer required for Python 3.7.

I mean, what's

```
    def __len__....
...
-        return int(self.cardinality())
+        return Integer(1) << self._s.cardinality()
+
+    __len__ = cardinality
```

in 

```
commit 7d97a56c5aaab99af75de58b71b144a28d4f9dd3
Author: Tobias Diez <code@tobiasdiez.com>
Date:   Mon Dec 7 23:52:28 2020 +0100

    Partially revert "Allow Sage to work with a system Python 3.6."
    
```


why do we need an implementation for `__len__` ?
(before `abb5607710a` it was just `__len__ = cardinality`)


---

Comment by @tobiasdiez created at 2021-01-16 12:25:06

Sorry, I don't understand your question.
In pseudo-language:

Before abb5607710a: `__len__ = cardinality`

After abb5607710a: `__len__ = int(cardinality)`

After 7d97a56c5a (this ticket): `__len__ = cardinality`

So we are back to the original behavior before abb5607710a "Allow Sage to work with a system Python 3.6."

Maybe this representation of the diff is clearer: https://github.com/sagemath/sagetrac-mirror/commit/7d97a56c5aaab99af75de58b71b144a28d4f9dd3


---

Comment by dimpase created at 2021-01-16 17:56:15

Oh, OK, I misread the diff, sorry.


---

Comment by git created at 2021-04-19 19:33:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2021-04-19 19:36:04

Rebased on 9.3.rc4 and #30913 (which added relevant metadata).

Let's merge this at the beginning of the 9.4 cycle.


---

Comment by dimpase created at 2021-04-22 12:40:41

lgtm


---

Comment by dimpase created at 2021-04-22 12:40:41

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2021-05-16 21:35:38

Did you take into account that Ubuntu 18.04 (LTS supported until 2028) still uses Python 3.6 (see https://packages.ubuntu.com/bionic/python3)? I am not sure what they intend to do with Python though.


---

Comment by mkoeppe created at 2021-05-16 21:56:07

Yes, these systems are out there. From Sage 9.4 on we will no longer be able to use the system python, but this will not stop Sage from building and running on this system.


---

Comment by slelievre created at 2021-05-16 21:56:36

There are two relevant Python minimum versions (see comment:13):

- the minimum Python version Sage can use as its underlying Python
- the minimum Python version Sage can use to bootstrap,
  building is own Python if necessary

On Ubuntu 18.04, building from source will still work,
but if the system Python is 3.6, Sage will build a more
recent Python to base itself on.


---

Comment by dimpase created at 2021-05-17 07:31:46

no need to build it on !Debian/Ubuntu, even the old LTS provide modern pythons. E.g.

```
sudo apt-get install python3.8 python3.8-dev python3.8-distutils python3.8-venv
```


and if you don't have root you can use pyenv to get modern python.

We should be thinking about stopping with shipping CPython sources, we don't patch them, and there are enough ways to get it in binary.


---

Comment by dimpase created at 2021-05-17 08:00:56

a slight inconvenience is that you'd need to specify the Python to use to `./configure`


---

Comment by mkoeppe created at 2021-05-18 02:16:02

Changing status from positive_review to needs_work.


---

Comment by mkoeppe created at 2021-05-18 02:16:02

Commit 721ede18042cfee9ca044823599346e1ee7420f1 is not good.


---

Comment by dimpase created at 2021-05-19 11:07:39

Replying to [comment:41 mkoeppe]:
> Commit 721ede18042cfee9ca044823599346e1ee7420f1 is not good. 

this is 

```diff
Author: Tobias Diez <code@tobiasdiez.com>
Date:   Tue Dec 8 00:05:41 2020 +0100

    Partially revert #30008

diff --git a/build/bin/sage-bootstrap-python b/build/bin/sage-bootstrap-python
index faee444e8d..c3afc1261a 100755
--- a/build/bin/sage-bootstrap-python
+++ b/build/bin/sage-bootstrap-python
@@ -30,15 +30,6 @@ fi
 # is accessible by this python; this is to guard on Cygwin against Pythons
 # installed somewhere else in Windows.
 
-# Trac #30008: Make it work even if the environment tries to sabotage UTF-8
-# operation in Python 3.0.x-3.6.x by setting LC_ALL=C or similar.
-
-if [ "$LC_ALL" = "C" -o "$LANG" = "C" -o "$LC_CTYPE" = "C" ]; then
-    LC_ALL=$(locale -a | grep -E -i '^(c|en_us)[-.]utf-?8$' | head -n 1)
-    LANG=$LC_ALL
-    export LC_ALL
-    export LANG
-fi
 
 PYTHONS="python python3 python3.8 python3.7 python2.7 python3.6 python2"
 for PY in $PYTHONS; do
```

what's the problem here?


---

Comment by mkoeppe created at 2021-05-19 15:13:52

Replying to [comment:43 dimpase]:
> what's the problem here?

It is a change to `sage-bootstrap-python`; but we are NOT changing support for bootstrapping with old Python versions.


---

Comment by git created at 2021-05-19 15:15:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-19 15:15:26

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-05-19 15:16:02

`@`vbraun - if it's too late for this change, I can also put this reverting commit on a new ticket.


---

Comment by dimpase created at 2021-05-19 15:19:06

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2021-05-19 15:19:06

ok.


---

Comment by mkoeppe created at 2021-05-26 01:25:59

Looks like the earlier version, b06731c29501c81a35bba514ce11a957174732f0, was merged in 9.4.beta0.
----
New commits:


---

Comment by git created at 2021-05-26 01:30:27

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-05-26 01:30:27

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-05-26 01:35:30

I've put the missing commit on #31860.


---

Comment by mkoeppe created at 2021-05-26 01:35:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-05-27 20:30:10

Resolution: fixed
