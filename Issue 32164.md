# Issue 32164: Fix maxima('acosh(0.5)') doctest in expression.pyx

Issue created by migration from https://trac.sagemath.org/ticket/32401

Original creator: slelievre

Original creation time: 2021-08-19 13:19:17

CC:  slelievre

Keywords: maxima, tolerance

Observed on Cygwin 3.2.0(0.340/5/3). This test:


```
sage -t --random-seed=0 src/sage/symbolics/expression.pyx
```


gives this failure:


```
File "src/sage/symbolic/expression.pyx", line 9045,
in sage.symbolic.expression.Expression.arccosh
Failed example:
    maxima('acosh(0.5)')
Expected:
    1.047197551196598...*%i
Got:
    1.047197551196598*%i-1.110223024625157e-16
```


The appearance of a small real part here
cannot be dealt with a tolerance.

Not sure how to track whether this comes
from some recent change in Cygwin.

To make the doctest pass, maybe instead:

- test real part is 0.0 with abs tol 1e-15
- test imaginary part is what it should be

This was briefly mentioned at

- #22191: update ECL to 20.4.24

as revealed by

- [Sage Trac search for maxima('acosh(0.5)')](https://trac.sagemath.org/search?q=maxima('acosh(0.5)'))


---

Comment by chapoton created at 2021-08-21 07:48:19

New commits:


---

Comment by chapoton created at 2021-08-21 07:48:19

Changing status from new to needs_review.


---

Comment by slelievre created at 2021-08-21 08:03:18

How about writing it like this?


```diff
-            sage: z = maxima('acosh(0.5)'); z.imag()
-            1.04719755119659...
+            sage: z = maxima('acosh(0.5)')
+            sage: z.real(), z.imag()  # abs tol 1e-15
+            (0.0, 1.047197551196598)
```


Also an opportunity to change rtac to trac
in the commit message.  : )


---

Comment by git created at 2021-08-21 08:21:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2021-08-21 08:22:22

voila, voila.


---

Comment by slelievre created at 2021-08-21 08:32:58

All tests passed!


---

Comment by slelievre created at 2021-08-21 08:32:58

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-08-21 08:53:21

Not sure where the change in rounding originates
that makes a small real part appear here.

Maxima? ECL? Cygwin math library? In case it might
be worth reporting upstream.

Tiny real resp. imaginary parts in pure imaginary
resp. real results are annoying, see e.g. #8450.


---

Comment by vbraun created at 2021-09-13 22:19:43

Resolution: fixed
