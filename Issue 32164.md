# Issue 32164: Fix maxima('acosh(0.5)') doctest in expression.pyx

archive/issues_032164.json:
```json
{
    "body": "CC:  slelievre\n\nKeywords: maxima, tolerance\n\nObserved on Cygwin 3.2.0(0.340/5/3). This test:\n\n\n```\nsage -t --random-seed=0 src/sage/symbolics/expression.pyx\n```\n\n\ngives this failure:\n\n\n```\nFile \"src/sage/symbolic/expression.pyx\", line 9045,\nin sage.symbolic.expression.Expression.arccosh\nFailed example:\n    maxima('acosh(0.5)')\nExpected:\n    1.047197551196598...*%i\nGot:\n    1.047197551196598*%i-1.110223024625157e-16\n```\n\n\nThe appearance of a small real part here\ncannot be dealt with a tolerance.\n\nNot sure how to track whether this comes\nfrom some recent change in Cygwin.\n\nTo make the doctest pass, maybe instead:\n\n- test real part is 0.0 with abs tol 1e-15\n- test imaginary part is what it should be\n\nThis was briefly mentioned at\n\n- #22191: update ECL to 20.4.24\n\nas revealed by\n\n- [Sage Trac search for maxima('acosh(0.5)')](https://trac.sagemath.org/search?q=maxima('acosh(0.5)'))\n\nIssue created by migration from https://trac.sagemath.org/ticket/32401\n\n",
    "created_at": "2021-08-19T13:19:17Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "title": "Fix maxima('acosh(0.5)') doctest in expression.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32164",
    "user": "slelievre"
}
```
CC:  slelievre

Keywords: maxima, tolerance

Observed on Cygwin 3.2.0(0.340/5/3). This test:


```
sage -t --random-seed=0 src/sage/symbolics/expression.pyx
```


gives this failure:


```
File "src/sage/symbolic/expression.pyx", line 9045,
in sage.symbolic.expression.Expression.arccosh
Failed example:
    maxima('acosh(0.5)')
Expected:
    1.047197551196598...*%i
Got:
    1.047197551196598*%i-1.110223024625157e-16
```


The appearance of a small real part here
cannot be dealt with a tolerance.

Not sure how to track whether this comes
from some recent change in Cygwin.

To make the doctest pass, maybe instead:

- test real part is 0.0 with abs tol 1e-15
- test imaginary part is what it should be

This was briefly mentioned at

- #22191: update ECL to 20.4.24

as revealed by

- [Sage Trac search for maxima('acosh(0.5)')](https://trac.sagemath.org/search?q=maxima('acosh(0.5)'))

Issue created by migration from https://trac.sagemath.org/ticket/32401





---

archive/issue_comments_459406.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-08-21T07:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459406",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_459407.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-21T07:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459407",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_459408.json:
```json
{
    "body": "How about writing it like this?\n\n\n```diff\n-            sage: z = maxima('acosh(0.5)'); z.imag()\n-            1.04719755119659...\n+            sage: z = maxima('acosh(0.5)')\n+            sage: z.real(), z.imag()  # abs tol 1e-15\n+            (0.0, 1.047197551196598)\n```\n\n\nAlso an opportunity to change rtac to trac\nin the commit message.  : )",
    "created_at": "2021-08-21T08:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459408",
    "user": "slelievre"
}
```

How about writing it like this?


```diff
-            sage: z = maxima('acosh(0.5)'); z.imag()
-            1.04719755119659...
+            sage: z = maxima('acosh(0.5)')
+            sage: z.real(), z.imag()  # abs tol 1e-15
+            (0.0, 1.047197551196598)
```


Also an opportunity to change rtac to trac
in the commit message.  : )



---

archive/issue_comments_459409.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-08-21T08:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459409",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_459410.json:
```json
{
    "body": "voila, voila.",
    "created_at": "2021-08-21T08:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459410",
    "user": "chapoton"
}
```

voila, voila.



---

archive/issue_comments_459411.json:
```json
{
    "body": "All tests passed!",
    "created_at": "2021-08-21T08:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459411",
    "user": "slelievre"
}
```

All tests passed!



---

archive/issue_comments_459412.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-21T08:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459412",
    "user": "slelievre"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_459413.json:
```json
{
    "body": "Not sure where the change in rounding originates\nthat makes a small real part appear here.\n\nMaxima? ECL? Cygwin math library? In case it might\nbe worth reporting upstream.\n\nTiny real resp. imaginary parts in pure imaginary\nresp. real results are annoying, see e.g. #8450.",
    "created_at": "2021-08-21T08:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459413",
    "user": "slelievre"
}
```

Not sure where the change in rounding originates
that makes a small real part appear here.

Maxima? ECL? Cygwin math library? In case it might
be worth reporting upstream.

Tiny real resp. imaginary parts in pure imaginary
resp. real results are annoying, see e.g. #8450.



---

archive/issue_comments_459414.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-13T22:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32164",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32164#issuecomment-459414",
    "user": "vbraun"
}
```

Resolution: fixed
