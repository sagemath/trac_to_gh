# Issue 33868: ZeroDivisionError while reducing a polynomial w.r.t. the zero ideal

Issue created by migration from https://trac.sagemath.org/ticket/34105

Original creator: @maxale

Original creation time: 2022-07-01 17:47:14

CC:  tscrim

The following code produces `ZeroDivisionError`:


```
K.<x,y> = AA[]
K.ideal([]).reduce(x+1)
```


Interestingly, the error goes away if `K.<x,y> = AA[]` is replaced with `K.<x> = AA[]` or with `K.<x,y> = QQ[]`.


---

Comment by nbruin created at 2022-07-01 20:33:30


```
sage: K.<x,y> = AA[]
....: I=K.ideal([])
sage: I.gens()
[0]
```

so the generic code in `sage/rings/polynomial/multi_polynomial_ideal.py` probably chokes on a zero generator. The behaviour of `I.gens()` is the same for `QQ[]`, so I suspect the reduction code should simply skip over zero generators to be consistent with the other backends.


---

Comment by @DaveWitteMorris created at 2022-07-01 22:05:22

Changing status from new to needs_review.


---

Comment by @DaveWitteMorris created at 2022-07-01 22:05:22

The first commit fixes the error by skipping zero monomials (and adds a doctest). The second commit cleans up the code a bit.
----
New commits:


---

Comment by @maxale created at 2022-07-04 16:23:39

Btw, it's not directly related to this bug report, but I see a discrepancy in `.gens()` for univariate and multivariate ideals. In the former case, it returns a tuple and the latter case it returns a list:



```
sage: K.<x> = QQ[]
....: K.ideal().gens()
(0,)
sage: K.<x,y> = QQ[]
....: K.ideal().gens()
[0]

```


Shouldn't it be always a tuple?


---

Comment by @DaveWitteMorris created at 2022-07-06 05:21:02

I opened #34120 to discuss the issue in comment:4.


---

Comment by klee created at 2022-07-16 11:55:22

Why did you remove this?

```sage
    lI = len(I)
    I = list(I)  
```

The code is for performance.


---

Comment by @DaveWitteMorris created at 2022-07-16 18:18:05

Thanks for your comments! 

The code looked unpythonic to me, and I wasn't thinking about performance.  Indeed, I don't know python well enough to understand most performance issues, but I can understand that having `I = list(I)` outside of the loop is more efficient. 

Instead of `for gi in I:`, the code let `lI = len(I)` (outside of the loop) and then used the very unpythonic

```
for i in range(lI):
    gi = I[i]
```

I suppose that is also for performance (because the compiler does not know that the length of `I` is constant), so I reverted that change, too.

Part of the reason I made changes is that `p -= quot*I[i]` seemed poor.  Even though my other attempts at improvement should be reverted, it seems to me this should be changed to `p -= quot * gi`. (Indeed, `gi` was specifically defined to be a more efficient replacement for `I[i]`.) But I am not fluent in python, so I will certainly do whatever you think is best about this.

(PS: I also rebased on 9.7b5 and fixed a whitespace issue -- I had spaces at the start of three blank lines.)
----
New commits:


---

Comment by klee created at 2022-07-17 03:44:26

Changing `I[i]` to `gi` is certainly an improvement.

On the other hand, I think that this `if gilm and P.monomial_divides(gilm, plm):` is not a real solution of the issue. As `gilm` is the leading monomial of a polynomial, it should be nonzero by definition, and it should not be necessary to check if it is so.  

The real problem is that `R.zero_ideal().gens()` returns the list of a zero polynomial. Mathematically zero (polynomial) is never a generator. Hence the proper solution would be to fix the `gens()` method of the ideal so that it returns an empty tuple (or list) for a zero ideal.

It is surprising to me that sage still has this bug, thinking the maturity of sage...


---

Comment by @DaveWitteMorris created at 2022-07-17 04:30:07

I don't agree that this is a bug or mathematical error (because I seem to use terminology differently than you do), but the documentation should be clarified.  For me, a generating set of an ideal is analogous to a spanning set of a vector space: there is no assumption that the set is irredundant or does not contain zero.

The docstring of `I.gens` says: "This is usually the set of generators provided during object creation" and I think that is the right thing to do, because it is very fast, and simplifying the list of generators could be expensive. (Probably the method `gens_reduced` should provide a good generating set, instead of just wrapping `gens`.)  For example, I think the following output is fine:

```
sage: K.<x,y> = AA[]
sage: K.ideal([x, x^2, 0, 0, x*y]).gens()
[x, x^2, 0, 0, x*y]
```


On the other hand, the docstring of `I.gens` also says "Return a set of generators / a basis of this ideal." I think the mention of "a basis" is confusing and should be deleted.  I don't know even know what it means to say that a set is a "basis" of an ideal, but I notice that ideals have a `basis` method that is a wrapper for `gens`.

A related issue is that I'm not so sure that the zero polynomial has a leading monomial:

```
sage: K(0).lm()
0
```

Perhaps this should return `None` (or raise `ValueError`), but returning `0` does seem reasonable.


---

Comment by @DaveWitteMorris created at 2022-07-17 04:49:34

I forgot to mention a point on which I think we agree: the `gens` of the ideal generated by `[]` should be `[]`, not `[0]`.


---

Comment by klee created at 2022-07-17 06:44:28

Replying to [comment:11 gh-DaveWitteMorris]:
> I forgot to mention a point on which I think we agree: the `gens` of the ideal generated by `[]` should be `[]`, not `[0]`.

Yes. The zero ideal is generated by an empty set of generators. Hence `R.zero_ideal().gens()` should always return an empty tuple.

It may be related with the fact that `K(0).lm()` returns `0`. I think it is also reasonable that this would raise an error.

For this ticket, we may skip `gi` if it is a zero polynomial, instead of checking `gilm` is nonzero, if we allow a zero generator but assume leading monomial is nonzero.


---

Comment by @DaveWitteMorris created at 2022-07-18 06:02:58

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-07-18 06:13:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2022-07-18 06:16:18

Setting zero element as the sole generator for a zero ideal seems pervasive in sage. 

The simplest solution for this ticket seems removing zeros for reduction.


---

Comment by klee created at 2022-07-18 06:16:50

Changing status from needs_work to needs_review.


---

Comment by klee created at 2022-07-18 06:17:54

Is the solution okay with you?


---

Comment by @DaveWitteMorris created at 2022-07-18 23:56:34

Changing status from needs_review to positive_review.


---

Comment by @DaveWitteMorris created at 2022-07-18 23:56:34

Yes, thanks for making the change. It is better than my original fix.

The patchbot failures are known random failures (#32773 and #33907) so I consider the patchbot to be green.


---

Comment by klee created at 2022-07-19 00:21:15

Thanks!


---

Comment by vbraun created at 2022-07-28 19:10:14

Resolution: fixed
