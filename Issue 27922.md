# Issue 27922: vector_bundles

Issue created by migration from https://trac.sagemath.org/ticket/28159

Original creator: @DeRhamSource

Original creation time: 2019-07-10 15:46:30

CC:  tscrim egourgoulhon




---

Comment by @DeRhamSource created at 2019-07-10 15:53:03

Changing keywords from "" to "vector bundles, manifolds".


---

Comment by @DeRhamSource created at 2019-07-10 15:53:03

Changing type from PLEASE CHANGE to enhancement.


---

Comment by @DeRhamSource created at 2019-07-10 16:13:11

Changing component from PLEASE CHANGE to geometry.


---

Comment by @DeRhamSource created at 2019-07-10 16:59:40

Please take a short look and give me a short feedback. I want to know whether I'm on the right way or not.

Furthermore, I appreciate tricks and advices. Thanks in advance! :) 
----
New commits:


---

Comment by egourgoulhon created at 2019-07-11 08:44:03

Replying to [comment:4 gh-DeRhamSource]:
> Please take a short look and give me a short feedback. I want to know whether I'm on the right way or not.
> 
> Furthermore, I appreciate tricks and advices. Thanks in advance! :) 


Thanks for this endeavor. I gave a look: it looks very nice! Please go on.

A minor comment: for class names, full names are preferable, so `TopolVectorBundle` could be replaced by `TopologicalVectorBundle`. Also maybe, in the context of vector bundles, `TransitionMap` is more appropriate than `CoordChange`.


---

Comment by @DeRhamSource created at 2019-07-11 13:51:06

Thanks!


---

Comment by git created at 2019-07-13 20:50:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-13 21:28:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-14 17:40:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-07-15 12:48:18

What about synergy and compatibility with the old code? I mean, tangent bundles and vector fields are just special cases of vector bundles and sections. So, it'd be nice when we don't have two different implementations for the very same thing. How would you like to handle that? Any suggestions?


---

Comment by @DeRhamSource created at 2019-07-15 14:17:49

Also, it could be a good idea to generalize tensor fields and vector fields
to tensor product sections and treat tensor fields as a special case then.
But that's a huge step with pretty much effort (because I'm not that much
into your complete manifold code and the synergies between your files),
where I'd appreciate some help -- if you agree of course. 

My first approach in mind is to implement just simple sections and program tensor products of bundles aswell.


---

Comment by egourgoulhon created at 2019-07-21 14:42:00

Replying to [comment:12 gh-DeRhamSource]:
> What about synergy and compatibility with the old code? I mean, tangent bundles and vector fields are just special cases of vector bundles and sections. So, it'd be nice when we don't have two different implementations for the very same thing. How would you like to handle that? Any suggestions? 

Sorry for the delay in replying. 
IMHO, you should introduce a subclass of `TopologicalVectorBundle` for the tangent bundle (or more generally for tensor bundles) and simply have the method `section` of this subclass return a vector field on the manifold, as defined by the "old" code. Maybe it is sufficient to have a single subclass for all tensor bundles, including the tangent and cotangent bundles, i.e. something like

```
class TensorBundle(TopologicalVectorBundle):

    def __init__(self, manifold, k, l):
        rank = manifold.dim()**(k+l)
        if (k, l) == (1, 0):
            name = "T{}".format(manifold._name)
        elif (k, l) == (0, 1):
            name = "T*{}".format(manifold._name)
        else:
            name = "T^({}{}){}".format(k, l, manifold._name)
        # similar code for latex_name
        TopologicalVectorBundle.__init__(self, rank, name, manifold, 
                                         field=manifold.base_field(),
                                         latex_name=latex_name)
        self._tensor_type = (k, l)

    def section(self, *args, **kwargs):
        if self.tensor_type == (1, 0):
            return self._base_space.vector_field(*args, **kwargs)
        return self._base_space.tensor_field(*(self._tensor_type + args), **kwargs)
```

In the code for differentiable manifolds, you could then add

```
class DifferentiableManifold(TopologicalManifold):

    ...

    def tangent_bundle(self):
        return TensorBundle(self, 1, 0)

    def cotangent_bundle(self):
        return TensorBundle(self, 0, 1)

    def tensor_bundle(self, k, l)
        return TensorBundle(self, k, l)

```



---

Comment by egourgoulhon created at 2019-07-21 16:23:02

Also, I don't know if this is useful at this stage, but you could introduce an intermediate class, `DifferentiableVectorBundle` say, and let `TensorBundle` inherits from it. Besides, since (the total spaces of) differentiable vector bundles are differentiable manifolds, this intermediate class could inherit from `DifferentiableManifold` as well:

```
class DifferentiableVectorBundle(TopologicalVectorBundle, DifferentiableManifold):

    def __init__(self, rank, name, base_space, diff_degree=infinity,
                 latex_name=None, category=None)
        field = base_space.base_field()
        TopologicalVectorBundle.__init__(self, rank, name, base_space, field=field,
                                         latex_name=latex_name, category=category)
        dim = base_space.dim() * rank
        if isinstance(field, RealField_class):
            structure = RealDifferentialStructure()
        else:
            structure = DifferentialStructure()
        DifferentiableManifold.__init__(self, dim, name, field, structure,
                                        diff_degree=diff_degree, 
                                        latex_name=latex_name, 
                                        start_index=base_space.start_index())

class TensorBundle(DifferentiableVectorBundle):
    ...
```



---

Comment by egourgoulhon created at 2019-07-21 19:50:08

In addition, to make the link with preexisting code, one could redefine the method `fiber()` of `TensorBundle` to return the tangent space at the given point if `(k,l)==(1,0)` or the corresponding tensor product for other values of `(k,l)`:

```
class TensorBundle(DifferentiableVectorBundle):

    def __init__(self, manifold, k, l):
        rank = manifold.dim()**(k+l)
        if (k, l) == (1, 0):
            name = "T{}".format(manifold._name)
        elif (k, l) == (0, 1):
            name = "T*{}".format(manifold._name)
        else:
            name = "T^({}{}){}".format(k, l, manifold._name)
        # similar code for latex_name
        DifferentiableVectorBundle.__init__(self, rank, name, manifold, 
                                            diff_degree=manifold.diff_degree(),
                                            latex_name=latex_name)
        self._tensor_type = (k, l)

    def section(self, *args, **kwargs):
        if self.tensor_type == (1, 0):
            return self._base_space.vector_field(*args, **kwargs)
        return self._base_space.tensor_field(*(self._tensor_type + args), **kwargs)
  
    def fiber(self, point):
        return self._base_space.tangent_space(point).tensor_module(*self._tensor_type)

```



---

Comment by @DeRhamSource created at 2019-07-21 22:30:21

Sounds like a very good compromise to me. I'll see what I can do. Thanks for your input!

But I feel not comfortable with inheriting from `DifferentiableManifold`. There are too many conflicts (`frame()`, `atlas()`, etc.). Maybe, having a `total_space()` method returning the corresponding manifold would be a better idea. What do you think?


---

Comment by egourgoulhon created at 2019-07-22 08:06:21

Replying to [comment:17 gh-DeRhamSource]:
> Sounds like a very good compromise to me. I'll see what I can do. Thanks for your input!
> 
> But I feel not comfortable with inheriting from `DifferentiableManifold`. There are too many conflicts (`frame()`, `atlas()`, etc.). Maybe, having a `total_space()` method returning the corresponding manifold would be a better idea. What do you think?

This seems indeed a good idea. Also sounds closer to the mathematical definition of a vector bundle as a tuple `(E, M, pi)`, which distinguishes the bundle from its base space `E`.


---

Comment by @DeRhamSource created at 2019-07-23 15:52:46

I need some help, again. I'm now trying to program local frames and sections and looked up how you managed it for vector fields. Maybe you can shortly explain how you did it? The code is pretty huge and spreaded. Especially, I'm interested in changes from one (coordinate) frame into another for different domains and the restriction process and display for tensor fields. Thanks! :)


---

Comment by egourgoulhon created at 2019-07-23 21:09:07

Replying to [comment:19 gh-DeRhamSource]:
> I need some help, again. I'm now trying to program local frames and sections and looked up how you managed it for vector fields. Maybe you can shortly explain how you did it? The code is pretty huge and spreaded. Especially, I'm interested in changes from one (coordinate) frame into another for different domains and the restriction process and display for tensor fields. Thanks! :)

You can find some details of the implementation in [this article](http://ccirm.cedram.org/cedram-bin/article/CCIRM_2018__6_1_A1_0.pdf). Please tell me if this does not cover what you are looking for.


---

Comment by @DeRhamSource created at 2019-07-26 15:55:22

Thanks, that was very helpful.

I think, one should do the following: Implement arbitrary tensor product sections on one particular vector bundle and apply and adapt the construction as it is done for tensor fields, and then derive tensor fields from this more general construction. Or even better: Implement tensor product sections of mixed vector bundles over the same base space (e.g. `\Gamma(E \otimes E^* \otimes \Lambda^k F)`).

Unfortunately, I'm running out of time. Moreover, for this endeavour, you need to understand the whole code around tensor fields quite perfectly. I would implement just simple sections for now and apply the compromise we agreed on above. Maybe I can try this generalization after my thesis or one of you is willing to take the effort.

However, simple sections seem enough for the beginning because it is possible to construct aforementioned sections by constructing the corresponding bundles and then defining simple sections on them. Still, imao, the way above is the most flexible and overall convenient.

What do you think?


---

Comment by egourgoulhon created at 2019-07-31 08:24:22

Replying to [comment:21 gh-DeRhamSource]:
> I would implement just simple sections for now and apply the compromise we agreed on above. Maybe I can try this generalization after my thesis or one of you is willing to take the effort.
> 
> However, simple sections seem enough for the beginning because it is possible to construct aforementioned sections by constructing the corresponding bundles and then defining simple sections on them. Still, imao, the way above is the most flexible and overall convenient.
> 
> What do you think?

Sorry for the delay in replying. 
Yes, implementing simple sections as a first stage seems the thing to do at the moment.


---

Comment by git created at 2019-08-02 15:02:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-02 17:04:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-23 13:56:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-08-23 14:01:02

The doctests take pretty much effort (especially for the section file). Maybe, I will not finish them on time. But for now, the code is mostly finished. Some things are still to do, but sections seem to work. Please take a look and write me if something is missing or should be done better.

Best regards,
Michael


---

Comment by egourgoulhon created at 2019-09-01 09:14:22

Replying to [comment:26 gh-DeRhamSource]:
> The doctests take pretty much effort (especially for the section file). Maybe, I will not finish them on time. But for now, the code is mostly finished. Some things are still to do, but sections seem to work. Please take a look and write me if something is missing or should be done better.
> 

Sorry for the delay in replying. I gave a look and it looks very good! Please go on.

A few comments/questions:
- you've deleted the dependency to #28189 while some source files modified in this ticket (those in `src/sage/matrix` and `src/sage/sets`) pertain to #28189
- vector bundles have not been added to the reference manual yet; I guess you have to edit/add some files in `src/doc/en/reference/manifolds` and check that the documentation builds correcty with

```
sage -docbuild reference/manifolds html
```

- notice that the doctests that output a dictionary, like

```
sage: E.changes_of_frame()
```

  in line 105 of `trivialization.py`, must be marked `# random`
- there is a typo in line 38 of `trivialization.py`:

```
    `(p, v) \mapsto \pi^{-1}(p)` is a linear isomorphism.  
```

  must be replaced by something like

```
    `(p, v) \mapsto v` is a linear isomorphism from `\pi^{-1}(p)` to `K^n`.
```

- another typo, in line 8 of `vector_bundle.py`: 

```
- the set `E_p=\pi^{-1}(x)` has the vector space structure of `K^n`,
```

  `x` has to be replaced by `p`.
- the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?
- shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)


---

Comment by @DeRhamSource created at 2019-09-07 13:17:50

> 
> Sorry for the delay in replying. I gave a look and it looks very good! Please go on.
>
\\
Don't worry. :)
\\\\


> A few comments/questions:
> - you've deleted the dependency to #28189 while some source files modified in this ticket (those in `src/sage/matrix` and `src/sage/sets`) pertain to #28189

\\
Added again.
\\\\

> - vector bundles have not been added to the reference manual yet; I guess you have to edit/add some files in `src/doc/en/reference/manifolds` and check that the documentation builds correcty with
> {{{
> sage -docbuild reference/manifolds html
> }}}
\\
Comes later, when all the doc is finished. :)
\\\\
> - notice that the doctests that output a dictionary, like
> {{{
> sage: E.changes_of_frame()
> }}}
>   in line 105 of `trivialization.py`, must be marked `# random`
\\
What do you mean?
\\\\
> - there is a typo in line 38 of `trivialization.py`:
> {{{
>     `(p, v) \mapsto \pi^{-1}(p)` is a linear isomorphism.  
> }}}
>   must be replaced by something like
> {{{
>     `(p, v) \mapsto v` is a linear isomorphism from `\pi^{-1}(p)` to `K^n`.
> }}}
> - another typo, in line 8 of `vector_bundle.py`: 
> {{{
> - the set `E_p=\pi^{-1}(x)` has the vector space structure of `K^n`,
> }}}
>   `x` has to be replaced by `p`.
\\
Corrected. The projection compatibility was missing, too.
\\\\

> - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?
\\
I just borrowed the same code lines from manifold.py. I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.
\\\\
> - shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)
\\
For now, yes. But later on, when the computation of the atlas is implemented, one should update the manifold's atlas, maybe using this method.
\\\\
Best, Michael


---

Comment by git created at 2019-09-08 09:06:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2019-09-08 20:23:13

Replying to [comment:30 gh-DeRhamSource]:
> 
> Comes later, when all the doc is finished. :)

I will ;-)

>
> > - notice that the doctests that output a dictionary, like
> > {{{
> > sage: E.changes_of_frame()
> > }}}
> >   in line 105 of `trivialization.py`, must be marked `# random`
> \\
> What do you mean?

When printing a dictionary, the order of elements is random. For instance it depends on the computer. So a doctest that involves a directory output may fail on a different computer. The marker `# random` ensures that the doctest is skipped (see http://doc.sagemath.org/html/en/developer/coding_basics.html#special-markup-to-influence-doctests).



> > - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?
> \\
> I just borrowed the same code lines from manifold.py. 

Ah yes, you are right: that's already there for manifolds. 

>I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.

Yes this could be the reason. Travis, do remember why such a choice was made? 
On the other side, things are not very consistent here, since `frames()` returns directly `self._frames` and we have the same for many other manifold methods. 

> > - shouldn't the method `TopologicalVectorBundle.total_space()` be cached? (possibly using the decorator ``@`cached_method`)
> \\
> For now, yes. But later on, when the computation of the atlas is implemented, one should update the manifold's atlas, maybe using this method.

OK, I see.


---

Comment by tscrim created at 2019-09-08 22:13:46

Replying to [comment:32 egourgoulhon]:
> Replying to [comment:30 gh-DeRhamSource]:
> > > - the function `TopologicalVectorBundle.atlas()` returns a shallow copy of `self._atlas`; why does it not return directly `self._atlas` ?
> > \\
> > I just borrowed the same code lines from manifold.py. 
> 
> Ah yes, you are right: that's already there for manifolds. 
> 
> >I guess, this is for convenience: One should not allow to alter the list when getting the atlas through this method.
> 
> Yes this could be the reason. Travis, do remember why such a choice was made? 
> On the other side, things are not very consistent here, since `frames()` returns directly `self._frames` and we have the same for many other manifold methods. 

Probably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.


---

Comment by egourgoulhon created at 2019-09-09 20:11:23

Replying to [comment:33 tscrim]:
> 
> Probably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.

My concern here would be about efficiency. We might have quite often loops like 

```
for chart in M.atlas():
    ...
```

This implies that a list is created each time such a loop occurs. But maybe the CPU cost is negligible...


---

Comment by tscrim created at 2019-09-09 21:27:41

Replying to [comment:34 egourgoulhon]:
> Replying to [comment:33 tscrim]:
> > 
> > Probably all of them should return copies of the lists because it better protects the data. It is really easy to access stuff and then unintentionally change it, which could then throw your entire system out of balance. Most likely I/we just didn't notice or think about it when doing the initial code.
> 
> My concern here would be about efficiency. We might have quite often loops like 
> {{{
> for chart in M.atlas():
>     ...
> }}}
> This implies that a list is created each time such a loop occurs. But maybe the CPU cost is negligible...

That would be my guess since so much time is spent in doing the computations of the manifold itself. (Python heavily optimizes list manipulations I think too.) Plus, since it is internal, it is much more okay to break encapsulation and just directly call the attribute when you know it is safe (or add a `copy` flag to the accessor methods).


---

Comment by git created at 2019-09-16 12:53:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-09-16 13:14:20

There was an issue with the restrictions of (vector) frames. Namely, the list of sub- and superframes was not complete and depended on some strange random order. Here is an example:


```
sage: M = Manifold(2, 'M')
sage: U = M.open_subset('U'); V = M.open_subset('V'); W = U.intersection(V, name='W')
sage: e = M.vector_frame('e')
sage: eV = e.restrict(V); eU = e.restrict(U); eW = e.restrict(W)
sage: eW._superframes
{Vector frame (W, (e_0,e_1)),
 Vector frame (M, (e_0,e_1)),
 Vector frame (V, (e_0,e_1))}
sage: eU._subframes
{Vector frame (U, (e_0,e_1))}
sage: eV._subframes
{Vector frame (W, (e_0,e_1)), Vector frame (V, (e_0,e_1))}
```


I fixed it by avoiding any recursion and expanding the tree of subframes (and superframes) starting from the reference frame. Please check.


---

Comment by egourgoulhon created at 2019-09-18 20:21:19

Replying to [comment:37 gh-DeRhamSource]:
> There was an issue with the restrictions of (vector) frames. Namely, the list of sub- and superframes was not complete and depended on some strange random order. 
>
> I fixed it by avoiding any recursion and expanding the tree of subframes (and superframes) starting from the reference frame. Please check.

Looks good to me. Thanks for the fix!


---

Comment by git created at 2019-09-24 13:24:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-09-24 13:36:50

I declared `ScalarFieldAlgebra` as a field so that matrix computations like inverses and determinants make no problems. When ticket #28189 is merged (hopefully in 9b0), this can be undone. But for now, this ticket does not depend on #28189 anymore.

Since this solves some problems in the preexisting code, I removed the SR enforcement in `differentiable/automorphismfield.py` for more compatibility.

Do you agree?


---

Comment by git created at 2019-09-24 19:30:19

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @DeRhamSource created at 2019-09-24 19:38:08

A merge of #28189 for 9b0 seems imminent. Since this ticket will be merged earliest in 9b0, I added the dependencies again. Imao, it makes things easier and less complicated, especially for characteristic classes.

I am sorry for potential inconveniences.


---

Comment by git created at 2019-09-25 14:29:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-04 14:34:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-04 14:42:00

So, I guess, all pieces of the puzzles are fit together now. Please take a look, give me a feedback and tell me what is missing.

I have some difficulties to interpret the docbuild errors. Can someone help? Is there a documentation?

It seems, we are almost done. :)


---

Comment by @DeRhamSource created at 2019-10-04 14:46:14

By the way: How should the authorship be handled? I copied most of the files and just adapted them. So, the other authors should be mentioned.


---

Comment by git created at 2019-10-04 15:37:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-04 18:53:35

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-10-04 22:39:45

Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.

As for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.

Are there things you can put as methods in the category of vector bundles? At least I think there should be an abstract method for the base space, and maybe also the projection map (i.e., things in this category should have a common way to give the defining properties).

This code doesn't do anything:

```
        if update_atlas:
            # TODO: if self._atlas not empty, introduce charts
            pass
```


I would change `Moebius` to `Möbius` in the documentation (also make sure to add the utf8 encoding `# -*- coding: utf-8 -*-` to the first line of such files).


```diff
-        desc = "Module "
-        desc += self._name + " "
-        desc += "of sections "
-        desc += "on the {} ".format(self._domain)
-        desc += "with values in the " + self._vbundle.base_field_type() + " "
-        desc += "vector bundle " + self._vbundle._name + " "
-        desc += "of rank {}".format(self._vbundle.rank())
+        desc = "Module {} of sections on the {} with values in the {} vector bundle of rank {}"
+        desc = desc.format(self._name, self._domain, self._vbundle.base_field_type(), self._vbundle.rank())
```



```diff
-Sets the default local frame on ``self``.
+Set the default local frame on ``self``.
```


I will probably have more changes, but I don't have time right now to look in full detail.


---

Comment by git created at 2019-10-05 09:18:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-05 09:25:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-05 09:33:45

Thanks for your feedback!

Replying to [comment:57 tscrim]:
> Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.

I guess, I have eliminated all doctest errors caused by these files. Please overlook this.

> As for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.

Done. I kept Eric in the copyrights. Is that appropriate?

> This code doesn't do anything:
> {{{
>         if update_atlas:
>             # TODO: if self._atlas not empty, introduce charts
>             pass
> }}}
> 
> I would change `Moebius` to `Möbius` in the documentation (also make sure to add the utf8 encoding `# -*- coding: utf-8 -*-` to the first line of such files).
> 
> {{{#!diff
> -        desc = "Module "
> -        desc += self._name + " "
> -        desc += "of sections "
> -        desc += "on the {} ".format(self._domain)
> -        desc += "with values in the " + self._vbundle.base_field_type() + " "
> -        desc += "vector bundle " + self._vbundle._name + " "
> -        desc += "of rank {}".format(self._vbundle.rank())
> +        desc = "Module {} of sections on the {} with values in the {} vector bundle of rank {}"
> +        desc = desc.format(self._name, self._domain, self._vbundle.base_field_type(), self._vbundle.rank())
> }}}
> 
> {{{#!diff
> -Sets the default local frame on ``self``.
> +Set the default local frame on ``self``.
> }}}

Done!

> Are there things you can put as methods in the category of vector bundles? At least I think there should be an abstract method for the base space, and maybe also the projection map (i.e., things in this category should have a common way to give the defining properties).

What do you mean? :/


---

Comment by git created at 2019-10-05 10:41:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-05 10:44:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2019-10-05 10:45:12

Replying to [comment:60 gh-DeRhamSource]:
> 
> Replying to [comment:57 tscrim]:
> > Docbuild errors are notoriously quite difficult. Unfortunately it usually just means going over the file carefully with some general hint from the error message about what you should be looking for. I can also go through it if you haven't been able to find what is going wrong.
> 
> I guess, I have eliminated all doctest errors caused by these files. Please overlook this.
> 

Thanks for this painful work. It is true that sphinx messages are not very informative. In particular the line numbers do not refer to the start of the file but to the start of the docstring. For this reason, one should not hesitate to build the doc often, possibly after each modification of a doctring. For this, do not run `make doc`, which takes ages (*), use instead `sage -docbuild reference/manifolds html`.

(*) hopefully there is a ticket about this (I don't remember which one at the moment).
> > As for authorship, I would say just listing yourself as the author because you did write the code, even if it is adapted from others. I don't think they should (or need to) have a copyright. Although it doesn't hurt to say it was based off another file, but I don't have a stake in this. Eric is best to comment on this.
> 
> Done. I kept Eric in the copyrights. Is that appropriate?

I think you can remove my name from the copyright, leaving just yours. 

I'll have a look at the code soon.
----
New commits:


---

Comment by @DeRhamSource created at 2019-10-05 10:58:03

Thank you! I fixed pyflakes and coverage errors. I'm looking forward to your review! :)


---

Comment by git created at 2019-10-06 08:05:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2019-10-07 13:32:52

Thanks for completing the documentation. 

With python3 Sage 9.0.beta0, I've got the following errors:

```
----------------------------------------------------------------------
sage -t --long --warn-long 53.2 src/sage/categories/vector_bundles.py  # 2 doctests failed
sage -t --long --warn-long 53.2 src/sage/manifolds/section.py  # 2 doctests failed
sage -t --long --warn-long 53.2 src/sage/manifolds/chart_func.py  # 1 doctest failed
sage -t --long --warn-long 53.2 src/sage/manifolds/section_module.py  # 10 doctests failed
sage -t --long --warn-long 53.2 src/sage/manifolds/vector_bundle.py  # 1 doctest failed
----------------------------------------------------------------------
```

They appear on the patchbot report too.

Besides, there is a warning when building the documentation:

```
[manifolds] <unknown>:1956: DeprecationWarning: invalid escape sequence \c
```



---

Comment by egourgoulhon created at 2019-10-07 13:32:52

Changing status from needs_review to needs_work.


---

Comment by egourgoulhon created at 2019-10-07 14:26:38

There is also some wrong indentation in the docstring of class `TopologicalVectorBundle`, starting from line 85 of `src/sage/manifolds/vector_bundle.py`. This alters the output of the html documentation.


---

Comment by git created at 2019-10-07 14:36:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-07 14:36:31

This should be fixed now.


---

Comment by @DeRhamSource created at 2019-10-07 14:36:58

Changing status from needs_work to needs_review.


---

Comment by @DeRhamSource created at 2019-10-07 14:37:57

The error in `src/sage/manifolds/chart_func.py` should not belong to this ticket. I fixed it anyway.


---

Comment by egourgoulhon created at 2019-10-07 14:58:58

Replying to [comment:71 gh-DeRhamSource]:
> The error in `src/sage/manifolds/chart_func.py` should not belong to this ticket.

Yes it does: there is no such error in Sage 9.0.beta0. 
Anyway, thanks for the fixes.


---

Comment by egourgoulhon created at 2019-10-09 08:50:45

I still get some errors:

```
----------------------------------------------------------------------
sage -t --long --warn-long 54.2 src/sage/manifolds/section.py  # 1 doctest failed
sage -t --long --warn-long 54.2 src/sage/manifolds/chart_func.py  # 2 doctests failed
sage -t --long --warn-long 54.2 src/sage/manifolds/vector_bundle.py  # 1 doctest failed
sage -t --long --warn-long 54.2 src/sage/manifolds/section_module.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by egourgoulhon created at 2019-10-09 08:50:45

Changing status from needs_review to needs_work.


---

Comment by @DeRhamSource created at 2019-10-09 09:29:41

That's pretty strange:
- For `section.py` I get no errors. What is your error message?
- The two `chart_func.py` errors are not related to this ticket. However, it seems a `#random` mark is needed here.

The other issues get fixed soon. I'll change the status.


---

Comment by git created at 2019-10-09 09:54:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-09 09:55:34

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2019-10-09 12:23:55

Replying to [comment:74 gh-DeRhamSource]:
> That's pretty strange:
> - For `section.py` I get no errors. What is your error message?

Here it is:

```
sage -t --long src/sage/manifolds/section.py
**********************************************************************
File "src/sage/manifolds/section.py", line 305, in sage.manifolds.section.Section._latex_
Failed example:
    omega = E.section(name='\omega')
Expected nothing
Got:
    doctest:warning
...
    DeprecationWarning: invalid escape sequence \o
**********************************************************************
1 item had failures:
   1 of   6 in sage.manifolds.section.Section._latex_
    [735 tests, 1 failure, 29.78 s]
```

This is because the raw string marker `r` is missing in front of `'\omega'`: the line 305 should read

```
   sage: omega = E.section(name=r'\omega')
```

Probably the reason why you don't get this error is that you are using Python 2 version of Sage, which is less strict in this respect (however, this is still an error, since the LaTeX output will not be correct). On general ground, I would advise you to use Python 3 version of Sage for development, since Sage 9.0 will be Python 3 based. Installing Python 3 Sage is pretty easy:

```
git clone https://github.com/sagemath/sage.git
cd sage
git checkout develop
git pull
make configure
./configure --with-python=3
MAKE="make -j8" make
```



---

Comment by @DeRhamSource created at 2019-10-09 12:37:19

Oh yeah, thank you! :) I am going to try a new test run after the python3 compilation. Till then, I keep this ticket on _needs_work_.


---

Comment by @DeRhamSource created at 2019-10-09 12:37:19

Changing status from needs_review to needs_work.


---

Comment by egourgoulhon created at 2019-10-09 12:57:15

Replying to [comment:78 gh-DeRhamSource]:
> Oh yeah, thank you! :) I am going to try a new test run after the python3 compilation. Till then, I keep this ticket on _needs_work_.

OK. On my (Python 3) side, the doctest error in `section.py` is the last remaining one. However, there are various errors in the html output of the documentation. For instance, in the section "Trivializations", some links are wrong (class names not clickable or expressions as `:class:`sage.manifolds.chart_func.ChartFunction` appearing in the output) and some `::` are missing before doctest blocs. Could you please fix those?


---

Comment by git created at 2019-10-09 19:10:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-10 11:54:52

Changed. Can you please check the docbuild for me?


---

Comment by @DeRhamSource created at 2019-10-10 11:54:52

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-10-10 15:54:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-10 15:58:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by egourgoulhon created at 2019-10-12 21:45:48

New commits:


---

Comment by egourgoulhon created at 2019-10-12 21:54:37

I've gone through the documentation and have introduced some fixes in the above commit (comment:84).
In particular, I've added an entry point for the category of vector bundles, as well as for fibers and fiber elements. I've also fixed hyperlinks, quote issues, missing `::` and the invalid escape sequence mentioned in comment:66. You can see the full list of changes [here](https://git.sagemath.org/sage.git/commit?id=12a86a4feef85048f97383363fd004f8d1961c44). Do you agree with them?


---

Comment by @DeRhamSource created at 2019-10-12 22:16:49

Thank you so much for overlooking my code and your effort! There was still quite a lot to do.

There's just one thing in `differentiable/vector_bundle.py` around line 389 in the class `TensorBundle`:

"OUPUT" -> "OUTPUT"

Apart from that, I agree. :)


---

Comment by git created at 2019-10-13 15:23:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2019-10-13 15:39:57

Replying to [comment:86 gh-DeRhamSource]:
 
> There's just one thing in `differentiable/vector_bundle.py` around line 389 in the class `TensorBundle`:
> 
> "OUPUT" -> "OUTPUT"
> 
Corrected in the above commit.
I've also introduced minor changes to improve the documentation (I hope). 

I have also performed some changes in the code, replacing `self._dest_map` by `self._dest_map.restrict(domain)` in `DifferentiableVectorBundle.section()` and `DifferentiableVectorBundle.local_frame()`. Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?

I have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.


---

Comment by @DeRhamSource created at 2019-10-13 16:43:55

Replying to [comment:88 egourgoulhon]:
> I have also performed some changes in the code, replacing `self._dest_map` by `self._dest_map.restrict(domain)` in `DifferentiableVectorBundle.section()` and `DifferentiableVectorBundle.local_frame()`.

Thank you! :)

> Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?

In this case, I do not agree. Altough actual frames of general tensor bundles are not implemented, vector frames _induce_ them canonically. In the whole preexisting code, a vector frame is used for declaration and output of tensor fields. So, in my opinion, we should keep it this way (at least until general tensor product bundles are implemented). However, a corresponding remark in the documentation might be a good idea.

> I have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.

The class `TopologicalVectorBundle` consists of these methods and `TensorBundle` inherits from it, so it must carry out these methods as well. But since all its features are already regulated through the manifold's framework (tensor bundles are induced by differentiable charts and their transitions), the vector bundle implementation is obsolete in this case and the methods must be overwritten. Likewise, a remark in the documentation might be useful, here. Do you have a better solution in mind?

**Another thing:** In a next step, I want to inherit `TensorField` from `Section` (and perhaps `VectorFrame` from `LocalFrame`) in order to minimize code redundancies. Keeping in mind, when my modifications in #28519 are finished, `Section` and `TrivialSection` should be adapted anyways.


---

Comment by egourgoulhon created at 2019-10-13 18:00:18

Replying to [comment:89 gh-DeRhamSource]:
> 
> > Besides, I have made the latter return `NotImplementedError` when the tensor bundle is not the tangent bundle, because in such a case, a `VectorFrame` should not be returned. Do you agree? Shall we maintain the alias `vector_frame` for `local_frame`?
> 
> In this case, I do not agree. Altough actual frames of general tensor bundles are not implemented, vector frames _induce_ them canonically. In the whole preexisting code, a vector frame is used for declaration and output of tensor fields. So, in my opinion, we should keep it this way (at least until general tensor product bundles are implemented). 

OK, I see.

>However, a corresponding remark in the documentation might be a good idea.

Yes, there should be a warning that the returned object is actually not a bundle local frame, although it canonically determines it, as you say. The same thing holds for the method `trivialization()`, which returns a chart on the base manifold and actually not a trivialization in the sense of a vector bundle.

> 
> > I have some question regarding the methods `atlas()`, `change_of_frame()`, `changes_of_frame`, `coframes()`, `frames()`, `set_change_of_frame()`,  `transition()`, `transitions()` of class `DifferentiableVectorBundle`: are these methods really necessary? As currently implemented, they return only features of the base manifold. In particular, none of them is using the tensor type `(k, l)` of `self`.
> 
> The class `TopologicalVectorBundle` consists of these methods and `TensorBundle` inherits from it, so it must carry out these methods as well. But since all its features are already regulated through the manifold's framework (tensor bundles are induced by differentiable charts and their transitions), the vector bundle implementation is obsolete in this case and the methods must be overwritten. 

OK.

> Likewise, a remark in the documentation might be useful, here. 

Indeed.

>Do you have a better solution in mind?
> 

Not at the moment.

I let you revert the `NotImplementedError` and add the relevent warnings.

> **Another thing:** In a next step, I want to inherit `TensorField` from `Section` (and perhaps `VectorFrame` from `LocalFrame`) in order to minimize code redundancies.

Yes, I guess by "next step", you mean "in another ticket".


---

Comment by git created at 2019-10-13 22:08:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-13 22:12:55

Replying to [comment:90 egourgoulhon]:
> I let you revert the `NotImplementedError` and add the relevent warnings.

Done.

Would you take a short look for typos etc?

Also, I've changed the name of the base space in the documentation of `TensorBundle` to `N` instead of `U`.

Do you agree so far? Any more suggestions?

> Yes, I guess by "next step", you mean "in another ticket".

Of course. :)


---

Comment by @DeRhamSource created at 2019-10-13 22:16:53

Ah, I've also fixed the filter algorithms for the frames. (Unfortunately, I missed it in the commit message.)


---

Comment by @DeRhamSource created at 2019-10-14 07:59:02

There are some more things I noticed. I'm going to take of it later this day.


---

Comment by git created at 2019-10-14 09:30:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-14 09:32:13

Please take a look. I made many modifications and fixes in the documentation.


---

Comment by git created at 2019-10-14 11:53:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2019-10-14 11:57:59

Replying to [comment:96 gh-DeRhamSource]:
> Please take a look. I made many modifications and fixes in the documentation.

Thanks for the improvements in the documentation!
I've just pushed a minor fix in some `:meth:` hyperlink. 
I think the ticket is ready to go.


---

Comment by @DeRhamSource created at 2019-10-14 12:29:46

Just wait a moment. I have still some fixes, coming soon.


---

Comment by git created at 2019-10-14 13:17:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-14 13:18:31

There we go. I had a short discussion with a collegue of mine in which I noticed some more things. But that should be it. Please take a short look.


---

Comment by git created at 2019-10-14 13:26:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2019-10-14 19:59:32

Changing status from needs_review to needs_work.


---

Comment by egourgoulhon created at 2019-10-14 19:59:32

I've just discovered that, with this ticket branch, the [AdS notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_anti_de_Sitter.ipynb) stalls at cell 92, which introduces the transition map from conformal coordinates to Poincaré coordinates. Running the notebook with Sage 9.0.beta1 shows no problem. So the issue is caused by some piece of code in this ticket. 

Cell 92 seems to run forever, or at least to take a very long time. After 15 min or so, I halted it by Kernel -> Interrupt in the Jupyter menu. It appeared then that the code was stalled in line 1147 of `src/sage/manifolds/differentiable/chart.py`:

```
   ch_basis_inv = ch_basis.inverse()
```

So I strongly suspect the issue to be due to the change in the computation of inverse automorphism fields introduced in this ticket.


---

Comment by @DeRhamSource created at 2019-10-14 20:16:44

This could be related to #28189, especially to the bug reported afterwards which has been partially fixed in #28570 (was this particular ticket merged in your testing?).

If there are no other options left, we can readd the SR enforcement for now. However, I suggest to construct a minimal example where this particular issue fails and report the error, since it seems to be a bigger problem deep in framework of matrices.


---

Comment by @DeRhamSource created at 2019-10-14 20:27:19

Wait. Why does the program compute the inverse anyway? This should not happen automatically, right? At least, in the next cell the inverse is set manually.


---

Comment by egourgoulhon created at 2019-10-14 20:47:49

Replying to [comment:105 gh-DeRhamSource]:
> Wait. Why does the program compute the inverse anyway? This should not happen automatically, right? At least, in the next cell the inverse is set manually.
It computes the inverse of the Jacobian matrix, not the inverse of the transition map.


---

Comment by @DeRhamSource created at 2019-10-15 09:34:46

Okay, I started some debugging process. And apparently, this has nothing to do with the aforementioned issue.

Since the algebra of scalar fields is not a field, the inversion algorithm is division free using adjugate matrices. I guess, this takes much more time than sophisticated algorithms on fields. My suggestion is to claim (at least for sage) that this algebra is a field (like it is done for the symbolic ring). I already started some testing and the computation time shrunk enormously. I've committed the changes.


---

Comment by git created at 2019-10-15 09:34:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-15 10:55:19

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2019-10-16 10:28:56

Just to tell that I am mostly AFK these days. I'll have a look at the ticket on Friday.


---

Comment by egourgoulhon created at 2019-10-18 14:20:39

Changing status from needs_review to needs_work.


---

Comment by egourgoulhon created at 2019-10-18 14:20:39

I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). 

I would propose that you revert to the original version of `AutomorphismFieldParal.__invert__()` and open a new ticket to discus the removal of `SR` enforcement in the inversion of automorphism fields. After all, this is not directly connected to vector bundles and therefore does not belong to the current ticket.


---

Comment by @DeRhamSource created at 2019-10-18 15:02:27

Replying to [comment:111 egourgoulhon]:
> I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). 

Yeah, I feel not comfortable with this solution as well.

> I would propose that you revert to the original version of `AutomorphismFieldParal.__invert__()` and open a new ticket to discus the removal of `SR` enforcement in the inversion of automorphism fields. After all, this is not directly connected to vector bundles and therefore does not belong to the current ticket. 

This is not entirely true. If the vector bundle is similarly complicated as the example in the notebook, it runs into the same problem.

However, forcing sage to use the inversion algorithm for fields would be very nice!

I will open a ticket on that and suggest this in the sage-devel group. Meanwhile, I undo the SR enforcement at least for tensor fields.


---

Comment by egourgoulhon created at 2019-10-18 15:07:14

Replying to [comment:112 gh-DeRhamSource]:
> Replying to [comment:111 egourgoulhon]:
> > I don't agree with the proposed fix for it goes against mathematical correctness: the method `is_field()` of `ScalarFieldAlgebra` shall not return `True`, the algebra of scalar fields being not a field (in particular, it is not an integral domain). 
> 
> Yeah, I feel not comfortable with this solution as well.
> 

Besides, it generated a lot of doctest errors as you can check in the patchbot report. 

> 
> I will open a ticket on that and suggest this in the sage-devel group. Meanwhile, I undo the SR enforcement at least for tensor fields.

OK, very good.


---

Comment by git created at 2019-10-18 15:55:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-18 15:57:38

Committed. Please check, again.


---

Comment by @DeRhamSource created at 2019-10-18 16:24:59

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2019-10-18 20:33:08

Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). 

Side note: `self.is_zero()`, as invoked in `ChartFunction.is_unit()`, can be very time consuming for large symbolic expressions, since it is trying to simplify the expression to zero. In this respect, the use of `is_trivial_zero()` in `ScalarField.is_unit()` is better.


---

Comment by egourgoulhon created at 2019-10-18 20:35:25

Btw, thanks for having moved the treatment of autormorphism field inverses to #28629.


---

Comment by @DeRhamSource created at 2019-10-18 22:12:03

Replying to [comment:117 egourgoulhon]:
> Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). 

I'm not quite sure, but I think this method is mandatory when using the division free algorithm. And the division free algorithm is invoked when changes of frames are established. In general, for vector bundles, frames may be distributed over serveral chart domains, for which the SR enforcement method fails. So yes, this is related to this ticket. I'm not completely satisfied with this either. As soon as the issue in ticket #28629 is solved, this snippet can be deleted again. Should I add a comment in the code about this?

> Side note: `self.is_zero()`, as invoked in `ChartFunction.is_unit()`, can be very time consuming for large symbolic expressions, since it is trying to simplify the expression to zero. In this respect, the use of `is_trivial_zero()` in `ScalarField.is_unit()` is better.

I agree, this is certainly better.


---

Comment by @DeRhamSource created at 2019-10-18 22:23:51

Furthermore, I would add a comment in the corresponding ticket, so that this code snippet gets not lost or forgotten.

What do you say?


---

Comment by git created at 2019-10-19 20:12:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-20 12:09:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DeRhamSource created at 2019-10-20 12:11:06

Since default frames are somehow obligatoric for further use, I added them. Please check. Sorry for that. But I think, this modification is very essential.


---

Comment by egourgoulhon created at 2019-10-21 09:45:11

Replying to [comment:119 gh-DeRhamSource]:
> Replying to [comment:117 egourgoulhon]:
> > Again, I don't like so much the methods `is_unit()` added to the classes `ChartFunction` and `ScalarField`. They don't reflect fully the mathematical meaning of being a unit element of a ring. Do you really need these in this ticket? (I don't see clearly the connection with vector bundles). 
> 
> I'm not quite sure, but I think this method is mandatory when using the division free algorithm. And the division free algorithm is invoked when changes of frames are established. In general, for vector bundles, frames may be distributed over serveral chart domains, for which the SR enforcement method fails. So yes, this is related to this ticket. I'm not completely satisfied with this either. As soon as the issue in ticket #28629 is solved, this snippet can be deleted again. 

Thanks for your answer. 

>Should I add a comment in the code about this?

I've seen that you have done it; thanks.


---

Comment by egourgoulhon created at 2019-10-21 09:45:40

Replying to [comment:124 gh-DeRhamSource]:
> Since default frames are somehow obligatoric for further use, I added them. Please check. Sorry for that. But I think, this modification is very essential.

LGTM.


---

Comment by egourgoulhon created at 2019-10-21 09:46:24

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2019-10-21 09:46:24

Thank you very much for this very valuable addition to Sage!


---

Comment by vbraun created at 2019-10-23 22:58:08

Resolution: fixed
