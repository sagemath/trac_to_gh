# Issue 16522: Fix install_package()

archive/issues_016522.json:
```json
{
    "body": "CC:  @williamstein\n\n`install_package()` fails because `standard_packages()` does not parse correctly the output given by the shell command `sage --standard`.\n\nSimilar for `optional_packages()` and `experimental_packages`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16759\n\n",
    "created_at": "2014-08-04T17:59:49Z",
    "labels": [
        "component: misc",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Fix install_package()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16522",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @williamstein

`install_package()` fails because `standard_packages()` does not parse correctly the output given by the shell command `sage --standard`.

Similar for `optional_packages()` and `experimental_packages`.

Issue created by migration from https://trac.sagemath.org/ticket/16759





---

archive/issue_comments_217105.json:
```json
{
    "body": "It also looks like `sage --standard` is broken: it is using old package information. For example, it thinks that the current version of Sage is 5.13. Also, `pillow` is now a standard package, replacing `pil`, but `pil` shows up.\n\nI'm not sure where to get a list of all of the current standard packages, but once we had that, we might be able to get the version numbers from `http://www.sagemath.org/packages/upstream/`.",
    "created_at": "2014-08-04T21:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217105",
    "user": "https://github.com/jhpalmieri"
}
```

It also looks like `sage --standard` is broken: it is using old package information. For example, it thinks that the current version of Sage is 5.13. Also, `pillow` is now a standard package, replacing `pil`, but `pil` shows up.

I'm not sure where to get a list of all of the current standard packages, but once we had that, we might be able to get the version numbers from `http://www.sagemath.org/packages/upstream/`.



---

archive/issue_comments_217106.json:
```json
{
    "body": "Replying to [comment:1 jhpalmieri]:\n> It also looks like `sage --standard` is broken: it is using old package information.\nI would say that `sage --standard` is doing the right thing, but somehow `http://www.sagemath.org/packages/standard/` is no longer updated. The right solution is updating the website script to take into account the new git-style packages (which is certainly a different issue than the one this ticket is about).",
    "created_at": "2014-08-04T21:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217106",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:1 jhpalmieri]:
> It also looks like `sage --standard` is broken: it is using old package information.
I would say that `sage --standard` is doing the right thing, but somehow `http://www.sagemath.org/packages/standard/` is no longer updated. The right solution is updating the website script to take into account the new git-style packages (which is certainly a different issue than the one this ticket is about).



---

archive/issue_comments_217107.json:
```json
{
    "body": "...that being said, it makes no sense to work on this ticket if the underlying `sage --standard` command isn't fixed.",
    "created_at": "2014-08-04T21:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217107",
    "user": "https://github.com/jdemeyer"
}
```

...that being said, it makes no sense to work on this ticket if the underlying `sage --standard` command isn't fixed.



---

archive/issue_comments_217108.json:
```json
{
    "body": "Along similar lines, does `sage -i` work properly with installing optional packages that have both \"old\" and \"new\" package versions?\n\nBut I agree with William that this is important.  I'm working at a Sage Days prep right now with exactly the kind of people William was talking about in the thread that led to this - people who know quite a bit of math and might want to use some specialized optional package (say, polymake) but would need an awful lot of hand-holding to make it through some of this weird behavior.",
    "created_at": "2014-08-04T23:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217108",
    "user": "https://github.com/kcrisman"
}
```

Along similar lines, does `sage -i` work properly with installing optional packages that have both "old" and "new" package versions?

But I agree with William that this is important.  I'm working at a Sage Days prep right now with exactly the kind of people William was talking about in the thread that led to this - people who know quite a bit of math and might want to use some specialized optional package (say, polymake) but would need an awful lot of hand-holding to make it through some of this weird behavior.



---

archive/issue_comments_217109.json:
```json
{
    "body": "Here's an option: turn off `install_package` until we can fix this. See #16760.",
    "created_at": "2014-08-05T01:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217109",
    "user": "https://github.com/jhpalmieri"
}
```

Here's an option: turn off `install_package` until we can fix this. See #16760.



---

archive/issue_comments_217110.json:
```json
{
    "body": "This might be related to the case of the tarball : you use `Pillow-2.2.2.tar.gz`. it turns out that `sage -sh sage-fix-pkg-checksums`, that computes the checksumes, will treat only lower-case-named tarballs ... except on Macs, whose filesystems will find `Pillow-2.2.2.tar.gz` when asked for `pillow-2.2.2.tar.gz`. See #18229 for discussion.\n\nThis is documented in the [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html), paragraph \"Directory structure\", that states :\n\n> \"The build scripts and associated files are in a subdirectory SAGE_ROOT/build/pkgs/package, where you replace package with a lower-case version of the upstream project name.\"\n\nI suppose that the original Pillow porter might have been a Mac user, and that nobody caught the problem.\n\nHTH,",
    "created_at": "2015-04-30T06:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217110",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

This might be related to the case of the tarball : you use `Pillow-2.2.2.tar.gz`. it turns out that `sage -sh sage-fix-pkg-checksums`, that computes the checksumes, will treat only lower-case-named tarballs ... except on Macs, whose filesystems will find `Pillow-2.2.2.tar.gz` when asked for `pillow-2.2.2.tar.gz`. See #18229 for discussion.

This is documented in the [Developer's guide](http://www.sagemath.org/doc/developer/packaging.html), paragraph "Directory structure", that states :

> "The build scripts and associated files are in a subdirectory SAGE_ROOT/build/pkgs/package, where you replace package with a lower-case version of the upstream project name."

I suppose that the original Pillow porter might have been a Mac user, and that nobody caught the problem.

HTH,



---

archive/issue_comments_217111.json:
```json
{
    "body": "From the `sage-fix-pkg-checksums` script, it looks like the case for the directory name (in `SAGE_ROOT/build/pkgs/`) must match the case for the tarball (except on OS X). Why not change the policy that currently requires the directory to be all lower-case? Would it cause upgrade problems on OS X if we renamed \"pillow\" to \"Pillow\", given the stupid way it deals with case?",
    "created_at": "2015-04-30T16:11:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217111",
    "user": "https://github.com/jhpalmieri"
}
```

From the `sage-fix-pkg-checksums` script, it looks like the case for the directory name (in `SAGE_ROOT/build/pkgs/`) must match the case for the tarball (except on OS X). Why not change the policy that currently requires the directory to be all lower-case? Would it cause upgrade problems on OS X if we renamed "pillow" to "Pillow", given the stupid way it deals with case?



---

archive/issue_comments_217112.json:
```json
{
    "body": "Or rewrite `sage-fix-pkg-checksums` to convert the tarball to lowercase to determine the directory name. That might be a better choice. \n\n```diff\ndiff --git a/src/bin/sage-fix-pkg-checksums b/src/bin/sage-fix-pkg-checksums\nindex 65542b9..b42463d 100755\n--- a/src/bin/sage-fix-pkg-checksums\n+++ b/src/bin/sage-fix-pkg-checksums\n@@ -11,7 +11,7 @@ fi\n for upstream in \"$@\"\n do\n     tarball=`basename \"$upstream\"`\n-    pkg_name=${tarball%%-*}\n+    pkg_name=`echo ${tarball%%-*} | tr '[:upper:]' '[:lower:]'`\n     pkg_compression=${tarball#*.tar}   # gz or bz2\n     if [ -d \"$SAGE_ROOT/build/pkgs/$pkg_name\" ]; then\n         sage_version=`cat \"$SAGE_ROOT/build/pkgs/$pkg_name/package-version.txt\" | sed 's/\\.p[0-9][0-9]*$//'`\n```\n\nMaybe print a warning whenever the case is changed, just to be safe?",
    "created_at": "2015-04-30T16:21:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217112",
    "user": "https://github.com/jhpalmieri"
}
```

Or rewrite `sage-fix-pkg-checksums` to convert the tarball to lowercase to determine the directory name. That might be a better choice. 

```diff
diff --git a/src/bin/sage-fix-pkg-checksums b/src/bin/sage-fix-pkg-checksums
index 65542b9..b42463d 100755
--- a/src/bin/sage-fix-pkg-checksums
+++ b/src/bin/sage-fix-pkg-checksums
@@ -11,7 +11,7 @@ fi
 for upstream in "$@"
 do
     tarball=`basename "$upstream"`
-    pkg_name=${tarball%%-*}
+    pkg_name=`echo ${tarball%%-*} | tr '[:upper:]' '[:lower:]'`
     pkg_compression=${tarball#*.tar}   # gz or bz2
     if [ -d "$SAGE_ROOT/build/pkgs/$pkg_name" ]; then
         sage_version=`cat "$SAGE_ROOT/build/pkgs/$pkg_name/package-version.txt" | sed 's/\.p[0-9][0-9]*$//'`
```

Maybe print a warning whenever the case is changed, just to be safe?



---

archive/issue_comments_217113.json:
```json
{
    "body": "Oops, there are more changes required: we need to keep track of `pkg_name` for the directory, and also the version with the original case for use in \n\n```\n            echo \"tarball=$original_pkg_name-VERSION.tar$pkg_compression\" > $checksums\n```\n",
    "created_at": "2015-04-30T16:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217113",
    "user": "https://github.com/jhpalmieri"
}
```

Oops, there are more changes required: we need to keep track of `pkg_name` for the directory, and also the version with the original case for use in 

```
            echo "tarball=$original_pkg_name-VERSION.tar$pkg_compression" > $checksums
```




---

archive/issue_comments_217114.json:
```json
{
    "body": "Replying to [comment:8 jhpalmieri]:\nWould you mind joining [this thead](https://groups.google.com/forum/#!topic/sage-devel/2CsisPTWBD8) on sage-devel ? There is not only a (small) technical problem, but also a policy problem, and this thread i probably not the right place to discuss it. In other words, we **know** that at least the `sage-fix-spkg-checksums` script won't work on mixedCase tarballs, and I wonder what will be broken if this script is fixed to accept mixed-case tarball names. Leif thinks that's only a convention, but I am not so sure...\n\nUpdate : Just saw your patch. It fixes the technical problem, but what other holes does it open ?\n\n> From the `sage-fix-pkg-checksums` script, it looks like the case for the directory name (in `SAGE_ROOT/build/pkgs/`) must match the case for the tarball (except on OS X). Why not change the policy that currently requires the directory to be all lower-case? Would it cause upgrade problems on OS X if we renamed \"pillow\" to \"Pillow\", given the stupid way it deals with case?",
    "created_at": "2015-04-30T16:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217114",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Replying to [comment:8 jhpalmieri]:
Would you mind joining [this thead](https://groups.google.com/forum/#!topic/sage-devel/2CsisPTWBD8) on sage-devel ? There is not only a (small) technical problem, but also a policy problem, and this thread i probably not the right place to discuss it. In other words, we **know** that at least the `sage-fix-spkg-checksums` script won't work on mixedCase tarballs, and I wonder what will be broken if this script is fixed to accept mixed-case tarball names. Leif thinks that's only a convention, but I am not so sure...

Update : Just saw your patch. It fixes the technical problem, but what other holes does it open ?

> From the `sage-fix-pkg-checksums` script, it looks like the case for the directory name (in `SAGE_ROOT/build/pkgs/`) must match the case for the tarball (except on OS X). Why not change the policy that currently requires the directory to be all lower-case? Would it cause upgrade problems on OS X if we renamed "pillow" to "Pillow", given the stupid way it deals with case?



---

archive/issue_comments_217115.json:
```json
{
    "body": "Replying to [comment:11 charpent]:\n> Update : Just saw your patch. It fixes the technical problem, but what other holes does it open ?\n\nGood question. Since we want to support OS X, we cannot allow different files whose names are the same except for case differences, so we cannot allow different directories `build/Pillow` and `build/PiLlOW`. So I hope it doesn't open any holes. As I suggested, maybe the script should print a warning if there are case differences between the tarball and the directory: \"Note: case mismatch between upstream/Pillow-2.2.2.tar.gz and build/pkgs/pillow.\"",
    "created_at": "2015-04-30T16:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217115",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:11 charpent]:
> Update : Just saw your patch. It fixes the technical problem, but what other holes does it open ?

Good question. Since we want to support OS X, we cannot allow different files whose names are the same except for case differences, so we cannot allow different directories `build/Pillow` and `build/PiLlOW`. So I hope it doesn't open any holes. As I suggested, maybe the script should print a warning if there are case differences between the tarball and the directory: "Note: case mismatch between upstream/Pillow-2.2.2.tar.gz and build/pkgs/pillow."



---

archive/issue_comments_217116.json:
```json
{
    "body": "See #18344.",
    "created_at": "2015-04-30T18:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217116",
    "user": "https://github.com/jhpalmieri"
}
```

See #18344.



---

archive/issue_comments_217117.json:
```json
{
    "body": "I'd keep all (Sage-internal) \"package names\" (i.e., folders) in `build/pkgs/` lowercase.\n\nWe should IMHO simply be more flexible w.r.t. upstream tarballs (their names and also their top-level folders).\n\nThe easiest way to achieve this is to record the upstream tarball's name as well; currently we only have `package-version.txt`, which doesn't contain anything but what we consider the version of the package.\n\nIn the long run, we wouldn't have to rename or modify upstream tarballs (which was the goal anyway), and could even provide the original URL(s) to obtain them, at least as an alternative, and also for documentation purposes.\n\n(There's more data we could move/replicate from `SPKG.txt` into more machine-readable form, finally creating `SPKG.txt` from, or augmenting it with data from other meta-data files, such as authors, copyright, upstream contact/address for bug reports, etc.)",
    "created_at": "2015-05-01T21:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217117",
    "user": "https://github.com/nexttime"
}
```

I'd keep all (Sage-internal) "package names" (i.e., folders) in `build/pkgs/` lowercase.

We should IMHO simply be more flexible w.r.t. upstream tarballs (their names and also their top-level folders).

The easiest way to achieve this is to record the upstream tarball's name as well; currently we only have `package-version.txt`, which doesn't contain anything but what we consider the version of the package.

In the long run, we wouldn't have to rename or modify upstream tarballs (which was the goal anyway), and could even provide the original URL(s) to obtain them, at least as an alternative, and also for documentation purposes.

(There's more data we could move/replicate from `SPKG.txt` into more machine-readable form, finally creating `SPKG.txt` from, or augmenting it with data from other meta-data files, such as authors, copyright, upstream contact/address for bug reports, etc.)



---

archive/issue_comments_217118.json:
```json
{
    "body": "Replying to [comment:14 leif]:\n> I'd keep all (Sage-internal) \"package names\" (i.e., folders) in `build/pkgs/` lowercase.\n\nYes.\n\n> We should IMHO simply be more flexible w.r.t. upstream tarballs (their names and also their top-level folders).\n\nYes.\n\n> The easiest way to achieve this is to record the upstream tarball's name as well; currently we only have `package-version.txt`, which doesn't contain anything but what we consider the version of the package.\n\nThe tarball name (without the version) is stored in `checksums.ini` already.\n\nSee the proposal at #18344. I think that the tarball and the directory name should agree except possibly for case differences. I guess we could allow completely different names for the two, but that would make various parts of the system more complicated: `sage-fix-pkg-checksums`, `sage-spkg`, etc., not to mention making everything more opaque: why should a file `foo.tar.gz` be the right tarball for `build/pkgs/bar`?",
    "created_at": "2015-05-01T22:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217118",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:14 leif]:
> I'd keep all (Sage-internal) "package names" (i.e., folders) in `build/pkgs/` lowercase.

Yes.

> We should IMHO simply be more flexible w.r.t. upstream tarballs (their names and also their top-level folders).

Yes.

> The easiest way to achieve this is to record the upstream tarball's name as well; currently we only have `package-version.txt`, which doesn't contain anything but what we consider the version of the package.

The tarball name (without the version) is stored in `checksums.ini` already.

See the proposal at #18344. I think that the tarball and the directory name should agree except possibly for case differences. I guess we could allow completely different names for the two, but that would make various parts of the system more complicated: `sage-fix-pkg-checksums`, `sage-spkg`, etc., not to mention making everything more opaque: why should a file `foo.tar.gz` be the right tarball for `build/pkgs/bar`?



---

archive/issue_comments_217119.json:
```json
{
    "body": "Replying to [comment:15 jhpalmieri]:\n> The tarball name (without the version) is stored in `checksums.ini` already.\n\nI disregarded M$ Windows files... ;-)",
    "created_at": "2015-05-01T22:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217119",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:15 jhpalmieri]:
> The tarball name (without the version) is stored in `checksums.ini` already.

I disregarded M$ Windows files... ;-)



---

archive/issue_comments_217120.json:
```json
{
    "body": "Related:\n\n```\n> I tried to install pyopenssl in order to run sagenb in sage 6.6 with\n> secure=True. It fails with Error 404, see below.\n> \n> Regards,\n> \n> CH\n> \n> I get:\n> $ ./sage -i pyopenssl\n> Attempting to download package pyopenssl\n>>>> Checking online list of optional packages.\n> [.]\n>>>> Found pyopenssl-0.13.p0\n>>>> Trying to download http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg\n> ....\n> IOError: [Errno 404] Not Found:\n> '//www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg'\n> Error: failed to download package pyopenssl-0.13.p0\n> \n> $ LANG=C wget http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg\n> --2015-05-03 16:02:09--\n> http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg\n> Resolving www.sagemath.org (www.sagemath.org)... 128.208.178.250\n> Connecting to www.sagemath.org (www.sagemath.org)|128.208.178.250|:80... connected.\n> HTTP request sent, awaiting response... 404 Not Found\n> 2015-05-03 16:02:10 ERROR 404: Not Found.\n\nUnfortunately setting SAGE_SERVER is borked as well (because the mirrors still\nhave 'spkg/', not 'packages/', which the scripts simply ignore), but you could\nuse a mirror \"manually\":\n\n\n  wget http://mirror.switch.ch/mirror/sagemath/spkg/optional/pyopenssl-0.13.p0.spkg\n\n  ./sage -i pyopenssl-0.13.p0.spkg   # Note the extension\n\n```\n\n\nSetting `SAGE_SERVER` leads into an endless loop: ;-)\n\n```sh\nSAGE_SERVER=\"http://sage.scipy.org/sage/\" ./sage --optional\nUsing Sage Server http://sage.scipy.org/sage/packages\nHTTP Error 404: Not Found\n\n\n\n********************************************************************************\n\n\n\nError contacting http://sage.scipy.org/sage/packages/optional/list. Try using an alternative server.\nFor example, from the bash prompt try typing\n\n   export SAGE_SERVER=http://sage.scipy.org/sage/\n\nthen try again.\n\n\n\n********************************************************************************\n```\n\n\nThe above [fails for a different reason](http://sage.scipy.org/), but try yourself with some other mirror...",
    "created_at": "2015-05-04T02:03:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217120",
    "user": "https://github.com/nexttime"
}
```

Related:

```
> I tried to install pyopenssl in order to run sagenb in sage 6.6 with
> secure=True. It fails with Error 404, see below.
> 
> Regards,
> 
> CH
> 
> I get:
> $ ./sage -i pyopenssl
> Attempting to download package pyopenssl
>>>> Checking online list of optional packages.
> [.]
>>>> Found pyopenssl-0.13.p0
>>>> Trying to download http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg
> ....
> IOError: [Errno 404] Not Found:
> '//www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg'
> Error: failed to download package pyopenssl-0.13.p0
> 
> $ LANG=C wget http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg
> --2015-05-03 16:02:09--
> http://www.sagemath.org/spkg/optional/pyopenssl-0.13.p0.spkg
> Resolving www.sagemath.org (www.sagemath.org)... 128.208.178.250
> Connecting to www.sagemath.org (www.sagemath.org)|128.208.178.250|:80... connected.
> HTTP request sent, awaiting response... 404 Not Found
> 2015-05-03 16:02:10 ERROR 404: Not Found.

Unfortunately setting SAGE_SERVER is borked as well (because the mirrors still
have 'spkg/', not 'packages/', which the scripts simply ignore), but you could
use a mirror "manually":


  wget http://mirror.switch.ch/mirror/sagemath/spkg/optional/pyopenssl-0.13.p0.spkg

  ./sage -i pyopenssl-0.13.p0.spkg   # Note the extension

```


Setting `SAGE_SERVER` leads into an endless loop: ;-)

```sh
SAGE_SERVER="http://sage.scipy.org/sage/" ./sage --optional
Using Sage Server http://sage.scipy.org/sage/packages
HTTP Error 404: Not Found



********************************************************************************



Error contacting http://sage.scipy.org/sage/packages/optional/list. Try using an alternative server.
For example, from the bash prompt try typing

   export SAGE_SERVER=http://sage.scipy.org/sage/

then try again.



********************************************************************************
```


The above [fails for a different reason](http://sage.scipy.org/), but try yourself with some other mirror...



---

archive/issue_comments_217121.json:
```json
{
    "body": "I vote for removing the `install_package()` command. Installing packages from within Sage can never work properly anyway:\n1. for some packages, you need to rebuild the Sage library, which cannot be done in Sage.\n2. some packages might need a change in environment variables (e.g. `ccache`) and that can only be done if `sage-env` is re-run after installing the package.",
    "created_at": "2015-09-09T11:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217121",
    "user": "https://github.com/jdemeyer"
}
```

I vote for removing the `install_package()` command. Installing packages from within Sage can never work properly anyway:
1. for some packages, you need to rebuild the Sage library, which cannot be done in Sage.
2. some packages might need a change in environment variables (e.g. `ccache`) and that can only be done if `sage-env` is re-run after installing the package.



---

archive/issue_comments_217122.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2015-09-09T13:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217122",
    "user": "https://github.com/jdemeyer"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_217123.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-09T13:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217123",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_217124.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-09T13:53:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217124",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_217125.json:
```json
{
    "body": "Channeling Nathann: regarding changes like `sage -i cryptominisat && make`, do we need to say something about being in `SAGE_ROOT` first?\n\nThis is no longer a stopgap, so in `misc.package.install_package`, should we be returning some other error message? Maybe `NotImplementedError`? I agree that `install_package('blah')` won't work much of the time for the reasons you give, so a deprecation isn't the right course of action, but a stopgap implies that the situation is temporary and is going to be fixed. This situation may be temporary, but only in the sense that `install_package()` may be completely deleted eventually. Also, with a stopgap, you only get the message the first time you run it. If we raise an error, you will get it every time, which might be better.\n\nI'm not sure if the changes to `trac.py` belong here or on a separate ticket. I don't care that much, though.\n\nAlso, please make the following change (or something similar):\n\n```diff\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex de4d206..9d727d9 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -19,7 +19,7 @@ components:\n Use the :func:``optional_packages`` command to list all\n optional packages available on the central Sage server.\n \n-Actually installing the packages should be done via the Sage command\n+Actually installing the packages should be done via the command\n line, using the following commands:\n \n - ``sage -i PACKAGE_NAME`` -- install the given package\n```\n\nAlso, the sentences at the top of that file describing Sage packages are outdated and should probably just be replaced with a pointer to the Developer's Guide. If you are willing to do that, too, that would be nice.",
    "created_at": "2015-09-11T22:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217125",
    "user": "https://github.com/jhpalmieri"
}
```

Channeling Nathann: regarding changes like `sage -i cryptominisat && make`, do we need to say something about being in `SAGE_ROOT` first?

This is no longer a stopgap, so in `misc.package.install_package`, should we be returning some other error message? Maybe `NotImplementedError`? I agree that `install_package('blah')` won't work much of the time for the reasons you give, so a deprecation isn't the right course of action, but a stopgap implies that the situation is temporary and is going to be fixed. This situation may be temporary, but only in the sense that `install_package()` may be completely deleted eventually. Also, with a stopgap, you only get the message the first time you run it. If we raise an error, you will get it every time, which might be better.

I'm not sure if the changes to `trac.py` belong here or on a separate ticket. I don't care that much, though.

Also, please make the following change (or something similar):

```diff
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index de4d206..9d727d9 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -19,7 +19,7 @@ components:
 Use the :func:``optional_packages`` command to list all
 optional packages available on the central Sage server.
 
-Actually installing the packages should be done via the Sage command
+Actually installing the packages should be done via the command
 line, using the following commands:
 
 - ``sage -i PACKAGE_NAME`` -- install the given package
```

Also, the sentences at the top of that file describing Sage packages are outdated and should probably just be replaced with a pointer to the Developer's Guide. If you are willing to do that, too, that would be nice.



---

archive/issue_comments_217126.json:
```json
{
    "body": "Replying to [comment:28 jhpalmieri]:\n> Channeling Nathann: regarding changes like `sage -i cryptominisat && make`, do we need to say something about being in `SAGE_ROOT` first?\nGood point. I'll replace this by `sage -i cryptominisat sagelib` which doesn't have the `SAGE_ROOT` problem.",
    "created_at": "2015-09-12T07:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217126",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:28 jhpalmieri]:
> Channeling Nathann: regarding changes like `sage -i cryptominisat && make`, do we need to say something about being in `SAGE_ROOT` first?
Good point. I'll replace this by `sage -i cryptominisat sagelib` which doesn't have the `SAGE_ROOT` problem.



---

archive/issue_comments_217127.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-12T07:40:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217127",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217128.json:
```json
{
    "body": "Replying to [comment:28 jhpalmieri]:\n> replaced with a pointer to the Developer's Guide.\nI don't think it's technically possible to have an actual link to the Developer's Guide, but I will change the wording.",
    "created_at": "2015-09-12T08:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217128",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:28 jhpalmieri]:
> replaced with a pointer to the Developer's Guide.
I don't think it's technically possible to have an actual link to the Developer's Guide, but I will change the wording.



---

archive/issue_comments_217129.json:
```json
{
    "body": "Replying to [comment:28 jhpalmieri]:\n> I'm not sure if the changes to `trac.py` belong here or on a separate ticket.\nIt's really just a deprecation that I added. Pretty innocent.",
    "created_at": "2015-09-12T08:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217129",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:28 jhpalmieri]:
> I'm not sure if the changes to `trac.py` belong here or on a separate ticket.
It's really just a deprecation that I added. Pretty innocent.



---

archive/issue_comments_217130.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-12T08:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217131.json:
```json
{
    "body": "John, I think I made all the changes you proposed.",
    "created_at": "2015-09-12T08:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217131",
    "user": "https://github.com/jdemeyer"
}
```

John, I think I made all the changes you proposed.



---

archive/issue_comments_217132.json:
```json
{
    "body": "Okay, looks good. What do we do about the files\n\n```\nsrc/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\nsrc/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\nsrc/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n```\n\nMaybe I can handle the last one:\n\n```diff\ndiff --git a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\nindex 93afc85..ef129b1 100644\n--- a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n+++ b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n@@ -5,22 +5,11 @@ MPI which stands for message passing interface is a common library\n for parallel programming. There is a package mpi4py that builds on\n the top of mpi, and lets arbitrary python objects be passed between\n different processes. These packages are not part of the default\n-sage install. To install them do\n-\n-.. skip\n-\n-::\n-\n-    sage: optional_packages()\n-\n-Find the package name openmpi-\\* and mpi4py-\\*and do\n-\n-.. skip\n+sage install. To install them, from a shell prompt, run\n \n ::\n \n-    sage: install_package('openmpi-*')\n-    sage: install_package('mpi4py-*')\n+    sage -i openmpi mpi4py\n \n Note that openmpi takes a while to compile (15-20 minutes or so).\n Openmpi can be run on a cluster, however this requires some set up\n```\n\nBut the other two files refer to packages which are now archived (`vtk`) or are archived and almost certainly a bad idea to install (`python-2.5.1-framework`). We can change each instance of `install_package` to `sage -i ...` anyway; I'm not sure what else to suggest.",
    "created_at": "2015-09-12T21:25:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217132",
    "user": "https://github.com/jhpalmieri"
}
```

Okay, looks good. What do we do about the files

```
src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
```

Maybe I can handle the last one:

```diff
diff --git a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
index 93afc85..ef129b1 100644
--- a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
+++ b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
@@ -5,22 +5,11 @@ MPI which stands for message passing interface is a common library
 for parallel programming. There is a package mpi4py that builds on
 the top of mpi, and lets arbitrary python objects be passed between
 different processes. These packages are not part of the default
-sage install. To install them do
-
-.. skip
-
-::
-
-    sage: optional_packages()
-
-Find the package name openmpi-\* and mpi4py-\*and do
-
-.. skip
+sage install. To install them, from a shell prompt, run
 
 ::
 
-    sage: install_package('openmpi-*')
-    sage: install_package('mpi4py-*')
+    sage -i openmpi mpi4py
 
 Note that openmpi takes a while to compile (15-20 minutes or so).
 Openmpi can be run on a cluster, however this requires some set up
```

But the other two files refer to packages which are now archived (`vtk`) or are archived and almost certainly a bad idea to install (`python-2.5.1-framework`). We can change each instance of `install_package` to `sage -i ...` anyway; I'm not sure what else to suggest.



---

archive/issue_comments_217133.json:
```json
{
    "body": "Replying to [comment:35 jhpalmieri]:\n> Okay, looks good. What do we do about the files\n> {{{\n> src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\n> src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\n> src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n> }}}\n\nI know.... it's difficult. Since I see no sensible way to fix those files, I just left them alone.\n\nThe problem is that those files have a laundry list of old-style packages which are no longer supported. I see no sensible way of updating them, there is no point to replace `install_package(\"foo\")` by `./sage -i foo` if the latter doesn't actually work.",
    "created_at": "2015-09-12T22:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217133",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:35 jhpalmieri]:
> Okay, looks good. What do we do about the files
> {{{
> src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
> src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
> src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
> }}}

I know.... it's difficult. Since I see no sensible way to fix those files, I just left them alone.

The problem is that those files have a laundry list of old-style packages which are no longer supported. I see no sensible way of updating them, there is no point to replace `install_package("foo")` by `./sage -i foo` if the latter doesn't actually work.



---

archive/issue_comments_217134.json:
```json
{
    "body": "How about this:\n\n```diff\ndiff --git a/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst b/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\nindex 16df05f..01ee37f 100644\n--- a/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\n+++ b/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst\n@@ -1,6 +1,10 @@\n Installing Visualization Tools on Linux\n =======================================\n \n+.. warning::\n+\n+   The following instructions are outdated (2015-Sep).\n+\n This section assumes you are running linux. You may need\n administrator rights to complete this section. First try\n \ndiff --git a/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst b/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\nindex 05c27e8..2c6cec8 100644\n--- a/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\n+++ b/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst\n@@ -1,6 +1,11 @@\n Installing Visualization Software on OS X\n =========================================\n \n+\n+.. warning::\n+\n+   The following instructions are outdated (2015-Sep).\n+\n The first thing we need to do is rebuild Python to use OSX's\n frameworks, so that it can create graphical windows. To do this\n first from the terminal do\ndiff --git a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\nindex 93afc85..98d0edb 100644\n--- a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n+++ b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst\n@@ -1,6 +1,11 @@\n mpi4py\n ======\n \n+\n+.. warning::\n+\n+   The following instructions are outdated (2015-Sep).\n+\n MPI which stands for message passing interface is a common library\n for parallel programming. There is a package mpi4py that builds on\n the top of mpi, and lets arbitrary python objects be passed between\n```\n\nWe can also add a note to contact sage-support for help. What do you think?",
    "created_at": "2015-09-13T02:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217134",
    "user": "https://github.com/jhpalmieri"
}
```

How about this:

```diff
diff --git a/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst b/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
index 16df05f..01ee37f 100644
--- a/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
+++ b/src/doc/en/thematic_tutorials/numerical_sage/installation_linux.rst
@@ -1,6 +1,10 @@
 Installing Visualization Tools on Linux
 =======================================
 
+.. warning::
+
+   The following instructions are outdated (2015-Sep).
+
 This section assumes you are running linux. You may need
 administrator rights to complete this section. First try
 
diff --git a/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst b/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
index 05c27e8..2c6cec8 100644
--- a/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
+++ b/src/doc/en/thematic_tutorials/numerical_sage/installation_osx.rst
@@ -1,6 +1,11 @@
 Installing Visualization Software on OS X
 =========================================
 
+
+.. warning::
+
+   The following instructions are outdated (2015-Sep).
+
 The first thing we need to do is rebuild Python to use OSX's
 frameworks, so that it can create graphical windows. To do this
 first from the terminal do
diff --git a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
index 93afc85..98d0edb 100644
--- a/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
+++ b/src/doc/en/thematic_tutorials/numerical_sage/mpi4py.rst
@@ -1,6 +1,11 @@
 mpi4py
 ======
 
+
+.. warning::
+
+   The following instructions are outdated (2015-Sep).
+
 MPI which stands for message passing interface is a common library
 for parallel programming. There is a package mpi4py that builds on
 the top of mpi, and lets arbitrary python objects be passed between
```

We can also add a note to contact sage-support for help. What do you think?



---

archive/issue_comments_217135.json:
```json
{
    "body": "Replying to [comment:37 jhpalmieri]:\n> We can also add a note to contact sage-support for help. What do you think?\nIn order to move forward with this ticket, I made it a separate ticket: #19198",
    "created_at": "2015-09-13T07:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217135",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:37 jhpalmieri]:
> We can also add a note to contact sage-support for help. What do you think?
In order to move forward with this ticket, I made it a separate ticket: #19198



---

archive/issue_comments_217136.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-13T15:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217136",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_217137.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-14T19:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16522#issuecomment-217137",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
