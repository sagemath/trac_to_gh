# Issue 34344: Implement substitution in InfinitePolynomialRing

archive/issues_034344.json:
```json
{
    "body": "CC:  tscrim mhansen simonking\n\nKeywords: polynomial infinite substitution subs\n\nAdd the ability to substitute variables in `InfinitePolynomialRing`.\n\n\n```\nsage: R.<z> = InfinitePolynomialRing(QQ)\nsage: f = z[1] + z[1]*z[2]*z[3]\nsage: f.subs({z[1]:z[0]})\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\nInput In [3], in <cell line: 1>()\n----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})\n\nFile ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()\n    828 if str(gen) in kwds:\n    829     variables.append(kwds[str(gen)])\n--> 830 elif in_dict and gen in in_dict:\n    831     variables.append(in_dict[gen])\n    832 else:\n\nTypeError: unhashable type: 'InfinitePolynomialGen'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34581\n\n",
    "created_at": "2022-09-24T15:32:40Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "title": "Implement substitution in InfinitePolynomialRing",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34344",
    "user": "tkarn"
}
```
CC:  tscrim mhansen simonking

Keywords: polynomial infinite substitution subs

Add the ability to substitute variables in `InfinitePolynomialRing`.


```
sage: R.<z> = InfinitePolynomialRing(QQ)
sage: f = z[1] + z[1]*z[2]*z[3]
sage: f.subs({z[1]:z[0]})
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
Input In [3], in <cell line: 1>()
----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})

File ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()
    828 if str(gen) in kwds:
    829     variables.append(kwds[str(gen)])
--> 830 elif in_dict and gen in in_dict:
    831     variables.append(in_dict[gen])
    832 else:

TypeError: unhashable type: 'InfinitePolynomialGen'
```


Issue created by migration from https://trac.sagemath.org/ticket/34581





---

archive/issue_comments_486979.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-09-24T17:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34344#issuecomment-486979",
    "user": "tkarn"
}
```

New commits:



---

archive/issue_comments_486980.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-24T17:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34344#issuecomment-486980",
    "user": "tkarn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_486981.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-09-25T00:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34344#issuecomment-486981",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_486982.json:
```json
{
    "body": "There are some bad behaviors that this implements:\n\n- It forces the inputs to be in the polynomial ring. I should be able to substitute anything I want where the computation makes such, such as square matrices. This should be a simple redirection.\n- It forces the output to be in the infinite polynomial ring. Instead, the output should be the common parent of the input and the base ring.\n\nThe \"standard\" thing to do is redirect everything through `__call__` after parsing the inputs a bit, and probably should be done here too. Although I am a bit tempted to just instead do a simple redirect to `self._p.subs(*args, **kwds)`. Actually, there probably is a general problem of not expanding the input polynomial to be large enough to handle the input.\n\n```\nsage: f(x_10=f)\nKeyError\nsage: f(x_2=f)\nx_3^2*x_2*x_1^2 + x_3*x_1^2 + x_1\nsage: x[12]  # make it big enough\nx_12\nsage: f(x_10=f)\nx_3*x_2*x_1 + x_1\n```\n\nProbably the input parsing of `subs` and `__call__` should be refactored out into a helper method, and then both of these methods redirect to their finite polynomial counterparts.",
    "created_at": "2022-09-25T00:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34344#issuecomment-486982",
    "user": "tscrim"
}
```

There are some bad behaviors that this implements:

- It forces the inputs to be in the polynomial ring. I should be able to substitute anything I want where the computation makes such, such as square matrices. This should be a simple redirection.
- It forces the output to be in the infinite polynomial ring. Instead, the output should be the common parent of the input and the base ring.

The "standard" thing to do is redirect everything through `__call__` after parsing the inputs a bit, and probably should be done here too. Although I am a bit tempted to just instead do a simple redirect to `self._p.subs(*args, **kwds)`. Actually, there probably is a general problem of not expanding the input polynomial to be large enough to handle the input.

```
sage: f(x_10=f)
KeyError
sage: f(x_2=f)
x_3^2*x_2*x_1^2 + x_3*x_1^2 + x_1
sage: x[12]  # make it big enough
x_12
sage: f(x_10=f)
x_3*x_2*x_1 + x_1
```

Probably the input parsing of `subs` and `__call__` should be refactored out into a helper method, and then both of these methods redirect to their finite polynomial counterparts.



---

archive/issue_comments_486983.json:
```json
{
    "body": "beware of #34542",
    "created_at": "2022-09-25T07:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34344#issuecomment-486983",
    "user": "chapoton"
}
```

beware of #34542



---

archive/issue_comments_486984.json:
```json
{
    "body": "This might answer [this question](https://ask.sagemath.org/question/42325/polynomial-rings-with-an-arbitrary-infinite-set-of-variables/) from 4 years ago. Thanks!",
    "created_at": "2022-10-02T16:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34344",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34344#issuecomment-486984",
    "user": "mathzeta2"
}
```

This might answer [this question](https://ask.sagemath.org/question/42325/polynomial-rings-with-an-arbitrary-infinite-set-of-variables/) from 4 years ago. Thanks!
