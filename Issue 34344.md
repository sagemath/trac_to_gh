# Issue 34344: Implement substitution in InfinitePolynomialRing

Issue created by migration from https://trac.sagemath.org/ticket/34581

Original creator: tkarn

Original creation time: 2022-09-24 15:32:40

CC:  tscrim mhansen simonking

Keywords: polynomial infinite substitution subs

Add the ability to substitute variables in `InfinitePolynomialRing`.


```
sage: R.<z> = InfinitePolynomialRing(QQ)
sage: f = z[1] + z[1]*z[2]*z[3]
sage: f.subs({z[1]:z[0]})
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
Input In [3], in <cell line: 1>()
----> 1 f.subs({z[Integer(1)]:z[Integer(0)]})

File ~/Applications/sage/src/sage/structure/element.pyx:830, in sage.structure.element.Element.subs()
    828 if str(gen) in kwds:
    829     variables.append(kwds[str(gen)])
--> 830 elif in_dict and gen in in_dict:
    831     variables.append(in_dict[gen])
    832 else:

TypeError: unhashable type: 'InfinitePolynomialGen'
```



---

Comment by tkarn created at 2022-09-24 17:06:52

New commits:


---

Comment by tkarn created at 2022-09-24 17:06:52

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-09-25 00:34:05

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2022-09-25 00:34:05

There are some bad behaviors that this implements:

- It forces the inputs to be in the polynomial ring. I should be able to substitute anything I want where the computation makes such, such as square matrices. This should be a simple redirection.
- It forces the output to be in the infinite polynomial ring. Instead, the output should be the common parent of the input and the base ring.

The "standard" thing to do is redirect everything through `__call__` after parsing the inputs a bit, and probably should be done here too. Although I am a bit tempted to just instead do a simple redirect to `self._p.subs(*args, **kwds)`. Actually, there probably is a general problem of not expanding the input polynomial to be large enough to handle the input.

```
sage: f(x_10=f)
KeyError
sage: f(x_2=f)
x_3^2*x_2*x_1^2 + x_3*x_1^2 + x_1
sage: x[12]  # make it big enough
x_12
sage: f(x_10=f)
x_3*x_2*x_1 + x_1
```

Probably the input parsing of `subs` and `__call__` should be refactored out into a helper method, and then both of these methods redirect to their finite polynomial counterparts.


---

Comment by chapoton created at 2022-09-25 07:00:06

beware of #34542


---

Comment by mathzeta2 created at 2022-10-02 16:44:53

This might answer [this question](https://ask.sagemath.org/question/42325/polynomial-rings-with-an-arbitrary-infinite-set-of-variables/) from 4 years ago. Thanks!
