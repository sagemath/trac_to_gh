# Issue 11372: Viewing matrices of algebraic numbers can take a long time

Issue created by migration from https://trac.sagemath.org/ticket/11544

Original creator: rbeezer

Original creation time: 2011-06-25 06:32:03

Assignee: jason, was

The following code leads to about a one minute hang for me (reproducibly in a fresh session).  Keshav Kini (via IRC) had the same experience.


```
sage: A = matrix(QQ, 4, 4, [1, 2, -2, 2, 1, 0, -1, -1, 0, -1, 1, 1, -1, 2, 1/2, 0])
sage: e = A.eigenvalues()[3]
sage: K = (A-e).kernel()
sage: P = K.basis_matrix()
sage: x = P.list()[3]
sage: hash(x)
sage: remap = {}
sage: remap.has_key(x)
```


This behavior hangs the creation of a string version of a matrix.  If you comment-out `sage/matrix/matrix0.pyx` at lines 1695-1696, the problem goes away.  To see the effect, run the first four lines of the code above and then just print P, with and without the two lines mentioned.

I have a workaround in mind that may solve the problem in many cases.  Root issue is at #11543.


---

Comment by rbeezer created at 2011-06-25 14:45:07

Changing status from new to needs_review.


---

Attachment


---

Comment by rbeezer created at 2011-06-26 03:51:11

Changing status from needs_review to needs_work.


---

Comment by rbeezer created at 2011-06-26 03:51:11

I tested this for speed, but forgot to do even minimal doctests.

It affects a lot of QQbar output in minor ways, so several doctests need fixing.


---

Attachment


---

Comment by rbeezer created at 2011-07-11 23:11:10

Changing status from needs_work to needs_review.


---

Comment by rbeezer created at 2011-07-11 23:11:10

v2 patch includes doctest fixes.

Just one line of code changes in sage/matrix/matrix0.pyx, the rest is documentation.

Previous behavior was to hash entries while printing, this caused the precision of an entry to increase, thus slightly greater precision in subsequent computed (printed) results.


---

Comment by rbeezer created at 2011-07-12 00:46:22

This probably needs a bit more explanation.

One feature of #10627 is to replace specific matrix entries by a symbol.  To look up this translation in a dictionary, entries of a matrix are hashed.  For QQbar, this hash is expensive (#11543).

This patch prevents a look-up if the translation dictionary is empty.


---

Comment by mraum created at 2011-08-06 19:28:16

Changing status from needs_review to positive_review.


---

Comment by mraum created at 2011-08-06 19:28:16

This gets a positive review as is.


---

Comment by rbeezer created at 2011-08-11 05:07:26

Thanks, again!


---

Comment by leif created at 2011-09-17 04:53:04

Resolution: fixed
