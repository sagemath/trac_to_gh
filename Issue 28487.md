# Issue 28487: Polyhedron._acted_upon_ should handle left multiplication by matrices, linear transformations

Issue created by migration from https://trac.sagemath.org/ticket/28724

Original creator: mkoeppe

Original creation time: 2019-11-12 14:28:13

CC:  jipilab @jiawei-wang-ucd

Keywords: polytopes


```
sage: b3 = polytopes.Birkhoff_polytope(3)
sage: b3.ambient_dim()
....:             9
sage: proj_mat=matrix([[0,1,0,0,0,0,0,0,0],[0,0,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,1,0]])
b3_proj = proj_mat * b3
Traceback (most recent call last)
.....
.... sage/geometry/polyhedron/base.pyc in _acted_upon_(self, actor, self_on_left)
   3687             return self.translation(actor)
   3688         else:
-> 3689             return self.dilation(actor)
   3690 
   3691     def __neg__(self):
.....
ValueError: V-representation data requires a list of length ambient_dim
```



---

Comment by jipilab created at 2019-11-13 00:39:34

Agreed, that would be nice to add this in the coercion.


---

Comment by jipilab created at 2019-11-13 00:53:09

Are you on it? I could come up with something.


---

Comment by jipilab created at 2019-11-13 01:42:20

Changing status from new to needs_review.


---

Comment by jipilab created at 2019-11-13 01:42:20

Here's a first version.

I wanted to have a `linear_transformation` method for a while... That was a good timing to add it.
----
New commits:


---

Comment by tscrim created at 2019-11-15 18:10:26

What happens when the linear transformation moves the polyhedron outside of the fields the backend can handle? Can you add such a doctest?


---

Comment by @kliem created at 2019-11-17 07:00:53

Can you just initialize the new parent like this?

```
new_parent = par.base_extend(linear_transf.base_ring(), ambient_dim=new_dim)
```


This should automatically keep the backend if possible, but change it, if not possible.


---

Comment by @kliem created at 2019-11-19 10:35:04

This does not work, when the matrix consists of floats.

Please apply the change I suggested, which fixes this, and add a doctest with floats.

However, this still does not work with sqrt5 for example, even with backend `field` or `normaliz`.

This is because coercion of parents does not work in this case. I'm trying to figure out what's going on there.


---

Comment by @kliem created at 2019-11-19 10:35:04

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2019-11-19 11:46:14

I added #28770 as a dependency, because it would be nice to have doctest with a square root of something or so.

If you think this is unnecessary, feel free to remove it again.


---

Comment by @kliem created at 2019-11-19 17:36:01

Three more things.

- `is_zero` catches too many matrices. A 2-by-2 zero-matrix should not change ambient dimension, if it acts on a Polyhedron in ambient dim 2. if it acts on a polyhedron of dimension 3 it should throw an error.
- (Optional) Are you happy with the error message thrown, if the dimension of the matrix does not fit? If not you should take care of it.
- Currently, you implemented left action (and I don't know, what a right action should be). You should probably check, whether `self_on_left` is `False`.


---

Comment by @kliem created at 2020-01-06 09:59:52

I applied those small changes as suggested above.

The matrix acts on the right now, by action of the transpose on the left.
----
New commits:


---

Comment by @kliem created at 2020-01-06 09:59:52

Changing status from needs_work to needs_review.


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by @kliem created at 2020-01-07 16:05:05

One probably should not return anything, if self is on left.


---

Comment by git created at 2020-01-09 11:36:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2020-01-24 09:52:10

New commits:


---

Comment by @kliem created at 2020-01-27 14:27:48

Bots are pretty much green. Some pyflakes warning, which I fixed in #28880 already (which is green botwise).


---

Comment by jipilab created at 2020-01-31 10:17:36

Changing status from needs_review to positive_review.


---

Comment by jipilab created at 2020-01-31 10:17:36

Looks good to me.


---

Comment by vbraun created at 2020-02-10 20:06:01

Resolution: fixed
