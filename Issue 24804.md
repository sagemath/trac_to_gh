# Issue 24804: Implement efficient automata and computing with regular languages

Issue created by migration from https://trac.sagemath.org/ticket/25041

Original creator: mercatp

Original creation time: 2018-03-27 12:39:45

CC:  slabbe vdelecroix dkrenn

Keywords: automata, regular languages

Define a class FastAutomaton that permits to manipulate deterministic automata, non-deterministic automata and regular languages with efficient operations implemented in C.


---

Comment by git created at 2018-05-29 12:20:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-29 14:27:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-05-30 14:21:11

You should look at the patchbot report, and fix everything wrong..
----
New commits:


---

Comment by git created at 2018-05-30 17:13:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-05 14:27:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-05 15:31:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-05 15:48:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dbenielli created at 2018-06-05 16:10:03

New commits:


---

Comment by dbenielli created at 2018-06-05 16:10:03

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-06-06 01:27:57

Some quick comments:

- Use `.. NOTE::` instead of `.. note::`.
- The stuff in `combinat/tutorial.py` would be better as a separate thematic tutorial (with a link in `combinat/tutorial.py`.
- There is a merge conflict in `combinat/tutorial.py` (look for the `>>>>>>`).
- Latex code is best marked as ``x = 5`` with single ``` (and not preceded by `:math:`).
- Could the core c file make for a standalone library (I think I asked this on #21072)?


---

Comment by vdelecroix created at 2018-06-08 15:34:26

a french remark: `calculabilitè` -> `calculabilité` et `complexitè` -> `complexité`


---

Comment by vdelecroix created at 2018-06-08 16:13:09

It would be really nice to have a serious implementation of automata in Sage. The current one `sage.combinat.finite_state_machine.Automaton` is really terrible and mostly useless. While possibly much better, the one proposed with this ticket is far from being in a satisfactory shape for inclusion in Sage.

Here are the main relevant things

1. Do you think that having two disjoint implementations will help Sage users? This ticket should come with a plan to replace or at least interact with the code already there.
2. You should *never* use french names for variables and comments. This code is intended to be read/used/improved by people all around the world. (note that it is even worse: you are mixing french and english)
3. You propose to include a lot of C code directly in Sage. This is relevant in the context of automata for speed. But as it is, this code is not properly tested and almost undocumented. Even the doctests of the pyx file are not testing corner cases, real world examples and random instances as it should be.

Some other minor comments

- The components on the ticket is set to `packages: optional` but you are not providing a package. You are simply including source code directly in Sage. This is a thing that you might want to think about: do you prefer inclusion in Sage sources or ship your code as a package?
- There should not be any commented code unless there is a very good reason for that
- In Sage sources (I am talking about `cautomata.pyx`) there are clear design choices that should be followed
    - ``@`property` are mostly not used. Object internal data are accessed with methods. If there is a need for cache you can use ``@`cached_method`.
    - method start with lower case (`Alphabet`)
    - the name should reflect the object and possibly the implementation. `FastAutomaton` and `NFastAutomaton` are poorly choosen.
    - error and print statements are different things. This kind of code should not be there

```
print("Error : Incorrect set of final states.")
```

    - This

```
cdef Bool(int x):
    if x:
        return True
    return False
```

     is automatically taken care of by the "special" `bint` type from Cython.
    - Docstring should start with an upper case and be informative. For example `zero-complete automaton in the other way` is cryptic.


---

Comment by vdelecroix created at 2018-06-08 16:13:17

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2018-06-08 16:13:32

Changing status from needs_work to needs_info.


---

Comment by vdelecroix created at 2018-06-08 16:16:11

And what is this? (`sage/combinat/tutorial.py`)

```
<<<<<<< HEAD

=======
    
>>>>>>> d41b62b47960e8b3b35944ea8c0c25d593966429
```



---

Comment by git created at 2018-06-12 13:50:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-22 14:49:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-25 17:04:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-27 11:23:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-27 11:47:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-27 13:28:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-27 13:34:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-27 13:44:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-06-29 19:59:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-06 12:32:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-06 17:07:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-08-03 19:18:42

milestone update 8.3 -> 8.4


---

Comment by git created at 2018-08-30 17:16:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-03 14:08:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-03 16:21:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-03 16:54:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2018-09-03 17:06:36

Note: if you use a branch `public/whatever` both of you have access in read/write.
----
New commits:


---

Comment by git created at 2018-09-03 17:07:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dbenielli created at 2018-09-10 10:55:18

Last 10 new commits:


---

Comment by git created at 2018-09-11 15:22:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-11 16:04:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-17 13:05:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-17 13:34:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-17 14:32:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-17 16:00:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-09-24 15:50:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-11-19 14:41:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-11-19 15:42:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2018-12-11 12:52:08

The branch does not apply anymore on the most recent development version of Sage.

I use the occasion to share some thoughts about this ticket. This is not the first time that a ticket is created to add a ton of new lines of code into Sage and in too many of those cases, the code just became dead on the sage trac for a ton of different reasons that I will not enumerate here (#21295, #16110, #12224 are examples which are taking years to complete). Therefore, now, I want to make sure that this does not happen again with this ticket since I am very interested in having a fast implementation of automaton available in Sage.

While I think that it is a very good idea that this ticket eventually gets merged into Sage, **I would like to suggest to the authors of this ticket to consider the possibility of creating an independent Python Package containing this code** beside this ticket. To me, this would be benefical for many reasons:
- Python Package are easy to install, use and maintain.
- If some important modifications that are backward incompatible are to be done in your code in the next two years, then no one will bother.
- In Sage, code modification must be backward compatible. This means that you will lose a lot of time in adding deprecation warning to your code in the next years. Also, this means that you have to lose a lot of time right now while thinking about all the different use cases that people you don't know may have during using your code.
- To me, the creation of a Python Package is a good way of making a new module go into Sage. Being use publically for one or two years as a Python Package before being included into Sage allows to be sure about the proper interface and without losing much time thinking about how other will use your code.
- This is what I ended up doing for #13346, #13069 and #20343. Instead of waiting years for a review, I decided to put those module into my own python package (slabbe). And the day someone tells me that some of my code is interresting enough for others, then I will consider updating the ticket with the most recent version of the desired module. Meanwhile, I will not update my code at two places in parallel. The most recent version is in my package and slowly, it converges to something usable for many usage.
- In the next two years, the code base of Sage may change and this can break the application the branch of this ticket (like right now today!), which makes your code unusable, untestable.

Here are examples of Python packages for Sage:

 - https://pypi.org/project/surface_dynamics/ (include Python, Cython, and C code)
 - https://pypi.org/project/slabbe/  (includes Cython code)
 - https://pypi.org/project/train-track/ (that you know)
 - https://github.com/miltminz/EkEkstar (simple: on single Python file)
 - https://github.com/sagemath/sage_sample (a demo with uptodate travis setup, etc.)

Good luck:)


---

Comment by git created at 2019-01-14 18:37:20

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by dbenielli created at 2019-02-11 12:28:17

Changing status from needs_info to needs_review.


---

Comment by dbenielli created at 2019-02-11 12:28:17

Changing component from packages: optional to packages: standard.


---

Comment by vdelecroix created at 2019-02-11 14:15:04

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2019-02-11 14:15:04

This is certainly not a package: http://doc.sagemath.org/html/en/developer/packaging.html


---

Comment by vdelecroix created at 2019-02-11 14:18:25

Are the two methods `get_automatonc` and `get_Automaton` the only things you will do to make the current Sage code and your code interact?


---

Comment by vdelecroix created at 2019-02-11 14:22:17

If you intend to include your Python code in Sage sources then
- all method names must be lower case with as few abbreviations as possible (e.g. `proji` is not acceptable)
- all class names must be CAML case with as few abbreviations as possible (e.g. `DetAutomaton` should be `DeterministicAutomaton`)
This is not an especially nice convention, but this is how it is.


---

Comment by vdelecroix created at 2019-02-11 14:23:04

Why `ON PLACE` in the documentation of `permut_op` in upper case? What does `on place` mean? Do you want to say `inplace`?


---

Comment by vdelecroix created at 2019-02-11 14:26:42

Your usage of `sig_on/sig_off` is very wrong. For example, the function `getDict2` contains Python code on its first line

```
    A = list(A)
```

However, you wrote in the code of the method `duplicate`

```
        sig_on()
        dC = getDict2(d, self.A, d1=d1)
        sig_off()
```

As written in the cysignals documentation, the code between `sig_on/sig_off` should not contain any Python code.


---

Comment by git created at 2019-02-15 10:26:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-15 10:44:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-15 16:09:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-21 14:58:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-21 15:41:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-21 18:39:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-22 15:37:26

Branch pushed to git repo; I updated commit sha1. New commits:
