# Issue 11845: Adds CoerceKey

Issue created by migration from Trac.

Original creator: roed

Original creation time: 2011-11-12 23:13:13

Assignee: robertwb

CC:  robertwb

Many parents in Sage are supposed to be unique, such as GF(5).  But we'd like to be able to make copies of GF(5) sometimes, for example when we want to consider the residue field of a number field at a completely split prime above 5.  The main difference between these copies of GF(5) is that they have different coercion data.  This patch adds a feature to sage.structure.factory that allows one to do this more simply than creating a whole new class for residue fields.


---

Attachment


---

Comment by roed created at 2011-11-12 23:25:20

This patch is still in progress, but I'd like to get feedback on the general approach and the changes to factory and parent.  In particular, I'm not very happy with the changes to comparison in parent, but I'm trying to satisfy the following goals

* Check for type equality and coerce keys in Parent so that implementers of new parents can just write one function that ignores coerce keys and can assume that its inputs are the same type.  Maybe one should be allowed to be a subtype of the other instead?
* Not have to immediately change all of the `__cmp__` functions on parents throughout Sage (see #10130 for what happens when you try to do this).
* Keep comparison equally fast or faster for parents that don't yet facilitate coerce keys.  In particular I'd like to avoid adding a bunch of Python function calls.

I'd also like to incorporate some of the improvements from #10130 since I need some of them.

Feedback is welcome.


---

Comment by robertwb created at 2011-11-13 04:04:24

I have to admit that this seems much more complicated than "simply than creating a whole new class for residue fields." In the particular case of residue fields, it seems that creating a new Parent would be desirable (e.g. it could print better and know where it came from); are there other usecases where such re-use would make more sense? 

If it is not easy to simply extend the Parent and re-use most of its methods/elements, that should be fixed.


---

Comment by roed created at 2011-11-17 14:31:17

After trying to get this approach to work a bit more, I agree with you.  There are some changes that need to be made to Parent to make things like residue fields easier to create, but I'll address them in another ticket.

Thanks for the feedback.


---

Comment by roed created at 2011-11-19 04:25:01

Changing status from new to needs_review.


---

Comment by roed created at 2011-11-19 04:25:21

Changing status from needs_review to positive_review.


---

Comment by roed created at 2011-11-19 04:25:21

Note that this should be closed as invalid, not merged.


---

Comment by jdemeyer created at 2011-11-26 13:05:57

Resolution: invalid
