# Issue 19868: expand difference of relations before evaluation to a boolean

Issue created by migration from Trac.

Original creator: behackl

Original creation time: 2016-02-24 08:24:31

CC:  cheuberg rws

Keywords: pynac

As described in [this discussion](https://groups.google.com/forum/#!topic/sage-devel/ojHqBy7oUVU), we currently have

```
sage: bool(x^2 - 1 - (x+1)*(x-1) == 0)
False
```

This can be fixed on a pynac-level by expanding the difference between the left-hand side and the right-hand side of the relational expression. See https://github.com/pynac/pynac/pull/139.

This ticket shall add doctests as soon as a new pynac version is released.


---

Comment by rws created at 2016-02-24 13:56:34

Note that the change in Pynac simply leads to Maxima being called in `Expression.__nonzero__` (waiting time on first invocation). The issue will be resolved in general with #19040 because we expand in `__nonzero__` then. But at the moment it's a bug and it's resolved by your Pynac patch.


---

Comment by cheuberg created at 2016-02-24 14:02:52

As posted on sage-devel:

```
$ cat test.sage
a = -1/(x+1) + 1/x
b = 1/(x*(x+1))
print bool(a == b), bool(a != b)
$ sage-6.9 test.sage
True False
$ sage-6.10 test.sage
True True
$ sage-7.0 test.sage
True True
```



---

Comment by rws created at 2016-02-24 14:21:13

Actually, the change in Pynac does not resolve this (`a!=b`) so it's unclear what causes it.


---

Comment by behackl created at 2016-02-24 15:03:51

I see. Expansion of the difference does not detect the partial fraction stuff going on there. In that case its probably better to wait for #19040 instead of submitting a fix in pynac.

I think that the more interesting question is whether the partial fraction stuff is also resolved with the ticket.

The pynac pull request and this ticket are then duplicates/wontfixes.


---

Comment by rws created at 2016-02-24 15:28:47

(deleted)


---

Comment by behackl created at 2016-02-24 15:36:06

My mistake. The wording in the ticket is actually wrong, somewhen today I must have switched to testing the wrong thing... >.<


---

Comment by rws created at 2016-02-24 15:36:20

Ok confirmed.

```
sage: bool(x^2 - 1 - (x+1)*(x-1) != 0)
True
```



---

Comment by rws created at 2016-02-25 09:13:07

With the new #19040 you will get:

```
sage: bool(x^2 - 1 - (x+1)*(x-1) != 0)
False
sage: (x^2 - 1 - (x+1)*(x-1) != 0).holds()
False
```

The first because we expand in `__nonzero__`, the second because Maxima is called. So, I think this ticket will turn out as duplicate of #19040.


---

Comment by behackl created at 2016-02-25 09:16:33

Replying to [comment:9 rws]:
> With the new #19040 you will get:
> {{{
> sage: bool(x^2 - 1 - (x+1)*(x-1) != 0)
> False
> sage: (x^2 - 1 - (x+1)*(x-1) != 0).holds()
> False
> }}}
> The first because we expand in `__nonzero__`, the second because Maxima is called. So, I think this ticket will turn out as duplicate of #19040.

Excellent! Thanks for checking. :-)
