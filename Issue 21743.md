# Issue 21743: py3 richcmp in real_double pyx

Issue created by migration from https://trac.sagemath.org/ticket/21980

Original creator: chapoton

Original creation time: 2016-11-27 13:02:40

CC:  tscrim aapitzsch jdemeyer

a minuscule step to python3


---

Comment by chapoton created at 2016-11-27 13:03:38

New commits:


---

Comment by jdemeyer created at 2016-11-29 08:29:19

`_richcmp_` only makes sense for `Element` classes. Do we have a general strategy for `Parent` classes?


---

Comment by chapoton created at 2016-12-02 08:39:44

I would say parents should only compare equal if they are the same (in which sense ?).

Converting to `__richcmp__` seems to be causing problems with pickling.

I have currently no idea what to do, but this is standing on our **long** way to py3.


---

Comment by tscrim created at 2016-12-02 15:07:12

Perhaps change it to an `__eq__` and add a `__ne__`?


---

Comment by tscrim created at 2016-12-02 15:08:40

Actually, I think what was causing the problems with simply changing to `__richcmp__` is with the blanket `return NotImplemented`. This was not actually checking `!=`.


---

Comment by git created at 2016-12-02 19:53:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-12-03 09:29:44

this seems to be good to go, the latex problem is most probably unrelated


---

Comment by chapoton created at 2016-12-03 09:29:44

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-12-06 16:32:51

*ping*


---

Comment by tscrim created at 2016-12-06 16:38:06

My opinion is it should return `True` for `!=` if the classes are distinct, which is a sufficient test for `!=`.


---

Comment by jdemeyer created at 2016-12-08 11:31:32

Like I said, I think we should have a general plan for comparing parents. We do have one for elements (the coercion model). As long as we don't have such a plan, I rather wouldn't want to change `__cmp__` to `__richcmp__`.


---

Comment by chapoton created at 2016-12-09 16:32:13

In Parent, we only have `_cmp_` which calls `__cmp__` and `_richcmp` which call `_cmp_`

I think one should add there a `_richcmp_` (possibly replacing the existing `_richcmp`) that first tries to call `__richcmp__` and then falls back to calling `__cmp__`.

Should this be looked at in #22029 or in a new ticket ?


---

Comment by jdemeyer created at 2016-12-09 19:30:07

Replying to [comment:11 chapoton]:
> Should this be looked at in #22029 or in a new ticket ?

Certainly a new ticket.


---

Comment by git created at 2016-12-12 20:01:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-12-12 23:22:12

I think this will do for now, but the reason we may not see any pickling issues here is because this has a (unsophisticated) way of implementing singleton behavior. So if we change this to an instance of `Singleton`, then we don't need the `__richcmp__`, but that is for another ticket.


---

Comment by tscrim created at 2016-12-12 23:22:12

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-12-14 23:15:54

Resolution: fixed
