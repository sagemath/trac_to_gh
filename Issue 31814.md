# Issue 31814: 1 internet doctest failing in src/sage/misc/package.py

Issue created by migration from https://trac.sagemath.org/ticket/32051

Original creator: slabbe

Original creation time: 2021-06-24 11:55:11

On 9.4.beta3, the command


```
sage -t --optional=sage,internet src/sage/misc/package.py
```


gives


```
sage -t --long --random-seed=0 src/sage/misc/package.py
**********************************************************************
File "src/sage/misc/package.py", line 101, in sage.misc.package.pip_remote_version
Failed example:
    pip_remote_version(nap, pypi_url=pypi, ignore_URLError=False) # optional - internet
Expected:

    Traceback (most recent call last):
    ...
    HTTPError: HTTP Error 404: Not Found
Got:
    <BLANKLINE>

    Traceback (most recent call last):
      File "/usr/lib/python3.8/urllib/request.py", line 1317, in do_open
        h.request(req.get_method(), req.selector, req.data, headers,
      File "/usr/lib/python3.8/http/client.py", line 1230, in request
        self._send_request(method, url, body, headers, encode_chunked)
      File "/usr/lib/python3.8/http/client.py", line 1276, in _send_request
        self.endheaders(body, encode_chunked=encode_chunked)
      File "/usr/lib/python3.8/http/client.py", line 1225, in endheaders
        self._send_output(message_body, encode_chunked=encode_chunked)
      File "/usr/lib/python3.8/http/client.py", line 1004, in _send_output
        self.send(msg)
      File "/usr/lib/python3.8/http/client.py", line 944, in send
        self.connect()
      File "/usr/lib/python3.8/http/client.py", line 915, in connect
        self.sock = self._create_connection(
      File "/usr/lib/python3.8/socket.py", line 807, in create_connection
        raise err
      File "/usr/lib/python3.8/socket.py", line 796, in create_connection
        sock.connect(sa)
    TimeoutError: [Errno 110] Connection timed out
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>

    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package.pip_remote_version[4]>", line 1, in <module>
        pip_remote_version(nap, pypi_url=pypi, ignore_URLError=False) # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python3.8/site-packages/sage/misc/package.py", line 109, in pip_remote_version
        f = urlopen(url)
      File "/usr/lib/python3.8/urllib/request.py", line 222, in urlopen
        return opener.open(url, data, timeout)
      File "/usr/lib/python3.8/urllib/request.py", line 525, in open
        response = self._open(req, data)
      File "/usr/lib/python3.8/urllib/request.py", line 542, in _open
        result = self._call_chain(self.handle_open, protocol, protocol +
      File "/usr/lib/python3.8/urllib/request.py", line 502, in _call_chain
        result = func(*args)
      File "/usr/lib/python3.8/urllib/request.py", line 1346, in http_open
        return self.do_open(http.client.HTTPConnection, req)
      File "/usr/lib/python3.8/urllib/request.py", line 1320, in do_open
        raise URLError(err)
    urllib.error.URLError: <urlopen error [Errno 110] Connection timed out>

**********************************************************************
1 item had failures:
   1 of   6 in sage.misc.package.pip_remote_version
    2 beautifulsoup4 tests not run
    1 not tested test not run
    0 tests not run because we ran out of time
    [57 tests, 1 failure, 278.08 s]
```



---

Comment by chapoton created at 2022-09-24 11:24:02

seems to work now. Maybe this can be closed as invalid ?


---

Comment by chapoton created at 2022-09-30 08:18:04

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-09-30 08:18:04

please confirm that this can be closed as invalid


---

Comment by slabbe created at 2022-09-30 08:24:36

Changing status from needs_review to positive_review.


---

Comment by slabbe created at 2022-09-30 08:24:36

the command works for me now with 9.8.beta0


---

Comment by chapoton created at 2022-09-30 09:05:31

Resolution: invalid
