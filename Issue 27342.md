# Issue 27342: Finding median in linear time

Issue created by migration from https://trac.sagemath.org/ticket/27579

Original creator: @Hrishabh-yadav

Original creation time: 2019-03-31 08:23:24

CC:  dcoudert

This ticket introduces a new technique for finding median of graph : [ ](https://en.wikipedia.org/wiki/Median_of_medians)  
This algorithm runs at complexity of O(n) in worst case and will be a good addition to sage stats module.


---

Comment by @Hrishabh-yadav created at 2019-04-09 21:08:14

Implementation of median_of_medians code is done. Algorithm does run fast as compared to the one in function median(), but still slow compared to it's expectation.
Results:

```
sage: A = [randint(0,i*100) for i in range (0,5000000)]
sage: median_of_medians(A,len(A)//2)
sage: median(A)
Time for median_of_medians : 2.66196990013
Time for median : 3.39063596725
```

----
New commits:


---

Comment by @Hrishabh-yadav created at 2019-04-10 18:26:08

Changing status from new to needs_review.


---

Comment by dcoudert created at 2019-04-12 11:35:35

Please follow the coding style of Sagemath: http://doc.sagemath.org/html/en/developer/coding_basics.html  and https://www.python.org/dev/peps/pep-0008 . For instance,
- `def median_of_medians( A, i ):` -> `def median_of_medians(A, i ):`
- bullets in INPUT block must be aligned below INPUT
- in these bullets, use ```A``` and not ``A``
- `if(len(A)<=i):` -> `if len(A) <= i:`
- etc., etc., etc.


---

Comment by git created at 2019-04-12 13:58:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-12 14:00:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Hrishabh-yadav created at 2019-04-12 14:01:51

I have modified the code.


---

Comment by dcoudert created at 2019-04-14 16:50:21

The method says that it returns the `i-th` smallest integer in the array, but in the examples, you return the `(i+1)-th`.

The examples are for small values, but you have hardcoded `items_per_column = 1000`. Thus, your tests are only for `sorted(A)[i]`.

Please add a description of the algorithm. Otherwise, it's very hard to  check your code.

Do you really need recursive calls ? can't you avoid that ?

and why choosing `1000` ?


---

Comment by @Hrishabh-yadav created at 2019-04-14 16:57:10

Replying to [comment:8 dcoudert]:
> The method says that it returns the `i-th` smallest integer in the array, but in the examples, you return the `(i+1)-th`.
I will change it.
> 
> The examples are for small values, but you have hardcoded `items_per_column = 1000`. Thus, your tests are only for `sorted(A)[i]`.
By taking 'items_per_column =1000' I got the best result, Although I will make sure it is given by the user. 
> Please add a description of the algorithm. Otherwise, it's very hard to  check your code.
Yeah sure.
> Do you really need recursive calls ? can't you avoid that ?
Actually no, I have a way to remove recursive calls, let me code it!
> and why choosing `1000` ?
As mentioned above, it gave the best results among '10','100','1000','10000'and '100000'.

Thanks!


---

Comment by @Hrishabh-yadav created at 2019-04-14 20:15:07

Apparently numpy has implemented introselect algorithm which is a mix of median_of_median and quickselct algorithm, and works quite fast as compared to the algorithm implemented in current branch.

 Introselect: https://en.wikipedia.org/wiki/Introselect     
 
 numpy library function :-https://docs.scipy.org/doc/numpy/reference/generated/numpy.partition.htm

I have made a new branch in which numpy library algorithm is called rather the one implemented above.
Or should i have both codes and let user decide which one should be implemented.


---

Comment by git created at 2019-04-14 20:17:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-04-15 09:30:50

> I have made a new branch in which numpy library algorithm is called rather the one implemented above.
> Or should i have both codes and let user decide which one should be implemented.

If there is a faster and simpler method, there is no need for adding another one, and in view of the proposed method, I think there is no need for adding `i_smallest`. The added value to Sagemath seems rather limited here.

So I suggest to change the milestone to wontfix.


---

Comment by @Hrishabh-yadav created at 2019-04-15 18:02:05

Ok done!


---

Comment by chapoton created at 2020-09-12 06:44:24

David, can we close this one ?


---

Comment by dcoudert created at 2020-09-12 08:15:38

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2020-09-12 08:15:38

Yes, we can close this ticket.


---

Comment by chapoton created at 2020-09-12 10:05:36

Resolution: invalid
