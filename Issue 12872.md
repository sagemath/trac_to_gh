# Issue 12872: ccache chokes on ecl

archive/issues_012872.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nKeywords: sd40.5\n\nCurrently ccache completely fails building ecl, so we should disable ccache in our ecl spkg.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13044\n\n",
    "created_at": "2012-05-28T04:37:04Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "ccache chokes on ecl",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12872",
    "user": "https://github.com/ohanar"
}
```
Assignee: GeorgSWeber

Keywords: sd40.5

Currently ccache completely fails building ecl, so we should disable ccache in our ecl spkg.

Issue created by migration from https://trac.sagemath.org/ticket/13044





---

archive/issue_comments_154627.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-05-28T04:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154627",
    "user": "https://github.com/ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_154628.json:
```json
{
    "body": "I can verify that our current ECL chokes with \"`env CC='nice gcc' ./spkg -i ecl...`\" and that your spkg fixes it. Perhaps it would be nice to put something into the generated `ecl_cc` so we know whence it came: maybe a comment like `# ECL chokes when CC contains spaces; this script works around that. See #13044.` Then it would be easier to remove this workaround when ECL is updated.\n\nAlso, I tried `env CXX='nice g++' ./sage -f ecl...` with the old version and it worked fine. Perhaps we shouldn't also create `ecl_cxx` since ECL is not using a C++ compiler.\n\nAlso`^2`, we should send this upstream.",
    "created_at": "2012-05-28T18:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154628",
    "user": "https://github.com/dandrake"
}
```

I can verify that our current ECL chokes with "`env CC='nice gcc' ./spkg -i ecl...`" and that your spkg fixes it. Perhaps it would be nice to put something into the generated `ecl_cc` so we know whence it came: maybe a comment like `# ECL chokes when CC contains spaces; this script works around that. See #13044.` Then it would be easier to remove this workaround when ECL is updated.

Also, I tried `env CXX='nice g++' ./sage -f ecl...` with the old version and it worked fine. Perhaps we shouldn't also create `ecl_cxx` since ECL is not using a C++ compiler.

Also`^2`, we should send this upstream.



---

archive/issue_comments_154629.json:
```json
{
    "body": "Changing component from build to packages.",
    "created_at": "2012-08-13T12:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154629",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from build to packages.



---

archive/issue_events_035745.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35745"
}
```



---

archive/issue_comments_154630.json:
```json
{
    "body": "Is this still needed?",
    "created_at": "2013-12-30T10:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154630",
    "user": "https://github.com/kiwifb"
}
```

Is this still needed?



---

archive/issue_comments_154631.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-12-30T10:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154631",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_154632.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-12-30T10:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154632",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_154633.json:
```json
{
    "body": "Yes, it is still needed.",
    "created_at": "2013-12-30T10:20:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154633",
    "user": "https://github.com/jdemeyer"
}
```

Yes, it is still needed.



---

archive/issue_events_035746.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35746"
}
```



---

archive/issue_events_035747.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35747"
}
```



---

archive/issue_events_035748.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35748"
}
```



---

archive/issue_events_035749.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35749"
}
```



---

archive/issue_comments_154634.json:
```json
{
    "body": "This needs to be converted to a new-style package, for the ECL version we currently use.",
    "created_at": "2014-05-15T20:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154634",
    "user": "https://github.com/pjbruin"
}
```

This needs to be converted to a new-style package, for the ECL version we currently use.



---

archive/issue_comments_154635.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-15T20:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154635",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_035750.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35750"
}
```



---

archive/issue_events_035751.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35751"
}
```



---

archive/issue_comments_154636.json:
```json
{
    "body": "I can confirm this is still an issue--sage build breaks on ecl when `CC=ccache gcc`--obviously this can be worked around easily enough, but setting `CC` like that is not uncommon either, and only seems to be a problem with ecl.\n\nWould this be worth patching in ecl (both upstream and in sage)?",
    "created_at": "2016-02-24T15:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154636",
    "user": "https://github.com/embray"
}
```

I can confirm this is still an issue--sage build breaks on ecl when `CC=ccache gcc`--obviously this can be worked around easily enough, but setting `CC` like that is not uncommon either, and only seems to be a problem with ecl.

Would this be worth patching in ecl (both upstream and in sage)?



---

archive/issue_comments_154637.json:
```json
{
    "body": "The updated spkg mentioned in this ticket is a 404 now.",
    "created_at": "2016-02-24T15:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154637",
    "user": "https://github.com/embray"
}
```

The updated spkg mentioned in this ticket is a 404 now.



---

archive/issue_comments_154638.json:
```json
{
    "body": "Current upstream is https://common-lisp.net/project/ecl/\nAlso `ecl-16.0.0` has been released and it would be nice to upgrade. It would be worth checking if it is still an issue in the latest release.",
    "created_at": "2016-02-24T20:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154638",
    "user": "https://github.com/kiwifb"
}
```

Current upstream is https://common-lisp.net/project/ecl/
Also `ecl-16.0.0` has been released and it would be nice to upgrade. It would be worth checking if it is still an issue in the latest release.



---

archive/issue_comments_154639.json:
```json
{
    "body": "There is a similar bug that I've just run into, but in Python, when compiling the Cython sources.  I've never run into this before strangely, but maybe have just worked on fewer projects with cpp generated from Cython: https://bugs.python.org/issue8027\n\nI will check if the ecl issue is fixed upstream.",
    "created_at": "2016-02-25T08:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154639",
    "user": "https://github.com/embray"
}
```

There is a similar bug that I've just run into, but in Python, when compiling the Cython sources.  I've never run into this before strangely, but maybe have just worked on fewer projects with cpp generated from Cython: https://bugs.python.org/issue8027

I will check if the ecl issue is fixed upstream.



---

archive/issue_comments_154640.json:
```json
{
    "body": "FYI this bug still exists upstream, or at least in ecl-16.0.0.  I will see if I can come up with a patch.",
    "created_at": "2016-03-17T13:04:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154640",
    "user": "https://github.com/embray"
}
```

FYI this bug still exists upstream, or at least in ecl-16.0.0.  I will see if I can come up with a patch.



---

archive/issue_comments_154641.json:
```json
{
    "body": "Submitted a patch to upstream: https://gitlab.com/embeddable-common-lisp/ecl/merge_requests/20",
    "created_at": "2016-03-17T15:03:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154641",
    "user": "https://github.com/embray"
}
```

Submitted a patch to upstream: https://gitlab.com/embeddable-common-lisp/ecl/merge_requests/20



---

archive/issue_comments_154642.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-17T17:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154642",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_154643.json:
```json
{
    "body": "Added the patch to the spkg.  It applies to the current version of the spkg with a bit of fuzz.  \n\nIf I understand correctly I should also update the patch version, and upload a new source package? Not sure exactly how to go about that though.\n\n---\nNew commits:",
    "created_at": "2016-03-17T17:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154643",
    "user": "https://github.com/embray"
}
```

Added the patch to the spkg.  It applies to the current version of the spkg with a bit of fuzz.  

If I understand correctly I should also update the patch version, and upload a new source package? Not sure exactly how to go about that though.

---
New commits:



---

archive/issue_events_035752.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-18T18:08:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35752"
}
```



---

archive/issue_events_035753.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2016-03-18T18:08:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "milestone": "sage-7.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35753"
}
```



---

archive/issue_comments_154644.json:
```json
{
    "body": "Replying to [comment:18 embray]:\n> Added the patch to the spkg.  It applies to the current version of the spkg with a bit of fuzz.  \n> \n> If I understand correctly I should also update the patch version\n\nIn this exceptional case I think it's not needed because there is no reason to rebuild everybody's ECL with this patch. And in the cases where ECL didn't install before, there is no **re**build needed since there couldn't have been a build in the first place.\n\n> and upload a new source package?\n\nNo, because you are not changing the source tarball, just adding a patch.",
    "created_at": "2016-03-18T18:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154644",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 embray]:
> Added the patch to the spkg.  It applies to the current version of the spkg with a bit of fuzz.  
> 
> If I understand correctly I should also update the patch version

In this exceptional case I think it's not needed because there is no reason to rebuild everybody's ECL with this patch. And in the cases where ECL didn't install before, there is no **re**build needed since there couldn't have been a build in the first place.

> and upload a new source package?

No, because you are not changing the source tarball, just adding a patch.



---

archive/issue_comments_154645.json:
```json
{
    "body": "If I understand correctly, for the package the patches are being applied by `spkg-src` which only seems to apply when building the source tarball.",
    "created_at": "2016-03-18T18:19:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154645",
    "user": "https://github.com/embray"
}
```

If I understand correctly, for the package the patches are being applied by `spkg-src` which only seems to apply when building the source tarball.



---

archive/issue_comments_154646.json:
```json
{
    "body": "Okay, this is unusual...",
    "created_at": "2016-03-19T13:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154646",
    "user": "https://github.com/jdemeyer"
}
```

Okay, this is unusual...



---

archive/issue_comments_154647.json:
```json
{
    "body": "Bad separation (i.e. none) between the patches that needs to be applied in `spkg-src` because autoconf has to be run after them and \"normal\" patches. I guess since you are patching the tarball anyway, you may as well put *all* the patches in it.",
    "created_at": "2016-03-19T19:54:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154647",
    "user": "https://github.com/kiwifb"
}
```

Bad separation (i.e. none) between the patches that needs to be applied in `spkg-src` because autoconf has to be run after them and "normal" patches. I guess since you are patching the tarball anyway, you may as well put *all* the patches in it.



---

archive/issue_comments_154648.json:
```json
{
    "body": "FWIW the patch has been accepted as-is upstream.",
    "created_at": "2016-03-21T10:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154648",
    "user": "https://github.com/embray"
}
```

FWIW the patch has been accepted as-is upstream.



---

archive/issue_comments_154649.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-21T10:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154649",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_154650.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-21T12:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154650",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_154651.json:
```json
{
    "body": "Building with `CC=\"ccache cc\" CXX=\"ccache c++\"` now works.\n\nI cleaned up the packaging and build of ECL. In particular, I separated the patches which need to be applied by `spkg-src` from the ones which are applied at build-time. This part still needs to be reviewed.\n\n---\nNew commits:",
    "created_at": "2016-03-21T12:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154651",
    "user": "https://github.com/jdemeyer"
}
```

Building with `CC="ccache cc" CXX="ccache c++"` now works.

I cleaned up the packaging and build of ECL. In particular, I separated the patches which need to be applied by `spkg-src` from the ones which are applied at build-time. This part still needs to be reviewed.

---
New commits:



---

archive/issue_comments_154652.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-21T13:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154652",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_154653.json:
```json
{
    "body": "+1",
    "created_at": "2016-03-21T13:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154653",
    "user": "https://github.com/embray"
}
```

+1



---

archive/issue_events_035754.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-22T15:23:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12872#event-35754"
}
```



---

archive/issue_comments_154654.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-22T15:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12872",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12872#issuecomment-154654",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
