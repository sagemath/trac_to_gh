# Issue 12872: ccache chokes on ecl

Issue created by migration from Trac.

Original creator: ohanar

Original creation time: 2012-05-28 04:37:04

Assignee: GeorgSWeber

Keywords: sd40.5

Currently ccache completely fails building ecl, so we should disable ccache in our ecl spkg.


---

Comment by ohanar created at 2012-05-28 04:37:50

Changing status from new to needs_review.


---

Comment by ddrake created at 2012-05-28 18:43:16

I can verify that our current ECL chokes with "`env CC='nice gcc' ./spkg -i ecl...`" and that your spkg fixes it. Perhaps it would be nice to put something into the generated `ecl_cc` so we know whence it came: maybe a comment like `# ECL chokes when CC contains spaces; this script works around that. See #13044.` Then it would be easier to remove this workaround when ECL is updated.

Also, I tried `env CXX='nice g++' ./sage -f ecl...` with the old version and it worked fine. Perhaps we shouldn't also create `ecl_cxx` since ECL is not using a C++ compiler.

Also`^2`, we should send this upstream.


---

Comment by jdemeyer created at 2012-08-13 12:20:48

Changing component from build to packages.


---

Comment by fbissey created at 2013-12-30 10:04:55

Is this still needed?


---

Comment by fbissey created at 2013-12-30 10:04:55

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2013-12-30 10:20:11

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2013-12-30 10:20:11

Yes, it is still needed.


---

Comment by pbruin created at 2014-05-15 20:33:10

This needs to be converted to a new-style package, for the ECL version we currently use.


---

Comment by pbruin created at 2014-05-15 20:33:10

Changing status from needs_review to needs_work.


---

Comment by embray created at 2016-02-24 15:47:28

I can confirm this is still an issue--sage build breaks on ecl when `CC=ccache gcc`--obviously this can be worked around easily enough, but setting `CC` like that is not uncommon either, and only seems to be a problem with ecl.

Would this be worth patching in ecl (both upstream and in sage)?


---

Comment by embray created at 2016-02-24 15:48:33

The updated spkg mentioned in this ticket is a 404 now.


---

Comment by fbissey created at 2016-02-24 20:22:19

Current upstream is https://common-lisp.net/project/ecl/
Also `ecl-16.0.0` has been released and it would be nice to upgrade. It would be worth checking if it is still an issue in the latest release.


---

Comment by embray created at 2016-02-25 08:36:37

There is a similar bug that I've just run into, but in Python, when compiling the Cython sources.  I've never run into this before strangely, but maybe have just worked on fewer projects with cpp generated from Cython: https://bugs.python.org/issue8027

I will check if the ecl issue is fixed upstream.


---

Comment by embray created at 2016-03-17 13:04:57

FYI this bug still exists upstream, or at least in ecl-16.0.0.  I will see if I can come up with a patch.


---

Comment by embray created at 2016-03-17 15:03:22

Submitted a patch to upstream: https://gitlab.com/embeddable-common-lisp/ecl/merge_requests/20


---

Comment by embray created at 2016-03-17 17:16:47

Changing status from needs_work to needs_review.


---

Comment by embray created at 2016-03-17 17:16:47

Added the patch to the spkg.  It applies to the current version of the spkg with a bit of fuzz.  

If I understand correctly I should also update the patch version, and upload a new source package? Not sure exactly how to go about that though.
----
New commits:


---

Comment by jdemeyer created at 2016-03-18 18:13:21

Replying to [comment:18 embray]:
> Added the patch to the spkg.  It applies to the current version of the spkg with a bit of fuzz.  
> 
> If I understand correctly I should also update the patch version
In this exceptional case I think it's not needed because there is no reason to rebuild everybody's ECL with this patch. And in the cases where ECL didn't install before, there is no *re*build needed since there couldn't have been a build in the first place.

> and upload a new source package?
No, because you are not changing the source tarball, just adding a patch.


---

Comment by embray created at 2016-03-18 18:19:19

If I understand correctly, for the package the patches are being applied by `spkg-src` which only seems to apply when building the source tarball.


---

Comment by jdemeyer created at 2016-03-19 13:34:53

Okay, this is unusual...


---

Comment by fbissey created at 2016-03-19 19:54:14

Bad separation (i.e. none) between the patches that needs to be applied in `spkg-src` because autoconf has to be run after them and "normal" patches. I guess since you are patching the tarball anyway, you may as well put *all* the patches in it.


---

Comment by embray created at 2016-03-21 10:02:22

FWIW the patch has been accepted as-is upstream.


---

Comment by jdemeyer created at 2016-03-21 10:29:32

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-03-21 12:11:39

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-03-21 12:11:39

Building with `CC="ccache cc" CXX="ccache c++"` now works.

I cleaned up the packaging and build of ECL. In particular, I separated the patches which need to be applied by `spkg-src` from the ones which are applied at build-time. This part still needs to be reviewed.
----
New commits:


---

Comment by embray created at 2016-03-21 13:16:02

Changing status from needs_review to positive_review.


---

Comment by embray created at 2016-03-21 13:16:02

+1


---

Comment by vbraun created at 2016-03-22 15:23:36

Resolution: fixed
