# Issue 18123: handle mutable objects better in symbolic evaluation

Issue created by migration from https://trac.sagemath.org/ticket/18360

Original creator: rws

Original creation time: 2015-05-04 07:30:35

CC:  nbruin

In examples like this:

```
sage: f(x)=matrix()
sage: bool(f(x)-f(x)==0)
...
TypeError: mutable matrices are unhashable
```

the `f(x)` is expanded into a mutable matrix, but this prevents evaluation because Pynac is called by `Expression._sub_` and wants to do hashes on the matrix for comparison reasons. However, for the purpose of subtraction dealing with a mutable matrix is completely unnecessary. So a solution would be to turn mutable objects immutable before doing arithmetics in `Expression` or in Pynac.


---

Comment by rws created at 2015-06-17 08:54:18

This is quite funny. By chance I hit on the real bug with this issue (note that `f(x)+1` and `f(x)^1` will work) in Pynac. No fiddling with mutable/immutable necessary it seems. Investigating.


---

Comment by rws created at 2015-06-17 14:35:28

Changing priority from major to critical.


---

Comment by rws created at 2015-06-17 14:35:28

Critical because it prevents crashing (#14211).


---

Comment by rws created at 2015-07-16 08:42:53

Changing status from new to needs_review.


---

Comment by rws created at 2015-07-16 08:42:53

Depends on #17321 because of merge conflict.
----
New commits:


---

Comment by rws created at 2015-07-16 09:22:07

Changing priority from critical to minor.


---

Comment by rws created at 2015-07-16 09:22:07

The fix is already in, so no longer critical.


---

Comment by git created at 2015-07-16 15:09:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-03 05:58:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-08-09 12:00:32

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2015-08-09 12:00:32

ok, this works in 6.9.b1


---

Comment by vbraun created at 2015-08-09 22:38:16

Resolution: fixed
