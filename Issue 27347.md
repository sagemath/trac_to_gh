# Issue 27347: Characteristic Classes

archive/issues_027347.json:
```json
{
    "body": "CC:  @egourgoulhon @tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27584\n\n",
    "created_at": "2019-03-31T22:17:48Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Characteristic Classes",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27347",
    "user": "https://github.com/DeRhamSource"
}
```
CC:  @egourgoulhon @tscrim



Issue created by migration from https://trac.sagemath.org/ticket/27584





---

archive/issue_comments_385141.json:
```json
{
    "body": "Changing keywords from \"\" to \"characteristic classes, manifolds\".",
    "created_at": "2019-03-31T22:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385141",
    "user": "https://github.com/DeRhamSource"
}
```

Changing keywords from "" to "characteristic classes, manifolds".



---

archive/issue_comments_385142.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-03-31T22:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385142",
    "user": "https://github.com/DeRhamSource"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_385143.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to geometry.",
    "created_at": "2019-03-31T22:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385143",
    "user": "https://github.com/DeRhamSource"
}
```

Changing component from PLEASE CHANGE to geometry.



---

archive/issue_comments_385144.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-03T11:37:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385145.json:
```json
{
    "body": "Here is the answer to the question raised in https://groups.google.com/d/msg/sage-devel/hwsQWuLN0nc/1_8LjLL4AgAJ, namely when `a` is a differential form (from previously existing `DiffForm` class) and `A` is a mixed form (as introduced in this ticket), why do we get\n\n```\nsage: a.__mul__(A)\nMixed differential form A/\\a on the 2-dimensional differentiable manifold M\n```\n\nI think this results from a clash between (i) the operator `__mul__` being used to denote the wedge product for mixed differential forms and (ii) the operator `__mul__` being used to denote tensor product for differential forms. Indeed `a.__mul__(A)`  calls the method `__mul__` implemented in line 2169 of `src/sage/manifolds/differentiable/tensorfield.py`, which is devoted to the tensor product (the differential form `a` being considered as a tensor field of type (0,p), where p=degree(a)). As you can see in line 2269, if `A` does not belong to the class `TensorField`, one assumes that `A` is a scalar field (the only possible case until this ticket) and the code return `A*a`, i.e. `A.wedge(a)`. \n\nA possible solution could be to change the lines 2269-2271 of `tensorfield.py` to\n\n```\nif isinstance(other, MixedForm):\n    return other.parent()(self)._mul_(other)\nelif not isinstance(other, TensorField):\n    # Multiplication by a scalar field or a number\n    return other * self\n```\n\nA better way would be to redefine `__mul__` in `DiffForm`, falling back to the tensor field version if `other` is not a mixed form.",
    "created_at": "2019-04-03T12:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385145",
    "user": "https://github.com/egourgoulhon"
}
```

Here is the answer to the question raised in https://groups.google.com/d/msg/sage-devel/hwsQWuLN0nc/1_8LjLL4AgAJ, namely when `a` is a differential form (from previously existing `DiffForm` class) and `A` is a mixed form (as introduced in this ticket), why do we get

```
sage: a.__mul__(A)
Mixed differential form A/\a on the 2-dimensional differentiable manifold M
```

I think this results from a clash between (i) the operator `__mul__` being used to denote the wedge product for mixed differential forms and (ii) the operator `__mul__` being used to denote tensor product for differential forms. Indeed `a.__mul__(A)`  calls the method `__mul__` implemented in line 2169 of `src/sage/manifolds/differentiable/tensorfield.py`, which is devoted to the tensor product (the differential form `a` being considered as a tensor field of type (0,p), where p=degree(a)). As you can see in line 2269, if `A` does not belong to the class `TensorField`, one assumes that `A` is a scalar field (the only possible case until this ticket) and the code return `A*a`, i.e. `A.wedge(a)`. 

A possible solution could be to change the lines 2269-2271 of `tensorfield.py` to

```
if isinstance(other, MixedForm):
    return other.parent()(self)._mul_(other)
elif not isinstance(other, TensorField):
    # Multiplication by a scalar field or a number
    return other * self
```

A better way would be to redefine `__mul__` in `DiffForm`, falling back to the tensor field version if `other` is not a mixed form.



---

archive/issue_comments_385146.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-03T14:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385147.json:
```json
{
    "body": "Your code looks nice, as well as the demo notebook! \n\nJust a remark at this stage: you should not put any Jupyter notebook in the ticket's git branch. Indeed, when the ticket gets a positive review, the branch is merged into Sage's main branch, which must contain only source code (it is already very large just with sources). It is of course a good idea to share notebooks during the development process, but you should put them to a public repository (e.g. GitHub) and simply add a link to them in some comment on the ticket.",
    "created_at": "2019-04-04T14:03:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385147",
    "user": "https://github.com/egourgoulhon"
}
```

Your code looks nice, as well as the demo notebook! 

Just a remark at this stage: you should not put any Jupyter notebook in the ticket's git branch. Indeed, when the ticket gets a positive review, the branch is merged into Sage's main branch, which must contain only source code (it is already very large just with sources). It is of course a good idea to share notebooks during the development process, but you should put them to a public repository (e.g. GitHub) and simply add a link to them in some comment on the ticket.



---

archive/issue_comments_385148.json:
```json
{
    "body": "The other thing you could do is add the notebook file as an attachment (but note that you cannot delete it afterwards).",
    "created_at": "2019-04-04T14:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385148",
    "user": "https://github.com/tscrim"
}
```

The other thing you could do is add the notebook file as an attachment (but note that you cannot delete it afterwards).



---

archive/issue_comments_385149.json:
```json
{
    "body": "Oh I'm sorry, I didn't realize that. How can I delete this file from the ticket?\n\nIn the next step, I will translate the notebook to english and add Doctests to the main files. Then, I guess, it's ready for review.",
    "created_at": "2019-04-04T14:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385149",
    "user": "https://github.com/DeRhamSource"
}
```

Oh I'm sorry, I didn't realize that. How can I delete this file from the ticket?

In the next step, I will translate the notebook to english and add Doctests to the main files. Then, I guess, it's ready for review.



---

archive/issue_comments_385150.json:
```json
{
    "body": "Replying to [comment:12 gh-DeRhamSource]:\n> Oh I'm sorry, I didn't realize that. How can I delete this file from the ticket?\n> \n\nSince the file is not very large, I guess it suffices to run\n\n```\ngit rm scripts/MixedAlgebra.ipynb\n```\n\nbefore your next commit. \nOtherwise (i.e. for a large file), I would have recommended to delete the branch and to start a brand new one. \n> In the next step, I will translate the notebook to english and add Doctests to the main files. Then, I guess, it's ready for review.\n\nOK very good!",
    "created_at": "2019-04-04T14:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385150",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:12 gh-DeRhamSource]:
> Oh I'm sorry, I didn't realize that. How can I delete this file from the ticket?
> 

Since the file is not very large, I guess it suffices to run

```
git rm scripts/MixedAlgebra.ipynb
```

before your next commit. 
Otherwise (i.e. for a large file), I would have recommended to delete the branch and to start a brand new one. 
> In the next step, I will translate the notebook to english and add Doctests to the main files. Then, I guess, it's ready for review.

OK very good!



---

archive/issue_comments_385151.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-04T15:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385151",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385152.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-05T15:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385153.json:
```json
{
    "body": "I added a link to my public github repo for the demo notebook in the description.",
    "created_at": "2019-04-05T15:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385153",
    "user": "https://github.com/DeRhamSource"
}
```

I added a link to my public github repo for the demo notebook in the description.



---

archive/issue_comments_385154.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-06T16:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385154",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385155.json:
```json
{
    "body": "There is now a full doctest implemented in mixed_form_algebra.py. However, I've encountered another problem while coding the doctest of mixed_form.py. Namely an issue with coercions from the symbolic ring:\n\n\n```\nsage: M = Manifold(2, 'M')\nsage: X.<x,y> = M.chart()\nsage: A = M.mixed_form_algebra()\nsage: A._element_constructor_(x).disp(X.frame())\n[x] + [0] + [0]\nsage: A(x).disp(X.frame())\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-84-7bd889258762> in <module>()\n----> 1 A(x).disp(X.frame())\n\nAttributeError: 'NoneType' object has no attribute 'disp'\n```\n\n\nHow is that possible? Shouldn't A(.) invoke the method A._element_constructor_?",
    "created_at": "2019-04-06T16:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385155",
    "user": "https://github.com/DeRhamSource"
}
```

There is now a full doctest implemented in mixed_form_algebra.py. However, I've encountered another problem while coding the doctest of mixed_form.py. Namely an issue with coercions from the symbolic ring:


```
sage: M = Manifold(2, 'M')
sage: X.<x,y> = M.chart()
sage: A = M.mixed_form_algebra()
sage: A._element_constructor_(x).disp(X.frame())
[x] + [0] + [0]
sage: A(x).disp(X.frame())
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-84-7bd889258762> in <module>()
----> 1 A(x).disp(X.frame())

AttributeError: 'NoneType' object has no attribute 'disp'
```


How is that possible? Shouldn't A(.) invoke the method A._element_constructor_?



---

archive/issue_comments_385156.json:
```json
{
    "body": "It does, but only after checking for a coercion. So my guess is something is going strange with the coercion. Posting the full traceback would be useful.\n\nA few unrelated comments:\n\n`isinstance(comp, (int, Integer))` -> `comp in ZZ` because it also catches cases like `2/1` (which is in `QQ`).\n\nA few of your example blocks should be `TESTS::` and `EXAMPLES::` when followed immediately by doctests, which should also be indentent 1 level.",
    "created_at": "2019-04-06T22:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385156",
    "user": "https://github.com/tscrim"
}
```

It does, but only after checking for a coercion. So my guess is something is going strange with the coercion. Posting the full traceback would be useful.

A few unrelated comments:

`isinstance(comp, (int, Integer))` -> `comp in ZZ` because it also catches cases like `2/1` (which is in `QQ`).

A few of your example blocks should be `TESTS::` and `EXAMPLES::` when followed immediately by doctests, which should also be indentent 1 level.



---

archive/issue_comments_385157.json:
```json
{
    "body": "Thanks! :)\n\nThe snippet `isinstance(comp, (int, Integer))` is adapted from `diff_form_module.py`. Should I apply your suggestion in that file as well for this branch, then?\n\nMore feedback and suggestions are very welcome! :)\n\nUnfortunately, there is no error message or traceback:\n\n\n```\nsage: M = Manifold(2, 'M')\nsage: X.<x,y> = M.chart()\nsage: A = M.mixed_form_algebra()\nsage: A(x)\n```\n\n\nThe coercion is already known:\n\n\n```\nsage: M.mixed_form_algebra().has_coerce_map_from(SR)\nTrue\n```\n\n\nSo, I have really no idea why it won't work. But for scalar fields, it does:\n\n\n```\nsage: f = M.scalar_field_algebra()(x); f\nScalar field on the 2-dimensional differentiable manifold M\n```\n",
    "created_at": "2019-04-06T23:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385157",
    "user": "https://github.com/DeRhamSource"
}
```

Thanks! :)

The snippet `isinstance(comp, (int, Integer))` is adapted from `diff_form_module.py`. Should I apply your suggestion in that file as well for this branch, then?

More feedback and suggestions are very welcome! :)

Unfortunately, there is no error message or traceback:


```
sage: M = Manifold(2, 'M')
sage: X.<x,y> = M.chart()
sage: A = M.mixed_form_algebra()
sage: A(x)
```


The coercion is already known:


```
sage: M.mixed_form_algebra().has_coerce_map_from(SR)
True
```


So, I have really no idea why it won't work. But for scalar fields, it does:


```
sage: f = M.scalar_field_algebra()(x); f
Scalar field on the 2-dimensional differentiable manifold M
```




---

archive/issue_comments_385158.json:
```json
{
    "body": "Hmm...so the output of `A(x)` really is `None`...that is very strange. What does `coercion_model.explain(x, A)` result in?",
    "created_at": "2019-04-06T23:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385158",
    "user": "https://github.com/tscrim"
}
```

Hmm...so the output of `A(x)` really is `None`...that is very strange. What does `coercion_model.explain(x, A)` result in?



---

archive/issue_comments_385159.json:
```json
{
    "body": "\n```\nsage: M = Manifold(2, 'M')\nsage: X.<x,y> = M.chart()\nsage: A = M.mixed_form_algebra()\nsage: coercion_model.explain(x, A)\nCoercion on left operand via\n    Generic morphism:\n      From: Symbolic Ring\n      To:   Graded algebra Omega^*(M) of mixed differential forms on the 2-dimensional differentiable manifold M\nArithmetic performed after coercions.\nResult lives in Graded algebra Omega^*(M) of mixed differential forms on the 2-dimensional differentiable manifold M\n```\n",
    "created_at": "2019-04-06T23:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385159",
    "user": "https://github.com/DeRhamSource"
}
```


```
sage: M = Manifold(2, 'M')
sage: X.<x,y> = M.chart()
sage: A = M.mixed_form_algebra()
sage: coercion_model.explain(x, A)
Coercion on left operand via
    Generic morphism:
      From: Symbolic Ring
      To:   Graded algebra Omega^*(M) of mixed differential forms on the 2-dimensional differentiable manifold M
Arithmetic performed after coercions.
Result lives in Graded algebra Omega^*(M) of mixed differential forms on the 2-dimensional differentiable manifold M
```




---

archive/issue_comments_385160.json:
```json
{
    "body": "What is the result of\n\n```\nsage: phi = A.coerce_map_from_(SR)\nsage: phi\nsage: type(phi)\nsage: phi(x)\n```\n",
    "created_at": "2019-04-07T00:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385160",
    "user": "https://github.com/tscrim"
}
```

What is the result of

```
sage: phi = A.coerce_map_from_(SR)
sage: phi
sage: type(phi)
sage: phi(x)
```




---

archive/issue_comments_385161.json:
```json
{
    "body": "\n```\nsage: M = Manifold(2, 'M')\nsage: X.<x,y> = M.chart()\nsage: A = M.mixed_form_algebra()\nsage: phi = A.coerce_map_from(SR)\nsage: phi\nGeneric morphism:\n  From: Symbolic Ring\n  To:   Graded algebra Omega^*(M) of mixed differential forms on the 2-dimensional differentiable manifold M\nsage: type(phi)\n<type 'sage.categories.morphism.SetMorphism'>\nsage: phi(x)\nsage: type(phi(x))\n<type 'NoneType'>\n```\n",
    "created_at": "2019-04-07T07:34:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385161",
    "user": "https://github.com/DeRhamSource"
}
```


```
sage: M = Manifold(2, 'M')
sage: X.<x,y> = M.chart()
sage: A = M.mixed_form_algebra()
sage: phi = A.coerce_map_from(SR)
sage: phi
Generic morphism:
  From: Symbolic Ring
  To:   Graded algebra Omega^*(M) of mixed differential forms on the 2-dimensional differentiable manifold M
sage: type(phi)
<type 'sage.categories.morphism.SetMorphism'>
sage: phi(x)
sage: type(phi(x))
<type 'NoneType'>
```




---

archive/issue_comments_385162.json:
```json
{
    "body": "That was what I was expecting. Basically what is happening is when it goes through the coercion framework, the result is `None`. So you need to look into that coercion morphism and what function it is calling and why that is not returning the proper object.",
    "created_at": "2019-04-07T07:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385162",
    "user": "https://github.com/tscrim"
}
```

That was what I was expecting. Basically what is happening is when it goes through the coercion framework, the result is `None`. So you need to look into that coercion morphism and what function it is calling and why that is not returning the proper object.



---

archive/issue_comments_385163.json:
```json
{
    "body": "I'm sorry: How do I manage that?",
    "created_at": "2019-04-07T08:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385163",
    "user": "https://github.com/DeRhamSource"
}
```

I'm sorry: How do I manage that?



---

archive/issue_comments_385164.json:
```json
{
    "body": "You will have to explore the properties of the morphism, such as `phi._function`, and maybe also add a `print()` statement or two for debugging in the `_element_constructor_` to see what is happening.",
    "created_at": "2019-04-07T13:33:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385164",
    "user": "https://github.com/tscrim"
}
```

You will have to explore the properties of the morphism, such as `phi._function`, and maybe also add a `print()` statement or two for debugging in the `_element_constructor_` to see what is happening.



---

archive/issue_comments_385165.json:
```json
{
    "body": "I think the issue arises because `SR` is the base ring of the algebra `A`:\n\n```\nsage: A.base_ring()\nSymbolic Ring\n```\n\nIf I am correct, in such a case, the coercion `SR` --> `A` is implemented via the algebra operation `x * A.one()`, not via `_element_constructor_`. In the present case, `x * A.one()` fails:\n\n```\nsage: x * A.one()\n...\nRuntimeError: BUG in map, returned None x <type 'sage.categories.morphism.SetMorphism'> Generic morphism:\n  From: Symbolic Ring\n  To:   Graded algebra Omega^*(M) of mixed differential forms on the 2-dimensional differentiable manifold M\n```\n\nTo make it work, you should implement the method `_lmul_` in class `MixedForm` and add the line \n\n```\n    if other is SR:\n        return True\n```\n\nin `MixedFormAlgebra._coerce_map_from_`. At least, this is what is done for the algebras of scalar fields: see line 512 of `src/sage/manifolds/scalarfield_algebra.py` and the definition of `_lmul_` in line 2449 of `src/sage/manifolds/scalarfield.py`.",
    "created_at": "2019-04-07T17:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385165",
    "user": "https://github.com/egourgoulhon"
}
```

I think the issue arises because `SR` is the base ring of the algebra `A`:

```
sage: A.base_ring()
Symbolic Ring
```

If I am correct, in such a case, the coercion `SR` --> `A` is implemented via the algebra operation `x * A.one()`, not via `_element_constructor_`. In the present case, `x * A.one()` fails:

```
sage: x * A.one()
...
RuntimeError: BUG in map, returned None x <type 'sage.categories.morphism.SetMorphism'> Generic morphism:
  From: Symbolic Ring
  To:   Graded algebra Omega^*(M) of mixed differential forms on the 2-dimensional differentiable manifold M
```

To make it work, you should implement the method `_lmul_` in class `MixedForm` and add the line 

```
    if other is SR:
        return True
```

in `MixedFormAlgebra._coerce_map_from_`. At least, this is what is done for the algebras of scalar fields: see line 512 of `src/sage/manifolds/scalarfield_algebra.py` and the definition of `_lmul_` in line 2449 of `src/sage/manifolds/scalarfield.py`.



---

archive/issue_comments_385166.json:
```json
{
    "body": "Yes, perfect. That solved the problem. Thanks! :)",
    "created_at": "2019-04-07T18:19:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385166",
    "user": "https://github.com/DeRhamSource"
}
```

Yes, perfect. That solved the problem. Thanks! :)



---

archive/issue_comments_385167.json:
```json
{
    "body": "Replying to [comment:29 egourgoulhon]:\n> To make it work, you should implement the method `_lmul_` in class `MixedForm` and add the line \n> {{{\n>     if other is SR:\n>         return True\n> }}}\n> in `MixedFormAlgebra._coerce_map_from_`. At least, this is what is done for the algebras of scalar fields: see line 512 of `src/sage/manifolds/scalarfield_algebra.py` and the definition of `_lmul_` in line 2449 of `src/sage/manifolds/scalarfield.py`.\n\nI am a little worried about this. What about `_rmul_`? This also makes the dependence too strong on the base ring being `SR`. Can we use `if other is self.base_ring()` or something like that?",
    "created_at": "2019-04-08T12:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385167",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:29 egourgoulhon]:
> To make it work, you should implement the method `_lmul_` in class `MixedForm` and add the line 
> {{{
>     if other is SR:
>         return True
> }}}
> in `MixedFormAlgebra._coerce_map_from_`. At least, this is what is done for the algebras of scalar fields: see line 512 of `src/sage/manifolds/scalarfield_algebra.py` and the definition of `_lmul_` in line 2449 of `src/sage/manifolds/scalarfield.py`.

I am a little worried about this. What about `_rmul_`? This also makes the dependence too strong on the base ring being `SR`. Can we use `if other is self.base_ring()` or something like that?



---

archive/issue_comments_385168.json:
```json
{
    "body": "Replying to [comment:31 tscrim]:\n> \n> I am a little worried about this. What about `_rmul_`? \n>\nI am puzzled now about the scalar field algebra implementation. Why do we have `_lmul_` and not `_rmul_`? Indeed, `__rmul__` is the standard Python operator for reflected operands and `__lmul__` does not exist in Python. What's exactly the role of `_lmul_` in Sage? I guess it is there for noncommutative base rings but I could not find a good place in the documentation explaining this... \nIn the present case, both for scalar field and mixed form algebras, we are dealing with a base ring that is commutative (since it is a field), so shouldn't we have only `_rmul_`?",
    "created_at": "2019-04-08T12:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385168",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:31 tscrim]:
> 
> I am a little worried about this. What about `_rmul_`? 
>
I am puzzled now about the scalar field algebra implementation. Why do we have `_lmul_` and not `_rmul_`? Indeed, `__rmul__` is the standard Python operator for reflected operands and `__lmul__` does not exist in Python. What's exactly the role of `_lmul_` in Sage? I guess it is there for noncommutative base rings but I could not find a good place in the documentation explaining this... 
In the present case, both for scalar field and mixed form algebras, we are dealing with a base ring that is commutative (since it is a field), so shouldn't we have only `_rmul_`?



---

archive/issue_comments_385169.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-08T14:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385170.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-08T14:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385170",
    "user": "https://github.com/DeRhamSource"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_385171.json:
```json
{
    "body": "Replying to [comment:29 egourgoulhon]:\n> To make it work, you should implement the method `_lmul_` in class `MixedForm` and add the line \n> {{{\n>     if other is SR:\n>         return True\n> }}}\n> in `MixedFormAlgebra._coerce_map_from_`. At least, this is what is done for the algebras of scalar fields: see line 512 of `src/sage/manifolds/scalarfield_algebra.py` and the definition of `_lmul_` in line 2449 of `src/sage/manifolds/scalarfield.py`.\n\nI managed the coercion detection via\n\n\n```\n        if self._domain.scalar_field_algebra().has_coerce_map_from(S):\n            return True\n```\n\n\nDoes that also eliminate your doubts concerning the strong dependencies on SR, Travis?",
    "created_at": "2019-04-08T15:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385171",
    "user": "https://github.com/DeRhamSource"
}
```

Replying to [comment:29 egourgoulhon]:
> To make it work, you should implement the method `_lmul_` in class `MixedForm` and add the line 
> {{{
>     if other is SR:
>         return True
> }}}
> in `MixedFormAlgebra._coerce_map_from_`. At least, this is what is done for the algebras of scalar fields: see line 512 of `src/sage/manifolds/scalarfield_algebra.py` and the definition of `_lmul_` in line 2449 of `src/sage/manifolds/scalarfield.py`.

I managed the coercion detection via


```
        if self._domain.scalar_field_algebra().has_coerce_map_from(S):
            return True
```


Does that also eliminate your doubts concerning the strong dependencies on SR, Travis?



---

archive/issue_comments_385172.json:
```json
{
    "body": "Replying to [comment:32 egourgoulhon]:\n> Replying to [comment:31 tscrim]:\n> > \n> > I am a little worried about this. What about `_rmul_`? \n> >\n> I am puzzled now about the scalar field algebra implementation. Why do we have `_lmul_` and not `_rmul_`? Indeed, `__rmul__` is the standard Python operator for reflected operands and `__lmul__` does not exist in Python. What's exactly the role of `_lmul_` in Sage? I guess it is there for noncommutative base rings but I could not find a good place in the documentation explaining this... \n> In the present case, both for scalar field and mixed form algebras, we are dealing with a base ring that is commutative (since it is a field), so shouldn't we have only `_rmul_`?\n\nI see in line 2394 of `src/sage/structure/element.pyx` that `_rmul_` falls back to `_lmul_`, which is not implemented at the `ModuleElement` level (actually returns `None`). This leaves the impression that when implementing a new module element class over a commutative ring, one shall actually implement `_lmul_` and not `_rmul_`...  Accordingly, my understanding at the moment is that in Sage, we have \n- `_mul_(self, other)` when `self` and `other` have the same parent\n- `_lmul_(self, other)` when `self` and `other` have distinct parents\n- `_rmul_(self, other)` is inherited from  `ModuleElement` (if not redefined) and falls back to `_lmul_`\n\nTravis, do you confirm?",
    "created_at": "2019-04-08T15:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385172",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:32 egourgoulhon]:
> Replying to [comment:31 tscrim]:
> > 
> > I am a little worried about this. What about `_rmul_`? 
> >
> I am puzzled now about the scalar field algebra implementation. Why do we have `_lmul_` and not `_rmul_`? Indeed, `__rmul__` is the standard Python operator for reflected operands and `__lmul__` does not exist in Python. What's exactly the role of `_lmul_` in Sage? I guess it is there for noncommutative base rings but I could not find a good place in the documentation explaining this... 
> In the present case, both for scalar field and mixed form algebras, we are dealing with a base ring that is commutative (since it is a field), so shouldn't we have only `_rmul_`?

I see in line 2394 of `src/sage/structure/element.pyx` that `_rmul_` falls back to `_lmul_`, which is not implemented at the `ModuleElement` level (actually returns `None`). This leaves the impression that when implementing a new module element class over a commutative ring, one shall actually implement `_lmul_` and not `_rmul_`...  Accordingly, my understanding at the moment is that in Sage, we have 
- `_mul_(self, other)` when `self` and `other` have the same parent
- `_lmul_(self, other)` when `self` and `other` have distinct parents
- `_rmul_(self, other)` is inherited from  `ModuleElement` (if not redefined) and falls back to `_lmul_`

Travis, do you confirm?



---

archive/issue_comments_385173.json:
```json
{
    "body": "Replying to [comment:36 egourgoulhon]:\n> Replying to [comment:32 egourgoulhon]:\n> > Replying to [comment:31 tscrim]:\n> > > \n> > > I am a little worried about this. What about `_rmul_`? \n> > >\n> > I am puzzled now about the scalar field algebra implementation. Why do we have `_lmul_` and not `_rmul_`? Indeed, `__rmul__` is the standard Python operator for reflected operands and `__lmul__` does not exist in Python. What's exactly the role of `_lmul_` in Sage? I guess it is there for noncommutative base rings but I could not find a good place in the documentation explaining this... \n> > In the present case, both for scalar field and mixed form algebras, we are dealing with a base ring that is commutative (since it is a field), so shouldn't we have only `_rmul_`?\n> \n> I see in line 2394 of `src/sage/structure/element.pyx` that `_rmul_` falls back to `_lmul_`, which is not implemented at the `ModuleElement` level (actually returns `None`). This leaves the impression that when implementing a new module element class over a commutative ring, one shall actually implement `_lmul_` and not `_rmul_`...  Accordingly, my understanding at the moment is that in Sage, we have \n> - `_mul_(self, other)` when `self` and `other` have the same parent\n> - `_lmul_(self, other)` when `self` and `other` have distinct parents\n> - `_rmul_(self, other)` is inherited from  `ModuleElement` (if not redefined) and falls back to `_lmul_`\n> \n> Travis, do you confirm?\n\nAh, right, I forgot that generic `_rmul_` was implemented in `ModuleElement`.\n\nSo Sage's `_rmul_` should not be confused with Python's `__rmul__`.\n\nPython's `__rmul__` is for when `self` knows how to multiply with `other` when `self` is on the right, but `other` does not. For instance, it handles `5 * self` because we cannot override the `int` type (which means the \"standard `int.__mul__`\" fails), but `self` knows what to do.\n\nSage's `_rmul_` and `_lmul_` play the same role, just on different sides. They are there to implement actions of `other` on `self` on the right or left, and thus are used by the coercion framework (in particular, they check if coercions can be applied).",
    "created_at": "2019-04-08T22:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385173",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:36 egourgoulhon]:
> Replying to [comment:32 egourgoulhon]:
> > Replying to [comment:31 tscrim]:
> > > 
> > > I am a little worried about this. What about `_rmul_`? 
> > >
> > I am puzzled now about the scalar field algebra implementation. Why do we have `_lmul_` and not `_rmul_`? Indeed, `__rmul__` is the standard Python operator for reflected operands and `__lmul__` does not exist in Python. What's exactly the role of `_lmul_` in Sage? I guess it is there for noncommutative base rings but I could not find a good place in the documentation explaining this... 
> > In the present case, both for scalar field and mixed form algebras, we are dealing with a base ring that is commutative (since it is a field), so shouldn't we have only `_rmul_`?
> 
> I see in line 2394 of `src/sage/structure/element.pyx` that `_rmul_` falls back to `_lmul_`, which is not implemented at the `ModuleElement` level (actually returns `None`). This leaves the impression that when implementing a new module element class over a commutative ring, one shall actually implement `_lmul_` and not `_rmul_`...  Accordingly, my understanding at the moment is that in Sage, we have 
> - `_mul_(self, other)` when `self` and `other` have the same parent
> - `_lmul_(self, other)` when `self` and `other` have distinct parents
> - `_rmul_(self, other)` is inherited from  `ModuleElement` (if not redefined) and falls back to `_lmul_`
> 
> Travis, do you confirm?

Ah, right, I forgot that generic `_rmul_` was implemented in `ModuleElement`.

So Sage's `_rmul_` should not be confused with Python's `__rmul__`.

Python's `__rmul__` is for when `self` knows how to multiply with `other` when `self` is on the right, but `other` does not. For instance, it handles `5 * self` because we cannot override the `int` type (which means the "standard `int.__mul__`" fails), but `self` knows what to do.

Sage's `_rmul_` and `_lmul_` play the same role, just on different sides. They are there to implement actions of `other` on `self` on the right or left, and thus are used by the coercion framework (in particular, they check if coercions can be applied).



---

archive/issue_comments_385174.json:
```json
{
    "body": "Replying to [comment:35 gh-DeRhamSource]:\n> Replying to [comment:29 egourgoulhon]:\n> > To make it work, you should implement the method `_lmul_` in class `MixedForm` and add the line \n> > {{{\n> >     if other is SR:\n> >         return True\n> > }}}\n> > in `MixedFormAlgebra._coerce_map_from_`. At least, this is what is done for the algebras of scalar fields: see line 512 of `src/sage/manifolds/scalarfield_algebra.py` and the definition of `_lmul_` in line 2449 of `src/sage/manifolds/scalarfield.py`.\n> \n> I managed the coercion detection via\n> \n> {{{\n>         if self._domain.scalar_field_algebra().has_coerce_map_from(S):\n>             return True\n> }}}\n> \n> Does that also eliminate your doubts concerning the strong dependencies on SR, Travis?\n\nYes, I think that is better. Generally, I do not think it is a good idea to hardcode a ring unless you really only want to work with that ring (and my understanding is that this could be made more flexible in the future).",
    "created_at": "2019-04-08T22:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385174",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:35 gh-DeRhamSource]:
> Replying to [comment:29 egourgoulhon]:
> > To make it work, you should implement the method `_lmul_` in class `MixedForm` and add the line 
> > {{{
> >     if other is SR:
> >         return True
> > }}}
> > in `MixedFormAlgebra._coerce_map_from_`. At least, this is what is done for the algebras of scalar fields: see line 512 of `src/sage/manifolds/scalarfield_algebra.py` and the definition of `_lmul_` in line 2449 of `src/sage/manifolds/scalarfield.py`.
> 
> I managed the coercion detection via
> 
> {{{
>         if self._domain.scalar_field_algebra().has_coerce_map_from(S):
>             return True
> }}}
> 
> Does that also eliminate your doubts concerning the strong dependencies on SR, Travis?

Yes, I think that is better. Generally, I do not think it is a good idea to hardcode a ring unless you really only want to work with that ring (and my understanding is that this could be made more flexible in the future).



---

archive/issue_comments_385175.json:
```json
{
    "body": "There was a merge conflict with Sage 8.8.beta1 in the file `src/sage/manifolds/differentiable/manifold.py`. This was due to #27581 (initialization of the components of a tensor field while declaring it), which changed that file. The conflict is solved in the attached branch (since I am the author of #27581, it was probably easier that I solved this conflict, hence the new branch).\n----\nNew commits:",
    "created_at": "2019-04-09T22:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385175",
    "user": "https://github.com/egourgoulhon"
}
```

There was a merge conflict with Sage 8.8.beta1 in the file `src/sage/manifolds/differentiable/manifold.py`. This was due to #27581 (initialization of the components of a tensor field while declaring it), which changed that file. The conflict is solved in the attached branch (since I am the author of #27581, it was probably easier that I solved this conflict, hence the new branch).
----
New commits:



---

archive/issue_comments_385176.json:
```json
{
    "body": "If you click on the patchbot button (marked \"8.8.beta1\") located at the right of the ticket title, you will access to the [patchbot reports](https://patchbot.sagemath.org/ticket/27584/). One of them is useless, due to some patchbot issue (the one marked \"BuildFailed\"). The most relevant one is from the patchbot \"zancara\". It indicates \"TestFailed\", but if you click either on \"log\" or \"shortlog\", you'll see that the failure occurs in a source file that has not been touched by this ticket: `src/sage/tests/books/computational-mathematics-with-sagemath/graphique_doctest.py`. So this is more an issue on the patchbot size. The only relevant issue is the *pyflakes* error marked by a red cross in the plugin list at the right of the summary of zancara's report: if you click on \"diff\", you get \n\n```\nsrc/sage/manifolds/differentiable/mixed_form_algebra.py:31: \n'sage.rings.integer.Integer' imported but unused\n```\n\nCan you please correct this?\nNote that you shall update your Sage version to 8.8.beta1. If this is not done already, it suffices to pull the new ticket branch and run \n`MAKE=\"make -j8\" make`.",
    "created_at": "2019-04-10T06:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385176",
    "user": "https://github.com/egourgoulhon"
}
```

If you click on the patchbot button (marked "8.8.beta1") located at the right of the ticket title, you will access to the [patchbot reports](https://patchbot.sagemath.org/ticket/27584/). One of them is useless, due to some patchbot issue (the one marked "BuildFailed"). The most relevant one is from the patchbot "zancara". It indicates "TestFailed", but if you click either on "log" or "shortlog", you'll see that the failure occurs in a source file that has not been touched by this ticket: `src/sage/tests/books/computational-mathematics-with-sagemath/graphique_doctest.py`. So this is more an issue on the patchbot size. The only relevant issue is the *pyflakes* error marked by a red cross in the plugin list at the right of the summary of zancara's report: if you click on "diff", you get 

```
src/sage/manifolds/differentiable/mixed_form_algebra.py:31: 
'sage.rings.integer.Integer' imported but unused
```

Can you please correct this?
Note that you shall update your Sage version to 8.8.beta1. If this is not done already, it suffices to pull the new ticket branch and run 
`MAKE="make -j8" make`.



---

archive/issue_comments_385177.json:
```json
{
    "body": "Regarding the documentation: you have added doctests in the Python sources but the documentation is not generated since there is no entry to it in the sources of the reference manual. You shall modify/add files in `src/doc/en/reference/manifolds`, for instance in a way similar to what is done for differential forms, i.e. create a file `mixed_diff_form.rst` and add a pointer to it in `diff_manifold.rst`. To generate the documentation in a fast way, i.e. without having Sage process the whole reference manual, run\n\n```\nsage -docbuild reference/manifolds html\n```\n",
    "created_at": "2019-04-10T06:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385177",
    "user": "https://github.com/egourgoulhon"
}
```

Regarding the documentation: you have added doctests in the Python sources but the documentation is not generated since there is no entry to it in the sources of the reference manual. You shall modify/add files in `src/doc/en/reference/manifolds`, for instance in a way similar to what is done for differential forms, i.e. create a file `mixed_diff_form.rst` and add a pointer to it in `diff_manifold.rst`. To generate the documentation in a fast way, i.e. without having Sage process the whole reference manual, run

```
sage -docbuild reference/manifolds html
```




---

archive/issue_comments_385178.json:
```json
{
    "body": "Side remark: the bug that you've reported in https://groups.google.com/d/msg/sage-devel/EfLYpAxl_jU/ShlCS9L4BgAJ is fixed in Sage 8.8.beta1 (since #25576 has been merged in it).",
    "created_at": "2019-04-10T08:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385178",
    "user": "https://github.com/egourgoulhon"
}
```

Side remark: the bug that you've reported in https://groups.google.com/d/msg/sage-devel/EfLYpAxl_jU/ShlCS9L4BgAJ is fixed in Sage 8.8.beta1 (since #25576 has been merged in it).



---

archive/issue_comments_385179.json:
```json
{
    "body": "Replying to [comment:41 egourgoulhon]:\n> Regarding the documentation: you have added doctests in the Python sources but the documentation is not generated since there is no entry to it in the sources of the reference manual. You shall modify/add files in `src/doc/en/reference/manifolds`, for instance in a way similar to what is done for differential forms, i.e. create a file `mixed_diff_form.rst` and add a pointer to it in `diff_manifold.rst`. To generate the documentation in a fast way, i.e. without having Sage process the whole reference manual, run\n> {{{\n> sage -docbuild reference/manifolds html\n> }}}\n\nUnfortunately, I get some errors:\n\n\n\n```\n[manifolds] /home/michi/GitProjects/sage/src/sage_setup/docbuild/ext/sage_autodoc.py:1170: RemovedInSphinx20Warning: formatargspec() is now deprecated.  Please use sphinx.util.inspect.Signature instead.\n[manifolds]   return formatargspec(initmeth, *argspec)\n[manifolds] /home/michi/GitProjects/sage/src/sage_setup/docbuild/ext/sage_autodoc.py:1406: RemovedInSphinx20Warning: formatargspec() is now deprecated.  Please use sphinx.util.inspect.Signature instead.\n[manifolds]   args = formatargspec(self.object, *argspec)\n[manifolds] /home/michi/GitProjects/sage/src/sage_setup/docbuild/ext/sage_autodoc.py:1072: RemovedInSphinx20Warning: formatargspec() is now deprecated.  Please use sphinx.util.inspect.Signature instead.\n[manifolds]   args = formatargspec(self.object, *argspec)\n...\nOSError: /home/michi/GitProjects/sage/src/doc/en/reference/manifolds/index.rst:4: WARNING: undefined label: tensors-on-free-modules (if the link has no caption the label must precede a section header)\n```\n\n\nHowever, what comes next?",
    "created_at": "2019-04-10T13:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385179",
    "user": "https://github.com/DeRhamSource"
}
```

Replying to [comment:41 egourgoulhon]:
> Regarding the documentation: you have added doctests in the Python sources but the documentation is not generated since there is no entry to it in the sources of the reference manual. You shall modify/add files in `src/doc/en/reference/manifolds`, for instance in a way similar to what is done for differential forms, i.e. create a file `mixed_diff_form.rst` and add a pointer to it in `diff_manifold.rst`. To generate the documentation in a fast way, i.e. without having Sage process the whole reference manual, run
> {{{
> sage -docbuild reference/manifolds html
> }}}

Unfortunately, I get some errors:



```
[manifolds] /home/michi/GitProjects/sage/src/sage_setup/docbuild/ext/sage_autodoc.py:1170: RemovedInSphinx20Warning: formatargspec() is now deprecated.  Please use sphinx.util.inspect.Signature instead.
[manifolds]   return formatargspec(initmeth, *argspec)
[manifolds] /home/michi/GitProjects/sage/src/sage_setup/docbuild/ext/sage_autodoc.py:1406: RemovedInSphinx20Warning: formatargspec() is now deprecated.  Please use sphinx.util.inspect.Signature instead.
[manifolds]   args = formatargspec(self.object, *argspec)
[manifolds] /home/michi/GitProjects/sage/src/sage_setup/docbuild/ext/sage_autodoc.py:1072: RemovedInSphinx20Warning: formatargspec() is now deprecated.  Please use sphinx.util.inspect.Signature instead.
[manifolds]   args = formatargspec(self.object, *argspec)
...
OSError: /home/michi/GitProjects/sage/src/doc/en/reference/manifolds/index.rst:4: WARNING: undefined label: tensors-on-free-modules (if the link has no caption the label must precede a section header)
```


However, what comes next?



---

archive/issue_comments_385180.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T13:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385180",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385181.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T13:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385182.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T13:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385183.json:
```json
{
    "body": "Some debugging will be needed (if you haven't fixed them already). Also you should rebase this (and force push) to have more professional commit messages. `;)`",
    "created_at": "2019-04-12T08:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385183",
    "user": "https://github.com/tscrim"
}
```

Some debugging will be needed (if you haven't fixed them already). Also you should rebase this (and force push) to have more professional commit messages. `;)`



---

archive/issue_comments_385184.json:
```json
{
    "body": "What should be debugged? I mean, the error above does not seem to have to do something with my implementation. Or does it?\n\nLong story short: There is no error occuring anymore regarding the mixed algebra while building the doc.",
    "created_at": "2019-04-12T09:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385184",
    "user": "https://github.com/DeRhamSource"
}
```

What should be debugged? I mean, the error above does not seem to have to do something with my implementation. Or does it?

Long story short: There is no error occuring anymore regarding the mixed algebra while building the doc.



---

archive/issue_comments_385185.json:
```json
{
    "body": "Replying to [comment:48 gh-DeRhamSource]:\n> What should be debugged? I mean, the error above does not seem to have to do something with my implementation. Or does it?\n> \n> Long story short: There is no error occuring anymore regarding the mixed algebra while building the doc. \n\nYes but some parts of the documentation require some debugging: \n\n- a formula is not displayed because `.. MATH:` should be `.. MATH::` in line 45 of `mixed_form.py`\n- in line 60 of the same file, there is an extra backquote around `comp`\n- at the top of `mixed_form.py` you may want to replace `\\Phi` by `\\varphi` to be consistent with the rest of the text, as well as with `mixed_form_algebra.py`",
    "created_at": "2019-04-12T11:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385185",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:48 gh-DeRhamSource]:
> What should be debugged? I mean, the error above does not seem to have to do something with my implementation. Or does it?
> 
> Long story short: There is no error occuring anymore regarding the mixed algebra while building the doc. 

Yes but some parts of the documentation require some debugging: 

- a formula is not displayed because `.. MATH:` should be `.. MATH::` in line 45 of `mixed_form.py`
- in line 60 of the same file, there is an extra backquote around `comp`
- at the top of `mixed_form.py` you may want to replace `\Phi` by `\varphi` to be consistent with the rest of the text, as well as with `mixed_form_algebra.py`



---

archive/issue_comments_385186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-04-12T12:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_385187.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-04-12T12:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_385188.json:
```json
{
    "body": "My apologies for these confusing commits. I'm quite new to it.\n\nHowever, I fixed the aforementioned issues.",
    "created_at": "2019-04-12T12:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385188",
    "user": "https://github.com/DeRhamSource"
}
```

My apologies for these confusing commits. I'm quite new to it.

However, I fixed the aforementioned issues.



---

archive/issue_comments_385189.json:
```json
{
    "body": "I have a couple more comments, most of them are fairly minor:\n\nIn `_richcmp_`:\n\n```\n        from sage.structure.richcmp import richcmp\n\n        # Compare all elements separately:\n        for j in range(0, self._max_deg + 1):\n```\n\nmove the import statement to the top-level (this is for speed reasons) and make `range(0, foo)` -> `range(foo)`.\n\nMake `_mul_ = wedge` and maybe combine or reduce the doctests.\n\n`degree $k$ along `\\varphi`` replace `&` with ```.\n\nInstead of using `self.__class__`, I have been told it is better to use `type(self)`.\n\nInstead of `\\`, my understanding is it is better to use `()` as that is guaranteed to generate an error if misused (as opposed to possibly a strange bug). For example\n\n```diff\n-                error_msg = \"input must be a \" \\\n-                            \"differential form of degree {}\".format(deg)\n+                error_msg = (\"input must be a \"\n+                             \"differential form of degree {}\".format(deg))\n```\n\n\nTypo: `datailed` -> `detailed`\n\nI don't think you need the `self._populate_coercion_lists_()`.",
    "created_at": "2019-04-12T23:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385189",
    "user": "https://github.com/tscrim"
}
```

I have a couple more comments, most of them are fairly minor:

In `_richcmp_`:

```
        from sage.structure.richcmp import richcmp

        # Compare all elements separately:
        for j in range(0, self._max_deg + 1):
```

move the import statement to the top-level (this is for speed reasons) and make `range(0, foo)` -> `range(foo)`.

Make `_mul_ = wedge` and maybe combine or reduce the doctests.

`degree $k$ along `\varphi`` replace `&` with ```.

Instead of using `self.__class__`, I have been told it is better to use `type(self)`.

Instead of `\`, my understanding is it is better to use `()` as that is guaranteed to generate an error if misused (as opposed to possibly a strange bug). For example

```diff
-                error_msg = "input must be a " \
-                            "differential form of degree {}".format(deg)
+                error_msg = ("input must be a "
+                             "differential form of degree {}".format(deg))
```


Typo: `datailed` -> `detailed`

I don't think you need the `self._populate_coercion_lists_()`.



---

archive/issue_comments_385190.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-13T09:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385190",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385191.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-13T09:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385192.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-13T10:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385193.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-13T10:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385193",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385194.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-13T11:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385195.json:
```json
{
    "body": "Thanks for your patience so far. Again, I changed a lot. Please check.\n\nHowever, I noticed another error message that should not occur:\n\n\n```\nsage: M = Manifold(2, 'M')\nsage: X.<x,y> = M.chart()\nsage: f = M.scalar_field(x, name='f')\nsage: f in M.diff_form_module(1)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-38-9654b754d2bc> in <module>()\n      2 X = M.chart(names=('x', 'y',)); (x, y,) = X._first_ngens(2)\n      3 f = M.scalar_field(x, name='f')\n----> 4 f in M.diff_form_module(Integer(1))\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__contains__ (build/cythonized/sage/structure/parent.c:9885)()\n   1090             return True\n   1091         try:\n-> 1092             x2 = self(x)\n   1093             EQ = (x2 == x)\n   1094             if EQ is True:\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9219)()\n    898         if mor is not None:\n    899             if no_extra_args:\n--> 900                 return mor._call_(x)\n    901             else:\n    902                 return mor._call_with_args(x, args, kwds)\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4551)()\n    160                 print(type(C), C)\n    161                 print(type(C._element_constructor), C._element_constructor)\n--> 162             raise\n    163 \n    164     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4443)()\n    155         cdef Parent C = self._codomain\n    156         try:\n--> 157             return C._element_constructor(x)\n    158         except Exception:\n    159             if print_warnings:\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/differentiable/diff_form_module.pyc in _element_constructor_(self, comp, frame, name, latex_name)\n    818         resu = self.element_class(self._fmodule, self._degree, name=name,\n    819                                   latex_name=latex_name)\n--> 820         if comp != []:\n    821             resu.set_comp(frame)[:] = comp\n    822         return resu\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/scalarfield.pyc in __ne__(self, other)\n   1285 \n   1286         \"\"\"\n-> 1287         return not (self == other)\n   1288 \n   1289     ####### End of required methods for an algebra element (beside arithmetic) #######\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/scalarfield.pyc in __eq__(self, other)\n   1244                 return False\n   1245             try:\n-> 1246                 other = self.parent()(other)  # conversion to a scalar field\n   1247             except TypeError:\n   1248                 return False\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9219)()\n    898         if mor is not None:\n    899             if no_extra_args:\n--> 900                 return mor._call_(x)\n    901             else:\n    902                 return mor._call_with_args(x, args, kwds)\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4551)()\n    160                 print(type(C), C)\n    161                 print(type(C._element_constructor), C._element_constructor)\n--> 162             raise\n    163 \n    164     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4443)()\n    155         cdef Parent C = self._codomain\n    156         try:\n--> 157             return C._element_constructor(x)\n    158         except Exception:\n    159             if print_warnings:\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/scalarfield_algebra.pyc in _element_constructor_(self, coord_expression, chart, name, latex_name)\n    470                                       coord_expression=coord_expression,\n    471                                       name=name, latex_name=latex_name,\n--> 472                                       chart=chart)\n    473         return resu\n    474 \n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/differentiable/scalarfield.pyc in __init__(self, parent, coord_expression, chart, name, latex_name)\n    630         \"\"\"\n    631         ScalarField.__init__(self, parent, coord_expression=coord_expression,\n--> 632                              chart=chart, name=name, latex_name=latex_name)\n    633         self._tensor_type = (0,0)\n    634 \n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/scalarfield.pyc in __init__(self, parent, coord_expression, chart, name, latex_name)\n   1101                         self._express[ch] = ch.function(coord_expression)\n   1102                 else:\n-> 1103                     self._express[chart] = chart.function(coord_expression)\n   1104         self._init_derived()   # initialization of derived quantities\n   1105 \n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/chart.pyc in function(self, expression, calc_method, expansion_symbol, order)\n   1087         return parent.element_class(parent, expression, calc_method=calc_method,\n   1088                                     expansion_symbol=expansion_symbol,\n-> 1089                                     order=order)\n   1090 \n   1091     def zero_function(self):\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/chart_func.pyc in __init__(self, parent, expression, calc_method, expansion_symbol, order)\n    360                 calc_method = self._calc_method._current\n    361             self._express[calc_method] = self._calc_method._tranf[calc_method](\n--> 362                                                                     expression)\n    363         # Derived quantities:\n    364         self._der = None  # list of partial derivatives (to be set by diff()\n\n/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/calculus_method.pyc in _Sympy_to_SR(expression)\n    106         # If SR cannot transform a sympy expression this is because it is a\n    107         # sympy abstract function\n--> 108         a = expression._sage_()\n    109         # As all sage objects have a ._sage_ operator, they have to be\n    110         # catched\n\nAttributeError: 'list' object has no attribute '_sage_'\n```\n",
    "created_at": "2019-04-13T11:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385195",
    "user": "https://github.com/DeRhamSource"
}
```

Thanks for your patience so far. Again, I changed a lot. Please check.

However, I noticed another error message that should not occur:


```
sage: M = Manifold(2, 'M')
sage: X.<x,y> = M.chart()
sage: f = M.scalar_field(x, name='f')
sage: f in M.diff_form_module(1)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-38-9654b754d2bc> in <module>()
      2 X = M.chart(names=('x', 'y',)); (x, y,) = X._first_ngens(2)
      3 f = M.scalar_field(x, name='f')
----> 4 f in M.diff_form_module(Integer(1))

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__contains__ (build/cythonized/sage/structure/parent.c:9885)()
   1090             return True
   1091         try:
-> 1092             x2 = self(x)
   1093             EQ = (x2 == x)
   1094             if EQ is True:

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9219)()
    898         if mor is not None:
    899             if no_extra_args:
--> 900                 return mor._call_(x)
    901             else:
    902                 return mor._call_with_args(x, args, kwds)

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4551)()
    160                 print(type(C), C)
    161                 print(type(C._element_constructor), C._element_constructor)
--> 162             raise
    163 
    164     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4443)()
    155         cdef Parent C = self._codomain
    156         try:
--> 157             return C._element_constructor(x)
    158         except Exception:
    159             if print_warnings:

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/differentiable/diff_form_module.pyc in _element_constructor_(self, comp, frame, name, latex_name)
    818         resu = self.element_class(self._fmodule, self._degree, name=name,
    819                                   latex_name=latex_name)
--> 820         if comp != []:
    821             resu.set_comp(frame)[:] = comp
    822         return resu

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/scalarfield.pyc in __ne__(self, other)
   1285 
   1286         """
-> 1287         return not (self == other)
   1288 
   1289     ####### End of required methods for an algebra element (beside arithmetic) #######

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/scalarfield.pyc in __eq__(self, other)
   1244                 return False
   1245             try:
-> 1246                 other = self.parent()(other)  # conversion to a scalar field
   1247             except TypeError:
   1248                 return False

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9219)()
    898         if mor is not None:
    899             if no_extra_args:
--> 900                 return mor._call_(x)
    901             else:
    902                 return mor._call_with_args(x, args, kwds)

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4551)()
    160                 print(type(C), C)
    161                 print(type(C._element_constructor), C._element_constructor)
--> 162             raise
    163 
    164     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4443)()
    155         cdef Parent C = self._codomain
    156         try:
--> 157             return C._element_constructor(x)
    158         except Exception:
    159             if print_warnings:

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/scalarfield_algebra.pyc in _element_constructor_(self, coord_expression, chart, name, latex_name)
    470                                       coord_expression=coord_expression,
    471                                       name=name, latex_name=latex_name,
--> 472                                       chart=chart)
    473         return resu
    474 

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/differentiable/scalarfield.pyc in __init__(self, parent, coord_expression, chart, name, latex_name)
    630         """
    631         ScalarField.__init__(self, parent, coord_expression=coord_expression,
--> 632                              chart=chart, name=name, latex_name=latex_name)
    633         self._tensor_type = (0,0)
    634 

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/scalarfield.pyc in __init__(self, parent, coord_expression, chart, name, latex_name)
   1101                         self._express[ch] = ch.function(coord_expression)
   1102                 else:
-> 1103                     self._express[chart] = chart.function(coord_expression)
   1104         self._init_derived()   # initialization of derived quantities
   1105 

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/chart.pyc in function(self, expression, calc_method, expansion_symbol, order)
   1087         return parent.element_class(parent, expression, calc_method=calc_method,
   1088                                     expansion_symbol=expansion_symbol,
-> 1089                                     order=order)
   1090 
   1091     def zero_function(self):

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/chart_func.pyc in __init__(self, parent, expression, calc_method, expansion_symbol, order)
    360                 calc_method = self._calc_method._current
    361             self._express[calc_method] = self._calc_method._tranf[calc_method](
--> 362                                                                     expression)
    363         # Derived quantities:
    364         self._der = None  # list of partial derivatives (to be set by diff()

/home/michi/GitProjects/sage/local/lib/python2.7/site-packages/sage/manifolds/calculus_method.pyc in _Sympy_to_SR(expression)
    106         # If SR cannot transform a sympy expression this is because it is a
    107         # sympy abstract function
--> 108         a = expression._sage_()
    109         # As all sage objects have a ._sage_ operator, they have to be
    110         # catched

AttributeError: 'list' object has no attribute '_sage_'
```




---

archive/issue_comments_385196.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-13T17:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385196",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385197.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-13T21:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385197",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385198.json:
```json
{
    "body": "Does that second to last commit fix the issue in comment:59?",
    "created_at": "2019-04-14T00:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385198",
    "user": "https://github.com/tscrim"
}
```

Does that second to last commit fix the issue in comment:59?



---

archive/issue_comments_385199.json:
```json
{
    "body": "Replying to [comment:62 tscrim]:\n> Does that second to last commit fix the issue in comment:59?\n\nNo. But now, I guess this has nothing to do with the mixed algebra. I already reported it in [sage-devel](https://groups.google.com/d/msg/sage-devel/wcIRe8UjuPo/mMRe-OR4CwAJ).",
    "created_at": "2019-04-14T08:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385199",
    "user": "https://github.com/DeRhamSource"
}
```

Replying to [comment:62 tscrim]:
> Does that second to last commit fix the issue in comment:59?

No. But now, I guess this has nothing to do with the mixed algebra. I already reported it in [sage-devel](https://groups.google.com/d/msg/sage-devel/wcIRe8UjuPo/mMRe-OR4CwAJ).



---

archive/issue_comments_385200.json:
```json
{
    "body": "Replying to [comment:63 gh-DeRhamSource]:\n> Replying to [comment:62 tscrim]:\n> > Does that second to last commit fix the issue in comment:59?\n> \n> No. But now, I guess this has nothing to do with the mixed algebra. I already reported it in [sage-devel](https://groups.google.com/d/msg/sage-devel/wcIRe8UjuPo/mMRe-OR4CwAJ).\n\nI confirm the error. I've opened #27658 for it.",
    "created_at": "2019-04-14T09:06:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385200",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:63 gh-DeRhamSource]:
> Replying to [comment:62 tscrim]:
> > Does that second to last commit fix the issue in comment:59?
> 
> No. But now, I guess this has nothing to do with the mixed algebra. I already reported it in [sage-devel](https://groups.google.com/d/msg/sage-devel/wcIRe8UjuPo/mMRe-OR4CwAJ).

I confirm the error. I've opened #27658 for it.



---

archive/issue_comments_385201.json:
```json
{
    "body": "Replying to [comment:64 egourgoulhon]:\n> Replying to [comment:63 gh-DeRhamSource]:\n> > Replying to [comment:62 tscrim]:\n> > > Does that second to last commit fix the issue in comment:59?\n> > \n> > No. But now, I guess this has nothing to do with the mixed algebra. I already reported it in [sage-devel](https://groups.google.com/d/msg/sage-devel/wcIRe8UjuPo/mMRe-OR4CwAJ).\n> \n> I confirm the error. I've opened #27658 for it.\n\nWhile this is definitely a bug, you can get rid of it by replacing\n\n```\nf in M.diff_form_module(n)\n```\n\nby\n\n```\nf.domain() is M and f.degree() == n\n```\n\nfor any integer `n`. Moreover the second form is must faster.",
    "created_at": "2019-04-14T09:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385201",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:64 egourgoulhon]:
> Replying to [comment:63 gh-DeRhamSource]:
> > Replying to [comment:62 tscrim]:
> > > Does that second to last commit fix the issue in comment:59?
> > 
> > No. But now, I guess this has nothing to do with the mixed algebra. I already reported it in [sage-devel](https://groups.google.com/d/msg/sage-devel/wcIRe8UjuPo/mMRe-OR4CwAJ).
> 
> I confirm the error. I've opened #27658 for it.

While this is definitely a bug, you can get rid of it by replacing

```
f in M.diff_form_module(n)
```

by

```
f.domain() is M and f.degree() == n
```

for any integer `n`. Moreover the second form is must faster.



---

archive/issue_comments_385202.json:
```json
{
    "body": "Fortunately, this issue is not directly relevant for my code anymore (since the error message was deleted). I've encountered the problem while debugging. :)",
    "created_at": "2019-04-14T09:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385202",
    "user": "https://github.com/DeRhamSource"
}
```

Fortunately, this issue is not directly relevant for my code anymore (since the error message was deleted). I've encountered the problem while debugging. :)



---

archive/issue_comments_385203.json:
```json
{
    "body": "Replying to [comment:66 gh-DeRhamSource]:\n> Fortunately, this issue is not directly relevant for my code anymore (since the error message was deleted). I've encountered the problem while debugging. :)\n\nGood!",
    "created_at": "2019-04-14T09:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385203",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:66 gh-DeRhamSource]:
> Fortunately, this issue is not directly relevant for my code anymore (since the error message was deleted). I've encountered the problem while debugging. :)

Good!



---

archive/issue_comments_385204.json:
```json
{
    "body": "Patchbot says no. :(\n\nThough, there is no obvious error. So, what's the matter?\n\nAny further suggestions?",
    "created_at": "2019-04-16T09:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385204",
    "user": "https://github.com/DeRhamSource"
}
```

Patchbot says no. :(

Though, there is no obvious error. So, what's the matter?

Any further suggestions?



---

archive/issue_comments_385205.json:
```json
{
    "body": "That error from the patchbot looks unrelated, so I would treat the patchbot as coming back green.\n\nSorry, one more nitpick for readability:\n\n```diff\n-            return self._domain.is_subset(\n-                S._domain) and self._ambient_domain.is_subset(S._ambient_domain)\n+            return (self._domain.is_subset(S._domain)\n+                    and self._ambient_domain.is_subset(S._ambient_domain))\n```\n\n\nEric, any other comments?",
    "created_at": "2019-04-16T12:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385205",
    "user": "https://github.com/tscrim"
}
```

That error from the patchbot looks unrelated, so I would treat the patchbot as coming back green.

Sorry, one more nitpick for readability:

```diff
-            return self._domain.is_subset(
-                S._domain) and self._ambient_domain.is_subset(S._ambient_domain)
+            return (self._domain.is_subset(S._domain)
+                    and self._ambient_domain.is_subset(S._ambient_domain))
```


Eric, any other comments?



---

archive/issue_comments_385206.json:
```json
{
    "body": "Replying to [comment:69 tscrim]:\n> \n> Eric, any other comments?\n\nYes, there is a doctest error with Python3-built Sage: \n\n```\nsage -t --long --warn-long 48.2 src/sage/manifolds/differentiable/mixed_form.py\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/mixed_form.py\", line 479, in sage.manifolds.differentiable.mixed_form.MixedForm.set_name\nFailed example:\n    F.set_name(name='fancy', latex_name='\\eta'); F\nExpected:\n    Mixed differential form fancy on the 4-dimensional differentiable\n     manifold M\nGot:\n    doctest:warning\n    ...\n    DeprecationWarning: invalid escape sequence \\e\n    Mixed differential form fancy on the 4-dimensional differentiable manifold M\n**********************************************************************\n```\n\nYou should replace `'\\eta'` by `r'\\eta'`. \n\nApart from this, everything is OK for me.",
    "created_at": "2019-04-16T14:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385206",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:69 tscrim]:
> 
> Eric, any other comments?

Yes, there is a doctest error with Python3-built Sage: 

```
sage -t --long --warn-long 48.2 src/sage/manifolds/differentiable/mixed_form.py
**********************************************************************
File "src/sage/manifolds/differentiable/mixed_form.py", line 479, in sage.manifolds.differentiable.mixed_form.MixedForm.set_name
Failed example:
    F.set_name(name='fancy', latex_name='\eta'); F
Expected:
    Mixed differential form fancy on the 4-dimensional differentiable
     manifold M
Got:
    doctest:warning
    ...
    DeprecationWarning: invalid escape sequence \e
    Mixed differential form fancy on the 4-dimensional differentiable manifold M
**********************************************************************
```

You should replace `'\eta'` by `r'\eta'`. 

Apart from this, everything is OK for me.



---

archive/issue_comments_385207.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-17T08:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385208.json:
```json
{
    "body": "Anything else? :)\n\nOtherwise I'd start programming the next part - namely characteristic classes.",
    "created_at": "2019-04-17T08:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385208",
    "user": "https://github.com/DeRhamSource"
}
```

Anything else? :)

Otherwise I'd start programming the next part - namely characteristic classes.



---

archive/issue_comments_385209.json:
```json
{
    "body": "Replying to [comment:72 gh-DeRhamSource]:\n> Anything else? :)\n> \n> Otherwise I'd start programming the next part - namely characteristic classes.\n\nThanks for the update and your work on this. I am OK for the positive review. Travis, do you agree?",
    "created_at": "2019-04-17T09:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385209",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:72 gh-DeRhamSource]:
> Anything else? :)
> 
> Otherwise I'd start programming the next part - namely characteristic classes.

Thanks for the update and your work on this. I am OK for the positive review. Travis, do you agree?



---

archive/issue_comments_385210.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-17T10:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385210",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_385211.json:
```json
{
    "body": "I concur.",
    "created_at": "2019-04-17T10:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385211",
    "user": "https://github.com/tscrim"
}
```

I concur.



---

archive/issue_events_068514.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-18T19:56:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27347#event-68514"
}
```



---

archive/issue_comments_385212.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-18T19:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27347#issuecomment-385212",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
