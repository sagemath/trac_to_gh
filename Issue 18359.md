# Issue 18359: Don't strip MathJax fonts

Issue created by migration from https://trac.sagemath.org/ticket/18596

Original creator: novoselt

Original creation time: 2015-06-02 23:01:10

CC:  fbissey vbraun mjo

Current MathJax package strips SVG and PNG fonts, but there are cases when for some reason normal fonts are not shown.

In addition, having not SVG fonts but choosing SVG rendrer makes MathJax menu unavailable on the webpage without a clear fix (refreshing does not show any formulas at all).

One of the reasons for stripping PNG fonts was that they are copied to all folders in the documentation - this wastes gigabytes of space and has to be addressed.


---

Comment by novoselt created at 2015-06-02 23:04:15

Extra data point - I've cloned MathJax repository and put it into `local/share/mathjax` instead of the standard Sage one for our campus cell server. Now Firefox works fine in the labs - still cannot get the webfonts and it takes a while on the first load to switch to image fonts, but they look satisfactory and SVG works too (with possibility of switching back).


---

Comment by tmonteil created at 2015-06-03 21:12:10

According to [this page](https://github.com/mathjax/MathJax-docs/wiki/Guide:-reducing-size-of-a-mathjax-installation/1814429ed1e97bfb7675c0fd400804baa9287249) (which i used to write the stripping script), there should be no problem with firefox since woff fonts are not stripped and supported by firefox, see [this page](http://en.wikipedia.org/wiki/Web_Open_Font_Format#Vendor_support). So i guess that if you encounter a problem, it is probably due to some misconfiguration somewhere. Could you please give a way to reproduce the bad formatting (which Sage commmand, in which notebook, whith which browser, etc) ?


---

Comment by novoselt created at 2015-06-04 04:25:30

Replying to [comment:2 tmonteil]:
> So i guess that if you encounter a problem, it is probably due to some misconfiguration somewhere.
Probably, but PNG fonts help to deal with such situations in a decent way and so far I heard no clear reason to strip away SVG.
> Could you please give a way to reproduce the bad formatting (which Sage commmand, in which notebook, whith which browser, etc) ?
Any command in Firefox producing a formula in either SageNB (for Sage-6.7) or SageMathCell (running a slightly customized Sage-6.7). But first come to our campus and go to a computer lab. I don't know what exactly is off with setup/setting there - my point is that having PNG/SVG fonts would help with this. If it is the fault of our IT guys, I am pretty sure they are not the worst in the world and other people may be in the same situation.


---

Comment by mjo created at 2016-09-25 21:35:06

I've had [Math Processing Error] for every bit of math in my documentation for years now. I just figured out that I can work around that by installing the STIX fonts (http://www.stixfonts.org/) on my machine and restarting firefox.


---

Comment by mjo created at 2017-02-20 05:34:18

I've spent another entire day trying to get my mathematics software to display mathematics. It's rather infuriating. Something changed in the last few months and the stix-fonts workaround (alone) no longer helps.

This is stupid, but it works and it doesn't take four hours to test:


```/bin/bash
#
# Replace references to Sage's MathJax with the version from the CDN,
# which actually works.
#

if (( $# < 1 )); then
    echo "Usage: ${0} <paths-to-html-files>"
    exit 1
fi

# The <script> tag for Sage's MathJax.
OLDJAX='<script type="text/javascript" src="../../_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>'

# The <script> tag for a working MathJax.
NEWJAX='<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>'

# Escape front-slashes in OLD/NEWJAX because otherwise sed will choke
# on them (you can use a different separator in an "s/foo/bar/" match,
# but not in the "1,<pattern>" construct).
OLDJAX="${OLDJAX//\//\\/}"
NEWJAX="${NEWJAX//\//\\/}"

# Replace the FIRST reference to Sage's MathJax with the CDN version.
# Then delete the REST of the Sage MathJax instances. Why is the same
# script loaded more than once? You've got me!
sed --in-place \
    --expression="1,/${OLDJAX}/ s/${OLDJAX}/${NEWJAX}/" \
    --expression="/${OLDJAX}/d" \
    $@
```



---

Comment by novoselt created at 2017-02-20 17:14:15

Well, with CDN you can't use files offline (does not really matter if they are not working anyway).

SageMathCell is not using Sage's MathJax anymore since we don't care about offline usage at all.

Do you have problems with sort-of-end-of-lifed SageNB, or are you talking about plain doc pages in a browser? Those presumably still should be a high priority for people to fix, e.g. by figuring out how to NOT copy MathJax into every subfolder and then stop stripping it from anything.


---

Comment by mkoeppe created at 2021-03-15 22:07:04

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by klee created at 2022-04-14 00:11:47

See ticket:25833#comment:67.


---

Comment by novoselt created at 2022-04-14 02:34:16

The problem here was for SageNB, which is EOL, and [SageMathCell](SageMathCell), where we use CDN MathJax now. So I think this problem was not solved, but it is no longer relevant.


---

Comment by novoselt created at 2022-04-14 02:34:16

Changing status from new to needs_review.


---

Comment by klee created at 2022-04-14 03:49:39

Okay


---

Comment by klee created at 2022-04-14 03:49:39

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-05-11 02:14:43

Resolution: invalid
