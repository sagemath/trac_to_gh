# Issue 26517: Remove or replace calls to Yahoo! Finance in sage/finance/stock.py

archive/issues_026517.json:
```json
{
    "body": "CC:  @slel\n\nKeywords: finance, stock, yahoo, was\n\nThe stock functionality in `sage/finance/stock.py` relies on querying a \"Yahoo! Finance\"\nservice to get current stock prices in csv files. The service seems to have shut down in May 2017.\n\nTicket #25473 marks the corresponding tests in Sage as \"known bug\".\n\nThe functionality to get stock prices should be removed or replaced.\n\nSome alternatives are discussed at\n\n- [Meumobi dev blog: Yahoo finance API discontinued and now?...](http://meumobi.github.io/stocks%20apis/stock/2017/11/07/yahoo-finance-download-API-discontinued.html)\n\nRelated ticket:\n\n- #25425: finance.Stock -- obtaining stock prices from Google is completely broken now\n\nIssue created by migration from https://trac.sagemath.org/ticket/26754\n\n",
    "created_at": "2018-11-24T01:26:56Z",
    "labels": [
        "component: finance",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Remove or replace calls to Yahoo! Finance in sage/finance/stock.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26517",
    "user": "https://github.com/slel"
}
```
CC:  @slel

Keywords: finance, stock, yahoo, was

The stock functionality in `sage/finance/stock.py` relies on querying a "Yahoo! Finance"
service to get current stock prices in csv files. The service seems to have shut down in May 2017.

Ticket #25473 marks the corresponding tests in Sage as "known bug".

The functionality to get stock prices should be removed or replaced.

Some alternatives are discussed at

- [Meumobi dev blog: Yahoo finance API discontinued and now?...](http://meumobi.github.io/stocks%20apis/stock/2017/11/07/yahoo-finance-download-API-discontinued.html)

Related ticket:

- #25425: finance.Stock -- obtaining stock prices from Google is completely broken now

Issue created by migration from https://trac.sagemath.org/ticket/26754





---

archive/issue_events_066227.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-11-24T01:29:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26517#event-66227"
}
```



---

archive/issue_comments_372472.json:
```json
{
    "body": "Changing keywords from \"finance, stock, yahoo, was\" to \"finance, stock, yahoo\".",
    "created_at": "2018-11-24T01:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372472",
    "user": "https://github.com/slel"
}
```

Changing keywords from "finance, stock, yahoo, was" to "finance, stock, yahoo".



---

archive/issue_comments_372473.json:
```json
{
    "body": "Tim Paine's webpage at\n\n- http://tim.paine.nyc/\n\nlists some Python packages for finance including\n\n- https://github.com/timkpaine/pyEX\n- https://github.com/timkpaine/tdameritrade\n\nwhich might help with this.",
    "created_at": "2019-05-13T05:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372473",
    "user": "https://github.com/slel"
}
```

Tim Paine's webpage at

- http://tim.paine.nyc/

lists some Python packages for finance including

- https://github.com/timkpaine/pyEX
- https://github.com/timkpaine/tdameritrade

which might help with this.



---

archive/issue_comments_372474.json:
```json
{
    "body": "The Yahoo service that was shut down a couple years ago was part of Yahoo Query Language (YQL). It was replaced with another Yahoo service accessible at the URL\n\nhttps://query1.finance.yahoo.com/v7/finance/quote?symbols=\n\nwhere stock symbols are appended to the end of the URL separated by commas. I know that this service works because I wrote a custom Amazon Alexa voice skill to access data for stocks described [here](http://analyticphysics.com/Diversions/An%20Alexa%20Skills%20Kit%20(ASK)%20JavaScript%20Cookbook.htm#stocks).\n\nThis new service provides more data that the older one in JSON format. If updating the Sage module were as simple as dropping in a new URL I would do so, but I fear the entire module needs to be rewritten. Since I don't use Sage, I'll leave that to someone who does.",
    "created_at": "2019-05-15T00:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372474",
    "user": "https://github.com/paulmasson"
}
```

The Yahoo service that was shut down a couple years ago was part of Yahoo Query Language (YQL). It was replaced with another Yahoo service accessible at the URL

https://query1.finance.yahoo.com/v7/finance/quote?symbols=

where stock symbols are appended to the end of the URL separated by commas. I know that this service works because I wrote a custom Amazon Alexa voice skill to access data for stocks described [here](http://analyticphysics.com/Diversions/An%20Alexa%20Skills%20Kit%20(ASK)%20JavaScript%20Cookbook.htm#stocks).

This new service provides more data that the older one in JSON format. If updating the Sage module were as simple as dropping in a new URL I would do so, but I fear the entire module needs to be rewritten. Since I don't use Sage, I'll leave that to someone who does.



---

archive/issue_comments_372475.json:
```json
{
    "body": "I think I can do something about this. The json query returns the following stuff\n\n['language', 'region', 'quoteType', 'triggerable', 'quoteSourceName', 'currency', 'postMarketChangePercent', 'postMarketTime', 'epsForward', 'postMarketPrice', 'postMarketChange', 'regularMarketChange', 'regularMarketChangePercent', 'regularMarketTime', 'regularMarketPrice', 'regularMarketDayHigh', 'regularMarketDayRange', 'regularMarketDayLow', 'regularMarketVolume', 'regularMarketPreviousClose', 'bid', 'ask', 'bidSize', 'askSize', 'fullExchangeName', 'financialCurrency', 'regularMarketOpen', 'averageDailyVolume3Month', 'averageDailyVolume10Day', 'fiftyTwoWeekLowChange', 'fiftyTwoWeekLowChangePercent', 'fiftyTwoWeekRange', 'fiftyTwoWeekHighChange', 'fiftyTwoWeekHighChangePercent', 'fiftyTwoWeekLow', 'fiftyTwoWeekHigh', 'trailingPE', 'marketState', 'tradeable', 'firstTradeDateMilliseconds', 'priceHint', 'exchange', 'shortName', 'longName', 'messageBoardId', 'exchangeTimezoneName', 'exchangeTimezoneShortName', 'gmtOffSetMilliseconds', 'market', 'esgPopulated', 'epsTrailingTwelveMonths', 'sharesOutstanding', 'bookValue', 'fiftyDayAverage', 'fiftyDayAverageChange', 'fiftyDayAverageChangePercent', 'twoHundredDayAverage', 'twoHundredDayAverageChange', 'twoHundredDayAverageChangePercent', 'marketCap', 'forwardPE', 'priceToBook', 'sourceInterval', 'exchangeDataDelayedBy', 'symbol']\n\nCan somebody direct me as to how to return this data? There are some attributes that are missing which I think could be derived from this data but I am not sure how. Those are ebitda, dividend_per_share, dividend_yield, earnings_per_share, price_earnings_ratio, price_earnings_growth_ratio, price_sales_ratio, short ratio.\n\nHow do I derive those from the json query?",
    "created_at": "2019-12-20T04:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372475",
    "user": "https://github.com/bhargeymehta"
}
```

I think I can do something about this. The json query returns the following stuff

['language', 'region', 'quoteType', 'triggerable', 'quoteSourceName', 'currency', 'postMarketChangePercent', 'postMarketTime', 'epsForward', 'postMarketPrice', 'postMarketChange', 'regularMarketChange', 'regularMarketChangePercent', 'regularMarketTime', 'regularMarketPrice', 'regularMarketDayHigh', 'regularMarketDayRange', 'regularMarketDayLow', 'regularMarketVolume', 'regularMarketPreviousClose', 'bid', 'ask', 'bidSize', 'askSize', 'fullExchangeName', 'financialCurrency', 'regularMarketOpen', 'averageDailyVolume3Month', 'averageDailyVolume10Day', 'fiftyTwoWeekLowChange', 'fiftyTwoWeekLowChangePercent', 'fiftyTwoWeekRange', 'fiftyTwoWeekHighChange', 'fiftyTwoWeekHighChangePercent', 'fiftyTwoWeekLow', 'fiftyTwoWeekHigh', 'trailingPE', 'marketState', 'tradeable', 'firstTradeDateMilliseconds', 'priceHint', 'exchange', 'shortName', 'longName', 'messageBoardId', 'exchangeTimezoneName', 'exchangeTimezoneShortName', 'gmtOffSetMilliseconds', 'market', 'esgPopulated', 'epsTrailingTwelveMonths', 'sharesOutstanding', 'bookValue', 'fiftyDayAverage', 'fiftyDayAverageChange', 'fiftyDayAverageChangePercent', 'twoHundredDayAverage', 'twoHundredDayAverageChange', 'twoHundredDayAverageChangePercent', 'marketCap', 'forwardPE', 'priceToBook', 'sourceInterval', 'exchangeDataDelayedBy', 'symbol']

Can somebody direct me as to how to return this data? There are some attributes that are missing which I think could be derived from this data but I am not sure how. Those are ebitda, dividend_per_share, dividend_yield, earnings_per_share, price_earnings_ratio, price_earnings_growth_ratio, price_sales_ratio, short ratio.

How do I derive those from the json query?



---

archive/issue_comments_372476.json:
```json
{
    "body": "outdated after sage.finance deprecation in #32427",
    "created_at": "2021-10-10T20:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372476",
    "user": "https://github.com/mkoeppe"
}
```

outdated after sage.finance deprecation in #32427



---

archive/issue_comments_372477.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-10T20:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372477",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_066228.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-10T20:29:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26517#event-66228"
}
```



---

archive/issue_events_066229.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-10T20:29:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26517#event-66229"
}
```



---

archive/issue_comments_372478.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-25T10:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372478",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_372479.json:
```json
{
    "body": "I agree.",
    "created_at": "2021-10-25T10:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372479",
    "user": "https://github.com/slel"
}
```

I agree.



---

archive/issue_comments_372480.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-10-25T15:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26517#issuecomment-372480",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_066230.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-25T15:39:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26517",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26517#event-66230"
}
```
