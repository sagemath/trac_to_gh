# Issue 26517: Remove or replace calls to Yahoo! Finance in sage/finance/stock.py

Issue created by migration from Trac.

Original creator: slelievre

Original creation time: 2018-11-24 01:26:56

CC:  slelievre

Keywords: finance, stock, yahoo, was

The stock functionality in `sage/finance/stock.py` relies on querying a "Yahoo! Finance"
service to get current stock prices in csv files. The service seems to have shut down in May 2017.

Ticket #25473 marks the corresponding tests in Sage as "known bug".

The functionality to get stock prices should be removed or replaced.

Some alternatives are discussed at

- [Meumobi dev blog: Yahoo finance API discontinued and now?...](http://meumobi.github.io/stocks%20apis/stock/2017/11/07/yahoo-finance-download-API-discontinued.html)

Related ticket:

- #25425: finance.Stock -- obtaining stock prices from Google is completely broken now


---

Comment by slelievre created at 2018-11-24 01:29:49

Changing keywords from "finance, stock, yahoo, was" to "finance, stock, yahoo".


---

Comment by slelievre created at 2019-05-13 05:49:52

Tim Paine's webpage at

- http://tim.paine.nyc/

lists some Python packages for finance including

- https://github.com/timkpaine/pyEX
- https://github.com/timkpaine/tdameritrade

which might help with this.


---

Comment by paulmasson created at 2019-05-15 00:05:25

The Yahoo service that was shut down a couple years ago was part of Yahoo Query Language (YQL). It was replaced with another Yahoo service accessible at the URL

https://query1.finance.yahoo.com/v7/finance/quote?symbols=

where stock symbols are appended to the end of the URL separated by commas. I know that this service works because I wrote a custom Amazon Alexa voice skill to access data for stocks described [here](http://analyticphysics.com/Diversions/An%20Alexa%20Skills%20Kit%20(ASK)%20JavaScript%20Cookbook.htm#stocks).

This new service provides more data that the older one in JSON format. If updating the Sage module were as simple as dropping in a new URL I would do so, but I fear the entire module needs to be rewritten. Since I don't use Sage, I'll leave that to someone who does.


---

Comment by @bhargeymehta created at 2019-12-20 04:57:43

I think I can do something about this. The json query returns the following stuff

['language', 'region', 'quoteType', 'triggerable', 'quoteSourceName', 'currency', 'postMarketChangePercent', 'postMarketTime', 'epsForward', 'postMarketPrice', 'postMarketChange', 'regularMarketChange', 'regularMarketChangePercent', 'regularMarketTime', 'regularMarketPrice', 'regularMarketDayHigh', 'regularMarketDayRange', 'regularMarketDayLow', 'regularMarketVolume', 'regularMarketPreviousClose', 'bid', 'ask', 'bidSize', 'askSize', 'fullExchangeName', 'financialCurrency', 'regularMarketOpen', 'averageDailyVolume3Month', 'averageDailyVolume10Day', 'fiftyTwoWeekLowChange', 'fiftyTwoWeekLowChangePercent', 'fiftyTwoWeekRange', 'fiftyTwoWeekHighChange', 'fiftyTwoWeekHighChangePercent', 'fiftyTwoWeekLow', 'fiftyTwoWeekHigh', 'trailingPE', 'marketState', 'tradeable', 'firstTradeDateMilliseconds', 'priceHint', 'exchange', 'shortName', 'longName', 'messageBoardId', 'exchangeTimezoneName', 'exchangeTimezoneShortName', 'gmtOffSetMilliseconds', 'market', 'esgPopulated', 'epsTrailingTwelveMonths', 'sharesOutstanding', 'bookValue', 'fiftyDayAverage', 'fiftyDayAverageChange', 'fiftyDayAverageChangePercent', 'twoHundredDayAverage', 'twoHundredDayAverageChange', 'twoHundredDayAverageChangePercent', 'marketCap', 'forwardPE', 'priceToBook', 'sourceInterval', 'exchangeDataDelayedBy', 'symbol']

Can somebody direct me as to how to return this data? There are some attributes that are missing which I think could be derived from this data but I am not sure how. Those are ebitda, dividend_per_share, dividend_yield, earnings_per_share, price_earnings_ratio, price_earnings_growth_ratio, price_sales_ratio, short ratio.

How do I derive those from the json query?


---

Comment by mkoeppe created at 2021-10-10 20:29:37

outdated after sage.finance deprecation in #32427


---

Comment by mkoeppe created at 2021-10-10 20:29:37

Changing status from new to needs_review.


---

Comment by slelievre created at 2021-10-25 10:58:28

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-10-25 10:58:28

I agree.


---

Comment by mkoeppe created at 2021-10-25 15:39:21

Resolution: invalid
