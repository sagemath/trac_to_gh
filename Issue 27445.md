# Issue 27445: upgrade normaliz to 3.7.0

Issue created by migration from https://trac.sagemath.org/ticket/27682

Original creator: vdelecroix

Original creation time: 2019-04-16 19:55:55

CC:  winfried jipilab @sebasguts mkoeppe

New release of Normaliz is available.

It depends on an additional library e-antic that is packaged in this ticket.

Tarballs:

- https://github.com/Normaliz/Normaliz/archive/v3.7.0.tar.gz (to be renamed `normaliz-3.7.0.tar.gz`)
- http://www.labri.fr/perso/vdelecro/e-antic/e-antic-0.1.2.tar.gz


---

Comment by git created at 2019-04-16 20:02:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-16 20:05:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-04-17 07:17:07

So far, both packages install without issues on debian stretch with gcc 6.3.0. Waiting for the tarball for the new version of pynormaliz.


---

Comment by git created at 2019-04-17 13:17:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2019-04-22 15:58:37

After a `make distclean` and proper reinstall as the ticket description, I got everything back in order and all tests pass in the folder `polyhedron`.


---

Comment by vdelecroix created at 2019-04-22 19:24:20

Replying to [comment:12 jipilab]:
> After a `make distclean` and proper reinstall as the ticket description, I got everything back in order and all tests pass in the folder `polyhedron`.

Then could you try to reproduce [#22](https://github.com/Normaliz/PyNormaliz/issues/22), [#23](https://github.com/Normaliz/PyNormaliz/issues/23), [#26](https://github.com/Normaliz/PyNormaliz/issues/26), [#27](https://github.com/Normaliz/PyNormaliz/issues/27)? (and report back on the github issues)


---

Comment by jipilab created at 2019-04-23 12:23:42

Replying to [comment:13 vdelecroix]:
> Replying to [comment:12 jipilab]:
> > After a `make distclean` and proper reinstall as the ticket description, I got everything back in order and all tests pass in the folder `polyhedron`.
> 
> Then could you try to reproduce [#22](https://github.com/Normaliz/PyNormaliz/issues/22), [#23](https://github.com/Normaliz/PyNormaliz/issues/23), [#26](https://github.com/Normaliz/PyNormaliz/issues/26), [#27](https://github.com/Normaliz/PyNormaliz/issues/27)? (and report back on the github issues)

Just to confirm: all 4 issues are now solved in sage (some of them had different traces inside of sage...).

and


```
$ sage -t *.py --optional=dochtml,e_antic,gfortran,memlimit,mpir,normaliz,python2,sage,pynormaliz
Using --optional=dochtml,e_antic,gfortran,memlimit,mpir,normaliz,pynormaliz,python2,sage
Doctesting 25 files.
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```



---

Comment by git created at 2019-04-25 08:20:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2019-04-25 08:33:42

Please no force pushs... I'm merging this ticket in #25097...


---

Comment by vdelecroix created at 2019-04-25 08:36:14

sorry... won't do anymore.


---

Comment by vdelecroix created at 2019-04-25 08:59:56

On the other hand, it does not make much sense to merge anywhere. Normaliz and e-antic needs upgrade and PyNormaliz needs to be fixed and released.


---

Comment by mkoeppe created at 2019-04-25 10:11:24

Yes, of course I'm waiting for these upgrades.


---

Comment by mkoeppe created at 2019-04-25 15:21:36

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2019-04-25 15:21:36

Updated. Builds and tests OK on macOS Mojave
----
New commits:


---

Comment by jipilab created at 2019-04-25 15:34:40

Builds and tests (`polyhedron` and `thematic_tutorial` folders) Oll Korrekt on debian stretch.


---

Comment by tscrim created at 2019-04-25 22:59:26

It passes all tests for me (in particular, in the folder I care about: `combinat/rigged_configurations` `;)`). I am also getting around a 5-10% speedup in my tests:

```
sage: RC = RiggedConfigurations(['E',8,1], [[4,1]])
sage: %time len(RC.kleber_tree())
CPU times: user 2.29 s, sys: 8.24 ms, total: 2.3 s
Wall time: 352 ms
87
sage: RC = RiggedConfigurations(['E',8,1], [[4,1],[2,1]])
sage: %time len(RC.kleber_tree())
CPU times: user 53.4 s, sys: 52.1 ms, total: 53.5 s
Wall time: 7.68 s
2137
sage: RC = RiggedConfigurations(['F',4,1], [[3,2],[2,2]])
sage: %time len(RC.kleber_tree())
CPU times: user 9.18 s, sys: 20.3 ms, total: 9.2 s
Wall time: 1.85 s
1257
```

vs before

```
sage: RC = RiggedConfigurations(['E',8,1], [[4,1]])
sage: %time len(RC.kleber_tree())
CPU times: user 2.29 s, sys: 7.74 ms, total: 2.29 s
Wall time: 360 ms
87
sage: RC = RiggedConfigurations(['E',8,1], [[4,1],[2,1]])
sage: %time len(RC.kleber_tree())
CPU times: user 55.7 s, sys: 59.4 ms, total: 55.8 s
Wall time: 8.23 s
2137
sage: RC = RiggedConfigurations(['F',4,1], [[3,2],[2,2]])
sage: %time len(RC.kleber_tree())
CPU times: user 9.43 s, sys: 24 ms, total: 9.45 s
Wall time: 1.92 s
1257
```



---

Comment by tscrim created at 2019-04-25 22:59:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-04-29 12:35:57

Resolution: fixed
