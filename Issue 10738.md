# Issue 10738: Small improvements to partn_ref functions

Issue created by migration from https://trac.sagemath.org/ticket/10804

Original creator: rlm

Original creation time: 2011-02-19 09:06:21

Assignee: rlm

CC:  boothby




---

Comment by rlm created at 2011-03-08 21:25:44

Changing status from new to needs_review.


---

Comment by boothby created at 2011-03-29 17:56:34

Changing status from needs_review to needs_work.


---

Comment by boothby created at 2011-03-29 17:56:34

buildbot applied the wrong patch... let's see if it works next time.


---

Comment by boothby created at 2011-03-29 17:56:43

Changing status from needs_work to needs_review.


---

Comment by rlm created at 2011-04-01 20:00:30

apply trac_10804.patch


---

Comment by rlm created at 2011-04-01 20:01:59

Changing status from needs_review to needs_work.


---

Comment by rlm created at 2011-04-01 20:01:59

Just updated patch to deal with conflict coming from #10712.


---

Comment by rlm created at 2011-04-01 20:02:15

Changing status from needs_work to needs_review.


---

Comment by rlm created at 2011-04-04 18:27:24

How do I get the buildbot to try again?


---

Comment by boothby created at 2011-04-05 04:46:31

Changing status from needs_review to needs_info.


---

Comment by boothby created at 2011-04-05 04:46:31

I just tried to apply this to 4.6.2.rc0 and got loads of failed hunks.  Am I missing something, or are you?


---

Comment by rlm created at 2011-04-05 18:22:35

Due to #10712 you need 4.6.2.rc1 or later.


---

Comment by rlm created at 2011-04-05 21:40:13

I just successfully applied this patch to sage-4.7.alpha3.


---

Comment by boothby created at 2011-04-06 17:30:40

Okay, this is a little weird.  Applied fine to 4.6.2, but I get the following:


```
sage -t  ".6.2/devel/sage/sage/groups/perm_gps/permgroup_morphism.py"
         [8.1 s]
sage -t  ".6.2/devel/sage/sage/groups/generic.py"
         [13.3 s]
sage -t  ".6.2/devel/sage/sage/stats/__init__.py"
         [0.2 s]
sage -t  ".6.2/devel/sage/sage/stats/intlist.pyx"
         [7.0 s]
sage -t  ".6.2/devel/sage/sage/stats/all.py"
         [0.2 s]
sage -t  ".6.2/devel/sage/sage/stats/test.py"

            if coset_eq(p, r, gens):
                found = True
                break
        if not found:
            reps.append(p)
Exception raised:
    Traceback (most recent call last):
      File "/home/tboothby/sage-4.6.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/tboothby/sage-4.6.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/tboothby/sage-4.6.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[14]>", line 5, in <module>
        if coset_eq(p, r, gens):
    NameError: name 'coset_eq' is not defined
**********************************************************************
File "/cecm/home/tboothby/sage-4.6.2/devel/sage/sage/groups/perm_gps/partn_ref/double_coset.pyx", line 165:
    sage: len(reps)
Expected:
    8
Got:
    1
**********************************************************************
1 items had failures:
   8 of  16 in __main__.example_1
***Test Failed*** 8 failures.
For whitespace errors, see the file /home/tboothby/.sage//tmp/.doctest_double_coset.py
         [5.3 s]
sage -t  ".6.2/devel/sage/sage/groups/perm_gps/permgroup_element.pyx"
         [6.0 s]
sage -t  ".6.2/devel/sage/sage/groups/perm_gps/permgroup_morphism.py"
         [8.1 s]
sage -t  ".6.2/devel/sage/sage/groups/generic.py"
         [13.3 s]
sage -t  ".6.2/devel/sage/sage/stats/__init__.py"
         [0.2 s]
sage -t  ".6.2/devel/sage/sage/stats/intlist.pyx"
         [7.0 s]
sage -t  ".6.2/devel/sage/sage/stats/all.py"
         [0.2 s]
sage -t  ".6.2/devel/sage/sage/stats/test.py"

            if coset_eq(p, r, gens):
                found = True
                break
        if not found:
            reps.append(p)
Exception raised:
    Traceback (most recent call last):
      File "/home/tboothby/sage-4.6.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/tboothby/sage-4.6.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/tboothby/sage-4.6.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[14]>", line 5, in <module>
        if coset_eq(p, r, gens):
    NameError: name 'coset_eq' is not defined
**********************************************************************
File "/cecm/home/tboothby/sage-4.6.2/devel/sage/sage/groups/perm_gps/partn_ref/double_coset.pyx", line 165:
    sage: len(reps)
Expected:
    8
Got:
    1
**********************************************************************
1 items had failures:
   8 of  16 in __main__.example_1
***Test Failed*** 8 failures.
For whitespace errors, see the file /home/tboothby/.sage//tmp/.doctest_double_coset.py
         [5.3 s]
sage -t  ".6.2/devel/sage/sage/groups/perm_gps/permgroup_element.pyx"
         [6.0 s]
sage -t  ".6.2/devel/sage/sage/groups/perm_gps/permgroup_morphism.py"
         [8.1 s]
sage -t  ".6.2/devel/sage/sage/groups/generic.py"
         [13.3 s]
sage -t  ".6.2/devel/sage/sage/stats/__init__.py"
         [0.2 s]
sage -t  ".6.2/devel/sage/sage/stats/intlist.pyx"
         [7.0 s]
sage -t  ".6.2/devel/sage/sage/stats/all.py"
         [0.2 s]
sage -t  ".6.2/devel/sage/sage/stats/test.py"
         [4.8 s]
sage -t  ".6.2/devel/sage/sage/stats/basic_stats.py"        

                break
        if not found:
            reps.append(p)
Exception raised:
    Traceback (most recent call last):
      File "/home/tboothby/sage-4.6.2/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/home/tboothby/sage-4.6.2/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/home/tboothby/sage-4.6.2/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_1[14]>", line 5, in <module>
        if coset_eq(p, r, gens):
    NameError: name 'coset_eq' is not defined
**********************************************************************
File "/cecm/home/tboothby/sage-4.6.2/devel/sage/sage/groups/perm_gps/partn_ref/double_coset.pyx", line 165:
    sage: len(reps)
Expected:
    8
Got:
    1
**********************************************************************
1 items had failures:
   8 of  16 in __main__.example_1
***Test Failed*** 8 failures.
For whitespace errors, see the file /home/tboothby/.sage//tmp/.doctest_double_coset.py
         [5.3 s]
sage -t  ".6.2/devel/sage/sage/groups/perm_gps/permgroup_element.pyx"
         [6.0 s]
sage -t  ".6.2/devel/sage/sage/groups/perm_gps/permgroup_morphism.py"
```


... and it just keeps going.  This machine is a little flaky, so maybe the problem is on my end.  I'll try it on my laptop tonight.


---

Comment by boothby created at 2011-04-07 15:32:08

Changing status from needs_info to needs_review.


---

Comment by boothby created at 2011-04-07 15:32:16

bah, that was pebcak, I was wrong to blame my poor computer.  All tests pass, and this code looks really good!


---

Comment by boothby created at 2011-04-11 20:43:22

... and, I forgot to change the status on that last comment.  Does newbie behavior qualify me for a "first time review" in the changelog?


---

Comment by boothby created at 2011-04-11 20:43:22

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-04-13 15:58:36

This needs to be rebased to sage-4.7.alpha4 (because of #10886).


---

Comment by jdemeyer created at 2011-04-13 15:58:36

Changing status from positive_review to needs_work.


---

Comment by rlm created at 2011-04-13 18:29:20

A pretty trivial rebase, so I'm setting the status back to positive review.


---

Comment by rlm created at 2011-04-13 18:29:20

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2011-04-14 12:13:40


```
sage -t  -long -force_lib devel/sage/sage/groups/perm_gps/partn_ref/refinement_graphs.pyx
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.1.alpha0/devel/sage-main/sage/groups/perm_gps/partn_ref/refinement_graphs.pyx", line 764:
    sage: sage.groups.perm_gps.partn_ref.refinement_graphs.random_tests()  # long time (up to 25s on sage.math, 2011)
Expected:
    All passed: 640 random tests on 40 graphs.
Got:
    All passed: 200 random tests on 20 graphs.
**********************************************************************
```



---

Comment by jdemeyer created at 2011-04-14 12:13:40

Changing status from positive_review to needs_work.


---

Comment by rlm created at 2011-04-14 17:06:14

Changing status from needs_work to positive_review.


---

Comment by rlm created at 2011-04-14 17:06:14

Sorry about that, please try again!


---

Comment by rlm created at 2011-04-15 16:57:07

Changing status from positive_review to needs_work.


---

Comment by rlm created at 2011-04-15 17:29:04

I'm now convinced that the speed issues aren't a problem. The reason is that when we're computing an automorphism group we know that the stabilizer chain will be up to date below the current level, so we don't sift at all.

Just to make the argument convincing, I tested empty graphs (which have full symmetry group and would be most likely to show this problem if it were there):


```
sage: G = Graph(n)
sage: timeit('H = G.automorphism_group()')
```


The results, in milliseconds:

```
n:      |  10 |  20 |  30 |  40 |  50 |
--------|-----|-----|-----|-----|-----|
BEFORE: | 148 | 313 | 480 | 645 | 809 |
AFTER:  | 148 | 311 | 479 | 645 | 820 |
```


In other words, no change at all. For a more complicated graph of higher degree:

```
sage: G = graphs.HigmanSimsGraph()
sage: G.num_verts()
100
sage: G.num_edges()
1100
```


Before:

```
sage: timeit('H = G.automorphism_group()')
5 loops, best of 3: 274 ms per loop
```


After:

```
sage: timeit('H = G.automorphism_group()')
5 loops, best of 3: 267 ms per loop
```


So no significant changes. I'm going to ask Tom to re-review this patch, since it's been through a few changes since he gave it the thumbs up. Note that this patch applies cleanly to sage-4.7.alpha4.


---

Comment by rlm created at 2011-04-15 17:29:04

Changing status from needs_work to needs_review.


---

Comment by rlm created at 2011-04-18 02:39:06

Changing status from needs_review to needs_info.


---

Comment by rlm created at 2011-04-18 02:39:17

Changing status from needs_info to needs_review.


---

Comment by rlm created at 2011-04-18 02:48:54

Changing status from needs_review to needs_work.


---

Comment by rlm created at 2011-04-18 02:49:04

Changing status from needs_work to needs_review.


---

Comment by boothby created at 2011-04-24 04:21:06

Changing status from needs_review to positive_review.


---

Comment by boothby created at 2011-04-24 04:21:06

Tested against 4.7.alpha5, all tests pass!


---

Comment by jdemeyer created at 2011-05-03 12:29:26

Resolution: fixed


---

Comment by jdemeyer created at 2011-05-10 08:19:54

Changing status from closed to new.


---

Comment by jdemeyer created at 2011-05-10 08:19:54

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2011-05-10 08:19:54

This patch conflicts with #10549.


---

Comment by jdemeyer created at 2011-05-10 08:20:05

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2011-05-10 08:20:10

Changing status from needs_review to needs_work.


---

Comment by boothby created at 2011-05-13 04:53:16

Hold on, wasn't this merged?  #10549 wasn't merged yet, why was this marked `needs_work`?


---

Comment by rlm created at 2011-05-13 04:58:05

Changing status from needs_work to needs_review.


---

Attachment

I've rebased the patch here on #10549...


---

Comment by boothby created at 2011-05-16 04:34:20

Changing status from needs_review to positive_review.


---

Comment by boothby created at 2011-05-16 04:34:20

works for me.


---

Comment by jdemeyer created at 2011-06-01 07:10:38

Resolution: fixed
