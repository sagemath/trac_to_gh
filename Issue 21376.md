# Issue 21376: Don't use make for autogenerated modules in sagelib

archive/issues_021376.json:
```json
{
    "body": "CC:  @mkoeppe @jdemeyer\n\nCurrently there is a `src/Makefile` at the root of the sagelib sources that is required to be invoked in order to make sure the packages in `sage_setup.autogen` and that autogenerated sources are placed in the sage sources before running its `setup.py install`.\n\n#21480 inverts things somewhat by removing the old Makefile (really making it into a no-op for now), but pulling out the `sage_setup.autogen` stuff into a separate makefile that is still invoked by calling `make` from the `setup.py` (in the current version of that ticket it is even called unconditionally).  This is pretty non-standard.\n\nThe appropriate time to do this would be either just before the `build_py` command is run, or the `build_ext` command is run (in the case of autogenerated sources for extension modules).\n\nIn the current cases we have its very trivial to check whether or not any of the sources actually need to be regenerated, and this is a pretty normal thing to do in some other complex Python packages.  For example, the package responsible for generating the source files (e.g. currently the `sage_setup.autogen` sub-packages) simply needs to be responsible for knowing what its own source code files are, and knowing the paths for its generated sources--then just compare modtimes.\n\nOne can do even better by having one of the generated files be a hash of the source files, and compare the hashes instead (this avoids rebuilds when switching between git branches but where the files didn't otherwise change).\n\nIssue created by migration from https://trac.sagemath.org/ticket/21613\n\n",
    "created_at": "2016-09-29T15:45:29Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Don't use make for autogenerated modules in sagelib",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21376",
    "user": "https://github.com/embray"
}
```
CC:  @mkoeppe @jdemeyer

Currently there is a `src/Makefile` at the root of the sagelib sources that is required to be invoked in order to make sure the packages in `sage_setup.autogen` and that autogenerated sources are placed in the sage sources before running its `setup.py install`.

#21480 inverts things somewhat by removing the old Makefile (really making it into a no-op for now), but pulling out the `sage_setup.autogen` stuff into a separate makefile that is still invoked by calling `make` from the `setup.py` (in the current version of that ticket it is even called unconditionally).  This is pretty non-standard.

The appropriate time to do this would be either just before the `build_py` command is run, or the `build_ext` command is run (in the case of autogenerated sources for extension modules).

In the current cases we have its very trivial to check whether or not any of the sources actually need to be regenerated, and this is a pretty normal thing to do in some other complex Python packages.  For example, the package responsible for generating the source files (e.g. currently the `sage_setup.autogen` sub-packages) simply needs to be responsible for knowing what its own source code files are, and knowing the paths for its generated sources--then just compare modtimes.

One can do even better by having one of the generated files be a hash of the source files, and compare the hashes instead (this avoids rebuilds when switching between git branches but where the files didn't otherwise change).

Issue created by migration from https://trac.sagemath.org/ticket/21613





---

archive/issue_comments_296420.json:
```json
{
    "body": "From the description:\n> The appropriate time to do this would be either just before the build_py command is run, or the build_ext command is run (in the case of autogenerated sources for extension modules).\n\nCould you make a ticket on top of #21480 (and probably #21604) that moves the invocation of `make  -f generate_py_source.mk` to the right place?",
    "created_at": "2016-09-29T18:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296420",
    "user": "https://github.com/mkoeppe"
}
```

From the description:
> The appropriate time to do this would be either just before the build_py command is run, or the build_ext command is run (in the case of autogenerated sources for extension modules).

Could you make a ticket on top of #21480 (and probably #21604) that moves the invocation of `make  -f generate_py_source.mk` to the right place?



---

archive/issue_comments_296421.json:
```json
{
    "body": "Replying to [comment:2 mkoeppe]:\n> Could you make a ticket on top of #21480 (and probably #21604) that moves the invocation of `make  -f generate_py_source.mk` to the right place?\n\nThat's not so easy, for the same reason that #21600 is not so easy. We need to pass the list of Python packages, Cython extensions and data_files to `setup()`. It is harder to get this right if not everything has been generated at that point. We should probably compute the list of packages dynamically in `setup()`.",
    "created_at": "2016-09-30T08:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296421",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:2 mkoeppe]:
> Could you make a ticket on top of #21480 (and probably #21604) that moves the invocation of `make  -f generate_py_source.mk` to the right place?

That's not so easy, for the same reason that #21600 is not so easy. We need to pass the list of Python packages, Cython extensions and data_files to `setup()`. It is harder to get this right if not everything has been generated at that point. We should probably compute the list of packages dynamically in `setup()`.



---

archive/issue_comments_296422.json:
```json
{
    "body": "Again, the title of this ticket does not match the long description. Do you want to get rid of `make` or just move the invocation of `make -f generate_py_source.mk` inside `setup()`?",
    "created_at": "2016-09-30T08:42:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296422",
    "user": "https://github.com/jdemeyer"
}
```

Again, the title of this ticket does not match the long description. Do you want to get rid of `make` or just move the invocation of `make -f generate_py_source.mk` inside `setup()`?



---

archive/issue_comments_296423.json:
```json
{
    "body": "I think it does match but I'm not sure what's unclear.",
    "created_at": "2016-09-30T10:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296423",
    "user": "https://github.com/embray"
}
```

I think it does match but I'm not sure what's unclear.



---

archive/issue_comments_296424.json:
```json
{
    "body": "I feel like this is not hard, having done it many times before.  There's nothing particularly special about sage either in any of these regards.",
    "created_at": "2016-09-30T10:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296424",
    "user": "https://github.com/embray"
}
```

I feel like this is not hard, having done it many times before.  There's nothing particularly special about sage either in any of these regards.



---

archive/issue_comments_296425.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2016-10-06T10:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296425",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_296426.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-07T12:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296426",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_296427.json:
```json
{
    "body": "Determine directly in the Python code whether or not autogenerated sources need to be built, without requiring a makefile or anything.  I think this is simple and clear to anyone who looks at the code.\n\nIf in the future we want more full make-like capabilities I've got something in the works for that, but it seems unlikely that anything more complicated than this is needed any time soon.\n----\nLast 10 new commits:",
    "created_at": "2016-10-07T12:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296427",
    "user": "https://github.com/embray"
}
```

Determine directly in the Python code whether or not autogenerated sources need to be built, without requiring a makefile or anything.  I think this is simple and clear to anyone who looks at the code.

If in the future we want more full make-like capabilities I've got something in the works for that, but it seems unlikely that anything more complicated than this is needed any time soon.
----
Last 10 new commits:



---

archive/issue_comments_296428.json:
```json
{
    "body": "This looks nice and easy to understand. \nBut let's get #21600 done before we full review this one.",
    "created_at": "2016-10-09T21:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296428",
    "user": "https://github.com/mkoeppe"
}
```

This looks nice and easy to understand. 
But let's get #21600 done before we full review this one.



---

archive/issue_comments_296429.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-14T06:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296429",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_296430.json:
```json
{
    "body": "On this ticket, [0394333](https://git.sagemath.org/sage.git/commit?id=0394333a54e51c53b9404f248220a412cf13e00e) needs to be reverted, `generate_py_source` removed again from `MANIFEST.in`\n\n(Of course, the manifest is out-of-date in many respects (#21516).)",
    "created_at": "2016-10-14T06:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296430",
    "user": "https://github.com/mkoeppe"
}
```

On this ticket, [0394333](https://git.sagemath.org/sage.git/commit?id=0394333a54e51c53b9404f248220a412cf13e00e) needs to be reverted, `generate_py_source` removed again from `MANIFEST.in`

(Of course, the manifest is out-of-date in many respects (#21516).)



---

archive/issue_comments_296431.json:
```json
{
    "body": "Indeed. I just noticed that MANIFEST.in contains MANIFEST.in, which it really doesn't need to do :)",
    "created_at": "2016-10-14T08:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296431",
    "user": "https://github.com/embray"
}
```

Indeed. I just noticed that MANIFEST.in contains MANIFEST.in, which it really doesn't need to do :)



---

archive/issue_comments_296432.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-14T08:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296433.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-14T08:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296433",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_057351.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2016-10-17T03:42:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "milestone": "sage-7.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21376#event-57351"
}
```



---

archive/issue_comments_296434.json:
```json
{
    "body": "This needs rebasing on top of current develop and possibly some work there.\nBuilding from scratch (with 7.4.rc2 merged) fails for me with:\n\n```\nNo such file or directory: '/doesnotexist/sage/libs/pari/paridecl.pxd'\n```\n\n(this is from #21480).",
    "created_at": "2016-10-17T03:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296434",
    "user": "https://github.com/mkoeppe"
}
```

This needs rebasing on top of current develop and possibly some work there.
Building from scratch (with 7.4.rc2 merged) fails for me with:

```
No such file or directory: '/doesnotexist/sage/libs/pari/paridecl.pxd'
```

(this is from #21480).



---

archive/issue_comments_296435.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-17T03:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296435",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_296436.json:
```json
{
    "body": "Ok, but I'm a little confused--this branch is based on the branch in #21600.  Was that rebased, or in need of rebasing too?",
    "created_at": "2016-10-17T09:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296436",
    "user": "https://github.com/embray"
}
```

Ok, but I'm a little confused--this branch is based on the branch in #21600.  Was that rebased, or in need of rebasing too?



---

archive/issue_comments_296437.json:
```json
{
    "body": "Probably easiest to just merge current develop, not rebase.",
    "created_at": "2016-10-17T14:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296437",
    "user": "https://github.com/mkoeppe"
}
```

Probably easiest to just merge current develop, not rebase.



---

archive/issue_comments_296438.json:
```json
{
    "body": "Oh I see, this is because `sage_setup.autogen` uses `SAGE_SRC`.  I guess it would be fine to just remove that, under the assumption that sage's `setup.py` is always run from the root of the sagelib source directory.",
    "created_at": "2016-10-17T14:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296438",
    "user": "https://github.com/embray"
}
```

Oh I see, this is because `sage_setup.autogen` uses `SAGE_SRC`.  I guess it would be fine to just remove that, under the assumption that sage's `setup.py` is always run from the root of the sagelib source directory.



---

archive/issue_comments_296439.json:
```json
{
    "body": "Alternatively, would you be opposed to changing the Makefile so that `SAGE_SRC` is just set to `.`?  There are places in the code where it makes sense to have `SAGE_SRC` set outside the context of building (e.g. testing), but where when building it should just be `.`.",
    "created_at": "2016-10-17T14:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296439",
    "user": "https://github.com/embray"
}
```

Alternatively, would you be opposed to changing the Makefile so that `SAGE_SRC` is just set to `.`?  There are places in the code where it makes sense to have `SAGE_SRC` set outside the context of building (e.g. testing), but where when building it should just be `.`.



---

archive/issue_comments_296440.json:
```json
{
    "body": "Replying to [comment:20 embray]:\n> Alternatively, would you be opposed to changing the Makefile so that `SAGE_SRC` is just set to `.`?  There are places in the code where it makes sense to have `SAGE_SRC` set outside the context of building (e.g. testing), but where when building it should just be `.`.\n\nPlease don't do that.\nsetup.py needs to be able to run without SAGE_SRC set.\nThat's the whole point of #21480.",
    "created_at": "2016-10-17T14:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296440",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:20 embray]:
> Alternatively, would you be opposed to changing the Makefile so that `SAGE_SRC` is just set to `.`?  There are places in the code where it makes sense to have `SAGE_SRC` set outside the context of building (e.g. testing), but where when building it should just be `.`.

Please don't do that.
setup.py needs to be able to run without SAGE_SRC set.
That's the whole point of #21480.



---

archive/issue_comments_296441.json:
```json
{
    "body": "That's sort of what I thought.  The problem is that there is code in this package that needs to be able to run in both a \"build\" environment and a \"runtime\" environment.  I agree that in the \"build\" environment it should not depend on `SAGE_SRC`.\n\nHowever, prior to this ticket the `setup.py` was depending on `SAGE_SRC` anyways, implicitly, through running Python from the makefile.\n\nI could modify that code to only use `SAGE_SRC` if it is set, but that's not going to work because it *is* set to \"/doesnotexist\".  I could check explicitly for that path but that's rather ugly too.",
    "created_at": "2016-10-17T14:35:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296441",
    "user": "https://github.com/embray"
}
```

That's sort of what I thought.  The problem is that there is code in this package that needs to be able to run in both a "build" environment and a "runtime" environment.  I agree that in the "build" environment it should not depend on `SAGE_SRC`.

However, prior to this ticket the `setup.py` was depending on `SAGE_SRC` anyways, implicitly, through running Python from the makefile.

I could modify that code to only use `SAGE_SRC` if it is set, but that's not going to work because it *is* set to "/doesnotexist".  I could check explicitly for that path but that's rather ugly too.



---

archive/issue_comments_296442.json:
```json
{
    "body": "How about this:  As a special case, when `sys.argv[0] == 'setup.py'` we could set `SAGE_SRC` in `sage.env` to `'.'`?",
    "created_at": "2016-10-17T14:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296442",
    "user": "https://github.com/embray"
}
```

How about this:  As a special case, when `sys.argv[0] == 'setup.py'` we could set `SAGE_SRC` in `sage.env` to `'.'`?



---

archive/issue_comments_296443.json:
```json
{
    "body": "Why not just set the environment variable in setup.py?\nThat's what was done (well, for a subprocess) before this ticket.",
    "created_at": "2016-10-17T14:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296443",
    "user": "https://github.com/mkoeppe"
}
```

Why not just set the environment variable in setup.py?
That's what was done (well, for a subprocess) before this ticket.



---

archive/issue_comments_296444.json:
```json
{
    "body": "Ah, so *that's* ok so long as it's not coming from the outer environment in which `setup.py` is run.  That makes sense--thanks for the suggestion.",
    "created_at": "2016-10-17T14:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296444",
    "user": "https://github.com/embray"
}
```

Ah, so *that's* ok so long as it's not coming from the outer environment in which `setup.py` is run.  That makes sense--thanks for the suggestion.



---

archive/issue_comments_296445.json:
```json
{
    "body": "Ok, I'm confused again because `setup.py` *is* setting `SAGE_SRC` to `os.getcwd()`, quite early on too.  So I'm not sure why that's being dropped.  The autogen code isn't being run in a subprocess, at least I don't think.",
    "created_at": "2016-10-17T14:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296445",
    "user": "https://github.com/embray"
}
```

Ok, I'm confused again because `setup.py` *is* setting `SAGE_SRC` to `os.getcwd()`, quite early on too.  So I'm not sure why that's being dropped.  The autogen code isn't being run in a subprocess, at least I don't think.



---

archive/issue_comments_296446.json:
```json
{
    "body": "This is exactly what you need to debug; it worked before.",
    "created_at": "2016-10-17T14:47:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296446",
    "user": "https://github.com/mkoeppe"
}
```

This is exactly what you need to debug; it worked before.



---

archive/issue_comments_296447.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-17T14:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296447",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296448.json:
```json
{
    "body": "Fixed--there were some dangling uses of `os.environ` is `sage_setup.autogen.pari`.",
    "created_at": "2016-10-17T14:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296448",
    "user": "https://github.com/embray"
}
```

Fixed--there were some dangling uses of `os.environ` is `sage_setup.autogen.pari`.



---

archive/issue_comments_296449.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-17T14:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296449",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296450.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-17T15:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296450",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296451.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-10-18T04:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296451",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_296452.json:
```json
{
    "body": "Looks good.",
    "created_at": "2016-10-18T04:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296452",
    "user": "https://github.com/mkoeppe"
}
```

Looks good.



---

archive/issue_comments_296453.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2016-10-20T21:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296453",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_296454.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-20T21:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296454",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_296455.json:
```json
{
    "body": "This is not actionable unless you tell us with which ticket it conflicts.",
    "created_at": "2016-10-20T23:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296455",
    "user": "https://github.com/mkoeppe"
}
```

This is not actionable unless you tell us with which ticket it conflicts.



---

archive/issue_comments_296456.json:
```json
{
    "body": "Just wait for the next beta",
    "created_at": "2016-10-21T06:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296456",
    "user": "https://github.com/vbraun"
}
```

Just wait for the next beta



---

archive/issue_comments_296457.json:
```json
{
    "body": "Erik: The branch on this ticket also has some of Jeroen's changes in it that are not yet in 7.5.beta0. From which ticket are they? It should be added to dependencies.",
    "created_at": "2016-10-22T18:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296457",
    "user": "https://github.com/mkoeppe"
}
```

Erik: The branch on this ticket also has some of Jeroen's changes in it that are not yet in 7.5.beta0. From which ticket are they? It should be added to dependencies.



---

archive/issue_comments_296458.json:
```json
{
    "body": "I'm adding #21820 as dependency because this ticket would conflict with that.",
    "created_at": "2016-11-05T17:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296458",
    "user": "https://github.com/jdemeyer"
}
```

I'm adding #21820 as dependency because this ticket would conflict with that.



---

archive/issue_comments_296459.json:
```json
{
    "body": "Or, since this ticket already had a positive review pending resolution of merge conflicts, you could make #21820 depend on this.",
    "created_at": "2016-11-07T13:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296459",
    "user": "https://github.com/embray"
}
```

Or, since this ticket already had a positive review pending resolution of merge conflicts, you could make #21820 depend on this.



---

archive/issue_comments_296460.json:
```json
{
    "body": "Replying to [comment:38 embray]:\n> Or, since this ticket already had a positive review\n\n\"ha**d**\" is the important word here. Adding a dependency on a needs_work ticket with no activity for 2 weeks did not seem like a wise move to me.\n\nBut I don't want to upset you. So feel free to undo [comment:37] if you fix this ticket.",
    "created_at": "2016-11-07T13:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296460",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:38 embray]:
> Or, since this ticket already had a positive review

"ha**d**" is the important word here. Adding a dependency on a needs_work ticket with no activity for 2 weeks did not seem like a wise move to me.

But I don't want to upset you. So feel free to undo [comment:37] if you fix this ticket.



---

archive/issue_comments_296461.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-07T14:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296461",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296462.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-07T14:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296462",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_296463.json:
```json
{
    "body": "Rebased--this was just based on a slightly older version of #21600 that was ultimately merged.",
    "created_at": "2016-11-07T14:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296463",
    "user": "https://github.com/embray"
}
```

Rebased--this was just based on a slightly older version of #21600 that was ultimately merged.



---

archive/issue_comments_296464.json:
```json
{
    "body": "In order to at least *minimize* the conflict with #21820 and #21821, can you revert the unneeded changes to `src/sage_setup/autogen/pari/parser.py`?",
    "created_at": "2016-11-07T14:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296464",
    "user": "https://github.com/jdemeyer"
}
```

In order to at least *minimize* the conflict with #21820 and #21821, can you revert the unneeded changes to `src/sage_setup/autogen/pari/parser.py`?



---

archive/issue_comments_296465.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-07T14:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296465",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_296466.json:
```json
{
    "body": "I would be happy to, but as it stands that change is needed, per [comment:15].  Now that I'm back from vacation and we can sync up better we can keep the dependencies if you want.  I just figured it would be easier for you to understand this change and build on top of it, rather than for me to do the same with #21820 and #21821.",
    "created_at": "2016-11-07T16:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296466",
    "user": "https://github.com/embray"
}
```

I would be happy to, but as it stands that change is needed, per [comment:15].  Now that I'm back from vacation and we can sync up better we can keep the dependencies if you want.  I just figured it would be easier for you to understand this change and build on top of it, rather than for me to do the same with #21820 and #21821.



---

archive/issue_comments_296467.json:
```json
{
    "body": "Replying to [comment:44 embray]:\n> I would be happy to, but as it stands that change is needed, per [comment:15].\n\nI am missing something. Why doesn't the same code fail right now (without applying this branch)?",
    "created_at": "2016-11-07T16:13:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296467",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:44 embray]:
> I would be happy to, but as it stands that change is needed, per [comment:15].

I am missing something. Why doesn't the same code fail right now (without applying this branch)?



---

archive/issue_comments_296468.json:
```json
{
    "body": "Besides the fact that the code using `sage.env` conflicts with #21821, I think it is also bad style for `setup.py` to import `sage.env` while building `sage`.",
    "created_at": "2016-11-07T16:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296468",
    "user": "https://github.com/jdemeyer"
}
```

Besides the fact that the code using `sage.env` conflicts with #21821, I think it is also bad style for `setup.py` to import `sage.env` while building `sage`.



---

archive/issue_comments_296469.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> Replying to [comment:44 embray]:\n> > I would be happy to, but as it stands that change is needed, per [comment:15].\n> \n> I am missing something. Why doesn't the same code fail right now (without applying this branch)?\n\nPreviously, when `make` was invoked, it was passed `SAGE_SRC=...`.",
    "created_at": "2016-11-07T16:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296469",
    "user": "https://github.com/embray"
}
```

Replying to [comment:45 jdemeyer]:
> Replying to [comment:44 embray]:
> > I would be happy to, but as it stands that change is needed, per [comment:15].
> 
> I am missing something. Why doesn't the same code fail right now (without applying this branch)?

Previously, when `make` was invoked, it was passed `SAGE_SRC=...`.



---

archive/issue_comments_296470.json:
```json
{
    "body": "Replying to [comment:47 embray]:\n> Previously, when `make` was invoked, it was passed `SAGE_SRC=...`.\n\nRight, I see. That's an ugly hack though.\n\nI changed #21821 such that it doesn't need `SAGE_SRC`.",
    "created_at": "2016-11-07T16:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296470",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:47 embray]:
> Previously, when `make` was invoked, it was passed `SAGE_SRC=...`.

Right, I see. That's an ugly hack though.

I changed #21821 such that it doesn't need `SAGE_SRC`.



---

archive/issue_comments_296471.json:
```json
{
    "body": "needs rebasing...",
    "created_at": "2016-11-18T01:21:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296471",
    "user": "https://github.com/mkoeppe"
}
```

needs rebasing...



---

archive/issue_comments_296472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-18T16:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296473.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-18T16:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296473",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296474.json:
```json
{
    "body": "Somewhere you should add a Python equivalent of\n\n```\nrm -f sage/libs/pari/auto_*.pxi\n```\n",
    "created_at": "2016-11-19T08:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296474",
    "user": "https://github.com/jdemeyer"
}
```

Somewhere you should add a Python equivalent of

```
rm -f sage/libs/pari/auto_*.pxi
```




---

archive/issue_comments_296475.json:
```json
{
    "body": "I don't really think that belongs here in the first place but okay.",
    "created_at": "2016-11-21T10:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296475",
    "user": "https://github.com/embray"
}
```

I don't really think that belongs here in the first place but okay.



---

archive/issue_comments_296476.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-21T10:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296476",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296477.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-21T10:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296477",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_296478.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-21T10:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296478",
    "user": "https://github.com/embray"
}
```

New commits:



---

archive/issue_comments_296479.json:
```json
{
    "body": "In #21820, some paths changed. In particular, the generated files are now in `src/sage/libs/cypari2`.",
    "created_at": "2016-11-22T10:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296479",
    "user": "https://github.com/jdemeyer"
}
```

In #21820, some paths changed. In particular, the generated files are now in `src/sage/libs/cypari2`.



---

archive/issue_comments_296480.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-11-22T10:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296480",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_296481.json:
```json
{
    "body": "Yes, I see that now. Incidentally *building* still worked, it just built the files in the wrong place.",
    "created_at": "2016-11-22T13:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296481",
    "user": "https://github.com/embray"
}
```

Yes, I see that now. Incidentally *building* still worked, it just built the files in the wrong place.



---

archive/issue_comments_296482.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-11-22T13:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296483.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-22T13:27:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296483",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_296484.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-11-22T13:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296484",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_296485.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-22T13:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296485",
    "user": "https://github.com/embray"
}
```

New commits:



---

archive/issue_comments_296486.json:
```json
{
    "body": "Looks good to me; though the description of this ticket could use updating.",
    "created_at": "2016-12-06T19:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296486",
    "user": "https://github.com/mkoeppe"
}
```

Looks good to me; though the description of this ticket could use updating.



---

archive/issue_comments_296487.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-06T19:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296487",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_057352.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-07T23:30:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21376#event-57352"
}
```



---

archive/issue_comments_296488.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-07T23:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296488",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_296489.json:
```json
{
    "body": "Some changes made here are not py3 compatible, and need to be corrected to be so.\n\ntry:\n\n```\nexport SAGE_PYTHON3=yes \nmake build\n```\n",
    "created_at": "2016-12-10T11:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296489",
    "user": "https://github.com/fchapoton"
}
```

Some changes made here are not py3 compatible, and need to be corrected to be so.

try:

```
export SAGE_PYTHON3=yes 
make build
```




---

archive/issue_comments_296490.json:
```json
{
    "body": "proposal fix in #22044",
    "created_at": "2016-12-11T09:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296490",
    "user": "https://github.com/fchapoton"
}
```

proposal fix in #22044



---

archive/issue_comments_296491.json:
```json
{
    "body": "Breakage: #22094.",
    "created_at": "2016-12-26T09:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21376",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21376#issuecomment-296491",
    "user": "https://github.com/jdemeyer"
}
```

Breakage: #22094.
