# Issue 16268: Modify cached_method's clear_cache() to remove single keys

Issue created by migration from https://trac.sagemath.org/ticket/16505

Original creator: saraedum

Original creation time: 2014-06-20 18:54:16

Keywords: cached_method

A `cached_method`'s `clear_cache()` clears the entire dictionary of a `cached_method`. Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore (e.g. because they are defined in some external expect interface but the external session is not running anymore, #16369).

This tickets adds an optional parameter to `clear_cache()` which removes only the specified keys from the dictionary.


---

Comment by saraedum created at 2014-06-20 19:33:25

Changing status from new to needs_review.


---

Comment by git created at 2014-06-23 02:14:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-07-23 17:33:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-01-10 07:14:47

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2015-01-10 07:14:47

From the looks of the function `set_cache` just above the one that you define, it seems that you should also handle the case of non-hashable keys.

Nathann


---

Comment by git created at 2015-12-23 18:54:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-23 19:00:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-12-23 19:09:22

Please rebase this on top of #19768.


---

Comment by git created at 2016-01-09 05:23:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-09 05:27:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2016-01-09 06:59:43

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-01-09 08:17:48

Please use the `get_key_args_kwds()` and `dict_key()` functions added recently to cached functions.


---

Comment by jdemeyer created at 2016-01-09 08:22:15

Replying to [ticket:16505 saraedum]:
> Currently, there is no way to only remove some keys. This is sometimes necessary if values in the cache are not usable anymore

For this use case, I see no reason to raise `KeyError` when the key does not exist: I would just ignore non-existing keys.

You should add doctests showing that this also works for a weak cached function and a cached method (not just plain cached functions).


---

Comment by jdemeyer created at 2016-01-09 08:22:15

Changing status from needs_review to needs_work.
