# Issue 26912: Test failure in doctest framework

archive/issues_026675.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nAs discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in `src/sage/doctest/test.py` sometimes fails when the system is under load. This was reproduced by Jeroen Demeyer with sage 8.5.rc0. Here's the log:\n\n```\nFile \"/nix/store/s1x3samyxif0mdg4l9v6abjzccc88b08-sage-src-8.4/src/sage/doctest/test.py\", line 220, in sage.doctest.test\nFailed example:\n    subprocess.call([\"sage\", \"-tp\", \"1000000\", \"--timeout=120\",  # long time\n         \"--warn-long\", \"0\", \"99seconds.rst\", \"interrupt_diehard.rst\"], **kwds2)\nExpected:\n    Running doctests...\n    Doctesting 2 files using 1000000 threads.\n    Killing test 99seconds.rst\n    Killing test interrupt_diehard.rst\n    ----------------------------------------------------------------------\n    Doctests interrupted: 0/2 files tested\n    ----------------------------------------------------------------------\n    ...\n    128\nGot:\n    Running doctests with ID 2018-12-17-16-27-41-26396051.\n    Using --optional=dochtml,gmp,memlimit,nose,sage\n    Doctesting 2 files using 1000000 threads.\n    ------------------------------------------------------------------------\n    Killing test 99seconds.rst\n    Killing test interrupt_diehard.rst\n    /nix/store/chdzkj17b8x0q42jnygpsjj9ccw2rasz-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7bfb)[0x7ffff1a2bbfb]\n    /nix/store/chdzkj17b8x0q42jnygpsjj9ccw2rasz-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7cbf)[0x7ffff1a2bcbf]\n    /nix/store/chdzkj17b8x0q42jnygpsjj9ccw2rasz-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0xa7bb)[0x7ffff1a2e7bb]\n    /nix/store/1mnsmslnx5anjfksac6417xfzzglrwhr-glibc-2.27/lib/libpthread.so.0(+0x11f10)[0x7ffff7592f10]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyFrame_New+0xb5)[0x7ffff78294e5]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x947a)[0x7ffff78b658a]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0x8a109)[0x7ffff782a109]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0x6865c)[0x7ffff780865c]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0xcb3ba)[0x7ffff786b3ba]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x2d32)[0x7ffff78afe42]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x94cb)[0x7ffff78b65db]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0x8a109)[0x7ffff782a109]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0x6865c)[0x7ffff780865c]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0xcb6f2)[0x7ffff786b6f2]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0xc7bba)[0x7ffff7867bba]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x2d32)[0x7ffff78afe42]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x94cb)[0x7ffff78b65db]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7ffff78b6fe9]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7ffff78d9c8a]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xe3)[0x7ffff78dbbc3]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(Py_Main+0xb4a)[0x7ffff78f4ada]\n    /nix/store/1mnsmslnx5anjfksac6417xfzzglrwhr-glibc-2.27/lib/libc.so.6(__libc_start_main+0xee)[0x7ffff6a52b8e]\n    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/bin/python(_start+0x2a)[0x4007fa]\n    ------------------------------------------------------------------------\n    ----------------------------------------------------------------------\n    Doctests interrupted: 0/2 files tested\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.1 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    Attaching gdb to process id 6834.\n    Cannot find gdb installed\n    GDB is not installed.\n    Install gdb for enhanced tracebacks.\n    ------------------------------------------------------------------------\n    128\n```\n\nCC:  @jdemeyer\n\nComponent: **doctest framework**\n\nAuthor: **Erik Bray**\n\nBranch: **[`ca5257a`](https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18)**\n\nReviewer: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26912_\n\n",
    "closed_at": "2021-03-18T22:32:21Z",
    "created_at": "2018-12-18T13:36:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Test failure in doctest framework",
    "type": "issue",
    "updated_at": "2023-01-08T09:54:45Z",
    "url": "https://github.com/sagemath/sage/issues/26912",
    "user": "https://github.com/timokau"
}
```
<div id="comment:0"></div>

As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in `src/sage/doctest/test.py` sometimes fails when the system is under load. This was reproduced by Jeroen Demeyer with sage 8.5.rc0. Here's the log:

```
File "/nix/store/s1x3samyxif0mdg4l9v6abjzccc88b08-sage-src-8.4/src/sage/doctest/test.py", line 220, in sage.doctest.test
Failed example:
    subprocess.call(["sage", "-tp", "1000000", "--timeout=120",  # long time
         "--warn-long", "0", "99seconds.rst", "interrupt_diehard.rst"], **kwds2)
Expected:
    Running doctests...
    Doctesting 2 files using 1000000 threads.
    Killing test 99seconds.rst
    Killing test interrupt_diehard.rst
    ----------------------------------------------------------------------
    Doctests interrupted: 0/2 files tested
    ----------------------------------------------------------------------
    ...
    128
Got:
    Running doctests with ID 2018-12-17-16-27-41-26396051.
    Using --optional=dochtml,gmp,memlimit,nose,sage
    Doctesting 2 files using 1000000 threads.
    ------------------------------------------------------------------------
    Killing test 99seconds.rst
    Killing test interrupt_diehard.rst
    /nix/store/chdzkj17b8x0q42jnygpsjj9ccw2rasz-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7bfb)[0x7ffff1a2bbfb]
    /nix/store/chdzkj17b8x0q42jnygpsjj9ccw2rasz-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0x7cbf)[0x7ffff1a2bcbf]
    /nix/store/chdzkj17b8x0q42jnygpsjj9ccw2rasz-python-2.7.15-env/lib/python2.7/site-packages/cysignals/signals.so(+0xa7bb)[0x7ffff1a2e7bb]
    /nix/store/1mnsmslnx5anjfksac6417xfzzglrwhr-glibc-2.27/lib/libpthread.so.0(+0x11f10)[0x7ffff7592f10]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyFrame_New+0xb5)[0x7ffff78294e5]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x947a)[0x7ffff78b658a]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0x8a109)[0x7ffff782a109]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0x6865c)[0x7ffff780865c]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0xcb3ba)[0x7ffff786b3ba]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x2d32)[0x7ffff78afe42]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x94cb)[0x7ffff78b65db]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0x8a109)[0x7ffff782a109]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0x6865c)[0x7ffff780865c]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0xcb6f2)[0x7ffff786b6f2]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(+0xc7bba)[0x7ffff7867bba]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyObject_Call+0x43)[0x7ffff77f9043]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x2d32)[0x7ffff78afe42]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x94cb)[0x7ffff78b65db]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6713)[0x7ffff78b3823]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7b8)[0x7ffff78b6dd8]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7ffff78b6fe9]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7ffff78d9c8a]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xe3)[0x7ffff78dbbc3]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/lib/libpython2.7.so.1.0(Py_Main+0xb4a)[0x7ffff78f4ada]
    /nix/store/1mnsmslnx5anjfksac6417xfzzglrwhr-glibc-2.27/lib/libc.so.6(__libc_start_main+0xee)[0x7ffff6a52b8e]
    /nix/store/vb3jdf8f9xq8aq77dq93csifdx3xkcwa-python-2.7.15/bin/python(_start+0x2a)[0x4007fa]
    ------------------------------------------------------------------------
    ----------------------------------------------------------------------
    Doctests interrupted: 0/2 files tested
    ----------------------------------------------------------------------
    Total time for all tests: 0.1 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    Attaching gdb to process id 6834.
    Cannot find gdb installed
    GDB is not installed.
    Install gdb for enhanced tracebacks.
    ------------------------------------------------------------------------
    128
```

CC:  @jdemeyer

Component: **doctest framework**

Author: **Erik Bray**

Branch: **[`ca5257a`](https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18)**

Reviewer: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/26912_





---

archive/issue_events_366744.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-12-18T13:36:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366744"
}
```



---

archive/issue_events_366745.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-12-18T13:36:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366745"
}
```



---

archive/issue_events_366746.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-12-18T13:36:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366746"
}
```



---

archive/issue_events_366747.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-12-18T13:36:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366747"
}
```



---

archive/issue_comments_414580.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\n@jdemeyer\n> Unfortunately, I don't manage to reproduce it reliably enough to be able \n> to fix it.\n\nThats unfortunate. Do you think it may have something to do with the \"ridiculous\nnumber of threads\"?",
    "created_at": "2018-12-18T13:37:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414580",
    "user": "https://github.com/timokau"
}
```

<div id="comment:1" align="right">comment:1</div>

@jdemeyer
> Unfortunately, I don't manage to reproduce it reliably enough to be able 
> to fix it.

Thats unfortunate. Do you think it may have something to do with the "ridiculous
number of threads"?



---

archive/issue_events_366748.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-18T13:39:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366748"
}
```



---

archive/issue_events_366749.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-18T13:39:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "0000b0",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366749"
}
```



---

archive/issue_comments_414581.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in src/sage/doctest/test.py sometimes fails when the system is under load. This was reproduced bei Jeoren with sage 8.5.rc0. Here's the log:\n+As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in `src/sage/doctest/test.py` sometimes fails when the system is under load. This was reproduced bei Jeroen with sage 8.5.rc0. Here's the log:\n \n ```\n File \"/nix/store/s1x3samyxif0mdg4l9v6abjzccc88b08-sage-src-8.4/src/sage/doctest/test.py\", line 220, in sage.doctest.test\n@@ -90,4 +90,3 @@\n     ------------------------------------------------------------------------\n     128\n ```\n-\n``````\n",
    "created_at": "2018-12-18T13:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414581",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in src/sage/doctest/test.py sometimes fails when the system is under load. This was reproduced bei Jeoren with sage 8.5.rc0. Here's the log:
+As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in `src/sage/doctest/test.py` sometimes fails when the system is under load. This was reproduced bei Jeroen with sage 8.5.rc0. Here's the log:
 
 ```
 File "/nix/store/s1x3samyxif0mdg4l9v6abjzccc88b08-sage-src-8.4/src/sage/doctest/test.py", line 220, in sage.doctest.test
@@ -90,4 +90,3 @@
     ------------------------------------------------------------------------
     128
 ```
-
``````




---

archive/issue_comments_414582.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAs I mentioned before, I don't think that this is related to cysignals in any way.",
    "created_at": "2018-12-18T13:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414582",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">comment:2</div>

As I mentioned before, I don't think that this is related to cysignals in any way.



---

archive/issue_comments_414583.json:
```json
{
    "body": "Changed keywords from **cysignals** to none",
    "created_at": "2018-12-18T13:39:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414583",
    "user": "https://github.com/jdemeyer"
}
```

Changed keywords from **cysignals** to none



---

archive/issue_events_366750.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-18T13:39:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "title_is": "Test failure in doctest framework",
    "title_was": "cysignals related test failure in test.py",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366750"
}
```



---

archive/issue_comments_414584.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in `src/sage/doctest/test.py` sometimes fails when the system is under load. This was reproduced bei Jeroen with sage 8.5.rc0. Here's the log:\n+As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in `src/sage/doctest/test.py` sometimes fails when the system is under load. This was reproduced by Jeroen Demeyer with sage 8.5.rc0. Here's the log:\n \n ```\n File \"/nix/store/s1x3samyxif0mdg4l9v6abjzccc88b08-sage-src-8.4/src/sage/doctest/test.py\", line 220, in sage.doctest.test\n``````\n",
    "created_at": "2018-12-18T13:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414584",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in `src/sage/doctest/test.py` sometimes fails when the system is under load. This was reproduced bei Jeroen with sage 8.5.rc0. Here's the log:
+As discussed [on sage-packaging](https://groups.google.com/forum/#!topic/sage-packaging/CtiTkXDxWF0), one of the test cases in `src/sage/doctest/test.py` sometimes fails when the system is under load. This was reproduced by Jeroen Demeyer with sage 8.5.rc0. Here's the log:
 
 ```
 File "/nix/store/s1x3samyxif0mdg4l9v6abjzccc88b08-sage-src-8.4/src/sage/doctest/test.py", line 220, in sage.doctest.test
``````




---

archive/issue_comments_414585.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOh, I misunderstood. I thought you only meant that the update to 1.8.0 wasn't responsible.",
    "created_at": "2018-12-19T09:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414585",
    "user": "https://github.com/timokau"
}
```

<div id="comment:4" align="right">comment:4</div>

Oh, I misunderstood. I thought you only meant that the update to 1.8.0 wasn't responsible.



---

archive/issue_comments_414586.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414586",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_events_366751.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366751"
}
```



---

archive/issue_events_366752.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366752"
}
```



---

archive/issue_events_366753.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366753"
}
```



---

archive/issue_events_366754.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366754"
}
```



---

archive/issue_comments_414587.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414587",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_414588.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAs the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:54:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414588",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">comment:7</div>

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_366755.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:54:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366755"
}
```



---

archive/issue_comments_414589.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI'm seeing something like this quite frequently since trying to test the fix to #30945:\n\n```\n$ SAGE_TIMEOUT=3 sage -t --warn-long 0 --random-seed=0 src/sage/doctest/tests/99seconds.rst \nRunning doctests with ID 2021-03-08-14-48-11-b862a4f7.\nGit branch: u/embray/gappy-without-wrappers\nUsing --optional=build,debian,dochtml,memlimit,pip,rubiks,sage,sage_spkg\nDoctesting 1 file.\nsage -t --warn-long 0.0 --random-seed=0 src/sage/doctest/tests/99seconds.rst\n    Timed out (and interrupt failed)\n**********************************************************************\nTests run before process (pid=7821) timed out:\nsage: import time ## line 3 ##\nsage: time.sleep(99) ## line 4 ##\n------------------------------------------------------------------------\n/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x6a6b)[0x7f4ccad87a6b]\n/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x6c48)[0x7f4ccad87c48]\n/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x90fa)[0x7f4ccad8a0fa]\n<long stacktrace>\n------------------------------------------------------------------------\nAttaching gdb to process id 7821.\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t --warn-long 0.0 --random-seed=0 src/sage/doctest/tests/99seconds.rst  # Timed out (and interrupt failed)\n----------------------------------------------------------------------\nTotal time for all tests: 63.0 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```",
    "created_at": "2021-03-08T13:55:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414589",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

I'm seeing something like this quite frequently since trying to test the fix to #30945:

```
$ SAGE_TIMEOUT=3 sage -t --warn-long 0 --random-seed=0 src/sage/doctest/tests/99seconds.rst 
Running doctests with ID 2021-03-08-14-48-11-b862a4f7.
Git branch: u/embray/gappy-without-wrappers
Using --optional=build,debian,dochtml,memlimit,pip,rubiks,sage,sage_spkg
Doctesting 1 file.
sage -t --warn-long 0.0 --random-seed=0 src/sage/doctest/tests/99seconds.rst
    Timed out (and interrupt failed)
**********************************************************************
Tests run before process (pid=7821) timed out:
sage: import time ## line 3 ##
sage: time.sleep(99) ## line 4 ##
------------------------------------------------------------------------
/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x6a6b)[0x7f4ccad87a6b]
/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x6c48)[0x7f4ccad87c48]
/home/embray/src/sagemath/sage/local/lib/python3.6/site-packages/cysignals/signals.cpython-36m-x86_64-linux-gnu.so(+0x90fa)[0x7f4ccad8a0fa]
<long stacktrace>
------------------------------------------------------------------------
Attaching gdb to process id 7821.

**********************************************************************
----------------------------------------------------------------------
sage -t --warn-long 0.0 --random-seed=0 src/sage/doctest/tests/99seconds.rst  # Timed out (and interrupt failed)
----------------------------------------------------------------------
Total time for all tests: 63.0 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```



---

archive/issue_comments_414590.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI think I might know the reason in my case.  The doctest runner gives test processes `timeout * 0.05` to die after they are sent a `SIGQUIT` due to timeout.  After this \"die timeout\" they are killed with `SIGKILL`.  This is the case in which the doctest reporter reports \"Timed out (and interrupt failed)\" as opposed to just \"Timed out\" (the message is a bit deceptive since the \"interrupt\" in question is a `SIGQUIT`).\n\nThe `sigdie()` in cysignals, in response to the `SIGQUT` is calling `print_enhanced_backtrace()` which fires up the cysignals-CSI machinery and starts up gdb.  Normally this is happening within the \"die timeout\" limit, but since I was working on #30945 I have some plugins loaded for gdb which are making it take longer to start up, resulting in the process not dying fast enough.\n\nI'm going to try running this test with `CYSIGNALS_CRASH_NDEBUG=1` and see if that makes a difference.",
    "created_at": "2021-03-08T14:21:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414590",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

I think I might know the reason in my case.  The doctest runner gives test processes `timeout * 0.05` to die after they are sent a `SIGQUIT` due to timeout.  After this "die timeout" they are killed with `SIGKILL`.  This is the case in which the doctest reporter reports "Timed out (and interrupt failed)" as opposed to just "Timed out" (the message is a bit deceptive since the "interrupt" in question is a `SIGQUIT`).

The `sigdie()` in cysignals, in response to the `SIGQUT` is calling `print_enhanced_backtrace()` which fires up the cysignals-CSI machinery and starts up gdb.  Normally this is happening within the "die timeout" limit, but since I was working on #30945 I have some plugins loaded for gdb which are making it take longer to start up, resulting in the process not dying fast enough.

I'm going to try running this test with `CYSIGNALS_CRASH_NDEBUG=1` and see if that makes a difference.



---

archive/issue_comments_414591.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI'll note that in the original ticket report it shows that gdb is not installed at all in that case.  But it's still conceivable that, especially on a system under load, just trying to start the cysignals-CSI script creates enough overhead that the process doesn't quit quickly enough.",
    "created_at": "2021-03-08T14:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414591",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

I'll note that in the original ticket report it shows that gdb is not installed at all in that case.  But it's still conceivable that, especially on a system under load, just trying to start the cysignals-CSI script creates enough overhead that the process doesn't quit quickly enough.



---

archive/issue_events_366756.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2021-03-08T16:31:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366756"
}
```



---

archive/issue_comments_414592.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThis should fix it in most cases.  It's not a silver bullet, but it should greatly reduce the likelihood of this (already rare) test failure.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18\"><code>ca5257a</code></a></td><td><code>Trac #26912: Improve the likelihood of these tests passing.</code></td></tr></table>\n",
    "created_at": "2021-03-08T16:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414592",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

This should fix it in most cases.  It's not a silver bullet, but it should greatly reduce the likelihood of this (already rare) test failure.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18"><code>ca5257a</code></a></td><td><code>Trac #26912: Improve the likelihood of these tests passing.</code></td></tr></table>




---

archive/issue_comments_414593.json:
```json
{
    "body": "Branch: **[u/embray/ticket-26912](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-26912)**",
    "created_at": "2021-03-08T16:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414593",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/ticket-26912](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-26912)**



---

archive/issue_events_366757.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2021-03-08T16:31:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366757"
}
```



---

archive/issue_comments_414594.json:
```json
{
    "body": "Commit: **[`ca5257a`](https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18)**",
    "created_at": "2021-03-08T16:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414594",
    "user": "https://github.com/embray"
}
```

Commit: **[`ca5257a`](https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18)**



---

archive/issue_comments_414595.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2021-03-08T16:31:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414595",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_events_366758.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-03-15T13:14:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366758"
}
```



---

archive/issue_events_366759.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-03-15T13:14:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366759"
}
```



---

archive/issue_comments_414596.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nok, let's do that",
    "created_at": "2021-03-15T13:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414596",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:12" align="right">comment:12</div>

ok, let's do that



---

archive/issue_comments_414597.json:
```json
{
    "body": "Reviewer: **Fr\u00e9d\u00e9ric Chapoton**",
    "created_at": "2021-03-15T13:14:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414597",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **Frédéric Chapoton**



---

archive/issue_comments_414598.json:
```json
{
    "body": "Changed branch from **[u/embray/ticket-26912](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-26912)** to **[`ca5257a`](https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18)**",
    "created_at": "2021-03-18T22:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414598",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/ticket-26912](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/ticket-26912)** to **[`ca5257a`](https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18)**



---

archive/issue_events_366760.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-18T22:32:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366760"
}
```



---

archive/issue_events_366761.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "80303834d3f55f8dc88cb11f5dd692df2b6f164c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-03-18T22:32:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26912#event-366761"
}
```



---

archive/issue_comments_414599.json:
```json
{
    "body": "Changed commit from **[`ca5257a`](https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18)** to none",
    "created_at": "2023-01-08T09:54:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26912",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26912#issuecomment-414599",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`ca5257a`](https://github.com/sagemath/sagetrac-mirror/commit/ca5257a5d0f32efc9f8f07e126020856270b1a18)** to none
