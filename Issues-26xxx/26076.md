# Issue 26076: Free nilpotent Lie algebras

archive/issues_025839.json:
```json
{
    "body": "Implement the construction of free nilpotent Lie algebras, i.e. Lie algebras where the only additional relations among the brackets are that iterated brackets longer than the nilpotency step must vanish.\n\nCC:  @tscrim\n\nKeywords: Lie algebras, nilpotent\n\nBranch/Commit: 664fbeceb2594310cb95ffe1df434e41ceb5ebbd\n\nReviewer: Travis Scrimshaw\n\nAuthor: Eero Hakavuori\n\nDependencies: #26074\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26076\n\n",
    "closed_at": "2018-08-26T09:37:40Z",
    "created_at": "2018-08-17T07:00:08Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Free nilpotent Lie algebras",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26076",
    "user": "https://github.com/ehaka"
}
```
Implement the construction of free nilpotent Lie algebras, i.e. Lie algebras where the only additional relations among the brackets are that iterated brackets longer than the nilpotency step must vanish.

CC:  @tscrim

Keywords: Lie algebras, nilpotent

Branch/Commit: 664fbeceb2594310cb95ffe1df434e41ceb5ebbd

Reviewer: Travis Scrimshaw

Author: Eero Hakavuori

Dependencies: #26074

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26076





---

archive/issue_comments_501025.json:
```json
{
    "body": "<a id='comment:1'></a>Some implementation already exists in an external private codebase that I need to clean up and import into Sage.",
    "created_at": "2018-08-17T07:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501025",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:1'></a>Some implementation already exists in an external private codebase that I need to clean up and import into Sage.



---

archive/issue_comments_501026.json:
```json
{
    "body": "Changing commit from \"\" to \"cb8a1030ea0da83777e06bbf8aea9876819b2567\"",
    "created_at": "2018-08-17T11:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501026",
    "user": "https://github.com/ehaka"
}
```

Changing commit from "" to "cb8a1030ea0da83777e06bbf8aea9876819b2567"



---

archive/issue_comments_501027.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-17T11:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501027",
    "user": "https://github.com/ehaka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_501028.json:
```json
{
    "body": "Changing author from \"\" to \"Eero Hakavuori\"",
    "created_at": "2018-08-17T11:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501028",
    "user": "https://github.com/ehaka"
}
```

Changing author from "" to "Eero Hakavuori"



---

archive/issue_comments_501029.json:
```json
{
    "body": "<a id='comment:2'></a>The adapted version of the free nilpotent Lie algebra construction is in the commits. I removed the parameter `free` from the method `sage.algebras.lie_algebras.nilpotent_lie_algebra.NilpotentLieAlgebra` of #26074, as the parameter seemed to be redundant.\n\n---\nNew commits:",
    "created_at": "2018-08-17T11:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501029",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:2'></a>The adapted version of the free nilpotent Lie algebra construction is in the commits. I removed the parameter `free` from the method `sage.algebras.lie_algebras.nilpotent_lie_algebra.NilpotentLieAlgebra` of #26074, as the parameter seemed to be redundant.

---
New commits:



---

archive/issue_comments_501030.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-ehaka/free_nilpotent_lie_algebras-26076\"",
    "created_at": "2018-08-17T11:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501030",
    "user": "https://github.com/ehaka"
}
```

Changing branch from "" to "u/gh-ehaka/free_nilpotent_lie_algebras-26076"



---

archive/issue_comments_501031.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-08-21T17:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501031",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_501032.json:
```json
{
    "body": "Changing commit from \"cb8a1030ea0da83777e06bbf8aea9876819b2567\" to \"31fa53ab88a2d593f4fa2992f04d12e6f71f9930\"",
    "created_at": "2018-08-21T17:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501032",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cb8a1030ea0da83777e06bbf8aea9876819b2567" to "31fa53ab88a2d593f4fa2992f04d12e6f71f9930"



---

archive/issue_comments_501033.json:
```json
{
    "body": "Changing commit from \"31fa53ab88a2d593f4fa2992f04d12e6f71f9930\" to \"b7c8a2a95b985b716a440bbdc89342528b5817ba\"",
    "created_at": "2018-08-22T05:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501033",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "31fa53ab88a2d593f4fa2992f04d12e6f71f9930" to "b7c8a2a95b985b716a440bbdc89342528b5817ba"



---

archive/issue_comments_501034.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-22T05:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_501035.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-22T05:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_501036.json:
```json
{
    "body": "Changing commit from \"b7c8a2a95b985b716a440bbdc89342528b5817ba\" to \"09b54f536e775b1f7c6b267ac25a77fbbdd52c99\"",
    "created_at": "2018-08-22T05:51:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501036",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b7c8a2a95b985b716a440bbdc89342528b5817ba" to "09b54f536e775b1f7c6b267ac25a77fbbdd52c99"



---

archive/issue_comments_501037.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-22T05:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_501038.json:
```json
{
    "body": "Changing commit from \"09b54f536e775b1f7c6b267ac25a77fbbdd52c99\" to \"b70bebd70696d8d22a58b422f90c701cb459f2db\"",
    "created_at": "2018-08-22T05:54:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "09b54f536e775b1f7c6b267ac25a77fbbdd52c99" to "b70bebd70696d8d22a58b422f90c701cb459f2db"



---

archive/issue_comments_501039.json:
```json
{
    "body": "Changing commit from \"b70bebd70696d8d22a58b422f90c701cb459f2db\" to \"a60ef683b3747b7d129b14b6834d0f329820a4fa\"",
    "created_at": "2018-08-23T01:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501039",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "b70bebd70696d8d22a58b422f90c701cb459f2db" to "a60ef683b3747b7d129b14b6834d0f329820a4fa"



---

archive/issue_comments_501040.json:
```json
{
    "body": "Changing branch from \"u/gh-ehaka/free_nilpotent_lie_algebras-26076\" to \"public/lie_algebras/free_nilpotent-26076\"",
    "created_at": "2018-08-23T01:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501040",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/gh-ehaka/free_nilpotent_lie_algebras-26076" to "public/lie_algebras/free_nilpotent-26076"



---

archive/issue_comments_501041.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-08-23T01:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501041",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_501042.json:
```json
{
    "body": "<a id='comment:7'></a>I have made some documentation tweaks and a little better normalization and testing of the input. I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory):\n\n```\n%sage: %time L = LieAlgebra(QQ, 3, step=3)\nCPU times: user 48 ms, sys: 4 ms, total: 52 ms\nWall time: 50.3 ms\nsage: %time L = LieAlgebra(QQ, 5, step=3)\nCPU times: user 16 ms, sys: 0 ns, total: 16 ms\nWall time: 12.7 ms\nsage: %time L = LieAlgebra(QQ, 5, step=4)\nCPU times: user 92 ms, sys: 0 ns, total: 92 ms\nWall time: 88.3 ms\nsage: %time L = LieAlgebra(QQ, 5, step=5)\nCPU times: user 1.45 s, sys: 28 ms, total: 1.48 s\nWall time: 1.47 s\nsage: %time L = LieAlgebra(QQ, 6, step=3)\nCPU times: user 16 ms, sys: 8 ms, total: 24 ms\nWall time: 21 ms\nsage: %time L = LieAlgebra(QQ, 6, step=4)\nCPU times: user 368 ms, sys: 36 ms, total: 404 ms\nWall time: 356 ms\nsage: %time L = LieAlgebra(QQ, 6, step=5)\nCPU times: user 8.83 s, sys: 148 ms, total: 8.98 s\nWall time: 8.97 s\n```\nvs prev\n\n```\nsage: %time L = LieAlgebra(QQ, 3, step=3)\nCPU times: user 44 ms, sys: 8 ms, total: 52 ms\nWall time: 49.3 ms\nsage: %time L = LieAlgebra(QQ, 5, step=3)\nCPU times: user 12 ms, sys: 4 ms, total: 16 ms\nWall time: 15.5 ms\nsage: %time L = LieAlgebra(QQ, 5, step=4)\nCPU times: user 144 ms, sys: 12 ms, total: 156 ms\nWall time: 142 ms\nsage: %time L = LieAlgebra(QQ, 5, step=5)\nCPU times: user 2.29 s, sys: 24 ms, total: 2.32 s\nWall time: 2.31 s\nsage: %time L = LieAlgebra(QQ, 6, step=3)\nCPU times: user 24 ms, sys: 0 ns, total: 24 ms\nWall time: 25.2 ms\nsage: %time L = LieAlgebra(QQ, 6, step=4)\nCPU times: user 536 ms, sys: 28 ms, total: 564 ms\nWall time: 533 ms\nsage: %time L = LieAlgebra(QQ, 6, step=5)\nCPU times: user 13.7 s, sys: 204 ms, total: 13.9 s\nWall time: 13.9 s\n```\n\nIf my changes are good, then positive review.\n\n---\nNew commits:",
    "created_at": "2018-08-23T01:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501042",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>I have made some documentation tweaks and a little better normalization and testing of the input. I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory):

```
%sage: %time L = LieAlgebra(QQ, 3, step=3)
CPU times: user 48 ms, sys: 4 ms, total: 52 ms
Wall time: 50.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=3)
CPU times: user 16 ms, sys: 0 ns, total: 16 ms
Wall time: 12.7 ms
sage: %time L = LieAlgebra(QQ, 5, step=4)
CPU times: user 92 ms, sys: 0 ns, total: 92 ms
Wall time: 88.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=5)
CPU times: user 1.45 s, sys: 28 ms, total: 1.48 s
Wall time: 1.47 s
sage: %time L = LieAlgebra(QQ, 6, step=3)
CPU times: user 16 ms, sys: 8 ms, total: 24 ms
Wall time: 21 ms
sage: %time L = LieAlgebra(QQ, 6, step=4)
CPU times: user 368 ms, sys: 36 ms, total: 404 ms
Wall time: 356 ms
sage: %time L = LieAlgebra(QQ, 6, step=5)
CPU times: user 8.83 s, sys: 148 ms, total: 8.98 s
Wall time: 8.97 s
```
vs prev

```
sage: %time L = LieAlgebra(QQ, 3, step=3)
CPU times: user 44 ms, sys: 8 ms, total: 52 ms
Wall time: 49.3 ms
sage: %time L = LieAlgebra(QQ, 5, step=3)
CPU times: user 12 ms, sys: 4 ms, total: 16 ms
Wall time: 15.5 ms
sage: %time L = LieAlgebra(QQ, 5, step=4)
CPU times: user 144 ms, sys: 12 ms, total: 156 ms
Wall time: 142 ms
sage: %time L = LieAlgebra(QQ, 5, step=5)
CPU times: user 2.29 s, sys: 24 ms, total: 2.32 s
Wall time: 2.31 s
sage: %time L = LieAlgebra(QQ, 6, step=3)
CPU times: user 24 ms, sys: 0 ns, total: 24 ms
Wall time: 25.2 ms
sage: %time L = LieAlgebra(QQ, 6, step=4)
CPU times: user 536 ms, sys: 28 ms, total: 564 ms
Wall time: 533 ms
sage: %time L = LieAlgebra(QQ, 6, step=5)
CPU times: user 13.7 s, sys: 204 ms, total: 13.9 s
Wall time: 13.9 s
```

If my changes are good, then positive review.

---
New commits:



---

archive/issue_comments_501043.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-23T01:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501043",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_501044.json:
```json
{
    "body": "Changing commit from \"a60ef683b3747b7d129b14b6834d0f329820a4fa\" to \"664fbeceb2594310cb95ffe1df434e41ceb5ebbd\"",
    "created_at": "2018-08-23T01:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501044",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a60ef683b3747b7d129b14b6834d0f329820a4fa" to "664fbeceb2594310cb95ffe1df434e41ceb5ebbd"



---

archive/issue_comments_501045.json:
```json
{
    "body": "<a id='comment:10'></a>I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.",
    "created_at": "2018-08-23T01:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501045",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.



---

archive/issue_comments_501046.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:7 tscrim]:\n> I have made some documentation tweaks and a little better normalization and testing of the input.\n\n\nAll good changes.\n\n> I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory)\n\n\nA ~30% speedup in the expensive cases, very impressive!\n\n\nReplying to [comment:10 tscrim]:\n> I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.\n\n\nI left the cutoff at 11 because I figured technically a zero does not cause ambiguity since it must always be attached to a 10. For aesthetic and convenience the cutoff at 10 is much better though.\n\nThe changes all look very good to me, thanks for the improvements!",
    "created_at": "2018-08-23T06:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501046",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:11'></a>Replying to [comment:7 tscrim]:
> I have made some documentation tweaks and a little better normalization and testing of the input.


All good changes.

> I have also obtained a speedup of the creation of the free nilpotent lie algebra (although it costs a big more in terms of memory usage by having to hold 2 copies of all of the Lyndon word tuples in memory)


A ~30% speedup in the expensive cases, very impressive!


Replying to [comment:10 tscrim]:
> I also changed the `r = 10` case to not be accepted for the index naming because you are using 1-based indices.


I left the cutoff at 11 because I figured technically a zero does not cause ambiguity since it must always be attached to a 10. For aesthetic and convenience the cutoff at 10 is much better though.

The changes all look very good to me, thanks for the improvements!



---

archive/issue_comments_501047.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-23T06:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501047",
    "user": "https://github.com/ehaka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_065092.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-26T09:37:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26076#event-65092"
}
```



---

archive/issue_comments_501048.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-26T09:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501048",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_501049.json:
```json
{
    "body": "Changing branch from \"public/lie_algebras/free_nilpotent-26076\" to \"664fbeceb2594310cb95ffe1df434e41ceb5ebbd\"",
    "created_at": "2018-08-26T09:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26076",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26076#issuecomment-501049",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/lie_algebras/free_nilpotent-26076" to "664fbeceb2594310cb95ffe1df434e41ceb5ebbd"
