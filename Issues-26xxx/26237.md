# Issue 26237: Speed up IntegerMatrix

archive/issues_026000.json:
```json
{
    "body": "We explicitly declare things to be `int` type so Cython can generate better C code.\n\n**CC:**  Stefan Rudi yomcat msaaltink\n\n**Branch/Commit:** [3c0195bc7302b36431d1c4715582fd33ed5cc0c0](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)\n\n**Reviewer:** Daniel Krenn, Jeroen Demeyer, Stefan Van Zwam, Rudi Pendavingh\n\n**Author:** Travis Scrimshaw\n\nIssue created by migration from https://trac.sagemath.org/ticket/26237\n\n",
    "closed_at": "2019-03-29T12:36:45Z",
    "created_at": "2018-09-11T05:26:13Z",
    "labels": [
        "component: matroid theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "title": "Speed up IntegerMatrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/26237",
    "user": "https://github.com/tscrim"
}
```
We explicitly declare things to be `int` type so Cython can generate better C code.

**CC:**  Stefan Rudi yomcat msaaltink

**Branch/Commit:** [3c0195bc7302b36431d1c4715582fd33ed5cc0c0](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)

**Reviewer:** Daniel Krenn, Jeroen Demeyer, Stefan Van Zwam, Rudi Pendavingh

**Author:** Travis Scrimshaw

Issue created by migration from https://trac.sagemath.org/ticket/26237





---

archive/issue_comments_406991.json:
```json
{
    "body": "<a id='comment:1'></a>\nWorks for me:\n\n```\nsage: from sage.matroids.linear_matroid import LinearMatroid\nsage: from sage.matroids.lean_matrix import IntegerMatrix\nsage: M = LinearMatroid(matrix=IntegerMatrix(4,3,matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]])))\nsage: M.circuits()\nIterator over a system of subsets\n```",
    "created_at": "2018-09-11T05:41:55Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406991",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:1'></a>
Works for me:

```
sage: from sage.matroids.linear_matroid import LinearMatroid
sage: from sage.matroids.lean_matrix import IntegerMatrix
sage: M = LinearMatroid(matrix=IntegerMatrix(4,3,matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]])))
sage: M.circuits()
Iterator over a system of subsets
```



---

archive/issue_comments_406992.json:
```json
{
    "body": "<a id='comment:2'></a>\nHmm...strange. Let me try from a fresh session to see if I somehow unintentionally corrupted things.",
    "created_at": "2018-09-11T05:45:53Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406992",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
Hmm...strange. Let me try from a fresh session to see if I somehow unintentionally corrupted things.



---

archive/issue_comments_406993.json:
```json
{
    "body": "<a id='comment:3'></a>\nOkay, I had one little seemingly innocuous change: I added an explicit return type `int` on the corresponding `get` method of `IntegerMatrix`. Once I removed that, it worked.",
    "created_at": "2018-09-11T05:54:06Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406993",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
Okay, I had one little seemingly innocuous change: I added an explicit return type `int` on the corresponding `get` method of `IntegerMatrix`. Once I removed that, it worked.



---

archive/issue_comments_406994.json:
```json
{
    "body": "<a id='comment:4'></a>\nSo what was going wrong is that there is a `bint is_nonzero` method which simply was `return self.get(r, c)`, and Cython could somehow not automatically convert that to a boolean check. Would that count as a Cython bug?\n\nIf it is not, I might also recycle this ticket with some Cython tweaks to `IntegerMatrix` to try and squeeze a bit more speed out of it.",
    "created_at": "2018-09-11T05:57:07Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406994",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
So what was going wrong is that there is a `bint is_nonzero` method which simply was `return self.get(r, c)`, and Cython could somehow not automatically convert that to a boolean check. Would that count as a Cython bug?

If it is not, I might also recycle this ticket with some Cython tweaks to `IntegerMatrix` to try and squeeze a bit more speed out of it.



---

archive/issue_comments_406995.json:
```json
{
    "body": "<a id='comment:5'></a>\nWell, there is a bug somewhere (on vanilla 8.4.beta4):\n\n```\nsage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\nsage: list(M.bases())\n[frozenset({0, 1, 2}), frozenset({0, 2, 3})]\n\nsage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\nsage: list(Mp.bases())\n[frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]\n```",
    "created_at": "2018-09-11T06:09:04Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406995",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
Well, there is a bug somewhere (on vanilla 8.4.beta4):

```
sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
sage: list(M.bases())
[frozenset({0, 1, 2}), frozenset({0, 2, 3})]

sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
sage: list(Mp.bases())
[frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]
```



---

archive/issue_comments_406996.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@tscrim](#comment%3A4):\n> So what was going wrong is that there is a `bint is_nonzero` method which simply was `return self.get(r, c)`, and Cython could somehow not automatically convert that to a boolean check.\n\nI'm not following here... what do you mean with \"Cython could somehow not automatically convert that to a boolean check\"?",
    "created_at": "2018-09-11T07:33:29Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406996",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [@tscrim](#comment%3A4):
> So what was going wrong is that there is a `bint is_nonzero` method which simply was `return self.get(r, c)`, and Cython could somehow not automatically convert that to a boolean check.

I'm not following here... what do you mean with "Cython could somehow not automatically convert that to a boolean check"?



---

archive/issue_comments_406997.json:
```json
{
    "body": "<a id='comment:7'></a>\nYes, that is correct (well, an `int` to a `bint` to be specific).",
    "created_at": "2018-09-11T07:46:42Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406997",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Yes, that is correct (well, an `int` to a `bint` to be specific).



---

archive/issue_comments_406998.json:
```json
{
    "body": "<a id='comment:8'></a>\nAt least, once I changed that to an explicit check != 0, it fixed the problem.",
    "created_at": "2018-09-11T07:47:17Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406998",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
At least, once I changed that to an explicit check != 0, it fixed the problem.



---

archive/issue_comments_406999.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [@tscrim](#comment%3A5):\n> Well, there is a bug somewhere (on vanilla 8.4.beta4):\n> \n> ```\n> sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\n> sage: list(M.bases())\n> [frozenset({0, 1, 2}), frozenset({0, 2, 3})]\n> \n> sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\n> sage: list(Mp.bases())\n> [frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]\n> ```\n\nMost (all?) LinearMatroid methods assume that we are allowed to pivot in the matrix, and do so without leaving the ring. Maybe that's what went wrong?",
    "created_at": "2018-09-11T07:49:08Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-406999",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:9'></a>
Replying to [@tscrim](#comment%3A5):
> Well, there is a bug somewhere (on vanilla 8.4.beta4):
> 
> ```
> sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
> sage: list(M.bases())
> [frozenset({0, 1, 2}), frozenset({0, 2, 3})]
> 
> sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
> sage: list(Mp.bases())
> [frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]
> ```

Most (all?) LinearMatroid methods assume that we are allowed to pivot in the matrix, and do so without leaving the ring. Maybe that's what went wrong?



---

archive/issue_comments_407000.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [@tscrim](#comment%3A8):\n> At least, once I changed that to an explicit check != 0, it fixed the problem.\n\nIt's still not clear which check you mean and what the problem really is...",
    "created_at": "2018-09-11T09:02:56Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407000",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [@tscrim](#comment%3A8):
> At least, once I changed that to an explicit check != 0, it fixed the problem.

It's still not clear which check you mean and what the problem really is...



---

archive/issue_comments_407001.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe method GenericMatrix.is_nonzero seems to be called only by LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row().\n\nLeanMatrix.pivot() does not even use is_nonzero(), but \u2018s=self.get_unsafe(i,y)\u2019 followed by \u2018if s and ..\u2019 (line 303 of lean_matrix.pyx). Apparently the conversion to a bool implicit in \u2018if s\u2019 does work in that context. It may be more effcient too, since depending on the base ring evaluating s!=0 may involve casting 0 as a ring element. I\u2019m quite sure that for finite fields \u2018if s\u2019 is about 5 times faster than \u2018if (s!=0)\u2019.\n\nSo it may also be a solution to rewrite LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row() in the more efficient way used in pivot(), completely avoiding the use of is_nonzero().",
    "created_at": "2018-09-11T09:31:06Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407001",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

<a id='comment:11'></a>
The method GenericMatrix.is_nonzero seems to be called only by LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row().

LeanMatrix.pivot() does not even use is_nonzero(), but ‘s=self.get_unsafe(i,y)’ followed by ‘if s and ..’ (line 303 of lean_matrix.pyx). Apparently the conversion to a bool implicit in ‘if s’ does work in that context. It may be more effcient too, since depending on the base ring evaluating s!=0 may involve casting 0 as a ring element. I’m quite sure that for finite fields ‘if s’ is about 5 times faster than ‘if (s!=0)’.

So it may also be a solution to rewrite LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row() in the more efficient way used in pivot(), completely avoiding the use of is_nonzero().



---

archive/issue_comments_407002.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@jdemeyer](#comment%3A10):\n> Replying to [@tscrim](#comment%3A8):\n> > At least, once I changed that to an explicit check != 0, it fixed the problem.\n\n> \n> It's still not clear which check you mean and what the problem really is...\n\nSorry, I was trying to answer quickly while I was out.\n\nSo when I explicitly tell Cython that `get` should return an `int`, then I have to do this change\n\n```diff\n     cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation\n-        return self.get(r, c)\n+        return self.get(r, c) != 0\n```\notherwise I get the original error message in the ticket description.",
    "created_at": "2018-09-11T22:42:31Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407002",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
Replying to [@jdemeyer](#comment%3A10):
> Replying to [@tscrim](#comment%3A8):
> > At least, once I changed that to an explicit check != 0, it fixed the problem.

> 
> It's still not clear which check you mean and what the problem really is...

Sorry, I was trying to answer quickly while I was out.

So when I explicitly tell Cython that `get` should return an `int`, then I have to do this change

```diff
     cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation
-        return self.get(r, c)
+        return self.get(r, c) != 0
```
otherwise I get the original error message in the ticket description.



---

archive/issue_comments_407003.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [Stefan](#comment%3A9):\n> Replying to [@tscrim](#comment%3A5):\n> > Well, there is a bug somewhere (on vanilla 8.4.beta4):\n> > \n> > ```\n> > sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\n> > sage: list(M.bases())\n> > [frozenset({0, 1, 2}), frozenset({0, 2, 3})]\n> > \n> > sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\n> > sage: list(Mp.bases())\n> > [frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]\n> > ```\n\n> \n> Most (all?) LinearMatroid methods assume that we are allowed to pivot in the matrix, and do so without leaving the ring. Maybe that's what went wrong?\n\nBut in the latter case, the matrix is over `ZZ`, so I would not think that is the problem.",
    "created_at": "2018-09-11T22:43:53Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407003",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Replying to [Stefan](#comment%3A9):
> Replying to [@tscrim](#comment%3A5):
> > Well, there is a bug somewhere (on vanilla 8.4.beta4):
> > 
> > ```
> > sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
> > sage: list(M.bases())
> > [frozenset({0, 1, 2}), frozenset({0, 2, 3})]
> > 
> > sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
> > sage: list(Mp.bases())
> > [frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]
> > ```

> 
> Most (all?) LinearMatroid methods assume that we are allowed to pivot in the matrix, and do so without leaving the ring. Maybe that's what went wrong?

But in the latter case, the matrix is over `ZZ`, so I would not think that is the problem.



---

archive/issue_comments_407004.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [Rudi](#comment%3A11):\n> The method GenericMatrix.is_nonzero seems to be called only by LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row().\n> \n> LeanMatrix.pivot() does not even use is_nonzero(), but \u2018s=self.get_unsafe(i,y)\u2019 followed by \u2018if s and ..\u2019 (line 303 of lean_matrix.pyx). Apparently the conversion to a bool implicit in \u2018if s\u2019 does work in that context. It may be more effcient too, since depending on the base ring evaluating s!=0 may involve casting 0 as a ring element. I\u2019m quite sure that for finite fields \u2018if s\u2019 is about 5 times faster than \u2018if (s!=0)\u2019.\n\nYes, as you surmised, the `s != 0` is slower because invokes the coercion framework. So `if s` is the best thing to do for speed in general. It is just in this case that Cython does not seem to be converting an `int` (from an `inline` function) into a `bint`.\n\n> So it may also be a solution to rewrite LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row() in the more efficient way used in pivot(), completely avoiding the use of is_nonzero().\n\nWhat I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.\n\n```diff\ndiff --git a/src/sage/matroids/lean_matrix.pxd b/src/sage/matroids/lean_matrix.pxd\nindex c284f6a..122dab1 100644\n--- a/src/sage/matroids/lean_matrix.pxd\n+++ b/src/sage/matroids/lean_matrix.pxd\n@@ -102,7 +102,7 @@ cdef class QuaternaryMatrix(LeanMatrix):\n cdef class IntegerMatrix(LeanMatrix):\n     cdef int* _entries\n \n-    cdef inline get(self, long r, long c)   # Not a Sage matrix operation\n+    cdef inline int get(self, long r, long c)   # Not a Sage matrix operation\n     cdef inline void set(self, long r, long c, int x)   # Not a Sage matrix operation\n \n     cdef inline long row_len(self, long i) except -1   # Not a Sage matrix operation\ndiff --git a/src/sage/matroids/lean_matrix.pyx b/src/sage/matroids/lean_matrix.pyx\nindex 93a32bc..d6022c2 100644\n--- a/src/sage/matroids/lean_matrix.pyx\n+++ b/src/sage/matroids/lean_matrix.pyx\n@@ -2844,7 +2844,7 @@ cdef class IntegerMatrix(LeanMatrix):\n         \"\"\"\n         return \"IntegerMatrix instance with \" + str(self._nrows) + \" rows and \" + str(self._ncols) + \" columns\"\n \n-    cdef inline get(self, long r, long c):   # Not a Sage matrix operation\n+    cdef inline int get(self, long r, long c):   # Not a Sage matrix operation\n         return self._entries[r * self._ncols + c]\n \n     cdef inline void set(self, long r, long c, int x):   # Not a Sage matrix operation\n@@ -2877,7 +2877,7 @@ cdef class IntegerMatrix(LeanMatrix):\n         return 0\n \n     cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation\n-        return self.get(r, c)\n+        return self.get(r, c) != 0\n \n     cdef LeanMatrix copy(self):   # Deprecated Sage matrix operation\n         cdef IntegerMatrix M = IntegerMatrix(self._nrows, self._ncols)\n@@ -2982,12 +2982,14 @@ cdef class IntegerMatrix(LeanMatrix):\n         ignored.\n         \"\"\"\n         cdef long i\n+        cdef int sval\n         if s is None:\n             for i from 0 <= i < self._ncols:\n                 self.set(x, i, self.get(x, i) + self.get(y, i))\n         else:\n+            sval = int(s)\n             for i from 0 <= i < self._ncols:\n-                self.set(x, i, self.get(x, i) + s * self.get(y, i))\n+                self.set(x, i, self.get(x, i) + sval * self.get(y, i))\n         return 0\n \n     cdef int swap_rows_c(self, long x, long y) except -1:\n@@ -3010,8 +3012,9 @@ cdef class IntegerMatrix(LeanMatrix):\n         compatibility, and is ignored.\n         \"\"\"\n         cdef long i\n+        cdef int sval = int(s)\n         for i from 0 <= i < self._ncols:\n-            self.set(x, i, s * self.get(x, i))\n+            self.set(x, i, sval * self.get(x, i))\n         return 0\n \n     cdef int rescale_column_c(self, long y, s, bint start_row) except -1:\n@@ -3020,8 +3023,9 @@ cdef class IntegerMatrix(LeanMatrix):\n         compatibility, and is ignored.\n         \"\"\"\n         cdef long j\n+        cdef int sval = int(s)\n         for j from 0 <= j < self._nrows:\n-            self.set(j, y, self.get(j, y) * s)\n+            self.set(j, y, self.get(j, y) * sval)\n         return 0\n \n     cdef int pivot(self, long x, long y) except -1:   # Not a Sage matrix operation\n```",
    "created_at": "2018-09-11T22:53:49Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407004",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Replying to [Rudi](#comment%3A11):
> The method GenericMatrix.is_nonzero seems to be called only by LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row().
> 
> LeanMatrix.pivot() does not even use is_nonzero(), but ‘s=self.get_unsafe(i,y)’ followed by ‘if s and ..’ (line 303 of lean_matrix.pyx). Apparently the conversion to a bool implicit in ‘if s’ does work in that context. It may be more effcient too, since depending on the base ring evaluating s!=0 may involve casting 0 as a ring element. I’m quite sure that for finite fields ‘if s’ is about 5 times faster than ‘if (s!=0)’.

Yes, as you surmised, the `s != 0` is slower because invokes the coercion framework. So `if s` is the best thing to do for speed in general. It is just in this case that Cython does not seem to be converting an `int` (from an `inline` function) into a `bint`.

> So it may also be a solution to rewrite LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row() in the more efficient way used in pivot(), completely avoiding the use of is_nonzero().

What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.

```diff
diff --git a/src/sage/matroids/lean_matrix.pxd b/src/sage/matroids/lean_matrix.pxd
index c284f6a..122dab1 100644
--- a/src/sage/matroids/lean_matrix.pxd
+++ b/src/sage/matroids/lean_matrix.pxd
@@ -102,7 +102,7 @@ cdef class QuaternaryMatrix(LeanMatrix):
 cdef class IntegerMatrix(LeanMatrix):
     cdef int* _entries
 
-    cdef inline get(self, long r, long c)   # Not a Sage matrix operation
+    cdef inline int get(self, long r, long c)   # Not a Sage matrix operation
     cdef inline void set(self, long r, long c, int x)   # Not a Sage matrix operation
 
     cdef inline long row_len(self, long i) except -1   # Not a Sage matrix operation
diff --git a/src/sage/matroids/lean_matrix.pyx b/src/sage/matroids/lean_matrix.pyx
index 93a32bc..d6022c2 100644
--- a/src/sage/matroids/lean_matrix.pyx
+++ b/src/sage/matroids/lean_matrix.pyx
@@ -2844,7 +2844,7 @@ cdef class IntegerMatrix(LeanMatrix):
         """
         return "IntegerMatrix instance with " + str(self._nrows) + " rows and " + str(self._ncols) + " columns"
 
-    cdef inline get(self, long r, long c):   # Not a Sage matrix operation
+    cdef inline int get(self, long r, long c):   # Not a Sage matrix operation
         return self._entries[r * self._ncols + c]
 
     cdef inline void set(self, long r, long c, int x):   # Not a Sage matrix operation
@@ -2877,7 +2877,7 @@ cdef class IntegerMatrix(LeanMatrix):
         return 0
 
     cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation
-        return self.get(r, c)
+        return self.get(r, c) != 0
 
     cdef LeanMatrix copy(self):   # Deprecated Sage matrix operation
         cdef IntegerMatrix M = IntegerMatrix(self._nrows, self._ncols)
@@ -2982,12 +2982,14 @@ cdef class IntegerMatrix(LeanMatrix):
         ignored.
         """
         cdef long i
+        cdef int sval
         if s is None:
             for i from 0 <= i < self._ncols:
                 self.set(x, i, self.get(x, i) + self.get(y, i))
         else:
+            sval = int(s)
             for i from 0 <= i < self._ncols:
-                self.set(x, i, self.get(x, i) + s * self.get(y, i))
+                self.set(x, i, self.get(x, i) + sval * self.get(y, i))
         return 0
 
     cdef int swap_rows_c(self, long x, long y) except -1:
@@ -3010,8 +3012,9 @@ cdef class IntegerMatrix(LeanMatrix):
         compatibility, and is ignored.
         """
         cdef long i
+        cdef int sval = int(s)
         for i from 0 <= i < self._ncols:
-            self.set(x, i, s * self.get(x, i))
+            self.set(x, i, sval * self.get(x, i))
         return 0
 
     cdef int rescale_column_c(self, long y, s, bint start_row) except -1:
@@ -3020,8 +3023,9 @@ cdef class IntegerMatrix(LeanMatrix):
         compatibility, and is ignored.
         """
         cdef long j
+        cdef int sval = int(s)
         for j from 0 <= j < self._nrows:
-            self.set(j, y, self.get(j, y) * s)
+            self.set(j, y, self.get(j, y) * sval)
         return 0
 
     cdef int pivot(self, long x, long y) except -1:   # Not a Sage matrix operation
```



---

archive/issue_comments_407005.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@tscrim](#comment%3A14):\n> Replying to [Rudi](#comment%3A11):\n> What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.\n\nThat looks like a good solution. Great! \n\nCould `GenericMatrix` perhaps also benefit from such explicit casting?  Anything that improves the efficiency of row operations should have an immediate effect on overall efficiency of linear matroid code.",
    "created_at": "2018-09-12T07:55:35Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407005",
    "user": "https://trac.sagemath.org/admin/accounts/users/Rudi"
}
```

<a id='comment:15'></a>
Replying to [@tscrim](#comment%3A14):
> Replying to [Rudi](#comment%3A11):
> What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.

That looks like a good solution. Great! 

Could `GenericMatrix` perhaps also benefit from such explicit casting?  Anything that improves the efficiency of row operations should have an immediate effect on overall efficiency of linear matroid code.



---

archive/issue_comments_407006.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [Rudi](#comment%3A15):\n> Replying to [@tscrim](#comment%3A14):\n> > Replying to [Rudi](#comment%3A11):\n> > What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.\n\n> \n> That looks like a good solution. Great! \n> \n> Could `GenericMatrix` perhaps also benefit from such explicit casting?  Anything that improves the efficiency of row operations should have an immediate effect on overall efficiency of linear matroid code. \n\nYou cannot explicitly cast to something you don't know. Plus the arithmetic operations being done for `IntegerMatrix` are explicitly as C integers and not going through Python (much less Sage) at all. So I don't see how.",
    "created_at": "2018-09-12T08:01:35Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407006",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Replying to [Rudi](#comment%3A15):
> Replying to [@tscrim](#comment%3A14):
> > Replying to [Rudi](#comment%3A11):
> > What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.

> 
> That looks like a good solution. Great! 
> 
> Could `GenericMatrix` perhaps also benefit from such explicit casting?  Anything that improves the efficiency of row operations should have an immediate effect on overall efficiency of linear matroid code. 

You cannot explicitly cast to something you don't know. Plus the arithmetic operations being done for `IntegerMatrix` are explicitly as C integers and not going through Python (much less Sage) at all. So I don't see how.



---

archive/issue_comments_407007.json:
```json
{
    "body": "<a id='comment:17'></a>\nI guess something you could do is also special case `QQ` and go directly with the C data using the `mpq` commands. It looks like the `GF(2)` and `GF(3)` matrices are already quite specialized. At least I would think that is the next most common field to work over (other than maybe `GF(4)`).",
    "created_at": "2018-09-12T08:07:28Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407007",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
I guess something you could do is also special case `QQ` and go directly with the C data using the `mpq` commands. It looks like the `GF(2)` and `GF(3)` matrices are already quite specialized. At least I would think that is the next most common field to work over (other than maybe `GF(4)`).



---

archive/issue_comments_407008.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [@tscrim](#comment%3A12):\n> So when I explicitly tell Cython that `get` should return an `int`\n\nFirst of all, that's a bad idea: a C int has limited range (typically 32 bits) and you cannot guarantee that all entries fit in that.\n\n> then I have to do this change\n> \n> ```diff\n>      cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation\n> -        return self.get(r, c)\n> +        return self.get(r, c) != 0\n> ```\n> otherwise I get the original error message in the ticket description.\n\nI don't consider that a bug. The reason is that the conversion of a Python object to a `bint` essentially translates to `int(bool(obj))` while the conversion to an `int` translates to `int(obj)`. These are obviously different. But once on the C level, the types `int` and `bint` are exactly the same, so no conversion is done when casting `int` to `bint`.",
    "created_at": "2018-09-12T08:15:02Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407008",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>
Replying to [@tscrim](#comment%3A12):
> So when I explicitly tell Cython that `get` should return an `int`

First of all, that's a bad idea: a C int has limited range (typically 32 bits) and you cannot guarantee that all entries fit in that.

> then I have to do this change
> 
> ```diff
>      cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation
> -        return self.get(r, c)
> +        return self.get(r, c) != 0
> ```
> otherwise I get the original error message in the ticket description.

I don't consider that a bug. The reason is that the conversion of a Python object to a `bint` essentially translates to `int(bool(obj))` while the conversion to an `int` translates to `int(obj)`. These are obviously different. But once on the C level, the types `int` and `bint` are exactly the same, so no conversion is done when casting `int` to `bint`.



---

archive/issue_comments_407009.json:
```json
{
    "body": "<a id='comment:19'></a>\nSo the solution for really converting an `int` to a `bint` in Cython is indeed adding an explicit `!= 0`.",
    "created_at": "2018-09-12T08:19:52Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407009",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'></a>
So the solution for really converting an `int` to a `bint` in Cython is indeed adding an explicit `!= 0`.



---

archive/issue_comments_407010.json:
```json
{
    "body": "<a id='comment:20'></a>\nShould I close this ticket or do you want to recycle it?",
    "created_at": "2018-09-12T08:23:29Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407010",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Should I close this ticket or do you want to recycle it?



---

archive/issue_comments_407011.json:
```json
{
    "body": "<a id='comment:21'></a>\nI will recycle this, at least for the speedups to `IntegerMatrix`, but maybe with some more tweaks or improvements or an implementation of a `RationalMatrix`.\n\nHowever, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?\n\nI am guessing instead of `int`, you would say we should have them all be `Py_ssize_t`?",
    "created_at": "2018-09-12T13:05:37Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407011",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
I will recycle this, at least for the speedups to `IntegerMatrix`, but maybe with some more tweaks or improvements or an implementation of a `RationalMatrix`.

However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?

I am guessing instead of `int`, you would say we should have them all be `Py_ssize_t`?



---

archive/issue_comments_407012.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,29 +1 @@\n-I am trying to compute things with some linear matroids whose representation matrices have integer values. Because the generic code is too slow, I wanted to use the more specialized code directly:\n \n-```\n-sage: from sage.matroids.linear_matroid import LinearMatroid\n-sage: from sage.matroids.lean_matrix import IntegerMatrix\n-sage: M = LinearMatroid(matrix=IntegerMatrix(4,3,matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]])))\n-sage: M.circuits()\n----------------------------------------------------------------------------\n-SystemError                               Traceback (most recent call last)\n-<ipython-input-42-8adfde621a57> in <module>()\n-----> 1 M.circuits()\n-\n-SystemError: error return without exception set\n-```\n-However, this works if I use `GenericMatrix`.\n-\n-This also occurs by doing things directly in the global namespace:\n-\n-```\n-sage: M = Matroid(matrix=matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]]), regular=True)\n-sage: M.circuits()\n----------------------------------------------------------------------------\n-SystemError                               Traceback (most recent call last)\n-<ipython-input-47-8adfde621a57> in <module>()\n-----> 1 M.circuits()\n-\n-SystemError: error return without exception set\n-```\n-There is definitely a bug at least somewhere.\n``````\n",
    "created_at": "2018-09-12T13:31:14Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407012",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,29 +1 @@
-I am trying to compute things with some linear matroids whose representation matrices have integer values. Because the generic code is too slow, I wanted to use the more specialized code directly:
 
-```
-sage: from sage.matroids.linear_matroid import LinearMatroid
-sage: from sage.matroids.lean_matrix import IntegerMatrix
-sage: M = LinearMatroid(matrix=IntegerMatrix(4,3,matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]])))
-sage: M.circuits()
----------------------------------------------------------------------------
-SystemError                               Traceback (most recent call last)
-<ipython-input-42-8adfde621a57> in <module>()
-----> 1 M.circuits()
-
-SystemError: error return without exception set
-```
-However, this works if I use `GenericMatrix`.
-
-This also occurs by doing things directly in the global namespace:
-
-```
-sage: M = Matroid(matrix=matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]]), regular=True)
-sage: M.circuits()
----------------------------------------------------------------------------
-SystemError                               Traceback (most recent call last)
-<ipython-input-47-8adfde621a57> in <module>()
-----> 1 M.circuits()
-
-SystemError: error return without exception set
-```
-There is definitely a bug at least somewhere.
``````




---

archive/issue_events_232298.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-09-12T13:31:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "rename": {
        "from": "SystemError with LinearMatroid with an IntegerMatrix",
        "to": "Speed up IntegerMatrix"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-232298"
}
```



---

archive/issue_comments_407013.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [@tscrim](#comment%3A21):\n> However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?\n\nSuppose that an entry in the matrix equals the Python integer -2. Currently (without applying any changes): when calling `is_nonzero()` on that -2, the return value is `int(bool(-2)) = 1`. With your changes, the return value for the same `is_nonzero()` call is just `-2`. The Cython wrapper interprets this `-2` as an exception return value (that is what `except -2` does). But there hasn't been an exception raised, which gives the `SystemError`.",
    "created_at": "2018-09-12T13:38:08Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407013",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:23'></a>
Replying to [@tscrim](#comment%3A21):
> However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?

Suppose that an entry in the matrix equals the Python integer -2. Currently (without applying any changes): when calling `is_nonzero()` on that -2, the return value is `int(bool(-2)) = 1`. With your changes, the return value for the same `is_nonzero()` call is just `-2`. The Cython wrapper interprets this `-2` as an exception return value (that is what `except -2` does). But there hasn't been an exception raised, which gives the `SystemError`.



---

archive/issue_comments_407014.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [@tscrim](#comment%3A21):\n> I am guessing instead of `int`, you would say we should have them all be `Py_ssize_t`?\n\nI just looked at the Cython sources for `lean_matrix.pyx` and `IntegerMatrix` does indeed use `int` internally. Therefore, returning `int` in `get()` is correct in that sense.\n\nHowever... this just shows that using `IntegerMatrix` in general looks dangerous: operations can overflow. This is actually documented in the docstring of `IntegerMatrix`:\n\n```\n        This class is mainly intended for use with the RegularMatroid class,\n        so entries are assumed to be small integers. No\n        overflow checking takes place!\n```",
    "created_at": "2018-09-12T13:50:04Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407014",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>
Replying to [@tscrim](#comment%3A21):
> I am guessing instead of `int`, you would say we should have them all be `Py_ssize_t`?

I just looked at the Cython sources for `lean_matrix.pyx` and `IntegerMatrix` does indeed use `int` internally. Therefore, returning `int` in `get()` is correct in that sense.

However... this just shows that using `IntegerMatrix` in general looks dangerous: operations can overflow. This is actually documented in the docstring of `IntegerMatrix`:

```
        This class is mainly intended for use with the RegularMatroid class,
        so entries are assumed to be small integers. No
        overflow checking takes place!
```



---

archive/issue_comments_407015.json:
```json
{
    "body": "<a id='comment:25'></a>\nThing is, the LeanMatrix classes are internal datatypes. Regular matroids have matrices with entries equal to -1, 0, 1, and are such that pivoting preserves that property. For a potentially regular matroid on which you want to run is_valid(), we check this condition through pivoting, which means we get to a \"bad subdeterminant\" of size at most 2x2, hardly enough to cause overflows if the entries are 0,1, or -1.\n\nWe took some effort to keep the LeanMatrix away from the end user (LinearMatroid.Representation returns a Sage matrix, for instance, and the datatypes don't get imported into the Sage namespace). Speed is of the essence here, since we create and destroy tons of these (Sage matrices have a lot of overhead at creation time), and we do tons of row operations on them. If you dig deep enough to use IntegerMatrix at this spot in the code, you'll have some idea of what you're getting yourself into.\n\nAgain, since you want to use IntegerMatrix in the LinearMatroid subclasses, and since you need a matrix where pivoting is safe, really the only use case is Regular Matroids where overflows are never an issue.",
    "created_at": "2018-09-12T21:40:44Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407015",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:25'></a>
Thing is, the LeanMatrix classes are internal datatypes. Regular matroids have matrices with entries equal to -1, 0, 1, and are such that pivoting preserves that property. For a potentially regular matroid on which you want to run is_valid(), we check this condition through pivoting, which means we get to a "bad subdeterminant" of size at most 2x2, hardly enough to cause overflows if the entries are 0,1, or -1.

We took some effort to keep the LeanMatrix away from the end user (LinearMatroid.Representation returns a Sage matrix, for instance, and the datatypes don't get imported into the Sage namespace). Speed is of the essence here, since we create and destroy tons of these (Sage matrices have a lot of overhead at creation time), and we do tons of row operations on them. If you dig deep enough to use IntegerMatrix at this spot in the code, you'll have some idea of what you're getting yourself into.

Again, since you want to use IntegerMatrix in the LinearMatroid subclasses, and since you need a matrix where pivoting is safe, really the only use case is Regular Matroids where overflows are never an issue.



---

archive/issue_comments_407016.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [@jdemeyer](#comment%3A23):\n> Replying to [@tscrim](#comment%3A21):\n> > However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?\n\n> \n> Suppose that an entry in the matrix equals the Python integer -2. Currently (without applying any changes): when calling `is_nonzero()` on that -2, the return value is `int(bool(-2)) = 1`. With your changes, the return value for the same `is_nonzero()` call is just `-2`. The Cython wrapper interprets this `-2` as an exception return value (that is what `except -2` does). But there hasn't been an exception raised, which gives the `SystemError`.\n\nAh, I see. Thank you for the explanation. I fully agree that it is not a bug.",
    "created_at": "2018-09-13T01:15:36Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407016",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>
Replying to [@jdemeyer](#comment%3A23):
> Replying to [@tscrim](#comment%3A21):
> > However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?

> 
> Suppose that an entry in the matrix equals the Python integer -2. Currently (without applying any changes): when calling `is_nonzero()` on that -2, the return value is `int(bool(-2)) = 1`. With your changes, the return value for the same `is_nonzero()` call is just `-2`. The Cython wrapper interprets this `-2` as an exception return value (that is what `except -2` does). But there hasn't been an exception raised, which gives the `SystemError`.

Ah, I see. Thank you for the explanation. I fully agree that it is not a bug.



---

archive/issue_comments_407017.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [Stefan](#comment%3A25):\n> Thing is, the LeanMatrix classes are internal datatypes. Regular matroids have matrices with entries equal to -1, 0, 1, and are such that pivoting preserves that property. For a potentially regular matroid on which you want to run is_valid(), we check this condition through pivoting, which means we get to a \"bad subdeterminant\" of size at most 2x2, hardly enough to cause overflows if the entries are 0,1, or -1.\n\nI see. `IntegerMatrix` is a misnomer because it requires entries to be `+-1` or `0`, which is also undocumented. In fact, in the `.. NOTE::`, it says this works for `LinearMatroid`, but that is not quite the case. Thank you for the explanation.\n\nNow I understand why it is working for the generic matrix over `ZZ`: it is secretly converting things to `QQ` when doing the matrix operations. My computation was not working using `IntegerMatrix` because of the assumption of `+-1` for the nonzero entries.\n\nI think this needs to be documented at the very least (which I will do here). I might also like to change the name of `IntegerMatrix` to perhaps `UnitIntegerMatrix` or `PlusMinusOneMatrix`. Thoughts?\n\n> Again, since you want to use IntegerMatrix in the LinearMatroid subclasses, and since you need a matrix where pivoting is safe, really the only use case is Regular Matroids where overflows are never an issue.\n\nSo it seems like I should write a version of `LeanMatrix` that directly uses `mpq`. I will start to work on that.",
    "created_at": "2018-09-13T01:33:02Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407017",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>
Replying to [Stefan](#comment%3A25):
> Thing is, the LeanMatrix classes are internal datatypes. Regular matroids have matrices with entries equal to -1, 0, 1, and are such that pivoting preserves that property. For a potentially regular matroid on which you want to run is_valid(), we check this condition through pivoting, which means we get to a "bad subdeterminant" of size at most 2x2, hardly enough to cause overflows if the entries are 0,1, or -1.

I see. `IntegerMatrix` is a misnomer because it requires entries to be `+-1` or `0`, which is also undocumented. In fact, in the `.. NOTE::`, it says this works for `LinearMatroid`, but that is not quite the case. Thank you for the explanation.

Now I understand why it is working for the generic matrix over `ZZ`: it is secretly converting things to `QQ` when doing the matrix operations. My computation was not working using `IntegerMatrix` because of the assumption of `+-1` for the nonzero entries.

I think this needs to be documented at the very least (which I will do here). I might also like to change the name of `IntegerMatrix` to perhaps `UnitIntegerMatrix` or `PlusMinusOneMatrix`. Thoughts?

> Again, since you want to use IntegerMatrix in the LinearMatroid subclasses, and since you need a matrix where pivoting is safe, really the only use case is Regular Matroids where overflows are never an issue.

So it seems like I should write a version of `LeanMatrix` that directly uses `mpq`. I will start to work on that.



---

archive/issue_comments_407018.json:
```json
{
    "body": "<a id='comment:28'></a>\nAlso: if the entries are really only 0, 1 or -1 then using an `int` to store the entries wastes memory. You could use `int8_t` (8 bits) instead of `int` (typically 32 bits). I'll leave it to you to decide whether it would be worth to change that.",
    "created_at": "2018-09-13T05:41:06Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407018",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Also: if the entries are really only 0, 1 or -1 then using an `int` to store the entries wastes memory. You could use `int8_t` (8 bits) instead of `int` (typically 32 bits). I'll leave it to you to decide whether it would be worth to change that.



---

archive/issue_comments_407019.json:
```json
{
    "body": "**Author:** Travis Scrimshaw",
    "created_at": "2018-09-13T05:46:04Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407019",
    "user": "https://github.com/tscrim"
}
```

**Author:** Travis Scrimshaw



---

archive/issue_comments_407020.json:
```json
{
    "body": "**Branch:** [public/matroids/speedup_integer_matrix-26237](https://github.com/sagemath/sagetrac-mirror/tree/public/matroids/speedup_integer_matrix-26237)",
    "created_at": "2018-09-13T05:46:04Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407020",
    "user": "https://github.com/tscrim"
}
```

**Branch:** [public/matroids/speedup_integer_matrix-26237](https://github.com/sagemath/sagetrac-mirror/tree/public/matroids/speedup_integer_matrix-26237)



---

archive/issue_comments_407021.json:
```json
{
    "body": "<a id='comment:30'></a>\nI will leave it to Rudi or Stefan to decide for that.\n\nSo I have gotten a somewhat working `RationalMatrix` version working, but I am having a bit of an issue with getting things to work like I expected. In Cython, are things pass-by-reference or pass-by-copy (like C)? In particular, I wanted to have an inlined `get` that returned the correct `mpq_t` entry, and I want to pass some of those around (and sometimes assign them to local variables). However, this does not seem to work. Does that mean I have to handle them always as pointers when I want to pass them around?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d3105e0b02a9c138514641af07d103f97d34519\">0d3105e</a></td><td><code>Explicit casts to int for IntegerMatrix.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/101663decdb23e66f3b8cc8d594890121dc9c7e2\">101663d</a></td><td><code>Documenting IntegerMatrix only should have +-1 or 0 entries.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44538fa571fa4ebc649b2729cbdbc117f1cf57c4\">44538fa</a></td><td><code>Adding RationalMatrix that directly manipulates an mpq_t array.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a\">31a87a3</a></td><td><code>Removing get in place of index and some bug fixes.</code></td></tr></table>\n",
    "created_at": "2018-09-13T05:46:04Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407021",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>
I will leave it to Rudi or Stefan to decide for that.

So I have gotten a somewhat working `RationalMatrix` version working, but I am having a bit of an issue with getting things to work like I expected. In Cython, are things pass-by-reference or pass-by-copy (like C)? In particular, I wanted to have an inlined `get` that returned the correct `mpq_t` entry, and I want to pass some of those around (and sometimes assign them to local variables). However, this does not seem to work. Does that mean I have to handle them always as pointers when I want to pass them around?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d3105e0b02a9c138514641af07d103f97d34519">0d3105e</a></td><td><code>Explicit casts to int for IntegerMatrix.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/101663decdb23e66f3b8cc8d594890121dc9c7e2">101663d</a></td><td><code>Documenting IntegerMatrix only should have +-1 or 0 entries.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44538fa571fa4ebc649b2729cbdbc117f1cf57c4">44538fa</a></td><td><code>Adding RationalMatrix that directly manipulates an mpq_t array.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a">31a87a3</a></td><td><code>Removing get in place of index and some bug fixes.</code></td></tr></table>




---

archive/issue_comments_407022.json:
```json
{
    "body": "**Commit:** [31a87a3194b9c77febb961c4821d1873a4b01b2a](https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a)",
    "created_at": "2018-09-13T05:46:04Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407022",
    "user": "https://github.com/tscrim"
}
```

**Commit:** [31a87a3194b9c77febb961c4821d1873a4b01b2a](https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a)



---

archive/issue_comments_407023.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplace\n\n```\ncdef int sval = int(s)\n```\nby\n\n```\ncdef int sval = s\n```\n\nThe `int()` is superfluous and will only slow things down. Cython already implicitly converts when you assign to a C `int`.",
    "created_at": "2018-09-13T05:53:44Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407023",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Replace

```
cdef int sval = int(s)
```
by

```
cdef int sval = s
```

The `int()` is superfluous and will only slow things down. Cython already implicitly converts when you assign to a C `int`.



---

archive/issue_comments_407024.json:
```json
{
    "body": "**Changing commit** from \"[31a87a3194b9c77febb961c4821d1873a4b01b2a](https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a)\" to \"[7effef06c3c1f821c1bfa3316d55e88c0026333a](https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a)\".",
    "created_at": "2018-09-13T05:55:16Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407024",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[31a87a3194b9c77febb961c4821d1873a4b01b2a](https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a)" to "[7effef06c3c1f821c1bfa3316d55e88c0026333a](https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a)".



---

archive/issue_comments_407025.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a\">7effef0</a></td><td><code>Removing superfluous int's.</code></td></tr></table>\n",
    "created_at": "2018-09-13T05:55:16Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407025",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a">7effef0</a></td><td><code>Removing superfluous int's.</code></td></tr></table>




---

archive/issue_comments_407026.json:
```json
{
    "body": "<a id='comment:33'></a>\nDone. I didn't know that. Thanks.",
    "created_at": "2018-09-13T05:55:33Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407026",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'></a>
Done. I didn't know that. Thanks.



---

archive/issue_comments_407027.json:
```json
{
    "body": "<a id='comment:34'></a>\nYou will see that no function ever returns an `mpq_t` (or `mpz_t` or whatever). The typical calling convention is passing a return argument, for example the declaration of `mpq_add`:\n\n```\nvoid mpq_add(mpq_t sum, mpq_t addend1, mpq_t addend2)\n```",
    "created_at": "2018-09-13T05:56:12Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407027",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'></a>
You will see that no function ever returns an `mpq_t` (or `mpz_t` or whatever). The typical calling convention is passing a return argument, for example the declaration of `mpq_add`:

```
void mpq_add(mpq_t sum, mpq_t addend1, mpq_t addend2)
```



---

archive/issue_comments_407028.json:
```json
{
    "body": "<a id='comment:35'></a>\nYea, I noticed that and so I scrapped the `get` in place of the `index` for better maintainability should the internal ordering change. However, I do have some functions where I am passing an `mpq_t`, e.g., in `pivot`, and this is not working as I would expect. Also, I had tried to do something like\n\n```\ncdef mpq_t s = self._entries[self.index(i,j)]\nmpq_add(s, s, t)\n```\nwhere `t` is some other `mpq_t`, but that wasn't working like I expected either.",
    "created_at": "2018-09-13T06:00:13Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407028",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>
Yea, I noticed that and so I scrapped the `get` in place of the `index` for better maintainability should the internal ordering change. However, I do have some functions where I am passing an `mpq_t`, e.g., in `pivot`, and this is not working as I would expect. Also, I had tried to do something like

```
cdef mpq_t s = self._entries[self.index(i,j)]
mpq_add(s, s, t)
```
where `t` is some other `mpq_t`, but that wasn't working like I expected either.



---

archive/issue_comments_407029.json:
```json
{
    "body": "<a id='comment:36'></a>\nCan you move \"Implement `RationalMatrix`\" to a new ticket instead?\n\nThe commits that you added here to improve `IntegerMatrix` make sense independently.",
    "created_at": "2018-09-13T07:54:01Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407029",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:36'></a>
Can you move "Implement `RationalMatrix`" to a new ticket instead?

The commits that you added here to improve `IntegerMatrix` make sense independently.



---

archive/issue_comments_407030.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [@tscrim](#comment%3A27):\n> I think this needs to be documented at the very least (which I will do here). I might also like to change the name of `IntegerMatrix` to perhaps `UnitIntegerMatrix` or `PlusMinusOneMatrix`. Thoughts?\n\n+1 to `PlusMinusOneMatrix`.",
    "created_at": "2018-09-13T07:55:41Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407030",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
Replying to [@tscrim](#comment%3A27):
> I think this needs to be documented at the very least (which I will do here). I might also like to change the name of `IntegerMatrix` to perhaps `UnitIntegerMatrix` or `PlusMinusOneMatrix`. Thoughts?

+1 to `PlusMinusOneMatrix`.



---

archive/issue_comments_407031.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [@jdemeyer](#comment%3A36):\n> Can you move \"Implement `RationalMatrix`\" to a new ticket instead?\n> \n> The commits that you added here to improve `IntegerMatrix` make sense independently.\n\nYep, I can do that. I will do that when I get into my office tomorrow.",
    "created_at": "2018-09-13T07:57:44Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407031",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>
Replying to [@jdemeyer](#comment%3A36):
> Can you move "Implement `RationalMatrix`" to a new ticket instead?
> 
> The commits that you added here to improve `IntegerMatrix` make sense independently.

Yep, I can do that. I will do that when I get into my office tomorrow.



---

archive/issue_comments_407032.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+We explicitly declare things to be `int` type so Cython can generate better C code.\n``````\n",
    "created_at": "2018-09-13T10:39:33Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407032",
    "user": "https://github.com/tscrim"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+We explicitly declare things to be `int` type so Cython can generate better C code.
``````




---

archive/issue_comments_407033.json:
```json
{
    "body": "<a id='comment:39'></a>\n#26269 for the `RationalMatrix` implementation.",
    "created_at": "2018-09-13T10:39:33Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407033",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:39'></a>
#26269 for the `RationalMatrix` implementation.



---

archive/issue_comments_407034.json:
```json
{
    "body": "**Changing commit** from \"[7effef06c3c1f821c1bfa3316d55e88c0026333a](https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a)\" to \"[fb64e43cd4e5eaa28b3156b39c7cb42909ac0075](https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075)\".",
    "created_at": "2018-09-14T01:07:27Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7effef06c3c1f821c1bfa3316d55e88c0026333a](https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a)" to "[fb64e43cd4e5eaa28b3156b39c7cb42909ac0075](https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075)".



---

archive/issue_comments_407035.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075\">fb64e43</a></td><td><code>Removing superfluous int's.</code></td></tr></table>\n",
    "created_at": "2018-09-14T01:07:27Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407035",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075">fb64e43</a></td><td><code>Removing superfluous int's.</code></td></tr></table>




---

archive/issue_events_232299.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-14T01:10:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-232299"
}
```



---

archive/issue_comments_407036.json:
```json
{
    "body": "<a id='comment:41'></a>\nI've split the ticket into the two parts. This part is now ready for review.",
    "created_at": "2018-09-14T01:10:51Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407036",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:41'></a>
I've split the ticket into the two parts. This part is now ready for review.



---

archive/issue_comments_407037.json:
```json
{
    "body": "<a id='comment:42'></a>\n(Essentially) Green patchbot.",
    "created_at": "2018-09-14T05:02:32Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407037",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:42'></a>
(Essentially) Green patchbot.



---

archive/issue_comments_407038.json:
```json
{
    "body": "<a id='comment:43'></a>\nSo how about renaming to `PlusMinusOneMatrix`? I'd like the opinion of Stefan on that.",
    "created_at": "2018-09-14T07:49:20Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407038",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:43'></a>
So how about renaming to `PlusMinusOneMatrix`? I'd like the opinion of Stefan on that.



---

archive/issue_comments_407039.json:
```json
{
    "body": "<a id='comment:44'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0\">3c0195b</a></td><td><code>Renaming IntegerMatrix to PlusMinusOneMatrix.</code></td></tr></table>\n",
    "created_at": "2018-09-16T22:47:44Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407039",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0">3c0195b</a></td><td><code>Renaming IntegerMatrix to PlusMinusOneMatrix.</code></td></tr></table>




---

archive/issue_comments_407040.json:
```json
{
    "body": "**Changing commit** from \"[fb64e43cd4e5eaa28b3156b39c7cb42909ac0075](https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075)\" to \"[3c0195bc7302b36431d1c4715582fd33ed5cc0c0](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)\".",
    "created_at": "2018-09-16T22:47:44Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407040",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fb64e43cd4e5eaa28b3156b39c7cb42909ac0075](https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075)" to "[3c0195bc7302b36431d1c4715582fd33ed5cc0c0](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)".



---

archive/issue_comments_407041.json:
```json
{
    "body": "<a id='comment:45'></a>\nI did the refactoring. Stefan, Rudi, any objections?",
    "created_at": "2018-09-16T22:48:21Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407041",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:45'></a>
I did the refactoring. Stefan, Rudi, any objections?



---

archive/issue_comments_407042.json:
```json
{
    "body": "<a id='comment:46'></a>\nI am happy with the new name. Don\u2019t have time for a long review.",
    "created_at": "2018-09-17T05:28:34Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407042",
    "user": "https://trac.sagemath.org/admin/accounts/users/Stefan"
}
```

<a id='comment:46'></a>
I am happy with the new name. Don’t have time for a long review.



---

archive/issue_comments_407043.json:
```json
{
    "body": "<a id='comment:47'></a>\nI've looked through the code and I am happy with it, so LGTM.\n\nHowever contributed to this ticket (mainly review), please insert your name in the reviewer field.",
    "created_at": "2019-03-27T14:03:46Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407043",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:47'></a>
I've looked through the code and I am happy with it, so LGTM.

However contributed to this ticket (mainly review), please insert your name in the reviewer field.



---

archive/issue_comments_407044.json:
```json
{
    "body": "**Reviewer:** Daniel Krenn",
    "created_at": "2019-03-27T14:03:46Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407044",
    "user": "https://github.com/dkrenn"
}
```

**Reviewer:** Daniel Krenn



---

archive/issue_events_232300.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-03-27T14:03:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-232300"
}
```



---

archive/issue_events_232301.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-03-27T14:03:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-232301"
}
```



---

archive/issue_comments_407045.json:
```json
{
    "body": "<a id='comment:48'></a>\nStefan, Rudi I added you as reviewers based on our conversions above. Jeroen is obviously a reviewer for looking at the Cython code (as well as his additional useful insights).",
    "created_at": "2019-03-27T22:08:16Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407045",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:48'></a>
Stefan, Rudi I added you as reviewers based on our conversions above. Jeroen is obviously a reviewer for looking at the Cython code (as well as his additional useful insights).



---

archive/issue_events_232302.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-27T22:08:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-232302"
}
```



---

archive/issue_events_232303.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-27T22:08:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-232303"
}
```



---

archive/issue_comments_407046.json:
```json
{
    "body": "**Changing reviewer** from \"Daniel Krenn\" to \"Daniel Krenn, Jeroen Demeyer, Stefan Van Zwam, Rudi Pendavingh\".",
    "created_at": "2019-03-27T22:08:16Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407046",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Daniel Krenn" to "Daniel Krenn, Jeroen Demeyer, Stefan Van Zwam, Rudi Pendavingh".



---

archive/issue_events_232304.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-29T12:36:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-232304"
}
```



---

archive/issue_events_232305.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "88305bb309b3caa85185d0d391cda7a53cf607c3",
    "created_at": "2019-03-29T12:36:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-232305"
}
```



---

archive/issue_comments_407047.json:
```json
{
    "body": "**Changing branch** from \"[public/matroids/speedup_integer_matrix-26237](https://github.com/sagemath/sagetrac-mirror/tree/public/matroids/speedup_integer_matrix-26237)\" to \"[3c0195bc7302b36431d1c4715582fd33ed5cc0c0](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)\".",
    "created_at": "2019-03-29T12:36:45Z",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-407047",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/matroids/speedup_integer_matrix-26237](https://github.com/sagemath/sagetrac-mirror/tree/public/matroids/speedup_integer_matrix-26237)" to "[3c0195bc7302b36431d1c4715582fd33ed5cc0c0](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)".
