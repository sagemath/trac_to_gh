# Issue 26237: Speed up IntegerMatrix

archive/issues_026000.json:
```json
{
    "assignees": [],
    "body": "We explicitly declare things to be `int` type so Cython can generate better C code.\n\nCC:  @sagetrac-Stefan @sagetrac-Rudi @sagetrac-yomcat @sagetrac-msaaltink\n\nBranch/Commit: **[`3c0195b`](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)**\n\nReviewer: **Daniel Krenn, Jeroen Demeyer, Stefan Van Zwam, Rudi Pendavingh**\n\nAuthor: **Travis Scrimshaw**\n\nComponent: **matroid theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26237_\n\n",
    "closed_at": "2019-03-29T12:36:45Z",
    "created_at": "2018-09-11T05:26:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20matroid%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Speed up IntegerMatrix",
    "type": "issue",
    "updated_at": "2019-03-29T12:36:45Z",
    "url": "https://github.com/sagemath/sage/issues/26237",
    "user": "https://github.com/tscrim"
}
```
We explicitly declare things to be `int` type so Cython can generate better C code.

CC:  @sagetrac-Stefan @sagetrac-Rudi @sagetrac-yomcat @sagetrac-msaaltink

Branch/Commit: **[`3c0195b`](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)**

Reviewer: **Daniel Krenn, Jeroen Demeyer, Stefan Van Zwam, Rudi Pendavingh**

Author: **Travis Scrimshaw**

Component: **matroid theory**

_Issue created by migration from https://trac.sagemath.org/ticket/26237_





---

archive/issue_events_361819.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-11T05:26:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361819"
}
```



---

archive/issue_events_361820.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-11T05:26:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20matroid%20theory",
    "label_color": "0000ff",
    "label_name": "c: matroid theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361820"
}
```



---

archive/issue_events_361821.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-11T05:26:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361821"
}
```



---

archive/issue_events_361822.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-11T05:26:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361822"
}
```



---

archive/issue_comments_404425.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWorks for me:\n\n```\nsage: from sage.matroids.linear_matroid import LinearMatroid\nsage: from sage.matroids.lean_matrix import IntegerMatrix\nsage: M = LinearMatroid(matrix=IntegerMatrix(4,3,matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]])))\nsage: M.circuits()\nIterator over a system of subsets\n```",
    "created_at": "2018-09-11T05:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404425",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

Works for me:

```
sage: from sage.matroids.linear_matroid import LinearMatroid
sage: from sage.matroids.lean_matrix import IntegerMatrix
sage: M = LinearMatroid(matrix=IntegerMatrix(4,3,matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]])))
sage: M.circuits()
Iterator over a system of subsets
```



---

archive/issue_comments_404426.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHmm...strange. Let me try from a fresh session to see if I somehow unintentionally corrupted things.",
    "created_at": "2018-09-11T05:45:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404426",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">comment:2</div>

Hmm...strange. Let me try from a fresh session to see if I somehow unintentionally corrupted things.



---

archive/issue_comments_404427.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOkay, I had one little seemingly innocuous change: I added an explicit return type `int` on the corresponding `get` method of `IntegerMatrix`. Once I removed that, it worked.",
    "created_at": "2018-09-11T05:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404427",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

Okay, I had one little seemingly innocuous change: I added an explicit return type `int` on the corresponding `get` method of `IntegerMatrix`. Once I removed that, it worked.



---

archive/issue_comments_404428.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nSo what was going wrong is that there is a `bint is_nonzero` method which simply was `return self.get(r, c)`, and Cython could somehow not automatically convert that to a boolean check. Would that count as a Cython bug?\n\nIf it is not, I might also recycle this ticket with some Cython tweaks to `IntegerMatrix` to try and squeeze a bit more speed out of it.",
    "created_at": "2018-09-11T05:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404428",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:4" align="right">comment:4</div>

So what was going wrong is that there is a `bint is_nonzero` method which simply was `return self.get(r, c)`, and Cython could somehow not automatically convert that to a boolean check. Would that count as a Cython bug?

If it is not, I might also recycle this ticket with some Cython tweaks to `IntegerMatrix` to try and squeeze a bit more speed out of it.



---

archive/issue_comments_404429.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nWell, there is a bug somewhere (on vanilla 8.4.beta4):\n\n```\nsage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\nsage: list(M.bases())\n[frozenset({0, 1, 2}), frozenset({0, 2, 3})]\n\nsage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\nsage: list(Mp.bases())\n[frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]\n```",
    "created_at": "2018-09-11T06:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404429",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

Well, there is a bug somewhere (on vanilla 8.4.beta4):

```
sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
sage: list(M.bases())
[frozenset({0, 1, 2}), frozenset({0, 2, 3})]

sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
sage: list(Mp.bases())
[frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]
```



---

archive/issue_comments_404430.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@tscrim](#comment:4):\n> So what was going wrong is that there is a `bint is_nonzero` method which simply was `return self.get(r, c)`, and Cython could somehow not automatically convert that to a boolean check.\n\nI'm not following here... what do you mean with \"Cython could somehow not automatically convert that to a boolean check\"?",
    "created_at": "2018-09-11T07:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404430",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@tscrim](#comment:4):
> So what was going wrong is that there is a `bint is_nonzero` method which simply was `return self.get(r, c)`, and Cython could somehow not automatically convert that to a boolean check.

I'm not following here... what do you mean with "Cython could somehow not automatically convert that to a boolean check"?



---

archive/issue_comments_404431.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nYes, that is correct (well, an `int` to a `bint` to be specific).",
    "created_at": "2018-09-11T07:46:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404431",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

Yes, that is correct (well, an `int` to a `bint` to be specific).



---

archive/issue_comments_404432.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAt least, once I changed that to an explicit check != 0, it fixed the problem.",
    "created_at": "2018-09-11T07:47:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404432",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

At least, once I changed that to an explicit check != 0, it fixed the problem.



---

archive/issue_comments_404433.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@tscrim](#comment:5):\n> Well, there is a bug somewhere (on vanilla 8.4.beta4):\n> \n> ```\n> sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\n> sage: list(M.bases())\n> [frozenset({0, 1, 2}), frozenset({0, 2, 3})]\n> \n> sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\n> sage: list(Mp.bases())\n> [frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]\n> ```\n\nMost (all?) LinearMatroid methods assume that we are allowed to pivot in the matrix, and do so without leaving the ring. Maybe that's what went wrong?",
    "created_at": "2018-09-11T07:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404433",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@tscrim](#comment:5):
> Well, there is a bug somewhere (on vanilla 8.4.beta4):
> 
> ```
> sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
> sage: list(M.bases())
> [frozenset({0, 1, 2}), frozenset({0, 2, 3})]
> 
> sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
> sage: list(Mp.bases())
> [frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]
> ```

Most (all?) LinearMatroid methods assume that we are allowed to pivot in the matrix, and do so without leaving the ring. Maybe that's what went wrong?



---

archive/issue_comments_404434.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@tscrim](#comment:8):\n> At least, once I changed that to an explicit check != 0, it fixed the problem.\n\nIt's still not clear which check you mean and what the problem really is...",
    "created_at": "2018-09-11T09:02:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404434",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@tscrim](#comment:8):
> At least, once I changed that to an explicit check != 0, it fixed the problem.

It's still not clear which check you mean and what the problem really is...



---

archive/issue_comments_404435.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe method GenericMatrix.is_nonzero seems to be called only by LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row().\n\nLeanMatrix.pivot() does not even use is_nonzero(), but \u2018s=self.get_unsafe(i,y)\u2019 followed by \u2018if s and ..\u2019 (line 303 of lean_matrix.pyx). Apparently the conversion to a bool implicit in \u2018if s\u2019 does work in that context. It may be more effcient too, since depending on the base ring evaluating s!=0 may involve casting 0 as a ring element. I\u2019m quite sure that for finite fields \u2018if s\u2019 is about 5 times faster than \u2018if (s!=0)\u2019.\n\nSo it may also be a solution to rewrite LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row() in the more efficient way used in pivot(), completely avoiding the use of is_nonzero().",
    "created_at": "2018-09-11T09:31:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404435",
    "user": "https://github.com/sagetrac-Rudi"
}
```

<div id="comment:11" align="right">comment:11</div>

The method GenericMatrix.is_nonzero seems to be called only by LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row().

LeanMatrix.pivot() does not even use is_nonzero(), but ‘s=self.get_unsafe(i,y)’ followed by ‘if s and ..’ (line 303 of lean_matrix.pyx). Apparently the conversion to a bool implicit in ‘if s’ does work in that context. It may be more effcient too, since depending on the base ring evaluating s!=0 may involve casting 0 as a ring element. I’m quite sure that for finite fields ‘if s’ is about 5 times faster than ‘if (s!=0)’.

So it may also be a solution to rewrite LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row() in the more efficient way used in pivot(), completely avoiding the use of is_nonzero().



---

archive/issue_comments_404436.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@jdemeyer](#comment:10):\n> Replying to [@tscrim](#comment:8):\n> > At least, once I changed that to an explicit check != 0, it fixed the problem.\n\n> \n> It's still not clear which check you mean and what the problem really is...\n\nSorry, I was trying to answer quickly while I was out.\n\nSo when I explicitly tell Cython that `get` should return an `int`, then I have to do this change\n\n```diff\n     cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation\n-        return self.get(r, c)\n+        return self.get(r, c) != 0\n```\notherwise I get the original error message in the ticket description.",
    "created_at": "2018-09-11T22:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404436",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@jdemeyer](#comment:10):
> Replying to [@tscrim](#comment:8):
> > At least, once I changed that to an explicit check != 0, it fixed the problem.

> 
> It's still not clear which check you mean and what the problem really is...

Sorry, I was trying to answer quickly while I was out.

So when I explicitly tell Cython that `get` should return an `int`, then I have to do this change

```diff
     cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation
-        return self.get(r, c)
+        return self.get(r, c) != 0
```
otherwise I get the original error message in the ticket description.



---

archive/issue_comments_404437.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@sagetrac-Stefan](#comment:9):\n> Replying to [@tscrim](#comment:5):\n> > Well, there is a bug somewhere (on vanilla 8.4.beta4):\n> > \n> > ```\n> > sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\n> > sage: list(M.bases())\n> > [frozenset({0, 1, 2}), frozenset({0, 2, 3})]\n> > \n> > sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))\n> > sage: list(Mp.bases())\n> > [frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]\n> > ```\n\n> \n> Most (all?) LinearMatroid methods assume that we are allowed to pivot in the matrix, and do so without leaving the ring. Maybe that's what went wrong?\n\nBut in the latter case, the matrix is over `ZZ`, so I would not think that is the problem.",
    "created_at": "2018-09-11T22:43:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404437",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@sagetrac-Stefan](#comment:9):
> Replying to [@tscrim](#comment:5):
> > Well, there is a bug somewhere (on vanilla 8.4.beta4):
> > 
> > ```
> > sage: M = LinearMatroid(matrix=IntegerMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
> > sage: list(M.bases())
> > [frozenset({0, 1, 2}), frozenset({0, 2, 3})]
> > 
> > sage: Mp = LinearMatroid(matrix=GenericMatrix(4,4,matrix([[0,0,0,0],[1,1,1,1],[0,1,1,2],[0,0,1,0]])))
> > sage: list(Mp.bases())
> > [frozenset({0, 1, 2}), frozenset({0, 2, 3}), frozenset({1, 2, 3})]
> > ```

> 
> Most (all?) LinearMatroid methods assume that we are allowed to pivot in the matrix, and do so without leaving the ring. Maybe that's what went wrong?

But in the latter case, the matrix is over `ZZ`, so I would not think that is the problem.



---

archive/issue_comments_404438.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@sagetrac-Rudi](#comment:11):\n> The method GenericMatrix.is_nonzero seems to be called only by LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row().\n> \n> LeanMatrix.pivot() does not even use is_nonzero(), but \u2018s=self.get_unsafe(i,y)\u2019 followed by \u2018if s and ..\u2019 (line 303 of lean_matrix.pyx). Apparently the conversion to a bool implicit in \u2018if s\u2019 does work in that context. It may be more effcient too, since depending on the base ring evaluating s!=0 may involve casting 0 as a ring element. I\u2019m quite sure that for finite fields \u2018if s\u2019 is about 5 times faster than \u2018if (s!=0)\u2019.\n\nYes, as you surmised, the `s != 0` is slower because invokes the coercion framework. So `if s` is the best thing to do for speed in general. It is just in this case that Cython does not seem to be converting an `int` (from an `inline` function) into a `bint`.\n\n> So it may also be a solution to rewrite LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row() in the more efficient way used in pivot(), completely avoiding the use of is_nonzero().\n\nWhat I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.\n\n```diff\ndiff --git a/src/sage/matroids/lean_matrix.pxd b/src/sage/matroids/lean_matrix.pxd\nindex c284f6a..122dab1 100644\n--- a/src/sage/matroids/lean_matrix.pxd\n+++ b/src/sage/matroids/lean_matrix.pxd\n@@ -102,7 +102,7 @@ cdef class QuaternaryMatrix(LeanMatrix):\n cdef class IntegerMatrix(LeanMatrix):\n     cdef int* _entries\n \n-    cdef inline get(self, long r, long c)   # Not a Sage matrix operation\n+    cdef inline int get(self, long r, long c)   # Not a Sage matrix operation\n     cdef inline void set(self, long r, long c, int x)   # Not a Sage matrix operation\n \n     cdef inline long row_len(self, long i) except -1   # Not a Sage matrix operation\ndiff --git a/src/sage/matroids/lean_matrix.pyx b/src/sage/matroids/lean_matrix.pyx\nindex 93a32bc..d6022c2 100644\n--- a/src/sage/matroids/lean_matrix.pyx\n+++ b/src/sage/matroids/lean_matrix.pyx\n@@ -2844,7 +2844,7 @@ cdef class IntegerMatrix(LeanMatrix):\n         \"\"\"\n         return \"IntegerMatrix instance with \" + str(self._nrows) + \" rows and \" + str(self._ncols) + \" columns\"\n \n-    cdef inline get(self, long r, long c):   # Not a Sage matrix operation\n+    cdef inline int get(self, long r, long c):   # Not a Sage matrix operation\n         return self._entries[r * self._ncols + c]\n \n     cdef inline void set(self, long r, long c, int x):   # Not a Sage matrix operation\n@@ -2877,7 +2877,7 @@ cdef class IntegerMatrix(LeanMatrix):\n         return 0\n \n     cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation\n-        return self.get(r, c)\n+        return self.get(r, c) != 0\n \n     cdef LeanMatrix copy(self):   # Deprecated Sage matrix operation\n         cdef IntegerMatrix M = IntegerMatrix(self._nrows, self._ncols)\n@@ -2982,12 +2982,14 @@ cdef class IntegerMatrix(LeanMatrix):\n         ignored.\n         \"\"\"\n         cdef long i\n+        cdef int sval\n         if s is None:\n             for i from 0 <= i < self._ncols:\n                 self.set(x, i, self.get(x, i) + self.get(y, i))\n         else:\n+            sval = int(s)\n             for i from 0 <= i < self._ncols:\n-                self.set(x, i, self.get(x, i) + s * self.get(y, i))\n+                self.set(x, i, self.get(x, i) + sval * self.get(y, i))\n         return 0\n \n     cdef int swap_rows_c(self, long x, long y) except -1:\n@@ -3010,8 +3012,9 @@ cdef class IntegerMatrix(LeanMatrix):\n         compatibility, and is ignored.\n         \"\"\"\n         cdef long i\n+        cdef int sval = int(s)\n         for i from 0 <= i < self._ncols:\n-            self.set(x, i, s * self.get(x, i))\n+            self.set(x, i, sval * self.get(x, i))\n         return 0\n \n     cdef int rescale_column_c(self, long y, s, bint start_row) except -1:\n@@ -3020,8 +3023,9 @@ cdef class IntegerMatrix(LeanMatrix):\n         compatibility, and is ignored.\n         \"\"\"\n         cdef long j\n+        cdef int sval = int(s)\n         for j from 0 <= j < self._nrows:\n-            self.set(j, y, self.get(j, y) * s)\n+            self.set(j, y, self.get(j, y) * sval)\n         return 0\n \n     cdef int pivot(self, long x, long y) except -1:   # Not a Sage matrix operation\n```",
    "created_at": "2018-09-11T22:53:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404438",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@sagetrac-Rudi](#comment:11):
> The method GenericMatrix.is_nonzero seems to be called only by LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row().
> 
> LeanMatrix.pivot() does not even use is_nonzero(), but ‘s=self.get_unsafe(i,y)’ followed by ‘if s and ..’ (line 303 of lean_matrix.pyx). Apparently the conversion to a bool implicit in ‘if s’ does work in that context. It may be more effcient too, since depending on the base ring evaluating s!=0 may involve casting 0 as a ring element. I’m quite sure that for finite fields ‘if s’ is about 5 times faster than ‘if (s!=0)’.

Yes, as you surmised, the `s != 0` is slower because invokes the coercion framework. So `if s` is the best thing to do for speed in general. It is just in this case that Cython does not seem to be converting an `int` (from an `inline` function) into a `bint`.

> So it may also be a solution to rewrite LeanMatrix.gauss_jordan_reduce() and LeanMatrix.nonzero_positions_in row() in the more efficient way used in pivot(), completely avoiding the use of is_nonzero().

What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.

```diff
diff --git a/src/sage/matroids/lean_matrix.pxd b/src/sage/matroids/lean_matrix.pxd
index c284f6a..122dab1 100644
--- a/src/sage/matroids/lean_matrix.pxd
+++ b/src/sage/matroids/lean_matrix.pxd
@@ -102,7 +102,7 @@ cdef class QuaternaryMatrix(LeanMatrix):
 cdef class IntegerMatrix(LeanMatrix):
     cdef int* _entries
 
-    cdef inline get(self, long r, long c)   # Not a Sage matrix operation
+    cdef inline int get(self, long r, long c)   # Not a Sage matrix operation
     cdef inline void set(self, long r, long c, int x)   # Not a Sage matrix operation
 
     cdef inline long row_len(self, long i) except -1   # Not a Sage matrix operation
diff --git a/src/sage/matroids/lean_matrix.pyx b/src/sage/matroids/lean_matrix.pyx
index 93a32bc..d6022c2 100644
--- a/src/sage/matroids/lean_matrix.pyx
+++ b/src/sage/matroids/lean_matrix.pyx
@@ -2844,7 +2844,7 @@ cdef class IntegerMatrix(LeanMatrix):
         """
         return "IntegerMatrix instance with " + str(self._nrows) + " rows and " + str(self._ncols) + " columns"
 
-    cdef inline get(self, long r, long c):   # Not a Sage matrix operation
+    cdef inline int get(self, long r, long c):   # Not a Sage matrix operation
         return self._entries[r * self._ncols + c]
 
     cdef inline void set(self, long r, long c, int x):   # Not a Sage matrix operation
@@ -2877,7 +2877,7 @@ cdef class IntegerMatrix(LeanMatrix):
         return 0
 
     cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation
-        return self.get(r, c)
+        return self.get(r, c) != 0
 
     cdef LeanMatrix copy(self):   # Deprecated Sage matrix operation
         cdef IntegerMatrix M = IntegerMatrix(self._nrows, self._ncols)
@@ -2982,12 +2982,14 @@ cdef class IntegerMatrix(LeanMatrix):
         ignored.
         """
         cdef long i
+        cdef int sval
         if s is None:
             for i from 0 <= i < self._ncols:
                 self.set(x, i, self.get(x, i) + self.get(y, i))
         else:
+            sval = int(s)
             for i from 0 <= i < self._ncols:
-                self.set(x, i, self.get(x, i) + s * self.get(y, i))
+                self.set(x, i, self.get(x, i) + sval * self.get(y, i))
         return 0
 
     cdef int swap_rows_c(self, long x, long y) except -1:
@@ -3010,8 +3012,9 @@ cdef class IntegerMatrix(LeanMatrix):
         compatibility, and is ignored.
         """
         cdef long i
+        cdef int sval = int(s)
         for i from 0 <= i < self._ncols:
-            self.set(x, i, s * self.get(x, i))
+            self.set(x, i, sval * self.get(x, i))
         return 0
 
     cdef int rescale_column_c(self, long y, s, bint start_row) except -1:
@@ -3020,8 +3023,9 @@ cdef class IntegerMatrix(LeanMatrix):
         compatibility, and is ignored.
         """
         cdef long j
+        cdef int sval = int(s)
         for j from 0 <= j < self._nrows:
-            self.set(j, y, self.get(j, y) * s)
+            self.set(j, y, self.get(j, y) * sval)
         return 0
 
     cdef int pivot(self, long x, long y) except -1:   # Not a Sage matrix operation
```



---

archive/issue_comments_404439.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@tscrim](#comment:14):\n> Replying to [@sagetrac-Rudi](#comment:11):\n> What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.\n\nThat looks like a good solution. Great! \n\nCould `GenericMatrix` perhaps also benefit from such explicit casting?  Anything that improves the efficiency of row operations should have an immediate effect on overall efficiency of linear matroid code.",
    "created_at": "2018-09-12T07:55:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404439",
    "user": "https://github.com/sagetrac-Rudi"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@tscrim](#comment:14):
> Replying to [@sagetrac-Rudi](#comment:11):
> What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.

That looks like a good solution. Great! 

Could `GenericMatrix` perhaps also benefit from such explicit casting?  Anything that improves the efficiency of row operations should have an immediate effect on overall efficiency of linear matroid code.



---

archive/issue_comments_404440.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@sagetrac-Rudi](#comment:15):\n> Replying to [@tscrim](#comment:14):\n> > Replying to [@sagetrac-Rudi](#comment:11):\n> > What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.\n\n> \n> That looks like a good solution. Great! \n> \n> Could `GenericMatrix` perhaps also benefit from such explicit casting?  Anything that improves the efficiency of row operations should have an immediate effect on overall efficiency of linear matroid code. \n\nYou cannot explicitly cast to something you don't know. Plus the arithmetic operations being done for `IntegerMatrix` are explicitly as C integers and not going through Python (much less Sage) at all. So I don't see how.",
    "created_at": "2018-09-12T08:01:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404440",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@sagetrac-Rudi](#comment:15):
> Replying to [@tscrim](#comment:14):
> > Replying to [@sagetrac-Rudi](#comment:11):
> > What I was hoping to do was take advantage of the known return types in the integer matrix to improve the Cython code. With the explicit casting, my computation goes from 13.6s to 3s.

> 
> That looks like a good solution. Great! 
> 
> Could `GenericMatrix` perhaps also benefit from such explicit casting?  Anything that improves the efficiency of row operations should have an immediate effect on overall efficiency of linear matroid code. 

You cannot explicitly cast to something you don't know. Plus the arithmetic operations being done for `IntegerMatrix` are explicitly as C integers and not going through Python (much less Sage) at all. So I don't see how.



---

archive/issue_comments_404441.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI guess something you could do is also special case `QQ` and go directly with the C data using the `mpq` commands. It looks like the `GF(2)` and `GF(3)` matrices are already quite specialized. At least I would think that is the next most common field to work over (other than maybe `GF(4)`).",
    "created_at": "2018-09-12T08:07:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404441",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

I guess something you could do is also special case `QQ` and go directly with the C data using the `mpq` commands. It looks like the `GF(2)` and `GF(3)` matrices are already quite specialized. At least I would think that is the next most common field to work over (other than maybe `GF(4)`).



---

archive/issue_comments_404442.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@tscrim](#comment:12):\n> So when I explicitly tell Cython that `get` should return an `int`\n\nFirst of all, that's a bad idea: a C int has limited range (typically 32 bits) and you cannot guarantee that all entries fit in that.\n\n> then I have to do this change\n> \n> ```diff\n>      cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation\n> -        return self.get(r, c)\n> +        return self.get(r, c) != 0\n> ```\n> otherwise I get the original error message in the ticket description.\n\nI don't consider that a bug. The reason is that the conversion of a Python object to a `bint` essentially translates to `int(bool(obj))` while the conversion to an `int` translates to `int(obj)`. These are obviously different. But once on the C level, the types `int` and `bint` are exactly the same, so no conversion is done when casting `int` to `bint`.",
    "created_at": "2018-09-12T08:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404442",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@tscrim](#comment:12):
> So when I explicitly tell Cython that `get` should return an `int`

First of all, that's a bad idea: a C int has limited range (typically 32 bits) and you cannot guarantee that all entries fit in that.

> then I have to do this change
> 
> ```diff
>      cdef bint is_nonzero(self, long r, long c) except -2:   # Not a Sage matrix operation
> -        return self.get(r, c)
> +        return self.get(r, c) != 0
> ```
> otherwise I get the original error message in the ticket description.

I don't consider that a bug. The reason is that the conversion of a Python object to a `bint` essentially translates to `int(bool(obj))` while the conversion to an `int` translates to `int(obj)`. These are obviously different. But once on the C level, the types `int` and `bint` are exactly the same, so no conversion is done when casting `int` to `bint`.



---

archive/issue_comments_404443.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nSo the solution for really converting an `int` to a `bint` in Cython is indeed adding an explicit `!= 0`.",
    "created_at": "2018-09-12T08:19:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404443",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

So the solution for really converting an `int` to a `bint` in Cython is indeed adding an explicit `!= 0`.



---

archive/issue_comments_404444.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nShould I close this ticket or do you want to recycle it?",
    "created_at": "2018-09-12T08:23:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404444",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Should I close this ticket or do you want to recycle it?



---

archive/issue_comments_404445.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI will recycle this, at least for the speedups to `IntegerMatrix`, but maybe with some more tweaks or improvements or an implementation of a `RationalMatrix`.\n\nHowever, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?\n\nI am guessing instead of `int`, you would say we should have them all be `Py_ssize_t`?",
    "created_at": "2018-09-12T13:05:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404445",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:21" align="right">comment:21</div>

I will recycle this, at least for the speedups to `IntegerMatrix`, but maybe with some more tweaks or improvements or an implementation of a `RationalMatrix`.

However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?

I am guessing instead of `int`, you would say we should have them all be `Py_ssize_t`?



---

archive/issue_comments_404446.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,29 +1 @@\n-I am trying to compute things with some linear matroids whose representation matrices have integer values. Because the generic code is too slow, I wanted to use the more specialized code directly:\n \n-```\n-sage: from sage.matroids.linear_matroid import LinearMatroid\n-sage: from sage.matroids.lean_matrix import IntegerMatrix\n-sage: M = LinearMatroid(matrix=IntegerMatrix(4,3,matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]])))\n-sage: M.circuits()\n----------------------------------------------------------------------------\n-SystemError                               Traceback (most recent call last)\n-<ipython-input-42-8adfde621a57> in <module>()\n-----> 1 M.circuits()\n-\n-SystemError: error return without exception set\n-```\n-However, this works if I use `GenericMatrix`.\n-\n-This also occurs by doing things directly in the global namespace:\n-\n-```\n-sage: M = Matroid(matrix=matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]]), regular=True)\n-sage: M.circuits()\n----------------------------------------------------------------------------\n-SystemError                               Traceback (most recent call last)\n-<ipython-input-47-8adfde621a57> in <module>()\n-----> 1 M.circuits()\n-\n-SystemError: error return without exception set\n-```\n-There is definitely a bug at least somewhere.\n``````\n",
    "created_at": "2018-09-12T13:31:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404446",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,29 +1 @@
-I am trying to compute things with some linear matroids whose representation matrices have integer values. Because the generic code is too slow, I wanted to use the more specialized code directly:
 
-```
-sage: from sage.matroids.linear_matroid import LinearMatroid
-sage: from sage.matroids.lean_matrix import IntegerMatrix
-sage: M = LinearMatroid(matrix=IntegerMatrix(4,3,matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]])))
-sage: M.circuits()
----------------------------------------------------------------------------
-SystemError                               Traceback (most recent call last)
-<ipython-input-42-8adfde621a57> in <module>()
-----> 1 M.circuits()
-
-SystemError: error return without exception set
-```
-However, this works if I use `GenericMatrix`.
-
-This also occurs by doing things directly in the global namespace:
-
-```
-sage: M = Matroid(matrix=matrix([[0,0,0],[0,0,0],[0,1,1],[1,0,1]]), regular=True)
-sage: M.circuits()
----------------------------------------------------------------------------
-SystemError                               Traceback (most recent call last)
-<ipython-input-47-8adfde621a57> in <module>()
-----> 1 M.circuits()
-
-SystemError: error return without exception set
-```
-There is definitely a bug at least somewhere.
``````




---

archive/issue_events_361823.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-09-12T13:31:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "title_is": "Speed up IntegerMatrix",
    "title_was": "SystemError with LinearMatroid with an IntegerMatrix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361823"
}
```



---

archive/issue_comments_404447.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@tscrim](#comment:21):\n> However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?\n\nSuppose that an entry in the matrix equals the Python integer -2. Currently (without applying any changes): when calling `is_nonzero()` on that -2, the return value is `int(bool(-2)) = 1`. With your changes, the return value for the same `is_nonzero()` call is just `-2`. The Cython wrapper interprets this `-2` as an exception return value (that is what `except -2` does). But there hasn't been an exception raised, which gives the `SystemError`.",
    "created_at": "2018-09-12T13:38:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404447",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@tscrim](#comment:21):
> However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?

Suppose that an entry in the matrix equals the Python integer -2. Currently (without applying any changes): when calling `is_nonzero()` on that -2, the return value is `int(bool(-2)) = 1`. With your changes, the return value for the same `is_nonzero()` call is just `-2`. The Cython wrapper interprets this `-2` as an exception return value (that is what `except -2` does). But there hasn't been an exception raised, which gives the `SystemError`.



---

archive/issue_comments_404448.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@tscrim](#comment:21):\n> I am guessing instead of `int`, you would say we should have them all be `Py_ssize_t`?\n\nI just looked at the Cython sources for `lean_matrix.pyx` and `IntegerMatrix` does indeed use `int` internally. Therefore, returning `int` in `get()` is correct in that sense.\n\nHowever... this just shows that using `IntegerMatrix` in general looks dangerous: operations can overflow. This is actually documented in the docstring of `IntegerMatrix`:\n\n```\n        This class is mainly intended for use with the RegularMatroid class,\n        so entries are assumed to be small integers. No\n        overflow checking takes place!\n```",
    "created_at": "2018-09-12T13:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404448",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@tscrim](#comment:21):
> I am guessing instead of `int`, you would say we should have them all be `Py_ssize_t`?

I just looked at the Cython sources for `lean_matrix.pyx` and `IntegerMatrix` does indeed use `int` internally. Therefore, returning `int` in `get()` is correct in that sense.

However... this just shows that using `IntegerMatrix` in general looks dangerous: operations can overflow. This is actually documented in the docstring of `IntegerMatrix`:

```
        This class is mainly intended for use with the RegularMatroid class,
        so entries are assumed to be small integers. No
        overflow checking takes place!
```



---

archive/issue_comments_404449.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThing is, the LeanMatrix classes are internal datatypes. Regular matroids have matrices with entries equal to -1, 0, 1, and are such that pivoting preserves that property. For a potentially regular matroid on which you want to run is_valid(), we check this condition through pivoting, which means we get to a \"bad subdeterminant\" of size at most 2x2, hardly enough to cause overflows if the entries are 0,1, or -1.\n\nWe took some effort to keep the LeanMatrix away from the end user (LinearMatroid.Representation returns a Sage matrix, for instance, and the datatypes don't get imported into the Sage namespace). Speed is of the essence here, since we create and destroy tons of these (Sage matrices have a lot of overhead at creation time), and we do tons of row operations on them. If you dig deep enough to use IntegerMatrix at this spot in the code, you'll have some idea of what you're getting yourself into.\n\nAgain, since you want to use IntegerMatrix in the LinearMatroid subclasses, and since you need a matrix where pivoting is safe, really the only use case is Regular Matroids where overflows are never an issue.",
    "created_at": "2018-09-12T21:40:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404449",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<div id="comment:25" align="right">comment:25</div>

Thing is, the LeanMatrix classes are internal datatypes. Regular matroids have matrices with entries equal to -1, 0, 1, and are such that pivoting preserves that property. For a potentially regular matroid on which you want to run is_valid(), we check this condition through pivoting, which means we get to a "bad subdeterminant" of size at most 2x2, hardly enough to cause overflows if the entries are 0,1, or -1.

We took some effort to keep the LeanMatrix away from the end user (LinearMatroid.Representation returns a Sage matrix, for instance, and the datatypes don't get imported into the Sage namespace). Speed is of the essence here, since we create and destroy tons of these (Sage matrices have a lot of overhead at creation time), and we do tons of row operations on them. If you dig deep enough to use IntegerMatrix at this spot in the code, you'll have some idea of what you're getting yourself into.

Again, since you want to use IntegerMatrix in the LinearMatroid subclasses, and since you need a matrix where pivoting is safe, really the only use case is Regular Matroids where overflows are never an issue.



---

archive/issue_comments_404450.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@jdemeyer](#comment:23):\n> Replying to [@tscrim](#comment:21):\n> > However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?\n\n> \n> Suppose that an entry in the matrix equals the Python integer -2. Currently (without applying any changes): when calling `is_nonzero()` on that -2, the return value is `int(bool(-2)) = 1`. With your changes, the return value for the same `is_nonzero()` call is just `-2`. The Cython wrapper interprets this `-2` as an exception return value (that is what `except -2` does). But there hasn't been an exception raised, which gives the `SystemError`.\n\nAh, I see. Thank you for the explanation. I fully agree that it is not a bug.",
    "created_at": "2018-09-13T01:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404450",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@jdemeyer](#comment:23):
> Replying to [@tscrim](#comment:21):
> > However, the fact that `bint` and `int` are the same, then why do I get the error I am getting when I do not explicitly make it a `bint` with the `!= 0`? From what you're saying, it should not result in an error. Unless there is some code elsewhere secretly expecting the result to be 0 or 1, which seems unlikely (or is `bint` allowed to take on different values)?

> 
> Suppose that an entry in the matrix equals the Python integer -2. Currently (without applying any changes): when calling `is_nonzero()` on that -2, the return value is `int(bool(-2)) = 1`. With your changes, the return value for the same `is_nonzero()` call is just `-2`. The Cython wrapper interprets this `-2` as an exception return value (that is what `except -2` does). But there hasn't been an exception raised, which gives the `SystemError`.

Ah, I see. Thank you for the explanation. I fully agree that it is not a bug.



---

archive/issue_comments_404451.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@sagetrac-Stefan](#comment:25):\n> Thing is, the LeanMatrix classes are internal datatypes. Regular matroids have matrices with entries equal to -1, 0, 1, and are such that pivoting preserves that property. For a potentially regular matroid on which you want to run is_valid(), we check this condition through pivoting, which means we get to a \"bad subdeterminant\" of size at most 2x2, hardly enough to cause overflows if the entries are 0,1, or -1.\n\nI see. `IntegerMatrix` is a misnomer because it requires entries to be `+-1` or `0`, which is also undocumented. In fact, in the `.. NOTE::`, it says this works for `LinearMatroid`, but that is not quite the case. Thank you for the explanation.\n\nNow I understand why it is working for the generic matrix over `ZZ`: it is secretly converting things to `QQ` when doing the matrix operations. My computation was not working using `IntegerMatrix` because of the assumption of `+-1` for the nonzero entries.\n\nI think this needs to be documented at the very least (which I will do here). I might also like to change the name of `IntegerMatrix` to perhaps `UnitIntegerMatrix` or `PlusMinusOneMatrix`. Thoughts?\n\n> Again, since you want to use IntegerMatrix in the LinearMatroid subclasses, and since you need a matrix where pivoting is safe, really the only use case is Regular Matroids where overflows are never an issue.\n\nSo it seems like I should write a version of `LeanMatrix` that directly uses `mpq`. I will start to work on that.",
    "created_at": "2018-09-13T01:33:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404451",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@sagetrac-Stefan](#comment:25):
> Thing is, the LeanMatrix classes are internal datatypes. Regular matroids have matrices with entries equal to -1, 0, 1, and are such that pivoting preserves that property. For a potentially regular matroid on which you want to run is_valid(), we check this condition through pivoting, which means we get to a "bad subdeterminant" of size at most 2x2, hardly enough to cause overflows if the entries are 0,1, or -1.

I see. `IntegerMatrix` is a misnomer because it requires entries to be `+-1` or `0`, which is also undocumented. In fact, in the `.. NOTE::`, it says this works for `LinearMatroid`, but that is not quite the case. Thank you for the explanation.

Now I understand why it is working for the generic matrix over `ZZ`: it is secretly converting things to `QQ` when doing the matrix operations. My computation was not working using `IntegerMatrix` because of the assumption of `+-1` for the nonzero entries.

I think this needs to be documented at the very least (which I will do here). I might also like to change the name of `IntegerMatrix` to perhaps `UnitIntegerMatrix` or `PlusMinusOneMatrix`. Thoughts?

> Again, since you want to use IntegerMatrix in the LinearMatroid subclasses, and since you need a matrix where pivoting is safe, really the only use case is Regular Matroids where overflows are never an issue.

So it seems like I should write a version of `LeanMatrix` that directly uses `mpq`. I will start to work on that.



---

archive/issue_comments_404452.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAlso: if the entries are really only 0, 1 or -1 then using an `int` to store the entries wastes memory. You could use `int8_t` (8 bits) instead of `int` (typically 32 bits). I'll leave it to you to decide whether it would be worth to change that.",
    "created_at": "2018-09-13T05:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404452",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:28" align="right">comment:28</div>

Also: if the entries are really only 0, 1 or -1 then using an `int` to store the entries wastes memory. You could use `int8_t` (8 bits) instead of `int` (typically 32 bits). I'll leave it to you to decide whether it would be worth to change that.



---

archive/issue_comments_404453.json:
```json
{
    "body": "Author: **Travis Scrimshaw**",
    "created_at": "2018-09-13T05:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404453",
    "user": "https://github.com/tscrim"
}
```

Author: **Travis Scrimshaw**



---

archive/issue_comments_404454.json:
```json
{
    "body": "Branch: **[public/matroids/speedup_integer_matrix-26237](https://github.com/sagemath/sagetrac-mirror/tree/public/matroids/speedup_integer_matrix-26237)**",
    "created_at": "2018-09-13T05:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404454",
    "user": "https://github.com/tscrim"
}
```

Branch: **[public/matroids/speedup_integer_matrix-26237](https://github.com/sagemath/sagetrac-mirror/tree/public/matroids/speedup_integer_matrix-26237)**



---

archive/issue_comments_404455.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI will leave it to Rudi or Stefan to decide for that.\n\nSo I have gotten a somewhat working `RationalMatrix` version working, but I am having a bit of an issue with getting things to work like I expected. In Cython, are things pass-by-reference or pass-by-copy (like C)? In particular, I wanted to have an inlined `get` that returned the correct `mpq_t` entry, and I want to pass some of those around (and sometimes assign them to local variables). However, this does not seem to work. Does that mean I have to handle them always as pointers when I want to pass them around?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0d3105e0b02a9c138514641af07d103f97d34519\">0d3105e</a></td><td><code>Explicit casts to int for IntegerMatrix.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/101663decdb23e66f3b8cc8d594890121dc9c7e2\">101663d</a></td><td><code>Documenting IntegerMatrix only should have +-1 or 0 entries.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44538fa571fa4ebc649b2729cbdbc117f1cf57c4\">44538fa</a></td><td><code>Adding RationalMatrix that directly manipulates an mpq_t array.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a\">31a87a3</a></td><td><code>Removing get in place of index and some bug fixes.</code></td></tr></table>\n",
    "created_at": "2018-09-13T05:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404455",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">comment:30</div>

I will leave it to Rudi or Stefan to decide for that.

So I have gotten a somewhat working `RationalMatrix` version working, but I am having a bit of an issue with getting things to work like I expected. In Cython, are things pass-by-reference or pass-by-copy (like C)? In particular, I wanted to have an inlined `get` that returned the correct `mpq_t` entry, and I want to pass some of those around (and sometimes assign them to local variables). However, this does not seem to work. Does that mean I have to handle them always as pointers when I want to pass them around?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0d3105e0b02a9c138514641af07d103f97d34519">0d3105e</a></td><td><code>Explicit casts to int for IntegerMatrix.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/101663decdb23e66f3b8cc8d594890121dc9c7e2">101663d</a></td><td><code>Documenting IntegerMatrix only should have +-1 or 0 entries.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44538fa571fa4ebc649b2729cbdbc117f1cf57c4">44538fa</a></td><td><code>Adding RationalMatrix that directly manipulates an mpq_t array.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a">31a87a3</a></td><td><code>Removing get in place of index and some bug fixes.</code></td></tr></table>




---

archive/issue_comments_404456.json:
```json
{
    "body": "Commit: **[`31a87a3`](https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a)**",
    "created_at": "2018-09-13T05:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404456",
    "user": "https://github.com/tscrim"
}
```

Commit: **[`31a87a3`](https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a)**



---

archive/issue_comments_404457.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplace\n\n```\ncdef int sval = int(s)\n```\nby\n\n```\ncdef int sval = s\n```\n\nThe `int()` is superfluous and will only slow things down. Cython already implicitly converts when you assign to a C `int`.",
    "created_at": "2018-09-13T05:53:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404457",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Replace

```
cdef int sval = int(s)
```
by

```
cdef int sval = s
```

The `int()` is superfluous and will only slow things down. Cython already implicitly converts when you assign to a C `int`.



---

archive/issue_comments_404458.json:
```json
{
    "body": "Changed commit from **[`31a87a3`](https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a)** to **[`7effef0`](https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a)**",
    "created_at": "2018-09-13T05:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404458",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`31a87a3`](https://github.com/sagemath/sagetrac-mirror/commit/31a87a3194b9c77febb961c4821d1873a4b01b2a)** to **[`7effef0`](https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a)**



---

archive/issue_comments_404459.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a\">7effef0</a></td><td><code>Removing superfluous int's.</code></td></tr></table>\n",
    "created_at": "2018-09-13T05:55:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404459",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a">7effef0</a></td><td><code>Removing superfluous int's.</code></td></tr></table>




---

archive/issue_comments_404460.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nDone. I didn't know that. Thanks.",
    "created_at": "2018-09-13T05:55:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404460",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:33" align="right">comment:33</div>

Done. I didn't know that. Thanks.



---

archive/issue_comments_404461.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nYou will see that no function ever returns an `mpq_t` (or `mpz_t` or whatever). The typical calling convention is passing a return argument, for example the declaration of `mpq_add`:\n\n```\nvoid mpq_add(mpq_t sum, mpq_t addend1, mpq_t addend2)\n```",
    "created_at": "2018-09-13T05:56:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404461",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:34" align="right">comment:34</div>

You will see that no function ever returns an `mpq_t` (or `mpz_t` or whatever). The typical calling convention is passing a return argument, for example the declaration of `mpq_add`:

```
void mpq_add(mpq_t sum, mpq_t addend1, mpq_t addend2)
```



---

archive/issue_comments_404462.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nYea, I noticed that and so I scrapped the `get` in place of the `index` for better maintainability should the internal ordering change. However, I do have some functions where I am passing an `mpq_t`, e.g., in `pivot`, and this is not working as I would expect. Also, I had tried to do something like\n\n```\ncdef mpq_t s = self._entries[self.index(i,j)]\nmpq_add(s, s, t)\n```\nwhere `t` is some other `mpq_t`, but that wasn't working like I expected either.",
    "created_at": "2018-09-13T06:00:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404462",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:35" align="right">comment:35</div>

Yea, I noticed that and so I scrapped the `get` in place of the `index` for better maintainability should the internal ordering change. However, I do have some functions where I am passing an `mpq_t`, e.g., in `pivot`, and this is not working as I would expect. Also, I had tried to do something like

```
cdef mpq_t s = self._entries[self.index(i,j)]
mpq_add(s, s, t)
```
where `t` is some other `mpq_t`, but that wasn't working like I expected either.



---

archive/issue_comments_404463.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nCan you move \"Implement `RationalMatrix`\" to a new ticket instead?\n\nThe commits that you added here to improve `IntegerMatrix` make sense independently.",
    "created_at": "2018-09-13T07:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404463",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:36" align="right">comment:36</div>

Can you move "Implement `RationalMatrix`" to a new ticket instead?

The commits that you added here to improve `IntegerMatrix` make sense independently.



---

archive/issue_comments_404464.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@tscrim](#comment:27):\n> I think this needs to be documented at the very least (which I will do here). I might also like to change the name of `IntegerMatrix` to perhaps `UnitIntegerMatrix` or `PlusMinusOneMatrix`. Thoughts?\n\n+1 to `PlusMinusOneMatrix`.",
    "created_at": "2018-09-13T07:55:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404464",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@tscrim](#comment:27):
> I think this needs to be documented at the very least (which I will do here). I might also like to change the name of `IntegerMatrix` to perhaps `UnitIntegerMatrix` or `PlusMinusOneMatrix`. Thoughts?

+1 to `PlusMinusOneMatrix`.



---

archive/issue_comments_404465.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@jdemeyer](#comment:36):\n> Can you move \"Implement `RationalMatrix`\" to a new ticket instead?\n> \n> The commits that you added here to improve `IntegerMatrix` make sense independently.\n\nYep, I can do that. I will do that when I get into my office tomorrow.",
    "created_at": "2018-09-13T07:57:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404465",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@jdemeyer](#comment:36):
> Can you move "Implement `RationalMatrix`" to a new ticket instead?
> 
> The commits that you added here to improve `IntegerMatrix` make sense independently.

Yep, I can do that. I will do that when I get into my office tomorrow.



---

archive/issue_comments_404466.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+We explicitly declare things to be `int` type so Cython can generate better C code.\n``````\n",
    "created_at": "2018-09-13T10:39:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404466",
    "user": "https://github.com/tscrim"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+We explicitly declare things to be `int` type so Cython can generate better C code.
``````




---

archive/issue_comments_404467.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\n#26269 for the `RationalMatrix` implementation.",
    "created_at": "2018-09-13T10:39:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404467",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:39" align="right">comment:39</div>

#26269 for the `RationalMatrix` implementation.



---

archive/issue_comments_404468.json:
```json
{
    "body": "Changed commit from **[`7effef0`](https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a)** to **[`fb64e43`](https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075)**",
    "created_at": "2018-09-14T01:07:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404468",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7effef0`](https://github.com/sagemath/sagetrac-mirror/commit/7effef06c3c1f821c1bfa3316d55e88c0026333a)** to **[`fb64e43`](https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075)**



---

archive/issue_comments_404469.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075\">fb64e43</a></td><td><code>Removing superfluous int's.</code></td></tr></table>\n",
    "created_at": "2018-09-14T01:07:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404469",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075">fb64e43</a></td><td><code>Removing superfluous int's.</code></td></tr></table>




---

archive/issue_events_361824.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-14T01:10:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361824"
}
```



---

archive/issue_comments_404470.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI've split the ticket into the two parts. This part is now ready for review.",
    "created_at": "2018-09-14T01:10:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404470",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:41" align="right">comment:41</div>

I've split the ticket into the two parts. This part is now ready for review.



---

archive/issue_comments_404471.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\n(Essentially) Green patchbot.",
    "created_at": "2018-09-14T05:02:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404471",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

(Essentially) Green patchbot.



---

archive/issue_comments_404472.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nSo how about renaming to `PlusMinusOneMatrix`? I'd like the opinion of Stefan on that.",
    "created_at": "2018-09-14T07:49:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404472",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:43" align="right">comment:43</div>

So how about renaming to `PlusMinusOneMatrix`? I'd like the opinion of Stefan on that.



---

archive/issue_comments_404473.json:
```json
{
    "body": "<div id=\"comment:44\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0\">3c0195b</a></td><td><code>Renaming IntegerMatrix to PlusMinusOneMatrix.</code></td></tr></table>\n",
    "created_at": "2018-09-16T22:47:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404473",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:44"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0">3c0195b</a></td><td><code>Renaming IntegerMatrix to PlusMinusOneMatrix.</code></td></tr></table>




---

archive/issue_comments_404474.json:
```json
{
    "body": "Changed commit from **[`fb64e43`](https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075)** to **[`3c0195b`](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)**",
    "created_at": "2018-09-16T22:47:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404474",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fb64e43`](https://github.com/sagemath/sagetrac-mirror/commit/fb64e43cd4e5eaa28b3156b39c7cb42909ac0075)** to **[`3c0195b`](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)**



---

archive/issue_comments_404475.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI did the refactoring. Stefan, Rudi, any objections?",
    "created_at": "2018-09-16T22:48:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404475",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:45" align="right">comment:45</div>

I did the refactoring. Stefan, Rudi, any objections?



---

archive/issue_comments_404476.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI am happy with the new name. Don\u2019t have time for a long review.",
    "created_at": "2018-09-17T05:28:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404476",
    "user": "https://github.com/sagetrac-Stefan"
}
```

<div id="comment:46" align="right">comment:46</div>

I am happy with the new name. Don’t have time for a long review.



---

archive/issue_comments_404477.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI've looked through the code and I am happy with it, so LGTM.\n\nHowever contributed to this ticket (mainly review), please insert your name in the reviewer field.",
    "created_at": "2019-03-27T14:03:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404477",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:47" align="right">comment:47</div>

I've looked through the code and I am happy with it, so LGTM.

However contributed to this ticket (mainly review), please insert your name in the reviewer field.



---

archive/issue_comments_404478.json:
```json
{
    "body": "Reviewer: **Daniel Krenn**",
    "created_at": "2019-03-27T14:03:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404478",
    "user": "https://github.com/dkrenn"
}
```

Reviewer: **Daniel Krenn**



---

archive/issue_events_361825.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-03-27T14:03:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361825"
}
```



---

archive/issue_events_361826.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2019-03-27T14:03:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361826"
}
```



---

archive/issue_comments_404479.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nStefan, Rudi I added you as reviewers based on our conversions above. Jeroen is obviously a reviewer for looking at the Cython code (as well as his additional useful insights).",
    "created_at": "2019-03-27T22:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404479",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:48" align="right">comment:48</div>

Stefan, Rudi I added you as reviewers based on our conversions above. Jeroen is obviously a reviewer for looking at the Cython code (as well as his additional useful insights).



---

archive/issue_events_361827.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-27T22:08:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361827"
}
```



---

archive/issue_events_361828.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-03-27T22:08:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361828"
}
```



---

archive/issue_comments_404480.json:
```json
{
    "body": "Changed reviewer from **Daniel Krenn** to **Daniel Krenn, Jeroen Demeyer, Stefan Van Zwam, Rudi Pendavingh**",
    "created_at": "2019-03-27T22:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404480",
    "user": "https://github.com/tscrim"
}
```

Changed reviewer from **Daniel Krenn** to **Daniel Krenn, Jeroen Demeyer, Stefan Van Zwam, Rudi Pendavingh**



---

archive/issue_events_361829.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-29T12:36:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361829"
}
```



---

archive/issue_events_361830.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "88305bb309b3caa85185d0d391cda7a53cf607c3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-03-29T12:36:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26237#event-361830"
}
```



---

archive/issue_comments_404481.json:
```json
{
    "body": "Changed branch from **[public/matroids/speedup_integer_matrix-26237](https://github.com/sagemath/sagetrac-mirror/tree/public/matroids/speedup_integer_matrix-26237)** to **[`3c0195b`](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)**",
    "created_at": "2019-03-29T12:36:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26237",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26237#issuecomment-404481",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/matroids/speedup_integer_matrix-26237](https://github.com/sagemath/sagetrac-mirror/tree/public/matroids/speedup_integer_matrix-26237)** to **[`3c0195b`](https://github.com/sagemath/sagetrac-mirror/commit/3c0195bc7302b36431d1c4715582fd33ed5cc0c0)**
