# Issue 26088: py3: hash for padic extension rings

archive/issues_025851.json:
```json
{
    "body": "part of #24551\n\nCC:  @xcaruso @roed314 @tscrim\n\nBranch/Commit: 4e068748c51a0ca9ca5c0529bf76fe7309039427\n\nReviewer: Julian R\u00fcth\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26088\n\n",
    "closed_at": "2018-08-30T22:24:37Z",
    "created_at": "2018-08-18T06:51:13Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "py3: hash for padic extension rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26088",
    "user": "https://github.com/fchapoton"
}
```
part of #24551

CC:  @xcaruso @roed314 @tscrim

Branch/Commit: 4e068748c51a0ca9ca5c0529bf76fe7309039427

Reviewer: Julian Rüth

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26088





---

archive/issue_comments_494932.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-18T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494932",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_494933.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[5193635](https://github.com/sagemath/sagetrac-mirror/commit/51936350ec6f83cec508bac31fc12ce59510c7b0)|`py3: hash for p-adic extension rings`|",
    "created_at": "2018-08-18T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494933",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[5193635](https://github.com/sagemath/sagetrac-mirror/commit/51936350ec6f83cec508bac31fc12ce59510c7b0)|`py3: hash for p-adic extension rings`|



---

archive/issue_comments_494934.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/26088\"",
    "created_at": "2018-08-18T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494934",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/26088"



---

archive/issue_comments_494935.json:
```json
{
    "body": "Changing commit from \"\" to \"51936350ec6f83cec508bac31fc12ce59510c7b0\"",
    "created_at": "2018-08-18T06:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494935",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "51936350ec6f83cec508bac31fc12ce59510c7b0"



---

archive/issue_comments_494936.json:
```json
{
    "body": "<a id='comment:2'></a>\nI'm not sure what hashes are used for but I would say that the precision type should be included in the hash, shouldn't it?",
    "created_at": "2018-08-18T08:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494936",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:2'></a>
I'm not sure what hashes are used for but I would say that the precision type should be included in the hash, shouldn't it?



---

archive/issue_comments_494937.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis hash is parallel to the behaviour of `__eq__` in the same class.\n\nI you want to change the equality, maybe do that in another ticket ?",
    "created_at": "2018-08-18T09:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494937",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
This hash is parallel to the behaviour of `__eq__` in the same class.

I you want to change the equality, maybe do that in another ticket ?



---

archive/issue_comments_494938.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-18T10:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494938",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_494939.json:
```json
{
    "body": "<a id='comment:4'></a>\nsome failing doctests..",
    "created_at": "2018-08-18T10:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494939",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
some failing doctests..



---

archive/issue_comments_494940.json:
```json
{
    "body": "<a id='comment:5'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[8c1bde6](https://github.com/sagemath/sagetrac-mirror/commit/8c1bde6d3a4d0d02742b898927319233281788a7)|`fix one detail in #26088`|",
    "created_at": "2018-08-19T06:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494940",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[8c1bde6](https://github.com/sagemath/sagetrac-mirror/commit/8c1bde6d3a4d0d02742b898927319233281788a7)|`fix one detail in #26088`|



---

archive/issue_comments_494941.json:
```json
{
    "body": "Changing commit from \"51936350ec6f83cec508bac31fc12ce59510c7b0\" to \"8c1bde6d3a4d0d02742b898927319233281788a7\"",
    "created_at": "2018-08-19T06:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "51936350ec6f83cec508bac31fc12ce59510c7b0" to "8c1bde6d3a4d0d02742b898927319233281788a7"



---

archive/issue_comments_494942.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-19T06:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494942",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_494943.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis should fix the failing doctests.",
    "created_at": "2018-08-19T06:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494943",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>
This should fix the failing doctests.



---

archive/issue_comments_494944.json:
```json
{
    "body": "<a id='comment:7'></a>\ngreen bot, please review",
    "created_at": "2018-08-19T17:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494944",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
green bot, please review



---

archive/issue_comments_494945.json:
```json
{
    "body": "<a id='comment:8'></a>\nI think that it's not enough to compare the string representation of the printer.\nFor example:\n\n```\nsage: A.<pi> = Zp(2, print_mode='bars', print_sep='|').extension(x^3 - 2)\nsage: B.<pi> = Zp(2, print_mode='bars', print_sep='#').extension(x^3 - 2)\nsage: A == B\nFalse\nsage: hash(A) == hash(B)\nTrue\n```\n\nProbably, one should implement a method `__hash__` for the printer as well...",
    "created_at": "2018-08-20T04:29:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494945",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:8'></a>
I think that it's not enough to compare the string representation of the printer.
For example:

```
sage: A.<pi> = Zp(2, print_mode='bars', print_sep='|').extension(x^3 - 2)
sage: B.<pi> = Zp(2, print_mode='bars', print_sep='#').extension(x^3 - 2)
sage: A == B
False
sage: hash(A) == hash(B)
True
```

Probably, one should implement a method `__hash__` for the printer as well...



---

archive/issue_comments_494946.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[a7bff82](https://github.com/sagemath/sagetrac-mirror/commit/a7bff82f74ed9b1e40a8029982a6099ba7a8e36d)|`better hash #26088`|",
    "created_at": "2018-08-20T07:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494946",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[a7bff82](https://github.com/sagemath/sagetrac-mirror/commit/a7bff82f74ed9b1e40a8029982a6099ba7a8e36d)|`better hash #26088`|



---

archive/issue_comments_494947.json:
```json
{
    "body": "Changing commit from \"8c1bde6d3a4d0d02742b898927319233281788a7\" to \"a7bff82f74ed9b1e40a8029982a6099ba7a8e36d\"",
    "created_at": "2018-08-20T07:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494947",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8c1bde6d3a4d0d02742b898927319233281788a7" to "a7bff82f74ed9b1e40a8029982a6099ba7a8e36d"



---

archive/issue_comments_494948.json:
```json
{
    "body": "<a id='comment:10'></a>\nThe hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.\n\nNevertheless, here is another proposal.",
    "created_at": "2018-08-20T07:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494948",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.

Nevertheless, here is another proposal.



---

archive/issue_comments_494949.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [chapoton](#comment%3A10):\n> The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.\n\n\nWhat's exactly the purpose and the requirements on the hash?\nDo we need to ensure that `A == B` implies `hash(A) == hash(B)`? Or the other way around? Something else? Nothing?",
    "created_at": "2018-08-20T08:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494949",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:11'></a>
Replying to [chapoton](#comment%3A10):
> The hash is not necessarily taking all parameters into account. One could very well just forget about the printing mode.


What's exactly the purpose and the requirements on the hash?
Do we need to ensure that `A == B` implies `hash(A) == hash(B)`? Or the other way around? Something else? Nothing?



---

archive/issue_comments_494950.json:
```json
{
    "body": "<a id='comment:12'></a>\nThe only requirement is that \"A == B\" implies \"hash(A) == hash(B)\".\n\nOne could even use the constant hash, that would be perfectly valid, but useless. So in general there is a balance or a choice : complex hash that tells many things apart, or simple hash that is not so good.\n\nI think in sage, the hash for parents are not so important. They are required for python3 nevertheless.\n\nhttps://docs.python.org/2/library/functions.html#hash\n\nhttps://docs.python.org/2/glossary.html#term-hashable",
    "created_at": "2018-08-20T08:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494950",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
The only requirement is that "A == B" implies "hash(A) == hash(B)".

One could even use the constant hash, that would be perfectly valid, but useless. So in general there is a balance or a choice : complex hash that tells many things apart, or simple hash that is not so good.

I think in sage, the hash for parents are not so important. They are required for python3 nevertheless.

https://docs.python.org/2/library/functions.html#hash

https://docs.python.org/2/glossary.html#term-hashable



---

archive/issue_comments_494951.json:
```json
{
    "body": "<a id='comment:13'></a>\nIs this ok for you, Xavier ? Patchbot is green.",
    "created_at": "2018-08-20T19:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494951",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
Is this ok for you, Xavier ? Patchbot is green.



---

archive/issue_comments_494952.json:
```json
{
    "body": "<a id='comment:14'></a>\nYes, it looks good to me.\n\nI would be happy to give a positive review but I don't know so much about p-adic printers and I would be more comfortable if David confirms that your changes won't break something elsewhere. David, could you do this, please?",
    "created_at": "2018-08-20T20:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494952",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:14'></a>
Yes, it looks good to me.

I would be happy to give a positive review but I don't know so much about p-adic printers and I would be more comfortable if David confirms that your changes won't break something elsewhere. David, could you do this, please?



---

archive/issue_comments_494953.json:
```json
{
    "body": "<a id='comment:15'></a>\nA printer's `__eq__` is quite complex so I think that hashing the full dict is too much, i.e., it'll give different hashes to  printers that are considered equal. Strangely, the printer is not hashable (seems like a bug to me) so I'd not include it into the hash of the ring at all. If it were hashable, we should just include the printer's hash value.\n\nSo, I'd drop `hash_printer` and add a comment that printer's are strangely not hashable. Does that sound Ok to you?",
    "created_at": "2018-08-22T02:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494953",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:15'></a>
A printer's `__eq__` is quite complex so I think that hashing the full dict is too much, i.e., it'll give different hashes to  printers that are considered equal. Strangely, the printer is not hashable (seems like a bug to me) so I'd not include it into the hash of the ring at all. If it were hashable, we should just include the printer's hash value.

So, I'd drop `hash_printer` and add a comment that printer's are strangely not hashable. Does that sound Ok to you?



---

archive/issue_comments_494954.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Julian R\u00fcth\"",
    "created_at": "2018-08-22T02:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494954",
    "user": "https://github.com/saraedum"
}
```

Changing reviewer from "" to "Julian Rüth"



---

archive/issue_comments_494955.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-22T02:06:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494955",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_494956.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[4e06874](https://github.com/sagemath/sagetrac-mirror/commit/4e068748c51a0ca9ca5c0529bf76fe7309039427)|`do not hash the _printer in #26088`|",
    "created_at": "2018-08-22T05:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[4e06874](https://github.com/sagemath/sagetrac-mirror/commit/4e068748c51a0ca9ca5c0529bf76fe7309039427)|`do not hash the _printer in #26088`|



---

archive/issue_comments_494957.json:
```json
{
    "body": "Changing commit from \"a7bff82f74ed9b1e40a8029982a6099ba7a8e36d\" to \"4e068748c51a0ca9ca5c0529bf76fe7309039427\"",
    "created_at": "2018-08-22T05:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494957",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a7bff82f74ed9b1e40a8029982a6099ba7a8e36d" to "4e068748c51a0ca9ca5c0529bf76fe7309039427"



---

archive/issue_comments_494958.json:
```json
{
    "body": "<a id='comment:18'></a>\ndone",
    "created_at": "2018-08-22T05:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494958",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
done



---

archive/issue_comments_494959.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-22T05:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494959",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_494960.json:
```json
{
    "body": "<a id='comment:19'></a>\nEverything seems to be ok. Positive review, somebody ?",
    "created_at": "2018-08-26T15:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494960",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>
Everything seems to be ok. Positive review, somebody ?



---

archive/issue_comments_494961.json:
```json
{
    "body": "<a id='comment:20'></a>\nreview, please",
    "created_at": "2018-08-29T18:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494961",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>
review, please



---

archive/issue_comments_494962.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-29T18:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494962",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_494963.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-30T22:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494963",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_494964.json:
```json
{
    "body": "Changing branch from \"u/chapoton/26088\" to \"4e068748c51a0ca9ca5c0529bf76fe7309039427\"",
    "created_at": "2018-08-30T22:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26088#issuecomment-494964",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/chapoton/26088" to "4e068748c51a0ca9ca5c0529bf76fe7309039427"



---

archive/issue_events_081832.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:24:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26088",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26088#event-81832"
}
```
