# Issue 26966: py3: new doctest failures in homology

archive/issues_026729.json:
```json
{
    "assignees": [],
    "body": "With Python 3, before #26931:\n\n```\nsage -t src/sage/homology/simplicial_complex.py  # 22 doctests failed\nsage -t src/sage/homology/examples.py  # 7 doctests failed\n```\nAfter #26931:\n\n```\nsage -t src/sage/homology/examples.py  # 14 doctests failed\nsage -t src/sage/homology/simplicial_complex.py  # 35 doctests failed\nsage -t src/sage/homology/simplicial_set.py  # 6 doctests failed\nsage -t src/sage/homology/delta_complex.py  # 3 doctests failed\nsage -t src/sage/homology/simplicial_complexes_catalog.py  # 3 doctests failed\n```\nAfter this branch:\n\n```\nsage -t src/sage/homology/simplicial_complex.py  # 10 doctests failed\nsage -t src/sage/homology/examples.py  # 1 doctest failed\n```\n\nBranch/Commit: **[`3da1d0f`](https://github.com/sagemath/sagetrac-mirror/commit/3da1d0f108449360fb575d64be78eacf89109cd3)**\n\nReviewer: **Jeroen Demeyer, Travis Scrimshaw**\n\nAuthor: **John Palmieri**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26966_\n\n",
    "closed_at": "2019-01-23T15:39:26Z",
    "created_at": "2018-12-28T22:33:23Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: new doctest failures in homology",
    "type": "issue",
    "updated_at": "2019-01-23T15:39:26Z",
    "url": "https://github.com/sagemath/sage/issues/26966",
    "user": "https://github.com/jhpalmieri"
}
```
With Python 3, before #26931:

```
sage -t src/sage/homology/simplicial_complex.py  # 22 doctests failed
sage -t src/sage/homology/examples.py  # 7 doctests failed
```
After #26931:

```
sage -t src/sage/homology/examples.py  # 14 doctests failed
sage -t src/sage/homology/simplicial_complex.py  # 35 doctests failed
sage -t src/sage/homology/simplicial_set.py  # 6 doctests failed
sage -t src/sage/homology/delta_complex.py  # 3 doctests failed
sage -t src/sage/homology/simplicial_complexes_catalog.py  # 3 doctests failed
```
After this branch:

```
sage -t src/sage/homology/simplicial_complex.py  # 10 doctests failed
sage -t src/sage/homology/examples.py  # 1 doctest failed
```

Branch/Commit: **[`3da1d0f`](https://github.com/sagemath/sagetrac-mirror/commit/3da1d0f108449360fb575d64be78eacf89109cd3)**

Reviewer: **Jeroen Demeyer, Travis Scrimshaw**

Author: **John Palmieri**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/26966_





---

archive/issue_events_367597.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-12-28T22:33:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367597"
}
```



---

archive/issue_events_367598.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-12-28T22:33:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367598"
}
```



---

archive/issue_events_367599.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-12-28T22:33:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367599"
}
```



---

archive/issue_events_367600.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-12-28T22:33:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367600"
}
```



---

archive/issue_comments_415734.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe failures come from trying to sort vertices. Before #26931, there was a fallback to use `str` as a key, but that was removed.\n\n```\nFile \"src/sage/homology/simplicial_complexes_catalog.py\", line 57, in sage.homology.simplicial_complexes_catalog\nFailed example:\n    simplicial_complexes.SurfaceOfGenus(3)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.homology.simplicial_complexes_catalog[2]>\", line 1, in <module>\n        simplicial_complexes.SurfaceOfGenus(Integer(3))\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/homology/examples.py\", line 451, in SurfaceOfGenus\n        S = S.connected_sum(T)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/homology/simplicial_complex.py\", line 2770, in connected_sum\n        return SimplicialComplex(facet_set, is_mutable=is_mutable)\n      File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/homology/simplicial_complex.py\", line 1040, in __init__\n        vertex_set = sorted(vertex_set)\n    TypeError: '<' not supported between instances of 'str' and 'int'\n```",
    "created_at": "2018-12-28T22:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415734",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:1" align="right">comment:1</div>

The failures come from trying to sort vertices. Before #26931, there was a fallback to use `str` as a key, but that was removed.

```
File "src/sage/homology/simplicial_complexes_catalog.py", line 57, in sage.homology.simplicial_complexes_catalog
Failed example:
    simplicial_complexes.SurfaceOfGenus(3)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.homology.simplicial_complexes_catalog[2]>", line 1, in <module>
        simplicial_complexes.SurfaceOfGenus(Integer(3))
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/homology/examples.py", line 451, in SurfaceOfGenus
        S = S.connected_sum(T)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/homology/simplicial_complex.py", line 2770, in connected_sum
        return SimplicialComplex(facet_set, is_mutable=is_mutable)
      File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.5/local/lib/python3.6/site-packages/sage/homology/simplicial_complex.py", line 1040, in __init__
        vertex_set = sorted(vertex_set)
    TypeError: '<' not supported between instances of 'str' and 'int'
```



---

archive/issue_comments_415735.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI don't know if this branch is the correct approach, but it helps. If it is the correct approach, it is incomplete: at #26966, I included a list of some of the methods which need attention paid to how vertices are sorted:\n\n- product\n- join\n- disjoint_union\n- wedge\n- connected_sum\n- link\n- star\n- generated_subcomplex\n- alexander_dual\n- stellar_subdivision\n- n_skeleton\n- connected_component\n- fixed_complex\n- intersection\n- `_contractible_subcomplex`\n- `_enlarge_subcomplex`\n- `__copy__`\n\nThis list may not be complete, and the branch here only deals with a few of these.",
    "created_at": "2018-12-29T21:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415735",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

I don't know if this branch is the correct approach, but it helps. If it is the correct approach, it is incomplete: at #26966, I included a list of some of the methods which need attention paid to how vertices are sorted:

- product
- join
- disjoint_union
- wedge
- connected_sum
- link
- star
- generated_subcomplex
- alexander_dual
- stellar_subdivision
- n_skeleton
- connected_component
- fixed_complex
- intersection
- `_contractible_subcomplex`
- `_enlarge_subcomplex`
- `__copy__`

This list may not be complete, and the branch here only deals with a few of these.



---

archive/issue_comments_415736.json:
```json
{
    "body": "Branch: **[u/jhpalmieri/sorting-simplicial-complexes](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sorting-simplicial-complexes)**",
    "created_at": "2018-12-29T21:42:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415736",
    "user": "https://github.com/jhpalmieri"
}
```

Branch: **[u/jhpalmieri/sorting-simplicial-complexes](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sorting-simplicial-complexes)**



---

archive/issue_comments_415737.json:
```json
{
    "body": "Commit: **[`b41b33c`](https://github.com/sagemath/sagetrac-mirror/commit/b41b33c4bfc020fcfc0e6eda1110d07875f2efde)**",
    "created_at": "2018-12-30T01:31:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415737",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`b41b33c`](https://github.com/sagemath/sagetrac-mirror/commit/b41b33c4bfc020fcfc0e6eda1110d07875f2efde)**



---

archive/issue_comments_415738.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI don't agree with\n\n```diff\ndiff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py\nindex 946eda0..fd88c23 100644\n--- a/src/sage/homology/simplicial_complex.py\n+++ b/src/sage/homology/simplicial_complex.py\n@@ -1037,7 +1037,10 @@ class SimplicialComplex(Parent, GenericCellComplex):\n             vertex_set = range(n + 1)\n \n         if sort_facets is True:\n-            vertex_set = sorted(vertex_set)\n+            try:\n+                vertex_set = sorted(vertex_set)\n+            except TypeError:\n+                vertex_set = sorted(vertex_set, key=str)\n         elif callable(sort_facets):\n             vertex_set = sorted(vertex_set, key=sort_facets)\n         elif not sort_facets:\n```\nbecause it's rather arbitrary and ill-defined.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b41b33c4bfc020fcfc0e6eda1110d07875f2efde\"><code>b41b33c</code></a></td><td><code>trac 26966: clean up sorting for some simplicial complex methods.</code></td></tr></table>\n",
    "created_at": "2018-12-30T01:31:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415738",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

I don't agree with

```diff
diff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py
index 946eda0..fd88c23 100644
--- a/src/sage/homology/simplicial_complex.py
+++ b/src/sage/homology/simplicial_complex.py
@@ -1037,7 +1037,10 @@ class SimplicialComplex(Parent, GenericCellComplex):
             vertex_set = range(n + 1)
 
         if sort_facets is True:
-            vertex_set = sorted(vertex_set)
+            try:
+                vertex_set = sorted(vertex_set)
+            except TypeError:
+                vertex_set = sorted(vertex_set, key=str)
         elif callable(sort_facets):
             vertex_set = sorted(vertex_set, key=sort_facets)
         elif not sort_facets:
```
because it's rather arbitrary and ill-defined.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b41b33c4bfc020fcfc0e6eda1110d07875f2efde"><code>b41b33c</code></a></td><td><code>trac 26966: clean up sorting for some simplicial complex methods.</code></td></tr></table>




---

archive/issue_comments_415739.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nDo you know why unsortable lists of vertices are so common in simplicial complexes? Is there a single place where these mixed `int`/`str` vertices come from?",
    "created_at": "2018-12-30T01:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415739",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:5" align="right">comment:5</div>

Do you know why unsortable lists of vertices are so common in simplicial complexes? Is there a single place where these mixed `int`/`str` vertices come from?



---

archive/issue_comments_415740.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nFor example, in `MooreSpace`, the obvious solution to me is to use only strings as vertices, i.e. replace `1` by `\"1\"`.",
    "created_at": "2018-12-30T01:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415740",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

For example, in `MooreSpace`, the obvious solution to me is to use only strings as vertices, i.e. replace `1` by `"1"`.



---

archive/issue_comments_415741.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@jdemeyer](#comment:5):\n> Do you know why unsortable lists of vertices are so common in simplicial complexes? Is there a single place where these mixed `int`/`str` vertices come from?\n\nI don't think we should impose restrictions on what users might choose to do. We can choose good defaults for the specific examples (like `MooreSpace`), but if someone wants to form a disjoint union from a complex whose vertices are integers with another whose vertices are strings, we should allow that.",
    "created_at": "2018-12-30T02:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415741",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@jdemeyer](#comment:5):
> Do you know why unsortable lists of vertices are so common in simplicial complexes? Is there a single place where these mixed `int`/`str` vertices come from?

I don't think we should impose restrictions on what users might choose to do. We can choose good defaults for the specific examples (like `MooreSpace`), but if someone wants to form a disjoint union from a complex whose vertices are integers with another whose vertices are strings, we should allow that.



---

archive/issue_comments_415742.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@jdemeyer](#comment:4):\n> I don't agree with\n> \n> ```diff\n> diff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py\n> index 946eda0..fd88c23 100644\n> --- a/src/sage/homology/simplicial_complex.py\n> +++ b/src/sage/homology/simplicial_complex.py\n> @@ -1037,7 +1037,10 @@ class SimplicialComplex(Parent, GenericCellComplex):\n>              vertex_set = range(n + 1)\n>  \n>          if sort_facets is True:\n> -            vertex_set = sorted(vertex_set)\n> +            try:\n> +                vertex_set = sorted(vertex_set)\n> +            except TypeError:\n> +                vertex_set = sorted(vertex_set, key=str)\n>          elif callable(sort_facets):\n>              vertex_set = sorted(vertex_set, key=sort_facets)\n>          elif not sort_facets:\n> ```\n> because it's rather arbitrary and ill-defined.\n\nOn the other hand, it's the old behavior, so it's safe. We could throw in a warning if the `except` clause ever kicks in, to try to discourage it.",
    "created_at": "2018-12-30T02:59:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415742",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@jdemeyer](#comment:4):
> I don't agree with
> 
> ```diff
> diff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py
> index 946eda0..fd88c23 100644
> --- a/src/sage/homology/simplicial_complex.py
> +++ b/src/sage/homology/simplicial_complex.py
> @@ -1037,7 +1037,10 @@ class SimplicialComplex(Parent, GenericCellComplex):
>              vertex_set = range(n + 1)
>  
>          if sort_facets is True:
> -            vertex_set = sorted(vertex_set)
> +            try:
> +                vertex_set = sorted(vertex_set)
> +            except TypeError:
> +                vertex_set = sorted(vertex_set, key=str)
>          elif callable(sort_facets):
>              vertex_set = sorted(vertex_set, key=sort_facets)
>          elif not sort_facets:
> ```
> because it's rather arbitrary and ill-defined.

On the other hand, it's the old behavior, so it's safe. We could throw in a warning if the `except` clause ever kicks in, to try to discourage it.



---

archive/issue_comments_415743.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jhpalmieri](#comment:7):\n> Replying to [@jdemeyer](#comment:5):\n> > Do you know why unsortable lists of vertices are so common in simplicial complexes? Is there a single place where these mixed `int`/`str` vertices come from?\n\n> \n> I don't think we should impose restrictions on what users might choose to do.\n\nI didn't say that we should. I'm just saying that, if the user does that, they have to explicitly specify the sorting key. Otherwise, it's too fragile (for example, code will behave *differently* on Python 2 and Python 3).",
    "created_at": "2018-12-30T12:05:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415743",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jhpalmieri](#comment:7):
> Replying to [@jdemeyer](#comment:5):
> > Do you know why unsortable lists of vertices are so common in simplicial complexes? Is there a single place where these mixed `int`/`str` vertices come from?

> 
> I don't think we should impose restrictions on what users might choose to do.

I didn't say that we should. I'm just saying that, if the user does that, they have to explicitly specify the sorting key. Otherwise, it's too fragile (for example, code will behave *differently* on Python 2 and Python 3).



---

archive/issue_comments_415744.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI feel like the sort key should mainly be internal, and users should not have to worry about it. Sorting the vertices needs to be done consistently for each simplicial complex, but maybe it's not important if, as the simplicial complex changes, the sorting changes. The ticket description at #26931 sounds compelling, but in retrospect, I'm not convinced. I could easily imagine a user doing this:\n\n```\nsage: T = SimplicialComplex([range(1,5)])\nsage: T.add_face([0,1,'*']) # add a new distinguished vertex\nsage: T.homology()\n...\nTypeError: '<' not supported between instances of 'str' and 'int'\n```",
    "created_at": "2018-12-30T18:00:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415744",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

I feel like the sort key should mainly be internal, and users should not have to worry about it. Sorting the vertices needs to be done consistently for each simplicial complex, but maybe it's not important if, as the simplicial complex changes, the sorting changes. The ticket description at #26931 sounds compelling, but in retrospect, I'm not convinced. I could easily imagine a user doing this:

```
sage: T = SimplicialComplex([range(1,5)])
sage: T.add_face([0,1,'*']) # add a new distinguished vertex
sage: T.homology()
...
TypeError: '<' not supported between instances of 'str' and 'int'
```



---

archive/issue_comments_415745.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jhpalmieri](#comment:10):\n> I feel like the sort key should mainly be internal, and users should not have to worry about it.\n\nLet me ask an even more basic question: why do we need to sort anything at all? If it's not to hard to drop that, we should go for it. Especially if it's meant to be internal as you say, there shouldn't be a fundamental reason why vertices need to be sorted.",
    "created_at": "2018-12-30T20:14:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415745",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jhpalmieri](#comment:10):
> I feel like the sort key should mainly be internal, and users should not have to worry about it.

Let me ask an even more basic question: why do we need to sort anything at all? If it's not to hard to drop that, we should go for it. Especially if it's meant to be internal as you say, there shouldn't be a fundamental reason why vertices need to be sorted.



---

archive/issue_comments_415746.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIn order to compute homology, each simplex needs to be sorted consistently with the other simplices, and the easiest way to achieve that is a total ordering on the vertices. I don't know a minimal example, but if you turn off sorting, then the homology of `simplicial_complexes.ComplexProjectivePlane()` is wrong. That is:\n\n```\nS = SimplicialComplex([[1, 2, 4, 5, 6], [2, 3, 5, 6, 4], [3, 1, 6, 4, 5],\n         [1, 2, 4, 5, 9], [2, 3, 5, 6, 7], [3, 1, 6, 4, 8],\n         [2, 3, 6, 4, 9], [3, 1, 4, 5, 7], [1, 2, 5, 6, 8],\n         [3, 1, 5, 6, 9], [1, 2, 6, 4, 7], [2, 3, 4, 5, 8],\n         [4, 5, 7, 8, 9], [5, 6, 8, 9, 7], [6, 4, 9, 7, 8],\n         [4, 5, 7, 8, 3], [5, 6, 8, 9, 1], [6, 4, 9, 7, 2],\n         [5, 6, 9, 7, 3], [6, 4, 7, 8, 1], [4, 5, 8, 9, 2],\n         [6, 4, 8, 9, 3], [4, 5, 9, 7, 1], [5, 6, 7, 8, 2],\n         [7, 8, 1, 2, 3], [8, 9, 2, 3, 1], [9, 7, 3, 1, 2],\n         [7, 8, 1, 2, 6], [8, 9, 2, 3, 4], [9, 7, 3, 1, 5],\n         [8, 9, 3, 1, 6], [9, 7, 1, 2, 4], [7, 8, 2, 3, 5],\n         [9, 7, 2, 3, 6], [7, 8, 3, 1, 4], [8, 9, 1, 2, 5]],\n        sort_facets=False)\nS.homology()\n```\nproduces the wrong answer: `{0: 0, 1: 0, 2: C2, 3: 0, 4: 0}` instead of `{0: 0, 1: 0, 2: Z, 3: 0, 4: Z}`.",
    "created_at": "2018-12-30T21:00:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415746",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

In order to compute homology, each simplex needs to be sorted consistently with the other simplices, and the easiest way to achieve that is a total ordering on the vertices. I don't know a minimal example, but if you turn off sorting, then the homology of `simplicial_complexes.ComplexProjectivePlane()` is wrong. That is:

```
S = SimplicialComplex([[1, 2, 4, 5, 6], [2, 3, 5, 6, 4], [3, 1, 6, 4, 5],
         [1, 2, 4, 5, 9], [2, 3, 5, 6, 7], [3, 1, 6, 4, 8],
         [2, 3, 6, 4, 9], [3, 1, 4, 5, 7], [1, 2, 5, 6, 8],
         [3, 1, 5, 6, 9], [1, 2, 6, 4, 7], [2, 3, 4, 5, 8],
         [4, 5, 7, 8, 9], [5, 6, 8, 9, 7], [6, 4, 9, 7, 8],
         [4, 5, 7, 8, 3], [5, 6, 8, 9, 1], [6, 4, 9, 7, 2],
         [5, 6, 9, 7, 3], [6, 4, 7, 8, 1], [4, 5, 8, 9, 2],
         [6, 4, 8, 9, 3], [4, 5, 9, 7, 1], [5, 6, 7, 8, 2],
         [7, 8, 1, 2, 3], [8, 9, 2, 3, 1], [9, 7, 3, 1, 2],
         [7, 8, 1, 2, 6], [8, 9, 2, 3, 4], [9, 7, 3, 1, 5],
         [8, 9, 3, 1, 6], [9, 7, 1, 2, 4], [7, 8, 2, 3, 5],
         [9, 7, 2, 3, 6], [7, 8, 3, 1, 4], [8, 9, 1, 2, 5]],
        sort_facets=False)
S.homology()
```
produces the wrong answer: `{0: 0, 1: 0, 2: C2, 3: 0, 4: 0}` instead of `{0: 0, 1: 0, 2: Z, 3: 0, 4: Z}`.



---

archive/issue_comments_415747.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIf the only requirement is a predictable ordering, you could have a dict mapping arbitrary vertices to integers and use that to sort.",
    "created_at": "2019-01-02T18:30:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415747",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

If the only requirement is a predictable ordering, you could have a dict mapping arbitrary vertices to integers and use that to sort.



---

archive/issue_comments_415748.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nFor example, the already-existing attribute `_vertex_set` could be used for that: we could implement a `set`-like class which internally uses a `dict` to store a `vertex: index` mapping.",
    "created_at": "2019-01-02T18:36:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415748",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

For example, the already-existing attribute `_vertex_set` could be used for that: we could implement a `set`-like class which internally uses a `dict` to store a `vertex: index` mapping.



---

archive/issue_comments_415749.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99eec7ba0857330654daf942d89c9160981bc19b\"><code>99eec7b</code></a></td><td><code>trac 26966: simplicial complexes: do not publicly sort vertices any more.</code></td></tr></table>\n",
    "created_at": "2019-01-03T19:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415749",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99eec7ba0857330654daf942d89c9160981bc19b"><code>99eec7b</code></a></td><td><code>trac 26966: simplicial complexes: do not publicly sort vertices any more.</code></td></tr></table>




---

archive/issue_comments_415750.json:
```json
{
    "body": "Changed commit from **[`b41b33c`](https://github.com/sagemath/sagetrac-mirror/commit/b41b33c4bfc020fcfc0e6eda1110d07875f2efde)** to **[`99eec7b`](https://github.com/sagemath/sagetrac-mirror/commit/99eec7ba0857330654daf942d89c9160981bc19b)**",
    "created_at": "2019-01-03T19:22:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415750",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b41b33c`](https://github.com/sagemath/sagetrac-mirror/commit/b41b33c4bfc020fcfc0e6eda1110d07875f2efde)** to **[`99eec7b`](https://github.com/sagemath/sagetrac-mirror/commit/99eec7ba0857330654daf942d89c9160981bc19b)**



---

archive/issue_comments_415751.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOkay, here is an attempt at not sorting vertices (publicly) any more. A few Python 3 doctests have random outputs, since if vertices cannot be sorted, they aren't, and the doctests give different outputs depending on the order of the vertices. I've marked one as `# py3 # random` and I've made another Python 2 only.",
    "created_at": "2019-01-03T19:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415751",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Okay, here is an attempt at not sorting vertices (publicly) any more. A few Python 3 doctests have random outputs, since if vertices cannot be sorted, they aren't, and the doctests give different outputs depending on the order of the vertices. I've marked one as `# py3 # random` and I've made another Python 2 only.



---

archive/issue_events_367601.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-01-03T19:28:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367601"
}
```



---

archive/issue_comments_415752.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,3 +13,9 @@\n sage -t src/sage/homology/delta_complex.py  # 3 doctests failed\n sage -t src/sage/homology/simplicial_complexes_catalog.py  # 3 doctests failed\n ```\n+After this branch:\n+\n+```\n+sage -t src/sage/homology/simplicial_complex.py  # 10 doctests failed\n+sage -t src/sage/homology/examples.py  # 1 doctest failed\n+```\n``````\n",
    "created_at": "2019-01-03T19:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415752",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,3 +13,9 @@
 sage -t src/sage/homology/delta_complex.py  # 3 doctests failed
 sage -t src/sage/homology/simplicial_complexes_catalog.py  # 3 doctests failed
 ```
+After this branch:
+
+```
+sage -t src/sage/homology/simplicial_complex.py  # 10 doctests failed
+sage -t src/sage/homology/examples.py  # 1 doctest failed
+```
``````




---

archive/issue_comments_415753.json:
```json
{
    "body": "Author: **John Palmieri**",
    "created_at": "2019-01-03T19:28:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415753",
    "user": "https://github.com/jhpalmieri"
}
```

Author: **John Palmieri**



---

archive/issue_events_367602.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-03T20:12:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367602"
}
```



---

archive/issue_events_367603.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-03T20:12:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367603"
}
```



---

archive/issue_comments_415754.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n1. What's the use case for trying to sort anyway? That way, you make doctests different on Python 2 and Python 3 for no good reason.\n\n2. Use dict comprehension instead of `dict((x,y) ....)` for example here:\n\n```\n        vertex_to_index = dict((vertex, i) for i, vertex\n                               in enumerate(vertices))\n```\n\n3. `self._vertex_to_index` seems redundant with `self._vertex_set`. It seems that `self._vertex_to_index` could replace `self._vertex_set`.",
    "created_at": "2019-01-03T20:12:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415754",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:17" align="right">comment:17</div>

1. What's the use case for trying to sort anyway? That way, you make doctests different on Python 2 and Python 3 for no good reason.

2. Use dict comprehension instead of `dict((x,y) ....)` for example here:

```
        vertex_to_index = dict((vertex, i) for i, vertex
                               in enumerate(vertices))
```

3. `self._vertex_to_index` seems redundant with `self._vertex_set`. It seems that `self._vertex_to_index` could replace `self._vertex_set`.



---

archive/issue_comments_415755.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jdemeyer](#comment:17):\n> 1. What's the use case for trying to sort anyway? That way, you make doctests different on Python 2 and Python 3 for no good reason.\n\nI tried without any sorting, but it didn't work well. Various methods rely on sorting: for example, when you take the product of simplicial complexes, if you want to triangulate the product of two edges, there are two choices, and which choice depends on how the vertices are ordered. Another example: when you compute the fundamental group, the presentation of the group depends on how the vertices and edges are sorted. So if nothing is sorted, lots of doctests break and/or the code needs special cases. Why not order if it's easy? Looking to the future when we switch to Python 3, it makes a lot of sense to sort the vertices if the vertices are just integers, and that's what I have in mind in the sorting code.\n\n> 2. Use dict comprehension instead of `dict((x,y) ....)` for example here:\n> \n> ```\n>         vertex_to_index = dict((vertex, i) for i, vertex\n>                                in enumerate(vertices))\n> ```\n\nI can do that. Is this just a stylistic choice, or is it better to use dict comprehension for other reasons?\n \n> 3. `self._vertex_to_index` seems redundant with `self._vertex_set`. It seems that `self._vertex_to_index` could replace `self._vertex_set`.\n\n \nThat shouldn't be hard to do.",
    "created_at": "2019-01-03T22:16:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415755",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jdemeyer](#comment:17):
> 1. What's the use case for trying to sort anyway? That way, you make doctests different on Python 2 and Python 3 for no good reason.

I tried without any sorting, but it didn't work well. Various methods rely on sorting: for example, when you take the product of simplicial complexes, if you want to triangulate the product of two edges, there are two choices, and which choice depends on how the vertices are ordered. Another example: when you compute the fundamental group, the presentation of the group depends on how the vertices and edges are sorted. So if nothing is sorted, lots of doctests break and/or the code needs special cases. Why not order if it's easy? Looking to the future when we switch to Python 3, it makes a lot of sense to sort the vertices if the vertices are just integers, and that's what I have in mind in the sorting code.

> 2. Use dict comprehension instead of `dict((x,y) ....)` for example here:
> 
> ```
>         vertex_to_index = dict((vertex, i) for i, vertex
>                                in enumerate(vertices))
> ```

I can do that. Is this just a stylistic choice, or is it better to use dict comprehension for other reasons?
 
> 3. `self._vertex_to_index` seems redundant with `self._vertex_set`. It seems that `self._vertex_to_index` could replace `self._vertex_set`.

 
That shouldn't be hard to do.



---

archive/issue_comments_415756.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6bb3e28d7a95cc11ec1dd7a1040fca1901d50d8d\"><code>6bb3e28</code></a></td><td><code>trac 26966: Remove vertex_set. Use dict comprehension.</code></td></tr></table>\n",
    "created_at": "2019-01-04T01:14:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415756",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6bb3e28d7a95cc11ec1dd7a1040fca1901d50d8d"><code>6bb3e28</code></a></td><td><code>trac 26966: Remove vertex_set. Use dict comprehension.</code></td></tr></table>




---

archive/issue_comments_415757.json:
```json
{
    "body": "Changed commit from **[`99eec7b`](https://github.com/sagemath/sagetrac-mirror/commit/99eec7ba0857330654daf942d89c9160981bc19b)** to **[`6bb3e28`](https://github.com/sagemath/sagetrac-mirror/commit/6bb3e28d7a95cc11ec1dd7a1040fca1901d50d8d)**",
    "created_at": "2019-01-04T01:14:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415757",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`99eec7b`](https://github.com/sagemath/sagetrac-mirror/commit/99eec7ba0857330654daf942d89c9160981bc19b)** to **[`6bb3e28`](https://github.com/sagemath/sagetrac-mirror/commit/6bb3e28d7a95cc11ec1dd7a1040fca1901d50d8d)**



---

archive/issue_events_367604.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-01-04T01:14:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367604"
}
```



---

archive/issue_events_367605.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2019-01-04T01:14:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367605"
}
```



---

archive/issue_comments_415758.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jhpalmieri](#comment:18):\n> Various methods rely on sorting\n\nWell, that's a problem. If things rely on sorting, then allowing the sort to fail is bad.\n\nI much prefer either always sorting or never sorting to this \"compromise\" of trying to sort.",
    "created_at": "2019-01-04T07:33:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415758",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jhpalmieri](#comment:18):
> Various methods rely on sorting

Well, that's a problem. If things rely on sorting, then allowing the sort to fail is bad.

I much prefer either always sorting or never sorting to this "compromise" of trying to sort.



---

archive/issue_comments_415759.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jdemeyer](#comment:21):\n> Replying to [@jhpalmieri](#comment:18):\n> > Various methods rely on sorting\n\n> \n> Well, that's a problem. If things rely on sorting, then allowing the sort to fail is bad.\n\n\"Bad\" is a bit strong. The answers can vary if the order varies (as will happen if the vertices are unsorted), but the answers will still be mathematically correct.\n \n> I much prefer either always sorting or never sorting to this \"compromise\" of trying to sort.\n\nHow much work should be put into this? You don't like it when I add a fallback to sort using `str`, so what do you suggest? And note that the compromise works pretty well. In practice, most simplicial complexes will have sortable vertices (either integers or tuples of integers). With the current branch, there are only two doctests with unpredictable results in Python 3: the one in `simplicial_set.py` now marked \"random\", and this:\n\n```\n            sage: G = (S1.wedge(S1)).flip_graph()\n            sage: G.vertices(); G.edges(labels=False) # py2\n            [(0, 'L1'), (0, 'L2'), (0, 'R1'), (0, 'R2'), ('L1', 'L2'), ('R1', 'R2')]\n            [((0, 'L1'), (0, 'L2')),\n             ((0, 'L1'), (0, 'R1')),\n             ((0, 'L1'), (0, 'R2')),\n             ((0, 'L1'), ('L1', 'L2')),\n             ((0, 'L2'), (0, 'R1')),\n             ((0, 'L2'), (0, 'R2')),\n             ((0, 'L2'), ('L1', 'L2')),\n             ((0, 'R1'), (0, 'R2')),\n             ((0, 'R1'), ('R1', 'R2')),\n             ((0, 'R2'), ('R1', 'R2'))]\n```\nWith Python 3, the vertices may be ordered randomly, and the same with the edges. Not a big deal, I think.",
    "created_at": "2019-01-04T17:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415759",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jdemeyer](#comment:21):
> Replying to [@jhpalmieri](#comment:18):
> > Various methods rely on sorting

> 
> Well, that's a problem. If things rely on sorting, then allowing the sort to fail is bad.

"Bad" is a bit strong. The answers can vary if the order varies (as will happen if the vertices are unsorted), but the answers will still be mathematically correct.
 
> I much prefer either always sorting or never sorting to this "compromise" of trying to sort.

How much work should be put into this? You don't like it when I add a fallback to sort using `str`, so what do you suggest? And note that the compromise works pretty well. In practice, most simplicial complexes will have sortable vertices (either integers or tuples of integers). With the current branch, there are only two doctests with unpredictable results in Python 3: the one in `simplicial_set.py` now marked "random", and this:

```
            sage: G = (S1.wedge(S1)).flip_graph()
            sage: G.vertices(); G.edges(labels=False) # py2
            [(0, 'L1'), (0, 'L2'), (0, 'R1'), (0, 'R2'), ('L1', 'L2'), ('R1', 'R2')]
            [((0, 'L1'), (0, 'L2')),
             ((0, 'L1'), (0, 'R1')),
             ((0, 'L1'), (0, 'R2')),
             ((0, 'L1'), ('L1', 'L2')),
             ((0, 'L2'), (0, 'R1')),
             ((0, 'L2'), (0, 'R2')),
             ((0, 'L2'), ('L1', 'L2')),
             ((0, 'R1'), (0, 'R2')),
             ((0, 'R1'), ('R1', 'R2')),
             ((0, 'R2'), ('R1', 'R2'))]
```
With Python 3, the vertices may be ordered randomly, and the same with the edges. Not a big deal, I think.



---

archive/issue_comments_415760.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@jhpalmieri](#comment:22):\n> the answers will still be mathematically correct.\n\nOK, in that case I misunderstood what you said in [comment:18].\n\nI would suggest then to not sort and just replace the doctest outputs with the different-but-equally-correct outputs.",
    "created_at": "2019-01-04T18:14:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415760",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@jhpalmieri](#comment:22):
> the answers will still be mathematically correct.

OK, in that case I misunderstood what you said in [comment:18].

I would suggest then to not sort and just replace the doctest outputs with the different-but-equally-correct outputs.



---

archive/issue_comments_415761.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI was wrong about one thing: when you are dealing with the product of a simplicial complex K with itself, you have to sort the vertices in the product consistently with the sorting of the vertices in K, or else the diagonal map may not be defined properly. So we need some sort of sorting. I can see two easy options:\n\n- always sort using `key=str`. Consistent, but '10' comes before '9', which is a little annoying to me.\n- test somehow to see if the vertices can be sorted well. Maybe just test to see if they are integers or tuples of integers (the most common cases) and sort those the default way. Sort using `key=str` in all other cases. I don't know of any way to force Python 2 to behave like Python 3 with regard to sorting. There is no analogue of `from `__future__` import print_function` for sorting, is there?",
    "created_at": "2019-01-08T22:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415761",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

I was wrong about one thing: when you are dealing with the product of a simplicial complex K with itself, you have to sort the vertices in the product consistently with the sorting of the vertices in K, or else the diagonal map may not be defined properly. So we need some sort of sorting. I can see two easy options:

- always sort using `key=str`. Consistent, but '10' comes before '9', which is a little annoying to me.
- test somehow to see if the vertices can be sorted well. Maybe just test to see if they are integers or tuples of integers (the most common cases) and sort those the default way. Sort using `key=str` in all other cases. I don't know of any way to force Python 2 to behave like Python 3 with regard to sorting. There is no analogue of `from `__future__` import print_function` for sorting, is there?



---

archive/issue_comments_415762.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jhpalmieri](#comment:24):\n> - always sort using `key=str`. Consistent, but '10' comes before '9', which is a little annoying to me.\n\nNot guaranteed to be consistent either, since `str()` does not have to be an injective function:\n\n```\nsage: L1 = [1.0 + 2^-52, 1.0]; L2 = reversed(L1)\nsage: sorted(L1, key=str) == sorted(L2, key=str)\nFalse\n```",
    "created_at": "2019-01-09T09:12:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415762",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jhpalmieri](#comment:24):
> - always sort using `key=str`. Consistent, but '10' comes before '9', which is a little annoying to me.

Not guaranteed to be consistent either, since `str()` does not have to be an injective function:

```
sage: L1 = [1.0 + 2^-52, 1.0]; L2 = reversed(L1)
sage: sorted(L1, key=str) == sorted(L2, key=str)
False
```



---

archive/issue_comments_415763.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAny suggestions, then? I suppose we could delete all of the simplicial complex code.",
    "created_at": "2019-01-09T16:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415763",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:26" align="right">comment:26</div>

Any suggestions, then? I suppose we could delete all of the simplicial complex code.



---

archive/issue_comments_415764.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI could do the sort of test you gave: compare `sorted(vertices, key=str)` with `sorted(reversed(vertices), key=str)` (or using whatever key is appropriate). If this is `False`, print a warning when constructing the product of a complex with itself.\n\nI don't know of any other case in which the sorting makes a difference. For homology, for example, the facets are sorted once in the `__init__` method, and that sorting is all that is necessary.",
    "created_at": "2019-01-09T18:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415764",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

I could do the sort of test you gave: compare `sorted(vertices, key=str)` with `sorted(reversed(vertices), key=str)` (or using whatever key is appropriate). If this is `False`, print a warning when constructing the product of a complex with itself.

I don't know of any other case in which the sorting makes a difference. For homology, for example, the facets are sorted once in the `__init__` method, and that sorting is all that is necessary.



---

archive/issue_comments_415765.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAnd to confirm, if I create a simplicial complex with vertices with nonunique string representations and sort always using `key=str`, the diagonal map can break. With my own branch which sorts exclusively by str:\n\n```\nsage: K = SimplicialComplex([[1.0 + 2^-52, 1.0]])\nsage: L = K.product(K)\nsage: d = Hom(K,L).diagonal_morphism()\nsage: d.associated_chain_complex_morphism()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: matrices must define a chain complex morphism\n```\n\nEdit: this case is actually worse because in the product `L`, the vertices are named using string representations, so there is only one vertex, not four, as there should be. (Each vertex is named `'L1.00000000000000R1.00000000000000'`, and since they all have the same name, they are viewed as the same vertex.) You can avoid this as follows:\n\n```\nsage: K = SimplicialComplex([[1.0 + 2^-52, 1.0]])\nsage: L = K.product(K, rename_vertices=False)\nsage: d = Hom(K,L).diagonal_morphism(rename_vertices=False)\nsage: d.associated_chain_complex_morphism()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: matrices must define a chain complex morphism\n```\nNow the names of the vertices cause bad sorting, and so the purported map `d` does not induce a chain map as it should. This is the same problem that arises with other complexes if we don't sort at all.",
    "created_at": "2019-01-09T18:54:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415765",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

And to confirm, if I create a simplicial complex with vertices with nonunique string representations and sort always using `key=str`, the diagonal map can break. With my own branch which sorts exclusively by str:

```
sage: K = SimplicialComplex([[1.0 + 2^-52, 1.0]])
sage: L = K.product(K)
sage: d = Hom(K,L).diagonal_morphism()
sage: d.associated_chain_complex_morphism()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: matrices must define a chain complex morphism
```

Edit: this case is actually worse because in the product `L`, the vertices are named using string representations, so there is only one vertex, not four, as there should be. (Each vertex is named `'L1.00000000000000R1.00000000000000'`, and since they all have the same name, they are viewed as the same vertex.) You can avoid this as follows:

```
sage: K = SimplicialComplex([[1.0 + 2^-52, 1.0]])
sage: L = K.product(K, rename_vertices=False)
sage: d = Hom(K,L).diagonal_morphism(rename_vertices=False)
sage: d.associated_chain_complex_morphism()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: matrices must define a chain complex morphism
```
Now the names of the vertices cause bad sorting, and so the purported map `d` does not induce a chain map as it should. This is the same problem that arises with other complexes if we don't sort at all.



---

archive/issue_comments_415766.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@jhpalmieri](#comment:26):\n> Any suggestions, then? I suppose we could delete all of the simplicial complex code.\n\nAs I suggested several times: just don't sort at all. That's how we have been fixing other sorting-related bugs (for example in incidence structures, graphs, ...).",
    "created_at": "2019-01-10T08:46:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415766",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@jhpalmieri](#comment:26):
> Any suggestions, then? I suppose we could delete all of the simplicial complex code.

As I suggested several times: just don't sort at all. That's how we have been fixing other sorting-related bugs (for example in incidence structures, graphs, ...).



---

archive/issue_comments_415767.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nJeroen - this might need a novel definition for homology to work smoothly...\n\nI'd say: always sort. This \"unsortable\" insanity of py3 has already taken its toll on the progress of porting to py3.",
    "created_at": "2019-01-10T12:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415767",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:30" align="right">comment:30</div>

Jeroen - this might need a novel definition for homology to work smoothly...

I'd say: always sort. This "unsortable" insanity of py3 has already taken its toll on the progress of porting to py3.



---

archive/issue_comments_415768.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@dimpase](#comment:30):\n> Jeroen - this might need a novel definition for homology to work smoothly...\n\nI think you are confusing two kinds of sorting introduced by this ticket.\n\nOne is the sorting using `vertex_to_index` which is perfectly fine. It allows consistent ordering of vertices which is indeed required for homology computations.\n\nThe sorting that I object to is this one:\n\n```\n        try:\n            # If vertices can be sorted, sort them.\n            vertices = tuple(sorted(vertices))\n        except TypeError:\n            pass\n```\nThis shouldn't be needed for anything. It also adds (rather than solves) problems with porting to Python 3 since this code behaves differently on Python 2 and Python 3.",
    "created_at": "2019-01-10T12:41:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415768",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@dimpase](#comment:30):
> Jeroen - this might need a novel definition for homology to work smoothly...

I think you are confusing two kinds of sorting introduced by this ticket.

One is the sorting using `vertex_to_index` which is perfectly fine. It allows consistent ordering of vertices which is indeed required for homology computations.

The sorting that I object to is this one:

```
        try:
            # If vertices can be sorted, sort them.
            vertices = tuple(sorted(vertices))
        except TypeError:
            pass
```
This shouldn't be needed for anything. It also adds (rather than solves) problems with porting to Python 3 since this code behaves differently on Python 2 and Python 3.



---

archive/issue_comments_415769.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThe vertex sorting is needed but just for one thing: for the diagonal map `X -> X x X` to be defined properly. If you sort the vertices in the product incompatibly with the sorting in the original simplicial complex, you can end up with a square triangulated the wrong way, so the diagonal map is not a map of simplicial complexes. So you really do need to sort the vertices.\n\nAs Jeroen says in his last comment, the `vertex_to_index` dictionary is sufficient sorting for homology.",
    "created_at": "2019-01-10T16:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415769",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">comment:32</div>

The vertex sorting is needed but just for one thing: for the diagonal map `X -> X x X` to be defined properly. If you sort the vertices in the product incompatibly with the sorting in the original simplicial complex, you can end up with a square triangulated the wrong way, so the diagonal map is not a map of simplicial complexes. So you really do need to sort the vertices.

As Jeroen says in his last comment, the `vertex_to_index` dictionary is sufficient sorting for homology.



---

archive/issue_comments_415770.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nOr maybe there is a way to use the `vertex_to_index` sorting when defining the product, although that take some work to implement. I'll have to think about that.",
    "created_at": "2019-01-10T16:09:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415770",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:33" align="right">comment:33</div>

Or maybe there is a way to use the `vertex_to_index` sorting when defining the product, although that take some work to implement. I'll have to think about that.



---

archive/issue_comments_415771.json:
```json
{
    "body": "Changed commit from **[`6bb3e28`](https://github.com/sagemath/sagetrac-mirror/commit/6bb3e28d7a95cc11ec1dd7a1040fca1901d50d8d)** to **[`f4a672c`](https://github.com/sagemath/sagetrac-mirror/commit/f4a672c94202bae95cb00c07e7318211f50ca9b0)**",
    "created_at": "2019-01-11T23:09:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415771",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6bb3e28`](https://github.com/sagemath/sagetrac-mirror/commit/6bb3e28d7a95cc11ec1dd7a1040fca1901d50d8d)** to **[`f4a672c`](https://github.com/sagemath/sagetrac-mirror/commit/f4a672c94202bae95cb00c07e7318211f50ca9b0)**



---

archive/issue_comments_415772.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29ade7e2a0b376e2cf203ef7aa6126b094db5666\"><code>29ade7e</code></a></td><td><code>trac 26966: simplicial complexes: do not publicly sort vertices any more.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b32535053b87455000c3f6b6f227b5d436c295ca\"><code>b325350</code></a></td><td><code>trac 26966: Remove vertex_set. Use dict comprehension.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e79fd391f07fb49fd5bee4fbace4d1258065a5db\"><code>e79fd39</code></a></td><td><code>trac 26966: always sort vertices using key=str</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4a672c94202bae95cb00c07e7318211f50ca9b0\"><code>f4a672c</code></a></td><td><code>trac 26966: do not sort vertices. Allow the user to specify sort_facets,</code></td></tr></table>\n",
    "created_at": "2019-01-11T23:09:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415772",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29ade7e2a0b376e2cf203ef7aa6126b094db5666"><code>29ade7e</code></a></td><td><code>trac 26966: simplicial complexes: do not publicly sort vertices any more.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b32535053b87455000c3f6b6f227b5d436c295ca"><code>b325350</code></a></td><td><code>trac 26966: Remove vertex_set. Use dict comprehension.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e79fd391f07fb49fd5bee4fbace4d1258065a5db"><code>e79fd39</code></a></td><td><code>trac 26966: always sort vertices using key=str</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4a672c94202bae95cb00c07e7318211f50ca9b0"><code>f4a672c</code></a></td><td><code>trac 26966: do not sort vertices. Allow the user to specify sort_facets,</code></td></tr></table>




---

archive/issue_comments_415773.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThe last commit undoes a large part of the previous one, but oh well. This now does not sort vertices at all. It uses `sort_facets` as an optional argument to allow users to specify the dictionary which converts vertices to integers. This optional argument is only used when taking the product of a simplicial complex with itself. A few doctests had to be changed. In some cases, I knew what they were testing and could provide suitable replacements. In one (for `flip_graph`), it wasn't clear what the point was, so I replaced with something that I think captures the right spirit.",
    "created_at": "2019-01-11T23:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415773",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

The last commit undoes a large part of the previous one, but oh well. This now does not sort vertices at all. It uses `sort_facets` as an optional argument to allow users to specify the dictionary which converts vertices to integers. This optional argument is only used when taking the product of a simplicial complex with itself. A few doctests had to be changed. In some cases, I knew what they were testing and could provide suitable replacements. In one (for `flip_graph`), it wasn't clear what the point was, so I replaced with something that I think captures the right spirit.



---

archive/issue_comments_415774.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41eeaf587878efcdec3499b49353bfe1dfeb7993\"><code>41eeaf5</code></a></td><td><code>typo</code></td></tr></table>\n",
    "created_at": "2019-01-11T23:13:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415774",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41eeaf587878efcdec3499b49353bfe1dfeb7993"><code>41eeaf5</code></a></td><td><code>typo</code></td></tr></table>




---

archive/issue_comments_415775.json:
```json
{
    "body": "Changed commit from **[`f4a672c`](https://github.com/sagemath/sagetrac-mirror/commit/f4a672c94202bae95cb00c07e7318211f50ca9b0)** to **[`41eeaf5`](https://github.com/sagemath/sagetrac-mirror/commit/41eeaf587878efcdec3499b49353bfe1dfeb7993)**",
    "created_at": "2019-01-11T23:13:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415775",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f4a672c`](https://github.com/sagemath/sagetrac-mirror/commit/f4a672c94202bae95cb00c07e7318211f50ca9b0)** to **[`41eeaf5`](https://github.com/sagemath/sagetrac-mirror/commit/41eeaf587878efcdec3499b49353bfe1dfeb7993)**



---

archive/issue_comments_415776.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI made a few other changes in here. For example, the change\n\n```diff\n@@ -1692,10 +1708,7 @@ class SimplicialComplex(Parent, GenericCellComplex):\n         # construct a graph with one vertex for each facet, one edge\n         # when two facets intersect in a (d-1)-simplex, and see\n         # whether that graph is connected.\n-        V = [f.set() for f in self.facets()]\n-        E = (lambda a, b: len(a.intersection(b)) == d)\n-        g = Graph([V, E])\n-        return g.is_connected()\n+        return self.flip_graph().is_connected()\n \n     def product(self, right, rename_vertices=True, is_mutable=True):\n         \"\"\"\n```\nis an attempt to make the documentation for `flip_graph` correct: it says <code>The flip graph is used to detect if \\`\\`self\\`\\` is a pseudomanifold.</code>",
    "created_at": "2019-01-11T23:18:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415776",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

I made a few other changes in here. For example, the change

```diff
@@ -1692,10 +1708,7 @@ class SimplicialComplex(Parent, GenericCellComplex):
         # construct a graph with one vertex for each facet, one edge
         # when two facets intersect in a (d-1)-simplex, and see
         # whether that graph is connected.
-        V = [f.set() for f in self.facets()]
-        E = (lambda a, b: len(a.intersection(b)) == d)
-        g = Graph([V, E])
-        return g.is_connected()
+        return self.flip_graph().is_connected()
 
     def product(self, right, rename_vertices=True, is_mutable=True):
         """
```
is an attempt to make the documentation for `flip_graph` correct: it says <code>The flip graph is used to detect if \`\`self\`\` is a pseudomanifold.</code>



---

archive/issue_comments_415777.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nBy the way, a few doctests were changed from a known output to a random output or to ellipses. In these cases, the answer will depend on, for example, how the vertices are sorted in\n\n```\nvertex_to_index = {v:i for i,v in enumerate(vertices)}\n```\nwhich is more or less random. It can certainly depend on whether you are using Python 2 vs. Python 3, and at least with Python 3, it will be random.",
    "created_at": "2019-01-11T23:30:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415777",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:38" align="right">comment:38</div>

By the way, a few doctests were changed from a known output to a random output or to ellipses. In these cases, the answer will depend on, for example, how the vertices are sorted in

```
vertex_to_index = {v:i for i,v in enumerate(vertices)}
```
which is more or less random. It can certainly depend on whether you are using Python 2 vs. Python 3, and at least with Python 3, it will be random.



---

archive/issue_comments_415778.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nSome minor comments:\n\nInstead of `lambda x: vertex_to_index[x]`, you can use `vertex_to_index.__getitem__` (which I believe is faster).\n\nAlso, this `try` block is if the `max` is empty, right:\n\n```diff\n        try:\n            idx = max(vertex_to_index.values()) + 1\n        except ValueError:\n            idx = 0\n```\nso you should be able to do this:\n\n```python\n        if vertex_to_index:\n            idx = max(vertex_to_index.values()) + 1\n        else:\n            idx = 0\n```\n\nI would pull out the `self._translation_to_numeric()` call here so it is not called on every `key` call:\n\n```\nsimplex = Simplex(sorted(face, key=lambda x: self._translation_to_numeric()[x]))\n```\n\nI think the latter syntax is easier to read (IIRC, it is also a little faster too):\n\n```diff\n-dict((g, i) for i, g in enumerate(gens))\n+{g: i for i, g in enumerate(gens)}\n```\nYou might also be able to simply do `dict(enumerate(gens))` too.",
    "created_at": "2019-01-13T17:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415778",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:39" align="right">comment:39</div>

Some minor comments:

Instead of `lambda x: vertex_to_index[x]`, you can use `vertex_to_index.__getitem__` (which I believe is faster).

Also, this `try` block is if the `max` is empty, right:

```diff
        try:
            idx = max(vertex_to_index.values()) + 1
        except ValueError:
            idx = 0
```
so you should be able to do this:

```python
        if vertex_to_index:
            idx = max(vertex_to_index.values()) + 1
        else:
            idx = 0
```

I would pull out the `self._translation_to_numeric()` call here so it is not called on every `key` call:

```
simplex = Simplex(sorted(face, key=lambda x: self._translation_to_numeric()[x]))
```

I think the latter syntax is easier to read (IIRC, it is also a little faster too):

```diff
-dict((g, i) for i, g in enumerate(gens))
+{g: i for i, g in enumerate(gens)}
```
You might also be able to simply do `dict(enumerate(gens))` too.



---

archive/issue_comments_415779.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95f6026404128b5fb82ddc27aa741fd2c20a4978\"><code>95f6026</code></a></td><td><code>trac 26966: minor code cleanup</code></td></tr></table>\n",
    "created_at": "2019-01-13T19:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415779",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95f6026404128b5fb82ddc27aa741fd2c20a4978"><code>95f6026</code></a></td><td><code>trac 26966: minor code cleanup</code></td></tr></table>




---

archive/issue_comments_415780.json:
```json
{
    "body": "Changed commit from **[`41eeaf5`](https://github.com/sagemath/sagetrac-mirror/commit/41eeaf587878efcdec3499b49353bfe1dfeb7993)** to **[`95f6026`](https://github.com/sagemath/sagetrac-mirror/commit/95f6026404128b5fb82ddc27aa741fd2c20a4978)**",
    "created_at": "2019-01-13T19:38:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415780",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`41eeaf5`](https://github.com/sagemath/sagetrac-mirror/commit/41eeaf587878efcdec3499b49353bfe1dfeb7993)** to **[`95f6026`](https://github.com/sagemath/sagetrac-mirror/commit/95f6026404128b5fb82ddc27aa741fd2c20a4978)**



---

archive/issue_comments_415781.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nReplying to [@tscrim](#comment:39):\n> Some minor comments:\n\n[snip]\n \n> I think the latter syntax is easier to read (IIRC, it is also a little faster too):\n> \n> ```diff\n> -dict((g, i) for i, g in enumerate(gens))\n> +{g: i for i, g in enumerate(gens)}\n> ```\n> You might also be able to simply do `dict(enumerate(gens))` too.\n\nI agree with everything except the very last sentence: `dict(enumerate(gens))` would be equivalent to `{i:g for i,g in enumerate(gens)}`, but I want `g:i`, not `i:g`.",
    "created_at": "2019-01-13T19:38:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415781",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:41" align="right">comment:41</div>

Replying to [@tscrim](#comment:39):
> Some minor comments:

[snip]
 
> I think the latter syntax is easier to read (IIRC, it is also a little faster too):
> 
> ```diff
> -dict((g, i) for i, g in enumerate(gens))
> +{g: i for i, g in enumerate(gens)}
> ```
> You might also be able to simply do `dict(enumerate(gens))` too.

I agree with everything except the very last sentence: `dict(enumerate(gens))` would be equivalent to `{i:g for i,g in enumerate(gens)}`, but I want `g:i`, not `i:g`.



---

archive/issue_comments_415782.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@jhpalmieri](#comment:41):\n> Replying to [@tscrim](#comment:39):\n> > I think the latter syntax is easier to read (IIRC, it is also a little faster too):\n> > \n> > ```diff\n> > -dict((g, i) for i, g in enumerate(gens))\n> > +{g: i for i, g in enumerate(gens)}\n> > ```\n> > You might also be able to simply do `dict(enumerate(gens))` too.\n\n> \n> I agree with everything except the very last sentence: `dict(enumerate(gens))` would be equivalent to `{i:g for i,g in enumerate(gens)}`, but I want `g:i`, not `i:g`.\n\nAh, right. I will try to finish the review in a day or two.",
    "created_at": "2019-01-13T20:29:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415782",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@jhpalmieri](#comment:41):
> Replying to [@tscrim](#comment:39):
> > I think the latter syntax is easier to read (IIRC, it is also a little faster too):
> > 
> > ```diff
> > -dict((g, i) for i, g in enumerate(gens))
> > +{g: i for i, g in enumerate(gens)}
> > ```
> > You might also be able to simply do `dict(enumerate(gens))` too.

> 
> I agree with everything except the very last sentence: `dict(enumerate(gens))` would be equivalent to `{i:g for i,g in enumerate(gens)}`, but I want `g:i`, not `i:g`.

Ah, right. I will try to finish the review in a day or two.



---

archive/issue_comments_415783.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415783",
    "user": "https://github.com/embray"
}
```

<div id="comment:43" align="right">comment:43</div>

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_events_367606.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367606"
}
```



---

archive/issue_events_367607.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367607"
}
```



---

archive/issue_comments_415784.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nTwo additional things; everything else LGTM.\n\n- `return tuple(self._vertex_to_index.keys())` is better as `return tuple(self._vertex_to_index)`\n- In `product`, is there some way we can avoid creating two simplicial complexes? I imagine it is slower to do it twice. Why not for the first case return the simplicial complex and for the second use the `facets`?",
    "created_at": "2019-01-15T22:41:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415784",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:44" align="right">comment:44</div>

Two additional things; everything else LGTM.

- `return tuple(self._vertex_to_index.keys())` is better as `return tuple(self._vertex_to_index)`
- In `product`, is there some way we can avoid creating two simplicial complexes? I imagine it is slower to do it twice. Why not for the first case return the simplicial complex and for the second use the `facets`?



---

archive/issue_comments_415785.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@tscrim](#comment:44):\n> Two additional things; everything else LGTM.\n> \n> - `return tuple(self._vertex_to_index.keys())` is better as `return tuple(self._vertex_to_index)`\n\nSure, sounds good.\n\n> - In `product`, is there some way we can avoid creating two simplicial complexes? I imagine it is slower to do it twice. Why not for the first case return the simplicial complex and for the second use the `facets`?\n\nYes. I think when I first wrote this, I was going to use something produced by the `__init__` method and so I was constructing the simplicial complex to avoid code duplication. That doesn't seem to be the case any more, so you're right, I can just use `facets` in the second case.",
    "created_at": "2019-01-15T23:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415785",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@tscrim](#comment:44):
> Two additional things; everything else LGTM.
> 
> - `return tuple(self._vertex_to_index.keys())` is better as `return tuple(self._vertex_to_index)`

Sure, sounds good.

> - In `product`, is there some way we can avoid creating two simplicial complexes? I imagine it is slower to do it twice. Why not for the first case return the simplicial complex and for the second use the `facets`?

Yes. I think when I first wrote this, I was going to use something produced by the `__init__` method and so I was constructing the simplicial complex to avoid code duplication. That doesn't seem to be the case any more, so you're right, I can just use `facets` in the second case.



---

archive/issue_comments_415786.json:
```json
{
    "body": "Changed commit from **[`95f6026`](https://github.com/sagemath/sagetrac-mirror/commit/95f6026404128b5fb82ddc27aa741fd2c20a4978)** to **[`3da1d0f`](https://github.com/sagemath/sagetrac-mirror/commit/3da1d0f108449360fb575d64be78eacf89109cd3)**",
    "created_at": "2019-01-15T23:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415786",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`95f6026`](https://github.com/sagemath/sagetrac-mirror/commit/95f6026404128b5fb82ddc27aa741fd2c20a4978)** to **[`3da1d0f`](https://github.com/sagemath/sagetrac-mirror/commit/3da1d0f108449360fb575d64be78eacf89109cd3)**



---

archive/issue_comments_415787.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3da1d0f108449360fb575d64be78eacf89109cd3\"><code>3da1d0f</code></a></td><td><code>trac 26966: following reviewer suggestions to simplify a little code.</code></td></tr></table>\n",
    "created_at": "2019-01-15T23:12:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415787",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3da1d0f108449360fb575d64be78eacf89109cd3"><code>3da1d0f</code></a></td><td><code>trac 26966: following reviewer suggestions to simplify a little code.</code></td></tr></table>




---

archive/issue_comments_415788.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nThanks.",
    "created_at": "2019-01-16T00:26:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415788",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:47" align="right">comment:47</div>

Thanks.



---

archive/issue_events_367608.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-16T00:26:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367608"
}
```



---

archive/issue_events_367609.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-16T00:26:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367609"
}
```



---

archive/issue_comments_415789.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer, Travis Scrimshaw**",
    "created_at": "2019-01-16T00:26:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415789",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Jeroen Demeyer, Travis Scrimshaw**



---

archive/issue_comments_415790.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nGreat, thanks for reviewing!",
    "created_at": "2019-01-16T00:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415790",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:48" align="right">comment:48</div>

Great, thanks for reviewing!



---

archive/issue_events_367610.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T15:39:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367610"
}
```



---

archive/issue_events_367611.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4a7f20f5626a7813257ef4e386df5491447ea350",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-01-23T15:39:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26966#event-367611"
}
```



---

archive/issue_comments_415791.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/sorting-simplicial-complexes](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sorting-simplicial-complexes)** to **[`3da1d0f`](https://github.com/sagemath/sagetrac-mirror/commit/3da1d0f108449360fb575d64be78eacf89109cd3)**",
    "created_at": "2019-01-23T15:39:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26966#issuecomment-415791",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/sorting-simplicial-complexes](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sorting-simplicial-complexes)** to **[`3da1d0f`](https://github.com/sagemath/sagetrac-mirror/commit/3da1d0f108449360fb575d64be78eacf89109cd3)**
