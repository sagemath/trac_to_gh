# Issue 26434: Do not require installed_packages() to work for three.js inclusion & show a warning if three.js cannot be found locally

archive/issues_026197.json:
```json
{
    "assignees": [],
    "body": "On conda, we are seeing failing doctests because installed_packages() is used:\n\n```\nFile \"src/sage/plot/plot3d/base.pyx\", line 361, in sage.plot.plot3d.base.Graphics3d._rich_repr_threejs\nFailed example:\n    sphere(online=True)._rich_repr_threejs()\nException raised:\n    Traceback (most recent call last):\n      File \"/builds/saraedum/conda-sagelib-tests/sagemath/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 573, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/builds/saraedum/conda-sagelib-tests/sagemath/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 983, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.plot.plot3d.base.Graphics3d._rich_repr_threejs[0]>\", line 1, in <module>\n        sphere(online=True)._rich_repr_threejs()\n      File \"sage/plot/plot3d/base.pyx\", line 377, in sage.plot.plot3d.base.Graphics3d._rich_repr_threejs (build/cythonized/sage/plot/plot3d/base.c:9311)\n        scripts = get_display_manager().threejs_scripts(options['online'])\n      File \"/builds/saraedum/conda-sagelib-tests/sagemath/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 749, in threejs_scripts\n        version = installed_packages()['threejs'].split('.')[0]\n    KeyError: 'threejs'\n```\n\nThis ticket aims to make installed_packages() here optional but also to simplify the threejs inclusion code that appears to have been duplicated and has since diverged.\n\nIf you think that this is fixing two separate issues and should be split into two separate tickets, feel free to make such a change.\n\nCC:  @timokau @kiwifb @antonio-rojas @egourgoulhon\n\nKeywords: **threejs, conda, installed_packages**\n\nBranch/Commit: **[u/saraedum/26434](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/26434) @ [`be72dbe`](https://github.com/sagemath/sagetrac-mirror/commit/be72dbe9745aae80e364912f0f9c9300de3b9a56)**\n\nWork Issues: **needs testing - but is the general approach ok?**\n\nReviewer: **Paul Masson**\n\nAuthor: **Julian R\u00fcth**\n\nComponent: **distribution**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26434_\n\n",
    "closed_at": "2020-06-23T06:15:16Z",
    "created_at": "2018-10-08T22:23:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20distribution",
        "https://github.com/sagemath/sage/labels/duplicate",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Do not require installed_packages() to work for three.js inclusion & show a warning if three.js cannot be found locally",
    "type": "issue",
    "updated_at": "2020-06-23T06:15:16Z",
    "url": "https://github.com/sagemath/sage/issues/26434",
    "user": "https://github.com/saraedum"
}
```
On conda, we are seeing failing doctests because installed_packages() is used:

```
File "src/sage/plot/plot3d/base.pyx", line 361, in sage.plot.plot3d.base.Graphics3d._rich_repr_threejs
Failed example:
    sphere(online=True)._rich_repr_threejs()
Exception raised:
    Traceback (most recent call last):
      File "/builds/saraedum/conda-sagelib-tests/sagemath/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 573, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/builds/saraedum/conda-sagelib-tests/sagemath/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 983, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.plot.plot3d.base.Graphics3d._rich_repr_threejs[0]>", line 1, in <module>
        sphere(online=True)._rich_repr_threejs()
      File "sage/plot/plot3d/base.pyx", line 377, in sage.plot.plot3d.base.Graphics3d._rich_repr_threejs (build/cythonized/sage/plot/plot3d/base.c:9311)
        scripts = get_display_manager().threejs_scripts(options['online'])
      File "/builds/saraedum/conda-sagelib-tests/sagemath/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 749, in threejs_scripts
        version = installed_packages()['threejs'].split('.')[0]
    KeyError: 'threejs'
```

This ticket aims to make installed_packages() here optional but also to simplify the threejs inclusion code that appears to have been duplicated and has since diverged.

If you think that this is fixing two separate issues and should be split into two separate tickets, feel free to make such a change.

CC:  @timokau @kiwifb @antonio-rojas @egourgoulhon

Keywords: **threejs, conda, installed_packages**

Branch/Commit: **[u/saraedum/26434](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/26434) @ [`be72dbe`](https://github.com/sagemath/sagetrac-mirror/commit/be72dbe9745aae80e364912f0f9c9300de3b9a56)**

Work Issues: **needs testing - but is the general approach ok?**

Reviewer: **Paul Masson**

Author: **Julian Rüth**

Component: **distribution**

_Issue created by migration from https://trac.sagemath.org/ticket/26434_





---

archive/issue_events_365821.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-10-08T22:23:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365821"
}
```



---

archive/issue_events_365822.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-10-08T22:23:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20distribution",
    "label_color": "000080",
    "label_name": "c: distribution",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365822"
}
```



---

archive/issue_events_365823.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-10-08T22:23:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365823"
}
```



---

archive/issue_events_365824.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-10-08T22:23:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365824"
}
```



---

archive/issue_comments_407359.json:
```json
{
    "body": "Branch: **[u/saraedum/26434](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/26434)**",
    "created_at": "2018-10-08T22:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407359",
    "user": "https://github.com/saraedum"
}
```

Branch: **[u/saraedum/26434](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/26434)**



---

archive/issue_comments_407360.json:
```json
{
    "body": "Commit: **[`9ea40f2`](https://github.com/sagemath/sagetrac-mirror/commit/9ea40f299351b4907da3b2f3b7fb93af0de7a184)**",
    "created_at": "2018-10-08T22:24:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407360",
    "user": "https://github.com/saraedum"
}
```

Commit: **[`9ea40f2`](https://github.com/sagemath/sagetrac-mirror/commit/9ea40f299351b4907da3b2f3b7fb93af0de7a184)**



---

archive/issue_comments_407361.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI CCed the usual packaging suspects; I have not tested this at all (Sage is rebuilding\u2026)\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9ea40f299351b4907da3b2f3b7fb93af0de7a184\"><code>9ea40f2</code></a></td><td><code>Make three.js inclusion packager friendly</code></td></tr></table>\n",
    "created_at": "2018-10-08T22:24:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407361",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:2" align="right">comment:2</div>

I CCed the usual packaging suspects; I have not tested this at all (Sage is rebuilding…)

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9ea40f299351b4907da3b2f3b7fb93af0de7a184"><code>9ea40f2</code></a></td><td><code>Make three.js inclusion packager friendly</code></td></tr></table>




---

archive/issue_comments_407362.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5aa1b44d0f2ca87237bd7173f49350a5a13bce03\"><code>5aa1b44</code></a></td><td><code>Make three.js inclusion packager friendly</code></td></tr></table>\n",
    "created_at": "2018-10-08T22:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407362",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5aa1b44d0f2ca87237bd7173f49350a5a13bce03"><code>5aa1b44</code></a></td><td><code>Make three.js inclusion packager friendly</code></td></tr></table>




---

archive/issue_comments_407363.json:
```json
{
    "body": "Changed commit from **[`9ea40f2`](https://github.com/sagemath/sagetrac-mirror/commit/9ea40f299351b4907da3b2f3b7fb93af0de7a184)** to **[`5aa1b44`](https://github.com/sagemath/sagetrac-mirror/commit/5aa1b44d0f2ca87237bd7173f49350a5a13bce03)**",
    "created_at": "2018-10-08T22:28:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407363",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9ea40f2`](https://github.com/sagemath/sagetrac-mirror/commit/9ea40f299351b4907da3b2f3b7fb93af0de7a184)** to **[`5aa1b44`](https://github.com/sagemath/sagetrac-mirror/commit/5aa1b44d0f2ca87237bd7173f49350a5a13bce03)**



---

archive/issue_comments_407364.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIdeally we would have a threejs config helper reporting its own version. That's the pipedream.",
    "created_at": "2018-10-08T22:38:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407364",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

Ideally we would have a threejs config helper reporting its own version. That's the pipedream.



---

archive/issue_comments_407365.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI looked into making threejs a feature and reporting the version there. But it appears that threejs has no version information readily available. Even if it had that information I am not sure what we would do with it. Requiring `r80` seems to be wrong as we are using a very small subset of threejs so I suspect that almost any version of threejs would work.",
    "created_at": "2018-10-08T22:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407365",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:5" align="right">comment:5</div>

I looked into making threejs a feature and reporting the version there. But it appears that threejs has no version information readily available. Even if it had that information I am not sure what we would do with it. Requiring `r80` seems to be wrong as we are using a very small subset of threejs so I suspect that almost any version of threejs would work.



---

archive/issue_comments_407366.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI agree, I think `master` is the one that give you the latest online. But the idea that you should use exactly the same version on and offline is not unsensible in itself.",
    "created_at": "2018-10-08T22:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407366",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

I agree, I think `master` is the one that give you the latest online. But the idea that you should use exactly the same version on and offline is not unsensible in itself.



---

archive/issue_comments_407367.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nWhy doesn't the example\n\n```\nget_display_manager().threejs_scripts(from_cdn=True)\n```\n\nrequire an `# optional - internet` tag? Apparently it doesn't becasue it didn't have one before either, but it seems like it should?\n\n> But it appears that threejs has no version information readily available.\n\nGrep shows that at least on nix the version is present in `package.json` and `package-lock.json`. Not sure if that is build system specific or anything.\n\nWhy would anyone want to use the CDN version anyways?",
    "created_at": "2018-10-09T15:40:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407367",
    "user": "https://github.com/timokau"
}
```

<div id="comment:7" align="right">comment:7</div>

Why doesn't the example

```
get_display_manager().threejs_scripts(from_cdn=True)
```

require an `# optional - internet` tag? Apparently it doesn't becasue it didn't have one before either, but it seems like it should?

> But it appears that threejs has no version information readily available.

Grep shows that at least on nix the version is present in `package.json` and `package-lock.json`. Not sure if that is build system specific or anything.

Why would anyone want to use the CDN version anyways?



---

archive/issue_comments_407368.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@timokau](#comment:7):\n> Why doesn't the example\n> \n> ```\n> get_display_manager().threejs_scripts(from_cdn=True)\n> ```\n> \n> require an `# optional - internet` tag? Apparently it doesn't becasue it didn't have one before either, but it seems like it should?\n\nThis just generates `<script>` tags. It doesn't download the scripts that these tags refer to.\n\n\n> > But it appears that threejs has no version information readily available.\n\n> Grep shows that at least on nix the version is present in `package.json` and `package-lock.json`. Not sure if that is build system specific or anything.\n\nThese files are npm metadata. I don't think that all disrtibutions include them.\n\n> Why would anyone want to use the CDN version anyways?\n\nWe could remove the CDN option but it's probably there for a reason.\nWhy would you want to use it? Well \"it feels right\" from a web-dev perspective...maybe you don't have threejs installed (in a compatible version)? Or you want to publish this somewhere online and don't want to serve all these script tags yourself?",
    "created_at": "2018-10-09T15:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407368",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@timokau](#comment:7):
> Why doesn't the example
> 
> ```
> get_display_manager().threejs_scripts(from_cdn=True)
> ```
> 
> require an `# optional - internet` tag? Apparently it doesn't becasue it didn't have one before either, but it seems like it should?

This just generates `<script>` tags. It doesn't download the scripts that these tags refer to.


> > But it appears that threejs has no version information readily available.

> Grep shows that at least on nix the version is present in `package.json` and `package-lock.json`. Not sure if that is build system specific or anything.

These files are npm metadata. I don't think that all disrtibutions include them.

> Why would anyone want to use the CDN version anyways?

We could remove the CDN option but it's probably there for a reason.
Why would you want to use it? Well "it feels right" from a web-dev perspective...maybe you don't have threejs installed (in a compatible version)? Or you want to publish this somewhere online and don't want to serve all these script tags yourself?



---

archive/issue_comments_407369.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nMakes sense. These changes look good to me, if the doctests pass. Definite improvement, thank you!",
    "created_at": "2018-10-09T15:59:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407369",
    "user": "https://github.com/timokau"
}
```

<div id="comment:9" align="right">comment:9</div>

Makes sense. These changes look good to me, if the doctests pass. Definite improvement, thank you!



---

archive/issue_comments_407370.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ec0979ee4eedf068f9bbb2fd91b1a26f59d7dc6\"><code>2ec0979</code></a></td><td><code>Import missing modules for threejs changes</code></td></tr></table>\n",
    "created_at": "2018-10-10T11:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407370",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ec0979ee4eedf068f9bbb2fd91b1a26f59d7dc6"><code>2ec0979</code></a></td><td><code>Import missing modules for threejs changes</code></td></tr></table>




---

archive/issue_comments_407371.json:
```json
{
    "body": "Changed commit from **[`5aa1b44`](https://github.com/sagemath/sagetrac-mirror/commit/5aa1b44d0f2ca87237bd7173f49350a5a13bce03)** to **[`2ec0979`](https://github.com/sagemath/sagetrac-mirror/commit/2ec0979ee4eedf068f9bbb2fd91b1a26f59d7dc6)**",
    "created_at": "2018-10-10T11:07:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407371",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5aa1b44`](https://github.com/sagemath/sagetrac-mirror/commit/5aa1b44d0f2ca87237bd7173f49350a5a13bce03)** to **[`2ec0979`](https://github.com/sagemath/sagetrac-mirror/commit/2ec0979ee4eedf068f9bbb2fd91b1a26f59d7dc6)**



---

archive/issue_comments_407372.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI checked that this still works in jupyter and in sagenb. Let's see what the patchbots think about it.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2ec0979ee4eedf068f9bbb2fd91b1a26f59d7dc6\"><code>2ec0979</code></a></td><td><code>Import missing modules for threejs changes</code></td></tr></table>\n",
    "created_at": "2018-10-10T11:09:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407372",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:11" align="right">comment:11</div>

I checked that this still works in jupyter and in sagenb. Let's see what the patchbots think about it.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2ec0979ee4eedf068f9bbb2fd91b1a26f59d7dc6"><code>2ec0979</code></a></td><td><code>Import missing modules for threejs changes</code></td></tr></table>




---

archive/issue_events_365825.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-02-16T14:48:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365825"
}
```



---

archive/issue_comments_407373.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\ngh-timokau, does this mean that we can set this to positive review now?",
    "created_at": "2019-02-16T14:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407373",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:13" align="right">comment:13</div>

gh-timokau, does this mean that we can set this to positive review now?



---

archive/issue_comments_407374.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHm\u2026now I am confused with the current discussion on sage-devel whether this would change the `online` keyword of `show()` to `from_cdn`\u2026",
    "created_at": "2019-02-16T14:53:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407374",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:14" align="right">comment:14</div>

Hm…now I am confused with the current discussion on sage-devel whether this would change the `online` keyword of `show()` to `from_cdn`…



---

archive/issue_comments_407375.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI don't know enough about three.js usages to give it a proper review myself, but I don't have any objections.",
    "created_at": "2019-02-16T14:56:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407375",
    "user": "https://github.com/timokau"
}
```

<div id="comment:15" align="right">comment:15</div>

I don't know enough about three.js usages to give it a proper review myself, but I don't have any objections.



---

archive/issue_comments_407376.json:
```json
{
    "body": "Changed commit from **[`2ec0979`](https://github.com/sagemath/sagetrac-mirror/commit/2ec0979ee4eedf068f9bbb2fd91b1a26f59d7dc6)** to **[`1b27f44`](https://github.com/sagemath/sagetrac-mirror/commit/1b27f44f52a36ac8d548f787c09cf61f5ec5aede)**",
    "created_at": "2019-02-16T15:45:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407376",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2ec0979`](https://github.com/sagemath/sagetrac-mirror/commit/2ec0979ee4eedf068f9bbb2fd91b1a26f59d7dc6)** to **[`1b27f44`](https://github.com/sagemath/sagetrac-mirror/commit/1b27f44f52a36ac8d548f787c09cf61f5ec5aede)**



---

archive/issue_comments_407377.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5bc086236a4db0772df0cadc046fcbc850a3d887\"><code>5bc0862</code></a></td><td><code>Detect missing three.js</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3d28f36ae10051ff937b04a001e2fd7cffad69a\"><code>a3d28f3</code></a></td><td><code>Support online parameter name</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b27f44f52a36ac8d548f787c09cf61f5ec5aede\"><code>1b27f44</code></a></td><td><code>fix typo</code></td></tr></table>\n",
    "created_at": "2019-02-16T15:45:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407377",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5bc086236a4db0772df0cadc046fcbc850a3d887"><code>5bc0862</code></a></td><td><code>Detect missing three.js</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3d28f36ae10051ff937b04a001e2fd7cffad69a"><code>a3d28f3</code></a></td><td><code>Support online parameter name</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b27f44f52a36ac8d548f787c09cf61f5ec5aede"><code>1b27f44</code></a></td><td><code>fix typo</code></td></tr></table>




---

archive/issue_comments_407378.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,3 +20,5 @@\n ```\n \n This ticket aims to make installed_packages() here optional but also to simplify the threejs inclusion code that appears to have been duplicated and has since diverged.\n+\n+If you think that this is fixing two separate issues and should be split into two separate tickets, feel free to make such a change.\n``````\n",
    "created_at": "2019-02-16T15:47:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407378",
    "user": "https://github.com/saraedum"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,3 +20,5 @@
 ```
 
 This ticket aims to make installed_packages() here optional but also to simplify the threejs inclusion code that appears to have been duplicated and has since diverged.
+
+If you think that this is fixing two separate issues and should be split into two separate tickets, feel free to make such a change.
``````




---

archive/issue_events_365826.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-02-16T15:47:00Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "title_is": "Do not require installed_packages() to work for three.js inclusion & show a warning if three.js cannot be found locally",
    "title_was": "Do not require installed_packages() to work for three.js inclusion",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365826"
}
```



---

archive/issue_comments_407379.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nFells like we lost the original goal of the ticket there. `install_package()` is needed if you don't want sage to break.",
    "created_at": "2019-02-16T18:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407379",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:18" align="right">comment:18</div>

Fells like we lost the original goal of the ticket there. `install_package()` is needed if you don't want sage to break.



---

archive/issue_comments_407380.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17fa3cc6a898091a6c7abb5a05e1a88a817495e1\"><code>17fa3cc</code></a></td><td><code>Remove option to load three.js from CDN</code></td></tr></table>\n",
    "created_at": "2019-02-16T19:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407380",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17fa3cc6a898091a6c7abb5a05e1a88a817495e1"><code>17fa3cc</code></a></td><td><code>Remove option to load three.js from CDN</code></td></tr></table>




---

archive/issue_comments_407381.json:
```json
{
    "body": "Changed commit from **[`1b27f44`](https://github.com/sagemath/sagetrac-mirror/commit/1b27f44f52a36ac8d548f787c09cf61f5ec5aede)** to **[`17fa3cc`](https://github.com/sagemath/sagetrac-mirror/commit/17fa3cc6a898091a6c7abb5a05e1a88a817495e1)**",
    "created_at": "2019-02-16T19:37:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407381",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1b27f44`](https://github.com/sagemath/sagetrac-mirror/commit/1b27f44f52a36ac8d548f787c09cf61f5ec5aede)** to **[`17fa3cc`](https://github.com/sagemath/sagetrac-mirror/commit/17fa3cc6a898091a6c7abb5a05e1a88a817495e1)**



---

archive/issue_comments_407382.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nSo the way to deal with locally served scripts is not to serve them at all but rather dump the whole script into the output??? And if there are multiple plots, then this code will be repeated and executed again and again and scripts won't be cached? Maybe all of this does not matter in practice because computers are so fast etc., but it surely seems wrong to me. I liked the old approach much better even if it required each backend to specify where to find these scripts.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/17fa3cc6a898091a6c7abb5a05e1a88a817495e1\"><code>17fa3cc</code></a></td><td><code>Remove option to load three.js from CDN</code></td></tr></table>\n",
    "created_at": "2019-02-16T19:37:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407382",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:20" align="right">comment:20</div>

So the way to deal with locally served scripts is not to serve them at all but rather dump the whole script into the output??? And if there are multiple plots, then this code will be repeated and executed again and again and scripts won't be cached? Maybe all of this does not matter in practice because computers are so fast etc., but it surely seems wrong to me. I liked the old approach much better even if it required each backend to specify where to find these scripts.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/17fa3cc6a898091a6c7abb5a05e1a88a817495e1"><code>17fa3cc</code></a></td><td><code>Remove option to load three.js from CDN</code></td></tr></table>




---

archive/issue_comments_407383.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAnd now remove functionality to load sensible scripts completely?!",
    "created_at": "2019-02-16T19:38:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407383",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:21" align="right">comment:21</div>

And now remove functionality to load sensible scripts completely?!



---

archive/issue_comments_407384.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nBut there does not seem to be an easy way to do this without dumping it all into the output. It's 500K per plot. That's annoying, sure, but at least it works (last time I checked at least) and nobody is going to complain about privacy.\n\nAt the meeting in Luminy last week we had virtually everybody who tried Sage stumble upon this one.\n\nSince three.js is a standard package this should also be acceptable for packagers. They need to set the THREEJS environment variable and then the right scripts should be included.",
    "created_at": "2019-02-16T19:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407384",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:22" align="right">comment:22</div>

But there does not seem to be an easy way to do this without dumping it all into the output. It's 500K per plot. That's annoying, sure, but at least it works (last time I checked at least) and nobody is going to complain about privacy.

At the meeting in Luminy last week we had virtually everybody who tried Sage stumble upon this one.

Since three.js is a standard package this should also be acceptable for packagers. They need to set the THREEJS environment variable and then the right scripts should be included.



---

archive/issue_comments_407385.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI agree that it's not pretty. But it fixes a bug and reduces the code base, that seems like a sensible solution for me until somebody sits down to find out how to do this properly in Jupyter & CoCalc.",
    "created_at": "2019-02-16T19:44:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407385",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:23" align="right">comment:23</div>

I agree that it's not pretty. But it fixes a bug and reduces the code base, that seems like a sensible solution for me until somebody sits down to find out how to do this properly in Jupyter & CoCalc.



---

archive/issue_comments_407386.json:
```json
{
    "body": "Work Issues: **needs testing - but is the general approach ok?**",
    "created_at": "2019-02-16T19:46:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407386",
    "user": "https://github.com/saraedum"
}
```

Work Issues: **needs testing - but is the general approach ok?**



---

archive/issue_comments_407387.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@novoselt](#comment:20):\n> And if there are multiple plots, then this code will be repeated and executed again and again and scripts won't be cached?\n\nAs I understand this, only the \"caching\" part of the script is different. The script would have been executed for every plot anyway as it was included in every plot with a `<script src=\"\u2026\">` tag.",
    "created_at": "2019-02-16T19:50:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407387",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@novoselt](#comment:20):
> And if there are multiple plots, then this code will be repeated and executed again and again and scripts won't be cached?

As I understand this, only the "caching" part of the script is different. The script would have been executed for every plot anyway as it was included in every plot with a `<script src="…">` tag.



---

archive/issue_comments_407388.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThe current situation is:\n- by default scripts are served offline and it works in some cases\n- there is an option to easily get output with scripts served online from CDN which also has its use cases and works everywhere, as I understand, but should not be made the default\n- there are cases (important ones) where offline does not work\n\nHow about:\n- keep the existing functionality of serving \"offline\" scripts\n- keep the existing functionality of serving \"online/CDN\" scripts\n- add your new option to inject the whole code instead of script tags\n\nThe default should be then \"use offline scripts if possible, but inject the code if it does not work\". Is this realizable? If not, then at least please keep the option to use CDN on request, what harm comes from that?!",
    "created_at": "2019-02-16T19:54:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407388",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:26" align="right">comment:26</div>

The current situation is:
- by default scripts are served offline and it works in some cases
- there is an option to easily get output with scripts served online from CDN which also has its use cases and works everywhere, as I understand, but should not be made the default
- there are cases (important ones) where offline does not work

How about:
- keep the existing functionality of serving "offline" scripts
- keep the existing functionality of serving "online/CDN" scripts
- add your new option to inject the whole code instead of script tags

The default should be then "use offline scripts if possible, but inject the code if it does not work". Is this realizable? If not, then at least please keep the option to use CDN on request, what harm comes from that?!



---

archive/issue_comments_407389.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@saraedum](#comment:5):\n> I looked into making threejs a feature and reporting the version there. But it appears that threejs has no version information readily available. Even if it had that information I am not sure what we would do with it. Requiring `r80` seems to be wrong as we are using a very small subset of threejs so I suspect that almost any version of threejs would work.\n\nPlease be careful regarding versions: any version will generally not work. Three.js is almost never backward compatible. That\u2019s just how Mr.doob works, and if we want to use his code we need to be aware of that.",
    "created_at": "2019-03-29T19:29:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407389",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@saraedum](#comment:5):
> I looked into making threejs a feature and reporting the version there. But it appears that threejs has no version information readily available. Even if it had that information I am not sure what we would do with it. Requiring `r80` seems to be wrong as we are using a very small subset of threejs so I suspect that almost any version of threejs would work.

Please be careful regarding versions: any version will generally not work. Three.js is almost never backward compatible. That’s just how Mr.doob works, and if we want to use his code we need to be aware of that.



---

archive/issue_comments_407390.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nPlease note that the proposed change always adds the locally installed version. That version should be compatible (the packager should make sure of that.)",
    "created_at": "2019-03-31T15:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407390",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:28" align="right">comment:28</div>

Please note that the proposed change always adds the locally installed version. That version should be compatible (the packager should make sure of that.)



---

archive/issue_comments_407391.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@novoselt](#comment:26):\n> The current situation is:\n> - by default scripts are served offline and it works in some cases\n> - there is an option to easily get output with scripts served online from CDN which also has its use cases and works everywhere, as I understand, but should not be made the default\n> - there are cases (important ones) where offline does not work\n> \n> How about:\n> - keep the existing functionality of serving \"offline\" scripts\n> - keep the existing functionality of serving \"online/CDN\" scripts\n> - add your new option to inject the whole code instead of script tags\n> \n> The default should be then \"use offline scripts if possible, but inject the code if it does not work\". Is this realizable? If not, then at least please keep the option to use CDN on request, what harm comes from that?!\n\nThe only harm that comes with this is that it creates more code to maintain. As opposed to only supporting one of these options.\n\nThe current situation is that this is broken for lots of users and they don't understand what's going on. (It was the most frequent issue people had with Sage at a recent introductory session of Sage.) I don't care at all how we fix this but we should just make it work by default everywhere. This here is one proposal to fix it. If it cannot be agreed upon, I am fine with anything else that works out of the box really. But I would really like to see this finally fixed. We can still improve upon this in a followup :)",
    "created_at": "2019-03-31T15:33:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407391",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@novoselt](#comment:26):
> The current situation is:
> - by default scripts are served offline and it works in some cases
> - there is an option to easily get output with scripts served online from CDN which also has its use cases and works everywhere, as I understand, but should not be made the default
> - there are cases (important ones) where offline does not work
> 
> How about:
> - keep the existing functionality of serving "offline" scripts
> - keep the existing functionality of serving "online/CDN" scripts
> - add your new option to inject the whole code instead of script tags
> 
> The default should be then "use offline scripts if possible, but inject the code if it does not work". Is this realizable? If not, then at least please keep the option to use CDN on request, what harm comes from that?!

The only harm that comes with this is that it creates more code to maintain. As opposed to only supporting one of these options.

The current situation is that this is broken for lots of users and they don't understand what's going on. (It was the most frequent issue people had with Sage at a recent introductory session of Sage.) I don't care at all how we fix this but we should just make it work by default everywhere. This here is one proposal to fix it. If it cannot be agreed upon, I am fine with anything else that works out of the box really. But I would really like to see this finally fixed. We can still improve upon this in a followup :)



---

archive/issue_comments_407392.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be72dbe9745aae80e364912f0f9c9300de3b9a56\"><code>be72dbe</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into u/saraedum/26434</code></td></tr></table>\n",
    "created_at": "2019-06-18T21:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407392",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be72dbe9745aae80e364912f0f9c9300de3b9a56"><code>be72dbe</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into u/saraedum/26434</code></td></tr></table>




---

archive/issue_comments_407393.json:
```json
{
    "body": "Changed commit from **[`17fa3cc`](https://github.com/sagemath/sagetrac-mirror/commit/17fa3cc6a898091a6c7abb5a05e1a88a817495e1)** to **[`be72dbe`](https://github.com/sagemath/sagetrac-mirror/commit/be72dbe9745aae80e364912f0f9c9300de3b9a56)**",
    "created_at": "2019-06-18T21:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407393",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`17fa3cc`](https://github.com/sagemath/sagetrac-mirror/commit/17fa3cc6a898091a6c7abb5a05e1a88a817495e1)** to **[`be72dbe`](https://github.com/sagemath/sagetrac-mirror/commit/be72dbe9745aae80e364912f0f9c9300de3b9a56)**



---

archive/issue_comments_407394.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI hope that this approach is an improvement at least. The CDN option is broken imho as it relies on `installed_packages()`.",
    "created_at": "2019-06-18T22:25:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407394",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:31" align="right">comment:31</div>

I hope that this approach is an improvement at least. The CDN option is broken imho as it relies on `installed_packages()`.



---

archive/issue_comments_407395.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@saraedum](#comment:31):\n> I hope that this approach is an improvement at least. The CDN option is broken imho as it relies on `installed_packages()`.\n\nI'm sure I don't fully understand the problems created by `installed_packages()`, but the CDN option is important for sharing notebooks and/or stand-alone graphics. Please do not just remove it completely!",
    "created_at": "2019-06-18T22:45:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407395",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@saraedum](#comment:31):
> I hope that this approach is an improvement at least. The CDN option is broken imho as it relies on `installed_packages()`.

I'm sure I don't fully understand the problems created by `installed_packages()`, but the CDN option is important for sharing notebooks and/or stand-alone graphics. Please do not just remove it completely!



---

archive/issue_comments_407396.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@paulmasson](#comment:32):\n> Replying to [@saraedum](#comment:31):\n> > I hope that this approach is an improvement at least. The CDN option is broken imho as it relies on `installed_packages()`.\n\n> I'm sure I don't fully understand the problems created by `installed_packages()`, but the CDN option is important for sharing notebooks and/or stand-alone graphics. Please do not just remove it completely!\n\nIt is a bit like you hardcoding a call to `rpm` in your application to figure something out. Forget about `apt` or anything else.",
    "created_at": "2019-06-18T22:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407396",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@paulmasson](#comment:32):
> Replying to [@saraedum](#comment:31):
> > I hope that this approach is an improvement at least. The CDN option is broken imho as it relies on `installed_packages()`.

> I'm sure I don't fully understand the problems created by `installed_packages()`, but the CDN option is important for sharing notebooks and/or stand-alone graphics. Please do not just remove it completely!

It is a bit like you hardcoding a call to `rpm` in your application to figure something out. Forget about `apt` or anything else.



---

archive/issue_comments_407397.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nAdding Eric Gourgoulhon for input on sharing notebooks",
    "created_at": "2019-06-18T22:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407397",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:34" align="right">comment:34</div>

Adding Eric Gourgoulhon for input on sharing notebooks



---

archive/issue_comments_407398.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nAnother option is to hard-code the version of Three.js each time an upgrade is done. I think that's what I originally did but was persuaded to use `installed_packages()` to make upgrades easier. If there is a `THREEJSDIR` variable why not add a `THREEJSVER` variable as well? Then a note can be added to `spkg-src` to remind the upgrader to change that variable as well.\n\nI'm a web-oriented person: a big part of the reason I wrote the Three.js backend was to encourage sharing of interactive graphics over the web. I would hate to see all that functionality just disappear.",
    "created_at": "2019-06-18T23:07:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407398",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:35" align="right">comment:35</div>

Another option is to hard-code the version of Three.js each time an upgrade is done. I think that's what I originally did but was persuaded to use `installed_packages()` to make upgrades easier. If there is a `THREEJSDIR` variable why not add a `THREEJSVER` variable as well? Then a note can be added to `spkg-src` to remind the upgrader to change that variable as well.

I'm a web-oriented person: a big part of the reason I wrote the Three.js backend was to encourage sharing of interactive graphics over the web. I would hate to see all that functionality just disappear.



---

archive/issue_comments_407399.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI can see the point of the advice you were given. However it ignored the push to package on distro. Ideally the information should be queryable from the installed stuff - without requiring a package manager. Hard coding is OK for me but I would favor something I can ask from the package itself somehow. Even if it is just manually parsing a file to find a version string.",
    "created_at": "2019-06-18T23:13:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407399",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:36" align="right">comment:36</div>

I can see the point of the advice you were given. However it ignored the push to package on distro. Ideally the information should be queryable from the installed stuff - without requiring a package manager. Hard coding is OK for me but I would favor something I can ask from the package itself somehow. Even if it is just manually parsing a file to find a version string.



---

archive/issue_comments_407400.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@kiwifb](#comment:36):\n> I can see the point of the advice you were given. However it ignored the push to package on distro. Ideally the information should be queryable from the installed stuff - without requiring a package manager. Hard coding is OK for me but I would favor something I can ask from the package itself somehow. Even if it is just manually parsing a file to find a version string.\n\nThe main `three.min.js` file has a string of the form `REVISION=\"100\"` so that the version is available in the browser. How about parsing the file for that when Sage loads?",
    "created_at": "2019-06-18T23:22:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407400",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@kiwifb](#comment:36):
> I can see the point of the advice you were given. However it ignored the push to package on distro. Ideally the information should be queryable from the installed stuff - without requiring a package manager. Hard coding is OK for me but I would favor something I can ask from the package itself somehow. Even if it is just manually parsing a file to find a version string.

The main `three.min.js` file has a string of the form `REVISION="100"` so that the version is available in the browser. How about parsing the file for that when Sage loads?



---

archive/issue_comments_407401.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nWorks for me. You will understand that it is hard to figure something like that exists from just looking at the file :) I am glad we had this chat with you as the author to figure it out.",
    "created_at": "2019-06-18T23:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407401",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:38" align="right">comment:38</div>

Works for me. You will understand that it is hard to figure something like that exists from just looking at the file :) I am glad we had this chat with you as the author to figure it out.



---

archive/issue_comments_407402.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@paulmasson](#comment:35):\n> I'm a web-oriented person: a big part of the reason I wrote the Three.js backend was to encourage sharing of interactive graphics over the web. I would hate to see all that functionality just disappear.\n\nThe functionality does not appear. The plots just get much bigger because they contain the inline three.js. I am not proud of this, but at runtime it does not make that much of a difference to load three.js several times, I suppose.",
    "created_at": "2019-06-18T23:43:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407402",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@paulmasson](#comment:35):
> I'm a web-oriented person: a big part of the reason I wrote the Three.js backend was to encourage sharing of interactive graphics over the web. I would hate to see all that functionality just disappear.

The functionality does not appear. The plots just get much bigger because they contain the inline three.js. I am not proud of this, but at runtime it does not make that much of a difference to load three.js several times, I suppose.



---

archive/issue_comments_407403.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nOk. So I can parse the REVISION to keep the CDN option alive. But the default would be to include all of three.js so things just work? (We could improve upon this further in a followup, e.g., add three.js to the sage kernel so it's only loaded once when in a Jupyter context.)",
    "created_at": "2019-06-18T23:46:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407403",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:40" align="right">comment:40</div>

Ok. So I can parse the REVISION to keep the CDN option alive. But the default would be to include all of three.js so things just work? (We could improve upon this further in a followup, e.g., add three.js to the sage kernel so it's only loaded once when in a Jupyter context.)



---

archive/issue_events_365827.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-06-18T23:46:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365827"
}
```



---

archive/issue_events_365828.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2019-06-18T23:46:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365828"
}
```



---

archive/issue_comments_407404.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@saraedum](#comment:40):\n> Ok. So I can parse the REVISION to keep the CDN option alive. But the default would be to include all of three.js so things just work? (We could improve upon this further in a followup, e.g., add three.js to the sage kernel so it's only loaded once when in a Jupyter context.)\n\nI am happy with that.",
    "created_at": "2019-06-18T23:50:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407404",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@saraedum](#comment:40):
> Ok. So I can parse the REVISION to keep the CDN option alive. But the default would be to include all of three.js so things just work? (We could improve upon this further in a followup, e.g., add three.js to the sage kernel so it's only loaded once when in a Jupyter context.)

I am happy with that.



---

archive/issue_comments_407405.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@saraedum](#comment:40):\n> Ok. So I can parse the REVISION to keep the CDN option alive. But the default would be to include all of three.js so things just work? (We could improve upon this further in a followup, e.g., add three.js to the sage kernel so it's only loaded once when in a Jupyter context.)\n\nThe original purpose of distinguishing between offline/online scripts was to use local files by default. One could then choose to set `online=True` to use the CDN for files that were meant to be shared. The Three.js template also has the silent fallback to the CDN that was fixed in #27575, so that even a notebook generated with the default of local files would work when shared on the web.\n\nI would like to see the original idea kept alive: first use local files, then fall back to the CDN as necessary or by choice. The only time you would want to dump all of Three.js into a file is when there is no Internet connectivity at all, but how often does that happen nowadays?\n\nHow about if this ticket just parses `three.min.js` for the version number to get rid of `installed_packages()` and doesn't change anything else yet? Then see what other issues arise in practice. Although you'll want to use `THREEJSDIR` in the local script tags.",
    "created_at": "2019-06-19T00:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407405",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@saraedum](#comment:40):
> Ok. So I can parse the REVISION to keep the CDN option alive. But the default would be to include all of three.js so things just work? (We could improve upon this further in a followup, e.g., add three.js to the sage kernel so it's only loaded once when in a Jupyter context.)

The original purpose of distinguishing between offline/online scripts was to use local files by default. One could then choose to set `online=True` to use the CDN for files that were meant to be shared. The Three.js template also has the silent fallback to the CDN that was fixed in #27575, so that even a notebook generated with the default of local files would work when shared on the web.

I would like to see the original idea kept alive: first use local files, then fall back to the CDN as necessary or by choice. The only time you would want to dump all of Three.js into a file is when there is no Internet connectivity at all, but how often does that happen nowadays?

How about if this ticket just parses `three.min.js` for the version number to get rid of `installed_packages()` and doesn't change anything else yet? Then see what other issues arise in practice. Although you'll want to use `THREEJSDIR` in the local script tags.



---

archive/issue_comments_407406.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@paulmasson](#comment:43):\n> Replying to [@saraedum](#comment:40):\n> > Ok. So I can parse the REVISION to keep the CDN option alive. But the default would be to include all of three.js so things just work? (We could improve upon this further in a followup, e.g., add three.js to the sage kernel so it's only loaded once when in a Jupyter context.)\n\n> The original purpose of distinguishing between offline/online scripts was to use local files by default. One could then choose to set `online=True` to use the CDN for files that were meant to be shared. The Three.js template also has the silent fallback to the CDN that was fixed in #27575, so that even a notebook generated with the default of local files would work when shared on the web.\n> \n> I would like to see the original idea kept alive: first use local files, then fall back to the CDN as necessary or by choice. The only time you would want to dump all of Three.js into a file is when there is no Internet connectivity at all, but how often does that happen nowadays?\n> \n> How about if this ticket just parses `three.min.js` for the version number to get rid of `installed_packages()` and doesn't change anything else yet? Then see what other issues arise in practice. Although you'll want to use `THREEJSDIR` in the local script tags.\n> \n\nThat also works for me. I had forgotten about #27575 in the meantime.",
    "created_at": "2019-06-19T00:39:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407406",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@paulmasson](#comment:43):
> Replying to [@saraedum](#comment:40):
> > Ok. So I can parse the REVISION to keep the CDN option alive. But the default would be to include all of three.js so things just work? (We could improve upon this further in a followup, e.g., add three.js to the sage kernel so it's only loaded once when in a Jupyter context.)

> The original purpose of distinguishing between offline/online scripts was to use local files by default. One could then choose to set `online=True` to use the CDN for files that were meant to be shared. The Three.js template also has the silent fallback to the CDN that was fixed in #27575, so that even a notebook generated with the default of local files would work when shared on the web.
> 
> I would like to see the original idea kept alive: first use local files, then fall back to the CDN as necessary or by choice. The only time you would want to dump all of Three.js into a file is when there is no Internet connectivity at all, but how often does that happen nowadays?
> 
> How about if this ticket just parses `three.min.js` for the version number to get rid of `installed_packages()` and doesn't change anything else yet? Then see what other issues arise in practice. Although you'll want to use `THREEJSDIR` in the local script tags.
> 

That also works for me. I had forgotten about #27575 in the meantime.



---

archive/issue_comments_407407.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@paulmasson](#comment:43):\n> \n> I would like to see the original idea kept alive: first use local files, then fall back to the CDN as necessary or by choice. The only time you would want to dump all of Three.js into a file is when there is no Internet connectivity at all, but how often does that happen nowadays?\n> \n\n+1",
    "created_at": "2019-06-20T12:08:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407407",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@paulmasson](#comment:43):
> 
> I would like to see the original idea kept alive: first use local files, then fall back to the CDN as necessary or by choice. The only time you would want to dump all of Three.js into a file is when there is no Internet connectivity at all, but how often does that happen nowadays?
> 

+1



---

archive/issue_comments_407408.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nThe intent of this ticket is addressed in #28086 so this one can be closed",
    "created_at": "2019-06-30T22:36:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407408",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:46" align="right">comment:46</div>

The intent of this ticket is addressed in #28086 so this one can be closed



---

archive/issue_events_365829.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-03-21T20:18:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365829"
}
```



---

archive/issue_events_365830.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-03-21T20:18:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365830"
}
```



---

archive/issue_comments_407409.json:
```json
{
    "body": "Reviewer: **Paul Masson**",
    "created_at": "2020-03-21T20:18:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407409",
    "user": "https://github.com/paulmasson"
}
```

Reviewer: **Paul Masson**



---

archive/issue_events_365831.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-03-21T20:18:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365831"
}
```



---

archive/issue_events_365832.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-03-21T20:18:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365832"
}
```



---

archive/issue_events_365833.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-03-21T20:18:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365833"
}
```



---

archive/issue_comments_407410.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nClosing as no longer needed. Reopen if you disagree.",
    "created_at": "2020-03-21T20:18:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26434#issuecomment-407410",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:47" align="right">comment:47</div>

Closing as no longer needed. Reopen if you disagree.



---

archive/issue_events_365834.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-06-23T06:15:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365834"
}
```



---

archive/issue_events_365835.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-06-23T06:15:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365835"
}
```



---

archive/issue_events_365836.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-06-23T06:15:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26434",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "c6c6c6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26434#event-365836"
}
```
