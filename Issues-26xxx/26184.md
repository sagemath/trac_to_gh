# Issue 26184: Broken regression test on search_doc

archive/issues_025947.json:
```json
{
    "body": "The tests added by #26017 do not pass:\n\n```\n$ ./sage -t --long --optional=dochtml,sage src/sage/misc/sagedoc.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2018-09-03-10-02-38-192a29c9.\nGit branch: HEAD\nUsing --optional=dochtml,memlimit,sage\nDoctesting 1 file.\nsage -t --long src/sage/misc/sagedoc.py\n**********************************************************************\nFile \"src/sage/misc/sagedoc.py\", line 1179, in sage.misc.sagedoc.?\nFailed example:\n    len(L) < N  # optional - dochtml, long time\nExpected:\n    True\nGot:\n    False\n**********************************************************************\nFile \"src/sage/misc/sagedoc.py\", line 1183, in sage.misc.sagedoc.?\nFailed example:\n    all(tree_re.search(l) for l in L) # optional - dochtml, long time\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n```\n\nDue to a bug in the doctest framework (#26110), these tests are not run by default.\n\nCC:  @embray @saraedum\n\nBranch/Commit: 31a3e07fe2a10a42886ed1a452d44f7fb3e2c7b4\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26184\n\n",
    "closed_at": "2018-09-05T16:43:57Z",
    "created_at": "2018-09-03T08:07:08Z",
    "labels": [
        "component: documentation",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Broken regression test on search_doc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26184",
    "user": "https://github.com/jdemeyer"
}
```
The tests added by #26017 do not pass:

```
$ ./sage -t --long --optional=dochtml,sage src/sage/misc/sagedoc.py 
too many failed tests, not using stored timings
Running doctests with ID 2018-09-03-10-02-38-192a29c9.
Git branch: HEAD
Using --optional=dochtml,memlimit,sage
Doctesting 1 file.
sage -t --long src/sage/misc/sagedoc.py
**********************************************************************
File "src/sage/misc/sagedoc.py", line 1179, in sage.misc.sagedoc.?
Failed example:
    len(L) < N  # optional - dochtml, long time
Expected:
    True
Got:
    False
**********************************************************************
File "src/sage/misc/sagedoc.py", line 1183, in sage.misc.sagedoc.?
Failed example:
    all(tree_re.search(l) for l in L) # optional - dochtml, long time
Expected:
    True
Got:
    False
**********************************************************************
```

Due to a bug in the doctest framework (#26110), these tests are not run by default.

CC:  @embray @saraedum

Branch/Commit: 31a3e07fe2a10a42886ed1a452d44f7fb3e2c7b4

Reviewer: Jeroen Demeyer

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26184





---

archive/issue_comments_503050.json:
```json
{
    "body": "<a id='comment:1'></a>To clarify something: these tests *did* pass when I wrote them.  I can confirm this because when I added them `optional - dochtml` didn't exist yet (that was only added on #26017 after I rebased the branch later to include that feature).\n\nI confirmed manually that it passed then, and it also passes for me now when run manually (on 8.4.beta2).  Of course, by nature, it *will not* pass if not run against a complete build of the docs.  #26017 made it less sensitive to specific magic numbers, but it still doesn't make sense without a full build of the html docs to run against.",
    "created_at": "2018-09-03T08:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503050",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>To clarify something: these tests *did* pass when I wrote them.  I can confirm this because when I added them `optional - dochtml` didn't exist yet (that was only added on #26017 after I rebased the branch later to include that feature).

I confirmed manually that it passed then, and it also passes for me now when run manually (on 8.4.beta2).  Of course, by nature, it *will not* pass if not run against a complete build of the docs.  #26017 made it less sensitive to specific magic numbers, but it still doesn't make sense without a full build of the html docs to run against.



---

archive/issue_comments_503051.json:
```json
{
    "body": "<a id='comment:2'></a>Replying to [comment:1 embray]:\n> I confirmed manually that it passed then, and it also passes for me now when run manually (on 8.4.beta2).\n\n\nDo you mean 8.4.beta3? Because that's when #26017 was merged.",
    "created_at": "2018-09-03T08:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503051",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Replying to [comment:1 embray]:
> I confirmed manually that it passed then, and it also passes for me now when run manually (on 8.4.beta2).


Do you mean 8.4.beta3? Because that's when #26017 was merged.



---

archive/issue_comments_503052.json:
```json
{
    "body": "<a id='comment:3'></a>By the way, for me both numbers `len(L)` and `N` are equal to 9495 in 8.4.beta3.",
    "created_at": "2018-09-03T09:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503052",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>By the way, for me both numbers `len(L)` and `N` are equal to 9495 in 8.4.beta3.



---

archive/issue_comments_503053.json:
```json
{
    "body": "<a id='comment:4'></a>No, I mean beta2.  I haven't pulled beta3 yet.  What I mean is that if I run those lines manually in Sage the tests pass.  Perhaps there is something else that changed in beta3 that caused it to start failing anew.  #24784 would be a likely candidate.",
    "created_at": "2018-09-03T09:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503053",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>No, I mean beta2.  I haven't pulled beta3 yet.  What I mean is that if I run those lines manually in Sage the tests pass.  Perhaps there is something else that changed in beta3 that caused it to start failing anew.  #24784 would be a likely candidate.



---

archive/issue_comments_503054.json:
```json
{
    "body": "<a id='comment:5'></a>Yep, I see the problem.",
    "created_at": "2018-09-03T09:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503054",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>Yep, I see the problem.



---

archive/issue_comments_503055.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2018-09-03T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503055",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_503056.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2018-09-03T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503056",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_503057.json:
```json
{
    "body": "Changing commit from \"\" to \"31a3e07fe2a10a42886ed1a452d44f7fb3e2c7b4\"",
    "created_at": "2018-09-03T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503057",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "31a3e07fe2a10a42886ed1a452d44f7fb3e2c7b4"



---

archive/issue_comments_503058.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/ticket-26184\"",
    "created_at": "2018-09-03T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503058",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/ticket-26184"



---

archive/issue_comments_503059.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-03T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503059",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_503060.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2018-09-03T10:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503060",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_comments_503061.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-03T10:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503061",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_503062.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-05T16:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503062",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065234.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-05T16:43:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26184#event-65234"
}
```



---

archive/issue_comments_503063.json:
```json
{
    "body": "Changing branch from \"u/embray/ticket-26184\" to \"31a3e07fe2a10a42886ed1a452d44f7fb3e2c7b4\"",
    "created_at": "2018-09-05T16:43:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26184",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26184#issuecomment-503063",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/ticket-26184" to "31a3e07fe2a10a42886ed1a452d44f7fb3e2c7b4"
