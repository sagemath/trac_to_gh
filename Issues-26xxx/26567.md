# Issue 26567: clean dense_graph.pyx

archive/issues_026330.json:
```json
{
    "body": "The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.\n\nOn the way, I have put `try.. except TypeError` around the 2 `sorted` operations.\n\nWe also do PEP8 cleaning.\n\nCC:  @tscrim @fchapoton\n\nKeywords: py3, graph\n\nBranch: [043388831f22a50333fd140823dedaf29de222cc](https://github.com/sagemath/sagetrac-mirror/commit/043388831f22a50333fd140823dedaf29de222cc)\n\nReviewer: Travis Scrimshaw\n\nAuthor: David Coudert\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26567\n\n",
    "closed_at": "2018-10-29T22:46:32Z",
    "created_at": "2018-10-27T12:50:39Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "clean dense_graph.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26567",
    "user": "https://github.com/dcoudert"
}
```
The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.

On the way, I have put `try.. except TypeError` around the 2 `sorted` operations.

We also do PEP8 cleaning.

CC:  @tscrim @fchapoton

Keywords: py3, graph

Branch: [043388831f22a50333fd140823dedaf29de222cc](https://github.com/sagemath/sagetrac-mirror/commit/043388831f22a50333fd140823dedaf29de222cc)

Reviewer: Travis Scrimshaw

Author: David Coudert

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26567





---

archive/issue_comments_512409.json:
```json
{
    "body": "Changing branch from \"\" to \"public/26567_dense_graph\"",
    "created_at": "2018-10-27T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512409",
    "user": "https://github.com/dcoudert"
}
```

Changing branch from "" to "public/26567_dense_graph"



---

archive/issue_comments_512410.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-27T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512410",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_512411.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.\n \n+On the way, I have put `try.. except TypeError` around the 2 `sorted` operations.\n+\n We also do PEP8 cleaning.\n``````\n",
    "created_at": "2018-10-27T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512411",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.
 
+On the way, I have put `try.. except TypeError` around the 2 `sorted` operations.
+
 We also do PEP8 cleaning.
``````




---

archive/issue_comments_512412.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|\n|[56cd44f](https://github.com/sagemath/sagetrac-mirror/commit/56cd44fce3f7739f17fa4b06f968a2ef4800582e)|`trac #26567: clean dense_graph.pyx and use yield in iterators`|",
    "created_at": "2018-10-27T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512412",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------|
|[56cd44f](https://github.com/sagemath/sagetrac-mirror/commit/56cd44fce3f7739f17fa4b06f968a2ef4800582e)|`trac #26567: clean dense_graph.pyx and use yield in iterators`|



---

archive/issue_comments_512413.json:
```json
{
    "body": "Changing commit from \"\" to \"56cd44fce3f7739f17fa4b06f968a2ef4800582e\"",
    "created_at": "2018-10-27T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512413",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "56cd44fce3f7739f17fa4b06f968a2ef4800582e"



---

archive/issue_comments_512414.json:
```json
{
    "body": "<a id='comment:2'></a>\nOn the error messages, please remove the `!`.\n\nI think a better way to do\n\n```python\n                        try:\n                            v, u = sorted((self.vertex_label(v_int),\n                                           self.vertex_label(u_int)))\n                        except TypeError:\n                            v = self.vertex_label(v_int)\n                            u = self.vertex_label(u_int)\n```\nis to do\n\n```python\n                        v = self.vertex_label(v_int)\n                        u = self.vertex_label(u_int)\n                        try:\n                            if u < v:\n                                v, u = u, v\n                        except TypeError:\n                            pass\n```\nas it does not create an intermediary objects (the tuple and the resulting list), I would guess one comparison is faster than calling `sorted`, and we only change things if we need to.",
    "created_at": "2018-10-27T13:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512414",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
On the error messages, please remove the `!`.

I think a better way to do

```python
                        try:
                            v, u = sorted((self.vertex_label(v_int),
                                           self.vertex_label(u_int)))
                        except TypeError:
                            v = self.vertex_label(v_int)
                            u = self.vertex_label(u_int)
```
is to do

```python
                        v = self.vertex_label(v_int)
                        u = self.vertex_label(u_int)
                        try:
                            if u < v:
                                v, u = u, v
                        except TypeError:
                            pass
```
as it does not create an intermediary objects (the tuple and the resulting list), I would guess one comparison is faster than calling `sorted`, and we only change things if we need to.



---

archive/issue_comments_512415.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[cbc0528](https://github.com/sagemath/sagetrac-mirror/commit/cbc0528973a3ff9a82abbca7e245bf74b781929d)|`trac #26567: Merged with 8.5.beta1`|\n|[aadaf14](https://github.com/sagemath/sagetrac-mirror/commit/aadaf141117af251564562b53e212a945244ad1b)|`trac #26567: implement reviewers comments`|\n|[32e15a0](https://github.com/sagemath/sagetrac-mirror/commit/32e15a0dfae38e2adb3c9b438d71671b83e49683)|`trac #26567: correct error`|",
    "created_at": "2018-10-27T14:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512415",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[cbc0528](https://github.com/sagemath/sagetrac-mirror/commit/cbc0528973a3ff9a82abbca7e245bf74b781929d)|`trac #26567: Merged with 8.5.beta1`|
|[aadaf14](https://github.com/sagemath/sagetrac-mirror/commit/aadaf141117af251564562b53e212a945244ad1b)|`trac #26567: implement reviewers comments`|
|[32e15a0](https://github.com/sagemath/sagetrac-mirror/commit/32e15a0dfae38e2adb3c9b438d71671b83e49683)|`trac #26567: correct error`|



---

archive/issue_comments_512416.json:
```json
{
    "body": "Changing commit from \"56cd44fce3f7739f17fa4b06f968a2ef4800582e\" to \"32e15a0dfae38e2adb3c9b438d71671b83e49683\"",
    "created_at": "2018-10-27T14:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512416",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "56cd44fce3f7739f17fa4b06f968a2ef4800582e" to "32e15a0dfae38e2adb3c9b438d71671b83e49683"



---

archive/issue_comments_512417.json:
```json
{
    "body": "Changing commit from \"32e15a0dfae38e2adb3c9b438d71671b83e49683\" to \"043388831f22a50333fd140823dedaf29de222cc\"",
    "created_at": "2018-10-27T14:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "32e15a0dfae38e2adb3c9b438d71671b83e49683" to "043388831f22a50333fd140823dedaf29de222cc"



---

archive/issue_comments_512418.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[0433888](https://github.com/sagemath/sagetrac-mirror/commit/043388831f22a50333fd140823dedaf29de222cc)|`trac #26567: improvements`|",
    "created_at": "2018-10-27T14:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[0433888](https://github.com/sagemath/sagetrac-mirror/commit/043388831f22a50333fd140823dedaf29de222cc)|`trac #26567: improvements`|



---

archive/issue_comments_512419.json:
```json
{
    "body": "<a id='comment:5'></a>\nAll comment's implemented.",
    "created_at": "2018-10-27T14:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512419",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>
All comment's implemented.



---

archive/issue_comments_512420.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-10-27T14:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512420",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_512421.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks. I just want to wait for a green patchbot. Once one comes back (morally) green, we can set a positive review.",
    "created_at": "2018-10-27T14:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512421",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Thanks. I just want to wait for a green patchbot. Once one comes back (morally) green, we can set a positive review.



---

archive/issue_comments_512422.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe doctest failures seem unrelated.",
    "created_at": "2018-10-27T19:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512422",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
The doctest failures seem unrelated.



---

archive/issue_comments_512423.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-27T19:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512423",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_512424.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-29T22:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512424",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_074931.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-29T22:46:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26567#event-74931"
}
```



---

archive/issue_comments_512425.json:
```json
{
    "body": "Changing branch from \"public/26567_dense_graph\" to \"043388831f22a50333fd140823dedaf29de222cc\"",
    "created_at": "2018-10-29T22:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512425",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/26567_dense_graph" to "043388831f22a50333fd140823dedaf29de222cc"



---

archive/issue_comments_512426.json:
```json
{
    "body": "Changing commit from \"043388831f22a50333fd140823dedaf29de222cc\" to \"\"",
    "created_at": "2018-11-29T00:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512426",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "043388831f22a50333fd140823dedaf29de222cc" to ""



---

archive/issue_comments_512427.json:
```json
{
    "body": "<a id='comment:9'></a>\nAre there any plans for similar changes to sparse_graph.pyx, in particular to `iterator_edges`? I tried doing something similar, but it led to other problems, so it would be better if someone who knows the graph theory stuff better to do it. The code in sparse_graph.pyx leads to Python 3 doctest failures with simplicial complexes.",
    "created_at": "2018-11-29T00:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-512427",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Are there any plans for similar changes to sparse_graph.pyx, in particular to `iterator_edges`? I tried doing something similar, but it led to other problems, so it would be better if someone who knows the graph theory stuff better to do it. The code in sparse_graph.pyx leads to Python 3 doctest failures with simplicial complexes.
