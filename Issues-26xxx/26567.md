# Issue 26567: clean dense_graph.pyx

archive/issues_026330.json:
```json
{
    "body": "The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.\n\nOn the way, I have put `try.. except TypeError` around the 2 `sorted` operations.\n\nWe also do PEP8 cleaning.\n\nCC:  @tscrim @fchapoton\n\nKeywords: py3, graph\n\nReviewer: Travis Scrimshaw\n\nAuthor: David Coudert\n\nBranch: 043388831f22a50333fd140823dedaf29de222cc\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26567\n\n",
    "closed_at": "2018-10-29T22:46:32Z",
    "created_at": "2018-10-27T12:50:39Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "clean dense_graph.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26567",
    "user": "https://github.com/dcoudert"
}
```
The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.

On the way, I have put `try.. except TypeError` around the 2 `sorted` operations.

We also do PEP8 cleaning.

CC:  @tscrim @fchapoton

Keywords: py3, graph

Reviewer: Travis Scrimshaw

Author: David Coudert

Branch: 043388831f22a50333fd140823dedaf29de222cc

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26567





---

archive/issue_comments_394925.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-27T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394925",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_394926.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.\n+\n+On the way, I have put `try.. except TypeError` around the 2 `sorted` operations.\n \n We also do PEP8 cleaning.\n \n```\n",
    "created_at": "2018-10-27T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394926",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The **big change** in this ticket is to use `yield` in iterators instead of first building a list and then returning an iterator over that list. This should speed up methods using these iterators.
+
+On the way, I have put `try.. except TypeError` around the 2 `sorted` operations.
 
 We also do PEP8 cleaning.
 
```




---

archive/issue_comments_394927.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2018-10-27T12:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394927",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_394928.json:
```json
{
    "body": "<a id='comment:2'></a>On the error messages, please remove the `!`.\n\nI think a better way to do\n\n```python\n                        try:\n                            v, u = sorted((self.vertex_label(v_int),\n                                           self.vertex_label(u_int)))\n                        except TypeError:\n                            v = self.vertex_label(v_int)\n                            u = self.vertex_label(u_int)\n```\nis to do\n\n```python\n                        v = self.vertex_label(v_int)\n                        u = self.vertex_label(u_int)\n                        try:\n                            if u < v:\n                                v, u = u, v\n                        except TypeError:\n                            pass\n```\nas it does not create an intermediary objects (the tuple and the resulting list), I would guess one comparison is faster than calling `sorted`, and we only change things if we need to.",
    "created_at": "2018-10-27T13:08:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394928",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>On the error messages, please remove the `!`.

I think a better way to do

```python
                        try:
                            v, u = sorted((self.vertex_label(v_int),
                                           self.vertex_label(u_int)))
                        except TypeError:
                            v = self.vertex_label(v_int)
                            u = self.vertex_label(u_int)
```
is to do

```python
                        v = self.vertex_label(v_int)
                        u = self.vertex_label(u_int)
                        try:
                            if u < v:
                                v, u = u, v
                        except TypeError:
                            pass
```
as it does not create an intermediary objects (the tuple and the resulting list), I would guess one comparison is faster than calling `sorted`, and we only change things if we need to.



---

archive/issue_comments_394929.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-27T14:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394929",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394930.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-27T14:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394930",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_394931.json:
```json
{
    "body": "<a id='comment:5'></a>All comment's implemented.",
    "created_at": "2018-10-27T14:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394931",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>All comment's implemented.



---

archive/issue_comments_394932.json:
```json
{
    "body": "<a id='comment:6'></a>Thanks. I just want to wait for a green patchbot. Once one comes back (morally) green, we can set a positive review.",
    "created_at": "2018-10-27T14:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394932",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>Thanks. I just want to wait for a green patchbot. Once one comes back (morally) green, we can set a positive review.



---

archive/issue_comments_394933.json:
```json
{
    "body": "<a id='comment:7'></a>The doctest failures seem unrelated.",
    "created_at": "2018-10-27T19:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394933",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>The doctest failures seem unrelated.



---

archive/issue_comments_394934.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-27T19:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394934",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_394935.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-29T22:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394935",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065972.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-29T22:46:32Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26567#event-65972"
}
```



---

archive/issue_comments_394936.json:
```json
{
    "body": "<a id='comment:9'></a>Are there any plans for similar changes to sparse_graph.pyx, in particular to `iterator_edges`? I tried doing something similar, but it led to other problems, so it would be better if someone who knows the graph theory stuff better to do it. The code in sparse_graph.pyx leads to Python 3 doctest failures with simplicial complexes.",
    "created_at": "2018-11-29T00:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26567",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26567#issuecomment-394936",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>Are there any plans for similar changes to sparse_graph.pyx, in particular to `iterator_edges`? I tried doing something similar, but it led to other problems, so it would be better if someone who knows the graph theory stuff better to do it. The code in sparse_graph.pyx leads to Python 3 doctest failures with simplicial complexes.
