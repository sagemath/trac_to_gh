# Issue 26886: Clean and enhance module combinat.derangement

archive/issues_026649.json:
```json
{
    "body": "Part of #26883 meta-ticket.\n\n* Replace `Derangement`'s superclass `CombinatorialElement` with `ClonableList`.\\\\\n\n* Allow to create a Derangement without declaring it's parent explicitly. The parent set generated is the list [1, 2, ..., n] where n is the length of the Derangement.\n\n```\nsage: d=Derangement([2,3,1])\nsage: d.parent()\nDerangements of the set [1, 2, 3]\n```\n\n* Implement consistency check when creating a `Derangement`. There is no control currently and inconsistencies are easy to build:\n\n```\nsage: D = Derangements(4)\nsage: elt=D([1,2,3,4])\nsage: tuple(elt) == D._set\nTrue\nsage: D([12,87,4,5]).parent()\nDerangements of the set [1, 2, 3, 4]\nsage: D([2,1]).parent()\nDerangements of the set [1, 2, 3, 4]\n```\n\n**CC:**  @hivert boussica\n\n**Keywords:** thursdaysbdx\n\n**Branch:** [u/vklein/replace_combinatorial_object_to_clonable_list_in_combinat_derangement_derangement](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/replace_combinatorial_object_to_clonable_list_in_combinat_derangement_derangement)\n\n**Commit:** [650acb7c198ff9fa5fc6e6cb7d0773863015491e](https://github.com/sagemath/sagetrac-mirror/commit/650acb7c198ff9fa5fc6e6cb7d0773863015491e)\n\n**Reviewer:** Adrien Boussicault\n\n**Author:** Vincent Klein\n\nIssue created by migration from https://trac.sagemath.org/ticket/26886\n\n",
    "created_at": "2018-12-12T17:18:47Z",
    "labels": [
        "component: combinatorics",
        "enhancement",
        "needs work"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Clean and enhance module combinat.derangement",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26886",
    "user": "https://github.com/vinklein"
}
```
Part of #26883 meta-ticket.

* Replace `Derangement`'s superclass `CombinatorialElement` with `ClonableList`.\\

* Allow to create a Derangement without declaring it's parent explicitly. The parent set generated is the list [1, 2, ..., n] where n is the length of the Derangement.

```
sage: d=Derangement([2,3,1])
sage: d.parent()
Derangements of the set [1, 2, 3]
```

* Implement consistency check when creating a `Derangement`. There is no control currently and inconsistencies are easy to build:

```
sage: D = Derangements(4)
sage: elt=D([1,2,3,4])
sage: tuple(elt) == D._set
True
sage: D([12,87,4,5]).parent()
Derangements of the set [1, 2, 3, 4]
sage: D([2,1]).parent()
Derangements of the set [1, 2, 3, 4]
```

**CC:**  @hivert boussica

**Keywords:** thursdaysbdx

**Branch:** [u/vklein/replace_combinatorial_object_to_clonable_list_in_combinat_derangement_derangement](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/replace_combinatorial_object_to_clonable_list_in_combinat_derangement_derangement)

**Commit:** [650acb7c198ff9fa5fc6e6cb7d0773863015491e](https://github.com/sagemath/sagetrac-mirror/commit/650acb7c198ff9fa5fc6e6cb7d0773863015491e)

**Reviewer:** Adrien Boussicault

**Author:** Vincent Klein

Issue created by migration from https://trac.sagemath.org/ticket/26886





---

archive/issue_comments_418158.json:
```json
{
    "body": "**Branch:** [u/vklein/replace_combinatorial_object_to_clonable_list_in_combinat_derangement_derangement](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/replace_combinatorial_object_to_clonable_list_in_combinat_derangement_derangement)",
    "created_at": "2018-12-13T11:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418158",
    "user": "https://github.com/vinklein"
}
```

**Branch:** [u/vklein/replace_combinatorial_object_to_clonable_list_in_combinat_derangement_derangement](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/replace_combinatorial_object_to_clonable_list_in_combinat_derangement_derangement)



---

archive/issue_comments_418159.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"thursdaysbdx\".",
    "created_at": "2018-12-13T13:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418159",
    "user": "https://github.com/vinklein"
}
```

**Changing keywords** from "" to "thursdaysbdx".



---

archive/issue_comments_418160.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9468c54ab54ad95d6650e1bd6a68a8f561ec3b07\">9468c54</a></td><td><code>Trac #26886: Replace CombinatorialObject usage ...</code></td></tr></table>\n",
    "created_at": "2018-12-13T13:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418160",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9468c54ab54ad95d6650e1bd6a68a8f561ec3b07">9468c54</a></td><td><code>Trac #26886: Replace CombinatorialObject usage ...</code></td></tr></table>




---

archive/issue_comments_418161.json:
```json
{
    "body": "**Commit:** [9468c54ab54ad95d6650e1bd6a68a8f561ec3b07](https://github.com/sagemath/sagetrac-mirror/commit/9468c54ab54ad95d6650e1bd6a68a8f561ec3b07)",
    "created_at": "2018-12-13T13:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418161",
    "user": "https://github.com/vinklein"
}
```

**Commit:** [9468c54ab54ad95d6650e1bd6a68a8f561ec3b07](https://github.com/sagemath/sagetrac-mirror/commit/9468c54ab54ad95d6650e1bd6a68a8f561ec3b07)



---

archive/issue_comments_418162.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,24 @@\n Part of #26883 meta-ticket.\n+\n+* Replace `Derangement`'s superclass `CombinatorialElement` with `ClonableList`.\\\\\n+\n+* Allow to create a Derangement without declaring it's parent explicitly. The parent set generated is the list [1, 2, ..., n] where n is the length of the Derangement.\n+\n+```\n+sage: d=Derangement([2,3,1])\n+sage: d.parent()\n+Derangements of the set [1, 2, 3]\n+```\n+\n+* Implement consistency check when creating a `Derangement`. There is no control currently and inconsistencies are easy to build:\n+\n+```\n+sage: D = Derangements(4)\n+sage: elt=D([1,2,3,4])\n+sage: tuple(elt) == D._set\n+True\n+sage: D([12,87,4,5]).parent()\n+Derangements of the set [1, 2, 3, 4]\n+sage: D([2,1]).parent()\n+Derangements of the set [1, 2, 3, 4]\n+```\n``````\n",
    "created_at": "2018-12-13T15:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418162",
    "user": "https://github.com/vinklein"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,24 @@
 Part of #26883 meta-ticket.
+
+* Replace `Derangement`'s superclass `CombinatorialElement` with `ClonableList`.\\
+
+* Allow to create a Derangement without declaring it's parent explicitly. The parent set generated is the list [1, 2, ..., n] where n is the length of the Derangement.
+
+```
+sage: d=Derangement([2,3,1])
+sage: d.parent()
+Derangements of the set [1, 2, 3]
+```
+
+* Implement consistency check when creating a `Derangement`. There is no control currently and inconsistencies are easy to build:
+
+```
+sage: D = Derangements(4)
+sage: elt=D([1,2,3,4])
+sage: tuple(elt) == D._set
+True
+sage: D([12,87,4,5]).parent()
+Derangements of the set [1, 2, 3, 4]
+sage: D([2,1]).parent()
+Derangements of the set [1, 2, 3, 4]
+```
``````




---

archive/issue_events_241360.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-12-13T15:24:07Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "rename": {
        "from": "Replace Combinatorial Object to Clonable List in combinat.derangement.Derangement",
        "to": "Replace Combinatorial Element to Clonable List in combinat.derangement.Derangement"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241360"
}
```



---

archive/issue_events_241361.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-12-13T15:25:42Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "rename": {
        "from": "Replace Combinatorial Element to Clonable List in combinat.derangement.Derangement",
        "to": "Clean and enhance module combinat.derangement"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241361"
}
```



---

archive/issue_comments_418163.json:
```json
{
    "body": "**Changing commit** from \"[9468c54ab54ad95d6650e1bd6a68a8f561ec3b07](https://github.com/sagemath/sagetrac-mirror/commit/9468c54ab54ad95d6650e1bd6a68a8f561ec3b07)\" to \"[ade0b9fd1717993312cc548e24beb8097472ea25](https://github.com/sagemath/sagetrac-mirror/commit/ade0b9fd1717993312cc548e24beb8097472ea25)\".",
    "created_at": "2018-12-13T16:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418163",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9468c54ab54ad95d6650e1bd6a68a8f561ec3b07](https://github.com/sagemath/sagetrac-mirror/commit/9468c54ab54ad95d6650e1bd6a68a8f561ec3b07)" to "[ade0b9fd1717993312cc548e24beb8097472ea25](https://github.com/sagemath/sagetrac-mirror/commit/ade0b9fd1717993312cc548e24beb8097472ea25)".



---

archive/issue_comments_418164.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/092c89ff8234d34df091fdfa2d977c0bf96fd86f\">092c89f</a></td><td><code>Trac #26886: Allow to create a Derangement without ...</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ade0b9fd1717993312cc548e24beb8097472ea25\">ade0b9f</a></td><td><code>Trac #26886: Implement consistency check</code></td></tr></table>\n",
    "created_at": "2018-12-13T16:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418164",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/092c89ff8234d34df091fdfa2d977c0bf96fd86f">092c89f</a></td><td><code>Trac #26886: Allow to create a Derangement without ...</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ade0b9fd1717993312cc548e24beb8097472ea25">ade0b9f</a></td><td><code>Trac #26886: Implement consistency check</code></td></tr></table>




---

archive/issue_comments_418165.json:
```json
{
    "body": "**Changing commit** from \"[ade0b9fd1717993312cc548e24beb8097472ea25](https://github.com/sagemath/sagetrac-mirror/commit/ade0b9fd1717993312cc548e24beb8097472ea25)\" to \"[b65923b05087906b8fc35e469605f28858db31cb](https://github.com/sagemath/sagetrac-mirror/commit/b65923b05087906b8fc35e469605f28858db31cb)\".",
    "created_at": "2018-12-17T10:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418165",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ade0b9fd1717993312cc548e24beb8097472ea25](https://github.com/sagemath/sagetrac-mirror/commit/ade0b9fd1717993312cc548e24beb8097472ea25)" to "[b65923b05087906b8fc35e469605f28858db31cb](https://github.com/sagemath/sagetrac-mirror/commit/b65923b05087906b8fc35e469605f28858db31cb)".



---

archive/issue_comments_418166.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b65923b05087906b8fc35e469605f28858db31cb\">b65923b</a></td><td><code>Trac #26886: Add doctests and documentation.</code></td></tr></table>\n",
    "created_at": "2018-12-17T10:34:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b65923b05087906b8fc35e469605f28858db31cb">b65923b</a></td><td><code>Trac #26886: Add doctests and documentation.</code></td></tr></table>




---

archive/issue_events_241362.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-12-17T10:37:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241362"
}
```



---

archive/issue_comments_418167.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/650acb7c198ff9fa5fc6e6cb7d0773863015491e\">650acb7</a></td><td><code>Trac #26886: Add doctests and documentation.</code></td></tr></table>\n",
    "created_at": "2018-12-17T10:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418167",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/650acb7c198ff9fa5fc6e6cb7d0773863015491e">650acb7</a></td><td><code>Trac #26886: Add doctests and documentation.</code></td></tr></table>




---

archive/issue_comments_418168.json:
```json
{
    "body": "**Changing commit** from \"[b65923b05087906b8fc35e469605f28858db31cb](https://github.com/sagemath/sagetrac-mirror/commit/b65923b05087906b8fc35e469605f28858db31cb)\" to \"[650acb7c198ff9fa5fc6e6cb7d0773863015491e](https://github.com/sagemath/sagetrac-mirror/commit/650acb7c198ff9fa5fc6e6cb7d0773863015491e)\".",
    "created_at": "2018-12-17T10:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418168",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b65923b05087906b8fc35e469605f28858db31cb](https://github.com/sagemath/sagetrac-mirror/commit/b65923b05087906b8fc35e469605f28858db31cb)" to "[650acb7c198ff9fa5fc6e6cb7d0773863015491e](https://github.com/sagemath/sagetrac-mirror/commit/650acb7c198ff9fa5fc6e6cb7d0773863015491e)".



---

archive/issue_events_241363.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-01-11T16:42:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241363"
}
```



---

archive/issue_events_241364.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-01-11T16:42:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241364"
}
```



---

archive/issue_comments_418169.json:
```json
{
    "body": "<a id='comment:10'></a>\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418169",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_events_241365.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241365"
}
```



---

archive/issue_events_241366.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241366"
}
```



---

archive/issue_comments_418170.json:
```json
{
    "body": "**Reviewer:** boussica",
    "created_at": "2019-01-31T09:32:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418170",
    "user": "https://trac.sagemath.org/admin/accounts/users/boussica"
}
```

**Reviewer:** boussica



---

archive/issue_comments_418171.json:
```json
{
    "body": "<a id='comment:12'></a>\nReview 1 remark 1\n\nIn `__classccall_private__()`, i think that you modify the functionalities of the Derangements class.\nIn their documentation, a derangement on a set S is a permutation sigma such that\nsigma(x) neq x for all x in S, i.e. sigma is a permutation of S with no fixed points.\n\nSo S can be an arbitrary set. For example, S can be equals to `[1,x,x**2]`. The following code shows that functionality:\n\n```\nsage: DDS = Derangements([1, x, x^2])\nsage: DDS\nDerangements of the set [x, x + 1, x^2]\nsage: list( DDS )\n[[x + 1, x^2, x], [x^2, x, x + 1]]\n```\n\nSo, in the code of `__class_call__private__()` you should'nt write \n\n```\n+        parent_set = [i + 1 for i in range(len(lst))]\n+        return Derangements(parent_set)(lst)\n```\n\nIndeed, you tranform any Derangment on any set to a derangement on some integers.\n\nSee the next comment for more details.",
    "created_at": "2019-01-31T10:17:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418171",
    "user": "https://trac.sagemath.org/admin/accounts/users/boussica"
}
```

<a id='comment:12'></a>
Review 1 remark 1

In `__classccall_private__()`, i think that you modify the functionalities of the Derangements class.
In their documentation, a derangement on a set S is a permutation sigma such that
sigma(x) neq x for all x in S, i.e. sigma is a permutation of S with no fixed points.

So S can be an arbitrary set. For example, S can be equals to `[1,x,x**2]`. The following code shows that functionality:

```
sage: DDS = Derangements([1, x, x^2])
sage: DDS
Derangements of the set [x, x + 1, x^2]
sage: list( DDS )
[[x + 1, x^2, x], [x^2, x, x + 1]]
```

So, in the code of `__class_call__private__()` you should'nt write 

```
+        parent_set = [i + 1 for i in range(len(lst))]
+        return Derangements(parent_set)(lst)
```

Indeed, you tranform any Derangment on any set to a derangement on some integers.

See the next comment for more details.



---

archive/issue_comments_418172.json:
```json
{
    "body": "<a id='comment:13'></a>\nReview 1 remark 1 bis\n\nThe problem is the following : \"how do we define correctly, without the parent, a derangement ?\"\n\nFor example with your code we have :\n\n```\nsage: Derangement([2,3,1])\n[2, 3, 1]\n```\n\nand \n\n```\nsage: Derangement([x**3, 1+x, x**2])\n---------------------------------------------------------------------------\nAssertionError  \n ...\nAssertionError: All elements of a derangement must be present in their parent set\n```\n\nThe problem is : the constructor should deduce the parent with just a list of elements.\nIt is not possible since a bijection is : a support (often implemented with a list of elements) and the image of the support (implemented by another list of  the same elements).\n\nSo, we need those two informations.\n\nSo i propose the following solutions :\n 1) we remove the constructor `__class_call_private__` and say that user have to use the parents to\n   construct their objects\n 2) we improve the message error : \n    \"Impossible to guess parents, please construct your derangement by using Derangements\"\n 3) we check if the elements of the list have a canonical total order, we order them and construct\n   the parent Derangements( sorted(lst) )\n 4) The constructor of derangement should always have a list of elements and an order function in parameter. During the construction a parent is obtained with the ordering function and then, the derangement is obtained with the help of the parent. If the ordering function is None, the constructor will use the default ordering on the element.\n\nIn my opinion, i prefer the solution 4).",
    "created_at": "2019-01-31T11:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418172",
    "user": "https://trac.sagemath.org/admin/accounts/users/boussica"
}
```

<a id='comment:13'></a>
Review 1 remark 1 bis

The problem is the following : "how do we define correctly, without the parent, a derangement ?"

For example with your code we have :

```
sage: Derangement([2,3,1])
[2, 3, 1]
```

and 

```
sage: Derangement([x**3, 1+x, x**2])
---------------------------------------------------------------------------
AssertionError  
 ...
AssertionError: All elements of a derangement must be present in their parent set
```

The problem is : the constructor should deduce the parent with just a list of elements.
It is not possible since a bijection is : a support (often implemented with a list of elements) and the image of the support (implemented by another list of  the same elements).

So, we need those two informations.

So i propose the following solutions :
 1) we remove the constructor `__class_call_private__` and say that user have to use the parents to
   construct their objects
 2) we improve the message error : 
    "Impossible to guess parents, please construct your derangement by using Derangements"
 3) we check if the elements of the list have a canonical total order, we order them and construct
   the parent Derangements( sorted(lst) )
 4) The constructor of derangement should always have a list of elements and an order function in parameter. During the construction a parent is obtained with the ordering function and then, the derangement is obtained with the help of the parent. If the ordering function is None, the constructor will use the default ordering on the element.

In my opinion, i prefer the solution 4).



---

archive/issue_comments_418173.json:
```json
{
    "body": "**Changing reviewer** from \"boussica\" to \"Adrien Boussicault\".",
    "created_at": "2019-01-31T13:40:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418173",
    "user": "https://github.com/vinklein"
}
```

**Changing reviewer** from "boussica" to "Adrien Boussicault".



---

archive/issue_comments_418174.json:
```json
{
    "body": "<a id='comment:15'></a>\nReview 1 Remark 2 :\n\nThe problem raised by Travis in ticket #26884 comment 12 [ticket:26884#comment:12] can be applyed to this ticket.\n\nTravis worte :\n\n> -1 on going through an essentially trivial `_element_constructor_` in internal code that should give valid > output. At the very least, you should not run the checks when constructing objects from internal code. \n\n\nWe need to fix and discuss the functionality of `ClonableList` class , `Check()` function and thet `SetFactory` framework with Florent to answer correctly to that question.",
    "created_at": "2019-02-07T09:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418174",
    "user": "https://trac.sagemath.org/admin/accounts/users/boussica"
}
```

<a id='comment:15'></a>
Review 1 Remark 2 :

The problem raised by Travis in ticket #26884 comment 12 [ticket:26884#comment:12] can be applyed to this ticket.

Travis worte :

> -1 on going through an essentially trivial `_element_constructor_` in internal code that should give valid > output. At the very least, you should not run the checks when constructing objects from internal code. 


We need to fix and discuss the functionality of `ClonableList` class , `Check()` function and thet `SetFactory` framework with Florent to answer correctly to that question.



---

archive/issue_events_241367.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boussica",
    "created_at": "2019-02-07T09:16:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241367"
}
```



---

archive/issue_events_241368.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/boussica",
    "created_at": "2019-02-07T09:16:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241368"
}
```



---

archive/issue_events_241369.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241369"
}
```



---

archive/issue_events_241370.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241370"
}
```



---

archive/issue_comments_418175.json:
```json
{
    "body": "<a id='comment:17'></a>\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418175",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>
Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_418176.json:
```json
{
    "body": "<a id='comment:18'></a>\nTickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418176",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>
Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_events_241371.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241371"
}
```



---

archive/issue_events_241372.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241372"
}
```



---

archive/issue_events_241373.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241373"
}
```



---

archive/issue_events_241374.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241374"
}
```



---

archive/issue_comments_418177.json:
```json
{
    "body": "<a id='comment:19'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418177",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>
Ticket retargeted after milestone closed



---

archive/issue_comments_418178.json:
```json
{
    "body": "<a id='comment:20'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418178",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_241375.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241375"
}
```



---

archive/issue_events_241376.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241376"
}
```



---

archive/issue_events_241377.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241377"
}
```



---

archive/issue_events_241378.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241378"
}
```



---

archive/issue_events_241379.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241379"
}
```



---

archive/issue_events_241380.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241380"
}
```



---

archive/issue_comments_418179.json:
```json
{
    "body": "<a id='comment:22'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418179",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_241381.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241381"
}
```



---

archive/issue_events_241382.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241382"
}
```



---

archive/issue_comments_418180.json:
```json
{
    "body": "<a id='comment:23'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-418180",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_241383.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241383"
}
```



---

archive/issue_events_241384.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241384"
}
```



---

archive/issue_events_241385.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241385"
}
```



---

archive/issue_events_241386.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241386"
}
```



---

archive/issue_events_241387.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241387"
}
```



---

archive/issue_events_241388.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26886#event-241388"
}
```
