# Issue 26958: Inheriting from MPolynomialRing_libsingular crashes sage

archive/issues_026721.json:
```json
{
    "body": "The following crashes sage with a SIGSEGV:\n\n```\nsage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular\nsage: class Foo(MPolynomialRing_libsingular):\n....:     pass\nsage: Foo(QQ, 2, ['x','y'], 'degrevlex')\n```\nStrangely enough this bug is triggered only when inheriting; indeed the following works as expected:\n\n```\nsage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular\nsage: MPolynomialRing_libsingular(QQ, 2, ['x','y'], 'degrevlex')\nMultivariate Polynomial Ring in x, y over Rational Field\n```\n\nAs it turns out this bug is due to a spurious call to `__init_extra__` of `Algebras(...).parent_class`. Univariate polynomial rings avoid this call by setting  the attribute `_no_generic_basering_coercion = True`; now multivariate polynomial rings do so too.\n\n\nKeywords: polynomial rings\n\nReviewer: Jeroen Demeyer\n\nAuthor: Salvatore Stella\n\nBranch: 57c81821cf0afc9060f2826002a56b9ff3563653\n\nCommit: 57c81821cf0afc9060f2826002a56b9ff3563653\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26958\n\n",
    "closed_at": "2019-01-23T14:17:35Z",
    "created_at": "2018-12-25T19:08:20Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Inheriting from MPolynomialRing_libsingular crashes sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26958",
    "user": "https://github.com/etn40ff"
}
```
The following crashes sage with a SIGSEGV:

```
sage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular
sage: class Foo(MPolynomialRing_libsingular):
....:     pass
sage: Foo(QQ, 2, ['x','y'], 'degrevlex')
```
Strangely enough this bug is triggered only when inheriting; indeed the following works as expected:

```
sage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular
sage: MPolynomialRing_libsingular(QQ, 2, ['x','y'], 'degrevlex')
Multivariate Polynomial Ring in x, y over Rational Field
```

As it turns out this bug is due to a spurious call to `__init_extra__` of `Algebras(...).parent_class`. Univariate polynomial rings avoid this call by setting  the attribute `_no_generic_basering_coercion = True`; now multivariate polynomial rings do so too.


Keywords: polynomial rings

Reviewer: Jeroen Demeyer

Author: Salvatore Stella

Branch: 57c81821cf0afc9060f2826002a56b9ff3563653

Commit: 57c81821cf0afc9060f2826002a56b9ff3563653

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26958





---

archive/issue_comments_375405.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2018-12-25T19:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375405",
    "user": "https://github.com/etn40ff"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_375406.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-25T19:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375406",
    "user": "https://github.com/etn40ff"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_375407.json:
```json
{
    "body": "<a id='comment:2'></a>Doesn't hurt I suppose...",
    "created_at": "2018-12-26T15:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375407",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>Doesn't hurt I suppose...



---

archive/issue_comments_375408.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-26T15:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375408",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375409.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2018-12-26T15:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375409",
    "user": "https://github.com/jdemeyer"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_375410.json:
```json
{
    "body": "<a id='comment:3'></a>Although maybe a minor comment about the code: can you replace\n\n```\ncdef public bool _no_generic_basering_coercion\n```\nby\n\n```\ncdef readonly _no_generic_basering_coercion\n```\nand remove the `bool` cimport (which serves no purpose)?",
    "created_at": "2018-12-26T15:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375410",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>Although maybe a minor comment about the code: can you replace

```
cdef public bool _no_generic_basering_coercion
```
by

```
cdef readonly _no_generic_basering_coercion
```
and remove the `bool` cimport (which serves no purpose)?



---

archive/issue_comments_375411.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-12-26T15:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375411",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_375412.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-27T09:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375413.json:
```json
{
    "body": "<a id='comment:5'></a>Done, thanks for the review.\n\nA side note worth noting for #25558: after this patch it is possible to inherit from `MPolynomialRing_libsingular` but it is not possible to change its element class because the element constructor uses a function, `new_MP`, which hardcodes its output.",
    "created_at": "2018-12-27T09:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375413",
    "user": "https://github.com/etn40ff"
}
```

<a id='comment:5'></a>Done, thanks for the review.

A side note worth noting for #25558: after this patch it is possible to inherit from `MPolynomialRing_libsingular` but it is not possible to change its element class because the element constructor uses a function, `new_MP`, which hardcodes its output.



---

archive/issue_comments_375414.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-12-27T09:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375414",
    "user": "https://github.com/etn40ff"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_375415.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-06T08:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375415",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_066855.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-66855"
}
```



---

archive/issue_comments_375416.json:
```json
{
    "body": "<a id='comment:8'></a>Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375416",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_events_066856.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T14:17:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-66856"
}
```



---

archive/issue_comments_375417.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-23T14:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-375417",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
