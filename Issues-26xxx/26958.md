# Issue 26958: Inheriting from MPolynomialRing_libsingular crashes sage

archive/issues_026721.json:
```json
{
    "body": "The following crashes sage with a SIGSEGV:\n\n```\nsage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular\nsage: class Foo(MPolynomialRing_libsingular):\n....:     pass\nsage: Foo(QQ, 2, ['x','y'], 'degrevlex')\n```\nStrangely enough this bug is triggered only when inheriting; indeed the following works as expected:\n\n```\nsage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular\nsage: MPolynomialRing_libsingular(QQ, 2, ['x','y'], 'degrevlex')\nMultivariate Polynomial Ring in x, y over Rational Field\n```\n\nAs it turns out this bug is due to a spurious call to `__init_extra__` of `Algebras(...).parent_class`. Univariate polynomial rings avoid this call by setting  the attribute `_no_generic_basering_coercion = True`; now multivariate polynomial rings do so too.\n\n\n**Keywords:** polynomial rings\n\n**Branch/Commit:** [57c81821cf0afc9060f2826002a56b9ff3563653](https://github.com/sagemath/sagetrac-mirror/commit/57c81821cf0afc9060f2826002a56b9ff3563653)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Salvatore Stella\n\nIssue created by migration from https://trac.sagemath.org/ticket/26958\n\n",
    "closed_at": "2019-01-23T14:17:35Z",
    "created_at": "2018-12-25T19:08:20Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Inheriting from MPolynomialRing_libsingular crashes sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26958",
    "user": "https://github.com/etn40ff"
}
```
The following crashes sage with a SIGSEGV:

```
sage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular
sage: class Foo(MPolynomialRing_libsingular):
....:     pass
sage: Foo(QQ, 2, ['x','y'], 'degrevlex')
```
Strangely enough this bug is triggered only when inheriting; indeed the following works as expected:

```
sage: from sage.rings.polynomial.multi_polynomial_libsingular import MPolynomialRing_libsingular
sage: MPolynomialRing_libsingular(QQ, 2, ['x','y'], 'degrevlex')
Multivariate Polynomial Ring in x, y over Rational Field
```

As it turns out this bug is due to a spurious call to `__init_extra__` of `Algebras(...).parent_class`. Univariate polynomial rings avoid this call by setting  the attribute `_no_generic_basering_coercion = True`; now multivariate polynomial rings do so too.


**Keywords:** polynomial rings

**Branch/Commit:** [57c81821cf0afc9060f2826002a56b9ff3563653](https://github.com/sagemath/sagetrac-mirror/commit/57c81821cf0afc9060f2826002a56b9ff3563653)

**Reviewer:** Jeroen Demeyer

**Author:** Salvatore Stella

Issue created by migration from https://trac.sagemath.org/ticket/26958





---

archive/issue_comments_419897.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d628f1459d21ecd34c14366336a7b56fc677b78c\">d628f14</a></td><td><code>Fix 26958</code></td></tr></table>\n",
    "created_at": "2018-12-25T19:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419897",
    "user": "https://github.com/etn40ff"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d628f1459d21ecd34c14366336a7b56fc677b78c">d628f14</a></td><td><code>Fix 26958</code></td></tr></table>




---

archive/issue_comments_419898.json:
```json
{
    "body": "**Branch:** [u/etn40ff/26958](https://github.com/sagemath/sagetrac-mirror/tree/u/etn40ff/26958)",
    "created_at": "2018-12-25T19:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419898",
    "user": "https://github.com/etn40ff"
}
```

**Branch:** [u/etn40ff/26958](https://github.com/sagemath/sagetrac-mirror/tree/u/etn40ff/26958)



---

archive/issue_comments_419899.json:
```json
{
    "body": "**Commit:** [d628f1459d21ecd34c14366336a7b56fc677b78c](https://github.com/sagemath/sagetrac-mirror/commit/d628f1459d21ecd34c14366336a7b56fc677b78c)",
    "created_at": "2018-12-25T19:12:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419899",
    "user": "https://github.com/etn40ff"
}
```

**Commit:** [d628f1459d21ecd34c14366336a7b56fc677b78c](https://github.com/sagemath/sagetrac-mirror/commit/d628f1459d21ecd34c14366336a7b56fc677b78c)



---

archive/issue_events_242181.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2018-12-25T19:12:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242181"
}
```



---

archive/issue_comments_419900.json:
```json
{
    "body": "<a id='comment:2'></a>\nDoesn't hurt I suppose...",
    "created_at": "2018-12-26T15:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419900",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
Doesn't hurt I suppose...



---

archive/issue_events_242182.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-26T15:55:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242182"
}
```



---

archive/issue_events_242183.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-26T15:55:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242183"
}
```



---

archive/issue_comments_419901.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2018-12-26T15:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419901",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_events_242184.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-26T15:55:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242184"
}
```



---

archive/issue_comments_419902.json:
```json
{
    "body": "<a id='comment:3'></a>\nAlthough maybe a minor comment about the code: can you replace\n\n```\ncdef public bool _no_generic_basering_coercion\n```\nby\n\n```\ncdef readonly _no_generic_basering_coercion\n```\nand remove the `bool` cimport (which serves no purpose)?",
    "created_at": "2018-12-26T15:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419902",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
Although maybe a minor comment about the code: can you replace

```
cdef public bool _no_generic_basering_coercion
```
by

```
cdef readonly _no_generic_basering_coercion
```
and remove the `bool` cimport (which serves no purpose)?



---

archive/issue_events_242185.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-26T15:57:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242185"
}
```



---

archive/issue_events_242186.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-26T15:57:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242186"
}
```



---

archive/issue_comments_419903.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57c81821cf0afc9060f2826002a56b9ff3563653\">57c8182</a></td><td><code>Avoid importing bool</code></td></tr></table>\n",
    "created_at": "2018-12-27T09:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419903",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57c81821cf0afc9060f2826002a56b9ff3563653">57c8182</a></td><td><code>Avoid importing bool</code></td></tr></table>




---

archive/issue_comments_419904.json:
```json
{
    "body": "**Changing commit** from \"[d628f1459d21ecd34c14366336a7b56fc677b78c](https://github.com/sagemath/sagetrac-mirror/commit/d628f1459d21ecd34c14366336a7b56fc677b78c)\" to \"[57c81821cf0afc9060f2826002a56b9ff3563653](https://github.com/sagemath/sagetrac-mirror/commit/57c81821cf0afc9060f2826002a56b9ff3563653)\".",
    "created_at": "2018-12-27T09:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d628f1459d21ecd34c14366336a7b56fc677b78c](https://github.com/sagemath/sagetrac-mirror/commit/d628f1459d21ecd34c14366336a7b56fc677b78c)" to "[57c81821cf0afc9060f2826002a56b9ff3563653](https://github.com/sagemath/sagetrac-mirror/commit/57c81821cf0afc9060f2826002a56b9ff3563653)".



---

archive/issue_comments_419905.json:
```json
{
    "body": "<a id='comment:5'></a>\nDone, thanks for the review.\n\nA side note worth noting for #25558: after this patch it is possible to inherit from `MPolynomialRing_libsingular` but it is not possible to change its element class because the element constructor uses a function, `new_MP`, which hardcodes its output.",
    "created_at": "2018-12-27T09:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419905",
    "user": "https://github.com/etn40ff"
}
```

<a id='comment:5'></a>
Done, thanks for the review.

A side note worth noting for #25558: after this patch it is possible to inherit from `MPolynomialRing_libsingular` but it is not possible to change its element class because the element constructor uses a function, `new_MP`, which hardcodes its output.



---

archive/issue_events_242187.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2018-12-27T09:26:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242187"
}
```



---

archive/issue_events_242188.json:
```json
{
    "actor": "https://github.com/etn40ff",
    "created_at": "2018-12-27T09:26:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242188"
}
```



---

archive/issue_events_242189.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-06T08:41:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242189"
}
```



---

archive/issue_events_242190.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-06T08:41:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242190"
}
```



---

archive/issue_events_242191.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242191"
}
```



---

archive/issue_events_242192.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242192"
}
```



---

archive/issue_comments_419906.json:
```json
{
    "body": "<a id='comment:8'></a>\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419906",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_419907.json:
```json
{
    "body": "**Changing branch** from \"[u/etn40ff/26958](https://github.com/sagemath/sagetrac-mirror/tree/u/etn40ff/26958)\" to \"[57c81821cf0afc9060f2826002a56b9ff3563653](https://github.com/sagemath/sagetrac-mirror/commit/57c81821cf0afc9060f2826002a56b9ff3563653)\".",
    "created_at": "2019-01-23T14:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26958#issuecomment-419907",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/etn40ff/26958](https://github.com/sagemath/sagetrac-mirror/tree/u/etn40ff/26958)" to "[57c81821cf0afc9060f2826002a56b9ff3563653](https://github.com/sagemath/sagetrac-mirror/commit/57c81821cf0afc9060f2826002a56b9ff3563653)".



---

archive/issue_events_242193.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T14:17:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242193"
}
```



---

archive/issue_events_242194.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T14:17:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26958",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26958#event-242194"
}
```
