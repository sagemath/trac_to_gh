# Issue 26769: Add an issequence utility to check for list, tuple, and other compatible objects

archive/issues_026532.json:
```json
{
    "assignees": [],
    "body": "`git grep 'isinstance(.*, *(list, *tuple))'` reveals a widespread use of this type check in the Sage library.\n\nThrough the transition to Python 3, many standard functions such as `range` no longer construct lists but return special objects that support the sequence protocol.\n\n\nThis ticket adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.\n\nFor the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.\n\n#24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.\n\nSee also:\n- #24815 Register `FreeModuleElement` to the `Sequence` ABC\n\nCC:  @fchapoton @jdemeyer @tscrim\n\nKeywords: **python3**\n\nBranch/Commit: **[u/embray/misc/issequence](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/issequence) @ [1d7066c](https://github.com/sagemath/sagetrac-mirror/commit/1d7066c898c4885ff33e5385b20d5892993cbc98)**\n\nAuthor: **Erik Bray**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26769_\n\n",
    "created_at": "2018-11-26T15:09:10Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20info"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add an issequence utility to check for list, tuple, and other compatible objects",
    "type": "issue",
    "updated_at": "2022-08-31T05:25:02Z",
    "url": "https://github.com/sagemath/sage/issues/26769",
    "user": "https://github.com/embray"
}
```
`git grep 'isinstance(.*, *(list, *tuple))'` reveals a widespread use of this type check in the Sage library.

Through the transition to Python 3, many standard functions such as `range` no longer construct lists but return special objects that support the sequence protocol.


This ticket adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.

For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.

#24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.

See also:
- #24815 Register `FreeModuleElement` to the `Sequence` ABC

CC:  @fchapoton @jdemeyer @tscrim

Keywords: **python3**

Branch/Commit: **[u/embray/misc/issequence](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/misc/issequence) @ [1d7066c](https://github.com/sagemath/sagetrac-mirror/commit/1d7066c898c4885ff33e5385b20d5892993cbc98)**

Author: **Erik Bray**

_Issue created by migration from https://trac.sagemath.org/ticket/26769_





---

archive/issue_events_349806.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-11-26T15:09:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349806"
}
```



---

archive/issue_events_349807.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-11-26T15:09:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349807"
}
```



---

archive/issue_events_349808.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-11-26T15:09:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349808"
}
```



---

archive/issue_events_349809.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-11-26T15:26:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349809"
}
```



---

archive/issue_comments_414996.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\n1. What's the difference between this and `isinstance(x, Sequence)`? I feel like that should be explained better.\n\n2. There is no point in adding an empty `.pyx` file (unless I'm missing something)",
    "created_at": "2018-11-26T16:48:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-414996",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:2" align="right">Comment 2</div>

1. What's the difference between this and `isinstance(x, Sequence)`? I feel like that should be explained better.

2. There is no point in adding an empty `.pyx` file (unless I'm missing something)



---

archive/issue_comments_414997.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\n3. Is it possible for a subclass of `list`/`tuple` not to be a sequence? Just asking because you use `FOO_CheckExact` as opposed to `FOO_Check`.",
    "created_at": "2018-11-26T17:01:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-414997",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:3" align="right">Comment 3</div>

3. Is it possible for a subclass of `list`/`tuple` not to be a sequence? Just asking because you use `FOO_CheckExact` as opposed to `FOO_Check`.



---

archive/issue_comments_414998.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nReplying to [@jdemeyer](#comment%3A2):\n> 1. What's the difference between this and `isinstance(x, Sequence)`? I feel like that should be explained better.\n\nThese are technically completely different things.  The C-API level \"sequence protocol\" is defined by implementing some or all of the [PySequenceMethods](https://docs.python.org/2/c-api/typeobj.html#c.PySequenceMethods) (the way `PySequence_Check` is implemented all it cares about is that `sq_item` by implemented at a minimum).\n\nThis is different from the Python level `collections.abc` \"Sequence\" ABC which requires that both `__getitem__` and `__len__` are implemented.\n\nThis inconsistent overloading of terms is irritating and confusing, but it is what it is.  So this interface defines my own sort of middle-ground which is closer to the ABC in that it requires both the C-level sequence interface (which Python classes that implement `__getitem__` have), but also that `PySequence_Length` works and returns a non-negative integer.  There is an assumption then that `obj[n]` will work for `[0:len(obj)]`.  Unfortunately, for types defined at the Python level there is no obvious way to explicitly distinguish between a \"sequence\" and a \"mapping\".\n\nA class that implements a custom `__getitem__` may work as one or the other, or both, so the best we can do is check for `__getitem__` and `__len__` and hope it works \"like a list\", which is how I'm defining \"sequence\" in this case.\n\nWe special case tuple and list here since they are going to be quite common and are known to be the two most fundamental sequence types built into Python (as opposed to dict, which is not considered a sequence).\n\n> 2. There is no point in adding an empty `.pyx` file (unless I'm missing something)\n\nIf you don't have the .pyx file Cython won't actually generate a Python module that can be used by Python.  You can still `cimport` cpdef functions defined in a .pxd file from other Cython code, but you can't use it in Python :/",
    "created_at": "2018-11-27T12:43:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-414998",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">Comment 4</div>

Replying to [@jdemeyer](#comment%3A2):
> 1. What's the difference between this and `isinstance(x, Sequence)`? I feel like that should be explained better.

These are technically completely different things.  The C-API level "sequence protocol" is defined by implementing some or all of the [PySequenceMethods](https://docs.python.org/2/c-api/typeobj.html#c.PySequenceMethods) (the way `PySequence_Check` is implemented all it cares about is that `sq_item` by implemented at a minimum).

This is different from the Python level `collections.abc` "Sequence" ABC which requires that both `__getitem__` and `__len__` are implemented.

This inconsistent overloading of terms is irritating and confusing, but it is what it is.  So this interface defines my own sort of middle-ground which is closer to the ABC in that it requires both the C-level sequence interface (which Python classes that implement `__getitem__` have), but also that `PySequence_Length` works and returns a non-negative integer.  There is an assumption then that `obj[n]` will work for `[0:len(obj)]`.  Unfortunately, for types defined at the Python level there is no obvious way to explicitly distinguish between a "sequence" and a "mapping".

A class that implements a custom `__getitem__` may work as one or the other, or both, so the best we can do is check for `__getitem__` and `__len__` and hope it works "like a list", which is how I'm defining "sequence" in this case.

We special case tuple and list here since they are going to be quite common and are known to be the two most fundamental sequence types built into Python (as opposed to dict, which is not considered a sequence).

> 2. There is no point in adding an empty `.pyx` file (unless I'm missing something)

If you don't have the .pyx file Cython won't actually generate a Python module that can be used by Python.  You can still `cimport` cpdef functions defined in a .pxd file from other Cython code, but you can't use it in Python :/



---

archive/issue_comments_414999.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@jdemeyer](#comment%3A3):\n> 3. Is it possible for a subclass of `list`/`tuple` not to be a sequence? Just asking because you use `FOO_CheckExact` as opposed to `FOO_Check`.\n\nFrom the C API perspective a subclass will still technically be a sequence, but there's no guarantee that it isn't broken in some way, and it's still necessary in those cases to go through the slower but more generic `PySequence_ITEM` calls, as opposed to `PyList_GET_ITEM` when accessing items, for example.\n\nLikewise in `issequence`, for subclasses it's kind of necessary to go through the slightly slower path of calling `PySequence_Length`, and you only add overhead to the more common \"exact\" case, while gaining nothing.",
    "created_at": "2018-11-27T12:53:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-414999",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@jdemeyer](#comment%3A3):
> 3. Is it possible for a subclass of `list`/`tuple` not to be a sequence? Just asking because you use `FOO_CheckExact` as opposed to `FOO_Check`.

From the C API perspective a subclass will still technically be a sequence, but there's no guarantee that it isn't broken in some way, and it's still necessary in those cases to go through the slower but more generic `PySequence_ITEM` calls, as opposed to `PyList_GET_ITEM` when accessing items, for example.

Likewise in `issequence`, for subclasses it's kind of necessary to go through the slightly slower path of calling `PySequence_Length`, and you only add overhead to the more common "exact" case, while gaining nothing.



---

archive/issue_comments_415000.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n Adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.\n \n For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.\n+\n+#24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.\n``````\n",
    "created_at": "2018-11-27T13:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415000",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 Adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.
 
 For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.
+
+#24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.
``````




---

archive/issue_comments_415001.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nIt would be better if Python had, say, a `__getindex__` and related magic methods that could explicitly distinguish a type as a sequence as opposed to a more general mapping.  Perhaps I will propose that...",
    "created_at": "2018-11-27T13:36:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415001",
    "user": "https://github.com/embray"
}
```

<div id="comment:7" align="right">Comment 7</div>

It would be better if Python had, say, a `__getindex__` and related magic methods that could explicitly distinguish a type as a sequence as opposed to a more general mapping.  Perhaps I will propose that...



---

archive/issue_comments_415002.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nReplying to [@jdemeyer](#comment%3A2):\n> 1. What's the difference between this and `isinstance(x, Sequence)`? I feel like that should be explained better.\n\nNow that I've had lunch, let me give a slightly clearer answer to this: This is effectively the same as `isinstance(x, Sequence)`, but it is much faster, both in the positive and negative cases, in that it bypasses all of the slow `isinstance` machinery entirely and does not result in calls to `Sequence.__subclasshook__` for types that do not obviously already implement the Sequence protocol.\n\nThe only case where it can be a slightly slow is for the cases where it has to call `PySequence_Length`, but that itself is only slow on classes that already implement `__getitem__` and `__len__`.",
    "created_at": "2018-11-27T13:48:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415002",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">Comment 8</div>

Replying to [@jdemeyer](#comment%3A2):
> 1. What's the difference between this and `isinstance(x, Sequence)`? I feel like that should be explained better.

Now that I've had lunch, let me give a slightly clearer answer to this: This is effectively the same as `isinstance(x, Sequence)`, but it is much faster, both in the positive and negative cases, in that it bypasses all of the slow `isinstance` machinery entirely and does not result in calls to `Sequence.__subclasshook__` for types that do not obviously already implement the Sequence protocol.

The only case where it can be a slightly slow is for the cases where it has to call `PySequence_Length`, but that itself is only slow on classes that already implement `__getitem__` and `__len__`.



---

archive/issue_comments_415003.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nWhat about point 2 in [comment:2](#comment%3A2) ?\n\nEDIT: OK, I missed that you answered that already.\n\nCan we move on ? I hope that Jeroen can finish the review.",
    "created_at": "2018-12-07T19:33:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415003",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:9" align="right">Comment 9</div>

What about point 2 in [comment:2](#comment%3A2) ?

EDIT: OK, I missed that you answered that already.

Can we move on ? I hope that Jeroen can finish the review.



---

archive/issue_comments_415004.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nOne other comment worth adding about this, is that it needs to be used *carefully*.  Almost any custom class in Python (except those explicitly inheriting from `dict`, I believe) that implements a `__getitem__` can be interpreted by Python as a \"sequence\" type.  Per my note in [comment:7](#comment%3A7), I think this is a fundamental shortcoming in Python though, and something we just have to deal with on some level...",
    "created_at": "2018-12-10T13:07:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415004",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">Comment 10</div>

One other comment worth adding about this, is that it needs to be used *carefully*.  Almost any custom class in Python (except those explicitly inheriting from `dict`, I believe) that implements a `__getitem__` can be interpreted by Python as a "sequence" type.  Per my note in [comment:7](#comment%3A7), I think this is a fundamental shortcoming in Python though, and something we just have to deal with on some level...



---

archive/issue_events_349810.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:10:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349810"
}
```



---

archive/issue_events_349811.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:10:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349811"
}
```



---

archive/issue_comments_415005.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nRetargeting some of my tickets (somewhat optimistically for now).",
    "created_at": "2018-12-28T14:10:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415005",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">Comment 11</div>

Retargeting some of my tickets (somewhat optimistically for now).



---

archive/issue_comments_415006.json:
```json
{
    "body": "Replying to [ticket:26769 embray]:\n> Adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))`\n\nI'm not really convinced that this `issequence(x)` is the correct replacement for `isinstance(x, (list, tuple))`. In the majority of cases, you probably want to be more general and accept any iterable. In the example #24804 that you refer to, you only iterate over the object so why restrict to sequences?\n\nAnd the way: I also agree that the mapping vs sequence thing is annoying.",
    "created_at": "2019-01-29T12:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415006",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:26769 embray]:
> Adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))`

I'm not really convinced that this `issequence(x)` is the correct replacement for `isinstance(x, (list, tuple))`. In the majority of cases, you probably want to be more general and accept any iterable. In the example #24804 that you refer to, you only iterate over the object so why restrict to sequences?

And the way: I also agree that the mapping vs sequence thing is annoying.



---

archive/issue_comments_415007.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nThis is specifically intended for cases where the iterable is treated sequentially: That is, it is assumed that it can be indexed with monotonically increasing integer indices.   There are many cases like this where you do *not* want to be more general and do not want to accept an arbitrary iterable, at least, without eagerly consuming the iterable in order to convert it to a sequence (e.g. `list(iterable)`) which is obviously wasteful if you already have a sequence-like object.",
    "created_at": "2019-01-29T16:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415007",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">Comment 13</div>

This is specifically intended for cases where the iterable is treated sequentially: That is, it is assumed that it can be indexed with monotonically increasing integer indices.   There are many cases like this where you do *not* want to be more general and do not want to accept an arbitrary iterable, at least, without eagerly consuming the iterable in order to convert it to a sequence (e.g. `list(iterable)`) which is obviously wasteful if you already have a sequence-like object.



---

archive/issue_comments_415008.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nFor example, there are many cases where you have `isinstance(x, (list tuple))` where it should also be able to accept something like a vector or a matrix, and just arbitrarily doesn't because of this less general check.",
    "created_at": "2019-01-29T16:55:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415008",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">Comment 14</div>

For example, there are many cases where you have `isinstance(x, (list tuple))` where it should also be able to accept something like a vector or a matrix, and just arbitrarily doesn't because of this less general check.



---

archive/issue_comments_415009.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nMoving all my in-progress tickets to 8.8 milestone.",
    "created_at": "2019-03-25T10:43:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415009",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">Comment 15</div>

Moving all my in-progress tickets to 8.8 milestone.



---

archive/issue_events_349812.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:43:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349812"
}
```



---

archive/issue_events_349813.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:43:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349813"
}
```



---

archive/issue_comments_415010.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@jdemeyer](#comment%3A12):\n> Replying to [ticket:26769 embray]:\n> > Adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))`\n\n> \n> I'm not really convinced that this `issequence(x)` is the correct replacement for `isinstance(x, (list, tuple))`. In the majority of cases, you probably want to be more general and accept any iterable. In the example #24804 that you refer to, you only iterate over the object so why restrict to sequences?\n\nIn many cases you *don't* just want an arbitrary iterable and that's what this is for.\n\nAnything more general and you wind up back mired in the performance problems of using `isinstance` and ABCs.\n\nIf there's one tweak to this I would make it would be to explicitly exclude `str` and `bytes`, since although they are technically sequences under this definition, most of the time we want to treat them separately.\n\nI think this problem *badly* needs a solution so I'd be happy to consider an alternative, but I think this is pretty useful in the vast majority of cases where it's needed.",
    "created_at": "2019-04-08T16:10:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415010",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@jdemeyer](#comment%3A12):
> Replying to [ticket:26769 embray]:
> > Adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))`

> 
> I'm not really convinced that this `issequence(x)` is the correct replacement for `isinstance(x, (list, tuple))`. In the majority of cases, you probably want to be more general and accept any iterable. In the example #24804 that you refer to, you only iterate over the object so why restrict to sequences?

In many cases you *don't* just want an arbitrary iterable and that's what this is for.

Anything more general and you wind up back mired in the performance problems of using `isinstance` and ABCs.

If there's one tweak to this I would make it would be to explicitly exclude `str` and `bytes`, since although they are technically sequences under this definition, most of the time we want to treat them separately.

I think this problem *badly* needs a solution so I'd be happy to consider an alternative, but I think this is pretty useful in the vast majority of cases where it's needed.



---

archive/issue_events_349814.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349814"
}
```



---

archive/issue_events_349815.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-07-03T11:37:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349815"
}
```



---

archive/issue_comments_415011.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nMoving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415011",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">Comment 17</div>

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_events_349816.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349816"
}
```



---

archive/issue_events_349817.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349817"
}
```



---

archive/issue_comments_415012.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415012",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">Comment 18</div>

Ticket retargeted after milestone closed



---

archive/issue_comments_415013.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415013",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">Comment 19</div>

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_events_349818.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349818"
}
```



---

archive/issue_events_349819.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349819"
}
```



---

archive/issue_events_349820.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-27T04:32:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349820"
}
```



---

archive/issue_events_349821.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-27T04:32:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349821"
}
```



---

archive/issue_comments_415014.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nThe ticket description is too abstract. There should be a demonstration of the benefits of this new interface on key examples. IOW - what problem does it solve.",
    "created_at": "2020-08-27T04:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415014",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">Comment 20</div>

The ticket description is too abstract. There should be a demonstration of the benefits of this new interface on key examples. IOW - what problem does it solve.



---

archive/issue_comments_415015.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nI'm not sure what's clear about it.  This would fix a lot of code for example that used to work when passed `range(n)` on Python 2 but no longer works with Python 3 `range` objects, just as an example.  It can replace lots of code that explicitly tests for `isinstance(obj, (list, tuple))` to support any sequence (where a sequence is an object that admits integer indices from `0` to `len(obj) - 1`).",
    "created_at": "2020-08-31T13:42:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415015",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">Comment 21</div>

I'm not sure what's clear about it.  This would fix a lot of code for example that used to work when passed `range(n)` on Python 2 but no longer works with Python 3 `range` objects, just as an example.  It can replace lots of code that explicitly tests for `isinstance(obj, (list, tuple))` to support any sequence (where a sequence is an object that admits integer indices from `0` to `len(obj) - 1`).



---

archive/issue_comments_415016.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nThanks. So as an example of an example, we have\n\n```\nsage: vector(range(5))                                                                                                                            \n(0, 1, 2, 3, 4)\nsage: (QQ^5)(range(5))\nTypeError: can't initialize vector from nonzero non-list\nsage: (QQ^5)(list(range(5)))                                                                                                                      \n(0, 1, 2, 3, 4)\n```\nIs this what you are concerned about? More examples are needed on the ticket description so that the scope becomes clear.",
    "created_at": "2020-08-31T14:01:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415016",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">Comment 22</div>

Thanks. So as an example of an example, we have

```
sage: vector(range(5))                                                                                                                            
(0, 1, 2, 3, 4)
sage: (QQ^5)(range(5))
TypeError: can't initialize vector from nonzero non-list
sage: (QQ^5)(list(range(5)))                                                                                                                      
(0, 1, 2, 3, 4)
```
Is this what you are concerned about? More examples are needed on the ticket description so that the scope becomes clear.



---

archive/issue_comments_415017.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nReplying to [@mkoeppe](#comment%3A22):\n> Thanks. So as an example of an example, we have\n> \n> ```\n> sage: vector(range(5))                                                                                                                            \n> (0, 1, 2, 3, 4)\n> sage: (QQ^5)(range(5))\n> TypeError: can't initialize vector from nonzero non-list\n> sage: (QQ^5)(list(range(5)))                                                                                                                      \n> (0, 1, 2, 3, 4)\n> ```\n> Is this what you are concerned about? More examples are needed on the ticket description so that the scope becomes clear.\n> \n\nYes, that's the idea.  Thank you for coming up with the example.  I'll see if I can find more.\n\nI think in the case of `vector()` we must have special-cased `range` (I'm just guessing) but the idea is to have fewer special cases and broader support for this kind of case.  For example `vector` itself is a sequence but there are countless cases in Sage where you should be able to pass a vector as a sequence but that isn't supported.  I'm not a strong-enough Sage user to think of a good example off the top of my head though.",
    "created_at": "2020-08-31T14:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415017",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">Comment 24</div>

Replying to [@mkoeppe](#comment%3A22):
> Thanks. So as an example of an example, we have
> 
> ```
> sage: vector(range(5))                                                                                                                            
> (0, 1, 2, 3, 4)
> sage: (QQ^5)(range(5))
> TypeError: can't initialize vector from nonzero non-list
> sage: (QQ^5)(list(range(5)))                                                                                                                      
> (0, 1, 2, 3, 4)
> ```
> Is this what you are concerned about? More examples are needed on the ticket description so that the scope becomes clear.
> 

Yes, that's the idea.  Thank you for coming up with the example.  I'll see if I can find more.

I think in the case of `vector()` we must have special-cased `range` (I'm just guessing) but the idea is to have fewer special cases and broader support for this kind of case.  For example `vector` itself is a sequence but there are countless cases in Sage where you should be able to pass a vector as a sequence but that isn't supported.  I'm not a strong-enough Sage user to think of a good example off the top of my head though.



---

archive/issue_comments_415018.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nHow about \n\n```\n(QQ^5)(iter([1, 2, 3, 4, 5]))\n```",
    "created_at": "2020-08-31T15:08:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415018",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">Comment 25</div>

How about 

```
(QQ^5)(iter([1, 2, 3, 4, 5]))
```



---

archive/issue_comments_415019.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@mkoeppe](#comment%3A25):\n> How about \n> \n> ```\n> (QQ^5)(iter([1, 2, 3, 4, 5]))\n> ```\n\nAn iterator is *not* a sequence.  Many interfaces could and should support iterators too, but that needs to be handled separately since iterators do not necessarily have a length.  The focus here on sequences is that they do have a fixed length and so certain guarantees and optimizations can be made about them that can't be made with arbitrary iterators.",
    "created_at": "2020-08-31T15:20:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415019",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@mkoeppe](#comment%3A25):
> How about 
> 
> ```
> (QQ^5)(iter([1, 2, 3, 4, 5]))
> ```

An iterator is *not* a sequence.  Many interfaces could and should support iterators too, but that needs to be handled separately since iterators do not necessarily have a length.  The focus here on sequences is that they do have a fixed length and so certain guarantees and optimizations can be made about them that can't be made with arbitrary iterators.



---

archive/issue_comments_415020.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,9 @@\n-Adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.\n+`git grep 'isinstance(.*, *(list, *tuple))'` reveals a widespread use of this type check in the Sage library.\n+\n+Through the transition to Python 3, many standard functions such as `range` no longer construct lists but return special objects that support the sequence protocol.\n+\n+\n+This ticket adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.\n \n For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.\n \n``````\n",
    "created_at": "2020-08-31T15:49:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415020",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,9 @@
-Adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.
+`git grep 'isinstance(.*, *(list, *tuple))'` reveals a widespread use of this type check in the Sage library.
+
+Through the transition to Python 3, many standard functions such as `range` no longer construct lists but return special objects that support the sequence protocol.
+
+
+This ticket adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.
 
 For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.
 
``````




---

archive/issue_comments_415021.json:
```json
{
    "body": "Replying to [ticket:26769 embray]:\n> `Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.\n\nI think it would be worth excluding `str` and `bytes`. I think I have run several times into the problem that a string was destructured into a list of characters -- something that none of our classes should ever do if I'm not overlooking something.",
    "created_at": "2020-08-31T15:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415021",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [ticket:26769 embray]:
> `Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.

I think it would be worth excluding `str` and `bytes`. I think I have run several times into the problem that a string was destructured into a list of characters -- something that none of our classes should ever do if I'm not overlooking something.



---

archive/issue_comments_415022.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,24 @@\n \n Through the transition to Python 3, many standard functions such as `range` no longer construct lists but return special objects that support the sequence protocol.\n \n+Examples:\n+\n+```\n+sage: vector(range(5))                                                                                                                            \n+(0, 1, 2, 3, 4)\n+sage: (QQ^5)(range(5))\n+TypeError: can't initialize vector from nonzero non-list\n+sage: (QQ^5)(list(range(5)))                                                                                                                      \n+(0, 1, 2, 3, 4)\n+```\n \n This ticket adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.\n \n For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.\n \n #24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.\n+\n+Outside of the scope of this ticket:\n+- iterators (see comments 25-26 below)\n+\n+\n``````\n",
    "created_at": "2020-08-31T16:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415022",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,24 @@
 
 Through the transition to Python 3, many standard functions such as `range` no longer construct lists but return special objects that support the sequence protocol.
 
+Examples:
+
+```
+sage: vector(range(5))                                                                                                                            
+(0, 1, 2, 3, 4)
+sage: (QQ^5)(range(5))
+TypeError: can't initialize vector from nonzero non-list
+sage: (QQ^5)(list(range(5)))                                                                                                                      
+(0, 1, 2, 3, 4)
+```
 
 This ticket adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.
 
 For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.
 
 #24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.
+
+Outside of the scope of this ticket:
+- iterators (see comments 25-26 below)
+
+
``````




---

archive/issue_comments_415023.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nReplying to [@mkoeppe](#comment%3A28):\n> Replying to [ticket:26769 embray]:\n> > `Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.\n\n> \n> I think it would be worth excluding `str` and `bytes`. I think I have run several times into the problem that a string was destructured into a list of characters -- something that none of our classes should ever do if I'm not overlooking something.\n\nYeah I've agonized over this.  From a purist standpoint it really should include bytes and str.  But I agree with you completely.  Maybe it could be an optional flag (excluding them by default).  At least having a flag for it might make me more comfortable :)\n\n\nAs an aside, I just noticed a small bug in my code:\n\n```\n+    PyErr_Clear()\n```\n\nAs I recently learned from the review of a PR I made to Python, a bare `PyErr_Clear()` is slightly dangerous, because it can also clear exceptions from external events like `MemoryError` and `KeyboardInterrupt`.  I should use `PyErr_ExceptionMatches` here.",
    "created_at": "2020-08-31T16:06:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415023",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">Comment 30</div>

Replying to [@mkoeppe](#comment%3A28):
> Replying to [ticket:26769 embray]:
> > `Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.

> 
> I think it would be worth excluding `str` and `bytes`. I think I have run several times into the problem that a string was destructured into a list of characters -- something that none of our classes should ever do if I'm not overlooking something.

Yeah I've agonized over this.  From a purist standpoint it really should include bytes and str.  But I agree with you completely.  Maybe it could be an optional flag (excluding them by default).  At least having a flag for it might make me more comfortable :)


As an aside, I just noticed a small bug in my code:

```
+    PyErr_Clear()
```

As I recently learned from the review of a PR I made to Python, a bare `PyErr_Clear()` is slightly dangerous, because it can also clear exceptions from external events like `MemoryError` and `KeyboardInterrupt`.  I should use `PyErr_ExceptionMatches` here.



---

archive/issue_comments_415024.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,24 +2,9 @@\n \n Through the transition to Python 3, many standard functions such as `range` no longer construct lists but return special objects that support the sequence protocol.\n \n-Examples:\n-\n-```\n-sage: vector(range(5))                                                                                                                            \n-(0, 1, 2, 3, 4)\n-sage: (QQ^5)(range(5))\n-TypeError: can't initialize vector from nonzero non-list\n-sage: (QQ^5)(list(range(5)))                                                                                                                      \n-(0, 1, 2, 3, 4)\n-```\n \n This ticket adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.\n \n For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.\n \n #24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.\n-\n-Outside of the scope of this ticket:\n-- iterators (see comments 25-26 below)\n-\n-\n``````\n",
    "created_at": "2020-08-31T16:06:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415024",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,24 +2,9 @@
 
 Through the transition to Python 3, many standard functions such as `range` no longer construct lists but return special objects that support the sequence protocol.
 
-Examples:
-
-```
-sage: vector(range(5))                                                                                                                            
-(0, 1, 2, 3, 4)
-sage: (QQ^5)(range(5))
-TypeError: can't initialize vector from nonzero non-list
-sage: (QQ^5)(list(range(5)))                                                                                                                      
-(0, 1, 2, 3, 4)
-```
 
 This ticket adds an `issequence()` function that can work as a more generic replacement for `isinstance(x, (list, tuple))` but will also work with a broader range of similar types (e.g. `xrange`, Sage vectors, Numpy arrays, etc).  Note `issequence(x)` is also True for `str` and `bytes`.  So when using this to replace `(list, tuple)` care should be taken to make sure other sequence-like types are handled first, in cases where they require separate handling in the first place.
 
 For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.
 
 #24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.
-
-Outside of the scope of this ticket:
-- iterators (see comments 25-26 below)
-
-
``````




---

archive/issue_comments_415025.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,6 @@\n For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.\n \n #24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.\n+\n+See also:\n+- #24815 Register `FreeModuleElement` to the `Sequence` ABC\n``````\n",
    "created_at": "2020-09-02T01:46:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415025",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,6 @@
 For the very common case of `(list, tuple)` this is faster than `isinstance`, but also has the benefit of being more generic, while not *quite* as generic as the much slower `isinstance(x, Sequence)`.
 
 #24804 demonstrates an example usage which allows the constructor in question to also accept a Python 3 `range` object (an example which appears in the doctests that did not otherwise work).  This will likely be useful elsewhere but we can find those examples as we come to them.
+
+See also:
+- #24815 Register `FreeModuleElement` to the `Sequence` ABC
``````




---

archive/issue_events_349822.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349822"
}
```



---

archive/issue_events_349823.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349823"
}
```



---

archive/issue_comments_415026.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415026",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">Comment 33</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_349824.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349824"
}
```



---

archive/issue_events_349825.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349825"
}
```



---

archive/issue_events_349826.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349826"
}
```



---

archive/issue_events_349827.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349827"
}
```



---

archive/issue_comments_415027.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26769#issuecomment-415027",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">Comment 34</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_349828.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349828"
}
```



---

archive/issue_events_349829.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349829"
}
```



---

archive/issue_events_349830.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349830"
}
```



---

archive/issue_events_349831.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349831"
}
```



---

archive/issue_events_349832.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349832"
}
```



---

archive/issue_events_349833.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T05:25:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26769",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26769#event-349833"
}
```
