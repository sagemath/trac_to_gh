# Issue 26809: Wrong contains in Permutations avoiding a pattern

archive/issues_026572.json:
```json
{
    "body": "```\nsage: P = Permutations(3, avoiding=[[1,3,2]])\nsage: P.list()\n[[1, 2, 3], [3, 1, 2], [2, 1, 3], [2, 3, 1], [3, 2, 1]]\nsage: [1,3,2] in P\nTrue\n```\n\nBranch/Commit: 6bf62d99022ae9132fa3699e095fce91b2bde430\n\nReviewer: Daniel Krenn, Travis Scrimshaw\n\nAuthor: Martin Rubey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26809\n\n",
    "closed_at": "2019-01-23T14:17:57Z",
    "created_at": "2018-12-03T20:58:38Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Wrong contains in Permutations avoiding a pattern",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26809",
    "user": "https://github.com/mantepse"
}
```
```
sage: P = Permutations(3, avoiding=[[1,3,2]])
sage: P.list()
[[1, 2, 3], [3, 1, 2], [2, 1, 3], [2, 3, 1], [3, 2, 1]]
sage: [1,3,2] in P
True
```

Branch/Commit: 6bf62d99022ae9132fa3699e095fce91b2bde430

Reviewer: Daniel Krenn, Travis Scrimshaw

Author: Martin Rubey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26809





---

archive/issue_comments_373142.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-03T22:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373142",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_373143.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2018-12-03T22:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373143",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_373144.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-04T09:10:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_373145.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-01-06T17:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373145",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_373146.json:
```json
{
    "body": "<a id='comment:4'></a>1.\n\n```\n+        if not StandardPermutations_n_abstract.__contains__(self, x):\n```\nIs it possible to user super here? (If so, I think this is the Pythonic way to do.)\n\n2.\n\n```\n+        x = self.element_class(self, x)\n```\nI would write here `x = self(x)` as I think it is not guaranteed that the other works. (This comment is made from a general point of view how parent/elements are usually implemented. I have not looked at the particular implementation relevant for this code.)\n\n3.\n\n```\n-        StandardPermutations_avoiding_generic.__init__(self, n, Permutations()([1, 2]))\n+        StandardPermutations_avoiding_generic.__init__(self, n, (Permutations()([1, 2]),))\n```\nvs\n\n```\n-        super(StandardPermutations_avoiding_312, self).__init__(n, Permutations()([3, 1, 2]))\n+        super(StandardPermutations_avoiding_312, self).__init__(n, (Permutations()([3, 1, 2]),))\n```\nCan one use super everywhere?\n\nApart from this, LGTM",
    "created_at": "2019-01-06T17:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373146",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:4'></a>1.

```
+        if not StandardPermutations_n_abstract.__contains__(self, x):
```
Is it possible to user super here? (If so, I think this is the Pythonic way to do.)

2.

```
+        x = self.element_class(self, x)
```
I would write here `x = self(x)` as I think it is not guaranteed that the other works. (This comment is made from a general point of view how parent/elements are usually implemented. I have not looked at the particular implementation relevant for this code.)

3.

```
-        StandardPermutations_avoiding_generic.__init__(self, n, Permutations()([1, 2]))
+        StandardPermutations_avoiding_generic.__init__(self, n, (Permutations()([1, 2]),))
```
vs

```
-        super(StandardPermutations_avoiding_312, self).__init__(n, Permutations()([3, 1, 2]))
+        super(StandardPermutations_avoiding_312, self).__init__(n, (Permutations()([3, 1, 2]),))
```
Can one use super everywhere?

Apart from this, LGTM



---

archive/issue_comments_373147.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-06T20:16:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373147",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_373148.json:
```json
{
    "body": "<a id='comment:6'></a>I'll do the remaining super changes in #26810.",
    "created_at": "2019-01-06T20:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373148",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:6'></a>I'll do the remaining super changes in #26810.



---

archive/issue_comments_373149.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-06T20:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373149",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_373150.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 mantepse]:\n> I'll do the remaining super changes in #26810.\n\n\nFine for me.",
    "created_at": "2019-01-07T13:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373150",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:8'></a>Replying to [comment:6 mantepse]:
> I'll do the remaining super changes in #26810.


Fine for me.



---

archive/issue_comments_373151.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-07T13:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373151",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_373152.json:
```json
{
    "body": "<a id='comment:9'></a>LGTM",
    "created_at": "2019-01-07T13:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373152",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:9'></a>LGTM



---

archive/issue_comments_373153.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-07T17:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373153",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_373154.json:
```json
{
    "body": "<a id='comment:10'></a>This could eventually raise an error if we end up adding checks:\n\n```\n        x = self(x)\n        return all(x.avoids(p) for p in self.a)\n```\nI think you should make `x` be a generic `Permutations()(x)`.\n\nA better way `if len(a) == 0:` changed to `if not a:`.\n\n`@`dkernn `super` is not (more) pythonic than directly calling the base class. You lose explicitness but gain by taking the direct superclass (so it reflects changes in the MRO if you insert a new class between itself and the base). I would avoid changing explicit base class calls to `super` unless there is a good reason to do so as it is a needless change.\n\nAlso `self.element_class(self, x)` is usually what `self(x)` eventually calls for combinatorial objects because coercion/conversion does not play any role. In this case, it is guaranteed to work by how the code is currently implemented (and the check above). Yet, in this case it is not necessarily so future-proof.",
    "created_at": "2019-01-07T17:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373154",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>This could eventually raise an error if we end up adding checks:

```
        x = self(x)
        return all(x.avoids(p) for p in self.a)
```
I think you should make `x` be a generic `Permutations()(x)`.

A better way `if len(a) == 0:` changed to `if not a:`.

`@`dkernn `super` is not (more) pythonic than directly calling the base class. You lose explicitness but gain by taking the direct superclass (so it reflects changes in the MRO if you insert a new class between itself and the base). I would avoid changing explicit base class calls to `super` unless there is a good reason to do so as it is a needless change.

Also `self.element_class(self, x)` is usually what `self(x)` eventually calls for combinatorial objects because coercion/conversion does not play any role. In this case, it is guaranteed to work by how the code is currently implemented (and the check above). Yet, in this case it is not necessarily so future-proof.



---

archive/issue_comments_373155.json:
```json
{
    "body": "<a id='comment:11'></a>I am confused.  Could you please be a bit more explict?  In particular, should I revert the super modifications?  Should I write `x = Permutations()(x)` instead of `x = self(x)`?",
    "created_at": "2019-01-07T18:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373155",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:11'></a>I am confused.  Could you please be a bit more explict?  In particular, should I revert the super modifications?  Should I write `x = Permutations()(x)` instead of `x = self(x)`?



---

archive/issue_comments_373156.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 mantepse]:\n> I am confused.  Could you please be a bit more explict?\n\n\nSuppose you have `A < B`, i.e., class `A` inherits from `B`. Then you change the MRO to be `A < C < B`, then the `super` would try to call the corresponding method in `C` instead of `B`.\n\n>  In particular, should I revert the super modifications?\n\n\nYou have already done them, then it is fine. However, I am pointing out that it is not a good change to enforce.\n\n>  Should I write `x = Permutations()(x)` instead of `x = self(x)`?\n\n\nYes.",
    "created_at": "2019-01-07T18:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373156",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>Replying to [comment:11 mantepse]:
> I am confused.  Could you please be a bit more explict?


Suppose you have `A < B`, i.e., class `A` inherits from `B`. Then you change the MRO to be `A < C < B`, then the `super` would try to call the corresponding method in `C` instead of `B`.

>  In particular, should I revert the super modifications?


You have already done them, then it is fine. However, I am pointing out that it is not a good change to enforce.

>  Should I write `x = Permutations()(x)` instead of `x = self(x)`?


Yes.



---

archive/issue_comments_373157.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-07T18:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373157",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_373158.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-07T18:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373158",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_373159.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-07T18:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373159",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_066351.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-07T18:53:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26809#event-66351"
}
```



---

archive/issue_comments_373160.json:
```json
{
    "body": "<a id='comment:15'></a>Thank you.",
    "created_at": "2019-01-07T18:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373160",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>Thank you.



---

archive/issue_comments_373161.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:10 tscrim]:\n> `@`dkernn `super` is not (more) pythonic than directly calling the base class. You lose explicitness but gain by taking the direct superclass (so it reflects changes in the MRO if you insert a new class between itself and the base). I would avoid changing explicit base class calls to `super` unless there is a good reason to do so as it is a needless change.\n\n\nBut now it is again quite inconsistent as there is a couple of times `super` and a couple of times not.\n\n> Also `self.element_class(self, x)` is usually what `self(x)` eventually calls for combinatorial objects because coercion/conversion does not play any role. In this case, it is guaranteed to work by how the code is currently implemented (and the check above). Yet, in this case it is not necessarily so future-proof.\n\n\nTrue, but in this case, one cannot guarantee that `x` has already the correct parent, therefore `self(x)`.",
    "created_at": "2019-01-08T09:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373161",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:16'></a>Replying to [comment:10 tscrim]:
> `@`dkernn `super` is not (more) pythonic than directly calling the base class. You lose explicitness but gain by taking the direct superclass (so it reflects changes in the MRO if you insert a new class between itself and the base). I would avoid changing explicit base class calls to `super` unless there is a good reason to do so as it is a needless change.


But now it is again quite inconsistent as there is a couple of times `super` and a couple of times not.

> Also `self.element_class(self, x)` is usually what `self(x)` eventually calls for combinatorial objects because coercion/conversion does not play any role. In this case, it is guaranteed to work by how the code is currently implemented (and the check above). Yet, in this case it is not necessarily so future-proof.


True, but in this case, one cannot guarantee that `x` has already the correct parent, therefore `self(x)`.



---

archive/issue_comments_373162.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 dkrenn]:\n> Replying to [comment:10 tscrim]:\n> > `@`dkernn `super` is not (more) pythonic than directly calling the base class. You lose explicitness but gain by taking the direct superclass (so it reflects changes in the MRO if you insert a new class between itself and the base). I would avoid changing explicit base class calls to `super` unless there is a good reason to do so as it is a needless change.\n\n> \n> But now it is again quite inconsistent as there is a couple of times `super` and a couple of times not.\n\n\nYou missed the point, the inconsistency does not matter. There are reasons to do have both. 99% of the time, the difference is irrelevant. Yet, you can use both in a file and it doesn't matter.\n\n> > Also `self.element_class(self, x)` is usually what `self(x)` eventually calls for combinatorial objects because coercion/conversion does not play any role. In this case, it is guaranteed to work by how the code is currently implemented (and the check above). Yet, in this case it is not necessarily so future-proof.\n\n> \n> True, but in this case, one cannot guarantee that `x` has already the correct parent, therefore `self(x)`.\n\n\nThe parent and type of `x` is irrelevant. The fact that it is valid input is what is important.",
    "created_at": "2019-01-08T17:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373162",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>Replying to [comment:16 dkrenn]:
> Replying to [comment:10 tscrim]:
> > `@`dkernn `super` is not (more) pythonic than directly calling the base class. You lose explicitness but gain by taking the direct superclass (so it reflects changes in the MRO if you insert a new class between itself and the base). I would avoid changing explicit base class calls to `super` unless there is a good reason to do so as it is a needless change.

> 
> But now it is again quite inconsistent as there is a couple of times `super` and a couple of times not.


You missed the point, the inconsistency does not matter. There are reasons to do have both. 99% of the time, the difference is irrelevant. Yet, you can use both in a file and it doesn't matter.

> > Also `self.element_class(self, x)` is usually what `self(x)` eventually calls for combinatorial objects because coercion/conversion does not play any role. In this case, it is guaranteed to work by how the code is currently implemented (and the check above). Yet, in this case it is not necessarily so future-proof.

> 
> True, but in this case, one cannot guarantee that `x` has already the correct parent, therefore `self(x)`.


The parent and type of `x` is irrelevant. The fact that it is valid input is what is important.



---

archive/issue_comments_373163.json:
```json
{
    "body": "<a id='comment:18'></a>Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373163",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_events_066352.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26809#event-66352"
}
```



---

archive/issue_events_066353.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26809#event-66353"
}
```



---

archive/issue_events_066354.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T14:17:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26809#event-66354"
}
```



---

archive/issue_comments_373164.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-23T14:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26809#issuecomment-373164",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
