# Issue 26433: Slowness in generic quo_rem

archive/issues_026196.json:
```json
{
    "body": "While working on #26405, I noticed that the generic implementation of `quo_rem` is very slow. Indeed, compare:\n\n```\nsage: R.<a> = Zq(2^3)\nsage: S.<x> = R[]\nsage: P = S.random_element(degree=100)\nsage: t = R.random_element()\n\nsage: %timeit _ = P(t)\n10000 loops, best of 3: 145 \u00b5s per loop\n\nsage: Q = x - t\nsage: %timeit _ = P % Q\n1000 loops, best of 3: 1.06 ms per loop\n```\n\nReviewer: Travis Scrimshaw\n\nAuthor: Xavier Caruso, Travis Scrimshaw\n\nBranch: 7047040f0fb3294c955241d3751f6b168ea020ef\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26433\n\n",
    "closed_at": "2018-10-20T11:58:12Z",
    "created_at": "2018-10-08T22:19:29Z",
    "labels": [
        "component: commutative algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Slowness in generic quo_rem",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26433",
    "user": "https://github.com/xcaruso"
}
```
While working on #26405, I noticed that the generic implementation of `quo_rem` is very slow. Indeed, compare:

```
sage: R.<a> = Zq(2^3)
sage: S.<x> = R[]
sage: P = S.random_element(degree=100)
sage: t = R.random_element()

sage: %timeit _ = P(t)
10000 loops, best of 3: 145 µs per loop

sage: Q = x - t
sage: %timeit _ = P % Q
1000 loops, best of 3: 1.06 ms per loop
```

Reviewer: Travis Scrimshaw

Author: Xavier Caruso, Travis Scrimshaw

Branch: 7047040f0fb3294c955241d3751f6b168ea020ef

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26433





---

archive/issue_comments_393090.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,14 +1,17 @@\n While working on #26405, I noticed that the generic implementation of \\`quo_rem\\` is very slow. Indeed, compare:\n \n \\`\\`\\`\n-sage: R = Zp(2)\n+sage: R.<a> = Zq(2^3)\n sage: S.<x> = R[]\n sage: P = S.random_element(degree=100)\n-sage: a = R.random_element()\n-sage: %timeit _ = P % (x-a)\n-1000 loops, best of 3: 1.64 ms per loop\n-sage: %timeit _ = P(a)\n-10000 loops, best of 3: 81.9 \u00b5s per loop\n+sage: t = R.random_element()\n+\n+sage: %timeit _ = P(t)\n+10000 loops, best of 3: 145 \u00b5s per loop\n+\n+sage: Q = X - t\n+sage: %timeit _ = P % Q\n+1000 loops, best of 3: 1.06 ms per loop\n \\`\\`\\`\n \n Comment: 1\n```\n",
    "created_at": "2018-10-08T22:32:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393090",
    "user": "https://github.com/xcaruso"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,14 +1,17 @@
 While working on #26405, I noticed that the generic implementation of \`quo_rem\` is very slow. Indeed, compare:
 
 \`\`\`
-sage: R = Zp(2)
+sage: R.<a> = Zq(2^3)
 sage: S.<x> = R[]
 sage: P = S.random_element(degree=100)
-sage: a = R.random_element()
-sage: %timeit _ = P % (x-a)
-1000 loops, best of 3: 1.64 ms per loop
-sage: %timeit _ = P(a)
-10000 loops, best of 3: 81.9 µs per loop
+sage: t = R.random_element()
+
+sage: %timeit _ = P(t)
+10000 loops, best of 3: 145 µs per loop
+
+sage: Q = X - t
+sage: %timeit _ = P % Q
+1000 loops, best of 3: 1.06 ms per loop
 \`\`\`
 
 Comment: 1
```




---

archive/issue_comments_393091.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T23:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393091",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393092.json:
```json
{
    "body": "<a id='comment:4'></a>Timings are now:\n\n```\nsage: %timeit _ = P % Q\n1000 loops, best of 3: 210 \u00b5s per loop\n```",
    "created_at": "2018-10-08T23:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393092",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:4'></a>Timings are now:

```
sage: %timeit _ = P % Q
1000 loops, best of 3: 210 µs per loop
```



---

archive/issue_comments_393093.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-08T23:16:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393093",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_393094.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-08T23:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393094",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_393095.json:
```json
{
    "body": "<a id='comment:7'></a>I made a few Cython improvements. I also pulled out the `if` statement because I felt the code duplication was minimal and it would be better to avoid doing the if check every time in the loop.\n\nIf my changes are good, then positive review (with the author name is filled in).",
    "created_at": "2018-10-10T00:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393095",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>I made a few Cython improvements. I also pulled out the `if` statement because I felt the code duplication was minimal and it would be better to avoid doing the if check every time in the loop.

If my changes are good, then positive review (with the author name is filled in).



---

archive/issue_comments_393096.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,18 @@\n+While working on #26405, I noticed that the generic implementation of \\`quo_rem\\` is very slow. Indeed, compare:\n \n+\\`\\`\\`\n+sage: R.<a> = Zq(2^3)\n+sage: S.<x> = R[]\n+sage: P = S.random_element(degree=100)\n+sage: t = R.random_element()\n+\n+sage: %timeit _ = P(t)\n+10000 loops, best of 3: 145 \u00b5s per loop\n+\n+sage: Q = x - t\n+sage: %timeit _ = P % Q\n+1000 loops, best of 3: 1.06 ms per loop\n+\\`\\`\\`\n \n Comment: 1\n \n```\n",
    "created_at": "2018-10-10T00:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393096",
    "user": "https://github.com/tscrim"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,18 @@
+While working on #26405, I noticed that the generic implementation of \`quo_rem\` is very slow. Indeed, compare:
 
+\`\`\`
+sage: R.<a> = Zq(2^3)
+sage: S.<x> = R[]
+sage: P = S.random_element(degree=100)
+sage: t = R.random_element()
+
+sage: %timeit _ = P(t)
+10000 loops, best of 3: 145 µs per loop
+
+sage: Q = x - t
+sage: %timeit _ = P % Q
+1000 loops, best of 3: 1.06 ms per loop
+\`\`\`
 
 Comment: 1
 
```




---

archive/issue_comments_393097.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-10T00:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393097",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_393098.json:
```json
{
    "body": "<a id='comment:9'></a>LGTM.",
    "created_at": "2018-10-10T14:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393098",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:9'></a>LGTM.



---

archive/issue_comments_393099.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-10T14:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393099",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_393100.json:
```json
{
    "body": "<a id='comment:10'></a>The patchbot reports one failing doctest in `src/sage/geometry/polyhedron/library.py` but I guess it is not related to this ticket (and the test passes on my computer).",
    "created_at": "2018-10-11T01:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393100",
    "user": "https://github.com/xcaruso"
}
```

<a id='comment:10'></a>The patchbot reports one failing doctest in `src/sage/geometry/polyhedron/library.py` but I guess it is not related to this ticket (and the test passes on my computer).



---

archive/issue_events_065710.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-20T11:58:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26433#event-65710"
}
```



---

archive/issue_comments_393101.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-20T11:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393101",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_393102.json:
```json
{
    "body": "<a id='comment:12'></a>This should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393102",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>This should be re-targeted for 8.5.



---

archive/issue_events_065711.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T14:52:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26433#event-65711"
}
```



---

archive/issue_comments_393103.json:
```json
{
    "body": "<a id='comment:13'></a>A regression that may be due to this change: #26433.",
    "created_at": "2018-12-17T11:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393103",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:13'></a>A regression that may be due to this change: #26433.



---

archive/issue_comments_393104.json:
```json
{
    "body": "<a id='comment:14'></a>See #26907.",
    "created_at": "2018-12-17T11:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26433",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26433#issuecomment-393104",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>See #26907.
