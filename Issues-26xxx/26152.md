# Issue 26152: Remove symlink local/share/mathjax/mathjax

archive/issues_025915.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThere is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.\n\nThis is creating trouble for the Sage documentation (see also #25111).\n\nThe bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.\n\nCC:  @jhpalmieri @embray\n\nComponent: **build**\n\nAuthor: **Jeroen Demeyer**\n\nBranch: **[`b9eb92c`](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**\n\nReviewer: **John Palmieri**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26152_\n\n",
    "closed_at": "2018-08-30T22:25:04Z",
    "created_at": "2018-08-28T14:47:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove symlink local/share/mathjax/mathjax",
    "type": "issue",
    "updated_at": "2018-10-31T19:00:54Z",
    "url": "https://github.com/sagemath/sage/issues/26152",
    "user": "https://github.com/jdemeyer"
}
```
<div id="comment:0"></div>

There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.

This is creating trouble for the Sage documentation (see also #25111).

The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.

CC:  @jhpalmieri @embray

Component: **build**

Author: **Jeroen Demeyer**

Branch: **[`b9eb92c`](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**

Reviewer: **John Palmieri**

_Issue created by migration from https://trac.sagemath.org/ticket/26152_





---

archive/issue_events_357856.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:47:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357856"
}
```



---

archive/issue_events_357857.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:47:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357857"
}
```



---

archive/issue_events_357858.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:47:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357858"
}
```



---

archive/issue_events_357859.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:47:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357859"
}
```



---

archive/issue_comments_402777.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThis is already fixed--it does not get created anymore.  The question is whether or not to bother putting in something to remove it if it exists.  Personally I don't think it's a blocker because it can easily just be removed, and would only be a problem in the case of some incremental builds that wound up with it at some point.",
    "created_at": "2018-08-28T14:51:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402777",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

This is already fixed--it does not get created anymore.  The question is whether or not to bother putting in something to remove it if it exists.  Personally I don't think it's a blocker because it can easily just be removed, and would only be a problem in the case of some incremental builds that wound up with it at some point.



---

archive/issue_comments_402778.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.\n \n-This is creating trouble for the Sage documentation (see also #25111). We should ensure that this symlink is not created in the first place and removed if it already exists.\n+This is creating trouble for the Sage documentation (see also #25111).\n+\n+The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T14:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402778",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.
 
-This is creating trouble for the Sage documentation (see also #25111). We should ensure that this symlink is not created in the first place and removed if it already exists.
+This is creating trouble for the Sage documentation (see also #25111).
+
+The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.
``````




---

archive/issue_comments_402779.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2018-08-28T14:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402779",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_402780.json:
```json
{
    "body": "Branch: **[u/jdemeyer/remove_symlink_local_share_mathjax_mathjax](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/remove_symlink_local_share_mathjax_mathjax)**",
    "created_at": "2018-08-28T15:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402780",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/remove_symlink_local_share_mathjax_mathjax](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/remove_symlink_local_share_mathjax_mathjax)**



---

archive/issue_comments_402781.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.\n+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402781",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.
+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.
``````




---

archive/issue_comments_402782.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@embray](#comment%3A1):\n> This is already fixed--it does not get created anymore.\n\nI also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d\"><code>b9eb92c</code></a></td><td><code>Rebuild mathjax to remove mathjax/mathjax symlink</code></td></tr></table>\n",
    "created_at": "2018-08-28T15:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402782",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@embray](#comment%3A1):
> This is already fixed--it does not get created anymore.

I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d"><code>b9eb92c</code></a></td><td><code>Rebuild mathjax to remove mathjax/mathjax symlink</code></td></tr></table>




---

archive/issue_comments_402783.json:
```json
{
    "body": "Commit: **[`b9eb92c`](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**",
    "created_at": "2018-08-28T15:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402783",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[`b9eb92c`](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**



---

archive/issue_comments_402784.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,9 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.\n+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running\n+\n+```\n+(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n+```\n+Also, the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402784",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,9 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.
+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running
+
+```
+(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
+```
+Also, the symlink should be removed if it already exists.
``````




---

archive/issue_comments_402785.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI created #26153 for the `sage-spkg` problem.",
    "created_at": "2018-08-28T15:16:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402785",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:6" align="right">comment:6</div>

I created #26153 for the `sage-spkg` problem.



---

archive/issue_events_357860.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T15:16:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357860"
}
```



---

archive/issue_comments_402786.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,4 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running\n-\n-```\n-(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n-```\n-Also, the symlink should be removed if it already exists.\n+The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402786",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,4 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running
-
-```
-(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
-```
-Also, the symlink should be removed if it already exists.
+The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.
``````




---

archive/issue_comments_402787.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jdemeyer](#comment%3A4):\n> Replying to [@embray](#comment%3A1):\n> > This is already fixed--it does not get created anymore.\n> \n> \n> I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.\n\nI am unable to recreate the symlink. Can you do this reliably?\n\nTo test so far, I have created the symlink by hand, and then when I ran `make` with this branch, it got deleted. So that's good.",
    "created_at": "2018-08-28T20:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402787",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jdemeyer](#comment%3A4):
> Replying to [@embray](#comment%3A1):
> > This is already fixed--it does not get created anymore.
> 
> 
> I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.

I am unable to recreate the symlink. Can you do this reliably?

To test so far, I have created the symlink by hand, and then when I ran `make` with this branch, it got deleted. So that's good.



---

archive/issue_comments_402788.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@jhpalmieri](#comment%3A9):\n> I am unable to recreate the symlink. Can you do this reliably?\n\n```\n(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n```",
    "created_at": "2018-08-28T21:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402788",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@jhpalmieri](#comment%3A9):
> I am unable to recreate the symlink. Can you do this reliably?

```
(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
```



---

archive/issue_comments_402789.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nOkay, that does it. I don't know why the various combinations of `./sage -f mathjax` and `./sage -f sagenb` don't also do it. And in fact, you don't need to delete the whole `sagenb` file in `installed`: for me, just deleting the line\n\n```\n        \"lib/python2.7/site-packages/sagenb/data/mathjax\",\n```\nis enough for `./sage -f sagenb` to recreate the link. I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says\n\n```\nNo record that 'sagenb' was ever installed; skipping uninstall\n```\nThat implied to me that the manifest was being ignored, but I guess that's not the case. Are these manifest files and their roles documented anywhere?",
    "created_at": "2018-08-28T21:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402789",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

Okay, that does it. I don't know why the various combinations of `./sage -f mathjax` and `./sage -f sagenb` don't also do it. And in fact, you don't need to delete the whole `sagenb` file in `installed`: for me, just deleting the line

```
        "lib/python2.7/site-packages/sagenb/data/mathjax",
```
is enough for `./sage -f sagenb` to recreate the link. I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says

```
No record that 'sagenb' was ever installed; skipping uninstall
```
That implied to me that the manifest was being ignored, but I guess that's not the case. Are these manifest files and their roles documented anywhere?



---

archive/issue_comments_402790.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIt seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?",
    "created_at": "2018-08-28T21:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402790",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?



---

archive/issue_comments_402791.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jhpalmieri](#comment%3A11):\n> I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says\n> \n> ```\n> No record that 'sagenb' was ever installed; skipping uninstall\n> ```\n> That implied to me that the manifest was being ignored, but I guess that's not the case.\n\nI agree that this may be confusing. The answer is that `./sage -f` is really an uninstall followed by an install, not a reinstall. The message that you quoted refers to uninstallation done as part of the installation. But by the time, `sagenb` is already uninstalled. This would be different if the uninstall would be part of a reinstall (for a version upgrade for example).",
    "created_at": "2018-08-28T21:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402791",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jhpalmieri](#comment%3A11):
> I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says
> 
> ```
> No record that 'sagenb' was ever installed; skipping uninstall
> ```
> That implied to me that the manifest was being ignored, but I guess that's not the case.

I agree that this may be confusing. The answer is that `./sage -f` is really an uninstall followed by an install, not a reinstall. The message that you quoted refers to uninstallation done as part of the installation. But by the time, `sagenb` is already uninstalled. This would be different if the uninstall would be part of a reinstall (for a version upgrade for example).



---

archive/issue_comments_402792.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nNow that running `sage-spkg-uninstall` is part of the normal package installation/upgrade process anyways it would be less confusing to change `./sage -f` to somehow force calling `sage-spkg <package>` without checking (via `make`) whether it is already up-to-date.",
    "created_at": "2018-08-29T10:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402792",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Now that running `sage-spkg-uninstall` is part of the normal package installation/upgrade process anyways it would be less confusing to change `./sage -f` to somehow force calling `sage-spkg <package>` without checking (via `make`) whether it is already up-to-date.



---

archive/issue_comments_402793.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jhpalmieri](#comment%3A12):\n> It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?\n\nThis is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.\n\nThe issue caused by symlinks in this case is somewhat unique to symlinks, and the existing package installation code not handling existing symlinks properly; that's what #26153 is addressing.",
    "created_at": "2018-08-29T10:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402793",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jhpalmieri](#comment%3A12):
> It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?

This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.

The issue caused by symlinks in this case is somewhat unique to symlinks, and the existing package installation code not handling existing symlinks properly; that's what #26153 is addressing.



---

archive/issue_comments_402794.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@embray](#comment%3A15):\n> This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.\n\nI agree partially. We should be mostly assuming a consistent state, but I can imagine some realistic scenarios where the information in `local/var/lib/sage/installed` is not consistent with the actual filesystem. For example, pressing CTRL-C while the files are being installed.\n\nWe shouldn't worry about it too much but we also shouldn't ignore it either.",
    "created_at": "2018-08-29T11:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402794",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@embray](#comment%3A15):
> This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.

I agree partially. We should be mostly assuming a consistent state, but I can imagine some realistic scenarios where the information in `local/var/lib/sage/installed` is not consistent with the actual filesystem. For example, pressing CTRL-C while the files are being installed.

We shouldn't worry about it too much but we also shouldn't ignore it either.



---

archive/issue_comments_402795.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nMaybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n\nThe only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.",
    "created_at": "2018-08-29T11:06:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402795",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.

The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.



---

archive/issue_comments_402796.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@embray](#comment%3A17):\n> Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n> \n> The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.\n\nMaybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.",
    "created_at": "2018-08-29T17:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402796",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@embray](#comment%3A17):
> Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.
> 
> The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.

Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.



---

archive/issue_comments_402797.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2018-08-29T17:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402797",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_357861.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-29T17:21:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357861"
}
```



---

archive/issue_events_357862.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-29T17:21:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357862"
}
```



---

archive/issue_comments_402798.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI'm willing to give this a positive review as a stopgap measure. I hope the real issue with symlinks can be addressed at #26153.",
    "created_at": "2018-08-29T17:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402798",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

I'm willing to give this a positive review as a stopgap measure. I hope the real issue with symlinks can be addressed at #26153.



---

archive/issue_events_357863.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:25:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357863"
}
```



---

archive/issue_events_357864.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "9911efbce3391fc6e1c4925aeea033d6127ce1c1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-08-30T22:25:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-357864"
}
```



---

archive/issue_comments_402799.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/remove_symlink_local_share_mathjax_mathjax](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/remove_symlink_local_share_mathjax_mathjax)** to **[`b9eb92c`](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**",
    "created_at": "2018-08-30T22:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402799",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/remove_symlink_local_share_mathjax_mathjax](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/remove_symlink_local_share_mathjax_mathjax)** to **[`b9eb92c`](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**



---

archive/issue_comments_402800.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jhpalmieri](#comment%3A18):\n> Replying to [@embray](#comment%3A17):\n> > Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n> > \n> > The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.\n> \n> \n> Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.\n\nI thought I posted it here but maybe forgot. But yes, I arrived at the same conclusion independently, so that's probably the obvious thing to do.  Write it first to a temp file, then move it to its proper location once installation completes successfully.\n\nThe only trick is that those \"temp\" files still need to be written some place that the uninstaller can find it.  Maybe it would be the same file by with a `.tmp` extension added, with the uninstaller updated to also find those `.tmp` files.",
    "created_at": "2018-09-03T09:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402800",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jhpalmieri](#comment%3A18):
> Replying to [@embray](#comment%3A17):
> > Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.
> > 
> > The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.
> 
> 
> Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.

I thought I posted it here but maybe forgot. But yes, I arrived at the same conclusion independently, so that's probably the obvious thing to do.  Write it first to a temp file, then move it to its proper location once installation completes successfully.

The only trick is that those "temp" files still need to be written some place that the uninstaller can find it.  Maybe it would be the same file by with a `.tmp` extension added, with the uninstaller updated to also find those `.tmp` files.



---

archive/issue_comments_402801.json:
```json
{
    "body": "Changed commit from **[`b9eb92c`](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)** to none",
    "created_at": "2018-09-03T09:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402801",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`b9eb92c`](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)** to none



---

archive/issue_comments_402802.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nCould anyone with working MathJax in Jupyter Sage notebooks post their setup?\n\nAfter this was fixed, I can't get it to work any more...",
    "created_at": "2018-09-25T11:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402802",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

Could anyone with working MathJax in Jupyter Sage notebooks post their setup?

After this was fixed, I can't get it to work any more...



---

archive/issue_comments_402803.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWhat do you mean by \"setup\"? I don't think I've done anything special, and math displays fine for me in Sage's Jupyter notebook. So I'm happy to provide information, but what are you looking for?",
    "created_at": "2018-09-25T14:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402803",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

What do you mean by "setup"? I don't think I've done anything special, and math displays fine for me in Sage's Jupyter notebook. So I'm happy to provide information, but what are you looking for?



---

archive/issue_comments_402804.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nIt was possible to set all the display to MathJax, no?\nWhat works for me is putting \n\n```\n%display latex\n...\n```\nin a cell, and then it seems to use MathJax to show stuff in it.\nSo it might be that my memory is fuzzy at this point, and I'm confusing this with some\nother notebook...",
    "created_at": "2018-09-25T18:38:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402804",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

It was possible to set all the display to MathJax, no?
What works for me is putting 

```
%display latex
...
```
in a cell, and then it seems to use MathJax to show stuff in it.
So it might be that my memory is fuzzy at this point, and I'm confusing this with some
other notebook...



---

archive/issue_comments_402805.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n(a) The legacy Sage notebook had an option to typeset all output, in which case it would use MathJax by default. Could that be what you're thinking of? I don't know of such an option for the Jupyter notebook, so I can't answer that part of your question. \n\n(b) If you're actually missing a feature, I don't think it would be due to this ticket. (Or if it was, then the feature was relying on seriously buggy behavior, and I think that is unlikely.) In particular, MathJax does work with the Jupyter notebook, for instance if I do `show(matrix(10, 10, lambda i, j: i+j))` or I put `$x=y$` in a markdown cell. It sounds like you also see MathJax in action.",
    "created_at": "2018-09-25T18:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402805",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

(a) The legacy Sage notebook had an option to typeset all output, in which case it would use MathJax by default. Could that be what you're thinking of? I don't know of such an option for the Jupyter notebook, so I can't answer that part of your question. 

(b) If you're actually missing a feature, I don't think it would be due to this ticket. (Or if it was, then the feature was relying on seriously buggy behavior, and I think that is unlikely.) In particular, MathJax does work with the Jupyter notebook, for instance if I do `show(matrix(10, 10, lambda i, j: i+j))` or I put `$x=y$` in a markdown cell. It sounds like you also see MathJax in action.



---

archive/issue_comments_402806.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nYeah all this ticket did was force reinstallation of the mathjax spkg for some people.",
    "created_at": "2018-09-26T09:15:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402806",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

Yeah all this ticket did was force reinstallation of the mathjax spkg for some people.



---

archive/issue_comments_402807.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nThis problem has returned for me. As part of Sage's installation (part of some package, I'm not sure which one, or maybe a level up from that), should we check whether this link exists, and if so, delete it?",
    "created_at": "2018-10-31T15:00:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402807",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

This problem has returned for me. As part of Sage's installation (part of some package, I'm not sure which one, or maybe a level up from that), should we check whether this link exists, and if so, delete it?



---

archive/issue_comments_402808.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nSee #26612 for a proposed solution (although I still don't know what is causing the problem).",
    "created_at": "2018-10-31T19:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-402808",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

See #26612 for a proposed solution (although I still don't know what is causing the problem).
