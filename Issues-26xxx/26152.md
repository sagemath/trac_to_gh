# Issue 26152: Remove symlink local/share/mathjax/mathjax

archive/issues_025915.json:
```json
{
    "body": "There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.\n\nThis is creating trouble for the Sage documentation (see also #25111).\n\nThe bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.\n\nCC:  @jhpalmieri @embray\n\nBranch: [b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)\n\nReviewer: John Palmieri\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26152\n\n",
    "closed_at": "2018-08-30T22:25:04Z",
    "created_at": "2018-08-28T14:47:43Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Remove symlink local/share/mathjax/mathjax",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26152",
    "user": "https://github.com/jdemeyer"
}
```
There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.

This is creating trouble for the Sage documentation (see also #25111).

The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.

CC:  @jhpalmieri @embray

Branch: [b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)

Reviewer: John Palmieri

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26152





---

archive/issue_comments_504335.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis is already fixed--it does not get created anymore.  The question is whether or not to bother putting in something to remove it if it exists.  Personally I don't think it's a blocker because it can easily just be removed, and would only be a problem in the case of some incremental builds that wound up with it at some point.",
    "created_at": "2018-08-28T14:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504335",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
This is already fixed--it does not get created anymore.  The question is whether or not to bother putting in something to remove it if it exists.  Personally I don't think it's a blocker because it can easily just be removed, and would only be a problem in the case of some incremental builds that wound up with it at some point.



---

archive/issue_comments_504336.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.\n \n-This is creating trouble for the Sage documentation (see also #25111). We should ensure that this symlink is not created in the first place and removed if it already exists.\n+This is creating trouble for the Sage documentation (see also #25111).\n+\n+The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T14:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504336",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.
 
-This is creating trouble for the Sage documentation (see also #25111). We should ensure that this symlink is not created in the first place and removed if it already exists.
+This is creating trouble for the Sage documentation (see also #25111).
+
+The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.
``````




---

archive/issue_comments_504337.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2018-08-28T14:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504337",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_504338.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/remove_symlink_local_share_mathjax_mathjax\"",
    "created_at": "2018-08-28T15:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504338",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/remove_symlink_local_share_mathjax_mathjax"



---

archive/issue_comments_504339.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.\n+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504339",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.
+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.
``````




---

archive/issue_comments_504340.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [embray](#comment%3A1):\n> This is already fixed--it does not get created anymore.\n\n\nI also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.\n\n---\nNew commits:\n|                                                                                                                                          |                                                   |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)|`Rebuild mathjax to remove mathjax/mathjax symlink`|",
    "created_at": "2018-08-28T15:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504340",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
Replying to [embray](#comment%3A1):
> This is already fixed--it does not get created anymore.


I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.

---
New commits:
|                                                                                                                                          |                                                   |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)|`Rebuild mathjax to remove mathjax/mathjax symlink`|



---

archive/issue_comments_504341.json:
```json
{
    "body": "Changing commit from \"\" to \"b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d\"",
    "created_at": "2018-08-28T15:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504341",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d"



---

archive/issue_comments_504342.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,9 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.\n+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running\n+\n+```\n+(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n+```\n+Also, the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504342",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,9 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.
+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running
+
+```
+(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
+```
+Also, the symlink should be removed if it already exists.
``````




---

archive/issue_comments_504343.json:
```json
{
    "body": "<a id='comment:6'></a>\nI created #26153 for the `sage-spkg` problem.",
    "created_at": "2018-08-28T15:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504343",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
I created #26153 for the `sage-spkg` problem.



---

archive/issue_comments_504344.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-28T15:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504344",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_504345.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,4 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running\n-\n-```\n-(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n-```\n-Also, the symlink should be removed if it already exists.\n+The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504345",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,4 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running
-
-```
-(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
-```
-Also, the symlink should be removed if it already exists.
+The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.
``````




---

archive/issue_comments_504346.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jdemeyer](#comment%3A4):\n> Replying to [embray](#comment%3A1):\n> > This is already fixed--it does not get created anymore.\n\n> \n> I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.\n\n\nI am unable to recreate the symlink. Can you do this reliably?\n\nTo test so far, I have created the symlink by hand, and then when I ran `make` with this branch, it got deleted. So that's good.",
    "created_at": "2018-08-28T20:52:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504346",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
Replying to [jdemeyer](#comment%3A4):
> Replying to [embray](#comment%3A1):
> > This is already fixed--it does not get created anymore.

> 
> I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.


I am unable to recreate the symlink. Can you do this reliably?

To test so far, I have created the symlink by hand, and then when I ran `make` with this branch, it got deleted. So that's good.



---

archive/issue_comments_504347.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jhpalmieri](#comment%3A9):\n> I am unable to recreate the symlink. Can you do this reliably?\n\n\n```\n(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n```",
    "created_at": "2018-08-28T21:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504347",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
Replying to [jhpalmieri](#comment%3A9):
> I am unable to recreate the symlink. Can you do this reliably?


```
(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
```



---

archive/issue_comments_504348.json:
```json
{
    "body": "<a id='comment:11'></a>\nOkay, that does it. I don't know why the various combinations of `./sage -f mathjax` and `./sage -f sagenb` don't also do it. And in fact, you don't need to delete the whole `sagenb` file in `installed`: for me, just deleting the line\n\n```\n        \"lib/python2.7/site-packages/sagenb/data/mathjax\",\n```\nis enough for `./sage -f sagenb` to recreate the link. I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says\n\n```\nNo record that 'sagenb' was ever installed; skipping uninstall\n```\nThat implied to me that the manifest was being ignored, but I guess that's not the case. Are these manifest files and their roles documented anywhere?",
    "created_at": "2018-08-28T21:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504348",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Okay, that does it. I don't know why the various combinations of `./sage -f mathjax` and `./sage -f sagenb` don't also do it. And in fact, you don't need to delete the whole `sagenb` file in `installed`: for me, just deleting the line

```
        "lib/python2.7/site-packages/sagenb/data/mathjax",
```
is enough for `./sage -f sagenb` to recreate the link. I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says

```
No record that 'sagenb' was ever installed; skipping uninstall
```
That implied to me that the manifest was being ignored, but I guess that's not the case. Are these manifest files and their roles documented anywhere?



---

archive/issue_comments_504349.json:
```json
{
    "body": "<a id='comment:12'></a>\nIt seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?",
    "created_at": "2018-08-28T21:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504349",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?



---

archive/issue_comments_504350.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [jhpalmieri](#comment%3A11):\n> I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says\n> \n> ```\n> No record that 'sagenb' was ever installed; skipping uninstall\n> ```\n> That implied to me that the manifest was being ignored, but I guess that's not the case.\n\n\nI agree that this may be confusing. The answer is that `./sage -f` is really an uninstall followed by an install, not a reinstall. The message that you quoted refers to uninstallation done as part of the installation. But by the time, `sagenb` is already uninstalled. This would be different if the uninstall would be part of a reinstall (for a version upgrade for example).",
    "created_at": "2018-08-28T21:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504350",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'></a>
Replying to [jhpalmieri](#comment%3A11):
> I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says
> 
> ```
> No record that 'sagenb' was ever installed; skipping uninstall
> ```
> That implied to me that the manifest was being ignored, but I guess that's not the case.


I agree that this may be confusing. The answer is that `./sage -f` is really an uninstall followed by an install, not a reinstall. The message that you quoted refers to uninstallation done as part of the installation. But by the time, `sagenb` is already uninstalled. This would be different if the uninstall would be part of a reinstall (for a version upgrade for example).



---

archive/issue_comments_504351.json:
```json
{
    "body": "<a id='comment:14'></a>\nNow that running `sage-spkg-uninstall` is part of the normal package installation/upgrade process anyways it would be less confusing to change `./sage -f` to somehow force calling `sage-spkg <package>` without checking (via `make`) whether it is already up-to-date.",
    "created_at": "2018-08-29T10:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504351",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
Now that running `sage-spkg-uninstall` is part of the normal package installation/upgrade process anyways it would be less confusing to change `./sage -f` to somehow force calling `sage-spkg <package>` without checking (via `make`) whether it is already up-to-date.



---

archive/issue_comments_504352.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jhpalmieri](#comment%3A12):\n> It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?\n\n\nThis is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.\n\nThe issue caused by symlinks in this case is somewhat unique to symlinks, and the existing package installation code not handling existing symlinks properly; that's what #26153 is addressing.",
    "created_at": "2018-08-29T10:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504352",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Replying to [jhpalmieri](#comment%3A12):
> It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?


This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.

The issue caused by symlinks in this case is somewhat unique to symlinks, and the existing package installation code not handling existing symlinks properly; that's what #26153 is addressing.



---

archive/issue_comments_504353.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [embray](#comment%3A15):\n> This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.\n\n\nI agree partially. We should be mostly assuming a consistent state, but I can imagine some realistic scenarios where the information in `local/var/lib/sage/installed` is not consistent with the actual filesystem. For example, pressing CTRL-C while the files are being installed.\n\nWe shouldn't worry about it too much but we also shouldn't ignore it either.",
    "created_at": "2018-08-29T11:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504353",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [embray](#comment%3A15):
> This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.


I agree partially. We should be mostly assuming a consistent state, but I can imagine some realistic scenarios where the information in `local/var/lib/sage/installed` is not consistent with the actual filesystem. For example, pressing CTRL-C while the files are being installed.

We shouldn't worry about it too much but we also shouldn't ignore it either.



---

archive/issue_comments_504354.json:
```json
{
    "body": "<a id='comment:17'></a>\nMaybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n\nThe only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.",
    "created_at": "2018-08-29T11:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504354",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>
Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.

The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.



---

archive/issue_comments_504355.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [embray](#comment%3A17):\n> Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n> \n> The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.\n\n\nMaybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.",
    "created_at": "2018-08-29T17:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504355",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
Replying to [embray](#comment%3A17):
> Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.
> 
> The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.


Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.



---

archive/issue_comments_504356.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2018-08-29T17:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504356",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_504357.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-29T17:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504357",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_504358.json:
```json
{
    "body": "<a id='comment:19'></a>\nI'm willing to give this a positive review as a stopgap measure. I hope the real issue with symlinks can be addressed at #26153.",
    "created_at": "2018-08-29T17:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504358",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>
I'm willing to give this a positive review as a stopgap measure. I hope the real issue with symlinks can be addressed at #26153.



---

archive/issue_events_074076.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:25:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26152#event-74076"
}
```



---

archive/issue_comments_504359.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/remove_symlink_local_share_mathjax_mathjax\" to \"b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d\"",
    "created_at": "2018-08-30T22:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504359",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/remove_symlink_local_share_mathjax_mathjax" to "b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d"



---

archive/issue_comments_504360.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-30T22:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504360",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_504361.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [jhpalmieri](#comment%3A18):\n> Replying to [embray](#comment%3A17):\n> > Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n> > \n> > The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.\n\n> \n> Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.\n\n\nI thought I posted it here but maybe forgot. But yes, I arrived at the same conclusion independently, so that's probably the obvious thing to do.  Write it first to a temp file, then move it to its proper location once installation completes successfully.\n\nThe only trick is that those \"temp\" files still need to be written some place that the uninstaller can find it.  Maybe it would be the same file by with a `.tmp` extension added, with the uninstaller updated to also find those `.tmp` files.",
    "created_at": "2018-09-03T09:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504361",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
Replying to [jhpalmieri](#comment%3A18):
> Replying to [embray](#comment%3A17):
> > Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.
> > 
> > The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.

> 
> Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.


I thought I posted it here but maybe forgot. But yes, I arrived at the same conclusion independently, so that's probably the obvious thing to do.  Write it first to a temp file, then move it to its proper location once installation completes successfully.

The only trick is that those "temp" files still need to be written some place that the uninstaller can find it.  Maybe it would be the same file by with a `.tmp` extension added, with the uninstaller updated to also find those `.tmp` files.



---

archive/issue_comments_504362.json:
```json
{
    "body": "Changing commit from \"b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d\" to \"\"",
    "created_at": "2018-09-03T09:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504362",
    "user": "https://github.com/embray"
}
```

Changing commit from "b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d" to ""



---

archive/issue_comments_504363.json:
```json
{
    "body": "<a id='comment:22'></a>\nCould anyone with working MathJax in Jupyter Sage notebooks post their setup?\n\nAfter this was fixed, I can't get it to work any more...",
    "created_at": "2018-09-25T11:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504363",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
Could anyone with working MathJax in Jupyter Sage notebooks post their setup?

After this was fixed, I can't get it to work any more...



---

archive/issue_comments_504364.json:
```json
{
    "body": "<a id='comment:23'></a>\nWhat do you mean by \"setup\"? I don't think I've done anything special, and math displays fine for me in Sage's Jupyter notebook. So I'm happy to provide information, but what are you looking for?",
    "created_at": "2018-09-25T14:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504364",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>
What do you mean by "setup"? I don't think I've done anything special, and math displays fine for me in Sage's Jupyter notebook. So I'm happy to provide information, but what are you looking for?



---

archive/issue_comments_504365.json:
```json
{
    "body": "<a id='comment:24'></a>\nIt was possible to set all the display to MathJax, no?\nWhat works for me is putting \n\n```\n%display latex\n...\n```\nin a cell, and then it seems to use MathJax to show stuff in it.\nSo it might be that my memory is fuzzy at this point, and I'm confusing this with some\nother notebook...",
    "created_at": "2018-09-25T18:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504365",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
It was possible to set all the display to MathJax, no?
What works for me is putting 

```
%display latex
...
```
in a cell, and then it seems to use MathJax to show stuff in it.
So it might be that my memory is fuzzy at this point, and I'm confusing this with some
other notebook...



---

archive/issue_comments_504366.json:
```json
{
    "body": "<a id='comment:25'></a>\n(a) The legacy Sage notebook had an option to typeset all output, in which case it would use MathJax by default. Could that be what you're thinking of? I don't know of such an option for the Jupyter notebook, so I can't answer that part of your question. \n\n(b) If you're actually missing a feature, I don't think it would be due to this ticket. (Or if it was, then the feature was relying on seriously buggy behavior, and I think that is unlikely.) In particular, MathJax does work with the Jupyter notebook, for instance if I do `show(matrix(10, 10, lambda i, j: i+j))` or I put `$x=y$` in a markdown cell. It sounds like you also see MathJax in action.",
    "created_at": "2018-09-25T18:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504366",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>
(a) The legacy Sage notebook had an option to typeset all output, in which case it would use MathJax by default. Could that be what you're thinking of? I don't know of such an option for the Jupyter notebook, so I can't answer that part of your question. 

(b) If you're actually missing a feature, I don't think it would be due to this ticket. (Or if it was, then the feature was relying on seriously buggy behavior, and I think that is unlikely.) In particular, MathJax does work with the Jupyter notebook, for instance if I do `show(matrix(10, 10, lambda i, j: i+j))` or I put `$x=y$` in a markdown cell. It sounds like you also see MathJax in action.



---

archive/issue_comments_504367.json:
```json
{
    "body": "<a id='comment:26'></a>\nYeah all this ticket did was force reinstallation of the mathjax spkg for some people.",
    "created_at": "2018-09-26T09:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504367",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>
Yeah all this ticket did was force reinstallation of the mathjax spkg for some people.



---

archive/issue_comments_504368.json:
```json
{
    "body": "<a id='comment:27'></a>\nThis problem has returned for me. As part of Sage's installation (part of some package, I'm not sure which one, or maybe a level up from that), should we check whether this link exists, and if so, delete it?",
    "created_at": "2018-10-31T15:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504368",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'></a>
This problem has returned for me. As part of Sage's installation (part of some package, I'm not sure which one, or maybe a level up from that), should we check whether this link exists, and if so, delete it?



---

archive/issue_comments_504369.json:
```json
{
    "body": "<a id='comment:28'></a>\nSee #26612 for a proposed solution (although I still don't know what is causing the problem).",
    "created_at": "2018-10-31T19:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26152#issuecomment-504369",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>
See #26612 for a proposed solution (although I still don't know what is causing the problem).
