# Issue 26152: Remove symlink local/share/mathjax/mathjax

archive/issues_025915.json:
```json
{
    "assignees": [],
    "body": "There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.\n\nThis is creating trouble for the Sage documentation (see also #25111).\n\nThe bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.\n\nCC:  @jhpalmieri @embray\n\nBranch: **[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**\n\nReviewer: **John Palmieri**\n\nAuthor: **Jeroen Demeyer**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26152_\n\n",
    "closed_at": "2018-08-30T22:25:04Z",
    "created_at": "2018-08-28T14:47:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove symlink local/share/mathjax/mathjax",
    "type": "issue",
    "updated_at": "2018-10-31T19:00:54Z",
    "url": "https://github.com/sagemath/sage/issues/26152",
    "user": "https://github.com/jdemeyer"
}
```
There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.

This is creating trouble for the Sage documentation (see also #25111).

The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.

CC:  @jhpalmieri @embray

Branch: **[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**

Reviewer: **John Palmieri**

Author: **Jeroen Demeyer**

_Issue created by migration from https://trac.sagemath.org/ticket/26152_





---

archive/issue_events_330555.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:47:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330555"
}
```



---

archive/issue_events_330556.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:47:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330556"
}
```



---

archive/issue_events_330557.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:47:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330557"
}
```



---

archive/issue_events_330558.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:47:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330558"
}
```



---

archive/issue_comments_405617.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nThis is already fixed--it does not get created anymore.  The question is whether or not to bother putting in something to remove it if it exists.  Personally I don't think it's a blocker because it can easily just be removed, and would only be a problem in the case of some incremental builds that wound up with it at some point.",
    "created_at": "2018-08-28T14:51:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405617",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'>Comment 1:</a>
This is already fixed--it does not get created anymore.  The question is whether or not to bother putting in something to remove it if it exists.  Personally I don't think it's a blocker because it can easily just be removed, and would only be a problem in the case of some incremental builds that wound up with it at some point.



---

archive/issue_comments_405618.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.\n \n-This is creating trouble for the Sage documentation (see also #25111). We should ensure that this symlink is not created in the first place and removed if it already exists.\n+This is creating trouble for the Sage documentation (see also #25111).\n+\n+The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T14:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405618",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 There is a symlink `local/share/mathjax/mathjax` pointing to `local/share/mathjax`. Presumably, this was created by old sagenb versions.
 
-This is creating trouble for the Sage documentation (see also #25111). We should ensure that this symlink is not created in the first place and removed if it already exists.
+This is creating trouble for the Sage documentation (see also #25111).
+
+The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.
``````




---

archive/issue_comments_405619.json:
```json
{
    "body": "Author: **Jeroen Demeyer**",
    "created_at": "2018-08-28T14:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405619",
    "user": "https://github.com/jdemeyer"
}
```

Author: **Jeroen Demeyer**



---

archive/issue_comments_405620.json:
```json
{
    "body": "Branch: **[u/jdemeyer/remove_symlink_local_share_mathjax_mathjax](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/remove_symlink_local_share_mathjax_mathjax)**",
    "created_at": "2018-08-28T15:04:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405620",
    "user": "https://github.com/jdemeyer"
}
```

Branch: **[u/jdemeyer/remove_symlink_local_share_mathjax_mathjax](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/remove_symlink_local_share_mathjax_mathjax)**



---

archive/issue_comments_405621.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.\n+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405621",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was fixed in #24646, but it should be removed if it already exists.
+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.
``````




---

archive/issue_comments_405622.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nReplying to [@embray](#comment%3A1):\n> This is already fixed--it does not get created anymore.\n\nI also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d\">b9eb92c</a></td><td><code>Rebuild mathjax to remove mathjax/mathjax symlink</code></td></tr></table>\n",
    "created_at": "2018-08-28T15:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405622",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'>Comment 4:</a>
Replying to [@embray](#comment%3A1):
> This is already fixed--it does not get created anymore.

I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d">b9eb92c</a></td><td><code>Rebuild mathjax to remove mathjax/mathjax symlink</code></td></tr></table>




---

archive/issue_comments_405623.json:
```json
{
    "body": "Commit: **[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**",
    "created_at": "2018-08-28T15:07:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405623",
    "user": "https://github.com/jdemeyer"
}
```

Commit: **[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**



---

archive/issue_comments_405624.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,9 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.\n+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running\n+\n+```\n+(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n+```\n+Also, the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405624",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,9 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. Also, the symlink should be removed if it already exists.
+The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running
+
+```
+(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
+```
+Also, the symlink should be removed if it already exists.
``````




---

archive/issue_comments_405625.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nI created #26153 for the `sage-spkg` problem.",
    "created_at": "2018-08-28T15:16:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405625",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'>Comment 6:</a>
I created #26153 for the `sage-spkg` problem.



---

archive/issue_events_330559.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T15:16:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330559"
}
```



---

archive/issue_comments_405626.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,9 +2,4 @@\n \n This is creating trouble for the Sage documentation (see also #25111).\n \n-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running\n-\n-```\n-(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n-```\n-Also, the symlink should be removed if it already exists.\n+The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.\n``````\n",
    "created_at": "2018-08-28T15:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405626",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,9 +2,4 @@
 
 This is creating trouble for the Sage documentation (see also #25111).
 
-The bug that the symlink is created was supposed to be fixed in #24646, but that fix didn't work. The problem can be reproduced by running
-
-```
-(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
-```
-Also, the symlink should be removed if it already exists.
+The bug that the symlink is created is fixed in #24646 (but not completely, see #26153). But the symlink should be removed if it already exists.
``````




---

archive/issue_comments_405627.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@jdemeyer](#comment%3A4):\n> Replying to [@embray](#comment%3A1):\n> > This is already fixed--it does not get created anymore.\n\n> \n> I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.\n\nI am unable to recreate the symlink. Can you do this reliably?\n\nTo test so far, I have created the symlink by hand, and then when I ran `make` with this branch, it got deleted. So that's good.",
    "created_at": "2018-08-28T20:52:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405627",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@jdemeyer](#comment%3A4):
> Replying to [@embray](#comment%3A1):
> > This is already fixed--it does not get created anymore.

> 
> I also assumed that also but we are wrong! The symlink does get created when sagenb is rebuilt (this may also be a bug in the `sage-spkg` script). So there is certainly something to be fixed here.

I am unable to recreate the symlink. Can you do this reliably?

To test so far, I have created the symlink by hand, and then when I ran `make` with this branch, it got deleted. So that's good.



---

archive/issue_comments_405628.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nReplying to [@jhpalmieri](#comment%3A9):\n> I am unable to recreate the symlink. Can you do this reliably?\n\n```\n(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb\n```",
    "created_at": "2018-08-28T21:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405628",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>Comment 10:</a>
Replying to [@jhpalmieri](#comment%3A9):
> I am unable to recreate the symlink. Can you do this reliably?

```
(cd local/var/lib/sage/installed; rm mathjax* sagenb*); make sagenb
```



---

archive/issue_comments_405629.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nOkay, that does it. I don't know why the various combinations of `./sage -f mathjax` and `./sage -f sagenb` don't also do it. And in fact, you don't need to delete the whole `sagenb` file in `installed`: for me, just deleting the line\n\n```\n        \"lib/python2.7/site-packages/sagenb/data/mathjax\",\n```\nis enough for `./sage -f sagenb` to recreate the link. I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says\n\n```\nNo record that 'sagenb' was ever installed; skipping uninstall\n```\nThat implied to me that the manifest was being ignored, but I guess that's not the case. Are these manifest files and their roles documented anywhere?",
    "created_at": "2018-08-28T21:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405629",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'>Comment 11:</a>
Okay, that does it. I don't know why the various combinations of `./sage -f mathjax` and `./sage -f sagenb` don't also do it. And in fact, you don't need to delete the whole `sagenb` file in `installed`: for me, just deleting the line

```
        "lib/python2.7/site-packages/sagenb/data/mathjax",
```
is enough for `./sage -f sagenb` to recreate the link. I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says

```
No record that 'sagenb' was ever installed; skipping uninstall
```
That implied to me that the manifest was being ignored, but I guess that's not the case. Are these manifest files and their roles documented anywhere?



---

archive/issue_comments_405630.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nIt seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?",
    "created_at": "2018-08-28T21:36:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405630",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'>Comment 12:</a>
It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?



---

archive/issue_comments_405631.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@jhpalmieri](#comment%3A11):\n> I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says\n> \n> ```\n> No record that 'sagenb' was ever installed; skipping uninstall\n> ```\n> That implied to me that the manifest was being ignored, but I guess that's not the case.\n\nI agree that this may be confusing. The answer is that `./sage -f` is really an uninstall followed by an install, not a reinstall. The message that you quoted refers to uninstallation done as part of the installation. But by the time, `sagenb` is already uninstalled. This would be different if the uninstall would be part of a reinstall (for a version upgrade for example).",
    "created_at": "2018-08-28T21:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405631",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@jhpalmieri](#comment%3A11):
> I don't know what these file manifests are supposed to do, especially since at the beginning of the `sagenb` install, it says
> 
> ```
> No record that 'sagenb' was ever installed; skipping uninstall
> ```
> That implied to me that the manifest was being ignored, but I guess that's not the case.

I agree that this may be confusing. The answer is that `./sage -f` is really an uninstall followed by an install, not a reinstall. The message that you quoted refers to uninstallation done as part of the installation. But by the time, `sagenb` is already uninstalled. This would be different if the uninstall would be part of a reinstall (for a version upgrade for example).



---

archive/issue_comments_405632.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nNow that running `sage-spkg-uninstall` is part of the normal package installation/upgrade process anyways it would be less confusing to change `./sage -f` to somehow force calling `sage-spkg <package>` without checking (via `make`) whether it is already up-to-date.",
    "created_at": "2018-08-29T10:00:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405632",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'>Comment 14:</a>
Now that running `sage-spkg-uninstall` is part of the normal package installation/upgrade process anyways it would be less confusing to change `./sage -f` to somehow force calling `sage-spkg <package>` without checking (via `make`) whether it is already up-to-date.



---

archive/issue_comments_405633.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nReplying to [@jhpalmieri](#comment%3A12):\n> It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?\n\nThis is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.\n\nThe issue caused by symlinks in this case is somewhat unique to symlinks, and the existing package installation code not handling existing symlinks properly; that's what #26153 is addressing.",
    "created_at": "2018-08-29T10:04:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405633",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'>Comment 15:</a>
Replying to [@jhpalmieri](#comment%3A12):
> It seems to me that the solution here is temporary: it will fix the issue for anyone who has the link right now, but as you point out, if sagenb is reinstalled, the link may come back. Will #26153 fix the problem permanently? Is there a way to force mathjax to be reinstalled after sagenb (even though mathjax is a dependency for sagenb), to ensure that any bad links are removed?

This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.

The issue caused by symlinks in this case is somewhat unique to symlinks, and the existing package installation code not handling existing symlinks properly; that's what #26153 is addressing.



---

archive/issue_comments_405634.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@embray](#comment%3A15):\n> This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.\n\nI agree partially. We should be mostly assuming a consistent state, but I can imagine some realistic scenarios where the information in `local/var/lib/sage/installed` is not consistent with the actual filesystem. For example, pressing CTRL-C while the files are being installed.\n\nWe shouldn't worry about it too much but we also shouldn't ignore it either.",
    "created_at": "2018-08-29T11:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405634",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@embray](#comment%3A15):
> This is only a problem if you're doing things that you are not supposed to do, like removing the package installation record (the one in `local/var/lib/sage/installed`) without also removing the files installed by that package.  We can't account for every possible way someone's `$SAGE_LOCAL` is corrupted.

I agree partially. We should be mostly assuming a consistent state, but I can imagine some realistic scenarios where the information in `local/var/lib/sage/installed` is not consistent with the actual filesystem. For example, pressing CTRL-C while the files are being installed.

We shouldn't worry about it too much but we also shouldn't ignore it either.



---

archive/issue_comments_405635.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nMaybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n\nThe only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.",
    "created_at": "2018-08-29T11:06:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405635",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'>Comment 17:</a>
Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.

The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.



---

archive/issue_comments_405636.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@embray](#comment%3A17):\n> Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n> \n> The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.\n\nMaybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.",
    "created_at": "2018-08-29T17:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405636",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@embray](#comment%3A17):
> Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.
> 
> The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.

Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.



---

archive/issue_comments_405637.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2018-08-29T17:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405637",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_330560.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-29T17:21:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330560"
}
```



---

archive/issue_events_330561.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-29T17:21:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330561"
}
```



---

archive/issue_comments_405638.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nI'm willing to give this a positive review as a stopgap measure. I hope the real issue with symlinks can be addressed at #26153.",
    "created_at": "2018-08-29T17:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405638",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'>Comment 19:</a>
I'm willing to give this a positive review as a stopgap measure. I hope the real issue with symlinks can be addressed at #26153.



---

archive/issue_events_330562.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:25:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330562"
}
```



---

archive/issue_events_330563.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "9911efbce3391fc6e1c4925aeea033d6127ce1c1",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-08-30T22:25:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26152#event-330563"
}
```



---

archive/issue_comments_405639.json:
```json
{
    "body": "Changed branch from **[u/jdemeyer/remove_symlink_local_share_mathjax_mathjax](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/remove_symlink_local_share_mathjax_mathjax)** to **[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**",
    "created_at": "2018-08-30T22:25:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405639",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jdemeyer/remove_symlink_local_share_mathjax_mathjax](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/remove_symlink_local_share_mathjax_mathjax)** to **[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)**



---

archive/issue_comments_405640.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@jhpalmieri](#comment%3A18):\n> Replying to [@embray](#comment%3A17):\n> > Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.\n> > \n> > The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.\n\n> \n> Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.\n\nI thought I posted it here but maybe forgot. But yes, I arrived at the same conclusion independently, so that's probably the obvious thing to do.  Write it first to a temp file, then move it to its proper location once installation completes successfully.\n\nThe only trick is that those \"temp\" files still need to be written some place that the uninstaller can find it.  Maybe it would be the same file by with a `.tmp` extension added, with the uninstaller updated to also find those `.tmp` files.",
    "created_at": "2018-09-03T09:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405640",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@jhpalmieri](#comment%3A18):
> Replying to [@embray](#comment%3A17):
> > Maybe it would be better, in that case, if the file manifest were written *first*.  Currently it is only written after file installation is complete.  If it were written first then it would represent, at least, what is *supposed* to be in `$SAGE_LOCAL`, and then uninstallation can still be used for cleanup.
> > 
> > The only problem with that is that the manifest is written to the same file that indicates that installation succeeded.  Maybe it should be a separate file; I don't know.

> 
> Maybe I'm misunderstanding, but you could write the manifest in a temporary location (and use it there for uninstallation) and then install it after file installation is complete.

I thought I posted it here but maybe forgot. But yes, I arrived at the same conclusion independently, so that's probably the obvious thing to do.  Write it first to a temp file, then move it to its proper location once installation completes successfully.

The only trick is that those "temp" files still need to be written some place that the uninstaller can find it.  Maybe it would be the same file by with a `.tmp` extension added, with the uninstaller updated to also find those `.tmp` files.



---

archive/issue_comments_405641.json:
```json
{
    "body": "Changed commit from **[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)** to none",
    "created_at": "2018-09-03T09:44:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405641",
    "user": "https://github.com/embray"
}
```

Changed commit from **[b9eb92c](https://github.com/sagemath/sagetrac-mirror/commit/b9eb92c31c9ac8268bbea31ada66fa31c09c8d4d)** to none



---

archive/issue_comments_405642.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nCould anyone with working MathJax in Jupyter Sage notebooks post their setup?\n\nAfter this was fixed, I can't get it to work any more...",
    "created_at": "2018-09-25T11:25:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405642",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'>Comment 22:</a>
Could anyone with working MathJax in Jupyter Sage notebooks post their setup?

After this was fixed, I can't get it to work any more...



---

archive/issue_comments_405643.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nWhat do you mean by \"setup\"? I don't think I've done anything special, and math displays fine for me in Sage's Jupyter notebook. So I'm happy to provide information, but what are you looking for?",
    "created_at": "2018-09-25T14:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405643",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'>Comment 23:</a>
What do you mean by "setup"? I don't think I've done anything special, and math displays fine for me in Sage's Jupyter notebook. So I'm happy to provide information, but what are you looking for?



---

archive/issue_comments_405644.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nIt was possible to set all the display to MathJax, no?\nWhat works for me is putting \n\n```\n%display latex\n...\n```\nin a cell, and then it seems to use MathJax to show stuff in it.\nSo it might be that my memory is fuzzy at this point, and I'm confusing this with some\nother notebook...",
    "created_at": "2018-09-25T18:38:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405644",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'>Comment 24:</a>
It was possible to set all the display to MathJax, no?
What works for me is putting 

```
%display latex
...
```
in a cell, and then it seems to use MathJax to show stuff in it.
So it might be that my memory is fuzzy at this point, and I'm confusing this with some
other notebook...



---

archive/issue_comments_405645.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\n(a) The legacy Sage notebook had an option to typeset all output, in which case it would use MathJax by default. Could that be what you're thinking of? I don't know of such an option for the Jupyter notebook, so I can't answer that part of your question. \n\n(b) If you're actually missing a feature, I don't think it would be due to this ticket. (Or if it was, then the feature was relying on seriously buggy behavior, and I think that is unlikely.) In particular, MathJax does work with the Jupyter notebook, for instance if I do `show(matrix(10, 10, lambda i, j: i+j))` or I put `$x=y$` in a markdown cell. It sounds like you also see MathJax in action.",
    "created_at": "2018-09-25T18:49:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405645",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'>Comment 25:</a>
(a) The legacy Sage notebook had an option to typeset all output, in which case it would use MathJax by default. Could that be what you're thinking of? I don't know of such an option for the Jupyter notebook, so I can't answer that part of your question. 

(b) If you're actually missing a feature, I don't think it would be due to this ticket. (Or if it was, then the feature was relying on seriously buggy behavior, and I think that is unlikely.) In particular, MathJax does work with the Jupyter notebook, for instance if I do `show(matrix(10, 10, lambda i, j: i+j))` or I put `$x=y$` in a markdown cell. It sounds like you also see MathJax in action.



---

archive/issue_comments_405646.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nYeah all this ticket did was force reinstallation of the mathjax spkg for some people.",
    "created_at": "2018-09-26T09:15:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405646",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'>Comment 26:</a>
Yeah all this ticket did was force reinstallation of the mathjax spkg for some people.



---

archive/issue_comments_405647.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nThis problem has returned for me. As part of Sage's installation (part of some package, I'm not sure which one, or maybe a level up from that), should we check whether this link exists, and if so, delete it?",
    "created_at": "2018-10-31T15:00:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405647",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'>Comment 27:</a>
This problem has returned for me. As part of Sage's installation (part of some package, I'm not sure which one, or maybe a level up from that), should we check whether this link exists, and if so, delete it?



---

archive/issue_comments_405648.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nSee #26612 for a proposed solution (although I still don't know what is causing the problem).",
    "created_at": "2018-10-31T19:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26152",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26152#issuecomment-405648",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'>Comment 28:</a>
See #26612 for a proposed solution (although I still don't know what is causing the problem).
