# Issue 26284: Avoid comparison of vertex labels in MIP (Step 3)

archive/issues_026047.json:
```json
{
    "assignees": [],
    "body": "Avoid comparison of vertex labels in `connectivity.pyx`.\n\nThis ticket also do some cleaning in the methods involving MIP in `comparability.pyx`, `digraph.py`, `vertex_separation.pyx`, `cutwidth.pyx`.\n\n\n**CC:**  @tscrim @fchapoton\n\n**Branch/Commit:** [4194063683449e51a11573dbcf3071597870d288](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** David Coudert\n\nIssue created by migration from https://trac.sagemath.org/ticket/26284\n\n",
    "closed_at": "2018-10-05T16:56:57Z",
    "created_at": "2018-09-14T14:19:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Avoid comparison of vertex labels in MIP (Step 3)",
    "type": "issue",
    "updated_at": "2018-10-05T16:56:57Z",
    "url": "https://github.com/sagemath/sage/issues/26284",
    "user": "https://github.com/dcoudert"
}
```
Avoid comparison of vertex labels in `connectivity.pyx`.

This ticket also do some cleaning in the methods involving MIP in `comparability.pyx`, `digraph.py`, `vertex_separation.pyx`, `cutwidth.pyx`.


**CC:**  @tscrim @fchapoton

**Branch/Commit:** [4194063683449e51a11573dbcf3071597870d288](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)

**Reviewer:** Travis Scrimshaw

**Author:** David Coudert

Issue created by migration from https://trac.sagemath.org/ticket/26284





---

archive/issue_events_316274.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:19:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-316274"
}
```



---

archive/issue_events_316275.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:19:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20graph%20theory",
    "label_color": "08517b",
    "label_name": "component: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-316275"
}
```



---

archive/issue_events_316276.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:19:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-316276"
}
```



---

archive/issue_comments_407880.json:
```json
{
    "body": "**Branch:** [public/26284_cleaning_in_some_MIPs](https://github.com/sagemath/sagetrac-mirror/tree/public/26284_cleaning_in_some_MIPs)",
    "created_at": "2018-09-14T14:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407880",
    "user": "https://github.com/dcoudert"
}
```

**Branch:** [public/26284_cleaning_in_some_MIPs](https://github.com/sagemath/sagetrac-mirror/tree/public/26284_cleaning_in_some_MIPs)



---

archive/issue_comments_407881.json:
```json
{
    "body": "**Commit:** [5bd8e80a1dd2f1d2a3aa512f979401945dd26830](https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830)",
    "created_at": "2018-09-14T14:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407881",
    "user": "https://github.com/dcoudert"
}
```

**Commit:** [5bd8e80a1dd2f1d2a3aa512f979401945dd26830](https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830)



---

archive/issue_events_316277.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:21:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-316277"
}
```



---

archive/issue_comments_407882.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830\">5bd8e80</a></td><td><code>trac #26284: cleaning in various MIPs</code></td></tr></table>\n",
    "created_at": "2018-09-14T14:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407882",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830">5bd8e80</a></td><td><code>trac #26284: cleaning in various MIPs</code></td></tr></table>




---

archive/issue_comments_407883.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a\">921a353</a></td><td><code>trac #: Merged with 8.4.beta5</code></td></tr></table>\n",
    "created_at": "2018-09-15T17:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407883",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a">921a353</a></td><td><code>trac #: Merged with 8.4.beta5</code></td></tr></table>




---

archive/issue_comments_407884.json:
```json
{
    "body": "**Changing commit** from \"[5bd8e80a1dd2f1d2a3aa512f979401945dd26830](https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830)\" to \"[921a353b5e4e9daea3fbf321bf80116577fc245a](https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a)\".",
    "created_at": "2018-09-15T17:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407884",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5bd8e80a1dd2f1d2a3aa512f979401945dd26830](https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830)" to "[921a353b5e4e9daea3fbf321bf80116577fc245a](https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a)".



---

archive/issue_comments_407885.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14\">a938f9c</a></td><td><code>trac #26284: change a lambda wrapper to a def</code></td></tr></table>\n",
    "created_at": "2018-09-16T09:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407885",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14">a938f9c</a></td><td><code>trac #26284: change a lambda wrapper to a def</code></td></tr></table>




---

archive/issue_comments_407886.json:
```json
{
    "body": "**Changing commit** from \"[921a353b5e4e9daea3fbf321bf80116577fc245a](https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a)\" to \"[a938f9c286d99752388c61a3315a92aaf4ec7c14](https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14)\".",
    "created_at": "2018-09-16T09:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407886",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[921a353b5e4e9daea3fbf321bf80116577fc245a](https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a)" to "[a938f9c286d99752388c61a3315a92aaf4ec7c14](https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14)".



---

archive/issue_comments_407887.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis change will be a slowdown:\n\n```diff\n-    if g.is_directed():\n-        reorder_edge = lambda x,y : (x,y)\n-    else:\n-        reorder_edge = lambda x,y : (x,y) if x<= y else (y,x)\n+    def reorder_edge(x, y):\n+        if g.is_directed():\n+            return (x,y)\n+        else:\n+            return frozenset((x,y))\n```\nas everytime `reorder_edge` is called, it has to check `g.is_directed`, whereas before it only checked it once. Actually, it is probably better just to do these changes:\n\n```diff\n-            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[reorder_edge(u,v)], max=1)\n-            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[reorder_edge(u,v)], max=1)\n+            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[frozenset([u,v])], max=1)\n+            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[frozenset([u,v])], max=1)\n```\n(We already know that `g` is not directed here.)\nMove this line into each of the two branches above:\n\n```\np.set_objective(p.sum(weight(l) * in_cut[reorder_edge(u,v)] for u,v,l in g.edge_iterator()))\n```\n\n```diff\n-        for u,v,l in g.edge_iterator():\n-            if in_cut[reorder_edge(u,v)] == 1:\n-                edges.append((u,v,l))\n+        if g.is_directed():\n+            for u,v,l in g.edge_iterator():\n+                if in_cut[u,v] == 1:\n+                    edges.append((u,v,l))\n+        else:\n+            for u,v,l in g.edge_iterator():\n+                if in_cut[frozenset(u,v)] == 1:\n+                    edges.append((u,v,l))\n```\n\nAlso PEP8 says remove the whitespace before the closing parenthesis:\n\n```diff\n-    p = MixedIntegerLinearProgram( maximization = False, solver = solver )\n+    p = MixedIntegerLinearProgram(maximization=False, solver=solver )\n```",
    "created_at": "2018-10-03T22:22:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407887",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
This change will be a slowdown:

```diff
-    if g.is_directed():
-        reorder_edge = lambda x,y : (x,y)
-    else:
-        reorder_edge = lambda x,y : (x,y) if x<= y else (y,x)
+    def reorder_edge(x, y):
+        if g.is_directed():
+            return (x,y)
+        else:
+            return frozenset((x,y))
```
as everytime `reorder_edge` is called, it has to check `g.is_directed`, whereas before it only checked it once. Actually, it is probably better just to do these changes:

```diff
-            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[reorder_edge(u,v)], max=1)
-            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[reorder_edge(u,v)], max=1)
+            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[frozenset([u,v])], max=1)
+            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[frozenset([u,v])], max=1)
```
(We already know that `g` is not directed here.)
Move this line into each of the two branches above:

```
p.set_objective(p.sum(weight(l) * in_cut[reorder_edge(u,v)] for u,v,l in g.edge_iterator()))
```

```diff
-        for u,v,l in g.edge_iterator():
-            if in_cut[reorder_edge(u,v)] == 1:
-                edges.append((u,v,l))
+        if g.is_directed():
+            for u,v,l in g.edge_iterator():
+                if in_cut[u,v] == 1:
+                    edges.append((u,v,l))
+        else:
+            for u,v,l in g.edge_iterator():
+                if in_cut[frozenset(u,v)] == 1:
+                    edges.append((u,v,l))
```

Also PEP8 says remove the whitespace before the closing parenthesis:

```diff
-    p = MixedIntegerLinearProgram( maximization = False, solver = solver )
+    p = MixedIntegerLinearProgram(maximization=False, solver=solver )
```



---

archive/issue_comments_407888.json:
```json
{
    "body": "**Changing commit** from \"[a938f9c286d99752388c61a3315a92aaf4ec7c14](https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14)\" to \"[4194063683449e51a11573dbcf3071597870d288](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)\".",
    "created_at": "2018-10-04T07:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407888",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[a938f9c286d99752388c61a3315a92aaf4ec7c14](https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14)" to "[4194063683449e51a11573dbcf3071597870d288](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)".



---

archive/issue_comments_407889.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83fa55e61e12a2b6718481a424905371d96cec58\">83fa55e</a></td><td><code>trac #26284: Merged with 8.4.beta7</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288\">4194063</a></td><td><code>trac #26284: implement reviewer's comments</code></td></tr></table>\n",
    "created_at": "2018-10-04T07:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407889",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83fa55e61e12a2b6718481a424905371d96cec58">83fa55e</a></td><td><code>trac #26284: Merged with 8.4.beta7</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288">4194063</a></td><td><code>trac #26284: implement reviewer's comments</code></td></tr></table>




---

archive/issue_comments_407890.json:
```json
{
    "body": "<a id='comment:7'></a>\nRight, `reorder_edge` was not needed here.",
    "created_at": "2018-10-04T07:27:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407890",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>
Right, `reorder_edge` was not needed here.



---

archive/issue_comments_407891.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks. LGTM.",
    "created_at": "2018-10-04T07:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407891",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Thanks. LGTM.



---

archive/issue_events_316278.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-10-04T07:47:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-316278"
}
```



---

archive/issue_events_316279.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-10-04T07:47:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-316279"
}
```



---

archive/issue_comments_407892.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-10-04T07:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407892",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_407893.json:
```json
{
    "body": "**Changing branch** from \"[public/26284_cleaning_in_some_MIPs](https://github.com/sagemath/sagetrac-mirror/tree/public/26284_cleaning_in_some_MIPs)\" to \"[4194063683449e51a11573dbcf3071597870d288](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)\".",
    "created_at": "2018-10-05T16:56:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-407893",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/26284_cleaning_in_some_MIPs](https://github.com/sagemath/sagetrac-mirror/tree/public/26284_cleaning_in_some_MIPs)" to "[4194063683449e51a11573dbcf3071597870d288](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)".



---

archive/issue_events_316280.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-05T16:56:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-316280"
}
```



---

archive/issue_events_316281.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c22cdee6a7c19357315d072de9262a25006490e6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-10-05T16:56:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-316281"
}
```
