# Issue 26284: Avoid comparison of vertex labels in MIP (Step 3)

archive/issues_026047.json:
```json
{
    "assignees": [],
    "body": "Avoid comparison of vertex labels in `connectivity.pyx`.\n\nThis ticket also do some cleaning in the methods involving MIP in `comparability.pyx`, `digraph.py`, `vertex_separation.pyx`, `cutwidth.pyx`.\n\n\nCC:  @tscrim @fchapoton\n\nComponent: **graph theory**\n\nAuthor: **David Coudert**\n\nBranch/Commit: **[`4194063`](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)**\n\nReviewer: **Travis Scrimshaw**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26284_\n\n",
    "closed_at": "2018-10-05T16:56:57Z",
    "created_at": "2018-09-14T14:19:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Avoid comparison of vertex labels in MIP (Step 3)",
    "type": "issue",
    "updated_at": "2018-10-05T16:56:57Z",
    "url": "https://github.com/sagemath/sage/issues/26284",
    "user": "https://github.com/dcoudert"
}
```
Avoid comparison of vertex labels in `connectivity.pyx`.

This ticket also do some cleaning in the methods involving MIP in `comparability.pyx`, `digraph.py`, `vertex_separation.pyx`, `cutwidth.pyx`.


CC:  @tscrim @fchapoton

Component: **graph theory**

Author: **David Coudert**

Branch/Commit: **[`4194063`](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)**

Reviewer: **Travis Scrimshaw**

_Issue created by migration from https://trac.sagemath.org/ticket/26284_





---

archive/issue_events_359294.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:19:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359294"
}
```



---

archive/issue_events_359295.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:19:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359295"
}
```



---

archive/issue_events_359296.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:19:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359296"
}
```



---

archive/issue_events_359297.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:19:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359297"
}
```



---

archive/issue_comments_405204.json:
```json
{
    "body": "Branch: **[public/26284_cleaning_in_some_MIPs](https://github.com/sagemath/sagetrac-mirror/tree/public/26284_cleaning_in_some_MIPs)**",
    "created_at": "2018-09-14T14:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405204",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[public/26284_cleaning_in_some_MIPs](https://github.com/sagemath/sagetrac-mirror/tree/public/26284_cleaning_in_some_MIPs)**



---

archive/issue_comments_405205.json:
```json
{
    "body": "Commit: **[`5bd8e80`](https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830)**",
    "created_at": "2018-09-14T14:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405205",
    "user": "https://github.com/dcoudert"
}
```

Commit: **[`5bd8e80`](https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830)**



---

archive/issue_events_359298.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-09-14T14:21:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359298"
}
```



---

archive/issue_comments_405206.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830\"><code>5bd8e80</code></a></td><td><code>trac #26284: cleaning in various MIPs</code></td></tr></table>\n",
    "created_at": "2018-09-14T14:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405206",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830"><code>5bd8e80</code></a></td><td><code>trac #26284: cleaning in various MIPs</code></td></tr></table>




---

archive/issue_comments_405207.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a\"><code>921a353</code></a></td><td><code>trac #: Merged with 8.4.beta5</code></td></tr></table>\n",
    "created_at": "2018-09-15T17:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405207",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a"><code>921a353</code></a></td><td><code>trac #: Merged with 8.4.beta5</code></td></tr></table>




---

archive/issue_comments_405208.json:
```json
{
    "body": "Changed commit from **[`5bd8e80`](https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830)** to **[`921a353`](https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a)**",
    "created_at": "2018-09-15T17:07:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405208",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5bd8e80`](https://github.com/sagemath/sagetrac-mirror/commit/5bd8e80a1dd2f1d2a3aa512f979401945dd26830)** to **[`921a353`](https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a)**



---

archive/issue_comments_405209.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14\"><code>a938f9c</code></a></td><td><code>trac #26284: change a lambda wrapper to a def</code></td></tr></table>\n",
    "created_at": "2018-09-16T09:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405209",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14"><code>a938f9c</code></a></td><td><code>trac #26284: change a lambda wrapper to a def</code></td></tr></table>




---

archive/issue_comments_405210.json:
```json
{
    "body": "Changed commit from **[`921a353`](https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a)** to **[`a938f9c`](https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14)**",
    "created_at": "2018-09-16T09:27:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405210",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`921a353`](https://github.com/sagemath/sagetrac-mirror/commit/921a353b5e4e9daea3fbf321bf80116577fc245a)** to **[`a938f9c`](https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14)**



---

archive/issue_comments_405211.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThis change will be a slowdown:\n\n```diff\n-    if g.is_directed():\n-        reorder_edge = lambda x,y : (x,y)\n-    else:\n-        reorder_edge = lambda x,y : (x,y) if x<= y else (y,x)\n+    def reorder_edge(x, y):\n+        if g.is_directed():\n+            return (x,y)\n+        else:\n+            return frozenset((x,y))\n```\nas everytime `reorder_edge` is called, it has to check `g.is_directed`, whereas before it only checked it once. Actually, it is probably better just to do these changes:\n\n```diff\n-            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[reorder_edge(u,v)], max=1)\n-            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[reorder_edge(u,v)], max=1)\n+            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[frozenset([u,v])], max=1)\n+            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[frozenset([u,v])], max=1)\n```\n(We already know that `g` is not directed here.)\nMove this line into each of the two branches above:\n\n```\np.set_objective(p.sum(weight(l) * in_cut[reorder_edge(u,v)] for u,v,l in g.edge_iterator()))\n```\n\n```diff\n-        for u,v,l in g.edge_iterator():\n-            if in_cut[reorder_edge(u,v)] == 1:\n-                edges.append((u,v,l))\n+        if g.is_directed():\n+            for u,v,l in g.edge_iterator():\n+                if in_cut[u,v] == 1:\n+                    edges.append((u,v,l))\n+        else:\n+            for u,v,l in g.edge_iterator():\n+                if in_cut[frozenset(u,v)] == 1:\n+                    edges.append((u,v,l))\n```\n\nAlso PEP8 says remove the whitespace before the closing parenthesis:\n\n```diff\n-    p = MixedIntegerLinearProgram( maximization = False, solver = solver )\n+    p = MixedIntegerLinearProgram(maximization=False, solver=solver )\n```",
    "created_at": "2018-10-03T22:22:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405211",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:5" align="right">comment:5</div>

This change will be a slowdown:

```diff
-    if g.is_directed():
-        reorder_edge = lambda x,y : (x,y)
-    else:
-        reorder_edge = lambda x,y : (x,y) if x<= y else (y,x)
+    def reorder_edge(x, y):
+        if g.is_directed():
+            return (x,y)
+        else:
+            return frozenset((x,y))
```
as everytime `reorder_edge` is called, it has to check `g.is_directed`, whereas before it only checked it once. Actually, it is probably better just to do these changes:

```diff
-            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[reorder_edge(u,v)], max=1)
-            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[reorder_edge(u,v)], max=1)
+            p.add_constraint(in_set[0,u] + in_set[1,v] - in_cut[frozenset([u,v])], max=1)
+            p.add_constraint(in_set[1,u] + in_set[0,v] - in_cut[frozenset([u,v])], max=1)
```
(We already know that `g` is not directed here.)
Move this line into each of the two branches above:

```
p.set_objective(p.sum(weight(l) * in_cut[reorder_edge(u,v)] for u,v,l in g.edge_iterator()))
```

```diff
-        for u,v,l in g.edge_iterator():
-            if in_cut[reorder_edge(u,v)] == 1:
-                edges.append((u,v,l))
+        if g.is_directed():
+            for u,v,l in g.edge_iterator():
+                if in_cut[u,v] == 1:
+                    edges.append((u,v,l))
+        else:
+            for u,v,l in g.edge_iterator():
+                if in_cut[frozenset(u,v)] == 1:
+                    edges.append((u,v,l))
```

Also PEP8 says remove the whitespace before the closing parenthesis:

```diff
-    p = MixedIntegerLinearProgram( maximization = False, solver = solver )
+    p = MixedIntegerLinearProgram(maximization=False, solver=solver )
```



---

archive/issue_comments_405212.json:
```json
{
    "body": "Changed commit from **[`a938f9c`](https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14)** to **[`4194063`](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)**",
    "created_at": "2018-10-04T07:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405212",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a938f9c`](https://github.com/sagemath/sagetrac-mirror/commit/a938f9c286d99752388c61a3315a92aaf4ec7c14)** to **[`4194063`](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)**



---

archive/issue_comments_405213.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83fa55e61e12a2b6718481a424905371d96cec58\"><code>83fa55e</code></a></td><td><code>trac #26284: Merged with 8.4.beta7</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288\"><code>4194063</code></a></td><td><code>trac #26284: implement reviewer's comments</code></td></tr></table>\n",
    "created_at": "2018-10-04T07:22:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405213",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83fa55e61e12a2b6718481a424905371d96cec58"><code>83fa55e</code></a></td><td><code>trac #26284: Merged with 8.4.beta7</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288"><code>4194063</code></a></td><td><code>trac #26284: implement reviewer's comments</code></td></tr></table>




---

archive/issue_comments_405214.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nRight, `reorder_edge` was not needed here.",
    "created_at": "2018-10-04T07:27:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405214",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:7" align="right">comment:7</div>

Right, `reorder_edge` was not needed here.



---

archive/issue_comments_405215.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThanks. LGTM.",
    "created_at": "2018-10-04T07:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405215",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

Thanks. LGTM.



---

archive/issue_events_359299.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-10-04T07:47:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359299"
}
```



---

archive/issue_events_359300.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-10-04T07:47:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359300"
}
```



---

archive/issue_comments_405216.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-10-04T07:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405216",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_405217.json:
```json
{
    "body": "Changed branch from **[public/26284_cleaning_in_some_MIPs](https://github.com/sagemath/sagetrac-mirror/tree/public/26284_cleaning_in_some_MIPs)** to **[`4194063`](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)**",
    "created_at": "2018-10-05T16:56:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26284#issuecomment-405217",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/26284_cleaning_in_some_MIPs](https://github.com/sagemath/sagetrac-mirror/tree/public/26284_cleaning_in_some_MIPs)** to **[`4194063`](https://github.com/sagemath/sagetrac-mirror/commit/4194063683449e51a11573dbcf3071597870d288)**



---

archive/issue_events_359301.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-05T16:56:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359301"
}
```



---

archive/issue_events_359302.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c22cdee6a7c19357315d072de9262a25006490e6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-10-05T16:56:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26284",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26284#event-359302"
}
```
