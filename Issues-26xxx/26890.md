# Issue 26890: ElementWrapperCheckWrappedClass does not implement comparison properly

archive/issues_026653.json:
```json
{
    "body": "Comparisons with the wrapped class should just delegate to the wrapped class, handling also inequalities instead of only `==` and `!=`.\n\n**Branch/Commit:** [8418f8eea1a2bf57ac1ea6df31585eac00496a9e](https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Jeroen Demeyer\n\nIssue created by migration from https://trac.sagemath.org/ticket/26890\n\n",
    "closed_at": "2018-12-23T23:39:52Z",
    "created_at": "2018-12-13T18:21:11Z",
    "labels": [
        "component: categories",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.6",
    "title": "ElementWrapperCheckWrappedClass does not implement comparison properly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26890",
    "user": "https://github.com/jdemeyer"
}
```
Comparisons with the wrapped class should just delegate to the wrapped class, handling also inequalities instead of only `==` and `!=`.

**Branch/Commit:** [8418f8eea1a2bf57ac1ea6df31585eac00496a9e](https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e)

**Reviewer:** Travis Scrimshaw

**Author:** Jeroen Demeyer

Issue created by migration from https://trac.sagemath.org/ticket/26890





---

archive/issue_comments_494101.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Comparisons should just delegate to the wrapped class instead of doing anything more fancy.\n``````\n",
    "created_at": "2018-12-13T19:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494101",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Comparisons should just delegate to the wrapped class instead of doing anything more fancy.
``````




---

archive/issue_comments_494102.json:
```json
{
    "body": "**Dependencies:** #26586",
    "created_at": "2018-12-13T19:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494102",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #26586



---

archive/issue_comments_494103.json:
```json
{
    "body": "**Branch:** [u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly)",
    "created_at": "2018-12-13T21:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494103",
    "user": "https://github.com/jdemeyer"
}
```

**Branch:** [u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly)



---

archive/issue_comments_494104.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494104",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_494105.json:
```json
{
    "body": "<a id='comment:4'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc77918a2fe3de5709d9c4a088b89775083b4970\">dc77918</a></td><td><code>Mark doctest as known bug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8acc5866ac55ba107b979bbaafa09c29bd17de7a\">8acc586</a></td><td><code>Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class</code></td></tr></table>\n",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494105",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc77918a2fe3de5709d9c4a088b89775083b4970">dc77918</a></td><td><code>Mark doctest as known bug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8acc5866ac55ba107b979bbaafa09c29bd17de7a">8acc586</a></td><td><code>Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class</code></td></tr></table>




---

archive/issue_comments_494106.json:
```json
{
    "body": "**Commit:** [8acc5866ac55ba107b979bbaafa09c29bd17de7a](https://github.com/sagemath/sagetrac-mirror/commit/8acc5866ac55ba107b979bbaafa09c29bd17de7a)",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494106",
    "user": "https://github.com/jdemeyer"
}
```

**Commit:** [8acc5866ac55ba107b979bbaafa09c29bd17de7a](https://github.com/sagemath/sagetrac-mirror/commit/8acc5866ac55ba107b979bbaafa09c29bd17de7a)



---

archive/issue_comments_494107.json:
```json
{
    "body": "**Author:** Jeroen Demeyer",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494107",
    "user": "https://github.com/jdemeyer"
}
```

**Author:** Jeroen Demeyer



---

archive/issue_comments_494108.json:
```json
{
    "body": "<a id='comment:5'></a>\nYou are changing the comparison logic a bit, in particular, comparisons between two wrapped classes no longer takes into account the parents. Since this is an extension class, it will not get subclassed when constructing elements; you've added an `isinstance` check that would also take care of if that happened as well. So we would get comparisons between objects that should not necessarily be treated as the same.\n\nFor a more concrete example, consider `(1,0)` as a **Z**-vector and `(1,0)` as a partition in an `2x2` box. These are (mathematically) incomparable objects, but your change would have them be equal. So at least the parent check should be added back in.\n\nMy recollection of why this was done this way was because we did not want the wrapped objects to have an ordering on them. However, I do not think there is any harm in inducing an ordering from the underlying objects. So the rest of your changes are fine with me.",
    "created_at": "2018-12-13T23:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494108",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
You are changing the comparison logic a bit, in particular, comparisons between two wrapped classes no longer takes into account the parents. Since this is an extension class, it will not get subclassed when constructing elements; you've added an `isinstance` check that would also take care of if that happened as well. So we would get comparisons between objects that should not necessarily be treated as the same.

For a more concrete example, consider `(1,0)` as a **Z**-vector and `(1,0)` as a partition in an `2x2` box. These are (mathematically) incomparable objects, but your change would have them be equal. So at least the parent check should be added back in.

My recollection of why this was done this way was because we did not want the wrapped objects to have an ordering on them. However, I do not think there is any harm in inducing an ordering from the underlying objects. So the rest of your changes are fine with me.



---

archive/issue_comments_494109.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-12-14T06:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494109",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_494110.json:
```json
{
    "body": "**Changing commit** from \"[8acc5866ac55ba107b979bbaafa09c29bd17de7a](https://github.com/sagemath/sagetrac-mirror/commit/8acc5866ac55ba107b979bbaafa09c29bd17de7a)\" to \"[ada617424e2350b4842ae5bdb3c6404dda7c9887](https://github.com/sagemath/sagetrac-mirror/commit/ada617424e2350b4842ae5bdb3c6404dda7c9887)\".",
    "created_at": "2018-12-14T08:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8acc5866ac55ba107b979bbaafa09c29bd17de7a](https://github.com/sagemath/sagetrac-mirror/commit/8acc5866ac55ba107b979bbaafa09c29bd17de7a)" to "[ada617424e2350b4842ae5bdb3c6404dda7c9887](https://github.com/sagemath/sagetrac-mirror/commit/ada617424e2350b4842ae5bdb3c6404dda7c9887)".



---

archive/issue_comments_494111.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ada617424e2350b4842ae5bdb3c6404dda7c9887\">ada6174</a></td><td><code>Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class</code></td></tr></table>\n",
    "created_at": "2018-12-14T08:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ada617424e2350b4842ae5bdb3c6404dda7c9887">ada6174</a></td><td><code>Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class</code></td></tr></table>




---

archive/issue_comments_494112.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c515f271abc7df392f6b4ea0c1347f2449fdcba\">7c515f2</a></td><td><code>Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class</code></td></tr></table>\n",
    "created_at": "2018-12-14T08:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c515f271abc7df392f6b4ea0c1347f2449fdcba">7c515f2</a></td><td><code>Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class</code></td></tr></table>




---

archive/issue_comments_494113.json:
```json
{
    "body": "**Changing commit** from \"[ada617424e2350b4842ae5bdb3c6404dda7c9887](https://github.com/sagemath/sagetrac-mirror/commit/ada617424e2350b4842ae5bdb3c6404dda7c9887)\" to \"[7c515f271abc7df392f6b4ea0c1347f2449fdcba](https://github.com/sagemath/sagetrac-mirror/commit/7c515f271abc7df392f6b4ea0c1347f2449fdcba)\".",
    "created_at": "2018-12-14T08:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ada617424e2350b4842ae5bdb3c6404dda7c9887](https://github.com/sagemath/sagetrac-mirror/commit/ada617424e2350b4842ae5bdb3c6404dda7c9887)" to "[7c515f271abc7df392f6b4ea0c1347f2449fdcba](https://github.com/sagemath/sagetrac-mirror/commit/7c515f271abc7df392f6b4ea0c1347f2449fdcba)".



---

archive/issue_comments_494114.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-12-14T08:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494114",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_494115.json:
```json
{
    "body": "<a id='comment:10'></a>\nThere is one failure because of the fact that coercion is now taken into account. So we also need this change in `sage/combinat/root_system/extended_affine_weyl_group.py`:\n\n```diff\n     Note that for untwisted affine type the dual form of the classical Weyl group\n     is isomorphic to the usual one, but acts on a different lattice and is therefore different to sage::\n \n         sage: W0v = E.dual_classical_weyl(); W0v\n         Weyl Group of type ['A', 2] (as a matrix group acting on the weight lattice)\n         sage: v = W0v.from_reduced_word([1,2])\n         sage: x = PvW0(v); x\n         s1*s2\n         sage: y = PW0(v); y\n         s1*s2\n-        sage: x == y\n-        False\n         sage: x.parent() == y.parent()\n         False\n+\n+    However, because there is a coercion from ``PvW0`` to ``PW0``,\n+    the elements ``x`` and ``y`` compare as equal::\n+\n+        sage: x == y\n+        True\n+\n```\nOnce changed, you can set a positive review on my behalf.",
    "created_at": "2018-12-16T00:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494115",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
There is one failure because of the fact that coercion is now taken into account. So we also need this change in `sage/combinat/root_system/extended_affine_weyl_group.py`:

```diff
     Note that for untwisted affine type the dual form of the classical Weyl group
     is isomorphic to the usual one, but acts on a different lattice and is therefore different to sage::
 
         sage: W0v = E.dual_classical_weyl(); W0v
         Weyl Group of type ['A', 2] (as a matrix group acting on the weight lattice)
         sage: v = W0v.from_reduced_word([1,2])
         sage: x = PvW0(v); x
         s1*s2
         sage: y = PW0(v); y
         s1*s2
-        sage: x == y
-        False
         sage: x.parent() == y.parent()
         False
+
+    However, because there is a coercion from ``PvW0`` to ``PW0``,
+    the elements ``x`` and ``y`` compare as equal::
+
+        sage: x == y
+        True
+
```
Once changed, you can set a positive review on my behalf.



---

archive/issue_comments_494116.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-12-16T00:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494116",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_494117.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e\">8418f8e</a></td><td><code>Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class</code></td></tr></table>\n",
    "created_at": "2018-12-17T09:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494117",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e">8418f8e</a></td><td><code>Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class</code></td></tr></table>




---

archive/issue_comments_494118.json:
```json
{
    "body": "**Changing commit** from \"[7c515f271abc7df392f6b4ea0c1347f2449fdcba](https://github.com/sagemath/sagetrac-mirror/commit/7c515f271abc7df392f6b4ea0c1347f2449fdcba)\" to \"[8418f8eea1a2bf57ac1ea6df31585eac00496a9e](https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e)\".",
    "created_at": "2018-12-17T09:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494118",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7c515f271abc7df392f6b4ea0c1347f2449fdcba](https://github.com/sagemath/sagetrac-mirror/commit/7c515f271abc7df392f6b4ea0c1347f2449fdcba)" to "[8418f8eea1a2bf57ac1ea6df31585eac00496a9e](https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e)".



---

archive/issue_comments_494119.json:
```json
{
    "body": "**Changing dependencies** from \"#26586\" to \"\".",
    "created_at": "2018-12-17T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494119",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#26586" to "".



---

archive/issue_comments_494120.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-12-17T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494120",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_494121.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Comparisons should just delegate to the wrapped class instead of doing anything more fancy.\n+Comparisons with the wrapped class should just delegate to the wrapped class, handling also inequalities instead of only `==` and `!=`.\n``````\n",
    "created_at": "2018-12-17T15:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494121",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1 @@
-Comparisons should just delegate to the wrapped class instead of doing anything more fancy.
+Comparisons with the wrapped class should just delegate to the wrapped class, handling also inequalities instead of only `==` and `!=`.
``````




---

archive/issue_events_075230.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-23T23:39:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26890#event-75230"
}
```



---

archive/issue_comments_494122.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly)\" to \"[8418f8eea1a2bf57ac1ea6df31585eac00496a9e](https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e)\".",
    "created_at": "2018-12-23T23:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494122",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly)" to "[8418f8eea1a2bf57ac1ea6df31585eac00496a9e](https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e)".



---

archive/issue_comments_494123.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis tickets were closed as fixed after the Sage 8.5 release.",
    "created_at": "2018-12-28T14:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-494123",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
This tickets were closed as fixed after the Sage 8.5 release.



---

archive/issue_events_075231.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:06:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26890#event-75231"
}
```
