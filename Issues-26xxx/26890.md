# Issue 26890: ElementWrapperCheckWrappedClass does not implement comparison properly

archive/issues_026653.json:
```json
{
    "body": "Comparisons with the wrapped class should just delegate to the wrapped class, handling also inequalities instead of only `==` and `!=`.\n\nBranch/Commit: 8418f8eea1a2bf57ac1ea6df31585eac00496a9e\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26890\n\n",
    "closed_at": "2018-12-23T23:39:52Z",
    "created_at": "2018-12-13T18:21:11Z",
    "labels": [
        "component: categories",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.6",
    "title": "ElementWrapperCheckWrappedClass does not implement comparison properly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26890",
    "user": "https://github.com/jdemeyer"
}
```
Comparisons with the wrapped class should just delegate to the wrapped class, handling also inequalities instead of only `==` and `!=`.

Branch/Commit: 8418f8eea1a2bf57ac1ea6df31585eac00496a9e

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26890





---

archive/issue_comments_518319.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+Comparisons should just delegate to the wrapped class instead of doing anything more fancy.\n``````\n",
    "created_at": "2018-12-13T19:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518319",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+Comparisons should just delegate to the wrapped class instead of doing anything more fancy.
``````




---

archive/issue_comments_518320.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#26586\"",
    "created_at": "2018-12-13T19:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518320",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "" to "#26586"



---

archive/issue_comments_518321.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly\"",
    "created_at": "2018-12-13T21:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518321",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly"



---

archive/issue_comments_518322.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518322",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_518323.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[dc77918](https://github.com/sagemath/sagetrac-mirror/commit/dc77918a2fe3de5709d9c4a088b89775083b4970)|`Mark doctest as known bug`|\n|[8acc586](https://github.com/sagemath/sagetrac-mirror/commit/8acc5866ac55ba107b979bbaafa09c29bd17de7a)|`Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class`|",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518323",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                           |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[dc77918](https://github.com/sagemath/sagetrac-mirror/commit/dc77918a2fe3de5709d9c4a088b89775083b4970)|`Mark doctest as known bug`|
|[8acc586](https://github.com/sagemath/sagetrac-mirror/commit/8acc5866ac55ba107b979bbaafa09c29bd17de7a)|`Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class`|



---

archive/issue_comments_518324.json:
```json
{
    "body": "Changing commit from \"\" to \"8acc5866ac55ba107b979bbaafa09c29bd17de7a\"",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518324",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "8acc5866ac55ba107b979bbaafa09c29bd17de7a"



---

archive/issue_comments_518325.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2018-12-13T21:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518325",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_518326.json:
```json
{
    "body": "<a id='comment:5'></a>\nYou are changing the comparison logic a bit, in particular, comparisons between two wrapped classes no longer takes into account the parents. Since this is an extension class, it will not get subclassed when constructing elements; you've added an `isinstance` check that would also take care of if that happened as well. So we would get comparisons between objects that should not necessarily be treated as the same.\n\nFor a more concrete example, consider `(1,0)` as a **Z**-vector and `(1,0)` as a partition in an `2x2` box. These are (mathematically) incomparable objects, but your change would have them be equal. So at least the parent check should be added back in.\n\nMy recollection of why this was done this way was because we did not want the wrapped objects to have an ordering on them. However, I do not think there is any harm in inducing an ordering from the underlying objects. So the rest of your changes are fine with me.",
    "created_at": "2018-12-13T23:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518326",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
You are changing the comparison logic a bit, in particular, comparisons between two wrapped classes no longer takes into account the parents. Since this is an extension class, it will not get subclassed when constructing elements; you've added an `isinstance` check that would also take care of if that happened as well. So we would get comparisons between objects that should not necessarily be treated as the same.

For a more concrete example, consider `(1,0)` as a **Z**-vector and `(1,0)` as a partition in an `2x2` box. These are (mathematically) incomparable objects, but your change would have them be equal. So at least the parent check should be added back in.

My recollection of why this was done this way was because we did not want the wrapped objects to have an ordering on them. However, I do not think there is any harm in inducing an ordering from the underlying objects. So the rest of your changes are fine with me.



---

archive/issue_comments_518327.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-12-14T06:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518327",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_518328.json:
```json
{
    "body": "Changing commit from \"8acc5866ac55ba107b979bbaafa09c29bd17de7a\" to \"ada617424e2350b4842ae5bdb3c6404dda7c9887\"",
    "created_at": "2018-12-14T08:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8acc5866ac55ba107b979bbaafa09c29bd17de7a" to "ada617424e2350b4842ae5bdb3c6404dda7c9887"



---

archive/issue_comments_518329.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[ada6174](https://github.com/sagemath/sagetrac-mirror/commit/ada617424e2350b4842ae5bdb3c6404dda7c9887)|`Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class`|",
    "created_at": "2018-12-14T08:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[ada6174](https://github.com/sagemath/sagetrac-mirror/commit/ada617424e2350b4842ae5bdb3c6404dda7c9887)|`Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class`|



---

archive/issue_comments_518330.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[7c515f2](https://github.com/sagemath/sagetrac-mirror/commit/7c515f271abc7df392f6b4ea0c1347f2449fdcba)|`Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class`|",
    "created_at": "2018-12-14T08:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[7c515f2](https://github.com/sagemath/sagetrac-mirror/commit/7c515f271abc7df392f6b4ea0c1347f2449fdcba)|`Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class`|



---

archive/issue_comments_518331.json:
```json
{
    "body": "Changing commit from \"ada617424e2350b4842ae5bdb3c6404dda7c9887\" to \"7c515f271abc7df392f6b4ea0c1347f2449fdcba\"",
    "created_at": "2018-12-14T08:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "ada617424e2350b4842ae5bdb3c6404dda7c9887" to "7c515f271abc7df392f6b4ea0c1347f2449fdcba"



---

archive/issue_comments_518332.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-12-14T08:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518332",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_518333.json:
```json
{
    "body": "<a id='comment:10'></a>\nThere is one failure because of the fact that coercion is now taken into account. So we also need this change in `sage/combinat/root_system/extended_affine_weyl_group.py`:\n\n```diff\n     Note that for untwisted affine type the dual form of the classical Weyl group\n     is isomorphic to the usual one, but acts on a different lattice and is therefore different to sage::\n \n         sage: W0v = E.dual_classical_weyl(); W0v\n         Weyl Group of type ['A', 2] (as a matrix group acting on the weight lattice)\n         sage: v = W0v.from_reduced_word([1,2])\n         sage: x = PvW0(v); x\n         s1*s2\n         sage: y = PW0(v); y\n         s1*s2\n-        sage: x == y\n-        False\n         sage: x.parent() == y.parent()\n         False\n+\n+    However, because there is a coercion from ``PvW0`` to ``PW0``,\n+    the elements ``x`` and ``y`` compare as equal::\n+\n+        sage: x == y\n+        True\n+\n```\nOnce changed, you can set a positive review on my behalf.",
    "created_at": "2018-12-16T00:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518333",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
There is one failure because of the fact that coercion is now taken into account. So we also need this change in `sage/combinat/root_system/extended_affine_weyl_group.py`:

```diff
     Note that for untwisted affine type the dual form of the classical Weyl group
     is isomorphic to the usual one, but acts on a different lattice and is therefore different to sage::
 
         sage: W0v = E.dual_classical_weyl(); W0v
         Weyl Group of type ['A', 2] (as a matrix group acting on the weight lattice)
         sage: v = W0v.from_reduced_word([1,2])
         sage: x = PvW0(v); x
         s1*s2
         sage: y = PW0(v); y
         s1*s2
-        sage: x == y
-        False
         sage: x.parent() == y.parent()
         False
+
+    However, because there is a coercion from ``PvW0`` to ``PW0``,
+    the elements ``x`` and ``y`` compare as equal::
+
+        sage: x == y
+        True
+
```
Once changed, you can set a positive review on my behalf.



---

archive/issue_comments_518334.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-12-16T00:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518334",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_518335.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[8418f8e](https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e)|`Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class`|",
    "created_at": "2018-12-17T09:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[8418f8e](https://github.com/sagemath/sagetrac-mirror/commit/8418f8eea1a2bf57ac1ea6df31585eac00496a9e)|`Delegate comparisons for ElementWrapperCheckWrappedClass to wrapped class`|



---

archive/issue_comments_518336.json:
```json
{
    "body": "Changing commit from \"7c515f271abc7df392f6b4ea0c1347f2449fdcba\" to \"8418f8eea1a2bf57ac1ea6df31585eac00496a9e\"",
    "created_at": "2018-12-17T09:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7c515f271abc7df392f6b4ea0c1347f2449fdcba" to "8418f8eea1a2bf57ac1ea6df31585eac00496a9e"



---

archive/issue_comments_518337.json:
```json
{
    "body": "Changing dependencies from \"#26586\" to \"\"",
    "created_at": "2018-12-17T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518337",
    "user": "https://github.com/jdemeyer"
}
```

Changing dependencies from "#26586" to ""



---

archive/issue_comments_518338.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-17T09:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518338",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_518339.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Comparisons should just delegate to the wrapped class instead of doing anything more fancy.\n+Comparisons with the wrapped class should just delegate to the wrapped class, handling also inequalities instead of only `==` and `!=`.\n``````\n",
    "created_at": "2018-12-17T15:03:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518339",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Comparisons should just delegate to the wrapped class instead of doing anything more fancy.
+Comparisons with the wrapped class should just delegate to the wrapped class, handling also inequalities instead of only `==` and `!=`.
``````




---

archive/issue_comments_518340.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-23T23:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518340",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_075563.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-23T23:39:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26890#event-75563"
}
```



---

archive/issue_comments_518341.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly\" to \"8418f8eea1a2bf57ac1ea6df31585eac00496a9e\"",
    "created_at": "2018-12-23T23:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518341",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/elementwrappercheckwrappedclass_does_not_implement_comparison_properly" to "8418f8eea1a2bf57ac1ea6df31585eac00496a9e"



---

archive/issue_comments_518342.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis tickets were closed as fixed after the Sage 8.5 release.",
    "created_at": "2018-12-28T14:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26890#issuecomment-518342",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
This tickets were closed as fixed after the Sage 8.5 release.



---

archive/issue_events_075564.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:06:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26890",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26890#event-75564"
}
```
