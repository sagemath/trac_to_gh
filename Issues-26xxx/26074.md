# Issue 26074: Subcategories and base class for nilpotent Lie algebras

archive/issues_025837.json:
```json
{
    "body": "Implementation of subcategories for nilpotent, graded and stratified Lie algebras, and a base class and constructor for nilpotent Lie algebras mimicking `LieAlgebraWithStructureCoefficients`.\n\nCC:  @tscrim\n\nKeywords: Lie algebras, nilpotent, graded, stratified\n\nBranch/Commit: [120c02af8877a76a06590d6a06c414ff3e7e1167](https://github.com/sagemath/sagetrac-mirror/commit/120c02af8877a76a06590d6a06c414ff3e7e1167)\n\nReviewer: Travis Scrimshaw, Eero Hakavuori\n\nAuthor: Eero Hakavuori, Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26074\n\n",
    "closed_at": "2018-08-26T09:37:43Z",
    "created_at": "2018-08-16T16:05:22Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Subcategories and base class for nilpotent Lie algebras",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26074",
    "user": "https://github.com/ehaka"
}
```
Implementation of subcategories for nilpotent, graded and stratified Lie algebras, and a base class and constructor for nilpotent Lie algebras mimicking `LieAlgebraWithStructureCoefficients`.

CC:  @tscrim

Keywords: Lie algebras, nilpotent, graded, stratified

Branch/Commit: [120c02af8877a76a06590d6a06c414ff3e7e1167](https://github.com/sagemath/sagetrac-mirror/commit/120c02af8877a76a06590d6a06c414ff3e7e1167)

Reviewer: Travis Scrimshaw, Eero Hakavuori

Author: Eero Hakavuori, Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26074





---

archive/issue_comments_502810.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2018-08-16T16:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502810",
    "user": "https://github.com/ehaka"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_502811.json:
```json
{
    "body": "<a id='comment:1'></a>\nAn initial working copy of the implementation is in the commits. Whether the category framework was used correctly I do not know. In particular the distinction between axioms like `.Finite()` and covariant functorial constructions as in `sage.categories.graded_modules` to implement `.Graded()` was not clear to me.\n\nCurrently, based on my understanding of http://doc.sagemath.org/html/en/reference/categories/sage/categories/primer.html#difference-between-axioms-and-regressive-covariant-functorial-constructions, I added `Nilpotent` as an axiom and `Graded` and `Stratified` as covariant constructions. Comments on these choices or correction suggestions about how to use the category framework correctly are very welcome. As it is now, all the implemented methods seem to work as they should, but I do not know if some kind of mistake is lurking beneath the surface.\n\nMoreover, the examples are currently slightly hand-built (e.g. by forcing an extra category on a nilpotent Lie algebra constructor). The main issue that I do not how to solve is that even in the case when the e.g. the natural stratification can be deduced (as in the implementation of the `degree_on_basis` method in `sage.categories.graded_lie_algebras.FiniteDimensionalStratifiedLieAlgebrasWithBasis`) the easy construction to verify the extra properties uses the constructed object itself. That is, the correct category is very difficult to deduce until after the parent has been initialized, and computation with its elements is possible. How would one approach this kind of problem?\n\nAdditionally, as a minor tweak I added an extra parameter `submodule` to the `lower_central_series` method in `sage.categories.finite_dimensional_lie_algebras_with_basis` to compute the lower central series purely in terms of submodules as was already done in the `product_space` method. Otherwise the nilpotency testing would require implementing ideals or writing the already existing code again somewhere else.",
    "created_at": "2018-08-16T16:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502811",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:1'></a>
An initial working copy of the implementation is in the commits. Whether the category framework was used correctly I do not know. In particular the distinction between axioms like `.Finite()` and covariant functorial constructions as in `sage.categories.graded_modules` to implement `.Graded()` was not clear to me.

Currently, based on my understanding of http://doc.sagemath.org/html/en/reference/categories/sage/categories/primer.html#difference-between-axioms-and-regressive-covariant-functorial-constructions, I added `Nilpotent` as an axiom and `Graded` and `Stratified` as covariant constructions. Comments on these choices or correction suggestions about how to use the category framework correctly are very welcome. As it is now, all the implemented methods seem to work as they should, but I do not know if some kind of mistake is lurking beneath the surface.

Moreover, the examples are currently slightly hand-built (e.g. by forcing an extra category on a nilpotent Lie algebra constructor). The main issue that I do not how to solve is that even in the case when the e.g. the natural stratification can be deduced (as in the implementation of the `degree_on_basis` method in `sage.categories.graded_lie_algebras.FiniteDimensionalStratifiedLieAlgebrasWithBasis`) the easy construction to verify the extra properties uses the constructed object itself. That is, the correct category is very difficult to deduce until after the parent has been initialized, and computation with its elements is possible. How would one approach this kind of problem?

Additionally, as a minor tweak I added an extra parameter `submodule` to the `lower_central_series` method in `sage.categories.finite_dimensional_lie_algebras_with_basis` to compute the lower central series purely in terms of submodules as was already done in the `product_space` method. Otherwise the nilpotency testing would require implementing ideals or writing the already existing code again somewhere else.



---

archive/issue_comments_502812.json:
```json
{
    "body": "<a id='comment:2'></a>\nSo `Nilpotent` is definitely an axiom and `Graded` is definitely a functorial construction. Now for `Stratified`, I am not certain it is not an axiom. It is somewhat like `Connected` for Hopf algebras, an axiom that only makes sense in the `Graded` category. I think if we have a Lie algebra that is some axiom X and stratified, then it is an X stratified Lie algebra.\n\nMost of your implementation of the categories is good on a quick look-over. There are a few things that could be simplified that I can work on tomorrow to make the structures a little cleaner given the code that is currently in the categories. We can easily expand things out later if there is a use for them. I think the easiest way to explain things will be me making some commits with the changes with some comments here, but if you would rather me just give comments, then let me know.\n\nAs to realizing the correct category, there is a `_refine_category` method that you can call later once you have computed some properties. This is what `Zmod(p)` does:\n\n```\nsage: P = Zmod(5)\nsage: P.category()\nJoin of Category of finite commutative rings and Category of subquotients of monoids and Category of quotients of semigroups and Category of finite enumerated sets\nsage: P in Fields()\nTrue\nsage: P.category()\nJoin of Category of finite enumerated fields and Category of subquotients of monoids and Category of quotients of semigroups\n```\nI should caution that this has been known to cause issues in the past, but mostly because these get used as the base ring (and hence, parameterize the category) for other objects. Although for general purpose classes, I am inclined to force the user to ask for such a property (such as in the example above), which can include calling particular methods.\n\n+1 for the added option to `lower_central_series`. That is good for optimization purposes (e.g., if you only need the length of the central series).\n\nAs previously mentioned, I will take a detailed look tomorrow. I am assuming I can otherwise treat the code as needs review.",
    "created_at": "2018-08-17T10:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502812",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
So `Nilpotent` is definitely an axiom and `Graded` is definitely a functorial construction. Now for `Stratified`, I am not certain it is not an axiom. It is somewhat like `Connected` for Hopf algebras, an axiom that only makes sense in the `Graded` category. I think if we have a Lie algebra that is some axiom X and stratified, then it is an X stratified Lie algebra.

Most of your implementation of the categories is good on a quick look-over. There are a few things that could be simplified that I can work on tomorrow to make the structures a little cleaner given the code that is currently in the categories. We can easily expand things out later if there is a use for them. I think the easiest way to explain things will be me making some commits with the changes with some comments here, but if you would rather me just give comments, then let me know.

As to realizing the correct category, there is a `_refine_category` method that you can call later once you have computed some properties. This is what `Zmod(p)` does:

```
sage: P = Zmod(5)
sage: P.category()
Join of Category of finite commutative rings and Category of subquotients of monoids and Category of quotients of semigroups and Category of finite enumerated sets
sage: P in Fields()
True
sage: P.category()
Join of Category of finite enumerated fields and Category of subquotients of monoids and Category of quotients of semigroups
```
I should caution that this has been known to cause issues in the past, but mostly because these get used as the base ring (and hence, parameterize the category) for other objects. Although for general purpose classes, I am inclined to force the user to ask for such a property (such as in the example above), which can include calling particular methods.

+1 for the added option to `lower_central_series`. That is good for optimization purposes (e.g., if you only need the length of the central series).

As previously mentioned, I will take a detailed look tomorrow. I am assuming I can otherwise treat the code as needs review.



---

archive/issue_comments_502813.json:
```json
{
    "body": "<a id='comment:3'></a>\nFeel free to make any changes, I agree that it is much easier to understand things with something concrete to look at. The `Zmod` example is also very good to know, I did not know that categories do not necessarily have to be 'stable' post-initialization.\n\nYour final assumption is correct, other than my confusion about the categories, I would have classified the code as 'needs review'.",
    "created_at": "2018-08-17T13:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502813",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:3'></a>
Feel free to make any changes, I agree that it is much easier to understand things with something concrete to look at. The `Zmod` example is also very good to know, I did not know that categories do not necessarily have to be 'stable' post-initialization.

Your final assumption is correct, other than my confusion about the categories, I would have classified the code as 'needs review'.



---

archive/issue_comments_502814.json:
```json
{
    "body": "<a id='comment:4'></a>\nI have made it through and reworked the categories around a bit, but it is more in line with what should be done (at least as I have learned it). As some extra test cases, I made the Heisenberg Lie algebra(s) in the nilpotent category.\n\nI have done a few other tweaks to the doc and code, including fixing some other cases for `product_space(submodule=True)` exposed by the matrix Heisenberg Lie algebra. I am not sure about the separate `NilpotentLieAlgebra` constructor as I feel like we should have a way to connect it with the general `LieAlgebra` constructor, perhaps via a `nilpotent=True` argument. That way we have fewer top-level entry points and gives better exposure to the user. I am also okay pushing that off to a later ticket, but I'd like to hear your thoughts on the matter.\n\nHopefully these changes (currently) will not cause you too many refactoring problems with later tickets.\n\n---\nNew commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[a571c1b](https://github.com/sagemath/sagetrac-mirror/commit/a571c1bacac224d727ce67f01248791aa49e1fad)|`Reworking things in the categories.`|\n|[9b6c1fe](https://github.com/sagemath/sagetrac-mirror/commit/9b6c1fe8946b1efdb2fd10094cca657cbf444a01)|`Adding Heisenberg to nilpotent Lie algebras.`|\n|[158bfdb](https://github.com/sagemath/sagetrac-mirror/commit/158bfdbfd8ed4c2afa660ff86cbb0fe2fbc54db0)|`Fix to product_space() for when L is not a true subalgebra of A.`|\n|[293901e](https://github.com/sagemath/sagetrac-mirror/commit/293901e306fb90a5bd43b35571c9b36bc0025df6)|`Fixed a test for _test_generated_by_degree_one().`|\n|[8658e9d](https://github.com/sagemath/sagetrac-mirror/commit/8658e9d059f2d457de1a747068e8c5b37f27f338)|`Fixing print order for fin-dim nilpotent Lie algebras with basis.`|\n|[726639f](https://github.com/sagemath/sagetrac-mirror/commit/726639fdd3518ea8a9dd0df3c4f708da5ead7dcc)|`Some last little cleanup.`|\n|[8b3c585](https://github.com/sagemath/sagetrac-mirror/commit/8b3c58560a44a449d4757c72c5d5e81ef5fef723)|`A better failure example for _test_generated_by_degree_one and some more doc.`|",
    "created_at": "2018-08-21T00:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502814",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
I have made it through and reworked the categories around a bit, but it is more in line with what should be done (at least as I have learned it). As some extra test cases, I made the Heisenberg Lie algebra(s) in the nilpotent category.

I have done a few other tweaks to the doc and code, including fixing some other cases for `product_space(submodule=True)` exposed by the matrix Heisenberg Lie algebra. I am not sure about the separate `NilpotentLieAlgebra` constructor as I feel like we should have a way to connect it with the general `LieAlgebra` constructor, perhaps via a `nilpotent=True` argument. That way we have fewer top-level entry points and gives better exposure to the user. I am also okay pushing that off to a later ticket, but I'd like to hear your thoughts on the matter.

Hopefully these changes (currently) will not cause you too many refactoring problems with later tickets.

---
New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[a571c1b](https://github.com/sagemath/sagetrac-mirror/commit/a571c1bacac224d727ce67f01248791aa49e1fad)|`Reworking things in the categories.`|
|[9b6c1fe](https://github.com/sagemath/sagetrac-mirror/commit/9b6c1fe8946b1efdb2fd10094cca657cbf444a01)|`Adding Heisenberg to nilpotent Lie algebras.`|
|[158bfdb](https://github.com/sagemath/sagetrac-mirror/commit/158bfdbfd8ed4c2afa660ff86cbb0fe2fbc54db0)|`Fix to product_space() for when L is not a true subalgebra of A.`|
|[293901e](https://github.com/sagemath/sagetrac-mirror/commit/293901e306fb90a5bd43b35571c9b36bc0025df6)|`Fixed a test for _test_generated_by_degree_one().`|
|[8658e9d](https://github.com/sagemath/sagetrac-mirror/commit/8658e9d059f2d457de1a747068e8c5b37f27f338)|`Fixing print order for fin-dim nilpotent Lie algebras with basis.`|
|[726639f](https://github.com/sagemath/sagetrac-mirror/commit/726639fdd3518ea8a9dd0df3c4f708da5ead7dcc)|`Some last little cleanup.`|
|[8b3c585](https://github.com/sagemath/sagetrac-mirror/commit/8b3c58560a44a449d4757c72c5d5e81ef5fef723)|`A better failure example for _test_generated_by_degree_one and some more doc.`|



---

archive/issue_comments_502815.json:
```json
{
    "body": "Changing branch from \"u/gh-ehaka/nilpotent_lie_algebras\" to \"public/lie_algebras/base_class_nilponent-26074\"",
    "created_at": "2018-08-21T00:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502815",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/gh-ehaka/nilpotent_lie_algebras" to "public/lie_algebras/base_class_nilponent-26074"



---

archive/issue_comments_502816.json:
```json
{
    "body": "Changing author from \"Eero Hakavuori\" to \"Eero Hakavuori, Travis Scrimshaw\"",
    "created_at": "2018-08-21T00:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502816",
    "user": "https://github.com/tscrim"
}
```

Changing author from "Eero Hakavuori" to "Eero Hakavuori, Travis Scrimshaw"



---

archive/issue_comments_502817.json:
```json
{
    "body": "Changing commit from \"19c27ebb9f0952df7ab9e607a94574f6b8d1c5cf\" to \"8b3c58560a44a449d4757c72c5d5e81ef5fef723\"",
    "created_at": "2018-08-21T00:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502817",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "19c27ebb9f0952df7ab9e607a94574f6b8d1c5cf" to "8b3c58560a44a449d4757c72c5d5e81ef5fef723"



---

archive/issue_comments_502818.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-08-21T00:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502818",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_502819.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw, Eero Hakavuori\"",
    "created_at": "2018-08-21T00:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502819",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw, Eero Hakavuori"



---

archive/issue_comments_502820.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks for the improvements, looks quite good to me. Probably you are right about the `NilpotentLieAlgebra` constructor that the logic would be better inside `LieAlgebra` instead. It would also make sense to include in this ticket I think.\n\nI noticed in the edits the `extra_super_categories` of finite dimensional stratified Lie algebras with basis got dropped. Currently we have for example\n\n```\nsage: C = LieAlgebras(QQ).FiniteDimensional().WithBasis().Graded().Stratified()\nsage: C is C.Nilpotent()\nFalse\n```\nwhereas mathematically this should be True. Then again this does not really depend on the basis, so if I understand correctly, the right place to add the `extra_super_categories` would be in `GradedLieAlgebras.Stratified` with an 'if finite dimensional' clause.\nI will add this and move the `NilpotentLieAlgebra` constructor inside `LieAlgebra` later today.\n\nRegarding the text presentation of the categories, the automatic printing is a bit cumbersome:\n\n```\nsage: LieAlgebras(QQ).FiniteDimensional().WithBasis().Graded().Stratified().Nilpotent()\nCategory of finite dimensional stratified nilpotent graded lie algebras with basis over Rational Field\n```\nIt makes sense to have `Stratified` as an axiom under `Graded`, but the automatic terminology 'stratified graded' or 'stratified X graded' sounds clunky. Would it be valid to replace 'stratified graded' with just 'stratified'? If so, what would be the most convenient way to systematically make this change for all axiom permutations?",
    "created_at": "2018-08-21T09:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502820",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:5'></a>
Thanks for the improvements, looks quite good to me. Probably you are right about the `NilpotentLieAlgebra` constructor that the logic would be better inside `LieAlgebra` instead. It would also make sense to include in this ticket I think.

I noticed in the edits the `extra_super_categories` of finite dimensional stratified Lie algebras with basis got dropped. Currently we have for example

```
sage: C = LieAlgebras(QQ).FiniteDimensional().WithBasis().Graded().Stratified()
sage: C is C.Nilpotent()
False
```
whereas mathematically this should be True. Then again this does not really depend on the basis, so if I understand correctly, the right place to add the `extra_super_categories` would be in `GradedLieAlgebras.Stratified` with an 'if finite dimensional' clause.
I will add this and move the `NilpotentLieAlgebra` constructor inside `LieAlgebra` later today.

Regarding the text presentation of the categories, the automatic printing is a bit cumbersome:

```
sage: LieAlgebras(QQ).FiniteDimensional().WithBasis().Graded().Stratified().Nilpotent()
Category of finite dimensional stratified nilpotent graded lie algebras with basis over Rational Field
```
It makes sense to have `Stratified` as an axiom under `Graded`, but the automatic terminology 'stratified graded' or 'stratified X graded' sounds clunky. Would it be valid to replace 'stratified graded' with just 'stratified'? If so, what would be the most convenient way to systematically make this change for all axiom permutations?



---

archive/issue_comments_502821.json:
```json
{
    "body": "<a id='comment:6'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[a1e1ace](https://github.com/sagemath/sagetrac-mirror/commit/a1e1ace42fb1bd26ca7ebbdebc640ea4f7361520)|`Refactored nilpotent Lie algebra constructor into Lie algebra constructor`|\n|[14fcd30](https://github.com/sagemath/sagetrac-mirror/commit/14fcd30d1908bb3ce743a8b625467c498bbb2c98)|`Deduction rule for the fact that finite dimensional stratified Lie algebras are nilpotent`|\n|[f1a0b1e](https://github.com/sagemath/sagetrac-mirror/commit/f1a0b1ede04fd5e24772ad9550a2467db171d6f9)|`Docstring fix for indexing of grading of a stratification`|",
    "created_at": "2018-08-21T15:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[a1e1ace](https://github.com/sagemath/sagetrac-mirror/commit/a1e1ace42fb1bd26ca7ebbdebc640ea4f7361520)|`Refactored nilpotent Lie algebra constructor into Lie algebra constructor`|
|[14fcd30](https://github.com/sagemath/sagetrac-mirror/commit/14fcd30d1908bb3ce743a8b625467c498bbb2c98)|`Deduction rule for the fact that finite dimensional stratified Lie algebras are nilpotent`|
|[f1a0b1e](https://github.com/sagemath/sagetrac-mirror/commit/f1a0b1ede04fd5e24772ad9550a2467db171d6f9)|`Docstring fix for indexing of grading of a stratification`|



---

archive/issue_comments_502822.json:
```json
{
    "body": "Changing commit from \"8b3c58560a44a449d4757c72c5d5e81ef5fef723\" to \"f1a0b1ede04fd5e24772ad9550a2467db171d6f9\"",
    "created_at": "2018-08-21T15:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8b3c58560a44a449d4757c72c5d5e81ef5fef723" to "f1a0b1ede04fd5e24772ad9550a2467db171d6f9"



---

archive/issue_comments_502823.json:
```json
{
    "body": "<a id='comment:7'></a>\nI removed the `NilpotentLieAlgebra` constructor and inserted the logic into `LieAlgebra` adding a new boolean parameter `nilpotent`, which currently only comes into play if the constructor is passed a dictionary of structural coefficients.\n\nI added the 'finite dimensional + stratified => nilpotent' deduction to `GradedLieAlgebras.Stratified.FiniteDimensional`. At least now the following works\n\n```\nsage: C = LieAlgebras(QQ).FiniteDimensional().Graded().Stratified()\nsage: C is C.Nilpotent()\nTrue\n```\nand it didn't break the existing deduction\n\n```\nsage: C = LieAlgebras(GF(5)).Graded().Stratified().FiniteDimensional()\nsage: C.is_subcategory(Sets().Finite())\nTrue\n```\nso I assume adding the `FiniteDimensional` subclass didn't break anything.\n\nI also fixed some doctests in `sage.algebras.lie_algebras.LieAlgebra` that were failing since I added the nilpotent category to abelian Lie algebras.",
    "created_at": "2018-08-21T15:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502823",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:7'></a>
I removed the `NilpotentLieAlgebra` constructor and inserted the logic into `LieAlgebra` adding a new boolean parameter `nilpotent`, which currently only comes into play if the constructor is passed a dictionary of structural coefficients.

I added the 'finite dimensional + stratified => nilpotent' deduction to `GradedLieAlgebras.Stratified.FiniteDimensional`. At least now the following works

```
sage: C = LieAlgebras(QQ).FiniteDimensional().Graded().Stratified()
sage: C is C.Nilpotent()
True
```
and it didn't break the existing deduction

```
sage: C = LieAlgebras(GF(5)).Graded().Stratified().FiniteDimensional()
sage: C.is_subcategory(Sets().Finite())
True
```
so I assume adding the `FiniteDimensional` subclass didn't break anything.

I also fixed some doctests in `sage.algebras.lie_algebras.LieAlgebra` that were failing since I added the nilpotent category to abelian Lie algebras.



---

archive/issue_comments_502824.json:
```json
{
    "body": "Changing commit from \"f1a0b1ede04fd5e24772ad9550a2467db171d6f9\" to \"0fa41adae20fd16a97587a542c3ee4c9781d20ee\"",
    "created_at": "2018-08-22T03:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f1a0b1ede04fd5e24772ad9550a2467db171d6f9" to "0fa41adae20fd16a97587a542c3ee4c9781d20ee"



---

archive/issue_comments_502825.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|\n|[a3dccfd](https://github.com/sagemath/sagetrac-mirror/commit/a3dccfda64d58af8fe6bd5c564f3a4d8304ecf23)|`Merge branch 'public/lie_algebras/base_class_nilponent-26074' of git://trac.sagemath.org/sage into public/lie_algebras/base_class_nilponent-26074`|\n|[0fa41ad](https://github.com/sagemath/sagetrac-mirror/commit/0fa41adae20fd16a97587a542c3ee4c9781d20ee)|`Fixing doctests, making category an arugment, and other small tweaks.`|",
    "created_at": "2018-08-22T03:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
|[a3dccfd](https://github.com/sagemath/sagetrac-mirror/commit/a3dccfda64d58af8fe6bd5c564f3a4d8304ecf23)|`Merge branch 'public/lie_algebras/base_class_nilponent-26074' of git://trac.sagemath.org/sage into public/lie_algebras/base_class_nilponent-26074`|
|[0fa41ad](https://github.com/sagemath/sagetrac-mirror/commit/0fa41adae20fd16a97587a542c3ee4c9781d20ee)|`Fixing doctests, making category an arugment, and other small tweaks.`|



---

archive/issue_comments_502826.json:
```json
{
    "body": "Changing commit from \"0fa41adae20fd16a97587a542c3ee4c9781d20ee\" to \"53a10be657d3ea6dfeb3373b762f4d8645047b97\"",
    "created_at": "2018-08-22T03:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0fa41adae20fd16a97587a542c3ee4c9781d20ee" to "53a10be657d3ea6dfeb3373b762f4d8645047b97"



---

archive/issue_comments_502827.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[53a10be](https://github.com/sagemath/sagetrac-mirror/commit/53a10be657d3ea6dfeb3373b762f4d8645047b97)|`Adding an extra doctest and fix for the category option.`|",
    "created_at": "2018-08-22T03:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[53a10be](https://github.com/sagemath/sagetrac-mirror/commit/53a10be657d3ea6dfeb3373b762f4d8645047b97)|`Adding an extra doctest and fix for the category option.`|



---

archive/issue_comments_502828.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [gh-ehaka](#comment%3A7):\n> I removed the `NilpotentLieAlgebra` constructor and inserted the logic into `LieAlgebra` adding a new boolean parameter `nilpotent`, which currently only comes into play if the constructor is passed a dictionary of structural coefficients.\n\n\nThank you. Looks good. I added an extra option so that when given `NilpotentLieAlgebras` as a category, then it automatically considers `nilpotent=True`.\n\n> I added the 'finite dimensional + stratified => nilpotent' deduction to `GradedLieAlgebras.Stratified.FiniteDimensional`. At least now the following works\n\n\nSorry about loosing that. Yes, this is the correct way to do it.\n\n> I also fixed some doctests in `sage.algebras.lie_algebras.LieAlgebra` that were failing since I added the nilpotent category to abelian Lie algebras.\n\n\nI fixed two others that were coming back from the patchbot.\n\nI know the text representation of the category is not very good. I will see if I can make it better (I think you can, but I need to dig around a little and experiment), but beyond that, I am happy with things here.",
    "created_at": "2018-08-22T03:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502828",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
Replying to [gh-ehaka](#comment%3A7):
> I removed the `NilpotentLieAlgebra` constructor and inserted the logic into `LieAlgebra` adding a new boolean parameter `nilpotent`, which currently only comes into play if the constructor is passed a dictionary of structural coefficients.


Thank you. Looks good. I added an extra option so that when given `NilpotentLieAlgebras` as a category, then it automatically considers `nilpotent=True`.

> I added the 'finite dimensional + stratified => nilpotent' deduction to `GradedLieAlgebras.Stratified.FiniteDimensional`. At least now the following works


Sorry about loosing that. Yes, this is the correct way to do it.

> I also fixed some doctests in `sage.algebras.lie_algebras.LieAlgebra` that were failing since I added the nilpotent category to abelian Lie algebras.


I fixed two others that were coming back from the patchbot.

I know the text representation of the category is not very good. I will see if I can make it better (I think you can, but I need to dig around a little and experiment), but beyond that, I am happy with things here.



---

archive/issue_comments_502829.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe edits all look good to me. I would be ok with marking this as positive review and handling the category repr improvements eventually in a later ticket as it is only a cosmetic fix.",
    "created_at": "2018-08-22T04:38:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502829",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:11'></a>
The edits all look good to me. I would be ok with marking this as positive review and handling the category repr improvements eventually in a later ticket as it is only a cosmetic fix.



---

archive/issue_comments_502830.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[a5ec3ad](https://github.com/sagemath/sagetrac-mirror/commit/a5ec3adf73a86bd3e2175be25c47966a85d08f13)|`Moving the axioms around for better printing.`|",
    "created_at": "2018-08-22T05:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502830",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[a5ec3ad](https://github.com/sagemath/sagetrac-mirror/commit/a5ec3adf73a86bd3e2175be25c47966a85d08f13)|`Moving the axioms around for better printing.`|



---

archive/issue_comments_502831.json:
```json
{
    "body": "Changing commit from \"53a10be657d3ea6dfeb3373b762f4d8645047b97\" to \"a5ec3adf73a86bd3e2175be25c47966a85d08f13\"",
    "created_at": "2018-08-22T05:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "53a10be657d3ea6dfeb3373b762f4d8645047b97" to "a5ec3adf73a86bd3e2175be25c47966a85d08f13"



---

archive/issue_comments_502832.json:
```json
{
    "body": "<a id='comment:13'></a>\nHere is the improvements to the category repr. The \"stratified graded\" -> \"stratified\" was a standard(ish) workaround. Removing the \"nilpotent\" was a bit more work, but mainly because we do not want to say \"nilpotent finite dimensional Lie algebras\". However, it falls under the same workaround as the other. So if these last changes are good, then positive review.",
    "created_at": "2018-08-22T05:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502832",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Here is the improvements to the category repr. The "stratified graded" -> "stratified" was a standard(ish) workaround. Removing the "nilpotent" was a bit more work, but mainly because we do not want to say "nilpotent finite dimensional Lie algebras". However, it falls under the same workaround as the other. So if these last changes are good, then positive review.



---

archive/issue_comments_502833.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [tscrim](#comment%3A13):\n> Here is the improvements to the category repr. The \"stratified graded\" -> \"stratified\" was a standard(ish) workaround. Removing the \"nilpotent\" was a bit more work, but mainly because we do not want to say \"nilpotent finite dimensional Lie algebras\". However, it falls under the same workaround as the other. So if these last changes are good, then positive review.\n\n\nVery nice! The various combinations of finite dimensional, graded, stratified and nilpotent all printed quite well now in my opinion.",
    "created_at": "2018-08-22T05:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502833",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:14'></a>
Replying to [tscrim](#comment%3A13):
> Here is the improvements to the category repr. The "stratified graded" -> "stratified" was a standard(ish) workaround. Removing the "nilpotent" was a bit more work, but mainly because we do not want to say "nilpotent finite dimensional Lie algebras". However, it falls under the same workaround as the other. So if these last changes are good, then positive review.


Very nice! The various combinations of finite dimensional, graded, stratified and nilpotent all printed quite well now in my opinion.



---

archive/issue_comments_502834.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-22T05:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502834",
    "user": "https://github.com/ehaka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_502835.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-08-22T19:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_502836.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                           |                                                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|\n|[8f7aac5](https://github.com/sagemath/sagetrac-mirror/commit/8f7aac54ad2479eb6f4044643043aae48e5093f7)|`Added missing files to documentation, removed non-existent one that was causing docbuild to fail`|",
    "created_at": "2018-08-22T19:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                           |                                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------|
|[8f7aac5](https://github.com/sagemath/sagetrac-mirror/commit/8f7aac54ad2479eb6f4044643043aae48e5093f7)|`Added missing files to documentation, removed non-existent one that was causing docbuild to fail`|



---

archive/issue_comments_502837.json:
```json
{
    "body": "Changing commit from \"a5ec3adf73a86bd3e2175be25c47966a85d08f13\" to \"8f7aac54ad2479eb6f4044643043aae48e5093f7\"",
    "created_at": "2018-08-22T19:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502837",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a5ec3adf73a86bd3e2175be25c47966a85d08f13" to "8f7aac54ad2479eb6f4044643043aae48e5093f7"



---

archive/issue_comments_502838.json:
```json
{
    "body": "<a id='comment:16'></a>\nDocbuild was failing because of the non-existent module `sage/categories/examples/finite_dimensional_nilpotent_lie_algebras_with_basis` which I assume was meant to be `sage/categories/finite...` as that link was missing. Also added the `nilpotent_lie_algebra` link to the Lie algebra index and corrected a typo that was causing the documentation to display strangely.\n\nI'll leave the ticket as needs review until it is verified that the doc changes were correct as I have not tried to modify the automatic html reference before.",
    "created_at": "2018-08-22T19:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502838",
    "user": "https://github.com/ehaka"
}
```

<a id='comment:16'></a>
Docbuild was failing because of the non-existent module `sage/categories/examples/finite_dimensional_nilpotent_lie_algebras_with_basis` which I assume was meant to be `sage/categories/finite...` as that link was missing. Also added the `nilpotent_lie_algebra` link to the Lie algebra index and corrected a typo that was causing the documentation to display strangely.

I'll leave the ticket as needs review until it is verified that the doc changes were correct as I have not tried to modify the automatic html reference before.



---

archive/issue_comments_502839.json:
```json
{
    "body": "Changing commit from \"8f7aac54ad2479eb6f4044643043aae48e5093f7\" to \"120c02af8877a76a06590d6a06c414ff3e7e1167\"",
    "created_at": "2018-08-22T22:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8f7aac54ad2479eb6f4044643043aae48e5093f7" to "120c02af8877a76a06590d6a06c414ff3e7e1167"



---

archive/issue_comments_502840.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[120c02a](https://github.com/sagemath/sagetrac-mirror/commit/120c02af8877a76a06590d6a06c414ff3e7e1167)|`Some trivial fixes.`|",
    "created_at": "2018-08-22T22:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[120c02a](https://github.com/sagemath/sagetrac-mirror/commit/120c02af8877a76a06590d6a06c414ff3e7e1167)|`Some trivial fixes.`|



---

archive/issue_comments_502841.json:
```json
{
    "body": "<a id='comment:18'></a>\nYep, LGTM. Thank you for catching and fixing that. I made some trivial changes and am allowing myself to set this to a positive review (I changed the V<sub>k</sub> to L<sub>k</sub> to be consistent notationally; feel free to revert the positive review if you disagree).",
    "created_at": "2018-08-22T22:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502841",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
Yep, LGTM. Thank you for catching and fixing that. I made some trivial changes and am allowing myself to set this to a positive review (I changed the V<sub>k</sub> to L<sub>k</sub> to be consistent notationally; feel free to revert the positive review if you disagree).



---

archive/issue_comments_502842.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-22T22:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502842",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_502843.json:
```json
{
    "body": "Changing branch from \"public/lie_algebras/base_class_nilponent-26074\" to \"120c02af8877a76a06590d6a06c414ff3e7e1167\"",
    "created_at": "2018-08-26T09:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502843",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/lie_algebras/base_class_nilponent-26074" to "120c02af8877a76a06590d6a06c414ff3e7e1167"



---

archive/issue_events_073960.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-26T09:37:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26074#event-73960"
}
```



---

archive/issue_comments_502844.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-26T09:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26074",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26074#issuecomment-502844",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
