# Issue 26933: Subsets_s should support unsortable sets

archive/issues_026696.json:
```json
{
    "body": "It should not force sorting the set, which may be unsortable.\n\nCC:  @fchapoton\n\nBranch/Commit: dba4c44db4b8160952877452f5f8d74824e5a971\n\nReviewer: Travis Scrimshaw\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26933\n\n",
    "closed_at": "2019-01-23T14:17:43Z",
    "created_at": "2018-12-21T14:52:54Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Subsets_s should support unsortable sets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26933",
    "user": "https://github.com/jdemeyer"
}
```
It should not force sorting the set, which may be unsortable.

CC:  @fchapoton

Branch/Commit: dba4c44db4b8160952877452f5f8d74824e5a971

Reviewer: Travis Scrimshaw

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26933





---

archive/issue_comments_517657.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/subsets_s_should_support_unsortable_sets\"",
    "created_at": "2018-12-21T15:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517657",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/subsets_s_should_support_unsortable_sets"



---

archive/issue_comments_517658.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-21T15:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517658",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_517659.json:
```json
{
    "body": "Changing commit from \"\" to \"3930c20b0d41c87f5b7ebc5c1ffd07bfcbb18832\"",
    "created_at": "2018-12-21T15:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517659",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "" to "3930c20b0d41c87f5b7ebc5c1ffd07bfcbb18832"



---

archive/issue_comments_517660.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[3930c20](https://git.sagemath.org/sage.git/commit?id=3930c20b0d41c87f5b7ebc5c1ffd07bfcbb18832)|`Do not sort in Subsets_s`|",
    "created_at": "2018-12-21T15:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517660",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[3930c20](https://git.sagemath.org/sage.git/commit?id=3930c20b0d41c87f5b7ebc5c1ffd07bfcbb18832)|`Do not sort in Subsets_s`|



---

archive/issue_comments_517661.json:
```json
{
    "body": "Changing commit from \"3930c20b0d41c87f5b7ebc5c1ffd07bfcbb18832\" to \"947cb4d3651b6540f51267cd5ccde7b45e55a118\"",
    "created_at": "2019-01-01T10:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517661",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3930c20b0d41c87f5b7ebc5c1ffd07bfcbb18832" to "947cb4d3651b6540f51267cd5ccde7b45e55a118"



---

archive/issue_comments_517662.json:
```json
{
    "body": "<a id='comment:3'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[947cb4d](https://git.sagemath.org/sage.git/commit/?id=947cb4d3651b6540f51267cd5ccde7b45e55a118)|`Do not sort in Subsets_s`|",
    "created_at": "2019-01-01T10:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517662",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[947cb4d](https://git.sagemath.org/sage.git/commit/?id=947cb4d3651b6540f51267cd5ccde7b45e55a118)|`Do not sort in Subsets_s`|



---

archive/issue_comments_517663.json:
```json
{
    "body": "<a id='comment:4'></a>\nI wonder whether it is really worth the trouble (and performance hit) to keep the order of the ground set.\n\n```\nsage: S = [1, 8, -5, 3/2, 'a', x]\nsage: import random\nsage: L = [choice(S) for _ in range(10000)]\nsage: %timeit list(set(L))\n1000 loops, best of 3: 708 \u00b5s per loop\nsage: %timeit list(stable_uniq(L))\n1000 loops, best of 3: 1.4 ms per loop\n```\n\n(Currently, essentially all the time in `Subsets_s.__init__` is spent in `uniq`.)",
    "created_at": "2019-01-01T11:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517663",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:4'></a>
I wonder whether it is really worth the trouble (and performance hit) to keep the order of the ground set.

```
sage: S = [1, 8, -5, 3/2, 'a', x]
sage: import random
sage: L = [choice(S) for _ in range(10000)]
sage: %timeit list(set(L))
1000 loops, best of 3: 708 Âµs per loop
sage: %timeit list(stable_uniq(L))
1000 loops, best of 3: 1.4 ms per loop
```

(Currently, essentially all the time in `Subsets_s.__init__` is spent in `uniq`.)



---

archive/issue_comments_517664.json:
```json
{
    "body": "<a id='comment:5'></a>\nIt is not really fair to compare a builtin Python class `set` to a (pure) Python function. So the fact it is a 2x slowdown on a set that large is quite good IMO. It is a nice side-effect that the order of the groundset is preserved, but that looks like it is a facet of the (simple) implementation. This is also not the tool you should be using in a tight loop anyways, so I am not worried about the slowdown here. Thus I am giving this a positive review.",
    "created_at": "2019-01-01T17:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517664",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
It is not really fair to compare a builtin Python class `set` to a (pure) Python function. So the fact it is a 2x slowdown on a set that large is quite good IMO. It is a nice side-effect that the order of the groundset is preserved, but that looks like it is a facet of the (simple) implementation. This is also not the tool you should be using in a tight loop anyways, so I am not worried about the slowdown here. Thus I am giving this a positive review.



---

archive/issue_comments_517665.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2019-01-01T17:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517665",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_517666.json:
```json
{
    "body": "<a id='comment:6'></a>\nfine with me, too!",
    "created_at": "2019-01-01T17:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517666",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:6'></a>
fine with me, too!



---

archive/issue_comments_517667.json:
```json
{
    "body": "<a id='comment:7'></a>\nTravis, I think you forgot to set the flag to \"positive\".",
    "created_at": "2019-01-01T19:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517667",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:7'></a>
Travis, I think you forgot to set the flag to "positive".



---

archive/issue_comments_517668.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-01T19:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517668",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_517669.json:
```json
{
    "body": "<a id='comment:9'></a>\nI just realized something... the existing `uniq(X)` really just does `sorted(set(X))`. It seems a bit silly to write a function just for that and one can also wonder if the sorting is the right thing to do in general.\n\nSo I suggest that this new `stable_uniq` would *replace* `uniq`. Of course, a deprecation period is needed for that. So I'd rather use a private name like `_stable_uniq` for now.",
    "created_at": "2019-01-02T22:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517669",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
I just realized something... the existing `uniq(X)` really just does `sorted(set(X))`. It seems a bit silly to write a function just for that and one can also wonder if the sorting is the right thing to do in general.

So I suggest that this new `stable_uniq` would *replace* `uniq`. Of course, a deprecation period is needed for that. So I'd rather use a private name like `_stable_uniq` for now.



---

archive/issue_comments_517670.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-02T22:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517670",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_517671.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|\n|[a86962c](https://git.sagemath.org/sage.git/commit/?id=a86962c1ef260b3014aec08e78d6f27fdbe15bab)|`Make _stable_uniq private`|",
    "created_at": "2019-01-02T22:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517671",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|[a86962c](https://git.sagemath.org/sage.git/commit/?id=a86962c1ef260b3014aec08e78d6f27fdbe15bab)|`Make _stable_uniq private`|



---

archive/issue_comments_517672.json:
```json
{
    "body": "Changing commit from \"947cb4d3651b6540f51267cd5ccde7b45e55a118\" to \"a86962c1ef260b3014aec08e78d6f27fdbe15bab\"",
    "created_at": "2019-01-02T22:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517672",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "947cb4d3651b6540f51267cd5ccde7b45e55a118" to "a86962c1ef260b3014aec08e78d6f27fdbe15bab"



---

archive/issue_comments_517673.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-02T22:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517673",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_517674.json:
```json
{
    "body": "<a id='comment:12'></a>\nThat is good with me.",
    "created_at": "2019-01-03T05:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517674",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
That is good with me.



---

archive/issue_comments_517675.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-03T05:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517675",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_517676.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-01-04T09:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517676",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_517677.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[0d45f46](https://git.sagemath.org/sage.git/commit/?id=0d45f468b327bc68ece38c98595836e463c60e48)|`Do not sort in Subsets_s`|\n|[dba4c44](https://git.sagemath.org/sage.git/commit/?id=dba4c44db4b8160952877452f5f8d74824e5a971)|`Make _stable_uniq private`|",
    "created_at": "2019-01-04T09:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517677",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[0d45f46](https://git.sagemath.org/sage.git/commit/?id=0d45f468b327bc68ece38c98595836e463c60e48)|`Do not sort in Subsets_s`|
|[dba4c44](https://git.sagemath.org/sage.git/commit/?id=dba4c44db4b8160952877452f5f8d74824e5a971)|`Make _stable_uniq private`|



---

archive/issue_comments_517678.json:
```json
{
    "body": "Changing commit from \"a86962c1ef260b3014aec08e78d6f27fdbe15bab\" to \"dba4c44db4b8160952877452f5f8d74824e5a971\"",
    "created_at": "2019-01-04T09:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517678",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a86962c1ef260b3014aec08e78d6f27fdbe15bab" to "dba4c44db4b8160952877452f5f8d74824e5a971"



---

archive/issue_comments_517679.json:
```json
{
    "body": "<a id='comment:14'></a>\nTrivial rebase to 8.6.rc0",
    "created_at": "2019-01-04T09:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517679",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Trivial rebase to 8.6.rc0



---

archive/issue_comments_517680.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-04T09:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517680",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_066709.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26933#event-66709"
}
```



---

archive/issue_comments_517681.json:
```json
{
    "body": "<a id='comment:15'></a>\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517681",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_517682.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/subsets_s_should_support_unsortable_sets\" to \"dba4c44db4b8160952877452f5f8d74824e5a971\"",
    "created_at": "2019-01-23T14:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517682",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/subsets_s_should_support_unsortable_sets" to "dba4c44db4b8160952877452f5f8d74824e5a971"



---

archive/issue_comments_517683.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-23T14:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26933#issuecomment-517683",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_066710.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T14:17:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26933",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26933#event-66710"
}
```
