# Issue 26628: py3: some fixes for sandpiles tutorial

archive/issues_026391.json:
```json
{
    "body": "namely simple changes of notation for the sink vertex\n\nThis decreases strongly the number of failing doctests under py3 in this file.\n\n**CC:**  @tscrim @vinklein\n\n**Branch/Commit:** [8ee90c7e421565e6ecd98fd2b79f2589b01f7e41](https://github.com/sagemath/sagetrac-mirror/commit/8ee90c7e421565e6ecd98fd2b79f2589b01f7e41)\n\n**Reviewer:** Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, Erik Bray\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26628\n\n",
    "closed_at": "2019-01-24T18:17:58Z",
    "created_at": "2018-11-03T18:11:56Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "py3: some fixes for sandpiles tutorial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26628",
    "user": "https://github.com/fchapoton"
}
```
namely simple changes of notation for the sink vertex

This decreases strongly the number of failing doctests under py3 in this file.

**CC:**  @tscrim @vinklein

**Branch/Commit:** [8ee90c7e421565e6ecd98fd2b79f2589b01f7e41](https://github.com/sagemath/sagetrac-mirror/commit/8ee90c7e421565e6ecd98fd2b79f2589b01f7e41)

**Reviewer:** Travis Scrimshaw, Frédéric Chapoton

**Author:** Frédéric Chapoton, Erik Bray

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/26628





---

archive/issue_comments_513546.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-11-03T18:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513546",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_513547.json:
```json
{
    "body": "**Branch:** [u/chapoton/26628](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26628)",
    "created_at": "2018-11-03T18:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513547",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/26628](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26628)



---

archive/issue_comments_513548.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e262d0afd2601730b0c206ef012922e177f2ab9\">5e262d0</a></td><td><code>py3: fix doctests in c3_controlled</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd\">c6ce4b6</a></td><td><code>py3: some fixes for sandpiles</code></td></tr></table>\n",
    "created_at": "2018-11-03T18:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513548",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e262d0afd2601730b0c206ef012922e177f2ab9">5e262d0</a></td><td><code>py3: fix doctests in c3_controlled</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd">c6ce4b6</a></td><td><code>py3: some fixes for sandpiles</code></td></tr></table>




---

archive/issue_comments_513549.json:
```json
{
    "body": "**Commit:** [c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd](https://github.com/sagemath/sagetrac-mirror/commit/c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd)",
    "created_at": "2018-11-03T18:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513549",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd](https://github.com/sagemath/sagetrac-mirror/commit/c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd)



---

archive/issue_comments_513550.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171\">7d3ecc7</a></td><td><code>py3: some fix for sandpiles</code></td></tr></table>\n",
    "created_at": "2018-11-03T18:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171">7d3ecc7</a></td><td><code>py3: some fix for sandpiles</code></td></tr></table>




---

archive/issue_comments_513551.json:
```json
{
    "body": "**Changing commit** from \"[c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd](https://github.com/sagemath/sagetrac-mirror/commit/c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd)\" to \"[7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171](https://github.com/sagemath/sagetrac-mirror/commit/7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171)\".",
    "created_at": "2018-11-03T18:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513551",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd](https://github.com/sagemath/sagetrac-mirror/commit/c6ce4b6a5748a8dcf483dbc6d24157132f5e0cfd)" to "[7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171](https://github.com/sagemath/sagetrac-mirror/commit/7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171)".



---

archive/issue_comments_513552.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d\">ba6fff3</a></td><td><code>trac 26628 fixing doctests</code></td></tr></table>\n",
    "created_at": "2018-11-04T09:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d">ba6fff3</a></td><td><code>trac 26628 fixing doctests</code></td></tr></table>




---

archive/issue_comments_513553.json:
```json
{
    "body": "**Changing commit** from \"[7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171](https://github.com/sagemath/sagetrac-mirror/commit/7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171)\" to \"[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)\".",
    "created_at": "2018-11-04T09:49:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171](https://github.com/sagemath/sagetrac-mirror/commit/7d3ecc74880f3c8970ab2eccc70c9cdaa4e10171)" to "[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)".



---

archive/issue_comments_513554.json:
```json
{
    "body": "<a id='comment:4'></a>\nbot is morally green, please review",
    "created_at": "2018-11-04T13:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513554",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>
bot is morally green, please review



---

archive/issue_comments_513555.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-11-04T14:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513555",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_513556.json:
```json
{
    "body": "<a id='comment:5'></a>\nLGTM.",
    "created_at": "2018-11-04T14:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513556",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
LGTM.



---

archive/issue_comments_513557.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-11-04T14:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513557",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_513558.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/26628](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26628)\" to \"[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)\".",
    "created_at": "2018-11-07T11:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513558",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/chapoton/26628](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26628)" to "[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)".



---

archive/issue_comments_513559.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2018-11-07T11:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513559",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_075023.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-07T11:27:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26628#event-75023"
}
```



---

archive/issue_comments_513560.json:
```json
{
    "body": "**Resolution changed** from fixed to .",
    "created_at": "2018-11-11T10:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513560",
    "user": "https://github.com/vbraun"
}
```

**Resolution changed** from fixed to .



---

archive/issue_comments_513561.json:
```json
{
    "body": "**Changing status** from closed to new.",
    "created_at": "2018-11-11T10:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513561",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from closed to new.



---

archive/issue_comments_513562.json:
```json
{
    "body": "**Changing commit** from \"[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)\" to \"\".",
    "created_at": "2018-11-11T10:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513562",
    "user": "https://github.com/vbraun"
}
```

**Changing commit** from "[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)" to "".



---

archive/issue_comments_513563.json:
```json
{
    "body": "<a id='comment:7'></a>\nI'm randomly getting this\n\n```\n**********************************************************************\nFile \"src/doc/en/thematic_tutorials/sandpile.rst\", line 4678, in doc.en.thematic_tutorials.sandpile\nFailed example:\n    D\nExpected:\n    {1: 2, 'a': 0, 'b': 1}\nGot:\n    {'a': 0, 'b': 1, 1: 2}\n**********************************************************************\n1 item had failures:\n   1 of 706 in doc.en.thematic_tutorials.sandpile\n    [705 tests, 1 failure, 93.88 s]\n**********************************************************************\nFile \"src/sage/sandpiles/sandpile.py\", line 4769, in sage.sandpiles.sandpile.SandpileDivisor.values\nFailed example:\n    D\nExpected:\n    {1: 2, 'a': 0, 'b': 1}\nGot:\n    {'a': 0, 'b': 1, 1: 2}\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.sandpiles.sandpile.SandpileDivisor.values\n    [941 tests, 1 failure, 54.14 s]\n```",
    "created_at": "2018-11-11T10:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513563",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:7'></a>
I'm randomly getting this

```
**********************************************************************
File "src/doc/en/thematic_tutorials/sandpile.rst", line 4678, in doc.en.thematic_tutorials.sandpile
Failed example:
    D
Expected:
    {1: 2, 'a': 0, 'b': 1}
Got:
    {'a': 0, 'b': 1, 1: 2}
**********************************************************************
1 item had failures:
   1 of 706 in doc.en.thematic_tutorials.sandpile
    [705 tests, 1 failure, 93.88 s]
**********************************************************************
File "src/sage/sandpiles/sandpile.py", line 4769, in sage.sandpiles.sandpile.SandpileDivisor.values
Failed example:
    D
Expected:
    {1: 2, 'a': 0, 'b': 1}
Got:
    {'a': 0, 'b': 1, 1: 2}
**********************************************************************
1 item had failures:
   1 of   6 in sage.sandpiles.sandpile.SandpileDivisor.values
    [941 tests, 1 failure, 54.14 s]
```



---

archive/issue_comments_513564.json:
```json
{
    "body": "<a id='comment:8'></a>\nAlso, for consistency I'd recommend using src.sage.repl.display.pretty_print.SagePrettyPrinter if you want to manually stringify an object",
    "created_at": "2018-11-11T10:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513564",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:8'></a>
Also, for consistency I'd recommend using src.sage.repl.display.pretty_print.SagePrettyPrinter if you want to manually stringify an object



---

archive/issue_comments_513565.json:
```json
{
    "body": "**Changing status** from new to needs_info.",
    "created_at": "2018-11-12T08:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513565",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_info.



---

archive/issue_comments_513566.json:
```json
{
    "body": "**Changing status** from needs_info to needs_work.",
    "created_at": "2018-11-12T08:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513566",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_info to needs_work.



---

archive/issue_comments_513567.json:
```json
{
    "body": "**Changing branch** from \"[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)\" to \"[u/chapoton/26628](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26628)\".",
    "created_at": "2018-12-03T13:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513567",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)" to "[u/chapoton/26628](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26628)".



---

archive/issue_comments_513568.json:
```json
{
    "body": "**Commit:** [ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)",
    "created_at": "2018-12-03T13:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513568",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)



---

archive/issue_comments_513569.json:
```json
{
    "body": "**Changing commit** from \"[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)\" to \"[bfcaa32e04991f193af3f3d9a50a328646391ad6](https://github.com/sagemath/sagetrac-mirror/commit/bfcaa32e04991f193af3f3d9a50a328646391ad6)\".",
    "created_at": "2018-12-03T13:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513569",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ba6fff38a08e5dc30071a4777fd68bba412b2c0d](https://github.com/sagemath/sagetrac-mirror/commit/ba6fff38a08e5dc30071a4777fd68bba412b2c0d)" to "[bfcaa32e04991f193af3f3d9a50a328646391ad6](https://github.com/sagemath/sagetrac-mirror/commit/bfcaa32e04991f193af3f3d9a50a328646391ad6)".



---

archive/issue_comments_513570.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e0dddb215587264d18124efaf7668a98d929667\">0e0dddb</a></td><td><code>Merge branch 'u/chapoton/26628' in 8.5.b6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bfcaa32e04991f193af3f3d9a50a328646391ad6\">bfcaa32</a></td><td><code>trac 26628 repr of sandpiles</code></td></tr></table>\n",
    "created_at": "2018-12-03T13:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513570",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e0dddb215587264d18124efaf7668a98d929667">0e0dddb</a></td><td><code>Merge branch 'u/chapoton/26628' in 8.5.b6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bfcaa32e04991f193af3f3d9a50a328646391ad6">bfcaa32</a></td><td><code>trac 26628 repr of sandpiles</code></td></tr></table>




---

archive/issue_comments_513571.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-12-03T13:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513571",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_513572.json:
```json
{
    "body": "<a id='comment:13'></a>\nIs this what you suggested, Volker ?",
    "created_at": "2018-12-03T13:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513572",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>
Is this what you suggested, Volker ?



---

archive/issue_comments_513573.json:
```json
{
    "body": "<a id='comment:14'></a>\n`@`vbraun:\n\nor should I rather use `from sage.repl.rich_output.pretty_print import pretty_print` ?",
    "created_at": "2018-12-07T09:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513573",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
`@`vbraun:

or should I rather use `from sage.repl.rich_output.pretty_print import pretty_print` ?



---

archive/issue_comments_513574.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2018-12-14T10:28:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513574",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_513575.json:
```json
{
    "body": "<a id='comment:16'></a>\nok, the alternative with pretty_print does not make sense. Back to needs_review..",
    "created_at": "2018-12-29T14:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513575",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
ok, the alternative with pretty_print does not make sense. Back to needs_review..



---

archive/issue_comments_513576.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2018-12-29T14:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513576",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_events_075024.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-12-29T14:24:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26628#event-75024"
}
```



---

archive/issue_comments_513577.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-12-29T16:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513577",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_513578.json:
```json
{
    "body": "<a id='comment:18'></a>\nI'm still getting this on the OSX buildbot:\n\n```\n**********************************************************************\nFile \"src/doc/en/thematic_tutorials/sandpile.rst\", line 4678, in doc.en.thematic_tutorials.sandpile\nFailed example:\n    D\nExpected:\n    {1: 2, 'a': 0, 'b': 1}\nGot:\n    {'a': 0, 'b': 1, 1: 2}\n**********************************************************************\n1 item had failures:\n   1 of 706 in doc.en.thematic_tutorials.sandpile\n    [705 tests, 1 failure, 86.65 s]\n**********************************************************************\nFile \"src/sage/sandpiles/sandpile.py\", line 4771, in sage.sandpiles.sandpile.SandpileDivisor.values\nFailed example:\n    D\nExpected:\n    {1: 2, 'a': 0, 'b': 1}\nGot:\n    {'a': 0, 'b': 1, 1: 2}\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.sandpiles.sandpile.SandpileDivisor.values\n    [941 tests, 1 failure, 43.18 s]\n----------------------------------------------------------------------\nsage -t --long src/doc/en/thematic_tutorials/sandpile.rst  # 1 doctest failed\nsage -t --long src/sage/sandpiles/sandpile.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2018-12-30T13:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513578",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>
I'm still getting this on the OSX buildbot:

```
**********************************************************************
File "src/doc/en/thematic_tutorials/sandpile.rst", line 4678, in doc.en.thematic_tutorials.sandpile
Failed example:
    D
Expected:
    {1: 2, 'a': 0, 'b': 1}
Got:
    {'a': 0, 'b': 1, 1: 2}
**********************************************************************
1 item had failures:
   1 of 706 in doc.en.thematic_tutorials.sandpile
    [705 tests, 1 failure, 86.65 s]
**********************************************************************
File "src/sage/sandpiles/sandpile.py", line 4771, in sage.sandpiles.sandpile.SandpileDivisor.values
Failed example:
    D
Expected:
    {1: 2, 'a': 0, 'b': 1}
Got:
    {'a': 0, 'b': 1, 1: 2}
**********************************************************************
1 item had failures:
   1 of   6 in sage.sandpiles.sandpile.SandpileDivisor.values
    [941 tests, 1 failure, 43.18 s]
----------------------------------------------------------------------
sage -t --long src/doc/en/thematic_tutorials/sandpile.rst  # 1 doctest failed
sage -t --long src/sage/sandpiles/sandpile.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_513579.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2018-12-30T13:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513579",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_513580.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/26628](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26628)\" to \"[public/ticket/26628](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/26628)\".",
    "created_at": "2018-12-31T18:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513580",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[u/chapoton/26628](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26628)" to "[public/ticket/26628](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/26628)".



---

archive/issue_comments_513581.json:
```json
{
    "body": "<a id='comment:19'></a>\n**NOTE**: I am going to recycle this ticket right now.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d976d7d612adfce8a881458bddcc13c5dd5ef9bb\">d976d7d</a></td><td><code>some care for sandpile tutorial</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6be243066df8a07b2542b40120ea38adad748409\">6be2430</a></td><td><code>fix doctests</code></td></tr></table>\n",
    "created_at": "2018-12-31T18:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513581",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>
**NOTE**: I am going to recycle this ticket right now.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d976d7d612adfce8a881458bddcc13c5dd5ef9bb">d976d7d</a></td><td><code>some care for sandpile tutorial</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6be243066df8a07b2542b40120ea38adad748409">6be2430</a></td><td><code>fix doctests</code></td></tr></table>




---

archive/issue_comments_513582.json:
```json
{
    "body": "**Changing commit** from \"[bfcaa32e04991f193af3f3d9a50a328646391ad6](https://github.com/sagemath/sagetrac-mirror/commit/bfcaa32e04991f193af3f3d9a50a328646391ad6)\" to \"[6be243066df8a07b2542b40120ea38adad748409](https://github.com/sagemath/sagetrac-mirror/commit/6be243066df8a07b2542b40120ea38adad748409)\".",
    "created_at": "2018-12-31T18:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513582",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[bfcaa32e04991f193af3f3d9a50a328646391ad6](https://github.com/sagemath/sagetrac-mirror/commit/bfcaa32e04991f193af3f3d9a50a328646391ad6)" to "[6be243066df8a07b2542b40120ea38adad748409](https://github.com/sagemath/sagetrac-mirror/commit/6be243066df8a07b2542b40120ea38adad748409)".



---

archive/issue_comments_513583.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-12-31T18:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513583",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_513584.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-the rest will have to wait for more fixes in generic graph\n+namely simple changes of notation for the sink vertex\n+\n+This decreases strongly the number of failing doctests under py3 in this file.\n``````\n",
    "created_at": "2018-12-31T18:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513584",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-the rest will have to wait for more fixes in generic graph
+namely simple changes of notation for the sink vertex
+
+This decreases strongly the number of failing doctests under py3 in this file.
``````




---

archive/issue_events_075025.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "rename": {
        "from": "py3: some partial fix for sandpiles",
        "to": "py3: some fixes for sandpiles tutorial"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26628#event-75025"
}
```



---

archive/issue_comments_513585.json:
```json
{
    "body": "<a id='comment:20'></a>\ngreen bot, please review (ticket has been recycled to do something related)",
    "created_at": "2018-12-31T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513585",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>
green bot, please review (ticket has been recycled to do something related)



---

archive/issue_comments_513586.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-01-04T20:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513586",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_513587.json:
```json
{
    "body": "**Changing status** from positive_review to needs_info.",
    "created_at": "2019-01-10T15:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513587",
    "user": "https://github.com/embray"
}
```

**Changing status** from positive_review to needs_info.



---

archive/issue_comments_513588.json:
```json
{
    "body": "<a id='comment:22'></a>\nSomething about this still smells off.  For example:\n\n```diff\n@@ -3595,14 +3595,14 @@ boolean\n \n EXAMPLES::\n \n-    sage: S = Sandpile({'a':[1,'b'], 'b':[1,'a'], 1:['a']},'a')\n-    sage: c = SandpileConfig(S, {'b':1, 1:2})\n+    sage: S = Sandpile({'a':['c','b'], 'b':['c','a'], 'c':['a']},'a')\n+    sage: c = SandpileConfig(S, {'b':1, 'c':2})\n     sage: c\n-    {1: 2, 'b': 1}\n+    {'c': 2, 'b': 1}\n```\n\nI'm not sure that last change is always going to be correct.  If `c` were a dict it would be pretty-printed with its keys sorted.  I haven't looked at `SandpileConfig` but it should probably do the same.",
    "created_at": "2019-01-10T15:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513588",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>
Something about this still smells off.  For example:

```diff
@@ -3595,14 +3595,14 @@ boolean
 
 EXAMPLES::
 
-    sage: S = Sandpile({'a':[1,'b'], 'b':[1,'a'], 1:['a']},'a')
-    sage: c = SandpileConfig(S, {'b':1, 1:2})
+    sage: S = Sandpile({'a':['c','b'], 'b':['c','a'], 'c':['a']},'a')
+    sage: c = SandpileConfig(S, {'b':1, 'c':2})
     sage: c
-    {1: 2, 'b': 1}
+    {'c': 2, 'b': 1}
```

I'm not sure that last change is always going to be correct.  If `c` were a dict it would be pretty-printed with its keys sorted.  I haven't looked at `SandpileConfig` but it should probably do the same.



---

archive/issue_comments_513589.json:
```json
{
    "body": "<a id='comment:23'></a>\nAnd does this relate in any way to #26722?",
    "created_at": "2019-01-10T15:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513589",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>
And does this relate in any way to #26722?



---

archive/issue_comments_513590.json:
```json
{
    "body": "<a id='comment:24'></a>\nThis is a preliminary cleanup work, certainly not the last word. Your concern should go to #26722. Sandpiles is a big mess, and I hope to move forward by small steps.\n\nCan I set back to positive ?",
    "created_at": "2019-01-10T16:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513590",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:24'></a>
This is a preliminary cleanup work, certainly not the last word. Your concern should go to #26722. Sandpiles is a big mess, and I hope to move forward by small steps.

Can I set back to positive ?



---

archive/issue_comments_513591.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [chapoton](#comment%3A24):\n> This is a preliminary cleanup work, certainly not the last word. Your concern should go to #26722. Sandpiles is a big mess, and I hope to move forward by small steps.\n> \n> Can I set back to positive ?\n\n\nUnfortunately not: The problem is that since this is being repr'd like a dict, the output order is completely arbitrary, and this ticket is just changing it to a different arbitrary order that is not guaranteed to be the same between Python versions or even platforms.\n\nIf you give me a sec, I think I have a solution...",
    "created_at": "2019-01-10T16:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513591",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>
Replying to [chapoton](#comment%3A24):
> This is a preliminary cleanup work, certainly not the last word. Your concern should go to #26722. Sandpiles is a big mess, and I hope to move forward by small steps.
> 
> Can I set back to positive ?


Unfortunately not: The problem is that since this is being repr'd like a dict, the output order is completely arbitrary, and this ticket is just changing it to a different arbitrary order that is not guaranteed to be the same between Python versions or even platforms.

If you give me a sec, I think I have a solution...



---

archive/issue_comments_513592.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db899d8f6434055900457db3bb9367537f57ae7e\">db899d8</a></td><td><code>fix pretty printing of SandpileConfig and SandpileDivisor</code></td></tr></table>\n",
    "created_at": "2019-01-10T16:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513592",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db899d8f6434055900457db3bb9367537f57ae7e">db899d8</a></td><td><code>fix pretty printing of SandpileConfig and SandpileDivisor</code></td></tr></table>




---

archive/issue_comments_513593.json:
```json
{
    "body": "**Changing commit** from \"[6be243066df8a07b2542b40120ea38adad748409](https://github.com/sagemath/sagetrac-mirror/commit/6be243066df8a07b2542b40120ea38adad748409)\" to \"[db899d8f6434055900457db3bb9367537f57ae7e](https://github.com/sagemath/sagetrac-mirror/commit/db899d8f6434055900457db3bb9367537f57ae7e)\".",
    "created_at": "2019-01-10T16:42:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513593",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[6be243066df8a07b2542b40120ea38adad748409](https://github.com/sagemath/sagetrac-mirror/commit/6be243066df8a07b2542b40120ea38adad748409)" to "[db899d8f6434055900457db3bb9367537f57ae7e](https://github.com/sagemath/sagetrac-mirror/commit/db899d8f6434055900457db3bb9367537f57ae7e)".



---

archive/issue_comments_513594.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2019-01-10T16:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513594",
    "user": "https://github.com/embray"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_comments_513595.json:
```json
{
    "body": "<a id='comment:28'></a>\nthis will probably trigger the import of IPython at startup, no ?",
    "created_at": "2019-01-10T16:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513595",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:28'></a>
this will probably trigger the import of IPython at startup, no ?



---

archive/issue_comments_513596.json:
```json
{
    "body": "<a id='comment:29'></a>\nI'm not sure what you mean.",
    "created_at": "2019-01-10T16:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513596",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'></a>
I'm not sure what you mean.



---

archive/issue_comments_513597.json:
```json
{
    "body": "<a id='comment:30'></a>\nI mean that the line\n\n```\nfrom IPython.lib import pretty\n```\nmaybe will have a negative impact on sage startup time (if it imports all of IPython)\n\nI am asking because I tried to import sage pretty-printer in some ticket, and then the startup time got 10% longer (import of Ipython..)",
    "created_at": "2019-01-10T16:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513597",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:30'></a>
I mean that the line

```
from IPython.lib import pretty
```
maybe will have a negative impact on sage startup time (if it imports all of IPython)

I am asking because I tried to import sage pretty-printer in some ticket, and then the startup time got 10% longer (import of Ipython..)



---

archive/issue_comments_513598.json:
```json
{
    "body": "<a id='comment:31'></a>\nThat's odd that you found that to be the case, because the Sage REPL *is* IPython:\n\n```\n$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.6.rc0, Release Date: 2019-01-03                 \u2502\n\u2502 Using Python 2.7.15. Type \"help()\" for help.                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: import sys\nsage: sys.modules['IPython.lib.pretty']\n<module 'IPython.lib.pretty' from '/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/IPython/lib/pretty.pyc'>\nsage: sys.modules['sage.sandpiles.sandpile']\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\n<ipython-input-4-8624d4f52316> in <module>()\n----> 1 sys.modules['sage.sandpiles.sandpile']\n\nKeyError: 'sage.sandpiles.sandpile'\n```",
    "created_at": "2019-01-10T16:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513598",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>
That's odd that you found that to be the case, because the Sage REPL *is* IPython:

```
$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.6.rc0, Release Date: 2019-01-03                 │
│ Using Python 2.7.15. Type "help()" for help.                       │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: import sys
sage: sys.modules['IPython.lib.pretty']
<module 'IPython.lib.pretty' from '/home/embray/src/sagemath/sage/local/lib/python2.7/site-packages/IPython/lib/pretty.pyc'>
sage: sys.modules['sage.sandpiles.sandpile']
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-4-8624d4f52316> in <module>()
----> 1 sys.modules['sage.sandpiles.sandpile']

KeyError: 'sage.sandpiles.sandpile'
```



---

archive/issue_comments_513599.json:
```json
{
    "body": "<a id='comment:32'></a>\nYes, strange indeed, but see bottom report here:\n\nhttps://patchbot.sagemath.org/ticket/26967/\n\nand in particular the startup plugins..\n\nEDIT: Apparently triggered by\n\n```\n+from sage.repl.rich_output.backend_base import BackendBase\n+from sage.repl.display.pretty_print import SagePrettyPrinter\n```",
    "created_at": "2019-01-10T16:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513599",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:32'></a>
Yes, strange indeed, but see bottom report here:

https://patchbot.sagemath.org/ticket/26967/

and in particular the startup plugins..

EDIT: Apparently triggered by

```
+from sage.repl.rich_output.backend_base import BackendBase
+from sage.repl.display.pretty_print import SagePrettyPrinter
```



---

archive/issue_comments_513600.json:
```json
{
    "body": "<a id='comment:33'></a>\nWell, `sage -c` is different because it doesn't load the REPL, but it does `import sage.all`.  However, I still *usually* get:\n\n```\n$ ./sage -c 'import sys; print(\"IPython\" in sys.modules)'\nFalse\n```\n\nThis might be in part because `sage.sandpiles` is lazy-imported.\n\nFor some odd reason though, immediately after a `./sage -b` I get:\n\n```\n$ ./sage -c 'import sys; print(\"IPython\" in sys.modules)'\nTrue\n```\n\nBut then not thereafter. Something must change immediately after a re-build that somehow triggers IPython from being imported.",
    "created_at": "2019-01-10T17:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513600",
    "user": "https://github.com/embray"
}
```

<a id='comment:33'></a>
Well, `sage -c` is different because it doesn't load the REPL, but it does `import sage.all`.  However, I still *usually* get:

```
$ ./sage -c 'import sys; print("IPython" in sys.modules)'
False
```

This might be in part because `sage.sandpiles` is lazy-imported.

For some odd reason though, immediately after a `./sage -b` I get:

```
$ ./sage -c 'import sys; print("IPython" in sys.modules)'
True
```

But then not thereafter. Something must change immediately after a re-build that somehow triggers IPython from being imported.



---

archive/issue_comments_513601.json:
```json
{
    "body": "<a id='comment:34'></a>\nAs my note says, it would be good to rework `sage.repl.display.pretty_print` so that this kind of thing can be avoided in the first place since it's pretty ugly anyways.",
    "created_at": "2019-01-10T17:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513601",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>
As my note says, it would be good to rework `sage.repl.display.pretty_print` so that this kind of thing can be avoided in the first place since it's pretty ugly anyways.



---

archive/issue_comments_513602.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [embray](#comment%3A33):\n> But then not thereafter. Something must change immediately after a re-build that somehow triggers IPython from being imported.\n\n\nI see: That's in order to rebuild the star imports cache.",
    "created_at": "2019-01-10T17:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513602",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>
Replying to [embray](#comment%3A33):
> But then not thereafter. Something must change immediately after a re-build that somehow triggers IPython from being imported.


I see: That's in order to rebuild the star imports cache.



---

archive/issue_comments_513603.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Erik Bray\".",
    "created_at": "2019-01-11T07:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513603",
    "user": "https://github.com/fchapoton"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, Erik Bray".



---

archive/issue_comments_513604.json:
```json
{
    "body": "<a id='comment:36'></a>\nok, then.",
    "created_at": "2019-01-11T07:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513604",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:36'></a>
ok, then.



---

archive/issue_comments_513605.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton\".",
    "created_at": "2019-01-11T07:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513605",
    "user": "https://github.com/fchapoton"
}
```

**Changing reviewer** from "Travis Scrimshaw" to "Travis Scrimshaw, Frédéric Chapoton".



---

archive/issue_comments_513606.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-01-11T07:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513606",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_513607.json:
```json
{
    "body": "<a id='comment:37'></a>\nThanks.  It's still a good point you raise though: Merely importing those modules shouldn't cause `IPython` to be imported if it can be avoided (e.g. it's pointless to do so if we're not in IPython).\n\nI'll open a ticket for that.",
    "created_at": "2019-01-11T11:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513607",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'></a>
Thanks.  It's still a good point you raise though: Merely importing those modules shouldn't cause `IPython` to be imported if it can be avoided (e.g. it's pointless to do so if we're not in IPython).

I'll open a ticket for that.



---

archive/issue_comments_513608.json:
```json
{
    "body": "<a id='comment:38'></a>\nOn OSX:\n\n```\n**********************************************************************\nFile \"src/sage/sandpiles/sandpile.py\", line 3486, in sage.sandpiles.sandpile.SandpileConfig.values\nFailed example:\n    c\nExpected:\n    {1: 2, 'b': 1}\nGot:\n    {'b': 1, 1: 2}\n**********************************************************************\nFile \"src/sage/sandpiles/sandpile.py\", line 4765, in sage.sandpiles.sandpile.SandpileDivisor.values\nFailed example:\n    D\nExpected:\n    {1: 2, 'a': 0, 'b': 1}\nGot:\n    {'a': 0, 'b': 1, 1: 2}\n**********************************************************************\n```",
    "created_at": "2019-01-20T19:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513608",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:38'></a>
On OSX:

```
**********************************************************************
File "src/sage/sandpiles/sandpile.py", line 3486, in sage.sandpiles.sandpile.SandpileConfig.values
Failed example:
    c
Expected:
    {1: 2, 'b': 1}
Got:
    {'b': 1, 1: 2}
**********************************************************************
File "src/sage/sandpiles/sandpile.py", line 4765, in sage.sandpiles.sandpile.SandpileDivisor.values
Failed example:
    D
Expected:
    {1: 2, 'a': 0, 'b': 1}
Got:
    {'a': 0, 'b': 1, 1: 2}
**********************************************************************
```



---

archive/issue_comments_513609.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2019-01-20T19:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513609",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_513610.json:
```json
{
    "body": "<a id='comment:39'></a>\nDamnation...",
    "created_at": "2019-01-20T20:38:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513610",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:39'></a>
Damnation...



---

archive/issue_comments_513611.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a58cbbbf6874773e7866cfac86cc822a3c82ed09\">a58cbbb</a></td><td><code>Merge branch 'public/ticket/26628' in 8.6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ee90c7e421565e6ecd98fd2b79f2589b01f7e41\">8ee90c7</a></td><td><code>sandpiles : fixing some doctests</code></td></tr></table>\n",
    "created_at": "2019-01-21T09:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513611",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a58cbbbf6874773e7866cfac86cc822a3c82ed09">a58cbbb</a></td><td><code>Merge branch 'public/ticket/26628' in 8.6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ee90c7e421565e6ecd98fd2b79f2589b01f7e41">8ee90c7</a></td><td><code>sandpiles : fixing some doctests</code></td></tr></table>




---

archive/issue_comments_513612.json:
```json
{
    "body": "**Changing commit** from \"[db899d8f6434055900457db3bb9367537f57ae7e](https://github.com/sagemath/sagetrac-mirror/commit/db899d8f6434055900457db3bb9367537f57ae7e)\" to \"[8ee90c7e421565e6ecd98fd2b79f2589b01f7e41](https://github.com/sagemath/sagetrac-mirror/commit/8ee90c7e421565e6ecd98fd2b79f2589b01f7e41)\".",
    "created_at": "2019-01-21T09:53:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513612",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[db899d8f6434055900457db3bb9367537f57ae7e](https://github.com/sagemath/sagetrac-mirror/commit/db899d8f6434055900457db3bb9367537f57ae7e)" to "[8ee90c7e421565e6ecd98fd2b79f2589b01f7e41](https://github.com/sagemath/sagetrac-mirror/commit/8ee90c7e421565e6ecd98fd2b79f2589b01f7e41)".



---

archive/issue_comments_513613.json:
```json
{
    "body": "<a id='comment:41'></a>\nok, this should fix it.",
    "created_at": "2019-01-21T09:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513613",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:41'></a>
ok, this should fix it.



---

archive/issue_comments_513614.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2019-01-21T09:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513614",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_513615.json:
```json
{
    "body": "<a id='comment:42'></a>\ngreen bot. I have no way to test on OSX.",
    "created_at": "2019-01-21T12:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513615",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:42'></a>
green bot. I have no way to test on OSX.



---

archive/issue_comments_513616.json:
```json
{
    "body": "<a id='comment:43'></a>\nVincent, would you please check the OsX behaviour ?",
    "created_at": "2019-01-22T07:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513616",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:43'></a>
Vincent, would you please check the OsX behaviour ?



---

archive/issue_comments_513617.json:
```json
{
    "body": "<a id='comment:44'></a>\nYes ! The two OSX errors from [comment:38](https://trac.sagemath.org/ticket/26628#comment:38) are fixed.",
    "created_at": "2019-01-22T10:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513617",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:44'></a>
Yes ! The two OSX errors from [comment:38](https://trac.sagemath.org/ticket/26628#comment:38) are fixed.



---

archive/issue_comments_513618.json:
```json
{
    "body": "<a id='comment:45'></a>\nMerci beaucoup, Vincent. Je repasse en positif.",
    "created_at": "2019-01-22T10:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513618",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:45'></a>
Merci beaucoup, Vincent. Je repasse en positif.



---

archive/issue_comments_513619.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-01-22T10:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513619",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_513620.json:
```json
{
    "body": "<a id='comment:46'></a>\nWeird. I'd have to take a closer look at how IPython's pretty-print module orders heterogeneous types when printing dictionaries.  If it's doing something id-based then it's not going to reliable (at least not the default implementation ...)",
    "created_at": "2019-01-23T12:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513620",
    "user": "https://github.com/embray"
}
```

<a id='comment:46'></a>
Weird. I'd have to take a closer look at how IPython's pretty-print module orders heterogeneous types when printing dictionaries.  If it's doing something id-based then it's not going to reliable (at least not the default implementation ...)



---

archive/issue_comments_513621.json:
```json
{
    "body": "<a id='comment:47'></a>\nUgh, so it's using this:\n\n```\ndef _sorted_for_pprint(items):\n    \"\"\"\n    Sort the given items for pretty printing. Since some predictable\n    sorting is better than no sorting at all, we sort on the string\n    representation if normal sorting fails.\n    \"\"\"\n    items = list(items)\n    try:\n        return sorted(items)\n    except Exception:\n        try:\n            return sorted(items, key=str)\n        except Exception:\n            return items\n```\n\nIronically this will give more-or-less deterministic results on Python 3 (<3.7, where it relies on built-in dict ordering), but non-deterministic results on Python 2 where `sorted(items)` will not raise an exception, and instead rely on Python 2's crappy fallback ordering which is not deterministic.\n\nThis might explain some other tests that expect dicts in their output, but where we've struggled to get consistent results across platforms.  I'll look into fixing this.",
    "created_at": "2019-01-23T12:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513621",
    "user": "https://github.com/embray"
}
```

<a id='comment:47'></a>
Ugh, so it's using this:

```
def _sorted_for_pprint(items):
    """
    Sort the given items for pretty printing. Since some predictable
    sorting is better than no sorting at all, we sort on the string
    representation if normal sorting fails.
    """
    items = list(items)
    try:
        return sorted(items)
    except Exception:
        try:
            return sorted(items, key=str)
        except Exception:
            return items
```

Ironically this will give more-or-less deterministic results on Python 3 (<3.7, where it relies on built-in dict ordering), but non-deterministic results on Python 2 where `sorted(items)` will not raise an exception, and instead rely on Python 2's crappy fallback ordering which is not deterministic.

This might explain some other tests that expect dicts in their output, but where we've struggled to get consistent results across platforms.  I'll look into fixing this.



---

archive/issue_comments_513622.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2019-01-24T18:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513622",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_075026.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-24T18:17:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26628#event-75026"
}
```



---

archive/issue_comments_513623.json:
```json
{
    "body": "**Changing branch** from \"[public/ticket/26628](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/26628)\" to \"[8ee90c7e421565e6ecd98fd2b79f2589b01f7e41](https://github.com/sagemath/sagetrac-mirror/commit/8ee90c7e421565e6ecd98fd2b79f2589b01f7e41)\".",
    "created_at": "2019-01-24T18:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26628",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26628#issuecomment-513623",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/ticket/26628](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/26628)" to "[8ee90c7e421565e6ecd98fd2b79f2589b01f7e41](https://github.com/sagemath/sagetrac-mirror/commit/8ee90c7e421565e6ecd98fd2b79f2589b01f7e41)".
