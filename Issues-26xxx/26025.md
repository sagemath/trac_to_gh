# Issue 26025: Sage should not use GP_DATA_DIR

archive/issues_025788.json:
```json
{
    "body": "It's an environment variable specific to PARI/GP and the location which is set in `interfaces/gp.py` is the default anyway.\n\nCC:  @timokau @kiwifb\n\nBranch/Commit: 63f8844f96acb90228a64b179a9b1fcf08e78dae\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26025\n\n",
    "closed_at": "2018-08-11T16:55:15Z",
    "created_at": "2018-08-08T07:17:51Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Sage should not use GP_DATA_DIR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26025",
    "user": "https://github.com/jdemeyer"
}
```
It's an environment variable specific to PARI/GP and the location which is set in `interfaces/gp.py` is the default anyway.

CC:  @timokau @kiwifb

Branch/Commit: 63f8844f96acb90228a64b179a9b1fcf08e78dae

Reviewer: François Bissey

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26025





---

archive/issue_comments_493799.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/sage_should_not_use_gp_data_dir\"",
    "created_at": "2018-08-08T07:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493799",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/sage_should_not_use_gp_data_dir"



---

archive/issue_comments_493800.json:
```json
{
    "body": "<a id='comment:2'></a>\nYes, my experience suggests that's not useful.\n\n---\nNew commits:\n|                                                                                                                                          |                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[63f8844](https://github.com/sagemath/sagetrac-mirror/commit/63f8844f96acb90228a64b179a9b1fcf08e78dae)|`No need to set GP datadir to GP_DATA_DIR`|",
    "created_at": "2018-08-08T07:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493800",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'></a>
Yes, my experience suggests that's not useful.

---
New commits:
|                                                                                                                                          |                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[63f8844](https://github.com/sagemath/sagetrac-mirror/commit/63f8844f96acb90228a64b179a9b1fcf08e78dae)|`No need to set GP datadir to GP_DATA_DIR`|



---

archive/issue_comments_493801.json:
```json
{
    "body": "Changing commit from \"\" to \"63f8844f96acb90228a64b179a9b1fcf08e78dae\"",
    "created_at": "2018-08-08T07:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493801",
    "user": "https://github.com/kiwifb"
}
```

Changing commit from "" to "63f8844f96acb90228a64b179a9b1fcf08e78dae"



---

archive/issue_comments_493802.json:
```json
{
    "body": "<a id='comment:3'></a>\nIt's not useful because PARI already uses the `GP_DATA_DIR` environment variable for that.",
    "created_at": "2018-08-08T07:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493802",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'></a>
It's not useful because PARI already uses the `GP_DATA_DIR` environment variable for that.



---

archive/issue_comments_493803.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-08T07:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493803",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_493804.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-08T07:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493804",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_493805.json:
```json
{
    "body": "<a id='comment:4'></a>\nLooks good to me.",
    "created_at": "2018-08-08T07:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493805",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>
Looks good to me.



---

archive/issue_comments_493806.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fran\u00e7ois Bissey\"",
    "created_at": "2018-08-08T07:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493806",
    "user": "https://github.com/kiwifb"
}
```

Changing reviewer from "" to "François Bissey"



---

archive/issue_comments_493807.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+It's an environment variable specific to PARI/GP and the location which is set in `interfaces/gp.py` is the default anyway.\n``````\n",
    "created_at": "2018-08-08T07:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493807",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+It's an environment variable specific to PARI/GP and the location which is set in `interfaces/gp.py` is the default anyway.
``````




---

archive/issue_comments_493808.json:
```json
{
    "body": "Replying to [ticket:26025 jdemeyer]:\n> is the default anyway.\n\n\nWell that's not the point of configurability. Also how can the default be in `SAGE_SHARE`? Is it determined relative to the pari binary? Or how else is it determined? Is `GP_DATA_DIR` still respected after this change?",
    "created_at": "2018-08-08T08:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493808",
    "user": "https://github.com/timokau"
}
```

Replying to [ticket:26025 jdemeyer]:
> is the default anyway.


Well that's not the point of configurability. Also how can the default be in `SAGE_SHARE`? Is it determined relative to the pari binary? Or how else is it determined? Is `GP_DATA_DIR` still respected after this change?



---

archive/issue_comments_493809.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2018-08-08T08:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493809",
    "user": "https://github.com/timokau"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_493810.json:
```json
{
    "body": "<a id='comment:7'></a>\nFrom pari's code\n\n```\nsrc/language/init.c:  pari_datadir = os_getenv(\"GP_DATA_DIR\");\n```\nSo it is enough for the variable to be in the environment.",
    "created_at": "2018-08-08T08:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493810",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
From pari's code

```
src/language/init.c:  pari_datadir = os_getenv("GP_DATA_DIR");
```
So it is enough for the variable to be in the environment.



---

archive/issue_comments_493811.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [gh-timokau](#comment%3A6):\n> Is `GP_DATA_DIR` still respected after this change?\n\n\nYes.",
    "created_at": "2018-08-08T09:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493811",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [gh-timokau](#comment%3A6):
> Is `GP_DATA_DIR` still respected after this change?


Yes.



---

archive/issue_comments_493812.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2018-08-08T09:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493812",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_493813.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe point of this ticket is that there is no point for *Sage* to deal with `GP_DATA_DIR` since *PARI* already deals with it.",
    "created_at": "2018-08-08T09:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493813",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
The point of this ticket is that there is no point for *Sage* to deal with `GP_DATA_DIR` since *PARI* already deals with it.



---

archive/issue_comments_493814.json:
```json
{
    "body": "<a id='comment:10'></a>\nOkay, thanks for the clarification.",
    "created_at": "2018-08-08T09:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493814",
    "user": "https://github.com/timokau"
}
```

<a id='comment:10'></a>
Okay, thanks for the clarification.



---

archive/issue_comments_493815.json:
```json
{
    "body": "<a id='comment:11'></a>\nDoes one of you know if there is a reliable way of setting `GP_DATA_DIR` as a distribution? I thought about a wrapper for the pari binaries, but that won't work when pari is used as a library. A better option seems to be `/etc/gprc`, but that is apparently overwritten (instead of extended) by `~/.gprc`.",
    "created_at": "2018-08-08T10:02:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493815",
    "user": "https://github.com/timokau"
}
```

<a id='comment:11'></a>
Does one of you know if there is a reliable way of setting `GP_DATA_DIR` as a distribution? I thought about a wrapper for the pari binaries, but that won't work when pari is used as a library. A better option seems to be `/etc/gprc`, but that is apparently overwritten (instead of extended) by `~/.gprc`.



---

archive/issue_comments_493816.json:
```json
{
    "body": "<a id='comment:12'></a>\nI just noticed that its possible to set `--datadir` at configure time. Thats not perfect because it needs re-compilation when adding data, but its something. If somebody knows a better option, that would be appreciated.\n\n(Got that here: http://pari.math.u-bordeaux.fr/dochtml/gpman.html)",
    "created_at": "2018-08-08T10:06:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493816",
    "user": "https://github.com/timokau"
}
```

<a id='comment:12'></a>
I just noticed that its possible to set `--datadir` at configure time. Thats not perfect because it needs re-compilation when adding data, but its something. If somebody knows a better option, that would be appreciated.

(Got that here: http://pari.math.u-bordeaux.fr/dochtml/gpman.html)



---

archive/issue_comments_493817.json:
```json
{
    "body": "<a id='comment:13'></a>\nWell, it depends a bit on the distribution but you can put special files under `/etc/env.d/` or `/etc/profile.d` - whichever is available - and they will be sourced on interactive login. An example under ubuntu\n\n```\nfrb15@p7login-rcc:~$ ll /etc/profile.d/\ntotal 36\ndrwxr-xr-x   2 root root  4096 Jul 31 22:30 ./\ndrwxr-xr-x 112 root root 12288 Aug  7 12:49 ../\n-rw-r--r--   1 root root   825 Jul 19 22:48 apps-bin-path.sh\n-rw-r--r--   1 root root   663 May 18  2016 bash_completion.sh\n-rw-r--r--   1 root root  1003 Dec 29  2015 cedilla-portuguese.sh\n-rw-r--r--   1 root root   168 Mar 17  2017 pwr7-prefix_path.sh\n-rw-r--r--   1 root root  1557 Apr 15  2016 Z97-byobu.sh\n```\nIf you look the first one for example\n\n```\nfrb15@p7login-rcc:~$ cat /etc/profile.d/apps-bin-path.sh \n# shellcheck shell=sh\n\n# Expand $PATH to include the directory where snappy applications go.\nsnap_bin_path=\"/snap/bin\"\nif [ -n \"${PATH##*${snap_bin_path}}\" -a -n \"${PATH##*${snap_bin_path}:*}\" ]; then\n    export PATH=$PATH:${snap_bin_path}\nfi\n\n# Ensure base distro defaults xdg path are set if nothing filed up some\n# defaults yet.\nif [ -z \"$XDG_DATA_DIRS\" ]; then\n    export XDG_DATA_DIRS=\"/usr/local/share:/usr/share\"\nfi\n\n# Desktop files (used by desktop environments within both X11 and Wayland) are\n# looked for in XDG_DATA_DIRS; make sure it includes the relevant directory for\n# snappy applications' desktop files.\nsnap_xdg_path=\"/var/lib/snapd/desktop\"\nif [ -n \"${XDG_DATA_DIRS##*${snap_xdg_path}}\" -a -n \"${XDG_DATA_DIRS##*${snap_xdg_path}:*}\" ]; then\n    export XDG_DATA_DIRS=\"${XDG_DATA_DIRS}:${snap_xdg_path}\"\nfi\n```\nSo it is totally possible for your pari or pari database package to add such a file with the right value for `GP_DATA_DIR`.",
    "created_at": "2018-08-08T10:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493817",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:13'></a>
Well, it depends a bit on the distribution but you can put special files under `/etc/env.d/` or `/etc/profile.d` - whichever is available - and they will be sourced on interactive login. An example under ubuntu

```
frb15@p7login-rcc:~$ ll /etc/profile.d/
total 36
drwxr-xr-x   2 root root  4096 Jul 31 22:30 ./
drwxr-xr-x 112 root root 12288 Aug  7 12:49 ../
-rw-r--r--   1 root root   825 Jul 19 22:48 apps-bin-path.sh
-rw-r--r--   1 root root   663 May 18  2016 bash_completion.sh
-rw-r--r--   1 root root  1003 Dec 29  2015 cedilla-portuguese.sh
-rw-r--r--   1 root root   168 Mar 17  2017 pwr7-prefix_path.sh
-rw-r--r--   1 root root  1557 Apr 15  2016 Z97-byobu.sh
```
If you look the first one for example

```
frb15@p7login-rcc:~$ cat /etc/profile.d/apps-bin-path.sh 
# shellcheck shell=sh

# Expand $PATH to include the directory where snappy applications go.
snap_bin_path="/snap/bin"
if [ -n "${PATH##*${snap_bin_path}}" -a -n "${PATH##*${snap_bin_path}:*}" ]; then
    export PATH=$PATH:${snap_bin_path}
fi

# Ensure base distro defaults xdg path are set if nothing filed up some
# defaults yet.
if [ -z "$XDG_DATA_DIRS" ]; then
    export XDG_DATA_DIRS="/usr/local/share:/usr/share"
fi

# Desktop files (used by desktop environments within both X11 and Wayland) are
# looked for in XDG_DATA_DIRS; make sure it includes the relevant directory for
# snappy applications' desktop files.
snap_xdg_path="/var/lib/snapd/desktop"
if [ -n "${XDG_DATA_DIRS##*${snap_xdg_path}}" -a -n "${XDG_DATA_DIRS##*${snap_xdg_path}:*}" ]; then
    export XDG_DATA_DIRS="${XDG_DATA_DIRS}:${snap_xdg_path}"
fi
```
So it is totally possible for your pari or pari database package to add such a file with the right value for `GP_DATA_DIR`.



---

archive/issue_comments_493818.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [fbissey](#comment%3A13):\n> Well, it depends a bit on the distribution but you can put special files under `/etc/env.d/` or `/etc/profile.d` - whichever is available - and they will be sourced on interactive login. An example under ubuntu\n\n\nThanks for the suggestion. However I think it is not the best one for me in this case. It requires setting global environment variables for the user, which is not ideal. It will also break if the user uses `env` or something to clear their env vars.\n\n\nWhen using `--datadir` to point to somewhere else than `<pari-prefix>/share/pari`, the `cypari` build breaks because it depends on files in `share/pari` (that are not installed datasets). I'm not sure if the same would have happened with `GP_DATA_DIR` or if `--datadir` has somewhat different semantics.\n\nThe best solution I see is to symlink the installed datasets to `<pari-prefix>/share/pari`. Just as the `--configure` option, that will require rebuilds. Maybe using different datasets is uncommon enough in practice that thats not a big deal.",
    "created_at": "2018-08-08T10:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493818",
    "user": "https://github.com/timokau"
}
```

<a id='comment:14'></a>
Replying to [fbissey](#comment%3A13):
> Well, it depends a bit on the distribution but you can put special files under `/etc/env.d/` or `/etc/profile.d` - whichever is available - and they will be sourced on interactive login. An example under ubuntu


Thanks for the suggestion. However I think it is not the best one for me in this case. It requires setting global environment variables for the user, which is not ideal. It will also break if the user uses `env` or something to clear their env vars.


When using `--datadir` to point to somewhere else than `<pari-prefix>/share/pari`, the `cypari` build breaks because it depends on files in `share/pari` (that are not installed datasets). I'm not sure if the same would have happened with `GP_DATA_DIR` or if `--datadir` has somewhat different semantics.

The best solution I see is to symlink the installed datasets to `<pari-prefix>/share/pari`. Just as the `--configure` option, that will require rebuilds. Maybe using different datasets is uncommon enough in practice that thats not a big deal.



---

archive/issue_comments_493819.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe actual code in pari setting the datadir at runtime\n\n```\n  pari_datadir = os_getenv(\"GP_DATA_DIR\");\n  if (!pari_datadir)\n  {\n#if defined(_WIN32) || defined(__CYGWIN32__)\n    if (paricfg_datadir[0]=='@' && paricfg_datadir[1]==0)\n      pari_datadir = win32_datadir();\n    else\n#endif\n      pari_datadir = pari_strdup(paricfg_datadir);\n  }\n  else pari_datadir= pari_strdup(pari_datadir);\n```\nSo `GP_DATA_DIR` over-rides the default location set by `--datadir` at runtime.",
    "created_at": "2018-08-08T10:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493819",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>
The actual code in pari setting the datadir at runtime

```
  pari_datadir = os_getenv("GP_DATA_DIR");
  if (!pari_datadir)
  {
#if defined(_WIN32) || defined(__CYGWIN32__)
    if (paricfg_datadir[0]=='@' && paricfg_datadir[1]==0)
      pari_datadir = win32_datadir();
    else
#endif
      pari_datadir = pari_strdup(paricfg_datadir);
  }
  else pari_datadir= pari_strdup(pari_datadir);
```
So `GP_DATA_DIR` over-rides the default location set by `--datadir` at runtime.



---

archive/issue_comments_493820.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [gh-timokau](#comment%3A14):\n> When using `--datadir` to point to somewhere else than `<pari-prefix>/share/pari`, the `cypari` build breaks because it depends on files in `share/pari` (that are not installed datasets).\n\n\nThat could be considered a bug in `cypari2`. I might fix it, but it's not high priority for me. I will accept a pull request though :-)",
    "created_at": "2018-08-08T10:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493820",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Replying to [gh-timokau](#comment%3A14):
> When using `--datadir` to point to somewhere else than `<pari-prefix>/share/pari`, the `cypari` build breaks because it depends on files in `share/pari` (that are not installed datasets).


That could be considered a bug in `cypari2`. I might fix it, but it's not high priority for me. I will accept a pull request though :-)



---

archive/issue_comments_493821.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jdemeyer](#comment%3A16):\n> Replying to [gh-timokau](#comment%3A14):\n> > When using `--datadir` to point to somewhere else than `<pari-prefix>/share/pari`, the `cypari` build breaks because it depends on files in `share/pari` (that are not installed datasets).\n\n> \n> That could be considered a bug in `cypari2`. I might fix it, but it's not high priority for me. I will accept a pull request though :-)\n\n\nThe `--datadir` solution doesn't really have any advantages over just symlinking, but it can't hurt to fix it: https://github.com/defeo/cypari2/pull/71",
    "created_at": "2018-08-08T11:21:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493821",
    "user": "https://github.com/timokau"
}
```

<a id='comment:17'></a>
Replying to [jdemeyer](#comment%3A16):
> Replying to [gh-timokau](#comment%3A14):
> > When using `--datadir` to point to somewhere else than `<pari-prefix>/share/pari`, the `cypari` build breaks because it depends on files in `share/pari` (that are not installed datasets).

> 
> That could be considered a bug in `cypari2`. I might fix it, but it's not high priority for me. I will accept a pull request though :-)


The `--datadir` solution doesn't really have any advantages over just symlinking, but it can't hurt to fix it: https://github.com/defeo/cypari2/pull/71



---

archive/issue_comments_493822.json:
```json
{
    "body": "<a id='comment:18'></a>\nI applied this patch on the sage nix package, removed the line that was setting `GP_DATA_DIR` and symlinked the data packages into pari's `share` folder. However something is wrong:\n\n```\n    TypeError: Error executing code in GP:\n    CODE:\n        sage[27]=polgalois(sage[26]);\n    PARI/GP ERROR:\n      ***   at top-level: sage[27]=polgalois(sage[26])\n      ***                          ^-------------------\n      *** polgalois: error opening galois file %s: `/nix/store/rcfgmlmqx4iffikynvb7d5dc0gzvv3al-sage-with-env-8.3/share/pari/galdata/NAM9'.\n```\n\nAnd various other errors of that type. For some reason, `gp` looks in `<sage-prefix>/share/pari/galdata` instead of `<pari-prefix>/share/pari/galdata`.\n\n`print(default(datadir))` in `gp` gives `<pari-prefix>/share/pari`, as expected.\n\nI only get errors referring to `galdata`. This worked when I was setting `GP_DATA_DIR` to a non-standard location. Not sure where that error is coming from.",
    "created_at": "2018-08-08T13:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493822",
    "user": "https://github.com/timokau"
}
```

<a id='comment:18'></a>
I applied this patch on the sage nix package, removed the line that was setting `GP_DATA_DIR` and symlinked the data packages into pari's `share` folder. However something is wrong:

```
    TypeError: Error executing code in GP:
    CODE:
        sage[27]=polgalois(sage[26]);
    PARI/GP ERROR:
      ***   at top-level: sage[27]=polgalois(sage[26])
      ***                          ^-------------------
      *** polgalois: error opening galois file %s: `/nix/store/rcfgmlmqx4iffikynvb7d5dc0gzvv3al-sage-with-env-8.3/share/pari/galdata/NAM9'.
```

And various other errors of that type. For some reason, `gp` looks in `<sage-prefix>/share/pari/galdata` instead of `<pari-prefix>/share/pari/galdata`.

`print(default(datadir))` in `gp` gives `<pari-prefix>/share/pari`, as expected.

I only get errors referring to `galdata`. This worked when I was setting `GP_DATA_DIR` to a non-standard location. Not sure where that error is coming from.



---

archive/issue_comments_493823.json:
```json
{
    "body": "<a id='comment:19'></a>\nNever mind, I messed up the symlinking with a missing closing quote. Still a weird error message though.",
    "created_at": "2018-08-08T14:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493823",
    "user": "https://github.com/timokau"
}
```

<a id='comment:19'></a>
Never mind, I messed up the symlinking with a missing closing quote. Still a weird error message though.



---

archive/issue_comments_493824.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/sage_should_not_use_gp_data_dir\" to \"63f8844f96acb90228a64b179a9b1fcf08e78dae\"",
    "created_at": "2018-08-11T16:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493824",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/sage_should_not_use_gp_data_dir" to "63f8844f96acb90228a64b179a9b1fcf08e78dae"



---

archive/issue_comments_493825.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-11T16:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26025#issuecomment-493825",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_081728.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-11T16:55:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26025",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26025#event-81728"
}
```
