# Issue 26714: primecount crashes Sage on 32bit system

archive/issues_026477.json:
```json
{
    "body": "Preparing 8.4 release of SDL (32bit system), i noticed that the following crashes Sage when `primecount` package is installed:\n\n```\nsage: from sage.interfaces.primecount import prime_pi\nsage: prime_pi(1000)\n------------------------------------------------------------------------\n/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5192)[0xb6bba192]\n/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/cysignals/signals.so(+0x523c)[0xb6bba23c]\n/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8680)[0xb6bbd680]\nlinux-gate.so.1(__kernel_sigreturn+0x0)[0xb7730d04]\n/opt/sagemath/sage-8.4/local/lib/libprimecount.so.4(_ZNK10primecount5Sieve5countEyy+0x2e8)[0x87db0368]\n/opt/sagemath/sage-8.4/local/lib/libprimecount.so.4(_ZN10primecount7pi_lmo5Ex+0xcf1)[0x87dcbbd1]\n/opt/sagemath/sage-8.4/local/lib/libprimecount.so.4(_ZN10primecount2piExi+0x4b)[0x87dbadbb]\n/opt/sagemath/sage-8.4/local/lib/libprimecount.so.4(_ZN10primecount2piEx+0x26)[0x87dbb7e6]\n/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/sage/interfaces/primecount.so(+0x4c2b)[0x87decc2b]\n/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/sage/interfaces/primecount.so(+0x5cc1)[0x87dedcc1]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x632a)[0xb75fc0ca]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x2e)[0xb75fff0e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7395)[0xb75fd135]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x2e)[0xb75fff0e]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x77)[0xb76234a7]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xdd)[0xb7624a0d]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyRun_AnyFileExFlags+0x67)[0xb7625137]\n/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(Py_Main+0xcfd)[0xb763c05d]\n/opt/sagemath/sage-8.4/local/bin/python2(main+0x27)[0x4a3607]\n/lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xf6)[0xb72cf286]\n/opt/sagemath/sage-8.4/local/bin/python2(+0x645)[0x4a3645]\n------------------------------------------------------------------------\nAttaching gdb to process id 24794.\n```\n\nI attach the corresponding gdb trace as well as the related doctest log.\n\n\nCC:  @videlec @vinklein @kiwifb @jdemeyer @dimpase\n\nKeywords: sdl\n\nReviewer: Dima Pasechnik\n\nDependencies: #25009\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/26714\n\n",
    "closed_at": "2021-11-20T23:57:15Z",
    "created_at": "2018-11-18T10:42:50Z",
    "labels": [
        "component: packages: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "primecount crashes Sage on 32bit system",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26714",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
Preparing 8.4 release of SDL (32bit system), i noticed that the following crashes Sage when `primecount` package is installed:

```
sage: from sage.interfaces.primecount import prime_pi
sage: prime_pi(1000)
------------------------------------------------------------------------
/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5192)[0xb6bba192]
/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/cysignals/signals.so(+0x523c)[0xb6bba23c]
/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8680)[0xb6bbd680]
linux-gate.so.1(__kernel_sigreturn+0x0)[0xb7730d04]
/opt/sagemath/sage-8.4/local/lib/libprimecount.so.4(_ZNK10primecount5Sieve5countEyy+0x2e8)[0x87db0368]
/opt/sagemath/sage-8.4/local/lib/libprimecount.so.4(_ZN10primecount7pi_lmo5Ex+0xcf1)[0x87dcbbd1]
/opt/sagemath/sage-8.4/local/lib/libprimecount.so.4(_ZN10primecount2piExi+0x4b)[0x87dbadbb]
/opt/sagemath/sage-8.4/local/lib/libprimecount.so.4(_ZN10primecount2piEx+0x26)[0x87dbb7e6]
/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/sage/interfaces/primecount.so(+0x4c2b)[0x87decc2b]
/opt/sagemath/sage-8.4/local/lib/python2.7/site-packages/sage/interfaces/primecount.so(+0x5cc1)[0x87dedcc1]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x632a)[0xb75fc0ca]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x2e)[0xb75fff0e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7395)[0xb75fd135]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7077)[0xb75fce17]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x7fe)[0xb75ffd9e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x2e)[0xb75fff0e]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x77)[0xb76234a7]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xdd)[0xb7624a0d]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(PyRun_AnyFileExFlags+0x67)[0xb7625137]
/opt/sagemath/sage-8.4/local/lib/libpython2.7.so.1.0(Py_Main+0xcfd)[0xb763c05d]
/opt/sagemath/sage-8.4/local/bin/python2(main+0x27)[0x4a3607]
/lib/i386-linux-gnu/libc.so.6(__libc_start_main+0xf6)[0xb72cf286]
/opt/sagemath/sage-8.4/local/bin/python2(+0x645)[0x4a3645]
------------------------------------------------------------------------
Attaching gdb to process id 24794.
```

I attach the corresponding gdb trace as well as the related doctest log.


CC:  @videlec @vinklein @kiwifb @jdemeyer @dimpase

Keywords: sdl

Reviewer: Dima Pasechnik

Dependencies: #25009

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/26714





---

archive/issue_comments_506745.json:
```json
{
    "body": "Attachment [primecount.gdb.crash.trace](tarball://root/attachments/some-uuid/ticket26714/primecount.gdb.crash.trace) by tmonteil created at 2018-11-18 10:43:14",
    "created_at": "2018-11-18T10:43:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506745",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Attachment [primecount.gdb.crash.trace](tarball://root/attachments/some-uuid/ticket26714/primecount.gdb.crash.trace) by tmonteil created at 2018-11-18 10:43:14



---

archive/issue_comments_506746.json:
```json
{
    "body": "<a id='comment:1'></a>\nAttachment [primecount.doctest.log](tarball://root/attachments/some-uuid/ticket26714/primecount.doctest.log) by tmonteil created at 2018-11-18 10:47:59",
    "created_at": "2018-11-18T10:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506746",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:1'></a>
Attachment [primecount.doctest.log](tarball://root/attachments/some-uuid/ticket26714/primecount.doctest.log) by tmonteil created at 2018-11-18 10:47:59



---

archive/issue_comments_506747.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt would be more appropriate to reproduce outside of Sage and make a report [upstream](https://github.com/kimwalisch/primecount).",
    "created_at": "2018-11-19T08:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506747",
    "user": "https://github.com/videlec"
}
```

<a id='comment:2'></a>
It would be more appropriate to reproduce outside of Sage and make a report [upstream](https://github.com/kimwalisch/primecount).



---

archive/issue_comments_506748.json:
```json
{
    "body": "<a id='comment:3'></a>\nAnd BTW, primecount 4.4 is out.",
    "created_at": "2018-11-19T08:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506748",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
And BTW, primecount 4.4 is out.



---

archive/issue_comments_506749.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [vdelecroix](#comment%3A2):\n> It would be more appropriate to reproduce outside of Sage and make a report [upstream](https://github.com/kimwalisch/primecount).\n\n\n`@`thierry: could you try the following in a Sage shell (`sage -sh`)\n\n```\n$ primecount 1000\n```",
    "created_at": "2018-11-19T08:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506749",
    "user": "https://github.com/videlec"
}
```

<a id='comment:4'></a>
Replying to [vdelecroix](#comment%3A2):
> It would be more appropriate to reproduce outside of Sage and make a report [upstream](https://github.com/kimwalisch/primecount).


`@`thierry: could you try the following in a Sage shell (`sage -sh`)

```
$ primecount 1000
```



---

archive/issue_comments_506750.json:
```json
{
    "body": "<a id='comment:5'></a>\nAnd the trace is irrelevant since primecount has not been compiled with gdb support. We only see Cython stuff. Apparently, running `cmake` with the additional option `-DCMAKE_BUILD_TYPE=Debug` should set the compiler flag properly. Could you try it?",
    "created_at": "2018-11-19T08:16:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506750",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
And the trace is irrelevant since primecount has not been compiled with gdb support. We only see Cython stuff. Apparently, running `cmake` with the additional option `-DCMAKE_BUILD_TYPE=Debug` should set the compiler flag properly. Could you try it?



---

archive/issue_comments_506751.json:
```json
{
    "body": "Changing keywords from \"\" to \"sdl\".",
    "created_at": "2019-08-27T19:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506751",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing keywords from "" to "sdl".



---

archive/issue_events_083013.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-16T18:13:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26714#event-83013"
}
```



---

archive/issue_comments_506752.json:
```json
{
    "body": "<a id='comment:8'></a>\nat least this works at the command line now (from the git version of primecount):\n\n```\n$ uname -a\nLinux arando 4.15.0-117-generic #118-Ubuntu SMP Fri Sep 4 20:00:48 UTC 2020 i686 i686 i686 GNU/Linux\n$ primecount 1000\n168\n```",
    "created_at": "2021-11-16T18:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506752",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
at least this works at the command line now (from the git version of primecount):

```
$ uname -a
Linux arando 4.15.0-117-generic #118-Ubuntu SMP Fri Sep 4 20:00:48 UTC 2020 i686 i686 i686 GNU/Linux
$ primecount 1000
168
```



---

archive/issue_comments_506753.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'll check that the interface works, too - it will take a while to build on this old box.",
    "created_at": "2021-11-16T18:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506753",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
I'll check that the interface works, too - it will take a while to build on this old box.



---

archive/issue_comments_506754.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-16T18:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506754",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_083014.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-16T18:30:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26714#event-83014"
}
```



---

archive/issue_events_083015.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-16T18:30:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26714#event-83015"
}
```



---

archive/issue_comments_506755.json:
```json
{
    "body": "<a id='comment:10'></a>\nLet's close it as outdated in view of the update ticket #25009.\n\nPortability testing (TBD) of #25009 also includes tests on several 32bit platforms.",
    "created_at": "2021-11-16T18:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506755",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Let's close it as outdated in view of the update ticket #25009.

Portability testing (TBD) of #25009 also includes tests on several 32bit platforms.



---

archive/issue_comments_506756.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#25009\"",
    "created_at": "2021-11-16T18:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506756",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#25009"



---

archive/issue_comments_506757.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2021-11-16T18:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506757",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_506758.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-16T18:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506758",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_506759.json:
```json
{
    "body": "<a id='comment:13'></a>\ntesting on #25009 shows that it's all good now on 32-bit, and this may be closed.",
    "created_at": "2021-11-17T16:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506759",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
testing on #25009 shows that it's all good now on 32-bit, and this may be closed.



---

archive/issue_comments_506760.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-11-20T23:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26714#issuecomment-506760",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_083016.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-20T23:57:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26714",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26714#event-83016"
}
```
