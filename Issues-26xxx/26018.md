# Issue 26018: Race conditions because of DESTDIR

archive/issues_025781.json:
```json
{
    "assignees": [],
    "body": "Using a staging directory for package install can introduce race conditions. For example, when installing a Python package, the package is installed first and then the `egg-info` directory is installed. The latter is what `pkg_resources` uses to consider a package \"installed\".\n\nHowever, when a `DESTDIR` install is used, the order that files appear in the final installation directory might be different.\n\nIf the `egg-info` directory is copied to `site-packages` before the actual Python package, then this can happen for example:\n\n```\nInstalling alabaster-0.7.10\nInstalling package alabaster using pip2\nIgnoring indexes: https://pypi.python.org/simple\nProcessing /home/jdemeyer/sage-test/local/var/tmp/sage/build/alabaster-0.7.10/src\n  Running setup.py (path:/tmp/pip-0ac_4C-build/setup.py) egg_info for package from file:///home/jdemeyer/sage-test/local/var/tmp/sage/build/alabaster-0.7.10/src\n    Running command python setup.py egg_info\n    running egg_info\n    creating pip-egg-info/alabaster.egg-info\n    writing pip-egg-info/alabaster.egg-info/PKG-INFO\n    writing top-level names to pip-egg-info/alabaster.egg-info/top_level.txt\n    writing dependency_links to pip-egg-info/alabaster.egg-info/dependency_links.txt\n    writing manifest file 'pip-egg-info/alabaster.egg-info/SOURCES.txt'\n    Traceback (most recent call last):\n      File \"<string>\", line 1, in <module>\n      File \"/tmp/pip-0ac_4C-build/setup.py\", line 37, in <module>\n        'Programming Language :: Python :: 3.4',\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/__init__.py\", line 129, in setup\n        return distutils.core.setup(**attrs)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/distutils/core.py\", line 151, in setup\n        dist.run_commands()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/distutils/dist.py\", line 953, in run_commands\n        self.run_command(cmd)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/distutils/dist.py\", line 972, in run_command\n        cmd_obj.run()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/egg_info.py\", line 278, in run\n        self.find_sources()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/egg_info.py\", line 293, in find_sources\n        mm.run()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/egg_info.py\", line 524, in run\n        self.add_defaults()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/egg_info.py\", line 563, in add_defaults\n        rcfiles = list(walk_revctrl())\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/sdist.py\", line 20, in walk_revctrl\n        for item in ep.load()(dirname):\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2405, in load\n        return self.resolve()\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/pkg_resources/__init__.py\", line 2411, in resolve\n        module = __import__(self.module_name, fromlist=['__name__'], level=0)\n      File \"/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools_scm/__init__.py\", line 9, in <module>\n        from .utils import trace\n    ImportError: No module named utils\n```\nWhat you see here is that `setuptools_scm` is used by `pkg_resources` even though the package `setuptools_scm` has not fully been installed.\n\nSee also: #26160 (py3: race condition with .pth files)\n\nCC:  @embray @dimpase @jhpalmieri\n\nBranch: **[6b20b84](https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c)**\n\nReviewer: **John Palmieri, Matthias Koeppe**\n\nAuthor: **Erik Bray, John Palmieri**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26018_\n\n",
    "closed_at": "2020-04-16T22:33:51Z",
    "created_at": "2018-08-07T10:17:58Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Race conditions because of DESTDIR",
    "type": "issue",
    "updated_at": "2020-04-26T02:49:06Z",
    "url": "https://github.com/sagemath/sage/issues/26018",
    "user": "https://github.com/jdemeyer"
}
```
Using a staging directory for package install can introduce race conditions. For example, when installing a Python package, the package is installed first and then the `egg-info` directory is installed. The latter is what `pkg_resources` uses to consider a package "installed".

However, when a `DESTDIR` install is used, the order that files appear in the final installation directory might be different.

If the `egg-info` directory is copied to `site-packages` before the actual Python package, then this can happen for example:

```
Installing alabaster-0.7.10
Installing package alabaster using pip2
Ignoring indexes: https://pypi.python.org/simple
Processing /home/jdemeyer/sage-test/local/var/tmp/sage/build/alabaster-0.7.10/src
  Running setup.py (path:/tmp/pip-0ac_4C-build/setup.py) egg_info for package from file:///home/jdemeyer/sage-test/local/var/tmp/sage/build/alabaster-0.7.10/src
    Running command python setup.py egg_info
    running egg_info
    creating pip-egg-info/alabaster.egg-info
    writing pip-egg-info/alabaster.egg-info/PKG-INFO
    writing top-level names to pip-egg-info/alabaster.egg-info/top_level.txt
    writing dependency_links to pip-egg-info/alabaster.egg-info/dependency_links.txt
    writing manifest file 'pip-egg-info/alabaster.egg-info/SOURCES.txt'
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/tmp/pip-0ac_4C-build/setup.py", line 37, in <module>
        'Programming Language :: Python :: 3.4',
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/__init__.py", line 129, in setup
        return distutils.core.setup(**attrs)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/distutils/core.py", line 151, in setup
        dist.run_commands()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/distutils/dist.py", line 953, in run_commands
        self.run_command(cmd)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/distutils/dist.py", line 972, in run_command
        cmd_obj.run()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/egg_info.py", line 278, in run
        self.find_sources()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/egg_info.py", line 293, in find_sources
        mm.run()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/egg_info.py", line 524, in run
        self.add_defaults()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/egg_info.py", line 563, in add_defaults
        rcfiles = list(walk_revctrl())
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools/command/sdist.py", line 20, in walk_revctrl
        for item in ep.load()(dirname):
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2405, in load
        return self.resolve()
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/pkg_resources/__init__.py", line 2411, in resolve
        module = __import__(self.module_name, fromlist=['__name__'], level=0)
      File "/home/jdemeyer/sage-test/local/lib/python2.7/site-packages/setuptools_scm/__init__.py", line 9, in <module>
        from .utils import trace
    ImportError: No module named utils
```
What you see here is that `setuptools_scm` is used by `pkg_resources` even though the package `setuptools_scm` has not fully been installed.

See also: #26160 (py3: race condition with .pth files)

CC:  @embray @dimpase @jhpalmieri

Branch: **[6b20b84](https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c)**

Reviewer: **John Palmieri, Matthias Koeppe**

Author: **Erik Bray, John Palmieri**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/26018_





---

archive/issue_events_359388.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-07T10:17:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359388"
}
```



---

archive/issue_events_359389.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-07T10:17:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359389"
}
```



---

archive/issue_events_359390.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-07T10:17:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359390"
}
```



---

archive/issue_events_359391.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-07T10:17:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359391"
}
```



---

archive/issue_comments_400824.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nVery naive fix at least for Python packages:\n\n```diff\ndiff --git a/build/bin/sage-spkg b/build/bin/sage-spkg\nindex 9b90421..eaf271e 100755\n--- a/build/bin/sage-spkg\n+++ b/build/bin/sage-spkg\n@@ -881,7 +881,7 @@ if [ -d \"$SAGE_DESTDIR\" ]; then\n     FILE_LIST=\"\"\n     FIRST=1\n     old_IFS=\"$IFS\"; IFS=$'\\n'\n-    for filename in $(find \"$PREFIX\" -type f -o -type l | sort); do\n+    for filename in $(find \"$PREFIX\" -type f -o -type l | sort -r); do\n         filename=\"${filename#$PREFIX}\"\n         if [ $FIRST -eq 1 ]; then\n             FILE_LIST=\"\\\"$filename\\\"\"\n```",
    "created_at": "2018-08-07T10:20:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400824",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

Very naive fix at least for Python packages:

```diff
diff --git a/build/bin/sage-spkg b/build/bin/sage-spkg
index 9b90421..eaf271e 100755
--- a/build/bin/sage-spkg
+++ b/build/bin/sage-spkg
@@ -881,7 +881,7 @@ if [ -d "$SAGE_DESTDIR" ]; then
     FILE_LIST=""
     FIRST=1
     old_IFS="$IFS"; IFS=$'\n'
-    for filename in $(find "$PREFIX" -type f -o -type l | sort); do
+    for filename in $(find "$PREFIX" -type f -o -type l | sort -r); do
         filename="${filename#$PREFIX}"
         if [ $FIRST -eq 1 ]; then
             FILE_LIST="\"$filename\""
```



---

archive/issue_comments_400825.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n Using a staging directory for package install can introduce race conditions. For example, when installing a Python package, the package is installed first and then the `egg-info` directory is installed. The latter is what `pkg_resources` uses to consider a package \"installed\".\n+\n+However, when a `DESTDIR` install is used, the order that files appear in the final installation directory might be different.\n \n If the `egg-info` directory is copied to `site-packages` before the actual Python package, then this can happen for example:\n \n``````\n",
    "created_at": "2018-08-07T10:21:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400825",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 Using a staging directory for package install can introduce race conditions. For example, when installing a Python package, the package is installed first and then the `egg-info` directory is installed. The latter is what `pkg_resources` uses to consider a package "installed".
+
+However, when a `DESTDIR` install is used, the order that files appear in the final installation directory might be different.
 
 If the `egg-info` directory is copied to `site-packages` before the actual Python package, then this can happen for example:
 
``````




---

archive/issue_comments_400826.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks for figuring out what was going on there.  Do you know a reliable way to reproduce this?  I wonder why I've never seen it before.",
    "created_at": "2018-08-07T10:36:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400826",
    "user": "https://github.com/embray"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks for figuring out what was going on there.  Do you know a reliable way to reproduce this?  I wonder why I've never seen it before.



---

archive/issue_comments_400827.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAnother thing to note: Previously we worked around this kind of race condition by putting a lock around `pip`, so only one package can be pip-installed at a time.  Now we still have that lock, but I think it's not actually necessary (though maybe still worth keeping?) since we in general do not pip-install packages to the same site-packages at the same time (when using DESTDIR).\n\nHowever, similar problems arise if packages can be copied into site-packages by sage-spkg while other python packages are simultaneously being installed.  So maybe we keep the exiting pip lock, but also require sage-spkg to obey it somehow.",
    "created_at": "2018-08-07T10:40:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400827",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

Another thing to note: Previously we worked around this kind of race condition by putting a lock around `pip`, so only one package can be pip-installed at a time.  Now we still have that lock, but I think it's not actually necessary (though maybe still worth keeping?) since we in general do not pip-install packages to the same site-packages at the same time (when using DESTDIR).

However, similar problems arise if packages can be copied into site-packages by sage-spkg while other python packages are simultaneously being installed.  So maybe we keep the exiting pip lock, but also require sage-spkg to obey it somehow.



---

archive/issue_comments_400828.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI just had this happen trying to rebuild the Windows patchbot, which broke again, for some reason.\n\nWhile I believe this is a more general problem in principle, it's happening specifically because installing `setuptools_scm` can alter the behavior of pip (in particular, it installs some `setuptools.file_finder` entrypoints).  It's also pulled in as a `setup_requires` from a couple of packages that have it listed as a prerequisite.\n\nThis is relatively unusual, and I think among packages installed by Sage, `setuptools_scm` is probably the only one like this.  So I wonder if we shouldn't just list it as a prerequisite to almost all Python packages, like we currently do with pip.",
    "created_at": "2018-08-14T10:26:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400828",
    "user": "https://github.com/embray"
}
```

<div id="comment:5" align="right">comment:5</div>

I just had this happen trying to rebuild the Windows patchbot, which broke again, for some reason.

While I believe this is a more general problem in principle, it's happening specifically because installing `setuptools_scm` can alter the behavior of pip (in particular, it installs some `setuptools.file_finder` entrypoints).  It's also pulled in as a `setup_requires` from a couple of packages that have it listed as a prerequisite.

This is relatively unusual, and I think among packages installed by Sage, `setuptools_scm` is probably the only one like this.  So I wonder if we shouldn't just list it as a prerequisite to almost all Python packages, like we currently do with pip.



---

archive/issue_comments_400829.json:
```json
{
    "body": "Branch: **[u/embray/build/python_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/python_toolchain)**",
    "created_at": "2018-08-14T10:44:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400829",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/build/python_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/python_toolchain)**



---

archive/issue_events_359392.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-14T10:44:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359392"
}
```



---

archive/issue_comments_400830.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nJust as one possible idea, what about this?\n\nTechnically, what I called `$(PYTHON_TOOLCHAIN)`, could just be spelled \"setuptools_scm\", since there's already a direct dependency sequence of `setuptools -> pip -> setuptools_scm`.  But I like that having a `PYTHON_TOOLCHAIN` variable makes this relationship to other packages explicit, and can be modified in one place.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c16368a6416d1e3655e026c63811fc9fbe23d2f\">6c16368</a></td><td><code>Add a PYTHON_TOOLCHIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr></table>\n",
    "created_at": "2018-08-14T10:44:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400830",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Just as one possible idea, what about this?

Technically, what I called `$(PYTHON_TOOLCHAIN)`, could just be spelled "setuptools_scm", since there's already a direct dependency sequence of `setuptools -> pip -> setuptools_scm`.  But I like that having a `PYTHON_TOOLCHAIN` variable makes this relationship to other packages explicit, and can be modified in one place.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c16368a6416d1e3655e026c63811fc9fbe23d2f">6c16368</a></td><td><code>Add a PYTHON_TOOLCHIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr></table>




---

archive/issue_comments_400831.json:
```json
{
    "body": "Commit: **[6c16368](https://github.com/sagemath/sagetrac-mirror/commit/6c16368a6416d1e3655e026c63811fc9fbe23d2f)**",
    "created_at": "2018-08-14T10:44:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400831",
    "user": "https://github.com/embray"
}
```

Commit: **[6c16368](https://github.com/sagemath/sagetrac-mirror/commit/6c16368a6416d1e3655e026c63811fc9fbe23d2f)**



---

archive/issue_comments_400832.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2018-08-14T10:44:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400832",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_400833.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6268ef708d10573b283cb4dea1c691e90a83872\">b6268ef</a></td><td><code>Add a PYTHON_TOOLCHIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr></table>\n",
    "created_at": "2018-08-14T10:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400833",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6268ef708d10573b283cb4dea1c691e90a83872">b6268ef</a></td><td><code>Add a PYTHON_TOOLCHIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr></table>




---

archive/issue_comments_400834.json:
```json
{
    "body": "Changed commit from **[6c16368](https://github.com/sagemath/sagetrac-mirror/commit/6c16368a6416d1e3655e026c63811fc9fbe23d2f)** to **[b6268ef](https://github.com/sagemath/sagetrac-mirror/commit/b6268ef708d10573b283cb4dea1c691e90a83872)**",
    "created_at": "2018-08-14T10:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400834",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6c16368](https://github.com/sagemath/sagetrac-mirror/commit/6c16368a6416d1e3655e026c63811fc9fbe23d2f)** to **[b6268ef](https://github.com/sagemath/sagetrac-mirror/commit/b6268ef708d10573b283cb4dea1c691e90a83872)**



---

archive/issue_comments_400835.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\n(had to fix one case, `build/pkgs/simplegeneric/dependencies`, where my `sed` call was a little over-aggressive; I should have made it just apply to the first line :)",
    "created_at": "2018-08-14T10:51:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400835",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

(had to fix one case, `build/pkgs/simplegeneric/dependencies`, where my `sed` call was a little over-aggressive; I should have made it just apply to the first line :)



---

archive/issue_comments_400836.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@embray](#comment:4):\n> Another thing to note: Previously we worked around this kind of race condition by putting a lock around `pip`, so only one package can be pip-installed at a time.  Now we still have that lock, but I think it's not actually necessary (though maybe still worth keeping?) since we in general do not pip-install packages to the same site-packages at the same time (when using DESTDIR).\n\nGood thinking! The problem is that the part which copies files from `DESTDIR` to the final installation directory is not locked. Adding an exclusive lock there would also mitigate this and maybe also #18438.",
    "created_at": "2018-08-16T08:34:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400836",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@embray](#comment:4):
> Another thing to note: Previously we worked around this kind of race condition by putting a lock around `pip`, so only one package can be pip-installed at a time.  Now we still have that lock, but I think it's not actually necessary (though maybe still worth keeping?) since we in general do not pip-install packages to the same site-packages at the same time (when using DESTDIR).

Good thinking! The problem is that the part which copies files from `DESTDIR` to the final installation directory is not locked. Adding an exclusive lock there would also mitigate this and maybe also #18438.



---

archive/issue_comments_400837.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI have in the past considered putting a lock around any kind of writing to `$SAGE_LOCAL`--not for any *specific* reason but it just seemed like it would probably be a good idea.  I had a feeling problems *like* this one would come up less frequently with such a lock.  However, for that to be practical, while still keeping parallel builds reasonably fast, we need as many packages as possible using `DESTDIR` builds.\n\nI can experiment with that, if you think it's a good idea.  In the meantime what do you think about the workaround I attached?  I think it makes a certain amount of sense independently of this issue, but I'm not sure.",
    "created_at": "2018-08-16T11:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400837",
    "user": "https://github.com/embray"
}
```

<div id="comment:10" align="right">comment:10</div>

I have in the past considered putting a lock around any kind of writing to `$SAGE_LOCAL`--not for any *specific* reason but it just seemed like it would probably be a good idea.  I had a feeling problems *like* this one would come up less frequently with such a lock.  However, for that to be practical, while still keeping parallel builds reasonably fast, we need as many packages as possible using `DESTDIR` builds.

I can experiment with that, if you think it's a good idea.  In the meantime what do you think about the workaround I attached?  I think it makes a certain amount of sense independently of this issue, but I'm not sure.



---

archive/issue_comments_400838.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI don't understand the branch: it looks like `pip` need not be installed before all of the packages that (without the branch) have it as a dependency. In any case, with a Python 3 build, I get\n\n```\nNo record that 'setuptools_scm' was ever installed; skipping uninstall\nInstalling setuptools_scm-1.15.6\nyour setuptools is too old (<12)\nsetuptools_scm functionality is degraded\n/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.4.beta5/local/bin/python3: No module named pip\n```\nPerhaps `pip` should not have `$(PYTHON_TOOLCHAIN)` as a dependency.",
    "created_at": "2018-09-20T15:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400838",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

I don't understand the branch: it looks like `pip` need not be installed before all of the packages that (without the branch) have it as a dependency. In any case, with a Python 3 build, I get

```
No record that 'setuptools_scm' was ever installed; skipping uninstall
Installing setuptools_scm-1.15.6
your setuptools is too old (<12)
setuptools_scm functionality is degraded
/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.4.beta5/local/bin/python3: No module named pip
```
Perhaps `pip` should not have `$(PYTHON_TOOLCHAIN)` as a dependency.



---

archive/issue_events_359393.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-09-20T16:55:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359393"
}
```



---

archive/issue_events_359394.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-09-20T16:55:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359394"
}
```



---

archive/issue_comments_400839.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nSimilar error with a Python 2 build. I don't think it's too much to ask for you to actually try your own branch before marking it as \"needs review\". Please do better in the future.",
    "created_at": "2018-09-20T16:55:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400839",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Similar error with a Python 2 build. I don't think it's too much to ask for you to actually try your own branch before marking it as "needs review". Please do better in the future.



---

archive/issue_comments_400840.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jhpalmieri](#comment:12):\n> Similar error with a Python 2 build. I don't think it's too much to ask for you to actually try your own branch before marking it as \"needs review\". Please do better in the future.\n\nWith respect, this is extremely condescending and unnecessary.  I'm a professional software engineer and you are not my employer or my mentor--you don't have to tell me how to do my job.  Obviously I tested it, being that it's a fairly non-trivial change.  I see what the problem is about pip and I'm not sure why I didn't hit on it, though I only would have if I were fully rebuilding from scratch (I believe, instead, I was doing some `./sage -f` calls that were designed to trigger the race condition).\n\nSage-the-distribution is a very large, complex pile of software, and it's difficult to test all possible scenarios, especially for builds.  I'm not sure what you think the point of \"needs review\" is, if not to provide peer-review, which includes peer-testing.  If you feel your time has been wasted you were also welcome to check the current results of the patchbots (which also show a build failure) and point that out rather than lecturing me needlessly.",
    "created_at": "2018-09-21T12:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400840",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jhpalmieri](#comment:12):
> Similar error with a Python 2 build. I don't think it's too much to ask for you to actually try your own branch before marking it as "needs review". Please do better in the future.

With respect, this is extremely condescending and unnecessary.  I'm a professional software engineer and you are not my employer or my mentor--you don't have to tell me how to do my job.  Obviously I tested it, being that it's a fairly non-trivial change.  I see what the problem is about pip and I'm not sure why I didn't hit on it, though I only would have if I were fully rebuilding from scratch (I believe, instead, I was doing some `./sage -f` calls that were designed to trigger the race condition).

Sage-the-distribution is a very large, complex pile of software, and it's difficult to test all possible scenarios, especially for builds.  I'm not sure what you think the point of "needs review" is, if not to provide peer-review, which includes peer-testing.  If you feel your time has been wasted you were also welcome to check the current results of the patchbots (which also show a build failure) and point that out rather than lecturing me needlessly.



---

archive/issue_comments_400841.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7efb49659ca300b0f894a6624bb6e7ab3466415\">e7efb49</a></td><td><code>Add a PYTHON_TOOLCHIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr></table>\n",
    "created_at": "2018-09-21T13:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400841",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7efb49659ca300b0f894a6624bb6e7ab3466415">e7efb49</a></td><td><code>Add a PYTHON_TOOLCHIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr></table>




---

archive/issue_comments_400842.json:
```json
{
    "body": "Changed commit from **[b6268ef](https://github.com/sagemath/sagetrac-mirror/commit/b6268ef708d10573b283cb4dea1c691e90a83872)** to **[e7efb49](https://github.com/sagemath/sagetrac-mirror/commit/e7efb49659ca300b0f894a6624bb6e7ab3466415)**",
    "created_at": "2018-09-21T13:29:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400842",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b6268ef](https://github.com/sagemath/sagetrac-mirror/commit/b6268ef708d10573b283cb4dea1c691e90a83872)** to **[e7efb49](https://github.com/sagemath/sagetrac-mirror/commit/e7efb49659ca300b0f894a6624bb6e7ab3466415)**



---

archive/issue_comments_400843.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nUpdated to ensure that `$(PYTHON_TOOLCHAIN)` is not used in the dependencies of the `PYTHON_TOOLCHAIN` members themselves.\n\nIIRC (it was several weeks ago) I did do this in the first place, but I think when I ran `sed` over the remaining packages I might have forgotten to exclude `pip` and `setuptools_scm` in particular.\n\nOf course, let's wait and see what my patchbot says.",
    "created_at": "2018-09-21T13:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400843",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

Updated to ensure that `$(PYTHON_TOOLCHAIN)` is not used in the dependencies of the `PYTHON_TOOLCHAIN` members themselves.

IIRC (it was several weeks ago) I did do this in the first place, but I think when I ran `sed` over the remaining packages I might have forgotten to exclude `pip` and `setuptools_scm` in particular.

Of course, let's wait and see what my patchbot says.



---

archive/issue_events_359395.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-21T13:45:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359395"
}
```



---

archive/issue_events_359396.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-21T13:45:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359396"
}
```



---

archive/issue_comments_400844.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nMy point is exactly that this is a ticket about building Sage from scratch, so running `make distclean; make` is one of the first things to test, it seems to me.\n\nEdit: let me tone this down a little.\n\nSo here is a serious question: if I think you have not done a good job on this ticket, should I not say anything? I think it's not bad to provide constructive criticism, like saying \"you should have run `make distclean; make` before marking this as `needs_review`.\"",
    "created_at": "2018-09-21T14:49:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400844",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

My point is exactly that this is a ticket about building Sage from scratch, so running `make distclean; make` is one of the first things to test, it seems to me.

Edit: let me tone this down a little.

So here is a serious question: if I think you have not done a good job on this ticket, should I not say anything? I think it's not bad to provide constructive criticism, like saying "you should have run `make distclean; make` before marking this as `needs_review`."



---

archive/issue_comments_400845.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nLet me put this another way. As you have no doubt experienced, in the Sage community there are different styles of reviewers. Some are very thorough, while some will take a glance at the code and say \"looks good to me, positive review\". One can get away with that superficial kind of review some of the time, for example a Python 3 ticket which just replaces some `iteritems` by `items`, but on a ticket like this, it needs thorough testing. I believe that the burden of that thorough testing falls on both the author and the reviewer. In this particular case, the problem gets caught by the patchbots, but that does not always happen.\n\nSo especially on a ticket involving Sage's build process, I think it is important for both the authors and the reviewers to be more careful and thorough than they might otherwise be. It's better to get it right the first time than to merge a ticket with problems and have to put out a bunch of fires later.",
    "created_at": "2018-09-21T16:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400845",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

Let me put this another way. As you have no doubt experienced, in the Sage community there are different styles of reviewers. Some are very thorough, while some will take a glance at the code and say "looks good to me, positive review". One can get away with that superficial kind of review some of the time, for example a Python 3 ticket which just replaces some `iteritems` by `items`, but on a ticket like this, it needs thorough testing. I believe that the burden of that thorough testing falls on both the author and the reviewer. In this particular case, the problem gets caught by the patchbots, but that does not always happen.

So especially on a ticket involving Sage's build process, I think it is important for both the authors and the reviewers to be more careful and thorough than they might otherwise be. It's better to get it right the first time than to merge a ticket with problems and have to put out a bunch of fires later.



---

archive/issue_comments_400846.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@jhpalmieri](#comment:16):\n> My point is exactly that this is a ticket about building Sage from scratch, so running `make distclean; make` is one of the first things to test, it seems to me.\n\nIt isn't necessarily though.  The issue at hand can occur in any situation where, at the most, the python2 package needs to be rebuilt, as do its dependencies.  A full build from scratch was not necessary to test it--I had found it sufficient for reliably reproducing the problem to do `./sage -f <something>` where I forget exactly what `<something>` was but it was one of python's early dependencies.  Possibly something fast, that wouldn't require a whole lot of other packages to be rebuilt.  Now that I look, it I think it was probably sqlite.\n\n\n> Edit: let me tone this down a little.\n> \n> So here is a serious question: if I think you have not done a good job on this ticket, should I not say anything? I think it's not bad to provide constructive criticism, like saying \"you should have run `make distclean; make` before marking this as `needs_review`.\"\n\nI think that would have been completely fair, though I have mixed feelings about \"before marking this as needs_review\".  What I find insulting is the assumption that I (or anyone, if it were someone else) just didn't test it at all.  It might be a little more reasonable if were something that *obviously* would never have worked at all under *any* circumstances, like having a syntax error in some code such that it would not have even compiled.\n\nEven then there are cases I've seen, both from myself and others, where I had something working fine, but accidentally hit a key in my editor and inserted a stray symbol somewhere just before committing the change.  I almost always review my diff before committing, but something like that can be easy to fix (and of course if I did skip diff review entirely, that's on me).  In fact, as I pointed out, this was in some ways such a case, since I had it \"right\" in the first place but then made a mistake before committing.  I did do a diff review but it was the sort that was easy to glaze over since it was dozens of almost equivalent changes.\n\nBut I don't think anyone should be lectured to about setting a ticket to \"needs review\" if there happens to be a mistake.  That's the whole point of asking for review--it's saying \"I've done everything I can *or have time for* to work on this; please take a look\".",
    "created_at": "2018-09-24T14:44:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400846",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@jhpalmieri](#comment:16):
> My point is exactly that this is a ticket about building Sage from scratch, so running `make distclean; make` is one of the first things to test, it seems to me.

It isn't necessarily though.  The issue at hand can occur in any situation where, at the most, the python2 package needs to be rebuilt, as do its dependencies.  A full build from scratch was not necessary to test it--I had found it sufficient for reliably reproducing the problem to do `./sage -f <something>` where I forget exactly what `<something>` was but it was one of python's early dependencies.  Possibly something fast, that wouldn't require a whole lot of other packages to be rebuilt.  Now that I look, it I think it was probably sqlite.


> Edit: let me tone this down a little.
> 
> So here is a serious question: if I think you have not done a good job on this ticket, should I not say anything? I think it's not bad to provide constructive criticism, like saying "you should have run `make distclean; make` before marking this as `needs_review`."

I think that would have been completely fair, though I have mixed feelings about "before marking this as needs_review".  What I find insulting is the assumption that I (or anyone, if it were someone else) just didn't test it at all.  It might be a little more reasonable if were something that *obviously* would never have worked at all under *any* circumstances, like having a syntax error in some code such that it would not have even compiled.

Even then there are cases I've seen, both from myself and others, where I had something working fine, but accidentally hit a key in my editor and inserted a stray symbol somewhere just before committing the change.  I almost always review my diff before committing, but something like that can be easy to fix (and of course if I did skip diff review entirely, that's on me).  In fact, as I pointed out, this was in some ways such a case, since I had it "right" in the first place but then made a mistake before committing.  I did do a diff review but it was the sort that was easy to glaze over since it was dozens of almost equivalent changes.

But I don't think anyone should be lectured to about setting a ticket to "needs review" if there happens to be a mistake.  That's the whole point of asking for review--it's saying "I've done everything I can *or have time for* to work on this; please take a look".



---

archive/issue_comments_400847.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jhpalmieri](#comment:17):\n> So especially on a ticket involving Sage's build process, I think it is important for both the authors and the reviewers to be more careful and thorough than they might otherwise be. It's better to get it right the first time than to merge a ticket with problems and have to put out a bunch of fires later.\n\nI don't disagree of course.  Part of the problem is that we do not have a QA department to set review policy.  But you will never, ever get everything \"right the first time\" and that's why we have peer review and continuous integration in the first place (and even with those things some things will be wrong and that's OK).\n\nIn the meantime, I think there would be less of a problem here if there were a test policy and review policy for build issues.  Lacking that, you can't point fingers if someone didn't follow a policy that doesn't exist. (Though as I've noted, I don't think it's fair to \"point fingers\" at all on code that is still under review in the first place).\n\nI appreciate your code reviews so I hope you'll keep doing them as they are very valuable; but please don't assume that if something is broken it's not because the contributor was lazy or careless or doesn't know what they're doing.",
    "created_at": "2018-09-24T14:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400847",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jhpalmieri](#comment:17):
> So especially on a ticket involving Sage's build process, I think it is important for both the authors and the reviewers to be more careful and thorough than they might otherwise be. It's better to get it right the first time than to merge a ticket with problems and have to put out a bunch of fires later.

I don't disagree of course.  Part of the problem is that we do not have a QA department to set review policy.  But you will never, ever get everything "right the first time" and that's why we have peer review and continuous integration in the first place (and even with those things some things will be wrong and that's OK).

In the meantime, I think there would be less of a problem here if there were a test policy and review policy for build issues.  Lacking that, you can't point fingers if someone didn't follow a policy that doesn't exist. (Though as I've noted, I don't think it's fair to "point fingers" at all on code that is still under review in the first place).

I appreciate your code reviews so I hope you'll keep doing them as they are very valuable; but please don't assume that if something is broken it's not because the contributor was lazy or careless or doesn't know what they're doing.



---

archive/issue_events_359397.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-02T17:01:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359397"
}
```



---

archive/issue_events_359398.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-02T17:01:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359398"
}
```



---

archive/issue_events_359399.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-02T17:34:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359399"
}
```



---

archive/issue_events_359400.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-02T17:34:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359400"
}
```



---

archive/issue_comments_400848.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nPer #26990, the `future` package also inserts itself at a fairly \"low level\" in that it ends up getting imported, once it's installed, by other Python build tools like setuptools and/or pip.  So it should also be included in the list of toolchain packages.",
    "created_at": "2019-01-03T14:23:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400848",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Per #26990, the `future` package also inserts itself at a fairly "low level" in that it ends up getting imported, once it's installed, by other Python build tools like setuptools and/or pip.  So it should also be included in the list of toolchain packages.



---

archive/issue_comments_400849.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b04b029084e89ffd1f125a97c201a2a8890f3473\">b04b029</a></td><td><code>Add a PYTHON_TOOLCHAIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cce3a23d86197f4d9603d3640d4196cbafa8a7fe\">cce3a23</a></td><td><code>add the \"future\" package to PYTHON_TOOLCHAIN</code></td></tr></table>\n",
    "created_at": "2019-01-03T14:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400849",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b04b029084e89ffd1f125a97c201a2a8890f3473">b04b029</a></td><td><code>Add a PYTHON_TOOLCHAIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cce3a23d86197f4d9603d3640d4196cbafa8a7fe">cce3a23</a></td><td><code>add the "future" package to PYTHON_TOOLCHAIN</code></td></tr></table>




---

archive/issue_comments_400850.json:
```json
{
    "body": "Changed commit from **[e7efb49](https://github.com/sagemath/sagetrac-mirror/commit/e7efb49659ca300b0f894a6624bb6e7ab3466415)** to **[cce3a23](https://github.com/sagemath/sagetrac-mirror/commit/cce3a23d86197f4d9603d3640d4196cbafa8a7fe)**",
    "created_at": "2019-01-03T14:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400850",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e7efb49](https://github.com/sagemath/sagetrac-mirror/commit/e7efb49659ca300b0f894a6624bb6e7ab3466415)** to **[cce3a23](https://github.com/sagemath/sagetrac-mirror/commit/cce3a23d86197f4d9603d3640d4196cbafa8a7fe)**



---

archive/issue_comments_400851.json:
```json
{
    "body": "Changed commit from **[cce3a23](https://github.com/sagemath/sagetrac-mirror/commit/cce3a23d86197f4d9603d3640d4196cbafa8a7fe)** to **[a06c851](https://github.com/sagemath/sagetrac-mirror/commit/a06c851550132fb137aafa09b2f749a52dd5fede)**",
    "created_at": "2019-01-03T14:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400851",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cce3a23](https://github.com/sagemath/sagetrac-mirror/commit/cce3a23d86197f4d9603d3640d4196cbafa8a7fe)** to **[a06c851](https://github.com/sagemath/sagetrac-mirror/commit/a06c851550132fb137aafa09b2f749a52dd5fede)**



---

archive/issue_comments_400852.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a06c851550132fb137aafa09b2f749a52dd5fede\">a06c851</a></td><td><code>add the \"future\" package to PYTHON_TOOLCHAIN</code></td></tr></table>\n",
    "created_at": "2019-01-03T14:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400852",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a06c851550132fb137aafa09b2f749a52dd5fede">a06c851</a></td><td><code>add the "future" package to PYTHON_TOOLCHAIN</code></td></tr></table>




---

archive/issue_comments_400853.json:
```json
{
    "body": "Changed commit from **[a06c851](https://github.com/sagemath/sagetrac-mirror/commit/a06c851550132fb137aafa09b2f749a52dd5fede)** to **[6c9482b](https://github.com/sagemath/sagetrac-mirror/commit/6c9482b6d65a153cb87f1c07801f503e4c7e7437)**",
    "created_at": "2019-01-03T17:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400853",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a06c851](https://github.com/sagemath/sagetrac-mirror/commit/a06c851550132fb137aafa09b2f749a52dd5fede)** to **[6c9482b](https://github.com/sagemath/sagetrac-mirror/commit/6c9482b6d65a153cb87f1c07801f503e4c7e7437)**



---

archive/issue_comments_400854.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b75c7722c55e4d53838b9c7485b3d840bfbf32d2\">b75c772</a></td><td><code>Add a PYTHON_TOOLCHAIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c9482b6d65a153cb87f1c07801f503e4c7e7437\">6c9482b</a></td><td><code>add the \"future\" package to PYTHON_TOOLCHAIN</code></td></tr></table>\n",
    "created_at": "2019-01-03T17:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400854",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b75c7722c55e4d53838b9c7485b3d840bfbf32d2">b75c772</a></td><td><code>Add a PYTHON_TOOLCHAIN variable to the makefile, which makes explicit the prerequisites to installing other Python packages with pip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c9482b6d65a153cb87f1c07801f503e4c7e7437">6c9482b</a></td><td><code>add the "future" package to PYTHON_TOOLCHAIN</code></td></tr></table>




---

archive/issue_events_359401.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-03T17:40:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359401"
}
```



---

archive/issue_events_359402.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-03T17:40:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359402"
}
```



---

archive/issue_comments_400855.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nRebased on 8.6.beta1, added future to the list of PYTHON_TOOLCHAIN packages and ensured that those packages are installed in order and can't be installed in parallel.  This should still work otherwise.",
    "created_at": "2019-01-03T17:40:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400855",
    "user": "https://github.com/embray"
}
```

<div id="comment:26" align="right">comment:26</div>

Rebased on 8.6.beta1, added future to the list of PYTHON_TOOLCHAIN packages and ensured that those packages are installed in order and can't be installed in parallel.  This should still work otherwise.



---

archive/issue_events_359403.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359403"
}
```



---

archive/issue_events_359404.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359404"
}
```



---

archive/issue_comments_400856.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400856",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_400857.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nred branch",
    "created_at": "2019-03-01T19:24:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400857",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:28" align="right">comment:28</div>

red branch



---

archive/issue_events_359405.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-01T19:24:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359405"
}
```



---

archive/issue_events_359406.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-03-01T19:24:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359406"
}
```



---

archive/issue_events_359407.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359407"
}
```



---

archive/issue_events_359408.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359408"
}
```



---

archive/issue_comments_400858.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400858",
    "user": "https://github.com/embray"
}
```

<div id="comment:29" align="right">comment:29</div>

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_359409.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359409"
}
```



---

archive/issue_events_359410.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:50:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359410"
}
```



---

archive/issue_comments_400859.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nTickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400859",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_events_359411.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359411"
}
```



---

archive/issue_events_359412.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359412"
}
```



---

archive/issue_comments_400860.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400860",
    "user": "https://github.com/embray"
}
```

<div id="comment:31" align="right">comment:31</div>

Ticket retargeted after milestone closed



---

archive/issue_comments_400861.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI have started to see this race conditions in automatic builds (for which I use high parallelization) now quite regularly. \nFor example https://github.com/mkoeppe/sage/runs/581024663?check_suite_focus=true",
    "created_at": "2020-04-13T00:16:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400861",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

I have started to see this race conditions in automatic builds (for which I use high parallelization) now quite regularly. 
For example https://github.com/mkoeppe/sage/runs/581024663?check_suite_focus=true



---

archive/issue_events_359413.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-13T00:16:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359413"
}
```



---

archive/issue_events_359414.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-13T00:16:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359414"
}
```



---

archive/issue_comments_400862.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -48,3 +48,5 @@\n     ImportError: No module named utils\n ```\n What you see here is that `setuptools_scm` is used by `pkg_resources` even though the package `setuptools_scm` has not fully been installed.\n+\n+See also: #26160 (py3: race condition with .pth files)\n``````\n",
    "created_at": "2020-04-13T00:25:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400862",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -48,3 +48,5 @@
     ImportError: No module named utils
 ```
 What you see here is that `setuptools_scm` is used by `pkg_resources` even though the package `setuptools_scm` has not fully been installed.
+
+See also: #26160 (py3: race condition with .pth files)
``````




---

archive/issue_comments_400863.json:
```json
{
    "body": "Changed branch from **[u/embray/build/python_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/python_toolchain)** to **[u/jhpalmieri/build/python_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/build/python_toolchain)**",
    "created_at": "2020-04-15T02:13:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400863",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/embray/build/python_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/python_toolchain)** to **[u/jhpalmieri/build/python_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/build/python_toolchain)**



---

archive/issue_comments_400864.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nRebased to 9.1.rc0.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c\">6b20b84</a></td><td><code>trac 26018: embray's work rebased to 9.1.rc0</code></td></tr></table>\n",
    "created_at": "2020-04-15T02:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400864",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:36" align="right">comment:36</div>

Rebased to 9.1.rc0.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c">6b20b84</a></td><td><code>trac 26018: embray's work rebased to 9.1.rc0</code></td></tr></table>




---

archive/issue_comments_400865.json:
```json
{
    "body": "Changed commit from **[6c9482b](https://github.com/sagemath/sagetrac-mirror/commit/6c9482b6d65a153cb87f1c07801f503e4c7e7437)** to **[6b20b84](https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c)**",
    "created_at": "2020-04-15T02:13:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400865",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[6c9482b](https://github.com/sagemath/sagetrac-mirror/commit/6c9482b6d65a153cb87f1c07801f503e4c7e7437)** to **[6b20b84](https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c)**



---

archive/issue_events_359415.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-04-15T02:14:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359415"
}
```



---

archive/issue_events_359416.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-04-15T02:14:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359416"
}
```



---

archive/issue_comments_400866.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nLooks good to me, I'll try this out on one of my next GH Action runs",
    "created_at": "2020-04-15T02:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400866",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">comment:38</div>

Looks good to me, I'll try this out on one of my next GH Action runs



---

archive/issue_comments_400867.json:
```json
{
    "body": "Changed author from **Erik Bray** to **Erik Bray, John Palmieri**",
    "created_at": "2020-04-15T02:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400867",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Erik Bray** to **Erik Bray, John Palmieri**



---

archive/issue_comments_400868.json:
```json
{
    "body": "Reviewer: **John Palmieri, Matthias Koeppe**",
    "created_at": "2020-04-15T02:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400868",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **John Palmieri, Matthias Koeppe**



---

archive/issue_comments_400869.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nBy the way, I ran \"git grep pip build/pkgs/*/dependencies\" and similarly searched for \"setuptools\" and \"future\". I think I caught everything that needed changing. There are a few packages (I think notedown and pandoc_attributes are the only ones) with dependencies like\n\n```\n$(PYTHON) $(PYTHON_TOOLCHAIN) | pip nbformat nbconvert six pandoc_attributes\n```\nand I left those as is.",
    "created_at": "2020-04-15T02:42:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400869",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:40" align="right">comment:40</div>

By the way, I ran "git grep pip build/pkgs/*/dependencies" and similarly searched for "setuptools" and "future". I think I caught everything that needed changing. There are a few packages (I think notedown and pandoc_attributes are the only ones) with dependencies like

```
$(PYTHON) $(PYTHON_TOOLCHAIN) | pip nbformat nbconvert six pandoc_attributes
```
and I left those as is.



---

archive/issue_events_359417.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-15T03:24:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359417"
}
```



---

archive/issue_events_359418.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-15T03:24:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359418"
}
```



---

archive/issue_comments_400870.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\ntests run at https://github.com/mkoeppe/sage/actions/runs/78581820",
    "created_at": "2020-04-15T04:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400870",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

tests run at https://github.com/mkoeppe/sage/actions/runs/78581820



---

archive/issue_events_359419.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-15T19:12:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359419"
}
```



---

archive/issue_events_359420.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-15T19:12:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359420"
}
```



---

archive/issue_comments_400871.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThis seems to be working well. Thanks!",
    "created_at": "2020-04-15T19:12:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400871",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43" align="right">comment:43</div>

This seems to be working well. Thanks!



---

archive/issue_comments_400872.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/build/python_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/build/python_toolchain)** to **[6b20b84](https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c)**",
    "created_at": "2020-04-16T22:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400872",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jhpalmieri/build/python_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/build/python_toolchain)** to **[6b20b84](https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c)**



---

archive/issue_events_359421.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-16T22:33:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359421"
}
```



---

archive/issue_events_359422.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "5d535e55b543ec5781e48726c5bdc464bc0c649b",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-04-16T22:33:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26018#event-359422"
}
```



---

archive/issue_comments_400873.json:
```json
{
    "body": "Changed commit from **[6b20b84](https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c)** to none",
    "created_at": "2020-04-26T02:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400873",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[6b20b84](https://github.com/sagemath/sagetrac-mirror/commit/6b20b84fa42303d8d96373f6e8f75546b97a079c)** to none



---

archive/issue_comments_400874.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nAs was to be expected, this helped but did not resolve the issue completely. Follow-up: \n\n- #29585 More race conditions with Python package installations because of DESTDIR",
    "created_at": "2020-04-26T02:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26018",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26018#issuecomment-400874",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">comment:45</div>

As was to be expected, this helped but did not resolve the issue completely. Follow-up: 

- #29585 More race conditions with Python package installations because of DESTDIR
