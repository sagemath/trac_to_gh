# Issue 26874: Use current_randstate() for seeding PRNGs used by Interfaces

archive/issues_026637.json:
```json
{
    "body": "There is a method `Interface.rand_seed()` which returns a randomized seed that can be used to initialize different `Interface`s RNGs, where applicable (it use called by individual interface implementations' `set_seed()` methods when the provided seed is `None`).\n\nFor some reason (itself not entirely clear to me) this does not use the `current_randstate()`, but rather initializes a new `randstate()` and uses that to obtain an arbitrary random seed.  Maybe there's no good reason for that in the first place, in fact?\n\nIn any case, for the doctests we want consistent results, so with this patch I have this method use `current_randstate().seed()` so that results are consistent across test runs.\n\nThis came up in[comment:341](#comment%3A341):ticket:22626 where it turned out some tests that use the GAP pexpect interface which depend on GAP's PRNG were different between test runs.\n\nThere are many other tests like this sprinkled about which manage this by manually calling `current_randstate().set_seed_gap()` before the test, but putting something like this in the documentation would seem rather distracting.\n\nCC:  @dimpase @jdemeyer\n\nReviewer: Dima Pasechnik\n\nAuthor: Erik Bray\n\nBranch: d7c85cd7ba758f5661245b994d857ca2a22f1637\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26874\n\n",
    "closed_at": "2018-12-23T23:41:17Z",
    "created_at": "2018-12-11T09:29:09Z",
    "labels": [
        "component: doctest framework",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.6",
    "title": "Use current_randstate() for seeding PRNGs used by Interfaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26874",
    "user": "https://github.com/embray"
}
```
There is a method `Interface.rand_seed()` which returns a randomized seed that can be used to initialize different `Interface`s RNGs, where applicable (it use called by individual interface implementations' `set_seed()` methods when the provided seed is `None`).

For some reason (itself not entirely clear to me) this does not use the `current_randstate()`, but rather initializes a new `randstate()` and uses that to obtain an arbitrary random seed.  Maybe there's no good reason for that in the first place, in fact?

In any case, for the doctests we want consistent results, so with this patch I have this method use `current_randstate().seed()` so that results are consistent across test runs.

This came up in[comment:341](#comment%3A341):ticket:22626 where it turned out some tests that use the GAP pexpect interface which depend on GAP's PRNG were different between test runs.

There are many other tests like this sprinkled about which manage this by manually calling `current_randstate().set_seed_gap()` before the test, but putting something like this in the documentation would seem rather distracting.

CC:  @dimpase @jdemeyer

Reviewer: Dima Pasechnik

Author: Erik Bray

Branch: d7c85cd7ba758f5661245b994d857ca2a22f1637

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26874





---

archive/issue_comments_509647.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-11T09:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509647",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_509648.json:
```json
{
    "body": "<a id='comment:2'></a>\nOK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.",
    "created_at": "2018-12-11T09:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509648",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.



---

archive/issue_comments_509649.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [dimpase](#comment%3A2):\n> OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.\n\n\nAlready did last night.  Remarkably, nothing broke.  There probably isn't actually all that much that depends on this, and most tests that could have been affected by it were already manually calling `current_randstate().set_seed_<foo>()` ahead of time...",
    "created_at": "2018-12-11T09:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509649",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
Replying to [dimpase](#comment%3A2):
> OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.


Already did last night.  Remarkably, nothing broke.  There probably isn't actually all that much that depends on this, and most tests that could have been affected by it were already manually calling `current_randstate().set_seed_<foo>()` ahead of time...



---

archive/issue_comments_509650.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-11T09:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509650",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_509651.json:
```json
{
    "body": "<a id='comment:4'></a>\nover to bots...",
    "created_at": "2018-12-11T09:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509651",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
over to bots...



---

archive/issue_comments_509652.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2018-12-11T09:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509652",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_509653.json:
```json
{
    "body": "<a id='comment:5'></a>\nMarking this as critical since it's a dependency of #22626",
    "created_at": "2018-12-20T12:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509653",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>
Marking this as critical since it's a dependency of #22626



---

archive/issue_comments_509654.json:
```json
{
    "body": "Changing branch from \"u/embray/doctests/interfaces-rand-seed\" to \"d7c85cd7ba758f5661245b994d857ca2a22f1637\"",
    "created_at": "2018-12-23T23:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509654",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/doctests/interfaces-rand-seed" to "d7c85cd7ba758f5661245b994d857ca2a22f1637"



---

archive/issue_events_083344.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-23T23:41:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26874#event-83344"
}
```



---

archive/issue_comments_509655.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-23T23:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509655",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_083345.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T11:13:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26874#event-83345"
}
```



---

archive/issue_comments_509656.json:
```json
{
    "body": "Changing commit from \"d7c85cd7ba758f5661245b994d857ca2a22f1637\" to \"\"",
    "created_at": "2018-12-28T11:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509656",
    "user": "https://github.com/embray"
}
```

Changing commit from "d7c85cd7ba758f5661245b994d857ca2a22f1637" to ""



---

archive/issue_comments_509657.json:
```json
{
    "body": "<a id='comment:7'></a>\nClosed 4 days ago so I'm assuming this didn't go in 8.5.  Please don't close a ticket as fixed without updating the milestone to its target release.",
    "created_at": "2018-12-28T11:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26874",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26874#issuecomment-509657",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
Closed 4 days ago so I'm assuming this didn't go in 8.5.  Please don't close a ticket as fixed without updating the milestone to its target release.
