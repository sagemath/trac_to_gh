# Issue 26513: bug in discovery of SRG' complements - related to twograph_descendant

archive/issues_026276.json:
```json
{
    "body": "as reported by Ferdinand Ihringer:\n\n```\nThe following two graphs do not work, but their complement does:\n\ngraphs.strongly_regular_graph(539, 250, 105, 125)\ngraphs.strongly_regular_graph(779, 378, 177, 189)\n\nHere the complement does not work:\n\ngraphs.strongly_regular_graph(819, 400, 190, 200)\ngraphs.strongly_regular_graph(819, 418, 217, 209)\n```\n\n```\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-1-5ba69562e41c> in <module>()\n----> 1 graphs.strongly_regular_graph(Integer(539), Integer(250), Integer(105), Integer(125))\n\n/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:44406)()\n   2982                 return True\n   2983             ans = f(*params)\n-> 2984             return check_srg(ans[0](*ans[1:]))\n   2985         if f(*params_complement):\n   2986             if existence:\n\n/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.is_twograph_descendant_of_srg.la (build/cythonized/sage/graphs/strongly_regular_db.c:23106)()\n   1500                 def la(vv):\n   1501                     from sage.combinat.designs.twographs import twograph_descendant\n-> 1502                     g = strongly_regular_graph(vv, k, l - 2*mu + k)\n   1503                     return twograph_descendant(g, next(g.vertex_iterator()),\n   1504                                                name=True)\n\n/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:45159)()\n   3015             if existence:\n   3016                 return True\n-> 3017             raise RuntimeError((\"Andries Brouwer's database claims that such a \"+\n   3018                                 \"({},{},{},{})-strongly regular graph exists, but \"+\n   3019                                 \"Sage does not know how to build it. If *you* do, \"+\n\nRuntimeError: Andries Brouwer's database claims that such a (540,245,100,120)-strongly regular graph exists, but Sage does not know how to build it. If *you* do, please get in touch with us on sage-devel!\nComments: 2-graph\nsage:\nsage: graphs.strongly_regular_graph(539, 288, 162, 144)\ndescendant of  at 0: Graph on 539 vertices\n```\n\n\nThis is related to the missing in Sage constructions. \n\nIn the first two cases graphs can be constructed using 2-graph descendant from Fickus et al SRGs (cf Brouwer's tables, not yet implemented in Sage), while their complements are\nconstructed using 2-graph descendant from known to Sage SRGs.\n\nThis illustrates a bug in discovery of SRGs via taking complements.\n\n\nIn the last case graphs can be constructed using 2-graph descendant from Fickus et al SRGs (cf Brouwer's tables, not yet implemented in Sage) or their complements.\n\nThere is also a discrepancy: the database gets broken after trying to build graphs.strongly_regular_graph(819, 400, 190, 200)\ngraphs.strongly_regular_graph(819, 418, 217, 209).\n\n\n\n\n\nCC:  @ivo-maffei @ferihr @vbraun\n\nBranch/Commit: b2673206665f09f15ba3ebc6b5b176d7825dd42a\n\nReviewer: Ivo Maffei, Ferdinand Ihringer\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26513\n\n",
    "closed_at": "2020-05-02T21:58:28Z",
    "created_at": "2018-10-20T08:05:31Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "bug in discovery of SRG' complements - related to twograph_descendant",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26513",
    "user": "https://github.com/dimpase"
}
```
as reported by Ferdinand Ihringer:

```
The following two graphs do not work, but their complement does:

graphs.strongly_regular_graph(539, 250, 105, 125)
graphs.strongly_regular_graph(779, 378, 177, 189)

Here the complement does not work:

graphs.strongly_regular_graph(819, 400, 190, 200)
graphs.strongly_regular_graph(819, 418, 217, 209)
```

```
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-1-5ba69562e41c> in <module>()
----> 1 graphs.strongly_regular_graph(Integer(539), Integer(250), Integer(105), Integer(125))

/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:44406)()
   2982                 return True
   2983             ans = f(*params)
-> 2984             return check_srg(ans[0](*ans[1:]))
   2985         if f(*params_complement):
   2986             if existence:

/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.is_twograph_descendant_of_srg.la (build/cythonized/sage/graphs/strongly_regular_db.c:23106)()
   1500                 def la(vv):
   1501                     from sage.combinat.designs.twographs import twograph_descendant
-> 1502                     g = strongly_regular_graph(vv, k, l - 2*mu + k)
   1503                     return twograph_descendant(g, next(g.vertex_iterator()),
   1504                                                name=True)

/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:45159)()
   3015             if existence:
   3016                 return True
-> 3017             raise RuntimeError(("Andries Brouwer's database claims that such a "+
   3018                                 "({},{},{},{})-strongly regular graph exists, but "+
   3019                                 "Sage does not know how to build it. If *you* do, "+

RuntimeError: Andries Brouwer's database claims that such a (540,245,100,120)-strongly regular graph exists, but Sage does not know how to build it. If *you* do, please get in touch with us on sage-devel!
Comments: 2-graph
sage:
sage: graphs.strongly_regular_graph(539, 288, 162, 144)
descendant of  at 0: Graph on 539 vertices
```


This is related to the missing in Sage constructions. 

In the first two cases graphs can be constructed using 2-graph descendant from Fickus et al SRGs (cf Brouwer's tables, not yet implemented in Sage), while their complements are
constructed using 2-graph descendant from known to Sage SRGs.

This illustrates a bug in discovery of SRGs via taking complements.


In the last case graphs can be constructed using 2-graph descendant from Fickus et al SRGs (cf Brouwer's tables, not yet implemented in Sage) or their complements.

There is also a discrepancy: the database gets broken after trying to build graphs.strongly_regular_graph(819, 400, 190, 200)
graphs.strongly_regular_graph(819, 418, 217, 209).





CC:  @ivo-maffei @ferihr @vbraun

Branch/Commit: b2673206665f09f15ba3ebc6b5b176d7825dd42a

Reviewer: Ivo Maffei, Ferdinand Ihringer

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26513





---

archive/issue_comments_369872.json:
```json
{
    "body": "<a id='comment:1'></a>There is also a bug with the database getting corrupt by an attempt to build an SRG:\n\n```\n\u2502 SageMath version 8.4, Release Date: 2018-10-17\nsage: graphs.strongly_regular_graph(819,418,217,209)\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-1-b80bcfe45035> in <module>()\n----> 1 graphs.strongly_regular_graph(Integer(819),Integer(418),Integer(217),Integer(209))\n\n/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:44406)()\n   2982                 return True\n   2983             ans = f(*params)\n-> 2984             return check_srg(ans[0](*ans[1:]))\n   2985         if f(*params_complement):\n   2986             if existence:\n\n/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.is_twograph_descendant_of_srg.la (build/cythonized/sage/graphs/strongly_regular_db.c:23106)()\n   1500                 def la(vv):\n   1501                     from sage.combinat.designs.twographs import twograph_descendant\n-> 1502                     g = strongly_regular_graph(vv, k, l - 2*mu + k)\n   1503                     return twograph_descendant(g, next(g.vertex_iterator()),\n   1504                                                name=True)\n\n/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:45159)()\n   3015             if existence:\n   3016                 return True\n-> 3017             raise RuntimeError((\"Andries Brouwer's database claims that such a \"+\n   3018                                 \"({},{},{},{})-strongly regular graph exists, but \"+\n   3019                                 \"Sage does not know how to build it. If *you* do, \"+\n\nRuntimeError: Andries Brouwer's database claims that such a (820,429,228,220)-strongly regular graph exists, but Sage does not know how to build it. If *you* do, please get in touch with us on sage-devel!\nComments: from ETF <a href=\"srgtabrefs.html#Fickus_et_al16\">Fickus et al.</a>; 2-graph\nsage: from sage.graphs.strongly_regular_db import _check_database\nsage: _check_database()\nSage cannot build a (512  133  24   38  ) that exists. Comment from Brouwer's database: <a href=\"srgtabrefs.html#Godsil92\">Godsil</a>(q=8,r=3); pg(7,18,2)?\nSage cannot build a (512  378  282  270 ) that exists. Comment from Brouwer's database: \nSage cannot build a (540  245  100  120 ) that exists. Comment from Brouwer's database: 2-graph\nSage cannot build a (540  294  168  150 ) that exists. Comment from Brouwer's database: from 2-(45,5,1) with 1-factor <a href=\"srgtabrefs.html#Fickus_et_al15\">Fickus et al.</a>; 2-graph\nSage cannot build a (780  369  168  180 ) that exists. Comment from Brouwer's database: 2-graph\nSage cannot build a (780  410  220  210 ) that exists. Comment from Brouwer's database: from 2-(39,3,1) with 1-factor <a href=\"srgtabrefs.html#Fickus_et_al15\">Fickus et al.</a>; 2-graph\nSage cannot build a (820  390  180  190 ) that exists. Comment from Brouwer's database: 2-graph\nSage cannot build a (820  429  228  220 ) that exists. Comment from Brouwer's database: from ETF <a href=\"srgtabrefs.html#Fickus_et_al16\">Fickus et al.</a>; 2-graph\n\nIn Andries Brouwer's database:\n- 462 impossible entries\n- 2916 undecided entries\n- 1160 realizable entries (Sage misses 8 of them)\n```\nwhereas if the 1st call is not run then as expected one gets two more missing entries:\n\n```\nSage cannot build a (819  400  190  200 ) that exists. Comment from Brouwer's database: pg(20,19,10)?; 2-graph*\nSage cannot build a (819  418  217  209 ) that exists. Comment from Brouwer's database: from ETF <a href=\"srgtabrefs.html#Fickus_et_al16\">Fickus et al.</a>; 2-graph*\n```\nand the final count of missing graphs is 10.",
    "created_at": "2018-10-20T08:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369872",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>There is also a bug with the database getting corrupt by an attempt to build an SRG:

```
â”‚ SageMath version 8.4, Release Date: 2018-10-17
sage: graphs.strongly_regular_graph(819,418,217,209)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-1-b80bcfe45035> in <module>()
----> 1 graphs.strongly_regular_graph(Integer(819),Integer(418),Integer(217),Integer(209))

/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:44406)()
   2982                 return True
   2983             ans = f(*params)
-> 2984             return check_srg(ans[0](*ans[1:]))
   2985         if f(*params_complement):
   2986             if existence:

/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.is_twograph_descendant_of_srg.la (build/cythonized/sage/graphs/strongly_regular_db.c:23106)()
   1500                 def la(vv):
   1501                     from sage.combinat.designs.twographs import twograph_descendant
-> 1502                     g = strongly_regular_graph(vv, k, l - 2*mu + k)
   1503                     return twograph_descendant(g, next(g.vertex_iterator()),
   1504                                                name=True)

/home/dimpase/Sage/sagetrac-mirror/local/lib/python2.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:45159)()
   3015             if existence:
   3016                 return True
-> 3017             raise RuntimeError(("Andries Brouwer's database claims that such a "+
   3018                                 "({},{},{},{})-strongly regular graph exists, but "+
   3019                                 "Sage does not know how to build it. If *you* do, "+

RuntimeError: Andries Brouwer's database claims that such a (820,429,228,220)-strongly regular graph exists, but Sage does not know how to build it. If *you* do, please get in touch with us on sage-devel!
Comments: from ETF <a href="srgtabrefs.html#Fickus_et_al16">Fickus et al.</a>; 2-graph
sage: from sage.graphs.strongly_regular_db import _check_database
sage: _check_database()
Sage cannot build a (512  133  24   38  ) that exists. Comment from Brouwer's database: <a href="srgtabrefs.html#Godsil92">Godsil</a>(q=8,r=3); pg(7,18,2)?
Sage cannot build a (512  378  282  270 ) that exists. Comment from Brouwer's database: 
Sage cannot build a (540  245  100  120 ) that exists. Comment from Brouwer's database: 2-graph
Sage cannot build a (540  294  168  150 ) that exists. Comment from Brouwer's database: from 2-(45,5,1) with 1-factor <a href="srgtabrefs.html#Fickus_et_al15">Fickus et al.</a>; 2-graph
Sage cannot build a (780  369  168  180 ) that exists. Comment from Brouwer's database: 2-graph
Sage cannot build a (780  410  220  210 ) that exists. Comment from Brouwer's database: from 2-(39,3,1) with 1-factor <a href="srgtabrefs.html#Fickus_et_al15">Fickus et al.</a>; 2-graph
Sage cannot build a (820  390  180  190 ) that exists. Comment from Brouwer's database: 2-graph
Sage cannot build a (820  429  228  220 ) that exists. Comment from Brouwer's database: from ETF <a href="srgtabrefs.html#Fickus_et_al16">Fickus et al.</a>; 2-graph

In Andries Brouwer's database:
- 462 impossible entries
- 2916 undecided entries
- 1160 realizable entries (Sage misses 8 of them)
```
whereas if the 1st call is not run then as expected one gets two more missing entries:

```
Sage cannot build a (819  400  190  200 ) that exists. Comment from Brouwer's database: pg(20,19,10)?; 2-graph*
Sage cannot build a (819  418  217  209 ) that exists. Comment from Brouwer's database: from ETF <a href="srgtabrefs.html#Fickus_et_al16">Fickus et al.</a>; 2-graph*
```
and the final count of missing graphs is 10.



---

archive/issue_comments_369873.json:
```json
{
    "body": "<a id='comment:2'></a>The following patch fixes the discovery (but not the database inconsistency, which is a different story):\n\n```diff\ndiff --git a/src/sage/graphs/strongly_regular_db.pyx b/src/sage/graphs/strongly_regular_db.pyx\nindex e8ece2dca0..e4e3fd0189 100644\n--- a/src/sage/graphs/strongly_regular_db.pyx\n+++ b/src/sage/graphs/strongly_regular_db.pyx\n@@ -2981,12 +2981,18 @@ def strongly_regular_graph(int v,int k,int l,int mu=-1,bint existence=False,bint\n             if existence:\n                 return True\n             ans = f(*params)\n-            return check_srg(ans[0](*ans[1:]))\n+            try:\n+                return check_srg(ans[0](*ans[1:]))\n+            except RuntimeError: # try the complement\n+                pass\n         if f(*params_complement):\n             if existence:\n                 return True\n             ans = f(*params_complement)\n-            return check_srg(ans[0](*ans[1:]).complement())\n+            try:\n+                return check_srg(ans[0](*ans[1:]).complement())\n+            except RuntimeError: # try more functions\n+                pass\n \n     # From now on, we have no idea how to build the graph.\n     #\n```",
    "created_at": "2018-12-03T19:16:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369873",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>The following patch fixes the discovery (but not the database inconsistency, which is a different story):

```diff
diff --git a/src/sage/graphs/strongly_regular_db.pyx b/src/sage/graphs/strongly_regular_db.pyx
index e8ece2dca0..e4e3fd0189 100644
--- a/src/sage/graphs/strongly_regular_db.pyx
+++ b/src/sage/graphs/strongly_regular_db.pyx
@@ -2981,12 +2981,18 @@ def strongly_regular_graph(int v,int k,int l,int mu=-1,bint existence=False,bint
             if existence:
                 return True
             ans = f(*params)
-            return check_srg(ans[0](*ans[1:]))
+            try:
+                return check_srg(ans[0](*ans[1:]))
+            except RuntimeError: # try the complement
+                pass
         if f(*params_complement):
             if existence:
                 return True
             ans = f(*params_complement)
-            return check_srg(ans[0](*ans[1:]).complement())
+            try:
+                return check_srg(ans[0](*ans[1:]).complement())
+            except RuntimeError: # try more functions
+                pass
 
     # From now on, we have no idea how to build the graph.
     #
```



---

archive/issue_comments_369874.json:
```json
{
    "body": "<a id='comment:3'></a>here is a quick fix for all the issues here\n\n```diff\n--- a/src/sage/graphs/strongly_regular_db.pyx\n+++ b/src/sage/graphs/strongly_regular_db.pyx\n@@ -1484,12 +1484,15 @@ def is_twograph_descendant_of_srg(int v, int k0, int l, int mu):\n             k = int(kf)\n             if k == kf and \\\n                 strongly_regular_graph(v+1, k, l - 2*mu + k , k - mu,  existence=True) is True:\n-                def la(vv):\n-                    from sage.combinat.designs.twographs import twograph_descendant\n-                    g = strongly_regular_graph(vv, k, l - 2*mu + k)\n-                    return twograph_descendant(g, next(g.vertex_iterator()),\n-                                               name=True)\n-                return la, v + 1\n+                try:\n+                    g = strongly_regular_graph(v+1, k, l - 2*mu + k) # Sage might not know how to build g\n+                    def la(gg):\n+                        from sage.combinat.designs.twographs import twograph_descendant\n+                        return twograph_descendant(gg, next(gg.vertex_iterator()),\n+                                                   name=True)\n+                    return la, g \n+                except RuntimeError:\n```\n\nbasically, `la()` must keep its promise to return a graph if called, but currently it does not if `g` can't be built, due to an absent implementation.\nA naive way (in the patch) is just to try to actually build `g` first.",
    "created_at": "2020-04-03T17:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369874",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>here is a quick fix for all the issues here

```diff
--- a/src/sage/graphs/strongly_regular_db.pyx
+++ b/src/sage/graphs/strongly_regular_db.pyx
@@ -1484,12 +1484,15 @@ def is_twograph_descendant_of_srg(int v, int k0, int l, int mu):
             k = int(kf)
             if k == kf and \
                 strongly_regular_graph(v+1, k, l - 2*mu + k , k - mu,  existence=True) is True:
-                def la(vv):
-                    from sage.combinat.designs.twographs import twograph_descendant
-                    g = strongly_regular_graph(vv, k, l - 2*mu + k)
-                    return twograph_descendant(g, next(g.vertex_iterator()),
-                                               name=True)
-                return la, v + 1
+                try:
+                    g = strongly_regular_graph(v+1, k, l - 2*mu + k) # Sage might not know how to build g
+                    def la(gg):
+                        from sage.combinat.designs.twographs import twograph_descendant
+                        return twograph_descendant(gg, next(gg.vertex_iterator()),
+                                                   name=True)
+                    return la, g 
+                except RuntimeError:
```

basically, `la()` must keep its promise to return a graph if called, but currently it does not if `g` can't be built, due to an absent implementation.
A naive way (in the patch) is just to try to actually build `g` first.



---

archive/issue_comments_369875.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-06T03:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369875",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369876.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2020-04-06T03:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369876",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_events_065894.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-04-06T03:53:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26513#event-65894"
}
```



---

archive/issue_comments_369877.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-07T18:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369877",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369878.json:
```json
{
    "body": "<a id='comment:7'></a>I don't fully understand how the srg database works, but I looked at the new code and I see its point.\\\\\nThe `la` function contains a reference to `g[0]`, but `g` is defined in in the scope of `is_twograph_descendant_of_srg` and not returned. This seems weird (does not `g[0]` get destroyed?), but, after some tests, it looks like Cython makes it work, so I just want to \nbring it to your attention since you definitely know more than me how Cython works.\nApart from the above, the `la` function still contains some debugging code (lines 1489 and 1492).\nIn `strongly_regular_graph` the code that handles `mu == -1` (line 2838, 2839) is pointless as the same code is executed inside `strongly_regular_graph_lazy`.\\\\\nEverything else looks good!",
    "created_at": "2020-04-08T23:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369878",
    "user": "https://github.com/Ivo-Maffei"
}
```

<a id='comment:7'></a>I don't fully understand how the srg database works, but I looked at the new code and I see its point.\\
The `la` function contains a reference to `g[0]`, but `g` is defined in in the scope of `is_twograph_descendant_of_srg` and not returned. This seems weird (does not `g[0]` get destroyed?), but, after some tests, it looks like Cython makes it work, so I just want to 
bring it to your attention since you definitely know more than me how Cython works.
Apart from the above, the `la` function still contains some debugging code (lines 1489 and 1492).
In `strongly_regular_graph` the code that handles `mu == -1` (line 2838, 2839) is pointless as the same code is executed inside `strongly_regular_graph_lazy`.\\
Everything else looks good!



---

archive/issue_comments_369879.json:
```json
{
    "body": "<a id='comment:8'></a>The following works in the develop branch or 9.0, but no longer works with your version. It is the only set of parameters where I entcountered this issue, but I failed at automating my testing process.\n\n\n```\nsage: graphs.strongly_regular_graph(209, 100, 45, 50)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-3438f70cd243> in <module>()\n----> 1 graphs.strongly_regular_graph(Integer(209), Integer(100), Integer(45), Integer(50))\n\n/home/ferihr/git/sage/local/lib/python3.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:41956)()\n   2841     if existence is True:\n   2842         return g\n-> 2843     G = g[0](*g[1:])\n   2844     if check and (v,k,l,mu) != G.is_strongly_regular(parameters=True):\n   2845         params = (v,k,l,mu)\n\n/home/ferihr/git/sage/local/lib/python3.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.is_twograph_descendant_of_srg.la (build/cythonized/sage/graphs/strongly_regular_db.c:22420)()\n   1491                         from sage.combinat.designs.twographs import twograph_descendant\n   1492                     #    print(\"in la:\", g[0], gr)\n-> 1493                         gg = g[0](*gr)\n   1494                         if (gg.name() is None) or (gg.name() == ''):\n   1495                             gg = Graph(gg, name=str((v+1, k, l - 2*mu + k , k - mu))+\"-strongly regular graph\")\n\nTypeError: lambda27() takes exactly one argument (0 given)\n```",
    "created_at": "2020-04-09T17:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369879",
    "user": "https://github.com/ferihr"
}
```

<a id='comment:8'></a>The following works in the develop branch or 9.0, but no longer works with your version. It is the only set of parameters where I entcountered this issue, but I failed at automating my testing process.


```
sage: graphs.strongly_regular_graph(209, 100, 45, 50)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-3438f70cd243> in <module>()
----> 1 graphs.strongly_regular_graph(Integer(209), Integer(100), Integer(45), Integer(50))

/home/ferihr/git/sage/local/lib/python3.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.strongly_regular_graph (build/cythonized/sage/graphs/strongly_regular_db.c:41956)()
   2841     if existence is True:
   2842         return g
-> 2843     G = g[0](*g[1:])
   2844     if check and (v,k,l,mu) != G.is_strongly_regular(parameters=True):
   2845         params = (v,k,l,mu)

/home/ferihr/git/sage/local/lib/python3.7/site-packages/sage/graphs/strongly_regular_db.pyx in sage.graphs.strongly_regular_db.is_twograph_descendant_of_srg.la (build/cythonized/sage/graphs/strongly_regular_db.c:22420)()
   1491                         from sage.combinat.designs.twographs import twograph_descendant
   1492                     #    print("in la:", g[0], gr)
-> 1493                         gg = g[0](*gr)
   1494                         if (gg.name() is None) or (gg.name() == ''):
   1495                             gg = Graph(gg, name=str((v+1, k, l - 2*mu + k , k - mu))+"-strongly regular graph")

TypeError: lambda27() takes exactly one argument (0 given)
```



---

archive/issue_comments_369880.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-09T17:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369880",
    "user": "https://github.com/ferihr"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_369881.json:
```json
{
    "body": "<a id='comment:10'></a>Thanks, I noticed your helpful reviews only now, as somehow I stopped receiving email notifications. I'll work on this soon.",
    "created_at": "2020-04-11T14:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369881",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Thanks, I noticed your helpful reviews only now, as somehow I stopped receiving email notifications. I'll work on this soon.



---

archive/issue_comments_369882.json:
```json
{
    "body": "<a id='comment:11'></a>I had a look at the bug yesterday evening, and I believe the issues is the lambda function at line 2903. I think inserting `*` before `t` will fix it, but I have not done much testing. (another lambda function that probably needs the same fix can be found at line 2937)",
    "created_at": "2020-04-11T16:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369882",
    "user": "https://github.com/Ivo-Maffei"
}
```

<a id='comment:11'></a>I had a look at the bug yesterday evening, and I believe the issues is the lambda function at line 2903. I think inserting `*` before `t` will fix it, but I have not done much testing. (another lambda function that probably needs the same fix can be found at line 2937)



---

archive/issue_comments_369883.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 gh-Ivo-Maffei]:\n> I had a look at the bug yesterday evening, and I believe the issues is the lambda function at line 2903. I think inserting `*` before `t` will fix it, but I have not done much testing. (another lambda function that probably needs the same fix can be found at line 2937)\n\n\nYes, good catch, you are right about line 2903, it should be `lambda *t` to accommodate functions\nwithout arguments. On the line 2937 all the functions are with at least one argument,\nso it should be OK.",
    "created_at": "2020-04-12T08:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369883",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>Replying to [comment:11 gh-Ivo-Maffei]:
> I had a look at the bug yesterday evening, and I believe the issues is the lambda function at line 2903. I think inserting `*` before `t` will fix it, but I have not done much testing. (another lambda function that probably needs the same fix can be found at line 2937)


Yes, good catch, you are right about line 2903, it should be `lambda *t` to accommodate functions
without arguments. On the line 2937 all the functions are with at least one argument,
so it should be OK.



---

archive/issue_comments_369884.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-12T08:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369884",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369885.json:
```json
{
    "body": "<a id='comment:14'></a>OK, this appears to fix everything. To test every graph, one can run mentioned in the manual loop (you'll need gap_packages spkg installed):\n\n```\n        sage: from sage.graphs.strongly_regular_db import apparently_feasible_parameters\n        sage: for p in sorted(apparently_feasible_parameters(1300)):   # not tested\n        ....:     if graphs.strongly_regular_graph(*p,existence=True) is True: # not tested\n        ....:         try:                                             # not tested\n        ....:             _ = graphs.strongly_regular_graph(*p)        # not tested\n        ....:             print(p, \"built successfully\")               # not tested\n        ....:         except RuntimeError as e:                        # not tested\n        ....:             if 'Brouwer' not in str(e):                  # not tested\n        ....:                 raise                                    # not tested\n```",
    "created_at": "2020-04-12T08:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369885",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>OK, this appears to fix everything. To test every graph, one can run mentioned in the manual loop (you'll need gap_packages spkg installed):

```
        sage: from sage.graphs.strongly_regular_db import apparently_feasible_parameters
        sage: for p in sorted(apparently_feasible_parameters(1300)):   # not tested
        ....:     if graphs.strongly_regular_graph(*p,existence=True) is True: # not tested
        ....:         try:                                             # not tested
        ....:             _ = graphs.strongly_regular_graph(*p)        # not tested
        ....:             print(p, "built successfully")               # not tested
        ....:         except RuntimeError as e:                        # not tested
        ....:             if 'Brouwer' not in str(e):                  # not tested
        ....:                 raise                                    # not tested
```



---

archive/issue_comments_369886.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-12T08:24:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369886",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_369887.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-21T11:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369887",
    "user": "https://github.com/Ivo-Maffei"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369888.json:
```json
{
    "body": "<a id='comment:16'></a>Thanks!\n\nVolker, could this make it into 9.1? Just one file is touched, long-standing bug fixed.",
    "created_at": "2020-04-21T15:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369888",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>Thanks!

Volker, could this make it into 9.1? Just one file is touched, long-standing bug fixed.



---

archive/issue_comments_369889.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-23T22:33:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369889",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065895.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-23T22:33:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26513#event-65895"
}
```



---

archive/issue_comments_369890.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2020-04-25T08:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369890",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_369891.json:
```json
{
    "body": "<a id='comment:18'></a>On Python 2:\n\n```\n**********************************************************************\nFile \"src/sage/graphs/strongly_regular_db.pyx\", line 2812, in sage.graphs.strongly_regular_db.strongly_regular_graph\nFailed example:\n    graphs.strongly_regular_graph(209, 100, 45, 50)\nExpected:\n    descendant of complement(merging of S_7 on Circulant(6,[1,4])s) at 11: Graph on 209 vertices\nGot:\n    descendant of complement(merging of S_7 on Circulant(6,[1,4])s) at 1: Graph on 209 vertices\n**********************************************************************\n1 item had failures:\n   1 of  20 in sage.graphs.strongly_regular_db.strongly_regular_graph\n    [330 tests, 1 failure, 24.69 s]\n**********************************************************************\n```",
    "created_at": "2020-04-25T08:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369891",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:18'></a>On Python 2:

```
**********************************************************************
File "src/sage/graphs/strongly_regular_db.pyx", line 2812, in sage.graphs.strongly_regular_db.strongly_regular_graph
Failed example:
    graphs.strongly_regular_graph(209, 100, 45, 50)
Expected:
    descendant of complement(merging of S_7 on Circulant(6,[1,4])s) at 11: Graph on 209 vertices
Got:
    descendant of complement(merging of S_7 on Circulant(6,[1,4])s) at 1: Graph on 209 vertices
**********************************************************************
1 item had failures:
   1 of  20 in sage.graphs.strongly_regular_db.strongly_regular_graph
    [330 tests, 1 failure, 24.69 s]
**********************************************************************
```



---

archive/issue_comments_369892.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-04-25T08:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369892",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_065896.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-25T08:56:03Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26513#event-65896"
}
```



---

archive/issue_comments_369893.json:
```json
{
    "body": "<a id='comment:19'></a>New commits:",
    "created_at": "2020-04-26T06:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369893",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>New commits:



---

archive/issue_comments_369894.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-26T06:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369894",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369895.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-26T06:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369895",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369896.json:
```json
{
    "body": "<a id='comment:20'></a>OK, the trivial fix by replacing unstable indices by `...`",
    "created_at": "2020-04-26T06:02:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369896",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>OK, the trivial fix by replacing unstable indices by `...`



---

archive/issue_comments_369897.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-02T21:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26513#issuecomment-369897",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065897.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-05-02T21:58:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26513",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26513#event-65897"
}
```
