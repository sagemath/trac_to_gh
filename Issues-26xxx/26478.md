# Issue 26478: clean graph_plot_js.py, graph_list.py and graph_input.py

archive/issues_026241.json:
```json
{
    "body": "clean the files (PEP8) and simplify some tests\n\nCC:  @tscrim\n\nKeywords: py3, graph\n\nBranch/Commit: 2cf89df2339e0a1cb2e98fb0af9bc3ddeb0a993f\n\nReviewer: Travis Scrimshaw\n\nAuthor: David Coudert\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26478\n\n",
    "closed_at": "2018-10-24T21:10:51Z",
    "created_at": "2018-10-12T15:20:47Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "clean graph_plot_js.py, graph_list.py and graph_input.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26478",
    "user": "https://github.com/dcoudert"
}
```
clean the files (PEP8) and simplify some tests

CC:  @tscrim

Keywords: py3, graph

Branch/Commit: 2cf89df2339e0a1cb2e98fb0af9bc3ddeb0a993f

Reviewer: Travis Scrimshaw

Author: David Coudert

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26478





---

archive/issue_comments_509101.json:
```json
{
    "body": "Changing branch from \"\" to \"public/26478_cleaning\"",
    "created_at": "2018-10-12T15:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509101",
    "user": "https://github.com/dcoudert"
}
```

Changing branch from "" to "public/26478_cleaning"



---

archive/issue_comments_509102.json:
```json
{
    "body": "Changing commit from \"\" to \"8c579b08a5ac05ce2e4d840840bda79a5dad5654\"",
    "created_at": "2018-10-12T15:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509102",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "8c579b08a5ac05ce2e4d840840bda79a5dad5654"



---

archive/issue_comments_509103.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2018-10-12T15:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509103",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_509104.json:
```json
{
    "body": "<a id='comment:2'></a>The most significant changes are in `graph_input.py` as I changed some tests.",
    "created_at": "2018-10-12T15:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509104",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:2'></a>The most significant changes are in `graph_input.py` as I changed some tests.



---

archive/issue_comments_509105.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-clean the files (PEP8) and simplification of some tests\n+clean the files (PEP8) and simplify some tests\n \n Author: David Coudert\n \n``````\n",
    "created_at": "2018-10-12T15:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509105",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-clean the files (PEP8) and simplification of some tests
+clean the files (PEP8) and simplify some tests
 
 Author: David Coudert
 
``````




---

archive/issue_comments_509106.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-12T15:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509106",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_509107.json:
```json
{
    "body": "<a id='comment:3'></a>For this change:\n\n```diff\n-    if not loops and any(u in neighb for u,neighb in six.iteritems(M)):\n-        if loops is False:\n-            u = next(u for u,neighb in six.iteritems(M) if u in neighb)\n-            raise ValueError(\"The graph was built with loops=False but input M has a loop at {}.\".format(u))\n-        loops = True\n-    if loops is None:\n-        loops = False\n+    if any(not isinstance(M[u], dict) for u in M):\n+        raise ValueError(\"input dict must be a consistent format\")\n+\n+    if not loops:\n+        for u, neighb in six.iteritems(M):\n+            if u in neighb:\n+                if loops is False:\n+                    raise ValueError(\"the graph was built with loops=False but input M has a loop at {}\".format(u))\n+                loops = True\n+                break\n+        if loops is None:\n+            loops = False\n```\nthe `any` call is actually faster. Granted, your change will result in a faster error, but I think an error message being here is unexpected. Hence it is allowed to be slow. If someone really wants the extra speed and is using that test to separate cases, they should run their own test instead of catching the error (which is faster). So I am inclined to revert this.\n\nAlso, strictly speaking, the items for `INPUT:` are not sentences and do not end in a period (although some of them are sufficiently long with multiple parts that require it). While I was letting this slide when it was previously there, the ones you are adding should not have it.\n\nAll of the other changes LGTM.",
    "created_at": "2018-10-12T22:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509107",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>For this change:

```diff
-    if not loops and any(u in neighb for u,neighb in six.iteritems(M)):
-        if loops is False:
-            u = next(u for u,neighb in six.iteritems(M) if u in neighb)
-            raise ValueError("The graph was built with loops=False but input M has a loop at {}.".format(u))
-        loops = True
-    if loops is None:
-        loops = False
+    if any(not isinstance(M[u], dict) for u in M):
+        raise ValueError("input dict must be a consistent format")
+
+    if not loops:
+        for u, neighb in six.iteritems(M):
+            if u in neighb:
+                if loops is False:
+                    raise ValueError("the graph was built with loops=False but input M has a loop at {}".format(u))
+                loops = True
+                break
+        if loops is None:
+            loops = False
```
the `any` call is actually faster. Granted, your change will result in a faster error, but I think an error message being here is unexpected. Hence it is allowed to be slow. If someone really wants the extra speed and is using that test to separate cases, they should run their own test instead of catching the error (which is faster). So I am inclined to revert this.

Also, strictly speaking, the items for `INPUT:` are not sentences and do not end in a period (although some of them are sufficiently long with multiple parts that require it). While I was letting this slide when it was previously there, the ones you are adding should not have it.

All of the other changes LGTM.



---

archive/issue_comments_509108.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-13T08:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509108",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509109.json:
```json
{
    "body": "Changing commit from \"8c579b08a5ac05ce2e4d840840bda79a5dad5654\" to \"90f89b08b54400fd66e9b62c625aa1b2c823f313\"",
    "created_at": "2018-10-13T08:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8c579b08a5ac05ce2e4d840840bda79a5dad5654" to "90f89b08b54400fd66e9b62c625aa1b2c823f313"



---

archive/issue_comments_509110.json:
```json
{
    "body": "<a id='comment:5'></a>The following lines are apparently incompatible with Python 3 (see patchbot).\n\n```diff\n+        if any(u in neighb for u,neighb in six.iteritems(M)):\n+                u = next(u for u,neighb in six.iteritems(M) if u in neighb)\n```\n\n```diff\n+        if any(u in neighb for u, neighb in six.iteritems(D)):\n+                u = next(u for u, neighb in six.iteritems(M) if u in neighb)\n```\nIs there a special trick or should I turn these lines to for loops ?",
    "created_at": "2018-10-13T11:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509110",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>The following lines are apparently incompatible with Python 3 (see patchbot).

```diff
+        if any(u in neighb for u,neighb in six.iteritems(M)):
+                u = next(u for u,neighb in six.iteritems(M) if u in neighb)
```

```diff
+        if any(u in neighb for u, neighb in six.iteritems(D)):
+                u = next(u for u, neighb in six.iteritems(M) if u in neighb)
```
Is there a special trick or should I turn these lines to for loops ?



---

archive/issue_comments_509111.json:
```json
{
    "body": "<a id='comment:6'></a>No, no. It's just the patchbot prefering \"iteritems\" to \"six.iteritems\". Just change the imports accordingly.\n\nAnd once again, it is never mandatory to have all green lights from the patchbot, as the patchbot is not smart..",
    "created_at": "2018-10-13T12:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509111",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>No, no. It's just the patchbot prefering "iteritems" to "six.iteritems". Just change the imports accordingly.

And once again, it is never mandatory to have all green lights from the patchbot, as the patchbot is not smart..



---

archive/issue_comments_509112.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-13T13:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509113.json:
```json
{
    "body": "Changing commit from \"90f89b08b54400fd66e9b62c625aa1b2c823f313\" to \"93ea7bdd587ab946b3c68ebd9ef52d3407704ae0\"",
    "created_at": "2018-10-13T13:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "90f89b08b54400fd66e9b62c625aa1b2c823f313" to "93ea7bdd587ab946b3c68ebd9ef52d3407704ae0"



---

archive/issue_comments_509114.json:
```json
{
    "body": "<a id='comment:8'></a>Good to know. As I'm not Python 3 expert, I thought it could be something else.",
    "created_at": "2018-10-13T13:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509114",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>Good to know. As I'm not Python 3 expert, I thought it could be something else.



---

archive/issue_events_065813.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-10-18T15:17:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26478#event-65813"
}
```



---

archive/issue_comments_509115.json:
```json
{
    "body": "<a id='comment:10'></a>Doctest failures:\n\n```\nFile \"src/sage/graphs/digraph.py\", line 399, in sage.graphs.digraph.DiGraph\nFailed example:\n    D = DiGraph('IRAaDCIIOEOKcPWAo')\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: The string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short.\nGot:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: the string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short\n```\nand similar in `graph.py`. Once fixed and the patchbot comes back green, then it will be a positive review.",
    "created_at": "2018-10-19T15:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509115",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Doctest failures:

```
File "src/sage/graphs/digraph.py", line 399, in sage.graphs.digraph.DiGraph
Failed example:
    D = DiGraph('IRAaDCIIOEOKcPWAo')
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: The string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short.
Got:
    Traceback (most recent call last):
    ...
    RuntimeError: the string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short
```
and similar in `graph.py`. Once fixed and the patchbot comes back green, then it will be a positive review.



---

archive/issue_comments_509116.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-19T16:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509116",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509117.json:
```json
{
    "body": "Changing commit from \"93ea7bdd587ab946b3c68ebd9ef52d3407704ae0\" to \"62403cd23042e6f8697dba2800648a2946a0919b\"",
    "created_at": "2018-10-19T16:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509117",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "93ea7bdd587ab946b3c68ebd9ef52d3407704ae0" to "62403cd23042e6f8697dba2800648a2946a0919b"



---

archive/issue_comments_509118.json:
```json
{
    "body": "<a id='comment:12'></a>I fixed the doctests. Now waiting for the patchbot.",
    "created_at": "2018-10-19T16:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509118",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>I fixed the doctests. Now waiting for the patchbot.



---

archive/issue_comments_509119.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks.",
    "created_at": "2018-10-22T02:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509119",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Thanks.



---

archive/issue_comments_509120.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-10-22T02:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509120",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_509121.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-22T02:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509121",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_509122.json:
```json
{
    "body": "<a id='comment:14'></a>Merge conflict",
    "created_at": "2018-10-22T22:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509122",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>Merge conflict



---

archive/issue_comments_509123.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-10-22T22:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509123",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_509124.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-23T08:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509124",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509125.json:
```json
{
    "body": "Changing commit from \"62403cd23042e6f8697dba2800648a2946a0919b\" to \"2cf89df2339e0a1cb2e98fb0af9bc3ddeb0a993f\"",
    "created_at": "2018-10-23T08:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509125",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "62403cd23042e6f8697dba2800648a2946a0919b" to "2cf89df2339e0a1cb2e98fb0af9bc3ddeb0a993f"



---

archive/issue_comments_509126.json:
```json
{
    "body": "<a id='comment:16'></a>I fixed the merge conflict with 8.5.beta0",
    "created_at": "2018-10-23T08:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509126",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:16'></a>I fixed the merge conflict with 8.5.beta0



---

archive/issue_comments_509127.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-23T08:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509127",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_509128.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-23T16:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509128",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_509129.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-24T21:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509129",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_509130.json:
```json
{
    "body": "Changing branch from \"public/26478_cleaning\" to \"2cf89df2339e0a1cb2e98fb0af9bc3ddeb0a993f\"",
    "created_at": "2018-10-24T21:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26478#issuecomment-509130",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/26478_cleaning" to "2cf89df2339e0a1cb2e98fb0af9bc3ddeb0a993f"



---

archive/issue_events_065814.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-24T21:10:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26478",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26478#event-65814"
}
```
