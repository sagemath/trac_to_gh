# Issue 26922: Wrong f-vector for unbounded polyhedra

archive/issues_026685.json:
```json
{
    "body": "#28625 fixed the `f_vector` in the case of unpointed polyhedra/polyhedra with lines.\n\nWe add doctests showing that #28625 fixed a bug in `f_vector`.\n\nBefore:\n\n```\nsage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()\n(1, 2, 1)\n```\n\nBut this polyhedron does not have zero-dimensional faces, and #28625 has correctly changed that:\n\n```\nsage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()\n(1, 0, 2, 1)\n```\n\nAlso we add documentation, specifically warning users that the methods\n- `vertices`,\n- `vertices_list`,\n- `vertices_generator`\n- `vertices_matrix`,\n- `n_vertices`,\ntreat vertices of the `Vrepresentation` and not vertices of the polyhedron in the unpointed case.\n\nCC:  @jplab @mo271\n\nBranch/Commit: 1c5378cd38b1f65717a2556ae7dc9ca7f756a150\n\nReviewer: Jean-Philippe Labb\u00e9\n\nAuthor: Jonathan Kliem\n\nDependencies: #28625\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26922\n\n",
    "closed_at": "2019-10-28T23:51:27Z",
    "created_at": "2018-12-20T12:49:53Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Wrong f-vector for unbounded polyhedra",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26922",
    "user": "https://github.com/kliem"
}
```
#28625 fixed the `f_vector` in the case of unpointed polyhedra/polyhedra with lines.

We add doctests showing that #28625 fixed a bug in `f_vector`.

Before:

```
sage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()
(1, 2, 1)
```

But this polyhedron does not have zero-dimensional faces, and #28625 has correctly changed that:

```
sage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()
(1, 0, 2, 1)
```

Also we add documentation, specifically warning users that the methods
- `vertices`,
- `vertices_list`,
- `vertices_generator`
- `vertices_matrix`,
- `n_vertices`,
treat vertices of the `Vrepresentation` and not vertices of the polyhedron in the unpointed case.

CC:  @jplab @mo271

Branch/Commit: 1c5378cd38b1f65717a2556ae7dc9ca7f756a150

Reviewer: Jean-Philippe Labb√©

Author: Jonathan Kliem

Dependencies: #28625

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26922





---

archive/issue_comments_399470.json:
```json
{
    "body": "<a id='comment:1'></a>This will be probably solved at some point by\n#26887\nThe calculation is correct there.\n\nAlso it can be corrected quickly now by calculating the dimension of the first level in the face lattice.",
    "created_at": "2019-01-12T16:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399470",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>This will be probably solved at some point by
#26887
The calculation is correct there.

Also it can be corrected quickly now by calculating the dimension of the first level in the face lattice.



---

archive/issue_events_066636.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26922#event-66636"
}
```



---

archive/issue_comments_399471.json:
```json
{
    "body": "<a id='comment:2'></a>Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399471",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_events_066637.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-03-14T15:59:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26922#event-66637"
}
```



---

archive/issue_events_066638.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2019-03-14T15:59:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26922#event-66638"
}
```



---

archive/issue_comments_399472.json:
```json
{
    "body": "<a id='comment:4'></a>As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399472",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_events_066639.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:54:19Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26922#event-66639"
}
```



---

archive/issue_comments_399473.json:
```json
{
    "body": "<a id='comment:5'></a>In principle, the problem is that the face lattice has four elements, but the elements on the second level are not 0-dimensional, but 1-dimensional.\n\nSo, depending on the definition of the f-vector:\n\n* Counting the number of elements at each level of the face lattice\n* Vector counting the number of faces by dimension\n\nIt should return different things.\n\nOne thing that should be done, is to make this explicit in the documentation of `f_vector` once this ticket is fixed and give an example of the difference with unbounded polyhedra.",
    "created_at": "2019-07-22T12:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399473",
    "user": "https://github.com/jplab"
}
```

<a id='comment:5'></a>In principle, the problem is that the face lattice has four elements, but the elements on the second level are not 0-dimensional, but 1-dimensional.

So, depending on the definition of the f-vector:

* Counting the number of elements at each level of the face lattice
* Vector counting the number of faces by dimension

It should return different things.

One thing that should be done, is to make this explicit in the documentation of `f_vector` once this ticket is fixed and give an example of the difference with unbounded polyhedra.



---

archive/issue_comments_399474.json:
```json
{
    "body": "<a id='comment:6'></a>#27063 will change the calculation of the f-vector (hopefully soon) to make use of `CombinatorialPolyhedron`.\n\nThis will count the number of faces per dimension, as the docstring of `f_vector` states (there is a +2 or -2 two missing, as the first entry gives the -1-dimensional faces count.\n\nWe could make this ticket depend on #27063 and then just append the docstring accordingly.\n\nOne could also fix it for now (just append a few zeros according to `n_lines`).\n\nReplying to [comment:5 jipilab]:\n> In principle, the problem is that the face lattice has four elements, but the elements on the second level are not 0-dimensional, but 1-dimensional.\n> \n> So, depending on the definition of the f-vector:\n> \n> * Counting the number of elements at each level of the face lattice\n\n\nI think f-vectors of fixed dimension polyhedra should be have sums/addition.\nAlso if one considers how adding or deleting inequalities can alter the f-vector this is strange.\nAnyway, it's most important to be precise, which one we use. Adding a zero or deleting it, if one really depends one version is trivial.\n\n>  * Vector counting the number of faces by dimension\n \n> \n> It should return different things.\n> \n> One thing that should be done, is to make this explicit in the documentation of `f_vector` once this ticket is fixed and give an example of the difference with unbounded polyhedra.",
    "created_at": "2019-07-22T19:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399474",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>#27063 will change the calculation of the f-vector (hopefully soon) to make use of `CombinatorialPolyhedron`.

This will count the number of faces per dimension, as the docstring of `f_vector` states (there is a +2 or -2 two missing, as the first entry gives the -1-dimensional faces count.

We could make this ticket depend on #27063 and then just append the docstring accordingly.

One could also fix it for now (just append a few zeros according to `n_lines`).

Replying to [comment:5 jipilab]:
> In principle, the problem is that the face lattice has four elements, but the elements on the second level are not 0-dimensional, but 1-dimensional.
> 
> So, depending on the definition of the f-vector:
> 
> * Counting the number of elements at each level of the face lattice


I think f-vectors of fixed dimension polyhedra should be have sums/addition.
Also if one considers how adding or deleting inequalities can alter the f-vector this is strange.
Anyway, it's most important to be precise, which one we use. Adding a zero or deleting it, if one really depends one version is trivial.

>  * Vector counting the number of faces by dimension
 
> 
> It should return different things.
> 
> One thing that should be done, is to make this explicit in the documentation of `f_vector` once this ticket is fixed and give an example of the difference with unbounded polyhedra.



---

archive/issue_comments_399475.json:
```json
{
    "body": "<a id='comment:7'></a>ping!",
    "created_at": "2019-10-17T12:00:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399475",
    "user": "https://github.com/jplab"
}
```

<a id='comment:7'></a>ping!



---

archive/issue_comments_399476.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-18T09:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399476",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_399477.json:
```json
{
    "body": "<a id='comment:8'></a>#28625 fixes this.\n\nI added some tests, improved the documentation of `f_vector` and fixed a tiny typo.\n\n---\nNew commits:",
    "created_at": "2019-10-18T09:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399477",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>#28625 fixes this.

I added some tests, improved the documentation of `f_vector` and fixed a tiny typo.

---
New commits:



---

archive/issue_events_066640.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2019-10-18T09:41:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "milestone": "sage-9.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26922#event-66640"
}
```



---

archive/issue_comments_399478.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-19T10:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399478",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_399479.json:
```json
{
    "body": "<a id='comment:9'></a>It would be nice if the note that you gave be in a NOTE environment followed by an appropriate example illustrating what is meant.",
    "created_at": "2019-10-19T10:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399479",
    "user": "https://github.com/jplab"
}
```

<a id='comment:9'></a>It would be nice if the note that you gave be in a NOTE environment followed by an appropriate example illustrating what is meant.



---

archive/issue_comments_399480.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-22T12:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399480",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399481.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,8 +1,28 @@\n+#28625 fixed the \\`f_vector\\` in the case of unpointed polyhedra/polyhedra with lines.\n+\n+We add doctests showing that #28625 fixed a bug in \\`f_vector\\`.\n+\n+Before:\n+\n \\`\\`\\`\n sage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()\n (1, 2, 1)\n \\`\\`\\`\n-This polyhedron does not have zero-dimensional faces, does it?\n+\n+But this polyhedron does not have zero-dimensional faces, and #28625 has correctly changed that:\n+\n+\\`\\`\\`\n+sage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()\n+(1, 0, 2, 1)\n+\\`\\`\\`\n+\n+Also we add documentation, specifically warning users that the methods\n+- \\`vertices\\`,\n+- \\`vertices_list\\`,\n+- \\`vertices_generator\\`\n+- \\`vertices_matrix\\`,\n+- \\`n_vertices\\`,\n+treat vertices of the \\`Vrepresentation\\` and not vertices of the polyhedron in the unpointed case.\n \n Comment: 1\n \n```\n",
    "created_at": "2019-10-22T12:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399481",
    "user": "https://github.com/kliem"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,8 +1,28 @@
+#28625 fixed the \`f_vector\` in the case of unpointed polyhedra/polyhedra with lines.
+
+We add doctests showing that #28625 fixed a bug in \`f_vector\`.
+
+Before:
+
 \`\`\`
 sage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()
 (1, 2, 1)
 \`\`\`
-This polyhedron does not have zero-dimensional faces, does it?
+
+But this polyhedron does not have zero-dimensional faces, and #28625 has correctly changed that:
+
+\`\`\`
+sage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()
+(1, 0, 2, 1)
+\`\`\`
+
+Also we add documentation, specifically warning users that the methods
+- \`vertices\`,
+- \`vertices_list\`,
+- \`vertices_generator\`
+- \`vertices_matrix\`,
+- \`n_vertices\`,
+treat vertices of the \`Vrepresentation\` and not vertices of the polyhedron in the unpointed case.
 
 Comment: 1
 
```




---

archive/issue_comments_399482.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-22T12:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399482",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_399483.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-24T08:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399483",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_399484.json:
```json
{
    "body": "<a id='comment:12'></a>May I suggest the following:\n\n```diff\n\n-            In case of a polyhedron with lines (unpointed polyhedron),\n-            return the number of vertices of the ``Vrepresentation``.\n-            Wheras the polyhedron has no vertices, this number corresponds\n-            to the number of `k`-faces, where `k` is the number of lines.\n+            If the polyhedron has lines, returns the number of vertices in\n+            the ``Vrepresentation``. As the represented polyhedron has \n+            no 0-dimensional faces (i.e. vertices), this number corresponds\n+            to the number of `k`-faces, where `k` is the number of lines.\n```\n\nSomehow, even though I corrected the above warning. I do not like what it says at all for the following reason:\n\n```\nsage: P = Polyhedron(rays=[[1,0,0]],lines=[[0,1,0]])\nsage: P.vertices()\n(A vertex at (0, 0, 0),)\nsage: Q = Polyhedron(lines=[[0,1,0],[0,0,1]])\nsage: Q.vertices()\n(A vertex at (0, 0, 0),)\nsage: R = Polyhedron(rays=[[1,0,0],[0,1,0]],vertices=[[0,1,0],[1,0,0]],lines=[[0,0,1]])\nsage: R.vertices()\n(A vertex at (0, 1, 0), A vertex at (1, 0, 0))\n```\n\nIn Sage, the computational convention (or compromise) is that polyhedra without vertices in their V-representation still receive a canonically computed vertex in order to do computations.\n\nWith this in mind, the second sentence is wrong. Just look at the above polyhedron `R`. It has lines, and two vertices.\n\n---> This warning is more confusing than anything. Please rephrase taking the above three examples in mind and the convention in Sage.",
    "created_at": "2019-10-24T08:56:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399484",
    "user": "https://github.com/jplab"
}
```

<a id='comment:12'></a>May I suggest the following:

```diff

-            In case of a polyhedron with lines (unpointed polyhedron),
-            return the number of vertices of the ``Vrepresentation``.
-            Wheras the polyhedron has no vertices, this number corresponds
-            to the number of `k`-faces, where `k` is the number of lines.
+            If the polyhedron has lines, returns the number of vertices in
+            the ``Vrepresentation``. As the represented polyhedron has 
+            no 0-dimensional faces (i.e. vertices), this number corresponds
+            to the number of `k`-faces, where `k` is the number of lines.
```

Somehow, even though I corrected the above warning. I do not like what it says at all for the following reason:

```
sage: P = Polyhedron(rays=[[1,0,0]],lines=[[0,1,0]])
sage: P.vertices()
(A vertex at (0, 0, 0),)
sage: Q = Polyhedron(lines=[[0,1,0],[0,0,1]])
sage: Q.vertices()
(A vertex at (0, 0, 0),)
sage: R = Polyhedron(rays=[[1,0,0],[0,1,0]],vertices=[[0,1,0],[1,0,0]],lines=[[0,0,1]])
sage: R.vertices()
(A vertex at (0, 1, 0), A vertex at (1, 0, 0))
```

In Sage, the computational convention (or compromise) is that polyhedra without vertices in their V-representation still receive a canonically computed vertex in order to do computations.

With this in mind, the second sentence is wrong. Just look at the above polyhedron `R`. It has lines, and two vertices.

---> This warning is more confusing than anything. Please rephrase taking the above three examples in mind and the convention in Sage.



---

archive/issue_comments_399485.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-10-25T09:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399485",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_399486.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-10-25T09:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399486",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_399487.json:
```json
{
    "body": "<a id='comment:15'></a>Looks good to me now",
    "created_at": "2019-10-27T15:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399487",
    "user": "https://github.com/jplab"
}
```

<a id='comment:15'></a>Looks good to me now



---

archive/issue_comments_399488.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-10-27T15:39:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399488",
    "user": "https://github.com/jplab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_399489.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-10-28T23:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26922#issuecomment-399489",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_066641.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-10-28T23:51:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26922",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26922#event-66641"
}
```
