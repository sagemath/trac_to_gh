# Issue 26715: build/pkgs/gfortran/spkg-configure.m4 works incorrectly if CC and CXX are already there

archive/issues_026478.json:
```json
{
    "body": "As a result of refactoring configure.ac in #24919,\nabsence of (g)fortran now forces installation of full gcc, instead of just gfortran part of it.\n\nThis is particularly crucial on OSX, where we don't normally build full gcc any more, but only build gfortran.\n\nTo reproduce, move gfortran out of your PATH, and re-run ./configure. You'll see that now `gcc` and `gfortran` are scheduled for installation...\n\n\n\n**CC:**  @embray @jhpalmieri @vbraun @kiwifb\n\n**Keywords:** spkg-configure\n\n**Branch:** [3185e91e9da7ce92bb90b69a4ef55dd98432b4dd](https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd)\n\n**Reviewer:** Erik Bray\n\n**Author:** Fran\u00e7ois Bissey\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26715\n\n",
    "closed_at": "2018-11-21T19:54:53Z",
    "created_at": "2018-11-18T10:54:03Z",
    "labels": [
        "component: build: configure",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "build/pkgs/gfortran/spkg-configure.m4 works incorrectly if CC and CXX are already there",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26715",
    "user": "https://github.com/dimpase"
}
```
As a result of refactoring configure.ac in #24919,
absence of (g)fortran now forces installation of full gcc, instead of just gfortran part of it.

This is particularly crucial on OSX, where we don't normally build full gcc any more, but only build gfortran.

To reproduce, move gfortran out of your PATH, and re-run ./configure. You'll see that now `gcc` and `gfortran` are scheduled for installation...



**CC:**  @embray @jhpalmieri @vbraun @kiwifb

**Keywords:** spkg-configure

**Branch:** [3185e91e9da7ce92bb90b69a4ef55dd98432b4dd](https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd)

**Reviewer:** Erik Bray

**Author:** Fran√ßois Bissey

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/26715





---

archive/issue_comments_514868.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n-As a result of refactoring configure.ac in #24919, it appears that\n+As a result of refactoring configure.ac in #24919,\n absence of (g)fortran now forces installation of full gcc, instead of just gfortran part of it.\n \n This is particularly crucial on OSX, where we don't normally build full gcc any more, but only build gfortran.\n \n+To reproduce, move gfortran out of your PATH, and re-run ./configure. You'll see that now `gcc` and `gfortran` are scheduled for installation...\n \n+\n``````\n",
    "created_at": "2018-11-18T19:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514868",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
-As a result of refactoring configure.ac in #24919, it appears that
+As a result of refactoring configure.ac in #24919,
 absence of (g)fortran now forces installation of full gcc, instead of just gfortran part of it.
 
 This is particularly crucial on OSX, where we don't normally build full gcc any more, but only build gfortran.
 
+To reproduce, move gfortran out of your PATH, and re-run ./configure. You'll see that now `gcc` and `gfortran` are scheduled for installation...
 
+
``````




---

archive/issue_comments_514869.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt appears that all what's needed is\n\n```diff\n--- a/build/pkgs/gfortran/spkg-configure.m4\n+++ b/build/pkgs/gfortran/spkg-configure.m4\n@@ -14,7 +14,6 @@ SAGE_SPKG_CONFIGURE([gfortran], [\n         # compiler.\n         if test -z \"$FC\"; then\n             sage_spkg_install_gfortran=yes\n-            SAGE_MUST_INSTALL_GCC([a Fortran compiler is missing])\n         fi\n \n         # see http://www.gnu.org/software/hello/manual/autoconf/Fortran-Compiler.html\n```\n\nwith this change, and no gfortran in `PATH`, everything looks as it should after running `./configure`.\n\nCould someone with access to OSX please try this? (Don't forget to run ./bootstrap before\n./configure, i.e. you do need autotools for such a check...).",
    "created_at": "2018-11-18T19:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514869",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>
It appears that all what's needed is

```diff
--- a/build/pkgs/gfortran/spkg-configure.m4
+++ b/build/pkgs/gfortran/spkg-configure.m4
@@ -14,7 +14,6 @@ SAGE_SPKG_CONFIGURE([gfortran], [
         # compiler.
         if test -z "$FC"; then
             sage_spkg_install_gfortran=yes
-            SAGE_MUST_INSTALL_GCC([a Fortran compiler is missing])
         fi
 
         # see http://www.gnu.org/software/hello/manual/autoconf/Fortran-Compiler.html
```

with this change, and no gfortran in `PATH`, everything looks as it should after running `./configure`.

Could someone with access to OSX please try this? (Don't forget to run ./bootstrap before
./configure, i.e. you do need autotools for such a check...).



---

archive/issue_comments_514870.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is all a bit tricky. What control logic is there when you don't have gfortran (so that the above check will say `sage_spkg_install_gfortran=yes`) but gcc must be installed as well?",
    "created_at": "2018-11-18T21:17:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514870",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>
This is all a bit tricky. What control logic is there when you don't have gfortran (so that the above check will say `sage_spkg_install_gfortran=yes`) but gcc must be installed as well?



---

archive/issue_comments_514871.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [fbissey](#comment%3A3):\n> This is all a bit tricky. What control logic is there when you don't have gfortran (so that the above check will say `sage_spkg_install_gfortran=yes`) but gcc must be installed as well?\n\n\nThere is `build/pkgs/gcc/spkg-configure.m4` which should take care of this.",
    "created_at": "2018-11-18T21:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514871",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
Replying to [fbissey](#comment%3A3):
> This is all a bit tricky. What control logic is there when you don't have gfortran (so that the above check will say `sage_spkg_install_gfortran=yes`) but gcc must be installed as well?


There is `build/pkgs/gcc/spkg-configure.m4` which should take care of this.



---

archive/issue_comments_514872.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [dimpase](#comment%3A4):\n> Replying to [fbissey](#comment%3A3):\n> > This is all a bit tricky. What control logic is there when you don't have gfortran (so that the above check will say `sage_spkg_install_gfortran=yes`) but gcc must be installed as well?\n\n> \n> There is `build/pkgs/gcc/spkg-configure.m4` which should take care of this.\n\n\nIt doesn't but the the section of code you point too in the diff can only be reached if `sage_spkg_install_gcc` is no. Otherwise the variable I was worried about is set to no.\n\nThe only real issue to be careful here is that the gcc bit needs to be run before the gfortran bit. If we go by lexical order everything is fine in this particular case. But that may be something to remember if there is ever another package with an \"optional split\" or a where checking a dependency first is important.",
    "created_at": "2018-11-18T21:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514872",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>
Replying to [dimpase](#comment%3A4):
> Replying to [fbissey](#comment%3A3):
> > This is all a bit tricky. What control logic is there when you don't have gfortran (so that the above check will say `sage_spkg_install_gfortran=yes`) but gcc must be installed as well?

> 
> There is `build/pkgs/gcc/spkg-configure.m4` which should take care of this.


It doesn't but the the section of code you point too in the diff can only be reached if `sage_spkg_install_gcc` is no. Otherwise the variable I was worried about is set to no.

The only real issue to be careful here is that the gcc bit needs to be run before the gfortran bit. If we go by lexical order everything is fine in this particular case. But that may be something to remember if there is ever another package with an "optional split" or a where checking a dependency first is important.



---

archive/issue_comments_514873.json:
```json
{
    "body": "<a id='comment:6'></a>\nIt seems to be the case for \"package Bar provides functionality Foo\" kind of stuff that one can dive in :-P\n\nShould this Sage component be called YAPS (Yet Another Packaging System)? And by virtue of name it must be implemented in yaml...",
    "created_at": "2018-11-18T23:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514873",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>
It seems to be the case for "package Bar provides functionality Foo" kind of stuff that one can dive in :-P

Should this Sage component be called YAPS (Yet Another Packaging System)? And by virtue of name it must be implemented in yaml...



---

archive/issue_comments_514874.json:
```json
{
    "body": "<a id='comment:7'></a>\nAmusing. But more seriously your diff certainly point to an issue that needs to be fixed and is logically what we are after. However the line probably should be replaced with a notice. It was probably the intent in the first place. When do you intend to submit a branch for review?",
    "created_at": "2018-11-18T23:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514874",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>
Amusing. But more seriously your diff certainly point to an issue that needs to be fixed and is logically what we are after. However the line probably should be replaced with a notice. It was probably the intent in the first place. When do you intend to submit a branch for review?



---

archive/issue_comments_514875.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [fbissey](#comment%3A7):\n> Amusing. But more seriously your diff certainly point to an issue that needs to be fixed and is logically what we are after. However the line probably should be replaced with a notice. It was probably the intent in the first place. When do you intend to submit a branch for review?\n\n\nI think having some kind of notice was the intent, though written exactly as I did was probably a mistake on my part.  Looking at the diff from #24919, this is the original code I removed from `configure.ac`:\n\n```diff\n-# Check that the Fortran compiler accepts free-format source code\n-# (as opposed to the older fixed-format style from Fortran 77).\n-# This helps verify the compiler works too, so if some idiot\n-# sets FC to /usr/bin/ls, we will at least know it's\n-# not a working Fortran compiler.\n-AC_LANG(Fortran)\n-if test -z \"$FC\"; then\n-    need_to_install_gfortran=yes\n-else\n```\n\nand this is the equivalent code that was moved to `build/pkgs/gfortran/spkg-configure.m4`:\n\n```diff\n+        # Check that the Fortran compiler accepts free-format source code (as\n+        # opposed to the older fixed-format style from Fortran 77).\n+        # This helps verify the compiler works too, so if some idiot sets FC to\n+        # /usr/bin/ls, we will at least know it's not a working Fortran\n+        # compiler.\n+        if test -z \"$FC\"; then\n+            sage_spkg_install_gfortran=yes\n+            SAGE_MUST_INSTALL_GCC([a Fortran compiler is missing])\n+        fi\n```\n\nThe use of the `SAGE_MUST_INSTALL_GCC` macro here is a mistake.  It *might* be a remnant from before we created a separate \"gfortran\" package (that actually happened after I first introduced #24919, and while I tried to incorporate that change it looks like this might have been left in).\n\nAs Dima suggested it can just be removed and/or replaced with an `AC_MSG_NOTICE`.",
    "created_at": "2018-11-19T08:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514875",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Replying to [fbissey](#comment%3A7):
> Amusing. But more seriously your diff certainly point to an issue that needs to be fixed and is logically what we are after. However the line probably should be replaced with a notice. It was probably the intent in the first place. When do you intend to submit a branch for review?


I think having some kind of notice was the intent, though written exactly as I did was probably a mistake on my part.  Looking at the diff from #24919, this is the original code I removed from `configure.ac`:

```diff
-# Check that the Fortran compiler accepts free-format source code
-# (as opposed to the older fixed-format style from Fortran 77).
-# This helps verify the compiler works too, so if some idiot
-# sets FC to /usr/bin/ls, we will at least know it's
-# not a working Fortran compiler.
-AC_LANG(Fortran)
-if test -z "$FC"; then
-    need_to_install_gfortran=yes
-else
```

and this is the equivalent code that was moved to `build/pkgs/gfortran/spkg-configure.m4`:

```diff
+        # Check that the Fortran compiler accepts free-format source code (as
+        # opposed to the older fixed-format style from Fortran 77).
+        # This helps verify the compiler works too, so if some idiot sets FC to
+        # /usr/bin/ls, we will at least know it's not a working Fortran
+        # compiler.
+        if test -z "$FC"; then
+            sage_spkg_install_gfortran=yes
+            SAGE_MUST_INSTALL_GCC([a Fortran compiler is missing])
+        fi
```

The use of the `SAGE_MUST_INSTALL_GCC` macro here is a mistake.  It *might* be a remnant from before we created a separate "gfortran" package (that actually happened after I first introduced #24919, and while I tried to incorporate that change it looks like this might have been left in).

As Dima suggested it can just be removed and/or replaced with an `AC_MSG_NOTICE`.



---

archive/issue_comments_514876.json:
```json
{
    "body": "<a id='comment:10'></a>\nActually, I think there needs to be a bit more logic restructuring too.  That `fi` should be an `else`.  There's no point in checking `AC_FC_FREEFORM` if `$FC` is empty, as in the original code.",
    "created_at": "2018-11-19T08:16:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514876",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
Actually, I think there needs to be a bit more logic restructuring too.  That `fi` should be an `else`.  There's no point in checking `AC_FC_FREEFORM` if `$FC` is empty, as in the original code.



---

archive/issue_comments_514877.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'd say we're wedded to gfortran too much. As far as I know, [flang](https://github.com/flang-compiler/flang) is in a good state, and a good candidate to replace gfortran (well, yes, it's not that fast yet, but, OK...).\n\nThis ticket would be a good occasion to fix this, and check for presence of a meaningful Fortran compiler, not specifically gfortran.",
    "created_at": "2018-11-19T09:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514877",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
I'd say we're wedded to gfortran too much. As far as I know, [flang](https://github.com/flang-compiler/flang) is in a good state, and a good candidate to replace gfortran (well, yes, it's not that fast yet, but, OK...).

This ticket would be a good occasion to fix this, and check for presence of a meaningful Fortran compiler, not specifically gfortran.



---

archive/issue_comments_514878.json:
```json
{
    "body": "<a id='comment:12'></a>\nThis really isn't specifically about gfortran.  It is, in fact, just checking that a fortran compiler exists, and if not is installing gfortran.  Let's not overcomplicate things here:  We've identified a simple fix.  I'll attach a patch if no one else does.",
    "created_at": "2018-11-19T17:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514878",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
This really isn't specifically about gfortran.  It is, in fact, just checking that a fortran compiler exists, and if not is installing gfortran.  Let's not overcomplicate things here:  We've identified a simple fix.  I'll attach a patch if no one else does.



---

archive/issue_comments_514879.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [embray](#comment%3A12):\n> This really isn't specifically about gfortran.  It is, in fact, just checking that a fortran compiler exists, and if not is installing gfortran.  Let's not overcomplicate things here:  We've identified a simple fix.  I'll attach a patch if no one else does.\n\n\nPlease do.",
    "created_at": "2018-11-19T17:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514879",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
Replying to [embray](#comment%3A12):
> This really isn't specifically about gfortran.  It is, in fact, just checking that a fortran compiler exists, and if not is installing gfortran.  Let's not overcomplicate things here:  We've identified a simple fix.  I'll attach a patch if no one else does.


Please do.



---

archive/issue_comments_514880.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [dimpase](#comment%3A11):\n> I'd say we're wedded to gfortran too much. As far as I know, [flang](https://github.com/flang-compiler/flang) is in a good state, and a good candidate to replace gfortran (well, yes, it's not that fast yet, but, OK...).\n\n\nIf flang is pretty good, then can you open another ticket to add it as an optional package? It would be nice to have a quicker way to build Sage on OS X for users who don't want to install their own gfortran.",
    "created_at": "2018-11-19T20:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514880",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
Replying to [dimpase](#comment%3A11):
> I'd say we're wedded to gfortran too much. As far as I know, [flang](https://github.com/flang-compiler/flang) is in a good state, and a good candidate to replace gfortran (well, yes, it's not that fast yet, but, OK...).


If flang is pretty good, then can you open another ticket to add it as an optional package? It would be nice to have a quicker way to build Sage on OS X for users who don't want to install their own gfortran.



---

archive/issue_comments_514881.json:
```json
{
    "body": "<a id='comment:15'></a>\nflang does not run on OSX yet. It does run on Linux and FreeBSD, though.",
    "created_at": "2018-11-19T21:10:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514881",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
flang does not run on OSX yet. It does run on Linux and FreeBSD, though.



---

archive/issue_comments_514882.json:
```json
{
    "body": "<a id='comment:16'></a>\n`flang` is not the only option by far. When I started the work on `clang` I effectively widened the pool of C/C++ compiler usable - not limited to clang. In fact I compiled sage with the Intel C/C++ compiler (and gfortran) with minimal difficulties. But it's not widely advertised and certainly we cannot say it is supported. So widening fortran compiler is good and may be support a different one. \n\nBut building `flang`, OS X or not, is still a hardship. I am afraid Intel fortran will do horrible and unhelpful optimisation but should be tried and then there is the community PGI compiler. Those are closed sources but somewhat easily available across some platforms (may be not freeBSD).",
    "created_at": "2018-11-19T21:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514882",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:16'></a>
`flang` is not the only option by far. When I started the work on `clang` I effectively widened the pool of C/C++ compiler usable - not limited to clang. In fact I compiled sage with the Intel C/C++ compiler (and gfortran) with minimal difficulties. But it's not widely advertised and certainly we cannot say it is supported. So widening fortran compiler is good and may be support a different one. 

But building `flang`, OS X or not, is still a hardship. I am afraid Intel fortran will do horrible and unhelpful optimisation but should be tried and then there is the community PGI compiler. Those are closed sources but somewhat easily available across some platforms (may be not freeBSD).



---

archive/issue_comments_514883.json:
```json
{
    "body": "<a id='comment:17'></a>\nimho Sage should not be in business of building compilers.",
    "created_at": "2018-11-19T21:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514883",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
imho Sage should not be in business of building compilers.



---

archive/issue_comments_514884.json:
```json
{
    "body": "**Branch:** [u/fbissey/fortran](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/fortran)",
    "created_at": "2018-11-19T21:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514884",
    "user": "https://github.com/kiwifb"
}
```

**Branch:** [u/fbissey/fortran](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/fortran)



---

archive/issue_comments_514885.json:
```json
{
    "body": "**Commit:** [a666ff9ca7eaff96d8546b633391ab955b38e486](https://github.com/sagemath/sagetrac-mirror/commit/a666ff9ca7eaff96d8546b633391ab955b38e486)",
    "created_at": "2018-11-19T21:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514885",
    "user": "https://github.com/kiwifb"
}
```

**Commit:** [a666ff9ca7eaff96d8546b633391ab955b38e486](https://github.com/sagemath/sagetrac-mirror/commit/a666ff9ca7eaff96d8546b633391ab955b38e486)



---

archive/issue_comments_514886.json:
```json
{
    "body": "**Author:** Fran\u00e7ois Bissey",
    "created_at": "2018-11-19T21:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514886",
    "user": "https://github.com/kiwifb"
}
```

**Author:** Fran√ßois Bissey



---

archive/issue_comments_514887.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-11-19T21:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514887",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_514888.json:
```json
{
    "body": "<a id='comment:18'></a>\nOK does this branch satisfy everyone.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a666ff9ca7eaff96d8546b633391ab955b38e486\">a666ff9</a></td><td><code>Do not build gcc if only a fortran compiler is missing. More care about check logic. Don't restrict to gfortran.</code></td></tr></table>\n",
    "created_at": "2018-11-19T21:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514888",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>
OK does this branch satisfy everyone.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a666ff9ca7eaff96d8546b633391ab955b38e486">a666ff9</a></td><td><code>Do not build gcc if only a fortran compiler is missing. More care about check logic. Don't restrict to gfortran.</code></td></tr></table>




---

archive/issue_comments_514889.json:
```json
{
    "body": "**Changing commit** from \"[a666ff9ca7eaff96d8546b633391ab955b38e486](https://github.com/sagemath/sagetrac-mirror/commit/a666ff9ca7eaff96d8546b633391ab955b38e486)\" to \"[c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4](https://github.com/sagemath/sagetrac-mirror/commit/c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4)\".",
    "created_at": "2018-11-19T21:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a666ff9ca7eaff96d8546b633391ab955b38e486](https://github.com/sagemath/sagetrac-mirror/commit/a666ff9ca7eaff96d8546b633391ab955b38e486)" to "[c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4](https://github.com/sagemath/sagetrac-mirror/commit/c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4)".



---

archive/issue_comments_514890.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4\">c35c6ec</a></td><td><code>Correct spacing</code></td></tr></table>\n",
    "created_at": "2018-11-19T21:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514890",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4">c35c6ec</a></td><td><code>Correct spacing</code></td></tr></table>




---

archive/issue_comments_514891.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-11-19T22:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514891",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_514892.json:
```json
{
    "body": "<a id='comment:20'></a>\nStuff is broken, trying to figure out why.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4\">c35c6ec</a></td><td><code>Correct spacing</code></td></tr></table>\n",
    "created_at": "2018-11-19T22:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514892",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:20'></a>
Stuff is broken, trying to figure out why.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4">c35c6ec</a></td><td><code>Correct spacing</code></td></tr></table>




---

archive/issue_comments_514893.json:
```json
{
    "body": "<a id='comment:21'></a>\nOK that was weird. After running `bootstrap` even after nicely reworking the syntax in the best possible ways and even in M4sh, I still had an empty `else...fi` section where I expected `AC_FC_FREEFORM` to be expanded.\n\nIt seems like that macro doesn't really like to live in a conditional. In fact it looks like it goes next to AC_PROG_FC all by itself. AC_PROG_FC (and also CC and CXX) is currently called in `configure.ac`, `gcc/spkg-configure.m4` and of course `gfortran/spkg-configure.m4`. \n\nI also learned a few things about `AC_REQUIRE` in the process.",
    "created_at": "2018-11-19T23:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514893",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:21'></a>
OK that was weird. After running `bootstrap` even after nicely reworking the syntax in the best possible ways and even in M4sh, I still had an empty `else...fi` section where I expected `AC_FC_FREEFORM` to be expanded.

It seems like that macro doesn't really like to live in a conditional. In fact it looks like it goes next to AC_PROG_FC all by itself. AC_PROG_FC (and also CC and CXX) is currently called in `configure.ac`, `gcc/spkg-configure.m4` and of course `gfortran/spkg-configure.m4`. 

I also learned a few things about `AC_REQUIRE` in the process.



---

archive/issue_comments_514894.json:
```json
{
    "body": "<a id='comment:22'></a>\nI also did some testing with `FC=/bin/ls` because it was helpfully suggested in comments\n\n```\nchecking whether we are using the GNU Fortran compiler... no\nchecking whether /bin/ls accepts -g... no\nchecking for Fortran flag needed to accept free-form source... unknown\nconfigure: Your Fortran compiler does not accept free-format source code\nconfigure: which means the compiler is either seriously broken, or\nconfigure: is too old to build Sage.\nconfigure: === checking whether to install the gfortran SPKG ===\n```\nThis is also nicely triggered if there is no `FC` found so it is enough.",
    "created_at": "2018-11-20T00:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514894",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:22'></a>
I also did some testing with `FC=/bin/ls` because it was helpfully suggested in comments

```
checking whether we are using the GNU Fortran compiler... no
checking whether /bin/ls accepts -g... no
checking for Fortran flag needed to accept free-form source... unknown
configure: Your Fortran compiler does not accept free-format source code
configure: which means the compiler is either seriously broken, or
configure: is too old to build Sage.
configure: === checking whether to install the gfortran SPKG ===
```
This is also nicely triggered if there is no `FC` found so it is enough.



---

archive/issue_comments_514895.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2449240ab8629475607ad2184372dd3d53a62364\">2449240</a></td><td><code>Do not check for a fortran compiler in the C/C++ detection macro. Leave it to the fortran macro.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd\">3185e91</a></td><td><code>Extreme streamlining of fortran package macro.</code></td></tr></table>\n",
    "created_at": "2018-11-20T00:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514895",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2449240ab8629475607ad2184372dd3d53a62364">2449240</a></td><td><code>Do not check for a fortran compiler in the C/C++ detection macro. Leave it to the fortran macro.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd">3185e91</a></td><td><code>Extreme streamlining of fortran package macro.</code></td></tr></table>




---

archive/issue_comments_514896.json:
```json
{
    "body": "**Changing commit** from \"[c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4](https://github.com/sagemath/sagetrac-mirror/commit/c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4)\" to \"[3185e91e9da7ce92bb90b69a4ef55dd98432b4dd](https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd)\".",
    "created_at": "2018-11-20T00:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4](https://github.com/sagemath/sagetrac-mirror/commit/c35c6ec1cc26a843a4cfe79a807e5f324afe8dd4)" to "[3185e91e9da7ce92bb90b69a4ef55dd98432b4dd](https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd)".



---

archive/issue_comments_514897.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-11-20T00:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514897",
    "user": "https://github.com/kiwifb"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_514898.json:
```json
{
    "body": "<a id='comment:24'></a>\nI left the issue of multiple calls to `AC_PROG_*` for later overall. Just touched gcc for cosmetics really.",
    "created_at": "2018-11-20T00:15:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514898",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:24'></a>
I left the issue of multiple calls to `AC_PROG_*` for later overall. Just touched gcc for cosmetics really.



---

archive/issue_comments_514899.json:
```json
{
    "body": "<a id='comment:25'></a>\nFor the record I just built and successfully doctested sage with this ticket and the PGI fortran compiler. A couple of issues with doing that though. More about it in the morning before I move to Intel compilers.",
    "created_at": "2018-11-20T11:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514899",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>
For the record I just built and successfully doctested sage with this ticket and the PGI fortran compiler. A couple of issues with doing that though. More about it in the morning before I move to Intel compilers.



---

archive/issue_comments_514900.json:
```json
{
    "body": "<a id='comment:26'></a>\nBuilds for me on OS X Mojave with my gfortran compiler temporarily removed. The Sage `gfortran` package took more than twice as long to build as any other Sage package, which I think is typical, but also reinforces my hope that we can suggest other fortran compilers for use with Sage.",
    "created_at": "2018-11-20T17:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514900",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
Builds for me on OS X Mojave with my gfortran compiler temporarily removed. The Sage `gfortran` package took more than twice as long to build as any other Sage package, which I think is typical, but also reinforces my hope that we can suggest other fortran compilers for use with Sage.



---

archive/issue_comments_514901.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-11-20T18:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514901",
    "user": "https://github.com/embray"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_514902.json:
```json
{
    "body": "<a id='comment:27'></a>\nThe `AC_FC_FREEFORM` macro always got expanded in a strange place for me too, and I could never figure out exactly why!  I didn't realize it was already called automatically by `AC_PROG_FC`, so thank you for figuring that out.  This looks good to me.",
    "created_at": "2018-11-20T18:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514902",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>
The `AC_FC_FREEFORM` macro always got expanded in a strange place for me too, and I could never figure out exactly why!  I didn't realize it was already called automatically by `AC_PROG_FC`, so thank you for figuring that out.  This looks good to me.



---

archive/issue_comments_514903.json:
```json
{
    "body": "**Reviewer:** Erik Bray",
    "created_at": "2018-11-20T18:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514903",
    "user": "https://github.com/embray"
}
```

**Reviewer:** Erik Bray



---

archive/issue_comments_514904.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [jhpalmieri](#comment%3A26):\n> Builds for me on OS X Mojave with my gfortran compiler temporarily removed. The Sage `gfortran` package took more than twice as long to build as any other Sage package, which I think is typical, but also reinforces my hope that we can suggest other fortran compilers for use with Sage.\n\n\nThat's because this involves compiling most, if not all, of gcc and only installing the gfortran bits.",
    "created_at": "2018-11-20T18:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514904",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>
Replying to [jhpalmieri](#comment%3A26):
> Builds for me on OS X Mojave with my gfortran compiler temporarily removed. The Sage `gfortran` package took more than twice as long to build as any other Sage package, which I think is typical, but also reinforces my hope that we can suggest other fortran compilers for use with Sage.


That's because this involves compiling most, if not all, of gcc and only installing the gfortran bits.



---

archive/issue_comments_514905.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [embray](#comment%3A28):\n> Replying to [jhpalmieri](#comment%3A26):\n> > Builds for me on OS X Mojave with my gfortran compiler temporarily removed. The Sage `gfortran` package took more than twice as long to build as any other Sage package, which I think is typical, but also reinforces my hope that we can suggest other fortran compilers for use with Sage.\n\n> \n> That's because this involves compiling most, if not all, of gcc and only installing the gfortran bits.\n\n\nI understand that, I just wish we could build a fortran compiler more quickly. (That's why I install `/usr/local/bin/gfortran` on every OS X machine I use for Sage.)",
    "created_at": "2018-11-20T18:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514905",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>
Replying to [embray](#comment%3A28):
> Replying to [jhpalmieri](#comment%3A26):
> > Builds for me on OS X Mojave with my gfortran compiler temporarily removed. The Sage `gfortran` package took more than twice as long to build as any other Sage package, which I think is typical, but also reinforces my hope that we can suggest other fortran compilers for use with Sage.

> 
> That's because this involves compiling most, if not all, of gcc and only installing the gfortran bits.


I understand that, I just wish we could build a fortran compiler more quickly. (That's why I install `/usr/local/bin/gfortran` on every OS X machine I use for Sage.)



---

archive/issue_comments_514906.json:
```json
{
    "body": "<a id='comment:30'></a>\nTotally happy if someone wants to look into that.  Too bad flang is (according to Fran\u00e7ois) still difficult to install on macOS, which would defeat some of the purpose :(",
    "created_at": "2018-11-20T18:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514906",
    "user": "https://github.com/embray"
}
```

<a id='comment:30'></a>
Totally happy if someone wants to look into that.  Too bad flang is (according to Fran√ßois) still difficult to install on macOS, which would defeat some of the purpose :(



---

archive/issue_comments_514907.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [embray](#comment%3A30):\n> Totally happy if someone wants to look into that.  Too bad flang is (according to Fran\u00e7ois) still difficult to install on macOS, which would defeat some of the purpose :(\n\n\nIt's a pain on all OS full stop. I think you have to have a private patched build of llvm, you cannot reuse clang bits if you have them. I won't recommend PGI fortran (needs hand holding) but ifc may be fine, I can try other suggestions if I have access to them.",
    "created_at": "2018-11-20T18:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514907",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>
Replying to [embray](#comment%3A30):
> Totally happy if someone wants to look into that.  Too bad flang is (according to Fran√ßois) still difficult to install on macOS, which would defeat some of the purpose :(


It's a pain on all OS full stop. I think you have to have a private patched build of llvm, you cannot reuse clang bits if you have them. I won't recommend PGI fortran (needs hand holding) but ifc may be fine, I can try other suggestions if I have access to them.



---

archive/issue_comments_514908.json:
```json
{
    "body": "<a id='comment:32'></a>\nOK wrap up for people interested in using something like pgfortran, you can get it from https://www.pgroup.com/ .\nBefore anyone ask, you cannot currently use pgcc/pgc++ to compile sage because they don't pretend to be gcc unlike clang and Intel. sage still wants a compiler that at least pretend to be gcc.\n\nSet your environment\n\n```\nexport PATH=\"/path_to_compiler_prefix/bin:$PATH\"\nexport LDFLAGS=\"-Wl,-rpath=/path_to_compiler_prefix/lib\"\nexport FPICFLAGS=\"-fPIC\"\n./configure FC=pgfortran\n```\n`FPICFLAGS` is specific to R.\n\n* I will send a couple of PR to openblas. openblas's `f_check` script does a pretty good job of finding all the linking flags needed for your compiler. But in the case of PGI, specifically, ruins the results completely - literally  WTF? I will attach a patch for now.\n\n* R needs hand holding. Its configure script has section that are hand crafted instead of using autotools standard macros. The only reason I can think of for doing that is ignorance. This is why you have to define `FPICFLAGS` in advance for it. However, it is not sufficient for configure to work out how to mix fortran and C code. So once the build breaks with an error on R \n\n```\nFC=\"pgfortran -fPIC\" ./sage -i r\n```\nand once done resume the build normally.\n\nDon't define `FC=/path_to_compiler/my_fortran_compiler`. numpy's distutils extension get confused if you do that and scipy's compilation will fail because gnu options are passed to the compiler instead of appropriate ones.",
    "created_at": "2018-11-20T20:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514908",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:32'></a>
OK wrap up for people interested in using something like pgfortran, you can get it from https://www.pgroup.com/ .
Before anyone ask, you cannot currently use pgcc/pgc++ to compile sage because they don't pretend to be gcc unlike clang and Intel. sage still wants a compiler that at least pretend to be gcc.

Set your environment

```
export PATH="/path_to_compiler_prefix/bin:$PATH"
export LDFLAGS="-Wl,-rpath=/path_to_compiler_prefix/lib"
export FPICFLAGS="-fPIC"
./configure FC=pgfortran
```
`FPICFLAGS` is specific to R.

* I will send a couple of PR to openblas. openblas's `f_check` script does a pretty good job of finding all the linking flags needed for your compiler. But in the case of PGI, specifically, ruins the results completely - literally  WTF? I will attach a patch for now.

* R needs hand holding. Its configure script has section that are hand crafted instead of using autotools standard macros. The only reason I can think of for doing that is ignorance. This is why you have to define `FPICFLAGS` in advance for it. However, it is not sufficient for configure to work out how to mix fortran and C code. So once the build breaks with an error on R 

```
FC="pgfortran -fPIC" ./sage -i r
```
and once done resume the build normally.

Don't define `FC=/path_to_compiler/my_fortran_compiler`. numpy's distutils extension get confused if you do that and scipy's compilation will fail because gnu options are passed to the compiler instead of appropriate ones.



---

archive/issue_comments_514909.json:
```json
{
    "body": "patch to compile openblas properly with pgfortran",
    "created_at": "2018-11-20T20:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514909",
    "user": "https://github.com/kiwifb"
}
```

patch to compile openblas properly with pgfortran



---

archive/issue_comments_514910.json:
```json
{
    "body": "<a id='comment:33'></a>\nAttachment [pgfortran.patch](tarball://root/attachments/some-uuid/ticket26715/pgfortran.patch) by @dimpase created at 2018-11-20 20:29:16\n\nDoes non-Apple clang pretend to be GCC? How? Just wondering.",
    "created_at": "2018-11-20T20:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514910",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>
Attachment [pgfortran.patch](tarball://root/attachments/some-uuid/ticket26715/pgfortran.patch) by @dimpase created at 2018-11-20 20:29:16

Does non-Apple clang pretend to be GCC? How? Just wondering.



---

archive/issue_comments_514911.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [dimpase](#comment%3A33):\n> Does non-Apple clang pretend to be GCC? How? Just wondering.\n\n\nIt does. Compiler identification is by pragma, and clang on OS X or otherwise has the pragmas saying it is gcc-4.2.1. The intel compiler is a bit different, at installation time it will look at your default gcc install and mimic all the needed pragmas to fake it. Both compiler still have their own vendor pragmas. But by default `AC_PROG_CC` will test the gcc pragma to set the variable `IS_GCC` (or something like that) and both clang (any OS) and Intel will set it to `yes`.",
    "created_at": "2018-11-20T20:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514911",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:34'></a>
Replying to [dimpase](#comment%3A33):
> Does non-Apple clang pretend to be GCC? How? Just wondering.


It does. Compiler identification is by pragma, and clang on OS X or otherwise has the pragmas saying it is gcc-4.2.1. The intel compiler is a bit different, at installation time it will look at your default gcc install and mimic all the needed pragmas to fake it. Both compiler still have their own vendor pragmas. But by default `AC_PROG_CC` will test the gcc pragma to set the variable `IS_GCC` (or something like that) and both clang (any OS) and Intel will set it to `yes`.



---

archive/issue_comments_514912.json:
```json
{
    "body": "**Changing branch** from \"[u/fbissey/fortran](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/fortran)\" to \"[3185e91e9da7ce92bb90b69a4ef55dd98432b4dd](https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd)\".",
    "created_at": "2018-11-21T19:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514912",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/fbissey/fortran](https://github.com/sagemath/sagetrac-mirror/tree/u/fbissey/fortran)" to "[3185e91e9da7ce92bb90b69a4ef55dd98432b4dd](https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd)".



---

archive/issue_events_075160.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-21T19:54:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26715#event-75160"
}
```



---

archive/issue_comments_514913.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2018-11-21T19:54:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514913",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_514914.json:
```json
{
    "body": "<a id='comment:36'></a>\nAnd at last for those still interested I did a build with gcc+ifort (intel fortran compiler). Same kind of set up as for PGI. I had to also provide `LD_LIBRARY_PATH` for the compiler's libraries because they don't know how to find each other in the same folder :(\n\nopenblas need the upgrade to 0.3.3 because of this https://github.com/xianyi/OpenBLAS/issues/1548\n\nR is still fiddly and you still need to define `FPICFLAGS` manually. I think most of the difficulties there would disappear by using the intel compiler for C/C++ as well as fortran.\n\nAnyway everything was sorted and built properly sage works and pass its doctests with flying colours on linux.\n\nAdding intel for C/C++ requires adjustment in pari and possibly sqlite from what I remember. But this is an alternative that could really be made to work.",
    "created_at": "2018-11-23T00:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514914",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:36'></a>
And at last for those still interested I did a build with gcc+ifort (intel fortran compiler). Same kind of set up as for PGI. I had to also provide `LD_LIBRARY_PATH` for the compiler's libraries because they don't know how to find each other in the same folder :(

openblas need the upgrade to 0.3.3 because of this https://github.com/xianyi/OpenBLAS/issues/1548

R is still fiddly and you still need to define `FPICFLAGS` manually. I think most of the difficulties there would disappear by using the intel compiler for C/C++ as well as fortran.

Anyway everything was sorted and built properly sage works and pass its doctests with flying colours on linux.

Adding intel for C/C++ requires adjustment in pari and possibly sqlite from what I remember. But this is an alternative that could really be made to work.



---

archive/issue_comments_514915.json:
```json
{
    "body": "**Changing commit** from \"[3185e91e9da7ce92bb90b69a4ef55dd98432b4dd](https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd)\" to \"\".",
    "created_at": "2018-11-23T00:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514915",
    "user": "https://github.com/kiwifb"
}
```

**Changing commit** from "[3185e91e9da7ce92bb90b69a4ef55dd98432b4dd](https://github.com/sagemath/sagetrac-mirror/commit/3185e91e9da7ce92bb90b69a4ef55dd98432b4dd)" to "".



---

archive/issue_comments_514916.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"spkg-configure\".",
    "created_at": "2019-02-12T09:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26715",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26715#issuecomment-514916",
    "user": "https://github.com/dimpase"
}
```

**Changing keywords** from "" to "spkg-configure".
