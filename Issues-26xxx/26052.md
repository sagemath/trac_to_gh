# Issue 26052: Update to OpenBLAS 0.3.3

archive/issues_025815.json:
```json
{
    "body": "OpenBLAS 0.3.2 came out and was uploaded to Debian. When attempting to build the sage 8.3 Debian package (with one thread) with this version, OpenBLAS causes a crash during the docbuild, see attached log.\n\nA bug in OpenBLAS that involves the same error message (\"OpenBLAS : Program will terminate because you tried to start too many threads.\") is https://github.com/xianyi/OpenBLAS/issues/1641\n\nOur temporary workaround for now is to use Atlas (which we already used before for architectures which are not supported by OpenBLAS).\n\nPlease consider updating OpenBLAS in sage.\n\nOpenblas 0.3.3 is now out and the threading behavior which caused many bug reports is reverted for now.\nPrepared upstream tarball renamed to `OpenBLAS-0.3.3.tar.gz`\n* [http://sagetrac.lipn.univ-paris13.fr/sage/OpenBLAS-0.3.3.tar.gz](http://sagetrac.lipn.univ-paris13.fr/sage/OpenBLAS-0.3.3.tar.gz)\n\nCC:  jpflori @vbraun @jdemeyer @mo271 @thecaligarmo @kiwifb @embray @tscrim\n\nBranch/Commit: bdf02cf06a95139a09567548b5f93021413a9e12\n\nReviewer: Erik Bray\n\nAuthor: Fran\u00e7ois Bissey\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26052\n\n",
    "closed_at": "2018-12-01T13:43:33Z",
    "created_at": "2018-08-12T17:23:01Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Update to OpenBLAS 0.3.3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26052",
    "user": "https://github.com/tobihan"
}
```
OpenBLAS 0.3.2 came out and was uploaded to Debian. When attempting to build the sage 8.3 Debian package (with one thread) with this version, OpenBLAS causes a crash during the docbuild, see attached log.

A bug in OpenBLAS that involves the same error message ("OpenBLAS : Program will terminate because you tried to start too many threads.") is https://github.com/xianyi/OpenBLAS/issues/1641

Our temporary workaround for now is to use Atlas (which we already used before for architectures which are not supported by OpenBLAS).

Please consider updating OpenBLAS in sage.

Openblas 0.3.3 is now out and the threading behavior which caused many bug reports is reverted for now.
Prepared upstream tarball renamed to `OpenBLAS-0.3.3.tar.gz`
* [http://sagetrac.lipn.univ-paris13.fr/sage/OpenBLAS-0.3.3.tar.gz](http://sagetrac.lipn.univ-paris13.fr/sage/OpenBLAS-0.3.3.tar.gz)

CC:  jpflori @vbraun @jdemeyer @mo271 @thecaligarmo @kiwifb @embray @tscrim

Branch/Commit: bdf02cf06a95139a09567548b5f93021413a9e12

Reviewer: Erik Bray

Author: Fran√ßois Bissey

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26052





---

archive/issue_comments_387794.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [sage_8.3-openblas_error.log](tarball://root/attachments/some-uuid/ticket26052/sage_8.3-openblas_error.log) by @tobihan created at 2018-08-12 17:28:21",
    "created_at": "2018-08-12T17:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387794",
    "user": "https://github.com/tobihan"
}
```

<a id='comment:1'></a>Attachment [sage_8.3-openblas_error.log](tarball://root/attachments/some-uuid/ticket26052/sage_8.3-openblas_error.log) by @tobihan created at 2018-08-12 17:28:21



---

archive/issue_comments_387795.json:
```json
{
    "body": "<a id='comment:3'></a>I am not experiencing this problem in sage-on-gentoo. However I decided to only use \"regular threads\" and no \"openmp threads\" in openblas some time ago. I suspect that is why I am not affected at this stage. It may be that I have the wrong picture of threading in openblas as well.",
    "created_at": "2018-08-16T00:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387795",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:3'></a>I am not experiencing this problem in sage-on-gentoo. However I decided to only use "regular threads" and no "openmp threads" in openblas some time ago. I suspect that is why I am not affected at this stage. It may be that I have the wrong picture of threading in openblas as well.



---

archive/issue_comments_387796.json:
```json
{
    "body": "<a id='comment:4'></a>I believe the problem has been addressed in 0.3.3 where they decided to switch back to the previous behavior with threads until they have fixed all the issues that have cropped in 0.3.2.\n\nFor the record I am using 0.3.3 (without openmp threads) in my own sage-on-gentoo builds.",
    "created_at": "2018-10-25T22:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387796",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:4'></a>I believe the problem has been addressed in 0.3.3 where they decided to switch back to the previous behavior with threads until they have fixed all the issues that have cropped in 0.3.2.

For the record I am using 0.3.3 (without openmp threads) in my own sage-on-gentoo builds.



---

archive/issue_events_065054.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-11-14T04:31:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26052#event-65054"
}
```



---

archive/issue_comments_387797.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-14T04:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387797",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_387798.json:
```json
{
    "body": "<a id='comment:5'></a>All the cygwin patches failed but most of the bits appears to have been merged upstream. Still someone should check cygwin with this release.\n\n---\nNew commits:",
    "created_at": "2018-11-14T04:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387798",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>All the cygwin patches failed but most of the bits appears to have been merged upstream. Still someone should check cygwin with this release.

---
New commits:



---

archive/issue_comments_387799.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -6,6 +6,10 @@\n \n Please consider updating OpenBLAS in sage.\n \n+Openblas 0.3.3 is now out and the threading behavior which caused many bug reports is reverted for now.\n+Upstream tarball needs to be renamed to `OpenBLAS-0.3.3.tar.gz` and can be found at\n+* [https://github.com/xianyi/OpenBLAS/archive/v0.3.3.tar.gz](https://github.com/xianyi/OpenBLAS/archive/v0.3.3.tar.gz)\n+\n Summary: Update to OpenBLAS 0.3.2\n \n Issue created by migration from https://trac.sagemath.org/ticket/26052\n```\n",
    "created_at": "2018-11-14T04:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387799",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
```diff
--- 
+++ 
@@ -6,6 +6,10 @@
 
 Please consider updating OpenBLAS in sage.
 
+Openblas 0.3.3 is now out and the threading behavior which caused many bug reports is reverted for now.
+Upstream tarball needs to be renamed to `OpenBLAS-0.3.3.tar.gz` and can be found at
+* [https://github.com/xianyi/OpenBLAS/archive/v0.3.3.tar.gz](https://github.com/xianyi/OpenBLAS/archive/v0.3.3.tar.gz)
+
 Summary: Update to OpenBLAS 0.3.2
 
 Issue created by migration from https://trac.sagemath.org/ticket/26052
```




---

archive/issue_comments_387800.json:
```json
{
    "body": "<a id='comment:7'></a>I can confirm that the aforementioned cygwin-related patches should be safe to remove as I've had them accepted upstream for some time.  I'll still want to run tests on this though.  I think I can go ahead and get that started now.",
    "created_at": "2018-11-29T13:32:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387800",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>I can confirm that the aforementioned cygwin-related patches should be safe to remove as I've had them accepted upstream for some time.  I'll still want to run tests on this though.  I think I can go ahead and get that started now.



---

archive/issue_comments_387801.json:
```json
{
    "body": "<a id='comment:8'></a>I am rebasing this on 8.5.beta5 first though, though that shouldn't make too much difference.",
    "created_at": "2018-11-29T13:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387801",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>I am rebasing this on 8.5.beta5 first though, though that shouldn't make too much difference.



---

archive/issue_comments_387802.json:
```json
{
    "body": "<a id='comment:9'></a>Also I'm getting invalid checksum when I use the tarball downloaded from github...?",
    "created_at": "2018-11-29T13:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387802",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>Also I'm getting invalid checksum when I use the tarball downloaded from github...?



---

archive/issue_comments_387803.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 embray]:\n> Also I'm getting invalid checksum when I use the tarball downloaded from github...?\n\n\ncould you wget the tar file and rename it? That oh so clever github API might do something more than that...",
    "created_at": "2018-11-29T13:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387803",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>Replying to [comment:9 embray]:
> Also I'm getting invalid checksum when I use the tarball downloaded from github...?


could you wget the tar file and rename it? That oh so clever github API might do something more than that...



---

archive/issue_comments_387804.json:
```json
{
    "body": "<a id='comment:11'></a>hmm, no, indeed, it seems to be wrong (and as I came here from a duplicate ticket I had for the same task, I already had my tarfile all set...)\nWhat I get is md5 30e2f8d7317e84dde5a37152173848f1",
    "created_at": "2018-11-29T13:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387804",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>hmm, no, indeed, it seems to be wrong (and as I came here from a duplicate ticket I had for the same task, I already had my tarfile all set...)
What I get is md5 30e2f8d7317e84dde5a37152173848f1



---

archive/issue_comments_387805.json:
```json
{
    "body": "<a id='comment:12'></a>I'm not sure what you mean.  That's exactly what I did.  That's...disconcerting.  I would hope that tarballs downloaded from [GitHub](GitHub) wouldn't differ depending on when they were downloaded >_>",
    "created_at": "2018-11-29T13:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387805",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>I'm not sure what you mean.  That's exactly what I did.  That's...disconcerting.  I would hope that tarballs downloaded from [GitHub](GitHub) wouldn't differ depending on when they were downloaded >_>



---

archive/issue_comments_387806.json:
```json
{
    "body": "<a id='comment:13'></a>well, let us wait for NZ to comment on this",
    "created_at": "2018-11-29T14:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387806",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>well, let us wait for NZ to comment on this



---

archive/issue_comments_387807.json:
```json
{
    "body": "<a id='comment:14'></a>Either way I'm going ahead with building it.",
    "created_at": "2018-11-29T14:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387807",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>Either way I'm going ahead with building it.



---

archive/issue_comments_387808.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:12 embray]:\n> I'm not sure what you mean.  That's exactly what I did.  That's...disconcerting.  I would hope that tarballs downloaded from [GitHub](GitHub) wouldn't differ depending on when they were downloaded >_>\n\n\nUnfortunately, it is known to happen https://github.com/cschwan/sage-on-gentoo/issues/529 . It may be that the release are not cut properly since there are repos for which I have no issues. In any case github lets you upload your own tarball prepared with sdist and the like. And people should really do it.\n\nSo someone will have to host a reference tarball until it makes it to the sage mirror.",
    "created_at": "2018-11-29T19:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387808",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:15'></a>Replying to [comment:12 embray]:
> I'm not sure what you mean.  That's exactly what I did.  That's...disconcerting.  I would hope that tarballs downloaded from [GitHub](GitHub) wouldn't differ depending on when they were downloaded >_>


Unfortunately, it is known to happen https://github.com/cschwan/sage-on-gentoo/issues/529 . It may be that the release are not cut properly since there are repos for which I have no issues. In any case github lets you upload your own tarball prepared with sdist and the like. And people should really do it.

So someone will have to host a reference tarball until it makes it to the sage mirror.



---

archive/issue_comments_387809.json:
```json
{
    "body": "<a id='comment:16'></a>I've raised https://github.com/xianyi/OpenBLAS/issues/1891",
    "created_at": "2018-11-29T19:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387809",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>I've raised https://github.com/xianyi/OpenBLAS/issues/1891



---

archive/issue_comments_387810.json:
```json
{
    "body": "<a id='comment:17'></a>Ok, looks good to me otherwise.",
    "created_at": "2018-11-30T12:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387810",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>Ok, looks good to me otherwise.



---

archive/issue_comments_387811.json:
```json
{
    "body": "<a id='comment:18'></a>Ok added the tarball matching the checksum in the description. Since Erik says he is happy with it I am switching it to positive review.",
    "created_at": "2018-11-30T20:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387811",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:18'></a>Ok added the tarball matching the checksum in the description. Since Erik says he is happy with it I am switching it to positive review.



---

archive/issue_comments_387812.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+OpenBLAS 0.3.2 came out and was uploaded to Debian. When attempting to build the sage 8.3 Debian package (with one thread) with this version, OpenBLAS causes a crash during the docbuild, see attached log.\n \n+A bug in OpenBLAS that involves the same error message (\"OpenBLAS : Program will terminate because you tried to start too many threads.\") is https://github.com/xianyi/OpenBLAS/issues/1641\n+\n+Our temporary workaround for now is to use Atlas (which we already used before for architectures which are not supported by OpenBLAS).\n+\n+Please consider updating OpenBLAS in sage.\n+\n+Openblas 0.3.3 is now out and the threading behavior which caused many bug reports is reverted for now.\n+Prepared upstream tarball renamed to `OpenBLAS-0.3.3.tar.gz`\n+* [http://sagetrac.lipn.univ-paris13.fr/sage/OpenBLAS-0.3.3.tar.gz](http://sagetrac.lipn.univ-paris13.fr/sage/OpenBLAS-0.3.3.tar.gz)\n \n Summary: Update to OpenBLAS 0.3.2\n \n```\n",
    "created_at": "2018-11-30T20:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387812",
    "user": "https://github.com/kiwifb"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+OpenBLAS 0.3.2 came out and was uploaded to Debian. When attempting to build the sage 8.3 Debian package (with one thread) with this version, OpenBLAS causes a crash during the docbuild, see attached log.
 
+A bug in OpenBLAS that involves the same error message ("OpenBLAS : Program will terminate because you tried to start too many threads.") is https://github.com/xianyi/OpenBLAS/issues/1641
+
+Our temporary workaround for now is to use Atlas (which we already used before for architectures which are not supported by OpenBLAS).
+
+Please consider updating OpenBLAS in sage.
+
+Openblas 0.3.3 is now out and the threading behavior which caused many bug reports is reverted for now.
+Prepared upstream tarball renamed to `OpenBLAS-0.3.3.tar.gz`
+* [http://sagetrac.lipn.univ-paris13.fr/sage/OpenBLAS-0.3.3.tar.gz](http://sagetrac.lipn.univ-paris13.fr/sage/OpenBLAS-0.3.3.tar.gz)
 
 Summary: Update to OpenBLAS 0.3.2
 
```




---

archive/issue_comments_387813.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-30T20:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387813",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_387814.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-01T13:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26052#issuecomment-387814",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065055.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-01T13:43:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26052",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26052#event-65055"
}
```
