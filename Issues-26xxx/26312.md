# Issue 26312: Formal power series over large commutative rings

archive/issues_026312.json:
```json
{
    "body": "Assignee: @NatStapleton\n\nCC:  @nilesjohnson\n\nKeywords: formal power series, LazyPowerSeries\n\nThe goal of this project is to build software in Sage for doing lazy computation with multivariable formal power series over large commutative ring (such as the Lazard ring, which is a polynomial ring over the integers in an countable number of variables). \n\nWe will define power series by describing a function from a cartesian power of the natural numbers to the coefficient ring. We plan to manipulate such power series in a completely formal manner. For example, when two formal power series are added, the resulting formal power series is just a tree containing the node \"+\" with the two functions defining the formal power series as children. The only time computation of the coefficients occurs is when the user asks to \"view\" a power series out to some range. Then our goal is to perform the minimal amount of computation in order to show the resulting power series to the user to the specified precision.\n\nWe also introduce a class of commutative rings called \"IndRings\". They are simply sequential diagrams of finitely generated k-algebras, where k is a base ring that Sage knows about. An IndRing is defined by specifying a function from the natural numbers to finitely generated k-algebras and, for each natural number i, a map of k-algebras from the k-algebra associated to i to the k-algebra associated to i+1. \n\nA map of IndRings is a map of Ind-objects in finitely generated k-algebras. That is, it is given by specifying countable subsets S and T of the natural numbers and a surjective lax order preserving map f from S to T and a map of k-algebras from the k-algebra associated to an element s in S to the k-algebra associated to f(s). These maps are supposed to commute with all of the structure, but we will not check this in the software.\n\nWe also provide a way to promote a finitely generated k-algebra to an IndRing. \n\nGiven an IndRing, we define a n-variable power series over it by specifying a function 'b' from the natural numbers to the natural numbers and then a function from the n-tuples of natural numbers of total degree i (just the sum of the values in the n-tuple) to the b(i)'th ring in the IndRing. When the user asks to view the power series to degree 'i', the result will be a polynomial of total degree i over the b(i)'th ring in the IndRing.\n\nRelation to Power Series and Multivariate Power Series (the code already in Sage): \n\nWe built this code on top of the existing code. This code is not meant to be a replacement but to be an extension of the existing code. \n\nAs mentioned above, the formal power series in this code are functions from a cartesian power of the natural numbers to a ring (or IndRing as described above). These formal power series are manipulated completely formally, we keep track of a tree of operations that user has performed on their formal power series. \n\nHowever, when the user asks to view one of these formal power series out to some degree, then the formal power series in the leaves of the tree are used to construct multivariate power series (in the sense of Sage) and these multivariate power series are manipulated according to the operations in the tree using the existing Sage code. \n\nThere are two points at which something strange happens. \n\nFirst, if the user asks to apply reversion to a single variable formal power series, then we convert the multivariate power series into a power series (in the sense of Sage) and apply reversion and then convert the result back to a multivariable power series. \n\nSecond, we found the multiplication of multivariable power series to be slow. After looking at the code, we believe that this is due to the fact that the current code multiplies the underlying polynomials and then truncates the result. Of course, it is more efficient to only multiply terms that contribute to the product up to the degree that you are interested in. We have implemented this more efficient multiplication in this code and it is the default multiplication for formal power series. We also make use of this faster multiplication when the user asks to view the composite of certain formal power series.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26549\n\n",
    "created_at": "2018-10-24T20:46:53Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "title": "Formal power series over large commutative rings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26312",
    "user": "https://github.com/NatStapleton"
}
```
Assignee: @NatStapleton

CC:  @nilesjohnson

Keywords: formal power series, LazyPowerSeries

The goal of this project is to build software in Sage for doing lazy computation with multivariable formal power series over large commutative ring (such as the Lazard ring, which is a polynomial ring over the integers in an countable number of variables). 

We will define power series by describing a function from a cartesian power of the natural numbers to the coefficient ring. We plan to manipulate such power series in a completely formal manner. For example, when two formal power series are added, the resulting formal power series is just a tree containing the node "+" with the two functions defining the formal power series as children. The only time computation of the coefficients occurs is when the user asks to "view" a power series out to some range. Then our goal is to perform the minimal amount of computation in order to show the resulting power series to the user to the specified precision.

We also introduce a class of commutative rings called "IndRings". They are simply sequential diagrams of finitely generated k-algebras, where k is a base ring that Sage knows about. An IndRing is defined by specifying a function from the natural numbers to finitely generated k-algebras and, for each natural number i, a map of k-algebras from the k-algebra associated to i to the k-algebra associated to i+1. 

A map of IndRings is a map of Ind-objects in finitely generated k-algebras. That is, it is given by specifying countable subsets S and T of the natural numbers and a surjective lax order preserving map f from S to T and a map of k-algebras from the k-algebra associated to an element s in S to the k-algebra associated to f(s). These maps are supposed to commute with all of the structure, but we will not check this in the software.

We also provide a way to promote a finitely generated k-algebra to an IndRing. 

Given an IndRing, we define a n-variable power series over it by specifying a function 'b' from the natural numbers to the natural numbers and then a function from the n-tuples of natural numbers of total degree i (just the sum of the values in the n-tuple) to the b(i)'th ring in the IndRing. When the user asks to view the power series to degree 'i', the result will be a polynomial of total degree i over the b(i)'th ring in the IndRing.

Relation to Power Series and Multivariate Power Series (the code already in Sage): 

We built this code on top of the existing code. This code is not meant to be a replacement but to be an extension of the existing code. 

As mentioned above, the formal power series in this code are functions from a cartesian power of the natural numbers to a ring (or IndRing as described above). These formal power series are manipulated completely formally, we keep track of a tree of operations that user has performed on their formal power series. 

However, when the user asks to view one of these formal power series out to some degree, then the formal power series in the leaves of the tree are used to construct multivariate power series (in the sense of Sage) and these multivariate power series are manipulated according to the operations in the tree using the existing Sage code. 

There are two points at which something strange happens. 

First, if the user asks to apply reversion to a single variable formal power series, then we convert the multivariate power series into a power series (in the sense of Sage) and apply reversion and then convert the result back to a multivariable power series. 

Second, we found the multiplication of multivariable power series to be slow. After looking at the code, we believe that this is due to the fact that the current code multiplies the underlying polynomials and then truncates the result. Of course, it is more efficient to only multiply terms that contribute to the product up to the degree that you are interested in. We have implemented this more efficient multiplication in this code and it is the default multiplication for formal power series. We also make use of this faster multiplication when the user asks to view the composite of certain formal power series.

Issue created by migration from https://trac.sagemath.org/ticket/26549





---

archive/issue_comments_370230.json:
```json
{
    "body": "Set assignee to @NatStapleton.",
    "created_at": "2018-10-31T20:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370230",
    "user": "https://github.com/NatStapleton"
}
```

Set assignee to @NatStapleton.



---

archive/issue_comments_370231.json:
```json
{
    "body": "Attachment [FPS.sage](tarball://root/attachments/some-uuid/ticket26549/FPS.sage) by @NatStapleton created at 2018-11-14 21:39:44\n\nthe formal power series package, do \"sage --preparse FPS.sage\" to be able to import it",
    "created_at": "2018-11-14T21:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370231",
    "user": "https://github.com/NatStapleton"
}
```

Attachment [FPS.sage](tarball://root/attachments/some-uuid/ticket26549/FPS.sage) by @NatStapleton created at 2018-11-14 21:39:44

the formal power series package, do "sage --preparse FPS.sage" to be able to import it



---

archive/issue_comments_370232.json:
```json
{
    "body": "Attachment [IndRing.sage](tarball://root/attachments/some-uuid/ticket26549/IndRing.sage) by @NatStapleton created at 2018-11-14 21:41:06\n\nthe IndRing package, run \"sage --preparse IndRing.sage\", you may need to move IndRing.sage.py to IndRing.py.",
    "created_at": "2018-11-14T21:41:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370232",
    "user": "https://github.com/NatStapleton"
}
```

Attachment [IndRing.sage](tarball://root/attachments/some-uuid/ticket26549/IndRing.sage) by @NatStapleton created at 2018-11-14 21:41:06

the IndRing package, run "sage --preparse IndRing.sage", you may need to move IndRing.sage.py to IndRing.py.



---

archive/issue_comments_370233.json:
```json
{
    "body": "Examples that use our packages",
    "created_at": "2018-11-14T22:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370233",
    "user": "https://github.com/NatStapleton"
}
```

Examples that use our packages



---

archive/issue_comments_370234.json:
```json
{
    "body": "Attachment [examples.sage](tarball://root/attachments/some-uuid/ticket26549/examples.sage) by @nilesjohnson created at 2018-11-19 14:31:55",
    "created_at": "2018-11-19T14:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370234",
    "user": "https://github.com/nilesjohnson"
}
```

Attachment [examples.sage](tarball://root/attachments/some-uuid/ticket26549/examples.sage) by @nilesjohnson created at 2018-11-19 14:31:55



---

archive/issue_comments_370235.json:
```json
{
    "body": "Great!  I can't see the branch you've created -- perhaps it is not uploaded to trac?  Are you using the `git trac` command ([here](http://doc.sagemath.org/html/en/developer/git_trac.html#uploading-changes-to-trac))? Or using git directly (known as [the hard way](http://doc.sagemath.org/html/en/developer/manual_git.html#git-the-hard-way), but it's not that hard ;)?\n\nIn any case, one of the questions I know people will ask will be how this relates/integrates with the existing power series.  Can this be implemented as an add-on to the current interface? (maybe you've already done that in your branch?)\n\nAnother question will be some examples demonstrating differences in speed and memory usage in this implementation v.s. the current power series.  If you have any such examples, let me know.",
    "created_at": "2018-11-19T14:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370235",
    "user": "https://github.com/nilesjohnson"
}
```

Great!  I can't see the branch you've created -- perhaps it is not uploaded to trac?  Are you using the `git trac` command ([here](http://doc.sagemath.org/html/en/developer/git_trac.html#uploading-changes-to-trac))? Or using git directly (known as [the hard way](http://doc.sagemath.org/html/en/developer/manual_git.html#git-the-hard-way), but it's not that hard ;)?

In any case, one of the questions I know people will ask will be how this relates/integrates with the existing power series.  Can this be implemented as an add-on to the current interface? (maybe you've already done that in your branch?)

Another question will be some examples demonstrating differences in speed and memory usage in this implementation v.s. the current power series.  If you have any such examples, let me know.



---

archive/issue_events_065947.json:
```json
{
    "actor": "https://github.com/NatStapleton",
    "created_at": "2019-01-16T20:48:08Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26312#event-65947"
}
```



---

archive/issue_comments_370236.json:
```json
{
    "body": "Thanks!  I've been slow at getting to this, but it is on my list :)\n\n---\nNew commits:",
    "created_at": "2019-01-16T21:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370236",
    "user": "https://github.com/nilesjohnson"
}
```

Thanks!  I've been slow at getting to this, but it is on my list :)

---
New commits:



---

archive/issue_comments_370237.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-06T21:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370237",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370238.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-06T21:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370239.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-13T18:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370240.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-13T22:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370240",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370241.json:
```json
{
    "body": "I think this is good progress.  Eventually the examples should be folded in to the docstrings, so you might consider moving toward that format.  For example, the documentation for power series looks like this:\n\nhttps://doc.sagemath.org/html/en/reference/calculus/sage/symbolic/series.html\n\nand the source code is like this:\n\nhttps://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/symbolic/series.pyx\n\nSince there is a lot of stuff in your code, I will try to go through it in parts.  I'll start with  the `IndRing` stuff, unless you think there is a better place to start -- let me know :)",
    "created_at": "2019-02-14T17:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370241",
    "user": "https://github.com/nilesjohnson"
}
```

I think this is good progress.  Eventually the examples should be folded in to the docstrings, so you might consider moving toward that format.  For example, the documentation for power series looks like this:

https://doc.sagemath.org/html/en/reference/calculus/sage/symbolic/series.html

and the source code is like this:

https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/symbolic/series.pyx

Since there is a lot of stuff in your code, I will try to go through it in parts.  I'll start with  the `IndRing` stuff, unless you think there is a better place to start -- let me know :)



---

archive/issue_comments_370242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-20T22:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370243.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370243",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_065948.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26312#event-65948"
}
```



---

archive/issue_events_065949.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26312#event-65949"
}
```



---

archive/issue_comments_370244.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-03-27T19:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370244",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370245.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-10T21:21:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370245",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370246.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-17T20:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370247.json:
```json
{
    "body": ">  Second, we found the multiplication of multivariable power series to be slow. After looking at the code, we believe that this is due to the fact that the current code multiplies the underlying polynomials and then truncates the result. Of course, it is more efficient to only multiply terms that contribute to the product up to the degree that you are interested in. We have implemented this more efficient multiplication in this code and it is the default multiplication for formal power series. We also make use of this faster multiplication when the user asks to view the composite of certain formal power series. \n\n\nI think this should be split off as a separate ticket as it is of independent interest and would be good to get into Sage faster. `;)`",
    "created_at": "2019-04-17T22:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370247",
    "user": "https://github.com/tscrim"
}
```

>  Second, we found the multiplication of multivariable power series to be slow. After looking at the code, we believe that this is due to the fact that the current code multiplies the underlying polynomials and then truncates the result. Of course, it is more efficient to only multiply terms that contribute to the product up to the degree that you are interested in. We have implemented this more efficient multiplication in this code and it is the default multiplication for formal power series. We also make use of this faster multiplication when the user asks to view the composite of certain formal power series. 


I think this should be split off as a separate ticket as it is of independent interest and would be good to get into Sage faster. `;)`



---

archive/issue_comments_370248.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-15T19:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_065950.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:55:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26312#event-65950"
}
```



---

archive/issue_comments_370249.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370249",
    "user": "https://github.com/embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_370250.json:
```json
{
    "body": "Changing keywords from \"formal power series\" to \"formal power series, LazyPowerSeries\".",
    "created_at": "2022-09-15T20:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26312",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26312#issuecomment-370250",
    "user": "https://github.com/mantepse"
}
```

Changing keywords from "formal power series" to "formal power series, LazyPowerSeries".
