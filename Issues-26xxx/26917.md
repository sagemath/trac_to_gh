# Issue 26917: py3: some fix in set_partition

archive/issues_026680.json:
```json
{
    "body": "\n\n**CC:**  @tscrim\n\n**Branch/Commit:** [171f9885ff150378e69de4cdfeea2fb1d6b107ea](https://github.com/sagemath/sagetrac-mirror/commit/171f9885ff150378e69de4cdfeea2fb1d6b107ea)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, Martin Rubey\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26917\n\n",
    "closed_at": "2019-01-23T14:17:46Z",
    "created_at": "2018-12-19T19:24:57Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "py3: some fix in set_partition",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26917",
    "user": "https://github.com/fchapoton"
}
```


**CC:**  @tscrim

**Branch/Commit:** [171f9885ff150378e69de4cdfeea2fb1d6b107ea](https://github.com/sagemath/sagetrac-mirror/commit/171f9885ff150378e69de4cdfeea2fb1d6b107ea)

**Reviewer:** Frédéric Chapoton, Travis Scrimshaw

**Author:** Frédéric Chapoton, Martin Rubey

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/26917





---

archive/issue_comments_518782.json:
```json
{
    "body": "**Commit:** [1485eb091fe76fb6968431a2c715e48a701ab7b8](https://github.com/sagemath/sagetrac-mirror/commit/1485eb091fe76fb6968431a2c715e48a701ab7b8)",
    "created_at": "2018-12-19T19:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518782",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [1485eb091fe76fb6968431a2c715e48a701ab7b8](https://github.com/sagemath/sagetrac-mirror/commit/1485eb091fe76fb6968431a2c715e48a701ab7b8)



---

archive/issue_comments_518783.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1485eb091fe76fb6968431a2c715e48a701ab7b8\">1485eb0</a></td><td><code>py3: some fix in set_partition (sortable elements only)</code></td></tr></table>\n",
    "created_at": "2018-12-19T19:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518783",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1485eb091fe76fb6968431a2c715e48a701ab7b8">1485eb0</a></td><td><code>py3: some fix in set_partition (sortable elements only)</code></td></tr></table>




---

archive/issue_comments_518784.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-12-19T19:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518784",
    "user": "https://github.com/fchapoton"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_518785.json:
```json
{
    "body": "**Branch:** [u/chapoton/26917](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26917)",
    "created_at": "2018-12-19T19:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518785",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/26917](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26917)



---

archive/issue_comments_518786.json:
```json
{
    "body": "**Changing commit** from \"[1485eb091fe76fb6968431a2c715e48a701ab7b8](https://github.com/sagemath/sagetrac-mirror/commit/1485eb091fe76fb6968431a2c715e48a701ab7b8)\" to \"[a0f038f7de5c4d6d7fad779b94735501713b49ba](https://github.com/sagemath/sagetrac-mirror/commit/a0f038f7de5c4d6d7fad779b94735501713b49ba)\".",
    "created_at": "2018-12-19T19:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1485eb091fe76fb6968431a2c715e48a701ab7b8](https://github.com/sagemath/sagetrac-mirror/commit/1485eb091fe76fb6968431a2c715e48a701ab7b8)" to "[a0f038f7de5c4d6d7fad779b94735501713b49ba](https://github.com/sagemath/sagetrac-mirror/commit/a0f038f7de5c4d6d7fad779b94735501713b49ba)".



---

archive/issue_comments_518787.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0f038f7de5c4d6d7fad779b94735501713b49ba\">a0f038f</a></td><td><code>py3: some fix in set_partition (sortable elements only)</code></td></tr></table>\n",
    "created_at": "2018-12-19T19:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0f038f7de5c4d6d7fad779b94735501713b49ba">a0f038f</a></td><td><code>py3: some fix in set_partition (sortable elements only)</code></td></tr></table>




---

archive/issue_comments_518788.json:
```json
{
    "body": "<a id='comment:3'></a>\ngreen bot, please review",
    "created_at": "2018-12-20T07:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518788",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
green bot, please review



---

archive/issue_comments_518789.json:
```json
{
    "body": "<a id='comment:4'></a>\nFrom the code, this should not be necessary. If this test is failing (on Py3), then is it failing because of a different order or generating an actual failure? If it is the latter, then it is definitely a bug in the code that should be fixed. If the former, then I don't understand why it is failing.",
    "created_at": "2018-12-20T07:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518789",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
From the code, this should not be necessary. If this test is failing (on Py3), then is it failing because of a different order or generating an actual failure? If it is the latter, then it is definitely a bug in the code that should be fixed. If the former, then I don't understand why it is failing.



---

archive/issue_comments_518790.json:
```json
{
    "body": "<a id='comment:5'></a>\nRight. Indeed, it is not failing on python3. It starts to fail (in python2) when we turn the switch in #22029.\n\nSo, it is more like that: do not mix things that cannot be sorted inside the set underlying a set partition.",
    "created_at": "2018-12-20T08:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518790",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
Right. Indeed, it is not failing on python3. It starts to fail (in python2) when we turn the switch in #22029.

So, it is more like that: do not mix things that cannot be sorted inside the set underlying a set partition.



---

archive/issue_comments_518791.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think there should be a decision on the assumption underlying set partitions.  There are several possibilities.  Currently several methods essentially assume that the ground set is totally ordered.\n\nIf we stick with this assumption, we can essentially assume that the ground set is 1,...,n.  In particular, notions such as crossings and nestings make sense.\n\nThere was an effort to remove this assumption, introducing `AbstractSetPartition`.  I am not sure whether this is worth it, however.",
    "created_at": "2018-12-20T08:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518791",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:6'></a>
I think there should be a decision on the assumption underlying set partitions.  There are several possibilities.  Currently several methods essentially assume that the ground set is totally ordered.

If we stick with this assumption, we can essentially assume that the ground set is 1,...,n.  In particular, notions such as crossings and nestings make sense.

There was an effort to remove this assumption, introducing `AbstractSetPartition`.  I am not sure whether this is worth it, however.



---

archive/issue_comments_518792.json:
```json
{
    "body": "<a id='comment:7'></a>\ntraceback on top of #22029:\n\n```\nsage -t --long --warn-long 54.8 src/sage/combinat/set_partition.py\n**********************************************************************\nFile \"src/sage/combinat/set_partition.py\", line 701, in sage.combinat.set_partition.SetPartition._latex_\nFailed example:\n    p = SetPartition([['a','c'],['b',1],[20]])\nException raised:\n    Traceback (most recent call last):\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.set_partition.SetPartition._latex_[4]>\", line 1, in <module>\n        p = SetPartition([['a','c'],['b',Integer(1)],[Integer(20)]])\n      File \"sage/misc/classcall_metaclass.pyx\", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1701)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/set_partition.py\", line 537, in `__classcall_private__`\n        return P.element_class(P, parts, check=check)\n      File \"sage/misc/classcall_metaclass.pyx\", line 333, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1726)\n        return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n      File \"/home/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/set_partition.py\", line 556, in `__init__`\n        ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)\n      File \"sage/rings/integer.pyx\", line 952, in sage.rings.integer.Integer.__richcmp__ (build/cythonized/sage/rings/integer.c:7787)\n        return coercion_model.richcmp(left, right, op)\n      File \"sage/structure/coerce.pyx\", line 1992, in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:20111)\n        raise bin_op_exception('>', x, y)\n    TypeError: unsupported operand parent(s) for >: 'Integer Ring' and '<type 'str'>'\n```",
    "created_at": "2018-12-20T17:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518792",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
traceback on top of #22029:

```
sage -t --long --warn-long 54.8 src/sage/combinat/set_partition.py
**********************************************************************
File "src/sage/combinat/set_partition.py", line 701, in sage.combinat.set_partition.SetPartition._latex_
Failed example:
    p = SetPartition([['a','c'],['b',1],[20]])
Exception raised:
    Traceback (most recent call last):
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.set_partition.SetPartition._latex_[4]>", line 1, in <module>
        p = SetPartition([['a','c'],['b',Integer(1)],[Integer(20)]])
      File "sage/misc/classcall_metaclass.pyx", line 330, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1701)
        return cls.classcall(cls, *args, **kwds)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/set_partition.py", line 537, in `__classcall_private__`
        return P.element_class(P, parts, check=check)
      File "sage/misc/classcall_metaclass.pyx", line 333, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1726)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/home/chapoton/sage/local/lib/python2.7/site-packages/sage/combinat/set_partition.py", line 556, in `__init__`
        ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)
      File "sage/rings/integer.pyx", line 952, in sage.rings.integer.Integer.__richcmp__ (build/cythonized/sage/rings/integer.c:7787)
        return coercion_model.richcmp(left, right, op)
      File "sage/structure/coerce.pyx", line 1992, in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:20111)
        raise bin_op_exception('>', x, y)
    TypeError: unsupported operand parent(s) for >: 'Integer Ring' and '<type 'str'>'
```



---

archive/issue_comments_518793.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [mantepse](#comment%3A6):\n> I think there should be a decision on the assumption underlying set partitions.  There are several possibilities.  Currently several methods essentially assume that the ground set is totally ordered.\n> \n> If we stick with this assumption, we can essentially assume that the ground set is 1,...,n.  In particular, notions such as crossings and nestings make sense.\n> \n> There was an effort to remove this assumption, introducing `AbstractSetPartition`.  I am not sure whether this is worth it, however.\n\n\nI think we should keep the current implementation: Let the methods error out when the `SetPartition` is not on `[n]`. For permutations, this makes more sense to have a special class for \"standard\" permutations (speed and the essentially ubiquity of `{1,...,n}`). However, this creates a fair bit of extra maintenance burden.\n\nTL;DR I think we should avoid forcing the ground set to be `[n]`.",
    "created_at": "2018-12-21T00:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518793",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>
Replying to [mantepse](#comment%3A6):
> I think there should be a decision on the assumption underlying set partitions.  There are several possibilities.  Currently several methods essentially assume that the ground set is totally ordered.
> 
> If we stick with this assumption, we can essentially assume that the ground set is 1,...,n.  In particular, notions such as crossings and nestings make sense.
> 
> There was an effort to remove this assumption, introducing `AbstractSetPartition`.  I am not sure whether this is worth it, however.


I think we should keep the current implementation: Let the methods error out when the `SetPartition` is not on `[n]`. For permutations, this makes more sense to have a special class for "standard" permutations (speed and the essentially ubiquity of `{1,...,n}`). However, this creates a fair bit of extra maintenance burden.

TL;DR I think we should avoid forcing the ground set to be `[n]`.



---

archive/issue_comments_518794.json:
```json
{
    "body": "<a id='comment:9'></a>\ncomment:7 is a hard error that prevents a set partition from being constructed from any incomparable objects.\n\nMy opinion would be to instead do this change:\n\n```diff\n-ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)\n+try:\n+    ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)\n+except TypeError:\n+    ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=lambda x: str(min(x))),\n+                           check=check)\n```",
    "created_at": "2018-12-21T00:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518794",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>
comment:7 is a hard error that prevents a set partition from being constructed from any incomparable objects.

My opinion would be to instead do this change:

```diff
-ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)
+try:
+    ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)
+except TypeError:
+    ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=lambda x: str(min(x))),
+                           check=check)
```



---

archive/issue_comments_518795.json:
```json
{
    "body": "<a id='comment:10'></a>\nHi Travis!\n\nSo, would you (just as I would) vote for removing `AbstractSetPartition` again?\n\nI admit I am confused about would you would prefer:\n\n1) a single implementation of set partitions, with arbitrary, possibly non-sortable ground set.  Some methods may return nonsense, some methods may yield an error.\n\n2) a single implementation of set partitions, with arbitrary, possibly non-sortable ground set.  Methods may yield an error, but will not return nonsense.  I believe that this is hard to achieve, when we want to keep speed.\n\n3) it seems that you (and me also) do not like the current state, which is an incomplete split between sortable and non-sortable ground set.\n\nI am certainly not saying that we should have only set partitions on `[n]`.",
    "created_at": "2018-12-21T07:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518795",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:10'></a>
Hi Travis!

So, would you (just as I would) vote for removing `AbstractSetPartition` again?

I admit I am confused about would you would prefer:

1) a single implementation of set partitions, with arbitrary, possibly non-sortable ground set.  Some methods may return nonsense, some methods may yield an error.

2) a single implementation of set partitions, with arbitrary, possibly non-sortable ground set.  Methods may yield an error, but will not return nonsense.  I believe that this is hard to achieve, when we want to keep speed.

3) it seems that you (and me also) do not like the current state, which is an incomplete split between sortable and non-sortable ground set.

I am certainly not saying that we should have only set partitions on `[n]`.



---

archive/issue_comments_518796.json:
```json
{
    "body": "<a id='comment:11'></a>\nI don't like it, but there are reasons for having it for comb. Hopf algebras IIRC. At least with a partial split, we can be fluid about what goes where, which lowers the maintenance burden.\n\nI am for option 1 as people doing things on more generic set partitions will almost certainly not be doing any other special methods (mainly, they are probably looking to enumerate the set partitions).",
    "created_at": "2018-12-21T18:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518796",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
I don't like it, but there are reasons for having it for comb. Hopf algebras IIRC. At least with a partial split, we can be fluid about what goes where, which lowers the maintenance burden.

I am for option 1 as people doing things on more generic set partitions will almost certainly not be doing any other special methods (mainly, they are probably looking to enumerate the set partitions).



---

archive/issue_comments_518797.json:
```json
{
    "body": "<a id='comment:12'></a>\nA related ticket is #25451. However, I think it would indeed be better to get rid of `AbstractSetPartition` again.  It is only used in `diagram_algebras.py`.\n\nApart from that I would like to go with Travis' proposal.  Any objections?",
    "created_at": "2018-12-25T10:02:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518797",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:12'></a>
A related ticket is #25451. However, I think it would indeed be better to get rid of `AbstractSetPartition` again.  It is only used in `diagram_algebras.py`.

Apart from that I would like to go with Travis' proposal.  Any objections?



---

archive/issue_comments_518798.json:
```json
{
    "body": "**Changing status** from needs_review to needs_info.",
    "created_at": "2018-12-25T11:03:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518798",
    "user": "https://github.com/mantepse"
}
```

**Changing status** from needs_review to needs_info.



---

archive/issue_comments_518799.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [tscrim](#comment%3A9):\n> comment:7 is a hard error that prevents a set partition from being constructed from any incomparable objects.\n> \n> My opinion would be to instead do this change:\n> \n> ```diff\n> -ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)\n> +try:\n> +    ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)\n> +except TypeError:\n> +    ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=lambda x: str(min(x))),\n> +                           check=check)\n> ```\n\n\nIs the sorting relevant in the first place? Couldn't we just keep things in the order that the user gives them?",
    "created_at": "2018-12-25T13:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518799",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Replying to [tscrim](#comment%3A9):
> comment:7 is a hard error that prevents a set partition from being constructed from any incomparable objects.
> 
> My opinion would be to instead do this change:
> 
> ```diff
> -ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)
> +try:
> +    ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=min), check=check)
> +except TypeError:
> +    ClonableArray.__init__(self, parent, sorted(map(frozenset, s), key=lambda x: str(min(x))),
> +                           check=check)
> ```


Is the sorting relevant in the first place? Couldn't we just keep things in the order that the user gives them?



---

archive/issue_comments_518800.json:
```json
{
    "body": "<a id='comment:15'></a>\n> Couldn't we just keep things in the order that the user gives them?\n\n\nNo, because we want to be able to compare two set partitions quickly.\n\n(the real thing would be to use restricted growth words, but there was a vote against it, and so far nobody asked for *really* fast set partitions)",
    "created_at": "2018-12-25T14:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518800",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:15'></a>
> Couldn't we just keep things in the order that the user gives them?


No, because we want to be able to compare two set partitions quickly.

(the real thing would be to use restricted growth words, but there was a vote against it, and so far nobody asked for *really* fast set partitions)



---

archive/issue_comments_518801.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [mantepse](#comment%3A12):\n> A related ticket is #25451. However, I think it would indeed be better to get rid of `AbstractSetPartition` again.  It is only used in `diagram_algebras.py`.\n> \n> Apart from that I would like to go with Travis' proposal.  Any objections?\n\n\nYes, I do. This abstraction is useful for the diagram algebras. The number of uses (as long as it is more than one) is not a good reason for removal. It also is not really a big maintenance burden. So -1, still.",
    "created_at": "2018-12-25T15:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518801",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Replying to [mantepse](#comment%3A12):
> A related ticket is #25451. However, I think it would indeed be better to get rid of `AbstractSetPartition` again.  It is only used in `diagram_algebras.py`.
> 
> Apart from that I would like to go with Travis' proposal.  Any objections?


Yes, I do. This abstraction is useful for the diagram algebras. The number of uses (as long as it is more than one) is not a good reason for removal. It also is not really a big maintenance burden. So -1, still.



---

archive/issue_comments_518802.json:
```json
{
    "body": "<a id='comment:17'></a>\n> Yes, I do. This abstraction is useful for the diagram algebras. The number of uses (as long as it is more than one) is not a good reason for removal. It also is not really a big maintenance burden. So -1, still.\n\n\nI don't mind.  What's the second use of `AbstractSetPartition`?\n\nCan we go ahead with your proposal in this ticket?",
    "created_at": "2018-12-25T18:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518802",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:17'></a>
> Yes, I do. This abstraction is useful for the diagram algebras. The number of uses (as long as it is more than one) is not a good reason for removal. It also is not really a big maintenance burden. So -1, still.


I don't mind.  What's the second use of `AbstractSetPartition`?

Can we go ahead with your proposal in this ticket?



---

archive/issue_comments_518803.json:
```json
{
    "body": "<a id='comment:18'></a>\nI just realised that I already said that equality of set partitions cannot work \n\n```\nsage: n=4; s = [frozenset([2*i, 2*i+1]) for i in range(n)]\nsage: p1 = SetPartition([[s[0]], [s[1]]])\nsage: p2 = SetPartition([[s[1]], [s[0]]])\nsage: p1 == p2\nFalse\n```\n\nTherefore I think that having an error raised when the base set is not totally ordered is actually much better.  (I do realise that the example above won't give an error in python3, but at least we shouldn't make matters worse.)\n\nIf really desired, generalising set partitions to non-totally ordered sets should go into another ticket, so I'd like to set this to positive review.",
    "created_at": "2018-12-26T08:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518803",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:18'></a>
I just realised that I already said that equality of set partitions cannot work 

```
sage: n=4; s = [frozenset([2*i, 2*i+1]) for i in range(n)]
sage: p1 = SetPartition([[s[0]], [s[1]]])
sage: p2 = SetPartition([[s[1]], [s[0]]])
sage: p1 == p2
False
```

Therefore I think that having an error raised when the base set is not totally ordered is actually much better.  (I do realise that the example above won't give an error in python3, but at least we shouldn't make matters worse.)

If really desired, generalising set partitions to non-totally ordered sets should go into another ticket, so I'd like to set this to positive review.



---

archive/issue_comments_518804.json:
```json
{
    "body": "**Changing status** from needs_info to positive_review.",
    "created_at": "2018-12-26T08:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518804",
    "user": "https://github.com/mantepse"
}
```

**Changing status** from needs_info to positive_review.



---

archive/issue_comments_518805.json:
```json
{
    "body": "**Reviewer:** Martin Rubey",
    "created_at": "2018-12-26T08:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518805",
    "user": "https://github.com/mantepse"
}
```

**Reviewer:** Martin Rubey



---

archive/issue_comments_518806.json:
```json
{
    "body": "<a id='comment:20'></a>\nTravis, just to be clear: feel free to set this to `needs work` again if you disagree with my reasoning.",
    "created_at": "2018-12-26T08:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518806",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:20'></a>
Travis, just to be clear: feel free to set this to `needs work` again if you disagree with my reasoning.



---

archive/issue_comments_518807.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/26917](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26917)\" to \"[u/mantepse/26917](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/26917)\".",
    "created_at": "2018-12-26T09:23:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518807",
    "user": "https://github.com/mantepse"
}
```

**Changing branch** from "[u/chapoton/26917](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26917)" to "[u/mantepse/26917](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/26917)".



---

archive/issue_comments_518808.json:
```json
{
    "body": "<a id='comment:22'></a>\nI took the liberty of adding an example indicating the limitation.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94bc96a01ab26655f1ffeb96da90e07a69da59c3\">94bc96a</a></td><td><code>make clear that equality needs a totally ordered set</code></td></tr></table>\n",
    "created_at": "2018-12-26T09:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518808",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:22'></a>
I took the liberty of adding an example indicating the limitation.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94bc96a01ab26655f1ffeb96da90e07a69da59c3">94bc96a</a></td><td><code>make clear that equality needs a totally ordered set</code></td></tr></table>




---

archive/issue_comments_518809.json:
```json
{
    "body": "**Changing commit** from \"[a0f038f7de5c4d6d7fad779b94735501713b49ba](https://github.com/sagemath/sagetrac-mirror/commit/a0f038f7de5c4d6d7fad779b94735501713b49ba)\" to \"[94bc96a01ab26655f1ffeb96da90e07a69da59c3](https://github.com/sagemath/sagetrac-mirror/commit/94bc96a01ab26655f1ffeb96da90e07a69da59c3)\".",
    "created_at": "2018-12-26T09:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518809",
    "user": "https://github.com/mantepse"
}
```

**Changing commit** from "[a0f038f7de5c4d6d7fad779b94735501713b49ba](https://github.com/sagemath/sagetrac-mirror/commit/a0f038f7de5c4d6d7fad779b94735501713b49ba)" to "[94bc96a01ab26655f1ffeb96da90e07a69da59c3](https://github.com/sagemath/sagetrac-mirror/commit/94bc96a01ab26655f1ffeb96da90e07a69da59c3)".



---

archive/issue_comments_518810.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2018-12-26T17:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518810",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_518811.json:
```json
{
    "body": "<a id='comment:23'></a>\nThis should have been reset to needs review with the extra commit.\n\nYou should change \"is not well defined\" to \"may give incorrect answers\".",
    "created_at": "2018-12-26T17:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518811",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
This should have been reset to needs review with the extra commit.

You should change "is not well defined" to "may give incorrect answers".



---

archive/issue_comments_518812.json:
```json
{
    "body": "**Changing commit** from \"[94bc96a01ab26655f1ffeb96da90e07a69da59c3](https://github.com/sagemath/sagetrac-mirror/commit/94bc96a01ab26655f1ffeb96da90e07a69da59c3)\" to \"[171f9885ff150378e69de4cdfeea2fb1d6b107ea](https://github.com/sagemath/sagetrac-mirror/commit/171f9885ff150378e69de4cdfeea2fb1d6b107ea)\".",
    "created_at": "2018-12-26T17:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[94bc96a01ab26655f1ffeb96da90e07a69da59c3](https://github.com/sagemath/sagetrac-mirror/commit/94bc96a01ab26655f1ffeb96da90e07a69da59c3)" to "[171f9885ff150378e69de4cdfeea2fb1d6b107ea](https://github.com/sagemath/sagetrac-mirror/commit/171f9885ff150378e69de4cdfeea2fb1d6b107ea)".



---

archive/issue_comments_518813.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c0cd90df5c839bb9edace8f2899166531bfac5b\">4c0cd90</a></td><td><code>reword as requested</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/171f9885ff150378e69de4cdfeea2fb1d6b107ea\">171f988</a></td><td><code>same for inequality</code></td></tr></table>\n",
    "created_at": "2018-12-26T17:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c0cd90df5c839bb9edace8f2899166531bfac5b">4c0cd90</a></td><td><code>reword as requested</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/171f9885ff150378e69de4cdfeea2fb1d6b107ea">171f988</a></td><td><code>same for inequality</code></td></tr></table>




---

archive/issue_comments_518814.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-12-26T17:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518814",
    "user": "https://github.com/mantepse"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_518815.json:
```json
{
    "body": "**Changing reviewer** from \"Martin Rubey\" to \"\".",
    "created_at": "2018-12-26T17:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518815",
    "user": "https://github.com/mantepse"
}
```

**Changing reviewer** from "Martin Rubey" to "".



---

archive/issue_comments_518816.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Martin Rubey\".",
    "created_at": "2018-12-26T17:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518816",
    "user": "https://github.com/mantepse"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, Martin Rubey".



---

archive/issue_comments_518817.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2018-12-31T19:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518817",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_comments_518818.json:
```json
{
    "body": "<a id='comment:26'></a>\ngood enough for me. Travis, do you agree ?",
    "created_at": "2018-12-31T19:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518818",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:26'></a>
good enough for me. Travis, do you agree ?



---

archive/issue_comments_518819.json:
```json
{
    "body": "**Changing reviewer** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Travis Scrimshaw\".",
    "created_at": "2019-01-01T17:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518819",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Frédéric Chapoton" to "Frédéric Chapoton, Travis Scrimshaw".



---

archive/issue_comments_518820.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-01-01T17:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518820",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_518821.json:
```json
{
    "body": "<a id='comment:27'></a>\nThis is okay with me.",
    "created_at": "2019-01-01T17:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518821",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>
This is okay with me.



---

archive/issue_events_075632.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26917#event-75632"
}
```



---

archive/issue_comments_518822.json:
```json
{
    "body": "<a id='comment:28'></a>\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518822",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>
Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_events_075633.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T14:17:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26917#event-75633"
}
```



---

archive/issue_comments_518823.json:
```json
{
    "body": "**Changing branch** from \"[u/mantepse/26917](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/26917)\" to \"[171f9885ff150378e69de4cdfeea2fb1d6b107ea](https://github.com/sagemath/sagetrac-mirror/commit/171f9885ff150378e69de4cdfeea2fb1d6b107ea)\".",
    "created_at": "2019-01-23T14:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518823",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mantepse/26917](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/26917)" to "[171f9885ff150378e69de4cdfeea2fb1d6b107ea](https://github.com/sagemath/sagetrac-mirror/commit/171f9885ff150378e69de4cdfeea2fb1d6b107ea)".



---

archive/issue_comments_518824.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2019-01-23T14:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26917",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26917#issuecomment-518824",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed
