# Issue 26512: Let `factorial` accept float arguments

archive/issues_026512.json:
```json
{
    "body": "CC:  @mezzarobba @slel tmonteil @videlec\n\nKeywords: plot, factorial, gamma, float\n\nIn Sage 8.3 to 9.0, `factorial` chokes if fed a float argument:\n\n```\nsage: factorial(float(3.2))\nTraceback (most recent call last):\n...\nAttributeError: 'float' object has no attribute 'gamma'\n```\n\nWe change the numerical evaluation so it will accept a float argument.\n\nWith this ticket:\n\n```\nsage: factorial(float(3.2))\n7.756689535793181\n```\n\nAs a consequence, `factorial(x)` can be plotted again -- as gamma(x + 1).\n\nIssue created by migration from https://trac.sagemath.org/ticket/26749\n\n",
    "closed_at": "2020-02-25T19:51:11Z",
    "created_at": "2018-11-23T19:42:49Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Let `factorial` accept float arguments",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26512",
    "user": "https://github.com/pelegm"
}
```
CC:  @mezzarobba @slel tmonteil @videlec

Keywords: plot, factorial, gamma, float

In Sage 8.3 to 9.0, `factorial` chokes if fed a float argument:

```
sage: factorial(float(3.2))
Traceback (most recent call last):
...
AttributeError: 'float' object has no attribute 'gamma'
```

We change the numerical evaluation so it will accept a float argument.

With this ticket:

```
sage: factorial(float(3.2))
7.756689535793181
```

As a consequence, `factorial(x)` can be plotted again -- as gamma(x + 1).

Issue created by migration from https://trac.sagemath.org/ticket/26749





---

archive/issue_comments_372400.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-19T06:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372400",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_372401.json:
```json
{
    "body": "Replying to [comment:1 gh-durgeshra]:\n\nExample:\n\n```\nsage: factorial(x).plot()\n---------------------------------------------------------------------------\nArithmeticError                           Traceback (most recent call last)\n<ipython-input-1-d07fdfec6413> in <module>()\n----> 1 factorial(x).plot()\n\n/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.plot (build/cythonized/sage/symbolic/expression.cpp:63513)()\n> 12067             except NotImplementedError:\n\n/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/misc/decorators.pyc in wrapper(*args, **kwds)\n--> 567             return func(*args, **options)\n\n/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/plot/plot.py in plot(funcs, *args, **kwds)\n-> 1956             G = _plot(funcs, (xmin, xmax), **kwds)\n\n/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/plot/plot.py in _plot(funcs, xrange, parametric, polar, fill, label, randomize, **options)\n-> 2266                                     randomize)\n\n/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/plot/plot.py in generate_plot_points(f, xrange, plot_points, adaptive_tolerance, adaptive_recursion, randomize, initial_points)\n-> 3731         raise ArithmeticError(\"The function cannot be plotted.\")\n\nArithmeticError: The function cannot be plotted.\n```\n(raises arithmetic error)\n\n```\nsage: (x).plot()\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\n```\n(plots correctly)",
    "created_at": "2018-12-19T07:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372401",
    "user": "https://github.com/durgeshra"
}
```

Replying to [comment:1 gh-durgeshra]:

Example:

```
sage: factorial(x).plot()
---------------------------------------------------------------------------
ArithmeticError                           Traceback (most recent call last)
<ipython-input-1-d07fdfec6413> in <module>()
----> 1 factorial(x).plot()

/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.plot (build/cythonized/sage/symbolic/expression.cpp:63513)()
> 12067             except NotImplementedError:

/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/misc/decorators.pyc in wrapper(*args, **kwds)
--> 567             return func(*args, **options)

/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/plot/plot.py in plot(funcs, *args, **kwds)
-> 1956             G = _plot(funcs, (xmin, xmax), **kwds)

/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/plot/plot.py in _plot(funcs, xrange, parametric, polar, fill, label, randomize, **options)
-> 2266                                     randomize)

/home/durgesh/Downloads/sage-8.4/local/lib/python2.7/site-packages/sage/plot/plot.py in generate_plot_points(f, xrange, plot_points, adaptive_tolerance, adaptive_recursion, randomize, initial_points)
-> 3731         raise ArithmeticError("The function cannot be plotted.")

ArithmeticError: The function cannot be plotted.
```
(raises arithmetic error)

```
sage: (x).plot()
Launched png viewer for Graphics object consisting of 1 graphics primitive
```
(plots correctly)



---

archive/issue_comments_372402.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-19T07:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372402",
    "user": "https://github.com/durgeshra"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_372403.json:
```json
{
    "body": "Don't mask errors. By putting a whole statement in a bare \"try/except\" you make it very hard to debug the code, because *any* error that gets raised will now be masked by \"ArithmeticError\". \n\nNote that `gamma(x+1).plot()` works just fine, so what `factorial(x).plot()` tries to do could just be fine. If you absolutely think this example needs to perform better then the way that `factorial` tries to evaluate numerical arguments should probably be adjusted.\n\nHere you can see that the original error message is much more informative than what you suggest on this ticket: it actually tells what is going wrong and allows someone to come up with a fix. Carpeting over this very useful error message with a generic, uninformative `function cannot be plotted` is not an improvement at all.",
    "created_at": "2018-12-19T07:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372403",
    "user": "https://github.com/nbruin"
}
```

Don't mask errors. By putting a whole statement in a bare "try/except" you make it very hard to debug the code, because *any* error that gets raised will now be masked by "ArithmeticError". 

Note that `gamma(x+1).plot()` works just fine, so what `factorial(x).plot()` tries to do could just be fine. If you absolutely think this example needs to perform better then the way that `factorial` tries to evaluate numerical arguments should probably be adjusted.

Here you can see that the original error message is much more informative than what you suggest on this ticket: it actually tells what is going wrong and allows someone to come up with a fix. Carpeting over this very useful error message with a generic, uninformative `function cannot be plotted` is not an improvement at all.



---

archive/issue_comments_372404.json:
```json
{
    "body": "Replying to [comment:4 nbruin]:\n> Don't mask errors. By putting a whole statement in a bare \"try/except\" you make it very hard to debug the code, because *any* error that gets raised will now be masked by \"ArithmeticError\". \n> \n> Note that `gamma(x+1).plot()` works just fine, so what `factorial(x).plot()` tries to do could just be fine. If you absolutely think this example needs to perform better then the way that `factorial` tries to evaluate numerical arguments should probably be adjusted.\n> \n> Here you can see that the original error message is much more informative than what you suggest on this ticket: it actually tells what is going wrong and allows someone to come up with a fix. Carpeting over this very useful error message with a generic, uninformative `function cannot be plotted` is not an improvement at all.\n\n\nSo what should `factorial(x).plot()` return? Should it make a plot like the gamma function?",
    "created_at": "2018-12-19T07:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372404",
    "user": "https://github.com/durgeshra"
}
```

Replying to [comment:4 nbruin]:
> Don't mask errors. By putting a whole statement in a bare "try/except" you make it very hard to debug the code, because *any* error that gets raised will now be masked by "ArithmeticError". 
> 
> Note that `gamma(x+1).plot()` works just fine, so what `factorial(x).plot()` tries to do could just be fine. If you absolutely think this example needs to perform better then the way that `factorial` tries to evaluate numerical arguments should probably be adjusted.
> 
> Here you can see that the original error message is much more informative than what you suggest on this ticket: it actually tells what is going wrong and allows someone to come up with a fix. Carpeting over this very useful error message with a generic, uninformative `function cannot be plotted` is not an improvement at all.


So what should `factorial(x).plot()` return? Should it make a plot like the gamma function?



---

archive/issue_events_066222.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-02-20T18:31:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26512#event-66222"
}
```



---

archive/issue_comments_372405.json:
```json
{
    "body": "Changing keywords from \"plot,factorial,gamma,float\" to \"plot, factorial, gamma, float\".",
    "created_at": "2020-02-20T18:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372405",
    "user": "https://github.com/slel"
}
```

Changing keywords from "plot,factorial,gamma,float" to "plot, factorial, gamma, float".



---

archive/issue_comments_372406.json:
```json
{
    "body": "The `factorial` function used to accept a Python float\nas an argument, but no longer does. It might have to do\nwith the refactoring in #25421. Compare the following.\n\nIn Sage 8.2:\n\n```\nsage: version()\n'SageMath version 8.2, Release Date: 2018-05-05'\nsage: factorial(1.2)\n1.10180249087971\nsage: factorial(1.2r)\n1.1018024908797128\n```\n\nIn Sage 8.3:\n\n```\nsage: version()\n'SageMath version 8.3, Release Date: 2018-08-03'\nsage: factorial(1.2)\n1.10180249087971\nsage: factorial(1.2r)\nTraceback (most recent call last)\n...\nAttributeError: 'float' object has no attribute 'gamma'\n```\n\nThe problem manifests itself when plotting because when\nplotting a symbolic function Sage feeds it Python floats.",
    "created_at": "2020-02-20T18:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372406",
    "user": "https://github.com/slel"
}
```

The `factorial` function used to accept a Python float
as an argument, but no longer does. It might have to do
with the refactoring in #25421. Compare the following.

In Sage 8.2:

```
sage: version()
'SageMath version 8.2, Release Date: 2018-05-05'
sage: factorial(1.2)
1.10180249087971
sage: factorial(1.2r)
1.1018024908797128
```

In Sage 8.3:

```
sage: version()
'SageMath version 8.3, Release Date: 2018-08-03'
sage: factorial(1.2)
1.10180249087971
sage: factorial(1.2r)
Traceback (most recent call last)
...
AttributeError: 'float' object has no attribute 'gamma'
```

The problem manifests itself when plotting because when
plotting a symbolic function Sage feeds it Python floats.



---

archive/issue_comments_372407.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-02-20T21:07:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372407",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_372408.json:
```json
{
    "body": "I like this try/except solution! Positive review from me if the patchbots are happy.",
    "created_at": "2020-02-21T00:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372408",
    "user": "https://github.com/slel"
}
```

I like this try/except solution! Positive review from me if the patchbots are happy.



---

archive/issue_comments_372409.json:
```json
{
    "body": "Note: a similar problem for `sqrt` was reported at\n\n- https://groups.google.com/d/topic/cocalc/rblsUHwBXQc/discussion",
    "created_at": "2020-02-21T09:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372409",
    "user": "https://github.com/slel"
}
```

Note: a similar problem for `sqrt` was reported at

- https://groups.google.com/d/topic/cocalc/rblsUHwBXQc/discussion



---

archive/issue_comments_372410.json:
```json
{
    "body": "Replying to [comment:11 slelievre]:\n> Note: a similar problem for `sqrt` was reported at\n> \n> - https://groups.google.com/d/topic/cocalc/rblsUHwBXQc/discussion\n\n\nWhat do you mean exactly? The following is with 9.1.beta4\n\n```\nsage: sqrt(float(1.3))\n1.140175425099138\nsage: type(sqrt(float(1.3)))\n<class 'float'>\n```",
    "created_at": "2020-02-21T09:33:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372410",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:11 slelievre]:
> Note: a similar problem for `sqrt` was reported at
> 
> - https://groups.google.com/d/topic/cocalc/rblsUHwBXQc/discussion


What do you mean exactly? The following is with 9.1.beta4

```
sage: sqrt(float(1.3))
1.140175425099138
sage: type(sqrt(float(1.3)))
<class 'float'>
```



---

archive/issue_comments_372411.json:
```json
{
    "body": "Replying to [comment:12 vdelecroix]:\n> Replying to [comment:11 slelievre]:\n> > Note: a similar problem for `sqrt` was reported at\n> > \n> > - https://groups.google.com/d/topic/cocalc/rblsUHwBXQc/discussion\n \n> \n> What do you mean exactly? The following is with 9.1.beta4\n> \n> ```\n> sage: sqrt(float(1.3))\n> 1.140175425099138\n> sage: type(sqrt(float(1.3)))\n> <class 'float'>\n> ```\n\n\nThis was a call to `.sqrt()` that floats do not have.",
    "created_at": "2020-02-21T17:06:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372411",
    "user": "https://github.com/fchapoton"
}
```

Replying to [comment:12 vdelecroix]:
> Replying to [comment:11 slelievre]:
> > Note: a similar problem for `sqrt` was reported at
> > 
> > - https://groups.google.com/d/topic/cocalc/rblsUHwBXQc/discussion
 
> 
> What do you mean exactly? The following is with 9.1.beta4
> 
> ```
> sage: sqrt(float(1.3))
> 1.140175425099138
> sage: type(sqrt(float(1.3)))
> <class 'float'>
> ```


This was a call to `.sqrt()` that floats do not have.



---

archive/issue_comments_372412.json:
```json
{
    "body": "See #29232 for that other problem, sorry for the noise here.",
    "created_at": "2020-02-21T17:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372412",
    "user": "https://github.com/slel"
}
```

See #29232 for that other problem, sorry for the noise here.



---

archive/issue_comments_372413.json:
```json
{
    "body": "This looks good to me.",
    "created_at": "2020-02-21T17:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372413",
    "user": "https://github.com/williamstein"
}
```

This looks good to me.



---

archive/issue_comments_372414.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-21T17:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372414",
    "user": "https://github.com/williamstein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_372415.json:
```json
{
    "body": "On 32-bit\n\n```\n**********************************************************************\nFile \"src/sage/functions/other.py\", line 1471, in sage.functions.other.Function_factorial._eval_\nFailed example:\n    factorial(float(3.2))\nExpected:\n    7.756689535793181\nGot:\n    7.756689535793178\n**********************************************************************\n1 item had failures:\n   1 of  11 in sage.functions.other.Function_factorial._eval_\n    [448 tests, 1 failure, 26.12 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/functions/other.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2020-02-22T18:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372415",
    "user": "https://github.com/vbraun"
}
```

On 32-bit

```
**********************************************************************
File "src/sage/functions/other.py", line 1471, in sage.functions.other.Function_factorial._eval_
Failed example:
    factorial(float(3.2))
Expected:
    7.756689535793181
Got:
    7.756689535793178
**********************************************************************
1 item had failures:
   1 of  11 in sage.functions.other.Function_factorial._eval_
    [448 tests, 1 failure, 26.12 s]
----------------------------------------------------------------------
sage -t --long src/sage/functions/other.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_372416.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-02-22T18:24:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372416",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_372417.json:
```json
{
    "body": "Turns out that 32 bits is much more accurate!\n\n```\nsage: RealBallField(64)(\"4.2\").gamma()                                                                    \n[7.7566895357931776 +/- 5.95e-17]\n```",
    "created_at": "2020-02-22T20:50:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372417",
    "user": "https://github.com/videlec"
}
```

Turns out that 32 bits is much more accurate!

```
sage: RealBallField(64)("4.2").gamma()                                                                    
[7.7566895357931776 +/- 5.95e-17]
```



---

archive/issue_comments_372418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-02-22T21:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_372419.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-02-22T21:02:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372419",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_372420.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-23T14:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372420",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_372421.json:
```json
{
    "body": "Thanks! Positive review.",
    "created_at": "2020-02-23T14:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372421",
    "user": "https://github.com/slel"
}
```

Thanks! Positive review.



---

archive/issue_comments_372422.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-02-25T19:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26512#issuecomment-372422",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_066223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-02-25T19:51:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26512",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26512#event-66223"
}
```
