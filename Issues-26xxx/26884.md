# Issue 26884: Global function fields: divisors

archive/issues_026884.json:
```json
{
    "body": "This is part of the meta-ticket #22982.\n\nThe goal of the present ticket is to add code for computing with divisors of global function fields.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27121\n\n",
    "closed_at": "2019-02-15T13:02:15Z",
    "created_at": "2019-01-25T10:45:09Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Global function fields: divisors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26884",
    "user": "https://github.com/kwankyu"
}
```
This is part of the meta-ticket #22982.

The goal of the present ticket is to add code for computing with divisors of global function fields.

Issue created by migration from https://trac.sagemath.org/ticket/27121





---

archive/issue_comments_377697.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-12T09:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377697",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377698.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-12T09:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377698",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_377699.json:
```json
{
    "body": "Here are my comments.\n\nThe `__radd__` should not be necessary as the coercion framework should take care of that (which you are using with `_add_`), unless you are trying to explicitly avoid the coercion framework (as the coercions you would need are not (or should not) be there).\n\nIs there a way to minimize the duplication of `divisor`, `divisor_of_zeros`, and `divisor_of_poles` in the two files (say, by putting them in a common base class for the respective files)? It all looks like basically the same code.\n\n`self.divisor_group()(0)` -> `self.divisor_group().zero()` (the latter is cached).\n\nSimilarly, I am not sure I like having the `zero_divisor` method. If anything, it should do `DivisorGroup(field).zero()` and not be used to construct the `0` of the divisor group. I am slightly in favor of removing it for the explicitness of the code (as it is a one-liner), but I can somewhat see how it might be a more natural operation.\n\nI don't see the point in the `valuation_ring` method as it does not involve `self`. This was something I missed on a previous review, but I noticed here because of the diff.\n\nThe `keys` here is unnecessary: `sorted(self._data.keys())`.\n\nIt is faster to use `while s and o:` instead of `while len(s) > 0 and len(o) > 0:`.",
    "created_at": "2019-02-13T16:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377699",
    "user": "https://github.com/tscrim"
}
```

Here are my comments.

The `__radd__` should not be necessary as the coercion framework should take care of that (which you are using with `_add_`), unless you are trying to explicitly avoid the coercion framework (as the coercions you would need are not (or should not) be there).

Is there a way to minimize the duplication of `divisor`, `divisor_of_zeros`, and `divisor_of_poles` in the two files (say, by putting them in a common base class for the respective files)? It all looks like basically the same code.

`self.divisor_group()(0)` -> `self.divisor_group().zero()` (the latter is cached).

Similarly, I am not sure I like having the `zero_divisor` method. If anything, it should do `DivisorGroup(field).zero()` and not be used to construct the `0` of the divisor group. I am slightly in favor of removing it for the explicitness of the code (as it is a one-liner), but I can somewhat see how it might be a more natural operation.

I don't see the point in the `valuation_ring` method as it does not involve `self`. This was something I missed on a previous review, but I noticed here because of the diff.

The `keys` here is unnecessary: `sorted(self._data.keys())`.

It is faster to use `while s and o:` instead of `while len(s) > 0 and len(o) > 0:`.



---

archive/issue_comments_377700.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> The `__radd__` should not be necessary as the coercion framework should take care of that (which you are using with `_add_`), unless you are trying to explicitly avoid the coercion framework (as the coercions you would need are not (or should not) be there).\n\n\nHow could I achieve the following without `__radd__`?  An integer (in particular zero) is not supposed to be coerced to a place. Then how the coercion framework could enable the example below.  Would you give me hints?\n\n```\n        This is only to support the ``sum`` function, that adds\n        the argument to initial (int) zero.\n\n        EXAMPLES::\n\n            sage: k.<a>=GF(2)\n            sage: K.<x>=FunctionField(k)\n            sage: sum(K.places_finite())\n            Place (x) + Place (x + 1)\n\n        .. NOTE:\n\n        This does not work though::\n\n            sage: 0 + K.place_infinite()\n            Traceback (most recent call last):\n            ...\n            TypeError: unsupported operand parent(s) for +: ...\n\n        The reason is that the ``0`` is a Sage integer, for which\n        the coercion system applies. \n```",
    "created_at": "2019-02-14T04:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377700",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:4 tscrim]:
> The `__radd__` should not be necessary as the coercion framework should take care of that (which you are using with `_add_`), unless you are trying to explicitly avoid the coercion framework (as the coercions you would need are not (or should not) be there).


How could I achieve the following without `__radd__`?  An integer (in particular zero) is not supposed to be coerced to a place. Then how the coercion framework could enable the example below.  Would you give me hints?

```
        This is only to support the ``sum`` function, that adds
        the argument to initial (int) zero.

        EXAMPLES::

            sage: k.<a>=GF(2)
            sage: K.<x>=FunctionField(k)
            sage: sum(K.places_finite())
            Place (x) + Place (x + 1)

        .. NOTE:

        This does not work though::

            sage: 0 + K.place_infinite()
            Traceback (most recent call last):
            ...
            TypeError: unsupported operand parent(s) for +: ...

        The reason is that the ``0`` is a Sage integer, for which
        the coercion system applies. 
```



---

archive/issue_comments_377701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-14T04:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377702.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n\n> Is there a way to minimize the duplication of `divisor`, `divisor_of_zeros`, and `divisor_of_poles` in the two files (say, by putting them in a common base class for the respective files)? It all looks like basically the same code.\n\n\nRight. Done.\n\n> \n> `self.divisor_group()(0)` -> `self.divisor_group().zero()` (the latter is cached).\n> \n\n\nDone.\n\n> Similarly, I am not sure I like having the `zero_divisor` method. If anything, it should do `DivisorGroup(field).zero()` and not be used to construct the `0` of the divisor group. I am slightly in favor of removing it for the explicitness of the code (as it is a one-liner), but I can somewhat see how it might be a more natural operation.\n\n\nDone.\n\n> \n> I don't see the point in the `valuation_ring` method as it does not involve `self`. This was something I missed on a previous review, but I noticed here because of the diff.\n\n\nRemoved.\n\n> \n> The `keys` here is unnecessary: `sorted(self._data.keys())`.\n> \n\n\nDone.\n\n> It is faster to use `while s and o:` instead of `while len(s) > 0 and len(o) > 0:`.\n\n\nDone.",
    "created_at": "2019-02-14T04:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377702",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:4 tscrim]:

> Is there a way to minimize the duplication of `divisor`, `divisor_of_zeros`, and `divisor_of_poles` in the two files (say, by putting them in a common base class for the respective files)? It all looks like basically the same code.


Right. Done.

> 
> `self.divisor_group()(0)` -> `self.divisor_group().zero()` (the latter is cached).
> 


Done.

> Similarly, I am not sure I like having the `zero_divisor` method. If anything, it should do `DivisorGroup(field).zero()` and not be used to construct the `0` of the divisor group. I am slightly in favor of removing it for the explicitness of the code (as it is a one-liner), but I can somewhat see how it might be a more natural operation.


Done.

> 
> I don't see the point in the `valuation_ring` method as it does not involve `self`. This was something I missed on a previous review, but I noticed here because of the diff.


Removed.

> 
> The `keys` here is unnecessary: `sorted(self._data.keys())`.
> 


Done.

> It is faster to use `while s and o:` instead of `while len(s) > 0 and len(o) > 0:`.


Done.



---

archive/issue_comments_377703.json:
```json
{
    "body": "Replying to [comment:5 klee]:\n> Replying to [comment:4 tscrim]:\n> > The `__radd__` should not be necessary as the coercion framework should take care of that (which you are using with `_add_`), unless you are trying to explicitly avoid the coercion framework (as the coercions you would need are not (or should not) be there).\n\n> \n> How could I achieve the following without `__radd__`?  An integer (in particular zero) is not supposed to be coerced to a place. Then how the coercion framework could enable the example below.  Would you give me hints?\n\n\nTo get this to work, you would need to allow `0` to convert into the parent (which is a special case within the coercion framework). So that is why this works:\n\n```\nsage: 0 + vector([1,2,1])\n(1, 2, 1)\nsage: coercion_model.canonical_coercion(0, v)\n((0, 0, 0), (1, 2, 1))\n```\nSo if you want it to work, you can hack something together to have `0` be some sort of allowed conversion to a dummy element.",
    "created_at": "2019-02-14T05:41:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377703",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:5 klee]:
> Replying to [comment:4 tscrim]:
> > The `__radd__` should not be necessary as the coercion framework should take care of that (which you are using with `_add_`), unless you are trying to explicitly avoid the coercion framework (as the coercions you would need are not (or should not) be there).

> 
> How could I achieve the following without `__radd__`?  An integer (in particular zero) is not supposed to be coerced to a place. Then how the coercion framework could enable the example below.  Would you give me hints?


To get this to work, you would need to allow `0` to convert into the parent (which is a special case within the coercion framework). So that is why this works:

```
sage: 0 + vector([1,2,1])
(1, 2, 1)
sage: coercion_model.canonical_coercion(0, v)
((0, 0, 0), (1, 2, 1))
```
So if you want it to work, you can hack something together to have `0` be some sort of allowed conversion to a dummy element.



---

archive/issue_comments_377704.json:
```json
{
    "body": "Also, the `.. NOTE::` block should have two colons and the following text should be indented, but this might be moot.",
    "created_at": "2019-02-14T05:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377704",
    "user": "https://github.com/tscrim"
}
```

Also, the `.. NOTE::` block should have two colons and the following text should be indented, but this might be moot.



---

archive/issue_comments_377705.json:
```json
{
    "body": "Replying to [comment:8 tscrim]:\n> Replying to [comment:5 klee]:\n> > Replying to [comment:4 tscrim]:\n> > > The `__radd__` should not be necessary as the coercion framework should take care of that (which you are using with `_add_`), unless you are trying to explicitly avoid the coercion framework (as the coercions you would need are not (or should not) be there).\n\n> > \n> > How could I achieve the following without `__radd__`?  An integer (in particular zero) is not supposed to be coerced to a place. Then how the coercion framework could enable the example below.  Would you give me hints?\n\n> \n> To get this to work, you would need to allow `0` to convert into the parent (which is a special case within the coercion framework). So that is why this works:\n> \n> ```\n> sage: 0 + vector([1,2,1])\n> (1, 2, 1)\n> sage: coercion_model.canonical_coercion(0, v)\n> ((0, 0, 0), (1, 2, 1))\n> ```\n> So if you want it to work, you can hack something together to have `0` be some sort of allowed conversion to a dummy element.\n\n\nFor vectors, `0` is naturally understood as zero vector, and the coercion system implements this. But as I said above, I don't want `0` to be coerced as some place (there is nothing like **zero place**). All I want is to make `sum(a bunch of places)` work.",
    "created_at": "2019-02-14T07:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377705",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:8 tscrim]:
> Replying to [comment:5 klee]:
> > Replying to [comment:4 tscrim]:
> > > The `__radd__` should not be necessary as the coercion framework should take care of that (which you are using with `_add_`), unless you are trying to explicitly avoid the coercion framework (as the coercions you would need are not (or should not) be there).

> > 
> > How could I achieve the following without `__radd__`?  An integer (in particular zero) is not supposed to be coerced to a place. Then how the coercion framework could enable the example below.  Would you give me hints?

> 
> To get this to work, you would need to allow `0` to convert into the parent (which is a special case within the coercion framework). So that is why this works:
> 
> ```
> sage: 0 + vector([1,2,1])
> (1, 2, 1)
> sage: coercion_model.canonical_coercion(0, v)
> ((0, 0, 0), (1, 2, 1))
> ```
> So if you want it to work, you can hack something together to have `0` be some sort of allowed conversion to a dummy element.


For vectors, `0` is naturally understood as zero vector, and the coercion system implements this. But as I said above, I don't want `0` to be coerced as some place (there is nothing like **zero place**). All I want is to make `sum(a bunch of places)` work.



---

archive/issue_comments_377706.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-14T08:13:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377707.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-02-14T16:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377707",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_377708.json:
```json
{
    "body": "Okay, if it does what you want, then positive review.",
    "created_at": "2019-02-14T16:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377708",
    "user": "https://github.com/tscrim"
}
```

Okay, if it does what you want, then positive review.



---

archive/issue_comments_377709.json:
```json
{
    "body": "Replying to [comment:12 tscrim]:\n> Okay, if it does what you want, then positive review.\n\n\nI admit that the `__radd__` thing is ugly. What I want is to allow `0 + p` for a place `p` to result in the **divisor** `p` (=`1*p`; divisors are just formal sums of places).  I wish that I could //fix// this later when I have a solution example of similar situation. \n\nThank you!",
    "created_at": "2019-02-14T23:18:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377709",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:12 tscrim]:
> Okay, if it does what you want, then positive review.


I admit that the `__radd__` thing is ugly. What I want is to allow `0 + p` for a place `p` to result in the **divisor** `p` (=`1*p`; divisors are just formal sums of places).  I wish that I could //fix// this later when I have a solution example of similar situation. 

Thank you!



---

archive/issue_events_067364.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-15T13:02:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26884#event-67364"
}
```



---

archive/issue_comments_377710.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-02-15T13:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26884",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26884#issuecomment-377710",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
