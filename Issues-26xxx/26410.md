# Issue 26410: Make threejs / three.js viewer respect thickness in parametric_plot3d

archive/issues_026173.json:
```json
{
    "body": "CC:  @embray @jcamp0x2a @paulmasson @slel @egourgoulhon @novoselt\n\nKeywords: threejs, three.js, parametric_plot3d, thickness, graphic options\n\nOn Windows and macOS, WebGL line thickness support is absent\nor limited, so that the three.js / threejs viewer appears not to respect\nthe thickness optional parameter in parametric_plot3d, while other\nviewers such as Jmol and Tachyon do.\n\nFor example, in Sage 8.3 or 8.7 on macOS 10.10.5, the thickness\nis not taken into account in the following -- whether launching it\nfrom the Sage REPL, the Jupyter notebook, or even SageCell online:\n\n```\nsage: pi = RDF.pi()\nsage: tau = 2*pi\nsage: a = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau)\nsage: b = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau + 1)\nsage: aa = parametric_plot(a, (-tau, tau), color='blue', thickness=1)\nsage: bb = parametric_plot(b, (-3*pi, pi), color='red', thickness=10)\nsage: p = aa + bb\nsage: p.show(viewer='threejs')\nLaunched html viewer for Graphics3d Object\nsage: p.show(viewer='jmol')\nLaunched jmol viewer for Graphics3d Object\nsage: p.show(viewer='tachyon')\nLaunched png viewer for Graphics3d Object\n```\n\nSuggested workarounds:\n- use `radius` instead of `thickness`.\n- use THREE.Meshline\n\nIssue created by migration from https://trac.sagemath.org/ticket/26410\n\n",
    "closed_at": "2021-02-20T10:46:35Z",
    "created_at": "2018-10-05T10:21:31Z",
    "labels": [
        "component: graphics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Make threejs / three.js viewer respect thickness in parametric_plot3d",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26410",
    "user": "https://github.com/slel"
}
```
CC:  @embray @jcamp0x2a @paulmasson @slel @egourgoulhon @novoselt

Keywords: threejs, three.js, parametric_plot3d, thickness, graphic options

On Windows and macOS, WebGL line thickness support is absent
or limited, so that the three.js / threejs viewer appears not to respect
the thickness optional parameter in parametric_plot3d, while other
viewers such as Jmol and Tachyon do.

For example, in Sage 8.3 or 8.7 on macOS 10.10.5, the thickness
is not taken into account in the following -- whether launching it
from the Sage REPL, the Jupyter notebook, or even SageCell online:

```
sage: pi = RDF.pi()
sage: tau = 2*pi
sage: a = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau)
sage: b = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau + 1)
sage: aa = parametric_plot(a, (-tau, tau), color='blue', thickness=1)
sage: bb = parametric_plot(b, (-3*pi, pi), color='red', thickness=10)
sage: p = aa + bb
sage: p.show(viewer='threejs')
Launched html viewer for Graphics3d Object
sage: p.show(viewer='jmol')
Launched jmol viewer for Graphics3d Object
sage: p.show(viewer='tachyon')
Launched png viewer for Graphics3d Object
```

Suggested workarounds:
- use `radius` instead of `thickness`.
- use THREE.Meshline

Issue created by migration from https://trac.sagemath.org/ticket/26410





---

archive/issue_comments_368421.json:
```json
{
    "body": "Changing keywords from \"\" to \"threejs, three.js, parametric_plot3d, thickness, graphic options\".",
    "created_at": "2018-10-05T10:27:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368421",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "threejs, three.js, parametric_plot3d, thickness, graphic options".



---

archive/issue_comments_368422.json:
```json
{
    "body": "Samuel, I don't see what the problem is: the red line looks thicker to me than the blue in the Three.js viewer. What are your expecting?",
    "created_at": "2019-03-31T21:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368422",
    "user": "https://github.com/paulmasson"
}
```

Samuel, I don't see what the problem is: the red line looks thicker to me than the blue in the Three.js viewer. What are your expecting?



---

archive/issue_comments_368423.json:
```json
{
    "body": "Paul, thanks a lot for having a look. For me the red line looks thicker in jmol and tachyon, but not in threejs.\nNot only on my computer, but also [on sagecell](https://sagecell.sagemath.org/?z=eJydjzEOwjAMRfecwluTNhQoG1I3xAG4AHLaSDWkTZSk9Pq4UwViYrO__vvfDgQt3C7XOpBUIuPMa1MGEsiDdDiaHiGfofNJZqVhUxJNX0pT5j0nKGH-ZqGCoxK4lgeMONocqbsH57NEDXLHFg1rh-ZU52NbGDfbgrWBuudkU2qZN-YHb1b-xK9pCLTx0faf-EGJwDjfUIExItRp8It8kV0s2_MQrX2kQr0B2b5ggQ==&lang=sage&interacts=eJyLjgUAARUAuQ==).",
    "created_at": "2019-04-01T08:27:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368423",
    "user": "https://github.com/slel"
}
```

Paul, thanks a lot for having a look. For me the red line looks thicker in jmol and tachyon, but not in threejs.
Not only on my computer, but also [on sagecell](https://sagecell.sagemath.org/?z=eJydjzEOwjAMRfecwluTNhQoG1I3xAG4AHLaSDWkTZSk9Pq4UwViYrO__vvfDgQt3C7XOpBUIuPMa1MGEsiDdDiaHiGfofNJZqVhUxJNX0pT5j0nKGH-ZqGCoxK4lgeMONocqbsH57NEDXLHFg1rh-ZU52NbGDfbgrWBuudkU2qZN-YHb1b-xK9pCLTx0faf-EGJwDjfUIExItRp8It8kV0s2_MQrX2kQr0B2b5ggQ==&lang=sage&interacts=eJyLjgUAARUAuQ==).



---

archive/issue_comments_368424.json:
```json
{
    "body": "That's probably because you're using a Windows machine. WebGL line thickness isn't supported at all in Windows, and support for it in macOS has limitations. It looks like line thickness will be removed from future versions of WebGL entirely.\n\nThe way to visualize thick lines is to use the `radius` parameter listed in the [documentation](http://doc.sagemath.org/html/en/reference/plot3d/threejs.html), which creates a cylinder along the path:\n\n```\npi = RDF.pi()\ntau = 2*pi\na = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau)\nb = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau + 1)\naa = parametric_plot(a, (-tau, tau), color='blue', thickness=1)\nbb = parametric_plot(b, (-3*pi, pi), color='red', radius=.1)\np = aa + bb\np.show(viewer='threejs')\n```\n\nThree.js has its own workaround for thick lines, but it's only in the examples, not the main library. I wouldn't implement it here until it's an official part of the main library.",
    "created_at": "2019-04-01T19:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368424",
    "user": "https://github.com/paulmasson"
}
```

That's probably because you're using a Windows machine. WebGL line thickness isn't supported at all in Windows, and support for it in macOS has limitations. It looks like line thickness will be removed from future versions of WebGL entirely.

The way to visualize thick lines is to use the `radius` parameter listed in the [documentation](http://doc.sagemath.org/html/en/reference/plot3d/threejs.html), which creates a cylinder along the path:

```
pi = RDF.pi()
tau = 2*pi
a = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau)
b = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau + 1)
aa = parametric_plot(a, (-tau, tau), color='blue', thickness=1)
bb = parametric_plot(b, (-3*pi, pi), color='red', radius=.1)
p = aa + bb
p.show(viewer='threejs')
```

Three.js has its own workaround for thick lines, but it's only in the examples, not the main library. I wouldn't implement it here until it's an official part of the main library.



---

archive/issue_comments_368425.json:
```json
{
    "body": "Thanks for explaining and for the workaround.\n\nThis was under macOS 10.10.5, using either Firefox 66.0.2 (64-bit),\nOpera 58.0.3135.118, Safari 10.1.2 (10603.3.8), so surely illustrating\nthe limitations you refer to.\n\nUsing `radius` as you suggest does the trick. A small enough radius works well.\nIf the curve is long and the radius gets somewhat large it is worth increasing the\nnumber of plot points so that the (piecewise linear) cylinder still looks more\ncurved than piecewise linear.\n\nThe following works well:\n\n```\npi = RDF.pi()\ntau = 2*pi\na = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau)\nb = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau + 1)\naa = parametric_plot(a, (-tau, tau), color='blue', radius=.02, plot_points=400)\nbb = parametric_plot(b, (-3*pi, pi), color='red', radius=.04, plot_points=400)\np = aa + bb\np.show(viewer='threejs')\n```\n\nI also notice that the cylinders have a polygonal base, with a number of\nsides depending on the radius; it seems to start 5-sided for small radius,\nand then the number of sides grows with the radius. Is there a way to\ncontrol that number of sides?\n\nThe following example shows the number of sides starting at 5 then\nincreasing to 6, 7, 8, 8, 9, 10, 11 (makes one want to guess the fomula\nfor `number_of_sides` as a function of `radius`):\n\n```\npp = parametric_plot\ncyl = lambda x, y: (lambda t: x, lambda t: y, lambda t: t)\npcyl = lambda x, y, r, h: pp(cyl(x, y), (0, 1), radius=r, rgbcolor=hue(h))\nparam = (.03, .04, .05, .06, .07, .08, .09, .10, .11, .12, .13, .14, .15, .16)\nnp = RDF(len(param))\ncylparam = lambda i, r: (0, 2.05*sum(param[:i])+r, r, (i+1)/(np+1))\np = sum((pcyl(*cylparam(i, r)) for i, r in enumerate(param)), Graphics())\np.show(frame=False, viewer='threejs')\n```",
    "created_at": "2019-04-02T16:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368425",
    "user": "https://github.com/slel"
}
```

Thanks for explaining and for the workaround.

This was under macOS 10.10.5, using either Firefox 66.0.2 (64-bit),
Opera 58.0.3135.118, Safari 10.1.2 (10603.3.8), so surely illustrating
the limitations you refer to.

Using `radius` as you suggest does the trick. A small enough radius works well.
If the curve is long and the radius gets somewhat large it is worth increasing the
number of plot points so that the (piecewise linear) cylinder still looks more
curved than piecewise linear.

The following works well:

```
pi = RDF.pi()
tau = 2*pi
a = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau)
b = (lambda t: cos(t), lambda t: sin(t), lambda t: 2*t/tau + 1)
aa = parametric_plot(a, (-tau, tau), color='blue', radius=.02, plot_points=400)
bb = parametric_plot(b, (-3*pi, pi), color='red', radius=.04, plot_points=400)
p = aa + bb
p.show(viewer='threejs')
```

I also notice that the cylinders have a polygonal base, with a number of
sides depending on the radius; it seems to start 5-sided for small radius,
and then the number of sides grows with the radius. Is there a way to
control that number of sides?

The following example shows the number of sides starting at 5 then
increasing to 6, 7, 8, 8, 9, 10, 11 (makes one want to guess the fomula
for `number_of_sides` as a function of `radius`):

```
pp = parametric_plot
cyl = lambda x, y: (lambda t: x, lambda t: y, lambda t: t)
pcyl = lambda x, y, r, h: pp(cyl(x, y), (0, 1), radius=r, rgbcolor=hue(h))
param = (.03, .04, .05, .06, .07, .08, .09, .10, .11, .12, .13, .14, .15, .16)
np = RDF(len(param))
cylparam = lambda i, r: (0, 2.05*sum(param[:i])+r, r, (i+1)/(np+1))
p = sum((pcyl(*cylparam(i, r)) for i, r in enumerate(param)), Graphics())
p.show(frame=False, viewer='threejs')
```



---

archive/issue_comments_368426.json:
```json
{
    "body": "I have encountered this problem myself, about a year ago, with my own threejs experiments outside of Sage.  It's really too bad this is still a problem.  IIRC the best workaround I found was to use the `THREE.MeshLine` plugin: https://github.com/spite/THREE.MeshLine\n\nIn particular, check out this cool demo: https://www.clicktorelease.com/code/THREE.MeshLine/demo/index.html\n\nPerhaps we could work that into Sage for use in parametric plots?",
    "created_at": "2019-04-03T10:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368426",
    "user": "https://github.com/embray"
}
```

I have encountered this problem myself, about a year ago, with my own threejs experiments outside of Sage.  It's really too bad this is still a problem.  IIRC the best workaround I found was to use the `THREE.MeshLine` plugin: https://github.com/spite/THREE.MeshLine

In particular, check out this cool demo: https://www.clicktorelease.com/code/THREE.MeshLine/demo/index.html

Perhaps we could work that into Sage for use in parametric plots?



---

archive/issue_events_065657.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2019-04-14T22:26:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26410#event-65657"
}
```



---

archive/issue_comments_368427.json:
```json
{
    "body": "Thanks! Very cool demo indeed -- it would be very nice to work that into Sage.",
    "created_at": "2019-04-14T22:27:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368427",
    "user": "https://github.com/slel"
}
```

Thanks! Very cool demo indeed -- it would be very nice to work that into Sage.



---

archive/issue_comments_368428.json:
```json
{
    "body": "Replying to [comment:8 slelievre]:\n> Thanks! Very cool demo indeed -- it would be very nice to work that into Sage.\n\n\nI was able to get [MeshLine](https://github.com/spite/THREE.MeshLine) integrated into the Three.js viewer quite easily. It's nice being able to get thick lines on my Windows box that aren't cylinders :) I've also got a branch that uses MeshLine instead of sprites to add arrow heads. (Although I don't think I ever put my sprite arrow heads up for review. They make `plot_vector_field3d` look a lot nicer.)\n\nThe packaging is the only part I'm unsure of. Right now I'm just having Sage copy the MeshLine code directly into the generated pages similar to what I do for my animation files. I imagine we'd probably want to treat it similarly to `threejs.min.js` and `OrbitControls.js`? That is: include `THREE.MeshLine.js` in the `threejs` SPKG for offline use and use the jsDelivr CDN link for online use?",
    "created_at": "2020-09-19T19:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368428",
    "user": "https://github.com/jcamp0x2a"
}
```

Replying to [comment:8 slelievre]:
> Thanks! Very cool demo indeed -- it would be very nice to work that into Sage.


I was able to get [MeshLine](https://github.com/spite/THREE.MeshLine) integrated into the Three.js viewer quite easily. It's nice being able to get thick lines on my Windows box that aren't cylinders :) I've also got a branch that uses MeshLine instead of sprites to add arrow heads. (Although I don't think I ever put my sprite arrow heads up for review. They make `plot_vector_field3d` look a lot nicer.)

The packaging is the only part I'm unsure of. Right now I'm just having Sage copy the MeshLine code directly into the generated pages similar to what I do for my animation files. I imagine we'd probably want to treat it similarly to `threejs.min.js` and `OrbitControls.js`? That is: include `THREE.MeshLine.js` in the `threejs` SPKG for offline use and use the jsDelivr CDN link for online use?



---

archive/issue_comments_368429.json:
```json
{
    "body": "With respect to packaging, we can\u2019t just add it to what we\u2019re doing with Three.js because it has a different owner with a separate license. And remember that Three.js has its own [implementation](https://threejs.org/examples/?q=fat#webgl_lines_fat) that looks better. We could package some of the files from the examples directory just like `OrbitControls.js`, but keep in mind that all of the simple non-module JavaScript files are disappearing at the end of the year...",
    "created_at": "2020-09-19T20:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368429",
    "user": "https://github.com/paulmasson"
}
```

With respect to packaging, we can’t just add it to what we’re doing with Three.js because it has a different owner with a separate license. And remember that Three.js has its own [implementation](https://threejs.org/examples/?q=fat#webgl_lines_fat) that looks better. We could package some of the files from the examples directory just like `OrbitControls.js`, but keep in mind that all of the simple non-module JavaScript files are disappearing at the end of the year...



---

archive/issue_comments_368430.json:
```json
{
    "body": "Replying to [comment:11 paulmasson]:\n> With respect to packaging, we can\u2019t just add it to what we\u2019re doing with Three.js because it has a different owner with a separate license.\n\n\nHmm, good point.\n\n> And remember that Three.js has its own [implementation](https://threejs.org/examples/?q=fat#webgl_lines_fat) that looks better.\n\n\nNice! I was not aware of that example (missed your [comment:4 previous comment] in this ticket), and I do agree it looks better. Also looks like we could use the wireframe example below it to spruce up the surface grid lines, too. One downside is that it doesn't seem to support varying width over the line like MeshLine does. I was using that to create arrow heads. Doesn't look like it would be difficult to add, though. (Don't quote me on that!)\n\n> We could package some of the files from the examples directory just like `OrbitControls.js`,\n\n\nI will proceed along the same lines then.\n\n> but keep in mind that all of the simple non-module JavaScript files are disappearing at the end of the year...\n\n\nOut of curiosity, do we know how we're going to handle this? As I understand, modules can't be loaded from the filesystem. So...\n\n- just drop support for running it purely locally, i.e. `online=False` and outside Jupyter?\n- spin up a simple server the first time a Three.js plot is shown per session for the sole purpose of serving the Three.js files? Would probably want to print a warning: \"Hey! This plot won't work once you exit Sage!\"\n- maintain our own non-module fork of the example files? I don't really have any interest in trying to keep such a fork up-to-date, even for only one file; heaven forbid the core Three.js ever goes module-only.\n- something else?",
    "created_at": "2020-09-19T23:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368430",
    "user": "https://github.com/jcamp0x2a"
}
```

Replying to [comment:11 paulmasson]:
> With respect to packaging, we can’t just add it to what we’re doing with Three.js because it has a different owner with a separate license.


Hmm, good point.

> And remember that Three.js has its own [implementation](https://threejs.org/examples/?q=fat#webgl_lines_fat) that looks better.


Nice! I was not aware of that example (missed your [comment:4 previous comment] in this ticket), and I do agree it looks better. Also looks like we could use the wireframe example below it to spruce up the surface grid lines, too. One downside is that it doesn't seem to support varying width over the line like MeshLine does. I was using that to create arrow heads. Doesn't look like it would be difficult to add, though. (Don't quote me on that!)

> We could package some of the files from the examples directory just like `OrbitControls.js`,


I will proceed along the same lines then.

> but keep in mind that all of the simple non-module JavaScript files are disappearing at the end of the year...


Out of curiosity, do we know how we're going to handle this? As I understand, modules can't be loaded from the filesystem. So...

- just drop support for running it purely locally, i.e. `online=False` and outside Jupyter?
- spin up a simple server the first time a Three.js plot is shown per session for the sole purpose of serving the Three.js files? Would probably want to print a warning: "Hey! This plot won't work once you exit Sage!"
- maintain our own non-module fork of the example files? I don't really have any interest in trying to keep such a fork up-to-date, even for only one file; heaven forbid the core Three.js ever goes module-only.
- something else?



---

archive/issue_comments_368431.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-20T18:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368431",
    "user": "https://github.com/jcamp0x2a"
}
```

Changing status from new to needs_review.



---

archive/issue_events_065658.json:
```json
{
    "actor": "https://github.com/jcamp0x2a",
    "created_at": "2020-09-20T18:10:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26410#event-65658"
}
```



---

archive/issue_events_065659.json:
```json
{
    "actor": "https://github.com/jcamp0x2a",
    "created_at": "2020-09-20T18:10:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26410#event-65659"
}
```



---

archive/issue_comments_368432.json:
```json
{
    "body": "I've pushed a branch that is based on the [webgl_lines_fat](https://threejs.org/examples/?q=fat#webgl_lines_fat) example that applies to both regular lines and surface grid lines. I opted not to follow the [webgl_lines_fat_wireframe](https://threejs.org/examples/?q=fat#webgl_lines_fat_wireframe) example for the surface grid since it would outline the generated triangles and not the original polygons coming from Sage.\n\nRequires the following files from Three.js's `examples/js/lines` directory:\n\n- `LineMaterial.js`\n- `LineSegmentsGeometry.js`\n- `LineGeometry.js`\n- `LineSegments2.js`\n- `Line2.js`\n\nThey have all been added to the threejs SPKG. Since I had to modify the SPKG anyway, I went ahead and bumped Three.js up to the current version, r120. The new tarball is attached. If it'd be preferred to do the upgrade/repackaging in a separate ticket first, I can do that as well.\n\nWhether these files and the new `fat_lines.js` script that uses them are included on the page depends on whether any lines or surface meshes with thickness > 1 are present in the scene so as not to slow down loading of plots that don't require this functionality.\n\nI'm anticipating a merge conflict with #30462, but it should be trivial.\n\n---\nNew commits:",
    "created_at": "2020-09-20T18:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368432",
    "user": "https://github.com/jcamp0x2a"
}
```

I've pushed a branch that is based on the [webgl_lines_fat](https://threejs.org/examples/?q=fat#webgl_lines_fat) example that applies to both regular lines and surface grid lines. I opted not to follow the [webgl_lines_fat_wireframe](https://threejs.org/examples/?q=fat#webgl_lines_fat_wireframe) example for the surface grid since it would outline the generated triangles and not the original polygons coming from Sage.

Requires the following files from Three.js's `examples/js/lines` directory:

- `LineMaterial.js`
- `LineSegmentsGeometry.js`
- `LineGeometry.js`
- `LineSegments2.js`
- `Line2.js`

They have all been added to the threejs SPKG. Since I had to modify the SPKG anyway, I went ahead and bumped Three.js up to the current version, r120. The new tarball is attached. If it'd be preferred to do the upgrade/repackaging in a separate ticket first, I can do that as well.

Whether these files and the new `fat_lines.js` script that uses them are included on the page depends on whether any lines or surface meshes with thickness > 1 are present in the scene so as not to slow down loading of plots that don't require this functionality.

I'm anticipating a merge conflict with #30462, but it should be trivial.

---
New commits:



---

archive/issue_comments_368433.json:
```json
{
    "body": "Attachment [threejs-r120.tar.gz](tarball://root/attachments/some-uuid/ticket26410/threejs-r120.tar.gz) by @jcamp0x2a created at 2020-09-20 18:11:42",
    "created_at": "2020-09-20T18:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368433",
    "user": "https://github.com/jcamp0x2a"
}
```

Attachment [threejs-r120.tar.gz](tarball://root/attachments/some-uuid/ticket26410/threejs-r120.tar.gz) by @jcamp0x2a created at 2020-09-20 18:11:42



---

archive/issue_events_065660.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-09-20T19:12:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26410#event-65660"
}
```



---

archive/issue_events_065661.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-09-20T19:12:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26410#event-65661"
}
```



---

archive/issue_comments_368434.json:
```json
{
    "body": "Joshua, the version upgrade needs to be a separate ticket so the release manager knows to copy the attachment to the mirrors.\n\nI haven\u2019t looked at the Three.js example in detail. Are all of the files you copied actually used here?",
    "created_at": "2020-09-20T19:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368434",
    "user": "https://github.com/paulmasson"
}
```

Joshua, the version upgrade needs to be a separate ticket so the release manager knows to copy the attachment to the mirrors.

I haven’t looked at the Three.js example in detail. Are all of the files you copied actually used here?



---

archive/issue_comments_368435.json:
```json
{
    "body": "Replying to [comment:14 paulmasson]:\n> Joshua, the version upgrade needs to be a separate ticket so the release manager knows to copy the attachment to the mirrors.\n\n\nUnderstood. Is there somewhere I would need to post the ticket number, like in sage-devel, in order for it to be picked up? Or would duplicating the structure of your r117 ticket, #29809, be enough? Please forgive me if I'm overstepping here and you'd prefer to manage the Three.js upgrades. I know the viewer is your creation, and I'm very grateful for it :)\n\n> I haven\u2019t looked at the Three.js example in detail. Are all of the files you copied actually used here?\n\n\nYes, they're all used in `fat_lines.js`, but I could potentially get rid of [Line2](https://github.com/mrdoob/three.js/blob/master/examples/js/lines/Line2.js) and [LineGeometry](https://github.com/mrdoob/three.js/blob/master/examples/js/lines/LineGeometry.js) if we want to absolutely minimize the number of scripts fetched / included on the page. They are pretty minimal wrappers around [LineSegments2](https://github.com/mrdoob/three.js/blob/master/examples/js/lines/LineSegments2.js) and [LineSegmentsGeometry](https://github.com/mrdoob/three.js/blob/master/examples/js/lines/LineSegmentsGeometry.js), respectively. Could easily turn the line strip into line segments ourselves.",
    "created_at": "2020-09-20T20:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368435",
    "user": "https://github.com/jcamp0x2a"
}
```

Replying to [comment:14 paulmasson]:
> Joshua, the version upgrade needs to be a separate ticket so the release manager knows to copy the attachment to the mirrors.


Understood. Is there somewhere I would need to post the ticket number, like in sage-devel, in order for it to be picked up? Or would duplicating the structure of your r117 ticket, #29809, be enough? Please forgive me if I'm overstepping here and you'd prefer to manage the Three.js upgrades. I know the viewer is your creation, and I'm very grateful for it :)

> I haven’t looked at the Three.js example in detail. Are all of the files you copied actually used here?


Yes, they're all used in `fat_lines.js`, but I could potentially get rid of [Line2](https://github.com/mrdoob/three.js/blob/master/examples/js/lines/Line2.js) and [LineGeometry](https://github.com/mrdoob/three.js/blob/master/examples/js/lines/LineGeometry.js) if we want to absolutely minimize the number of scripts fetched / included on the page. They are pretty minimal wrappers around [LineSegments2](https://github.com/mrdoob/three.js/blob/master/examples/js/lines/LineSegments2.js) and [LineSegmentsGeometry](https://github.com/mrdoob/three.js/blob/master/examples/js/lines/LineSegmentsGeometry.js), respectively. Could easily turn the line strip into line segments ourselves.



---

archive/issue_comments_368436.json:
```json
{
    "body": "I don't mind if you perform the upgrade. Just copy the last one, making sure \"upgrade\" is clearly stated. And make sure there are no errors in the template from features that might have changed. Test against a variety of graphics.\n\nI've opened #30620 to discuss the possibilities for handling modular files. Considering that the change is coming in a couple months, you might want to minimize the number of files copied now. Or you may want to put this ticket on hold until we address the bigger issue. The change is a real pain...",
    "created_at": "2020-09-20T21:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368436",
    "user": "https://github.com/paulmasson"
}
```

I don't mind if you perform the upgrade. Just copy the last one, making sure "upgrade" is clearly stated. And make sure there are no errors in the template from features that might have changed. Test against a variety of graphics.

I've opened #30620 to discuss the possibilities for handling modular files. Considering that the change is coming in a couple months, you might want to minimize the number of files copied now. Or you may want to put this ticket on hold until we address the bigger issue. The change is a real pain...



---

archive/issue_comments_368437.json:
```json
{
    "body": "Replying to [comment:16 paulmasson]:\n> I've opened #30620 to discuss the possibilities for handling modular files. Considering that the change is coming in a couple months, you might want to minimize the number of files copied now. Or you may want to put this ticket on hold until we address the bigger issue. The change is a real pain...\n\n\nGoing to put it on hold then until that's resolved.",
    "created_at": "2020-09-21T02:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368437",
    "user": "https://github.com/jcamp0x2a"
}
```

Replying to [comment:16 paulmasson]:
> I've opened #30620 to discuss the possibilities for handling modular files. Considering that the change is coming in a couple months, you might want to minimize the number of files copied now. Or you may want to put this ticket on hold until we address the bigger issue. The change is a real pain...


Going to put it on hold then until that's resolved.



---

archive/issue_comments_368438.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-09-21T02:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368438",
    "user": "https://github.com/jcamp0x2a"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_368439.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-06T05:10:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368439",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_368440.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-06T05:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368440",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_368441.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-06T23:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368441",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_368442.json:
```json
{
    "body": "Now that the Three.js r122 update has been merged in #30915, I've pushed an updated version of this branch.",
    "created_at": "2020-12-06T23:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368442",
    "user": "https://github.com/jcamp0x2a"
}
```

Now that the Three.js r122 update has been merged in #30915, I've pushed an updated version of this branch.



---

archive/issue_comments_368443.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-12-06T23:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368443",
    "user": "https://github.com/jcamp0x2a"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_events_065662.json:
```json
{
    "actor": "https://github.com/jcamp0x2a",
    "created_at": "2020-12-06T23:08:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26410#event-65662"
}
```



---

archive/issue_events_065663.json:
```json
{
    "actor": "https://github.com/jcamp0x2a",
    "created_at": "2020-12-06T23:08:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26410#event-65663"
}
```



---

archive/issue_comments_368444.json:
```json
{
    "body": "Replying to [comment:22 gh-jcamp0x2a]:\n> Now that the Three.js r122 update has been merged in #30915, I've pushed an updated version of this branch.\n\nThere is a merge conflict with Sage 9.3.beta5. Could you please fix this?",
    "created_at": "2020-12-29T16:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368444",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:22 gh-jcamp0x2a]:
> Now that the Three.js r122 update has been merged in #30915, I've pushed an updated version of this branch.

There is a merge conflict with Sage 9.3.beta5. Could you please fix this?



---

archive/issue_comments_368445.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-29T21:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368445",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_368446.json:
```json
{
    "body": "Replying to [comment:25 egourgoulhon]:\n> Replying to [comment:22 gh-jcamp0x2a]:\n> > Now that the Three.js r122 update has been merged in #30915, I've pushed an updated version of this branch.\n\n> There is a merge conflict with Sage 9.3.beta5. Could you please fix this?\n\nThanks, I've merged in the latest develop branch. Did a quick sanity check to make sure the feature still works, too.",
    "created_at": "2020-12-29T21:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368446",
    "user": "https://github.com/jcamp0x2a"
}
```

Replying to [comment:25 egourgoulhon]:
> Replying to [comment:22 gh-jcamp0x2a]:
> > Now that the Three.js r122 update has been merged in #30915, I've pushed an updated version of this branch.

> There is a merge conflict with Sage 9.3.beta5. Could you please fix this?

Thanks, I've merged in the latest develop branch. Did a quick sanity check to make sure the feature still works, too.



---

archive/issue_comments_368447.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-05T18:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368447",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_368448.json:
```json
{
    "body": "Sorry the delay! LGTM. Thanks.",
    "created_at": "2021-02-05T18:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368448",
    "user": "https://github.com/egourgoulhon"
}
```

Sorry the delay! LGTM. Thanks.



---

archive/issue_comments_368449.json:
```json
{
    "body": "Replying to [comment:29 egourgoulhon]:\n> Sorry the delay! LGTM. Thanks.\n\n\nNo worries. I haven't been able to do much Sage stuff recently myself. Thanks for the review :)",
    "created_at": "2021-02-11T21:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368449",
    "user": "https://github.com/jcamp0x2a"
}
```

Replying to [comment:29 egourgoulhon]:
> Sorry the delay! LGTM. Thanks.


No worries. I haven't been able to do much Sage stuff recently myself. Thanks for the review :)



---

archive/issue_events_065664.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-02-20T10:46:35Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26410#event-65664"
}
```



---

archive/issue_comments_368450.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-02-20T10:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26410#issuecomment-368450",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
