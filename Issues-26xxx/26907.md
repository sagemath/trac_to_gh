# Issue 26907: Exact division in ℤ[x][y] is broken

archive/issues_026670.json:
```json
{
    "assignees": [],
    "body": "Issue:\n\n```\nsage: P.<x> = ZZ[]\nsage: Q.<y> = P[]\nsage: a = 3*y + 1\nsage: a//a\nTypeError: no conversion of this rational to integer\n```\n\ndue to cb8db697a1b (#26433).\n\nThe branch on this ticket fixes that issue and improves `inverse_of_unit()`; see the commit messages for detail.\n\nBranch/Commit: **[839c605](https://github.com/sagemath/sagetrac-mirror/commit/839c605a6160d26877b184958a307cf42ffe21f9)**\n\nReviewer: **Vincent Delecroix**\n\nAuthor: **Travis Scrimshaw, Marc Mezzarobba**\n\nComponent: **basic arithmetic**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26907_\n\n",
    "closed_at": "2019-01-23T15:39:31Z",
    "created_at": "2018-12-17T11:37:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Exact division in \u2124[x][y] is broken",
    "type": "issue",
    "updated_at": "2019-01-23T15:39:31Z",
    "url": "https://github.com/sagemath/sage/issues/26907",
    "user": "https://github.com/mezzarobba"
}
```
Issue:

```
sage: P.<x> = ZZ[]
sage: Q.<y> = P[]
sage: a = 3*y + 1
sage: a//a
TypeError: no conversion of this rational to integer
```

due to cb8db697a1b (#26433).

The branch on this ticket fixes that issue and improves `inverse_of_unit()`; see the commit messages for detail.

Branch/Commit: **[839c605](https://github.com/sagemath/sagetrac-mirror/commit/839c605a6160d26877b184958a307cf42ffe21f9)**

Reviewer: **Vincent Delecroix**

Author: **Travis Scrimshaw, Marc Mezzarobba**

Component: **basic arithmetic**

_Issue created by migration from https://trac.sagemath.org/ticket/26907_





---

archive/issue_events_369663.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-12-17T11:37:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "milestone_number": null,
    "milestone_title": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369663"
}
```



---

archive/issue_events_369664.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-12-17T11:37:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369664"
}
```



---

archive/issue_events_369665.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-12-17T11:37:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369665"
}
```



---

archive/issue_events_369666.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-12-17T11:37:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369666"
}
```



---

archive/issue_comments_414620.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThe simple fix should be to add\n\n```diff\n         try:\n             inv = y[n-1].inverse_of_unit()\n-        except (ArithmeticError, ValueError):\n+        except (ArithmeticError, ValueError, TypeError):\n             inv = ~(y[n-1])\n             convert = True\n```\nHowever, I would argue the real bug is here:\n\n```\nsage: R.<x> = ZZ[]\nsage: R(2).inverse_of_unit()\n...\nTypeError: no conversion of this rational to integer\n```\nIn particular, we are inconsistent about the type of error that is raised. This was an assumption in the code block above, which is why it was not caught. Hence, the above change should fix this, but sweep the underlying issue under the rug.\n\nAlso, wouldn't it be better to do\n\n```diff\n         elif d == -1:\n             return self._parent(~self._parent._base.zero())\n-        return self._parent(~self.get_unsafe(0))\n+        return self._parent(self.get_unsafe(0).inverse_of_unit())\n```\n\nSide note: We probably should add a generic `inverse_of_unit` to the category of `Fields` that simply returns `~self`.",
    "created_at": "2018-12-17T11:56:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414620",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:1" align="right">comment:1</div>

The simple fix should be to add

```diff
         try:
             inv = y[n-1].inverse_of_unit()
-        except (ArithmeticError, ValueError):
+        except (ArithmeticError, ValueError, TypeError):
             inv = ~(y[n-1])
             convert = True
```
However, I would argue the real bug is here:

```
sage: R.<x> = ZZ[]
sage: R(2).inverse_of_unit()
...
TypeError: no conversion of this rational to integer
```
In particular, we are inconsistent about the type of error that is raised. This was an assumption in the code block above, which is why it was not caught. Hence, the above change should fix this, but sweep the underlying issue under the rug.

Also, wouldn't it be better to do

```diff
         elif d == -1:
             return self._parent(~self._parent._base.zero())
-        return self._parent(~self.get_unsafe(0))
+        return self._parent(self.get_unsafe(0).inverse_of_unit())
```

Side note: We probably should add a generic `inverse_of_unit` to the category of `Fields` that simply returns `~self`.



---

archive/issue_events_369667.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2018-12-22T20:30:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369667"
}
```



---

archive/issue_comments_414621.json:
```json
{
    "body": "Author: **Travis Scrimshaw, Marc Mezzarobba**",
    "created_at": "2018-12-22T20:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414621",
    "user": "https://github.com/mezzarobba"
}
```

Author: **Travis Scrimshaw, Marc Mezzarobba**



---

archive/issue_comments_414622.json:
```json
{
    "body": "Commit: **[9f94bd6](https://github.com/sagemath/sagetrac-mirror/commit/9f94bd6056d8f62dd1a417fc8aac65a653b51322)**",
    "created_at": "2018-12-22T20:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414622",
    "user": "https://github.com/mezzarobba"
}
```

Commit: **[9f94bd6](https://github.com/sagemath/sagetrac-mirror/commit/9f94bd6056d8f62dd1a417fc8aac65a653b51322)**



---

archive/issue_comments_414623.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,96 +4,7 @@\n sage: Q.<y> = P[]\n sage: a = 3*y + 1\n sage: a//a\n----------------------------------------------------------------------------\n-TypeError                                 Traceback (most recent call last)\n-<ipython-input-28-932792481982> in <module>()\n-----> 1 a//a\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial_generic_dense.__floordiv__ (build/cythonized/sage/rings/polynomial/polynomial_element.c:88374)()\n-  10816         \"\"\"\n-  10817         if have_same_parent(self, right):\n-> 10818             return (<Polynomial_generic_dense>self)._floordiv_(<Polynomial_generic_dense>right)\n-  10819         P = parent(self)\n-  10820         d = P.base_ring()(right)\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial._floordiv_ (build/cythonized/sage/rings/polynomial/polynomial_element.c:28587)()\n-   2748             # quite typical when removing gcds...\n-   2749             return self\n--> 2750         Q, _ = self.quo_rem(right)\n-   2751         return Q\n-   2752 \n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/element.pyx in sage.structure.element.coerce_binop.new_method (build/cythonized/sage/structure/element.c:27512)()\n-   4282     def new_method(self, other, *args, **kwargs):\n-   4283         if have_same_parent(self, other):\n--> 4284             return method(self, other, *args, **kwargs)\n-   4285         else:\n-   4286             a, b = coercion_model.canonical_coercion(self, other)\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial_generic_dense.quo_rem (build/cythonized/sage/rings/polynomial/polynomial_element.c:91271)()\n-  11065         cdef Py_ssize_t j, k\n-  11066         try:\n-> 11067             inv = y[n-1].inverse_of_unit()\n-  11068         except (ArithmeticError, ValueError):\n-  11069             inv = ~(y[n-1])\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.inverse_of_unit (build/cythonized/sage/rings/polynomial/polynomial_element.c:14449)()\n-   1385         elif d == -1:\n-   1386             return self._parent(~self._parent._base.zero())\n--> 1387         return self._parent(~self.get_unsafe(0))\n-   1388 \n-   1389     def inverse_mod(a, m):\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9531)()\n-    917         if mor is not None:\n-    918             if no_extra_args:\n---> 919                 return mor._call_(x)\n-    920             else:\n-    921                 return mor._call_with_args(x, args, kwds)\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4595)()\n-    143                 print(type(C), C)\n-    144                 print(type(C._element_constructor), C._element_constructor)\n---> 145             raise\n-    146 \n-    147     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4487)()\n-    138         cdef Parent C = self._codomain\n-    139         try:\n---> 140             return C._element_constructor(x)\n-    141         except Exception:\n-    142             if print_warnings:\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.pyc in _element_constructor_(self, x, check, is_gen, construct, **kwds)\n-    458         elif isinstance(x, sage.rings.power_series_ring_element.PowerSeries):\n-    459             x = x.truncate()\n---> 460         return C(self, x, check, is_gen, construct=construct, **kwds)\n-    461 \n-    462     @classmethod\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_integer_dense_flint.pyx in sage.rings.polynomial.polynomial_integer_dense_flint.Polynomial_integer_dense_flint.__init__ (build/cythonized/sage/rings/polynomial/polynomial_integer_dense_flint.cpp:6706)()\n-    286             else:\n-    287                 if not isinstance(a, Integer):\n---> 288                     a = ZZ(a)\n-    289                 sig_on()\n-    290                 fmpz_poly_set_coeff_mpz(self.__poly, i, (<Integer>a).value)\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9531)()\n-    917         if mor is not None:\n-    918             if no_extra_args:\n---> 919                 return mor._call_(x)\n-    920             else:\n-    921                 return mor._call_with_args(x, args, kwds)\n-\n-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/rational.pyx in sage.rings.rational.Q_to_Z._call_ (build/cythonized/sage/rings/rational.c:32086)()\n-   4140         \"\"\"\n-   4141         if not mpz_cmp_si(mpq_denref((<Rational>x).value), 1) == 0:\n--> 4142             raise TypeError(\"no conversion of this rational to integer\")\n-   4143         cdef Integer n = Integer.__new__(Integer)\n-   4144         n.set_from_mpz(mpq_numref((<Rational>x).value))\n-\n TypeError: no conversion of this rational to integer\n ```\n \n-I think it might be due to cb8db697a1b (#26433), but I didn't check.\n+due to cb8db697a1b (#26433)\n``````\n",
    "created_at": "2018-12-22T20:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414623",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,96 +4,7 @@
 sage: Q.<y> = P[]
 sage: a = 3*y + 1
 sage: a//a
----------------------------------------------------------------------------
-TypeError                                 Traceback (most recent call last)
-<ipython-input-28-932792481982> in <module>()
-----> 1 a//a
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial_generic_dense.__floordiv__ (build/cythonized/sage/rings/polynomial/polynomial_element.c:88374)()
-  10816         """
-  10817         if have_same_parent(self, right):
-> 10818             return (<Polynomial_generic_dense>self)._floordiv_(<Polynomial_generic_dense>right)
-  10819         P = parent(self)
-  10820         d = P.base_ring()(right)
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial._floordiv_ (build/cythonized/sage/rings/polynomial/polynomial_element.c:28587)()
-   2748             # quite typical when removing gcds...
-   2749             return self
--> 2750         Q, _ = self.quo_rem(right)
-   2751         return Q
-   2752 
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/element.pyx in sage.structure.element.coerce_binop.new_method (build/cythonized/sage/structure/element.c:27512)()
-   4282     def new_method(self, other, *args, **kwargs):
-   4283         if have_same_parent(self, other):
--> 4284             return method(self, other, *args, **kwargs)
-   4285         else:
-   4286             a, b = coercion_model.canonical_coercion(self, other)
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial_generic_dense.quo_rem (build/cythonized/sage/rings/polynomial/polynomial_element.c:91271)()
-  11065         cdef Py_ssize_t j, k
-  11066         try:
-> 11067             inv = y[n-1].inverse_of_unit()
-  11068         except (ArithmeticError, ValueError):
-  11069             inv = ~(y[n-1])
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.inverse_of_unit (build/cythonized/sage/rings/polynomial/polynomial_element.c:14449)()
-   1385         elif d == -1:
-   1386             return self._parent(~self._parent._base.zero())
--> 1387         return self._parent(~self.get_unsafe(0))
-   1388 
-   1389     def inverse_mod(a, m):
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9531)()
-    917         if mor is not None:
-    918             if no_extra_args:
---> 919                 return mor._call_(x)
-    920             else:
-    921                 return mor._call_with_args(x, args, kwds)
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4595)()
-    143                 print(type(C), C)
-    144                 print(type(C._element_constructor), C._element_constructor)
---> 145             raise
-    146 
-    147     cpdef Element _call_with_args(self, x, args=(), kwds={}):
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4487)()
-    138         cdef Parent C = self._codomain
-    139         try:
---> 140             return C._element_constructor(x)
-    141         except Exception:
-    142             if print_warnings:
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_ring.pyc in _element_constructor_(self, x, check, is_gen, construct, **kwds)
-    458         elif isinstance(x, sage.rings.power_series_ring_element.PowerSeries):
-    459             x = x.truncate()
---> 460         return C(self, x, check, is_gen, construct=construct, **kwds)
-    461 
-    462     @classmethod
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_integer_dense_flint.pyx in sage.rings.polynomial.polynomial_integer_dense_flint.Polynomial_integer_dense_flint.__init__ (build/cythonized/sage/rings/polynomial/polynomial_integer_dense_flint.cpp:6706)()
-    286             else:
-    287                 if not isinstance(a, Integer):
---> 288                     a = ZZ(a)
-    289                 sig_on()
-    290                 fmpz_poly_set_coeff_mpz(self.__poly, i, (<Integer>a).value)
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9531)()
-    917         if mor is not None:
-    918             if no_extra_args:
---> 919                 return mor._call_(x)
-    920             else:
-    921                 return mor._call_with_args(x, args, kwds)
-
-/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/rational.pyx in sage.rings.rational.Q_to_Z._call_ (build/cythonized/sage/rings/rational.c:32086)()
-   4140         """
-   4141         if not mpz_cmp_si(mpq_denref((<Rational>x).value), 1) == 0:
--> 4142             raise TypeError("no conversion of this rational to integer")
-   4143         cdef Integer n = Integer.__new__(Integer)
-   4144         n.set_from_mpz(mpq_numref((<Rational>x).value))
-
 TypeError: no conversion of this rational to integer
 ```
 
-I think it might be due to cb8db697a1b (#26433), but I didn't check.
+due to cb8db697a1b (#26433)
``````




---

archive/issue_comments_414624.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/238c1b7e7ba418fc6f95c8f05875dbaa2ada0b1b\">238c1b7</a></td><td><code>#26907 Polynomial.inverse_of_unit(): fix choice of exception</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30831ce2f3c14295761368b51436e1d2731c4405\">30831ce</a></td><td><code>#26907 check that exact division in \u2124[x][y] works again</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f94bd6056d8f62dd1a417fc8aac65a653b51322\">9f94bd6</a></td><td><code>Fields: generic inverse_of_unit()</code></td></tr></table>\n",
    "created_at": "2018-12-22T20:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414624",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/238c1b7e7ba418fc6f95c8f05875dbaa2ada0b1b">238c1b7</a></td><td><code>#26907 Polynomial.inverse_of_unit(): fix choice of exception</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30831ce2f3c14295761368b51436e1d2731c4405">30831ce</a></td><td><code>#26907 check that exact division in ℤ[x][y] works again</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f94bd6056d8f62dd1a417fc8aac65a653b51322">9f94bd6</a></td><td><code>Fields: generic inverse_of_unit()</code></td></tr></table>




---

archive/issue_comments_414625.json:
```json
{
    "body": "Branch: **[u/mmezzarobba/poly_inverse_of_unit](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/poly_inverse_of_unit)**",
    "created_at": "2018-12-22T20:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414625",
    "user": "https://github.com/mezzarobba"
}
```

Branch: **[u/mmezzarobba/poly_inverse_of_unit](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/poly_inverse_of_unit)**



---

archive/issue_comments_414626.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nSo this behavior should change now with this change:\n\n```\nsage: RR(0).inverse_of_unit()\n---------------------------------------------------------------------------\nArithmeticError                           Traceback (most recent call last)\n<ipython-input-7-9817ebd4dc31> in <module>()\n----> 1 RR(Integer(0)).inverse_of_unit()\n\n/home/travis/sage-build/local/lib/python2.7/site-packages/sage/categories/rings.pyc in inverse_of_unit(self)\n   1155             try:\n   1156                 if not self.is_unit():\n-> 1157                     raise ArithmeticError(\"element is not a unit\")\n   1158             except NotImplementedError:\n   1159                 # if an element does not implement is_unit, we just try to\n\nArithmeticError: element is not a unit\nsage: 1/RR(0)\n+infinity\n```\nI think it is the correct change, but I am now maybe a little worried about assumptions and we might want to quickly ask on sage-devel about this to confirm.\n\nAlso, a better test:\n\n```\n                sage: try:\n                ....:    QQ(0).inverse_of_unit()\n                ....: except ArithmeticError as e:\n                ....:    print(type(e))\n                <... 'exceptions.ZeroDivisionError'>\n```\nto\n\n```\n                sage: QQ(0).inverse_of_unit()\n                Traceback (most recent call last):\n                ...\n                ZeroDivisionError: rational division by zero\n```",
    "created_at": "2018-12-22T21:07:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414626",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:3" align="right">comment:3</div>

So this behavior should change now with this change:

```
sage: RR(0).inverse_of_unit()
---------------------------------------------------------------------------
ArithmeticError                           Traceback (most recent call last)
<ipython-input-7-9817ebd4dc31> in <module>()
----> 1 RR(Integer(0)).inverse_of_unit()

/home/travis/sage-build/local/lib/python2.7/site-packages/sage/categories/rings.pyc in inverse_of_unit(self)
   1155             try:
   1156                 if not self.is_unit():
-> 1157                     raise ArithmeticError("element is not a unit")
   1158             except NotImplementedError:
   1159                 # if an element does not implement is_unit, we just try to

ArithmeticError: element is not a unit
sage: 1/RR(0)
+infinity
```
I think it is the correct change, but I am now maybe a little worried about assumptions and we might want to quickly ask on sage-devel about this to confirm.

Also, a better test:

```
                sage: try:
                ....:    QQ(0).inverse_of_unit()
                ....: except ArithmeticError as e:
                ....:    print(type(e))
                <... 'exceptions.ZeroDivisionError'>
```
to

```
                sage: QQ(0).inverse_of_unit()
                Traceback (most recent call last):
                ...
                ZeroDivisionError: rational division by zero
```



---

archive/issue_comments_414627.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@tscrim](#comment:3):\n> So this behavior should change now with this change:\n> \n> ```\n> sage: RR(0).inverse_of_unit()\n> ---------------------------------------------------------------------------\n> ArithmeticError                           Traceback (most recent call last)\n> <ipython-input-7-9817ebd4dc31> in <module>()\n> ----> 1 RR(Integer(0)).inverse_of_unit()\n> \n> /home/travis/sage-build/local/lib/python2.7/site-packages/sage/categories/rings.pyc in inverse_of_unit(self)\n>    1155             try:\n>    1156                 if not self.is_unit():\n> -> 1157                     raise ArithmeticError(\"element is not a unit\")\n>    1158             except NotImplementedError:\n>    1159                 # if an element does not implement is_unit, we just try to\n> \n> ArithmeticError: element is not a unit\n> sage: 1/RR(0)\n> +infinity\n> ```\n> I think it is the correct change, but I am now maybe a little worried about assumptions and we might want to quickly ask on sage-devel about this to confirm.\n\nI just followed your suggestion here, I have no opinion on the matter.\n\n> Also, a better test:\n> \n> ```\n>                 sage: try:\n>                 ....:    QQ(0).inverse_of_unit()\n>                 ....: except ArithmeticError as e:\n>                 ....:    print(type(e))\n>                 <... 'exceptions.ZeroDivisionError'>\n> ```\n> to\n> \n> ```\n>                 sage: QQ(0).inverse_of_unit()\n>                 Traceback (most recent call last):\n>                 ...\n>                 ZeroDivisionError: rational division by zero\n> ```\n\nI deliberately wrote it that way, to hint to the fact that it is often better to catch all `ArithmeticError`s than just `ZeroDivisionError`s if you are `calling inverse_of_unit()`\u2014but yes, I should have been more explicit!",
    "created_at": "2018-12-23T06:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414627",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@tscrim](#comment:3):
> So this behavior should change now with this change:
> 
> ```
> sage: RR(0).inverse_of_unit()
> ---------------------------------------------------------------------------
> ArithmeticError                           Traceback (most recent call last)
> <ipython-input-7-9817ebd4dc31> in <module>()
> ----> 1 RR(Integer(0)).inverse_of_unit()
> 
> /home/travis/sage-build/local/lib/python2.7/site-packages/sage/categories/rings.pyc in inverse_of_unit(self)
>    1155             try:
>    1156                 if not self.is_unit():
> -> 1157                     raise ArithmeticError("element is not a unit")
>    1158             except NotImplementedError:
>    1159                 # if an element does not implement is_unit, we just try to
> 
> ArithmeticError: element is not a unit
> sage: 1/RR(0)
> +infinity
> ```
> I think it is the correct change, but I am now maybe a little worried about assumptions and we might want to quickly ask on sage-devel about this to confirm.

I just followed your suggestion here, I have no opinion on the matter.

> Also, a better test:
> 
> ```
>                 sage: try:
>                 ....:    QQ(0).inverse_of_unit()
>                 ....: except ArithmeticError as e:
>                 ....:    print(type(e))
>                 <... 'exceptions.ZeroDivisionError'>
> ```
> to
> 
> ```
>                 sage: QQ(0).inverse_of_unit()
>                 Traceback (most recent call last):
>                 ...
>                 ZeroDivisionError: rational division by zero
> ```

I deliberately wrote it that way, to hint to the fact that it is often better to catch all `ArithmeticError`s than just `ZeroDivisionError`s if you are `calling inverse_of_unit()`—but yes, I should have been more explicit!



---

archive/issue_comments_414628.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40ab0ae49a429836f8c85275b6082f02e6863563\">40ab0ae</a></td><td><code>Fields: generic inverse_of_unit()</code></td></tr></table>\n",
    "created_at": "2018-12-23T06:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414628",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40ab0ae49a429836f8c85275b6082f02e6863563">40ab0ae</a></td><td><code>Fields: generic inverse_of_unit()</code></td></tr></table>




---

archive/issue_comments_414629.json:
```json
{
    "body": "Changed commit from **[9f94bd6](https://github.com/sagemath/sagetrac-mirror/commit/9f94bd6056d8f62dd1a417fc8aac65a653b51322)** to **[40ab0ae](https://github.com/sagemath/sagetrac-mirror/commit/40ab0ae49a429836f8c85275b6082f02e6863563)**",
    "created_at": "2018-12-23T06:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414629",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9f94bd6](https://github.com/sagemath/sagetrac-mirror/commit/9f94bd6056d8f62dd1a417fc8aac65a653b51322)** to **[40ab0ae](https://github.com/sagemath/sagetrac-mirror/commit/40ab0ae49a429836f8c85275b6082f02e6863563)**



---

archive/issue_comments_414630.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/06017378677be5abfdc44f8e017c92e5533e08e9\">0601737</a></td><td><code>#26907 Polynomial.inverse_of_unit(): fix choice of exception</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2230a29607cdbe5ae0558dfce28bafa20a59538\">c2230a2</a></td><td><code>#26907 check that exact division in \u2124[x][y] works again</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/323cc39bc0b47bbfe954faf57182887681f472f6\">323cc39</a></td><td><code>Fields: generic inverse_of_unit()</code></td></tr></table>\n",
    "created_at": "2019-01-05T09:30:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414630",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/06017378677be5abfdc44f8e017c92e5533e08e9">0601737</a></td><td><code>#26907 Polynomial.inverse_of_unit(): fix choice of exception</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2230a29607cdbe5ae0558dfce28bafa20a59538">c2230a2</a></td><td><code>#26907 check that exact division in ℤ[x][y] works again</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/323cc39bc0b47bbfe954faf57182887681f472f6">323cc39</a></td><td><code>Fields: generic inverse_of_unit()</code></td></tr></table>




---

archive/issue_comments_414631.json:
```json
{
    "body": "Changed commit from **[40ab0ae](https://github.com/sagemath/sagetrac-mirror/commit/40ab0ae49a429836f8c85275b6082f02e6863563)** to **[323cc39](https://github.com/sagemath/sagetrac-mirror/commit/323cc39bc0b47bbfe954faf57182887681f472f6)**",
    "created_at": "2019-01-05T09:30:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414631",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[40ab0ae](https://github.com/sagemath/sagetrac-mirror/commit/40ab0ae49a429836f8c85275b6082f02e6863563)** to **[323cc39](https://github.com/sagemath/sagetrac-mirror/commit/323cc39bc0b47bbfe954faf57182887681f472f6)**



---

archive/issue_events_369668.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-01-05T09:33:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369668"
}
```



---

archive/issue_events_369669.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-01-05T09:33:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369669"
}
```



---

archive/issue_events_369670.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-01-05T09:33:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "milestone_number": null,
    "milestone_title": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369670"
}
```



---

archive/issue_events_369671.json:
```json
{
    "actor": "https://github.com/mezzarobba",
    "created_at": "2019-01-05T09:33:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369671"
}
```



---

archive/issue_comments_414632.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n*Critical* is perhaps a bit strong, but it would be nice if this branch could go in 8.6, since it fixes a regression introduced in 8.5.",
    "created_at": "2019-01-05T09:33:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414632",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:7" align="right">comment:7</div>

*Critical* is perhaps a bit strong, but it would be nice if this branch could go in 8.6, since it fixes a regression introduced in 8.5.



---

archive/issue_comments_414633.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe following works without any patch\n\n```\nsage: NumberField(x^7+2,'a')(2).inverse_of_unit()\n1/2\n```",
    "created_at": "2019-01-05T10:10:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414633",
    "user": "https://github.com/videlec"
}
```

<div id="comment:8" align="right">comment:8</div>

The following works without any patch

```
sage: NumberField(x^7+2,'a')(2).inverse_of_unit()
1/2
```



---

archive/issue_comments_414634.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nWhy do you try/catch here\n\n```\n+        try:\n+            inv = cst.inverse_of_unit()\n+        except (TypeError, ValueError):\n+            raise ArithmeticError(f\"{self} is not a unit in {self.parent()}\")\n```\nThe error generated by calling `inverse_of_unit` should just be fine.",
    "created_at": "2019-01-05T10:15:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414634",
    "user": "https://github.com/videlec"
}
```

<div id="comment:9" align="right">comment:9</div>

Why do you try/catch here

```
+        try:
+            inv = cst.inverse_of_unit()
+        except (TypeError, ValueError):
+            raise ArithmeticError(f"{self} is not a unit in {self.parent()}")
```
The error generated by calling `inverse_of_unit` should just be fine.



---

archive/issue_comments_414635.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@videlec](#comment:8):\n> The following works without any patch\n> \n> ```\n> sage: NumberField(x^7+2,'a')(2).inverse_of_unit()\n> 1/2\n> ```\n\nThat's expected. The part that fixes the bug is in the first two commits; the third is general cleanup suggested by Travis above.",
    "created_at": "2019-01-05T10:50:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414635",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@videlec](#comment:8):
> The following works without any patch
> 
> ```
> sage: NumberField(x^7+2,'a')(2).inverse_of_unit()
> 1/2
> ```

That's expected. The part that fixes the bug is in the first two commits; the third is general cleanup suggested by Travis above.



---

archive/issue_comments_414636.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@videlec](#comment:9):\n> Why do you try/catch here\n> \n> ```\n> +        try:\n> +            inv = cst.inverse_of_unit()\n> +        except (TypeError, ValueError):\n> +            raise ArithmeticError(f\"{self} is not a unit in {self.parent()}\")\n> ```\n> The error generated by calling `inverse_of_unit` should just be fine.\n\nBecause `//` now relies on the exception being `ArithmeticError` (that's what caused of the regression, and the convention used by `inverse_of_unit()` elsewhere in Sage). While I fixed `inverse_of_unit()` in the case that caused the issue reported in this ticket, there may be other code paths that raise the wrong exception.",
    "created_at": "2019-01-05T10:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414636",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@videlec](#comment:9):
> Why do you try/catch here
> 
> ```
> +        try:
> +            inv = cst.inverse_of_unit()
> +        except (TypeError, ValueError):
> +            raise ArithmeticError(f"{self} is not a unit in {self.parent()}")
> ```
> The error generated by calling `inverse_of_unit` should just be fine.

Because `//` now relies on the exception being `ArithmeticError` (that's what caused of the regression, and the convention used by `inverse_of_unit()` elsewhere in Sage). While I fixed `inverse_of_unit()` in the case that caused the issue reported in this ticket, there may be other code paths that raise the wrong exception.



---

archive/issue_comments_414637.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@mezzarobba](#comment:11):\n> Replying to [@videlec](#comment:9):\n> > Why do you try/catch here\n> > \n> > ```\n> > +        try:\n> > +            inv = cst.inverse_of_unit()\n> > +        except (TypeError, ValueError):\n> > +            raise ArithmeticError(f\"{self} is not a unit in {self.parent()}\")\n> > ```\n> > The error generated by calling `inverse_of_unit` should just be fine.\n\n> \n> Because `//` now relies on the exception being `ArithmeticError` (that's what caused of the regression, and the convention used by `inverse_of_unit()` elsewhere in Sage). While I fixed `inverse_of_unit()` in the case that caused the issue reported in this ticket, there may be other code paths that raise the wrong exception.\n\nIf any, it would be better to fix the error in inverse of unit rather than introducing this workaround that hides the problem.",
    "created_at": "2019-01-05T11:18:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414637",
    "user": "https://github.com/videlec"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@mezzarobba](#comment:11):
> Replying to [@videlec](#comment:9):
> > Why do you try/catch here
> > 
> > ```
> > +        try:
> > +            inv = cst.inverse_of_unit()
> > +        except (TypeError, ValueError):
> > +            raise ArithmeticError(f"{self} is not a unit in {self.parent()}")
> > ```
> > The error generated by calling `inverse_of_unit` should just be fine.

> 
> Because `//` now relies on the exception being `ArithmeticError` (that's what caused of the regression, and the convention used by `inverse_of_unit()` elsewhere in Sage). While I fixed `inverse_of_unit()` in the case that caused the issue reported in this ticket, there may be other code paths that raise the wrong exception.

If any, it would be better to fix the error in inverse of unit rather than introducing this workaround that hides the problem.



---

archive/issue_comments_414638.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSince you seriously modified `inverse_of_unit`, you should update the ticket description.",
    "created_at": "2019-01-05T11:24:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414638",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

Since you seriously modified `inverse_of_unit`, you should update the ticket description.



---

archive/issue_comments_414639.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@videlec](#comment:12):\n> If any, it would be better to fix the error in inverse of unit rather than introducing this workaround that hides the problem.\n\nI don't think so. Raising another exception is a really minor issue compared to breaking mathematical functionality; and, since it will typically come from conversion failures, it might even be a reasonable choice in some cases.\n\n\nReplying to [@videlec](#comment:13):\n> Since you seriously modified inverse_of_unit, you should update the ticket description.\n\nDone, though IMO people really should stop confusing ticket descriptions and commit messages...",
    "created_at": "2019-01-05T11:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414639",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@videlec](#comment:12):
> If any, it would be better to fix the error in inverse of unit rather than introducing this workaround that hides the problem.

I don't think so. Raising another exception is a really minor issue compared to breaking mathematical functionality; and, since it will typically come from conversion failures, it might even be a reasonable choice in some cases.


Replying to [@videlec](#comment:13):
> Since you seriously modified inverse_of_unit, you should update the ticket description.

Done, though IMO people really should stop confusing ticket descriptions and commit messages...



---

archive/issue_comments_414640.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+Issue:\n \n ```\n sage: P.<x> = ZZ[]\n@@ -7,4 +8,6 @@\n TypeError: no conversion of this rational to integer\n ```\n \n-due to cb8db697a1b (#26433)\n+due to cb8db697a1b (#26433).\n+\n+The branch on this ticket fixes that issue and improves `inverse_of_unit()`; see the commit messages for detail.\n``````\n",
    "created_at": "2019-01-05T11:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414640",
    "user": "https://github.com/mezzarobba"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+Issue:
 
 ```
 sage: P.<x> = ZZ[]
@@ -7,4 +8,6 @@
 TypeError: no conversion of this rational to integer
 ```
 
-due to cb8db697a1b (#26433)
+due to cb8db697a1b (#26433).
+
+The branch on this ticket fixes that issue and improves `inverse_of_unit()`; see the commit messages for detail.
``````




---

archive/issue_comments_414641.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@mezzarobba](#comment:14):\n> Replying to [@videlec](#comment:12):\n> > If any, it would be better to fix the error in inverse of unit rather than introducing this workaround that hides the problem.\n\n> \n> I don't think so. Raising another exception is a really minor issue compared to breaking mathematical functionality; and, since it will typically come from conversion failures, it might even be a reasonable choice in some cases.\n\nI agree with Vincent here as consistent error messages are not only better practice, but are also  useful. It allows a `TypeError` raised from actual bug to be percolated up instead of being caught and maybe silently working.",
    "created_at": "2019-01-05T17:38:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414641",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@mezzarobba](#comment:14):
> Replying to [@videlec](#comment:12):
> > If any, it would be better to fix the error in inverse of unit rather than introducing this workaround that hides the problem.

> 
> I don't think so. Raising another exception is a really minor issue compared to breaking mathematical functionality; and, since it will typically come from conversion failures, it might even be a reasonable choice in some cases.

I agree with Vincent here as consistent error messages are not only better practice, but are also  useful. It allows a `TypeError` raised from actual bug to be percolated up instead of being caught and maybe silently working.



---

archive/issue_comments_414642.json:
```json
{
    "body": "Changed commit from **[323cc39](https://github.com/sagemath/sagetrac-mirror/commit/323cc39bc0b47bbfe954faf57182887681f472f6)** to **[839c605](https://github.com/sagemath/sagetrac-mirror/commit/839c605a6160d26877b184958a307cf42ffe21f9)**",
    "created_at": "2019-01-06T10:13:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414642",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[323cc39](https://github.com/sagemath/sagetrac-mirror/commit/323cc39bc0b47bbfe954faf57182887681f472f6)** to **[839c605](https://github.com/sagemath/sagetrac-mirror/commit/839c605a6160d26877b184958a307cf42ffe21f9)**



---

archive/issue_comments_414643.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5a76c409ab11c70c177352b625aa020d31aa9d9\">d5a76c4</a></td><td><code>#26907 Polynomial.inverse_of_unit(): fix choice of exception</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2d35616a23dce06ffe326ea074f4fab18f01b2f\">f2d3561</a></td><td><code>#26907 check that exact division in \u2124[x][y] works again</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/839c605a6160d26877b184958a307cf42ffe21f9\">839c605</a></td><td><code>#26907 Fields: generic inverse_of_unit()</code></td></tr></table>\n",
    "created_at": "2019-01-06T10:13:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414643",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5a76c409ab11c70c177352b625aa020d31aa9d9">d5a76c4</a></td><td><code>#26907 Polynomial.inverse_of_unit(): fix choice of exception</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2d35616a23dce06ffe326ea074f4fab18f01b2f">f2d3561</a></td><td><code>#26907 check that exact division in ℤ[x][y] works again</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/839c605a6160d26877b184958a307cf42ffe21f9">839c605</a></td><td><code>#26907 Fields: generic inverse_of_unit()</code></td></tr></table>




---

archive/issue_comments_414644.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@tscrim](#comment:15):\n> I agree with Vincent here as consistent error messages are not only better practice, but are also  useful. It allows a `TypeError` raised from actual bug to be percolated up instead of being caught and maybe silently working.\n\nI really don't follow your reasoning, but if that's what it takes to get the issue fixed, so be it.",
    "created_at": "2019-01-06T10:16:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414644",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@tscrim](#comment:15):
> I agree with Vincent here as consistent error messages are not only better practice, but are also  useful. It allows a `TypeError` raised from actual bug to be percolated up instead of being caught and maybe silently working.

I really don't follow your reasoning, but if that's what it takes to get the issue fixed, so be it.



---

archive/issue_comments_414645.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThe test failure in `polyhedron/library.py` seems unrelated (and doesn't occur on my box).",
    "created_at": "2019-01-06T14:37:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414645",
    "user": "https://github.com/mezzarobba"
}
```

<div id="comment:18" align="right">comment:18</div>

The test failure in `polyhedron/library.py` seems unrelated (and doesn't occur on my box).



---

archive/issue_comments_414646.json:
```json
{
    "body": "Reviewer: **Vincent Delecroix**",
    "created_at": "2019-01-07T07:37:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414646",
    "user": "https://github.com/videlec"
}
```

Reviewer: **Vincent Delecroix**



---

archive/issue_events_369672.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-01-07T07:37:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369672"
}
```



---

archive/issue_events_369673.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-01-07T07:37:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369673"
}
```



---

archive/issue_comments_414647.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOk for me. Merci Marc.",
    "created_at": "2019-01-07T07:37:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414647",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

Ok for me. Merci Marc.



---

archive/issue_events_369674.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369674"
}
```



---

archive/issue_events_369675.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369675"
}
```



---

archive/issue_comments_414648.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414648",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_414649.json:
```json
{
    "body": "Changed branch from **[u/mmezzarobba/poly_inverse_of_unit](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/poly_inverse_of_unit)** to **[839c605](https://github.com/sagemath/sagetrac-mirror/commit/839c605a6160d26877b184958a307cf42ffe21f9)**",
    "created_at": "2019-01-23T15:39:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26907#issuecomment-414649",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mmezzarobba/poly_inverse_of_unit](https://github.com/sagemath/sagetrac-mirror/tree/u/mmezzarobba/poly_inverse_of_unit)** to **[839c605](https://github.com/sagemath/sagetrac-mirror/commit/839c605a6160d26877b184958a307cf42ffe21f9)**



---

archive/issue_events_369676.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T15:39:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369676"
}
```



---

archive/issue_events_369677.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d6f2242df401faad20bb220452331b42e6df9d1a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-01-23T15:39:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26907",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26907#event-369677"
}
```
