# Issue 26498: each asymptotic ring gets its own term monoid factory

archive/issues_026261.json:
```json
{
    "body": "\n\nBranch/Commit: 4b1aab74e47fdc801396c5bcda7a32ffc4e37d43\n\nReviewer: Benjamin Hackl\n\nAuthor: Daniel Krenn\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26498\n\n",
    "closed_at": "2019-04-18T19:56:51Z",
    "created_at": "2018-10-17T13:05:51Z",
    "labels": [
        "component: asymptotic expansions"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "each asymptotic ring gets its own term monoid factory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26498",
    "user": "https://github.com/dkrenn"
}
```


Branch/Commit: 4b1aab74e47fdc801396c5bcda7a32ffc4e37d43

Reviewer: Benjamin Hackl

Author: Daniel Krenn

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26498





---

archive/issue_comments_509461.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dkrenn/asy-own-term-monoid-factory\"",
    "created_at": "2018-10-17T13:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509461",
    "user": "https://github.com/dkrenn"
}
```

Changing branch from "" to "u/dkrenn/asy-own-term-monoid-factory"



---

archive/issue_comments_509462.json:
```json
{
    "body": "Changing commit from \"\" to \"2e9317e8a9866babebf62bdd6f6e7763e440f474\"",
    "created_at": "2018-10-18T13:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509462",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "2e9317e8a9866babebf62bdd6f6e7763e440f474"



---

archive/issue_comments_509463.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-18T13:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509463",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509464.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-18T13:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509464",
    "user": "https://github.com/dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_509465.json:
```json
{
    "body": "Changing author from \"\" to \"Daniel Krenn\"",
    "created_at": "2018-10-18T13:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509465",
    "user": "https://github.com/dkrenn"
}
```

Changing author from "" to "Daniel Krenn"



---

archive/issue_comments_509466.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-20T15:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509467.json:
```json
{
    "body": "Changing commit from \"2e9317e8a9866babebf62bdd6f6e7763e440f474\" to \"40708fd108c586ee8443ff3aaed16c017a2887de\"",
    "created_at": "2018-10-20T15:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509467",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "2e9317e8a9866babebf62bdd6f6e7763e440f474" to "40708fd108c586ee8443ff3aaed16c017a2887de"



---

archive/issue_comments_509468.json:
```json
{
    "body": "Changing commit from \"40708fd108c586ee8443ff3aaed16c017a2887de\" to \"432dca4755323f302e0feb6738f46b1c3a500476\"",
    "created_at": "2018-11-12T12:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "40708fd108c586ee8443ff3aaed16c017a2887de" to "432dca4755323f302e0feb6738f46b1c3a500476"



---

archive/issue_comments_509469.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-12T12:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509469",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_509470.json:
```json
{
    "body": "Changing commit from \"432dca4755323f302e0feb6738f46b1c3a500476\" to \"4b1aab74e47fdc801396c5bcda7a32ffc4e37d43\"",
    "created_at": "2019-04-16T14:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509470",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "432dca4755323f302e0feb6738f46b1c3a500476" to "4b1aab74e47fdc801396c5bcda7a32ffc4e37d43"



---

archive/issue_comments_509471.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-16T14:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509471",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_065856.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2019-04-16T14:14:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26498#event-65856"
}
```



---

archive/issue_comments_509472.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Benjamin Hackl\"",
    "created_at": "2019-04-16T14:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509472",
    "user": "https://github.com/behackl"
}
```

Changing reviewer from "" to "Benjamin Hackl"



---

archive/issue_comments_509473.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-16T14:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509473",
    "user": "https://github.com/behackl"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_509474.json:
```json
{
    "body": "<a id='comment:7'></a>I've looked through these changes and had one minor remark (the overlooked TODO in a docstring), this was already fixed via https://git.sagemath.org/sage.git/commit/?id=4b1aab74e47fdc801396c5bcda7a32ffc4e37d43.\n\nThus, I am happy. The patchbot tests seem to be false-negatives, testing the code locally (after merging `8.7`) made all tests pass. Good to go.",
    "created_at": "2019-04-16T14:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509474",
    "user": "https://github.com/behackl"
}
```

<a id='comment:7'></a>I've looked through these changes and had one minor remark (the overlooked TODO in a docstring), this was already fixed via https://git.sagemath.org/sage.git/commit/?id=4b1aab74e47fdc801396c5bcda7a32ffc4e37d43.

Thus, I am happy. The patchbot tests seem to be false-negatives, testing the code locally (after merging `8.7`) made all tests pass. Good to go.



---

archive/issue_comments_509475.json:
```json
{
    "body": "<a id='comment:8'></a>Just a comment:\n\n```\nclass TermMonoidFactory(UniqueRepresentation, UniqueFactory):\n```\nhas a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.",
    "created_at": "2019-04-17T01:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509475",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Just a comment:

```
class TermMonoidFactory(UniqueRepresentation, UniqueFactory):
```
has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.



---

archive/issue_comments_509476.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 tscrim]:\n> Just a comment:\n> \n> ```\n> class TermMonoidFactory(UniqueRepresentation, UniqueFactory):\n> ```\n> has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.\n\n\nWe have/need a parametrized factory; the desired behavior should be that of both base classes. Where/how do you think the memory leak appears?",
    "created_at": "2019-04-17T08:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509476",
    "user": "https://github.com/dkrenn"
}
```

<a id='comment:9'></a>Replying to [comment:8 tscrim]:
> Just a comment:
> 
> ```
> class TermMonoidFactory(UniqueRepresentation, UniqueFactory):
> ```
> has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.


We have/need a parametrized factory; the desired behavior should be that of both base classes. Where/how do you think the memory leak appears?



---

archive/issue_comments_509477.json:
```json
{
    "body": "<a id='comment:10'></a>What I am worried about is `TermMonoidFactory` having a key `G` to its construction, when then creates an object `TM` (which has a weak ref from the factory) that then holds a strong ref to `G`, creating a reference cycle with a strong reference with the `UniqueRepresentation` key nailing it all in memory.\n\nIMO, it also feels like the `TermMonoidFactory` is better suited to being a parent that is its just a `UniqueRepresentation` (not to mention all of the ugly doctests). It just is looking quite awkward to me.\n\nHowever, this is not code I have an investment in, so the design decisions are your. So if there is no memory leak, then feel free to disregard my comment(s).",
    "created_at": "2019-04-17T12:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509477",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>What I am worried about is `TermMonoidFactory` having a key `G` to its construction, when then creates an object `TM` (which has a weak ref from the factory) that then holds a strong ref to `G`, creating a reference cycle with a strong reference with the `UniqueRepresentation` key nailing it all in memory.

IMO, it also feels like the `TermMonoidFactory` is better suited to being a parent that is its just a `UniqueRepresentation` (not to mention all of the ugly doctests). It just is looking quite awkward to me.

However, this is not code I have an investment in, so the design decisions are your. So if there is no memory leak, then feel free to disregard my comment(s).



---

archive/issue_comments_509478.json:
```json
{
    "body": "Changing branch from \"u/dkrenn/asy-own-term-monoid-factory\" to \"4b1aab74e47fdc801396c5bcda7a32ffc4e37d43\"",
    "created_at": "2019-04-18T19:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509478",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dkrenn/asy-own-term-monoid-factory" to "4b1aab74e47fdc801396c5bcda7a32ffc4e37d43"



---

archive/issue_events_065857.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-18T19:56:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26498#event-65857"
}
```



---

archive/issue_comments_509479.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-18T19:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26498#issuecomment-509479",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
