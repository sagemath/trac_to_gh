# Issue 26498: each asymptotic ring gets its own term monoid factory

archive/issues_026261.json:
```json
{
    "assignees": [],
    "body": "\n\nComponent: **asymptotic expansions**\n\nAuthor: **Daniel Krenn**\n\nBranch/Commit: **[`4b1aab7`](https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43)**\n\nReviewer: **Benjamin Hackl**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26498_\n\n",
    "closed_at": "2019-04-18T19:56:51Z",
    "created_at": "2018-10-17T13:05:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20asymptotic%20expansions",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "each asymptotic ring gets its own term monoid factory",
    "type": "issue",
    "updated_at": "2019-04-18T19:56:51Z",
    "url": "https://github.com/sagemath/sage/issues/26498",
    "user": "https://github.com/dkrenn"
}
```


Component: **asymptotic expansions**

Author: **Daniel Krenn**

Branch/Commit: **[`4b1aab7`](https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43)**

Reviewer: **Benjamin Hackl**

_Issue created by migration from https://trac.sagemath.org/ticket/26498_





---

archive/issue_events_361919.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2018-10-17T13:05:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361919"
}
```



---

archive/issue_events_361920.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2018-10-17T13:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20asymptotic%20expansions",
    "label_color": "0000ff",
    "label_name": "c: asymptotic expansions",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361920"
}
```



---

archive/issue_events_361921.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2018-10-17T13:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361921"
}
```



---

archive/issue_events_361922.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2018-10-17T13:05:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361922"
}
```



---

archive/issue_comments_408480.json:
```json
{
    "body": "Branch: **[u/dkrenn/asy-own-term-monoid-factory](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy-own-term-monoid-factory)**",
    "created_at": "2018-10-17T13:08:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408480",
    "user": "https://github.com/dkrenn"
}
```

Branch: **[u/dkrenn/asy-own-term-monoid-factory](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy-own-term-monoid-factory)**



---

archive/issue_comments_408481.json:
```json
{
    "body": "Commit: **[`2e9317e`](https://github.com/sagemath/sagetrac-mirror/commit/2e9317e8a9866babebf62bdd6f6e7763e440f474)**",
    "created_at": "2018-10-18T13:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408481",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`2e9317e`](https://github.com/sagemath/sagetrac-mirror/commit/2e9317e8a9866babebf62bdd6f6e7763e440f474)**



---

archive/issue_comments_408482.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0e45ca857b20f26a01bc2d142ce96ab38222a1cf\"><code>0e45ca8</code></a></td><td><code>Trac #26498: convenience method term_monoid</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e9317e8a9866babebf62bdd6f6e7763e440f474\"><code>2e9317e</code></a></td><td><code>Trac #26498: take care of term_monoid_factory in Functors</code></td></tr></table>\n",
    "created_at": "2018-10-18T13:30:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408482",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0e45ca857b20f26a01bc2d142ce96ab38222a1cf"><code>0e45ca8</code></a></td><td><code>Trac #26498: convenience method term_monoid</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e9317e8a9866babebf62bdd6f6e7763e440f474"><code>2e9317e</code></a></td><td><code>Trac #26498: take care of term_monoid_factory in Functors</code></td></tr></table>




---

archive/issue_events_361923.json:
```json
{
    "actor": "https://github.com/dkrenn",
    "created_at": "2018-10-18T13:30:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361923"
}
```



---

archive/issue_comments_408483.json:
```json
{
    "body": "Author: **Daniel Krenn**",
    "created_at": "2018-10-18T13:30:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408483",
    "user": "https://github.com/dkrenn"
}
```

Author: **Daniel Krenn**



---

archive/issue_comments_408484.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40708fd108c586ee8443ff3aaed16c017a2887de\"><code>40708fd</code></a></td><td><code>Trac #26498: fixup `__init__` (somehow a line was not commited)</code></td></tr></table>\n",
    "created_at": "2018-10-20T15:15:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408484",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40708fd108c586ee8443ff3aaed16c017a2887de"><code>40708fd</code></a></td><td><code>Trac #26498: fixup `__init__` (somehow a line was not commited)</code></td></tr></table>




---

archive/issue_comments_408485.json:
```json
{
    "body": "Changed commit from **[`2e9317e`](https://github.com/sagemath/sagetrac-mirror/commit/2e9317e8a9866babebf62bdd6f6e7763e440f474)** to **[`40708fd`](https://github.com/sagemath/sagetrac-mirror/commit/40708fd108c586ee8443ff3aaed16c017a2887de)**",
    "created_at": "2018-10-20T15:15:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408485",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2e9317e`](https://github.com/sagemath/sagetrac-mirror/commit/2e9317e8a9866babebf62bdd6f6e7763e440f474)** to **[`40708fd`](https://github.com/sagemath/sagetrac-mirror/commit/40708fd108c586ee8443ff3aaed16c017a2887de)**



---

archive/issue_comments_408486.json:
```json
{
    "body": "Changed commit from **[`40708fd`](https://github.com/sagemath/sagetrac-mirror/commit/40708fd108c586ee8443ff3aaed16c017a2887de)** to **[`432dca4`](https://github.com/sagemath/sagetrac-mirror/commit/432dca4755323f302e0feb6738f46b1c3a500476)**",
    "created_at": "2018-11-12T12:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408486",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`40708fd`](https://github.com/sagemath/sagetrac-mirror/commit/40708fd108c586ee8443ff3aaed16c017a2887de)** to **[`432dca4`](https://github.com/sagemath/sagetrac-mirror/commit/432dca4755323f302e0feb6738f46b1c3a500476)**



---

archive/issue_comments_408487.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/432dca4755323f302e0feb6738f46b1c3a500476\"><code>432dca4</code></a></td><td><code>Trac #26498: method term_monoid</code></td></tr></table>\n",
    "created_at": "2018-11-12T12:07:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408487",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/432dca4755323f302e0feb6738f46b1c3a500476"><code>432dca4</code></a></td><td><code>Trac #26498: method term_monoid</code></td></tr></table>




---

archive/issue_comments_408488.json:
```json
{
    "body": "Changed commit from **[`432dca4`](https://github.com/sagemath/sagetrac-mirror/commit/432dca4755323f302e0feb6738f46b1c3a500476)** to **[`4b1aab7`](https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43)**",
    "created_at": "2019-04-16T14:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408488",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`432dca4`](https://github.com/sagemath/sagetrac-mirror/commit/432dca4755323f302e0feb6738f46b1c3a500476)** to **[`4b1aab7`](https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43)**



---

archive/issue_comments_408489.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43\"><code>4b1aab7</code></a></td><td><code>remove forgotten \"TODO\"</code></td></tr></table>\n",
    "created_at": "2019-04-16T14:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408489",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43"><code>4b1aab7</code></a></td><td><code>remove forgotten "TODO"</code></td></tr></table>




---

archive/issue_events_361924.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2019-04-16T14:14:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361924"
}
```



---

archive/issue_events_361925.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2019-04-16T14:14:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "milestone_number": null,
    "milestone_title": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361925"
}
```



---

archive/issue_comments_408490.json:
```json
{
    "body": "Reviewer: **Benjamin Hackl**",
    "created_at": "2019-04-16T14:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408490",
    "user": "https://github.com/behackl"
}
```

Reviewer: **Benjamin Hackl**



---

archive/issue_events_361926.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2019-04-16T14:14:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361926"
}
```



---

archive/issue_events_361927.json:
```json
{
    "actor": "https://github.com/behackl",
    "created_at": "2019-04-16T14:14:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361927"
}
```



---

archive/issue_comments_408491.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI've looked through these changes and had one minor remark (the overlooked TODO in a docstring), this was already fixed via https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43.\n\nThus, I am happy. The patchbot tests seem to be false-negatives, testing the code locally (after merging `8.7`) made all tests pass. Good to go.",
    "created_at": "2019-04-16T14:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408491",
    "user": "https://github.com/behackl"
}
```

<div id="comment:7" align="right">comment:7</div>

I've looked through these changes and had one minor remark (the overlooked TODO in a docstring), this was already fixed via https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43.

Thus, I am happy. The patchbot tests seem to be false-negatives, testing the code locally (after merging `8.7`) made all tests pass. Good to go.



---

archive/issue_comments_408492.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nJust a comment:\n\n```\nclass TermMonoidFactory(UniqueRepresentation, UniqueFactory):\n```\nhas a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.",
    "created_at": "2019-04-17T01:31:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408492",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

Just a comment:

```
class TermMonoidFactory(UniqueRepresentation, UniqueFactory):
```
has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.



---

archive/issue_comments_408493.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@tscrim](#comment%3A8):\n> Just a comment:\n> \n> ```\n> class TermMonoidFactory(UniqueRepresentation, UniqueFactory):\n> ```\n> has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.\n\nWe have/need a parametrized factory; the desired behavior should be that of both base classes. Where/how do you think the memory leak appears?",
    "created_at": "2019-04-17T08:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408493",
    "user": "https://github.com/dkrenn"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@tscrim](#comment%3A8):
> Just a comment:
> 
> ```
> class TermMonoidFactory(UniqueRepresentation, UniqueFactory):
> ```
> has a very strong code smell to me and makes me concerned about memory leaks. Maybe it is all okay, but it is a bit of a departure from normal use.

We have/need a parametrized factory; the desired behavior should be that of both base classes. Where/how do you think the memory leak appears?



---

archive/issue_comments_408494.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWhat I am worried about is `TermMonoidFactory` having a key `G` to its construction, when then creates an object `TM` (which has a weak ref from the factory) that then holds a strong ref to `G`, creating a reference cycle with a strong reference with the `UniqueRepresentation` key nailing it all in memory.\n\nIMO, it also feels like the `TermMonoidFactory` is better suited to being a parent that is its just a `UniqueRepresentation` (not to mention all of the ugly doctests). It just is looking quite awkward to me.\n\nHowever, this is not code I have an investment in, so the design decisions are your. So if there is no memory leak, then feel free to disregard my comment(s).",
    "created_at": "2019-04-17T12:29:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408494",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:10" align="right">comment:10</div>

What I am worried about is `TermMonoidFactory` having a key `G` to its construction, when then creates an object `TM` (which has a weak ref from the factory) that then holds a strong ref to `G`, creating a reference cycle with a strong reference with the `UniqueRepresentation` key nailing it all in memory.

IMO, it also feels like the `TermMonoidFactory` is better suited to being a parent that is its just a `UniqueRepresentation` (not to mention all of the ugly doctests). It just is looking quite awkward to me.

However, this is not code I have an investment in, so the design decisions are your. So if there is no memory leak, then feel free to disregard my comment(s).



---

archive/issue_comments_408495.json:
```json
{
    "body": "Changed branch from **[u/dkrenn/asy-own-term-monoid-factory](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy-own-term-monoid-factory)** to **[`4b1aab7`](https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43)**",
    "created_at": "2019-04-18T19:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26498#issuecomment-408495",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/dkrenn/asy-own-term-monoid-factory](https://github.com/sagemath/sagetrac-mirror/tree/u/dkrenn/asy-own-term-monoid-factory)** to **[`4b1aab7`](https://github.com/sagemath/sagetrac-mirror/commit/4b1aab74e47fdc801396c5bcda7a32ffc4e37d43)**



---

archive/issue_events_361928.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-04-18T19:56:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361928"
}
```



---

archive/issue_events_361929.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f2f05fc5bb8502e6859ad26ea769bba8a8acfee7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-04-18T19:56:51Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26498",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26498#event-361929"
}
```
