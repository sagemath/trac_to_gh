# Issue 26522: Python 3 vs. Sphinx, part 2: classes inheriting from ClasscallMetaclass

archive/issues_026285.json:
```json
{
    "body": "(split off of #26449)\n\nWith a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. It seems to be related to classes which inherit from `ClasscallMetaclass` and which also have class-level docstrings. For example, if I have this:\n\n```\nclass Test1(ClasscallMetaclass):\n    def A(self):\n        \"\"\"\n        documentation for A\n        \"\"\"\n        pass\n\nclass Test2(ClasscallMetaclass):\n    \"\"\"\n    class-level docstring\n    \"\"\"\n    def B(self):\n        \"\"\"\n        documentation for B\n        \"\"\"\n        pass\n```\nthen Sphinx will produce output looking like this:\n\n```\nclass sage.algebras.commutative_dga.Test1\n    Bases: sage.misc.classcall_metaclass.ClasscallMetaclass\n\n    A()\n        documentation for A\n\nsage.algebras.commutative_dga.Test2\n\n    class-level docstring\n```\n`Test1` is properly documented, but `Test2` is missing documentation for the methods; furthermore, it doesn't say \"class\" at the beginning and does not list the base class.\n\nClasses which inherit from other classes, say `WithEqualitybyId`, work just fine.\n\n**CC:**  @fchapoton @jdemeyer @embray\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26522\n\n",
    "closed_at": "2019-01-28T17:19:08Z",
    "created_at": "2018-10-21T18:30:02Z",
    "labels": [
        "component: python3",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Python 3 vs. Sphinx, part 2: classes inheriting from ClasscallMetaclass",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26522",
    "user": "https://github.com/jhpalmieri"
}
```
(split off of #26449)

With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. It seems to be related to classes which inherit from `ClasscallMetaclass` and which also have class-level docstrings. For example, if I have this:

```
class Test1(ClasscallMetaclass):
    def A(self):
        """
        documentation for A
        """
        pass

class Test2(ClasscallMetaclass):
    """
    class-level docstring
    """
    def B(self):
        """
        documentation for B
        """
        pass
```
then Sphinx will produce output looking like this:

```
class sage.algebras.commutative_dga.Test1
    Bases: sage.misc.classcall_metaclass.ClasscallMetaclass

    A()
        documentation for A

sage.algebras.commutative_dga.Test2

    class-level docstring
```
`Test1` is properly documented, but `Test2` is missing documentation for the methods; furthermore, it doesn't say "class" at the beginning and does not list the base class.

Classes which inherit from other classes, say `WithEqualitybyId`, work just fine.

**CC:**  @fchapoton @jdemeyer @embray

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/26522





---

archive/issue_events_074862.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "rename": {
        "from": "Python 3 vs. Sphinx, part 2",
        "to": "Python 3 vs. Sphinx, part 2: classes inheriting from UniqueRepresentation"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26522#event-74862"
}
```



---

archive/issue_comments_511742.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,17 +1,23 @@\n (split off of #26449)\n \n-With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. Perhaps it is related to classes containing subclasses. For example, in `sage.algebras.commutative_dga`, we have\n+With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. It seems to be related to classes which inherit from `CachedRepresentation`. If I create a test class which inherits from, say, `WithEqualityById`, then Sphinx produces something looking like this:\n \n ```\n+class sage.algebras.commutative_dga.TestGCAlgebra\n+    Bases: sage.misc.fast_methods.WithEqualityById\n \n-class GCAlgebra(UniqueRepresentation, QuotientRing_nc):\n+    top level documentation\n \n-    ...\n+    a()\n+        class a\n \n-    class Element(QuotientRingElement):\n-\n-        ...\n+    b()\n+        class b\n+```\n+If it instead inherits from `CachedRepresentation`, then Sphinx produces this:\n \n ```\n-With Python 2, methods directly within `GCAlgebra` appear, as do those in `Element`. With Python 3, only the top-level documentation for the `GCAlgebra` class is present: no methods are included at all. Within the same file, the methods for the class `GCAlgebraHomset` all appear, in both Python 2 and Python 3.\n-\n+sage.algebras.commutative_dga.TestGCAlgebra\n+    top level documentation\n+```\n+It is missing documentation for the methods; furthermore, it doesn't say \"class\" at the beginning and does not list the base class.\n``````\n",
    "created_at": "2018-10-21T19:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511742",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,17 +1,23 @@
 (split off of #26449)
 
-With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. Perhaps it is related to classes containing subclasses. For example, in `sage.algebras.commutative_dga`, we have
+With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. It seems to be related to classes which inherit from `CachedRepresentation`. If I create a test class which inherits from, say, `WithEqualityById`, then Sphinx produces something looking like this:
 
 ```
+class sage.algebras.commutative_dga.TestGCAlgebra
+    Bases: sage.misc.fast_methods.WithEqualityById
 
-class GCAlgebra(UniqueRepresentation, QuotientRing_nc):
+    top level documentation
 
-    ...
+    a()
+        class a
 
-    class Element(QuotientRingElement):
-
-        ...
+    b()
+        class b
+```
+If it instead inherits from `CachedRepresentation`, then Sphinx produces this:
 
 ```
-With Python 2, methods directly within `GCAlgebra` appear, as do those in `Element`. With Python 3, only the top-level documentation for the `GCAlgebra` class is present: no methods are included at all. Within the same file, the methods for the class `GCAlgebraHomset` all appear, in both Python 2 and Python 3.
-
+sage.algebras.commutative_dga.TestGCAlgebra
+    top level documentation
+```
+It is missing documentation for the methods; furthermore, it doesn't say "class" at the beginning and does not list the base class.
``````




---

archive/issue_events_074863.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "rename": {
        "from": "Python 3 vs. Sphinx, part 2: classes inheriting from UniqueRepresentation",
        "to": "Python 3 vs. Sphinx, part 2: classes inheriting from CachedRepresentation"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26522#event-74863"
}
```



---

archive/issue_comments_511743.json:
```json
{
    "body": "<a id='comment:3'></a>\nThis is important to fix; otherwise, the Python 3 build of the reference manual will be very incomplete, missing methods from every class that inherits from `CachedRepresentation`. I also have no idea how to fix it.",
    "created_at": "2018-10-21T19:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511743",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:3'></a>
This is important to fix; otherwise, the Python 3 build of the reference manual will be very incomplete, missing methods from every class that inherits from `CachedRepresentation`. I also have no idea how to fix it.



---

archive/issue_comments_511744.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis change doesn't help, but is there any reason not to do this:\n\n```diff\ndiff --git a/src/sage/structure/unique_representation.py b/src/sage/structure/unique_representation.py\nindex 4fc44c8b86..e08393954b 100644\n--- a/src/sage/structure/unique_representation.py\n+++ b/src/sage/structure/unique_representation.py\n@@ -561,13 +561,13 @@ accordingly, for example by inheriting from\n #******************************************************************************\n from __future__ import print_function\n \n-from sage.misc import six\n+from six import with_metaclass\n from sage.misc.cachefunc import weak_cached_function\n from sage.misc.classcall_metaclass import ClasscallMetaclass, typecall\n from sage.misc.fast_methods import WithEqualityById\n \n \n-class CachedRepresentation(six.with_metaclass(ClasscallMetaclass)):\n+class CachedRepresentation(with_metaclass(ClasscallMetaclass)):\n     \"\"\"\n     Classes derived from CachedRepresentation inherit a weak cache for their\n     instances.\n```",
    "created_at": "2018-10-22T23:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511744",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>
This change doesn't help, but is there any reason not to do this:

```diff
diff --git a/src/sage/structure/unique_representation.py b/src/sage/structure/unique_representation.py
index 4fc44c8b86..e08393954b 100644
--- a/src/sage/structure/unique_representation.py
+++ b/src/sage/structure/unique_representation.py
@@ -561,13 +561,13 @@ accordingly, for example by inheriting from
 #******************************************************************************
 from __future__ import print_function
 
-from sage.misc import six
+from six import with_metaclass
 from sage.misc.cachefunc import weak_cached_function
 from sage.misc.classcall_metaclass import ClasscallMetaclass, typecall
 from sage.misc.fast_methods import WithEqualityById
 
 
-class CachedRepresentation(six.with_metaclass(ClasscallMetaclass)):
+class CachedRepresentation(with_metaclass(ClasscallMetaclass)):
     """
     Classes derived from CachedRepresentation inherit a weak cache for their
     instances.
```



---

archive/issue_comments_511745.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,23 +1,38 @@\n (split off of #26449)\n \n-With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. It seems to be related to classes which inherit from `CachedRepresentation`. If I create a test class which inherits from, say, `WithEqualityById`, then Sphinx produces something looking like this:\n+With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. It seems to be related to classes which inherit from `ClasscallMetaclass` and which also have class-level docstrings. For example, if I have this:\n \n ```\n-class sage.algebras.commutative_dga.TestGCAlgebra\n-    Bases: sage.misc.fast_methods.WithEqualityById\n+class Test1(ClasscallMetaclass):\n+    def A(self):\n+        \"\"\"\n+        documentation for A\n+        \"\"\"\n+        pass\n \n-    top level documentation\n-\n-    a()\n-        class a\n-\n-    b()\n-        class b\n+class Test2(ClasscallMetaclass):\n+    \"\"\"\n+    class-level docstring\n+    \"\"\"\n+    def B(self):\n+        \"\"\"\n+        documentation for B\n+        \"\"\"\n+        pass\n ```\n-If it instead inherits from `CachedRepresentation`, then Sphinx produces this:\n+then Sphinx will produce output looking like this:\n \n ```\n-sage.algebras.commutative_dga.TestGCAlgebra\n-    top level documentation\n+class sage.algebras.commutative_dga.Test1\n+    Bases: sage.misc.classcall_metaclass.ClasscallMetaclass\n+\n+    A()\n+        documentation for A\n+\n+sage.algebras.commutative_dga.Test2\n+\n+    class-level docstring\n ```\n-It is missing documentation for the methods; furthermore, it doesn't say \"class\" at the beginning and does not list the base class.\n+`Test1` is properly documented, but `Test2` is missing documentation for the methods; furthermore, it doesn't say \"class\" at the beginning and does not list the base class.\n+\n+Classes which inherit from other classes, say `WithEqualitybyId`, work just fine.\n``````\n",
    "created_at": "2018-11-06T22:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511745",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,23 +1,38 @@
 (split off of #26449)
 
-With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. It seems to be related to classes which inherit from `CachedRepresentation`. If I create a test class which inherits from, say, `WithEqualityById`, then Sphinx produces something looking like this:
+With a Python 3 build of Sage, Sphinx omits large chunks of the autodoc documentation. It seems to be related to classes which inherit from `ClasscallMetaclass` and which also have class-level docstrings. For example, if I have this:
 
 ```
-class sage.algebras.commutative_dga.TestGCAlgebra
-    Bases: sage.misc.fast_methods.WithEqualityById
+class Test1(ClasscallMetaclass):
+    def A(self):
+        """
+        documentation for A
+        """
+        pass
 
-    top level documentation
-
-    a()
-        class a
-
-    b()
-        class b
+class Test2(ClasscallMetaclass):
+    """
+    class-level docstring
+    """
+    def B(self):
+        """
+        documentation for B
+        """
+        pass
 ```
-If it instead inherits from `CachedRepresentation`, then Sphinx produces this:
+then Sphinx will produce output looking like this:
 
 ```
-sage.algebras.commutative_dga.TestGCAlgebra
-    top level documentation
+class sage.algebras.commutative_dga.Test1
+    Bases: sage.misc.classcall_metaclass.ClasscallMetaclass
+
+    A()
+        documentation for A
+
+sage.algebras.commutative_dga.Test2
+
+    class-level docstring
 ```
-It is missing documentation for the methods; furthermore, it doesn't say "class" at the beginning and does not list the base class.
+`Test1` is properly documented, but `Test2` is missing documentation for the methods; furthermore, it doesn't say "class" at the beginning and does not list the base class.
+
+Classes which inherit from other classes, say `WithEqualitybyId`, work just fine.
``````




---

archive/issue_comments_511746.json:
```json
{
    "body": "<a id='comment:6'></a>\nA little more experimentation has led me to change the ticket description. I think the problem is with `ClasscallMetaclass`, not `CachedRepresentation`. Furthermore, it only manifests itself when there is a class-level docstring.",
    "created_at": "2018-11-06T22:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511746",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
A little more experimentation has led me to change the ticket description. I think the problem is with `ClasscallMetaclass`, not `CachedRepresentation`. Furthermore, it only manifests itself when there is a class-level docstring.



---

archive/issue_events_074864.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "rename": {
        "from": "Python 3 vs. Sphinx, part 2: classes inheriting from CachedRepresentation",
        "to": "Python 3 vs. Sphinx, part 2: classes inheriting from ClasscallMetaclass"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26522#event-74864"
}
```



---

archive/issue_comments_511747.json:
```json
{
    "body": "<a id='comment:7'></a>\nI should note that if I add methods to `ClasscallMetaclass` in `sage.misc.classcall_metaclass` (in particular, methods which do not start with an underscore), they are not included in the documentation, and the built documentation for `ClasscallMetaclass` does not list its base.",
    "created_at": "2018-11-06T22:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511747",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
I should note that if I add methods to `ClasscallMetaclass` in `sage.misc.classcall_metaclass` (in particular, methods which do not start with an underscore), they are not included in the documentation, and the built documentation for `ClasscallMetaclass` does not list its base.



---

archive/issue_comments_511748.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis looks like very generic code which is not really even dependent upon Sage, so one can create a separate sphinx testcase for it, right?",
    "created_at": "2018-12-03T23:21:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511748",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
This looks like very generic code which is not really even dependent upon Sage, so one can create a separate sphinx testcase for it, right?



---

archive/issue_comments_511749.json:
```json
{
    "body": "<a id='comment:9'></a>\nIf someone could figure out what's going wrong, that would be preferable to making a special case of it. Is it because `ClasscallMetaclass` is defined in a cython file? It must be more than that, so what makes things go wrong with this particular class?",
    "created_at": "2018-12-04T18:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511749",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
If someone could figure out what's going wrong, that would be preferable to making a special case of it. Is it because `ClasscallMetaclass` is defined in a cython file? It must be more than that, so what makes things go wrong with this particular class?



---

archive/issue_comments_511750.json:
```json
{
    "body": "<a id='comment:10'></a>\nOn my sage-on-gentoo install I'm able to complete building the docs with python3 if I disable catching the `OSError` that normally terminates the build:\n\n```diff\ndiff --git a/src/sage_setup/docbuild/sphinxbuild.py b/src/sage_setup/docbuild/sphinxbuild.py\nindex 8f7034fcb8..6cfdb10080 100644\n--- a/src/sage_setup/docbuild/sphinxbuild.py\n+++ b/src/sage_setup/docbuild/sphinxbuild.py\n@@ -250,8 +250,8 @@ class SageSphinxLogger(object):\n             OSError: This is a SEVERE error\n \n         \"\"\"\n-        if self._error is not None:\n-            raise OSError(self._error)\n+#        if self._error is not None:\n+#            raise OSError(self._error)\n \n     _line_buffer = ''\n```\nPerhaps someone can try this on vanilla to see if it works with python3. If it works then perhaps we can determine which pieces are missing.",
    "created_at": "2018-12-05T20:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511750",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:10'></a>
On my sage-on-gentoo install I'm able to complete building the docs with python3 if I disable catching the `OSError` that normally terminates the build:

```diff
diff --git a/src/sage_setup/docbuild/sphinxbuild.py b/src/sage_setup/docbuild/sphinxbuild.py
index 8f7034fcb8..6cfdb10080 100644
--- a/src/sage_setup/docbuild/sphinxbuild.py
+++ b/src/sage_setup/docbuild/sphinxbuild.py
@@ -250,8 +250,8 @@ class SageSphinxLogger(object):
             OSError: This is a SEVERE error
 
         """
-        if self._error is not None:
-            raise OSError(self._error)
+#        if self._error is not None:
+#            raise OSError(self._error)
 
     _line_buffer = ''
```
Perhaps someone can try this on vanilla to see if it works with python3. If it works then perhaps we can determine which pieces are missing.



---

archive/issue_comments_511751.json:
```json
{
    "body": "<a id='comment:11'></a>\nThis is probably what @jhpalmieri was indicating. Under `Special Methods for Classes`\n\nCorrect doc\n\n```\nclass sage.misc.classcall_metaclass.ClasscallMetaclass\nBases: sage.misc.nested_class.NestedClassMetaclass\n\nA metaclass providing support for special methods for classes.\n```\n\nIncorrect with python3\n\n```\n sage.misc.classcall_metaclass.ClasscallMetaclass\n\n    A metaclass providing support for special methods for classes.\n```\nAnd perhaps other places.",
    "created_at": "2018-12-05T23:13:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511751",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:11'></a>
This is probably what @jhpalmieri was indicating. Under `Special Methods for Classes`

Correct doc

```
class sage.misc.classcall_metaclass.ClasscallMetaclass
Bases: sage.misc.nested_class.NestedClassMetaclass

A metaclass providing support for special methods for classes.
```

Incorrect with python3

```
 sage.misc.classcall_metaclass.ClasscallMetaclass

    A metaclass providing support for special methods for classes.
```
And perhaps other places.



---

archive/issue_comments_511752.json:
```json
{
    "body": "<a id='comment:12'></a>\nFor another illustration, navigate in the reference manual by choosing `Categories` and then `Sets`. The documentation for the class `Sets` in the Python 2 build includes lots of methods (for example \n[`an_element`](http://doc.sagemath.org/html/en/reference/categories/sage/categories/sets_cat.html#sage.categories.sets_cat.Sets.ParentMethods.an_element)), but the documentation for the Python 3 build only has the top-level docstring.\n\nThis is what actually causes the documentation to fail to build with Python 3: a cross-reference to \"facade-sets\" points to [what becomes omitted](http://doc.sagemath.org/html/en/reference/categories/sage/categories/sets_cat.html#sage.categories.sets_cat.Sets.SubcategoryMethods.Facade) in the Python 3 build of the documentation.",
    "created_at": "2018-12-06T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511752",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
For another illustration, navigate in the reference manual by choosing `Categories` and then `Sets`. The documentation for the class `Sets` in the Python 2 build includes lots of methods (for example 
[`an_element`](http://doc.sagemath.org/html/en/reference/categories/sage/categories/sets_cat.html#sage.categories.sets_cat.Sets.ParentMethods.an_element)), but the documentation for the Python 3 build only has the top-level docstring.

This is what actually causes the documentation to fail to build with Python 3: a cross-reference to "facade-sets" points to [what becomes omitted](http://doc.sagemath.org/html/en/reference/categories/sage/categories/sets_cat.html#sage.categories.sets_cat.Sets.SubcategoryMethods.Facade) in the Python 3 build of the documentation.



---

archive/issue_comments_511753.json:
```json
{
    "body": "<a id='comment:13'></a>\nAlso, python3 appears to not be picking up on external links. From the `html` code near the top of\n[Sets](http://doc.sagemath.org/html/en/reference/categories/sage/categories/sets_cat.html)\n\npython2:\n\n```\n<dd><p>Bases: <a class=\"reference external\" href=\"https://docs.python.org/library/exceptions.html#exceptions.ValueError\" title=\"(in Python v2.7)\"><code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">exceptions.ValueError</span></code></a></p>\n```\n\npython3:\n\n```\n<dd><p>Bases: <code class=\"xref py py-class docutils literal notranslate\"><span class=\"pre\">ValueError</span></code></p>\n```\n\nIt's not clear to me where these external links originate.",
    "created_at": "2018-12-07T05:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511753",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:13'></a>
Also, python3 appears to not be picking up on external links. From the `html` code near the top of
[Sets](http://doc.sagemath.org/html/en/reference/categories/sage/categories/sets_cat.html)

python2:

```
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/library/exceptions.html#exceptions.ValueError" title="(in Python v2.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">exceptions.ValueError</span></code></a></p>
```

python3:

```
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">ValueError</span></code></p>
```

It's not clear to me where these external links originate.



---

archive/issue_comments_511754.json:
```json
{
    "body": "<a id='comment:14'></a>\nI wonder if those links come from `src/doc/common/python.inv`. That file probably needs to be updated for Python 3. Maybe we need two different versions.",
    "created_at": "2018-12-07T21:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511754",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>
I wonder if those links come from `src/doc/common/python.inv`. That file probably needs to be updated for Python 3. Maybe we need two different versions.



---

archive/issue_comments_511755.json:
```json
{
    "body": "<a id='comment:15'></a>\nConfirmed: if I download `python.inv` using the script `update-python-inv.sh` (modified to make sure it gets the Python 3.6.6 version), then the link reappears.",
    "created_at": "2018-12-07T23:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511755",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:15'></a>
Confirmed: if I download `python.inv` using the script `update-python-inv.sh` (modified to make sure it gets the Python 3.6.6 version), then the link reappears.



---

archive/issue_comments_511756.json:
```json
{
    "body": "<a id='comment:16'></a>\nSee #26859 for the `python.inv` issue: I propose including files `python2.inv` and `python3.inv`.",
    "created_at": "2018-12-08T23:28:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511756",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
See #26859 for the `python.inv` issue: I propose including files `python2.inv` and `python3.inv`.



---

archive/issue_comments_511757.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [jhpalmieri](#comment%3A5):\n> This change doesn't help, but is there any reason not to do this:\n\n\nThere is a bug in some versions of `six` that `with_metaclass` doesn't work properly with some classes (I think nested classes in particular).  I think the version of `six` in sage-the-distribution has this fixed.",
    "created_at": "2018-12-10T12:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511757",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>
Replying to [jhpalmieri](#comment%3A5):
> This change doesn't help, but is there any reason not to do this:


There is a bug in some versions of `six` that `with_metaclass` doesn't work properly with some classes (I think nested classes in particular).  I think the version of `six` in sage-the-distribution has this fixed.



---

archive/issue_comments_511758.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [embray](#comment%3A17):\n> Replying to [jhpalmieri](#comment%3A5):\n> > This change doesn't help, but is there any reason not to do this:\n\n> \n> There is a bug in some versions of `six` that `with_metaclass` doesn't work properly with some classes (I think nested classes in particular).  I think the version of `six` in sage-the-distribution has this fixed.\n\n\nIn `sage.misc.six`, there is no `with_metaclass`. Maybe there used to be. It gets imported via `from six import *` at the top of `sage.misc.six`.",
    "created_at": "2018-12-10T18:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511758",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
Replying to [embray](#comment%3A17):
> Replying to [jhpalmieri](#comment%3A5):
> > This change doesn't help, but is there any reason not to do this:

> 
> There is a bug in some versions of `six` that `with_metaclass` doesn't work properly with some classes (I think nested classes in particular).  I think the version of `six` in sage-the-distribution has this fixed.


In `sage.misc.six`, there is no `with_metaclass`. Maybe there used to be. It gets imported via `from six import *` at the top of `sage.misc.six`.



---

archive/issue_comments_511759.json:
```json
{
    "body": "<a id='comment:19'></a>\nI'm wondering if there is a problem with the inventory builder. Here, for example, with python3 most everything is missing under ['Finite Coxeter Groups'](http://doc.sagemath.org/html/en/reference/categories/sage/categories/finite_coxeter_groups.html) including the `.png` on that page. The `.png` should be generated under `local/share/doc/sage/inventory/en/reference/categories/sage/categories/`. At least with my sage-on-gentoo build the `.png` file is not generated.",
    "created_at": "2018-12-11T00:54:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511759",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:19'></a>
I'm wondering if there is a problem with the inventory builder. Here, for example, with python3 most everything is missing under ['Finite Coxeter Groups'](http://doc.sagemath.org/html/en/reference/categories/sage/categories/finite_coxeter_groups.html) including the `.png` on that page. The `.png` should be generated under `local/share/doc/sage/inventory/en/reference/categories/sage/categories/`. At least with my sage-on-gentoo build the `.png` file is not generated.



---

archive/issue_comments_511760.json:
```json
{
    "body": "<a id='comment:20'></a>\nNote that `FiniteCoxeterGroups` inherits from `CategoryWithAxiom` which inherits from `Category` which inherits from `UniqueRepresentation` which inherits from `ClasscallMetaclass`. Maybe you're right: maybe the problem is with the inventory builder, or at least maybe that's where it first manifests itself.",
    "created_at": "2018-12-11T18:20:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511760",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>
Note that `FiniteCoxeterGroups` inherits from `CategoryWithAxiom` which inherits from `Category` which inherits from `UniqueRepresentation` which inherits from `ClasscallMetaclass`. Maybe you're right: maybe the problem is with the inventory builder, or at least maybe that's where it first manifests itself.



---

archive/issue_comments_511761.json:
```json
{
    "body": "<a id='comment:21'></a>\nAnother data point. With Python3 numerous entries in inventory `objects.inv` files are assigned different sphinx directives from those assigned with Python2. For example, in the `objects.inv` file under `local/share/doc/sage/inventory/en/reference/misc` the entry\n\n```\nsage.misc.classcall_metaclass.ClasscallMetaclass sage/misc/classcall_metaclass.html#sage.misc.classcall_metaclass.ClasscallMetaclass\n```\nis assigned the `py:class` directive when using Python2 but the `py:attribute` directive when using Python3. I assume this will affect how things appear in `html` docs.\n\n```\npython -m sphinx.ext.intersphinx objects.inv | less\n```\nto view the file contents.",
    "created_at": "2018-12-21T20:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511761",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:21'></a>
Another data point. With Python3 numerous entries in inventory `objects.inv` files are assigned different sphinx directives from those assigned with Python2. For example, in the `objects.inv` file under `local/share/doc/sage/inventory/en/reference/misc` the entry

```
sage.misc.classcall_metaclass.ClasscallMetaclass sage/misc/classcall_metaclass.html#sage.misc.classcall_metaclass.ClasscallMetaclass
```
is assigned the `py:class` directive when using Python2 but the `py:attribute` directive when using Python3. I assume this will affect how things appear in `html` docs.

```
python -m sphinx.ext.intersphinx objects.inv | less
```
to view the file contents.



---

archive/issue_comments_511762.json:
```json
{
    "body": "<a id='comment:22'></a>\nThat's interesting. I don't understand anything about how Sphinx generates the inventory files. I've tried poking around, but I'm not getting anywhere.",
    "created_at": "2018-12-21T23:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511762",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
That's interesting. I don't understand anything about how Sphinx generates the inventory files. I've tried poking around, but I'm not getting anywhere.



---

archive/issue_comments_511763.json:
```json
{
    "body": "<a id='comment:23'></a>\nPlease check out #26949",
    "created_at": "2018-12-24T01:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511763",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:23'></a>
Please check out #26949



---

archive/issue_comments_511764.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [klee](#comment%3A23):\n> Please check out #26949\n\n@jhpalmieri: \n\nI'll be interested in your comments. It probably would have been better to have the commits in this location but so be it. The html-docs do build for me but I haven't been able to view them. I do notice some `DeprecationWarning`s that I don't believe were present with python 2, things like\n\n```\n[repl     ] <unknown>:181: DeprecationWarning: invalid escape sequence \\)\n[repl     ] <unknown>:365: DeprecationWarning: invalid escape sequence \\w\n[matrices ] <unknown>:6657: DeprecationWarning: invalid escape sequence \\p\n[number_fi] <unknown>:6657: DeprecationWarning: invalid escape sequence \\p\n[rings_num] <unknown>:6657: DeprecationWarning: invalid escape sequence \\p\n```",
    "created_at": "2018-12-24T18:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511764",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:24'></a>
Replying to [klee](#comment%3A23):
> Please check out #26949

@jhpalmieri: 

I'll be interested in your comments. It probably would have been better to have the commits in this location but so be it. The html-docs do build for me but I haven't been able to view them. I do notice some `DeprecationWarning`s that I don't believe were present with python 2, things like

```
[repl     ] <unknown>:181: DeprecationWarning: invalid escape sequence \)
[repl     ] <unknown>:365: DeprecationWarning: invalid escape sequence \w
[matrices ] <unknown>:6657: DeprecationWarning: invalid escape sequence \p
[number_fi] <unknown>:6657: DeprecationWarning: invalid escape sequence \p
[rings_num] <unknown>:6657: DeprecationWarning: invalid escape sequence \p
```



---

archive/issue_comments_511765.json:
```json
{
    "body": "<a id='comment:25'></a>\nThere are subtle differences under [Sets](http://doc.sagemath.org/html/en/reference/categories/sage/categories/sets_cat.html). We need a central place to discuss this.",
    "created_at": "2018-12-24T19:19:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511765",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:25'></a>
There are subtle differences under [Sets](http://doc.sagemath.org/html/en/reference/categories/sage/categories/sets_cat.html). We need a central place to discuss this.



---

archive/issue_comments_511766.json:
```json
{
    "body": "<a id='comment:26'></a>\nThose invalid escape sequences crop up in the Python 3 docbuilding process. Other tickets have removed many of them.",
    "created_at": "2018-12-24T20:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511766",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:26'></a>
Those invalid escape sequences crop up in the Python 3 docbuilding process. Other tickets have removed many of them.



---

archive/issue_events_074865.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-10T14:52:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26522#event-74865"
}
```



---

archive/issue_comments_511767.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2019-01-28T00:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511767",
    "user": "https://github.com/kwankyu"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_511768.json:
```json
{
    "body": "<a id='comment:28'></a>\nNow fixed by #26949.",
    "created_at": "2019-01-28T00:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511768",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:28'></a>
Now fixed by #26949.



---

archive/issue_events_074866.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2019-01-28T00:22:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26522#event-74866"
}
```



---

archive/issue_events_074867.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2019-01-28T00:22:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26522#event-74867"
}
```



---

archive/issue_comments_511769.json:
```json
{
    "body": "<a id='comment:29'></a>\nCool, thank you.",
    "created_at": "2019-01-28T17:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511769",
    "user": "https://github.com/embray"
}
```

<a id='comment:29'></a>
Cool, thank you.



---

archive/issue_comments_511770.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2019-01-28T17:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26522#issuecomment-511770",
    "user": "https://github.com/embray"
}
```

**Resolution:** fixed



---

archive/issue_events_074868.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-28T17:19:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26522",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26522#event-74868"
}
```
