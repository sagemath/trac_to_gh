# Issue 26936: WordMorphism: domain/codomain should be sortable if not given

archive/issues_026699.json:
```json
{
    "assignees": [],
    "body": "In `src/sage/combinat/words/morphism.py`, there is the following code:\n\n```\ndom_alph.sort()\n```\nand\n\n```\nreturn FiniteWords(sorted(codom_alphabet))\n```\n\nThese will break with #22029.\n\nCC:  @videlec\n\nBranch/Commit: **[`db81e7d`](https://github.com/sagemath/sagetrac-mirror/commit/db81e7dd2f141be4eed6cfcb87fc718ccae9e68c)**\n\nReviewer: **Jeroen Demeyer**\n\nAuthor: **S\u00e9bastien Labb\u00e9**\n\nComponent: **combinatorics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26936_\n\n",
    "closed_at": "2019-01-23T14:17:41Z",
    "created_at": "2018-12-21T15:32:49Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "WordMorphism: domain/codomain should be sortable if not given",
    "type": "issue",
    "updated_at": "2019-01-23T14:17:41Z",
    "url": "https://github.com/sagemath/sage/issues/26936",
    "user": "https://github.com/jdemeyer"
}
```
In `src/sage/combinat/words/morphism.py`, there is the following code:

```
dom_alph.sort()
```
and

```
return FiniteWords(sorted(codom_alphabet))
```

These will break with #22029.

CC:  @videlec

Branch/Commit: **[`db81e7d`](https://github.com/sagemath/sagetrac-mirror/commit/db81e7dd2f141be4eed6cfcb87fc718ccae9e68c)**

Reviewer: **Jeroen Demeyer**

Author: **Sébastien Labbé**

Component: **combinatorics**

_Issue created by migration from https://trac.sagemath.org/ticket/26936_





---

archive/issue_events_367133.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-21T15:32:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367133"
}
```



---

archive/issue_events_367134.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-21T15:32:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20combinatorics",
    "label_color": "0000ff",
    "label_name": "c: combinatorics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367134"
}
```



---

archive/issue_events_367135.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-21T15:32:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367135"
}
```



---

archive/issue_events_367136.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-21T15:32:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367136"
}
```



---

archive/issue_comments_415151.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThis one is not trivial. Simply replacing the `sorted()` by `list()` gives a lot of doctest failures.",
    "created_at": "2018-12-22T13:51:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415151",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

This one is not trivial. Simply replacing the `sorted()` by `list()` gives a lot of doctest failures.



---

archive/issue_events_367137.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-22T14:17:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "title_is": "WordMorphism should not assume sorted domain/codomain",
    "title_was": "WordMorphism should support unsortable codomain",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367137"
}
```



---

archive/issue_comments_415152.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,12 @@\n-This breaks with #22029:\n+In `src/sage/combinat/words/morphism.py`, there is the following code:\n \n ```\n-        return FiniteWords(sorted(codom_alphabet))\n+dom_alph.sort()\n ```\n+and\n+\n+```\n+return FiniteWords(sorted(codom_alphabet))\n+```\n+\n+These will break with #22029.\n``````\n",
    "created_at": "2018-12-22T14:17:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415152",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,12 @@
-This breaks with #22029:
+In `src/sage/combinat/words/morphism.py`, there is the following code:
 
 ```
-        return FiniteWords(sorted(codom_alphabet))
+dom_alph.sort()
 ```
+and
+
+```
+return FiniteWords(sorted(codom_alphabet))
+```
+
+These will break with #22029.
``````




---

archive/issue_comments_415153.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nDoes something like this work?\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbe667041c1f05fad5d9080ef82290d79042bb0e\"><code>dbe6670</code></a></td><td><code>26936: try sorting</code></td></tr></table>\n",
    "created_at": "2018-12-23T15:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415153",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:3" align="right">comment:3</div>

Does something like this work?

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbe667041c1f05fad5d9080ef82290d79042bb0e"><code>dbe6670</code></a></td><td><code>26936: try sorting</code></td></tr></table>




---

archive/issue_comments_415154.json:
```json
{
    "body": "Branch: **[public/26936](https://github.com/sagemath/sagetrac-mirror/tree/public/26936)**",
    "created_at": "2018-12-23T15:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415154",
    "user": "https://github.com/seblabbe"
}
```

Branch: **[public/26936](https://github.com/sagemath/sagetrac-mirror/tree/public/26936)**



---

archive/issue_comments_415155.json:
```json
{
    "body": "Commit: **[`dbe6670`](https://github.com/sagemath/sagetrac-mirror/commit/dbe667041c1f05fad5d9080ef82290d79042bb0e)**",
    "created_at": "2018-12-23T15:05:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415155",
    "user": "https://github.com/seblabbe"
}
```

Commit: **[`dbe6670`](https://github.com/sagemath/sagetrac-mirror/commit/dbe667041c1f05fad5d9080ef82290d79042bb0e)**



---

archive/issue_comments_415156.json:
```json
{
    "body": "Changed commit from **[`dbe6670`](https://github.com/sagemath/sagetrac-mirror/commit/dbe667041c1f05fad5d9080ef82290d79042bb0e)** to **[`f146b5e`](https://github.com/sagemath/sagetrac-mirror/commit/f146b5e33df130565f76c6cbf74c42ea78c12008)**",
    "created_at": "2018-12-23T15:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415156",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dbe6670`](https://github.com/sagemath/sagetrac-mirror/commit/dbe667041c1f05fad5d9080ef82290d79042bb0e)** to **[`f146b5e`](https://github.com/sagemath/sagetrac-mirror/commit/f146b5e33df130565f76c6cbf74c42ea78c12008)**



---

archive/issue_comments_415157.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f146b5e33df130565f76c6cbf74c42ea78c12008\"><code>f146b5e</code></a></td><td><code>26936: try sorting</code></td></tr></table>\n",
    "created_at": "2018-12-23T15:11:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415157",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f146b5e33df130565f76c6cbf74c42ea78c12008"><code>f146b5e</code></a></td><td><code>26936: try sorting</code></td></tr></table>




---

archive/issue_comments_415158.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI put `except TypeError` clauses if I understand #22029 correctly.",
    "created_at": "2018-12-23T15:12:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415158",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:5" align="right">comment:5</div>

I put `except TypeError` clauses if I understand #22029 correctly.



---

archive/issue_events_367138.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-12-23T15:14:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367138"
}
```



---

archive/issue_comments_415159.json:
```json
{
    "body": "Author: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2018-12-23T15:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415159",
    "user": "https://github.com/seblabbe"
}
```

Author: **Sébastien Labbé**



---

archive/issue_comments_415160.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThe problem with this `try`/`except` approach is that some methods/algorithms actually assume sorting. For example, `is_endomorphism()` will return `False` if the domain and codomain are the same, but in a different order.",
    "created_at": "2018-12-24T11:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415160",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:8" align="right">comment:8</div>

The problem with this `try`/`except` approach is that some methods/algorithms actually assume sorting. For example, `is_endomorphism()` will return `False` if the domain and codomain are the same, but in a different order.



---

archive/issue_events_367139.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-24T11:04:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367139"
}
```



---

archive/issue_events_367140.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-12-24T11:04:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367140"
}
```



---

archive/issue_comments_415161.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nFor `codom_alphabet`, you need to convert to a `list` in any case.",
    "created_at": "2018-12-24T11:04:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415161",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

For `codom_alphabet`, you need to convert to a `list` in any case.



---

archive/issue_comments_415162.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb4aa1fd1d476ab4766cbdd1349f23fb971b64d1\"><code>cb4aa1f</code></a></td><td><code>26936: fixing reviewer's comment</code></td></tr></table>\n",
    "created_at": "2018-12-31T12:17:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415162",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb4aa1fd1d476ab4766cbdd1349f23fb971b64d1"><code>cb4aa1f</code></a></td><td><code>26936: fixing reviewer's comment</code></td></tr></table>




---

archive/issue_comments_415163.json:
```json
{
    "body": "Changed commit from **[`f146b5e`](https://github.com/sagemath/sagetrac-mirror/commit/f146b5e33df130565f76c6cbf74c42ea78c12008)** to **[`cb4aa1f`](https://github.com/sagemath/sagetrac-mirror/commit/cb4aa1fd1d476ab4766cbdd1349f23fb971b64d1)**",
    "created_at": "2018-12-31T12:17:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415163",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f146b5e`](https://github.com/sagemath/sagetrac-mirror/commit/f146b5e33df130565f76c6cbf74c42ea78c12008)** to **[`cb4aa1f`](https://github.com/sagemath/sagetrac-mirror/commit/cb4aa1fd1d476ab4766cbdd1349f23fb971b64d1)**



---

archive/issue_events_367141.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-12-31T12:20:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367141"
}
```



---

archive/issue_events_367142.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-12-31T12:20:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367142"
}
```



---

archive/issue_comments_415164.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nAs explained in [comment:8], I still don't agree with this approach. It may be sufficient to fix existing doctests, but it doesn't address the real problem. This ticket simply replaces an obvious problem by a much more hidden problem.",
    "created_at": "2018-12-31T12:50:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415164",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:12" align="right">comment:12</div>

As explained in [comment:8], I still don't agree with this approach. It may be sufficient to fix existing doctests, but it doesn't address the real problem. This ticket simply replaces an obvious problem by a much more hidden problem.



---

archive/issue_comments_415165.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIf such a problem happen, that is an alphabet with uncomparable elements, the user can define the domain and cododmain himself by doing for instance `WordMorphism(data, domain=domain, codomain=domain)`. Would you like to add such a suggestion to the user for example within the error message for `is_endomorphism`?\n\nAlso, I think the best thing we should do with the move to Python 3 is to make it so that using alphabet with uncomparable letters is not desirable anymore.",
    "created_at": "2018-12-31T14:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415165",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:13" align="right">comment:13</div>

If such a problem happen, that is an alphabet with uncomparable elements, the user can define the domain and cododmain himself by doing for instance `WordMorphism(data, domain=domain, codomain=domain)`. Would you like to add such a suggestion to the user for example within the error message for `is_endomorphism`?

Also, I think the best thing we should do with the move to Python 3 is to make it so that using alphabet with uncomparable letters is not desirable anymore.



---

archive/issue_comments_415166.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@seblabbe](#comment:13):\n> Also, I think the best thing we should do with the move to Python 3 is to make it so that using alphabet with uncomparable letters is not desirable anymore.\n\nI don't really understand what you mean here.",
    "created_at": "2019-01-01T09:27:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415166",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@seblabbe](#comment:13):
> Also, I think the best thing we should do with the move to Python 3 is to make it so that using alphabet with uncomparable letters is not desirable anymore.

I don't really understand what you mean here.



---

archive/issue_comments_415167.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nMaybe the simplest solution for now would be to simply document that the alphabet must be sortable, and change the doctests with a non-sortable alphabet. Do you agree?",
    "created_at": "2019-01-02T16:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415167",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:15" align="right">comment:15</div>

Maybe the simplest solution for now would be to simply document that the alphabet must be sortable, and change the doctests with a non-sortable alphabet. Do you agree?



---

archive/issue_comments_415168.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nFor reference, the failing doctests are\n\n```\nsage -t --long src/sage/combinat/words/morphism.py\n**********************************************************************\nFile \"src/sage/combinat/words/morphism.py\", line 340, in sage.combinat.words.morphism.WordMorphism.__init__\nFailed example:\n    WordMorphism({'a':['a',6,'a'],6:[6,6,6,'a']})\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.words.morphism.WordMorphism.__init__[13]>\", line 1, in <module>\n        WordMorphism({'a':['a',Integer(6),'a'],Integer(6):[Integer(6),Integer(6),Integer(6),'a']})\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/combinat/words/morphism.py\", line 380, in __init__\n        codomain = self._build_codomain(data)\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/combinat/words/morphism.py\", line 478, in _build_codomain\n        return FiniteWords(sorted(codom_alphabet))\n      File \"sage/rings/integer.pyx\", line 952, in sage.rings.integer.Integer.__richcmp__ (build/cythonized/sage/rings/integer.c:7789)\n        return coercion_model.richcmp(left, right, op)\n      File \"sage/structure/coerce.pyx\", line 1967, in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:19675)\n        raise bin_op_exception('<', x, y)\n    TypeError: unsupported operand parent(s) for <: 'Integer Ring' and '<type 'str'>'\n**********************************************************************\nFile \"src/sage/combinat/words/morphism.py\", line 1266, in sage.combinat.words.morphism.WordMorphism.image\nFailed example:\n    s = WordMorphism({0:[1,2], 'a':(2,3,4), 'z':[9,8,7]})\nException raised:\n    Traceback (most recent call last):\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 671, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1086, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.combinat.words.morphism.WordMorphism.image[4]>\", line 1, in <module>\n        s = WordMorphism({Integer(0):[Integer(1),Integer(2)], 'a':(Integer(2),Integer(3),Integer(4)), 'z':[Integer(9),Integer(8),Integer(7)]})\n      File \"/opt/sage/local/lib/python2.7/site-packages/sage/combinat/words/morphism.py\", line 404, in __init__\n        dom_alph.sort()\n      File \"sage/rings/integer.pyx\", line 952, in sage.rings.integer.Integer.__richcmp__ (build/cythonized/sage/rings/integer.c:7789)\n        return coercion_model.richcmp(left, right, op)\n      File \"sage/structure/coerce.pyx\", line 1971, in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:19739)\n        raise bin_op_exception('>', x, y)\n    TypeError: unsupported operand parent(s) for >: 'Integer Ring' and '<type 'str'>'\n**********************************************************************\n```",
    "created_at": "2019-01-02T17:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415168",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:16" align="right">comment:16</div>

For reference, the failing doctests are

```
sage -t --long src/sage/combinat/words/morphism.py
**********************************************************************
File "src/sage/combinat/words/morphism.py", line 340, in sage.combinat.words.morphism.WordMorphism.__init__
Failed example:
    WordMorphism({'a':['a',6,'a'],6:[6,6,6,'a']})
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.words.morphism.WordMorphism.__init__[13]>", line 1, in <module>
        WordMorphism({'a':['a',Integer(6),'a'],Integer(6):[Integer(6),Integer(6),Integer(6),'a']})
      File "/opt/sage/local/lib/python2.7/site-packages/sage/combinat/words/morphism.py", line 380, in __init__
        codomain = self._build_codomain(data)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/combinat/words/morphism.py", line 478, in _build_codomain
        return FiniteWords(sorted(codom_alphabet))
      File "sage/rings/integer.pyx", line 952, in sage.rings.integer.Integer.__richcmp__ (build/cythonized/sage/rings/integer.c:7789)
        return coercion_model.richcmp(left, right, op)
      File "sage/structure/coerce.pyx", line 1967, in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:19675)
        raise bin_op_exception('<', x, y)
    TypeError: unsupported operand parent(s) for <: 'Integer Ring' and '<type 'str'>'
**********************************************************************
File "src/sage/combinat/words/morphism.py", line 1266, in sage.combinat.words.morphism.WordMorphism.image
Failed example:
    s = WordMorphism({0:[1,2], 'a':(2,3,4), 'z':[9,8,7]})
Exception raised:
    Traceback (most recent call last):
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 671, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/opt/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1086, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.words.morphism.WordMorphism.image[4]>", line 1, in <module>
        s = WordMorphism({Integer(0):[Integer(1),Integer(2)], 'a':(Integer(2),Integer(3),Integer(4)), 'z':[Integer(9),Integer(8),Integer(7)]})
      File "/opt/sage/local/lib/python2.7/site-packages/sage/combinat/words/morphism.py", line 404, in __init__
        dom_alph.sort()
      File "sage/rings/integer.pyx", line 952, in sage.rings.integer.Integer.__richcmp__ (build/cythonized/sage/rings/integer.c:7789)
        return coercion_model.richcmp(left, right, op)
      File "sage/structure/coerce.pyx", line 1971, in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:19739)
        raise bin_op_exception('>', x, y)
    TypeError: unsupported operand parent(s) for >: 'Integer Ring' and '<type 'str'>'
**********************************************************************
```



---

archive/issue_events_367143.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-02T20:44:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367143"
}
```



---

archive/issue_events_367144.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-02T20:44:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367144"
}
```



---

archive/issue_comments_415169.json:
```json
{
    "body": "Changed commit from **[`cb4aa1f`](https://github.com/sagemath/sagetrac-mirror/commit/cb4aa1fd1d476ab4766cbdd1349f23fb971b64d1)** to **[`0cc0a61`](https://github.com/sagemath/sagetrac-mirror/commit/0cc0a618c71e99a912063097aef96135b67ea37e)**",
    "created_at": "2019-01-02T22:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415169",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[`cb4aa1f`](https://github.com/sagemath/sagetrac-mirror/commit/cb4aa1fd1d476ab4766cbdd1349f23fb971b64d1)** to **[`0cc0a61`](https://github.com/sagemath/sagetrac-mirror/commit/0cc0a618c71e99a912063097aef96135b67ea37e)**



---

archive/issue_comments_415170.json:
```json
{
    "body": "Changed branch from **[public/26936](https://github.com/sagemath/sagetrac-mirror/tree/public/26936)** to **[u/slabbe/26936](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/26936)**",
    "created_at": "2019-01-02T22:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415170",
    "user": "https://github.com/seblabbe"
}
```

Changed branch from **[public/26936](https://github.com/sagemath/sagetrac-mirror/tree/public/26936)** to **[u/slabbe/26936](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/26936)**



---

archive/issue_comments_415171.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea22e208a07e8349e1885e5f600f125bc9a11743\"><code>ea22e20</code></a></td><td><code>26936: fixing doctests with sortable alphabets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0cc0a618c71e99a912063097aef96135b67ea37e\"><code>0cc0a61</code></a></td><td><code>26936: improved class documentation</code></td></tr></table>\n",
    "created_at": "2019-01-02T22:28:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415171",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:18"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea22e208a07e8349e1885e5f600f125bc9a11743"><code>ea22e20</code></a></td><td><code>26936: fixing doctests with sortable alphabets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0cc0a618c71e99a912063097aef96135b67ea37e"><code>0cc0a61</code></a></td><td><code>26936: improved class documentation</code></td></tr></table>




---

archive/issue_events_367145.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-01-02T22:34:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367145"
}
```



---

archive/issue_events_367146.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-01-02T22:34:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367146"
}
```



---

archive/issue_comments_415172.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jdemeyer](#comment:15):\n> Maybe the simplest solution for now would be to simply document that the alphabet must be sortable, and change the doctests with a non-sortable alphabet. Do you agree?\n\nDo you mean \"with a *sortable* alphabet\" ?\n\nI updated a branch which fixes the 2 doctests. I also updated the class documentation: INPUT block was missing, the example block of the class doc was the same as the module doc, I erased it and replaced that by examples better suited for what is seen with `WordMorphism?` showing the different way of using the inputs. I also added a note block about the sortable expectation when the domain and codomain are not explicitely given.\n\nNeeds review.",
    "created_at": "2019-01-02T22:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415172",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jdemeyer](#comment:15):
> Maybe the simplest solution for now would be to simply document that the alphabet must be sortable, and change the doctests with a non-sortable alphabet. Do you agree?

Do you mean "with a *sortable* alphabet" ?

I updated a branch which fixes the 2 doctests. I also updated the class documentation: INPUT block was missing, the example block of the class doc was the same as the module doc, I erased it and replaced that by examples better suited for what is seen with `WordMorphism?` showing the different way of using the inputs. I also added a note block about the sortable expectation when the domain and codomain are not explicitely given.

Needs review.



---

archive/issue_comments_415173.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@seblabbe](#comment:19):\n> Replying to [@jdemeyer](#comment:15):\n> > Maybe the simplest solution for now would be to simply document that the alphabet must be sortable, and change the doctests with a non-sortable alphabet. Do you agree?\n\n> \n> Do you mean \"with a *sortable* alphabet\" ?\n\nIf `X` is any permutation of the alphabet, then `sorted(X)` always succeeds (not raising an exception) and always returns the same thing (independent of the chosen permutation)",
    "created_at": "2019-01-03T07:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415173",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@seblabbe](#comment:19):
> Replying to [@jdemeyer](#comment:15):
> > Maybe the simplest solution for now would be to simply document that the alphabet must be sortable, and change the doctests with a non-sortable alphabet. Do you agree?

> 
> Do you mean "with a *sortable* alphabet" ?

If `X` is any permutation of the alphabet, then `sorted(X)` always succeeds (not raising an exception) and always returns the same thing (independent of the chosen permutation)



---

archive/issue_comments_415174.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db81e7dd2f141be4eed6cfcb87fc718ccae9e68c\"><code>db81e7d</code></a></td><td><code>26936: add example with non sortable alphabet</code></td></tr></table>\n",
    "created_at": "2019-01-03T09:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415174",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db81e7dd2f141be4eed6cfcb87fc718ccae9e68c"><code>db81e7d</code></a></td><td><code>26936: add example with non sortable alphabet</code></td></tr></table>




---

archive/issue_comments_415175.json:
```json
{
    "body": "Changed commit from **[`0cc0a61`](https://github.com/sagemath/sagetrac-mirror/commit/0cc0a618c71e99a912063097aef96135b67ea37e)** to **[`db81e7d`](https://github.com/sagemath/sagetrac-mirror/commit/db81e7dd2f141be4eed6cfcb87fc718ccae9e68c)**",
    "created_at": "2019-01-03T09:49:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415175",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0cc0a61`](https://github.com/sagemath/sagetrac-mirror/commit/0cc0a618c71e99a912063097aef96135b67ea37e)** to **[`db81e7d`](https://github.com/sagemath/sagetrac-mirror/commit/db81e7dd2f141be4eed6cfcb87fc718ccae9e68c)**



---

archive/issue_comments_415176.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI readded an example with a non-sortable alphabet showing how to deal with it by giving explicitely the domain and codomain.\n\nI did not check yet if it is okay with #22029.",
    "created_at": "2019-01-03T09:53:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415176",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:22" align="right">comment:22</div>

I readded an example with a non-sortable alphabet showing how to deal with it by giving explicitely the domain and codomain.

I did not check yet if it is okay with #22029.



---

archive/issue_comments_415177.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\n> I did not check yet if it is okay with #22029.\n\nIt is okay, I just checked.\n\nNeeds review.",
    "created_at": "2019-01-03T10:01:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415177",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:23" align="right">comment:23</div>

> I did not check yet if it is okay with #22029.

It is okay, I just checked.

Needs review.



---

archive/issue_comments_415178.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI'll merge this into the testing branch #22029 and see what the patchbot gives. Hang on...",
    "created_at": "2019-01-04T09:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415178",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:24" align="right">comment:24</div>

I'll merge this into the testing branch #22029 and see what the patchbot gives. Hang on...



---

archive/issue_events_367147.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-04T10:42:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "title_is": "WordMorphism: domain/codomain should be sortable if not given",
    "title_was": "WordMorphism should not assume sorted domain/codomain",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367147"
}
```



---

archive/issue_comments_415179.json:
```json
{
    "body": "Reviewer: **Jeroen Demeyer**",
    "created_at": "2019-01-04T10:49:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415179",
    "user": "https://github.com/jdemeyer"
}
```

Reviewer: **Jeroen Demeyer**



---

archive/issue_events_367148.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-04T18:30:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367148"
}
```



---

archive/issue_events_367149.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2019-01-04T18:30:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367149"
}
```



---

archive/issue_events_367150.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367150"
}
```



---

archive/issue_events_367151.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:16:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367151"
}
```



---

archive/issue_comments_415180.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415180",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_events_367152.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-23T14:17:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367152"
}
```



---

archive/issue_events_367153.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "37065d12db693fb9b5082e599c987b367c4d0744",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-01-23T14:17:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26936#event-367153"
}
```



---

archive/issue_comments_415181.json:
```json
{
    "body": "Changed branch from **[u/slabbe/26936](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/26936)** to **[`db81e7d`](https://github.com/sagemath/sagetrac-mirror/commit/db81e7dd2f141be4eed6cfcb87fc718ccae9e68c)**",
    "created_at": "2019-01-23T14:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26936",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26936#issuecomment-415181",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/slabbe/26936](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/26936)** to **[`db81e7d`](https://github.com/sagemath/sagetrac-mirror/commit/db81e7dd2f141be4eed6cfcb87fc718ccae9e68c)**
