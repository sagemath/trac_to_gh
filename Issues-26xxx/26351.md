# Issue 26351: build/pkgs/*/checksums.ini: Add upstream_url field

archive/issues_026114.json:
```json
{
    "assignees": [],
    "body": "This is to make testing tickets that include SPKG upgrades easier for developers and patchbots.\n\nTo add the `upstream_url` field, just edit `checksums.ini` or use the new option `--url` of `sage -package create`:\n\n```\n$ ./sage -package create --help\nusage: sage --package create [-h] [--version VERSION] [--tarball TARBALL]\n                             [--type TYPE] [--url URL]\n                             [package_name]\n\n[...]\n  --tarball TARBALL  Tarball filename pattern, e.g. Foo-VERSION.tar.bz2\n  --type TYPE        Package type\n  --url URL          Download URL pattern, e.g. http://example.org/Foo-\n                     VERSION.tar.bz2\n```\n\nThe default behavior of `sage -i` is not changed: Packages are only downloaded from the Sage mirrors.\n\nTo allow downloading from the upstream URL, use `sage -i --allow-upstream SPKG`.\n\nExample (for qepcad) at #28388.\n\n\nCC:  @embray @dimpase @vbraun @jhpalmieri @tscrim\n\nBranch: **[`537210d`](https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5)**\n\nReviewer: **Erik Bray**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26351_\n\n",
    "closed_at": "2020-03-10T23:27:48Z",
    "created_at": "2018-09-26T23:54:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "build/pkgs/*/checksums.ini: Add upstream_url field",
    "type": "issue",
    "updated_at": "2020-04-03T10:09:43Z",
    "url": "https://github.com/sagemath/sage/issues/26351",
    "user": "https://github.com/mkoeppe"
}
```
This is to make testing tickets that include SPKG upgrades easier for developers and patchbots.

To add the `upstream_url` field, just edit `checksums.ini` or use the new option `--url` of `sage -package create`:

```
$ ./sage -package create --help
usage: sage --package create [-h] [--version VERSION] [--tarball TARBALL]
                             [--type TYPE] [--url URL]
                             [package_name]

[...]
  --tarball TARBALL  Tarball filename pattern, e.g. Foo-VERSION.tar.bz2
  --type TYPE        Package type
  --url URL          Download URL pattern, e.g. http://example.org/Foo-
                     VERSION.tar.bz2
```

The default behavior of `sage -i` is not changed: Packages are only downloaded from the Sage mirrors.

To allow downloading from the upstream URL, use `sage -i --allow-upstream SPKG`.

Example (for qepcad) at #28388.


CC:  @embray @dimpase @vbraun @jhpalmieri @tscrim

Branch: **[`537210d`](https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5)**

Reviewer: **Erik Bray**

Author: **Matthias Koeppe**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/26351_





---

archive/issue_events_360096.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-26T23:54:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360096"
}
```



---

archive/issue_events_360097.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-26T23:54:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360097"
}
```



---

archive/issue_events_360098.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-26T23:54:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360098"
}
```



---

archive/issue_events_360099.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2018-09-26T23:54:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360099"
}
```



---

archive/issue_comments_406145.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nThat's a good idea.  It should still be synced to our mirrors primarily, but having a canonical \"original\" URL (even if it's just an attachment to a trac ticket) would provide the primary source for a tarball independent of the mirrors.",
    "created_at": "2018-09-27T08:05:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406145",
    "user": "https://github.com/embray"
}
```

<div id="comment:1" align="right">comment:1</div>

That's a good idea.  It should still be synced to our mirrors primarily, but having a canonical "original" URL (even if it's just an attachment to a trac ticket) would provide the primary source for a tarball independent of the mirrors.



---

archive/issue_comments_406146.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI'll take a stab at this.  What I'm thinking is `sage-download-file` could try all mirrors first, but failing that try the `upstream-tarball-url` as a last resort.  This way, if that field is filled in, the download should still work even if the tarball is not on the mirrors yet (this will be great for people manually testing new SPKGs too, since it means they won't have to manually download the tarball into `upstream/`).\n\nThe `upstream-tarball-url` should also be optional, so that we don't have to go adding it for every package.  But it should be encouraged to add it when adding new SPGKs or updating existing ones.  Additionally, `sage --package fix-checksum` could test the URL to make sure it's still valid, and `sage-download-file` could grow a `--no-mirrors` option to skip the mirrors entirely if there is an `upstream-tarball-url` (useful if nothing else for testing).",
    "created_at": "2018-09-27T11:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406146",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

I'll take a stab at this.  What I'm thinking is `sage-download-file` could try all mirrors first, but failing that try the `upstream-tarball-url` as a last resort.  This way, if that field is filled in, the download should still work even if the tarball is not on the mirrors yet (this will be great for people manually testing new SPKGs too, since it means they won't have to manually download the tarball into `upstream/`).

The `upstream-tarball-url` should also be optional, so that we don't have to go adding it for every package.  But it should be encouraged to add it when adding new SPGKs or updating existing ones.  Additionally, `sage --package fix-checksum` could test the URL to make sure it's still valid, and `sage-download-file` could grow a `--no-mirrors` option to skip the mirrors entirely if there is an `upstream-tarball-url` (useful if nothing else for testing).



---

archive/issue_comments_406147.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nSounds good, thank you!",
    "created_at": "2018-09-27T17:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406147",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

Sounds good, thank you!



---

archive/issue_comments_406148.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nAny news on this?",
    "created_at": "2019-04-29T21:42:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406148",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">comment:4</div>

Any news on this?



---

archive/issue_events_360100.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-09T16:08:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360100"
}
```



---

archive/issue_events_360101.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-09T16:08:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "milestone_number": null,
    "milestone_title": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360101"
}
```



---

archive/issue_comments_406149.json:
```json
{
    "body": "Branch: **[u/mkoeppe/build_pkgs___checksums_ini__add_upstream_tarball_url_field](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_pkgs___checksums_ini__add_upstream_tarball_url_field)**",
    "created_at": "2020-02-11T02:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406149",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/build_pkgs___checksums_ini__add_upstream_tarball_url_field](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_pkgs___checksums_ini__add_upstream_tarball_url_field)**



---

archive/issue_events_360102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-11T02:59:18Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "title_is": "build/pkgs/*/checksums.ini: Add upstream_url field",
    "title_was": "build/pkgs/*/checksums.ini: Add upstream-tarball-url field",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360102"
}
```



---

archive/issue_comments_406150.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,23 @@\n-This is to make testing tickets that include spkg upgrades easier.\n+This is to make testing tickets that include SPKG upgrades easier for developers.\n+\n+To add the `upstream_url` field, just edit `checksums.ini` or use the new option `--url` of `sage -package create`:\n+\n+```\n+$ ./sage -package create --help\n+usage: sage --package create [-h] [--version VERSION] [--tarball TARBALL]\n+                             [--type TYPE] [--url URL]\n+                             [package_name]\n+\n+[...]\n+  --tarball TARBALL  Tarball filename pattern, e.g. Foo-VERSION.tar.bz2\n+  --type TYPE        Package type\n+  --url URL          Download URL pattern, e.g. http://example.org/Foo-\n+                     VERSION.tar.bz2\n+```\n+\n+The default behavior of `sage -i` is not changed: Packages are only downloaded from the Sage mirrors.\n+\n+To allow downloading from the upstream URL, use `sage -i --allow-upstream SPKG`.\n+\n+Example (for qepcad) at 328388.\n+\n``````\n",
    "created_at": "2020-02-11T02:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406150",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,23 @@
-This is to make testing tickets that include spkg upgrades easier.
+This is to make testing tickets that include SPKG upgrades easier for developers.
+
+To add the `upstream_url` field, just edit `checksums.ini` or use the new option `--url` of `sage -package create`:
+
+```
+$ ./sage -package create --help
+usage: sage --package create [-h] [--version VERSION] [--tarball TARBALL]
+                             [--type TYPE] [--url URL]
+                             [package_name]
+
+[...]
+  --tarball TARBALL  Tarball filename pattern, e.g. Foo-VERSION.tar.bz2
+  --type TYPE        Package type
+  --url URL          Download URL pattern, e.g. http://example.org/Foo-
+                     VERSION.tar.bz2
+```
+
+The default behavior of `sage -i` is not changed: Packages are only downloaded from the Sage mirrors.
+
+To allow downloading from the upstream URL, use `sage -i --allow-upstream SPKG`.
+
+Example (for qepcad) at 328388.
+
``````




---

archive/issue_events_360103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-02-11T02:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360103"
}
```



---

archive/issue_comments_406151.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb6f4f30f93e9302d2367ff6d3938968c7fdbf3c\"><code>cb6f4f3</code></a></td><td><code>build/tox.ini: Add more python versions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f421bd7263995473ce3c4450f0447cdcb59b1cd7\"><code>f421bd7</code></a></td><td><code>build/test: Set maxDiff=None to improve debugging of sage_bootstrap</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c02af0d797c0a364d2cda8b2c95b7afdc1353115\"><code>c02af0d</code></a></td><td><code>build/sage_bootstrap: Handle upstream_url field in checksum.ini, add options to 'sage -package'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b4a9e823dd2685e70e3510fd57ee61184d199a4\"><code>5b4a9e8</code></a></td><td><code>build/sage_bootstrap/download: Add option --allow-upstream</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5\"><code>537210d</code></a></td><td><code>build/bin/sage-spkg: Add option -o (--allow-upstream)</code></td></tr></table>\n",
    "created_at": "2020-02-11T02:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406151",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb6f4f30f93e9302d2367ff6d3938968c7fdbf3c"><code>cb6f4f3</code></a></td><td><code>build/tox.ini: Add more python versions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f421bd7263995473ce3c4450f0447cdcb59b1cd7"><code>f421bd7</code></a></td><td><code>build/test: Set maxDiff=None to improve debugging of sage_bootstrap</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c02af0d797c0a364d2cda8b2c95b7afdc1353115"><code>c02af0d</code></a></td><td><code>build/sage_bootstrap: Handle upstream_url field in checksum.ini, add options to 'sage -package'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b4a9e823dd2685e70e3510fd57ee61184d199a4"><code>5b4a9e8</code></a></td><td><code>build/sage_bootstrap/download: Add option --allow-upstream</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5"><code>537210d</code></a></td><td><code>build/bin/sage-spkg: Add option -o (--allow-upstream)</code></td></tr></table>




---

archive/issue_comments_406152.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-02-11T02:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406152",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_406153.json:
```json
{
    "body": "Commit: **[`537210d`](https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5)**",
    "created_at": "2020-02-11T02:59:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406153",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`537210d`](https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5)**



---

archive/issue_comments_406154.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,5 +19,5 @@\n \n To allow downloading from the upstream URL, use `sage -i --allow-upstream SPKG`.\n \n-Example (for qepcad) at 328388.\n+Example (for qepcad) at #28388.\n \n``````\n",
    "created_at": "2020-02-11T02:59:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406154",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,5 +19,5 @@
 
 To allow downloading from the upstream URL, use `sage -i --allow-upstream SPKG`.
 
-Example (for qepcad) at 328388.
+Example (for qepcad) at #28388.
 
``````




---

archive/issue_comments_406155.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This is to make testing tickets that include SPKG upgrades easier for developers.\n+This is to make testing tickets that include SPKG upgrades easier for developers and patchbots.\n \n To add the `upstream_url` field, just edit `checksums.ini` or use the new option `--url` of `sage -package create`:\n \n``````\n",
    "created_at": "2020-02-17T06:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406155",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This is to make testing tickets that include SPKG upgrades easier for developers.
+This is to make testing tickets that include SPKG upgrades easier for developers and patchbots.
 
 To add the `upstream_url` field, just edit `checksums.ini` or use the new option `--url` of `sage -package create`:
 
``````




---

archive/issue_comments_406156.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAnyone interested in this ticket?",
    "created_at": "2020-03-03T02:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406156",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Anyone interested in this ticket?



---

archive/issue_comments_406157.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nEverything looks fine to me from what I understand, but I don't feel qualified enough to set this to a positive review.",
    "created_at": "2020-03-03T04:11:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406157",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

Everything looks fine to me from what I understand, but I don't feel qualified enough to set this to a positive review.



---

archive/issue_comments_406158.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWhat are the lines `maxDiff = None` for? And how are we supposed to test that this works?\n\nEdit: I mean, I see the commit message \"build/test: Set maxDiff=None to improve debugging of sage_bootstrap\", but can you expand on this?",
    "created_at": "2020-03-03T05:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406158",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:13" align="right">comment:13</div>

What are the lines `maxDiff = None` for? And how are we supposed to test that this works?

Edit: I mean, I see the commit message "build/test: Set maxDiff=None to improve debugging of sage_bootstrap", but can you expand on this?



---

archive/issue_comments_406159.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jhpalmieri](#comment:13):\n> What are the lines `maxDiff = None` for?\n\nhttps://docs.python.org/3/library/unittest.html#unittest.TestCase.maxDiff",
    "created_at": "2020-03-03T11:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406159",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jhpalmieri](#comment:13):
> What are the lines `maxDiff = None` for?

https://docs.python.org/3/library/unittest.html#unittest.TestCase.maxDiff



---

archive/issue_comments_406160.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@jhpalmieri](#comment:13):\n> What are the lines `maxDiff = None` for? And how are we supposed to test that this works?\n> \n> Edit: I mean, I see the commit message \"build/test: Set maxDiff=None to improve debugging of sage_bootstrap\", but can you expand on this?\n\nWithout this change, failed test assertions did not show enough useful information.\nNow, of course, nothing fails, so these lines have no effect on the operation of sage_bootstrap.\n\nIf you want to test that this ticket works, may I suggest picking a package that needs upgrading anyway, and use the new upstream_url mechanism to do the upgrade.",
    "created_at": "2020-03-06T02:29:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406160",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@jhpalmieri](#comment:13):
> What are the lines `maxDiff = None` for? And how are we supposed to test that this works?
> 
> Edit: I mean, I see the commit message "build/test: Set maxDiff=None to improve debugging of sage_bootstrap", but can you expand on this?

Without this change, failed test assertions did not show enough useful information.
Now, of course, nothing fails, so these lines have no effect on the operation of sage_bootstrap.

If you want to test that this ticket works, may I suggest picking a package that needs upgrading anyway, and use the new upstream_url mechanism to do the upgrade.



---

archive/issue_comments_406161.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI have a package to upgrade, so I'll try doing it with this feature.",
    "created_at": "2020-03-06T12:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406161",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

I have a package to upgrade, so I'll try doing it with this feature.



---

archive/issue_comments_406162.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nSort of unrelated, but why does `tox.ini` have so many old Python 3.x versions?  The minimal version I've been able to get Sage working on is 3.6.",
    "created_at": "2020-03-06T12:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406162",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Sort of unrelated, but why does `tox.ini` have so many old Python 3.x versions?  The minimal version I've been able to get Sage working on is 3.6.



---

archive/issue_comments_406163.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nCan you please also apply the following patch:\n\n```\ndiff --git a/build/sage_bootstrap/cmdline.py b/build/sage_bootstrap/cmdline.py\nindex abb617dd65..3fa9de4104 100644\n--- a/build/sage_bootstrap/cmdline.py\n+++ b/build/sage_bootstrap/cmdline.py\n@@ -219,14 +219,14 @@ def make_parser():\n     parser_fix_checksum.add_argument(\n         'package_name', nargs='?', default=None, type=str,\n         help='Package name. Default: fix all packages.')\n-    \n+\n     parser_create = subparsers.add_parser(\n         'create', epilog=epilog_create,\n         formatter_class=argparse.RawDescriptionHelpFormatter,\n         help='Create or overwrite package.')\n     parser_create.add_argument(\n-        'package_name', nargs='?', default=None, type=str,\n-        help='Package name. Default: fix all packages.')\n+        'package_name', default=None, type=str,\n+        help='Package name.')\n     parser_create.add_argument(\n         '--version', type=str, default=None, help='Package version')\n     parser_create.add_argument(\n```\n\nrunning `sage -package create` doesn't work without a package name argument, so it shouldn't be optional (it looks like it was just incorrectly copied from the fix-checksum command).",
    "created_at": "2020-03-06T13:35:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406163",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

Can you please also apply the following patch:

```
diff --git a/build/sage_bootstrap/cmdline.py b/build/sage_bootstrap/cmdline.py
index abb617dd65..3fa9de4104 100644
--- a/build/sage_bootstrap/cmdline.py
+++ b/build/sage_bootstrap/cmdline.py
@@ -219,14 +219,14 @@ def make_parser():
     parser_fix_checksum.add_argument(
         'package_name', nargs='?', default=None, type=str,
         help='Package name. Default: fix all packages.')
-    
+
     parser_create = subparsers.add_parser(
         'create', epilog=epilog_create,
         formatter_class=argparse.RawDescriptionHelpFormatter,
         help='Create or overwrite package.')
     parser_create.add_argument(
-        'package_name', nargs='?', default=None, type=str,
-        help='Package name. Default: fix all packages.')
+        'package_name', default=None, type=str,
+        help='Package name.')
     parser_create.add_argument(
         '--version', type=str, default=None, help='Package version')
     parser_create.add_argument(
```

running `sage -package create` doesn't work without a package name argument, so it shouldn't be optional (it looks like it was just incorrectly copied from the fix-checksum command).



---

archive/issue_comments_406164.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@embray](#comment:17):\n> Sort of unrelated, but why does `tox.ini` have so many old Python 3.x versions?  The minimal version I've been able to get Sage working on is 3.6.\n\nNevermind, I misunderstood that these are the tests for the bootstrap scripts.",
    "created_at": "2020-03-06T13:39:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406164",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@embray](#comment:17):
> Sort of unrelated, but why does `tox.ini` have so many old Python 3.x versions?  The minimal version I've been able to get Sage working on is 3.6.

Nevermind, I misunderstood that these are the tests for the bootstrap scripts.



---

archive/issue_comments_406165.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIf you want to fix the issue above as part of this ticket please do; it wasn't clear to me whether or not this bug predates this ticket (it probably does).  Whether you decide to or not you can set this to positive_review afterwards.",
    "created_at": "2020-03-06T14:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406165",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

If you want to fix the issue above as part of this ticket please do; it wasn't clear to me whether or not this bug predates this ticket (it probably does).  Whether you decide to or not you can set this to positive_review afterwards.



---

archive/issue_comments_406166.json:
```json
{
    "body": "Reviewer: **Erik Bray**",
    "created_at": "2020-03-06T14:50:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406166",
    "user": "https://github.com/embray"
}
```

Reviewer: **Erik Bray**



---

archive/issue_comments_406167.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThanks for reviewing.\nSeparate ticket please for the patch.",
    "created_at": "2020-03-06T15:21:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406167",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Thanks for reviewing.
Separate ticket please for the patch.



---

archive/issue_events_360104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-06T15:21:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360104"
}
```



---

archive/issue_events_360105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-03-06T15:21:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360105"
}
```



---

archive/issue_comments_406168.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mkoeppe](#comment:21):\n> Separate ticket please for the patch.\n\nThat's #29286",
    "created_at": "2020-03-06T16:30:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406168",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mkoeppe](#comment:21):
> Separate ticket please for the patch.

That's #29286



---

archive/issue_events_360106.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:15:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360106"
}
```



---

archive/issue_events_360107.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:15:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360107"
}
```



---

archive/issue_comments_406169.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nMerge conflict",
    "created_at": "2020-03-08T22:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406169",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:23" align="right">comment:23</div>

Merge conflict



---

archive/issue_events_360108.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:16:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360108"
}
```



---

archive/issue_events_360109.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:16:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360109"
}
```



---

archive/issue_comments_406170.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nActually: `There is no merge to abort (MERGE_HEAD missing).`",
    "created_at": "2020-03-08T22:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406170",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:24" align="right">comment:24</div>

Actually: `There is no merge to abort (MERGE_HEAD missing).`



---

archive/issue_events_360110.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:26:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360110"
}
```



---

archive/issue_events_360111.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-08T22:26:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360111"
}
```



---

archive/issue_events_360112.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-03-10T23:27:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360112"
}
```



---

archive/issue_events_360113.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d8ce310e3d9c3a8313b9f9e95a7decd789e24ab3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-03-10T23:27:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26351#event-360113"
}
```



---

archive/issue_comments_406171.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/build_pkgs___checksums_ini__add_upstream_tarball_url_field](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_pkgs___checksums_ini__add_upstream_tarball_url_field)** to **[`537210d`](https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5)**",
    "created_at": "2020-03-10T23:27:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406171",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/build_pkgs___checksums_ini__add_upstream_tarball_url_field](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_pkgs___checksums_ini__add_upstream_tarball_url_field)** to **[`537210d`](https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5)**



---

archive/issue_comments_406172.json:
```json
{
    "body": "Changed commit from **[`537210d`](https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5)** to none",
    "created_at": "2020-04-03T00:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406172",
    "user": "https://github.com/dimpase"
}
```

Changed commit from **[`537210d`](https://github.com/sagemath/sagetrac-mirror/commit/537210da655c72cc8f64ad72d664334e07b662c5)** to none



---

archive/issue_comments_406173.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI am trying to test #29444, and upstream_url does not seem to work\n(either by running make, or with ./sage -i)\nWhat am I doing wrong?",
    "created_at": "2020-04-03T00:54:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406173",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

I am trying to test #29444, and upstream_url does not seem to work
(either by running make, or with ./sage -i)
What am I doing wrong?



---

archive/issue_comments_406174.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI think you're supposed to do `make SAGE_SPKG=\"sage-spkg -o\" ...`",
    "created_at": "2020-04-03T01:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406174",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:28" align="right">comment:28</div>

I think you're supposed to do `make SAGE_SPKG="sage-spkg -o" ...`



---

archive/issue_comments_406175.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThanks. Is there any reason for this extra verbosity? After all, the checksums are supposed to identify the tarball well enough, so as long as they are not tampered with, downloading from `upstream_url` is safe.",
    "created_at": "2020-04-03T02:30:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406175",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

Thanks. Is there any reason for this extra verbosity? After all, the checksums are supposed to identify the tarball well enough, so as long as they are not tampered with, downloading from `upstream_url` is safe.



---

archive/issue_comments_406176.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\n#29392 proposes a nicer user interface to this feature. \nI didn't make it the default because it's a potentially controversial feature.",
    "created_at": "2020-04-03T10:09:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26351",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26351#issuecomment-406176",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

#29392 proposes a nicer user interface to this feature. 
I didn't make it the default because it's a potentially controversial feature.
