# Issue 26326: Upgrade networkx to 2.2, add self tests, and update random seed format

archive/issues_026089.json:
```json
{
    "body": "Note that self tests require `nose` which is optional only.\n\nAlso, the random seeds are not passed as integers, but as `random.Random` instances, see https://networkx.github.io/documentation/stable/release/release_2.2.html#improvements\n\nZipball: https://files.pythonhosted.org/packages/f3/f4/7e20ef40b118478191cec0b58c3192f822cace858c19505c7670961b76b2/networkx-2.2.zip\n\nCC:  @embray @kiwifb @timokau\n\nReviewer: Volker Braun, Dima Pasechnik\n\nAuthor: Thierry Monteil, Dima Pasechnik\n\nBranch: 8d125d0f7bb7ce5ac347dc4fc979a134feccd11c\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26326\n\n",
    "closed_at": "2019-01-10T17:26:57Z",
    "created_at": "2018-09-21T12:54:31Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.6",
    "title": "Upgrade networkx to 2.2, add self tests, and update random seed format",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26326",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
Note that self tests require `nose` which is optional only.

Also, the random seeds are not passed as integers, but as `random.Random` instances, see https://networkx.github.io/documentation/stable/release/release_2.2.html#improvements

Zipball: https://files.pythonhosted.org/packages/f3/f4/7e20ef40b118478191cec0b58c3192f822cace858c19505c7670961b76b2/networkx-2.2.zip

CC:  @embray @kiwifb @timokau

Reviewer: Volker Braun, Dima Pasechnik

Author: Thierry Monteil, Dima Pasechnik

Branch: 8d125d0f7bb7ce5ac347dc4fc979a134feccd11c

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26326





---

archive/issue_comments_367453.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-21T13:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367453",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367454.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-21T13:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367454",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_367455.json:
```json
{
    "body": "<a id='comment:5'></a>There are issues with random graphs provided by networkx:\n\n```\nsage: graphs.RandomBarabasiAlbert(50,2)\nValueError: 71598026902468055907350337076908659440L cannot be used to generate a random.Random instance\n```",
    "created_at": "2018-09-21T13:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367455",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:5'></a>There are issues with random graphs provided by networkx:

```
sage: graphs.RandomBarabasiAlbert(50,2)
ValueError: 71598026902468055907350337076908659440L cannot be used to generate a random.Random instance
```



---

archive/issue_comments_367456.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-21T13:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367456",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_367457.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-21T14:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367457",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367458.json:
```json
{
    "body": "<a id='comment:8'></a>Erik, there is an issue about the nature of random seeds provided by `current_randstate` during doctests that is not of the same type that the ones provided during a normal session. It might come from #24508, any idea on how to fix that ?",
    "created_at": "2018-09-21T14:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367458",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:8'></a>Erik, there is an issue about the nature of random seeds provided by `current_randstate` during doctests that is not of the same type that the ones provided during a normal session. It might come from #24508, any idea on how to fix that ?



---

archive/issue_comments_367459.json:
```json
{
    "body": "<a id='comment:9'></a>I see; the relevant code in networkx is here: https://github.com/networkx/networkx/blob/3466b800ef241cdfe76bae875fac50ac1ab54e02/networkx/utils/misc.py#L373\n\nWhat I don't quite understand is why you changed this to `current_python` everywhere.  It should still accept a plain `int` as the RNG seed (I don't quite like how networkx uses \"seed\" to mean something else, but that's another question...)\n\nI could offer a workaround, but first I want to make sure it's really necessary to make this change in Sage, because it doesn't seem like it should be necessary.  The release notes you linked to are unclear about what they thing the best practice should be.",
    "created_at": "2018-09-21T15:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367459",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>I see; the relevant code in networkx is here: https://github.com/networkx/networkx/blob/3466b800ef241cdfe76bae875fac50ac1ab54e02/networkx/utils/misc.py#L373

What I don't quite understand is why you changed this to `current_python` everywhere.  It should still accept a plain `int` as the RNG seed (I don't quite like how networkx uses "seed" to mean something else, but that's another question...)

I could offer a workaround, but first I want to make sure it's really necessary to make this change in Sage, because it doesn't seem like it should be necessary.  The release notes you linked to are unclear about what they thing the best practice should be.



---

archive/issue_comments_367460.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 embray]:\n> I see; the relevant code in networkx is here: https://github.com/networkx/networkx/blob/3466b800ef241cdfe76bae875fac50ac1ab54e02/networkx/utils/misc.py#L373\n> \n> What I don't quite understand is why you changed this to `current_python` everywhere.  It should still accept a plain `int` as the RNG seed (I don't quite like how networkx uses \"seed\" to mean something else, but that's another question...)\n\n\n\nThe problem is that `current_randstate().seed()` provides longs, and apparently networkx does not like it:\n\n```\nsage: graphs.RandomBarabasiAlbert(50,2)\nValueError: 337906337582125808005456054818180223663L cannot be used to generate a random.Random instance\n```\n\nHowever it likes instances of `random.Random` objects which are provided by `current_randstate().python_random()`.\n\nMaybe should i use `current_randstate().c_random()` which is a 31bit-only integer, or `current_randstate().python_random() % sys.maxint`.\n\nI guess that they do not support long because they are going to support Python 3 only.\n\n> I could offer a workaround, but first I want to make sure it's really necessary to make this change in Sage, because it doesn't seem like it should be necessary.  The release notes you linked to are unclear about what they thing the best practice should be.",
    "created_at": "2018-09-21T15:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367460",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:10'></a>Replying to [comment:9 embray]:
> I see; the relevant code in networkx is here: https://github.com/networkx/networkx/blob/3466b800ef241cdfe76bae875fac50ac1ab54e02/networkx/utils/misc.py#L373
> 
> What I don't quite understand is why you changed this to `current_python` everywhere.  It should still accept a plain `int` as the RNG seed (I don't quite like how networkx uses "seed" to mean something else, but that's another question...)



The problem is that `current_randstate().seed()` provides longs, and apparently networkx does not like it:

```
sage: graphs.RandomBarabasiAlbert(50,2)
ValueError: 337906337582125808005456054818180223663L cannot be used to generate a random.Random instance
```

However it likes instances of `random.Random` objects which are provided by `current_randstate().python_random()`.

Maybe should i use `current_randstate().c_random()` which is a 31bit-only integer, or `current_randstate().python_random() % sys.maxint`.

I guess that they do not support long because they are going to support Python 3 only.

> I could offer a workaround, but first I want to make sure it's really necessary to make this change in Sage, because it doesn't seem like it should be necessary.  The release notes you linked to are unclear about what they thing the best practice should be.



---

archive/issue_comments_367461.json:
```json
{
    "body": "<a id='comment:13'></a>So what's the status of this ticket now? Does this need review again or do you still want to change something here embray?",
    "created_at": "2018-10-10T07:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367461",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:13'></a>So what's the status of this ticket now? Does this need review again or do you still want to change something here embray?



---

archive/issue_comments_367462.json:
```json
{
    "body": "<a id='comment:14'></a>With this patch I'm getting lots of test suite errors on Arch:\n\nValueError: <sage.cpython._py2_random.Random object at 0x561e012e8f50> cannot be used to generate a random.Random instance\n\nRunning the test code directly in Sage works fine. Using c_random() instead of python_random() makes the tests pass.",
    "created_at": "2018-10-14T13:57:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367462",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:14'></a>With this patch I'm getting lots of test suite errors on Arch:

ValueError: <sage.cpython._py2_random.Random object at 0x561e012e8f50> cannot be used to generate a random.Random instance

Running the test code directly in Sage works fine. Using c_random() instead of python_random() makes the tests pass.



---

archive/issue_comments_367463.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 arojas]:\n> With this patch I'm getting lots of test suite errors on Arch:\n> \n> ValueError: <sage.cpython._py2_random.Random object at 0x561e012e8f50> cannot be used to generate a random.Random instance\n> \n> Running the test code directly in Sage works fine. Using c_random() instead of python_random() makes the tests pass.\n\n\nActually no, there are still some (fewer) failures\n\n```\nFile \"/usr/lib/python2.7/site-packages/sage/graphs/graph_plot.py\", line 1286, in sage.graphs.graph_plot.GraphPlot.layout_tree\nFailed example:\n    T.show(layout='tree',tree_orientation='up') # indirect doctest\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python2.7/site-packages/sage/doctest/forker.py\", line 659, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1070, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.graph_plot.GraphPlot.layout_tree[1]>\", line 1, in <module>\n        T.show(layout='tree',tree_orientation='up') # indirect doctest\n      File \"/usr/lib/python2.7/site-packages/sage/graphs/generic_graph.py\", line 19265, in show\n        return self.graphplot(**plot_kwds).show(**kwds)\n      File \"/usr/lib/python2.7/site-packages/sage/graphs/generic_graph.py\", line 18867, in graphplot\n        return GraphPlot(graph=self, options=options)\n      File \"/usr/lib/python2.7/site-packages/sage/graphs/graph_plot.py\", line 256, in __init__\n        self.set_pos()\n      File \"/usr/lib/python2.7/site-packages/sage/graphs/graph_plot.py\", line 340, in set_pos\n        self._pos = self._graph.layout(**self._options)\n      File \"/usr/lib/python2.7/site-packages/sage/graphs/generic_graph.py\", line 18187, in layout\n        pos = getattr(self, \"layout_%s\"%layout)(dim = dim, **options)\n      File \"/usr/lib/python2.7/site-packages/sage/graphs/generic_graph.py\", line 18443, in layout_tree\n        raise RuntimeError(\"Cannot use tree layout on this graph: \"\n    RuntimeError: Cannot use tree layout on this graph: self.is_tree() returns False.\n```\n\nAgain, running the code inside a Sage session works fine",
    "created_at": "2018-10-14T17:01:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367463",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:15'></a>Replying to [comment:14 arojas]:
> With this patch I'm getting lots of test suite errors on Arch:
> 
> ValueError: <sage.cpython._py2_random.Random object at 0x561e012e8f50> cannot be used to generate a random.Random instance
> 
> Running the test code directly in Sage works fine. Using c_random() instead of python_random() makes the tests pass.


Actually no, there are still some (fewer) failures

```
File "/usr/lib/python2.7/site-packages/sage/graphs/graph_plot.py", line 1286, in sage.graphs.graph_plot.GraphPlot.layout_tree
Failed example:
    T.show(layout='tree',tree_orientation='up') # indirect doctest
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.graph_plot.GraphPlot.layout_tree[1]>", line 1, in <module>
        T.show(layout='tree',tree_orientation='up') # indirect doctest
      File "/usr/lib/python2.7/site-packages/sage/graphs/generic_graph.py", line 19265, in show
        return self.graphplot(**plot_kwds).show(**kwds)
      File "/usr/lib/python2.7/site-packages/sage/graphs/generic_graph.py", line 18867, in graphplot
        return GraphPlot(graph=self, options=options)
      File "/usr/lib/python2.7/site-packages/sage/graphs/graph_plot.py", line 256, in __init__
        self.set_pos()
      File "/usr/lib/python2.7/site-packages/sage/graphs/graph_plot.py", line 340, in set_pos
        self._pos = self._graph.layout(**self._options)
      File "/usr/lib/python2.7/site-packages/sage/graphs/generic_graph.py", line 18187, in layout
        pos = getattr(self, "layout_%s"%layout)(dim = dim, **options)
      File "/usr/lib/python2.7/site-packages/sage/graphs/generic_graph.py", line 18443, in layout_tree
        raise RuntimeError("Cannot use tree layout on this graph: "
    RuntimeError: Cannot use tree layout on this graph: self.is_tree() returns False.
```

Again, running the code inside a Sage session works fine



---

archive/issue_comments_367464.json:
```json
{
    "body": "<a id='comment:16'></a>I'm getting the same errors as Antonio on nix.",
    "created_at": "2018-10-24T15:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367464",
    "user": "https://github.com/timokau"
}
```

<a id='comment:16'></a>I'm getting the same errors as Antonio on nix.



---

archive/issue_comments_367465.json:
```json
{
    "body": "<a id='comment:17'></a>> I guess that they do not support long because they are going to support Python 3 only.\n\n\nThat doesn't really make sense given that the Python 3 int type is the Python 2 long type.  Probably more likely it needs to be modulo `sys.max_size`.",
    "created_at": "2018-10-26T13:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367465",
    "user": "https://github.com/embray"
}
```

<a id='comment:17'></a>> I guess that they do not support long because they are going to support Python 3 only.


That doesn't really make sense given that the Python 3 int type is the Python 2 long type.  Probably more likely it needs to be modulo `sys.max_size`.



---

archive/issue_comments_367466.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-26T15:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367466",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367467.json:
```json
{
    "body": "<a id='comment:19'></a>I would have preferred to rely on `random.Random` seeds, but let us move forward with that.",
    "created_at": "2018-10-26T16:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367467",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:19'></a>I would have preferred to rely on `random.Random` seeds, but let us move forward with that.



---

archive/issue_comments_367468.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-26T16:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367468",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_367469.json:
```json
{
    "body": "<a id='comment:20'></a>I'm still getting:\n\n```\nFile \"/nix/store/9h32ccgbsdjbbiw5y9lvc338w5fbskkh-sage-src-8.4/src/sage/graphs/generators/degree_sequence.py\", line 153, in sage.graphs.generators.degree_sequence.DegreeSequenceConfigurationModel\nFailed example:\n    G = graphs.DegreeSequenceConfigurationModel([1,1])\nException raised:\n    Traceback (most recent call last):\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py\", line 659, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1070, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generators.degree_sequence.DegreeSequenceConfigurationModel[0]>\", line 1, in <module>\n        G = graphs.DegreeSequenceConfigurationModel([Integer(1),Integer(1)])\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/graphs/generators/degree_sequence.py\", line 177, in DegreeSequenceConfigurationModel\n        return Graph(networkx.configuration_model([int(i) for i in deg_sequence], seed=seed), loops=True, multiedges=True, sparse=True)\n      File \"<decorator-gen-154>\", line 2, in configuration_model\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/decorators.py\", line 459, in _random_state\n        random_state = create_py_random_state(random_state_arg)\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/misc.py\", line 409, in create_py_random_state\n        raise ValueError(msg % random_state)\n    ValueError: 138300676084728942938177272249092044107L cannot be used to generate a random.Random instance\n**********************************************************************\nFile \"/nix/store/9h32ccgbsdjbbiw5y9lvc338w5fbskkh-sage-src-8.4/src/sage/graphs/generators/degree_sequence.py\", line 164, in sage.graphs.generators.degree_sequence.DegreeSequenceConfigurationModel\nFailed example:\n    G = graphs.DegreeSequenceConfigurationModel([3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3])\nException raised:\n    Traceback (most recent call last):\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py\", line 659, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1070, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generators.degree_sequence.DegreeSequenceConfigurationModel[2]>\", line 1, in <module>\n        G = graphs.DegreeSequenceConfigurationModel([Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3)])\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/graphs/generators/degree_sequence.py\", line 177, in DegreeSequenceConfigurationModel\n        return Graph(networkx.configuration_model([int(i) for i in deg_sequence], seed=seed), loops=True, multiedges=True, sparse=True)\n      File \"<decorator-gen-154>\", line 2, in configuration_model\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/decorators.py\", line 459, in _random_state\n        random_state = create_py_random_state(random_state_arg)\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/misc.py\", line 409, in create_py_random_state\n        raise ValueError(msg % random_state)\n    ValueError: 41203442069597040437188274198544025403L cannot be used to generate a random.Random instance\n**********************************************************************\nFile \"/nix/store/9h32ccgbsdjbbiw5y9lvc338w5fbskkh-sage-src-8.4/src/sage/graphs/generators/degree_sequence.py\", line 221, in sage.graphs.generators.degree_sequence.DegreeSequenceExpected\nFailed example:\n    G = graphs.DegreeSequenceExpected([1,2,3,2,3])\nException raised:\n    Traceback (most recent call last):\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py\", line 659, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1070, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.generators.degree_sequence.DegreeSequenceExpected[0]>\", line 1, in <module>\n        G = graphs.DegreeSequenceExpected([Integer(1),Integer(2),Integer(3),Integer(2),Integer(3)])\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/graphs/generators/degree_sequence.py\", line 235, in DegreeSequenceExpected\n        return Graph(networkx.expected_degree_graph([int(i) for i in deg_sequence], seed=seed), loops=True)\n      File \"<decorator-gen-158>\", line 2, in expected_degree_graph\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/decorators.py\", line 459, in _random_state\n        random_state = create_py_random_state(random_state_arg)\n      File \"/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/misc.py\", line 409, in create_py_random_state\n        raise ValueError(msg % random_state)\n    ValueError: 138300676084728942938177272249092044107L cannot be used to generate a random.Random instance\n```",
    "created_at": "2018-10-27T10:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367469",
    "user": "https://github.com/timokau"
}
```

<a id='comment:20'></a>I'm still getting:

```
File "/nix/store/9h32ccgbsdjbbiw5y9lvc338w5fbskkh-sage-src-8.4/src/sage/graphs/generators/degree_sequence.py", line 153, in sage.graphs.generators.degree_sequence.DegreeSequenceConfigurationModel
Failed example:
    G = graphs.DegreeSequenceConfigurationModel([1,1])
Exception raised:
    Traceback (most recent call last):
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generators.degree_sequence.DegreeSequenceConfigurationModel[0]>", line 1, in <module>
        G = graphs.DegreeSequenceConfigurationModel([Integer(1),Integer(1)])
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/graphs/generators/degree_sequence.py", line 177, in DegreeSequenceConfigurationModel
        return Graph(networkx.configuration_model([int(i) for i in deg_sequence], seed=seed), loops=True, multiedges=True, sparse=True)
      File "<decorator-gen-154>", line 2, in configuration_model
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/decorators.py", line 459, in _random_state
        random_state = create_py_random_state(random_state_arg)
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/misc.py", line 409, in create_py_random_state
        raise ValueError(msg % random_state)
    ValueError: 138300676084728942938177272249092044107L cannot be used to generate a random.Random instance
**********************************************************************
File "/nix/store/9h32ccgbsdjbbiw5y9lvc338w5fbskkh-sage-src-8.4/src/sage/graphs/generators/degree_sequence.py", line 164, in sage.graphs.generators.degree_sequence.DegreeSequenceConfigurationModel
Failed example:
    G = graphs.DegreeSequenceConfigurationModel([3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3])
Exception raised:
    Traceback (most recent call last):
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generators.degree_sequence.DegreeSequenceConfigurationModel[2]>", line 1, in <module>
        G = graphs.DegreeSequenceConfigurationModel([Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3),Integer(3)])
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/graphs/generators/degree_sequence.py", line 177, in DegreeSequenceConfigurationModel
        return Graph(networkx.configuration_model([int(i) for i in deg_sequence], seed=seed), loops=True, multiedges=True, sparse=True)
      File "<decorator-gen-154>", line 2, in configuration_model
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/decorators.py", line 459, in _random_state
        random_state = create_py_random_state(random_state_arg)
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/misc.py", line 409, in create_py_random_state
        raise ValueError(msg % random_state)
    ValueError: 41203442069597040437188274198544025403L cannot be used to generate a random.Random instance
**********************************************************************
File "/nix/store/9h32ccgbsdjbbiw5y9lvc338w5fbskkh-sage-src-8.4/src/sage/graphs/generators/degree_sequence.py", line 221, in sage.graphs.generators.degree_sequence.DegreeSequenceExpected
Failed example:
    G = graphs.DegreeSequenceExpected([1,2,3,2,3])
Exception raised:
    Traceback (most recent call last):
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.generators.degree_sequence.DegreeSequenceExpected[0]>", line 1, in <module>
        G = graphs.DegreeSequenceExpected([Integer(1),Integer(2),Integer(3),Integer(2),Integer(3)])
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/sage/graphs/generators/degree_sequence.py", line 235, in DegreeSequenceExpected
        return Graph(networkx.expected_degree_graph([int(i) for i in deg_sequence], seed=seed), loops=True)
      File "<decorator-gen-158>", line 2, in expected_degree_graph
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/decorators.py", line 459, in _random_state
        random_state = create_py_random_state(random_state_arg)
      File "/nix/store/44zw4cgfi89wcyqg4p24yrs29hys03dj-python-2.7.15-env/lib/python2.7/site-packages/networkx/utils/misc.py", line 409, in create_py_random_state
        raise ValueError(msg % random_state)
    ValueError: 138300676084728942938177272249092044107L cannot be used to generate a random.Random instance
```



---

archive/issue_comments_367470.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-27T13:36:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367470",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367471.json:
```json
{
    "body": "<a id='comment:22'></a>Oops, my bad, i forgot that file (i remembered about two files only). Should be OK now.",
    "created_at": "2018-10-27T13:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367471",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:22'></a>Oops, my bad, i forgot that file (i remembered about two files only). Should be OK now.



---

archive/issue_comments_367472.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-12-27T22:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367472",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_367473.json:
```json
{
    "body": "<a id='comment:23'></a>Needs rebasing for 8.6.beta0",
    "created_at": "2018-12-27T22:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367473",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:23'></a>Needs rebasing for 8.6.beta0



---

archive/issue_comments_367474.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-05T11:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367474",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367475.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-05T11:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367475",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_367476.json:
```json
{
    "body": "<a id='comment:25'></a>Thanks for noticing.",
    "created_at": "2019-01-05T11:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367476",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:25'></a>Thanks for noticing.



---

archive/issue_events_065491.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/tmonteil",
    "created_at": "2019-01-05T11:58:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26326#event-65491"
}
```



---

archive/issue_comments_367477.json:
```json
{
    "body": "<a id='comment:26'></a>Note that Debian `buster` uses networkx 2.2, so i guess this should enter Sage 8.6, see https://packages.debian.org/buster/python-networkx",
    "created_at": "2019-01-05T12:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367477",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:26'></a>Note that Debian `buster` uses networkx 2.2, so i guess this should enter Sage 8.6, see https://packages.debian.org/buster/python-networkx



---

archive/issue_comments_367478.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-05T13:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367478",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_367479.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:17 embray]:\n> > I guess that they do not support long because they are going to support Python 3 only.\n\n> \n> That doesn't really make sense given that the Python 3 int type is the Python 2 long type.  Probably more likely it needs to be modulo `sys.max_size`.\n\n\nPerhaps it's the same issue as I've noticed with networkx before, and even fixed some of it. Basically, they don't quite respect the Python's numerical tower, if it's extended, say by numpy, or Sage.\nSee https://github.com/networkx/networkx/issues/2799\n\nBasically they did dispatch on types not quite right, e.g. `isinstance(foo,int)` instead of `isinstance(foo,numbers.Integral)`",
    "created_at": "2019-01-06T02:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367479",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>Replying to [comment:17 embray]:
> > I guess that they do not support long because they are going to support Python 3 only.

> 
> That doesn't really make sense given that the Python 3 int type is the Python 2 long type.  Probably more likely it needs to be modulo `sys.max_size`.


Perhaps it's the same issue as I've noticed with networkx before, and even fixed some of it. Basically, they don't quite respect the Python's numerical tower, if it's extended, say by numpy, or Sage.
See https://github.com/networkx/networkx/issues/2799

Basically they did dispatch on types not quite right, e.g. `isinstance(foo,int)` instead of `isinstance(foo,numbers.Integral)`



---

archive/issue_comments_367480.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-06T09:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367480",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_367481.json:
```json
{
    "body": "<a id='comment:29'></a>Doctests fail on 32 bit: http://build.sagemath.org/#/builders/15/builds/10/steps/9/logs/stdio",
    "created_at": "2019-01-06T09:39:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367481",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>Doctests fail on 32 bit: http://build.sagemath.org/#/builders/15/builds/10/steps/9/logs/stdio



---

archive/issue_comments_367482.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-06T22:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367483.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-06T22:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367483",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_367484.json:
```json
{
    "body": "<a id='comment:32'></a>lets give it a try",
    "created_at": "2019-01-06T23:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367484",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:32'></a>lets give it a try



---

archive/issue_comments_367485.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-06T23:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367485",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_367486.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-10T10:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367486",
    "user": "https://github.com/fchapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_367487.json:
```json
{
    "body": "<a id='comment:33'></a>on python3:\n\n```\n----> 1 sys.maxint\n\nAttributeError: module 'sys' has no attribute 'maxint'\n```\n\n**EDIT**:\n\nsys.maxsize is the correct replacement, I think\n\nhttps://stackoverflow.com/questions/13795758/what-is-sys-maxint-in-python-3",
    "created_at": "2019-01-10T10:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367487",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:33'></a>on python3:

```
----> 1 sys.maxint

AttributeError: module 'sys' has no attribute 'maxint'
```

**EDIT**:

sys.maxsize is the correct replacement, I think

https://stackoverflow.com/questions/13795758/what-is-sys-maxint-in-python-3



---

archive/issue_comments_367488.json:
```json
{
    "body": "<a id='comment:34'></a>that's right, sys.maxsize works for py3 and py2. Who's going to update this?",
    "created_at": "2019-01-10T10:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367488",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>that's right, sys.maxsize works for py3 and py2. Who's going to update this?



---

archive/issue_comments_367489.json:
```json
{
    "body": "<a id='comment:35'></a>New commits:",
    "created_at": "2019-01-10T11:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367489",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>New commits:



---

archive/issue_comments_367490.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-10T11:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367490",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_367491.json:
```json
{
    "body": "<a id='comment:36'></a>tests pass on py2. \n\nOn py3 there are 6 different formatting/ordering-induced test failures in ` src/sage/graphs/generators/random.py`. I suppose this is for another ticket.",
    "created_at": "2019-01-10T12:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367491",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>tests pass on py2. 

On py3 there are 6 different formatting/ordering-induced test failures in ` src/sage/graphs/generators/random.py`. I suppose this is for another ticket.



---

archive/issue_comments_367492.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-10T12:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367492",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_367493.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-10T17:26:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367493",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065492.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-10T17:26:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26326#event-65492"
}
```



---

archive/issue_comments_367494.json:
```json
{
    "body": "<a id='comment:38'></a>This breaks building with `SAGE_CHECK=\"yes\"`, see #27253.",
    "created_at": "2019-02-10T22:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26326",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26326#issuecomment-367494",
    "user": "https://github.com/Konrad127123"
}
```

<a id='comment:38'></a>This breaks building with `SAGE_CHECK="yes"`, see #27253.
