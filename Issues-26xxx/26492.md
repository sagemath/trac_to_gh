# Issue 26492: symbolic constant e reverses relations

archive/issues_026255.json:
```json
{
    "body": "As discussed on [this ask question](https://ask.sagemath.org/question/43946/desolve-initial-condition-involving-e-gives-strange-answer/):\n\n```\nsage: x == e\ne == x\nsage: x > e\ne < x\nsage: x <= e\ne >= x\n```\n\nNote that it only happens with `e`, this constant is handled in the dedicated `SAGE_ROOT/src/sage/symbolic/constants_c.pyx`.\n\nThis does not happen with the symbolic expression `e`:\n\n```\nsage: x == e*1\nx == e\nsage: x > e*1\nx > e\nsage: x <= e*1\nx <= e\n```\n\n\nCC:  @rwst\n\nDependencies: #18077\n\nIssue created by migration from https://trac.sagemath.org/ticket/26492\n\n",
    "created_at": "2018-10-15T13:12:00Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "symbolic constant e reverses relations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26492",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
As discussed on [this ask question](https://ask.sagemath.org/question/43946/desolve-initial-condition-involving-e-gives-strange-answer/):

```
sage: x == e
e == x
sage: x > e
e < x
sage: x <= e
e >= x
```

Note that it only happens with `e`, this constant is handled in the dedicated `SAGE_ROOT/src/sage/symbolic/constants_c.pyx`.

This does not happen with the symbolic expression `e`:

```
sage: x == e*1
x == e
sage: x > e*1
x > e
sage: x <= e*1
x <= e
```


CC:  @rwst

Dependencies: #18077

Issue created by migration from https://trac.sagemath.org/ticket/26492





---

archive/issue_comments_369531.json:
```json
{
    "body": "<a id='comment:2'></a>The reason is that `constant_E` is a subclass. When Python sees `a < b` where `type(b)` is a strict subclass of `type(a)`, it instead evaluates `b > a`.\n\nSo this gives us basically the following options:\n\n1. Consider this not a bug and move on.\n\n2. Ensure that `type(e)` is the same as `type(x)`.\n\n3. Ensure that `type(e)` and `type(x)` are both subtypes of a common subclass.",
    "created_at": "2018-10-16T10:22:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26492#issuecomment-369531",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>The reason is that `constant_E` is a subclass. When Python sees `a < b` where `type(b)` is a strict subclass of `type(a)`, it instead evaluates `b > a`.

So this gives us basically the following options:

1. Consider this not a bug and move on.

2. Ensure that `type(e)` is the same as `type(x)`.

3. Ensure that `type(e)` and `type(x)` are both subtypes of a common subclass.



---

archive/issue_comments_369532.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 jdemeyer]:\n> The reason is that `constant_E` is a subclass. When Python sees `a < b` where `type(b)` is a strict subclass of `type(a)`, it instead evaluates `b > a`.\n\n\nAha, so it is at the Python level, thanks for the hint, i could not find the explanation within Sage source code.\n\n> So this gives us basically the following options:\n> \n> 1. Consider this not a bug and move on.\n\n\nThe problem comes from #26490, so in this case, we should do more parsing to replace lines such as `tempic=tempic+\",\"+(dvar==ics[1])._maxima_().str()` to something that hardcodes maxima's \"=\" symbol. Also, from a user perspective, one could program something with `rhs` and `lhs` and  get confused when such unexpected case appears.\n\n> 2. Ensure that `type(e)` is the same as `type(x)`.\n\n\nWould replacing\n\n```\ne = E()\n```\n\nwith\n\n```\ne = E() * 1\n```\n\nin `SAGE_ROOT/src/sage/symbolic/constants.py` be considered as a correct fix ?\n\n> 3. Ensure that `type(e)` and `type(x)` are both subtypes of a common subclass.",
    "created_at": "2018-10-16T16:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26492#issuecomment-369532",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:3'></a>Replying to [comment:2 jdemeyer]:
> The reason is that `constant_E` is a subclass. When Python sees `a < b` where `type(b)` is a strict subclass of `type(a)`, it instead evaluates `b > a`.


Aha, so it is at the Python level, thanks for the hint, i could not find the explanation within Sage source code.

> So this gives us basically the following options:
> 
> 1. Consider this not a bug and move on.


The problem comes from #26490, so in this case, we should do more parsing to replace lines such as `tempic=tempic+","+(dvar==ics[1])._maxima_().str()` to something that hardcodes maxima's "=" symbol. Also, from a user perspective, one could program something with `rhs` and `lhs` and  get confused when such unexpected case appears.

> 2. Ensure that `type(e)` is the same as `type(x)`.


Would replacing

```
e = E()
```

with

```
e = E() * 1
```

in `SAGE_ROOT/src/sage/symbolic/constants.py` be considered as a correct fix ?

> 3. Ensure that `type(e)` and `type(x)` are both subtypes of a common subclass.



---

archive/issue_comments_369533.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 tmonteil]:\n> Would replacing\n> \n> \n> ```\n> e = E()\n> ```\n> \n> with\n> \n> \n> ```\n> e = E() * 1\n> ```\n> \n> in `SAGE_ROOT/src/sage/symbolic/constants.py` be considered as a correct fix ?\n\n\nIf you want to do that, then why do we need the `constant_E` class in the first place? My guess is that it's mainly for documentation, such that `e?` gives information about `e` as opposed to generic expressions.",
    "created_at": "2018-10-16T18:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26492#issuecomment-369533",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Replying to [comment:3 tmonteil]:
> Would replacing
> 
> 
> ```
> e = E()
> ```
> 
> with
> 
> 
> ```
> e = E() * 1
> ```
> 
> in `SAGE_ROOT/src/sage/symbolic/constants.py` be considered as a correct fix ?


If you want to do that, then why do we need the `constant_E` class in the first place? My guess is that it's mainly for documentation, such that `e?` gives information about `e` as opposed to generic expressions.



---

archive/issue_comments_369534.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:3 tmonteil]:\n> Aha, so it is at the Python level, thanks for the hint, i could not find the explanation within Sage source code.\n\n\nTo elaborate on this: for arithmetic operators like `__add__`, there is a reversed version like `__radd__`. But the reversed version of `__le__` is just `__gt__`. So user code cannot make a difference between `a < b` and `b > a`.",
    "created_at": "2018-10-16T18:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26492",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26492#issuecomment-369534",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>Replying to [comment:3 tmonteil]:
> Aha, so it is at the Python level, thanks for the hint, i could not find the explanation within Sage source code.


To elaborate on this: for arithmetic operators like `__add__`, there is a reversed version like `__radd__`. But the reversed version of `__le__` is just `__gt__`. So user code cannot make a difference between `a < b` and `b > a`.
