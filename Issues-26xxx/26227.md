# Issue 26227: Make search_doc independent of sage_setup

archive/issues_025990.json:
```json
{
    "assignees": [],
    "body": "search_doc currently imports stuff from sage_setup, which shouldn't be needed by sage at runtime. It also relies on the sage doc source to be present, which is not necessarily true for distro packages.\nThis patch replaces the current exhaustive check that all translated docs have been built by a simple check that $SAGE_DOC/html exists.\n\nCC:  @timokau @kiwifb @saraedum\n\nKeywords: **packaging**\n\nBranch/Commit: **[`b3abf9c`](https://github.com/sagemath/sagetrac-mirror/commit/b3abf9cc455f02c4d7b11244a863e6eb4fa607c7)**\n\nReviewer: **Fran\u00e7ois Bissey**\n\nAuthor: **Antonio Rojas**\n\nComponent: **documentation**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26227_\n\n",
    "closed_at": "2018-09-23T19:34:12Z",
    "created_at": "2018-09-08T18:12:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20documentation",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make search_doc independent of sage_setup",
    "type": "issue",
    "updated_at": "2023-01-08T10:42:18Z",
    "url": "https://github.com/sagemath/sage/issues/26227",
    "user": "https://github.com/antonio-rojas"
}
```
search_doc currently imports stuff from sage_setup, which shouldn't be needed by sage at runtime. It also relies on the sage doc source to be present, which is not necessarily true for distro packages.
This patch replaces the current exhaustive check that all translated docs have been built by a simple check that $SAGE_DOC/html exists.

CC:  @timokau @kiwifb @saraedum

Keywords: **packaging**

Branch/Commit: **[`b3abf9c`](https://github.com/sagemath/sagetrac-mirror/commit/b3abf9cc455f02c4d7b11244a863e6eb4fa607c7)**

Reviewer: **Fran√ßois Bissey**

Author: **Antonio Rojas**

Component: **documentation**

_Issue created by migration from https://trac.sagemath.org/ticket/26227_





---

archive/issue_events_358656.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2018-09-08T18:12:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358656"
}
```



---

archive/issue_events_358657.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2018-09-08T18:12:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358657"
}
```



---

archive/issue_comments_404198.json:
```json
{
    "body": "Branch: **[u/arojas/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_search_doc_independent_of_sage_setup)**",
    "created_at": "2018-09-08T18:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404198",
    "user": "https://github.com/antonio-rojas"
}
```

Branch: **[u/arojas/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_search_doc_independent_of_sage_setup)**



---

archive/issue_comments_404199.json:
```json
{
    "body": "Changed keywords from none to **packaging**",
    "created_at": "2018-09-08T18:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404199",
    "user": "https://github.com/antonio-rojas"
}
```

Changed keywords from none to **packaging**



---

archive/issue_events_358658.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2018-09-08T18:21:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20documentation",
    "label_color": "0075ca",
    "label_name": "c: documentation",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358658"
}
```



---

archive/issue_comments_404200.json:
```json
{
    "body": "Commit: **[`86c3afb`](https://github.com/sagemath/sagetrac-mirror/commit/86c3afbcfa4f004c527aea9fafd6d0efd4a858d5)**",
    "created_at": "2018-09-08T18:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404200",
    "user": "https://github.com/antonio-rojas"
}
```

Commit: **[`86c3afb`](https://github.com/sagemath/sagetrac-mirror/commit/86c3afbcfa4f004c527aea9fafd6d0efd4a858d5)**



---

archive/issue_comments_404201.json:
```json
{
    "body": "Author: **Antonio Rojas**",
    "created_at": "2018-09-08T18:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404201",
    "user": "https://github.com/antonio-rojas"
}
```

Author: **Antonio Rojas**



---

archive/issue_comments_404202.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,2 @@\n-\n+search_doc currently imports stuff from sage_setup, which shouldn't be needed by sage at runtime.\n+This patch defines the necessary variables directly so that search_doc works when sage_setup is not installed.\n``````\n",
    "created_at": "2018-09-08T18:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404202",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,2 @@
-
+search_doc currently imports stuff from sage_setup, which shouldn't be needed by sage at runtime.
+This patch defines the necessary variables directly so that search_doc works when sage_setup is not installed.
``````




---

archive/issue_events_358659.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2018-09-08T18:21:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358659"
}
```



---

archive/issue_comments_404203.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86c3afbcfa4f004c527aea9fafd6d0efd4a858d5\"><code>86c3afb</code></a></td><td><code>Make search_doc work if sage_setup is not installed</code></td></tr></table>\n",
    "created_at": "2018-09-08T18:21:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404203",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86c3afbcfa4f004c527aea9fafd6d0efd4a858d5"><code>86c3afb</code></a></td><td><code>Make search_doc work if sage_setup is not installed</code></td></tr></table>




---

archive/issue_comments_404204.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks for copying me. Those bits are a part of something I just remove from sage https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage/files/sage-8.4-sagedoc.patch . I wonder if it is time for it to disappear in sage proper too.\n\nWhy do I remove that bit? This check at runtime that the documentation has been built - it may have been helpful at some point during  early sage development but I don't believe it should still be the case. Furthermore, this effectively depends on the presence (fake or real) of sage's documentation source. And of course we disapprove of that in distro. Finally if the search fails, it suggests you do stuff that is not supported for user on a distro (`sage -docbuild`).",
    "created_at": "2018-09-08T19:13:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404204",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks for copying me. Those bits are a part of something I just remove from sage https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage/files/sage-8.4-sagedoc.patch . I wonder if it is time for it to disappear in sage proper too.

Why do I remove that bit? This check at runtime that the documentation has been built - it may have been helpful at some point during  early sage development but I don't believe it should still be the case. Furthermore, this effectively depends on the presence (fake or real) of sage's documentation source. And of course we disapprove of that in distro. Finally if the search fails, it suggests you do stuff that is not supported for user on a distro (`sage -docbuild`).



---

archive/issue_comments_404205.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIt would be great to get rid of all that code, yes. If devs agree to that I'll happily withdraw this.",
    "created_at": "2018-09-09T13:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404205",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:4" align="right">comment:4</div>

It would be great to get rid of all that code, yes. If devs agree to that I'll happily withdraw this.



---

archive/issue_comments_404206.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\n@kiwifb: Is there some good way of detecting whether you are on a distro, and then conditionally evaluate the code? My view has been for a long time that a Sage installation (any software installation, really) is not complete without documentation, so I want some sort of check. (I don't think you're advocating removing that big chunk of code always, just in your distro, but if we can make things work for both settings, why not?) Can we set some environment variable, or touch some file, or do something else to indicate that it's a distro and not a from-source or from-binary installation?\n\n@antonio-rojas: By the way, an alternative to the branch here: rather than to duplicate code and variable definitions from sage_setup.docbuild, is to define the relevant variables in sage.misc.sagedoc or sage.env, and then import them in sage_setup.docbuild. Duplication is usually a bad idea: harder to maintain and harder to diagnose problems. (sage_setup.docbuild already has some imports from the Sage library.)",
    "created_at": "2018-09-09T17:38:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404206",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

@kiwifb: Is there some good way of detecting whether you are on a distro, and then conditionally evaluate the code? My view has been for a long time that a Sage installation (any software installation, really) is not complete without documentation, so I want some sort of check. (I don't think you're advocating removing that big chunk of code always, just in your distro, but if we can make things work for both settings, why not?) Can we set some environment variable, or touch some file, or do something else to indicate that it's a distro and not a from-source or from-binary installation?

@antonio-rojas: By the way, an alternative to the branch here: rather than to duplicate code and variable definitions from sage_setup.docbuild, is to define the relevant variables in sage.misc.sagedoc or sage.env, and then import them in sage_setup.docbuild. Duplication is usually a bad idea: harder to maintain and harder to diagnose problems. (sage_setup.docbuild already has some imports from the Sage library.)



---

archive/issue_comments_404207.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI understand the concern about the documentation (or at least some documentation - in sage-on-gentoo I allow for some language selection with the caveat that only english is complete). The code is useful for someone writing new code with the associated documentation but it is difficult to justify it at runtime for everyone.\n\nThere no current way to say we are a distro, although we could come up with one :)\n\nOverall I think the concern that documentation is present could be checked by a doctest rather than anytime you do a search. I am OK for sage's source code to be referenced during a doctest.",
    "created_at": "2018-09-09T19:11:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404207",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:6" align="right">comment:6</div>

I understand the concern about the documentation (or at least some documentation - in sage-on-gentoo I allow for some language selection with the caveat that only english is complete). The code is useful for someone writing new code with the associated documentation but it is difficult to justify it at runtime for everyone.

There no current way to say we are a distro, although we could come up with one :)

Overall I think the concern that documentation is present could be checked by a doctest rather than anytime you do a search. I am OK for sage's source code to be referenced during a doctest.



---

archive/issue_comments_404208.json:
```json
{
    "body": "Changed branch from **[u/arojas/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_search_doc_independent_of_sage_setup)** to **[u/jhpalmieri/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/make_search_doc_independent_of_sage_setup)**",
    "created_at": "2018-09-10T00:00:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404208",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/arojas/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_search_doc_independent_of_sage_setup)** to **[u/jhpalmieri/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/make_search_doc_independent_of_sage_setup)**



---

archive/issue_comments_404209.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOkay, how about something like this? I tried to write it so it would work if `SAGE_DOC_SRC` is missing or if `sage_setup` is missing. The doctests are marked 'optional - dochtml'. I also added doctests so that we find out when the hardcoded lists of languages and documents become outdated (when building with access to the full Sage source code).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41bc9de9cc5e6407e770fc84414674135b691b39\"><code>41bc9de</code></a></td><td><code>trac 26227: do not check whether the documentation exists every time</code></td></tr></table>\n",
    "created_at": "2018-09-10T00:01:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404209",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Okay, how about something like this? I tried to write it so it would work if `SAGE_DOC_SRC` is missing or if `sage_setup` is missing. The doctests are marked 'optional - dochtml'. I also added doctests so that we find out when the hardcoded lists of languages and documents become outdated (when building with access to the full Sage source code).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41bc9de9cc5e6407e770fc84414674135b691b39"><code>41bc9de</code></a></td><td><code>trac 26227: do not check whether the documentation exists every time</code></td></tr></table>




---

archive/issue_comments_404210.json:
```json
{
    "body": "Changed commit from **[`86c3afb`](https://github.com/sagemath/sagetrac-mirror/commit/86c3afbcfa4f004c527aea9fafd6d0efd4a858d5)** to **[`41bc9de`](https://github.com/sagemath/sagetrac-mirror/commit/41bc9de9cc5e6407e770fc84414674135b691b39)**",
    "created_at": "2018-09-10T00:01:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404210",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[`86c3afb`](https://github.com/sagemath/sagetrac-mirror/commit/86c3afbcfa4f004c527aea9fafd6d0efd4a858d5)** to **[`41bc9de`](https://github.com/sagemath/sagetrac-mirror/commit/41bc9de9cc5e6407e770fc84414674135b691b39)**



---

archive/issue_comments_404211.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI am not too crazy about it, I'd like other people opinions and some reflection time before completely dismissing the approach. But my first reaction is as follow\n* I don't like `HARDCODED*` variables in particular documents.\n* Of course it make sense have it tagged `dochtml` - good thinking.\n* In sage-on-gentoo I allow installing a subset of languages (with english being compulsory if you build/install documentation at all) I am not liking the idea of a doctest failing because I don't have languages that are not relevant to me. I guess that's why I don't like `HARDCODED_DOCUMENTS`, but I could live with that.\n\nI guess more generally I didn't think doctesting that some or all documentation has been built/installed would need that much machinery that in turn needs its own problematic doctests. Is the added complexity worth it?\n\nBut thank you for showing what you think it should look like.",
    "created_at": "2018-09-10T00:20:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404211",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">comment:9</div>

I am not too crazy about it, I'd like other people opinions and some reflection time before completely dismissing the approach. But my first reaction is as follow
* I don't like `HARDCODED*` variables in particular documents.
* Of course it make sense have it tagged `dochtml` - good thinking.
* In sage-on-gentoo I allow installing a subset of languages (with english being compulsory if you build/install documentation at all) I am not liking the idea of a doctest failing because I don't have languages that are not relevant to me. I guess that's why I don't like `HARDCODED_DOCUMENTS`, but I could live with that.

I guess more generally I didn't think doctesting that some or all documentation has been built/installed would need that much machinery that in turn needs its own problematic doctests. Is the added complexity worth it?

But thank you for showing what you think it should look like.



---

archive/issue_comments_404212.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSome more thoughts.\n \nUsing sources at runtime is forbidden but testing is ideally run before install time and certainly before packaging for binary distro. We don't expect users installing binary packages to be able to run the test suite. Apart from some rare cases it is just not present to be run anyway.\n\nSo relying on SAGE_DOC_SRC at testing is fine. Nevertheless there is a general feeling that the list of language may belong to env.py rather than somewhere in sage_setup. Something more satisfactory could be constructed there.\n\nThere are many moving parts and I am considering giving it a shot from the current branch and some thinking time.",
    "created_at": "2018-09-10T00:32:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404212",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:10" align="right">comment:10</div>

Some more thoughts.
 
Using sources at runtime is forbidden but testing is ideally run before install time and certainly before packaging for binary distro. We don't expect users installing binary packages to be able to run the test suite. Apart from some rare cases it is just not present to be run anyway.

So relying on SAGE_DOC_SRC at testing is fine. Nevertheless there is a general feeling that the list of language may belong to env.py rather than somewhere in sage_setup. Something more satisfactory could be constructed there.

There are many moving parts and I am considering giving it a shot from the current branch and some thinking time.



---

archive/issue_comments_404213.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nPing to other distro guys, do you have a definition for `SAGE_DOC_SRC` in `sage/env.py` for your distro. If you do what is it? In sage-on-gentoo SAGE_DOC_SRC=SAGE_DOC at runtime (but not at build time obviously).",
    "created_at": "2018-09-10T00:37:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404213",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:11" align="right">comment:11</div>

Ping to other distro guys, do you have a definition for `SAGE_DOC_SRC` in `sage/env.py` for your distro. If you do what is it? In sage-on-gentoo SAGE_DOC_SRC=SAGE_DOC at runtime (but not at build time obviously).



---

archive/issue_comments_404214.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@kiwifb](#comment%3A9):\n> I guess more generally I didn't think doctesting that some or all documentation has been built/installed would need that much machinery that in turn needs its own problematic doctests. Is the added complexity worth it?\n\nTo really test whether the built documentation is present, you need access to `SAGE_DOC_SRC` and `sage_setup` to compile the lists of languages and documents. So if the doctests should pass without access to those, you need\n\n- sensible versions of the variables,\n- and a way to detect when those sensible versions are no longer sensible (because someone has translated the tutorial to Arabic, for example).\n\nIf you don't care about doctests passing, or if you only care about doctests passing if you have intact `SAGE_DOC_SRC` and `sage_setup`, then it doesn't need to be as complicated. (References to `sage_setup` could be avoided, but I think you need `SAGE_DOC_SRC`.) Since some people want to distribute Sage without any built documentation and have it pass doctests, I don't know what is reasonable to require for doctests to pass. Maybe that's where the discussion should start: under what circumstances should doctests pass?\n\nDoes it at least make sense to have a separate function (as in my branch) that just tests whether the documentation is built, along with a doctest?",
    "created_at": "2018-09-10T01:10:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404214",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@kiwifb](#comment%3A9):
> I guess more generally I didn't think doctesting that some or all documentation has been built/installed would need that much machinery that in turn needs its own problematic doctests. Is the added complexity worth it?

To really test whether the built documentation is present, you need access to `SAGE_DOC_SRC` and `sage_setup` to compile the lists of languages and documents. So if the doctests should pass without access to those, you need

- sensible versions of the variables,
- and a way to detect when those sensible versions are no longer sensible (because someone has translated the tutorial to Arabic, for example).

If you don't care about doctests passing, or if you only care about doctests passing if you have intact `SAGE_DOC_SRC` and `sage_setup`, then it doesn't need to be as complicated. (References to `sage_setup` could be avoided, but I think you need `SAGE_DOC_SRC`.) Since some people want to distribute Sage without any built documentation and have it pass doctests, I don't know what is reasonable to require for doctests to pass. Maybe that's where the discussion should start: under what circumstances should doctests pass?

Does it at least make sense to have a separate function (as in my branch) that just tests whether the documentation is built, along with a doctest?



---

archive/issue_comments_404215.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jhpalmieri](#comment%3A12):\n> Replying to [@kiwifb](#comment%3A9):\n> > I guess more generally I didn't think doctesting that some or all documentation has been built/installed would need that much machinery that in turn needs its own problematic doctests. Is the added complexity worth it?\n\n> \n> To really test whether the built documentation is present, you need access to `SAGE_DOC_SRC` and `sage_setup` to compile the lists of languages and documents. So if the doctests should pass without access to those, you need\n> \n> - sensible versions of the variables,\n> - and a way to detect when those sensible versions are no longer sensible (because someone has translated the tutorial to Arabic, for example).\n> \n\nYes.\n\n> If you don't care about doctests passing, or if you only care about doctests passing if you have intact `SAGE_DOC_SRC` and `sage_setup`, then it doesn't need to be as complicated. (References to `sage_setup` could be avoided, but I think you need `SAGE_DOC_SRC`.) Since some people want to distribute Sage without any built documentation and have it pass doctests, I don't know what is reasonable to require for doctests to pass. Maybe that's where the discussion should start: under what circumstances should doctests pass?\n> \n\nI must say I am puzzled by my colleagues insisting the tests should pass without the doc. I guess technically I have it run OK with just some languages of the documentation but I was not expecting it to pass with none. But having the ability to test the html documentation separately is not absurd. I agree you should at least have \"something that look like SAGE_DOC_SRC\". Again, like I said using sources for testing purposes is OK.\n\n> Does it at least make sense to have a separate function (as in my branch) that just tests whether the documentation is built, along with a doctest?\n\nYes, I hadn't gone as far as thinking of a new function when I brought you the idea of doctesting but it make sense for it to exist and to be the thing tested. The only issue I may have is: \"is it useful to have this available at runtime?\" Which then turns into where is it appropriate to put this.",
    "created_at": "2018-09-10T01:23:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404215",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jhpalmieri](#comment%3A12):
> Replying to [@kiwifb](#comment%3A9):
> > I guess more generally I didn't think doctesting that some or all documentation has been built/installed would need that much machinery that in turn needs its own problematic doctests. Is the added complexity worth it?

> 
> To really test whether the built documentation is present, you need access to `SAGE_DOC_SRC` and `sage_setup` to compile the lists of languages and documents. So if the doctests should pass without access to those, you need
> 
> - sensible versions of the variables,
> - and a way to detect when those sensible versions are no longer sensible (because someone has translated the tutorial to Arabic, for example).
> 

Yes.

> If you don't care about doctests passing, or if you only care about doctests passing if you have intact `SAGE_DOC_SRC` and `sage_setup`, then it doesn't need to be as complicated. (References to `sage_setup` could be avoided, but I think you need `SAGE_DOC_SRC`.) Since some people want to distribute Sage without any built documentation and have it pass doctests, I don't know what is reasonable to require for doctests to pass. Maybe that's where the discussion should start: under what circumstances should doctests pass?
> 

I must say I am puzzled by my colleagues insisting the tests should pass without the doc. I guess technically I have it run OK with just some languages of the documentation but I was not expecting it to pass with none. But having the ability to test the html documentation separately is not absurd. I agree you should at least have "something that look like SAGE_DOC_SRC". Again, like I said using sources for testing purposes is OK.

> Does it at least make sense to have a separate function (as in my branch) that just tests whether the documentation is built, along with a doctest?

Yes, I hadn't gone as far as thinking of a new function when I brought you the idea of doctesting but it make sense for it to exist and to be the thing tested. The only issue I may have is: "is it useful to have this available at runtime?" Which then turns into where is it appropriate to put this.



---

archive/issue_comments_404216.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAnd if it is not needed at runtime, my reaction is to shove it into sage_setup.",
    "created_at": "2018-09-10T01:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404216",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:14" align="right">comment:14</div>

And if it is not needed at runtime, my reaction is to shove it into sage_setup.



---

archive/issue_comments_404217.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@kiwifb](#comment%3A10):\n> Some more thoughts.\n>  \n> Using sources at runtime is forbidden but testing is ideally run before install time and certainly before packaging for binary distro. We don't expect users installing binary packages to be able to run the test suite. Apart from some rare cases it is just not present to be run anyway.\n\nI don't agree with this. Binary packages have a different folder structure than the one in sage-the-distribution and it's important to make sure that everything works as intended, and the way to check that is by running the test suite, and it needs to be done when the package is installed and the source files are no longer available. This helps detecting runtime dependencies on source files that should be removed, and can't be detected by running the test suite on sage-the-distribution.",
    "created_at": "2018-09-10T20:30:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404217",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@kiwifb](#comment%3A10):
> Some more thoughts.
>  
> Using sources at runtime is forbidden but testing is ideally run before install time and certainly before packaging for binary distro. We don't expect users installing binary packages to be able to run the test suite. Apart from some rare cases it is just not present to be run anyway.

I don't agree with this. Binary packages have a different folder structure than the one in sage-the-distribution and it's important to make sure that everything works as intended, and the way to check that is by running the test suite, and it needs to be done when the package is installed and the source files are no longer available. This helps detecting runtime dependencies on source files that should be removed, and can't be detected by running the test suite on sage-the-distribution.



---

archive/issue_comments_404218.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\n- Should there be a doctest to test whether the documentation has been built? If I am installing Sage myself, I know whether I tried to build the docs, and if I did, then I know whether it succeeded. So people who build from source or use a Sage binary don't need this doctest. What about for distros? If we want such a doctest, should it be in `sage_setup` or the main Sage library? If in the main Sage library, can it assume that `sage_setup` and `SAGE_DOC_SRC` are intact?\n\n- If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?",
    "created_at": "2018-09-10T20:42:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404218",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

- Should there be a doctest to test whether the documentation has been built? If I am installing Sage myself, I know whether I tried to build the docs, and if I did, then I know whether it succeeded. So people who build from source or use a Sage binary don't need this doctest. What about for distros? If we want such a doctest, should it be in `sage_setup` or the main Sage library? If in the main Sage library, can it assume that `sage_setup` and `SAGE_DOC_SRC` are intact?

- If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?



---

archive/issue_comments_404219.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jhpalmieri](#comment%3A16):\n> - Should there be a doctest to test whether the documentation has been built? If I am installing Sage myself, I know whether I tried to build the docs, and if I did, then I know whether it succeeded. \n\nThe same applies to packagers who build distro packages, so I don't see why that case should be treated differently.\n\n> - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?\n\nWe ship docs as a separate, optional package, so such a warning would be quite useful.",
    "created_at": "2018-09-10T20:50:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404219",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jhpalmieri](#comment%3A16):
> - Should there be a doctest to test whether the documentation has been built? If I am installing Sage myself, I know whether I tried to build the docs, and if I did, then I know whether it succeeded. 

The same applies to packagers who build distro packages, so I don't see why that case should be treated differently.

> - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?

We ship docs as a separate, optional package, so such a warning would be quite useful.



---

archive/issue_comments_404220.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@antonio-rojas](#comment%3A15):\n> Replying to [@kiwifb](#comment%3A10):\n> > Some more thoughts.\n> >  \n> > Using sources at runtime is forbidden but testing is ideally run before install time and certainly before packaging for binary distro. We don't expect users installing binary packages to be able to run the test suite. Apart from some rare cases it is just not present to be run anyway.\n\n> \n> I don't agree with this. Binary packages have a different folder structure than the one in sage-the-distribution and it's important to make sure that everything works as intended, and the way to check that is by running the test suite, and it needs to be done when the package is installed and the source files are no longer available. This helps detecting runtime dependencies on source files that should be removed, and can't be detected by running the test suite on sage-the-distribution.\n\nI agree with arojas. I think testing is ideally run *after* install time, under identical conditions as if the package was installed on a users machine. Because that is what we want to test: That sage is fully functional for a user. What does it help when sage works after build but may break after installation?\n\nI personally just ship the sage source code. Why do you not want to do that? The only negative I see is the disk space, which is not *that* much.",
    "created_at": "2018-09-10T21:05:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404220",
    "user": "https://github.com/timokau"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@antonio-rojas](#comment%3A15):
> Replying to [@kiwifb](#comment%3A10):
> > Some more thoughts.
> >  
> > Using sources at runtime is forbidden but testing is ideally run before install time and certainly before packaging for binary distro. We don't expect users installing binary packages to be able to run the test suite. Apart from some rare cases it is just not present to be run anyway.

> 
> I don't agree with this. Binary packages have a different folder structure than the one in sage-the-distribution and it's important to make sure that everything works as intended, and the way to check that is by running the test suite, and it needs to be done when the package is installed and the source files are no longer available. This helps detecting runtime dependencies on source files that should be removed, and can't be detected by running the test suite on sage-the-distribution.

I agree with arojas. I think testing is ideally run *after* install time, under identical conditions as if the package was installed on a users machine. Because that is what we want to test: That sage is fully functional for a user. What does it help when sage works after build but may break after installation?

I personally just ship the sage source code. Why do you not want to do that? The only negative I see is the disk space, which is not *that* much.



---

archive/issue_comments_404221.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@antonio-rojas](#comment%3A17):\n> > - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?\n\n> \n> We ship docs as a separate, optional package, so such a warning would be quite useful.\n\nDoes your main distribution include `SAGE_DOC_SRC`? If not, how can you meaningfully measure whether the documentation is present? My branch tries to address this; is it overkill?",
    "created_at": "2018-09-10T21:08:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404221",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@antonio-rojas](#comment%3A17):
> > - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?

> 
> We ship docs as a separate, optional package, so such a warning would be quite useful.

Does your main distribution include `SAGE_DOC_SRC`? If not, how can you meaningfully measure whether the documentation is present? My branch tries to address this; is it overkill?



---

archive/issue_comments_404222.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@jhpalmieri](#comment%3A16):\n> - Should there be a doctest to test whether the documentation has been built? If I am installing Sage myself, I know whether I tried to build the docs, and if I did, then I know whether it succeeded. So people who build from source or use a Sage binary don't need this doctest. What about for distros? If we want such a doctest, should it be in `sage_setup` or the main Sage library? If in the main Sage library, can it assume that `sage_setup` and `SAGE_DOC_SRC` are intact?\n\nI think a doctest that makes sure sage can find its documentation is very valuable. However it shouldn't be mandatory to build sage. That is why I originally introduced `optional - dochtml`. Currently I'm building sage without docs and then testing it without `dochtml`. I then build the docs seperately and run only the `dochtml` tests for that. Users can decide weather or not to install the docs. Unfortunately, that will be somewhat undermined by [this change](https://github.com/sagemath/sage/issues/26110#comment:15).\n\n> - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?\n\nThat would be nice.",
    "created_at": "2018-09-10T21:09:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404222",
    "user": "https://github.com/timokau"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@jhpalmieri](#comment%3A16):
> - Should there be a doctest to test whether the documentation has been built? If I am installing Sage myself, I know whether I tried to build the docs, and if I did, then I know whether it succeeded. So people who build from source or use a Sage binary don't need this doctest. What about for distros? If we want such a doctest, should it be in `sage_setup` or the main Sage library? If in the main Sage library, can it assume that `sage_setup` and `SAGE_DOC_SRC` are intact?

I think a doctest that makes sure sage can find its documentation is very valuable. However it shouldn't be mandatory to build sage. That is why I originally introduced `optional - dochtml`. Currently I'm building sage without docs and then testing it without `dochtml`. I then build the docs seperately and run only the `dochtml` tests for that. Users can decide weather or not to install the docs. Unfortunately, that will be somewhat undermined by [this change](https://github.com/sagemath/sage/issues/26110#comment:15).

> - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?

That would be nice.



---

archive/issue_comments_404223.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@jhpalmieri](#comment%3A19):\n> Replying to [@antonio-rojas](#comment%3A17):\n> > > - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?\n\n> > \n> > We ship docs as a separate, optional package, so such a warning would be quite useful.\n\n> \n> Does your main distribution include `SAGE_DOC_SRC`? If not, how can you meaningfully measure whether the documentation is present? My branch tries to address this; is it overkill?\n\nI ship two packages: `sage` and `sageWithDoc`. The second one is just a wrapper around `sage` that sets `SAGE_DOC_SRC`.",
    "created_at": "2018-09-10T21:10:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404223",
    "user": "https://github.com/timokau"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@jhpalmieri](#comment%3A19):
> Replying to [@antonio-rojas](#comment%3A17):
> > > - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?

> > 
> > We ship docs as a separate, optional package, so such a warning would be quite useful.

> 
> Does your main distribution include `SAGE_DOC_SRC`? If not, how can you meaningfully measure whether the documentation is present? My branch tries to address this; is it overkill?

I ship two packages: `sage` and `sageWithDoc`. The second one is just a wrapper around `sage` that sets `SAGE_DOC_SRC`.



---

archive/issue_comments_404224.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jhpalmieri](#comment%3A19):\n> Replying to [@antonio-rojas](#comment%3A17):\n> > > - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?\n\n> > \n> > We ship docs as a separate, optional package, so such a warning would be quite useful.\n\n> \n> Does your main distribution include `SAGE_DOC_SRC`? If not, how can you meaningfully measure whether the documentation is present? My branch tries to address this; is it overkill?\n\nWe do define SAGE_DOC_SRC because it is still required by Sage at runtime (ideally it shouldn't). For us, simply checking whether $SAGE_DOC/html is present would be enough.",
    "created_at": "2018-09-10T21:20:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404224",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jhpalmieri](#comment%3A19):
> Replying to [@antonio-rojas](#comment%3A17):
> > > - If a user tries to search the documentation, should they be warned if the documentation is missing or incomplete?

> > 
> > We ship docs as a separate, optional package, so such a warning would be quite useful.

> 
> Does your main distribution include `SAGE_DOC_SRC`? If not, how can you meaningfully measure whether the documentation is present? My branch tries to address this; is it overkill?

We do define SAGE_DOC_SRC because it is still required by Sage at runtime (ideally it shouldn't). For us, simply checking whether $SAGE_DOC/html is present would be enough.



---

archive/issue_comments_404225.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nWe do define it too, but just a dummy value:\n\n```\nSAGE_DOC_SRC=${SAGE_DOC_SRC_OVERRIDE:-dummy}\n```\n\nWhere the wrapper may set `SAGE_DOC_SRC_OVERRIDE`.",
    "created_at": "2018-09-10T21:54:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404225",
    "user": "https://github.com/timokau"
}
```

<div id="comment:23" align="right">comment:23</div>

We do define it too, but just a dummy value:

```
SAGE_DOC_SRC=${SAGE_DOC_SRC_OVERRIDE:-dummy}
```

Where the wrapper may set `SAGE_DOC_SRC_OVERRIDE`.



---

archive/issue_comments_404226.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nMaybe you should rip out all of the stuff that Fran\u00e7ois mentions in [comment:3](#comment%3A3), and instead check for the presence of `SAGE_DOC/html`, printing a warning (but no instructions about how to build the docs) if that is missing. If you want to get fancy, then do it like Sage's deprecation warnings: only print the warning once per session. That could go on a separate ticket, though.\n\nI'm assuming that distributions will either include no documentation or will include (almost) all of it. With this approach, if for some reason someone decided to only include the stuff in Italian, then `search_doc` will not print any warnings but will not work well.",
    "created_at": "2018-09-10T22:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404226",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:24" align="right">comment:24</div>

Maybe you should rip out all of the stuff that Fran√ßois mentions in [comment:3](#comment%3A3), and instead check for the presence of `SAGE_DOC/html`, printing a warning (but no instructions about how to build the docs) if that is missing. If you want to get fancy, then do it like Sage's deprecation warnings: only print the warning once per session. That could go on a separate ticket, though.

I'm assuming that distributions will either include no documentation or will include (almost) all of it. With this approach, if for some reason someone decided to only include the stuff in Italian, then `search_doc` will not print any warnings but will not work well.



---

archive/issue_comments_404227.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@jhpalmieri](#comment%3A24):\n> Maybe you should rip out all of the stuff that Fran\u00e7ois mentions in [comment:3](#comment%3A3), and instead check for the presence of `SAGE_DOC/html`, printing a warning (but no instructions about how to build the docs) if that is missing. If you want to get fancy, then do it like Sage's deprecation warnings: only print the warning once per session. That could go on a separate ticket, though.\n> \n> I'm assuming that distributions will either include no documentation or will include (almost) all of it. With this approach, if for some reason someone decided to only include the stuff in Italian, then `search_doc` will not print any warnings but will not work well.\n\nSorry for the delay. My job had to take priority over the last few days. It seems like arojas and timokau have a different concept of what should be tested and when compared to me and I suspect Debian. That is unexpected but not a show stopper to me. People should be able to do what they think they need to do unless it is outrageous in some ways.\n\nI would totally be in favor of John's last proposal. Rip this particular code and check whether the (or some) documentation is available when searching.",
    "created_at": "2018-09-13T02:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404227",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@jhpalmieri](#comment%3A24):
> Maybe you should rip out all of the stuff that Fran√ßois mentions in [comment:3](#comment%3A3), and instead check for the presence of `SAGE_DOC/html`, printing a warning (but no instructions about how to build the docs) if that is missing. If you want to get fancy, then do it like Sage's deprecation warnings: only print the warning once per session. That could go on a separate ticket, though.
> 
> I'm assuming that distributions will either include no documentation or will include (almost) all of it. With this approach, if for some reason someone decided to only include the stuff in Italian, then `search_doc` will not print any warnings but will not work well.

Sorry for the delay. My job had to take priority over the last few days. It seems like arojas and timokau have a different concept of what should be tested and when compared to me and I suspect Debian. That is unexpected but not a show stopper to me. People should be able to do what they think they need to do unless it is outrageous in some ways.

I would totally be in favor of John's last proposal. Rip this particular code and check whether the (or some) documentation is available when searching.



---

archive/issue_comments_404228.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/make_search_doc_independent_of_sage_setup)** to **[u/arojas/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_search_doc_independent_of_sage_setup)**",
    "created_at": "2018-09-19T19:41:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404228",
    "user": "https://github.com/antonio-rojas"
}
```

Changed branch from **[u/jhpalmieri/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/make_search_doc_independent_of_sage_setup)** to **[u/arojas/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_search_doc_independent_of_sage_setup)**



---

archive/issue_comments_404229.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,2 @@\n-search_doc currently imports stuff from sage_setup, which shouldn't be needed by sage at runtime.\n-This patch defines the necessary variables directly so that search_doc works when sage_setup is not installed.\n+search_doc currently imports stuff from sage_setup, which shouldn't be needed by sage at runtime. It also relies on the sage doc source to be present, which is not necessarily true for distro packages.\n+This patch replaces the current exhaustive check that all translated docs have been built by a simple check that $SAGE_DOC/html exists.\n``````\n",
    "created_at": "2018-09-19T19:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404229",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,2 @@
-search_doc currently imports stuff from sage_setup, which shouldn't be needed by sage at runtime.
-This patch defines the necessary variables directly so that search_doc works when sage_setup is not installed.
+search_doc currently imports stuff from sage_setup, which shouldn't be needed by sage at runtime. It also relies on the sage doc source to be present, which is not necessarily true for distro packages.
+This patch replaces the current exhaustive check that all translated docs have been built by a simple check that $SAGE_DOC/html exists.
``````




---

archive/issue_comments_404230.json:
```json
{
    "body": "Changed commit from **[`41bc9de`](https://github.com/sagemath/sagetrac-mirror/commit/41bc9de9cc5e6407e770fc84414674135b691b39)** to **[`b3abf9c`](https://github.com/sagemath/sagetrac-mirror/commit/b3abf9cc455f02c4d7b11244a863e6eb4fa607c7)**",
    "created_at": "2018-09-19T19:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404230",
    "user": "https://github.com/antonio-rojas"
}
```

Changed commit from **[`41bc9de`](https://github.com/sagemath/sagetrac-mirror/commit/41bc9de9cc5e6407e770fc84414674135b691b39)** to **[`b3abf9c`](https://github.com/sagemath/sagetrac-mirror/commit/b3abf9cc455f02c4d7b11244a863e6eb4fa607c7)**



---

archive/issue_comments_404231.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ea4177524f61f3e8eb64dc3e9fd25eb193b216dc\"><code>ea41775</code></a></td><td><code>Merge remote-tracking branch 'origin/develop' into t/26227/make_search_doc_independent_of_sage_setup</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/746949d16763a7bdce7b315199088a5d08a5ac97\"><code>746949d</code></a></td><td><code>Revert \"trac 26227: do not check whether the documentation exists every time\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b3abf9cc455f02c4d7b11244a863e6eb4fa607c7\"><code>b3abf9c</code></a></td><td><code>Replace exhaustive check for built docs by a simple check that $SAGE_DOC/html exists</code></td></tr></table>\n",
    "created_at": "2018-09-19T19:45:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404231",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:27"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ea4177524f61f3e8eb64dc3e9fd25eb193b216dc"><code>ea41775</code></a></td><td><code>Merge remote-tracking branch 'origin/develop' into t/26227/make_search_doc_independent_of_sage_setup</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/746949d16763a7bdce7b315199088a5d08a5ac97"><code>746949d</code></a></td><td><code>Revert "trac 26227: do not check whether the documentation exists every time"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b3abf9cc455f02c4d7b11244a863e6eb4fa607c7"><code>b3abf9c</code></a></td><td><code>Replace exhaustive check for built docs by a simple check that $SAGE_DOC/html exists</code></td></tr></table>




---

archive/issue_comments_404232.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nDone as suggested in [comment:25](#comment%3A25)",
    "created_at": "2018-09-22T10:29:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404232",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:28" align="right">comment:28</div>

Done as suggested in [comment:25](#comment%3A25)



---

archive/issue_events_358660.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2018-09-22T10:29:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358660"
}
```



---

archive/issue_comments_404233.json:
```json
{
    "body": "Reviewer: **Fran\u00e7ois Bissey**",
    "created_at": "2018-09-22T10:32:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404233",
    "user": "https://github.com/kiwifb"
}
```

Reviewer: **Fran√ßois Bissey**



---

archive/issue_comments_404234.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nGood enough for me.",
    "created_at": "2018-09-22T10:32:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404234",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:29" align="right">comment:29</div>

Good enough for me.



---

archive/issue_events_358661.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-09-22T10:32:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358661"
}
```



---

archive/issue_events_358662.json:
```json
{
    "actor": "https://github.com/kiwifb",
    "created_at": "2018-09-22T10:32:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358662"
}
```



---

archive/issue_events_358663.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-23T19:34:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358663"
}
```



---

archive/issue_events_358664.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "614c0368ecdbf994757f15cd93c73799a4b0269d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-09-23T19:34:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26227#event-358664"
}
```



---

archive/issue_comments_404235.json:
```json
{
    "body": "Changed branch from **[u/arojas/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_search_doc_independent_of_sage_setup)** to **[`b3abf9c`](https://github.com/sagemath/sagetrac-mirror/commit/b3abf9cc455f02c4d7b11244a863e6eb4fa607c7)**",
    "created_at": "2018-09-23T19:34:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26227#issuecomment-404235",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/arojas/make_search_doc_independent_of_sage_setup](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/make_search_doc_independent_of_sage_setup)** to **[`b3abf9c`](https://github.com/sagemath/sagetrac-mirror/commit/b3abf9cc455f02c4d7b11244a863e6eb4fa607c7)**
