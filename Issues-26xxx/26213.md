# Issue 26213: py3: minor cleanup in sage.finance.stock

archive/issues_025976.json:
```json
{
    "assignees": [],
    "body": "\n\nCC:  @embray @jdemeyer\n\nComponent: **python3**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nBranch/Commit: **[`d73a9fe`](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**\n\nReviewer: **Vincent Klein**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26213_\n\n",
    "closed_at": "2018-09-12T19:58:27Z",
    "created_at": "2018-09-07T14:11:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: minor cleanup in sage.finance.stock",
    "type": "issue",
    "updated_at": "2018-09-12T19:58:27Z",
    "url": "https://github.com/sagemath/sage/issues/26213",
    "user": "https://github.com/fchapoton"
}
```


CC:  @embray @jdemeyer

Component: **python3**

Author: **Frédéric Chapoton**

Branch/Commit: **[`d73a9fe`](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**

Reviewer: **Vincent Klein**

_Issue created by migration from https://trac.sagemath.org/ticket/26213_





---

archive/issue_events_358514.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358514"
}
```



---

archive/issue_events_358515.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358515"
}
```



---

archive/issue_events_358516.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358516"
}
```



---

archive/issue_events_358517.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358517"
}
```



---

archive/issue_comments_404028.json:
```json
{
    "body": "Branch: **[u/chapoton/26213](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26213)**",
    "created_at": "2018-09-07T14:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404028",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/26213](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26213)**



---

archive/issue_comments_404029.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef\"><code>172458e</code></a></td><td><code>py3: fix doctests in finance</code></td></tr></table>\n",
    "created_at": "2018-09-07T14:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404029",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef"><code>172458e</code></a></td><td><code>py3: fix doctests in finance</code></td></tr></table>




---

archive/issue_comments_404030.json:
```json
{
    "body": "Commit: **[`172458e`](https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef)**",
    "created_at": "2018-09-07T14:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404030",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`172458e`](https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef)**



---

archive/issue_events_358518.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358518"
}
```



---

archive/issue_comments_404031.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe two tests use the doctest tag `# py2`. Therefore it fails with python2.",
    "created_at": "2018-09-07T14:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404031",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:2" align="right">comment:2</div>

The two tests use the doctest tag `# py2`. Therefore it fails with python2.



---

archive/issue_comments_404032.json:
```json
{
    "body": "Reviewer: **Vincent Klein**",
    "created_at": "2018-09-07T14:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404032",
    "user": "https://github.com/vinklein"
}
```

Reviewer: **Vincent Klein**



---

archive/issue_comments_404033.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb\"><code>a6918b2</code></a></td><td><code>fix</code></td></tr></table>\n",
    "created_at": "2018-09-07T15:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404033",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb"><code>a6918b2</code></a></td><td><code>fix</code></td></tr></table>




---

archive/issue_comments_404034.json:
```json
{
    "body": "Changed commit from **[`172458e`](https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef)** to **[`a6918b2`](https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb)**",
    "created_at": "2018-09-07T15:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404034",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`172458e`](https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef)** to **[`a6918b2`](https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb)**



---

archive/issue_comments_404035.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nthanks, fixed",
    "created_at": "2018-09-07T15:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404035",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">comment:5</div>

thanks, fixed



---

archive/issue_comments_404036.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nWith python3, i get :\n\n```\nsage -t src/sage/finance/stock.py\n**********************************************************************\nFile \"src/sage/finance/stock.py\", line 573, in sage.finance.stock.Stock.load_from_file\nFailed example:\n    finance.Stock(\"AAPL\").load_from_file(\"I am not a file\") # py3\nExpected:\n    Traceback (most recent call last):\n    ...\n    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.finance.stock.Stock.load_from_file[4]>\", line 1, in <module>\n        finance.Stock(\"AAPL\").load_from_file(\"I am not a file\") # py3\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/finance/stock.py\", line 578, in load_from_file\n        file_obj = open(file, 'r')\n    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'\n\n```\n\nAnd if i add a `<BLANKLINE>` in the doctest expected result :\n\n\n```\nsage -t src/sage/finance/stock.py\n**********************************************************************\nFile \"src/sage/finance/stock.py\", line 573, in sage.finance.stock.Stock.load_from_file\nFailed example:\n    finance.Stock(\"AAPL\").load_from_file(\"I am not a file\") # py3\nException raised:\n    Traceback (most recent call last):\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.finance.stock.Stock.load_from_file[4]>\", line 1, in <module>\n        finance.Stock(\"AAPL\").load_from_file(\"I am not a file\") # py3\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/finance/stock.py\", line 579, in load_from_file\n        file_obj = open(file, 'r')\n    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'\n\n```\n\nIt behave as if the Error is not catched by the doctest framework.",
    "created_at": "2018-09-07T15:11:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404036",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:6" align="right">comment:6</div>

With python3, i get :

```
sage -t src/sage/finance/stock.py
**********************************************************************
File "src/sage/finance/stock.py", line 573, in sage.finance.stock.Stock.load_from_file
Failed example:
    finance.Stock("AAPL").load_from_file("I am not a file") # py3
Expected:
    Traceback (most recent call last):
    ...
    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.finance.stock.Stock.load_from_file[4]>", line 1, in <module>
        finance.Stock("AAPL").load_from_file("I am not a file") # py3
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/finance/stock.py", line 578, in load_from_file
        file_obj = open(file, 'r')
    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'

```

And if i add a `<BLANKLINE>` in the doctest expected result :


```
sage -t src/sage/finance/stock.py
**********************************************************************
File "src/sage/finance/stock.py", line 573, in sage.finance.stock.Stock.load_from_file
Failed example:
    finance.Stock("AAPL").load_from_file("I am not a file") # py3
Exception raised:
    Traceback (most recent call last):
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.finance.stock.Stock.load_from_file[4]>", line 1, in <module>
        finance.Stock("AAPL").load_from_file("I am not a file") # py3
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/finance/stock.py", line 579, in load_from_file
        file_obj = open(file, 'r')
    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'

```

It behave as if the Error is not catched by the doctest framework.



---

archive/issue_comments_404037.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThen let us ask for help.. Erik or Jeroen, any idea ?",
    "created_at": "2018-09-07T15:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404037",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">comment:7</div>

Then let us ask for help.. Erik or Jeroen, any idea ?



---

archive/issue_comments_404038.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nTo simplify i have tested the following doctest :\n\n```\nsage: raise NameError(\"test\")\nTraceback (most recent call last):\n...\nNameError: test\nsage: raise FileNotFoundError(\"test\")\nTraceback (most recent call last):\n...\nFileNotFoundError: test\n```\n\nThe first test pass and the second fails.",
    "created_at": "2018-09-07T15:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404038",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:8" align="right">comment:8</div>

To simplify i have tested the following doctest :

```
sage: raise NameError("test")
Traceback (most recent call last):
...
NameError: test
sage: raise FileNotFoundError("test")
Traceback (most recent call last):
...
FileNotFoundError: test
```

The first test pass and the second fails.



---

archive/issue_comments_404039.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb\"><code>e462f1a</code></a></td><td><code>fix for py3</code></td></tr></table>\n",
    "created_at": "2018-09-10T18:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404039",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb"><code>e462f1a</code></a></td><td><code>fix for py3</code></td></tr></table>




---

archive/issue_comments_404040.json:
```json
{
    "body": "Changed commit from **[`a6918b2`](https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb)** to **[`e462f1a`](https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb)**",
    "created_at": "2018-09-10T18:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404040",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a6918b2`](https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb)** to **[`e462f1a`](https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb)**



---

archive/issue_comments_404041.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nok. So the reason is that there is in sage doctesting framework a mechanism that modifies some subexceptions of OSError in python3, and replace them with OSError.\n\nShould be good to go now. Unless Erik (@embray) has a better idea ?",
    "created_at": "2018-09-10T18:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404041",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

ok. So the reason is that there is in sage doctesting framework a mechanism that modifies some subexceptions of OSError in python3, and replace them with OSError.

Should be good to go now. Unless Erik (@embray) has a better idea ?



---

archive/issue_comments_404042.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nIndeed, it's the #25676 ticket.",
    "created_at": "2018-09-11T07:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404042",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:11" align="right">comment:11</div>

Indeed, it's the #25676 ticket.



---

archive/issue_comments_404043.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+It's ok for me. I let Eric pass it in positive review.\n``````\n",
    "created_at": "2018-09-11T07:35:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404043",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+It's ok for me. I let Eric pass it in positive review.
``````




---

archive/issue_comments_404044.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It's ok for me. I let Eric pass it in positive review.\n+\n``````\n",
    "created_at": "2018-09-11T07:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404044",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-It's ok for me. I let Eric pass it in positive review.
+
``````




---

archive/issue_comments_404045.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIt's ok for me. I let Eric pass it in positive review.",
    "created_at": "2018-09-11T07:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404045",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:13" align="right">comment:13</div>

It's ok for me. I let Eric pass it in positive review.



---

archive/issue_comments_404046.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nBecause of #25676 this shouldn't require separate `#py2` and `#py3` cases at all, unless I missed a case in #25676.",
    "created_at": "2018-09-11T13:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404046",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Because of #25676 this shouldn't require separate `#py2` and `#py3` cases at all, unless I missed a case in #25676.



---

archive/issue_comments_404047.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWell, I tried and it did not work. Because you are busy on other stuff, I thought it was good enough for the moment.",
    "created_at": "2018-09-11T13:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404047",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">comment:15</div>

Well, I tried and it did not work. Because you are busy on other stuff, I thought it was good enough for the moment.



---

archive/issue_comments_404048.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThis is pretty low priority though (I would argue even trivial) so I don't see any reason to rush to a fix.  I can have a look at it.",
    "created_at": "2018-09-11T14:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404048",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

This is pretty low priority though (I would argue even trivial) so I don't see any reason to rush to a fix.  I can have a look at it.



---

archive/issue_comments_404049.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nWeird. I don't even have that test locally.  Was it just added in 8.4.beta4?",
    "created_at": "2018-09-11T14:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404049",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">comment:17</div>

Weird. I don't even have that test locally.  Was it just added in 8.4.beta4?



---

archive/issue_comments_404050.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nlast modified seven years ago..",
    "created_at": "2018-09-11T14:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404050",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">comment:18</div>

last modified seven years ago..



---

archive/issue_comments_404051.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOh I see now.  In my branch I just removed that test completely because it was pointless.  All it's testing is that the `open(...)` built-in raises an exception if the given file does not exist (duh).  There's nothing in that code that even does anything special in that case, so the test is not useful at all.",
    "created_at": "2018-09-11T14:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404051",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Oh I see now.  In my branch I just removed that test completely because it was pointless.  All it's testing is that the `open(...)` built-in raises an exception if the given file does not exist (duh).  There's nothing in that code that even does anything special in that case, so the test is not useful at all.



---

archive/issue_comments_404052.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI have some other minor cleanup in that file as well, such as replacing `open()` with `with open()`.  I think I missed the spurious semicolon you had.  This is my diff to the file:\n\n```diff\ndiff --git a/src/sage/finance/stock.py b/src/sage/finance/stock.py\nindex 1c9ba47..dfab025 100644\n--- a/src/sage/finance/stock.py\n+++ b/src/sage/finance/stock.py\n@@ -124,7 +124,7 @@ class OHLC:\n             True\n         \"\"\"\n         return not (self == other)\n-\n+\n\n class Stock:\n     \"\"\"\n@@ -562,18 +562,11 @@ class Stock:\n             1212407640 187.75 188.00 187.75 188.00       2000,\n             1212405780 187.80 187.80 187.80 187.80        100\n             ]\n-\n-        This tests a file that doesn't exist::\n-\n-            sage: finance.Stock(\"AAPL\").load_from_file(\"I am not a file\")\n-            Traceback (most recent call last):\n-            ...\n-            IOError: [Errno 2] No such file or directory: 'I am not a file'\n         \"\"\"\n-        file_obj = open(file, 'r')\n-        R = file_obj.read();\n+        with open(file, 'r') as fobj:\n+            R = fobj.read()\n+\n         self.__historical = self._load_from_csv(R)\n-        file_obj.close()\n         return self.__historical\n```\n\nStill weird that it's failing for you though.  I might temporarily restore the test just to investigate a little.  But I still think it should just be deleted entirely.",
    "created_at": "2018-09-11T14:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404052",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">comment:20</div>

I have some other minor cleanup in that file as well, such as replacing `open()` with `with open()`.  I think I missed the spurious semicolon you had.  This is my diff to the file:

```diff
diff --git a/src/sage/finance/stock.py b/src/sage/finance/stock.py
index 1c9ba47..dfab025 100644
--- a/src/sage/finance/stock.py
+++ b/src/sage/finance/stock.py
@@ -124,7 +124,7 @@ class OHLC:
             True
         """
         return not (self == other)
-
+

 class Stock:
     """
@@ -562,18 +562,11 @@ class Stock:
             1212407640 187.75 188.00 187.75 188.00       2000,
             1212405780 187.80 187.80 187.80 187.80        100
             ]
-
-        This tests a file that doesn't exist::
-
-            sage: finance.Stock("AAPL").load_from_file("I am not a file")
-            Traceback (most recent call last):
-            ...
-            IOError: [Errno 2] No such file or directory: 'I am not a file'
         """
-        file_obj = open(file, 'r')
-        R = file_obj.read();
+        with open(file, 'r') as fobj:
+            R = fobj.read()
+
         self.__historical = self._load_from_csv(R)
-        file_obj.close()
         return self.__historical
```

Still weird that it's failing for you though.  I might temporarily restore the test just to investigate a little.  But I still think it should just be deleted entirely.



---

archive/issue_comments_404053.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nFor that matter the `'r'` argument to `open()` is superfluous as well.",
    "created_at": "2018-09-11T14:39:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404053",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

For that matter the `'r'` argument to `open()` is superfluous as well.



---

archive/issue_comments_404054.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAh, I see the problem.  There are two classes of exception name mappings surrounding `OSError`: One is classes in Python 2 that have just been replaced with `OSError` (of which `IOError` happens to be one).  The other is new-to-Python 3 specialized subclasses of `OSError` for specific errnos, such as `FileNotFoundError`.\n\nOn Python 3 the doctester code treats either one case, or the other.  But in this case it should treat both by mapping `IOError -> OSError -> FileNotFoundError`.  I'll make a ticket.",
    "created_at": "2018-09-11T14:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404054",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">comment:22</div>

Ah, I see the problem.  There are two classes of exception name mappings surrounding `OSError`: One is classes in Python 2 that have just been replaced with `OSError` (of which `IOError` happens to be one).  The other is new-to-Python 3 specialized subclasses of `OSError` for specific errnos, such as `FileNotFoundError`.

On Python 3 the doctester code treats either one case, or the other.  But in this case it should treat both by mapping `IOError -> OSError -> FileNotFoundError`.  I'll make a ticket.



---

archive/issue_comments_404055.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nok. Let us remove the useless doctest here.",
    "created_at": "2018-09-11T14:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404055",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">comment:23</div>

ok. Let us remove the useless doctest here.



---

archive/issue_comments_404056.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a\"><code>d73a9fe</code></a></td><td><code>py3: fix finance doctest</code></td></tr></table>\n",
    "created_at": "2018-09-11T14:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404056",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a"><code>d73a9fe</code></a></td><td><code>py3: fix finance doctest</code></td></tr></table>




---

archive/issue_comments_404057.json:
```json
{
    "body": "Changed commit from **[`e462f1a`](https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb)** to **[`d73a9fe`](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**",
    "created_at": "2018-09-11T14:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404057",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e462f1a`](https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb)** to **[`d73a9fe`](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**



---

archive/issue_comments_404058.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\ndone, ready for review again",
    "created_at": "2018-09-11T14:52:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404058",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">comment:25</div>

done, ready for review again



---

archive/issue_events_358519.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T14:59:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358519"
}
```



---

archive/issue_events_358520.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T14:59:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358520"
}
```



---

archive/issue_events_358521.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T14:59:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "title_is": "py3: minor cleanup in sage.finance.stock",
    "title_was": "py3: fix doctests in finance/",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358521"
}
```



---

archive/issue_events_358522.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T15:00:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358522"
}
```



---

archive/issue_events_358523.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T15:00:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20trivial%20/%205",
    "label_color": "fff9e5",
    "label_name": "p: trivial / 5",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358523"
}
```



---

archive/issue_comments_404059.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nIn case it helps Volker.",
    "created_at": "2018-09-11T15:00:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404059",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

In case it helps Volker.



---

archive/issue_events_358524.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-12T19:58:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358524"
}
```



---

archive/issue_events_358525.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4da33d08d7377d2fdb62c07c1b24d9ffb6043029",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-09-12T19:58:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-358525"
}
```



---

archive/issue_comments_404060.json:
```json
{
    "body": "Changed branch from **[u/chapoton/26213](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26213)** to **[`d73a9fe`](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**",
    "created_at": "2018-09-12T19:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-404060",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/26213](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26213)** to **[`d73a9fe`](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**
