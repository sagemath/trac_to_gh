# Issue 26213: py3: minor cleanup in sage.finance.stock

archive/issues_025976.json:
```json
{
    "assignees": [],
    "body": "\n\nCC:  @embray @jdemeyer\n\nBranch/Commit: **[d73a9fe](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**\n\nReviewer: **Vincent Klein**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26213_\n\n",
    "closed_at": "2018-09-12T19:58:27Z",
    "created_at": "2018-09-07T14:11:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20python3",
        "https://github.com/sagemath/sage/labels/p5%20%E2%80%93%20trivial",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: minor cleanup in sage.finance.stock",
    "type": "issue",
    "updated_at": "2018-09-12T19:58:27Z",
    "url": "https://github.com/sagemath/sage/issues/26213",
    "user": "https://github.com/fchapoton"
}
```


CC:  @embray @jdemeyer

Branch/Commit: **[d73a9fe](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**

Reviewer: **Vincent Klein**

Author: **Frédéric Chapoton**

_Issue created by migration from https://trac.sagemath.org/ticket/26213_





---

archive/issue_events_343490.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343490"
}
```



---

archive/issue_events_343491.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20python3",
    "label_color": "000080",
    "label_name": "component: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343491"
}
```



---

archive/issue_events_343492.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343492"
}
```



---

archive/issue_events_343493.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343493"
}
```



---

archive/issue_comments_406869.json:
```json
{
    "body": "Branch: **[u/chapoton/26213](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26213)**",
    "created_at": "2018-09-07T14:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406869",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/26213](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26213)**



---

archive/issue_comments_406870.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef\">172458e</a></td><td><code>py3: fix doctests in finance</code></td></tr></table>\n",
    "created_at": "2018-09-07T14:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406870",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1" align="right">Comment 1</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef">172458e</a></td><td><code>py3: fix doctests in finance</code></td></tr></table>




---

archive/issue_comments_406871.json:
```json
{
    "body": "Commit: **[172458e](https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef)**",
    "created_at": "2018-09-07T14:11:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406871",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[172458e](https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef)**



---

archive/issue_events_343494.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-09-07T14:11:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343494"
}
```



---

archive/issue_comments_406872.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nThe two tests use the doctest tag `# py2`. Therefore it fails with python2.",
    "created_at": "2018-09-07T14:57:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406872",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:2" align="right">Comment 2</div>

The two tests use the doctest tag `# py2`. Therefore it fails with python2.



---

archive/issue_comments_406873.json:
```json
{
    "body": "Reviewer: **Vincent Klein**",
    "created_at": "2018-09-07T14:57:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406873",
    "user": "https://github.com/vinklein"
}
```

Reviewer: **Vincent Klein**



---

archive/issue_comments_406874.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb\">a6918b2</a></td><td><code>fix</code></td></tr></table>\n",
    "created_at": "2018-09-07T15:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406874",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4" align="right">Comment 4</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb">a6918b2</a></td><td><code>fix</code></td></tr></table>




---

archive/issue_comments_406875.json:
```json
{
    "body": "Changed commit from **[172458e](https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef)** to **[a6918b2](https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb)**",
    "created_at": "2018-09-07T15:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406875",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[172458e](https://github.com/sagemath/sagetrac-mirror/commit/172458e6e98f382ea49d872ee09ecf635caff9ef)** to **[a6918b2](https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb)**



---

archive/issue_comments_406876.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nthanks, fixed",
    "created_at": "2018-09-07T15:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406876",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">Comment 5</div>

thanks, fixed



---

archive/issue_comments_406877.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nWith python3, i get :\n\n```\nsage -t src/sage/finance/stock.py\n**********************************************************************\nFile \"src/sage/finance/stock.py\", line 573, in sage.finance.stock.Stock.load_from_file\nFailed example:\n    finance.Stock(\"AAPL\").load_from_file(\"I am not a file\") # py3\nExpected:\n    Traceback (most recent call last):\n    ...\n    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.finance.stock.Stock.load_from_file[4]>\", line 1, in <module>\n        finance.Stock(\"AAPL\").load_from_file(\"I am not a file\") # py3\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/finance/stock.py\", line 578, in load_from_file\n        file_obj = open(file, 'r')\n    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'\n\n```\n\nAnd if i add a `<BLANKLINE>` in the doctest expected result :\n\n\n```\nsage -t src/sage/finance/stock.py\n**********************************************************************\nFile \"src/sage/finance/stock.py\", line 573, in sage.finance.stock.Stock.load_from_file\nFailed example:\n    finance.Stock(\"AAPL\").load_from_file(\"I am not a file\") # py3\nException raised:\n    Traceback (most recent call last):\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.finance.stock.Stock.load_from_file[4]>\", line 1, in <module>\n        finance.Stock(\"AAPL\").load_from_file(\"I am not a file\") # py3\n      File \"/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/finance/stock.py\", line 579, in load_from_file\n        file_obj = open(file, 'r')\n    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'\n\n```\n\nIt behave as if the Error is not catched by the doctest framework.",
    "created_at": "2018-09-07T15:11:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406877",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:6" align="right">Comment 6</div>

With python3, i get :

```
sage -t src/sage/finance/stock.py
**********************************************************************
File "src/sage/finance/stock.py", line 573, in sage.finance.stock.Stock.load_from_file
Failed example:
    finance.Stock("AAPL").load_from_file("I am not a file") # py3
Expected:
    Traceback (most recent call last):
    ...
    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.finance.stock.Stock.load_from_file[4]>", line 1, in <module>
        finance.Stock("AAPL").load_from_file("I am not a file") # py3
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/finance/stock.py", line 578, in load_from_file
        file_obj = open(file, 'r')
    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'

```

And if i add a `<BLANKLINE>` in the doctest expected result :


```
sage -t src/sage/finance/stock.py
**********************************************************************
File "src/sage/finance/stock.py", line 573, in sage.finance.stock.Stock.load_from_file
Failed example:
    finance.Stock("AAPL").load_from_file("I am not a file") # py3
Exception raised:
    Traceback (most recent call last):
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.finance.stock.Stock.load_from_file[4]>", line 1, in <module>
        finance.Stock("AAPL").load_from_file("I am not a file") # py3
      File "/home/vklein/odk/sage/local/lib/python3.6/site-packages/sage/finance/stock.py", line 579, in load_from_file
        file_obj = open(file, 'r')
    FileNotFoundError: [Errno 2] No such file or directory: 'I am not a file'

```

It behave as if the Error is not catched by the doctest framework.



---

archive/issue_comments_406878.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nThen let us ask for help.. Erik or Jeroen, any idea ?",
    "created_at": "2018-09-07T15:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406878",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:7" align="right">Comment 7</div>

Then let us ask for help.. Erik or Jeroen, any idea ?



---

archive/issue_comments_406879.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nTo simplify i have tested the following doctest :\n\n```\nsage: raise NameError(\"test\")\nTraceback (most recent call last):\n...\nNameError: test\nsage: raise FileNotFoundError(\"test\")\nTraceback (most recent call last):\n...\nFileNotFoundError: test\n```\n\nThe first test pass and the second fails.",
    "created_at": "2018-09-07T15:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406879",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:8" align="right">Comment 8</div>

To simplify i have tested the following doctest :

```
sage: raise NameError("test")
Traceback (most recent call last):
...
NameError: test
sage: raise FileNotFoundError("test")
Traceback (most recent call last):
...
FileNotFoundError: test
```

The first test pass and the second fails.



---

archive/issue_comments_406880.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb\">e462f1a</a></td><td><code>fix for py3</code></td></tr></table>\n",
    "created_at": "2018-09-10T18:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406880",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9" align="right">Comment 9</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb">e462f1a</a></td><td><code>fix for py3</code></td></tr></table>




---

archive/issue_comments_406881.json:
```json
{
    "body": "Changed commit from **[a6918b2](https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb)** to **[e462f1a](https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb)**",
    "created_at": "2018-09-10T18:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406881",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a6918b2](https://github.com/sagemath/sagetrac-mirror/commit/a6918b22cb1ec71df9724f271e628df49099a6fb)** to **[e462f1a](https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb)**



---

archive/issue_comments_406882.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nok. So the reason is that there is in sage doctesting framework a mechanism that modifies some subexceptions of OSError in python3, and replace them with OSError.\n\nShould be good to go now. Unless Erik (@embray) has a better idea ?",
    "created_at": "2018-09-10T18:51:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406882",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">Comment 10</div>

ok. So the reason is that there is in sage doctesting framework a mechanism that modifies some subexceptions of OSError in python3, and replace them with OSError.

Should be good to go now. Unless Erik (@embray) has a better idea ?



---

archive/issue_comments_406883.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nIndeed, it's the #25676 ticket.",
    "created_at": "2018-09-11T07:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406883",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:11" align="right">Comment 11</div>

Indeed, it's the #25676 ticket.



---

archive/issue_comments_406884.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-\n+It's ok for me. I let Eric pass it in positive review.\n``````\n",
    "created_at": "2018-09-11T07:35:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406884",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-
+It's ok for me. I let Eric pass it in positive review.
``````




---

archive/issue_comments_406885.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-It's ok for me. I let Eric pass it in positive review.\n+\n``````\n",
    "created_at": "2018-09-11T07:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406885",
    "user": "https://github.com/vinklein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-It's ok for me. I let Eric pass it in positive review.
+
``````




---

archive/issue_comments_406886.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nIt's ok for me. I let Eric pass it in positive review.",
    "created_at": "2018-09-11T07:35:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406886",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:13" align="right">Comment 13</div>

It's ok for me. I let Eric pass it in positive review.



---

archive/issue_comments_406887.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nBecause of #25676 this shouldn't require separate `#py2` and `#py3` cases at all, unless I missed a case in #25676.",
    "created_at": "2018-09-11T13:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406887",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">Comment 14</div>

Because of #25676 this shouldn't require separate `#py2` and `#py3` cases at all, unless I missed a case in #25676.



---

archive/issue_comments_406888.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nWell, I tried and it did not work. Because you are busy on other stuff, I thought it was good enough for the moment.",
    "created_at": "2018-09-11T13:59:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406888",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:15" align="right">Comment 15</div>

Well, I tried and it did not work. Because you are busy on other stuff, I thought it was good enough for the moment.



---

archive/issue_comments_406889.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nThis is pretty low priority though (I would argue even trivial) so I don't see any reason to rush to a fix.  I can have a look at it.",
    "created_at": "2018-09-11T14:09:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406889",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">Comment 16</div>

This is pretty low priority though (I would argue even trivial) so I don't see any reason to rush to a fix.  I can have a look at it.



---

archive/issue_comments_406890.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nWeird. I don't even have that test locally.  Was it just added in 8.4.beta4?",
    "created_at": "2018-09-11T14:13:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406890",
    "user": "https://github.com/embray"
}
```

<div id="comment:17" align="right">Comment 17</div>

Weird. I don't even have that test locally.  Was it just added in 8.4.beta4?



---

archive/issue_comments_406891.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nlast modified seven years ago..",
    "created_at": "2018-09-11T14:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406891",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:18" align="right">Comment 18</div>

last modified seven years ago..



---

archive/issue_comments_406892.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nOh I see now.  In my branch I just removed that test completely because it was pointless.  All it's testing is that the `open(...)` built-in raises an exception if the given file does not exist (duh).  There's nothing in that code that even does anything special in that case, so the test is not useful at all.",
    "created_at": "2018-09-11T14:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406892",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">Comment 19</div>

Oh I see now.  In my branch I just removed that test completely because it was pointless.  All it's testing is that the `open(...)` built-in raises an exception if the given file does not exist (duh).  There's nothing in that code that even does anything special in that case, so the test is not useful at all.



---

archive/issue_comments_406893.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nI have some other minor cleanup in that file as well, such as replacing `open()` with `with open()`.  I think I missed the spurious semicolon you had.  This is my diff to the file:\n\n```diff\ndiff --git a/src/sage/finance/stock.py b/src/sage/finance/stock.py\nindex 1c9ba47..dfab025 100644\n--- a/src/sage/finance/stock.py\n+++ b/src/sage/finance/stock.py\n@@ -124,7 +124,7 @@ class OHLC:\n             True\n         \"\"\"\n         return not (self == other)\n-\n+\n\n class Stock:\n     \"\"\"\n@@ -562,18 +562,11 @@ class Stock:\n             1212407640 187.75 188.00 187.75 188.00       2000,\n             1212405780 187.80 187.80 187.80 187.80        100\n             ]\n-\n-        This tests a file that doesn't exist::\n-\n-            sage: finance.Stock(\"AAPL\").load_from_file(\"I am not a file\")\n-            Traceback (most recent call last):\n-            ...\n-            IOError: [Errno 2] No such file or directory: 'I am not a file'\n         \"\"\"\n-        file_obj = open(file, 'r')\n-        R = file_obj.read();\n+        with open(file, 'r') as fobj:\n+            R = fobj.read()\n+\n         self.__historical = self._load_from_csv(R)\n-        file_obj.close()\n         return self.__historical\n```\n\nStill weird that it's failing for you though.  I might temporarily restore the test just to investigate a little.  But I still think it should just be deleted entirely.",
    "created_at": "2018-09-11T14:37:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406893",
    "user": "https://github.com/embray"
}
```

<div id="comment:20" align="right">Comment 20</div>

I have some other minor cleanup in that file as well, such as replacing `open()` with `with open()`.  I think I missed the spurious semicolon you had.  This is my diff to the file:

```diff
diff --git a/src/sage/finance/stock.py b/src/sage/finance/stock.py
index 1c9ba47..dfab025 100644
--- a/src/sage/finance/stock.py
+++ b/src/sage/finance/stock.py
@@ -124,7 +124,7 @@ class OHLC:
             True
         """
         return not (self == other)
-
+

 class Stock:
     """
@@ -562,18 +562,11 @@ class Stock:
             1212407640 187.75 188.00 187.75 188.00       2000,
             1212405780 187.80 187.80 187.80 187.80        100
             ]
-
-        This tests a file that doesn't exist::
-
-            sage: finance.Stock("AAPL").load_from_file("I am not a file")
-            Traceback (most recent call last):
-            ...
-            IOError: [Errno 2] No such file or directory: 'I am not a file'
         """
-        file_obj = open(file, 'r')
-        R = file_obj.read();
+        with open(file, 'r') as fobj:
+            R = fobj.read()
+
         self.__historical = self._load_from_csv(R)
-        file_obj.close()
         return self.__historical
```

Still weird that it's failing for you though.  I might temporarily restore the test just to investigate a little.  But I still think it should just be deleted entirely.



---

archive/issue_comments_406894.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nFor that matter the `'r'` argument to `open()` is superfluous as well.",
    "created_at": "2018-09-11T14:39:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406894",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">Comment 21</div>

For that matter the `'r'` argument to `open()` is superfluous as well.



---

archive/issue_comments_406895.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nAh, I see the problem.  There are two classes of exception name mappings surrounding `OSError`: One is classes in Python 2 that have just been replaced with `OSError` (of which `IOError` happens to be one).  The other is new-to-Python 3 specialized subclasses of `OSError` for specific errnos, such as `FileNotFoundError`.\n\nOn Python 3 the doctester code treats either one case, or the other.  But in this case it should treat both by mapping `IOError -> OSError -> FileNotFoundError`.  I'll make a ticket.",
    "created_at": "2018-09-11T14:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406895",
    "user": "https://github.com/embray"
}
```

<div id="comment:22" align="right">Comment 22</div>

Ah, I see the problem.  There are two classes of exception name mappings surrounding `OSError`: One is classes in Python 2 that have just been replaced with `OSError` (of which `IOError` happens to be one).  The other is new-to-Python 3 specialized subclasses of `OSError` for specific errnos, such as `FileNotFoundError`.

On Python 3 the doctester code treats either one case, or the other.  But in this case it should treat both by mapping `IOError -> OSError -> FileNotFoundError`.  I'll make a ticket.



---

archive/issue_comments_406896.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nok. Let us remove the useless doctest here.",
    "created_at": "2018-09-11T14:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406896",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:23" align="right">Comment 23</div>

ok. Let us remove the useless doctest here.



---

archive/issue_comments_406897.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a\">d73a9fe</a></td><td><code>py3: fix finance doctest</code></td></tr></table>\n",
    "created_at": "2018-09-11T14:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406897",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24" align="right">Comment 24</div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a">d73a9fe</a></td><td><code>py3: fix finance doctest</code></td></tr></table>




---

archive/issue_comments_406898.json:
```json
{
    "body": "Changed commit from **[e462f1a](https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb)** to **[d73a9fe](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**",
    "created_at": "2018-09-11T14:50:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406898",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e462f1a](https://github.com/sagemath/sagetrac-mirror/commit/e462f1a47cff55b24e100a2ffd01f958623368fb)** to **[d73a9fe](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**



---

archive/issue_comments_406899.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\ndone, ready for review again",
    "created_at": "2018-09-11T14:52:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406899",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:25" align="right">Comment 25</div>

done, ready for review again



---

archive/issue_events_343495.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T14:59:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343495"
}
```



---

archive/issue_events_343496.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T14:59:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343496"
}
```



---

archive/issue_events_343497.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T14:59:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "title_is": "py3: minor cleanup in sage.finance.stock",
    "title_was": "py3: fix doctests in finance/",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343497"
}
```



---

archive/issue_events_343498.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T15:00:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343498"
}
```



---

archive/issue_events_343499.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-11T15:00:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/p5%20%E2%80%93%20trivial",
    "label_color": "fff9e5",
    "label_name": "p5 \u2013 trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343499"
}
```



---

archive/issue_comments_406900.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nIn case it helps Volker.",
    "created_at": "2018-09-11T15:00:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406900",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">Comment 27</div>

In case it helps Volker.



---

archive/issue_events_343500.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-12T19:58:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343500"
}
```



---

archive/issue_events_343501.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4da33d08d7377d2fdb62c07c1b24d9ffb6043029",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-09-12T19:58:27Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26213#event-343501"
}
```



---

archive/issue_comments_406901.json:
```json
{
    "body": "Changed branch from **[u/chapoton/26213](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26213)** to **[d73a9fe](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**",
    "created_at": "2018-09-12T19:58:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26213#issuecomment-406901",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/26213](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/26213)** to **[d73a9fe](https://github.com/sagemath/sagetrac-mirror/commit/d73a9fed2ca4e5d4f55115de8fbbb538e862034a)**
