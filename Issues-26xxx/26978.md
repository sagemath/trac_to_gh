# Issue 26978: Remove broken SAGE_BUILD_TOOLCHAIN support

archive/issues_026978.json:
```json
{
    "body": "CC:  @embray\n\nThe environment variable `SAGE_BUILD_TOOLCHAIN` has always been a bit of a hack. It is currently broken (probably due to #24919): imagine a system where the `gcc` Sage package is installed. If `mpir` is upgraded, then `mpir` is rebuilt (as dependency of `gcc`) with `SAGE_BUILD_TOOLCHAIN` but there is nothing forcing a second build of `mpir` without `SAGE_BUILD_TOOLCHAIN`.\n\nInstead of trying to fix `SAGE_BUILD_TOOLCHAIN`, we just stop supporting it: toolchain packages are now built once just like any other package.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27215\n\n",
    "closed_at": "2019-03-14T18:14:05Z",
    "created_at": "2019-02-04T14:28:17Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Remove broken SAGE_BUILD_TOOLCHAIN support",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26978",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @embray

The environment variable `SAGE_BUILD_TOOLCHAIN` has always been a bit of a hack. It is currently broken (probably due to #24919): imagine a system where the `gcc` Sage package is installed. If `mpir` is upgraded, then `mpir` is rebuilt (as dependency of `gcc`) with `SAGE_BUILD_TOOLCHAIN` but there is nothing forcing a second build of `mpir` without `SAGE_BUILD_TOOLCHAIN`.

Instead of trying to fix `SAGE_BUILD_TOOLCHAIN`, we just stop supporting it: toolchain packages are now built once just like any other package.

Issue created by migration from https://trac.sagemath.org/ticket/27215





---

archive/issue_comments_379341.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-02-04T16:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379341",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_379342.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-02-04T17:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_379343.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-02-04T17:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379343",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_379344.json:
```json
{
    "body": "I think #27373 shows the other side of the same problem--things aren't nice with mpir/gmp if they come from the system rather than built.",
    "created_at": "2019-03-11T11:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379344",
    "user": "https://github.com/dimpase"
}
```

I think #27373 shows the other side of the same problem--things aren't nice with mpir/gmp if they come from the system rather than built.



---

archive/issue_comments_379345.json:
```json
{
    "body": "Does this ticket try to repair anything, or just removes stuff?",
    "created_at": "2019-03-11T12:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379345",
    "user": "https://github.com/dimpase"
}
```

Does this ticket try to repair anything, or just removes stuff?



---

archive/issue_comments_379346.json:
```json
{
    "body": "I guess #27212 ought to depend on this one, or the other way around, otherwise merging gets messy.",
    "created_at": "2019-03-11T12:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379346",
    "user": "https://github.com/dimpase"
}
```

I guess #27212 ought to depend on this one, or the other way around, otherwise merging gets messy.



---

archive/issue_comments_379347.json:
```json
{
    "body": "Replying to [comment:6 dimpase]:\n> Does this ticket try to repair anything\n\n\nYes, as explained in the ticket description. That's also why it's a blocker ticket: it breaks builds whenever the Sage GCC package is installed.",
    "created_at": "2019-03-11T12:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379347",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:6 dimpase]:
> Does this ticket try to repair anything


Yes, as explained in the ticket description. That's also why it's a blocker ticket: it breaks builds whenever the Sage GCC package is installed.



---

archive/issue_comments_379348.json:
```json
{
    "body": "The ticket description does not explain the change in functionality that should be the result, it only explains the defect.",
    "created_at": "2019-03-11T13:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379348",
    "user": "https://github.com/dimpase"
}
```

The ticket description does not explain the change in functionality that should be the result, it only explains the defect.



---

archive/issue_comments_379349.json:
```json
{
    "body": "Replying to [comment:9 dimpase]:\n> The ticket description does not explain the change in functionality that should be the result, it only explains the defect.\n\n\nIt doesn't even explain the defect.  Just \"it breaks\".  What breaks? How?  How does this fix it? Is there anything this fix breaks?",
    "created_at": "2019-03-11T14:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379349",
    "user": "https://github.com/embray"
}
```

Replying to [comment:9 dimpase]:
> The ticket description does not explain the change in functionality that should be the result, it only explains the defect.


It doesn't even explain the defect.  Just "it breaks".  What breaks? How?  How does this fix it? Is there anything this fix breaks?



---

archive/issue_comments_379350.json:
```json
{
    "body": "Replying to [comment:12 embray]:\n> Just \"it breaks\".  What breaks?\n\n\nWith all due respect, I think that this explanation from the ticket description is more than just \"it breaks\":\n\n> imagine a system where the `gcc` Sage package is installed. If `mpir` is upgraded, then `mpir` is rebuilt (as dependency of `gcc`) with `SAGE_BUILD_TOOLCHAIN` but there is nothing forcing a second build of `mpir`.\n\n\nIf you have more concrete questions, I'm happy to answer them.",
    "created_at": "2019-03-11T14:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379350",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 embray]:
> Just "it breaks".  What breaks?


With all due respect, I think that this explanation from the ticket description is more than just "it breaks":

> imagine a system where the `gcc` Sage package is installed. If `mpir` is upgraded, then `mpir` is rebuilt (as dependency of `gcc`) with `SAGE_BUILD_TOOLCHAIN` but there is nothing forcing a second build of `mpir`.


If you have more concrete questions, I'm happy to answer them.



---

archive/issue_comments_379351.json:
```json
{
    "body": "I had to re-read it several times (I don't know if that's a problem with the wording, or if it's just subtle), but I think I understand now.  And because mpir is not rebuilt, in this case, with `SAGE_BUILD_TOOLCHAIN=no` it is missing some functionality I guess (specifically it is built without the C++ library).\n\nI think there probably could be a better way to indicate if mpir is being built as a dependency of a (not yet built) gcc.  But I agree that there's not a whole lot of advantage to doing so, especially if the feature breaks normal builds in service to a (what I would consider) the rather marginal use case of installing Sage's own gcc.",
    "created_at": "2019-03-11T14:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379351",
    "user": "https://github.com/embray"
}
```

I had to re-read it several times (I don't know if that's a problem with the wording, or if it's just subtle), but I think I understand now.  And because mpir is not rebuilt, in this case, with `SAGE_BUILD_TOOLCHAIN=no` it is missing some functionality I guess (specifically it is built without the C++ library).

I think there probably could be a better way to indicate if mpir is being built as a dependency of a (not yet built) gcc.  But I agree that there's not a whole lot of advantage to doing so, especially if the feature breaks normal builds in service to a (what I would consider) the rather marginal use case of installing Sage's own gcc.



---

archive/issue_comments_379352.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-03-11T14:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379352",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_379353.json:
```json
{
    "body": "I guess it would be a problem on a system without a C++ compiler to begin with (per #12782).  I suppose we're saying we don't care about that though--install a minimal C++ compiler as a prerequisite.",
    "created_at": "2019-03-11T14:43:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379353",
    "user": "https://github.com/embray"
}
```

I guess it would be a problem on a system without a C++ compiler to begin with (per #12782).  I suppose we're saying we don't care about that though--install a minimal C++ compiler as a prerequisite.



---

archive/issue_comments_379354.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2019-03-11T14:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379354",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_379355.json:
```json
{
    "body": "Actually one quick question before I set back to positive-review: Unless this issue actually broke some buildbots or something, do we really want to increase the package versions?  For successfully built systems this changes nothing about their GMP/MPIR builds, so I would rather not force the overhead of rebuilding those packages and their many dependencies if we don't really need to.",
    "created_at": "2019-03-11T14:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379355",
    "user": "https://github.com/embray"
}
```

Actually one quick question before I set back to positive-review: Unless this issue actually broke some buildbots or something, do we really want to increase the package versions?  For successfully built systems this changes nothing about their GMP/MPIR builds, so I would rather not force the overhead of rebuilding those packages and their many dependencies if we don't really need to.



---

archive/issue_comments_379356.json:
```json
{
    "body": "Replying to [comment:17 embray]:\n> For successfully built systems\n\n\nWell, this change was meant for non-successfully built systems.",
    "created_at": "2019-03-11T14:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379356",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 embray]:
> For successfully built systems


Well, this change was meant for non-successfully built systems.



---

archive/issue_comments_379357.json:
```json
{
    "body": "I think, up to a point, we don't have to care about a few broken builds due to issues introduced several versions ago, unless we have some specific known need to (e.g. fixing some incremental builds on buildbots).  Otherwise you're just forcing a lot of needless electricity usage.",
    "created_at": "2019-03-11T14:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379357",
    "user": "https://github.com/embray"
}
```

I think, up to a point, we don't have to care about a few broken builds due to issues introduced several versions ago, unless we have some specific known need to (e.g. fixing some incremental builds on buildbots).  Otherwise you're just forcing a lot of needless electricity usage.



---

archive/issue_comments_379358.json:
```json
{
    "body": "OK, I see your point.",
    "created_at": "2019-03-11T14:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379358",
    "user": "https://github.com/jdemeyer"
}
```

OK, I see your point.



---

archive/issue_comments_379359.json:
```json
{
    "body": "So, do we agree do not bump up the versions here? I'd like to merge this branch into #27212...",
    "created_at": "2019-03-11T18:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379359",
    "user": "https://github.com/dimpase"
}
```

So, do we agree do not bump up the versions here? I'd like to merge this branch into #27212...



---

archive/issue_comments_379360.json:
```json
{
    "body": "I leave it up to Jeroen--I think it's a sensible policy to always *default* to bumping package versions when updating their spkg-install, but I also believe there are cases (and this is one of them) where it might be smarter not to unless there's a strong reason for doing so.",
    "created_at": "2019-03-12T12:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379360",
    "user": "https://github.com/embray"
}
```

I leave it up to Jeroen--I think it's a sensible policy to always *default* to bumping package versions when updating their spkg-install, but I also believe there are cases (and this is one of them) where it might be smarter not to unless there's a strong reason for doing so.



---

archive/issue_comments_379361.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-03-12T13:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379361",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_379362.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2019-03-12T13:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379362",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_379363.json:
```json
{
    "body": "Removed the package version bumping.",
    "created_at": "2019-03-12T13:57:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379363",
    "user": "https://github.com/jdemeyer"
}
```

Removed the package version bumping.



---

archive/issue_comments_379364.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-03-14T18:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26978#issuecomment-379364",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_067570.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-14T18:14:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26978",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26978#event-67570"
}
```
