# Issue 26000: sage with 64 bit openblas

archive/issues_025763.json:
```json
{
    "body": "By default, openblas compiles with a 32 bit interface (even when the binary is 64 bit). To build with the 64 bit interface, you have to set the [INTERFACE64](https://github.com/xianyi/OpenBLAS/blob/b03ae3f4dc90a3bde83b98f3fd67e8c618c0390b/Makefile.rule#L115) environment variable. [Here](https://github.com/Homebrew/homebrew-science/issues/48#issuecomment-11636954) is some discussion about the differences.\n\nWhen just naively enabling 64 bit openblas in sage, we get various segfaults. First during docbuild and then more during testing (see attached logs).\nOn nix I even get those failures if only flint is compiled with openblas64, even though flint doesn't even really need openblas.\n\n\nKeywords: openblas\n\nBranch: [public/26000](https://github.com/sagemath/sagetrac-mirror/tree/public/26000)\n\nCommit: [e3ddaf81108343c05aee7a1231dd3cbb4d74b5a8](https://github.com/sagemath/sagetrac-mirror/commit/e3ddaf81108343c05aee7a1231dd3cbb4d74b5a8)\n\nStatus: new\n\nIssue created by migration from https://trac.sagemath.org/ticket/26000\n\n",
    "created_at": "2018-08-04T15:15:03Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "sage with 64 bit openblas",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26000",
    "user": "https://github.com/timokau"
}
```
By default, openblas compiles with a 32 bit interface (even when the binary is 64 bit). To build with the 64 bit interface, you have to set the [INTERFACE64](https://github.com/xianyi/OpenBLAS/blob/b03ae3f4dc90a3bde83b98f3fd67e8c618c0390b/Makefile.rule#L115) environment variable. [Here](https://github.com/Homebrew/homebrew-science/issues/48#issuecomment-11636954) is some discussion about the differences.

When just naively enabling 64 bit openblas in sage, we get various segfaults. First during docbuild and then more during testing (see attached logs).
On nix I even get those failures if only flint is compiled with openblas64, even though flint doesn't even really need openblas.


Keywords: openblas

Branch: [public/26000](https://github.com/sagemath/sagetrac-mirror/tree/public/26000)

Commit: [e3ddaf81108343c05aee7a1231dd3cbb4d74b5a8](https://github.com/sagemath/sagetrac-mirror/commit/e3ddaf81108343c05aee7a1231dd3cbb4d74b5a8)

Status: new

Issue created by migration from https://trac.sagemath.org/ticket/26000





---

archive/issue_comments_501434.json:
```json
{
    "body": "Attachment [tests.log](tarball://root/attachments/some-uuid/ticket26000/tests.log) by @timokau created at 2018-08-04 15:15:32",
    "created_at": "2018-08-04T15:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501434",
    "user": "https://github.com/timokau"
}
```

Attachment [tests.log](tarball://root/attachments/some-uuid/ticket26000/tests.log) by @timokau created at 2018-08-04 15:15:32



---

archive/issue_comments_501435.json:
```json
{
    "body": "Attachment [dochtml.log](tarball://root/attachments/some-uuid/ticket26000/dochtml.log) by @timokau created at 2018-08-04 15:16:02",
    "created_at": "2018-08-04T15:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501435",
    "user": "https://github.com/timokau"
}
```

Attachment [dochtml.log](tarball://root/attachments/some-uuid/ticket26000/dochtml.log) by @timokau created at 2018-08-04 15:16:02



---

archive/issue_comments_501436.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,5 @@\n By default, openblas compiles with a 32 bit interface (even when the binary is 64 bit). To build with the 64 bit interface, you have to set the [INTERFACE64](https://github.com/xianyi/OpenBLAS/blob/b03ae3f4dc90a3bde83b98f3fd67e8c618c0390b/Makefile.rule#L115) environment variable. [Here](https://github.com/Homebrew/homebrew-science/issues/48#issuecomment-11636954) is some discussion about the differences.\n+\n+When just naively enabling 64 bit openblas in sage, we get various segfaults. First during docbuild and then more during testing (see attached logs).\n+On nix I even get those failures if only flint is compiled with openblas64, even though flint doesn't even really need openblas.\n+\n``````\n",
    "created_at": "2018-08-04T15:16:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501436",
    "user": "https://github.com/timokau"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,5 @@
 By default, openblas compiles with a 32 bit interface (even when the binary is 64 bit). To build with the 64 bit interface, you have to set the [INTERFACE64](https://github.com/xianyi/OpenBLAS/blob/b03ae3f4dc90a3bde83b98f3fd67e8c618c0390b/Makefile.rule#L115) environment variable. [Here](https://github.com/Homebrew/homebrew-science/issues/48#issuecomment-11636954) is some discussion about the differences.
+
+When just naively enabling 64 bit openblas in sage, we get various segfaults. First during docbuild and then more during testing (see attached logs).
+On nix I even get those failures if only flint is compiled with openblas64, even though flint doesn't even really need openblas.
+
``````




---

archive/issue_comments_501437.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                      |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[e3ddaf8](https://github.com/sagemath/sagetrac-mirror/commit/e3ddaf81108343c05aee7a1231dd3cbb4d74b5a8)|`Enable 64 bit interface for openblas`|",
    "created_at": "2018-08-05T11:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501437",
    "user": "https://github.com/timokau"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                      |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[e3ddaf8](https://github.com/sagemath/sagetrac-mirror/commit/e3ddaf81108343c05aee7a1231dd3cbb4d74b5a8)|`Enable 64 bit interface for openblas`|



---

archive/issue_comments_501438.json:
```json
{
    "body": "Changing commit from \"\" to \"e3ddaf81108343c05aee7a1231dd3cbb4d74b5a8\"",
    "created_at": "2018-08-05T11:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501438",
    "user": "https://github.com/timokau"
}
```

Changing commit from "" to "e3ddaf81108343c05aee7a1231dd3cbb4d74b5a8"



---

archive/issue_comments_501439.json:
```json
{
    "body": "Changing branch from \"\" to \"public/26000\"",
    "created_at": "2018-08-05T11:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501439",
    "user": "https://github.com/timokau"
}
```

Changing branch from "" to "public/26000"



---

archive/issue_comments_501440.json:
```json
{
    "body": "Replying to [ticket:26000 gh-timokau]:\n> By default, openblas compiles with a 32 bit interface (even when the binary is 64 bit). To build with the 64 bit interface, you have to set the [INTERFACE64](https://github.com/xianyi/OpenBLAS/blob/b03ae3f4dc90a3bde83b98f3fd67e8c618c0390b/Makefile.rule#L115) environment variable. [Here](https://github.com/Homebrew/homebrew-science/issues/48#issuecomment-11636954) is some discussion about the differences.\n\n\nAfter reading that page, I don't think that we should enable INTERFACE64. An environment variable to change the API? That makes no sense to me...\n\nSo why should we do this?",
    "created_at": "2018-08-07T14:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501440",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:26000 gh-timokau]:
> By default, openblas compiles with a 32 bit interface (even when the binary is 64 bit). To build with the 64 bit interface, you have to set the [INTERFACE64](https://github.com/xianyi/OpenBLAS/blob/b03ae3f4dc90a3bde83b98f3fd67e8c618c0390b/Makefile.rule#L115) environment variable. [Here](https://github.com/Homebrew/homebrew-science/issues/48#issuecomment-11636954) is some discussion about the differences.


After reading that page, I don't think that we should enable INTERFACE64. An environment variable to change the API? That makes no sense to me...

So why should we do this?



---

archive/issue_comments_501441.json:
```json
{
    "body": "<a id='comment:4'></a>\nDid you maybe misunderstand that? Its a configure-time variable, nothing unusual. Not runtime.\n\nThe advantages would be higher precision data types and higher compatibility with system openblas.",
    "created_at": "2018-08-07T18:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501441",
    "user": "https://github.com/timokau"
}
```

<a id='comment:4'></a>
Did you maybe misunderstand that? Its a configure-time variable, nothing unusual. Not runtime.

The advantages would be higher precision data types and higher compatibility with system openblas.



---

archive/issue_comments_501442.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [gh-timokau](#comment%3A4):\n> higher compatibility with system openblas.\n\n\nDo distros set INTERFACE64?",
    "created_at": "2018-08-07T19:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501442",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:5'></a>
Replying to [gh-timokau](#comment%3A4):
> higher compatibility with system openblas.


Do distros set INTERFACE64?



---

archive/issue_comments_501443.json:
```json
{
    "body": "<a id='comment:6'></a>\nIn nix we have two versions, `openblas` and `openblasCompat`. `openblas` uses `INTERFACE64` on 64 bit machines while `openblasCompat` always uses 32.\n\nIts harder for other distros to have multiple variants of the same library though, so maybe they just use the `Compat` version all the time. I don't know for sure. Either way, if we figure out where the `INTERFACE64` failures are coming from we would keep compatibility for 32 bit anyways. So it would be a win-win.",
    "created_at": "2018-08-07T19:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501443",
    "user": "https://github.com/timokau"
}
```

<a id='comment:6'></a>
In nix we have two versions, `openblas` and `openblasCompat`. `openblas` uses `INTERFACE64` on 64 bit machines while `openblasCompat` always uses 32.

Its harder for other distros to have multiple variants of the same library though, so maybe they just use the `Compat` version all the time. I don't know for sure. Either way, if we figure out where the `INTERFACE64` failures are coming from we would keep compatibility for 32 bit anyways. So it would be a win-win.



---

archive/issue_comments_501444.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [gh-timokau](#comment%3A6):\n> In nix we have two versions, `openblas` and `openblasCompat`. `openblas` uses `INTERFACE64` on 64 bit machines while `openblasCompat` always uses 32.\n\n\nSo then use `openblasCompat`.\n\nIt's still not clear which bug this ticket is supposed to fix...",
    "created_at": "2018-08-10T19:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501444",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
Replying to [gh-timokau](#comment%3A6):
> In nix we have two versions, `openblas` and `openblasCompat`. `openblas` uses `INTERFACE64` on 64 bit machines while `openblasCompat` always uses 32.


So then use `openblasCompat`.

It's still not clear which bug this ticket is supposed to fix...



---

archive/issue_comments_501445.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jdemeyer](#comment%3A7):\n> It's still not clear which bug this ticket is supposed to fix...\n\n\nIts an enhancement. Nix specific, using openblasCompat means we also have to build two versions of flint and two versions of all the sage dependencies that depend on flint. Thats a bit annoying.\n\nIn general, 64 bit is not only the future, I would argue it is the present. I don't know how long other distros will keep INTERFACET64=0 (if they currently do that). And ignoring distros for the moment, the main reason for 64 bit are 64 bit datatypes of course.",
    "created_at": "2018-08-10T20:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26000#issuecomment-501445",
    "user": "https://github.com/timokau"
}
```

<a id='comment:8'></a>
Replying to [jdemeyer](#comment%3A7):
> It's still not clear which bug this ticket is supposed to fix...


Its an enhancement. Nix specific, using openblasCompat means we also have to build two versions of flint and two versions of all the sage dependencies that depend on flint. Thats a bit annoying.

In general, 64 bit is not only the future, I would argue it is the present. I don't know how long other distros will keep INTERFACET64=0 (if they currently do that). And ignoring distros for the moment, the main reason for 64 bit are 64 bit datatypes of course.
