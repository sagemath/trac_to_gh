# Issue 26360: Upgrade arb to 2.15.1

archive/issues_026123.json:
```json
{
    "body": "Arb 2.15.1 is out and the upgrade breaks a lot (~200) doctests with changes that are not actually failures. Nearly all the changes are minor differences in the accuracy of the radius. As previously discussed in #25966, I think we should fix this once and for all. The tests are brittle and break with more or less every arb upgrade. All those \"failures\" distract from the actual failures. It makes arb upgrades painful and is a burden on distributions.\n\nI suspect the solution here (lots of `...`) will be controversial. I don't like it very much myself. But I think it is better than the status quo. What we really want are different tolerances for the \"mid\" and the \"radius\". I don't know if that is possible in the doctesting framework without explicitly testing for `.mid()` and `.radius()` in different tests each time. We may even want to test the `.accuracy()` instead of the radius.\n\nUpstream tarball: \u200bhttps://github.com/fredrik-johansson/arb/archive/2.15.1.tar.gz\n\nCC:  @fredrik-johansson @embray @mezzarobba @jdemeyer @kiwifb\n\nKeywords: arb, upgrade\n\nBranch/Commit: 30cc778d46579bd0c7537ed33e8d7a4f40fd5c31\n\nReviewer: Marc Mezzarobba\n\nAuthor: Timo Kaufmann\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26360\n\n",
    "closed_at": "2018-12-07T12:10:46Z",
    "created_at": "2018-09-28T15:16:48Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Upgrade arb to 2.15.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26360",
    "user": "https://github.com/timokau"
}
```
Arb 2.15.1 is out and the upgrade breaks a lot (~200) doctests with changes that are not actually failures. Nearly all the changes are minor differences in the accuracy of the radius. As previously discussed in #25966, I think we should fix this once and for all. The tests are brittle and break with more or less every arb upgrade. All those "failures" distract from the actual failures. It makes arb upgrades painful and is a burden on distributions.

I suspect the solution here (lots of `...`) will be controversial. I don't like it very much myself. But I think it is better than the status quo. What we really want are different tolerances for the "mid" and the "radius". I don't know if that is possible in the doctesting framework without explicitly testing for `.mid()` and `.radius()` in different tests each time. We may even want to test the `.accuracy()` instead of the radius.

Upstream tarball: ​https://github.com/fredrik-johansson/arb/archive/2.15.1.tar.gz

CC:  @fredrik-johansson @embray @mezzarobba @jdemeyer @kiwifb

Keywords: arb, upgrade

Branch/Commit: 30cc778d46579bd0c7537ed33e8d7a4f40fd5c31

Reviewer: Marc Mezzarobba

Author: Timo Kaufmann

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26360





---

archive/issue_comments_506857.json:
```json
{
    "body": "<a id='comment:1'></a>It would be nice to have some hook for doctests so that balls by default are compared in terms of overlapping and that the radii are the same within a factor 10, say.",
    "created_at": "2018-09-28T15:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506857",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:1'></a>It would be nice to have some hook for doctests so that balls by default are compared in terms of overlapping and that the radii are the same within a factor 10, say.



---

archive/issue_comments_506858.json:
```json
{
    "body": "Replying to [ticket:26360 gh-timokau]:\n> I suspect the solution here (lots of `...`) will be controversial. I don't like it very much myself.\n\n\nI'm okay with it, but I'd like to see what Jeroen says since he insisted for exact doctests back then.\n\n> What we really want are different tolerances for the \"mid\" and the \"radius\".\n\n\nIs that really necessary? If you use absolute tolerances, having the same tolerance for the center and the radius isn't too bad.\n\nSomething like what Fredrik suggests would be better, of course. Since arb provides a way to parse strings of the form `[mid +/- rad]`, it is perhaps doable. (I'm not volunteering, though...)",
    "created_at": "2018-09-29T08:05:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506858",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [ticket:26360 gh-timokau]:
> I suspect the solution here (lots of `...`) will be controversial. I don't like it very much myself.


I'm okay with it, but I'd like to see what Jeroen says since he insisted for exact doctests back then.

> What we really want are different tolerances for the "mid" and the "radius".


Is that really necessary? If you use absolute tolerances, having the same tolerance for the center and the radius isn't too bad.

Something like what Fredrik suggests would be better, of course. Since arb provides a way to parse strings of the form `[mid +/- rad]`, it is perhaps doable. (I'm not volunteering, though...)



---

archive/issue_comments_506859.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 mmezzarobba]:\n> Replying to [ticket:26360 gh-timokau]:\n> > I suspect the solution here (lots of `...`) will be controversial. I don't like it very much myself.\n\n> \n> I'm okay with it, but I'd like to see what Jeroen says since he insisted for exact doctests back then.\n\n\nJeroen, do you still insist on exact doctests here?",
    "created_at": "2018-10-20T21:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506859",
    "user": "https://github.com/timokau"
}
```

<a id='comment:4'></a>Replying to [comment:3 mmezzarobba]:
> Replying to [ticket:26360 gh-timokau]:
> > I suspect the solution here (lots of `...`) will be controversial. I don't like it very much myself.

> 
> I'm okay with it, but I'd like to see what Jeroen says since he insisted for exact doctests back then.


Jeroen, do you still insist on exact doctests here?



---

archive/issue_comments_506860.json:
```json
{
    "body": "<a id='comment:5'></a>> > What we really want are different tolerances for the \"mid\" and the \"radius\".\n\n> \n> Is that really necessary? If you use absolute tolerances, having the same tolerance for the center and the radius isn't too bad.\n\n\nThat might also a (while not pretty) workable solution.\n\n> Something like what Fredrik suggests would be better, of course. Since arb provides a way to parse strings of the form `[mid +/- rad]`, it is perhaps doable. (I'm not volunteering, though...)\n\n\nIs the doctesting framework even that flexible?",
    "created_at": "2018-10-20T21:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506860",
    "user": "https://github.com/timokau"
}
```

<a id='comment:5'></a>> > What we really want are different tolerances for the "mid" and the "radius".

> 
> Is that really necessary? If you use absolute tolerances, having the same tolerance for the center and the radius isn't too bad.


That might also a (while not pretty) workable solution.

> Something like what Fredrik suggests would be better, of course. Since arb provides a way to parse strings of the form `[mid +/- rad]`, it is perhaps doable. (I'm not volunteering, though...)


Is the doctesting framework even that flexible?



---

archive/issue_comments_506861.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 gh-timokau]:\n> Jeroen, do you still insist on exact doctests here?\n\n\nI don't recall why I originally insisted on that. So go ahead.",
    "created_at": "2018-10-21T08:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506861",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>Replying to [comment:4 gh-timokau]:
> Jeroen, do you still insist on exact doctests here?


I don't recall why I originally insisted on that. So go ahead.



---

archive/issue_comments_506862.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:3 mmezzarobba]:\n> Something like what Fredrik suggests would be better, of course. Since arb provides a way to parse strings of the form `[mid +/- rad]`, it is perhaps doable. (I'm not volunteering, though...)\n\n\nI'm not convinced that we need to patch the doctest framework for that.",
    "created_at": "2018-10-21T08:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506862",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>Replying to [comment:3 mmezzarobba]:
> Something like what Fredrik suggests would be better, of course. Since arb provides a way to parse strings of the form `[mid +/- rad]`, it is perhaps doable. (I'm not volunteering, though...)


I'm not convinced that we need to patch the doctest framework for that.



---

archive/issue_comments_506863.json:
```json
{
    "body": "<a id='comment:8'></a>I can't really do much about the remaining failures, since I lack the subject knowledge to decide weather or not they are real errors:\n\n```\nsage -t --long src/sage/rings/complex_arb.pyx\n**********************************************************************\nFile \"src/sage/rings/complex_arb.pyx\", line 4403, in sage.rings.complex_arb.ComplexBall.elliptic_f\nFailed example:\n    (CBF.pi()/2).elliptic_f(phi)\nExpected:\n    [1.5092369540513 +/- ...e-14] + [0.6251464152027 +/- ...e-14]*I\nGot:\n    nan + nan*I\n**********************************************************************\nFile \"src/sage/rings/complex_arb.pyx\", line 4409, in sage.rings.complex_arb.ComplexBall.elliptic_f\nFailed example:\n    (CBF.pi()/2).elliptic_f(phi)\nExpected:\n    [1.3393589639094 +/- ...e-14] + [1.1104369690719 +/- ...e-14]*I\nGot:\n    nan + nan*I\n**********************************************************************\nFile \"src/sage/rings/complex_arb.pyx\", line 4441, in sage.rings.complex_arb.ComplexBall.elliptic_e_inc\nFailed example:\n    (CBF.pi()/2).elliptic_e_inc(phi)\nExpected:\n    [1.2838409578982 +/- ...e-14] + [-0.5317843366915 +/- ...e-14]*I\nGot:\n    nan + nan*I\n**********************************************************************\nFile \"src/sage/rings/complex_arb.pyx\", line 4447, in sage.rings.complex_arb.ComplexBall.elliptic_e_inc\nFailed example:\n    (CBF.pi()/2).elliptic_e_inc(phi)\nExpected:\n    [0.787564350925 +/- ...e-13] + [-0.686896129145 +/- ...e-13]*I\nGot:\n    nan + nan*I\n**********************************************************************\nFile \"src/sage/rings/complex_arb.pyx\", line 4481, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\nFailed example:\n    n.elliptic_pi_inc(CBF.pi()/2, m)\nExpected:\n    [0.8934793755173 +/- ...e-14] + [0.95707868710750 +/- ...e-15]*I\nGot:\n    nan + nan*I\n**********************************************************************\nFile \"src/sage/rings/complex_arb.pyx\", line 4488, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\nFailed example:\n    n.elliptic_pi_inc(CBF.pi()/2, m)\nExpected:\n    [0.2969588746419 +/- ...e-14] + [1.318879533274 +/- ...e-13]*I\nGot:\n    nan + nan*I\n**********************************************************************\n3 items had failures:\n   2 of   8 in sage.rings.complex_arb.ComplexBall.elliptic_e_inc\n   2 of   8 in sage.rings.complex_arb.ComplexBall.elliptic_f\n   2 of  10 in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc\n    [622 tests, 6 failures, 11.97 s]\n```\n\n```\nsage -t --long src/sage/rings/real_arb.pyx\n**********************************************************************\nFile \"src/sage/rings/real_arb.pyx\", line 1305, in sage.rings.real_arb.RealBall.__init__\nFailed example:\n    RBF(\"2.3e10000000000000000000000 +/- ...e10000000000000000000000\")\nException raised:\n    Traceback (most recent call last):\n      File \"/home/timo/repos2/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 659, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/timo/repos2/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1070, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.real_arb.RealBall.__init__[35]>\", line 1, in <module>\n        RBF(\"2.3e10000000000000000000000 +/- ...e10000000000000000000000\")\n      File \"sage/structure/parent.pyx\", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 145, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4574)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 140, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4462)\n        return C._element_constructor(x)\n      File \"sage/rings/real_arb.pyx\", line 512, in sage.rings.real_arb.RealBallField._element_constructor_ (build/cythonized/sage/rings/real_arb.c:5843)\n        return self.element_class(self, mid, rad)\n      File \"sage/rings/real_arb.pyx\", line 1376, in sage.rings.real_arb.RealBall.__init__ (build/cythonized/sage/rings/real_arb.c:13451)\n        raise ValueError(\"unsupported string format\")\n    ValueError: unsupported string format\n**********************************************************************\n1 item had failures:\n   1 of  48 in sage.rings.real_arb.RealBall.__init__\n    [530 tests, 1 failure, 0.78 s]\n```",
    "created_at": "2018-10-23T21:34:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506863",
    "user": "https://github.com/timokau"
}
```

<a id='comment:8'></a>I can't really do much about the remaining failures, since I lack the subject knowledge to decide weather or not they are real errors:

```
sage -t --long src/sage/rings/complex_arb.pyx
**********************************************************************
File "src/sage/rings/complex_arb.pyx", line 4403, in sage.rings.complex_arb.ComplexBall.elliptic_f
Failed example:
    (CBF.pi()/2).elliptic_f(phi)
Expected:
    [1.5092369540513 +/- ...e-14] + [0.6251464152027 +/- ...e-14]*I
Got:
    nan + nan*I
**********************************************************************
File "src/sage/rings/complex_arb.pyx", line 4409, in sage.rings.complex_arb.ComplexBall.elliptic_f
Failed example:
    (CBF.pi()/2).elliptic_f(phi)
Expected:
    [1.3393589639094 +/- ...e-14] + [1.1104369690719 +/- ...e-14]*I
Got:
    nan + nan*I
**********************************************************************
File "src/sage/rings/complex_arb.pyx", line 4441, in sage.rings.complex_arb.ComplexBall.elliptic_e_inc
Failed example:
    (CBF.pi()/2).elliptic_e_inc(phi)
Expected:
    [1.2838409578982 +/- ...e-14] + [-0.5317843366915 +/- ...e-14]*I
Got:
    nan + nan*I
**********************************************************************
File "src/sage/rings/complex_arb.pyx", line 4447, in sage.rings.complex_arb.ComplexBall.elliptic_e_inc
Failed example:
    (CBF.pi()/2).elliptic_e_inc(phi)
Expected:
    [0.787564350925 +/- ...e-13] + [-0.686896129145 +/- ...e-13]*I
Got:
    nan + nan*I
**********************************************************************
File "src/sage/rings/complex_arb.pyx", line 4481, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi_inc(CBF.pi()/2, m)
Expected:
    [0.8934793755173 +/- ...e-14] + [0.95707868710750 +/- ...e-15]*I
Got:
    nan + nan*I
**********************************************************************
File "src/sage/rings/complex_arb.pyx", line 4488, in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
Failed example:
    n.elliptic_pi_inc(CBF.pi()/2, m)
Expected:
    [0.2969588746419 +/- ...e-14] + [1.318879533274 +/- ...e-13]*I
Got:
    nan + nan*I
**********************************************************************
3 items had failures:
   2 of   8 in sage.rings.complex_arb.ComplexBall.elliptic_e_inc
   2 of   8 in sage.rings.complex_arb.ComplexBall.elliptic_f
   2 of  10 in sage.rings.complex_arb.ComplexBall.elliptic_pi_inc
    [622 tests, 6 failures, 11.97 s]
```

```
sage -t --long src/sage/rings/real_arb.pyx
**********************************************************************
File "src/sage/rings/real_arb.pyx", line 1305, in sage.rings.real_arb.RealBall.__init__
Failed example:
    RBF("2.3e10000000000000000000000 +/- ...e10000000000000000000000")
Exception raised:
    Traceback (most recent call last):
      File "/home/timo/repos2/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/timo/repos2/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.real_arb.RealBall.__init__[35]>", line 1, in <module>
        RBF("2.3e10000000000000000000000 +/- ...e10000000000000000000000")
      File "sage/structure/parent.pyx", line 921, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9679)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 145, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4574)
        raise
      File "sage/structure/coerce_maps.pyx", line 140, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4462)
        return C._element_constructor(x)
      File "sage/rings/real_arb.pyx", line 512, in sage.rings.real_arb.RealBallField._element_constructor_ (build/cythonized/sage/rings/real_arb.c:5843)
        return self.element_class(self, mid, rad)
      File "sage/rings/real_arb.pyx", line 1376, in sage.rings.real_arb.RealBall.__init__ (build/cythonized/sage/rings/real_arb.c:13451)
        raise ValueError("unsupported string format")
    ValueError: unsupported string format
**********************************************************************
1 item had failures:
   1 of  48 in sage.rings.real_arb.RealBall.__init__
    [530 tests, 1 failure, 0.78 s]
```



---

archive/issue_comments_506864.json:
```json
{
    "body": "<a id='comment:9'></a>That's a genuine regression in Arb 2.15. I have not tried to debug it, but quite likely the original code was buggy and only worked by accident -- it works if you add CBF(\"+/- 1e-10\") to pi/2.",
    "created_at": "2018-10-24T13:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506864",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:9'></a>That's a genuine regression in Arb 2.15. I have not tried to debug it, but quite likely the original code was buggy and only worked by accident -- it works if you add CBF("+/- 1e-10") to pi/2.



---

archive/issue_comments_506865.json:
```json
{
    "body": "<a id='comment:10'></a>> it works if you add CBF(\"+/- 1e-10\") to pi/2\n\n\nSo should we just do that in the doctests?",
    "created_at": "2018-10-24T13:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506865",
    "user": "https://github.com/timokau"
}
```

<a id='comment:10'></a>> it works if you add CBF("+/- 1e-10") to pi/2


So should we just do that in the doctests?



---

archive/issue_comments_506866.json:
```json
{
    "body": "<a id='comment:11'></a>This commit should provide a bugfix: https://github.com/fredrik-johansson/arb/commit/eb60d7ac4ee85cd6f8353dd9cf52a10bfd5967c3\n\nThe other failure (\"unsupported string format\") is due to too greedy search & replace to insert ...",
    "created_at": "2018-10-24T20:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506866",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:11'></a>This commit should provide a bugfix: https://github.com/fredrik-johansson/arb/commit/eb60d7ac4ee85cd6f8353dd9cf52a10bfd5967c3

The other failure ("unsupported string format") is due to too greedy search & replace to insert ...



---

archive/issue_comments_506867.json:
```json
{
    "body": "<a id='comment:12'></a>Do you plan to make a release with that fix included anytime soon?",
    "created_at": "2018-10-24T21:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506867",
    "user": "https://github.com/timokau"
}
```

<a id='comment:12'></a>Do you plan to make a release with that fix included anytime soon?



---

archive/issue_comments_506868.json:
```json
{
    "body": "<a id='comment:13'></a>Done. https://github.com/fredrik-johansson/arb/archive/2.15.1.tar.gz",
    "created_at": "2018-10-25T19:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506868",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:13'></a>Done. https://github.com/fredrik-johansson/arb/archive/2.15.1.tar.gz



---

archive/issue_comments_506869.json:
```json
{
    "body": "<a id='comment:14'></a>Thank you! Could you expand on what you mean by \"due to too greedy search & replace to insert\"? As far as I can see it is caused by `arb_set_str` returning false.",
    "created_at": "2018-10-26T16:19:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506869",
    "user": "https://github.com/timokau"
}
```

<a id='comment:14'></a>Thank you! Could you expand on what you mean by "due to too greedy search & replace to insert"? As far as I can see it is caused by `arb_set_str` returning false.



---

archive/issue_comments_506870.json:
```json
{
    "body": "<a id='comment:15'></a>There is \"...\" in the input string which shouldn't have been inserted there in place of the numerical value.",
    "created_at": "2018-10-26T16:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506870",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:15'></a>There is "..." in the input string which shouldn't have been inserted there in place of the numerical value.



---

archive/issue_comments_506871.json:
```json
{
    "body": "Changing commit from \"00d3ccd2ee230d9252b9cdc3183adf9c7f9f45ad\" to \"30cc778d46579bd0c7537ed33e8d7a4f40fd5c31\"",
    "created_at": "2018-10-27T07:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "00d3ccd2ee230d9252b9cdc3183adf9c7f9f45ad" to "30cc778d46579bd0c7537ed33e8d7a4f40fd5c31"



---

archive/issue_comments_506872.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-27T07:42:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_506873.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-27T07:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506873",
    "user": "https://github.com/timokau"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_506874.json:
```json
{
    "body": "<a id='comment:17'></a>Oh, stupid mistake. Thanks.\n\nDoctests pass now.",
    "created_at": "2018-10-27T07:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506874",
    "user": "https://github.com/timokau"
}
```

<a id='comment:17'></a>Oh, stupid mistake. Thanks.

Doctests pass now.



---

archive/issue_comments_506875.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n-Arb 2.15.0 is out and the upgrade breaks a lot (~200) doctests with changes that are not actually failures. Nearly all the changes are minor differences in the accuracy of the radius. As previously discussed in #25966, I think we should fix this once and for all. The tests are brittle and break with more or less every arb upgrade. All those \"failures\" distract from the actual failures. It makes arb upgrades painful and is a burden on distributions.\n+Arb 2.15.1 is out and the upgrade breaks a lot (~200) doctests with changes that are not actually failures. Nearly all the changes are minor differences in the accuracy of the radius. As previously discussed in #25966, I think we should fix this once and for all. The tests are brittle and break with more or less every arb upgrade. All those \"failures\" distract from the actual failures. It makes arb upgrades painful and is a burden on distributions.\n \n I suspect the solution here (lots of `...`) will be controversial. I don't like it very much myself. But I think it is better than the status quo. What we really want are different tolerances for the \"mid\" and the \"radius\". I don't know if that is possible in the doctesting framework without explicitly testing for `.mid()` and `.radius()` in different tests each time. We may even want to test the `.accuracy()` instead of the radius.\n \n-Upstream tarball: \u200bhttps://github.com/fredrik-johansson/arb/archive/2.15.0.tar.gz\n+Upstream tarball: \u200bhttps://github.com/fredrik-johansson/arb/archive/2.15.1.tar.gz\n``````\n",
    "created_at": "2018-10-27T07:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506875",
    "user": "https://github.com/timokau"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
-Arb 2.15.0 is out and the upgrade breaks a lot (~200) doctests with changes that are not actually failures. Nearly all the changes are minor differences in the accuracy of the radius. As previously discussed in #25966, I think we should fix this once and for all. The tests are brittle and break with more or less every arb upgrade. All those "failures" distract from the actual failures. It makes arb upgrades painful and is a burden on distributions.
+Arb 2.15.1 is out and the upgrade breaks a lot (~200) doctests with changes that are not actually failures. Nearly all the changes are minor differences in the accuracy of the radius. As previously discussed in #25966, I think we should fix this once and for all. The tests are brittle and break with more or less every arb upgrade. All those "failures" distract from the actual failures. It makes arb upgrades painful and is a burden on distributions.
 
 I suspect the solution here (lots of `...`) will be controversial. I don't like it very much myself. But I think it is better than the status quo. What we really want are different tolerances for the "mid" and the "radius". I don't know if that is possible in the doctesting framework without explicitly testing for `.mid()` and `.radius()` in different tests each time. We may even want to test the `.accuracy()` instead of the radius.
 
-Upstream tarball: ​https://github.com/fredrik-johansson/arb/archive/2.15.0.tar.gz
+Upstream tarball: ​https://github.com/fredrik-johansson/arb/archive/2.15.1.tar.gz
``````




---

archive/issue_comments_506876.json:
```json
{
    "body": "<a id='comment:18'></a>I think rather than so many `...`, if there are changes we can make to the doctest parser to make these tests a little more natural that would be better, and probably not a big deal...",
    "created_at": "2018-10-28T11:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506876",
    "user": "https://github.com/embray"
}
```

<a id='comment:18'></a>I think rather than so many `...`, if there are changes we can make to the doctest parser to make these tests a little more natural that would be better, and probably not a big deal...



---

archive/issue_comments_506877.json:
```json
{
    "body": "<a id='comment:19'></a>I wouldn't know how to do that.",
    "created_at": "2018-10-28T12:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506877",
    "user": "https://github.com/timokau"
}
```

<a id='comment:19'></a>I wouldn't know how to do that.



---

archive/issue_comments_506878.json:
```json
{
    "body": "<a id='comment:20'></a>I mean, I would, but I don't know exactly what it is you need in this case.",
    "created_at": "2018-10-28T12:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506878",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>I mean, I would, but I don't know exactly what it is you need in this case.



---

archive/issue_comments_506879.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:5 gh-timokau]:\n> > > What we really want are different tolerances for the \"mid\" and the \"radius\".\n\n> > \n> > Is that really necessary? If you use absolute tolerances, having the same tolerance for the center and the radius isn't too bad.\n\n> \n> That might also a (while not pretty) workable solution.\n\n\nDid you ever try this?  I don't really see it as \"pretty\" or not \"pretty\".  An `# abs tol` will apply to both values, but we really only care about it in this case for the radius.  Technically it would be applied to the mid too but it doesn't matter either way for the present purpose.",
    "created_at": "2018-10-28T12:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506879",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>Replying to [comment:5 gh-timokau]:
> > > What we really want are different tolerances for the "mid" and the "radius".

> > 
> > Is that really necessary? If you use absolute tolerances, having the same tolerance for the center and the radius isn't too bad.

> 
> That might also a (while not pretty) workable solution.


Did you ever try this?  I don't really see it as "pretty" or not "pretty".  An `# abs tol` will apply to both values, but we really only care about it in this case for the radius.  Technically it would be applied to the mid too but it doesn't matter either way for the present purpose.



---

archive/issue_comments_506880.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:20 embray]:\n> I mean, I would, but I don't know exactly what it is you need in this case.\n\n\nWe'd need to use proper comparison methods instead of just comparing the digits. Something like what Frederik [comment:1 said].\n\nReplying to [comment:21 embray]:\n> Replying to [comment:5 gh-timokau]:\n> > > > What we really want are different tolerances for the \"mid\" and the \"radius\".\n\n> > > \n> > > Is that really necessary? If you use absolute tolerances, having the same tolerance for the center and the radius isn't too bad.\n\n> > \n> > That might also a (while not pretty) workable solution.\n\n> \n> Did you ever try this?  I don't really see it as \"pretty\" or not \"pretty\".  An `# abs tol` will apply to both values, but we really only care about it in this case for the radius.  Technically it would be applied to the mid too but it doesn't matter either way for the present purpose.\n\n\nNo I haven't. It would require either a lot of manual adding of `# abs tol` or a very clever sed script. It doesn't have high enough priority for me right now to spend the time doing that, but I'd be happy with the solution if somebody else would.",
    "created_at": "2018-10-29T08:47:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506880",
    "user": "https://github.com/timokau"
}
```

<a id='comment:22'></a>Replying to [comment:20 embray]:
> I mean, I would, but I don't know exactly what it is you need in this case.


We'd need to use proper comparison methods instead of just comparing the digits. Something like what Frederik [comment:1 said].

Replying to [comment:21 embray]:
> Replying to [comment:5 gh-timokau]:
> > > > What we really want are different tolerances for the "mid" and the "radius".

> > > 
> > > Is that really necessary? If you use absolute tolerances, having the same tolerance for the center and the radius isn't too bad.

> > 
> > That might also a (while not pretty) workable solution.

> 
> Did you ever try this?  I don't really see it as "pretty" or not "pretty".  An `# abs tol` will apply to both values, but we really only care about it in this case for the radius.  Technically it would be applied to the mid too but it doesn't matter either way for the present purpose.


No I haven't. It would require either a lot of manual adding of `# abs tol` or a very clever sed script. It doesn't have high enough priority for me right now to spend the time doing that, but I'd be happy with the solution if somebody else would.



---

archive/issue_comments_506881.json:
```json
{
    "body": "<a id='comment:23'></a>I'll give it a try and see.  I'm pretty good at ridiculous regular expressions :)",
    "created_at": "2018-10-31T13:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506881",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>I'll give it a try and see.  I'm pretty good at ridiculous regular expressions :)



---

archive/issue_comments_506882.json:
```json
{
    "body": "<a id='comment:24'></a>I suggest merging this as-is. The doctest improvement would be nice to have but it's not worth delaying the upgrade over it.",
    "created_at": "2018-11-06T09:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506882",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:24'></a>I suggest merging this as-is. The doctest improvement would be nice to have but it's not worth delaying the upgrade over it.



---

archive/issue_comments_506883.json:
```json
{
    "body": "<a id='comment:25'></a>`@`fredrik.johansson was that a review? I'm guessing `@`embray has different priorities right now, would be nice to get this into the next release.",
    "created_at": "2018-11-26T21:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506883",
    "user": "https://github.com/timokau"
}
```

<a id='comment:25'></a>`@`fredrik.johansson was that a review? I'm guessing `@`embray has different priorities right now, would be nice to get this into the next release.



---

archive/issue_comments_506884.json:
```json
{
    "body": "<a id='comment:26'></a>It's true I have different priorities.  I'm pretty sad about this doctest issue but not enough to do anything about it *right now* so I don't think this should be held up over it.  I'll open a ticket though.",
    "created_at": "2018-11-27T10:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506884",
    "user": "https://github.com/embray"
}
```

<a id='comment:26'></a>It's true I have different priorities.  I'm pretty sad about this doctest issue but not enough to do anything about it *right now* so I don't think this should be held up over it.  I'll open a ticket though.



---

archive/issue_comments_506885.json:
```json
{
    "body": "<a id='comment:27'></a>See #26774 with an idea for a generalized solution.",
    "created_at": "2018-11-27T10:28:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506885",
    "user": "https://github.com/embray"
}
```

<a id='comment:27'></a>See #26774 with an idea for a generalized solution.



---

archive/issue_comments_506886.json:
```json
{
    "body": "<a id='comment:28'></a>#26774 would be really nice. In addition to arb I'm sure there are a lot of other areas where the doctests could be improved. That'll take a while however.\n\nLets get this merged for now.",
    "created_at": "2018-11-27T14:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506886",
    "user": "https://github.com/timokau"
}
```

<a id='comment:28'></a>#26774 would be really nice. In addition to arb I'm sure there are a lot of other areas where the doctests could be improved. That'll take a while however.

Lets get this merged for now.



---

archive/issue_comments_506887.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 gh-timokau]:\n> #26774 would be really nice. In addition to arb I'm sure there are a lot of other areas where the doctests could be improved. That'll take a while however.\n> \n> Lets get this merged for now.\n\n\nI agree.",
    "created_at": "2018-12-05T12:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506887",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:29'></a>Replying to [comment:28 gh-timokau]:
> #26774 would be really nice. In addition to arb I'm sure there are a lot of other areas where the doctests could be improved. That'll take a while however.
> 
> Lets get this merged for now.


I agree.



---

archive/issue_comments_506888.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-05T12:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506888",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_506889.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Marc Mezzarobba\"",
    "created_at": "2018-12-05T12:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506889",
    "user": "https://github.com/mezzarobba"
}
```

Changing reviewer from "" to "Marc Mezzarobba"



---

archive/issue_events_065573.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-07T12:10:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26360#event-65573"
}
```



---

archive/issue_comments_506890.json:
```json
{
    "body": "Changing branch from \"u/gh-timokau/arb-2.15.0\" to \"30cc778d46579bd0c7537ed33e8d7a4f40fd5c31\"",
    "created_at": "2018-12-07T12:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506890",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-timokau/arb-2.15.0" to "30cc778d46579bd0c7537ed33e8d7a4f40fd5c31"



---

archive/issue_comments_506891.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-07T12:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26360",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26360#issuecomment-506891",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
