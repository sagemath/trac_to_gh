# Issue 26898: Hashes of some Algebraic Field elements hang indefinitely

archive/issues_026661.json:
```json
{
    "body": "Keywords: hash, algebraic field\n\nThe following code hangs on both Sage 7.5.1 and Sage 8.4:\n\n```\nR.<a> = QQ[]\nNF.<b> = NumberField(4*a^7 + 27)\nfor hom in NF.embeddings(QQbar):\n   print hash(hom(b))\n```\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26898\n\n",
    "closed_at": "2018-12-23T23:39:44Z",
    "created_at": "2018-12-14T21:45:47Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.6",
    "title": "Hashes of some Algebraic Field elements hang indefinitely",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26898",
    "user": "https://github.com/BrentBaccala"
}
```
Keywords: hash, algebraic field

The following code hangs on both Sage 7.5.1 and Sage 8.4:

```
R.<a> = QQ[]
NF.<b> = NumberField(4*a^7 + 27)
for hom in NF.embeddings(QQbar):
   print hash(hom(b))
```



Issue created by migration from https://trac.sagemath.org/ticket/26898





---

archive/issue_comments_374333.json:
```json
{
    "body": "Here's another test case that I constructed after drilling down through the code:\n\n```\nfrom sage.rings.qqbar import AlgebraicGenerator, ANRoot\n\nR.<y> = QQ[]\ngen = y^14 - 6*y^7 + 18\nNF.<a> = NumberField(gen)\n\nroot1 = ANRoot(gen, CIF(NF.embeddings(QQbar)[0](a)))\nroot2 = ANRoot(gen, CIF(NF.embeddings(QQbar)[1](a)))\n\nag1 = AlgebraicGenerator(NF, root1)\nag2 = AlgebraicGenerator(NF, root2)\n\nag1.union(ag2)\n\n```\n\nChanging `gen` around produces different answers.  `gen = y^2+18` produces the answer I'd expect from `union`: a number field defined by y<sup>2</sup> + 18.  `gen = y^3+18` produces a number field defined by a sixth degree polynomial; `gen = y^7 + 18` produces a number field defined by a 42<sup>nd</sup> degree polynomial.\n\nI guess the 14<sup>th</sup> degree polynomial leads to a calculation that takes excessively long, but I think it should be a very simple calculation if the two `AlgebraicGenerator`'s are from the same number field - it should just return that field, right?",
    "created_at": "2018-12-17T21:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374333",
    "user": "https://github.com/BrentBaccala"
}
```

Here's another test case that I constructed after drilling down through the code:

```
from sage.rings.qqbar import AlgebraicGenerator, ANRoot

R.<y> = QQ[]
gen = y^14 - 6*y^7 + 18
NF.<a> = NumberField(gen)

root1 = ANRoot(gen, CIF(NF.embeddings(QQbar)[0](a)))
root2 = ANRoot(gen, CIF(NF.embeddings(QQbar)[1](a)))

ag1 = AlgebraicGenerator(NF, root1)
ag2 = AlgebraicGenerator(NF, root2)

ag1.union(ag2)

```

Changing `gen` around produces different answers.  `gen = y^2+18` produces the answer I'd expect from `union`: a number field defined by y<sup>2</sup> + 18.  `gen = y^3+18` produces a number field defined by a sixth degree polynomial; `gen = y^7 + 18` produces a number field defined by a 42<sup>nd</sup> degree polynomial.

I guess the 14<sup>th</sup> degree polynomial leads to a calculation that takes excessively long, but I think it should be a very simple calculation if the two `AlgebraicGenerator`'s are from the same number field - it should just return that field, right?



---

archive/issue_comments_374334.json:
```json
{
    "body": "Now that I've thought about it more, the number field might not be a splitting field, so it's more complicated than returning the same field.",
    "created_at": "2018-12-18T00:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374334",
    "user": "https://github.com/BrentBaccala"
}
```

Now that I've thought about it more, the number field might not be a splitting field, so it's more complicated than returning the same field.



---

archive/issue_comments_374335.json:
```json
{
    "body": "I found some comments in the code suggesting that when approximations to algebraic numbers are computed, an attempt is made to use 40 extra bits of precision, but it doesn't seem like that every actually got done.\n\nI made the obvious change to actually compute 40 extra bits, and it seems to have solved my problem.\n\n---\nNew commits:",
    "created_at": "2018-12-18T22:46:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374335",
    "user": "https://github.com/BrentBaccala"
}
```

I found some comments in the code suggesting that when approximations to algebraic numbers are computed, an attempt is made to use 40 extra bits of precision, but it doesn't seem like that every actually got done.

I made the obvious change to actually compute 40 extra bits, and it seems to have solved my problem.

---
New commits:



---

archive/issue_comments_374336.json:
```json
{
    "body": "Should the ticket be set to needs_review?",
    "created_at": "2018-12-19T08:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374336",
    "user": "https://github.com/mezzarobba"
}
```

Should the ticket be set to needs_review?



---

archive/issue_comments_374337.json:
```json
{
    "body": "Replying to [comment:4 mmezzarobba]:\n> Should the ticket be set to needs_review?\n\n\nYes, but I'm waiting for it to clear patchbot.",
    "created_at": "2018-12-19T18:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374337",
    "user": "https://github.com/BrentBaccala"
}
```

Replying to [comment:4 mmezzarobba]:
> Should the ticket be set to needs_review?


Yes, but I'm waiting for it to clear patchbot.



---

archive/issue_comments_374338.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-19T19:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374338",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_374339.json:
```json
{
    "body": "Replying to [comment:5 gh-BrentBaccala]:\n> Replying to [comment:4 mmezzarobba]:\n> > Should the ticket be set to needs_review?\n\n> \n> Yes, but I'm waiting for it to clear patchbot.\n\n\nUnless you have your own patchbot with a special configuration, it (probably) won't even run the tests until the ticket needs_review.\n\nBut I've done it locally and all is well.",
    "created_at": "2018-12-19T19:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374339",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:5 gh-BrentBaccala]:
> Replying to [comment:4 mmezzarobba]:
> > Should the ticket be set to needs_review?

> 
> Yes, but I'm waiting for it to clear patchbot.


Unless you have your own patchbot with a special configuration, it (probably) won't even run the tests until the ticket needs_review.

But I've done it locally and all is well.



---

archive/issue_comments_374340.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-19T19:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374340",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_066573.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-23T23:39:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26898#event-66573"
}
```



---

archive/issue_comments_374341.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-23T23:39:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374341",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_374342.json:
```json
{
    "body": "This tickets were closed as fixed after the Sage 8.5 release.",
    "created_at": "2018-12-28T14:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26898#issuecomment-374342",
    "user": "https://github.com/embray"
}
```

This tickets were closed as fixed after the Sage 8.5 release.



---

archive/issue_events_066574.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-12-28T14:06:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26898",
    "milestone": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26898#event-66574"
}
```
