# Issue 26559: Bug in DiGraph.spectral_radius()

archive/issues_026322.json:
```json
{
    "body": "I propose a correction for a bug in DiGraph.spectral_radius().\n\nThe problem.\nThe following code does'nt stop:\n sage: g = DiGraph([(0,1),(1,2),(2,0),(2,0)], multiedges=True)\n sage: g.spectral_radius()\n\nThe solution.\nThe fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is periodic thanks to the function DiGraph.is_aperiodic(), rather that going to an infinite loop.\n\nCC:  @dcoudert @tscrim\n\nBranch/Commit: c3bbe710ec5dfb581c9ebb78086176fc9f4c009f\n\nReviewer: David Coudert\n\nAuthor: Paul Mercat\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26559\n\n",
    "closed_at": "2018-11-07T11:28:09Z",
    "created_at": "2018-10-26T10:40:43Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Bug in DiGraph.spectral_radius()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26559",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```
I propose a correction for a bug in DiGraph.spectral_radius().

The problem.
The following code does'nt stop:
 sage: g = DiGraph([(0,1),(1,2),(2,0),(2,0)], multiedges=True)
 sage: g.spectral_radius()

The solution.
The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is periodic thanks to the function DiGraph.is_aperiodic(), rather that going to an infinite loop.

CC:  @dcoudert @tscrim

Branch/Commit: c3bbe710ec5dfb581c9ebb78086176fc9f4c009f

Reviewer: David Coudert

Author: Paul Mercat

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26559





---

archive/issue_comments_510537.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n  sage: g.spectral_radius()\n \n The solution.\n-The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is peridic rather that going to an infinite loop.\n+The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is periodic thanks to the function DiGraph.is_aperiodic(), rather that going to an infinite loop.\n \n Author: Paul Mercat\n \n``````\n",
    "created_at": "2018-10-26T11:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510537",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
  sage: g.spectral_radius()
 
 The solution.
-The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is peridic rather that going to an infinite loop.
+The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is periodic thanks to the function DiGraph.is_aperiodic(), rather that going to an infinite loop.
 
 Author: Paul Mercat
 
``````




---

archive/issue_comments_510538.json:
```json
{
    "body": "<a id='comment:3'></a>I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.",
    "created_at": "2018-10-26T15:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510538",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.



---

archive/issue_comments_510539.json:
```json
{
    "body": "<a id='comment:4'></a>One solution to avoid to pay for is_aperiodic() is to throw two threads: one that compute is_aperiodic(), the other one that compute the spectral radius(). If is_aperiodic() returns false, then we stop everything and raise an error. If the computation of the spectral radius ends, then we stop the thread computing is_aperiodic().\n\nReplying to [comment:3 dcoudert]:\n> I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.",
    "created_at": "2018-10-30T21:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510539",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```

<a id='comment:4'></a>One solution to avoid to pay for is_aperiodic() is to throw two threads: one that compute is_aperiodic(), the other one that compute the spectral radius(). If is_aperiodic() returns false, then we stop everything and raise an error. If the computation of the spectral radius ends, then we stop the thread computing is_aperiodic().

Replying to [comment:3 dcoudert]:
> I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.



---

archive/issue_comments_510540.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mercatp/bug_in_digraph_spectral_radius__\"",
    "created_at": "2018-10-30T21:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510540",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```

Changing branch from "" to "u/mercatp/bug_in_digraph_spectral_radius__"



---

archive/issue_comments_510541.json:
```json
{
    "body": "<a id='comment:6'></a>\n```diff\n-    #test if the graph is aperiodic\n-    if not G.is_aperiodic():\n-        raise ValueError(\"The graph must be aperiodic.\")\n+    # test if the graph is aperiodic\n+    if not G.is_aperiodic():\n+        raise ValueError(\"the graph must be aperiodic\")\n```\nand possibly add a doctest\n\n---\nNew commits:",
    "created_at": "2018-10-31T00:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510541",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>
```diff
-    #test if the graph is aperiodic
-    if not G.is_aperiodic():
-        raise ValueError("The graph must be aperiodic.")
+    # test if the graph is aperiodic
+    if not G.is_aperiodic():
+        raise ValueError("the graph must be aperiodic")
```
and possibly add a doctest

---
New commits:



---

archive/issue_comments_510542.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Coudert\"",
    "created_at": "2018-10-31T00:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510542",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "" to "David Coudert"



---

archive/issue_comments_510543.json:
```json
{
    "body": "Changing commit from \"\" to \"a63981648b72842df053687a61528cca43fd06a5\"",
    "created_at": "2018-10-31T00:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510543",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "a63981648b72842df053687a61528cca43fd06a5"



---

archive/issue_comments_510544.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-31T09:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510545.json:
```json
{
    "body": "Changing commit from \"a63981648b72842df053687a61528cca43fd06a5\" to \"cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b\"",
    "created_at": "2018-10-31T09:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510545",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a63981648b72842df053687a61528cca43fd06a5" to "cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b"



---

archive/issue_comments_510546.json:
```json
{
    "body": "<a id='comment:8'></a>You have trailing white space of the line before `#test`, and please add a space before `test`, so do:\n\n```diff\n-    \n-    #test if the graph is aperiodic\n+\n+    # test if the graph is aperiodic\n```",
    "created_at": "2018-10-31T11:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510546",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>You have trailing white space of the line before `#test`, and please add a space before `test`, so do:

```diff
-    
-    #test if the graph is aperiodic
+
+    # test if the graph is aperiodic
```



---

archive/issue_comments_510547.json:
```json
{
    "body": "Changing commit from \"cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b\" to \"a1c6343fe9a4f4e96e6753d064d2224983dc67ea\"",
    "created_at": "2018-10-31T13:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510547",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b" to "a1c6343fe9a4f4e96e6753d064d2224983dc67ea"



---

archive/issue_comments_510548.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-31T13:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510549.json:
```json
{
    "body": "<a id='comment:10'></a>If ready for review, set the ticket to `needs review`",
    "created_at": "2018-11-04T19:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510549",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>If ready for review, set the ticket to `needs review`



---

archive/issue_comments_510550.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-04T21:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510550",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_510551.json:
```json
{
    "body": "<a id='comment:12'></a>Before and after the test `is_aperiodic`, you have introduced lines with trailing white spaces (4 spaces) and this is something to avoid. You must remove these spaces (but keep empty lines).",
    "created_at": "2018-11-05T07:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510551",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>Before and after the test `is_aperiodic`, you have introduced lines with trailing white spaces (4 spaces) and this is something to avoid. You must remove these spaces (but keep empty lines).



---

archive/issue_comments_510552.json:
```json
{
    "body": "Changing commit from \"a1c6343fe9a4f4e96e6753d064d2224983dc67ea\" to \"c3bbe710ec5dfb581c9ebb78086176fc9f4c009f\"",
    "created_at": "2018-11-05T08:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a1c6343fe9a4f4e96e6753d064d2224983dc67ea" to "c3bbe710ec5dfb581c9ebb78086176fc9f4c009f"



---

archive/issue_comments_510553.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-05T08:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_510554.json:
```json
{
    "body": "<a id='comment:14'></a>Looks good to me.",
    "created_at": "2018-11-05T08:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510554",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>Looks good to me.



---

archive/issue_comments_510555.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-05T08:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510555",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_510556.json:
```json
{
    "body": "Changing branch from \"u/mercatp/bug_in_digraph_spectral_radius__\" to \"c3bbe710ec5dfb581c9ebb78086176fc9f4c009f\"",
    "created_at": "2018-11-07T11:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510556",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mercatp/bug_in_digraph_spectral_radius__" to "c3bbe710ec5dfb581c9ebb78086176fc9f4c009f"



---

archive/issue_events_065960.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-07T11:28:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26559#event-65960"
}
```



---

archive/issue_comments_510557.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-07T11:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-510557",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
