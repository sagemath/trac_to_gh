# Issue 26559: Bug in DiGraph.spectral_radius()

archive/issues_026322.json:
```json
{
    "body": "I propose a correction for a bug in DiGraph.spectral_radius().\n\nThe problem.\nThe following code does'nt stop:\n sage: g = DiGraph([(0,1),(1,2),(2,0),(2,0)], multiedges=True)\n sage: g.spectral_radius()\n\nThe solution.\nThe fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is periodic thanks to the function DiGraph.is_aperiodic(), rather that going to an infinite loop.\n\nCC:  @dcoudert @tscrim\n\nBranch/Commit: c3bbe710ec5dfb581c9ebb78086176fc9f4c009f\n\nReviewer: David Coudert\n\nAuthor: Paul Mercat\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26559\n\n",
    "closed_at": "2018-11-07T11:28:09Z",
    "created_at": "2018-10-26T10:40:43Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Bug in DiGraph.spectral_radius()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26559",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```
I propose a correction for a bug in DiGraph.spectral_radius().

The problem.
The following code does'nt stop:
 sage: g = DiGraph([(0,1),(1,2),(2,0),(2,0)], multiedges=True)
 sage: g.spectral_radius()

The solution.
The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is periodic thanks to the function DiGraph.is_aperiodic(), rather that going to an infinite loop.

CC:  @dcoudert @tscrim

Branch/Commit: c3bbe710ec5dfb581c9ebb78086176fc9f4c009f

Reviewer: David Coudert

Author: Paul Mercat

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26559





---

archive/issue_comments_504162.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,4 +6,4 @@\n  sage: g.spectral_radius()\n \n The solution.\n-The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is peridic rather that going to an infinite loop.\n+The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is periodic thanks to the function DiGraph.is_aperiodic(), rather that going to an infinite loop.\n``````\n",
    "created_at": "2018-10-26T11:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504162",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,4 +6,4 @@
  sage: g.spectral_radius()
 
 The solution.
-The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is peridic rather that going to an infinite loop.
+The fact that it doesn't stop comes from the fact that the graph is not aperiodic. So I propose to raise a error when we detect that the graph is periodic thanks to the function DiGraph.is_aperiodic(), rather that going to an infinite loop.
``````




---

archive/issue_comments_504163.json:
```json
{
    "body": "<a id='comment:3'></a>\nI agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.",
    "created_at": "2018-10-26T15:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504163",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>
I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.



---

archive/issue_comments_504164.json:
```json
{
    "body": "<a id='comment:4'></a>\nOne solution to avoid to pay for is_aperiodic() is to throw two threads: one that compute is_aperiodic(), the other one that compute the spectral radius(). If is_aperiodic() returns false, then we stop everything and raise an error. If the computation of the spectral radius ends, then we stop the thread computing is_aperiodic().\n\nReplying to [dcoudert](#comment%3A3):\n> I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.",
    "created_at": "2018-10-30T21:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504164",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```

<a id='comment:4'></a>
One solution to avoid to pay for is_aperiodic() is to throw two threads: one that compute is_aperiodic(), the other one that compute the spectral radius(). If is_aperiodic() returns false, then we stop everything and raise an error. If the computation of the spectral radius ends, then we stop the thread computing is_aperiodic().

Replying to [dcoudert](#comment%3A3):
> I agree with the proposed change. We could also try to improve method `is_aperiodic` (currently using a method from `NetworkX`, so we have to pay for the transformation) but this can be done later.



---

archive/issue_comments_504165.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mercatp/bug_in_digraph_spectral_radius__\"",
    "created_at": "2018-10-30T21:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504165",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```

Changing branch from "" to "u/mercatp/bug_in_digraph_spectral_radius__"



---

archive/issue_comments_504166.json:
```json
{
    "body": "<a id='comment:6'></a>\n\n```diff\n-    #test if the graph is aperiodic\n-    if not G.is_aperiodic():\n-        raise ValueError(\"The graph must be aperiodic.\")\n+    # test if the graph is aperiodic\n+    if not G.is_aperiodic():\n+        raise ValueError(\"the graph must be aperiodic\")\n```\nand possibly add a doctest\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|\n|[a639816](https://github.com/sagemath/sagetrac-mirror/commit/a63981648b72842df053687a61528cca43fd06a5)|`Add a test that the graph is aperiodic is spectral_radius(), in order to avoid to fall into an infinite loop.`|",
    "created_at": "2018-10-31T00:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504166",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>

```diff
-    #test if the graph is aperiodic
-    if not G.is_aperiodic():
-        raise ValueError("The graph must be aperiodic.")
+    # test if the graph is aperiodic
+    if not G.is_aperiodic():
+        raise ValueError("the graph must be aperiodic")
```
and possibly add a doctest

---
New commits:
|                                                                                                                                          |                                                                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------|
|[a639816](https://github.com/sagemath/sagetrac-mirror/commit/a63981648b72842df053687a61528cca43fd06a5)|`Add a test that the graph is aperiodic is spectral_radius(), in order to avoid to fall into an infinite loop.`|



---

archive/issue_comments_504167.json:
```json
{
    "body": "Changing reviewer from \"\" to \"David Coudert\"",
    "created_at": "2018-10-31T00:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504167",
    "user": "https://github.com/dcoudert"
}
```

Changing reviewer from "" to "David Coudert"



---

archive/issue_comments_504168.json:
```json
{
    "body": "Changing commit from \"\" to \"a63981648b72842df053687a61528cca43fd06a5\"",
    "created_at": "2018-10-31T00:15:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504168",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "a63981648b72842df053687a61528cca43fd06a5"



---

archive/issue_comments_504169.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|\n|[cb1ef6d](https://github.com/sagemath/sagetrac-mirror/commit/cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b)|`Add a conversion to DiGraph before using is_aperiodic(). Add a test that show that the bug is no more present.`|",
    "created_at": "2018-10-31T09:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------|
|[cb1ef6d](https://github.com/sagemath/sagetrac-mirror/commit/cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b)|`Add a conversion to DiGraph before using is_aperiodic(). Add a test that show that the bug is no more present.`|



---

archive/issue_comments_504170.json:
```json
{
    "body": "Changing commit from \"a63981648b72842df053687a61528cca43fd06a5\" to \"cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b\"",
    "created_at": "2018-10-31T09:51:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504170",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a63981648b72842df053687a61528cca43fd06a5" to "cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b"



---

archive/issue_comments_504171.json:
```json
{
    "body": "<a id='comment:8'></a>\nYou have trailing white space of the line before `#test`, and please add a space before `test`, so do:\n\n```diff\n-    \n-    #test if the graph is aperiodic\n+\n+    # test if the graph is aperiodic\n```",
    "created_at": "2018-10-31T11:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504171",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>
You have trailing white space of the line before `#test`, and please add a space before `test`, so do:

```diff
-    
-    #test if the graph is aperiodic
+
+    # test if the graph is aperiodic
```



---

archive/issue_comments_504172.json:
```json
{
    "body": "Changing commit from \"cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b\" to \"a1c6343fe9a4f4e96e6753d064d2224983dc67ea\"",
    "created_at": "2018-10-31T13:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cb1ef6d3b8140861ca6bcafdb94ea6174b7a7b1b" to "a1c6343fe9a4f4e96e6753d064d2224983dc67ea"



---

archive/issue_comments_504173.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[a1c6343](https://github.com/sagemath/sagetrac-mirror/commit/a1c6343fe9a4f4e96e6753d064d2224983dc67ea)|`Make a little correction of a comment.`|",
    "created_at": "2018-10-31T13:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504173",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[a1c6343](https://github.com/sagemath/sagetrac-mirror/commit/a1c6343fe9a4f4e96e6753d064d2224983dc67ea)|`Make a little correction of a comment.`|



---

archive/issue_comments_504174.json:
```json
{
    "body": "<a id='comment:10'></a>\nIf ready for review, set the ticket to `needs review`",
    "created_at": "2018-11-04T19:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504174",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:10'></a>
If ready for review, set the ticket to `needs review`



---

archive/issue_comments_504175.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-04T21:29:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504175",
    "user": "https://trac.sagemath.org/admin/accounts/users/mercatp"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_504176.json:
```json
{
    "body": "<a id='comment:12'></a>\nBefore and after the test `is_aperiodic`, you have introduced lines with trailing white spaces (4 spaces) and this is something to avoid. You must remove these spaces (but keep empty lines).",
    "created_at": "2018-11-05T07:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504176",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>
Before and after the test `is_aperiodic`, you have introduced lines with trailing white spaces (4 spaces) and this is something to avoid. You must remove these spaces (but keep empty lines).



---

archive/issue_comments_504177.json:
```json
{
    "body": "Changing commit from \"a1c6343fe9a4f4e96e6753d064d2224983dc67ea\" to \"c3bbe710ec5dfb581c9ebb78086176fc9f4c009f\"",
    "created_at": "2018-11-05T08:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504177",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a1c6343fe9a4f4e96e6753d064d2224983dc67ea" to "c3bbe710ec5dfb581c9ebb78086176fc9f4c009f"



---

archive/issue_comments_504178.json:
```json
{
    "body": "<a id='comment:13'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[c3bbe71](https://github.com/sagemath/sagetrac-mirror/commit/c3bbe710ec5dfb581c9ebb78086176fc9f4c009f)|`Remove trailing white spaces.`|",
    "created_at": "2018-11-05T08:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[c3bbe71](https://github.com/sagemath/sagetrac-mirror/commit/c3bbe710ec5dfb581c9ebb78086176fc9f4c009f)|`Remove trailing white spaces.`|



---

archive/issue_comments_504179.json:
```json
{
    "body": "<a id='comment:14'></a>\nLooks good to me.",
    "created_at": "2018-11-05T08:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504179",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:14'></a>
Looks good to me.



---

archive/issue_comments_504180.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-05T08:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504180",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_504181.json:
```json
{
    "body": "Changing branch from \"u/mercatp/bug_in_digraph_spectral_radius__\" to \"c3bbe710ec5dfb581c9ebb78086176fc9f4c009f\"",
    "created_at": "2018-11-07T11:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504181",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mercatp/bug_in_digraph_spectral_radius__" to "c3bbe710ec5dfb581c9ebb78086176fc9f4c009f"



---

archive/issue_events_082771.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-07T11:28:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26559#event-82771"
}
```



---

archive/issue_comments_504182.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-07T11:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26559",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26559#issuecomment-504182",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
