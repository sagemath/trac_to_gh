# Issue 26267: py3: fix IPython's automatic pprinting of dicts in doctests

archive/issues_026030.json:
```json
{
    "body": "As discussed [here](https://trac.sagemath.org/ticket/26097#comment:21), IPython has its own pprint library which, like the stdlib's, normally displays dicts such that their output is sorted by key.\n\nHowever, it is not doing this on Python 3.6+, which it turns out is by design.  Instead it opts to keep the dict's \"natural\" insertion order which is preserved in CPython 3.6+.\n\nHowever, there is a global flag to control this, which we should set at least for running the doctests.  I agree that for normal usage the default behavior is desirable, but for the sake of the doctests it's easier to make the output as close to Python 2 as possible, at least until we drop Python 2 support.\n\nFixing this should fix a number of trivial test failures.\n\nCC:  @fchapoton @vinklein\n\nBranch/Commit: [fcdded3a6804760e893a975cd933dd2858b30776](https://github.com/sagemath/sagetrac-mirror/commit/fcdded3a6804760e893a975cd933dd2858b30776)\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26267\n\n",
    "closed_at": "2018-09-14T20:26:46Z",
    "created_at": "2018-09-13T09:48:59Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "py3: fix IPython's automatic pprinting of dicts in doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26267",
    "user": "https://github.com/embray"
}
```
As discussed [here](https://trac.sagemath.org/ticket/26097#comment:21), IPython has its own pprint library which, like the stdlib's, normally displays dicts such that their output is sorted by key.

However, it is not doing this on Python 3.6+, which it turns out is by design.  Instead it opts to keep the dict's "natural" insertion order which is preserved in CPython 3.6+.

However, there is a global flag to control this, which we should set at least for running the doctests.  I agree that for normal usage the default behavior is desirable, but for the sake of the doctests it's easier to make the output as close to Python 2 as possible, at least until we drop Python 2 support.

Fixing this should fix a number of trivial test failures.

CC:  @fchapoton @vinklein

Branch/Commit: [fcdded3a6804760e893a975cd933dd2858b30776](https://github.com/sagemath/sagetrac-mirror/commit/fcdded3a6804760e893a975cd933dd2858b30776)

Reviewer: Frédéric Chapoton

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26267





---

archive/issue_comments_506945.json:
```json
{
    "body": "Commit: [fcdded3a6804760e893a975cd933dd2858b30776](https://github.com/sagemath/sagetrac-mirror/commit/fcdded3a6804760e893a975cd933dd2858b30776)",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506945",
    "user": "https://github.com/embray"
}
```

Commit: [fcdded3a6804760e893a975cd933dd2858b30776](https://github.com/sagemath/sagetrac-mirror/commit/fcdded3a6804760e893a975cd933dd2858b30776)



---

archive/issue_comments_506946.json:
```json
{
    "body": "Author: Erik Bray",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506946",
    "user": "https://github.com/embray"
}
```

Author: Erik Bray



---

archive/issue_comments_506947.json:
```json
{
    "body": "<a id='comment:1'></a>\nI haven't run the full test suite on this yet so I don't know if it will *break* any existing tests.  I don't think it will, but let's see what a patchbot says.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|\n|[4a6f715](https://github.com/sagemath/sagetrac-mirror/commit/4a6f715b0f9ed89a48ae6fa7747732b01c6568d9)|`py3: for IPython to pprint dicts sorted by key when running the doctests`|\n|[fcdded3](https://github.com/sagemath/sagetrac-mirror/commit/fcdded3a6804760e893a975cd933dd2858b30776)|`py3: remove explicit pprint from some doctests where it should no longer be needed`|",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506947",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>
I haven't run the full test suite on this yet so I don't know if it will *break* any existing tests.  I don't think it will, but let's see what a patchbot says.

---
New commits:
|                                                                                                                                          |                                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------|
|[4a6f715](https://github.com/sagemath/sagetrac-mirror/commit/4a6f715b0f9ed89a48ae6fa7747732b01c6568d9)|`py3: for IPython to pprint dicts sorted by key when running the doctests`|
|[fcdded3](https://github.com/sagemath/sagetrac-mirror/commit/fcdded3a6804760e893a975cd933dd2858b30776)|`py3: remove explicit pprint from some doctests where it should no longer be needed`|



---

archive/issue_comments_506948.json:
```json
{
    "body": "Branch: [u/embray/python3/doctests/fix-pprint](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/doctests/fix-pprint)",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506948",
    "user": "https://github.com/embray"
}
```

Branch: [u/embray/python3/doctests/fix-pprint](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/doctests/fix-pprint)



---

archive/issue_comments_506949.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506949",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_506950.json:
```json
{
    "body": "<a id='comment:2'></a>\ngreat !! This was really needed.",
    "created_at": "2018-09-13T09:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506950",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
great !! This was really needed.



---

archive/issue_comments_506951.json:
```json
{
    "body": "<a id='comment:3'></a>\nFunny, i was currently looking at how to force the doctests framework to use python pprint for dict rather than IPython's. Doesn't know there is global flag for that.",
    "created_at": "2018-09-13T09:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506951",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:3'></a>
Funny, i was currently looking at how to force the doctests framework to use python pprint for dict rather than IPython's. Doesn't know there is global flag for that.



---

archive/issue_comments_506952.json:
```json
{
    "body": "<a id='comment:4'></a>\nIt still uses IPython's, it just controls the behavior of whether or not it should re-sort dict keys.",
    "created_at": "2018-09-13T10:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506952",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>
It still uses IPython's, it just controls the behavior of whether or not it should re-sort dict keys.



---

archive/issue_comments_506953.json:
```json
{
    "body": "<a id='comment:5'></a>\napparently no doctest failure",
    "created_at": "2018-09-13T11:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506953",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
apparently no doctest failure



---

archive/issue_comments_506954.json:
```json
{
    "body": "<a id='comment:6'></a>\nI wish whoever runs \"fermat\" would either fix or disable those magma tests.  I would look into fixing them myself but I don't have access to magma as far as I know :)",
    "created_at": "2018-09-13T11:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506954",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
I wish whoever runs "fermat" would either fix or disable those magma tests.  I would look into fixing them myself but I don't have access to magma as far as I know :)



---

archive/issue_comments_506955.json:
```json
{
    "body": "<a id='comment:7'></a>\nI already fixed one of those, but there will remain two of them.",
    "created_at": "2018-09-13T11:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506955",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>
I already fixed one of those, but there will remain two of them.



---

archive/issue_comments_506956.json:
```json
{
    "body": "<a id='comment:8'></a>\nWell, that's progress at least :)",
    "created_at": "2018-09-13T11:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506956",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Well, that's progress at least :)



---

archive/issue_comments_506957.json:
```json
{
    "body": "<a id='comment:9'></a>\nI restarted my Ubuntu patchbot.  Apparently it hasn't done anything in 10 days, and it's not at all clear why it stalled :(",
    "created_at": "2018-09-13T11:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506957",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
I restarted my Ubuntu patchbot.  Apparently it hasn't done anything in 10 days, and it's not at all clear why it stalled :(



---

archive/issue_comments_506958.json:
```json
{
    "body": "<a id='comment:10'></a>\nOne fully green bot. I think this is good to go. Thanks a lot.",
    "created_at": "2018-09-13T14:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506958",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
One fully green bot. I think this is good to go. Thanks a lot.



---

archive/issue_comments_506959.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-13T14:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506959",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_506960.json:
```json
{
    "body": "Reviewer: Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2018-09-13T14:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506960",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: Frédéric Chapoton



---

archive/issue_comments_506961.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-14T20:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506961",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_506962.json:
```json
{
    "body": "Changing branch from \"[u/embray/python3/doctests/fix-pprint](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/doctests/fix-pprint)\" to \"[fcdded3a6804760e893a975cd933dd2858b30776](https://github.com/sagemath/sagetrac-mirror/commit/fcdded3a6804760e893a975cd933dd2858b30776)\"",
    "created_at": "2018-09-14T20:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-506962",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/embray/python3/doctests/fix-pprint](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/doctests/fix-pprint)" to "[fcdded3a6804760e893a975cd933dd2858b30776](https://github.com/sagemath/sagetrac-mirror/commit/fcdded3a6804760e893a975cd933dd2858b30776)"



---

archive/issue_events_074286.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-14T20:26:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26267#event-74286"
}
```
