# Issue 26267: py3: fix IPython's automatic pprinting of dicts in doctests

archive/issues_026030.json:
```json
{
    "body": "As discussed [here](https://trac.sagemath.org/ticket/26097#comment:21), IPython has its own pprint library which, like the stdlib's, normally displays dicts such that their output is sorted by key.\n\nHowever, it is not doing this on Python 3.6+, which it turns out is by design.  Instead it opts to keep the dict's \"natural\" insertion order which is preserved in CPython 3.6+.\n\nHowever, there is a global flag to control this, which we should set at least for running the doctests.  I agree that for normal usage the default behavior is desirable, but for the sake of the doctests it's easier to make the output as close to Python 2 as possible, at least until we drop Python 2 support.\n\nFixing this should fix a number of trivial test failures.\n\nCC:  @fchapoton @vinklein\n\nBranch/Commit: fcdded3a6804760e893a975cd933dd2858b30776\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26267\n\n",
    "closed_at": "2018-09-14T20:26:46Z",
    "created_at": "2018-09-13T09:48:59Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "py3: fix IPython's automatic pprinting of dicts in doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26267",
    "user": "https://github.com/embray"
}
```
As discussed [here](https://trac.sagemath.org/ticket/26097#comment:21), IPython has its own pprint library which, like the stdlib's, normally displays dicts such that their output is sorted by key.

However, it is not doing this on Python 3.6+, which it turns out is by design.  Instead it opts to keep the dict's "natural" insertion order which is preserved in CPython 3.6+.

However, there is a global flag to control this, which we should set at least for running the doctests.  I agree that for normal usage the default behavior is desirable, but for the sake of the doctests it's easier to make the output as close to Python 2 as possible, at least until we drop Python 2 support.

Fixing this should fix a number of trivial test failures.

CC:  @fchapoton @vinklein

Branch/Commit: fcdded3a6804760e893a975cd933dd2858b30776

Reviewer: Frédéric Chapoton

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26267





---

archive/issue_comments_366764.json:
```json
{
    "body": "<a id='comment:1'></a>I haven't run the full test suite on this yet so I don't know if it will *break* any existing tests.  I don't think it will, but let's see what a patchbot says.\n\n---\nNew commits:",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366764",
    "user": "https://github.com/embray"
}
```

<a id='comment:1'></a>I haven't run the full test suite on this yet so I don't know if it will *break* any existing tests.  I don't think it will, but let's see what a patchbot says.

---
New commits:



---

archive/issue_comments_366765.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366765",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_366766.json:
```json
{
    "body": "<a id='comment:2'></a>great !! This was really needed.",
    "created_at": "2018-09-13T09:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366766",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>great !! This was really needed.



---

archive/issue_comments_366767.json:
```json
{
    "body": "<a id='comment:3'></a>Funny, i was currently looking at how to force the doctests framework to use python pprint for dict rather than IPython's. Doesn't know there is global flag for that.",
    "created_at": "2018-09-13T09:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366767",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:3'></a>Funny, i was currently looking at how to force the doctests framework to use python pprint for dict rather than IPython's. Doesn't know there is global flag for that.



---

archive/issue_comments_366768.json:
```json
{
    "body": "<a id='comment:4'></a>It still uses IPython's, it just controls the behavior of whether or not it should re-sort dict keys.",
    "created_at": "2018-09-13T10:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366768",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>It still uses IPython's, it just controls the behavior of whether or not it should re-sort dict keys.



---

archive/issue_comments_366769.json:
```json
{
    "body": "<a id='comment:5'></a>apparently no doctest failure",
    "created_at": "2018-09-13T11:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366769",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>apparently no doctest failure



---

archive/issue_comments_366770.json:
```json
{
    "body": "<a id='comment:6'></a>I wish whoever runs \"fermat\" would either fix or disable those magma tests.  I would look into fixing them myself but I don't have access to magma as far as I know :)",
    "created_at": "2018-09-13T11:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366770",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>I wish whoever runs "fermat" would either fix or disable those magma tests.  I would look into fixing them myself but I don't have access to magma as far as I know :)



---

archive/issue_comments_366771.json:
```json
{
    "body": "<a id='comment:7'></a>I already fixed one of those, but there will remain two of them.",
    "created_at": "2018-09-13T11:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366771",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>I already fixed one of those, but there will remain two of them.



---

archive/issue_comments_366772.json:
```json
{
    "body": "<a id='comment:8'></a>Well, that's progress at least :)",
    "created_at": "2018-09-13T11:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366772",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>Well, that's progress at least :)



---

archive/issue_comments_366773.json:
```json
{
    "body": "<a id='comment:9'></a>I restarted my Ubuntu patchbot.  Apparently it hasn't done anything in 10 days, and it's not at all clear why it stalled :(",
    "created_at": "2018-09-13T11:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366773",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>I restarted my Ubuntu patchbot.  Apparently it hasn't done anything in 10 days, and it's not at all clear why it stalled :(



---

archive/issue_comments_366774.json:
```json
{
    "body": "<a id='comment:10'></a>One fully green bot. I think this is good to go. Thanks a lot.",
    "created_at": "2018-09-13T14:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366774",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>One fully green bot. I think this is good to go. Thanks a lot.



---

archive/issue_comments_366775.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-13T14:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366775",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_366776.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-14T20:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26267#issuecomment-366776",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_065388.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-14T20:26:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26267",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26267#event-65388"
}
```
