# Issue 26677: rational_points for some elliptic curves fails

archive/issues_026440.json:
```json
{
    "body": "```\nsage: E = EllipticCurve(\"11a1\")\nsage: E.rational_points(bound=5)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-892e6de8bab5> in <module>()\n----> 1 E.rational_points(\"11a1\")\n\nAttributeError: 'function' object has no attribute 'rational_points'\nsage: E = EllipticCurve(\"11a1\")\nsage: E.rational_points(bound=5)\nException raised by child process with pid=90565:\nTraceback (most recent call last):\n  File \"/Users/alex/sage/local/lib/python2.7/site-packages/sage/parallel/use_fork.py\", line 177, in __call__\n    self._subprocess(f, dir, *v0)\n  File \"/Users/alex/sage/local/lib/python2.7/site-packages/sage/parallel/use_fork.py\", line 302, in _subprocess\n    value = f(*args, **kwds)\n  File \"/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/projective/projective_rational_point.py\", line 460, in parallel_function\n    Xp = X.change_ring(GF(p))\n  File \"/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py\", line 1347, in change_ring\n    return self.base_extend(R)\n  File \"/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_number_field.py\", line 151, in base_extend\n    E = super(EllipticCurve_number_field, self).base_extend(R)\n  File \"/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py\", line 1329, in base_extend\n    return constructor.EllipticCurve([R(a) for a in self.a_invariants()])\n  File \"sage/structure/factory.pyx\", line 369, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2046)\n    return self.get_object(version, key, kwds)\n  File \"sage/structure/factory.pyx\", line 412, in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:2422)\n    obj = self.create_object(version, key, **extra_args)\n  File \"/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/constructor.py\", line 471, in create_object\n    return EllipticCurve_finite_field(R, x)\n  File \"/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py\", line 149, in __init__\n    raise ArithmeticError(\"invariants \" + str(ainvs) + \" define a singular curve\")\nArithmeticError: invariants (0, 10, 1, 1, 2) define a singular curve\n<---------SNIP----------->\n/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/generic/algebraic_scheme.pyc in rational_points(self, **kwds)\n   1828                 return X.points(**kwds) # checks for proper bound done in points functions\n   1829             except TypeError:\n-> 1830                 raise TypeError(\"Unable to enumerate points over %s.\"%F)\n   1831         elif (self.base_ring() in NumberFields() or self.base_ring() == ZZ)\\\n   1832           and hasattr(F, 'precision'):\n\nTypeError: Unable to enumerate points over Rational Field.\nsage: \n```\n\n\nMiraculously this works for the curve that is currently doctested `37a`, \n\nThe issue is that elliptic curves don't like to be base changed to bad primes, however for the purposes of sieving this is fine. So elliptic curves need to be convinced they are just curves for the purposes of sieving for points.\n\nPrecisely\n\n```\nCurve(E).rational_points(bound=5)\n```\n\nworks even when `E.rational_points(bound=5)` does not. Not sure if a change should be made to elliptic curves (to have a special rational_points method, or to the generic sieving code to first change the input to a rather generic type of scheme. I like the former more as the latter causes friction if people want to add special methods that speed up base_change or whatever.\n\nCC:  @raghukul01 @bhutz\n\nKeywords: rational points, elliptic curves\n\nBranch/Commit: b6a6e9793ca6be1a9635bc8d5505d60970e81367\n\nReviewer: Ben Hutz\n\nAuthor: Alex J. Best\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26677\n\n",
    "closed_at": "2018-11-18T00:06:55Z",
    "created_at": "2018-11-11T08:54:59Z",
    "labels": [
        "component: algebraic geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "rational_points for some elliptic curves fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26677",
    "user": "https://github.com/alexjbest"
}
```
```
sage: E = EllipticCurve("11a1")
sage: E.rational_points(bound=5)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-892e6de8bab5> in <module>()
----> 1 E.rational_points("11a1")

AttributeError: 'function' object has no attribute 'rational_points'
sage: E = EllipticCurve("11a1")
sage: E.rational_points(bound=5)
Exception raised by child process with pid=90565:
Traceback (most recent call last):
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/parallel/use_fork.py", line 177, in __call__
    self._subprocess(f, dir, *v0)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/parallel/use_fork.py", line 302, in _subprocess
    value = f(*args, **kwds)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/projective/projective_rational_point.py", line 460, in parallel_function
    Xp = X.change_ring(GF(p))
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py", line 1347, in change_ring
    return self.base_extend(R)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_number_field.py", line 151, in base_extend
    E = super(EllipticCurve_number_field, self).base_extend(R)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py", line 1329, in base_extend
    return constructor.EllipticCurve([R(a) for a in self.a_invariants()])
  File "sage/structure/factory.pyx", line 369, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2046)
    return self.get_object(version, key, kwds)
  File "sage/structure/factory.pyx", line 412, in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:2422)
    obj = self.create_object(version, key, **extra_args)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/constructor.py", line 471, in create_object
    return EllipticCurve_finite_field(R, x)
  File "/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_generic.py", line 149, in __init__
    raise ArithmeticError("invariants " + str(ainvs) + " define a singular curve")
ArithmeticError: invariants (0, 10, 1, 1, 2) define a singular curve
<---------SNIP----------->
/Users/alex/sage/local/lib/python2.7/site-packages/sage/schemes/generic/algebraic_scheme.pyc in rational_points(self, **kwds)
   1828                 return X.points(**kwds) # checks for proper bound done in points functions
   1829             except TypeError:
-> 1830                 raise TypeError("Unable to enumerate points over %s."%F)
   1831         elif (self.base_ring() in NumberFields() or self.base_ring() == ZZ)\
   1832           and hasattr(F, 'precision'):

TypeError: Unable to enumerate points over Rational Field.
sage: 
```


Miraculously this works for the curve that is currently doctested `37a`, 

The issue is that elliptic curves don't like to be base changed to bad primes, however for the purposes of sieving this is fine. So elliptic curves need to be convinced they are just curves for the purposes of sieving for points.

Precisely

```
Curve(E).rational_points(bound=5)
```

works even when `E.rational_points(bound=5)` does not. Not sure if a change should be made to elliptic curves (to have a special rational_points method, or to the generic sieving code to first change the input to a rather generic type of scheme. I like the former more as the latter causes friction if people want to add special methods that speed up base_change or whatever.

CC:  @raghukul01 @bhutz

Keywords: rational points, elliptic curves

Branch/Commit: b6a6e9793ca6be1a9635bc8d5505d60970e81367

Reviewer: Ben Hutz

Author: Alex J. Best

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26677





---

archive/issue_comments_396282.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -44,9 +44,18 @@\n sage: \n ```\n \n-Not clear the exact issue right now, but it looks like a bad prime is being used.\n \n-Miraculously this works for the curve that is currently doctested `37a`,\n+Miraculously this works for the curve that is currently doctested `37a`, \n+\n+The issue is that elliptic curves don't like to be base changed to bad primes, however for the purposes of sieving this is fine. So elliptic curves need to be convinced they are just curves for the purposes of sieving for points.\n+\n+Precisely\n+\n+```\n+Curve(E).rational_points(bound=5)\n+```\n+\n+works even when `E.rational_points(bound=5)` does not. Not sure if a change should be made to elliptic curves (to have a special rational_points method, or to the generic sieving code to first change the input to a rather generic type of scheme. I like the former more as the latter causes friction if people want to add special methods that speed up base_change or whatever.\n \n Comment: 1\n \n``````\n",
    "created_at": "2018-11-11T09:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396282",
    "user": "https://github.com/alexjbest"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -44,9 +44,18 @@
 sage: 
 ```
 
-Not clear the exact issue right now, but it looks like a bad prime is being used.
 
-Miraculously this works for the curve that is currently doctested `37a`,
+Miraculously this works for the curve that is currently doctested `37a`, 
+
+The issue is that elliptic curves don't like to be base changed to bad primes, however for the purposes of sieving this is fine. So elliptic curves need to be convinced they are just curves for the purposes of sieving for points.
+
+Precisely
+
+```
+Curve(E).rational_points(bound=5)
+```
+
+works even when `E.rational_points(bound=5)` does not. Not sure if a change should be made to elliptic curves (to have a special rational_points method, or to the generic sieving code to first change the input to a rather generic type of scheme. I like the former more as the latter causes friction if people want to add special methods that speed up base_change or whatever.
 
 Comment: 1
 
``````




---

archive/issue_comments_396283.json:
```json
{
    "body": "<a id='comment:2'></a>As stated above, the problem is that the sieving method is not considering whether a prime could be bad. I also prefer the suggestion of elliptic curves having their own method; if for no other reason that the method could be significantly improved in the case of the elliptic curves. In the short term, the elliptic curve method could just call the current method as a generic 'curve' until a faster specialized algorithm is implemented.",
    "created_at": "2018-11-11T14:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396283",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:2'></a>As stated above, the problem is that the sieving method is not considering whether a prime could be bad. I also prefer the suggestion of elliptic curves having their own method; if for no other reason that the method could be significantly improved in the case of the elliptic curves. In the short term, the elliptic curve method could just call the current method as a generic 'curve' until a faster specialized algorithm is implemented.



---

archive/issue_comments_396284.json:
```json
{
    "body": "<a id='comment:4'></a>Ok I added a patch, let me know if anyone thinks of a better solution, or if this should be somewhere more generic that elliptic_curve_number_field (thats just the situation I care about where I believe rational points is most common).\n\n---\nNew commits:",
    "created_at": "2018-11-11T22:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396284",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:4'></a>Ok I added a patch, let me know if anyone thinks of a better solution, or if this should be somewhere more generic that elliptic_curve_number_field (thats just the situation I care about where I believe rational points is most common).

---
New commits:



---

archive/issue_comments_396285.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-11T22:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396285",
    "user": "https://github.com/alexjbest"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_396286.json:
```json
{
    "body": "<a id='comment:7'></a>I didn't pull the branch to test, but don't you need to coerce the points back to original elliptic curve before returning.",
    "created_at": "2018-11-11T22:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396286",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:7'></a>I didn't pull the branch to test, but don't you need to coerce the points back to original elliptic curve before returning.



---

archive/issue_comments_396287.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-11T23:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396287",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_396288.json:
```json
{
    "body": "<a id='comment:9'></a>Good point!",
    "created_at": "2018-11-11T23:05:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396288",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:9'></a>Good point!



---

archive/issue_comments_396289.json:
```json
{
    "body": "<a id='comment:10'></a>Actually this requires some more code as we need to allow\n\n```\nsage: E = EllipticCurve([1,0])\nsage: E.rational_points(bound=2, F= QuadraticField(-1))\n```\n\n which currently fails",
    "created_at": "2018-11-11T23:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396289",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:10'></a>Actually this requires some more code as we need to allow

```
sage: E = EllipticCurve([1,0])
sage: E.rational_points(bound=2, F= QuadraticField(-1))
```

 which currently fails



---

archive/issue_comments_396290.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-11-11T23:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396290",
    "user": "https://github.com/alexjbest"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_396291.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-12T05:18:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396291",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_396292.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-11-12T05:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396292",
    "user": "https://github.com/alexjbest"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_396293.json:
```json
{
    "body": "<a id='comment:13'></a>You need to get the keyword 'F' before it can be used.\n\nMaybe change the last example to\n\n```\nsage: E = EllipticCurve([1,0])\nsage: E.rational_points(F=QuadraticField(-1))\n```\nso an error like this shows up.",
    "created_at": "2018-11-13T18:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396293",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:13'></a>You need to get the keyword 'F' before it can be used.

Maybe change the last example to

```
sage: E = EllipticCurve([1,0])
sage: E.rational_points(F=QuadraticField(-1))
```
so an error like this shows up.



---

archive/issue_comments_396294.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-11-13T18:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396294",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_396295.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-14T22:59:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396295",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_396296.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-11-14T23:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396296",
    "user": "https://github.com/alexjbest"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_396297.json:
```json
{
    "body": "<a id='comment:15'></a>Yikes, thanks.",
    "created_at": "2018-11-14T23:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396297",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:15'></a>Yikes, thanks.



---

archive/issue_comments_396298.json:
```json
{
    "body": "<a id='comment:16'></a>I think this is fine now. If we can get an all tests pass on the patchbot, I'll mark it positive.",
    "created_at": "2018-11-15T15:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396298",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:16'></a>I think this is fine now. If we can get an all tests pass on the patchbot, I'll mark it positive.



---

archive/issue_comments_396299.json:
```json
{
    "body": "<a id='comment:18'></a>ran the long tests on my machine. All passed.",
    "created_at": "2018-11-16T17:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396299",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:18'></a>ran the long tests on my machine. All passed.



---

archive/issue_comments_396300.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-16T17:50:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396300",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_066127.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-18T00:06:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26677#event-66127"
}
```



---

archive/issue_comments_396301.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-18T00:06:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26677#issuecomment-396301",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
