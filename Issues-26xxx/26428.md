# Issue 26428: improve is_weakly_chordal

archive/issues_026191.json:
```json
{
    "body": "This ticket do:\n- Remove recursion in methods `is_long_hole_free` and `is_long_antihole_free`\n- Avoid modifying the input graph\n- Cythonize parts of the code\n\nBranch/Commit: 66a1ed9a6521c26e3354b53ca5aaa9bb2f1e4c59\n\nReviewer: Travis Scrimshaw\n\nAuthor: David Coudert\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/26428\n\n",
    "closed_at": "2018-10-20T11:58:19Z",
    "created_at": "2018-10-07T15:15:04Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "improve is_weakly_chordal",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26428",
    "user": "https://github.com/dcoudert"
}
```
This ticket do:
- Remove recursion in methods `is_long_hole_free` and `is_long_antihole_free`
- Avoid modifying the input graph
- Cythonize parts of the code

Branch/Commit: 66a1ed9a6521c26e3354b53ca5aaa9bb2f1e4c59

Reviewer: Travis Scrimshaw

Author: David Coudert

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/26428





---

archive/issue_comments_509740.json:
```json
{
    "body": "Changing branch from \"\" to \"public/26428_weakly_chordal\"",
    "created_at": "2018-10-07T15:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509740",
    "user": "https://github.com/dcoudert"
}
```

Changing branch from "" to "public/26428_weakly_chordal"



---

archive/issue_comments_509741.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-07T15:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509741",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_509742.json:
```json
{
    "body": "Changing commit from \"\" to \"f3fc0614c1311e4437d83766156ff077d89a2ac3\"",
    "created_at": "2018-10-07T15:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509742",
    "user": "https://github.com/dcoudert"
}
```

Changing commit from "" to "f3fc0614c1311e4437d83766156ff077d89a2ac3"



---

archive/issue_comments_509743.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n This ticket do:\n - Remove recursion in methods `is_long_hole_free` and `is_long_antihole_free`\n-- Avoid modifying the input graph (this is very bad)\n+- Avoid modifying the input graph\n - Cythonize parts of the code\n``````\n",
    "created_at": "2018-10-07T15:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509743",
    "user": "https://github.com/dcoudert"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 This ticket do:
 - Remove recursion in methods `is_long_hole_free` and `is_long_antihole_free`
-- Avoid modifying the input graph (this is very bad)
+- Avoid modifying the input graph
 - Cythonize parts of the code
``````




---

archive/issue_comments_509744.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[f3fc061](https://github.com/sagemath/sagetrac-mirror/commit/f3fc0614c1311e4437d83766156ff077d89a2ac3)|`trac #26428: multiple improvements`|",
    "created_at": "2018-10-07T15:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509744",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[f3fc061](https://github.com/sagemath/sagetrac-mirror/commit/f3fc0614c1311e4437d83766156ff077d89a2ac3)|`trac #26428: multiple improvements`|



---

archive/issue_comments_509745.json:
```json
{
    "body": "Changing commit from \"f3fc0614c1311e4437d83766156ff077d89a2ac3\" to \"1537dfd70f0aab5fbc2a8a34c99325e5aa2a1581\"",
    "created_at": "2018-10-07T15:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f3fc0614c1311e4437d83766156ff077d89a2ac3" to "1537dfd70f0aab5fbc2a8a34c99325e5aa2a1581"



---

archive/issue_comments_509746.json:
```json
{
    "body": "<a id='comment:2'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[1537dfd](https://github.com/sagemath/sagetrac-mirror/commit/1537dfd70f0aab5fbc2a8a34c99325e5aa2a1581)|`trac #26428: remove useless imports`|",
    "created_at": "2018-10-07T15:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509746",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[1537dfd](https://github.com/sagemath/sagetrac-mirror/commit/1537dfd70f0aab5fbc2a8a34c99325e5aa2a1581)|`trac #26428: remove useless imports`|



---

archive/issue_comments_509747.json:
```json
{
    "body": "<a id='comment:3'></a>\nI think you should move `process` out as a separate `cdef inline` function and pass the data you need. It is likely equivalent to a Python function call, and since it is in the heart of the algorithm, it should be made to be called quickly (the inline hopefully will make it avoid the function call altogether).\n\nI was going to say the same thing for the `dist`, but since that is processing on the way out, it is only done once and should not contribute much time.\n\nA few quick notes on style. For pointers, the `*` is better next to the type, e.g., `int*` as it makes it look less like multiplication. Also `lambda X : foo` -> `lambda X: foo`.\n\nOtherwise LGTM. Have you run some timings?",
    "created_at": "2018-10-07T22:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509747",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>
I think you should move `process` out as a separate `cdef inline` function and pass the data you need. It is likely equivalent to a Python function call, and since it is in the heart of the algorithm, it should be made to be called quickly (the inline hopefully will make it avoid the function call altogether).

I was going to say the same thing for the `dist`, but since that is processing on the way out, it is only done once and should not contribute much time.

A few quick notes on style. For pointers, the `*` is better next to the type, e.g., `int*` as it makes it look less like multiplication. Also `lambda X : foo` -> `lambda X: foo`.

Otherwise LGTM. Have you run some timings?



---

archive/issue_comments_509748.json:
```json
{
    "body": "Changing commit from \"1537dfd70f0aab5fbc2a8a34c99325e5aa2a1581\" to \"66a1ed9a6521c26e3354b53ca5aaa9bb2f1e4c59\"",
    "created_at": "2018-10-08T13:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1537dfd70f0aab5fbc2a8a34c99325e5aa2a1581" to "66a1ed9a6521c26e3354b53ca5aaa9bb2f1e4c59"



---

archive/issue_comments_509749.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[66a1ed9](https://github.com/sagemath/sagetrac-mirror/commit/66a1ed9a6521c26e3354b53ca5aaa9bb2f1e4c59)|`trac #26428: cdef methods process`|",
    "created_at": "2018-10-08T13:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[66a1ed9](https://github.com/sagemath/sagetrac-mirror/commit/66a1ed9a6521c26e3354b53ca5aaa9bb2f1e4c59)|`trac #26428: cdef methods process`|



---

archive/issue_comments_509750.json:
```json
{
    "body": "<a id='comment:5'></a>\nI have cdef the methods `process` and perform other suggestions.\n\nI have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.\n\nI also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).",
    "created_at": "2018-10-08T13:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509750",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>
I have cdef the methods `process` and perform other suggestions.

I have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.

I also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).



---

archive/issue_comments_509751.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-08T22:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509751",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_509752.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [dcoudert](#comment%3A5):\n> I have cdef the methods `process` and perform other suggestions.\n\n\nThank you for doing that. I didn't realize `process` needed so many of the local variables.\n\n> I have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.\n\n\nSpeed gains is a consequence of all of those things. <sup>_</sup>\n\n> I also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).\n\n\nIt is good to care about these things as well. Sometimes we do have to sacrifice speed so that sparse graphs will work well too. We can also potentially try to do things differently for each those cases, but I think what you have done here is more than enough.",
    "created_at": "2018-10-08T22:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509752",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
Replying to [dcoudert](#comment%3A5):
> I have cdef the methods `process` and perform other suggestions.


Thank you for doing that. I didn't realize `process` needed so many of the local variables.

> I have not done clear timings. It is now faster on large cliques for instance, but very similar for graphs like the Petersen graph. My main motivation was not timing but 1) no sorting on original vertex labels, 2) no modification of the input graph (very bad), and 3) avoid recursive calls.


Speed gains is a consequence of all of those things. <sup>_</sup>

> I also tried to use the `has_edge` method of `short_digraph` to avoid copying the graph in a `n^2` length bitset (`dense_graph`), but it was slightly slower. This is certainly something to consider if we have very large sparse graphs (i.e., when memory matters).


It is good to care about these things as well. Sometimes we do have to sacrifice speed so that sparse graphs will work well too. We can also potentially try to do things differently for each those cases, but I think what you have done here is more than enough.



---

archive/issue_comments_509753.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-10-08T22:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509753",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_509754.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-20T11:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509754",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_509755.json:
```json
{
    "body": "Changing branch from \"public/26428_weakly_chordal\" to \"66a1ed9a6521c26e3354b53ca5aaa9bb2f1e4c59\"",
    "created_at": "2018-10-20T11:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509755",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/26428_weakly_chordal" to "66a1ed9a6521c26e3354b53ca5aaa9bb2f1e4c59"



---

archive/issue_events_074634.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-20T11:58:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26428#event-74634"
}
```



---

archive/issue_events_074635.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T14:52:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26428#event-74635"
}
```



---

archive/issue_comments_509756.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26428",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26428#issuecomment-509756",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
This should be re-targeted for 8.5.
