# Issue 26078: Ideals and subalgebras of finite dimensional Lie algebras

archive/issues_025841.json:
```json
{
    "assignees": [],
    "body": "An implementation of ideals and subalgebras generated by a subset of a finite dimensional Lie algebra with basis. In the finite dimensional case a naive (and probably inefficient) method of repeatedly computing brackets to find a basis of the ideal or subalgebra is available, as opposed to the Gr\u00f6bner-basis style methods that would need to be used in the general case. Part of a part of #16824\n\nDepends on #26076\n\nCC:  @tscrim\n\nKeywords: **Lie algebras, ideals, subalgebras**\n\nBranch/Commit: **[fcb4888](https://github.com/sagemath/sagetrac-mirror/commit/fcb488858260db781ccc93200d5e6976389d861d)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Eero Hakavuori**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/26078_\n\n",
    "closed_at": "2018-09-12T19:58:39Z",
    "created_at": "2018-08-17T07:09:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Ideals and subalgebras of finite dimensional Lie algebras",
    "type": "issue",
    "updated_at": "2018-09-12T19:58:39Z",
    "url": "https://github.com/sagemath/sage/issues/26078",
    "user": "https://github.com/ehaka"
}
```
An implementation of ideals and subalgebras generated by a subset of a finite dimensional Lie algebra with basis. In the finite dimensional case a naive (and probably inefficient) method of repeatedly computing brackets to find a basis of the ideal or subalgebra is available, as opposed to the Gröbner-basis style methods that would need to be used in the general case. Part of a part of #16824

Depends on #26076

CC:  @tscrim

Keywords: **Lie algebras, ideals, subalgebras**

Branch/Commit: **[fcb4888](https://github.com/sagemath/sagetrac-mirror/commit/fcb488858260db781ccc93200d5e6976389d861d)**

Reviewer: **Travis Scrimshaw**

Author: **Eero Hakavuori**

_Issue created by migration from https://trac.sagemath.org/ticket/26078_





---

archive/issue_events_342035.json:
```json
{
    "actor": "https://github.com/ehaka",
    "created_at": "2018-08-17T07:09:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342035"
}
```



---

archive/issue_events_342036.json:
```json
{
    "actor": "https://github.com/ehaka",
    "created_at": "2018-08-17T07:09:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "0000ff",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342036"
}
```



---

archive/issue_events_342037.json:
```json
{
    "actor": "https://github.com/ehaka",
    "created_at": "2018-08-17T07:09:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342037"
}
```



---

archive/issue_events_342038.json:
```json
{
    "actor": "https://github.com/ehaka",
    "created_at": "2018-08-17T07:09:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342038"
}
```



---

archive/issue_comments_404413.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nSome implementation already exists in a codebase that I need to clean up and import into Sage.",
    "created_at": "2018-08-17T07:10:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404413",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:1" align="right">Comment 1</div>

Some implementation already exists in a codebase that I need to clean up and import into Sage.



---

archive/issue_comments_404414.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nThat was basically how my previous code (on #14901) was doing things. Although it probably should be done lazily (i.e., when the user asks for `basis`). Will you also be including code for subalgebras?",
    "created_at": "2018-08-17T10:47:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404414",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:2" align="right">Comment 2</div>

That was basically how my previous code (on #14901) was doing things. Although it probably should be done lazily (i.e., when the user asks for `basis`). Will you also be including code for subalgebras?



---

archive/issue_comments_404415.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nThe lazy implementation is a good idea, I will tweak it in when I get to the import. Currently I have no code related to generic subalgebras, only a coercion from an ideal back to the ambient algebra. I'll have to see if during cleanup of the ideal-code there is something that sticks out as belonging in a subalgebra construction.",
    "created_at": "2018-08-17T13:12:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404415",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:3" align="right">Comment 3</div>

The lazy implementation is a good idea, I will tweak it in when I get to the import. Currently I have no code related to generic subalgebras, only a coercion from an ideal back to the ambient algebra. I'll have to see if during cleanup of the ideal-code there is something that sticks out as belonging in a subalgebra construction.



---

archive/issue_comments_404416.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-An implementation of ideals generated by a subset of a finite dimensional Lie algebra with basis. In the finite dimensional case a naive (and probably inefficient) method of repeatedly computing brackets to find a basis of the ideal is available, as opposed to the Gr\u00f6bner-basis style methods that would need to be used in the general case. Part of a part of #16824\n+An implementation of ideals and subalgebras generated by a subset of a finite dimensional Lie algebra with basis. In the finite dimensional case a naive (and probably inefficient) method of repeatedly computing brackets to find a basis of the ideal or subalgebra is available, as opposed to the Gr\u00f6bner-basis style methods that would need to be used in the general case. Part of a part of #16824\n``````\n",
    "created_at": "2018-08-29T06:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404416",
    "user": "https://github.com/ehaka"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-An implementation of ideals generated by a subset of a finite dimensional Lie algebra with basis. In the finite dimensional case a naive (and probably inefficient) method of repeatedly computing brackets to find a basis of the ideal is available, as opposed to the Gröbner-basis style methods that would need to be used in the general case. Part of a part of #16824
+An implementation of ideals and subalgebras generated by a subset of a finite dimensional Lie algebra with basis. In the finite dimensional case a naive (and probably inefficient) method of repeatedly computing brackets to find a basis of the ideal or subalgebra is available, as opposed to the Gröbner-basis style methods that would need to be used in the general case. Part of a part of #16824
``````




---

archive/issue_comments_404417.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nA first iteration of ideals and subalgebras of finite dimensional Lie algebras with basis is in the commits. I added subalgebras to the scope of this ticket since it turned out that a lot of the code fit naturally within the subalgebra setting, and the only extra piece was the differing computation of a basis.\n\nThe implementation of ideals+subalgebras is through a `LieSubset` base class, whose elements are wrappers (subclassing `LieAlgebraElementWrapper`) around elements of the ambient Lie algebra. Any computations are done by the lift-retract model suggested by `Sets().Subobjects()`.\n\nMuch of the code would fit inside also within a generic `LieIdeal` or `LieSubalgebra` class, however the essential part of containment testing of elements would not be implemented, so I decided to leave all the code in a finite dimensional class for now.\n\nAlthough technically independent from nilpotent Lie algebras, I added the dependency #26076 in order  to implement the fact that a subalgebra or ideal of a nilpotent Lie algebra is also nilpotent.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b70bebd70696d8d22a58b422f90c701cb459f2db\">b70bebd</a></td><td><code>doctest fix for changed category printing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7699db449d8cc3d3d85df364c5ef7ddf152a30eb\">7699db4</a></td><td><code>Merge branch 'u/gh-ehaka/free_nilpotent_lie_algebras-26076' of git://trac.sagemath.org/sage into public/lie_algebras/free_nilpotent-26076</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1fe093f0eb87fadf439bd6ba15e2ab80627ffdd\">d1fe093</a></td><td><code>Some reviewer changes and tweaks.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a60ef683b3747b7d129b14b6834d0f329820a4fa\">a60ef68</a></td><td><code>Speedup constructor for free Nilpotent Lie algebras.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/664fbeceb2594310cb95ffe1df434e41ceb5ebbd\">664fbec</a></td><td><code>Changing r=10 as cutoff to requiring a linear ordering.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c3f341ae792695efa204240163ba330af049557\">1c3f341</a></td><td><code>Merge remote-tracking branch 'trac/public/lie_algebras/free_nilpotent-26076' into lieideals-26078</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5a660048419c04e01a4218f680628cadd74dd09\">a5a6600</a></td><td><code>Initial implementation of finite dim subalgebras and ideals</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69dfbfe2257f97f1ea5fec495f3a1909558214c8\">69dfbfe</a></td><td><code>Preserve nilpotent category for ideals and subalgebras of nilpotent Lie algebras</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0d60e1f775af58e648f1c062d6128a2f164217d\">a0d60e1</a></td><td><code>Refactored subobject computations to use lift and retract instead of value</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59576970729d4378562773cc04af617b183b2127\">5957697</a></td><td><code>Fix for lower central series computation of subalgebras: 'from_vector' now checks if the vector is given in the ambient or intrinsic form</code></td></tr></table>\n",
    "created_at": "2018-08-29T06:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404417",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:4" align="right">Comment 4</div>

A first iteration of ideals and subalgebras of finite dimensional Lie algebras with basis is in the commits. I added subalgebras to the scope of this ticket since it turned out that a lot of the code fit naturally within the subalgebra setting, and the only extra piece was the differing computation of a basis.

The implementation of ideals+subalgebras is through a `LieSubset` base class, whose elements are wrappers (subclassing `LieAlgebraElementWrapper`) around elements of the ambient Lie algebra. Any computations are done by the lift-retract model suggested by `Sets().Subobjects()`.

Much of the code would fit inside also within a generic `LieIdeal` or `LieSubalgebra` class, however the essential part of containment testing of elements would not be implemented, so I decided to leave all the code in a finite dimensional class for now.

Although technically independent from nilpotent Lie algebras, I added the dependency #26076 in order  to implement the fact that a subalgebra or ideal of a nilpotent Lie algebra is also nilpotent.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b70bebd70696d8d22a58b422f90c701cb459f2db">b70bebd</a></td><td><code>doctest fix for changed category printing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7699db449d8cc3d3d85df364c5ef7ddf152a30eb">7699db4</a></td><td><code>Merge branch 'u/gh-ehaka/free_nilpotent_lie_algebras-26076' of git://trac.sagemath.org/sage into public/lie_algebras/free_nilpotent-26076</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1fe093f0eb87fadf439bd6ba15e2ab80627ffdd">d1fe093</a></td><td><code>Some reviewer changes and tweaks.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a60ef683b3747b7d129b14b6834d0f329820a4fa">a60ef68</a></td><td><code>Speedup constructor for free Nilpotent Lie algebras.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/664fbeceb2594310cb95ffe1df434e41ceb5ebbd">664fbec</a></td><td><code>Changing r=10 as cutoff to requiring a linear ordering.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c3f341ae792695efa204240163ba330af049557">1c3f341</a></td><td><code>Merge remote-tracking branch 'trac/public/lie_algebras/free_nilpotent-26076' into lieideals-26078</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5a660048419c04e01a4218f680628cadd74dd09">a5a6600</a></td><td><code>Initial implementation of finite dim subalgebras and ideals</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69dfbfe2257f97f1ea5fec495f3a1909558214c8">69dfbfe</a></td><td><code>Preserve nilpotent category for ideals and subalgebras of nilpotent Lie algebras</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0d60e1f775af58e648f1c062d6128a2f164217d">a0d60e1</a></td><td><code>Refactored subobject computations to use lift and retract instead of value</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59576970729d4378562773cc04af617b183b2127">5957697</a></td><td><code>Fix for lower central series computation of subalgebras: 'from_vector' now checks if the vector is given in the ambient or intrinsic form</code></td></tr></table>




---

archive/issue_events_342039.json:
```json
{
    "actor": "https://github.com/ehaka",
    "created_at": "2018-08-29T06:13:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "title_is": "Ideals and subalgebras of finite dimensional Lie algebras",
    "title_was": "Ideals of finite dimensional Lie algebras",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342039"
}
```



---

archive/issue_comments_404418.json:
```json
{
    "body": "Branch: **[u/gh-ehaka/lie_ideals-26078](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-ehaka/lie_ideals-26078)**",
    "created_at": "2018-08-29T06:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404418",
    "user": "https://github.com/ehaka"
}
```

Branch: **[u/gh-ehaka/lie_ideals-26078](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-ehaka/lie_ideals-26078)**



---

archive/issue_events_342040.json:
```json
{
    "actor": "https://github.com/ehaka",
    "created_at": "2018-08-29T06:13:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342040"
}
```



---

archive/issue_comments_404419.json:
```json
{
    "body": "Dependencies: **#26076**",
    "created_at": "2018-08-29T06:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404419",
    "user": "https://github.com/ehaka"
}
```

Dependencies: **#26076**



---

archive/issue_comments_404420.json:
```json
{
    "body": "Commit: **[5957697](https://github.com/sagemath/sagetrac-mirror/commit/59576970729d4378562773cc04af617b183b2127)**",
    "created_at": "2018-08-29T06:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404420",
    "user": "https://github.com/ehaka"
}
```

Commit: **[5957697](https://github.com/sagemath/sagetrac-mirror/commit/59576970729d4378562773cc04af617b183b2127)**



---

archive/issue_comments_404421.json:
```json
{
    "body": "Changed keywords from **Lie algebras, ideals** to **Lie algebras, ideals, subalgebras**",
    "created_at": "2018-08-29T06:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404421",
    "user": "https://github.com/ehaka"
}
```

Changed keywords from **Lie algebras, ideals** to **Lie algebras, ideals, subalgebras**



---

archive/issue_comments_404422.json:
```json
{
    "body": "Changed commit from **[5957697](https://github.com/sagemath/sagetrac-mirror/commit/59576970729d4378562773cc04af617b183b2127)** to **[e2cdaed](https://github.com/sagemath/sagetrac-mirror/commit/e2cdaed522396d8154a9eed6246580a886b8f366)**",
    "created_at": "2018-08-29T06:18:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404422",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[5957697](https://github.com/sagemath/sagetrac-mirror/commit/59576970729d4378562773cc04af617b183b2127)** to **[e2cdaed](https://github.com/sagemath/sagetrac-mirror/commit/e2cdaed522396d8154a9eed6246580a886b8f366)**



---

archive/issue_comments_404423.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2cdaed522396d8154a9eed6246580a886b8f366\">e2cdaed</a></td><td><code>Added doctest for nilpotency step computation of ideals and subalgebras</code></td></tr></table>\n",
    "created_at": "2018-08-29T06:18:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404423",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5" align="right">Comment 5</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2cdaed522396d8154a9eed6246580a886b8f366">e2cdaed</a></td><td><code>Added doctest for nilpotency step computation of ideals and subalgebras</code></td></tr></table>




---

archive/issue_comments_404424.json:
```json
{
    "body": "Changed commit from **[e2cdaed](https://github.com/sagemath/sagetrac-mirror/commit/e2cdaed522396d8154a9eed6246580a886b8f366)** to **[2d7c007](https://github.com/sagemath/sagetrac-mirror/commit/2d7c00706e3bc93cc85d81ef7d2f77c8632ea86a)**",
    "created_at": "2018-09-02T11:03:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404424",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e2cdaed](https://github.com/sagemath/sagetrac-mirror/commit/e2cdaed522396d8154a9eed6246580a886b8f366)** to **[2d7c007](https://github.com/sagemath/sagetrac-mirror/commit/2d7c00706e3bc93cc85d81ef7d2f77c8632ea86a)**



---

archive/issue_comments_404425.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff672fc23d93ec67f595348827cc69e2e07bcf12\">ff672fc</a></td><td><code>retract to subalgebra now checks that the element is contained in the subalgebra</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d7c00706e3bc93cc85d81ef7d2f77c8632ea86a\">2d7c007</a></td><td><code>Added repr_short method to ideals mimicking ring ideals</code></td></tr></table>\n",
    "created_at": "2018-09-02T11:03:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404425",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6" align="right">Comment 6</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff672fc23d93ec67f595348827cc69e2e07bcf12">ff672fc</a></td><td><code>retract to subalgebra now checks that the element is contained in the subalgebra</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d7c00706e3bc93cc85d81ef7d2f77c8632ea86a">2d7c007</a></td><td><code>Added repr_short method to ideals mimicking ring ideals</code></td></tr></table>




---

archive/issue_comments_404426.json:
```json
{
    "body": "Changed commit from **[2d7c007](https://github.com/sagemath/sagetrac-mirror/commit/2d7c00706e3bc93cc85d81ef7d2f77c8632ea86a)** to **[209c755](https://github.com/sagemath/sagetrac-mirror/commit/209c75541d4f6a4bfe7ba1c469b14a9ffe66a6e8)**",
    "created_at": "2018-09-02T13:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404426",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2d7c007](https://github.com/sagemath/sagetrac-mirror/commit/2d7c00706e3bc93cc85d81ef7d2f77c8632ea86a)** to **[209c755](https://github.com/sagemath/sagetrac-mirror/commit/209c75541d4f6a4bfe7ba1c469b14a9ffe66a6e8)**



---

archive/issue_comments_404427.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/209c75541d4f6a4bfe7ba1c469b14a9ffe66a6e8\">209c755</a></td><td><code>Fixed error in testing if a subalgebra or ideal is an ideal of a Lie algebra</code></td></tr></table>\n",
    "created_at": "2018-09-02T13:34:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404427",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7" align="right">Comment 7</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/209c75541d4f6a4bfe7ba1c469b14a9ffe66a6e8">209c755</a></td><td><code>Fixed error in testing if a subalgebra or ideal is an ideal of a Lie algebra</code></td></tr></table>




---

archive/issue_comments_404428.json:
```json
{
    "body": "Author: **Eero Hakavuori**",
    "created_at": "2018-09-02T14:38:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404428",
    "user": "https://github.com/ehaka"
}
```

Author: **Eero Hakavuori**



---

archive/issue_comments_404429.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nSome comments:\n\nWhy do you have these ABCs? I don't see the point of having them and instead just having `LieSubalgebra_finite_dimensional_with_basis` as the starting class. It is easy enough to separate things once we find a use-case for them, but doing so prematurely can make it harder in terms of maintenance. Of course, if you do have a use-case for them in the future, just let me know.\n\nRather than manually setting the category as default, you should just use\n\n```\nambient.category().Subobjects()\n```\nas that means you do not need the essentially duplication of `subalgebra` and `ideal` in the fin-dim nilpotent with basis category. It also is a much more robust default.\n\nIn `basis()`, `EXAMPLES:` -> `EXAMPLES::`.\n\n`monomoial_coefficients` should not have keys that are not in the support (e.g., the `0: 0` in your example).\n\nSubsequently your `__getitem__` should just call `self.to_vector()[i]` (and return `0` if `i` is not in the basis index set).\n\nI would consider caching the result of `to_vector()` since it is computationally expensive.\n\nI would change `ambient_submodule` to\n\n```python\n    def module(self, sparse=False):\n        m = self.ambient().module(sparse=sparse)\n        ambientbasis = [self.lift(X).to_vector() for X in self.basis()]\n        return m.submodule_with_basis(ambientbasis)\n```\nI found the name somewhat confusing and nothing in the API for `module` forces the result to be an ambient module (nor should it have specifically contain \"free\" in its doc). The result of `module` is meant to reflect the space where we want to do the linear algebra computations.\n\n`if len(gens) == 0:` -> `if not gens:` Although I think in this case, it is better to not have any generators, even if it makes the code more complicated. I would also strip all copies of 0 from the generating set for better input normalization.\n\nI would avoid the use of the (more) ambiguous `gens` in the subalgebra code and instead use `lie_algebra_generators`.\n\nInstead of `P.ambient().bracket(self_lift, x_lift)`, use the more direct (and faster) `self_lift._bracket_(x_lift)`. Similarly, instead of calling the lift, I would just use `self_lift = self.value`. Internal methods can use internal parts. :)\n\nDo you want to implement methods like `__add__`, `direct_sum`, `is_subalgebra`, `intersection` (for ideals), etc. on this ticket? Similarly, do we want to add shorthands such as `L[x, L]` and `x.bracket(L)` for creating ideals? (I am happy to do these implementations.)",
    "created_at": "2018-09-08T22:35:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404429",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:9" align="right">Comment 9</div>

Some comments:

Why do you have these ABCs? I don't see the point of having them and instead just having `LieSubalgebra_finite_dimensional_with_basis` as the starting class. It is easy enough to separate things once we find a use-case for them, but doing so prematurely can make it harder in terms of maintenance. Of course, if you do have a use-case for them in the future, just let me know.

Rather than manually setting the category as default, you should just use

```
ambient.category().Subobjects()
```
as that means you do not need the essentially duplication of `subalgebra` and `ideal` in the fin-dim nilpotent with basis category. It also is a much more robust default.

In `basis()`, `EXAMPLES:` -> `EXAMPLES::`.

`monomoial_coefficients` should not have keys that are not in the support (e.g., the `0: 0` in your example).

Subsequently your `__getitem__` should just call `self.to_vector()[i]` (and return `0` if `i` is not in the basis index set).

I would consider caching the result of `to_vector()` since it is computationally expensive.

I would change `ambient_submodule` to

```python
    def module(self, sparse=False):
        m = self.ambient().module(sparse=sparse)
        ambientbasis = [self.lift(X).to_vector() for X in self.basis()]
        return m.submodule_with_basis(ambientbasis)
```
I found the name somewhat confusing and nothing in the API for `module` forces the result to be an ambient module (nor should it have specifically contain "free" in its doc). The result of `module` is meant to reflect the space where we want to do the linear algebra computations.

`if len(gens) == 0:` -> `if not gens:` Although I think in this case, it is better to not have any generators, even if it makes the code more complicated. I would also strip all copies of 0 from the generating set for better input normalization.

I would avoid the use of the (more) ambiguous `gens` in the subalgebra code and instead use `lie_algebra_generators`.

Instead of `P.ambient().bracket(self_lift, x_lift)`, use the more direct (and faster) `self_lift._bracket_(x_lift)`. Similarly, instead of calling the lift, I would just use `self_lift = self.value`. Internal methods can use internal parts. :)

Do you want to implement methods like `__add__`, `direct_sum`, `is_subalgebra`, `intersection` (for ideals), etc. on this ticket? Similarly, do we want to add shorthands such as `L[x, L]` and `x.bracket(L)` for creating ideals? (I am happy to do these implementations.)



---

archive/issue_comments_404430.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nReplying to [@tscrim](#comment%3A9):\n> Some comments:\n> \n> Of course, if you do have a use-case for them in the future, just let me know.\n\nNo use case, just my own misunderstanding of which way of doing things was more maintainable. I will fix this now.\n\n> Rather than manually setting the category as default, you should just use\n> \n> ```\n> ambient.category().Subobjects()\n> ```\n> as that means you do not need the essentially duplication of `subalgebra` and `ideal` in the fin-dim nilpotent with basis category. It also is a much more robust default.\n\nThe thing I was worried about here is the `Graded` and `Stratified` categories. The result in such cases would be\n\n```\nsage: LieAlgebras(QQ).Graded().Subobjects()\nJoin of Category of graded Lie algebras over Rational Field and Category of subobjects of sets\n```\nbut not every subalgebra is graded, so this would still need separate handling. Because of this it wasn't clear to me if categories should be handled in an 'opt-out' or 'opt-in' manner. The main worry was that if the default is 'opt-out', then any future implementation of a subcategory of Lie algebras would have to also consider whether ideals and subalgebras are automatically in this category, which sounded error-prone.\n\n> I would change `ambient_submodule` to\n> \n> ```python\n>     def module(self, sparse=False):\n>         m = self.ambient().module(sparse=sparse)\n>         ambientbasis = [self.lift(X).to_vector() for X in self.basis()]\n>         return m.submodule_with_basis(ambientbasis)\n> ```\n> I found the name somewhat confusing and nothing in the API for `module` forces the result to be an ambient module (nor should it have specifically contain \"free\" in its doc). The result of `module` is meant to reflect the space where we want to do the linear algebra computations.\n\nWill fix. However I am not sure how to get rid of \"free\" coming from\n\n```\nsage: L.<X,Y,Z> = LieAlgebra(ZZ, {('X','Y'): {'Z': 3}})\nsage: L.module(sparse=False)\nAmbient free module of rank 3 over the principal ideal domain Integer Ring\n```\n\n> `if len(gens) == 0:` -> `if not gens:` Although I think in this case, it is better to not have any generators, even if it makes the code more complicated. I would also strip all copies of 0 from the generating set for better input normalization.\n\nHow much processing should be done here? The upper limit I suppose would be to extract a maximal linearly independent subset, but this might be too expensive for high dimensions. I will add the 'cheap' zero-stripping now.\n\n> I would avoid the use of the (more) ambiguous `gens` in the subalgebra code and instead use `lie_algebra_generators`.\n\nI will add `lie_algebra_generators` to subalgebras, but also keep `gens`, since it is used also by ideals, and I think it would be confusing to have the generating set of an ideal referred to as `lie_algebra_generators`.\n\n> Do you want to implement methods like `__add__`, `direct_sum`, `is_subalgebra`, `intersection` (for ideals), etc. on this ticket? Similarly, do we want to add shorthands such as `L[x, L]` and `x.bracket(L)` for creating ideals? (I am happy to do these implementations.)\n\nThese sound like very good convenience additions. You can do the implementation as you most likely have a clearer vision on how it should be done.\n\nI will do the other corrections now, except for the default category thing, as I would still like to hear your comments on how to handle the `Graded` issue.",
    "created_at": "2018-09-09T05:54:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404430",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:10" align="right">Comment 10</div>

Replying to [@tscrim](#comment%3A9):
> Some comments:
> 
> Of course, if you do have a use-case for them in the future, just let me know.

No use case, just my own misunderstanding of which way of doing things was more maintainable. I will fix this now.

> Rather than manually setting the category as default, you should just use
> 
> ```
> ambient.category().Subobjects()
> ```
> as that means you do not need the essentially duplication of `subalgebra` and `ideal` in the fin-dim nilpotent with basis category. It also is a much more robust default.

The thing I was worried about here is the `Graded` and `Stratified` categories. The result in such cases would be

```
sage: LieAlgebras(QQ).Graded().Subobjects()
Join of Category of graded Lie algebras over Rational Field and Category of subobjects of sets
```
but not every subalgebra is graded, so this would still need separate handling. Because of this it wasn't clear to me if categories should be handled in an 'opt-out' or 'opt-in' manner. The main worry was that if the default is 'opt-out', then any future implementation of a subcategory of Lie algebras would have to also consider whether ideals and subalgebras are automatically in this category, which sounded error-prone.

> I would change `ambient_submodule` to
> 
> ```python
>     def module(self, sparse=False):
>         m = self.ambient().module(sparse=sparse)
>         ambientbasis = [self.lift(X).to_vector() for X in self.basis()]
>         return m.submodule_with_basis(ambientbasis)
> ```
> I found the name somewhat confusing and nothing in the API for `module` forces the result to be an ambient module (nor should it have specifically contain "free" in its doc). The result of `module` is meant to reflect the space where we want to do the linear algebra computations.

Will fix. However I am not sure how to get rid of "free" coming from

```
sage: L.<X,Y,Z> = LieAlgebra(ZZ, {('X','Y'): {'Z': 3}})
sage: L.module(sparse=False)
Ambient free module of rank 3 over the principal ideal domain Integer Ring
```

> `if len(gens) == 0:` -> `if not gens:` Although I think in this case, it is better to not have any generators, even if it makes the code more complicated. I would also strip all copies of 0 from the generating set for better input normalization.

How much processing should be done here? The upper limit I suppose would be to extract a maximal linearly independent subset, but this might be too expensive for high dimensions. I will add the 'cheap' zero-stripping now.

> I would avoid the use of the (more) ambiguous `gens` in the subalgebra code and instead use `lie_algebra_generators`.

I will add `lie_algebra_generators` to subalgebras, but also keep `gens`, since it is used also by ideals, and I think it would be confusing to have the generating set of an ideal referred to as `lie_algebra_generators`.

> Do you want to implement methods like `__add__`, `direct_sum`, `is_subalgebra`, `intersection` (for ideals), etc. on this ticket? Similarly, do we want to add shorthands such as `L[x, L]` and `x.bracket(L)` for creating ideals? (I am happy to do these implementations.)

These sound like very good convenience additions. You can do the implementation as you most likely have a clearer vision on how it should be done.

I will do the other corrections now, except for the default category thing, as I would still like to hear your comments on how to handle the `Graded` issue.



---

archive/issue_comments_404431.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@ehaka](#comment%3A10):\n> Replying to [@tscrim](#comment%3A9):\n> > Rather than manually setting the category as default, you should just use\n> > \n> > ```\n> > ambient.category().Subobjects()\n> > ```\n> > as that means you do not need the essentially duplication of `subalgebra` and `ideal` in the fin-dim nilpotent with basis category. It also is a much more robust default.\n\n> \n> The thing I was worried about here is the `Graded` and `Stratified` categories. The result in such cases would be\n> \n> ```\n> sage: LieAlgebras(QQ).Graded().Subobjects()\n> Join of Category of graded Lie algebras over Rational Field and Category of subobjects of sets\n> ```\n> but not every subalgebra is graded, so this would still need separate handling. Because of this it wasn't clear to me if categories should be handled in an 'opt-out' or 'opt-in' manner. The main worry was that if the default is 'opt-out', then any future implementation of a subcategory of Lie algebras would have to also consider whether ideals and subalgebras are automatically in this category, which sounded error-prone.\n\nAh, I see your point. However, I think this might be more of an issue of `Subobjects` interacting with `Grading` improperly. The category should be subobjects of the ambient category, but you are correct, it does not imply they are graded. I will ask Nicolas about this.\n\n> > I would change `ambient_submodule` to\n> > \n> > ```python\n> >     def module(self, sparse=False):\n> >         m = self.ambient().module(sparse=sparse)\n> >         ambientbasis = [self.lift(X).to_vector() for X in self.basis()]\n> >         return m.submodule_with_basis(ambientbasis)\n> > ```\n> > I found the name somewhat confusing and nothing in the API for `module` forces the result to be an ambient module (nor should it have specifically contain \"free\" in its doc). The result of `module` is meant to reflect the space where we want to do the linear algebra computations.\n\n> \n> Will fix. However I am not sure how to get rid of \"free\" coming from\n> \n> ```\n> sage: L.<X,Y,Z> = LieAlgebra(ZZ, {('X','Y'): {'Z': 3}})\n> sage: L.module(sparse=False)\n> Ambient free module of rank 3 over the principal ideal domain Integer Ring\n> ```\n\nAs for the free modules, the result of `module` are (generally) free modules since we usually work on Lie algebras over fields or PIDs. The result in this case is a free module, so it is somewhat expected in the output.\n\n> > `if len(gens) == 0:` -> `if not gens:` Although I think in this case, it is better to not have any generators, even if it makes the code more complicated. I would also strip all copies of 0 from the generating set for better input normalization.\n\n> \n> How much processing should be done here? The upper limit I suppose would be to extract a maximal linearly independent subset, but this might be too expensive for high dimensions. I will add the 'cheap' zero-stripping now.\n\nI think removing the \"cheap\" zeros (i.e., identically zero) gens is sufficient.\n\n> > I would avoid the use of the (more) ambiguous `gens` in the subalgebra code and instead use `lie_algebra_generators`.\n\n> \n> I will add `lie_algebra_generators` to subalgebras, but also keep `gens`, since it is used also by ideals, and I think it would be confusing to have the generating set of an ideal referred to as `lie_algebra_generators`.\n\n+1 for keeping `gens`, especially for ideals, but for an ideal, `lie_algebra_generators` should redirect to `basis` (as otherwise `gens` is not guaranteed to generate the ideal as a Lie subalgebra).\n\n> > Do you want to implement methods like `__add__`, `direct_sum`, `is_subalgebra`, `intersection` (for ideals), etc. on this ticket? Similarly, do we want to add shorthands such as `L[x, L]` and `x.bracket(L)` for creating ideals? (I am happy to do these implementations.)\n\n> \n> These sound like very good convenience additions. You can do the implementation as you most likely have a clearer vision on how it should be done.\n\nI will do that soon.",
    "created_at": "2018-09-09T06:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404431",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@ehaka](#comment%3A10):
> Replying to [@tscrim](#comment%3A9):
> > Rather than manually setting the category as default, you should just use
> > 
> > ```
> > ambient.category().Subobjects()
> > ```
> > as that means you do not need the essentially duplication of `subalgebra` and `ideal` in the fin-dim nilpotent with basis category. It also is a much more robust default.

> 
> The thing I was worried about here is the `Graded` and `Stratified` categories. The result in such cases would be
> 
> ```
> sage: LieAlgebras(QQ).Graded().Subobjects()
> Join of Category of graded Lie algebras over Rational Field and Category of subobjects of sets
> ```
> but not every subalgebra is graded, so this would still need separate handling. Because of this it wasn't clear to me if categories should be handled in an 'opt-out' or 'opt-in' manner. The main worry was that if the default is 'opt-out', then any future implementation of a subcategory of Lie algebras would have to also consider whether ideals and subalgebras are automatically in this category, which sounded error-prone.

Ah, I see your point. However, I think this might be more of an issue of `Subobjects` interacting with `Grading` improperly. The category should be subobjects of the ambient category, but you are correct, it does not imply they are graded. I will ask Nicolas about this.

> > I would change `ambient_submodule` to
> > 
> > ```python
> >     def module(self, sparse=False):
> >         m = self.ambient().module(sparse=sparse)
> >         ambientbasis = [self.lift(X).to_vector() for X in self.basis()]
> >         return m.submodule_with_basis(ambientbasis)
> > ```
> > I found the name somewhat confusing and nothing in the API for `module` forces the result to be an ambient module (nor should it have specifically contain "free" in its doc). The result of `module` is meant to reflect the space where we want to do the linear algebra computations.

> 
> Will fix. However I am not sure how to get rid of "free" coming from
> 
> ```
> sage: L.<X,Y,Z> = LieAlgebra(ZZ, {('X','Y'): {'Z': 3}})
> sage: L.module(sparse=False)
> Ambient free module of rank 3 over the principal ideal domain Integer Ring
> ```

As for the free modules, the result of `module` are (generally) free modules since we usually work on Lie algebras over fields or PIDs. The result in this case is a free module, so it is somewhat expected in the output.

> > `if len(gens) == 0:` -> `if not gens:` Although I think in this case, it is better to not have any generators, even if it makes the code more complicated. I would also strip all copies of 0 from the generating set for better input normalization.

> 
> How much processing should be done here? The upper limit I suppose would be to extract a maximal linearly independent subset, but this might be too expensive for high dimensions. I will add the 'cheap' zero-stripping now.

I think removing the "cheap" zeros (i.e., identically zero) gens is sufficient.

> > I would avoid the use of the (more) ambiguous `gens` in the subalgebra code and instead use `lie_algebra_generators`.

> 
> I will add `lie_algebra_generators` to subalgebras, but also keep `gens`, since it is used also by ideals, and I think it would be confusing to have the generating set of an ideal referred to as `lie_algebra_generators`.

+1 for keeping `gens`, especially for ideals, but for an ideal, `lie_algebra_generators` should redirect to `basis` (as otherwise `gens` is not guaranteed to generate the ideal as a Lie subalgebra).

> > Do you want to implement methods like `__add__`, `direct_sum`, `is_subalgebra`, `intersection` (for ideals), etc. on this ticket? Similarly, do we want to add shorthands such as `L[x, L]` and `x.bracket(L)` for creating ideals? (I am happy to do these implementations.)

> 
> These sound like very good convenience additions. You can do the implementation as you most likely have a clearer vision on how it should be done.

I will do that soon.



---

archive/issue_comments_404432.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a25fe51f655acaac05ac7fcdd8c070f839feefe8\">a25fe51</a></td><td><code>trac #26078: combining unused base classes and changing module behavior for subalgebras</code></td></tr></table>\n",
    "created_at": "2018-09-09T07:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404432",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12" align="right">Comment 12</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a25fe51f655acaac05ac7fcdd8c070f839feefe8">a25fe51</a></td><td><code>trac #26078: combining unused base classes and changing module behavior for subalgebras</code></td></tr></table>




---

archive/issue_comments_404433.json:
```json
{
    "body": "Changed commit from **[209c755](https://github.com/sagemath/sagetrac-mirror/commit/209c75541d4f6a4bfe7ba1c469b14a9ffe66a6e8)** to **[a25fe51](https://github.com/sagemath/sagetrac-mirror/commit/a25fe51f655acaac05ac7fcdd8c070f839feefe8)**",
    "created_at": "2018-09-09T07:49:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404433",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[209c755](https://github.com/sagemath/sagetrac-mirror/commit/209c75541d4f6a4bfe7ba1c469b14a9ffe66a6e8)** to **[a25fe51](https://github.com/sagemath/sagetrac-mirror/commit/a25fe51f655acaac05ac7fcdd8c070f839feefe8)**



---

archive/issue_comments_404434.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nI made the changes, however I am still having some confusion with the desired behavior for the subalgebra element methods `__getitem__`, `to_vector` and `monomial_coefficients`. \n\nHaving changed `module` to refer to a submodule of the ambient Lie algebra as opposed to the intrinsic module, `to_vector` should naturally give elements in the same ambient format, i.e. not in the intrinsic basis. The doc of `monomial_coefficients` refers to the basis of `self` though, so that is now still given in terms of the intrinsic basis. It wasn't clear to me which of these `__getitem__` should refer to. Currently I left it pointing to `monomial_coefficients`.",
    "created_at": "2018-09-09T08:00:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404434",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:13" align="right">Comment 13</div>

I made the changes, however I am still having some confusion with the desired behavior for the subalgebra element methods `__getitem__`, `to_vector` and `monomial_coefficients`. 

Having changed `module` to refer to a submodule of the ambient Lie algebra as opposed to the intrinsic module, `to_vector` should naturally give elements in the same ambient format, i.e. not in the intrinsic basis. The doc of `monomial_coefficients` refers to the basis of `self` though, so that is now still given in terms of the intrinsic basis. It wasn't clear to me which of these `__getitem__` should refer to. Currently I left it pointing to `monomial_coefficients`.



---

archive/issue_comments_404435.json:
```json
{
    "body": "Changed commit from **[a25fe51](https://github.com/sagemath/sagetrac-mirror/commit/a25fe51f655acaac05ac7fcdd8c070f839feefe8)** to **[64ec990](https://github.com/sagemath/sagetrac-mirror/commit/64ec99048e3635490dd8baa8d45763a73fd86592)**",
    "created_at": "2018-09-09T08:12:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404435",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a25fe51](https://github.com/sagemath/sagetrac-mirror/commit/a25fe51f655acaac05ac7fcdd8c070f839feefe8)** to **[64ec990](https://github.com/sagemath/sagetrac-mirror/commit/64ec99048e3635490dd8baa8d45763a73fd86592)**



---

archive/issue_comments_404436.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64ec99048e3635490dd8baa8d45763a73fd86592\">64ec990</a></td><td><code>trac #26078: to_vector() now gives an element whose parent is the correct module</code></td></tr></table>\n",
    "created_at": "2018-09-09T08:12:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404436",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14" align="right">Comment 14</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64ec99048e3635490dd8baa8d45763a73fd86592">64ec990</a></td><td><code>trac #26078: to_vector() now gives an element whose parent is the correct module</code></td></tr></table>




---

archive/issue_comments_404437.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nI think `__getitem__` should mimic `monomial_coefficients` and give things in terms of the intrinsic basis (more generally, if we have some way to give a Lie algebra a custom support set, it should return the coefficient of the basis element corresponding to the input `i`, cf. the Lie algebras defined via structure coefficients).\n\nSo I had a brief email exchange with Nicolas, and the conclusion I arrived to is we probably should (for now) just do the parsing in the explicit subalgebra class (this is what is done in the `SubmoduleWithBasis` class). This will probably be the case until a generic mechanism is added to the category framework.",
    "created_at": "2018-09-09T09:05:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404437",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">Comment 15</div>

I think `__getitem__` should mimic `monomial_coefficients` and give things in terms of the intrinsic basis (more generally, if we have some way to give a Lie algebra a custom support set, it should return the coefficient of the basis element corresponding to the input `i`, cf. the Lie algebras defined via structure coefficients).

So I had a brief email exchange with Nicolas, and the conclusion I arrived to is we probably should (for now) just do the parsing in the explicit subalgebra class (this is what is done in the `SubmoduleWithBasis` class). This will probably be the case until a generic mechanism is added to the category framework.



---

archive/issue_comments_404438.json:
```json
{
    "body": "Changed commit from **[64ec990](https://github.com/sagemath/sagetrac-mirror/commit/64ec99048e3635490dd8baa8d45763a73fd86592)** to **[4981fd4](https://github.com/sagemath/sagetrac-mirror/commit/4981fd4411d664ad87ae310baa0cefed5fb3a167)**",
    "created_at": "2018-09-09T14:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404438",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[64ec990](https://github.com/sagemath/sagetrac-mirror/commit/64ec99048e3635490dd8baa8d45763a73fd86592)** to **[4981fd4](https://github.com/sagemath/sagetrac-mirror/commit/4981fd4411d664ad87ae310baa0cefed5fb3a167)**



---

archive/issue_comments_404439.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4981fd4411d664ad87ae310baa0cefed5fb3a167\">4981fd4</a></td><td><code>trac #26078: moved ideal nilpotency construction out of category code</code></td></tr></table>\n",
    "created_at": "2018-09-09T14:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404439",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16" align="right">Comment 16</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4981fd4411d664ad87ae310baa0cefed5fb3a167">4981fd4</a></td><td><code>trac #26078: moved ideal nilpotency construction out of category code</code></td></tr></table>




---

archive/issue_comments_404440.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nI think it would be better to have\n\n```\n        category = cat.Subobjects().or_subcategory(category)\n        if ambient in LieAlgebras(ambient.base_ring()).Nilpotent():\n            category = category.Nilpotent()\n```\nsince that way we don't have to force the user to pass a nilpotent category. Likewise, we should allow the user to pass a `category` via `subalgebra` and `ideal`.\n\nThinking a little bit more, we probably want to combine the ideal and subalgebra classes and simply use an attribute `_is_ideal` (for the `basis()` method) and the `self.is_ideal(self.ambient())` as a check for when we need the code to diverge. This would keep things easier to work with as perhaps we construct something as a subalgebra that happens to be an ideal, but we don't want to compute things twice or have messy code to share data. Does that make sense?",
    "created_at": "2018-09-10T07:21:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404440",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">Comment 17</div>

I think it would be better to have

```
        category = cat.Subobjects().or_subcategory(category)
        if ambient in LieAlgebras(ambient.base_ring()).Nilpotent():
            category = category.Nilpotent()
```
since that way we don't have to force the user to pass a nilpotent category. Likewise, we should allow the user to pass a `category` via `subalgebra` and `ideal`.

Thinking a little bit more, we probably want to combine the ideal and subalgebra classes and simply use an attribute `_is_ideal` (for the `basis()` method) and the `self.is_ideal(self.ambient())` as a check for when we need the code to diverge. This would keep things easier to work with as perhaps we construct something as a subalgebra that happens to be an ideal, but we don't want to compute things twice or have messy code to share data. Does that make sense?



---

archive/issue_comments_404441.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nReplying to [@tscrim](#comment%3A17):\n> I think it would be better to have\n> \n> ```\n>         category = cat.Subobjects().or_subcategory(category)\n>         if ambient in LieAlgebras(ambient.base_ring()).Nilpotent():\n>             category = category.Nilpotent()\n> ```\n> since that way we don't have to force the user to pass a nilpotent category. Likewise, we should allow the user to pass a `category` via `subalgebra` and `ideal`.\n> \n> Thinking a little bit more, we probably want to combine the ideal and subalgebra classes and simply use an attribute `_is_ideal` (for the `basis()` method) and the `self.is_ideal(self.ambient())` as a check for when we need the code to diverge. This would keep things easier to work with as perhaps we construct something as a subalgebra that happens to be an ideal, but we don't want to compute things twice or have messy code to share data. Does that make sense?\n\nThat does sound like it could work. Should the class name stay as subalgebra or be something else? I could try to refactor this in later today.",
    "created_at": "2018-09-10T07:32:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404441",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:18" align="right">Comment 18</div>

Replying to [@tscrim](#comment%3A17):
> I think it would be better to have
> 
> ```
>         category = cat.Subobjects().or_subcategory(category)
>         if ambient in LieAlgebras(ambient.base_ring()).Nilpotent():
>             category = category.Nilpotent()
> ```
> since that way we don't have to force the user to pass a nilpotent category. Likewise, we should allow the user to pass a `category` via `subalgebra` and `ideal`.
> 
> Thinking a little bit more, we probably want to combine the ideal and subalgebra classes and simply use an attribute `_is_ideal` (for the `basis()` method) and the `self.is_ideal(self.ambient())` as a check for when we need the code to diverge. This would keep things easier to work with as perhaps we construct something as a subalgebra that happens to be an ideal, but we don't want to compute things twice or have messy code to share data. Does that make sense?

That does sound like it could work. Should the class name stay as subalgebra or be something else? I could try to refactor this in later today.



---

archive/issue_comments_404442.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nI would just keep it called subalgebra, but in the docs you will have to discuss the new input parameter `is_ideal`, where you can (indirectly) mention that the class will also be used to construct ideals.",
    "created_at": "2018-09-10T07:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404442",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">Comment 19</div>

I would just keep it called subalgebra, but in the docs you will have to discuss the new input parameter `is_ideal`, where you can (indirectly) mention that the class will also be used to construct ideals.



---

archive/issue_comments_404443.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a3784d2902140df4454f1ceb7d9484db992f3fe\">0a3784d</a></td><td><code>trac #26078: combined ideals and subalgebras into one class</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6d71aefed41ae73745110b28e463977e5abe1bb2\">6d71aef</a></td><td><code>trac #26078: added category parameter to ideal and subalgebra interface</code></td></tr></table>\n",
    "created_at": "2018-09-10T16:38:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404443",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20" align="right">Comment 20</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a3784d2902140df4454f1ceb7d9484db992f3fe">0a3784d</a></td><td><code>trac #26078: combined ideals and subalgebras into one class</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6d71aefed41ae73745110b28e463977e5abe1bb2">6d71aef</a></td><td><code>trac #26078: added category parameter to ideal and subalgebra interface</code></td></tr></table>




---

archive/issue_comments_404444.json:
```json
{
    "body": "Changed commit from **[4981fd4](https://github.com/sagemath/sagetrac-mirror/commit/4981fd4411d664ad87ae310baa0cefed5fb3a167)** to **[6d71aef](https://github.com/sagemath/sagetrac-mirror/commit/6d71aefed41ae73745110b28e463977e5abe1bb2)**",
    "created_at": "2018-09-10T16:38:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404444",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4981fd4](https://github.com/sagemath/sagetrac-mirror/commit/4981fd4411d664ad87ae310baa0cefed5fb3a167)** to **[6d71aef](https://github.com/sagemath/sagetrac-mirror/commit/6d71aefed41ae73745110b28e463977e5abe1bb2)**



---

archive/issue_comments_404445.json:
```json
{
    "body": "Changed commit from **[6d71aef](https://github.com/sagemath/sagetrac-mirror/commit/6d71aefed41ae73745110b28e463977e5abe1bb2)** to **[3d1e21f](https://github.com/sagemath/sagetrac-mirror/commit/3d1e21fcf0de255b63fb1a7141aedfe0c01c97ab)**",
    "created_at": "2018-09-10T16:49:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404445",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6d71aef](https://github.com/sagemath/sagetrac-mirror/commit/6d71aefed41ae73745110b28e463977e5abe1bb2)** to **[3d1e21f](https://github.com/sagemath/sagetrac-mirror/commit/3d1e21fcf0de255b63fb1a7141aedfe0c01c97ab)**



---

archive/issue_comments_404446.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3d1e21fcf0de255b63fb1a7141aedfe0c01c97ab\">3d1e21f</a></td><td><code>trac #26078: removed initializing of incomplete _indices attribute for subalgebras</code></td></tr></table>\n",
    "created_at": "2018-09-10T16:49:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404446",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3d1e21fcf0de255b63fb1a7141aedfe0c01c97ab">3d1e21f</a></td><td><code>trac #26078: removed initializing of incomplete _indices attribute for subalgebras</code></td></tr></table>




---

archive/issue_comments_404447.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nI combined everything into one class, which seemed to work quite nicely as it even cut down on some of the duplicate code e.g. in the basis computation.\n\nI also added the category parameter to the `ideal` and `subalgebra` methods. However testing creation of a stratified subalgebra I realized that the `FilteredModulesWithBasis` category requires the `_indices` attribute. The issue is that the proper `_indices` parameter can only be computed after the basis is computed. So currently trying to use methods of `FilteredModulesWithBasis` before basis computation gives errors\n\n```\nsage: L.<x,y> = LieAlgebra(QQ, abelian=True)\nsage: C = LieAlgebras(QQ).FiniteDimensional().WithBasis().Subobjects().Graded().Stratified()\nsage: S = L.subalgebra(x,category=C)\nsage: S.homogeneous_component_basis(1).list()\nTraceback (most recent call last):\n...\nAttributeError: 'LieSubalgebra_finite_dimensional_with_basis_with_category' object has no attribute '_indices'\nsage: B = S.basis()\nsage: S.homogeneous_component_basis(1).list()\n[x]\n```\nI'm not sure how to handle the issue of not knowing the proper indices a priori. Having `_indices` initially correspond to the generators did not seem like a good solution, since the `degree_on_basis` method of `FiniteDimensionalGradedLieAlgebrasWithBasis.Stratified` will immediately compute the basis, and then the the old `_indices` will be irrelevant, leading to strange results for e.g. `homogeneous_component_basis`.\n\nIs the correct way to fix this behavior to create a subclass for graded subalgebras or is there something else that could be done? Alternatively, the proper implementation of graded subalgebras could also be left to a later ticket.",
    "created_at": "2018-09-10T17:10:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404447",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:22" align="right">Comment 22</div>

I combined everything into one class, which seemed to work quite nicely as it even cut down on some of the duplicate code e.g. in the basis computation.

I also added the category parameter to the `ideal` and `subalgebra` methods. However testing creation of a stratified subalgebra I realized that the `FilteredModulesWithBasis` category requires the `_indices` attribute. The issue is that the proper `_indices` parameter can only be computed after the basis is computed. So currently trying to use methods of `FilteredModulesWithBasis` before basis computation gives errors

```
sage: L.<x,y> = LieAlgebra(QQ, abelian=True)
sage: C = LieAlgebras(QQ).FiniteDimensional().WithBasis().Subobjects().Graded().Stratified()
sage: S = L.subalgebra(x,category=C)
sage: S.homogeneous_component_basis(1).list()
Traceback (most recent call last):
...
AttributeError: 'LieSubalgebra_finite_dimensional_with_basis_with_category' object has no attribute '_indices'
sage: B = S.basis()
sage: S.homogeneous_component_basis(1).list()
[x]
```
I'm not sure how to handle the issue of not knowing the proper indices a priori. Having `_indices` initially correspond to the generators did not seem like a good solution, since the `degree_on_basis` method of `FiniteDimensionalGradedLieAlgebrasWithBasis.Stratified` will immediately compute the basis, and then the the old `_indices` will be irrelevant, leading to strange results for e.g. `homogeneous_component_basis`.

Is the correct way to fix this behavior to create a subclass for graded subalgebras or is there something else that could be done? Alternatively, the proper implementation of graded subalgebras could also be left to a later ticket.



---

archive/issue_comments_404448.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe91f3bc709974dee7365d761e08cf1267947474\">fe91f3b</a></td><td><code>trac #26078: removed unused imports and fixed a missing variable</code></td></tr></table>\n",
    "created_at": "2018-09-10T19:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404448",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23" align="right">Comment 23</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe91f3bc709974dee7365d761e08cf1267947474">fe91f3b</a></td><td><code>trac #26078: removed unused imports and fixed a missing variable</code></td></tr></table>




---

archive/issue_comments_404449.json:
```json
{
    "body": "Changed commit from **[3d1e21f](https://github.com/sagemath/sagetrac-mirror/commit/3d1e21fcf0de255b63fb1a7141aedfe0c01c97ab)** to **[fe91f3b](https://github.com/sagemath/sagetrac-mirror/commit/fe91f3bc709974dee7365d761e08cf1267947474)**",
    "created_at": "2018-09-10T19:08:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404449",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3d1e21f](https://github.com/sagemath/sagetrac-mirror/commit/3d1e21fcf0de255b63fb1a7141aedfe0c01c97ab)** to **[fe91f3b](https://github.com/sagemath/sagetrac-mirror/commit/fe91f3bc709974dee7365d761e08cf1267947474)**



---

archive/issue_comments_404450.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nMake `_indices` a `@lazy_attribute`:\n\n```python\nfrom sage.misc.lazy_attribute import lazy_attribute\nfrom sage.sets.finite_enumerated_set import FiniteEnumeratedSet\n\n@lazy_attribute\ndef _indices(self):\n    return FiniteEnumeratedSet(self.basis().keys())\n```\nWith this, the first part of your example passes. (The reason for `FiniteEnumeratedSet` is so that `S._indices.cardinality()` will work and is consistent with other parts of Sage.)",
    "created_at": "2018-09-10T23:15:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404450",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">Comment 24</div>

Make `_indices` a `@lazy_attribute`:

```python
from sage.misc.lazy_attribute import lazy_attribute
from sage.sets.finite_enumerated_set import FiniteEnumeratedSet

@lazy_attribute
def _indices(self):
    return FiniteEnumeratedSet(self.basis().keys())
```
With this, the first part of your example passes. (The reason for `FiniteEnumeratedSet` is so that `S._indices.cardinality()` will work and is consistent with other parts of Sage.)



---

archive/issue_comments_404451.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nAlthough code generally should not be using `_indices` as this just serves to index the keys of the generators, not necessarily the basis. I might consider also changing the code in `filtered_modules_with_basis` to use `self.basis().keys()` instead of `self._indices`, but that should be done on a separate ticket. (The reason it is doing this is because it was more or less assuming that things in this category are subclasses of `CombinatorialFreeModule`.)",
    "created_at": "2018-09-10T23:18:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404451",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:25" align="right">Comment 25</div>

Although code generally should not be using `_indices` as this just serves to index the keys of the generators, not necessarily the basis. I might consider also changing the code in `filtered_modules_with_basis` to use `self.basis().keys()` instead of `self._indices`, but that should be done on a separate ticket. (The reason it is doing this is because it was more or less assuming that things in this category are subclasses of `CombinatorialFreeModule`.)



---

archive/issue_comments_404452.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c40f2b0ee248290ad97e451ea4446a8c3b3d9ec\">5c40f2b</a></td><td><code>trac #26078: added lazy attribute _indices to subalgebras</code></td></tr></table>\n",
    "created_at": "2018-09-11T04:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404452",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26" align="right">Comment 26</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c40f2b0ee248290ad97e451ea4446a8c3b3d9ec">5c40f2b</a></td><td><code>trac #26078: added lazy attribute _indices to subalgebras</code></td></tr></table>




---

archive/issue_comments_404453.json:
```json
{
    "body": "Changed commit from **[fe91f3b](https://github.com/sagemath/sagetrac-mirror/commit/fe91f3bc709974dee7365d761e08cf1267947474)** to **[5c40f2b](https://github.com/sagemath/sagetrac-mirror/commit/5c40f2b0ee248290ad97e451ea4446a8c3b3d9ec)**",
    "created_at": "2018-09-11T04:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404453",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fe91f3b](https://github.com/sagemath/sagetrac-mirror/commit/fe91f3bc709974dee7365d761e08cf1267947474)** to **[5c40f2b](https://github.com/sagemath/sagetrac-mirror/commit/5c40f2b0ee248290ad97e451ea4446a8c3b3d9ec)**



---

archive/issue_comments_404454.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nMy last round of comments (I am pretty sure); just two more things. I can do these fixes too (since I also have the other ideal creation to take care of too) if you prefer.\n\n- We probably should do some form of caching on `monomial_coefficients` for each element. I would do a `_monomial_coefficients`, defaulting to `None` that stores the computation, then have\n\n  ```python\n  def monomial_coefficients(self, copy=False):\n      if self._monomial_coefficients is None:\n          sm = self.parent().module()\n          v = sm.coordinate_vector(self.to_vector())\n          self._monomial_coefficients = {k: v[k] for k in range(len(v)) if not v[k].is_zero()}\n      if copy:\n          return dict(self._monomial_coefficients)\n      return self._monomial_coefficients\n  ```\n  Using this, we can also override\n\n  ```python\n  from sage.data_structures.blas_dict import add\n  def _add_(self, other):\n    sup = super(self, LieSubalgebra_finite_dimensional_with_basis.Element)\n    ret = sup._add_(other)\n    if self._monomial_coefficients is not None and other._monomial_coefficients is not None:\n        ret._monomial_coefficients = add(self._monomial_coefficients, other._monomial_coefficients)\n  ```\n  and similarly for all of the other basic operations. I would also move this all into `lie_algebra_element.pyx`. What do you think?\n- `if not v[k].is_zero()` -> `if v[k]`.",
    "created_at": "2018-09-11T05:43:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404454",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:27" align="right">Comment 27</div>

My last round of comments (I am pretty sure); just two more things. I can do these fixes too (since I also have the other ideal creation to take care of too) if you prefer.

- We probably should do some form of caching on `monomial_coefficients` for each element. I would do a `_monomial_coefficients`, defaulting to `None` that stores the computation, then have

  ```python
  def monomial_coefficients(self, copy=False):
      if self._monomial_coefficients is None:
          sm = self.parent().module()
          v = sm.coordinate_vector(self.to_vector())
          self._monomial_coefficients = {k: v[k] for k in range(len(v)) if not v[k].is_zero()}
      if copy:
          return dict(self._monomial_coefficients)
      return self._monomial_coefficients
  ```
  Using this, we can also override

  ```python
  from sage.data_structures.blas_dict import add
  def _add_(self, other):
    sup = super(self, LieSubalgebra_finite_dimensional_with_basis.Element)
    ret = sup._add_(other)
    if self._monomial_coefficients is not None and other._monomial_coefficients is not None:
        ret._monomial_coefficients = add(self._monomial_coefficients, other._monomial_coefficients)
  ```
  and similarly for all of the other basic operations. I would also move this all into `lie_algebra_element.pyx`. What do you think?
- `if not v[k].is_zero()` -> `if v[k]`.



---

archive/issue_comments_404455.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nI take it moving things to `lie_algebra_element.pyx` is a speed optimization? Sounds good to me. If it is not too much trouble for you, you can handle these.",
    "created_at": "2018-09-11T06:09:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404455",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:28" align="right">Comment 28</div>

I take it moving things to `lie_algebra_element.pyx` is a speed optimization? Sounds good to me. If it is not too much trouble for you, you can handle these.



---

archive/issue_comments_404456.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nYes, it would be an optimization (because it will be in Cython and closer to C code). I will get to work on them now.",
    "created_at": "2018-09-11T06:12:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404456",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:29" align="right">Comment 29</div>

Yes, it would be an optimization (because it will be in Cython and closer to C code). I will get to work on them now.



---

archive/issue_comments_404457.json:
```json
{
    "body": "Changed commit from **[5c40f2b](https://github.com/sagemath/sagetrac-mirror/commit/5c40f2b0ee248290ad97e451ea4446a8c3b3d9ec)** to **[42dd071](https://github.com/sagemath/sagetrac-mirror/commit/42dd07107a85c823fa17eb0bb6e911b3e8944e17)**",
    "created_at": "2018-09-11T07:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404457",
    "user": "https://github.com/tscrim"
}
```

Changed commit from **[5c40f2b](https://github.com/sagemath/sagetrac-mirror/commit/5c40f2b0ee248290ad97e451ea4446a8c3b3d9ec)** to **[42dd071](https://github.com/sagemath/sagetrac-mirror/commit/42dd07107a85c823fa17eb0bb6e911b3e8944e17)**



---

archive/issue_comments_404458.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-09-11T07:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404458",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_404459.json:
```json
{
    "body": "Changed branch from **[u/gh-ehaka/lie_ideals-26078](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-ehaka/lie_ideals-26078)** to **[public/lie_algebras/fin_dim_ideals_subalgebras-26078](https://github.com/sagemath/sagetrac-mirror/tree/public/lie_algebras/fin_dim_ideals_subalgebras-26078)**",
    "created_at": "2018-09-11T07:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404459",
    "user": "https://github.com/tscrim"
}
```

Changed branch from **[u/gh-ehaka/lie_ideals-26078](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-ehaka/lie_ideals-26078)** to **[public/lie_algebras/fin_dim_ideals_subalgebras-26078](https://github.com/sagemath/sagetrac-mirror/tree/public/lie_algebras/fin_dim_ideals_subalgebras-26078)**



---

archive/issue_comments_404460.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nOkay, here are those changes. I did not do `x.bracket(L)` because that was going to be too much work to make sure it was consistent across the board, and it is really syntactic sugar at the end of the day.\n\nIf my changes are good, then I believe we are at a positive review.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/650a3259cf85d4fdfb5fa3d2b480bde309f1bf9b\">650a325</a></td><td><code>Merge branch 'u/gh-ehaka/lie_ideals-26078' of git://trac.sagemath.org/sage into public/lie_algebras/fin_dim_ideals_subalgebras-26078</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b84e1f028225cfdf7c4ef52fab88bcac971eebd\">5b84e1f</a></td><td><code>Adding code paths to compute ideals using the L[X, Y] and L.bracket(X, Y).</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42dd07107a85c823fa17eb0bb6e911b3e8944e17\">42dd071</a></td><td><code>Cythonizing subalgebra elements and caching their monomial coefficients.</code></td></tr></table>\n",
    "created_at": "2018-09-11T07:18:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404460",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:30" align="right">Comment 30</div>

Okay, here are those changes. I did not do `x.bracket(L)` because that was going to be too much work to make sure it was consistent across the board, and it is really syntactic sugar at the end of the day.

If my changes are good, then I believe we are at a positive review.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/650a3259cf85d4fdfb5fa3d2b480bde309f1bf9b">650a325</a></td><td><code>Merge branch 'u/gh-ehaka/lie_ideals-26078' of git://trac.sagemath.org/sage into public/lie_algebras/fin_dim_ideals_subalgebras-26078</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b84e1f028225cfdf7c4ef52fab88bcac971eebd">5b84e1f</a></td><td><code>Adding code paths to compute ideals using the L[X, Y] and L.bracket(X, Y).</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42dd07107a85c823fa17eb0bb6e911b3e8944e17">42dd071</a></td><td><code>Cythonizing subalgebra elements and caching their monomial coefficients.</code></td></tr></table>




---

archive/issue_comments_404461.json:
```json
{
    "body": "Changed commit from **[42dd071](https://github.com/sagemath/sagetrac-mirror/commit/42dd07107a85c823fa17eb0bb6e911b3e8944e17)** to **[fcb4888](https://github.com/sagemath/sagetrac-mirror/commit/fcb488858260db781ccc93200d5e6976389d861d)**",
    "created_at": "2018-09-11T09:10:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404461",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[42dd071](https://github.com/sagemath/sagetrac-mirror/commit/42dd07107a85c823fa17eb0bb6e911b3e8944e17)** to **[fcb4888](https://github.com/sagemath/sagetrac-mirror/commit/fcb488858260db781ccc93200d5e6976389d861d)**



---

archive/issue_comments_404462.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fcb488858260db781ccc93200d5e6976389d861d\">fcb4888</a></td><td><code>trac #26078: added missing doctest to subalgebra element initialization</code></td></tr></table>\n",
    "created_at": "2018-09-11T09:10:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404462",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31" align="right">Comment 31</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fcb488858260db781ccc93200d5e6976389d861d">fcb4888</a></td><td><code>trac #26078: added missing doctest to subalgebra element initialization</code></td></tr></table>




---

archive/issue_comments_404463.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nAll the improvements above look good to me. I also added a doctest to the initialization of a subalgebra element (at least I assume that was what patchbot was complaining about).",
    "created_at": "2018-09-11T09:14:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404463",
    "user": "https://github.com/ehaka"
}
```

<div id="comment:32" align="right">Comment 32</div>

All the improvements above look good to me. I also added a doctest to the initialization of a subalgebra element (at least I assume that was what patchbot was complaining about).



---

archive/issue_events_342041.json:
```json
{
    "actor": "https://github.com/ehaka",
    "created_at": "2018-09-11T09:14:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342041"
}
```



---

archive/issue_events_342042.json:
```json
{
    "actor": "https://github.com/ehaka",
    "created_at": "2018-09-11T09:14:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342042"
}
```



---

archive/issue_comments_404464.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nWhoops, yes, I forgot to add that. Thank you.",
    "created_at": "2018-09-11T12:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404464",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:33" align="right">Comment 33</div>

Whoops, yes, I forgot to add that. Thank you.



---

archive/issue_comments_404465.json:
```json
{
    "body": "Changed branch from **[public/lie_algebras/fin_dim_ideals_subalgebras-26078](https://github.com/sagemath/sagetrac-mirror/tree/public/lie_algebras/fin_dim_ideals_subalgebras-26078)** to **[fcb4888](https://github.com/sagemath/sagetrac-mirror/commit/fcb488858260db781ccc93200d5e6976389d861d)**",
    "created_at": "2018-09-12T19:58:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/26078#issuecomment-404465",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/lie_algebras/fin_dim_ideals_subalgebras-26078](https://github.com/sagemath/sagetrac-mirror/tree/public/lie_algebras/fin_dim_ideals_subalgebras-26078)** to **[fcb4888](https://github.com/sagemath/sagetrac-mirror/commit/fcb488858260db781ccc93200d5e6976389d861d)**



---

archive/issue_events_342043.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-12T19:58:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342043"
}
```



---

archive/issue_events_342044.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ca8203b5e342c75db054a2d7782a57cccc057304",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-09-12T19:58:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/26078",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/26078#event-342044"
}
```
