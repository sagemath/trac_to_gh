# Issue 26253: Upgrade: psutil 5.8.0

archive/issues_026016.json:
```json
{
    "body": "Cygwin support needs a rebase.\n\n\nCC:  @embray @slel @orlitzky @mkoeppe @kiwifb @antonio-rojas @isuruf\n\nKeywords: upgrade, psutil\n\nWork_Issues: Cygwin\n\nReviewer: Michael Orlitzky\n\nBranch: public/ticket/26253\n\nCommit: 0fc3c304287e728be0700c526b7dde4cd847c4e9\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/26253\n\n",
    "closed_at": "2021-11-20T23:57:15Z",
    "created_at": "2018-09-11T21:41:26Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Upgrade: psutil 5.8.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26253",
    "user": "https://github.com/dimpase"
}
```
Cygwin support needs a rebase.


CC:  @embray @slel @orlitzky @mkoeppe @kiwifb @antonio-rojas @isuruf

Keywords: upgrade, psutil

Work_Issues: Cygwin

Reviewer: Michael Orlitzky

Branch: public/ticket/26253

Commit: 0fc3c304287e728be0700c526b7dde4cd847c4e9

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/26253





---

archive/issue_comments_366472.json:
```json
{
    "body": "<a id='comment:1'></a>The cygwin-specific patch does not apply, needs a rebase. It's removed for the sake of being able to test on other system (needed on FreeBSD, older package does not work there).",
    "created_at": "2018-09-11T21:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366472",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>The cygwin-specific patch does not apply, needs a rebase. It's removed for the sake of being able to test on other system (needed on FreeBSD, older package does not work there).



---

archive/issue_comments_366473.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2018-09-12T10:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366473",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_366474.json:
```json
{
    "body": "<a id='comment:3'></a>meanwhile 5.4.8 is out.",
    "created_at": "2018-11-21T16:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366474",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>meanwhile 5.4.8 is out.



---

archive/issue_events_065347.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-11-22T11:13:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65347"
}
```



---

archive/issue_comments_366475.json:
```json
{
    "body": "<a id='comment:5'></a>I keep starting and stopping on reworking my Cygwin stuff for psutil.  It needs to be refactored pretty badly and every time I start to work on it I quickly get pulled away to other things.\n\nIs there some specific reason to update the psutil version?",
    "created_at": "2018-11-22T11:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366475",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>I keep starting and stopping on reworking my Cygwin stuff for psutil.  It needs to be refactored pretty badly and every time I start to work on it I quickly get pulled away to other things.

Is there some specific reason to update the psutil version?



---

archive/issue_comments_366476.json:
```json
{
    "body": "<a id='comment:6'></a>One reason is that the current version does not work on FreeBSD 12.0.\nHow hard is that refactoring? I have a Windows laptop around, which BSODs now and then due to some hardware issue, but probably is good enough for mild Cygwin work.\n\nA related Cygwin issue is on #26052 - any idea about that?",
    "created_at": "2018-11-22T11:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366476",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>One reason is that the current version does not work on FreeBSD 12.0.
How hard is that refactoring? I have a Windows laptop around, which BSODs now and then due to some hardware issue, but probably is good enough for mild Cygwin work.

A related Cygwin issue is on #26052 - any idea about that?



---

archive/issue_comments_366477.json:
```json
{
    "body": "<a id='comment:7'></a>It's very non-trivial, unfortunately, and requires upstream cooperation (where in this case the psutil maintainer has been helpful and amenable, but that doesn't mean I can just go and do what I want).",
    "created_at": "2018-11-29T13:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366477",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>It's very non-trivial, unfortunately, and requires upstream cooperation (where in this case the psutil maintainer has been helpful and amenable, but that doesn't mean I can just go and do what I want).



---

archive/issue_comments_366478.json:
```json
{
    "body": "<a id='comment:8'></a>meanwhile psutils 5.5.0 is out",
    "created_at": "2019-02-11T12:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366478",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>meanwhile psutils 5.5.0 is out



---

archive/issue_comments_366479.json:
```json
{
    "body": "Changing keywords from \"\" to \"upgrade\".",
    "created_at": "2019-03-01T18:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366479",
    "user": "https://github.com/fchapoton"
}
```

Changing keywords from "" to "upgrade".



---

archive/issue_comments_366480.json:
```json
{
    "body": "<a id='comment:10'></a>I'm working on a new (simpler) version of the Cygwin patch for psutil.  Hopefully it will be ready soon.",
    "created_at": "2019-03-01T18:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366480",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>I'm working on a new (simpler) version of the Cygwin patch for psutil.  Hopefully it will be ready soon.



---

archive/issue_comments_366481.json:
```json
{
    "body": "<a id='comment:11'></a>the latest psutil is 5.6.2.",
    "created_at": "2019-05-03T16:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366481",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>the latest psutil is 5.6.2.



---

archive/issue_comments_366482.json:
```json
{
    "body": "<a id='comment:12'></a>It would be good to update. Distros likely use a more recent psutil (I do). It causes at least one optional doctest failure (when combined with `fricas`) due to changes to output\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/fricas.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/interfaces/fricas.py\", line 351, in sage.interfaces.fricas.FriCAS._quit_string\nFailed example:\n    p = fricas.pid(); pr = psutil.Process(p); pr                  # optional - fricas\nExpected:\n    <psutil.Process(pid=..., name='AXIOMsys') at ...>\nGot:\n    psutil.Process(pid=7277, name='AXIOMsys', started='19:52:17')\n**********************************************************************\n```\nThis is with `psutil-5.5.0`.",
    "created_at": "2019-05-03T20:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366482",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:12'></a>It would be good to update. Distros likely use a more recent psutil (I do). It causes at least one optional doctest failure (when combined with `fricas`) due to changes to output

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/interfaces/fricas.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/interfaces/fricas.py", line 351, in sage.interfaces.fricas.FriCAS._quit_string
Failed example:
    p = fricas.pid(); pr = psutil.Process(p); pr                  # optional - fricas
Expected:
    <psutil.Process(pid=..., name='AXIOMsys') at ...>
Got:
    psutil.Process(pid=7277, name='AXIOMsys', started='19:52:17')
**********************************************************************
```
This is with `psutil-5.5.0`.



---

archive/issue_comments_366483.json:
```json
{
    "body": "<a id='comment:13'></a>Here is a branch, not tested. I have not removed the patches.\n\n---\nNew commits:",
    "created_at": "2019-06-08T06:41:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366483",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>Here is a branch, not tested. I have not removed the patches.

---
New commits:



---

archive/issue_comments_366484.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-08T06:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366484",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_366485.json:
```json
{
    "body": "<a id='comment:15'></a>New release (2020-02): psutil 5.7.0.",
    "created_at": "2020-05-12T12:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366485",
    "user": "https://github.com/slel"
}
```

<a id='comment:15'></a>New release (2020-02): psutil 5.7.0.



---

archive/issue_comments_366486.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-29T16:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366486",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366487.json:
```json
{
    "body": "<a id='comment:17'></a>The psutil upstream issue on cygwin support is still open: https://github.com/giampaolo/psutil/issues/82\n\nErik, your help is needed",
    "created_at": "2020-06-29T16:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366487",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>The psutil upstream issue on cygwin support is still open: https://github.com/giampaolo/psutil/issues/82

Erik, your help is needed



---

archive/issue_events_065348.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-11T23:56:24Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-pending",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65348"
}
```



---

archive/issue_events_065349.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-11T23:56:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65349"
}
```



---

archive/issue_comments_366488.json:
```json
{
    "body": "<a id='comment:20'></a>perhaps we should look into removing psutils (on cygwin, or perhaps totally)",
    "created_at": "2020-11-12T09:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366488",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>perhaps we should look into removing psutils (on cygwin, or perhaps totally)



---

archive/issue_comments_366489.json:
```json
{
    "body": "<a id='comment:21'></a>I have been thinking lately of spending a couple days updating the cygwin version of psutils.  In particular, I think I will start maintaining my own fork of psutils with cygwin support, since last time I tried to upstream these changes it did not go well.  If the psutil developer wants to port over any work from my fork he'd still be free to.\n\nI was thinking about this lately because there was yet another issue on the psutils github asking for cygwin support and pointing to my incomplete pull requests...",
    "created_at": "2020-11-12T14:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366489",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>I have been thinking lately of spending a couple days updating the cygwin version of psutils.  In particular, I think I will start maintaining my own fork of psutils with cygwin support, since last time I tried to upstream these changes it did not go well.  If the psutil developer wants to port over any work from my fork he'd still be free to.

I was thinking about this lately because there was yet another issue on the psutils github asking for cygwin support and pointing to my incomplete pull requests...



---

archive/issue_comments_366490.json:
```json
{
    "body": "<a id='comment:22'></a>If nothing else, I'll try rebasing my existing patches again...",
    "created_at": "2020-11-12T14:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366490",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>If nothing else, I'll try rebasing my existing patches again...



---

archive/issue_comments_366491.json:
```json
{
    "body": "<a id='comment:23'></a>I've rebased the latest version of my Cygwin patch onto psutil master.  Once we update this ticket and decide which psutil version to upgrade to I can update the patch as well.\n\nI might also try submitting this upstream again.  The patch is incomplete (many features are missing) but good enough for Sage's purposes for now.",
    "created_at": "2020-11-17T18:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366491",
    "user": "https://github.com/embray"
}
```

<a id='comment:23'></a>I've rebased the latest version of my Cygwin patch onto psutil master.  Once we update this ticket and decide which psutil version to upgrade to I can update the patch as well.

I might also try submitting this upstream again.  The patch is incomplete (many features are missing) but good enough for Sage's purposes for now.



---

archive/issue_comments_366492.json:
```json
{
    "body": "<a id='comment:24'></a>5.7.3 is close to master, so hopefully one can apply your patches on top of  5.7.3",
    "created_at": "2020-11-18T13:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366492",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>5.7.3 is close to master, so hopefully one can apply your patches on top of  5.7.3



---

archive/issue_comments_366493.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-18T17:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366493",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_366494.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-18T17:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366494",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366495.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-20T12:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366495",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_366496.json:
```json
{
    "body": "<a id='comment:28'></a>wrong comment - confused by the timeline, which I didn't update. It's fine.",
    "created_at": "2020-11-20T12:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366496",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>wrong comment - confused by the timeline, which I didn't update. It's fine.



---

archive/issue_comments_366497.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-20T13:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366497",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_366498.json:
```json
{
    "body": "<a id='comment:29'></a>this should be tested everywhere, except Cygwin, where Erik has promised a patch.",
    "created_at": "2020-11-20T13:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366498",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>this should be tested everywhere, except Cygwin, where Erik has promised a patch.



---

archive/issue_comments_366499.json:
```json
{
    "body": "<a id='comment:31'></a>I can generate a patch from my latest Cygwin branch at https://github.com/embray/psutil/tree/cygwin/v3\n\nBut longer term if we want psutil to support Cygwin someone other than me will have to try to talk sense into its maintainer, who apparently does not have time to work on the project, but also says that he and only he can work on the Cygwin port which I've already spent days bringing to around 90% completion, with frankly a pretty clean patch not requiring a lot of changes. Seems pretty unreasonable, and disappointing.\n\nI continued to work on my branch and he blocked me from the project bc I unthinkingly used his `@` in a commit message (perhaps in unfounded optimism that he'd be willing to give the work another look later): https://github.com/giampaolo/psutil/pull/1884#issuecomment-733165286",
    "created_at": "2020-11-24T21:34:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366499",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>I can generate a patch from my latest Cygwin branch at https://github.com/embray/psutil/tree/cygwin/v3

But longer term if we want psutil to support Cygwin someone other than me will have to try to talk sense into its maintainer, who apparently does not have time to work on the project, but also says that he and only he can work on the Cygwin port which I've already spent days bringing to around 90% completion, with frankly a pretty clean patch not requiring a lot of changes. Seems pretty unreasonable, and disappointing.

I continued to work on my branch and he blocked me from the project bc I unthinkingly used his `@` in a commit message (perhaps in unfounded optimism that he'd be willing to give the work another look later): https://github.com/giampaolo/psutil/pull/1884#issuecomment-733165286



---

archive/issue_comments_366500.json:
```json
{
    "body": "<a id='comment:32'></a>one cannot even open issues on the main psutil repo, I don't think there is any hope that patches would be accepted there.\n\nit's not the 1st case we have where our patches are not welcome, I would not be too upset about it (cf. e.g. csdp, cliquer...)",
    "created_at": "2020-11-24T23:14:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366500",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>one cannot even open issues on the main psutil repo, I don't think there is any hope that patches would be accepted there.

it's not the 1st case we have where our patches are not welcome, I would not be too upset about it (cf. e.g. csdp, cliquer...)



---

archive/issue_comments_366501.json:
```json
{
    "body": "<a id='comment:33'></a>We should not maintain patches that add functionality in Sage. This will create problems later when switch to using standard Python package dependency information for Python packages.\n\nInstead I see two options:\n- Fork `psutil`, making it available on PyPI under a new name. Only makes sense if you are willing to maintain it, obviously.\n- Just implement Cygwin version of the few things needed from `psutil` in `src/sage/interfaces/gap.py` and `src/sage/misc/getusage.py`",
    "created_at": "2020-11-24T23:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366501",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>We should not maintain patches that add functionality in Sage. This will create problems later when switch to using standard Python package dependency information for Python packages.

Instead I see two options:
- Fork `psutil`, making it available on PyPI under a new name. Only makes sense if you are willing to maintain it, obviously.
- Just implement Cygwin version of the few things needed from `psutil` in `src/sage/interfaces/gap.py` and `src/sage/misc/getusage.py`



---

archive/issue_comments_366502.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 mkoeppe]:\n> We should not maintain patches that add functionality in Sage. This will create problems later when switch to using standard Python package dependency information for Python packages.\n\n\nNormally I would agree but that's not really the case here.  We're not talking about adding new functionality or bug fixes required for Sage to function in such a way that would be at odds with using system packages.\n\nThis is just adding support to the package for a platform it doesn't otherwise support: Which is to say, there is no \"standard Python package dependency information\" for psutil on Cygwin.  In fact, PyPI does not even support cygwin wheels yet (something I plan to lobby on, but it's slightly complicated).  There is also no psutil package for Cygwin, again because support for it does not even exist modulo my patch.\n\n> Instead I see two options:\n> - Fork `psutil`, making it available on PyPI under a new name. Only makes sense if you are willing to maintain it, obviously.\n> - Just implement Cygwin version of the few things needed from `psutil` in `src/sage/interfaces/gap.py` and `src/sage/misc/getusage.py`\n\n\nWhat I plan to do is, once my Cygwin port of psutil reaches 100% feature parity then I will add a Cygwin package for it to [cygwinports](https://github.com/cygwinports) based on my fork.  Then there will at least be a standard Cygwin package for psutil and we can drop the patch and/or use my fork as the standard installation source for psutil on all platforms.\n\nI don't think it will require a lot of maintenance since he says he's planning on taking a break from making new psutil releases for a while.",
    "created_at": "2020-11-27T12:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366502",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>Replying to [comment:33 mkoeppe]:
> We should not maintain patches that add functionality in Sage. This will create problems later when switch to using standard Python package dependency information for Python packages.


Normally I would agree but that's not really the case here.  We're not talking about adding new functionality or bug fixes required for Sage to function in such a way that would be at odds with using system packages.

This is just adding support to the package for a platform it doesn't otherwise support: Which is to say, there is no "standard Python package dependency information" for psutil on Cygwin.  In fact, PyPI does not even support cygwin wheels yet (something I plan to lobby on, but it's slightly complicated).  There is also no psutil package for Cygwin, again because support for it does not even exist modulo my patch.

> Instead I see two options:
> - Fork `psutil`, making it available on PyPI under a new name. Only makes sense if you are willing to maintain it, obviously.
> - Just implement Cygwin version of the few things needed from `psutil` in `src/sage/interfaces/gap.py` and `src/sage/misc/getusage.py`


What I plan to do is, once my Cygwin port of psutil reaches 100% feature parity then I will add a Cygwin package for it to [cygwinports](https://github.com/cygwinports) based on my fork.  Then there will at least be a standard Cygwin package for psutil and we can drop the patch and/or use my fork as the standard installation source for psutil on all platforms.

I don't think it will require a lot of maintenance since he says he's planning on taking a break from making new psutil releases for a while.



---

archive/issue_comments_366503.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-02-21T10:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_366504.json:
```json
{
    "body": "<a id='comment:37'></a>Is there any news on Cygwin support?",
    "created_at": "2021-02-21T17:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366504",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>Is there any news on Cygwin support?



---

archive/issue_comments_366505.json:
```json
{
    "body": "<a id='comment:38'></a>I don't know.  It would be great if someone would try to talk sense to its maintainer at https://github.com/giampaolo/psutil/pull/1884#issuecomment-733165286.\n\nOtherwise we can still just generate a patch from my existing work in the meantime...",
    "created_at": "2021-02-26T11:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366505",
    "user": "https://github.com/embray"
}
```

<a id='comment:38'></a>I don't know.  It would be great if someone would try to talk sense to its maintainer at https://github.com/giampaolo/psutil/pull/1884#issuecomment-733165286.

Otherwise we can still just generate a patch from my existing work in the meantime...



---

archive/issue_comments_366506.json:
```json
{
    "body": "<a id='comment:39'></a>It sounds as if psutil is ripe for a fork :-)",
    "created_at": "2021-03-10T14:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366506",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:39'></a>It sounds as if psutil is ripe for a fork :-)



---

archive/issue_events_065350.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65350"
}
```



---

archive/issue_events_065351.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65351"
}
```



---

archive/issue_comments_366507.json:
```json
{
    "body": "<a id='comment:40'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366507",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_065352.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65352"
}
```



---

archive/issue_events_065353.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65353"
}
```



---

archive/issue_comments_366508.json:
```json
{
    "body": "<a id='comment:41'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366508",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_366509.json:
```json
{
    "body": "Changing keywords from \"upgrade\" to \"upgrade, psutil\".",
    "created_at": "2021-08-23T13:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366509",
    "user": "https://github.com/slel"
}
```

Changing keywords from "upgrade" to "upgrade, psutil".



---

archive/issue_comments_366510.json:
```json
{
    "body": "<a id='comment:42'></a>Currently our spkg is at psutil 5.2.0,\nfrom 2017-03 (with patches).\n\nPython 3 deprecation warnings in psutil\nwere resolved in psutil itself by\n\n- [psutil pull request 1318](https://github.com/giampaolo/psutil/pull/1318),\n  merged in 2018-08\n\nWith a recent psutil, the first start of\nSage on Cygwin could be warnings-free.\n\nSome user reports mentioning the deprecation warnings:\n\n- [2020-08: Ask Sage question 53120](https://ask.sagemath.org/question/53120)\n- [2021-08: sage-support](https://groups.google.com/g/sage-support/c/KZFZBoI6xJk/m/cP-fduA5AQAJ)",
    "created_at": "2021-08-23T13:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366510",
    "user": "https://github.com/slel"
}
```

<a id='comment:42'></a>Currently our spkg is at psutil 5.2.0,
from 2017-03 (with patches).

Python 3 deprecation warnings in psutil
were resolved in psutil itself by

- [psutil pull request 1318](https://github.com/giampaolo/psutil/pull/1318),
  merged in 2018-08

With a recent psutil, the first start of
Sage on Cygwin could be warnings-free.

Some user reports mentioning the deprecation warnings:

- [2020-08: Ask Sage question 53120](https://ask.sagemath.org/question/53120)
- [2021-08: sage-support](https://groups.google.com/g/sage-support/c/KZFZBoI6xJk/m/cP-fduA5AQAJ)



---

archive/issue_comments_366511.json:
```json
{
    "body": "<a id='comment:43'></a>psutil 5.8 does not support Cygwin, as far as I know.",
    "created_at": "2021-08-23T17:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366511",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'></a>psutil 5.8 does not support Cygwin, as far as I know.



---

archive/issue_comments_366512.json:
```json
{
    "body": "<a id='comment:44'></a>Do we need psutil at all? I think we can delete it. It's used for three things:\n\n1. To guess at the initial GAP memory pool size, passed to gap via `-o` and `-s`. I don't think we need these flags, though: https://www.gap-system.org/Manuals/doc/ref/chap3.html\n2. To set the maximum stack size during PARI initialization. Again, we can just set it to a big number; it's a limit, and we're already guessing.\n3. Two doctests that call `get_memory_usage()` to check for leaks.\n\nThose two doctests are not worth keeping it around, even as an optional package, considering it won't work on one of our supported platforms. So I say we,\n\n1. Drop the `-o` and `-s` flags to GAP. If the absence of `-s` causes problems in some cases, we  can always pass `-s <big_number>` since that memory should not actually be allocated. And if *that* assumption is violated on some platform, then we could special-case that platform.\n2. Pass a big value to PARI in `libs/pari/__init__.py` for its stack size limit. 1024 times the initial size, or something like that.\n3. Delete those two doctests.\n4. Delete psutil, and sleep easier knowing that we won't be responsible for a fork of it for the rest of our lives.",
    "created_at": "2021-10-07T12:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366512",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:44'></a>Do we need psutil at all? I think we can delete it. It's used for three things:

1. To guess at the initial GAP memory pool size, passed to gap via `-o` and `-s`. I don't think we need these flags, though: https://www.gap-system.org/Manuals/doc/ref/chap3.html
2. To set the maximum stack size during PARI initialization. Again, we can just set it to a big number; it's a limit, and we're already guessing.
3. Two doctests that call `get_memory_usage()` to check for leaks.

Those two doctests are not worth keeping it around, even as an optional package, considering it won't work on one of our supported platforms. So I say we,

1. Drop the `-o` and `-s` flags to GAP. If the absence of `-s` causes problems in some cases, we  can always pass `-s <big_number>` since that memory should not actually be allocated. And if *that* assumption is violated on some platform, then we could special-case that platform.
2. Pass a big value to PARI in `libs/pari/__init__.py` for its stack size limit. 1024 times the initial size, or something like that.
3. Delete those two doctests.
4. Delete psutil, and sleep easier knowing that we won't be responsible for a fork of it for the rest of our lives.



---

archive/issue_comments_366513.json:
```json
{
    "body": "<a id='comment:45'></a>+1 to removing psutils",
    "created_at": "2021-10-07T16:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366513",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:45'></a>+1 to removing psutils



---

archive/issue_comments_366514.json:
```json
{
    "body": "<a id='comment:46'></a>+1 if it can be done without breaking stuff",
    "created_at": "2021-10-07T17:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366514",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>+1 if it can be done without breaking stuff



---

archive/issue_comments_366515.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-10-07T19:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366515",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_366516.json:
```json
{
    "body": "<a id='comment:48'></a>Consider setting to invalid/wontfix after removal of psutil in #32656.",
    "created_at": "2021-10-10T12:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366516",
    "user": "https://github.com/slel"
}
```

<a id='comment:48'></a>Consider setting to invalid/wontfix after removal of psutil in #32656.



---

archive/issue_comments_366517.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2021-10-10T12:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366517",
    "user": "https://github.com/slel"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_events_065354.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-10-21T11:35:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65354"
}
```



---

archive/issue_events_065355.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-10-21T11:35:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65355"
}
```



---

archive/issue_events_065356.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-11-08T12:35:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65356"
}
```



---

archive/issue_events_065357.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-11-08T12:35:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65357"
}
```



---

archive/issue_comments_366518.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2021-11-08T12:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366518",
    "user": "https://github.com/slel"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_366519.json:
```json
{
    "body": "<a id='comment:50'></a>Ticket #32656 was merged in Sage 9.5.beta5.",
    "created_at": "2021-11-08T12:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366519",
    "user": "https://github.com/slel"
}
```

<a id='comment:50'></a>Ticket #32656 was merged in Sage 9.5.beta5.



---

archive/issue_comments_366520.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-11-20T22:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366520",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_366521.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-11-20T23:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26253#issuecomment-366521",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_065358.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-11-20T23:57:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26253",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26253#event-65358"
}
```
