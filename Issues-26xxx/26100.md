# Issue 26100: Always try to load maxima.fas from the standard ecl module dir

archive/issues_025863.json:
```json
{
    "body": "CC:  @saraedum @timokau @kiwifb @jdemeyer\n\nIn #25309 the path to the maxima ecl module was made configurable. However, the default path /usr/lib/ecl/maxima.fas is sage-specific (upstream ecl installs modules to the versioned path /usr/lib/ecl-${eclver}). This forces distributions who ship unmodified ecl to patch sage to point it to the right path. Even worse, the path depends on the ecl version so the patch would need to be updated for every ecl upgrade, creating additional burden.\n\nThis patch makes makes MAXIMA_FAS unset by default. For sage-the-distribution the behavior should be identical to 8.3. For distros that ship a vanilla ecl (ie. with versioned module dir) it should work out of the box as it did in 8.3. Distros that install maxima.fas to a non-standard location can still customize it.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26100\n\n",
    "closed_at": "2018-08-29T22:31:29Z",
    "created_at": "2018-08-20T16:24:48Z",
    "labels": [
        "component: distribution"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Always try to load maxima.fas from the standard ecl module dir",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26100",
    "user": "https://github.com/antonio-rojas"
}
```
CC:  @saraedum @timokau @kiwifb @jdemeyer

In #25309 the path to the maxima ecl module was made configurable. However, the default path /usr/lib/ecl/maxima.fas is sage-specific (upstream ecl installs modules to the versioned path /usr/lib/ecl-${eclver}). This forces distributions who ship unmodified ecl to patch sage to point it to the right path. Even worse, the path depends on the ecl version so the patch would need to be updated for every ecl upgrade, creating additional burden.

This patch makes makes MAXIMA_FAS unset by default. For sage-the-distribution the behavior should be identical to 8.3. For distros that ship a vanilla ecl (ie. with versioned module dir) it should work out of the box as it did in 8.3. Distros that install maxima.fas to a non-standard location can still customize it.

Issue created by migration from https://trac.sagemath.org/ticket/26100





---

archive/issue_comments_364647.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-08-20T16:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364647",
    "user": "https://github.com/antonio-rojas"
}
```

New commits:



---

archive/issue_comments_364648.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to distribution.",
    "created_at": "2018-08-20T16:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364648",
    "user": "https://github.com/antonio-rojas"
}
```

Changing component from PLEASE CHANGE to distribution.



---

archive/issue_comments_364649.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2018-08-20T16:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364649",
    "user": "https://github.com/antonio-rojas"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_364650.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-20T16:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364650",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_364651.json:
```json
{
    "body": "This solution is essentially what I meant in #25309. I just don't like that it silently fails if I explicitly provides `MAXIMA_FAS`. I'd prefer it if ECLDIR would just default to `None` in `env.py` and the default is only used when it is `None` (not explicitly overwritten).",
    "created_at": "2018-08-20T17:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364651",
    "user": "https://github.com/timokau"
}
```

This solution is essentially what I meant in #25309. I just don't like that it silently fails if I explicitly provides `MAXIMA_FAS`. I'd prefer it if ECLDIR would just default to `None` in `env.py` and the default is only used when it is `None` (not explicitly overwritten).



---

archive/issue_comments_364652.json:
```json
{
    "body": "Setting ECLDIR and MAXIMA_FAS to None by default in env.py and replacing the 'try:' with an 'if \"MAXIMA_FAS\" in os.environ:' would also work for me. Let's see if someone else has an opinion on this.",
    "created_at": "2018-08-20T17:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364652",
    "user": "https://github.com/antonio-rojas"
}
```

Setting ECLDIR and MAXIMA_FAS to None by default in env.py and replacing the 'try:' with an 'if "MAXIMA_FAS" in os.environ:' would also work for me. Let's see if someone else has an opinion on this.



---

archive/issue_comments_364653.json:
```json
{
    "body": "MAXIMA_FAS should probably still default relative to ecl dir if it is set. Or is that the default behaviour anyways?",
    "created_at": "2018-08-20T17:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364653",
    "user": "https://github.com/timokau"
}
```

MAXIMA_FAS should probably still default relative to ecl dir if it is set. Or is that the default behaviour anyways?



---

archive/issue_comments_364654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-24T12:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364655.json:
```json
{
    "body": "Replying to [comment:7 gh-timokau]:\n> MAXIMA_FAS should probably still default relative to ecl dir if it is set. Or is that the default behaviour anyways?\n\n\nThat's the default behavior, yes. Since ECLDIR is used nowhere else, there should be no need to set it, right? You can simply define MAXIMA_FAS directly.",
    "created_at": "2018-08-24T12:23:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364655",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:7 gh-timokau]:
> MAXIMA_FAS should probably still default relative to ecl dir if it is set. Or is that the default behaviour anyways?


That's the default behavior, yes. Since ECLDIR is used nowhere else, there should be no need to set it, right? You can simply define MAXIMA_FAS directly.



---

archive/issue_comments_364656.json:
```json
{
    "body": "Yes in that case we could just get rid of ECLDIR.",
    "created_at": "2018-08-24T14:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364656",
    "user": "https://github.com/timokau"
}
```

Yes in that case we could just get rid of ECLDIR.



---

archive/issue_comments_364657.json:
```json
{
    "body": "... which I see you already did.",
    "created_at": "2018-08-24T14:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364657",
    "user": "https://github.com/timokau"
}
```

... which I see you already did.



---

archive/issue_comments_364658.json:
```json
{
    "body": "Minor style nitpick: I very much prefer `if MAXIMA_FAS is not None` over `if MAXIMA_FAS`. The second one looks like `MAXIMA_FAS` is a boolean. Not sure if sage has style guides for that.",
    "created_at": "2018-08-24T14:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364658",
    "user": "https://github.com/timokau"
}
```

Minor style nitpick: I very much prefer `if MAXIMA_FAS is not None` over `if MAXIMA_FAS`. The second one looks like `MAXIMA_FAS` is a boolean. Not sure if sage has style guides for that.



---

archive/issue_comments_364659.json:
```json
{
    "body": "Replying to [comment:13 gh-timokau]:\n> Minor style nitpick: I very much prefer `if MAXIMA_FAS is not None` over `if MAXIMA_FAS`. The second one looks like `MAXIMA_FAS` is a boolean. Not sure if sage has style guides for that.\n\n\nIn fact, `... is not None` is the appropriate test if `None` is used as a sentinel value. The empty string `\"\"` would also be \"False\", and I imagine you might want to treat it differently from the value not being present. There are some wilder scenarios where it matters, e.g. if someone makes a string type that always tests `False`, but that is pretty exotic.",
    "created_at": "2018-08-24T15:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364659",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:13 gh-timokau]:
> Minor style nitpick: I very much prefer `if MAXIMA_FAS is not None` over `if MAXIMA_FAS`. The second one looks like `MAXIMA_FAS` is a boolean. Not sure if sage has style guides for that.


In fact, `... is not None` is the appropriate test if `None` is used as a sentinel value. The empty string `""` would also be "False", and I imagine you might want to treat it differently from the value not being present. There are some wilder scenarios where it matters, e.g. if someone makes a string type that always tests `False`, but that is pretty exotic.



---

archive/issue_comments_364660.json:
```json
{
    "body": "For what its worth I still have to set `ECLDIR` for the nix package. I'm not sure why ECL needs that or what the default is when it is not set. Have you tested sage without a system ECL installed? Maybe its accidentally using that when removing `ECLDIR`.",
    "created_at": "2018-08-24T15:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364660",
    "user": "https://github.com/timokau"
}
```

For what its worth I still have to set `ECLDIR` for the nix package. I'm not sure why ECL needs that or what the default is when it is not set. Have you tested sage without a system ECL installed? Maybe its accidentally using that when removing `ECLDIR`.



---

archive/issue_comments_364661.json:
```json
{
    "body": "Replying to [comment:15 gh-timokau]:\n> For what its worth I still have to set `ECLDIR` for the nix package. I'm not sure why ECL needs that or what the default is when it is not set. Have you tested sage without a system ECL installed? Maybe its accidentally using that when removing `ECLDIR`.\n\n\nFrom ecl's configure script:\n\nAC_ARG_VAR([ecldir], [the directory where *.fas files are installed])\ntest -z \"${ecldir}\" && ecldir=\"${libdir}/ecl-${PACKAGE_VERSION}\"\n\nSage works fine without a system ecl and without setting ECLDIR (even after removing it from sage-env). From #7186 setting it was added to fix issues after moving the sage tree - I wonder if that still makes sense now that moving the tree is no longer supported",
    "created_at": "2018-08-24T17:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364661",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:15 gh-timokau]:
> For what its worth I still have to set `ECLDIR` for the nix package. I'm not sure why ECL needs that or what the default is when it is not set. Have you tested sage without a system ECL installed? Maybe its accidentally using that when removing `ECLDIR`.


From ecl's configure script:

AC_ARG_VAR([ecldir], [the directory where *.fas files are installed])
test -z "${ecldir}" && ecldir="${libdir}/ecl-${PACKAGE_VERSION}"

Sage works fine without a system ecl and without setting ECLDIR (even after removing it from sage-env). From #7186 setting it was added to fix issues after moving the sage tree - I wonder if that still makes sense now that moving the tree is no longer supported



---

archive/issue_comments_364662.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-24T17:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364662",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_364663.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-24T17:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364663",
    "user": "https://github.com/timokau"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_364664.json:
```json
{
    "body": "Out of interest: Do you happen to know how ecl knows sage's `lib_dir`?",
    "created_at": "2018-08-24T17:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364664",
    "user": "https://github.com/timokau"
}
```

Out of interest: Do you happen to know how ecl knows sage's `lib_dir`?



---

archive/issue_comments_364665.json:
```json
{
    "body": "Replying to [comment:18 gh-timokau]:\n> Out of interest: Do you happen to know how ecl knows sage's `lib_dir`?\n\n\nsdh_configure does that\n\nhttps://github.com/sagemath/sage/blob/master/src/bin/sage-dist-helpers#L150",
    "created_at": "2018-08-24T18:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364665",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:18 gh-timokau]:
> Out of interest: Do you happen to know how ecl knows sage's `lib_dir`?


sdh_configure does that

https://github.com/sagemath/sage/blob/master/src/bin/sage-dist-helpers#L150



---

archive/issue_comments_364666.json:
```json
{
    "body": "Hm weird, we set the correct `--prefix` for ecl and the lib dir is under `<prefix>/lib` as usual, so I wonder why ecl doesn't figure it out by itself in our case. Something to investigate in the future. Thanks :)",
    "created_at": "2018-08-24T18:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364666",
    "user": "https://github.com/timokau"
}
```

Hm weird, we set the correct `--prefix` for ecl and the lib dir is under `<prefix>/lib` as usual, so I wonder why ecl doesn't figure it out by itself in our case. Something to investigate in the future. Thanks :)



---

archive/issue_comments_364667.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-25T23:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364667",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_364668.json:
```json
{
    "body": "Author name is missing...",
    "created_at": "2018-08-25T23:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364668",
    "user": "https://github.com/vbraun"
}
```

Author name is missing...



---

archive/issue_comments_364669.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-08-26T07:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364669",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_065125.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-29T22:31:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26100#event-65125"
}
```



---

archive/issue_comments_364670.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-29T22:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26100#issuecomment-364670",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
