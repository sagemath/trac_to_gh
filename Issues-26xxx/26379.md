# Issue 26379: Global function fields: places

archive/issues_026379.json:
```json
{
    "body": "This is part of the meta-ticket #22982.\n\nThe goal of the present ticket is to add code for computing places of global function fields.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26616\n\n",
    "closed_at": "2019-01-24T18:18:00Z",
    "created_at": "2018-11-02T07:39:20Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Global function fields: places",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26379",
    "user": "https://github.com/kwankyu"
}
```
This is part of the meta-ticket #22982.

The goal of the present ticket is to add code for computing places of global function fields.


Issue created by migration from https://trac.sagemath.org/ticket/26616





---

archive/issue_comments_371006.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-02T07:41:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371007.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-03T03:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371008.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-03T03:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371008",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_371009.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-03T03:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371010.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-04T06:44:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371010",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371011.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-09T06:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371012.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-28T00:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371013.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-28T06:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371014.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-13T06:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371015.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-12-24T06:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371015",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371016.json:
```json
{
    "body": "Some comments:\n\n- Perhaps it is my lack of understanding of the field, but is `place` common terminology for `valuation()`? It might be good to keep some indication about it being a prime element.\n- What is the reason for `FunctionFieldElement_global.__cached_methods`?\n- You should be able to replace `[place for place in self._places_finite(degree)]` with `list(self._places_finite(degree))`. Similarly for the `infinite`.\n- I think there is a grammar issue here: `Return the unique place at infinite.` Should it be `Return the unique place at infinity.`?\n- Instead of a ``@`cached_method` for `_gens_over_base`, I could consider making it a ``@`lazy_attribute`. (So you then use it as `self._gens_over_base` instead of `self._gens_over_base()`.)\n- I am not sure about this change:\n  {{{#!diff\n-        norm = reduce(operator.mul, hnf.diagonal())\n+        norm = 1\n+        for e in hnf.diagonal():\n+            norm *= e\n  }}}\n  as it might be slower. However, this is a minor thing (the new code is definitely more readable).\n- I do not think you need the `lazy_import('sage.matrix.constructor', 'matrix')` in `sage/rings/function_field/valuation_ring.py`.\n\nOtherwise it does what it says it does, so LGTM.",
    "created_at": "2019-01-17T02:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371016",
    "user": "https://github.com/tscrim"
}
```

Some comments:

- Perhaps it is my lack of understanding of the field, but is `place` common terminology for `valuation()`? It might be good to keep some indication about it being a prime element.
- What is the reason for `FunctionFieldElement_global.__cached_methods`?
- You should be able to replace `[place for place in self._places_finite(degree)]` with `list(self._places_finite(degree))`. Similarly for the `infinite`.
- I think there is a grammar issue here: `Return the unique place at infinite.` Should it be `Return the unique place at infinity.`?
- Instead of a ``@`cached_method` for `_gens_over_base`, I could consider making it a ``@`lazy_attribute`. (So you then use it as `self._gens_over_base` instead of `self._gens_over_base()`.)
- I am not sure about this change:
  {{{#!diff
-        norm = reduce(operator.mul, hnf.diagonal())
+        norm = 1
+        for e in hnf.diagonal():
+            norm *= e
  }}}
  as it might be slower. However, this is a minor thing (the new code is definitely more readable).
- I do not think you need the `lazy_import('sage.matrix.constructor', 'matrix')` in `sage/rings/function_field/valuation_ring.py`.

Otherwise it does what it says it does, so LGTM.



---

archive/issue_comments_371017.json:
```json
{
    "body": "Replying to [comment:13 tscrim]:\n> Some comments:\n> \n> - Perhaps it is my lack of understanding of the field, but is `place` common terminology for `valuation()`? It might be good to keep some indication about it being a prime element.\n\n\n\"place\" is established terminology in the function field theory. Places correspond, one-to-one, to (discrete) valuation rings of the function field, which  defines valuation of the elements of the function field. In a later stage, I will introduce \"divisors\", which are central objects in the function field theory. A divisor is defined to be a formal sum of places.  A place is not said to be prime, though \"finite\" places are in one-to-one correspondence with prime ideals of the \"finite\" maximal order.\n\n\n> - What is the reason for `FunctionFieldElement_global.__cached_methods`?\n\n\nI forgot :-) I removed it.\n\n> - You should be able to replace `[place for place in self._places_finite(degree)]` with `list(self._places_finite(degree))`. Similarly for the `infinite`.\n\n\nDone. Thanks.\n\n> - I think there is a grammar issue here: `Return the unique place at infinite.` Should it be `Return the unique place at infinity.`?\n\n\nRight. Fixed.\n\n> - Instead of a ``@`cached_method` for `_gens_over_base`, I could consider making it a ``@`lazy_attribute`. (So you then use it as `self._gens_over_base` instead of `self._gens_over_base()`.)\n\n\nOk. Done. Thanks for a good tip.\n\n> - I am not sure about this change:\n>   {{{#!diff\n> -        norm = reduce(operator.mul, hnf.diagonal())\n> +        norm = 1\n> +        for e in hnf.diagonal():\n> +            norm *= e\n>   }}}\n>   as it might be slower. However, this is a minor thing (the new code is definitely more readable).\n\n\nI guess Guido did not remove `reduce` in python3 for no reason. I did a simple experiment (with ints) in python3 and both take the same time. I would prefer to remove `reduce`. \n> - I do not think you need the `lazy_import('sage.matrix.constructor', 'matrix')` in `sage/rings/function_field/valuation_ring.py`.\n\n\nRemoved.\n\nThank you for giving attention!!",
    "created_at": "2019-01-17T09:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371017",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:13 tscrim]:
> Some comments:
> 
> - Perhaps it is my lack of understanding of the field, but is `place` common terminology for `valuation()`? It might be good to keep some indication about it being a prime element.


"place" is established terminology in the function field theory. Places correspond, one-to-one, to (discrete) valuation rings of the function field, which  defines valuation of the elements of the function field. In a later stage, I will introduce "divisors", which are central objects in the function field theory. A divisor is defined to be a formal sum of places.  A place is not said to be prime, though "finite" places are in one-to-one correspondence with prime ideals of the "finite" maximal order.


> - What is the reason for `FunctionFieldElement_global.__cached_methods`?


I forgot :-) I removed it.

> - You should be able to replace `[place for place in self._places_finite(degree)]` with `list(self._places_finite(degree))`. Similarly for the `infinite`.


Done. Thanks.

> - I think there is a grammar issue here: `Return the unique place at infinite.` Should it be `Return the unique place at infinity.`?


Right. Fixed.

> - Instead of a ``@`cached_method` for `_gens_over_base`, I could consider making it a ``@`lazy_attribute`. (So you then use it as `self._gens_over_base` instead of `self._gens_over_base()`.)


Ok. Done. Thanks for a good tip.

> - I am not sure about this change:
>   {{{#!diff
> -        norm = reduce(operator.mul, hnf.diagonal())
> +        norm = 1
> +        for e in hnf.diagonal():
> +            norm *= e
>   }}}
>   as it might be slower. However, this is a minor thing (the new code is definitely more readable).


I guess Guido did not remove `reduce` in python3 for no reason. I did a simple experiment (with ints) in python3 and both take the same time. I would prefer to remove `reduce`. 
> - I do not think you need the `lazy_import('sage.matrix.constructor', 'matrix')` in `sage/rings/function_field/valuation_ring.py`.


Removed.

Thank you for giving attention!!



---

archive/issue_comments_371018.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-17T09:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371018",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-17T09:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_371020.json:
```json
{
    "body": "Squashed and rebased to sage 8.6.",
    "created_at": "2019-01-17T09:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371020",
    "user": "https://github.com/kwankyu"
}
```

Squashed and rebased to sage 8.6.



---

archive/issue_events_066043.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2019-01-17T16:39:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26379#event-66043"
}
```



---

archive/issue_comments_371021.json:
```json
{
    "body": "Thank you for the explanation about the definition of a `place`. I learned something new. `<sup>_</sup>`\n\nDo you think you could add that or some variant to `place.py`, either at the module-level or in some key class-level doc? Maybe also with a standard reference for the subject? Once that is done, positive review.\n\nI forgot that `reduce` was moved to `functools`. Thanks for the reminder.",
    "created_at": "2019-01-17T16:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371021",
    "user": "https://github.com/tscrim"
}
```

Thank you for the explanation about the definition of a `place`. I learned something new. `<sup>_</sup>`

Do you think you could add that or some variant to `place.py`, either at the module-level or in some key class-level doc? Maybe also with a standard reference for the subject? Once that is done, positive review.

I forgot that `reduce` was moved to `functools`. Thanks for the reminder.



---

archive/issue_comments_371022.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-18T03:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371022",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371023.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-18T05:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371023",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_371024.json:
```json
{
    "body": "Thank you.",
    "created_at": "2019-01-18T05:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371024",
    "user": "https://github.com/tscrim"
}
```

Thank you.



---

archive/issue_comments_371025.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-24T18:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26379#issuecomment-371025",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_066044.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-01-24T18:18:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26379",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26379#event-66044"
}
```
