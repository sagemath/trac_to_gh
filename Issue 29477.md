# Issue 29477: some micro optimisations in comparison to empty list

Issue created by migration from https://trac.sagemath.org/ticket/29714

Original creator: chapoton

Original creation time: 2020-05-19 20:14:27

CC:  tscrim




---

Comment by chapoton created at 2020-05-19 20:17:03

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-05-19 20:17:03

New commits:


---

Comment by nbruin created at 2020-05-19 22:32:39

I'm always worried by these shorthand checks. Checking that a list has members seems much more clearly expressed by `if len(L):`. For instance, `if L:` does not distinguish between `L=[]` and `L=None`, whereas `if L != []:` does.

So, I think you need to be pretty sure that L really is a list before making such changes. I see in some of the code fragments that's pretty obviously the case, so then the change is fine, but I'd be concerned when I were making such a change across a whole bunch of code I'd overlook some corner case. Aren't you?


---

Comment by @denissunko created at 2020-05-20 13:55:43

Logically there is a difference between the replacements


```
-            while ret[-1] != []:
+            while ret[-1]:
```


and


```
-                if arg == []:
+                if not arg:
```


In the latter case a `None` can slip through after the change, in the former it cannot (but it could before). So from a formal point of view, the first replacement is an improvement, the second a regression, and they are clearly distinguished by the apperance of `not`.

However, from an operational viewpoint, it is hard to imagine an unexpected `None` generating a silent error, at least in my experience. So one could adopt a legalistic attitude: whosoever overloads the `bool()` built-in should expect it to be used as in these optimizations.


---

Comment by git created at 2020-06-10 14:52:42

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2020-06-10 14:53:46

I have looked again at all of the changes, and remove some slightly dubious ones.

What remains seems safe enough for me.


---

Comment by @denissunko created at 2020-06-10 16:45:06

I agree that systematic preference of positive over negative statements is better than using bool() everywhere, and safe enough.


---

Comment by git created at 2020-06-10 17:12:45

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2020-06-10 18:54:05

and the bot is now fully green


---

Comment by @denissunko created at 2020-06-10 19:10:47

Changing status from needs_review to positive_review.


---

Comment by @denissunko created at 2020-06-10 19:10:47

yess


---

Comment by vbraun created at 2020-07-08 19:32:33

Resolution: fixed
