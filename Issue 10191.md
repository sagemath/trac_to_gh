# Issue 10191: SageNB fails to install when SAGE_PATH is set to '.'

archive/issues_010191.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  leif mpatel mhansen jdemeyer jhpalmieri\n\nKeywords: notebook installation\n\nWhen `SAGE_PATH` is set to '.', during the installation of sagenb, python is able to find sagenb into its path and therefore refuse to add it to easy-install.pth. Later sage won't find it leading to the following error message\n\n```\nImportError: No module named sagenb.misc.sphinxify\nError importing ipy_profile_sage - perhaps you should run %upgrade?\nWARNING: Loading of ipy_profile_sage failed.\n```\n\n\nThis is a followup to #10176 and there has been some discussion on [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/bb636656e2153332)\n\nIssue created by migration from https://trac.sagemath.org/ticket/10192\n\n",
    "created_at": "2010-10-30T15:48:54Z",
    "labels": [
        "notebook",
        "major",
        "bug"
    ],
    "title": "SageNB fails to install when SAGE_PATH is set to '.'",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10191",
    "user": "hivert"
}
```
Assignee: jason, was

CC:  leif mpatel mhansen jdemeyer jhpalmieri

Keywords: notebook installation

When `SAGE_PATH` is set to '.', during the installation of sagenb, python is able to find sagenb into its path and therefore refuse to add it to easy-install.pth. Later sage won't find it leading to the following error message

```
ImportError: No module named sagenb.misc.sphinxify
Error importing ipy_profile_sage - perhaps you should run %upgrade?
WARNING: Loading of ipy_profile_sage failed.
```


This is a followup to #10176 and there has been some discussion on [sage-release](http://groups.google.com/group/sage-release/browse_thread/thread/bb636656e2153332)

Issue created by migration from https://trac.sagemath.org/ticket/10192





---

archive/issue_comments_103586.json:
```json
{
    "body": "Changing keywords from \"notebook installation\" to \"notebook installation dot PYTHONPATH easy_install easy-install pth sage-spkg setuptools\".",
    "created_at": "2010-10-30T22:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103586",
    "user": "leif"
}
```

Changing keywords from "notebook installation" to "notebook installation dot PYTHONPATH easy_install easy-install pth sage-spkg setuptools".



---

archive/issue_comments_103587.json:
```json
{
    "body": "From `sage-env`:\n\n```sh\nif [ -d \"$SAGE_ROOT/local/lib/python\" ]; then\n    PYTHONPATH=\"$SAGE_PATH:$SAGE_ROOT/local/lib/python\"   && export PYTHONPATH\n    PYTHONHOME=\"$SAGE_ROOT/local\" && export PYTHONHOME\nfi\n```\n\n\nWe shouldn't add `$SAGE_PATH` there if it is empty btw., but the removal of \"`.`\" from `PYTHONPATH` should be performed in `sage-spkg` I think.\n\n(`$SAGE_PATH` is also *appended* to an overwritten(?!) `PYTHONPATH` in `sage-doctest`.)",
    "created_at": "2010-10-30T22:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103587",
    "user": "leif"
}
```

From `sage-env`:

```sh
if [ -d "$SAGE_ROOT/local/lib/python" ]; then
    PYTHONPATH="$SAGE_PATH:$SAGE_ROOT/local/lib/python"   && export PYTHONPATH
    PYTHONHOME="$SAGE_ROOT/local" && export PYTHONHOME
fi
```


We shouldn't add `$SAGE_PATH` there if it is empty btw., but the removal of "`.`" from `PYTHONPATH` should be performed in `sage-spkg` I think.

(`$SAGE_PATH` is also *appended* to an overwritten(?!) `PYTHONPATH` in `sage-doctest`.)



---

archive/issue_comments_103588.json:
```json
{
    "body": "Ok, after changing some instances of `PYTHON_PATH` to `PYTHONPATH` (argh!), the attached patch works for me.\n\nYou can try setting `SAGE_PATH` to something containing \"`.`\" (e.g. `\":/foo/bar:.:/baz`, too), of course also doing `export SAGE_PATH`, then [re]installing the SageNB 0.8.7 spkg (or the newer ones, p1 or p2, but these aren't necessary, i.e., the patch here fixes the issue in a different way, not needing an additional work-around).",
    "created_at": "2010-10-31T01:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103588",
    "user": "leif"
}
```

Ok, after changing some instances of `PYTHON_PATH` to `PYTHONPATH` (argh!), the attached patch works for me.

You can try setting `SAGE_PATH` to something containing "`.`" (e.g. `":/foo/bar:.:/baz`, too), of course also doing `export SAGE_PATH`, then [re]installing the SageNB 0.8.7 spkg (or the newer ones, p1 or p2, but these aren't necessary, i.e., the patch here fixes the issue in a different way, not needing an additional work-around).



---

archive/issue_comments_103589.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-10-31T01:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103589",
    "user": "leif"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_103590.json:
```json
{
    "body": "As far as I know, Cygwin (as opposed to MS DOS/Windows) also uses \"`:`\" to separate directories in search paths, so this should work for Cygwin as well.\n\n(Other shell and even Python scripts in Sage also hard-code that character.)",
    "created_at": "2010-10-31T01:31:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103590",
    "user": "leif"
}
```

As far as I know, Cygwin (as opposed to MS DOS/Windows) also uses "`:`" to separate directories in search paths, so this should work for Cygwin as well.

(Other shell and even Python scripts in Sage also hard-code that character.)



---

archive/issue_comments_103591.json:
```json
{
    "body": "Changing component from notebook to build.",
    "created_at": "2010-10-31T01:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103591",
    "user": "leif"
}
```

Changing component from notebook to build.



---

archive/issue_comments_103592.json:
```json
{
    "body": "Replying to [comment:5 leif]:\n\nApplying the patch give me\n\n```\npatching file sage-spkg\nHunk #1 succeeded at 292 (offset -8 lines).\n```\n\nAre you sure that you didn't change anything else from a vanilla 4.6.rc0 ? \n\nAnyway, for what concerns openSUSE 11.1 and 11.3 the patch perfectly works. I also checked it on sage.sagemath.org. So I'm ok to give it a positive review, except for the Cygwin question where I'm not competent. Please do it on my behalf as soon as you have Mike answer.",
    "created_at": "2010-10-31T08:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103592",
    "user": "hivert"
}
```

Replying to [comment:5 leif]:

Applying the patch give me

```
patching file sage-spkg
Hunk #1 succeeded at 292 (offset -8 lines).
```

Are you sure that you didn't change anything else from a vanilla 4.6.rc0 ? 

Anyway, for what concerns openSUSE 11.1 and 11.3 the patch perfectly works. I also checked it on sage.sagemath.org. So I'm ok to give it a positive review, except for the Cygwin question where I'm not competent. Please do it on my behalf as soon as you have Mike answer.



---

archive/issue_comments_103593.json:
```json
{
    "body": "Replying to [comment:6 hivert]:\n> Applying the patch give me\n\n```\npatching file sage-spkg\nHunk #1 succeeded at 292 (offset -8 lines).\n```\n\n> Are you sure that you didn't change anything else from a vanilla 4.6.rc0 ? \n\nOk, not based on *vanilla* rc0; I've also applied a completely unrelated patch to `sage-spkg` (removing \"`x`\" from `tar` by default, #10040).",
    "created_at": "2010-10-31T09:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103593",
    "user": "leif"
}
```

Replying to [comment:6 hivert]:
> Applying the patch give me

```
patching file sage-spkg
Hunk #1 succeeded at 292 (offset -8 lines).
```

> Are you sure that you didn't change anything else from a vanilla 4.6.rc0 ? 

Ok, not based on *vanilla* rc0; I've also applied a completely unrelated patch to `sage-spkg` (removing "`x`" from `tar` by default, #10040).



---

archive/issue_comments_103594.json:
```json
{
    "body": "Attachment [trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg-scripts_repo.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg-scripts_repo.patch) by leif created at 2010-10-31 12:45:04\n\nApply to scripts repo. Based on vanilla Sage 4.6.rc0. (Updated version, handles more weird cases, too.)",
    "created_at": "2010-10-31T12:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103594",
    "user": "leif"
}
```

Attachment [trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg-scripts_repo.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg-scripts_repo.patch) by leif created at 2010-10-31 12:45:04

Apply to scripts repo. Based on vanilla Sage 4.6.rc0. (Updated version, handles more weird cases, too.)



---

archive/issue_comments_103595.json:
```json
{
    "body": "I've uploaded a slightly improved patch, this time *really* based on *vanilla* 4.6.rc0.\n\nTry again...\n\n(also with `SAGE_PATH=\".::./././//./://bingo//:baz:::://///:./.:.\"` and alike) ;-)\n\nAlthough it *might* still fail with e.g. `SAGE_PATH=\"./foo/..\"` (if `./foo/` happens to exist in the directory `setup` is run in), but this would at least for SageNB be catched by the 0.8.7.p{1,2} spkgs...",
    "created_at": "2010-10-31T13:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103595",
    "user": "leif"
}
```

I've uploaded a slightly improved patch, this time *really* based on *vanilla* 4.6.rc0.

Try again...

(also with `SAGE_PATH=".::./././//./://bingo//:baz:::://///:./.:."` and alike) ;-)

Although it *might* still fail with e.g. `SAGE_PATH="./foo/.."` (if `./foo/` happens to exist in the directory `setup` is run in), but this would at least for SageNB be catched by the 0.8.7.p{1,2} spkgs...



---

archive/issue_comments_103596.json:
```json
{
    "body": "ping...\n\n(Still needs review, only the Cygwin question seems still open, though I believe it'll also work on Cygwin.)\n\nThe patch will almost certainly have to get rebased, haven't tried yet.",
    "created_at": "2011-08-11T19:07:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103596",
    "user": "leif"
}
```

ping...

(Still needs review, only the Cygwin question seems still open, though I believe it'll also work on Cygwin.)

The patch will almost certainly have to get rebased, haven't tried yet.



---

archive/issue_comments_103597.json:
```json
{
    "body": "SCRIPTS repo. Same patch, rebased to Sage 4.7.1.rc2.",
    "created_at": "2011-08-11T20:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103597",
    "user": "leif"
}
```

SCRIPTS repo. Same patch, rebased to Sage 4.7.1.rc2.



---

archive/issue_comments_103598.json:
```json
{
    "body": "Attachment [trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.rebased_to_4.7.1.rc2.scripts.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.rebased_to_4.7.1.rc2.scripts.patch) by leif created at 2011-08-11 20:33:44\n\nReplying to [comment:9 leif]:\n> The patch will almost certainly have to get rebased, haven't tried yet.\n\nWow, the patch still applied (with an offset of only a few lines); I've rebased it on Sage 4.7.1.rc2 despite of that to now apply cleanly.\n\nThere are currently some concurrent tickets also patching `sage-spkg` though.",
    "created_at": "2011-08-11T20:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103598",
    "user": "leif"
}
```

Attachment [trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.rebased_to_4.7.1.rc2.scripts.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.rebased_to_4.7.1.rc2.scripts.patch) by leif created at 2011-08-11 20:33:44

Replying to [comment:9 leif]:
> The patch will almost certainly have to get rebased, haven't tried yet.

Wow, the patch still applied (with an offset of only a few lines); I've rebased it on Sage 4.7.1.rc2 despite of that to now apply cleanly.

There are currently some concurrent tickets also patching `sage-spkg` though.



---

archive/issue_comments_103599.json:
```json
{
    "body": "New attempt to clean up even nastier paths (including .., ./., etc)",
    "created_at": "2011-10-13T12:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103599",
    "user": "ppurka"
}
```

New attempt to clean up even nastier paths (including .., ./., etc)



---

archive/issue_comments_103600.json:
```json
{
    "body": "Attachment [trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.2.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.2.patch) by ppurka created at 2011-10-13 12:50:18\n\nNew attempt to clean up even nastier paths (including .., ./., etc) (Ignore the other patch)",
    "created_at": "2011-10-13T12:50:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103600",
    "user": "ppurka"
}
```

Attachment [trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.2.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.2.patch) by ppurka created at 2011-10-13 12:50:18

New attempt to clean up even nastier paths (including .., ./., etc) (Ignore the other patch)



---

archive/issue_comments_103601.json:
```json
{
    "body": "Attachment [trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.patch) by ppurka created at 2011-10-13 12:51:23\n\nPlease check [attachment:trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.patch] against other platforms. I have checked it on Linux x86_64 and it cleans up nasty examples like the one mentioned earlier `\".::./././//./://bingo//:baz:::://///:./.:.\"`. (Indented the paste below :))\n\n```\n ~ $ AAAA=\".::./././//./://bingo//:baz:::://///:./.:.\"\n ~ $ new_pp=\"\"\n ~ $ IFS=\":\"\n ~ $ for x in $AAAA; do\n  if [ -n \"$x\" -a -n \"$(echo \"$x\" | sed -e 's/[\\.\\/]\\+//g')\" ]; then\n    if [ -z \"$new_pp\" ]; then\n      new_pp=\"$x\"\n    else\n      new_pp=\"${new_pp}:$x\"\n    fi\n  fi\ndone \n ~ $ echo \"$new_pp\"\n//bingo//:baz\n```\n\nThis is against 4.7.0. I will later try to upload it rebased against 4.7.2.",
    "created_at": "2011-10-13T12:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103601",
    "user": "ppurka"
}
```

Attachment [trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.patch) by ppurka created at 2011-10-13 12:51:23

Please check [attachment:trac_10192-remove_dot_and_more_from_PYTHONPATH_in_sage.spkg.patch] against other platforms. I have checked it on Linux x86_64 and it cleans up nasty examples like the one mentioned earlier `".::./././//./://bingo//:baz:::://///:./.:."`. (Indented the paste below :))

```
 ~ $ AAAA=".::./././//./://bingo//:baz:::://///:./.:."
 ~ $ new_pp=""
 ~ $ IFS=":"
 ~ $ for x in $AAAA; do
  if [ -n "$x" -a -n "$(echo "$x" | sed -e 's/[\.\/]\+//g')" ]; then
    if [ -z "$new_pp" ]; then
      new_pp="$x"
    else
      new_pp="${new_pp}:$x"
    fi
  fi
done 
 ~ $ echo "$new_pp"
//bingo//:baz
```

This is against 4.7.0. I will later try to upload it rebased against 4.7.2.



---

archive/issue_comments_103602.json:
```json
{
    "body": "And what's the advantage of running `sed` (and twice `test`, and `echo`) multiple times in a loop? B)\n\nI'm not sure right now whether my patch is up-to-date btw., as the currently attached one doesn't remove redundant slashs and (e.g.) `./`... 8/",
    "created_at": "2011-10-13T15:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103602",
    "user": "leif"
}
```

And what's the advantage of running `sed` (and twice `test`, and `echo`) multiple times in a loop? B)

I'm not sure right now whether my patch is up-to-date btw., as the currently attached one doesn't remove redundant slashs and (e.g.) `./`... 8/



---

archive/issue_comments_103603.json:
```json
{
    "body": "Replying to [comment:13 leif]:\n> And what's the advantage of running `sed` (and twice `test`, and `echo`) multiple times in a loop? B)\n> \n> I'm not sure right now whether my patch is up-to-date btw., as the currently attached one doesn't remove redundant slashs and (e.g.) `./`... 8/\nThe main point in the patch is the separator that is redefined to ':'.\n\nNow when you run a loop through the variable, it loops through all the parts separated by ':'. Once each part is separated, you can check whether it is empty (hence the first test `-n \"$x\"`), or whether it consists of only . and / (hence the echo + sed). This is important because this catches all the bad cases like `..`, `./.`, `.`, etc. ( In relation to #11914, I tried to cd to devel/sage/sage and ran sage as `SAGE_PATH=.. sage -n` and it failed to run. So we should definitely weed out at least `..` by itself. ) I do feel that it is over-engineered, but I haven't been able to come up with a better solution that catches all the cases.\n\nSince all the scripts in Sage are trying to conform to POSIX you need the echo + sed. In pure bash, you can replace the `\"$( echo \"$x\" | sed ... )\"` with simply `\"${x//[\\.\\/]}\"`",
    "created_at": "2011-10-13T15:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103603",
    "user": "ppurka"
}
```

Replying to [comment:13 leif]:
> And what's the advantage of running `sed` (and twice `test`, and `echo`) multiple times in a loop? B)
> 
> I'm not sure right now whether my patch is up-to-date btw., as the currently attached one doesn't remove redundant slashs and (e.g.) `./`... 8/
The main point in the patch is the separator that is redefined to ':'.

Now when you run a loop through the variable, it loops through all the parts separated by ':'. Once each part is separated, you can check whether it is empty (hence the first test `-n "$x"`), or whether it consists of only . and / (hence the echo + sed). This is important because this catches all the bad cases like `..`, `./.`, `.`, etc. ( In relation to #11914, I tried to cd to devel/sage/sage and ran sage as `SAGE_PATH=.. sage -n` and it failed to run. So we should definitely weed out at least `..` by itself. ) I do feel that it is over-engineered, but I haven't been able to come up with a better solution that catches all the cases.

Since all the scripts in Sage are trying to conform to POSIX you need the echo + sed. In pure bash, you can replace the `"$( echo "$x" | sed ... )"` with simply `"${x//[\.\/]}"`



---

archive/issue_comments_103604.json:
```json
{
    "body": "Replying to [comment:14 ppurka]:\n> Replying to [comment:13 leif]:\n> > And what's the advantage of running `sed` (and twice `test`, and `echo`) multiple times in a loop? B)\n> > \n> > I'm not sure right now whether my patch is up-to-date btw., as the currently attached one doesn't remove redundant slashs and (e.g.) `./`... 8/\n> The main point in the patch is the separator that is redefined to ':'.\n\nWell, I know `IFS`, but I don't want to run it in a loop; that was my point.\n\nMy improved code snippet (simplified and catching additional instances; using a single invocation of `sed`) looks like this:\n\n```sh\n$ echo $EXAMPLE; echo; echo \":$EXAMPLE:\" | sed \\\n-e 's|/\\+|/|g' \\\n-e 's|:\\(\\./\\)\\+|:|g' \\\n-e 's|\\(/\\.\\)\\+:|:|g' \\\n-e 's|\\(:\\.\\)\\+:|:|g' \\\n-e 's|:\\+|:|g' -e 's|^:\\+||' -e 's|:\\+$||' \n.::./././//./://bingo//:baz:::://///:./.:.\n\n/bingo/:baz:/\n```\n\n\n\n\n\n> This is important because this catches all the bad cases like `..`, `./.`, `.`, etc.\n\nWe only have to catch \"`.`\" (i.e., the current working directory) *here*.\n\n\n\n\n> (In relation to #11914, I tried to cd to devel/sage/sage and ran sage as `SAGE_PATH=.. sage -n` and it failed to run. So we should definitely weed out at least `..` by itself.)\n\nIMHO not.  If you put things into `SAGE_PATH`, you have to live with the results (or side-effects) *in that case*.  Or we have to do that in `sage-sage`, before we (try to) start the notebook only, independently of the fix to `sage-env` at #11914 (and of course `sage-spkg`, which is patched here).\n\nA better approach in the case of the notebook would perhaps be to directly test whether any component of `PYTHONPATH` yields `devel/sage-*/` (or has a subdirectory `sage` with an `__init__.py` file in it), or, probably easiest, *prepend* the correct directory to `PYTHONPATH` before running `sage-notebook`.\n\n(We should better discuss the latter on #11914.)",
    "created_at": "2011-10-13T17:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103604",
    "user": "leif"
}
```

Replying to [comment:14 ppurka]:
> Replying to [comment:13 leif]:
> > And what's the advantage of running `sed` (and twice `test`, and `echo`) multiple times in a loop? B)
> > 
> > I'm not sure right now whether my patch is up-to-date btw., as the currently attached one doesn't remove redundant slashs and (e.g.) `./`... 8/
> The main point in the patch is the separator that is redefined to ':'.

Well, I know `IFS`, but I don't want to run it in a loop; that was my point.

My improved code snippet (simplified and catching additional instances; using a single invocation of `sed`) looks like this:

```sh
$ echo $EXAMPLE; echo; echo ":$EXAMPLE:" | sed \
-e 's|/\+|/|g' \
-e 's|:\(\./\)\+|:|g' \
-e 's|\(/\.\)\+:|:|g' \
-e 's|\(:\.\)\+:|:|g' \
-e 's|:\+|:|g' -e 's|^:\+||' -e 's|:\+$||' 
.::./././//./://bingo//:baz:::://///:./.:.

/bingo/:baz:/
```





> This is important because this catches all the bad cases like `..`, `./.`, `.`, etc.

We only have to catch "`.`" (i.e., the current working directory) *here*.




> (In relation to #11914, I tried to cd to devel/sage/sage and ran sage as `SAGE_PATH=.. sage -n` and it failed to run. So we should definitely weed out at least `..` by itself.)

IMHO not.  If you put things into `SAGE_PATH`, you have to live with the results (or side-effects) *in that case*.  Or we have to do that in `sage-sage`, before we (try to) start the notebook only, independently of the fix to `sage-env` at #11914 (and of course `sage-spkg`, which is patched here).

A better approach in the case of the notebook would perhaps be to directly test whether any component of `PYTHONPATH` yields `devel/sage-*/` (or has a subdirectory `sage` with an `__init__.py` file in it), or, probably easiest, *prepend* the correct directory to `PYTHONPATH` before running `sage-notebook`.

(We should better discuss the latter on #11914.)



---

archive/issue_comments_103605.json:
```json
{
    "body": "Attachment [trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.v2.scripts.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.v2.scripts.patch) by leif created at 2011-10-13 17:49:06\n\nSCRIPTS repo. Improved version of my previous patch. Based on Sage 4.7.2.alpha4.",
    "created_at": "2011-10-13T17:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103605",
    "user": "leif"
}
```

Attachment [trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.v2.scripts.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.v2.scripts.patch) by leif created at 2011-10-13 17:49:06

SCRIPTS repo. Improved version of my previous patch. Based on Sage 4.7.2.alpha4.



---

archive/issue_comments_103606.json:
```json
{
    "body": "New patch is up.",
    "created_at": "2011-10-13T17:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103606",
    "user": "leif"
}
```

New patch is up.



---

archive/issue_comments_103607.json:
```json
{
    "body": "New patch looks good to me. I will leave it to people who actually had the problem(s) to report back and change this to \"positive review.\"\n\nPersonally, I had no problems in getting Sage compiled and up and running on two different Linux distributions, and with sage-4.7.0 and sage-4.7.2_alpha3.",
    "created_at": "2011-10-16T12:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103607",
    "user": "ppurka"
}
```

New patch looks good to me. I will leave it to people who actually had the problem(s) to report back and change this to "positive review."

Personally, I had no problems in getting Sage compiled and up and running on two different Linux distributions, and with sage-4.7.0 and sage-4.7.2_alpha3.



---

archive/issue_comments_103608.json:
```json
{
    "body": "Attachment [trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.v3.scripts.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.v3.scripts.patch) by ppurka created at 2012-02-03 19:27:45\n\nUpdated the v2 of the file so that it applies to sage-4.8",
    "created_at": "2012-02-03T19:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103608",
    "user": "ppurka"
}
```

Attachment [trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.v3.scripts.patch](tarball://root/attachments/some-uuid/ticket10192/trac_10192-remove_dot_from_PYTHONPATH_in_sage-spkg.v3.scripts.patch) by ppurka created at 2012-02-03 19:27:45

Updated the v2 of the file so that it applies to sage-4.8



---

archive/issue_comments_103609.json:
```json
{
    "body": "Update patch to sage-4.8.\n\nThis has positive review from my side. If there is nothing else holding it up, then it should be merged, in my opinion.",
    "created_at": "2012-02-03T19:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103609",
    "user": "ppurka"
}
```

Update patch to sage-4.8.

This has positive review from my side. If there is nothing else holding it up, then it should be merged, in my opinion.



---

archive/issue_comments_103610.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-03T19:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103610",
    "user": "ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_103611.json:
```json
{
    "body": "Attachment [10192-remove_dot_from_PYTHONPATH_in_sage-spkg.patch](tarball://root/attachments/some-uuid/ticket10192/10192-remove_dot_from_PYTHONPATH_in_sage-spkg.patch) by jdemeyer created at 2012-02-04 14:10:38",
    "created_at": "2012-02-04T14:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103611",
    "user": "jdemeyer"
}
```

Attachment [10192-remove_dot_from_PYTHONPATH_in_sage-spkg.patch](tarball://root/attachments/some-uuid/ticket10192/10192-remove_dot_from_PYTHONPATH_in_sage-spkg.patch) by jdemeyer created at 2012-02-04 14:10:38



---

archive/issue_comments_103612.json:
```json
{
    "body": "Rebased to #11073.",
    "created_at": "2012-02-04T14:12:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103612",
    "user": "jdemeyer"
}
```

Rebased to #11073.



---

archive/issue_comments_103613.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-06T21:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103613",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_103614.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2012-02-16T09:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103614",
    "user": "jdemeyer"
}
```

Changing status from closed to new.



---

archive/issue_comments_103615.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2012-02-16T09:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103615",
    "user": "jdemeyer"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_103616.json:
```json
{
    "body": "This needs work because \"\\+\" in sed scripts isn't portable.  You can replace \"X\\+\" by \"XX*\", which is equivalent.",
    "created_at": "2012-02-16T09:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103616",
    "user": "jdemeyer"
}
```

This needs work because "\+" in sed scripts isn't portable.  You can replace "X\+" by "XX*", which is equivalent.



---

archive/issue_comments_103617.json:
```json
{
    "body": "Another minor comment: use spaces instead of TABs for indenting.",
    "created_at": "2012-02-16T09:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103617",
    "user": "jdemeyer"
}
```

Another minor comment: use spaces instead of TABs for indenting.



---

archive/issue_comments_103618.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> This needs work because \"\\+\" in sed scripts isn't portable.  You can replace \"X\\+\" by \"XX*\", which is equivalent.\n\nIs `\\{1,\\}` a portable version of `\\+`?",
    "created_at": "2012-02-16T09:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103618",
    "user": "ppurka"
}
```

Replying to [comment:22 jdemeyer]:
> This needs work because "\+" in sed scripts isn't portable.  You can replace "X\+" by "XX*", which is equivalent.

Is `\{1,\}` a portable version of `\+`?



---

archive/issue_comments_103619.json:
```json
{
    "body": "Replying to [comment:24 ppurka]:\n> Is `\\{1,\\}` a portable version of `\\+`?\n\nAs far as I can tell, yes.  But I consider \"XX*\" to be more readable than \"X\\{1,\\}\", especially for short strings X, which is the case here.",
    "created_at": "2012-02-16T09:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103619",
    "user": "jdemeyer"
}
```

Replying to [comment:24 ppurka]:
> Is `\{1,\}` a portable version of `\+`?

As far as I can tell, yes.  But I consider "XX*" to be more readable than "X\{1,\}", especially for short strings X, which is the case here.



---

archive/issue_comments_103620.json:
```json
{
    "body": "Apply only this to SAGE_ROOT",
    "created_at": "2012-02-16T11:46:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103620",
    "user": "ppurka"
}
```

Apply only this to SAGE_ROOT



---

archive/issue_comments_103621.json:
```json
{
    "body": "Attachment [10192-remove_dot_from_PYTHONPATH_in_sage-spkg.2.patch](tarball://root/attachments/some-uuid/ticket10192/10192-remove_dot_from_PYTHONPATH_in_sage-spkg.2.patch) by ppurka created at 2012-02-16 11:46:58\n\nUpdated the patch with the stated modifications. Please review.\n\nHere is the output in busybox (probably the closest system to POSIX I have around here, but the earlier version also works fine):\n\n```\n~> busybox sh\n\n\nBusyBox v1.18.4 (Ubuntu 1:1.18.4-2ubuntu2) built-in shell (ash)\nEnter 'help' for a list of built-in commands.\n\n~ $ EXAMPLE=\".::./././//./://bingo//:baz:::://///:./.:.\"\n~ $ echo :$EXAMPLE: | busybox sed -e 's|//*|/|g' -e 's|:\\(\\./\\)\\{1,\\}|:|g' -e 's\ns|::*$||'\n/bingo/:baz:/\n```\n",
    "created_at": "2012-02-16T11:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103621",
    "user": "ppurka"
}
```

Attachment [10192-remove_dot_from_PYTHONPATH_in_sage-spkg.2.patch](tarball://root/attachments/some-uuid/ticket10192/10192-remove_dot_from_PYTHONPATH_in_sage-spkg.2.patch) by ppurka created at 2012-02-16 11:46:58

Updated the patch with the stated modifications. Please review.

Here is the output in busybox (probably the closest system to POSIX I have around here, but the earlier version also works fine):

```
~> busybox sh


BusyBox v1.18.4 (Ubuntu 1:1.18.4-2ubuntu2) built-in shell (ash)
Enter 'help' for a list of built-in commands.

~ $ EXAMPLE=".::./././//./://bingo//:baz:::://///:./.:."
~ $ echo :$EXAMPLE: | busybox sed -e 's|//*|/|g' -e 's|:\(\./\)\{1,\}|:|g' -e 's
s|::*$||'
/bingo/:baz:/
```




---

archive/issue_comments_103622.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-16T11:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103622",
    "user": "ppurka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_103623.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-21T10:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103623",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_103624.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-27T11:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10191",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10191#issuecomment-103624",
    "user": "jdemeyer"
}
```

Resolution: fixed
