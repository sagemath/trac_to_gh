# Issue 30052: Error in display of a continuous map between open intervals

Issue created by migration from https://trac.sagemath.org/ticket/30289

Original creator: tscrim

Original creation time: 2020-08-04 23:16:16

CC:  egourgoulhon @mjungmath slelievre

Keywords: equation display


```
sage: R.<t> = RealLine()
sage: I = R.open_interval(0, 2*pi)
sage: J = R.open_interval(2*pi, 6*pi)
sage: h = J.continuous_map(I, ((2*pi-t)/2,), name='h')
sage: h.display()
h: (2*pi, 6*pi) --> (0, 2*pi)
   t |-->
```



---

Comment by @mjungmath created at 2020-08-05 07:35:00

Removing the error block in starting in line 1069 in `continuous_map.py` then yields the following error:


```
sage: R.<t> = RealLine()
sage: I = R.open_interval(0, 2*pi)
sage: J = R.open_interval(2*pi, 6*pi)
sage: h = J.continuous_map(I, ((t-2*pi)/2,), name='h')
sage: h.display()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-67d00ebd9395> in <module>()
      3 J = R.open_interval(Integer(2)*pi, Integer(6)*pi)
      4 h = J.continuous_map(I, ((t-Integer(2)*pi)/Integer(2),), name='h')
----> 5 h.display()

/home/michi/Projekte/sage-devel/local/lib/python3.7/site-packages/sage/manifolds/continuous_map.py in display(self, chart1, chart2)
   1113                 for ch1 in self._domain._top_charts:
   1114                     for ch2 in self._codomain.atlas():
-> 1115                         _display_expression(self, ch1, ch2, result)
   1116             else:
   1117                 for ch1 in self._domain._top_charts:

/home/michi/Projekte/sage-devel/local/lib/python3.7/site-packages/sage/manifolds/continuous_map.py in _display_expression(self, chart1, chart2, result)
   1086                 if len(expression) == 1:
   1087                     result._txt += repr(coords2[0]) + " = " + \
-> 1088                                   repr(expression[0]) + "\n"
   1089                     result._latex += latex(coords2[0]) + " = " + \
   1090                                     latex(coord_func[0]) + r"\\"

TypeError: 'sage.symbolic.expression.Expression' object is not subscriptable
```


Imho, this try-except block should be removed and replaced by another solution (or at least restricted to a smaller snippet of code) since it can mask bugs like these.

Furthermore, I just noticed that picewise defined continuous maps (not quite the unusal case) could perhaps not be displayed properly (cf. #28554 for scalar fields).


---

Comment by @mjungmath created at 2020-08-05 07:40:01

Ah okay, it's the variable `coords2`. The bug can be fixed very quickly.

My other points still stand for discussion. :)


---

Comment by @mjungmath created at 2020-08-05 07:51:10

New commits:


---

Comment by @mjungmath created at 2020-08-05 07:51:10

Changing status from new to needs_review.


---

Comment by tscrim created at 2020-08-05 08:23:58

Shouldn't the same change also be done for the `result._latex`?

Also, please add a doctest.


---

Comment by @mjungmath created at 2020-08-05 08:46:45

Oh yes, sure. I was too impatient and haven't double checked. Sorry.


---

Comment by @mjungmath created at 2020-08-05 08:46:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-05 10:08:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-08-05 10:08:36

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-08-05 10:22:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @mjungmath created at 2020-08-05 10:23:09

This should be even better. I have shifted the try-except block. When an error is raised after this block, this must be a bug and therefore exposed as such.


---

Comment by tscrim created at 2020-08-05 11:03:59

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-08-05 11:03:59

That is the danger of putting too much stuff into a try-except block. Thank you for the quick fix. LGTM.


---

Comment by vbraun created at 2020-08-09 08:47:08

Resolution: fixed
