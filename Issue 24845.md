# Issue 24845: Fix symbolic power of matrix

archive/issues_024845.json:
```json
{
    "body": "CC:  @mforets @slel tmonteil @tscrim\n\nKeywords: matrix power, symbolic\n\nThe symbolic power of a matrix was requested and discussed in\n[Ask Sage question 25658](https://ask.sagemath.org/question/35658/general-power-of-a-matrix/),\nand implemented in #22523.\n\nThat implementation works in basic cases (diagonalizable case, two by two case, ...).\n\nAs reported in\n[Ask Sage question 41622](https://ask.sagemath.org/question/41622/bug-in-general-power-of-a-matrix)\nthough, it fails in some cases.\n\nThe reason is that the general matrix power is computed on the Jordan form of the matrix,\nbut the k-th block was placed at (k, k), which is incorrect if a Jordan block of size at least two\noccurs in any position but the last.\n\nThis ticket implements the fix suggested in an answer to Ask Sage question 41622.\n\nBefore this ticket:\n\n```\nsage: n = SR.var('n')\nsage: A = matrix(QQ, 3, [[2, 1, 0], [0, 2, 0], [0, 0, 3]]); A\nsage: B = A^n; B\n[        2^n 2^(n - 1)*n           0]\n[          0         3^n           0]\n[          0           0           0]\n```\n\nAfter this ticket:\n\n```\nsage: B = A^n; B\n[        2^n 2^(n - 1)*n           0]\n[          0         2^n           0]\n[          0           0         3^n]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25082\n\n",
    "closed_at": "2018-04-08T23:26:39Z",
    "created_at": "2018-04-02T18:00:26Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Fix symbolic power of matrix",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24845",
    "user": "https://github.com/slel"
}
```
CC:  @mforets @slel tmonteil @tscrim

Keywords: matrix power, symbolic

The symbolic power of a matrix was requested and discussed in
[Ask Sage question 25658](https://ask.sagemath.org/question/35658/general-power-of-a-matrix/),
and implemented in #22523.

That implementation works in basic cases (diagonalizable case, two by two case, ...).

As reported in
[Ask Sage question 41622](https://ask.sagemath.org/question/41622/bug-in-general-power-of-a-matrix)
though, it fails in some cases.

The reason is that the general matrix power is computed on the Jordan form of the matrix,
but the k-th block was placed at (k, k), which is incorrect if a Jordan block of size at least two
occurs in any position but the last.

This ticket implements the fix suggested in an answer to Ask Sage question 41622.

Before this ticket:

```
sage: n = SR.var('n')
sage: A = matrix(QQ, 3, [[2, 1, 0], [0, 2, 0], [0, 0, 3]]); A
sage: B = A^n; B
[        2^n 2^(n - 1)*n           0]
[          0         3^n           0]
[          0           0           0]
```

After this ticket:

```
sage: B = A^n; B
[        2^n 2^(n - 1)*n           0]
[          0         2^n           0]
[          0           0         3^n]
```


Issue created by migration from https://trac.sagemath.org/ticket/25082





---

archive/issue_comments_348562.json:
```json
{
    "body": "Cc-ing authors and reviewers of #22523.\n\nI pushed the fix from my answer at Ask Sage.",
    "created_at": "2018-04-02T18:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24845#issuecomment-348562",
    "user": "https://github.com/slel"
}
```

Cc-ing authors and reviewers of #22523.

I pushed the fix from my answer at Ask Sage.



---

archive/issue_comments_348563.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-02T18:09:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24845#issuecomment-348563",
    "user": "https://github.com/slel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_348564.json:
```json
{
    "body": "ok",
    "created_at": "2018-04-06T08:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24845#issuecomment-348564",
    "user": "https://github.com/fchapoton"
}
```

ok



---

archive/issue_comments_348565.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-06T08:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24845#issuecomment-348565",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_348566.json:
```json
{
    "body": "thanks for the fix.",
    "created_at": "2018-04-06T10:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24845#issuecomment-348566",
    "user": "https://github.com/mforets"
}
```

thanks for the fix.



---

archive/issue_events_062902.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-04-08T23:26:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/24845",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/24845#event-62902"
}
```



---

archive/issue_comments_348567.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-04-08T23:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24845",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24845#issuecomment-348567",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
