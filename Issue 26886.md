# Issue 26886: bliss automorphism_group() shouldn't sort vertices

archive/issues_026886.json:
```json
{
    "body": "CC:  @dimpase @dcoudert stumpc5\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27123\n\n",
    "created_at": "2019-01-25T13:17:15Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "bliss automorphism_group() shouldn't sort vertices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26886",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @dimpase @dcoudert stumpc5



Issue created by migration from https://trac.sagemath.org/ticket/27123





---

archive/issue_comments_377861.json:
```json
{
    "body": "I had a quick look at `PermutationGroup` (documentation is incomplete) and then at `PermutationGroup_generic`... According to the documentation, parameter `domain` must be a sorted list of integer, but in bliss `automorphism_group()` we don't ensure that vertices are integers.\n\nI agree that we should not sort vertices in bliss, but there is also something to do in `PermutationGroup**`. Why should `domain` be sorted ? Why can we call `PermutationGroup` with non-integer vertices/domain ?\n\nAn expert in `PermutationGroup` is certainly needed here.",
    "created_at": "2019-01-25T13:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377861",
    "user": "https://github.com/dcoudert"
}
```

I had a quick look at `PermutationGroup` (documentation is incomplete) and then at `PermutationGroup_generic`... According to the documentation, parameter `domain` must be a sorted list of integer, but in bliss `automorphism_group()` we don't ensure that vertices are integers.

I agree that we should not sort vertices in bliss, but there is also something to do in `PermutationGroup**`. Why should `domain` be sorted ? Why can we call `PermutationGroup` with non-integer vertices/domain ?

An expert in `PermutationGroup` is certainly needed here.



---

archive/issue_comments_377862.json:
```json
{
    "body": "Iirc, I have to relabel the vertices by 0 .. n-1 in order to do the computation. To give a bijection, I sort the vertices of the graph.\n\n> We need to revert that since vertices of graphs cannot be sorted in general. \n\nIn which sense **cannot be sorted** ? At least these are hashable objects, so these are sortable according to their hashs, aren't they?",
    "created_at": "2019-01-25T14:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377862",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Iirc, I have to relabel the vertices by 0 .. n-1 in order to do the computation. To give a bijection, I sort the vertices of the graph.

> We need to revert that since vertices of graphs cannot be sorted in general. 

In which sense **cannot be sorted** ? At least these are hashable objects, so these are sortable according to their hashs, aren't they?



---

archive/issue_comments_377863.json:
```json
{
    "body": "we cannot sort a list of objects of different types with Python3. Of course we can sort by hash, but it's better to avoid sorting whenever possible.",
    "created_at": "2019-01-25T14:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377863",
    "user": "https://github.com/dcoudert"
}
```

we cannot sort a list of objects of different types with Python3. Of course we can sort by hash, but it's better to avoid sorting whenever possible.



---

archive/issue_comments_377864.json:
```json
{
    "body": "For fixing #25426, there shouldn't be need to sort the input to `PermutationGroup_generic`. I think that something goes wrong in the translation of that group-with-unsorted-domain to an actual concrete automorphism.",
    "created_at": "2019-01-25T14:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377864",
    "user": "https://github.com/jdemeyer"
}
```

For fixing #25426, there shouldn't be need to sort the input to `PermutationGroup_generic`. I think that something goes wrong in the translation of that group-with-unsorted-domain to an actual concrete automorphism.



---

archive/issue_comments_377865.json:
```json
{
    "body": "The problem is really in the `automorphisms_of_rows_and_columns` method itself. When reverting #25426, the computed graph automorphism is correct. It's just that the conversion of that to an automorphism of the matrix goes wrong.",
    "created_at": "2019-01-25T14:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377865",
    "user": "https://github.com/jdemeyer"
}
```

The problem is really in the `automorphisms_of_rows_and_columns` method itself. When reverting #25426, the computed graph automorphism is correct. It's just that the conversion of that to an automorphism of the matrix goes wrong.



---

archive/issue_comments_377866.json:
```json
{
    "body": "Replying to [comment:3 stumpc5]:\n> In which sense **cannot be sorted** ?\n\nIn this sense:\n\n```\nPython 3.6.3 (default, Mar 13 2018, 19:00:30) \n[GCC 6.4.0] on linux\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> L = [1, \"x\"]\n>>> sorted(L)\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nTypeError: '<' not supported between instances of 'str' and 'int'\n```\n\n\n(image that you have a graph with vertices `1` and `\"x\"`)",
    "created_at": "2019-01-25T14:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377866",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 stumpc5]:
> In which sense **cannot be sorted** ?

In this sense:

```
Python 3.6.3 (default, Mar 13 2018, 19:00:30) 
[GCC 6.4.0] on linux
Type "help", "copyright", "credits" or "license" for more information.
>>> L = [1, "x"]
>>> sorted(L)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
TypeError: '<' not supported between instances of 'str' and 'int'
```


(image that you have a graph with vertices `1` and `"x"`)



---

archive/issue_comments_377867.json:
```json
{
    "body": "Replying to [comment:1 dcoudert]:\n> According to the documentation, parameter `domain` must be a sorted list of integer\n\nThat documentation is just wrong... even the examples in that file have other domains. I decided that remove that piece of documentation: having wrong documentation is worse than no documentation at all.\n----\nNew commits:",
    "created_at": "2019-01-25T14:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377867",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:1 dcoudert]:
> According to the documentation, parameter `domain` must be a sorted list of integer

That documentation is just wrong... even the examples in that file have other domains. I decided that remove that piece of documentation: having wrong documentation is worse than no documentation at all.
----
New commits:



---

archive/issue_comments_377868.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-01-25T14:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377868",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_377869.json:
```json
{
    "body": "I hope Python survives this terrible mess created by this \"clever\" idea of unsortable things (and the whole string/bytes disaster)... Somebody must have been smoking too much homotopic type theory or something...",
    "created_at": "2019-01-25T15:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377869",
    "user": "https://github.com/dimpase"
}
```

I hope Python survives this terrible mess created by this "clever" idea of unsortable things (and the whole string/bytes disaster)... Somebody must have been smoking too much homotopic type theory or something...



---

archive/issue_comments_377870.json:
```json
{
    "body": "Okay, this works as it treats the permutation as a map (instead of in 1-line notation), which does also fix the problem. I think it will end up being a little slower `automorphisms_of_rows_and_columns`, but I doubt it will practically matter. So I am setting a positive review.",
    "created_at": "2019-01-27T02:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377870",
    "user": "https://github.com/tscrim"
}
```

Okay, this works as it treats the permutation as a map (instead of in 1-line notation), which does also fix the problem. I think it will end up being a little slower `automorphisms_of_rows_and_columns`, but I doubt it will practically matter. So I am setting a positive review.



---

archive/issue_comments_377871.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-27T02:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377871",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_377872.json:
```json
{
    "body": "In matrix2 one sees\n\n```\n         B = self.as_bipartite_graph()\n         nrows = self.nrows()\n         ncols = self.ncols()\n-        parts = [list(range(1, nrows + 1)),\n-                 list(range(nrows + 1, nrows + ncols + 1))]\n-        A = B.automorphism_group(partition=parts, edge_labels=True)\n+        A = B.automorphism_group(edge_labels=True)\n```\n\n\nI don't understand why this is mathematically correct. With this change, A may end up bigger than before. E.g. imagine B being symmetric and having all entries 1, then the new way will give an extra automorphism flipping row and columns.",
    "created_at": "2019-01-27T06:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377872",
    "user": "https://github.com/dimpase"
}
```

In matrix2 one sees

```
         B = self.as_bipartite_graph()
         nrows = self.nrows()
         ncols = self.ncols()
-        parts = [list(range(1, nrows + 1)),
-                 list(range(nrows + 1, nrows + ncols + 1))]
-        A = B.automorphism_group(partition=parts, edge_labels=True)
+        A = B.automorphism_group(edge_labels=True)
```


I don't understand why this is mathematically correct. With this change, A may end up bigger than before. E.g. imagine B being symmetric and having all entries 1, then the new way will give an extra automorphism flipping row and columns.



---

archive/issue_comments_377873.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-27T06:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377873",
    "user": "https://github.com/dimpase"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_377874.json:
```json
{
    "body": "Replying to [comment:12 dimpase]:\n> then the new way will give an extra automorphism flipping row and columns.  \nNo, that's checked in the code after that:\n\n```\nif p(1) <= nrows: # Check that rows are mapped to rows\n```\n",
    "created_at": "2019-01-27T08:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377874",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 dimpase]:
> then the new way will give an extra automorphism flipping row and columns.  
No, that's checked in the code after that:

```
if p(1) <= nrows: # Check that rows are mapped to rows
```




---

archive/issue_comments_377875.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-01-27T08:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377875",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_377876.json:
```json
{
    "body": "OK, it did not cross my mind that in the original code there was a condition which was identically true :-)\n\nAll in all, this function is an example of horribly non-efficient computation - it should return an iterator, or a generating set for the group in question, not a list of permutations.",
    "created_at": "2019-01-27T09:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377876",
    "user": "https://github.com/dimpase"
}
```

OK, it did not cross my mind that in the original code there was a condition which was identically true :-)

All in all, this function is an example of horribly non-efficient computation - it should return an iterator, or a generating set for the group in question, not a list of permutations.



---

archive/issue_comments_377877.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-28T19:20:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26886",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26886#issuecomment-377877",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
