# Issue 12007: Binomial of integer (mod n) returns integer

archive/issues_012007.json:
```json
{
    "body": "Assignee: @aghitza\n\nKeywords: binomial coefficiant, modulo\n\n\n```\nsage: R = Integers(6)\nsage: binomial(R(5), R(2))\n10\nsage: binomial(R(5), R(2)).parent()\nInteger Ring\n```\n\n\nWouldn't we expect the answer to be 4 and an element of R?\n\n\nThe offending code is in the method binomial of [rings/arith.py](http://trac.sagemath.org/sage_trac/browser/sage/rings/arith.py)\nThe problem is that the code will immediately attempt to deal with the inputs as integers by x=ZZ(x) and makes no attempt to convert them back into the original ring.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12179\n\n",
    "created_at": "2011-12-18T15:34:57Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Binomial of integer (mod n) returns integer",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12007",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```
Assignee: @aghitza

Keywords: binomial coefficiant, modulo


```
sage: R = Integers(6)
sage: binomial(R(5), R(2))
10
sage: binomial(R(5), R(2)).parent()
Integer Ring
```


Wouldn't we expect the answer to be 4 and an element of R?


The offending code is in the method binomial of [rings/arith.py](http://trac.sagemath.org/sage_trac/browser/sage/rings/arith.py)
The problem is that the code will immediately attempt to deal with the inputs as integers by x=ZZ(x) and makes no attempt to convert them back into the original ring.

Issue created by migration from https://trac.sagemath.org/ticket/12179





---

archive/issue_comments_138495.json:
```json
{
    "body": "Attachment [12179.patch](tarball://root/attachments/some-uuid/ticket12179/12179.patch) by scotts created at 2011-12-20 01:27:19",
    "created_at": "2011-12-20T01:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138495",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

Attachment [12179.patch](tarball://root/attachments/some-uuid/ticket12179/12179.patch) by scotts created at 2011-12-20 01:27:19



---

archive/issue_comments_138496.json:
```json
{
    "body": "Attached patch should add this functionality with no impact on speed of standard integer/float/etc binomial calculation.",
    "created_at": "2011-12-20T01:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138496",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

Attached patch should add this functionality with no impact on speed of standard integer/float/etc binomial calculation.



---

archive/issue_comments_138497.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-12-20T01:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138497",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_138498.json:
```json
{
    "body": "Looks good to me: positive review.",
    "created_at": "2011-12-20T10:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138498",
    "user": "https://trac.sagemath.org/admin/accounts/users/cpauderis"
}
```

Looks good to me: positive review.



---

archive/issue_comments_138499.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-12-20T10:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138499",
    "user": "https://trac.sagemath.org/admin/accounts/users/cpauderis"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_138500.json:
```json
{
    "body": "Attachment [12179.2.patch](tarball://root/attachments/some-uuid/ticket12179/12179.2.patch) by scotts created at 2011-12-20 14:04:23\n\nPatch added to deal with the case where the input was a primitive python int.\n\nThanks to Colton (cpauderis) for catching that one.",
    "created_at": "2011-12-20T14:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138500",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

Attachment [12179.2.patch](tarball://root/attachments/some-uuid/ticket12179/12179.2.patch) by scotts created at 2011-12-20 14:04:23

Patch added to deal with the case where the input was a primitive python int.

Thanks to Colton (cpauderis) for catching that one.



---

archive/issue_comments_138501.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-12-21T15:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138501",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_138502.json:
```json
{
    "body": "The line\n\n```\n Test of integers modulo n:\n}}{\nshould end in two colons (for docbuilding).  Furthermore, \n{{{\n return x.parent()(binomial(ZZ(x), m, **kwds)) \n}}}\nis inefficient when computing modulo a small number n: the binomial coefficient over ZZ may be huge, whereas its reduction modulo n will be small.  It is therefore better to to the entire calculation modulo n.",
    "created_at": "2011-12-21T15:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138502",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

The line

```
 Test of integers modulo n:
}}{
should end in two colons (for docbuilding).  Furthermore, 
{{{
 return x.parent()(binomial(ZZ(x), m, **kwds)) 
}}}
is inefficient when computing modulo a small number n: the binomial coefficient over ZZ may be huge, whereas its reduction modulo n will be small.  It is therefore better to to the entire calculation modulo n.



---

archive/issue_comments_138503.json:
```json
{
    "body": "The line\n\n```\n Test of integers modulo n:\n```\n\nshould end in two colons (for docbuilding).  Furthermore, \n\n```\n return x.parent()(binomial(ZZ(x), m, **kwds)) \n```\n\nis inefficient when computing modulo a small number n: the binomial coefficient over ZZ may be huge, whereas its reduction modulo n will be small.  It is therefore better to to the entire calculation modulo n.",
    "created_at": "2011-12-21T15:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138503",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

The line

```
 Test of integers modulo n:
```

should end in two colons (for docbuilding).  Furthermore, 

```
 return x.parent()(binomial(ZZ(x), m, **kwds)) 
```

is inefficient when computing modulo a small number n: the binomial coefficient over ZZ may be huge, whereas its reduction modulo n will be small.  It is therefore better to to the entire calculation modulo n.



---

archive/issue_comments_138504.json:
```json
{
    "body": "Changing keywords from \"binomial coefficiant, modulo\" to \"binomial coefficiant, modulo sd35\".",
    "created_at": "2011-12-21T15:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138504",
    "user": "https://trac.sagemath.org/admin/accounts/users/johanbosman"
}
```

Changing keywords from "binomial coefficiant, modulo" to "binomial coefficiant, modulo sd35".



---

archive/issue_comments_138505.json:
```json
{
    "body": "Patch is incompatible with #11417, which is already merged.",
    "created_at": "2012-01-05T13:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138505",
    "user": "https://github.com/mstreng"
}
```

Patch is incompatible with #11417, which is already merged.



---

archive/issue_comments_138506.json:
```json
{
    "body": "Changing keywords from \"binomial coefficiant, modulo sd35\" to \"binomial coefficient modulo sd35\".",
    "created_at": "2012-01-05T13:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138506",
    "user": "https://github.com/mstreng"
}
```

Changing keywords from "binomial coefficiant, modulo sd35" to "binomial coefficient modulo sd35".



---

archive/issue_comments_138507.json:
```json
{
    "body": "Replying to [comment:6 johanbosman]:\n> Furthermore, \n> {{{\n>  return x.parent()(binomial(ZZ(x), m, **kwds)) \n> }}}\n> is inefficient when computing modulo a small number n: the binomial coefficient over ZZ may be huge, whereas its reduction modulo n will be small.  It is therefore better to to the entire calculation modulo n.\n\nI definitely agree, the changes I was proposing were to simply try and return a more sensible type.\n\nSince I am new to sage, I was trying to keep as much of the existing algorithm intact, so that it wouldn't have any unexpected behaviour. For example, currently it seems that sage uses Peri to calculate the usual binomial coefficient. So I wasn't sure if the implementation for modulo n would belong here.",
    "created_at": "2012-01-08T23:55:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138507",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

Replying to [comment:6 johanbosman]:
> Furthermore, 
> {{{
>  return x.parent()(binomial(ZZ(x), m, **kwds)) 
> }}}
> is inefficient when computing modulo a small number n: the binomial coefficient over ZZ may be huge, whereas its reduction modulo n will be small.  It is therefore better to to the entire calculation modulo n.

I definitely agree, the changes I was proposing were to simply try and return a more sensible type.

Since I am new to sage, I was trying to keep as much of the existing algorithm intact, so that it wouldn't have any unexpected behaviour. For example, currently it seems that sage uses Peri to calculate the usual binomial coefficient. So I wasn't sure if the implementation for modulo n would belong here.



---

archive/issue_comments_138508.json:
```json
{
    "body": "That should obviously be Pari, not Peri.",
    "created_at": "2012-01-09T00:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138508",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

That should obviously be Pari, not Peri.



---

archive/issue_comments_138509.json:
```json
{
    "body": "Replying to [comment:9 scotts]:\n> I definitely agree, the changes I was proposing were to simply try and return a more sensible type.\n> \n> Since I am new to sage, I was trying to keep as much of the existing algorithm intact, so that it wouldn't have any unexpected behaviour. For example, currently it seems that sage uses Peri to calculate the usual binomial coefficient. So I wasn't sure if the implementation for modulo n would belong here. \n\nThat sounds sensible, this is a bugfix patch and the inefficiency is not introduced by your patch. So if you don't want to, you don't have to improve the speed. However, since you're editing anyway, you might as well. It's up to you. The other issues\n \n* documentation that does not build correctly\n* a conflicting patch has already been merged\n\ndo need to be resolved though.\n\nFor the first issue, after building Sage, use `sage -docbuild reference html` to rebuild the documentation and see if all the changed documentation looks good (in this case, replacing : by :: will probably be enough).\n\nAs for the second issue, you should not write two independent patches editing the same part of a file. They can't be applied after each other, because the second-to-be-applied can't find the piece of code that it should change. You should write your patch for #12179 on top of a copy of Sage that has #11417 applied.",
    "created_at": "2012-01-09T10:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138509",
    "user": "https://github.com/mstreng"
}
```

Replying to [comment:9 scotts]:
> I definitely agree, the changes I was proposing were to simply try and return a more sensible type.
> 
> Since I am new to sage, I was trying to keep as much of the existing algorithm intact, so that it wouldn't have any unexpected behaviour. For example, currently it seems that sage uses Peri to calculate the usual binomial coefficient. So I wasn't sure if the implementation for modulo n would belong here. 

That sounds sensible, this is a bugfix patch and the inefficiency is not introduced by your patch. So if you don't want to, you don't have to improve the speed. However, since you're editing anyway, you might as well. It's up to you. The other issues
 
* documentation that does not build correctly
* a conflicting patch has already been merged

do need to be resolved though.

For the first issue, after building Sage, use `sage -docbuild reference html` to rebuild the documentation and see if all the changed documentation looks good (in this case, replacing : by :: will probably be enough).

As for the second issue, you should not write two independent patches editing the same part of a file. They can't be applied after each other, because the second-to-be-applied can't find the piece of code that it should change. You should write your patch for #12179 on top of a copy of Sage that has #11417 applied.



---

archive/issue_comments_138510.json:
```json
{
    "body": "Attachment [12179.3.patch](tarball://root/attachments/some-uuid/ticket12179/12179.3.patch) by scotts created at 2012-12-16 17:27:25",
    "created_at": "2012-12-16T17:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138510",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

Attachment [12179.3.patch](tarball://root/attachments/some-uuid/ticket12179/12179.3.patch) by scotts created at 2012-12-16 17:27:25



---

archive/issue_comments_138511.json:
```json
{
    "body": "Finally got around to reinstalling sage after a hard-drive failure. Hoping to get back on track with contributing to sage. Sorry for the incredibly slow response.\n\nHopefully this should tie up this loose end.\n\nWhile I do agree that there is room for improving the speed of calculating binomial coefficients mod N, I don't feel like it's worth bloating the binomial function with multiple extra lines of code for something which doesn't seem to be used much.\n\nPerhaps it could be added as a feature at a later stage when the need is there.\n\nHowever, I feel that this patch adequately addresses the original issue: that elements are treated as integers and returned as such, with no attempt to return them to their original class. This could potentially help with other cases.\n\nThanks for the advice with regards to the other issues.",
    "created_at": "2012-12-16T17:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138511",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

Finally got around to reinstalling sage after a hard-drive failure. Hoping to get back on track with contributing to sage. Sorry for the incredibly slow response.

Hopefully this should tie up this loose end.

While I do agree that there is room for improving the speed of calculating binomial coefficients mod N, I don't feel like it's worth bloating the binomial function with multiple extra lines of code for something which doesn't seem to be used much.

Perhaps it could be added as a feature at a later stage when the need is there.

However, I feel that this patch adequately addresses the original issue: that elements are treated as integers and returned as such, with no attempt to return them to their original class. This could potentially help with other cases.

Thanks for the advice with regards to the other issues.



---

archive/issue_comments_138512.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-16T17:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138512",
    "user": "https://trac.sagemath.org/admin/accounts/users/scotts"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_138513.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-02-04T12:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138513",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_138514.json:
```json
{
    "body": "Oops, I never got around to looking at the mathematics while reviewing your rest-formatting before. The problem is that binomial(x, y) is in general not defined for x and y integers modulo n. I'll update the ticket description appropriately.\n\nAllowing y to be anything other than an integer makes no sense to me. What would the definition be? In any case, the output has to be in the ring containing x, and will definitely depend on the exact integer y, and not just on y modulo any n. For example:\n\n```\nsage: binomial(5,-2) # bionomial(5, Zmod(2)(0)) = ???\n0\nsage: binomial(5,0)\n1\nsage: binomial(5,2)\n10\nsage: binomial(5,4) \n5\nsage: binomial(5,6)\n0\n```\n\nSummary: if y is an element of Zmod(n), then surely a `ValueError` must be raised.\n\nThe situation when x is an element of Zmod(n) is more complicated, but cannot be always automatically allowed:\n\n```\nsage: binomial(1, 3) % 3 # binomial(Zmod(3)(1), 3) = ???\n0\nsage: binomial(4, 3) % 3\n1\nsage: binomial(7, 3) % 3\n2\n```\n\nSo the correct answer to `binomial(Zmod(3)(1), 3)` is \"any integer modulo 3\". Just returning Zmod(3)(0) is wrong. It would be ok to raise an error, I'd say `ZeroDivisionError`, because of the following completely general formula:\n\n```\nsage: binomial(x, 3)\n1/6*x^3 - 1/2*x^2 + 1/3*x\n```\n\n\nThere are of course some cases that we can still allow. Suppose the input is `binomial(Zmod(n)(x), y)`.\n\n* If n is coprime to factorial(y), then all divisions are allowed, so the output should again be a well-defined element of Zmod(n). This is what happens with the code `x.parent()(prod([x-k for k in range(y)]) / factorial(y))` from the ticket description.\n* In general, we could allow the output be an element of Zmod(n / gcd(factorial(y), n)) instead of Zmod(n). This would mean no `ZeroDivisionError`s are raised, but Zmod(1)(0) is returned instead. This makes sense in the theory and practice of p-adic power series and formal groups, but may not be what the user expects, so I left this out of the new ticket description.",
    "created_at": "2013-02-04T12:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138514",
    "user": "https://github.com/mstreng"
}
```

Oops, I never got around to looking at the mathematics while reviewing your rest-formatting before. The problem is that binomial(x, y) is in general not defined for x and y integers modulo n. I'll update the ticket description appropriately.

Allowing y to be anything other than an integer makes no sense to me. What would the definition be? In any case, the output has to be in the ring containing x, and will definitely depend on the exact integer y, and not just on y modulo any n. For example:

```
sage: binomial(5,-2) # bionomial(5, Zmod(2)(0)) = ???
0
sage: binomial(5,0)
1
sage: binomial(5,2)
10
sage: binomial(5,4) 
5
sage: binomial(5,6)
0
```

Summary: if y is an element of Zmod(n), then surely a `ValueError` must be raised.

The situation when x is an element of Zmod(n) is more complicated, but cannot be always automatically allowed:

```
sage: binomial(1, 3) % 3 # binomial(Zmod(3)(1), 3) = ???
0
sage: binomial(4, 3) % 3
1
sage: binomial(7, 3) % 3
2
```

So the correct answer to `binomial(Zmod(3)(1), 3)` is "any integer modulo 3". Just returning Zmod(3)(0) is wrong. It would be ok to raise an error, I'd say `ZeroDivisionError`, because of the following completely general formula:

```
sage: binomial(x, 3)
1/6*x^3 - 1/2*x^2 + 1/3*x
```


There are of course some cases that we can still allow. Suppose the input is `binomial(Zmod(n)(x), y)`.

* If n is coprime to factorial(y), then all divisions are allowed, so the output should again be a well-defined element of Zmod(n). This is what happens with the code `x.parent()(prod([x-k for k in range(y)]) / factorial(y))` from the ticket description.
* In general, we could allow the output be an element of Zmod(n / gcd(factorial(y), n)) instead of Zmod(n). This would mean no `ZeroDivisionError`s are raised, but Zmod(1)(0) is returned instead. This makes sense in the theory and practice of p-adic power series and formal groups, but may not be what the user expects, so I left this out of the new ticket description.



---

archive/issue_comments_138515.json:
```json
{
    "body": "Replying to [comment:13 mstreng]:\n> Summary: if y is an element of Zmod(n), then surely a `ValueError` must be raised.\n\nno, wait, I meant `TypeError`",
    "created_at": "2013-02-04T12:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138515",
    "user": "https://github.com/mstreng"
}
```

Replying to [comment:13 mstreng]:
> Summary: if y is an element of Zmod(n), then surely a `ValueError` must be raised.

no, wait, I meant `TypeError`



---

archive/issue_comments_138516.json:
```json
{
    "body": "apply only 12179_new.patch",
    "created_at": "2013-07-25T14:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138516",
    "user": "https://github.com/mstreng"
}
```

apply only 12179_new.patch



---

archive/issue_comments_138517.json:
```json
{
    "body": "Attachment [12179_new.patch](tarball://root/attachments/some-uuid/ticket12179/12179_new.patch) by @mstreng created at 2013-07-25 14:51:59",
    "created_at": "2013-07-25T14:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138517",
    "user": "https://github.com/mstreng"
}
```

Attachment [12179_new.patch](tarball://root/attachments/some-uuid/ticket12179/12179_new.patch) by @mstreng created at 2013-07-25 14:51:59



---

archive/issue_comments_138518.json:
```json
{
    "body": "New version, but it screws up lots of symbolic things. Perhaps a few special cases, like binomial(n, n) always returning 1, will fix this. I'm done with this for now.",
    "created_at": "2013-07-25T16:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138518",
    "user": "https://github.com/mstreng"
}
```

New version, but it screws up lots of symbolic things. Perhaps a few special cases, like binomial(n, n) always returning 1, will fix this. I'm done with this for now.



---

archive/issue_comments_138519.json:
```json
{
    "body": "Replying to [comment:13 mstreng]:\n> So the correct answer to `binomial(Zmod(3)(1), 3)` is \"any integer modulo 3\". Just returning Zmod(3)(0) is wrong. It would be ok to raise an error, I'd say `ZeroDivisionError`\nPari does this too.\n> There are of course some cases that we can still allow. Suppose the input is `binomial(Zmod(n)(x), y)`.\nExample with Pari:\n\n```\n? binomial(Mod(7,11),3)\n%3 = Mod(2, 11)\n```\n",
    "created_at": "2014-08-11T16:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138519",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:13 mstreng]:
> So the correct answer to `binomial(Zmod(3)(1), 3)` is "any integer modulo 3". Just returning Zmod(3)(0) is wrong. It would be ok to raise an error, I'd say `ZeroDivisionError`
Pari does this too.
> There are of course some cases that we can still allow. Suppose the input is `binomial(Zmod(n)(x), y)`.
Example with Pari:

```
? binomial(Mod(7,11),3)
%3 = Mod(2, 11)
```




---

archive/issue_comments_138520.json:
```json
{
    "body": "Hello,\n\nI just discover this ticket. During a cleanup in `sage.rings.arith` (#17852) I took care of this case. I propose to close this one as duplicate. With the branch applied we got\n\n```\nsage: from sage.rings.arith import binomial\nsage: R = Integers(6)\nsage: binomial(R(5), R(2))\nTraceback (most recent call last):\n...\nZeroDivisionError: Inverse does not exist.\nsage: R = Integers(21)\nsage: binomial(R(5), R(2))\n10\nsage: binomial(R(5), R(2)).parent()\nRing of integers modulo 21\n```\n\n\nVincent",
    "created_at": "2015-03-15T13:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138520",
    "user": "https://github.com/videlec"
}
```

Hello,

I just discover this ticket. During a cleanup in `sage.rings.arith` (#17852) I took care of this case. I propose to close this one as duplicate. With the branch applied we got

```
sage: from sage.rings.arith import binomial
sage: R = Integers(6)
sage: binomial(R(5), R(2))
Traceback (most recent call last):
...
ZeroDivisionError: Inverse does not exist.
sage: R = Integers(21)
sage: binomial(R(5), R(2))
10
sage: binomial(R(5), R(2)).parent()
Ring of integers modulo 21
```


Vincent



---

archive/issue_comments_138521.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-15T13:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138521",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_138522.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-16T11:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138522",
    "user": "https://github.com/mstreng"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_138523.json:
```json
{
    "body": "Replying to [comment:23 vdelecroix]:\n> sage: R = Integers(21)\n> sage: binomial(R(5), R(2))\n> 10\n\nThis should be `TypeError`, because `binomial(x,y)` makes no sense when y is an element of `R`. It only makes sense when y is an integer. For example, binomial(5, 2) = 10, but binomial(5, 2+21) = 0.\n\nSo of the two points in the ticket description, the work in #17852 fixes the second one, but the first one is still open.",
    "created_at": "2015-03-16T11:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138523",
    "user": "https://github.com/mstreng"
}
```

Replying to [comment:23 vdelecroix]:
> sage: R = Integers(21)
> sage: binomial(R(5), R(2))
> 10

This should be `TypeError`, because `binomial(x,y)` makes no sense when y is an element of `R`. It only makes sense when y is an integer. For example, binomial(5, 2) = 10, but binomial(5, 2+21) = 0.

So of the two points in the ticket description, the work in #17852 fixes the second one, but the first one is still open.



---

archive/issue_comments_138524.json:
```json
{
    "body": "Replying to [comment:24 mstreng]:\n> Replying to [comment:23 vdelecroix]:\n> > sage: R = Integers(21)\n> > sage: binomial(R(5), R(2))\n> > 10\n> \n> This should be `TypeError`, because `binomial(x,y)` makes no sense when y is an element of `R`. It only makes sense when y is an integer. For example, binomial(5, 2) = 10, but binomial(5, 2+21) = 0.\n> \n> So of the two points in the ticket description, the work in #17852 fixes the second one, but the first one is still open.\n\nRight!",
    "created_at": "2015-03-16T12:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138524",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:24 mstreng]:
> Replying to [comment:23 vdelecroix]:
> > sage: R = Integers(21)
> > sage: binomial(R(5), R(2))
> > 10
> 
> This should be `TypeError`, because `binomial(x,y)` makes no sense when y is an element of `R`. It only makes sense when y is an integer. For example, binomial(5, 2) = 10, but binomial(5, 2+21) = 0.
> 
> So of the two points in the ticket description, the work in #17852 fixes the second one, but the first one is still open.

Right!



---

archive/issue_comments_138525.json:
```json
{
    "body": "Hi,\n\nTicket #17852 is in pass to be positively reviewed. Let me summarize what will change when calling `rings.arith.binomial(x,y)`:\n- `y` must be an integer (actually, I only asked that `ZZ(y)` does work and the first lines of code do `y = ZZ(y)`)\n- the output type is always the type of `x`\n- if `factorial(y)` is not invertible a `ZeroDivisionError` is raised (I checked the behavior on many finite rings that I was able to think of)\n\nVincent",
    "created_at": "2015-03-21T23:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12007",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12007#issuecomment-138525",
    "user": "https://github.com/videlec"
}
```

Hi,

Ticket #17852 is in pass to be positively reviewed. Let me summarize what will change when calling `rings.arith.binomial(x,y)`:
- `y` must be an integer (actually, I only asked that `ZZ(y)` does work and the first lines of code do `y = ZZ(y)`)
- the output type is always the type of `x`
- if `factorial(y)` is not invertible a `ZeroDivisionError` is raised (I checked the behavior on many finite rings that I was able to think of)

Vincent
