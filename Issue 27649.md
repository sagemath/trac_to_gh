# Issue 27649: Misc pip upgrades again

archive/issues_027649.json:
```json
{
    "body": "CC:  slelievre vbraun embray jdemeyer fbissey\n\nsimilar to #26969\n\nWhat could be updated:\n\n```\nBabel                        2.6.0      2.7.0    wheel\nbackports.ssl-match-hostname 3.5.0.1    3.7.0.1  sdist\nbleach                       3.0.2      3.1.0    wheel\ncertifi                      2018.11.29 2019.3.9 wheel\nconfigparser                 3.5.0      3.7.4    wheel\ncvxopt                       1.1.8      1.2.3    wheel\ncypari2                      2.1.0      2.1.1    sdist\nCython                       0.29.5     0.29.8   wheel\ndecorator                    4.3.0      4.4.0    wheel\ndefusedxml                   0.5.0      0.6.0    wheel\nentrypoints                  0.2.3      0.3      wheel\nFlask                        0.10.1     1.0.3    wheel\nFlask-AutoIndex              0.6        0.6.2    sdist\nFlask-Babel                  0.9        0.12.2   sdist\nipykernel                    4.8.2      5.1.1    wheel\nipython                      5.8.0      7.5.0    wheel\nJinja2                       2.10       2.10.1   wheel\njsonschema                   2.6.0      3.0.1    wheel\nkiwisolver                   1.0.1      1.1.0    wheel\nMarkupSafe                   1.1.0      1.1.1    wheel\nmatplotlib                   2.2.3      3.1.0    wheel\nnbconvert                    5.4.0      5.5.0    wheel\nnetworkx                     2.2        2.3      sdist\nnotebook                     5.7.6      5.7.8    wheel\nnumpy                        1.16.1     1.16.3   wheel\npackaging                    18.0       19.0     wheel\npath.py                      7.1        12.0.1   wheel\npexpect                      4.6.0      4.7.0    wheel\nPillow                       5.3.0      6.0.0    wheel\npip                          18.1       19.1.1   wheel\npkgconfig                    1.4.0      1.5.1    wheel\nprometheus-client            0.5.0      0.6.0    sdist\nprompt-toolkit               1.0.15     2.0.9    wheel\npsutil                       5.2.0      5.6.2    sdist\nptyprocess                   0.5.1      0.6.0    wheel\nPygments                     2.3.1      2.4.2    wheel\npyparsing                    2.3.0      2.4.0    wheel\npython-dateutil              2.5.3      2.8.0    wheel\npytz                         2018.7     2019.1   wheel\npyzmq                        17.1.2     18.0.1   wheel\nrequests                     2.13.0     2.22.0   wheel\nrpy2                         2.8.2      3.0.4    sdist\nscandir                      1.9.0      1.10.0   sdist\nscipy                        1.2.0      1.3.0    wheel\nsetuptools                   40.6.3     41.0.1   wheel\nsetuptools-scm               3.1.0      3.3.3    wheel\nSphinx                       1.8.5      2.0.1    wheel\nsphinxcontrib-websupport     1.1.0      1.1.2    wheel\nterminado                    0.8.1      0.8.2    wheel\ntornado                      4.5.2      6.0.2    sdist\nTwisted                      16.3.0     19.2.0   sdist\nWerkzeug                     0.14.1     0.15.4   wheel\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27886\n\n",
    "created_at": "2019-05-28T18:41:50Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Misc pip upgrades again",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27649",
    "user": "chapoton"
}
```
CC:  slelievre vbraun embray jdemeyer fbissey

similar to #26969

What could be updated:

```
Babel                        2.6.0      2.7.0    wheel
backports.ssl-match-hostname 3.5.0.1    3.7.0.1  sdist
bleach                       3.0.2      3.1.0    wheel
certifi                      2018.11.29 2019.3.9 wheel
configparser                 3.5.0      3.7.4    wheel
cvxopt                       1.1.8      1.2.3    wheel
cypari2                      2.1.0      2.1.1    sdist
Cython                       0.29.5     0.29.8   wheel
decorator                    4.3.0      4.4.0    wheel
defusedxml                   0.5.0      0.6.0    wheel
entrypoints                  0.2.3      0.3      wheel
Flask                        0.10.1     1.0.3    wheel
Flask-AutoIndex              0.6        0.6.2    sdist
Flask-Babel                  0.9        0.12.2   sdist
ipykernel                    4.8.2      5.1.1    wheel
ipython                      5.8.0      7.5.0    wheel
Jinja2                       2.10       2.10.1   wheel
jsonschema                   2.6.0      3.0.1    wheel
kiwisolver                   1.0.1      1.1.0    wheel
MarkupSafe                   1.1.0      1.1.1    wheel
matplotlib                   2.2.3      3.1.0    wheel
nbconvert                    5.4.0      5.5.0    wheel
networkx                     2.2        2.3      sdist
notebook                     5.7.6      5.7.8    wheel
numpy                        1.16.1     1.16.3   wheel
packaging                    18.0       19.0     wheel
path.py                      7.1        12.0.1   wheel
pexpect                      4.6.0      4.7.0    wheel
Pillow                       5.3.0      6.0.0    wheel
pip                          18.1       19.1.1   wheel
pkgconfig                    1.4.0      1.5.1    wheel
prometheus-client            0.5.0      0.6.0    sdist
prompt-toolkit               1.0.15     2.0.9    wheel
psutil                       5.2.0      5.6.2    sdist
ptyprocess                   0.5.1      0.6.0    wheel
Pygments                     2.3.1      2.4.2    wheel
pyparsing                    2.3.0      2.4.0    wheel
python-dateutil              2.5.3      2.8.0    wheel
pytz                         2018.7     2019.1   wheel
pyzmq                        17.1.2     18.0.1   wheel
requests                     2.13.0     2.22.0   wheel
rpy2                         2.8.2      3.0.4    sdist
scandir                      1.9.0      1.10.0   sdist
scipy                        1.2.0      1.3.0    wheel
setuptools                   40.6.3     41.0.1   wheel
setuptools-scm               3.1.0      3.3.3    wheel
Sphinx                       1.8.5      2.0.1    wheel
sphinxcontrib-websupport     1.1.0      1.1.2    wheel
terminado                    0.8.1      0.8.2    wheel
tornado                      4.5.2      6.0.2    sdist
Twisted                      16.3.0     19.2.0   sdist
Werkzeug                     0.14.1     0.15.4   wheel
```


Issue created by migration from https://trac.sagemath.org/ticket/27886





---

archive/issue_comments_390413.json:
```json
{
    "body": "Some of these are only for Python 3: `ipython`, `ipykernel`, `matplotlib`, `Sphinx`, `rpy2` (?), possibly others. In some cases (`matplotlib`, `rpy2`) we may be able to upgrade one or two minor versions and still maintain compatibility with Python 2, but we can't upgrade to the latest version yet.",
    "created_at": "2019-05-28T20:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390413",
    "user": "jhpalmieri"
}
```

Some of these are only for Python 3: `ipython`, `ipykernel`, `matplotlib`, `Sphinx`, `rpy2` (?), possibly others. In some cases (`matplotlib`, `rpy2`) we may be able to upgrade one or two minor versions and still maintain compatibility with Python 2, but we can't upgrade to the latest version yet.



---

archive/issue_comments_390414.json:
```json
{
    "body": "To take into account py2 / py3, upgrade this:\n\n```\npackage upstream             version    latest   wheel  py3     spkg name in Sage\nofficial name                in Sage    py2-ok   sdist  only    if different\n-------------------------------------------------------------------------------\nBabel                        2.6.0      2.7.0    wheel          babel\nbackports.ssl-match-hostname 3.5.0.1    3.7.0.1  sdist          backports_ssl_match_hostname\nbleach                       3.0.2      3.1.0    wheel\ncertifi                      2018.11.29 2019.3.9 wheel\nconfigparser                 3.5.0      3.7.4    wheel\ncvxopt                       1.1.8      1.2.3    wheel\ncypari2                      2.1.0      2.1.1    sdist\nCython                       0.29.5     0.29.8   wheel          cython\ndecorator                    4.3.0      4.4.0    wheel\ndefusedxml                   0.5.0      0.6.0    wheel\nentrypoints                  0.2.3      0.3      wheel\nFlask                        0.10.1     1.0.3    wheel          flask\nFlask-AutoIndex              0.6        0.6.2    sdist          flask_autoindex\nFlask-Babel                  0.9        0.12.2   sdist          flask_babel\nipykernel                    4.8.2      4.10.0   wheel  5+\nJinja2                       2.10       2.10.1   wheel          jinja2\njsonschema                   2.6.0      3.0.1    wheel\nkiwisolver                   1.0.1      1.1.0    wheel\nMarkupSafe                   1.1.0      1.1.1    wheel          markupsafe\nnbconvert                    5.4.0      5.5.0    wheel\nnetworkx                     2.2        2.3      sdist\nnotebook                     5.7.6      5.7.8    wheel\nnumpy                        1.16.1     1.16.3   wheel\npackaging                    18.0       19.0     wheel\npath.py                      7.1        11.5.2   wheel  12+     pathpy\npexpect                      4.6.0      4.7.0    wheel\nPillow                       5.3.0      6.0.0    wheel          pillow\npip                          18.1       19.1.1   wheel\npkgconfig                    1.4.0      1.5.1    wheel\nprometheus-client            0.5.0      0.6.0    sdist          prometheus_client\nprompt-toolkit               1.0.15     2.0.9    wheel          prompt_toolkit\npsutil                       5.2.0      5.6.2    sdist\nptyprocess                   0.5.1      0.6.0    wheel\nPygments                     2.3.1      2.4.2    wheel          pygments\npyparsing                    2.3.0      2.4.0    wheel\npython-dateutil              2.5.3      2.8.0    wheel          dateutil\npytz                         2018.7     2019.1   wheel\npyzmq                        17.1.2     18.0.1   wheel\nrequests                     2.13.0     2.22.0   wheel\nrpy2                         2.8.2      2.8.6    sdist  2.9+\nscandir                      1.9.0      1.10.0   sdist\nscipy                        1.2.0      1.2.1    wheel  1.3+\nsetuptools                   40.6.3     41.0.1   wheel\nsetuptools-scm               3.1.0      3.3.3    wheel          setuptools_scm\nsphinxcontrib-websupport     1.1.0      1.1.2    wheel          sphinxcontrib_websupport\nterminado                    0.8.1      0.8.2    wheel\ntornado                      4.5.2      5.1.1    sdist  6+\nTwisted                      16.3.0     19.2.0   sdist          twisted\nWerkzeug                     0.14.1     0.15.4   wheel          werkzeug\n```\n\n\nCannot upgrade this until we drop Python 2:\n\n```\nipython                      5.8.0      5.8.0    wheel  6+\nmatplotlib                   2.2.3      2.2.3    wheel  3+\nSphinx                       1.8.5      1.8.5    wheel  2+     sphinx\n```\n\n\nAdditional possible PyPI upgrades:\n\n```\nreadline 6.3.008.p0 --> gnureadline 6.3.8\npyx 0.12.1.p0 --> 0.14.1\nscons 1.2.0 --> 3.0.5\n```\n",
    "created_at": "2019-05-28T22:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390414",
    "user": "slelievre"
}
```

To take into account py2 / py3, upgrade this:

```
package upstream             version    latest   wheel  py3     spkg name in Sage
official name                in Sage    py2-ok   sdist  only    if different
-------------------------------------------------------------------------------
Babel                        2.6.0      2.7.0    wheel          babel
backports.ssl-match-hostname 3.5.0.1    3.7.0.1  sdist          backports_ssl_match_hostname
bleach                       3.0.2      3.1.0    wheel
certifi                      2018.11.29 2019.3.9 wheel
configparser                 3.5.0      3.7.4    wheel
cvxopt                       1.1.8      1.2.3    wheel
cypari2                      2.1.0      2.1.1    sdist
Cython                       0.29.5     0.29.8   wheel          cython
decorator                    4.3.0      4.4.0    wheel
defusedxml                   0.5.0      0.6.0    wheel
entrypoints                  0.2.3      0.3      wheel
Flask                        0.10.1     1.0.3    wheel          flask
Flask-AutoIndex              0.6        0.6.2    sdist          flask_autoindex
Flask-Babel                  0.9        0.12.2   sdist          flask_babel
ipykernel                    4.8.2      4.10.0   wheel  5+
Jinja2                       2.10       2.10.1   wheel          jinja2
jsonschema                   2.6.0      3.0.1    wheel
kiwisolver                   1.0.1      1.1.0    wheel
MarkupSafe                   1.1.0      1.1.1    wheel          markupsafe
nbconvert                    5.4.0      5.5.0    wheel
networkx                     2.2        2.3      sdist
notebook                     5.7.6      5.7.8    wheel
numpy                        1.16.1     1.16.3   wheel
packaging                    18.0       19.0     wheel
path.py                      7.1        11.5.2   wheel  12+     pathpy
pexpect                      4.6.0      4.7.0    wheel
Pillow                       5.3.0      6.0.0    wheel          pillow
pip                          18.1       19.1.1   wheel
pkgconfig                    1.4.0      1.5.1    wheel
prometheus-client            0.5.0      0.6.0    sdist          prometheus_client
prompt-toolkit               1.0.15     2.0.9    wheel          prompt_toolkit
psutil                       5.2.0      5.6.2    sdist
ptyprocess                   0.5.1      0.6.0    wheel
Pygments                     2.3.1      2.4.2    wheel          pygments
pyparsing                    2.3.0      2.4.0    wheel
python-dateutil              2.5.3      2.8.0    wheel          dateutil
pytz                         2018.7     2019.1   wheel
pyzmq                        17.1.2     18.0.1   wheel
requests                     2.13.0     2.22.0   wheel
rpy2                         2.8.2      2.8.6    sdist  2.9+
scandir                      1.9.0      1.10.0   sdist
scipy                        1.2.0      1.2.1    wheel  1.3+
setuptools                   40.6.3     41.0.1   wheel
setuptools-scm               3.1.0      3.3.3    wheel          setuptools_scm
sphinxcontrib-websupport     1.1.0      1.1.2    wheel          sphinxcontrib_websupport
terminado                    0.8.1      0.8.2    wheel
tornado                      4.5.2      5.1.1    sdist  6+
Twisted                      16.3.0     19.2.0   sdist          twisted
Werkzeug                     0.14.1     0.15.4   wheel          werkzeug
```


Cannot upgrade this until we drop Python 2:

```
ipython                      5.8.0      5.8.0    wheel  6+
matplotlib                   2.2.3      2.2.3    wheel  3+
Sphinx                       1.8.5      1.8.5    wheel  2+     sphinx
```


Additional possible PyPI upgrades:

```
readline 6.3.008.p0 --> gnureadline 6.3.8
pyx 0.12.1.p0 --> 0.14.1
scons 1.2.0 --> 3.0.5
```




---

archive/issue_comments_390415.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2019-05-28T22:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390415",
    "user": "slelievre"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_390416.json:
```json
{
    "body": "It looks to me as though matplotlib 2.2.4 would be okay for Python 2, but nothing beyond that.",
    "created_at": "2019-05-28T22:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390416",
    "user": "jhpalmieri"
}
```

It looks to me as though matplotlib 2.2.4 would be okay for Python 2, but nothing beyond that.



---

archive/issue_comments_390417.json:
```json
{
    "body": "Replying to [comment:4 jhpalmieri]:\n> It looks to me as though matplotlib 2.2.4 would be okay for Python 2, but nothing beyond that.\n\nUsing it in sage-on-gentoo.",
    "created_at": "2019-05-28T23:19:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390417",
    "user": "fbissey"
}
```

Replying to [comment:4 jhpalmieri]:
> It looks to me as though matplotlib 2.2.4 would be okay for Python 2, but nothing beyond that.

Using it in sage-on-gentoo.



---

archive/issue_comments_390418.json:
```json
{
    "body": "as in #26969, we may need to exclude \"ptyprocess\" and \"tornado\"\n\nVolker, do you have an easy way to do this kind of batch upgrade, as you did it before ?",
    "created_at": "2019-05-31T13:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390418",
    "user": "chapoton"
}
```

as in #26969, we may need to exclude "ptyprocess" and "tornado"

Volker, do you have an easy way to do this kind of batch upgrade, as you did it before ?



---

archive/issue_comments_390419.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-06-05T10:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390419",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_390420.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-07T07:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390420",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_390421.json:
```json
{
    "body": "ok, maybe this is a good first step. Includes an update of cython.",
    "created_at": "2019-06-07T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390421",
    "user": "chapoton"
}
```

ok, maybe this is a good first step. Includes an update of cython.



---

archive/issue_comments_390422.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-07T07:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390422",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_390423.json:
```json
{
    "body": "cypari does not build. Should I add back the cython trashcan patch ?",
    "created_at": "2019-06-07T07:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390423",
    "user": "chapoton"
}
```

cypari does not build. Should I add back the cython trashcan patch ?



---

archive/issue_comments_390424.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-06-07T07:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390424",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_390425.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-07T08:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390425",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_390426.json:
```json
{
    "body": "ok, I have added back the cython patch. Back to needs review.",
    "created_at": "2019-06-07T08:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390426",
    "user": "chapoton"
}
```

ok, I have added back the cython patch. Back to needs review.



---

archive/issue_comments_390427.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-07T08:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390427",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_390428.json:
```json
{
    "body": "Updating the ticket description to reflect the actual changes.",
    "created_at": "2019-06-07T08:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390428",
    "user": "slelievre"
}
```

Updating the ticket description to reflect the actual changes.



---

archive/issue_comments_390429.json:
```json
{
    "body": "Changing keywords from \"\" to \"upgrade, cython\".",
    "created_at": "2019-06-07T08:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390429",
    "user": "slelievre"
}
```

Changing keywords from "" to "upgrade, cython".



---

archive/issue_comments_390430.json:
```json
{
    "body": "Works for me on OS X, both Python 2 and 3. Others should try on other platforms.\n\nUnfortunately it doesn't fix the Python 3 doctest failure in `cpython`.",
    "created_at": "2019-06-07T20:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390430",
    "user": "jhpalmieri"
}
```

Works for me on OS X, both Python 2 and 3. Others should try on other platforms.

Unfortunately it doesn't fix the Python 3 doctest failure in `cpython`.



---

archive/issue_comments_390431.json:
```json
{
    "body": "Which failure remains in the cpython folder under python3 ? Both of these :\n\n```\n\u2523 debug.pyx  # 1\n\u2517 dict_del_by_value.pyx  # 2\n```\n\nor just one ? The upgrade is supposed only to fix the second file. For the first one, see #27964",
    "created_at": "2019-06-10T16:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390431",
    "user": "chapoton"
}
```

Which failure remains in the cpython folder under python3 ? Both of these :

```
┣ debug.pyx  # 1
┗ dict_del_by_value.pyx  # 2
```

or just one ? The upgrade is supposed only to fix the second file. For the first one, see #27964



---

archive/issue_comments_390432.json:
```json
{
    "body": "I still get both failures. I'll try `make distclean` and then rebuild to see if that helps.",
    "created_at": "2019-06-10T18:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390432",
    "user": "jhpalmieri"
}
```

I still get both failures. I'll try `make distclean` and then rebuild to see if that helps.



---

archive/issue_comments_390433.json:
```json
{
    "body": "After `make distclean`, same result: both files have failures.",
    "created_at": "2019-06-10T19:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390433",
    "user": "jhpalmieri"
}
```

After `make distclean`, same result: both files have failures.



---

archive/issue_comments_390434.json:
```json
{
    "body": "And Jeroen, who knows about cython and prevented me to fix that in a naive way, seems not to be very active here at the moment.",
    "created_at": "2019-06-10T19:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390434",
    "user": "chapoton"
}
```

And Jeroen, who knows about cython and prevented me to fix that in a naive way, seems not to be very active here at the moment.



---

archive/issue_comments_390435.json:
```json
{
    "body": "I see:\n\n```\ntest_del_dictitem_by_exact_value(D, ZZ, 2)\n```\n\nfails, but\n\n```\ntest_del_dictitem_by_exact_value(D, ZZ, int(2))\n```\n\nworks. What was your naive fix? I would be tempted to use\n\n```\ntest_del_dictitem_by_exact_value(D, ZZ, hash(2))\n```\n\nThis is more robust, since it works in this kind of case:\n\n```\nsage: D = {1230981308409180310928308123: ZZ}\nsage: test_del_dictitem_by_exact_value(D, ZZ, hash(1230981308409180310928308123))\n```\n\nwhile\n\n```\nsage: D = {1230981308409180310928308123: ZZ}\nsage: test_del_dictitem_by_exact_value(D, ZZ, 1230981308409180310928308123)\n```\n\nfails with both Python 2 and 3. The current doctest relies on the fact that the hash of the Sage integer 2 is equal to 2, and this doesn't generalize to integers that are too large.",
    "created_at": "2019-06-10T20:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390435",
    "user": "jhpalmieri"
}
```

I see:

```
test_del_dictitem_by_exact_value(D, ZZ, 2)
```

fails, but

```
test_del_dictitem_by_exact_value(D, ZZ, int(2))
```

works. What was your naive fix? I would be tempted to use

```
test_del_dictitem_by_exact_value(D, ZZ, hash(2))
```

This is more robust, since it works in this kind of case:

```
sage: D = {1230981308409180310928308123: ZZ}
sage: test_del_dictitem_by_exact_value(D, ZZ, hash(1230981308409180310928308123))
```

while

```
sage: D = {1230981308409180310928308123: ZZ}
sage: test_del_dictitem_by_exact_value(D, ZZ, 1230981308409180310928308123)
```

fails with both Python 2 and 3. The current doctest relies on the fact that the hash of the Sage integer 2 is equal to 2, and this doesn't generalize to integers that are too large.



---

archive/issue_comments_390436.json:
```json
{
    "body": "ok, I will do that in another ticket, thanks for the suggestion.\n\nsee #27972",
    "created_at": "2019-06-12T07:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390436",
    "user": "chapoton"
}
```

ok, I will do that in another ticket, thanks for the suggestion.

see #27972



---

archive/issue_comments_390437.json:
```json
{
    "body": "The `test_del_dictitem_by_exact_value` failure is fixed upstream at https://github.com/cython/cython/commit/28251032f86c266065e4976080230481b1a1bb29\n\nI suggest to just apply that patch instead of \"fixing\" the doctest.",
    "created_at": "2019-06-12T09:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390437",
    "user": "jdemeyer"
}
```

The `test_del_dictitem_by_exact_value` failure is fixed upstream at https://github.com/cython/cython/commit/28251032f86c266065e4976080230481b1a1bb29

I suggest to just apply that patch instead of "fixing" the doctest.



---

archive/issue_comments_390438.json:
```json
{
    "body": "But this is supposed to be in cython 0.29.3 ??\n\n6 months ago, in #26855 you said : Fixed upstream, but not in a stable release",
    "created_at": "2019-06-12T11:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390438",
    "user": "chapoton"
}
```

But this is supposed to be in cython 0.29.3 ??

6 months ago, in #26855 you said : Fixed upstream, but not in a stable release



---

archive/issue_comments_390439.json:
```json
{
    "body": "It's not fixed in a Cython bugfix release it seems, but only in the next major release.",
    "created_at": "2019-06-12T12:15:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390439",
    "user": "jdemeyer"
}
```

It's not fixed in a Cython bugfix release it seems, but only in the next major release.



---

archive/issue_comments_390440.json:
```json
{
    "body": "...or maybe it was meant to be fixed in 0.29.x but forgotten.",
    "created_at": "2019-06-12T12:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390440",
    "user": "jdemeyer"
}
```

...or maybe it was meant to be fixed in 0.29.x but forgotten.



---

archive/issue_comments_390441.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-12T12:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390441",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_390442.json:
```json
{
    "body": "This change does fix the py3 doctest failures in `cpython/dict_del_by_value.pyx`. I was hoping it would fix some of the doctests in integer.pyx, but it doesn't seem to have done that.",
    "created_at": "2019-06-12T15:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390442",
    "user": "jhpalmieri"
}
```

This change does fix the py3 doctest failures in `cpython/dict_del_by_value.pyx`. I was hoping it would fix some of the doctests in integer.pyx, but it doesn't seem to have done that.



---

archive/issue_comments_390443.json:
```json
{
    "body": "Let's merge this into an early 8.9 beta.",
    "created_at": "2019-06-18T04:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390443",
    "user": "jhpalmieri"
}
```

Let's merge this into an early 8.9 beta.



---

archive/issue_comments_390444.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-18T04:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390444",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_390445.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-27T20:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27649#issuecomment-390445",
    "user": "vbraun"
}
```

Resolution: fixed
