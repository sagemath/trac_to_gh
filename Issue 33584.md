# Issue 33584: Remove use of SAGE_LIB in sage.misc

archive/issues_033584.json:
```json
{
    "body": "CC:  @kiwifb @antonio-rojas @tornaria\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33821\n\n",
    "created_at": "2022-05-08T03:39:41Z",
    "labels": [
        "refactoring",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Remove use of SAGE_LIB in sage.misc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33584",
    "user": "@mkoeppe"
}
```
CC:  @kiwifb @antonio-rojas @tornaria



Issue created by migration from https://trac.sagemath.org/ticket/33821





---

archive/issue_comments_478019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-08T04:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478019",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478020.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-08T04:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478020",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_478021.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-08T18:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478021",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478022.json:
```json
{
    "body": "The failure in \"Build&Test\" is in `sage -t --random-seed=54174803604868423169944467131116599504 sage/parallel/map_reduce.py `, unrelated.",
    "created_at": "2022-05-09T17:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478022",
    "user": "@mkoeppe"
}
```

The failure in "Build&Test" is in `sage -t --random-seed=54174803604868423169944467131116599504 sage/parallel/map_reduce.py `, unrelated.



---

archive/issue_comments_478023.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-10T05:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478023",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478024.json:
```json
{
    "body": "You have a repeated block\n\n```\n+                def directories():\n+                    try:\n+                        from sage.env import SAGE_SRC\n+                    except ImportError:\n+                        pass\n+                    else:\n+                        if SAGE_SRC:\n+                            yield normpath(os.path.join(SAGE_SRC, 'sage'))\n+                    import sage\n+                    yield from sage.__path__\n+\n+                for directory in directories():\n+                    if commonprefix([filename, directory]) == directory:\n+                        filename = os.path.join('sage', relpath(filename, directory))\n+                        break\n```\n\nIf it ends up being useful in more than two files, should it be factored somewhere?",
    "created_at": "2022-06-12T21:10:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478024",
    "user": "@kiwifb"
}
```

You have a repeated block

```
+                def directories():
+                    try:
+                        from sage.env import SAGE_SRC
+                    except ImportError:
+                        pass
+                    else:
+                        if SAGE_SRC:
+                            yield normpath(os.path.join(SAGE_SRC, 'sage'))
+                    import sage
+                    yield from sage.__path__
+
+                for directory in directories():
+                    if commonprefix([filename, directory]) == directory:
+                        filename = os.path.join('sage', relpath(filename, directory))
+                        break
```

If it ends up being useful in more than two files, should it be factored somewhere?



---

archive/issue_comments_478025.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-25T22:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478025",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_478026.json:
```json
{
    "body": "Good suggestion, done now",
    "created_at": "2022-06-25T22:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478026",
    "user": "@mkoeppe"
}
```

Good suggestion, done now



---

archive/issue_comments_478027.json:
```json
{
    "body": "LGTM, let's ship it.",
    "created_at": "2022-06-25T23:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478027",
    "user": "@kiwifb"
}
```

LGTM, let's ship it.



---

archive/issue_comments_478028.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-25T23:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478028",
    "user": "@kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_478029.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-06-25T23:13:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478029",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_478030.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-03T22:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33584#issuecomment-478030",
    "user": "@vbraun"
}
```

Resolution: fixed
