# Issue 33584: Remove use of SAGE_LIB in sage.misc

Issue created by migration from https://trac.sagemath.org/ticket/33821

Original creator: mkoeppe

Original creation time: 2022-05-08 03:39:41

CC:  fbissey arojas tornaria




---

Comment by git created at 2022-05-08 04:35:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-08 04:37:16

Changing status from new to needs_review.


---

Comment by git created at 2022-05-08 18:20:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-09 17:49:04

The failure in "Build&Test" is in `sage -t --random-seed=54174803604868423169944467131116599504 sage/parallel/map_reduce.py `, unrelated.


---

Comment by git created at 2022-05-10 05:11:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2022-06-12 21:10:15

You have a repeated block

```
+                def directories():
+                    try:
+                        from sage.env import SAGE_SRC
+                    except ImportError:
+                        pass
+                    else:
+                        if SAGE_SRC:
+                            yield normpath(os.path.join(SAGE_SRC, 'sage'))
+                    import sage
+                    yield from sage.__path__
+
+                for directory in directories():
+                    if commonprefix([filename, directory]) == directory:
+                        filename = os.path.join('sage', relpath(filename, directory))
+                        break
```

If it ends up being useful in more than two files, should it be factored somewhere?


---

Comment by git created at 2022-06-25 22:58:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-06-25 22:59:05

Good suggestion, done now


---

Comment by fbissey created at 2022-06-25 23:02:59

LGTM, let's ship it.


---

Comment by fbissey created at 2022-06-25 23:02:59

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-06-25 23:13:44

Thanks!


---

Comment by vbraun created at 2022-07-03 22:06:02

Resolution: fixed
