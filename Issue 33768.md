# Issue 33768: center_basis for group algebra works for one group but not isomorphic copy

archive/issues_033768.json:
```json
{
    "body": "CC:  @nbruin @videlec @fchapoton\n\nRunning sage 9.5.\n\nThis works:\n\n```\nGfail=PermutationGroup([(1,2,3),(2,3,4)])\nGworks=AlternatingGroup(4)\nRfail=GroupAlgebra(Gfail,QQ)\nRworks=GroupAlgebra(Gworks,QQ)\nRworks.center_basis()\n```\n\nThis fails:\n\n\n```\nRfail.center_basis()\n```\n\n\nPertinent part of error message:\nRuntimeError: There is a bug in the coercion code in Sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34005\n\n",
    "created_at": "2022-06-16T16:56:38Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "center_basis for group algebra works for one group but not isomorphic copy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33768",
    "user": "@JaTaSn"
}
```
CC:  @nbruin @videlec @fchapoton

Running sage 9.5.

This works:

```
Gfail=PermutationGroup([(1,2,3),(2,3,4)])
Gworks=AlternatingGroup(4)
Rfail=GroupAlgebra(Gfail,QQ)
Rworks=GroupAlgebra(Gworks,QQ)
Rworks.center_basis()
```

This fails:


```
Rfail.center_basis()
```


Pertinent part of error message:
RuntimeError: There is a bug in the coercion code in Sage.

Issue created by migration from https://trac.sagemath.org/ticket/34005





---

archive/issue_comments_480122.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2022-06-17T02:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33768#issuecomment-480122",
    "user": "@tscrim"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_480123.json:
```json
{
    "body": "Interesting. This is coming from the fact that generic permutation groups are not unique parents:\n\n```\nsage: G2 = PermutationGroup([(1,2,3),(2,3,4)])\nsage: Gfail is G2\nFalse\nsage: Gfail == G2\nTrue\n```\n\nThe quick fix would be making `PermutationGroup` always return a `UniqueRepresentation` subclass as my guess is it comes from this:\n\n```\nsage: R2 = GroupAlgebra(G2, QQ)\nsage: R2 is Rfail\nTrue\n```\n\nNow we could make the group algebra code only be unique if the input group is unique, but that would require some major modifications to how things are implemented I think.\n\nI don't think we want `PermutationGroup_generic` to be a subclass of `UniqueRepresentation` because of the equality check. Could making it a subclass of `CachedRepresentation` maybe fix this problem? Although I don't exactly understand why the code is failing in the first place...",
    "created_at": "2022-06-17T02:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33768#issuecomment-480123",
    "user": "@tscrim"
}
```

Interesting. This is coming from the fact that generic permutation groups are not unique parents:

```
sage: G2 = PermutationGroup([(1,2,3),(2,3,4)])
sage: Gfail is G2
False
sage: Gfail == G2
True
```

The quick fix would be making `PermutationGroup` always return a `UniqueRepresentation` subclass as my guess is it comes from this:

```
sage: R2 = GroupAlgebra(G2, QQ)
sage: R2 is Rfail
True
```

Now we could make the group algebra code only be unique if the input group is unique, but that would require some major modifications to how things are implemented I think.

I don't think we want `PermutationGroup_generic` to be a subclass of `UniqueRepresentation` because of the equality check. Could making it a subclass of `CachedRepresentation` maybe fix this problem? Although I don't exactly understand why the code is failing in the first place...



---

archive/issue_comments_480124.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to coercion.",
    "created_at": "2022-06-17T02:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33768#issuecomment-480124",
    "user": "@tscrim"
}
```

Changing component from PLEASE CHANGE to coercion.



---

archive/issue_comments_480125.json:
```json
{
    "body": "Possibly related to\n\n```\nsage: p1 = PermutationGroup([(1,2),(1,2,3,4)]).an_element()\nsage: p2 = SymmetricGroup(4).an_element()\nsage: parent(coercion_model.canonical_coercion(p1, p2)[0])\nPermutation Group with generators [(1,2), (1,2,3,4)]\nsage: parent(coercion_model.canonical_coercion(p2, p1)[0])\nSymmetric group of order 4! as a permutation group\n```\n\nSee #28544",
    "created_at": "2022-06-17T06:05:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33768#issuecomment-480125",
    "user": "@videlec"
}
```

Possibly related to

```
sage: p1 = PermutationGroup([(1,2),(1,2,3,4)]).an_element()
sage: p2 = SymmetricGroup(4).an_element()
sage: parent(coercion_model.canonical_coercion(p1, p2)[0])
Permutation Group with generators [(1,2), (1,2,3,4)]
sage: parent(coercion_model.canonical_coercion(p2, p1)[0])
Symmetric group of order 4! as a permutation group
```

See #28544



---

archive/issue_comments_480126.json:
```json
{
    "body": "Quite likely. Non-unique-representation parents make coercion difficult, and from comment:2, likely even `CachedRepresentation` won't improve the situation. We might have to explicitly convert some elements in the `GroupAlgebra` code to fix this. It should at least fix the symptom, but that is likely just a hack solution with other issues popping up elsewhere...",
    "created_at": "2022-06-17T08:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33768#issuecomment-480126",
    "user": "@tscrim"
}
```

Quite likely. Non-unique-representation parents make coercion difficult, and from comment:2, likely even `CachedRepresentation` won't improve the situation. We might have to explicitly convert some elements in the `GroupAlgebra` code to fix this. It should at least fix the symptom, but that is likely just a hack solution with other issues popping up elsewhere...
