# Issue 33768: center_basis for group algebra works for one group but not isomorphic copy

Issue created by migration from https://trac.sagemath.org/ticket/34005

Original creator: @JaTaSn

Original creation time: 2022-06-16 16:56:38

CC:  nbruin vdelecroix chapoton

Running sage 9.5.

This works:

```
Gfail=PermutationGroup([(1,2,3),(2,3,4)])
Gworks=AlternatingGroup(4)
Rfail=GroupAlgebra(Gfail,QQ)
Rworks=GroupAlgebra(Gworks,QQ)
Rworks.center_basis()
```

This fails:


```
Rfail.center_basis()
```


Pertinent part of error message:
RuntimeError: There is a bug in the coercion code in Sage.


---

Comment by tscrim created at 2022-06-17 02:51:22

Changing type from PLEASE CHANGE to defect.


---

Comment by tscrim created at 2022-06-17 02:51:22

Interesting. This is coming from the fact that generic permutation groups are not unique parents:

```
sage: G2 = PermutationGroup([(1,2,3),(2,3,4)])
sage: Gfail is G2
False
sage: Gfail == G2
True
```

The quick fix would be making `PermutationGroup` always return a `UniqueRepresentation` subclass as my guess is it comes from this:

```
sage: R2 = GroupAlgebra(G2, QQ)
sage: R2 is Rfail
True
```

Now we could make the group algebra code only be unique if the input group is unique, but that would require some major modifications to how things are implemented I think.

I don't think we want `PermutationGroup_generic` to be a subclass of `UniqueRepresentation` because of the equality check. Could making it a subclass of `CachedRepresentation` maybe fix this problem? Although I don't exactly understand why the code is failing in the first place...


---

Comment by tscrim created at 2022-06-17 02:51:22

Changing component from PLEASE CHANGE to coercion.


---

Comment by vdelecroix created at 2022-06-17 06:05:37

Possibly related to

```
sage: p1 = PermutationGroup([(1,2),(1,2,3,4)]).an_element()
sage: p2 = SymmetricGroup(4).an_element()
sage: parent(coercion_model.canonical_coercion(p1, p2)[0])
Permutation Group with generators [(1,2), (1,2,3,4)]
sage: parent(coercion_model.canonical_coercion(p2, p1)[0])
Symmetric group of order 4! as a permutation group
```

See #28544


---

Comment by tscrim created at 2022-06-17 08:12:07

Quite likely. Non-unique-representation parents make coercion difficult, and from comment:2, likely even `CachedRepresentation` won't improve the situation. We might have to explicitly convert some elements in the `GroupAlgebra` code to fix this. It should at least fix the symptom, but that is likely just a hack solution with other issues popping up elsewhere...
