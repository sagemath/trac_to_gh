# Issue 11548: regularly refresh the pickle jar

Issue created by migration from https://trac.sagemath.org/ticket/11720

Original creator: boothby

Original creation time: 2011-08-23 08:14:53

Assignee: was

CC:  vbraun

The pickle jar hasn't been refreshed in a very long time.  We need a system in place that continually adds pickles to the jar, and keeps the old pickles around.


---

Comment by SimonKing created at 2014-05-02 21:32:25

I guess one question that needs to be addressed is: How can we keep track of the pickle jar _with git_? IICTC, the pickle jar is not under version control, and being a binary file (`.tar.bz2`) it _shouldn't_ be under version control.

Each item in the pickle jar corresponds to a pair of files. One file is pure text, describing the Sage version used to create the pickle, the class whose instance is pickled, and the expected string representation of the unpickled object. The second file is the actual pickle, `.sobj`.

Is git able to look into bzipped tar files? If this was the case, then we could at least let git track the text files associated with the pickles.

Another question that needs to be addressed: How to post changes of the pickle jar on a trac ticket? Shall one attach the new version of the pickle jar, leaving a comment for the release manager asking him/her to replace the old jar with the new jar? That's why I put Volker on Cc (Hi Volker...).

And perhaps it would be nice to have a function that automatically creates a new pickle in the jar. Yes, I know, there is a function that puts a "text file"-"sobj"-pair for a given object into a given directory. However, some manual work is currently involved to move this into `SAGE_EXTCODE/pickle_jar/pickle_jar.tar.bz2`, and this should easily be automated.

Concerning the topic of this trac ticket: If I understand correctly, there is an option to automatically create a pickle jar during `sage -t`, containing pickles for all objects that are subject to a `loads/dumps` doc test. But perhaps this is overzealous, and in addition the result would currently not be automatically put into the standard pickle jar.

However, this could be used as a starting point, to be modified so that
1. the resulting pickles would automatically be put into the standard bzipped pickle jar in `SAGE_EXTCODE`
2. only _new_ pickles will be added: If an sobj created in version 5.9 is bitwise identical with an sobj created in version 6.1, then we should only have one copy of it in the pickle jar.


---

Comment by vbraun created at 2014-05-03 08:12:35

Git doesn't do anything special for bzipped files, in particular space usage will grow with the size of the pickle jar.

How about we distribute the pickle jar like any other database, as a tarball with a dummy `build/pkg/pickle_jar`?


---

Comment by jdemeyer created at 2017-03-08 13:19:24

Duplicate of #10768.


---

Comment by jdemeyer created at 2017-03-08 13:19:24

Resolution: duplicate


---

Comment by @DaveWitteMorris created at 2021-01-29 02:56:06

Sorry, this branch was intended for a ticket #17720 (typo).
