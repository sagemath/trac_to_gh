# Issue 28201: Allow using python3 jupyter notebook on python2 sage

archive/issues_028201.json:
```json
{
    "body": "CC:  dimpase slelievre vdelecroix fbissey jdemeyer @timokau\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28438\n\n",
    "created_at": "2019-08-31T22:24:36Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Allow using python3 jupyter notebook on python2 sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28201",
    "user": "arojas"
}
```
CC:  dimpase slelievre vdelecroix fbissey jdemeyer @timokau



Issue created by migration from https://trac.sagemath.org/ticket/28438





---

archive/issue_comments_398223.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-08-31T22:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398223",
    "user": "arojas"
}
```

New commits:



---

archive/issue_comments_398224.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to notebook.",
    "created_at": "2019-08-31T22:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398224",
    "user": "arojas"
}
```

Changing component from PLEASE CHANGE to notebook.



---

archive/issue_comments_398225.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-08-31T22:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398225",
    "user": "arojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_398226.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-08-31T22:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398226",
    "user": "arojas"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_398227.json:
```json
{
    "body": "Interesting. This still limit the `jupyter` notebook to be installed in the same prefix as the python executable. Could we just call things relying on it being in the `PATH`? That may be especially helpful for nix.",
    "created_at": "2019-08-31T22:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398227",
    "user": "fbissey"
}
```

Interesting. This still limit the `jupyter` notebook to be installed in the same prefix as the python executable. Could we just call things relying on it being in the `PATH`? That may be especially helpful for nix.



---

archive/issue_comments_398228.json:
```json
{
    "body": "Replying to [comment:3 fbissey]:\n> Interesting. This still limit the `jupyter` notebook to be installed in the same prefix as the python executable. Could we just call things relying on it being in the `PATH`? That may be especially helpful for nix.\n\nThis was my first idea, but there is one problem: the sage kernel is not guaranteed to be installed in a hypothetical system-wide install of jupyter, sage.repl.ipython_kernel.install.SageKernelSpec installs the kernel under the python sys prefix",
    "created_at": "2019-08-31T22:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398228",
    "user": "arojas"
}
```

Replying to [comment:3 fbissey]:
> Interesting. This still limit the `jupyter` notebook to be installed in the same prefix as the python executable. Could we just call things relying on it being in the `PATH`? That may be especially helpful for nix.

This was my first idea, but there is one problem: the sage kernel is not guaranteed to be installed in a hypothetical system-wide install of jupyter, sage.repl.ipython_kernel.install.SageKernelSpec installs the kernel under the python sys prefix



---

archive/issue_comments_398229.json:
```json
{
    "body": "That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.",
    "created_at": "2019-08-31T23:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398229",
    "user": "fbissey"
}
```

That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.



---

archive/issue_comments_398230.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.\n\nThat's definitely not the case for me! I certainly install jupyter notebook. In fact, I make sure that I install the sage kernel in THAT jupyter notebook, so that normally I just run \"jupyter notebook\" to access sage worksheets. For me that's a py3 notebook, calling the (for now still py2) sage python for the kernel. However, when I run sage --notebook=jupyter I would fully expect the sage python to run with the notebook there, and not see the kernels that I installed in my system-wide jupyter.\n\nOf course, perhaps in the future we want to make it possible out-of-the-box for sage to make use of the system jupyter and to install its kernel in there. But then there's just no need for a \"sage --notebook\" command anymore. So it's fine to use `PATH` but you should use the modified path that has `$SAGE_LOCAL/bin` in front in `sage --notebook`.",
    "created_at": "2019-08-31T23:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398230",
    "user": "nbruin"
}
```

Replying to [comment:5 fbissey]:
> That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.

That's definitely not the case for me! I certainly install jupyter notebook. In fact, I make sure that I install the sage kernel in THAT jupyter notebook, so that normally I just run "jupyter notebook" to access sage worksheets. For me that's a py3 notebook, calling the (for now still py2) sage python for the kernel. However, when I run sage --notebook=jupyter I would fully expect the sage python to run with the notebook there, and not see the kernels that I installed in my system-wide jupyter.

Of course, perhaps in the future we want to make it possible out-of-the-box for sage to make use of the system jupyter and to install its kernel in there. But then there's just no need for a "sage --notebook" command anymore. So it's fine to use `PATH` but you should use the modified path that has `$SAGE_LOCAL/bin` in front in `sage --notebook`.



---

archive/issue_comments_398231.json:
```json
{
    "body": "If you start jupyter-notebook from vanilla sage's root or any of the usual commands, I expect you will get the sage version because `SAGE_LOCAL/bin` will be in your `PATH`.\n\nIt seems to me that the real problem is that we would like to pass the path to the location of the kernels to `jupyter-notebook`. I'll look into that.",
    "created_at": "2019-09-01T01:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398231",
    "user": "fbissey"
}
```

If you start jupyter-notebook from vanilla sage's root or any of the usual commands, I expect you will get the sage version because `SAGE_LOCAL/bin` will be in your `PATH`.

It seems to me that the real problem is that we would like to pass the path to the location of the kernels to `jupyter-notebook`. I'll look into that.



---

archive/issue_comments_398232.json:
```json
{
    "body": "Setting `JUPYTER_PATH` we could make sure that the kernels we want are discovered by `jupyter-notebook`[https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html](https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html). The only possible problem could be compatibility.",
    "created_at": "2019-09-01T02:04:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398232",
    "user": "fbissey"
}
```

Setting `JUPYTER_PATH` we could make sure that the kernels we want are discovered by `jupyter-notebook`[https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html](https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html). The only possible problem could be compatibility.



---

archive/issue_comments_398233.json:
```json
{
    "body": "see also #28197",
    "created_at": "2019-09-01T06:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398233",
    "user": "chapoton"
}
```

see also #28197



---

archive/issue_comments_398234.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.\n\nThanks for taking this into consideration :)\n\nThe way I currently handle jupyter is as follows: I have a custom kernel spec (independent of the one sage generates) which can then be used either by a system-wide jupyter service or by the notebook sage launches. Jupyter is taken from the system of course and sage is wrapped with an appropriate `JUPYTER_PATH` pointing to the kernel spec.",
    "created_at": "2019-09-01T16:12:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398234",
    "user": "@timokau"
}
```

Replying to [comment:5 fbissey]:
> That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.

Thanks for taking this into consideration :)

The way I currently handle jupyter is as follows: I have a custom kernel spec (independent of the one sage generates) which can then be used either by a system-wide jupyter service or by the notebook sage launches. Jupyter is taken from the system of course and sage is wrapped with an appropriate `JUPYTER_PATH` pointing to the kernel spec.



---

archive/issue_comments_398235.json:
```json
{
    "body": "OK, but in regards to the branch currently in this ticket, `jupyter-notebook` is assumed to be installed in the same prefix as the python interpreter.\n\nI would be more in favor of using `jupyter-notebook` found in the `PATH` for vanilla sage we can expect it to be the first one in the `PATH` and similarly with most distributions unless you do something explicit before launching. What we should make sure of, is that the kernels we want are found. So we should prepend `JUPYTER_PATH` with the path we expect the sage kernel to be by default. For distributions that install kernels differently but set `JUPYTER_PATH`, it should still be found.",
    "created_at": "2019-09-02T00:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398235",
    "user": "fbissey"
}
```

OK, but in regards to the branch currently in this ticket, `jupyter-notebook` is assumed to be installed in the same prefix as the python interpreter.

I would be more in favor of using `jupyter-notebook` found in the `PATH` for vanilla sage we can expect it to be the first one in the `PATH` and similarly with most distributions unless you do something explicit before launching. What we should make sure of, is that the kernels we want are found. So we should prepend `JUPYTER_PATH` with the path we expect the sage kernel to be by default. For distributions that install kernels differently but set `JUPYTER_PATH`, it should still be found.



---

archive/issue_comments_398236.json:
```json
{
    "body": "Oh, I didn't review the details of this ticket. I agree that using `PATH` is preferable to using a location relative to the python interpreter. sage-the-distribution can then set `PATH` appropriately (which it already does for other things anyways).",
    "created_at": "2019-09-03T13:39:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398236",
    "user": "@timokau"
}
```

Oh, I didn't review the details of this ticket. I agree that using `PATH` is preferable to using a location relative to the python interpreter. sage-the-distribution can then set `PATH` appropriately (which it already does for other things anyways).



---

archive/issue_comments_398237.json:
```json
{
    "body": "Switched my packages to python3 so I'm no longer interested in this - if someone is, feel free to take it over, otherwise please close.",
    "created_at": "2019-12-26T09:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398237",
    "user": "arojas"
}
```

Switched my packages to python3 so I'm no longer interested in this - if someone is, feel free to take it over, otherwise please close.



---

archive/issue_comments_398238.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398238",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_398239.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2020-02-12T13:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398239",
    "user": "chapoton"
}
```

Resolution: wontfix



---

archive/issue_comments_398240.json:
```json
{
    "body": "Let us close this one, now that sage uses python 3 by default",
    "created_at": "2020-02-12T13:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28201",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28201#issuecomment-398240",
    "user": "chapoton"
}
```

Let us close this one, now that sage uses python 3 by default
