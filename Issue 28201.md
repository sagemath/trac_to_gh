# Issue 28201: Allow using python3 jupyter notebook on python2 sage

Issue created by migration from https://trac.sagemath.org/ticket/28438

Original creator: arojas

Original creation time: 2019-08-31 22:24:36

CC:  dimpase slelievre vdelecroix fbissey jdemeyer @timokau




---

Comment by arojas created at 2019-08-31 22:37:00

New commits:


---

Comment by arojas created at 2019-08-31 22:37:00

Changing component from PLEASE CHANGE to notebook.


---

Comment by arojas created at 2019-08-31 22:37:00

Changing status from new to needs_review.


---

Comment by arojas created at 2019-08-31 22:37:00

Changing type from PLEASE CHANGE to enhancement.


---

Comment by fbissey created at 2019-08-31 22:44:55

Interesting. This still limit the `jupyter` notebook to be installed in the same prefix as the python executable. Could we just call things relying on it being in the `PATH`? That may be especially helpful for nix.


---

Comment by arojas created at 2019-08-31 22:47:28

Replying to [comment:3 fbissey]:
> Interesting. This still limit the `jupyter` notebook to be installed in the same prefix as the python executable. Could we just call things relying on it being in the `PATH`? That may be especially helpful for nix.

This was my first idea, but there is one problem: the sage kernel is not guaranteed to be installed in a hypothetical system-wide install of jupyter, sage.repl.ipython_kernel.install.SageKernelSpec installs the kernel under the python sys prefix


---

Comment by fbissey created at 2019-08-31 23:03:10

That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.


---

Comment by nbruin created at 2019-08-31 23:41:42

Replying to [comment:5 fbissey]:
> That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.

That's definitely not the case for me! I certainly install jupyter notebook. In fact, I make sure that I install the sage kernel in THAT jupyter notebook, so that normally I just run "jupyter notebook" to access sage worksheets. For me that's a py3 notebook, calling the (for now still py2) sage python for the kernel. However, when I run sage --notebook=jupyter I would fully expect the sage python to run with the notebook there, and not see the kernels that I installed in my system-wide jupyter.

Of course, perhaps in the future we want to make it possible out-of-the-box for sage to make use of the system jupyter and to install its kernel in there. But then there's just no need for a "sage --notebook" command anymore. So it's fine to use `PATH` but you should use the modified path that has `$SAGE_LOCAL/bin` in front in `sage --notebook`.


---

Comment by fbissey created at 2019-09-01 01:46:33

If you start jupyter-notebook from vanilla sage's root or any of the usual commands, I expect you will get the sage version because `SAGE_LOCAL/bin` will be in your `PATH`.

It seems to me that the real problem is that we would like to pass the path to the location of the kernels to `jupyter-notebook`. I'll look into that.


---

Comment by fbissey created at 2019-09-01 02:04:09

Setting `JUPYTER_PATH` we could make sure that the kernels we want are discovered by `jupyter-notebook`[https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html](https://jupyter.readthedocs.io/en/latest/projects/jupyter-directories.html). The only possible problem could be compatibility.


---

Comment by chapoton created at 2019-09-01 06:27:13

see also #28197


---

Comment by @timokau created at 2019-09-01 16:12:16

Replying to [comment:5 fbissey]:
> That is true. I am just having the expectation that the `jupyter-notebook` you find first in the `PATH` is the right one. I think we should ask the nix people how they are handling things before making their life harder. But being able to remove stuff like `have_prerequisites` is definitely a good thing.

Thanks for taking this into consideration :)

The way I currently handle jupyter is as follows: I have a custom kernel spec (independent of the one sage generates) which can then be used either by a system-wide jupyter service or by the notebook sage launches. Jupyter is taken from the system of course and sage is wrapped with an appropriate `JUPYTER_PATH` pointing to the kernel spec.


---

Comment by fbissey created at 2019-09-02 00:52:01

OK, but in regards to the branch currently in this ticket, `jupyter-notebook` is assumed to be installed in the same prefix as the python interpreter.

I would be more in favor of using `jupyter-notebook` found in the `PATH` for vanilla sage we can expect it to be the first one in the `PATH` and similarly with most distributions unless you do something explicit before launching. What we should make sure of, is that the kernels we want are found. So we should prepend `JUPYTER_PATH` with the path we expect the sage kernel to be by default. For distributions that install kernels differently but set `JUPYTER_PATH`, it should still be found.


---

Comment by @timokau created at 2019-09-03 13:39:22

Oh, I didn't review the details of this ticket. I agree that using `PATH` is preferable to using a location relative to the python interpreter. sage-the-distribution can then set `PATH` appropriately (which it already does for other things anyways).


---

Comment by arojas created at 2019-12-26 09:00:20

Switched my packages to python3 so I'm no longer interested in this - if someone is, feel free to take it over, otherwise please close.


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by chapoton created at 2020-02-12 13:41:55

Resolution: wontfix


---

Comment by chapoton created at 2020-02-12 13:41:55

Let us close this one, now that sage uses python 3 by default
