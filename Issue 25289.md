# Issue 25289: Factor iterator in suffix tree of word

Issue created by migration from https://trac.sagemath.org/ticket/25526

Original creator: evandomme

Original creation time: 2018-06-07 09:42:04

CC:  vdelecroix slabbe

Keywords: thursdaysbdx

We improve the algorithm computing the factor iterator in the implicit suffix tree of a word.


---

Comment by slabbe created at 2018-06-21 08:31:20

Does the branch needs review?
----
New commits:


---

Comment by slabbe created at 2018-06-21 08:33:30

Changing status from new to needs_review.


---

Comment by slabbe created at 2018-06-21 08:33:30

Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?


---

Comment by slabbe created at 2018-06-21 08:33:37

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2018-06-21 08:50:33

Replying to [comment:3 slabbe]:
> Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?

No. The reason is that there is no guarantee that iterating through a dictionary via `iteritems` you always get the same order (you can check that in the doctests there are `sorted` everywhere). But before this ticket, it was clearly not a DFS

```
sage: for w in Word("cacao").suffix_tree().factor_iterator(): print w
c
a
ac
aca
ao
acao
o
ca
cac
caca
cao
cacao
```

With this ticket it is

```
sage: for w in Word("cacao").suffix_tree().factor_iterator(): print w
a
ao
ac
aca
acao
o
c
ca
cao
cac
caca
cacao
```



---

Comment by slabbe created at 2018-06-21 12:56:50

Replying to [comment:5 vdelecroix]:
> Replying to [comment:3 slabbe]:
> > Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?
> 
> No. 

I was asking in the description of the ticket not in a doctest.


---

Comment by slabbe created at 2018-06-21 13:14:08

Before this ticket, this just eats all the memory and CPU:


```
sage: w = words.FibonacciWord([0,1])
sage: it = w[:10000].suffix_tree().factor_iterator()
sage: %time L = list(it)
Processus arrêté
```


With the branch of this ticket, I get:


```
sage: w = words.FibonacciWord([0,1])
sage: it = w[:10000].suffix_tree().factor_iterator()
sage: %time L = list(it)
CPU times: user 14 s, sys: 504 ms, total: 14.5 s
Wall time: 14.5 s
sage: len(L)
24337601
```


So, it is definitely an improvement.


---

Comment by slabbe created at 2018-06-21 13:15:18

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-06-22 22:58:36

Resolution: fixed
