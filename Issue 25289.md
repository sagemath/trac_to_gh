# Issue 25289: Factor iterator in suffix tree of word

archive/issues_025289.json:
```json
{
    "body": "CC:  @videlec @seblabbe\n\nKeywords: thursdaysbdx\n\nWe improve the algorithm computing the factor iterator in the implicit suffix tree of a word.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25526\n\n",
    "created_at": "2018-06-07T09:42:04Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Factor iterator in suffix tree of word",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25289",
    "user": "https://trac.sagemath.org/admin/accounts/users/evandomme"
}
```
CC:  @videlec @seblabbe

Keywords: thursdaysbdx

We improve the algorithm computing the factor iterator in the implicit suffix tree of a word.

Issue created by migration from https://trac.sagemath.org/ticket/25526





---

archive/issue_comments_356101.json:
```json
{
    "body": "Does the branch needs review?\n----\nNew commits:",
    "created_at": "2018-06-21T08:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356101",
    "user": "https://github.com/seblabbe"
}
```

Does the branch needs review?
----
New commits:



---

archive/issue_comments_356102.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-21T08:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356102",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_356103.json:
```json
{
    "body": "Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?",
    "created_at": "2018-06-21T08:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356103",
    "user": "https://github.com/seblabbe"
}
```

Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?



---

archive/issue_comments_356104.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-21T08:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356104",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_356105.json:
```json
{
    "body": "Replying to [comment:3 slabbe]:\n> Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?\n\nNo. The reason is that there is no guarantee that iterating through a dictionary via `iteritems` you always get the same order (you can check that in the doctests there are `sorted` everywhere). But before this ticket, it was clearly not a DFS\n\n```\nsage: for w in Word(\"cacao\").suffix_tree().factor_iterator(): print w\nc\na\nac\naca\nao\nacao\no\nca\ncac\ncaca\ncao\ncacao\n```\n\nWith this ticket it is\n\n```\nsage: for w in Word(\"cacao\").suffix_tree().factor_iterator(): print w\na\nao\nac\naca\nacao\no\nc\nca\ncao\ncac\ncaca\ncacao\n```\n",
    "created_at": "2018-06-21T08:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356105",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:3 slabbe]:
> Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?

No. The reason is that there is no guarantee that iterating through a dictionary via `iteritems` you always get the same order (you can check that in the doctests there are `sorted` everywhere). But before this ticket, it was clearly not a DFS

```
sage: for w in Word("cacao").suffix_tree().factor_iterator(): print w
c
a
ac
aca
ao
acao
o
ca
cac
caca
cao
cacao
```

With this ticket it is

```
sage: for w in Word("cacao").suffix_tree().factor_iterator(): print w
a
ao
ac
aca
acao
o
c
ca
cao
cac
caca
cacao
```




---

archive/issue_comments_356106.json:
```json
{
    "body": "Replying to [comment:5 vdelecroix]:\n> Replying to [comment:3 slabbe]:\n> > Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?\n> \n> No. \n\nI was asking in the description of the ticket not in a doctest.",
    "created_at": "2018-06-21T12:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356106",
    "user": "https://github.com/seblabbe"
}
```

Replying to [comment:5 vdelecroix]:
> Replying to [comment:3 slabbe]:
> > Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?
> 
> No. 

I was asking in the description of the ticket not in a doctest.



---

archive/issue_comments_356107.json:
```json
{
    "body": "Before this ticket, this just eats all the memory and CPU:\n\n\n```\nsage: w = words.FibonacciWord([0,1])\nsage: it = w[:10000].suffix_tree().factor_iterator()\nsage: %time L = list(it)\nProcessus arr\u00eat\u00e9\n```\n\n\nWith the branch of this ticket, I get:\n\n\n```\nsage: w = words.FibonacciWord([0,1])\nsage: it = w[:10000].suffix_tree().factor_iterator()\nsage: %time L = list(it)\nCPU times: user 14 s, sys: 504 ms, total: 14.5 s\nWall time: 14.5 s\nsage: len(L)\n24337601\n```\n\n\nSo, it is definitely an improvement.",
    "created_at": "2018-06-21T13:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356107",
    "user": "https://github.com/seblabbe"
}
```

Before this ticket, this just eats all the memory and CPU:


```
sage: w = words.FibonacciWord([0,1])
sage: it = w[:10000].suffix_tree().factor_iterator()
sage: %time L = list(it)
Processus arrêté
```


With the branch of this ticket, I get:


```
sage: w = words.FibonacciWord([0,1])
sage: it = w[:10000].suffix_tree().factor_iterator()
sage: %time L = list(it)
CPU times: user 14 s, sys: 504 ms, total: 14.5 s
Wall time: 14.5 s
sage: len(L)
24337601
```


So, it is definitely an improvement.



---

archive/issue_comments_356108.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-06-21T13:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356108",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_356109.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-22T22:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25289#issuecomment-356109",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_023556.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-22T22:58:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25289",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25289#event-23556"
}
```
