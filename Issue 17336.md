# Issue 17336: Wrap Gap Structure Description

archive/issues_017336.json:
```json
{
    "body": "See [this math.sx question](http://math.stackexchange.com/questions/1084341).\n\n     G.gap().StructureDescription()\n\nIssue created by migration from https://trac.sagemath.org/ticket/17573\n\n",
    "created_at": "2014-12-31T04:38:48Z",
    "labels": [
        "component: group theory",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Wrap Gap Structure Description",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17336",
    "user": "https://github.com/kcrisman"
}
```
See [this math.sx question](http://math.stackexchange.com/questions/1084341).

     G.gap().StructureDescription()

Issue created by migration from https://trac.sagemath.org/ticket/17573





---

archive/issue_comments_230665.json:
```json
{
    "body": "Something like that ?\n\n```\nsage: graphs.PetersenGraph().automorphism_group().structure_description()\n'S5'\n```\n\n\nIt is in `sage.groups.perm_gps.permgroup.PermutationGroup` (relevant ticket#15128)\n\nNathann",
    "created_at": "2014-12-31T07:26:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230665",
    "user": "https://github.com/nathanncohen"
}
```

Something like that ?

```
sage: graphs.PetersenGraph().automorphism_group().structure_description()
'S5'
```


It is in `sage.groups.perm_gps.permgroup.PermutationGroup` (relevant ticket#15128)

Nathann



---

archive/issue_comments_230666.json:
```json
{
    "body": "To make it work on the example given on math.sx, you have to first build the associated permutation group.\n\n\n```\nsage: F.<x, y> = FreeGroup()\nsage: G=F / [x^2*y^-1, x^3*y^2, x*y*x^-1*y^-1]\nsage: G.as_permutation_group().structure_description()\n'C7'\n```\n\n\nIt should probably be exposed in `F` directly. As an alias to `.as_permutation_group().structure_description()` if we have to, but it seems that gap does not actually need to build the permutation group in order to compute that.\n\nNathann",
    "created_at": "2014-12-31T07:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230666",
    "user": "https://github.com/nathanncohen"
}
```

To make it work on the example given on math.sx, you have to first build the associated permutation group.


```
sage: F.<x, y> = FreeGroup()
sage: G=F / [x^2*y^-1, x^3*y^2, x*y*x^-1*y^-1]
sage: G.as_permutation_group().structure_description()
'C7'
```


It should probably be exposed in `F` directly. As an alias to `.as_permutation_group().structure_description()` if we have to, but it seems that gap does not actually need to build the permutation group in order to compute that.

Nathann



---

archive/issue_comments_230667.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-22T20:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230667",
    "user": "https://trac.sagemath.org/admin/accounts/users/captaintrunky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_230668.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-01-22T20:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230668",
    "user": "https://trac.sagemath.org/admin/accounts/users/captaintrunky"
}
```

New commits:



---

archive/issue_comments_230669.json:
```json
{
    "body": "Hello,\n\nThe method does not look reasonable: if you ask the structure description of the free group, it will not answer. I am pretty sure that there are things to analyze structure of finitely generated groups in GAP. Moreover why 4096000 for finite groups? it is quite huge!\n\nVincent",
    "created_at": "2015-01-22T22:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230669",
    "user": "https://github.com/videlec"
}
```

Hello,

The method does not look reasonable: if you ask the structure description of the free group, it will not answer. I am pretty sure that there are things to analyze structure of finitely generated groups in GAP. Moreover why 4096000 for finite groups? it is quite huge!

Vincent



---

archive/issue_comments_230670.json:
```json
{
    "body": "Hello again,\n\nIt seems that it is not necessary to turn the group into a permutation group in order to get this information from gap\n\n\n```\nsage: F.<x, y> = FreeGroup()\nsage: G=F / [x^2*y^-1, x^3*y^2, x*y*x^-1*y^-1]\nsage: G._gap_().StructureDescription()\n\"C7\"\n```\n\n\nThus there should be no problem with a limit argument or anything.\n\nThere remains some work to do in this ticket, however, for the code of `structure_description` defined in `PermutationGroup` does not only return GAP's answer: there is some string rewriting going on (as well as a latex output available), and it would be better to not copy/paste it here.\n\nNathann",
    "created_at": "2015-01-23T09:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230670",
    "user": "https://github.com/nathanncohen"
}
```

Hello again,

It seems that it is not necessary to turn the group into a permutation group in order to get this information from gap


```
sage: F.<x, y> = FreeGroup()
sage: G=F / [x^2*y^-1, x^3*y^2, x*y*x^-1*y^-1]
sage: G._gap_().StructureDescription()
"C7"
```


Thus there should be no problem with a limit argument or anything.

There remains some work to do in this ticket, however, for the code of `structure_description` defined in `PermutationGroup` does not only return GAP's answer: there is some string rewriting going on (as well as a latex output available), and it would be better to not copy/paste it here.

Nathann



---

archive/issue_comments_230671.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-01-23T09:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230671",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_230672.json:
```json
{
    "body": "Hi, Nathan. Thanks for the feedback.\nI've ended up today with exactly the same solution like yours. I'll add Latex output and proper string formatting in a couple of days.\n\nReplying to [comment:6 ncohen]:\n> Hello again,\n> \n> It seems that it is not necessary to turn the group into a permutation group in order to get this information from gap\n> \n> {{{\n> sage: F.<x, y> = FreeGroup()\n> sage: G=F / [x<sup>2*y</sup>-1, x<sup>3*y</sup>2, x*y*x<sup>-1*y</sup>-1]\n> sage: G._gap_().StructureDescription()\n> \"C7\"\n> }}}\n> \n> Thus there should be no problem with a limit argument or anything.\n> \n> There remains some work to do in this ticket, however, for the code of `structure_description` defined in `PermutationGroup` does not only return GAP's answer: there is some string rewriting going on (as well as a latex output available), and it would be better to not copy/paste it here.\n> \n> Nathann",
    "created_at": "2015-01-23T16:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230672",
    "user": "https://trac.sagemath.org/admin/accounts/users/captaintrunky"
}
```

Hi, Nathan. Thanks for the feedback.
I've ended up today with exactly the same solution like yours. I'll add Latex output and proper string formatting in a couple of days.

Replying to [comment:6 ncohen]:
> Hello again,
> 
> It seems that it is not necessary to turn the group into a permutation group in order to get this information from gap
> 
> {{{
> sage: F.<x, y> = FreeGroup()
> sage: G=F / [x<sup>2*y</sup>-1, x<sup>3*y</sup>2, x*y*x<sup>-1*y</sup>-1]
> sage: G._gap_().StructureDescription()
> "C7"
> }}}
> 
> Thus there should be no problem with a limit argument or anything.
> 
> There remains some work to do in this ticket, however, for the code of `structure_description` defined in `PermutationGroup` does not only return GAP's answer: there is some string rewriting going on (as well as a latex output available), and it would be better to not copy/paste it here.
> 
> Nathann



---

archive/issue_comments_230673.json:
```json
{
    "body": "Yoooooooo !\n\n> I've ended up today with exactly the same solution like yours. I'll add Latex output and proper string formatting in a couple of days.\n\nGreat! Thanks for working on that.\n\nNathann",
    "created_at": "2015-01-23T16:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230673",
    "user": "https://github.com/nathanncohen"
}
```

Yoooooooo !

> I've ended up today with exactly the same solution like yours. I'll add Latex output and proper string formatting in a couple of days.

Great! Thanks for working on that.

Nathann



---

archive/issue_comments_230674.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-25T21:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230674",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_230675.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-01-25T21:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230675",
    "user": "https://trac.sagemath.org/admin/accounts/users/captaintrunky"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_230676.json:
```json
{
    "body": "Hello again,\n\nI thought for a while about how we could avoid some copy/pate meant to handle the GAP output, then ended up using a trick. I wrote a couple of commits which do the following:\n\n1) Move `structure_description` from `permgroup.py` to `generic.py` without doing any modification to it\n\n2) Update it a bit (change 'self' into 'G', add a couple of examples) then bind this function to the `permutation_group` and `finitely_presented_group` classes. And also to `Matrix_group` while I was at it.\n\nI had to find a workaround for this `.sage()/.str()` problem you must have met yourself while you were working on this patch. This code works but there is definitely something fishy there.\n\nTell me what you think,\n\nNathann\n\nP.S.: Those two commits can be found at: `public/17573`",
    "created_at": "2015-01-26T10:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230676",
    "user": "https://github.com/nathanncohen"
}
```

Hello again,

I thought for a while about how we could avoid some copy/pate meant to handle the GAP output, then ended up using a trick. I wrote a couple of commits which do the following:

1) Move `structure_description` from `permgroup.py` to `generic.py` without doing any modification to it

2) Update it a bit (change 'self' into 'G', add a couple of examples) then bind this function to the `permutation_group` and `finitely_presented_group` classes. And also to `Matrix_group` while I was at it.

I had to find a workaround for this `.sage()/.str()` problem you must have met yourself while you were working on this patch. This code works but there is definitely something fishy there.

Tell me what you think,

Nathann

P.S.: Those two commits can be found at: `public/17573`



---

archive/issue_comments_230677.json:
```json
{
    "body": "Hi, Nathann!\n`StructureDescription` routine seems to be very general, so I agree that it should be moved from a special object like `permutation_group` somewhere else. I found your solution in these 2 commits reasonable for the whole problem.\nYes, I have already struggled with `sage()/str()`. Maybe we should open a ticket for this? I was very surprised that such basic stuff works in different (and not obvious) ways under the same cover due to several APIs to GAP.\nIn conclusion, I think that this ticket may be closed -- the goal is achieved.\n\nReplying to [comment:12 ncohen]:\n> Hello again,\n> \n> I thought for a while about how we could avoid some copy/pate meant to handle the GAP output, then ended up using a trick. I wrote a couple of commits which do the following:\n> \n> 1) Move `structure_description` from `permgroup.py` to `generic.py` without doing any modification to it\n> \n> 2) Update it a bit (change 'self' into 'G', add a couple of examples) then bind this function to the `permutation_group` and `finitely_presented_group` classes. And also to `Matrix_group` while I was at it.\n> \n> I had to find a workaround for this `.sage()/.str()` problem you must have met yourself while you were working on this patch. This code works but there is definitely something fishy there.\n> \n> Tell me what you think,\n> \n> Nathann\n> \n> P.S.: Those two commits can be found at: `public/17573`",
    "created_at": "2015-01-26T16:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230677",
    "user": "https://trac.sagemath.org/admin/accounts/users/captaintrunky"
}
```

Hi, Nathann!
`StructureDescription` routine seems to be very general, so I agree that it should be moved from a special object like `permutation_group` somewhere else. I found your solution in these 2 commits reasonable for the whole problem.
Yes, I have already struggled with `sage()/str()`. Maybe we should open a ticket for this? I was very surprised that such basic stuff works in different (and not obvious) ways under the same cover due to several APIs to GAP.
In conclusion, I think that this ticket may be closed -- the goal is achieved.

Replying to [comment:12 ncohen]:
> Hello again,
> 
> I thought for a while about how we could avoid some copy/pate meant to handle the GAP output, then ended up using a trick. I wrote a couple of commits which do the following:
> 
> 1) Move `structure_description` from `permgroup.py` to `generic.py` without doing any modification to it
> 
> 2) Update it a bit (change 'self' into 'G', add a couple of examples) then bind this function to the `permutation_group` and `finitely_presented_group` classes. And also to `Matrix_group` while I was at it.
> 
> I had to find a workaround for this `.sage()/.str()` problem you must have met yourself while you were working on this patch. This code works but there is definitely something fishy there.
> 
> Tell me what you think,
> 
> Nathann
> 
> P.S.: Those two commits can be found at: `public/17573`



---

archive/issue_comments_230678.json:
```json
{
    "body": "Hello!\n\n> `StructureDescription` routine seems to be very general, so I agree that it should be moved from a special object like `permutation_group` somewhere else.\n\nIndeed.\n\n> I found your solution in these 2 commits reasonable for the whole problem.\n\nThanks.\n\n> Yes, I have already struggled with `sage()/str()`. Maybe we should open a ticket for this? I was very surprised that such basic stuff works in different (and not obvious) ways under the same cover due to several APIs to GAP.\n\nTo be honest I would be glad to see it fixed, but I really did not understand where the problem came from. For some reason that I do not get, calling `str(x)` is not equivalent to `x.__str__()` on some objects `O_o`\n\n> In conclusion, I think that this ticket may be closed -- the goal is achieved.\n\nWell, then you can switch the ticket's status to `positive_review` and it will make it in the next release `:-)`\n\nNathann\n----\nNew commits:",
    "created_at": "2015-01-26T16:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230678",
    "user": "https://github.com/nathanncohen"
}
```

Hello!

> `StructureDescription` routine seems to be very general, so I agree that it should be moved from a special object like `permutation_group` somewhere else.

Indeed.

> I found your solution in these 2 commits reasonable for the whole problem.

Thanks.

> Yes, I have already struggled with `sage()/str()`. Maybe we should open a ticket for this? I was very surprised that such basic stuff works in different (and not obvious) ways under the same cover due to several APIs to GAP.

To be honest I would be glad to see it fixed, but I really did not understand where the problem came from. For some reason that I do not get, calling `str(x)` is not equivalent to `x.__str__()` on some objects `O_o`

> In conclusion, I think that this ticket may be closed -- the goal is achieved.

Well, then you can switch the ticket's status to `positive_review` and it will make it in the next release `:-)`

Nathann
----
New commits:



---

archive/issue_comments_230679.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-26T17:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230679",
    "user": "https://trac.sagemath.org/admin/accounts/users/captaintrunky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_230680.json:
```json
{
    "body": "I'll try to investigate the troubles with `str()/sage()`.",
    "created_at": "2015-01-26T17:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230680",
    "user": "https://trac.sagemath.org/admin/accounts/users/captaintrunky"
}
```

I'll try to investigate the troubles with `str()/sage()`.



---

archive/issue_comments_230681.json:
```json
{
    "body": "Argh, monkey patching classes to inherit your methods? Really? Am I the only one who finds this hideously ugly?\n\nThe plan is to \n1. get rid of `Group_old`, ie. switch permutation group to libgap\n2. get rid of all users of the old gap pexpect interface",
    "created_at": "2015-01-27T15:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230681",
    "user": "https://github.com/vbraun"
}
```

Argh, monkey patching classes to inherit your methods? Really? Am I the only one who finds this hideously ugly?

The plan is to 
1. get rid of `Group_old`, ie. switch permutation group to libgap
2. get rid of all users of the old gap pexpect interface



---

archive/issue_comments_230682.json:
```json
{
    "body": "> Argh, monkey patching classes to inherit your methods? Really? Am I the only one who finds this hideously ugly?\n\nWhere do you think that this method should be implemented in order to be only inherited by classes on which it will actually work?\n\nNathann",
    "created_at": "2015-01-27T15:44:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230682",
    "user": "https://github.com/nathanncohen"
}
```

> Argh, monkey patching classes to inherit your methods? Really? Am I the only one who finds this hideously ugly?

Where do you think that this method should be implemented in order to be only inherited by classes on which it will actually work?

Nathann



---

archive/issue_comments_230683.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-01-27T15:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230683",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_230684.json:
```json
{
    "body": "At the very least don't impose your idea of the degree of the dihedral group on others. Especially if your docs say that you use GAP's definititon.",
    "created_at": "2015-01-27T15:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230684",
    "user": "https://github.com/vbraun"
}
```

At the very least don't impose your idea of the degree of the dihedral group on others. Especially if your docs say that you use GAP's definititon.



---

archive/issue_comments_230685.json:
```json
{
    "body": "Replying to [comment:17 ncohen]:\n> Where do you think that this method should be implemented in order to be only inherited by classes on which it will actually work?\n\nThe standard lore is to give a generic implementation as high up as possible (e.g. in `Group`) and then override it with specialized implementations where appropriate.",
    "created_at": "2015-01-27T15:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230685",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:17 ncohen]:
> Where do you think that this method should be implemented in order to be only inherited by classes on which it will actually work?

The standard lore is to give a generic implementation as high up as possible (e.g. in `Group`) and then override it with specialized implementations where appropriate.



---

archive/issue_comments_230686.json:
```json
{
    "body": "> At the very least don't impose your idea of the degree of the dihedral group on others. Especially if your docs say that you use GAP's definititon.\n\nNone of the code that this branch contains does that. As you will find from the commits, it merely moves a function from one place to another, and the function's body has not been changed.\n\n> The standard lore is to give a generic implementation as high up as possible (e.g. in Group) and then override it with specialized implementations where appropriate.\n\nIf you do that, the function will be broken on many groups. It will not give wrong or slow results, but will just break. This is why I only added it to the classes that I found able to handle it.\n\nI set this patch back to its original status.\n\nNathann",
    "created_at": "2015-01-27T15:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230686",
    "user": "https://github.com/nathanncohen"
}
```

> At the very least don't impose your idea of the degree of the dihedral group on others. Especially if your docs say that you use GAP's definititon.

None of the code that this branch contains does that. As you will find from the commits, it merely moves a function from one place to another, and the function's body has not been changed.

> The standard lore is to give a generic implementation as high up as possible (e.g. in Group) and then override it with specialized implementations where appropriate.

If you do that, the function will be broken on many groups. It will not give wrong or slow results, but will just break. This is why I only added it to the classes that I found able to handle it.

I set this patch back to its original status.

Nathann



---

archive/issue_comments_230687.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-01-27T15:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230687",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_230688.json:
```json
{
    "body": "Fine, take a dump in our codebase.",
    "created_at": "2015-01-27T15:57:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230688",
    "user": "https://github.com/vbraun"
}
```

Fine, take a dump in our codebase.



---

archive/issue_comments_230689.json:
```json
{
    "body": "> Fine, take a dump in our codebase. \n\nI'll be glad to improve this implementation if you eventually want to contribute some more constructive criticism.\n\nNathann",
    "created_at": "2015-01-27T16:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230689",
    "user": "https://github.com/nathanncohen"
}
```

> Fine, take a dump in our codebase. 

I'll be glad to improve this implementation if you eventually want to contribute some more constructive criticism.

Nathann



---

archive/issue_comments_230690.json:
```json
{
    "body": "Could raising a `NotImplementedError` at the highest level solve this standoff?  I believe that is the usual way to deal with this.",
    "created_at": "2015-01-27T16:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230690",
    "user": "https://github.com/kcrisman"
}
```

Could raising a `NotImplementedError` at the highest level solve this standoff?  I believe that is the usual way to deal with this.



---

archive/issue_comments_230691.json:
```json
{
    "body": "> Could raising a `NotImplementedError` at the highest level solve this standoff?  I believe that is the usual way to deal with this.\n\nThis would make the function available on all groups, but then how should we make the 'real code' available in the groups that actually support it (if not by the trick used here)?\n\nNathann",
    "created_at": "2015-01-27T16:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230691",
    "user": "https://github.com/nathanncohen"
}
```

> Could raising a `NotImplementedError` at the highest level solve this standoff?  I believe that is the usual way to deal with this.

This would make the function available on all groups, but then how should we make the 'real code' available in the groups that actually support it (if not by the trick used here)?

Nathann



---

archive/issue_comments_230692.json:
```json
{
    "body": "Really the SX question boils down to : why is `structure_description` not consistently available for every group, after all it makes sense for every group. Just monkey-patching it to yet another group  addresses one particular symptom, but does nothing against the disease. I agree with Karl-Dieter, just raise `NotImplementedError` where appropriate (e.g. there is no `gap` method).",
    "created_at": "2015-01-27T16:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230692",
    "user": "https://github.com/vbraun"
}
```

Really the SX question boils down to : why is `structure_description` not consistently available for every group, after all it makes sense for every group. Just monkey-patching it to yet another group  addresses one particular symptom, but does nothing against the disease. I agree with Karl-Dieter, just raise `NotImplementedError` where appropriate (e.g. there is no `gap` method).



---

archive/issue_comments_230693.json:
```json
{
    "body": "I haven't looked at the details, just trying a suggestion; perhaps in this case it isn't appropriate.  There is no subclass of groups that it is available on?\n\nOr is the problem that the code for wrapping this only should be written *once*, but the various subclasses it works on aren't inherited from each other, so that then one has to rewrite this code for each such class?\n\nTo Volker's point, I believe that not every group actually has this description available in gap itself, or so I read the comments and tests to imply.  It isn't sufficient to have a gap method, it looks like.",
    "created_at": "2015-01-27T16:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230693",
    "user": "https://github.com/kcrisman"
}
```

I haven't looked at the details, just trying a suggestion; perhaps in this case it isn't appropriate.  There is no subclass of groups that it is available on?

Or is the problem that the code for wrapping this only should be written *once*, but the various subclasses it works on aren't inherited from each other, so that then one has to rewrite this code for each such class?

To Volker's point, I believe that not every group actually has this description available in gap itself, or so I read the comments and tests to imply.  It isn't sufficient to have a gap method, it looks like.



---

archive/issue_comments_230694.json:
```json
{
    "body": "Yo!\n\n> Really the SX question boils down to : why is `structure_description` not consistently available for every group, after all it makes sense for every group.\n\nTrue. There are oddities in the code, however, like this `MatrixGroup_gap` class whose description reads:\n\n`Matrix group over a ring that GAP understands`\n\nI took it as a hint that there will never be a working `.gap()` function on all groups.\n\n> Just monkey-patching it to yet another group  addresses one particular symptom, but does nothing against the disease.\n\nIndeed. It only makes the method available on some classes where it was not.\n\n> I agree with Karl-Dieter, just raise `NotImplementedError` where appropriate (e.g. there is no `gap` method).\n\nThus this patch should only move that function from one place to another. In which class do you think it should go?\n\nNathann",
    "created_at": "2015-01-27T16:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230694",
    "user": "https://github.com/nathanncohen"
}
```

Yo!

> Really the SX question boils down to : why is `structure_description` not consistently available for every group, after all it makes sense for every group.

True. There are oddities in the code, however, like this `MatrixGroup_gap` class whose description reads:

`Matrix group over a ring that GAP understands`

I took it as a hint that there will never be a working `.gap()` function on all groups.

> Just monkey-patching it to yet another group  addresses one particular symptom, but does nothing against the disease.

Indeed. It only makes the method available on some classes where it was not.

> I agree with Karl-Dieter, just raise `NotImplementedError` where appropriate (e.g. there is no `gap` method).

Thus this patch should only move that function from one place to another. In which class do you think it should go?

Nathann



---

archive/issue_comments_230695.json:
```json
{
    "body": "Replying to [comment:28 ncohen]:\n> I took it as a hint that there will never be a working `.gap()` function on all groups.\n\nYes. Another possible generic implementation is to call `.as_permutation_group().structure_description()`, if that is available. But in some cases you'll have to raise `NotImplementedError`. It is then up to author of that particular group to override `structure_description`.\n\n> Thus this patch should only move that function from one place to another. In which class do you think it should go?\n\nEvidently it should be in sage.groups.group.Group",
    "created_at": "2015-01-27T16:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230695",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:28 ncohen]:
> I took it as a hint that there will never be a working `.gap()` function on all groups.

Yes. Another possible generic implementation is to call `.as_permutation_group().structure_description()`, if that is available. But in some cases you'll have to raise `NotImplementedError`. It is then up to author of that particular group to override `structure_description`.

> Thus this patch should only move that function from one place to another. In which class do you think it should go?

Evidently it should be in sage.groups.group.Group



---

archive/issue_comments_230696.json:
```json
{
    "body": "> Yes. Another possible generic implementation is to call `.as_permutation_group().structure_description()`, if that is available.\n\nOnly applies to finite groups. And will be meaningless for very large finitely presented groups.\n\n> But in some cases you'll have to raise `NotImplementedError`. It is then up to author of that particular group to override `structure_description`.\n\nI personally consider this bad design, and this is why I prefer to monkey-patch functions that work rather than inherit broken ones.\n\n> Evidently it should be in sage.groups.group.Group\n\nWill you review it if I make the change?\n\nNathann",
    "created_at": "2015-01-27T16:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230696",
    "user": "https://github.com/nathanncohen"
}
```

> Yes. Another possible generic implementation is to call `.as_permutation_group().structure_description()`, if that is available.

Only applies to finite groups. And will be meaningless for very large finitely presented groups.

> But in some cases you'll have to raise `NotImplementedError`. It is then up to author of that particular group to override `structure_description`.

I personally consider this bad design, and this is why I prefer to monkey-patch functions that work rather than inherit broken ones.

> Evidently it should be in sage.groups.group.Group

Will you review it if I make the change?

Nathann



---

archive/issue_comments_230697.json:
```json
{
    "body": "Replying to [comment:30 ncohen]:\n> And will be meaningless for very large finitely presented groups.\n\nEverything is impossible to compute once you increase the problem size too far. FP groups are perhaps particularly tricky in that regard since there is no algorithm that necessarily terminates. But you should be allowed to ask the question.\n \n> I personally consider this bad design\n\nthis = consistent interfaces and specialized implementations in subclasses?\n\n> Will you review it if I make the change?\n\nSure",
    "created_at": "2015-01-27T16:42:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230697",
    "user": "https://github.com/vbraun"
}
```

Replying to [comment:30 ncohen]:
> And will be meaningless for very large finitely presented groups.

Everything is impossible to compute once you increase the problem size too far. FP groups are perhaps particularly tricky in that regard since there is no algorithm that necessarily terminates. But you should be allowed to ask the question.
 
> I personally consider this bad design

this = consistent interfaces and specialized implementations in subclasses?

> Will you review it if I make the change?

Sure



---

archive/issue_comments_230698.json:
```json
{
    "body": "> Everything is impossible to compute once you increase the problem size too far.\n\nYou are oversimplifying. Some finitely presented groups can be described very easily in either Sage or Gap, and this function can be called quickly too. Turning them into a permutation group is a very bad move.\n\n> > I personally consider this bad design\n> \n> this = consistent interfaces and specialized implementations in subclasses?\n\nCalling non implemented or broken functions, and saying that \"it is somebody else's problem\"\n\n\n```\nIt is then up to author of that particular group to override structure_description.\n```\n\n\nNathann",
    "created_at": "2015-01-27T16:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230698",
    "user": "https://github.com/nathanncohen"
}
```

> Everything is impossible to compute once you increase the problem size too far.

You are oversimplifying. Some finitely presented groups can be described very easily in either Sage or Gap, and this function can be called quickly too. Turning them into a permutation group is a very bad move.

> > I personally consider this bad design
> 
> this = consistent interfaces and specialized implementations in subclasses?

Calling non implemented or broken functions, and saying that "it is somebody else's problem"


```
It is then up to author of that particular group to override structure_description.
```


Nathann



---

archive/issue_comments_230699.json:
```json
{
    "body": "> Evidently it should be in sage.groups.group.Group\n\nThis change does not work: a `CyclicPermutationGroup` does not inherit from `Group`. If you wonder how that happens, just look at that and roll your eyes, just like me:\n\n\n```\ndef is_Group(x):\n    from sage.groups.old import Group as OldGroup\n    return isinstance(x, (Group, OldGroup))\n```\n\n\nNathann",
    "created_at": "2015-01-27T16:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230699",
    "user": "https://github.com/nathanncohen"
}
```

> Evidently it should be in sage.groups.group.Group

This change does not work: a `CyclicPermutationGroup` does not inherit from `Group`. If you wonder how that happens, just look at that and roll your eyes, just like me:


```
def is_Group(x):
    from sage.groups.old import Group as OldGroup
    return isinstance(x, (Group, OldGroup))
```


Nathann



---

archive/issue_comments_230700.json:
```json
{
    "body": "I know. This is why I said that permutation groups need to be switched away from OldGroup.",
    "created_at": "2015-01-27T16:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230700",
    "user": "https://github.com/vbraun"
}
```

I know. This is why I said that permutation groups need to be switched away from OldGroup.



---

archive/issue_comments_230701.json:
```json
{
    "body": "> I know. This is why I said that permutation groups need to be switched away from OldGroup. \n\nI see. What do you propose that we do with this ticket, then? I want this feature to make it into Sage, but I cannot rewrite code that I do not understand.\n\nNathann",
    "created_at": "2015-01-27T17:01:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230701",
    "user": "https://github.com/nathanncohen"
}
```

> I know. This is why I said that permutation groups need to be switched away from OldGroup. 

I see. What do you propose that we do with this ticket, then? I want this feature to make it into Sage, but I cannot rewrite code that I do not understand.

Nathann



---

archive/issue_comments_230702.json:
```json
{
    "body": "I would just add a method to OldGroup that calls Group.structure_description (or whatever is appropriate) with a note that it should be removed later.",
    "created_at": "2015-01-27T17:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230702",
    "user": "https://github.com/vbraun"
}
```

I would just add a method to OldGroup that calls Group.structure_description (or whatever is appropriate) with a note that it should be removed later.



---

archive/issue_comments_230703.json:
```json
{
    "body": "> I would just add a method to OldGroup that calls Group.structure_description (or whatever is appropriate) with a note that it should be removed later.\n\nI am sorry to block this here, but I do not agree with this way of doing things. I can rebase this patch on another ticket if this `OldGroup/Group` problem is solved soon, but otherwise I prefer this code as it is, as it does not introduce broken methods.\n\nNathann",
    "created_at": "2015-01-27T17:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230703",
    "user": "https://github.com/nathanncohen"
}
```

> I would just add a method to OldGroup that calls Group.structure_description (or whatever is appropriate) with a note that it should be removed later.

I am sorry to block this here, but I do not agree with this way of doing things. I can rebase this patch on another ticket if this `OldGroup/Group` problem is solved soon, but otherwise I prefer this code as it is, as it does not introduce broken methods.

Nathann



---

archive/issue_comments_230704.json:
```json
{
    "body": "So we'll have a consistent interface as soon as we have monkey-patched every group in Sage, excellent.",
    "created_at": "2015-01-27T20:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230704",
    "user": "https://github.com/vbraun"
}
```

So we'll have a consistent interface as soon as we have monkey-patched every group in Sage, excellent.



---

archive/issue_comments_230705.json:
```json
{
    "body": "> So we'll have a consistent interface as soon as we have monkey-patched every group in Sage, excellent.\n\nStop being difficult and let us do something useful: I am telling you that I am willing to help you or whoever will try to rewrite this code. The only thing I cannot do is rewrite it all by myself if you start taking this ticket as a hostage.\n\nMy problem is that I do not know nor understand how the group code works. I only want to add a feature, and this is the only way I found to do it without introducing broken functions (I do not want users to call a function and end up with an exception -- to them that is nothing but a bug).\n\nIf you are willing to solve the root of the problem, let us do so in another ticket. I will be glad to help.\n\nNathann",
    "created_at": "2015-01-27T21:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230705",
    "user": "https://github.com/nathanncohen"
}
```

> So we'll have a consistent interface as soon as we have monkey-patched every group in Sage, excellent.

Stop being difficult and let us do something useful: I am telling you that I am willing to help you or whoever will try to rewrite this code. The only thing I cannot do is rewrite it all by myself if you start taking this ticket as a hostage.

My problem is that I do not know nor understand how the group code works. I only want to add a feature, and this is the only way I found to do it without introducing broken functions (I do not want users to call a function and end up with an exception -- to them that is nothing but a bug).

If you are willing to solve the root of the problem, let us do so in another ticket. I will be glad to help.

Nathann



---

archive/issue_comments_230706.json:
```json
{
    "body": "In general I agree with ncohen here.  Though:\n\n> this is the only way I found to do it without introducing broken functions (I do not want users to call a function and end up with an exception -- to them that is nothing but a bug).\n\nWell, `NotImplementedError` is a special case, though.  Maybe you can make the error message really really obvious that it is GAP which doesn't have this available, not that Sage has some error?  Then it takes the sting away - *nobody* can calculate it, it's not a Sage bug at all, just the user wishing something got calculated that isn't, like an elementary integral to sin(x)/x.",
    "created_at": "2015-01-27T21:53:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230706",
    "user": "https://github.com/kcrisman"
}
```

In general I agree with ncohen here.  Though:

> this is the only way I found to do it without introducing broken functions (I do not want users to call a function and end up with an exception -- to them that is nothing but a bug).

Well, `NotImplementedError` is a special case, though.  Maybe you can make the error message really really obvious that it is GAP which doesn't have this available, not that Sage has some error?  Then it takes the sting away - *nobody* can calculate it, it's not a Sage bug at all, just the user wishing something got calculated that isn't, like an elementary integral to sin(x)/x.



---

archive/issue_comments_230707.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-29T13:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17336",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17336#issuecomment-230707",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
