# Issue 10274: matrix output strangeness for cached methods

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2010-11-15 22:43:51

Assignee: jason, was

CC:  cremona

From [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/60ce4391e54e74be?tvc=2): Something is not quite right in the cleverness used to output matrices: 

```
sage: M 
76 x 58 dense matrix over Integer Ring (type 'print M.str()' to see all of the entries) 
sage: M.hermite_form() 
76 x 58 dense matrix over Integer Ring (type 'print hnf-True-False.str()' to see all of the entries)
```

This issue arises with methods which cache their results (like hermite_form), whereas other methods (like transpose) work the way they're supposed to.  The proposed fix: 

 - in the function `sage_variablename` which tries to get the name of an object, only return strings which are valid identifiers for Python objects.

 - then in the caching methods for matrices, make sure the keys are not valid identifiers by appending a symbol like "$".


---

Attachment


---

Comment by jhpalmieri created at 2010-11-15 22:49:16

Changing priority from major to minor.


---

Comment by jhpalmieri created at 2010-11-15 22:49:16

Changing status from new to needs_review.


---

Comment by saraedum created at 2011-10-13 15:14:41

passed all tests when applied to sage-4.7.2.alpha2.


---

Comment by saraedum created at 2011-10-13 15:14:41

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-10-16 16:07:41

This needs to be rebased to sage-4.7.2.alpha4:

```
patching file sage/matrix/matrix0.pyx
Hunk #3 succeeded at 4456 (offset 417 lines).
patching file sage/misc/sageinspect.py
Hunk #1 succeeded at 1490 with fuzz 2 (offset 488 lines).
Hunk #2 FAILED at 1505.
1 out of 2 hunks FAILED -- saving rejects to file sage/misc/sageinspect.py.rej
```



---

Comment by jdemeyer created at 2011-10-16 16:07:41

Changing status from positive_review to needs_work.


---

Comment by saraedum created at 2011-10-17 13:41:53

The problem is fixed as a side effect of #10903. The attached patch only adds the doctest to check for the right behavior.


---

Attachment

adds a doctest and removes a obsolete comment


---

Comment by saraedum created at 2011-10-17 13:44:19

Apply trac_10275_doctest.patch


---

Comment by saraedum created at 2011-10-17 13:44:19

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2011-10-17 20:40:35

Your patch has "sage: sage: " on line 1498.  I'm attaching a new version.  

I agree that the problem seems to have been fixed by #10903.  Doctests pass, so positive review.


---

Comment by jhpalmieri created at 2011-10-17 20:40:35

Changing status from needs_review to positive_review.


---

Attachment


---

Comment by jdemeyer created at 2011-10-19 18:52:43

Resolution: fixed


---

Comment by jdemeyer created at 2011-11-03 16:14:43

Milestone sage-4.7.3 deleted
