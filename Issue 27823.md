# Issue 27823: Partial map from GF(q^m) to GF(q) is in Sage but not readily available

archive/issues_027823.json:
```json
{
    "body": "CC:  @xcaruso @tscrim\n\nKeywords: finitefield, rings\n\nThe following gives me a map from GF(5^2) to GF(5^6), but there's neither \"inverse\" or \"section\":\n\n\n```\n    sage: k.<a> = GF(5^2)\n    sage: K, f = k.extension(3, map=True)\n    sage: f(a) in K\n    True\n    sage: f.inverse(f(a))\n    AttributeError:\n    ...\n    NotImplementedError: \n    sage: f.section()\n    ---------------------------------------------------------------------------\n    TypeError                                 Traceback (most recent call last)\n    ...\n    /opt/sage/sage_devel/local/lib/python2.7/site-packages/sage/rings/finite_rings/hom_finite_field.pyx in sage.rings.finite_rings.hom_finite_field.FiniteFieldHomomorphism_generic.section \n(build/cythonized/sage/rings/finite_rings/hom_finite_field.c:4900)()\n    340               Defn: t |--> T^20 + 2*T^18 + T^16 + 2*T^13 + T^9 + 2*T^8 + T^7 + T^6 + T^5 + T^3 + 2*T^2 + T\n    341         \"\"\"\n--> 342         return self._section_class(self)\n    343 \n    344     def __hash__(self):\n\n    TypeError: 'NoneType' object is not callable\n```\n\n\nThe latter calls, apparently incorrectly, the code that *does* produce a map and its partial inverse:\n\n\n```\n    sage: k.<t> = GF(3^7)\n    sage: K.<T> = GF(3^21)\n    sage: from sage.rings.finite_rings.hom_finite_field import FiniteFieldHomomorphism_generic\n    sage: f = FiniteFieldHomomorphism_generic(Hom(k, K))\n    sage: g = f.section()\n    sage: g(f(a))\n    a\n```\n\n\nOn a related note, a redundant implementation of seemingly exactly this map is also available in `sage/coding/relative_finite_field_extension.py`. That implementation should probably be removed and its few uses in `sage/coding` be changed to use the one in `sage/rings/finite_rings/hom_finite_field.pyx`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28060\n\n",
    "created_at": "2019-06-26T08:06:22Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Partial map from GF(q^m) to GF(q) is in Sage but not readily available",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27823",
    "user": "@johanrosenkilde"
}
```
CC:  @xcaruso @tscrim

Keywords: finitefield, rings

The following gives me a map from GF(5^2) to GF(5^6), but there's neither "inverse" or "section":


```
    sage: k.<a> = GF(5^2)
    sage: K, f = k.extension(3, map=True)
    sage: f(a) in K
    True
    sage: f.inverse(f(a))
    AttributeError:
    ...
    NotImplementedError: 
    sage: f.section()
    ---------------------------------------------------------------------------
    TypeError                                 Traceback (most recent call last)
    ...
    /opt/sage/sage_devel/local/lib/python2.7/site-packages/sage/rings/finite_rings/hom_finite_field.pyx in sage.rings.finite_rings.hom_finite_field.FiniteFieldHomomorphism_generic.section 
(build/cythonized/sage/rings/finite_rings/hom_finite_field.c:4900)()
    340               Defn: t |--> T^20 + 2*T^18 + T^16 + 2*T^13 + T^9 + 2*T^8 + T^7 + T^6 + T^5 + T^3 + 2*T^2 + T
    341         """
--> 342         return self._section_class(self)
    343 
    344     def __hash__(self):

    TypeError: 'NoneType' object is not callable
```


The latter calls, apparently incorrectly, the code that *does* produce a map and its partial inverse:


```
    sage: k.<t> = GF(3^7)
    sage: K.<T> = GF(3^21)
    sage: from sage.rings.finite_rings.hom_finite_field import FiniteFieldHomomorphism_generic
    sage: f = FiniteFieldHomomorphism_generic(Hom(k, K))
    sage: g = f.section()
    sage: g(f(a))
    a
```


On a related note, a redundant implementation of seemingly exactly this map is also available in `sage/coding/relative_finite_field_extension.py`. That implementation should probably be removed and its few uses in `sage/coding` be changed to use the one in `sage/rings/finite_rings/hom_finite_field.pyx`.

Issue created by migration from https://trac.sagemath.org/ticket/28060





---

archive/issue_comments_392995.json:
```json
{
    "body": "Oops, I should have updated my ancient Sage before posting this ticket: the `f.section()` method now works fine and gives a partial map from K to k which inverts `f`. Sorry for the noise!\n\nFor usability, I find it very strange that `f.inverse_image(f(a))` does not return `a`, but rather throws a `NotImplementedException`. I'm posting a patch that makes `inverse_image` behave like this.\n----\nNew commits:",
    "created_at": "2019-06-26T12:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-392995",
    "user": "@johanrosenkilde"
}
```

Oops, I should have updated my ancient Sage before posting this ticket: the `f.section()` method now works fine and gives a partial map from K to k which inverts `f`. Sorry for the noise!

For usability, I find it very strange that `f.inverse_image(f(a))` does not return `a`, but rather throws a `NotImplementedException`. I'm posting a patch that makes `inverse_image` behave like this.
----
New commits:



---

archive/issue_comments_392996.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-26T12:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-392996",
    "user": "@johanrosenkilde"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_392997.json:
```json
{
    "body": "Hi Johan, I have two very minor comments: \n\n1. There is a typo `methid` instead of `method` in the documentation.\n2. ``self.section()`` and ``b`` should have double backticks.\n\nOtherwise, LGTM.",
    "created_at": "2019-08-22T09:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-392997",
    "user": "@bgrenet"
}
```

Hi Johan, I have two very minor comments: 

1. There is a typo `methid` instead of `method` in the documentation.
2. ``self.section()`` and ``b`` should have double backticks.

Otherwise, LGTM.



---

archive/issue_comments_392998.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-22T10:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-392998",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_392999.json:
```json
{
    "body": "Cool, thanks Bruno!",
    "created_at": "2019-08-22T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-392999",
    "user": "@johanrosenkilde"
}
```

Cool, thanks Bruno!



---

archive/issue_comments_393000.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-22T10:11:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-393000",
    "user": "@johanrosenkilde"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_393001.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-08-26T22:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27823",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27823#issuecomment-393001",
    "user": "@vbraun"
}
```

Resolution: fixed
