# Issue 33526: Refactor src/sage/docs

archive/issues_033526.json:
```json
{
    "body": "CC:  arojas\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33763\n\n",
    "created_at": "2022-04-27T04:19:37Z",
    "labels": [
        "documentation",
        "major",
        "enhancement"
    ],
    "title": "Refactor src/sage/docs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33526",
    "user": "klee"
}
```
CC:  arojas



Issue created by migration from https://trac.sagemath.org/ticket/33763





---

archive/issue_comments_477346.json:
```json
{
    "body": "Indeed. Why does this package even exist?",
    "created_at": "2022-04-27T06:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477346",
    "user": "mkoeppe"
}
```

Indeed. Why does this package even exist?



---

archive/issue_comments_477347.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-27T09:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477347",
    "user": "klee"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_477348.json:
```json
{
    "body": "----\nNew commits:",
    "created_at": "2022-04-27T09:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477348",
    "user": "klee"
}
```

----
New commits:



---

archive/issue_comments_477349.json:
```json
{
    "body": "Replying to [comment:1 mkoeppe]:\n> Indeed. Why does this package even exist? \n\nRemoving it is the goal of this ticket. To minimize confusion, this ticket should be the first one to be merged with sage 9.7.beta.",
    "created_at": "2022-04-27T09:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477349",
    "user": "klee"
}
```

Replying to [comment:1 mkoeppe]:
> Indeed. Why does this package even exist? 

Removing it is the goal of this ticket. To minimize confusion, this ticket should be the first one to be merged with sage 9.7.beta.



---

archive/issue_comments_477350.json:
```json
{
    "body": "Replying to [comment:1 mkoeppe]:\n> Indeed. Why does this package even exist? \n\nI don't know...",
    "created_at": "2022-04-27T09:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477350",
    "user": "klee"
}
```

Replying to [comment:1 mkoeppe]:
> Indeed. Why does this package even exist? 

I don't know...



---

archive/issue_comments_477351.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-27T09:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477351",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477352.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-27T14:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477352",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477353.json:
```json
{
    "body": "The failing Build&Test has nothing to do with this ticket.",
    "created_at": "2022-04-28T00:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477353",
    "user": "klee"
}
```

The failing Build&Test has nothing to do with this ticket.



---

archive/issue_comments_477354.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-28T18:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477354",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_477355.json:
```json
{
    "body": "LGTM.",
    "created_at": "2022-04-28T18:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477355",
    "user": "mkoeppe"
}
```

LGTM.



---

archive/issue_comments_477356.json:
```json
{
    "body": "The new module needs to be added to `pkgs/sagemath-objects/MANIFEST.in`",
    "created_at": "2022-04-28T18:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477356",
    "user": "mkoeppe"
}
```

The new module needs to be added to `pkgs/sagemath-objects/MANIFEST.in`



---

archive/issue_comments_477357.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-04-28T18:17:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477357",
    "user": "mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_477358.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-29T00:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477358",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_477359.json:
```json
{
    "body": "Would this work?",
    "created_at": "2022-04-29T00:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477359",
    "user": "klee"
}
```

Would this work?



---

archive/issue_comments_477360.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-29T00:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477360",
    "user": "klee"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_477361.json:
```json
{
    "body": "Yes, tested with #28925. Thanks!",
    "created_at": "2022-04-29T16:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477361",
    "user": "mkoeppe"
}
```

Yes, tested with #28925. Thanks!



---

archive/issue_comments_477362.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-29T16:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477362",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_477363.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-22T16:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477363",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_477364.json:
```json
{
    "body": "After this ticket, the `git` status is not clean:\n\n```\n% git status\nOn branch develop\nYour branch is up to date with 'trac/develop'.\n\nUntracked files:\n  (use \"git add <file>...\" to include in what will be committed)\n\tsrc/doc/en/reference/documentation/sage_docbuild/\n\nnothing added to commit but untracked files present (use \"git add\" to track)\n```\n\nAlso, `conf.py` produces an `html` file in the documentation with title=\"MISSING TITLE\".",
    "created_at": "2022-05-28T06:03:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477364",
    "user": "jhpalmieri"
}
```

After this ticket, the `git` status is not clean:

```
% git status
On branch develop
Your branch is up to date with 'trac/develop'.

Untracked files:
  (use "git add <file>..." to include in what will be committed)
	src/doc/en/reference/documentation/sage_docbuild/

nothing added to commit but untracked files present (use "git add" to track)
```

Also, `conf.py` produces an `html` file in the documentation with title="MISSING TITLE".



---

archive/issue_comments_477365.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> After this ticket, the `git` status is not clean:\n> {{{\n> % git status\n> On branch develop\n> Your branch is up to date with 'trac/develop'.\n> \n> Untracked files:\n>   (use \"git add <file>...\" to include in what will be committed)\n> \tsrc/doc/en/reference/documentation/sage_docbuild/\n> \n> nothing added to commit but untracked files present (use \"git add\" to track)\n> }}}\n> Also, `conf.py` produces an `html` file in the documentation with title=\"MISSING TITLE\".\n\nWill be fixed in #33922.",
    "created_at": "2022-05-28T07:56:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477365",
    "user": "klee"
}
```

Replying to [comment:17 jhpalmieri]:
> After this ticket, the `git` status is not clean:
> {{{
> % git status
> On branch develop
> Your branch is up to date with 'trac/develop'.
> 
> Untracked files:
>   (use "git add <file>..." to include in what will be committed)
> 	src/doc/en/reference/documentation/sage_docbuild/
> 
> nothing added to commit but untracked files present (use "git add" to track)
> }}}
> Also, `conf.py` produces an `html` file in the documentation with title="MISSING TITLE".

Will be fixed in #33922.



---

archive/issue_comments_477366.json:
```json
{
    "body": "This adds a runtime dependency to `sage_docbuild` in `sagelib` (when displaying a command's help). Is this intentional?",
    "created_at": "2022-05-28T12:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477366",
    "user": "arojas"
}
```

This adds a runtime dependency to `sage_docbuild` in `sagelib` (when displaying a command's help). Is this intentional?



---

archive/issue_comments_477367.json:
```json
{
    "body": "Replying to [comment:19 arojas]:\n> This adds a runtime dependency to `sage_docbuild` in `sagelib` (when displaying a command's help). \n\nSorry. Would you elaborate? What does it mean \"when displaying a command's help\"?",
    "created_at": "2022-05-28T13:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477367",
    "user": "klee"
}
```

Replying to [comment:19 arojas]:
> This adds a runtime dependency to `sage_docbuild` in `sagelib` (when displaying a command's help). 

Sorry. Would you elaborate? What does it mean "when displaying a command's help"?



---

archive/issue_comments_477368.json:
```json
{
    "body": "Replying to [comment:20 klee]:\n\n> Sorry. Would you elaborate? What does it mean \"when displaying a command's help\"?\n\nIf `sage_docbuild` is not installed:\n\n\n```\nsage: integrate?\n---------------------------------------------------------------------------\nModuleNotFoundError                       Traceback (most recent call last)\nFile /usr/lib/python3.10/site-packages/sphinx/config.py:332, in eval_config_file(filename, tags)\n    331         code = compile(f.read(), filename.encode(fs_encoding), 'exec')\n--> 332         exec(code, namespace)\n    333 except SyntaxError as err:\n\nFile /tmp/tmpovois2g5/en/introspect/conf.py:2, in <module>\n----> 2 from sage_docbuild.conf import *\n      3 extensions = ['sphinx.ext.autodoc', 'sphinx.ext.mathjax', 'sphinx.ext.todo', 'sphinx.ext.extlinks']\n\nModuleNotFoundError: No module named 'sage_docbuild'\n\nThe above exception was the direct cause of the following exception:\n\nConfigError                               Traceback (most recent call last)\nInput In [1], in <cell line: 1>()\n----> 1 get_ipython().run_line_magic('pinfo', 'integrate')\n\nFile /usr/lib/python3.10/site-packages/IPython/core/interactiveshell.py:2304, in InteractiveShell.run_line_magic(self, magic_name, line, _stack_depth)\n   2302     kwargs['local_ns'] = self.get_local_scope(stack_depth)\n   2303 with self.builtin_trap:\n-> 2304     result = fn(*args, **kwargs)\n   2305 return result\n\nFile /usr/lib/python3.10/site-packages/IPython/core/magics/namespace.py:58, in NamespaceMagics.pinfo(self, parameter_s, namespaces)\n     56     self.psearch(oname)\n     57 else:\n---> 58     self.shell._inspect('pinfo', oname, detail_level=detail_level,\n     59                         namespaces=namespaces)\n\nFile /usr/lib/python3.10/site-packages/IPython/core/interactiveshell.py:1684, in InteractiveShell._inspect(self, meth, oname, namespaces, **kw)\n   1682     pmethod(info.obj, oname, formatter)\n   1683 elif meth == 'pinfo':\n-> 1684     pmethod(\n   1685         info.obj,\n   1686         oname,\n   1687         formatter,\n   1688         info,\n   1689         enable_html_pager=self.enable_html_pager,\n   1690         **kw,\n   1691     )\n   1692 else:\n   1693     pmethod(info.obj, oname)\n\nFile /usr/lib/python3.10/site-packages/IPython/core/oinspect.py:698, in Inspector.pinfo(self, obj, oname, formatter, info, detail_level, enable_html_pager, omit_sections)\n    665 def pinfo(\n    666     self,\n    667     obj,\n   (...)\n    673     omit_sections=(),\n    674 ):\n    675     \"\"\"Show detailed information about an object.\n    676 \n    677     Optional arguments:\n   (...)\n    696     - omit_sections: set of section keys and titles to omit\n    697     \"\"\"\n--> 698     info = self._get_info(\n    699         obj, oname, formatter, info, detail_level, omit_sections=omit_sections\n    700     )\n    701     if not enable_html_pager:\n    702         del info['text/html']\n\nFile /usr/lib/python3.10/site-packages/IPython/core/oinspect.py:591, in Inspector._get_info(self, obj, oname, formatter, info, detail_level, omit_sections)\n    571 def _get_info(\n    572     self, obj, oname=\"\", formatter=None, info=None, detail_level=0, omit_sections=()\n    573 ):\n    574     \"\"\"Retrieve an info dict and format it.\n    575 \n    576     Parameters\n   (...)\n    588         Titles or keys to omit from output (can be set, tuple, etc., anything supporting `in`)\n    589     \"\"\"\n--> 591     info = self.info(obj, oname=oname, info=info, detail_level=detail_level)\n    593     _mime = {\n    594         'text/plain': [],\n    595         'text/html': '',\n    596     }\n    598     def append_field(bundle, title:str, key:str, formatter=None):\n\nFile /usr/lib/python3.10/site-packages/IPython/core/oinspect.py:762, in Inspector.info(self, obj, oname, info, detail_level)\n    760             ds += \"\\nDocstring:\\n\" + obj.__doc__\n    761 else:\n--> 762     ds = getdoc(obj)\n    763     if ds is None:\n    764         ds = '<no docstring>'\n\nFile /usr/lib/python3.10/site-packages/sage/misc/lazy_import.pyx:391, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4273)()\n    389         True\n    390     \"\"\"\n--> 391     return self.get_object()(*args, **kwds)\n    392 \n    393 def __repr__(self):\n\nFile /usr/lib/python3.10/site-packages/sage/misc/sageinspect.py:2050, in sage_getdoc(obj, obj_name, embedded)\n   2048     return ''\n   2049 r = sage_getdoc_original(obj)\n-> 2050 s = sage.misc.sagedoc.format(r, embedded=embedded)\n   2051 f = sage_getfile(obj)\n   2052 if f and os.path.exists(f):\n\nFile /usr/lib/python3.10/site-packages/sage/misc/sagedoc.py:752, in format(s, embedded)\n    750         s = process_mathtt(s)\n    751     s = process_extlinks(s, embedded=embedded)\n--> 752     s = detex(s, embedded=embedded)\n    753 return s\n\nFile /usr/lib/python3.10/site-packages/sage/misc/sagedoc.py:249, in detex(s, embedded)\n    247     s = s.replace('``', '\"').replace('`', '') + '\\n'\n    248 else:\n--> 249     s = sphinxify(s, format='text')\n    250 # Do math substitutions. The strings to be replaced should be\n    251 # TeX commands like \"\\\\blah\". Do a regular expression\n    252 # replacement to replace \"\\\\blah\" but not \"\\\\blahxyz\", etc.:\n    253 # test to make sure the next character is not a letter.\n    254 for a,b in math_substitutes:\n\nFile /usr/lib/python3.10/site-packages/sage/misc/sphinxify.py:122, in sphinxify(docstring, format)\n    119 old_sys_path = list(sys.path)  # Sphinx modifies sys.path\n    120 # Sphinx constructor: Sphinx(srcdir, confdir, outdir, doctreedir,\n    121 # buildername, confoverrides, status, warning, freshenv).\n--> 122 sphinx_app = Sphinx(srcdir, confdir, outdir, doctreedir, format,\n    123                     confoverrides, None, None, True)\n    124 sphinx_app.build(None, [rst_name])\n    125 sys.path = old_sys_path\n\nFile /usr/lib/python3.10/site-packages/sphinx/application.py:202, in Sphinx.__init__(self, srcdir, confdir, outdir, doctreedir, buildername, confoverrides, status, warning, freshenv, warningiserror, tags, verbosity, parallel, keep_going)\n    200 else:\n    201     self.confdir = abspath(confdir)\n--> 202     self.config = Config.read(self.confdir, confoverrides or {}, self.tags)\n    204 # initialize some limited config variables before initialize i18n and loading\n    205 # extensions\n    206 self.config.pre_init_values()\n\nFile /usr/lib/python3.10/site-packages/sphinx/config.py:165, in Config.read(cls, confdir, overrides, tags)\n    162 if not path.isfile(filename):\n    163     raise ConfigError(__(\"config directory doesn't contain a conf.py file (%s)\") %\n    164                       confdir)\n--> 165 namespace = eval_config_file(filename, tags)\n    166 return cls(namespace, overrides or {})\n\nFile /usr/lib/python3.10/site-packages/sphinx/config.py:345, in eval_config_file(filename, tags)\n    343     except Exception as exc:\n    344         msg = __(\"There is a programmable error in your configuration file:\\n\\n%s\")\n--> 345         raise ConfigError(msg % traceback.format_exc()) from exc\n    347 return namespace\n\nConfigError: There is a programmable error in your configuration file:\n\nTraceback (most recent call last):\n  File \"/usr/lib/python3.10/site-packages/sphinx/config.py\", line 332, in eval_config_file\n    exec(code, namespace)\n  File \"/tmp/tmpovois2g5/en/introspect/conf.py\", line 2, in <module>\n    from sage_docbuild.conf import *\nModuleNotFoundError: No module named 'sage_docbuild'\n```\n",
    "created_at": "2022-05-28T19:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477368",
    "user": "arojas"
}
```

Replying to [comment:20 klee]:

> Sorry. Would you elaborate? What does it mean "when displaying a command's help"?

If `sage_docbuild` is not installed:


```
sage: integrate?
---------------------------------------------------------------------------
ModuleNotFoundError                       Traceback (most recent call last)
File /usr/lib/python3.10/site-packages/sphinx/config.py:332, in eval_config_file(filename, tags)
    331         code = compile(f.read(), filename.encode(fs_encoding), 'exec')
--> 332         exec(code, namespace)
    333 except SyntaxError as err:

File /tmp/tmpovois2g5/en/introspect/conf.py:2, in <module>
----> 2 from sage_docbuild.conf import *
      3 extensions = ['sphinx.ext.autodoc', 'sphinx.ext.mathjax', 'sphinx.ext.todo', 'sphinx.ext.extlinks']

ModuleNotFoundError: No module named 'sage_docbuild'

The above exception was the direct cause of the following exception:

ConfigError                               Traceback (most recent call last)
Input In [1], in <cell line: 1>()
----> 1 get_ipython().run_line_magic('pinfo', 'integrate')

File /usr/lib/python3.10/site-packages/IPython/core/interactiveshell.py:2304, in InteractiveShell.run_line_magic(self, magic_name, line, _stack_depth)
   2302     kwargs['local_ns'] = self.get_local_scope(stack_depth)
   2303 with self.builtin_trap:
-> 2304     result = fn(*args, **kwargs)
   2305 return result

File /usr/lib/python3.10/site-packages/IPython/core/magics/namespace.py:58, in NamespaceMagics.pinfo(self, parameter_s, namespaces)
     56     self.psearch(oname)
     57 else:
---> 58     self.shell._inspect('pinfo', oname, detail_level=detail_level,
     59                         namespaces=namespaces)

File /usr/lib/python3.10/site-packages/IPython/core/interactiveshell.py:1684, in InteractiveShell._inspect(self, meth, oname, namespaces, **kw)
   1682     pmethod(info.obj, oname, formatter)
   1683 elif meth == 'pinfo':
-> 1684     pmethod(
   1685         info.obj,
   1686         oname,
   1687         formatter,
   1688         info,
   1689         enable_html_pager=self.enable_html_pager,
   1690         **kw,
   1691     )
   1692 else:
   1693     pmethod(info.obj, oname)

File /usr/lib/python3.10/site-packages/IPython/core/oinspect.py:698, in Inspector.pinfo(self, obj, oname, formatter, info, detail_level, enable_html_pager, omit_sections)
    665 def pinfo(
    666     self,
    667     obj,
   (...)
    673     omit_sections=(),
    674 ):
    675     """Show detailed information about an object.
    676 
    677     Optional arguments:
   (...)
    696     - omit_sections: set of section keys and titles to omit
    697     """
--> 698     info = self._get_info(
    699         obj, oname, formatter, info, detail_level, omit_sections=omit_sections
    700     )
    701     if not enable_html_pager:
    702         del info['text/html']

File /usr/lib/python3.10/site-packages/IPython/core/oinspect.py:591, in Inspector._get_info(self, obj, oname, formatter, info, detail_level, omit_sections)
    571 def _get_info(
    572     self, obj, oname="", formatter=None, info=None, detail_level=0, omit_sections=()
    573 ):
    574     """Retrieve an info dict and format it.
    575 
    576     Parameters
   (...)
    588         Titles or keys to omit from output (can be set, tuple, etc., anything supporting `in`)
    589     """
--> 591     info = self.info(obj, oname=oname, info=info, detail_level=detail_level)
    593     _mime = {
    594         'text/plain': [],
    595         'text/html': '',
    596     }
    598     def append_field(bundle, title:str, key:str, formatter=None):

File /usr/lib/python3.10/site-packages/IPython/core/oinspect.py:762, in Inspector.info(self, obj, oname, info, detail_level)
    760             ds += "\nDocstring:\n" + obj.__doc__
    761 else:
--> 762     ds = getdoc(obj)
    763     if ds is None:
    764         ds = '<no docstring>'

File /usr/lib/python3.10/site-packages/sage/misc/lazy_import.pyx:391, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4273)()
    389         True
    390     """
--> 391     return self.get_object()(*args, **kwds)
    392 
    393 def __repr__(self):

File /usr/lib/python3.10/site-packages/sage/misc/sageinspect.py:2050, in sage_getdoc(obj, obj_name, embedded)
   2048     return ''
   2049 r = sage_getdoc_original(obj)
-> 2050 s = sage.misc.sagedoc.format(r, embedded=embedded)
   2051 f = sage_getfile(obj)
   2052 if f and os.path.exists(f):

File /usr/lib/python3.10/site-packages/sage/misc/sagedoc.py:752, in format(s, embedded)
    750         s = process_mathtt(s)
    751     s = process_extlinks(s, embedded=embedded)
--> 752     s = detex(s, embedded=embedded)
    753 return s

File /usr/lib/python3.10/site-packages/sage/misc/sagedoc.py:249, in detex(s, embedded)
    247     s = s.replace('``', '"').replace('`', '') + '\n'
    248 else:
--> 249     s = sphinxify(s, format='text')
    250 # Do math substitutions. The strings to be replaced should be
    251 # TeX commands like "\\blah". Do a regular expression
    252 # replacement to replace "\\blah" but not "\\blahxyz", etc.:
    253 # test to make sure the next character is not a letter.
    254 for a,b in math_substitutes:

File /usr/lib/python3.10/site-packages/sage/misc/sphinxify.py:122, in sphinxify(docstring, format)
    119 old_sys_path = list(sys.path)  # Sphinx modifies sys.path
    120 # Sphinx constructor: Sphinx(srcdir, confdir, outdir, doctreedir,
    121 # buildername, confoverrides, status, warning, freshenv).
--> 122 sphinx_app = Sphinx(srcdir, confdir, outdir, doctreedir, format,
    123                     confoverrides, None, None, True)
    124 sphinx_app.build(None, [rst_name])
    125 sys.path = old_sys_path

File /usr/lib/python3.10/site-packages/sphinx/application.py:202, in Sphinx.__init__(self, srcdir, confdir, outdir, doctreedir, buildername, confoverrides, status, warning, freshenv, warningiserror, tags, verbosity, parallel, keep_going)
    200 else:
    201     self.confdir = abspath(confdir)
--> 202     self.config = Config.read(self.confdir, confoverrides or {}, self.tags)
    204 # initialize some limited config variables before initialize i18n and loading
    205 # extensions
    206 self.config.pre_init_values()

File /usr/lib/python3.10/site-packages/sphinx/config.py:165, in Config.read(cls, confdir, overrides, tags)
    162 if not path.isfile(filename):
    163     raise ConfigError(__("config directory doesn't contain a conf.py file (%s)") %
    164                       confdir)
--> 165 namespace = eval_config_file(filename, tags)
    166 return cls(namespace, overrides or {})

File /usr/lib/python3.10/site-packages/sphinx/config.py:345, in eval_config_file(filename, tags)
    343     except Exception as exc:
    344         msg = __("There is a programmable error in your configuration file:\n\n%s")
--> 345         raise ConfigError(msg % traceback.format_exc()) from exc
    347 return namespace

ConfigError: There is a programmable error in your configuration file:

Traceback (most recent call last):
  File "/usr/lib/python3.10/site-packages/sphinx/config.py", line 332, in eval_config_file
    exec(code, namespace)
  File "/tmp/tmpovois2g5/en/introspect/conf.py", line 2, in <module>
    from sage_docbuild.conf import *
ModuleNotFoundError: No module named 'sage_docbuild'
```




---

archive/issue_comments_477369.json:
```json
{
    "body": "Where is this from?\n\n```\nFile /tmp/tmpovois2g5/en/introspect/conf.py:2, in <module>\n----> 2 from sage_docbuild.conf import *\n```\n\nI could not find `.../introspect/conf.py` in the sage source tree.",
    "created_at": "2022-05-28T23:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477369",
    "user": "klee"
}
```

Where is this from?

```
File /tmp/tmpovois2g5/en/introspect/conf.py:2, in <module>
----> 2 from sage_docbuild.conf import *
```

I could not find `.../introspect/conf.py` in the sage source tree.



---

archive/issue_comments_477370.json:
```json
{
    "body": "It's from these lines from `misc/sphinxify.py`:\n\n```\n    confdir = os.path.join(srcdir, 'en' , 'introspect')\n    os.makedirs(confdir)\n    with open(os.path.join(confdir, 'conf.py'), 'w') as filed:\n        filed.write(r\"\"\"\n          ...\n```\n",
    "created_at": "2022-05-28T23:51:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477370",
    "user": "jhpalmieri"
}
```

It's from these lines from `misc/sphinxify.py`:

```
    confdir = os.path.join(srcdir, 'en' , 'introspect')
    os.makedirs(confdir)
    with open(os.path.join(confdir, 'conf.py'), 'w') as filed:
        filed.write(r"""
          ...
```




---

archive/issue_comments_477371.json:
```json
{
    "body": "Replying to [comment:19 arojas]:\n> This adds a runtime dependency to `sage_docbuild` in `sagelib` (when displaying a command's help). Is this intentional?\n\nThat was not intentional. I was not aware that putting `conf.py` in the directory `sage_docbuild` introduces the runtime dependency.\n\nI think we may move `conf.py` to `misc/conf.py`. Before I open a ticket for that, I want Matthias to confirm that the runtime independence of `sagelib` from `sage_docbuild` should not be broken.\n\nMatthias?",
    "created_at": "2022-05-29T05:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477371",
    "user": "klee"
}
```

Replying to [comment:19 arojas]:
> This adds a runtime dependency to `sage_docbuild` in `sagelib` (when displaying a command's help). Is this intentional?

That was not intentional. I was not aware that putting `conf.py` in the directory `sage_docbuild` introduces the runtime dependency.

I think we may move `conf.py` to `misc/conf.py`. Before I open a ticket for that, I want Matthias to confirm that the runtime independence of `sagelib` from `sage_docbuild` should not be broken.

Matthias?



---

archive/issue_comments_477372.json:
```json
{
    "body": "Sorry, I didn't catch this when reviewing the ticket. `sage_docbuild` definitely must not be a runtime dependency of sagelib.",
    "created_at": "2022-05-29T17:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477372",
    "user": "mkoeppe"
}
```

Sorry, I didn't catch this when reviewing the ticket. `sage_docbuild` definitely must not be a runtime dependency of sagelib.



---

archive/issue_comments_477373.json:
```json
{
    "body": "I don't think all of `conf.py` is appropriate to go into `misc`. \nLet's split it.\nFor example, I don't think any of the mathjax configuration is needed for sphinxify.",
    "created_at": "2022-05-29T17:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477373",
    "user": "mkoeppe"
}
```

I don't think all of `conf.py` is appropriate to go into `misc`. 
Let's split it.
For example, I don't think any of the mathjax configuration is needed for sphinxify.



---

archive/issue_comments_477374.json:
```json
{
    "body": "See also: #33682 Replace `sage.misc.sphinxify` with docrepr",
    "created_at": "2022-05-29T17:32:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477374",
    "user": "mkoeppe"
}
```

See also: #33682 Replace `sage.misc.sphinxify` with docrepr



---

archive/issue_comments_477375.json:
```json
{
    "body": "Replying to [comment:27 mkoeppe]:\n> For example, I don't think any of the mathjax configuration is needed for sphinxify.\n\nI'm probably wrong about mathjax here. But some other settings in `conf.py` are not appropriate in the context of sphinxify: \n- `templates_path` (which makes a reference to `SAGE_DOC_SRC` - which is not available at sagelib runtime)\n- `jupyter_sphinx_thebelab_config`\n- `latex_elements`\n- `add_page_context`\n- ...",
    "created_at": "2022-05-29T17:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477375",
    "user": "mkoeppe"
}
```

Replying to [comment:27 mkoeppe]:
> For example, I don't think any of the mathjax configuration is needed for sphinxify.

I'm probably wrong about mathjax here. But some other settings in `conf.py` are not appropriate in the context of sphinxify: 
- `templates_path` (which makes a reference to `SAGE_DOC_SRC` - which is not available at sagelib runtime)
- `jupyter_sphinx_thebelab_config`
- `latex_elements`
- `add_page_context`
- ...



---

archive/issue_comments_477376.json:
```json
{
    "body": "Replying to [comment:29 mkoeppe]:\n> Replying to [comment:27 mkoeppe]:\n> > For example, I don't think any of the mathjax configuration is needed for sphinxify.\n> \n> I'm probably wrong about mathjax here.\n\nWell, our only uses of `sphinxify` with `format='html'` in the Sage library appears in a function `browse_sage_doc` (which I just learned about), which does not seem to use mathjax.",
    "created_at": "2022-05-29T17:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477376",
    "user": "mkoeppe"
}
```

Replying to [comment:29 mkoeppe]:
> Replying to [comment:27 mkoeppe]:
> > For example, I don't think any of the mathjax configuration is needed for sphinxify.
> 
> I'm probably wrong about mathjax here.

Well, our only uses of `sphinxify` with `format='html'` in the Sage library appears in a function `browse_sage_doc` (which I just learned about), which does not seem to use mathjax.



---

archive/issue_comments_477377.json:
```json
{
    "body": "Replying to [comment:25 klee]:\n> Before I open a ticket for that, I want Matthias to confirm that the runtime independence of `sagelib` from `sage_docbuild` should not be broken.\n\nI've opened #33936 (Remove runtime dependency on sage_docbuild introduced in #33763)",
    "created_at": "2022-05-29T18:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33526#issuecomment-477377",
    "user": "mkoeppe"
}
```

Replying to [comment:25 klee]:
> Before I open a ticket for that, I want Matthias to confirm that the runtime independence of `sagelib` from `sage_docbuild` should not be broken.

I've opened #33936 (Remove runtime dependency on sage_docbuild introduced in #33763)
