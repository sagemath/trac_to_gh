# Issue 13573: Fix TimeSeries histogram plotting

archive/issues_013573.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  jason ppurka\n\nTurns out that this has been broken for a while.  Yuck.  The fix is a few characters.  This is a stopgap of sorts for when #9671 is ever fixed...\n\nIssue created by migration from https://trac.sagemath.org/ticket/13777\n\n",
    "created_at": "2012-11-30T02:50:36Z",
    "labels": [
        "graphics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "Fix TimeSeries histogram plotting",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13573",
    "user": "kcrisman"
}
```
Assignee: jason, was

CC:  jason ppurka

Turns out that this has been broken for a while.  Yuck.  The fix is a few characters.  This is a stopgap of sorts for when #9671 is ever fixed...

Issue created by migration from https://trac.sagemath.org/ticket/13777





---

archive/issue_comments_167894.json:
```json
{
    "body": "Needs review.  No doctest needed since basically no one had ever *looked* at the doctest, which is all that would have been needed!",
    "created_at": "2012-11-30T02:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167894",
    "user": "kcrisman"
}
```

Needs review.  No doctest needed since basically no one had ever *looked* at the doctest, which is all that would have been needed!



---

archive/issue_comments_167895.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-11-30T02:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167895",
    "user": "kcrisman"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167896.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-30T02:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167896",
    "user": "kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_167897.json:
```json
{
    "body": "Oops, this was in a Cython file.  Needs work.",
    "created_at": "2012-11-30T02:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167897",
    "user": "kcrisman"
}
```

Oops, this was in a Cython file.  Needs work.



---

archive/issue_comments_167898.json:
```json
{
    "body": "You need to import Graphics two lines above to make it compile. But that doesn't fix the histogram. :)",
    "created_at": "2012-11-30T03:10:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167898",
    "user": "ppurka"
}
```

You need to import Graphics two lines above to make it compile. But that doesn't fix the histogram. :)



---

archive/issue_comments_167899.json:
```json
{
    "body": "Okay, this seems to work.",
    "created_at": "2012-11-30T03:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167899",
    "user": "kcrisman"
}
```

Okay, this seems to work.



---

archive/issue_comments_167900.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-30T03:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167900",
    "user": "kcrisman"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_167901.json:
```json
{
    "body": "> You need to import Graphics two lines above to make it compile. But that doesn't fix the histogram. :)\nYes, I saw that - too bad Trac doesn't auto-update :)  But somehow it works for me now.",
    "created_at": "2012-11-30T03:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167901",
    "user": "kcrisman"
}
```

> You need to import Graphics two lines above to make it compile. But that doesn't fix the histogram. :)
Yes, I saw that - too bad Trac doesn't auto-update :)  But somehow it works for me now.



---

archive/issue_comments_167902.json:
```json
{
    "body": "Attachment [shot-2012-11-30_11-41-17.jpg](tarball://root/attachments/some-uuid/ticket13777/shot-2012-11-30_11-41-17.jpg) by ppurka created at 2012-11-30 03:41:48",
    "created_at": "2012-11-30T03:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167902",
    "user": "ppurka"
}
```

Attachment [shot-2012-11-30_11-41-17.jpg](tarball://root/attachments/some-uuid/ticket13777/shot-2012-11-30_11-41-17.jpg) by ppurka created at 2012-11-30 03:41:48



---

archive/issue_comments_167903.json:
```json
{
    "body": "I get [attachment:shot-2012-11-30_11-41-17.jpg this output]. Don't see any histogram.",
    "created_at": "2012-11-30T03:42:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167903",
    "user": "ppurka"
}
```

I get [attachment:shot-2012-11-30_11-41-17.jpg this output]. Don't see any histogram.



---

archive/issue_comments_167904.json:
```json
{
    "body": "> I get [attachment:shot-2012-11-30_11-41-17.jpg this output]. Don't see any histogram.\nYeah, I only got the right thing once.  What the heck do we have to do to fix this?  It works fine in the command line.  Trying to import other things like `line` don't work either.  And most frustratingly, it worked exactly once in the compiled version!",
    "created_at": "2012-11-30T03:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167904",
    "user": "kcrisman"
}
```

> I get [attachment:shot-2012-11-30_11-41-17.jpg this output]. Don't see any histogram.
Yeah, I only got the right thing once.  What the heck do we have to do to fix this?  It works fine in the command line.  Trying to import other things like `line` don't work either.  And most frustratingly, it worked exactly once in the compiled version!



---

archive/issue_comments_167905.json:
```json
{
    "body": "A while ago we changed polygons to have aspect ratio 1 automatically, IIRC.  So you should add an `aspect_ratio='automatic'` somewhere, maybe as a default option.",
    "created_at": "2012-11-30T04:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167905",
    "user": "jason"
}
```

A while ago we changed polygons to have aspect ratio 1 automatically, IIRC.  So you should add an `aspect_ratio='automatic'` somewhere, maybe as a default option.



---

archive/issue_comments_167906.json:
```json
{
    "body": "Replying to [comment:8 jason]:\n> A while ago we changed polygons to have aspect ratio 1 automatically, IIRC.  So you should add an `aspect_ratio='automatic'` somewhere, maybe as a default option.\nYou are right. Modifying the polygon line to this works.\n\n```\n        for i, (x0,x1) in enumerate(intervals):\n            s += polygon([(x0,0), (x0,counts[i]), (x1,counts[i]), (x1,0)],\n                    aspect_ratio='automatic', **kwds)\n```\n",
    "created_at": "2012-11-30T05:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167906",
    "user": "ppurka"
}
```

Replying to [comment:8 jason]:
> A while ago we changed polygons to have aspect ratio 1 automatically, IIRC.  So you should add an `aspect_ratio='automatic'` somewhere, maybe as a default option.
You are right. Modifying the polygon line to this works.

```
        for i, (x0,x1) in enumerate(intervals):
            s += polygon([(x0,0), (x0,counts[i]), (x1,counts[i]), (x1,0)],
                    aspect_ratio='automatic', **kwds)
```




---

archive/issue_comments_167907.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-11-30T05:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167907",
    "user": "ppurka"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_167908.json:
```json
{
    "body": "Be careful because kwds might contain aspect_ratio...",
    "created_at": "2012-11-30T05:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167908",
    "user": "jason"
}
```

Be careful because kwds might contain aspect_ratio...



---

archive/issue_comments_167909.json:
```json
{
    "body": "But there's a simple way to add to a dictionary only if a key isn't taken, right?  Like [this place](http://stackoverflow.com/questions/11548302/check-if-key-exists-in-dictionary-if-not-append-it) recommends `d.get(k, 'Not available')`.",
    "created_at": "2012-12-01T04:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167909",
    "user": "kcrisman"
}
```

But there's a simple way to add to a dictionary only if a key isn't taken, right?  Like [this place](http://stackoverflow.com/questions/11548302/check-if-key-exists-in-dictionary-if-not-append-it) recommends `d.get(k, 'Not available')`.



---

archive/issue_comments_167910.json:
```json
{
    "body": "Use [setdefault](http://docs.python.org/2/library/stdtypes.html#dict.setdefault).",
    "created_at": "2012-12-01T04:07:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167910",
    "user": "jason"
}
```

Use [setdefault](http://docs.python.org/2/library/stdtypes.html#dict.setdefault).



---

archive/issue_comments_167911.json:
```json
{
    "body": "Now I see why I didn't understand this!   Here's what I get from `T.plot_histogram?`:\n\n```\nDefinition:     T.plot_histogram(self, bins, normalize=50, **kwds=True)\nDocstring:\n       Return histogram plot of this time series with given number of\n       bins.\n    \n```\n\nI couldn't parse that for some reason (though in retrospect it's obvious) and so I assumed `normalize` had a default of `False`.  But of course with `True` this will happen.  So in fact we probably didn't need the import of `Graphics` anyway, which presumably saves a few microseconds somewhere.",
    "created_at": "2012-12-01T15:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167911",
    "user": "kcrisman"
}
```

Now I see why I didn't understand this!   Here's what I get from `T.plot_histogram?`:

```
Definition:     T.plot_histogram(self, bins, normalize=50, **kwds=True)
Docstring:
       Return histogram plot of this time series with given number of
       bins.
    
```

I couldn't parse that for some reason (though in retrospect it's obvious) and so I assumed `normalize` had a default of `False`.  But of course with `True` this will happen.  So in fact we probably didn't need the import of `Graphics` anyway, which presumably saves a few microseconds somewhere.



---

archive/issue_comments_167912.json:
```json
{
    "body": "Attachment [trac_13777-histogram.patch](tarball://root/attachments/some-uuid/ticket13777/trac_13777-histogram.patch) by kcrisman created at 2012-12-01 15:18:21\n\nOkay, needs review.  I added a doctest to check that `aspect_ratio` is passed correctly, which is good to do anyway since with `normalize=False` that might be useful sometimes.\n\nPatchbot, apply trac_13777-histogram.patch.",
    "created_at": "2012-12-01T15:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167912",
    "user": "kcrisman"
}
```

Attachment [trac_13777-histogram.patch](tarball://root/attachments/some-uuid/ticket13777/trac_13777-histogram.patch) by kcrisman created at 2012-12-01 15:18:21

Okay, needs review.  I added a doctest to check that `aspect_ratio` is passed correctly, which is good to do anyway since with `normalize=False` that might be useful sometimes.

Patchbot, apply trac_13777-histogram.patch.



---

archive/issue_comments_167913.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-01T15:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167913",
    "user": "kcrisman"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_167914.json:
```json
{
    "body": "Everything works well. Positive review.",
    "created_at": "2012-12-01T15:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167914",
    "user": "ppurka"
}
```

Everything works well. Positive review.



---

archive/issue_comments_167915.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-01T15:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167915",
    "user": "ppurka"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167916.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-18T11:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13573",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13573#issuecomment-167916",
    "user": "jdemeyer"
}
```

Resolution: fixed
