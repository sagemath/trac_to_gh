# Issue 13573: Fix TimeSeries histogram plotting

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2012-11-30 02:50:36

Assignee: jason, was

CC:  jason ppurka

Turns out that this has been broken for a while.  Yuck.  The fix is a few characters.  This is a stopgap of sorts for when #9671 is ever fixed...


---

Comment by kcrisman created at 2012-11-30 02:52:11

Needs review.  No doctest needed since basically no one had ever _looked_ at the doctest, which is all that would have been needed!


---

Comment by kcrisman created at 2012-11-30 02:52:11

Changing status from new to needs_review.


---

Comment by kcrisman created at 2012-11-30 02:54:37

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2012-11-30 02:54:37

Oops, this was in a Cython file.  Needs work.


---

Comment by ppurka created at 2012-11-30 03:10:42

You need to import Graphics two lines above to make it compile. But that doesn't fix the histogram. :)


---

Comment by kcrisman created at 2012-11-30 03:33:33

Okay, this seems to work.


---

Comment by kcrisman created at 2012-11-30 03:33:33

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2012-11-30 03:34:41

> You need to import Graphics two lines above to make it compile. But that doesn't fix the histogram. :)
Yes, I saw that - too bad Trac doesn't auto-update :)  But somehow it works for me now.


---

Attachment


---

Comment by ppurka created at 2012-11-30 03:42:51

I get [attachment:shot-2012-11-30_11-41-17.jpg this output]. Don't see any histogram.


---

Comment by kcrisman created at 2012-11-30 03:52:30

> I get [attachment:shot-2012-11-30_11-41-17.jpg this output]. Don't see any histogram.
Yeah, I only got the right thing once.  What the heck do we have to do to fix this?  It works fine in the command line.  Trying to import other things like `line` don't work either.  And most frustratingly, it worked exactly once in the compiled version!


---

Comment by jason created at 2012-11-30 04:59:59

A while ago we changed polygons to have aspect ratio 1 automatically, IIRC.  So you should add an `aspect_ratio='automatic'` somewhere, maybe as a default option.


---

Comment by ppurka created at 2012-11-30 05:24:12

Replying to [comment:8 jason]:
> A while ago we changed polygons to have aspect ratio 1 automatically, IIRC.  So you should add an `aspect_ratio='automatic'` somewhere, maybe as a default option.
You are right. Modifying the polygon line to this works.

```
        for i, (x0,x1) in enumerate(intervals):
            s += polygon([(x0,0), (x0,counts[i]), (x1,counts[i]), (x1,0)],
                    aspect_ratio='automatic', **kwds)
```



---

Comment by ppurka created at 2012-11-30 05:24:30

Changing status from needs_review to needs_work.


---

Comment by jason created at 2012-11-30 05:32:08

Be careful because kwds might contain aspect_ratio...


---

Comment by kcrisman created at 2012-12-01 04:02:17

But there's a simple way to add to a dictionary only if a key isn't taken, right?  Like [this place](http://stackoverflow.com/questions/11548302/check-if-key-exists-in-dictionary-if-not-append-it) recommends `d.get(k, 'Not available')`.


---

Comment by jason created at 2012-12-01 04:07:56

Use [setdefault](http://docs.python.org/2/library/stdtypes.html#dict.setdefault).


---

Comment by kcrisman created at 2012-12-01 15:12:51

Now I see why I didn't understand this!   Here's what I get from `T.plot_histogram?`:

```
Definition:     T.plot_histogram(self, bins, normalize=50, **kwds=True)
Docstring:
       Return histogram plot of this time series with given number of
       bins.
    
```

I couldn't parse that for some reason (though in retrospect it's obvious) and so I assumed `normalize` had a default of `False`.  But of course with `True` this will happen.  So in fact we probably didn't need the import of `Graphics` anyway, which presumably saves a few microseconds somewhere.


---

Attachment

Okay, needs review.  I added a doctest to check that `aspect_ratio` is passed correctly, which is good to do anyway since with `normalize=False` that might be useful sometimes.

Patchbot, apply trac_13777-histogram.patch.


---

Comment by kcrisman created at 2012-12-01 15:18:21

Changing status from needs_work to needs_review.


---

Comment by ppurka created at 2012-12-01 15:31:57

Everything works well. Positive review.


---

Comment by ppurka created at 2012-12-01 15:31:57

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-12-18 11:17:48

Resolution: fixed
