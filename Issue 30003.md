# Issue 30003: Graphs: a few distance-regular graphs

Issue created by migration from https://trac.sagemath.org/ticket/30240

Original creator: @Ivo-Maffei

Original creation time: 2020-07-28 14:47:22

CC:  dimpase

Keywords: distance_regular_graph drg

Implemented a few distance-regular graphs for a database of such graphs.


---

Comment by @Ivo-Maffei created at 2020-07-28 14:47:54

Changing status from new to needs_review.


---

Comment by dcoudert created at 2020-07-29 17:40:00

Hello,

can you move the file `distance_regular.pyx` to the subdirectory `generators/`. This is certainly a better place for generators.

Also, what's the added value of using python instead of python here ? Do you have any plan for further improvements ? I'm not against python here, I just want to understand the motivation.

The patchbot reports an issue with gap during the construction `G = graphs.graph_3O73()`.


---

Comment by git created at 2020-07-29 19:04:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @Ivo-Maffei created at 2020-07-29 19:05:14

Replying to [comment:2 dcoudert]:
> can you move the file `distance_regular.pyx` to the subdirectory `generators/`. 
Sure!

> Also, what's the added value of using python instead of python here ? Do you have any plan for further improvements ? 
I'm using Cython mainly to speed things up a bit. I have quite a lot of graphs that will end up here, but I thought that many small tickets are better than a huge one.

> The patchbot reports an issue with gap during the construction `G = graphs.graph_3O73()`.
Should be fixed now.

(Also rebased branch on 9.2.beta6)


---

Comment by dcoudert created at 2020-07-30 09:29:34

I fully agree that small tickets are better ;)
In the future, i suggest to name branch like `public/graphs/30240` so that I can directly push a review commit for minor corrections.

A few comments:

- ensure that comments are formatted in 80 columns mode. Not sure it is the case now

- typos

```diff
-Dabase of distance regular graphs
+Database of distance regular graphs
```

- several times

```diff
-    This is a distance-regular graph with intersecion array
+    This is a distance-regular graph with intersection array
```


- wha's the reason for choosing 100 ?
- PEP8

```diff
-        for j in range(i+1,100):
+        for j in range(i + 1, 100):
```


```diff
-                sC2 = frozenset(cocliques[j])
-                edges.append( (sC,sC2) )
+                edges.append((sC, rozenset(cocliques[j])))
```


```diff
-    G = Graph(edges,format="list_of_edges")
+    G = Graph(edges, format="list_of_edges")
```



```diff
-    H = libgap.AtlasGroup("3^2.U4(3).D8",libgap.NrMovedPoints,756)
+    H = libgap.AtlasGroup("3^2.U4(3).D8", libgap.NrMovedPoints, 756)
```



```diff
-    G = Graph(libgap.Orbit(N,[1,9],libgap.OnSets), format='list_of_edges')
+    G = Graph(libgap.Orbit(N, [1, 9], libgap.OnSets), format='list_of_edges')
```



- `if x == 0` -> `if not x`
- `x == z2+1` -> `x == z2 + 1`  this is to improve readability (PEP8)
- `#create e_i` -> `# create e_i`   this is to avoid confusion with compilers macros
- `ei = [0]*6` -> `ei = [0] * 6`  or directly `ei = [0, 0, 0, 0, 0, 0]` ?

- possibly simpler code

```diff
-    def has_edge(u,v):
-        com = 0
-        for i in range(6):
-            com += u[i].conjugate() * v[i]
-
-        if com == 2:
-            return True
-        return False
+    def has_edge(u, v):
+        return sum(u[i].conjugate() * v[i] for i in range(6)) == 2
```


- you could add a loop so set all `K[i]` to immutable first. I think you do that many times.


---

Comment by dcoudert created at 2020-07-30 09:29:34

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-07-30 10:13:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Ivo-Maffei created at 2020-07-30 10:18:11

Changing status from needs_work to needs_review.


---

Comment by @Ivo-Maffei created at 2020-07-30 10:18:11

Replying to [comment:5 dcoudert]:
Thanks for the feedback
> - ensure that comments are formatted in 80 columns mode. Not sure it is the case now
Unless my editor is wrong, there are only 2 lines that reach (and don't exceed) column 80 (line 40 and 243).

> - wha's the reason for choosing 100 ?
There are only 100 cocliques, so to iterate over the list I use `range(100)`.

> - `if x == 0` -> `if not x`
Personally I find the rhs more confusing as I read it as `if x is not None` (especially since `x` is not an `int`).
I changed it to `if  x.is_zero()`. If PEP8 or Sage insist with `if not x`, I'll change it right away.


---

Comment by dcoudert created at 2020-07-30 11:05:28

I'm not insisting for the `not x` ;)

may be you can do:

```
cocliques = [frozenset(c) for c in DC.cliques_maximum()]

edges = []
import itertools
for sC, sC2 in itertools.combinations(cocliques, 2):
    if len(sC.intersection(sC2)) == 8:
        edges.append((sC, sC2))
```


similarly

```
-    for i in range(length):
-        for j in range(i + 1, length):
+    for Ki, Kj in itertools.combinations(K, 2):
```


I agree it's minor changes.


---

Comment by git created at 2020-07-30 11:34:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-07-31 13:40:20

`AtlasRep` is always installed together with GAP, it's not a part of gap_packages.
These tests, however, need to be tagged with `internet` rather tnan `gap_packages`, as `AtlasRep` pulls data from the net (and caches it if it can).


---

Comment by dimpase created at 2020-07-31 13:40:20

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-07-31 17:43:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Ivo-Maffei created at 2020-07-31 17:44:18

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-07-31 20:47:17

The name of the graph function `locally_GQ42_graph()` is not good. There are more locally GQ42 graphs (I even found one myself many years ago, see https://mathscinet.ams.org/mathscinet-getitem?mr=1357771 :-))

Probably `locally_GQ42_distance_transitive_graph()` is better.
(There is also the 3-fold quotient of this graph - but it is strongly regular, so no confusion should arise).

Also the docstring for this graph should be improved; it says

```
 Return the unique amply regular graph which is locally a generalised
 quadrangle.
```

but this is not unique such a graph, as it's 3-fold quotient is also amply regular
(all strongly regular graphs are)

Please also add `REFERENCES:` sectuion to all the graphs in this branch.


---

Comment by git created at 2020-08-01 08:15:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Ivo-Maffei created at 2020-08-01 08:20:32

Replying to [comment:13 dimpase]:

> Also the docstring for this graph should be improved; it says
> {{{
>  Return the unique amply regular graph which is locally a generalised
>  quadrangle.
> }}}
> but this is not unique such a graph, as it's 3-fold quotient is also amply regular
> (all strongly regular graphs are)
I looked closer at what is written in BCN and they say the graph is the unique amply regular graph with `\mu = 6`.
I'm not sure that's true, tough.

> Please also add `REFERENCES:` sectuion to all the graphs in this branch.
I've added them and I think the construction of `locally_GQ42_distance_transitive_graph` is actually due to you as is not the one given in BCN.


---

Comment by git created at 2020-08-01 08:21:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-08-01 08:41:05

Replying to [comment:15 gh-Ivo-Maffei]:
> Replying to [comment:13 dimpase]:
> 
> > Also the docstring for this graph should be improved; it says
> > {{{
> >  Return the unique amply regular graph which is locally a generalised
> >  quadrangle.
> > }}}
> > but this is not unique such a graph, as it's 3-fold quotient is also amply regular
> > (all strongly regular graphs are)
> I looked closer at what is written in BCN and they say the graph is the unique amply regular graph with `\mu = 6`.

yes, that's correct - you do need mu=6, though.
There is a locally GQ(4,2) graph with mu=18 (an s.r.g)
`graphs.strongly_regular_graph(126,45,12,18)`
 
> I'm not sure that's true, tough.
so, add that mu=6 there then.

> 
> > Please also add `REFERENCES:` sectuion to all the graphs in this branch.
> I've added them and I think the construction of `locally_GQ42_distance_transitive_graph` is actually due to you as is not the one given in BCN.

huh? see [BCN], 13.2.C and p.397 for references. It seems that [688] is the earliest - but why don't you just refer to [BCN], 13.2.C ?


---

Comment by @Ivo-Maffei created at 2020-08-01 09:32:57

I cited BCN 13.2.C for a description of the graph, however the construction that takes a normal subgroup of `3^2.U4(3).D8` is hard to deduce from that section and I think it is something you came up during one of our meetings. 
I can remove the sentence citing you if you wish.


---

Comment by dimpase created at 2020-08-01 12:04:30

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-08-01 12:04:30

OK, fine.


---

Comment by dcoudert created at 2020-08-01 13:12:49

small indentation issue

```diff
-    for c1, c2 in itertools.combinations(cocliques, 2):
-        if len(c1.intersection(c2)) == 8:
-                edges.append((c1, c2))
+    for c1, c2 in itertools.combinations(cocliques, 2):
+        if len(c1.intersection(c2)) == 8:
+            edges.append((c1, c2))
```

once corrected, you can set back the ticket to positive review.


---

Comment by dcoudert created at 2020-08-01 13:12:49

Changing status from positive_review to needs_work.


---

Comment by git created at 2020-08-01 14:46:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Ivo-Maffei created at 2020-08-01 14:47:19

Changing status from needs_work to positive_review.


---

Comment by dcoudert created at 2020-08-03 09:23:08

#30277 removes file `src/module_list.py` from sagemath, so this ticket should not write in it.

When this part is removed from this ticket, you can set it back to positive review.

Thanks.


---

Comment by dcoudert created at 2020-08-03 09:23:08

Changing status from positive_review to needs_work.


---

Comment by dimpase created at 2020-08-03 09:47:27

Oh, right, this ticket should be based on #30277, indeed. Sorry for missing this.


---

Comment by dimpase created at 2020-08-03 10:00:20

my understanding is that you just have to remove any changed to `src/module_list.py` - the rest is the same.


---

Comment by dimpase created at 2020-08-03 12:15:10

Two-stage rebase worked for me - 

 1) rebase the current branch over the latest beta (beta7)

 2) rebase the result over the branch of #30277


---

Comment by dcoudert created at 2020-08-03 12:19:51

May be you should push the result to a new branch ? I don't know if Ivo knows how to do that (not sure I can do it myself, I'm a basic git user...).


---

Comment by @Ivo-Maffei created at 2020-08-03 12:34:25

I can do it. You would need to wait until my update to sage 9.2.beta7 is complete, though


---

Comment by git created at 2020-08-03 13:04:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by dimpase created at 2020-08-03 14:05:06

unfortunately my (perhaps wrong) tests indicate that #30277 is broken. Some pyx modules are not discovered and built in, somehow


---

Comment by git created at 2020-08-04 07:59:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Ivo-Maffei created at 2020-08-04 08:00:55

I found a bug because the module `sage.graphs.distance_regular` had path sage/graphs/generators/distance_regular.pyx
Everything else seems to work. Do you have a specific example where things go bad?


---

Comment by dimpase created at 2020-08-04 09:41:08

`graph_3073()` does not work for me as `libgap.AtlasGroup("3.O7(3)", libgap.NrMovedPoints, 1134)` returns `fail`. Did it ever work?


---

Comment by dimpase created at 2020-08-04 09:44:39

It seems that `AtlasGroup` only knows `3.O7(3)` as a 27-dimensional matrix group  over GF(4).


---

Comment by dimpase created at 2020-08-04 09:47:50

Replying to [comment:32 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[4e17fd7](https://git.sagemath.org/sage.git/commit/?id=4e17fd7fd738e0d1a376a8212fbbf44ea9262646)||`fixed bug introduced by removing module_list`||

it is less clutter to write there simply

```
from .generators import smallgraphs, distance_regular
```



---

Comment by @Ivo-Maffei created at 2020-08-04 10:00:43

Replying to [comment:34 dimpase]:
> `graph_3073()` does not work for me as `libgap.AtlasGroup("3.O7(3)", libgap.NrMovedPoints, 1134)` returns `fail`. Did it ever work?
I get the following:

```
sage: graphs.graph_3O73()
Distance transitive graph with automorphism group 3.O_7(3): Graph on 1134 vertices
sage: G=_
sage: G.is_distance_regular(True)
([117, 80, 24, 1, None], [None, 1, 12, 80, 117])
sage: libgap.DisplayAtlasInfo("3.O7(3)")
Representations for G = 3.O7(3):    (all refer to std. generators 1)
--------------------------------
1: G <= Sym(1134)* rank 7, on cosets of L4(3).2_2<3xL4(3).2_2
2: G <= GL(27a,4)  

Programs for G = 3.O7(3):    (all refer to std. generators 1)
-------------------------
- kernels*:
  3.O7(3) -> O7(3)*             
- maxes (11 out of 15):
   1*:  6_1.U4(3).2_2           
   2*:  3.3^5:U4(2):2           
   3*:  3xL4(3).2_2             
   4*:  3.G2(3)                 
   6*:  3.(3^(3+3):L3(3))       
   7*:  3xS6(2)                 
   9*:  3.3^(1+6)_+.(2A4xA4).2  
  12*:  3x(2^2xU4(2)):2         
  13*:  2^6:3A7                 
  14*:  3xS6xS4                 
  15*:  3.(A4x2(A4xA4).2).2
```

Maybe we have different versions of GAP installed?

```
% sage -gap
 ┌───────┐   GAP 4.10.2 of 19-Jun-2019
 │  GAP  │   https://www.gap-system.org
 └───────┘   Architecture: x86_64-apple-darwin19.4.0-default64-kv3
 Configuration:  gmp 6.0.0, readline
```



---

Comment by git created at 2020-08-04 10:02:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-08-04 13:59:45

Replying to [comment:37 gh-Ivo-Maffei]:
> Replying to [comment:34 dimpase]:
> > `graph_3073()` does not work for me as `libgap.AtlasGroup("3.O7(3)", libgap.NrMovedPoints, 1134)` returns `fail`. Did it ever work?
> I get the following:

right, sorry, I got the error because I didn't have `gap_packages` installed, and they provide extra data needed in this case. That is, these tests should be tagged with `gap_packages`, too, not only `internet`.


---

Comment by dimpase created at 2020-08-04 14:14:50

test, please ignore.


---

Comment by @Ivo-Maffei created at 2020-08-04 14:36:56

Replying to [comment:39 dimpase]:
> right, sorry, I got the error because I didn't have `gap_packages` installed, and they provide extra data needed in this case. That is, these tests should be tagged with `gap_packages`, too, not only `internet`.
Just to be sure, only the tests for `graph_7073` or does `locally_GQ42_distance_transitive_graph` need it too?

Is there a way to check what optional packages are really needed without having another sage installation?


---

Comment by dimpase created at 2020-08-04 17:33:54

`make gap_packages-clean` should uninstall this one. Iirc, only that one graph needed
gap_packages installed, not sure, away from kbd now.


---

Comment by dimpase created at 2020-08-04 21:32:15

Just tag all the tests using AtlasGroup with `gap_packages`, in addtion to `internet`.


---

Comment by git created at 2020-08-05 08:22:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @Ivo-Maffei created at 2020-08-05 08:55:37

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2020-08-10 19:51:21

LGTM


---

Comment by dimpase created at 2020-08-10 19:51:21

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-08-14 22:23:38

Resolution: fixed
