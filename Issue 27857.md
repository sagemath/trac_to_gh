# Issue 27857: support function fields in characteristic zero

Issue created by migration from https://trac.sagemath.org/ticket/28094

Original creator: @BrentBaccala

Original creation time: 2019-07-01 18:14:29

Keywords: function fields

Current function field code only works in prime characteristic.

First step is to support function fields over QQ and NumberField's.

Next step is to support function fields over QQbar.


---

Comment by @BrentBaccala created at 2019-10-10 01:22:03

Description of algorithm to decompose prime ideals in an extension


---

Attachment

LaTex source of decomposition.pdf


---

Attachment

Last 10 new commits:


---

Comment by git created at 2019-10-11 03:05:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @BrentBaccala created at 2019-10-11 03:08:08

Current status of this ticket:

1. It mostly works!

2. There's a new algorithm (see attached pdf and tex files) to compute decomposition of prime ideals in extension fields.  The older algorithm, which only works in characteristic p, is still used in characteristic p.

3. One way of testing the new decomposition algorithm is to comment out the old algorithm.  This produces a bunch of failures in the test cases, but they all look like different ways of writing the same ideals, not actual failures.

4. It needs test cases.  Lots of them.  We have almost no tests for characteristic zero.  Many of the characteristic p test cases could be adapted to characteristic zero.

5. Once Trac #25390 is integrated, it should work over the algebraic field.


---

Comment by git created at 2019-10-11 16:38:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-11 16:46:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-24 19:53:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-24 19:54:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-27 18:09:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-10-27 18:09:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @BrentBaccala created at 2019-10-27 18:11:11

Changing status from new to needs_review.


---

Comment by git created at 2019-11-04 22:20:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-11-05 01:14:17

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2019-11-05 01:14:17

Some little things from a quick read through:


```diff
         - ``separating_element`` -- separating element of the function field;
-            the default is the generator of the rational function field
+          the default is the generator of the rational function field
```


```diff
-Function fields over the rational field are supported:
+Function fields over the rational field are supported::
```


```diff
-    G.-M.Greuel, S.Laplagne, F.Seelisch: Normalization of Rings (2009).
+    G.-M. Greuel, S. Laplagne, F. Seelisch: Normalization of Rings (2009).
```


Missing doctests on `_singular_normal` and `FunctionFieldIdeal_global.__init__` (which should be a `TestSuite(foo).run()`).

In `FunctionFieldIdeal_global.gens_two()`, it should be `ALGORITHM:` and no indentation there, and without dollar signs.

In `FunctionFieldHigherDerivation_charzero._derive`, I don't see the point of the internal `derive` function. Also, I believe it is considered better practice to do `def derivative(f): return f.derivative()` since you are naming the function.

In `FunctionFieldMaximalOrder_global.decomposition`, the `.. TODO::` block needs to be indented. I would also do

```diff
-is done in `FunctionFieldMaximalOrder_global`'s `decomposition`
+is done in :meth:`FunctionFieldMaximalOrder_global.decomposition()`
```



---

Comment by git created at 2019-12-01 04:45:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @BrentBaccala created at 2019-12-01 04:51:50

Changing status from needs_work to needs_review.


---

Comment by @BrentBaccala created at 2019-12-01 04:51:50

I've addressed all of the issues from comment:12 and have fixed a serious bug that I uncovered with some more testing.

I'd like to add some more test cases for function fields over `QQbar` (and likely will), but other than that I again think that this ticket is ready for review.


---

Comment by klee created at 2019-12-06 07:01:54

Changing status from needs_review to needs_work.


---

Comment by klee created at 2019-12-06 07:01:54

Before the patch, 

```
sage: K.<x> = FunctionField(GF(3))
sage: _.<Y> = K[]
sage: L.<y> = K.extension(Y-x)
sage: y.zeros()
[Place (x)]
```

After the patch, 

```
sage: K.<x> = FunctionField(GF(3))
sage: _.<Y> = K[]
sage: L.<y> = K.extension(Y-x)
sage: y.zeros()
[Place (x, 0)]
```



---

Comment by git created at 2019-12-06 21:28:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @BrentBaccala created at 2019-12-06 21:30:38

Changing status from needs_work to needs_review.


---

Comment by @BrentBaccala created at 2019-12-06 21:30:38

Replying to [comment:15 klee]:

Looks like I dropped some code during one of my refactoring steps.  Fixed.


---

Comment by git created at 2019-12-10 05:36:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-12-12 04:33:55

Kwankyu, can you do a check of the mathematical correctness? I can recheck the code, but I doubt there will be anything more from my side.


---

Comment by klee created at 2019-12-12 05:14:41

Replying to [comment:19 tscrim]:
> Kwankyu, can you do a check of the mathematical correctness? I can recheck the code, but I doubt there will be anything more from my side.

Ok. That is on my to-do list.


---

Comment by git created at 2019-12-19 06:09:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-12-19 06:23:54

It is a nice work.  I made lots of small changes to tidy up the overall function field code. Most of them are just for better style  and for better naming. I made also some refactoring to add more functionality to function fields of char zero.

I give positive review on the base code. Please review on my part of modifications.  Then this is good to go.


---

Comment by klee created at 2019-12-19 10:20:29

I observe a serious speed regression on computing maximal orders of global function fields:

Previously,

```
sage: k.<a>=GF(3^3)
....: K.<x>=FunctionField(k); _.<s>=K[]
....: L.<y>=K.extension(s^9 + x^72*s^3 + x^96*s + 2*x^104 + 2*x^96) 
....: 
sage: time L.maximal_order()
CPU times: user 3.41 s, sys: 33.8 ms, total: 3.44 s
Wall time: 3.45 s
Maximal order of Function field in y defined by y^9 + x^72*y^3 + x^96*y + 2*x^104 + 2*x^96
```

Now with the patch,

```
sage: k.<a>=GF(3^3)
....: K.<x>=FunctionField(k); _.<s>=K[]
....: L.<y>=K.extension(s^9 + x^72*s^3 + x^96*s + 2*x^104 + 2*x^96) 
....: 
sage: time L.maximal_order()
CPU times: user 35.1 s, sys: 168 ms, total: 35.3 s
Wall time: 35.2 s
Maximal order of Function field in y defined by y^9 + x^72*y^3 + x^96*y + 2*x^104 + 2*x^96
```


This is actually expected because now  Singular's generic normalization algorithm is used while previously a custom implementation (in `ext/singular/function_field/core.lib`)of Leonard-Pellikaan-Singh-Swanson algorithm  specialized for finite field was used.

I think we should recover the previous algorithm for global function fields.


---

Comment by git created at 2019-12-19 12:03:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-12-19 12:17:02

By the way, I get this timing on Mac pro

```
sage: k.<a>=GF(3^3)
....: K.<x>=FunctionField(k); _.<s>=K[]
....: L.<y>=K.extension(s^9 + x^72*s^3 + x^96*s + 2*x^104 + 2*x^96) 
....: 
sage: time L.genus() # 5.08s    
CPU times: user 27.3 s, sys: 83.7 ms, total: 27.4 s
Wall time: 27.4 s
12
```

5.08s is the timing I got more than two years ago on a slower  labtop. I wonder what have happened with sage meanwhile. Sigh..


---

Comment by @BrentBaccala created at 2019-12-20 02:36:34

Approved.  We can study the performance regression on another ticket.


---

Comment by @BrentBaccala created at 2019-12-20 02:36:34

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-12-20 08:12:53

no author name and no reviewer name !


---

Comment by vbraun created at 2019-12-25 19:09:34

Resolution: fixed
