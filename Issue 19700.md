# Issue 19700: Implement generic __div__ and _div_ in the categories

archive/issues_019700.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/19937\n\n",
    "created_at": "2016-01-21T16:51:18Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Implement generic __div__ and _div_ in the categories",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19700",
    "user": "@nthiery"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/19937





---

archive/issue_comments_270785.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to categories.",
    "created_at": "2016-01-21T17:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270785",
    "user": "@nthiery"
}
```

Changing component from PLEASE CHANGE to categories.



---

archive/issue_comments_270786.json:
```json
{
    "body": "Changing keywords from \"\" to \"coercion\".",
    "created_at": "2016-01-21T17:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270786",
    "user": "@nthiery"
}
```

Changing keywords from "" to "coercion".



---

archive/issue_comments_270787.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2016-01-21T17:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270787",
    "user": "@nthiery"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_270788.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-01-21T17:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270788",
    "user": "@nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_270789.json:
```json
{
    "body": "We started a discussion on sage-devel about moving all of the coercion buisness (i.e. implementation of `__mul__`, `__div__`, etc) at the level of `Element`. See\n\n    https://groups.google.com/forum/#!topic/sage-devel/k1bBQEWB9uI\n\nThis would be lost of time to also have this implementation in categories. But it might be a reasonable path for a transition. Anyway, it would be good to advertise this ticket on the thread.\n----\nNew commits:",
    "created_at": "2016-01-21T19:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270789",
    "user": "@videlec"
}
```

We started a discussion on sage-devel about moving all of the coercion buisness (i.e. implementation of `__mul__`, `__div__`, etc) at the level of `Element`. See

    https://groups.google.com/forum/#!topic/sage-devel/k1bBQEWB9uI

This would be lost of time to also have this implementation in categories. But it might be a reasonable path for a transition. Anyway, it would be good to advertise this ticket on the thread.
----
New commits:



---

archive/issue_comments_270790.json:
```json
{
    "body": "What is the advantage of putting these in `ElementMethods` in the category as opposed to directly in `Element` or `RingElement` or `WhateverElement`?",
    "created_at": "2016-01-21T19:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270790",
    "user": "@jdemeyer"
}
```

What is the advantage of putting these in `ElementMethods` in the category as opposed to directly in `Element` or `RingElement` or `WhateverElement`?



---

archive/issue_comments_270791.json:
```json
{
    "body": "Hi Vincent, Jeroen,\n\nThanks for the pointer to the discussion on sage-devel. I'll mention\nthis ticket there.\n\nDue to the lack of multiple inheritance in Cython, we cannot have a\ncommon Cython base class for all parents having the appropriate\nmultiplicative structure to define `__div__`. Besides there are\nparents where you only know at initialization time whether they have\nthat appropriate structure; the elements of those can there only\ninherit statically from Element.\n\nBecause of this, putting the `__div__` method in `RingElement` and its\nvariants (`MultiplicativeGroupElement`, ...) is not sufficient to cover\nall the use cases. Having `__div__` there also encourages people to inherit\nfrom `RingElement` with no mathematical justification (see\ne.g. `GapElement` in libgap). Hence the need to have a copy of this\nmethod in the categories.\n\n\nAn alternative option would indeed be to move all the `__div__`,\n`__mul__`, ...  methods in `Element`. This has the advantage of\nenabling coercion for every Sage `Element`. This has the disadvantage\nof polluting the namespace of many objects with irrelevant methods.\n\nI don't have a strong opinion myself.\n\nIn any cases, `_div_` belongs to this category and this ticket solves\nthe problem for now in a consistent way with what's done for the\nadditive structure and friends. It's also trivial to remove/move the\n`__div__` method it defines. Therefore, unless moving `__div__` and\nfriends to `Element` is decided and implemented very quickly, I\nsuggest that we get this ticket in. I need this feature for the\nSage-GAP interface enhancements I am working on right now in St\nAndrews.\n\nCheers,\n                                    Nicolas",
    "created_at": "2016-01-21T22:29:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270791",
    "user": "@nthiery"
}
```

Hi Vincent, Jeroen,

Thanks for the pointer to the discussion on sage-devel. I'll mention
this ticket there.

Due to the lack of multiple inheritance in Cython, we cannot have a
common Cython base class for all parents having the appropriate
multiplicative structure to define `__div__`. Besides there are
parents where you only know at initialization time whether they have
that appropriate structure; the elements of those can there only
inherit statically from Element.

Because of this, putting the `__div__` method in `RingElement` and its
variants (`MultiplicativeGroupElement`, ...) is not sufficient to cover
all the use cases. Having `__div__` there also encourages people to inherit
from `RingElement` with no mathematical justification (see
e.g. `GapElement` in libgap). Hence the need to have a copy of this
method in the categories.


An alternative option would indeed be to move all the `__div__`,
`__mul__`, ...  methods in `Element`. This has the advantage of
enabling coercion for every Sage `Element`. This has the disadvantage
of polluting the namespace of many objects with irrelevant methods.

I don't have a strong opinion myself.

In any cases, `_div_` belongs to this category and this ticket solves
the problem for now in a consistent way with what's done for the
additive structure and friends. It's also trivial to remove/move the
`__div__` method it defines. Therefore, unless moving `__div__` and
friends to `Element` is decided and implemented very quickly, I
suggest that we get this ticket in. I need this feature for the
Sage-GAP interface enhancements I am working on right now in St
Andrews.

Cheers,
                                    Nicolas



---

archive/issue_comments_270792.json:
```json
{
    "body": "Replying to [comment:7 nthiery]:\n\nHola,\n\nI basically agree with you. Except that spoiling the namespace with `__div__` and `__mul__` is much better than with `numerical_approx`, `subs`, `substitute`, `is_zero`, `cartesian_product`, `base_ring`, `base_extend`, `N`, ...\n\nDepending of how the reheat of the thread goes on we could:\n- actually move the `__div__` and friends to `Element` (that should not be hard)\n- adopt the (possibly temporary) solution as suggested in your branch. In which case, it would be better to mention in the docstring that we might move this to `Element`\n\nHave nice time in St Andrews!\nVincent",
    "created_at": "2016-01-21T22:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270792",
    "user": "@videlec"
}
```

Replying to [comment:7 nthiery]:

Hola,

I basically agree with you. Except that spoiling the namespace with `__div__` and `__mul__` is much better than with `numerical_approx`, `subs`, `substitute`, `is_zero`, `cartesian_product`, `base_ring`, `base_extend`, `N`, ...

Depending of how the reheat of the thread goes on we could:
- actually move the `__div__` and friends to `Element` (that should not be hard)
- adopt the (possibly temporary) solution as suggested in your branch. In which case, it would be better to mention in the docstring that we might move this to `Element`

Have nice time in St Andrews!
Vincent



---

archive/issue_comments_270793.json:
```json
{
    "body": "Did you mean that thread from last fall or was there some more recent discussion specifically on that?\n\nhttps://groups.google.com/d/msg/sage-devel/k1bBQEWB9uI/KawvRce3BQAJ",
    "created_at": "2016-01-21T23:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270793",
    "user": "@nthiery"
}
```

Did you mean that thread from last fall or was there some more recent discussion specifically on that?

https://groups.google.com/d/msg/sage-devel/k1bBQEWB9uI/KawvRce3BQAJ



---

archive/issue_comments_270794.json:
```json
{
    "body": "This is it. I do not remember of anything more recent about it.",
    "created_at": "2016-01-21T23:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270794",
    "user": "@videlec"
}
```

This is it. I do not remember of anything more recent about it.



---

archive/issue_comments_270795.json:
```json
{
    "body": "Shouldn't this be `__truediv__` and have `__div__` as an alias as per #18578 for Python3 compatibility?",
    "created_at": "2016-01-22T03:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270795",
    "user": "@tscrim"
}
```

Shouldn't this be `__truediv__` and have `__div__` as an alias as per #18578 for Python3 compatibility?



---

archive/issue_comments_270796.json:
```json
{
    "body": "Replying to [comment:7 nthiery]:\n> Due to the lack of multiple inheritance in Cython\nFor the record, this has not much to do with Cython, but with Python. Too many things are being blamed on Cython which are really Python issues.\n\nReplying to [comment:8 vdelecroix]:\n> Depending of how the reheat of the thread goes on we could:\n> - actually move the `__div__` and friends to `Element` (that should not be hard)\nIndeed, not hard, but somebody has to do it. In any case, I would prefer to wait for #269 to avoid conflicts.\n\n> - adopt the (possibly temporary) solution as suggested in your branch.\nIf it solves an actual problem you're having, I don't mind.\n\nReplying to [comment:11 tscrim]:\n> Shouldn't this be `__truediv__` and have `__div__` as an alias as per #18578 for Python3 compatibility?\n\nAbsolutely.",
    "created_at": "2016-01-22T08:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270796",
    "user": "@jdemeyer"
}
```

Replying to [comment:7 nthiery]:
> Due to the lack of multiple inheritance in Cython
For the record, this has not much to do with Cython, but with Python. Too many things are being blamed on Cython which are really Python issues.

Replying to [comment:8 vdelecroix]:
> Depending of how the reheat of the thread goes on we could:
> - actually move the `__div__` and friends to `Element` (that should not be hard)
Indeed, not hard, but somebody has to do it. In any case, I would prefer to wait for #269 to avoid conflicts.

> - adopt the (possibly temporary) solution as suggested in your branch.
If it solves an actual problem you're having, I don't mind.

Replying to [comment:11 tscrim]:
> Shouldn't this be `__truediv__` and have `__div__` as an alias as per #18578 for Python3 compatibility?

Absolutely.



---

archive/issue_comments_270797.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-01-22T08:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270797",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_270798.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-22T16:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270798",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_270799.json:
```json
{
    "body": "Thanks for the `__truediv__` info! I had missed that point. Let's get this in.",
    "created_at": "2016-01-22T17:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270799",
    "user": "@nthiery"
}
```

Thanks for the `__truediv__` info! I had missed that point. Let's get this in.



---

archive/issue_comments_270800.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-01-22T17:04:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270800",
    "user": "@nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_270801.json:
```json
{
    "body": "For the record: I double checked Sam's changes over his shoulders.\n----\nNew commits:",
    "created_at": "2016-01-23T23:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270801",
    "user": "@nthiery"
}
```

For the record: I double checked Sam's changes over his shoulders.
----
New commits:



---

archive/issue_comments_270802.json:
```json
{
    "body": "The patchbot was happy, I just added a line of documentation. Positive review.",
    "created_at": "2016-01-23T23:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270802",
    "user": "@slel"
}
```

The patchbot was happy, I just added a line of documentation. Positive review.



---

archive/issue_comments_270803.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-01-23T23:24:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270803",
    "user": "@slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_270804.json:
```json
{
    "body": "Changing keywords from \"coercion\" to \"coercion, days70.5\".",
    "created_at": "2016-01-24T00:32:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270804",
    "user": "@nthiery"
}
```

Changing keywords from "coercion" to "coercion, days70.5".



---

archive/issue_comments_270805.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-01-24T12:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19700",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19700#issuecomment-270805",
    "user": "@vbraun"
}
```

Resolution: fixed
