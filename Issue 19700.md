# Issue 19700: Implement generic __div__ and _div_ in the categories

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2016-01-21 16:51:18




---

Comment by nthiery created at 2016-01-21 17:01:53

Changing component from PLEASE CHANGE to categories.


---

Comment by nthiery created at 2016-01-21 17:01:53

Changing keywords from "" to "coercion".


---

Comment by nthiery created at 2016-01-21 17:01:53

Changing type from PLEASE CHANGE to enhancement.


---

Comment by nthiery created at 2016-01-21 17:01:53

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2016-01-21 19:05:34

We started a discussion on sage-devel about moving all of the coercion buisness (i.e. implementation of `__mul__`, `__div__`, etc) at the level of `Element`. See

    https://groups.google.com/forum/#!topic/sage-devel/k1bBQEWB9uI

This would be lost of time to also have this implementation in categories. But it might be a reasonable path for a transition. Anyway, it would be good to advertise this ticket on the thread.
----
New commits:


---

Comment by jdemeyer created at 2016-01-21 19:42:53

What is the advantage of putting these in `ElementMethods` in the category as opposed to directly in `Element` or `RingElement` or `WhateverElement`?


---

Comment by nthiery created at 2016-01-21 22:29:56

Hi Vincent, Jeroen,

Thanks for the pointer to the discussion on sage-devel. I'll mention
this ticket there.

Due to the lack of multiple inheritance in Cython, we cannot have a
common Cython base class for all parents having the appropriate
multiplicative structure to define `__div__`. Besides there are
parents where you only know at initialization time whether they have
that appropriate structure; the elements of those can there only
inherit statically from Element.

Because of this, putting the `__div__` method in `RingElement` and its
variants (`MultiplicativeGroupElement`, ...) is not sufficient to cover
all the use cases. Having `__div__` there also encourages people to inherit
from `RingElement` with no mathematical justification (see
e.g. `GapElement` in libgap). Hence the need to have a copy of this
method in the categories.


An alternative option would indeed be to move all the `__div__`,
`__mul__`, ...  methods in `Element`. This has the advantage of
enabling coercion for every Sage `Element`. This has the disadvantage
of polluting the namespace of many objects with irrelevant methods.

I don't have a strong opinion myself.

In any cases, `_div_` belongs to this category and this ticket solves
the problem for now in a consistent way with what's done for the
additive structure and friends. It's also trivial to remove/move the
`__div__` method it defines. Therefore, unless moving `__div__` and
friends to `Element` is decided and implemented very quickly, I
suggest that we get this ticket in. I need this feature for the
Sage-GAP interface enhancements I am working on right now in St
Andrews.

Cheers,
                                    Nicolas


---

Comment by vdelecroix created at 2016-01-21 22:39:47

Replying to [comment:7 nthiery]:

Hola,

I basically agree with you. Except that spoiling the namespace with `__div__` and `__mul__` is much better than with `numerical_approx`, `subs`, `substitute`, `is_zero`, `cartesian_product`, `base_ring`, `base_extend`, `N`, ...

Depending of how the reheat of the thread goes on we could:
- actually move the `__div__` and friends to `Element` (that should not be hard)
- adopt the (possibly temporary) solution as suggested in your branch. In which case, it would be better to mention in the docstring that we might move this to `Element`

Have nice time in St Andrews!
Vincent


---

Comment by nthiery created at 2016-01-21 23:49:49

Did you mean that thread from last fall or was there some more recent discussion specifically on that?

https://groups.google.com/d/msg/sage-devel/k1bBQEWB9uI/KawvRce3BQAJ


---

Comment by vdelecroix created at 2016-01-21 23:51:00

This is it. I do not remember of anything more recent about it.


---

Comment by tscrim created at 2016-01-22 03:17:13

Shouldn't this be `__truediv__` and have `__div__` as an alias as per #18578 for Python3 compatibility?


---

Comment by jdemeyer created at 2016-01-22 08:51:00

Replying to [comment:7 nthiery]:
> Due to the lack of multiple inheritance in Cython
For the record, this has not much to do with Cython, but with Python. Too many things are being blamed on Cython which are really Python issues.

Replying to [comment:8 vdelecroix]:
> Depending of how the reheat of the thread goes on we could:
> - actually move the `__div__` and friends to `Element` (that should not be hard)
Indeed, not hard, but somebody has to do it. In any case, I would prefer to wait for #269 to avoid conflicts.

> - adopt the (possibly temporary) solution as suggested in your branch.
If it solves an actual problem you're having, I don't mind.

Replying to [comment:11 tscrim]:
> Shouldn't this be `__truediv__` and have `__div__` as an alias as per #18578 for Python3 compatibility?

Absolutely.


---

Comment by jdemeyer created at 2016-01-22 08:51:00

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-01-22 16:50:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nthiery created at 2016-01-22 17:04:00

Thanks for the `__truediv__` info! I had missed that point. Let's get this in.


---

Comment by nthiery created at 2016-01-22 17:04:00

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2016-01-23 23:22:54

For the record: I double checked Sam's changes over his shoulders.
----
New commits:


---

Comment by slelievre created at 2016-01-23 23:24:10

The patchbot was happy, I just added a line of documentation. Positive review.


---

Comment by slelievre created at 2016-01-23 23:24:10

Changing status from needs_review to positive_review.


---

Comment by nthiery created at 2016-01-24 00:32:21

Changing keywords from "coercion" to "coercion, days70.5".


---

Comment by vbraun created at 2016-01-24 12:52:30

Resolution: fixed
