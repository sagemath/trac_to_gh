# Issue 25464: Implement Sieve algorithm for product_projective space

archive/issues_025464.json:
```json
{
    "body": "CC:  @bhutz @raghukul01\n\nKeywords: algebraic scheme, gsoc2018\n\nSieve algorithm can be used for enumeration of rational points, when product projective space is over a `RationalField`. This would be much faster than basic enumeration.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25701\n\n",
    "created_at": "2018-06-29T14:06:21Z",
    "labels": [
        "algebraic geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Implement Sieve algorithm for product_projective space",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25464",
    "user": "@raghukul01"
}
```
CC:  @bhutz @raghukul01

Keywords: algebraic scheme, gsoc2018

Sieve algorithm can be used for enumeration of rational points, when product projective space is over a `RationalField`. This would be much faster than basic enumeration.

Issue created by migration from https://trac.sagemath.org/ticket/25701





---

archive/issue_comments_359293.json:
```json
{
    "body": "Doing LLL reduction per component did work fine. But it performs very poor on small examples. Consider this:\n\n\n```\nsage: from sage.schemes.product_projective.rational_point import \\\n                enum_product_projective_number_field\nsage: from sage.schemes.product_projective.rational_point import sieve\nsage: PP.<x1,x2,x3,y1,y2,y3,z1,z2,z3> = ProductProjectiveSpaces([2,2,2], QQ)\nsage: X = PP.subscheme([x1+x2+x3,y1+y2+y3,z1+z2+z3])\nsage: sieve(X,1)\nsage: enum_product_projective_rational_field(X,1)\n```\n\n\nBasic enumeration turns out to be extremely efficient. However for larger bound, sieve works good.\n\nI have pushed a branch for the same\n[u/raghukul01/product_sieve_23701](https://git.sagemath.org/sage.git/log/?h=u/raghukul01/product_sieve_23701)",
    "created_at": "2018-07-27T16:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359293",
    "user": "@raghukul01"
}
```

Doing LLL reduction per component did work fine. But it performs very poor on small examples. Consider this:


```
sage: from sage.schemes.product_projective.rational_point import \
                enum_product_projective_number_field
sage: from sage.schemes.product_projective.rational_point import sieve
sage: PP.<x1,x2,x3,y1,y2,y3,z1,z2,z3> = ProductProjectiveSpaces([2,2,2], QQ)
sage: X = PP.subscheme([x1+x2+x3,y1+y2+y3,z1+z2+z3])
sage: sieve(X,1)
sage: enum_product_projective_rational_field(X,1)
```


Basic enumeration turns out to be extremely efficient. However for larger bound, sieve works good.

I have pushed a branch for the same
[u/raghukul01/product_sieve_23701](https://git.sagemath.org/sage.git/log/?h=u/raghukul01/product_sieve_23701)



---

archive/issue_comments_359294.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2018-07-27T16:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359294",
    "user": "@raghukul01"
}
```

Last 10 new commits:



---

archive/issue_comments_359295.json:
```json
{
    "body": "Value of B is calculated from the component projective space, whose dimension is maximum\n\n```python\ndim_max = max(P[i].dimension() for i in range(num_comp))\nB = RR(2**(dim_max/4+1)*bound**2*(dim_max+1).sqrt())\n```\n\nSince that would be the upper bound for all other components as well.",
    "created_at": "2018-07-27T16:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359295",
    "user": "@raghukul01"
}
```

Value of B is calculated from the component projective space, whose dimension is maximum

```python
dim_max = max(P[i].dimension() for i in range(num_comp))
B = RR(2**(dim_max/4+1)*bound**2*(dim_max+1).sqrt())
```

Since that would be the upper bound for all other components as well.



---

archive/issue_comments_359296.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-30T16:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359296",
    "user": "@raghukul01"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_359297.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-03T15:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359297",
    "user": "@bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359298.json:
```json
{
    "body": "Doc test failures in schemes/product_projective\n\n\n```\nsage -t --long --warn-long 82.3 homset.py  # 2 doctests failed\nsage -t --long --warn-long 82.3 rational_point.py  # 16 doctests failed\nsage -t --long --warn-long 82.3 space.py  # 1 doctest failed\n```\n",
    "created_at": "2018-08-03T15:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359298",
    "user": "@bhutz"
}
```

Doc test failures in schemes/product_projective


```
sage -t --long --warn-long 82.3 homset.py  # 2 doctests failed
sage -t --long --warn-long 82.3 rational_point.py  # 16 doctests failed
sage -t --long --warn-long 82.3 space.py  # 1 doctest failed
```




---

archive/issue_comments_359299.json:
```json
{
    "body": "Sir,\n\nI didn't get any of those doctest failure (tested on 8.4.beta0), can you provide some specific test which failed.",
    "created_at": "2018-08-07T11:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359299",
    "user": "@raghukul01"
}
```

Sir,

I didn't get any of those doctest failure (tested on 8.4.beta0), can you provide some specific test which failed.



---

archive/issue_comments_359300.json:
```json
{
    "body": "It works fine on 8.4.beta0, perhaps my local version was just messed up when I ran those tests.\n\nIn testing functionality I'm not getting any issues, but I do see the very slow times. It seems to me like you need to re-think your 'good_primes' strategy. I'm getting much better results using the list from 'sufficient_primes', so it seems you are underestimating the time to enumerate.\n\nIt may be that you should just use the 'sufficient_primes' list trimmed down to be minimal.",
    "created_at": "2018-08-07T20:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359300",
    "user": "@bhutz"
}
```

It works fine on 8.4.beta0, perhaps my local version was just messed up when I ran those tests.

In testing functionality I'm not getting any issues, but I do see the very slow times. It seems to me like you need to re-think your 'good_primes' strategy. I'm getting much better results using the list from 'sufficient_primes', so it seems you are underestimating the time to enumerate.

It may be that you should just use the 'sufficient_primes' list trimmed down to be minimal.



---

archive/issue_comments_359301.json:
```json
{
    "body": "Yes that seemed to work fine, but why is it so? Is there something missing in the complexity part, which is causing this error?",
    "created_at": "2018-08-09T06:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359301",
    "user": "@raghukul01"
}
```

Yes that seemed to work fine, but why is it so? Is there something missing in the complexity part, which is causing this error?



---

archive/issue_comments_359302.json:
```json
{
    "body": "It's probably just that Pmax^N as a rough estimate of the number of points is too simplistic of a complexity estimate.",
    "created_at": "2018-08-09T13:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359302",
    "user": "@bhutz"
}
```

It's probably just that Pmax^N as a rough estimate of the number of points is too simplistic of a complexity estimate.



---

archive/issue_comments_359303.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-13T18:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359303",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359304.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-13T18:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359304",
    "user": "@raghukul01"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359305.json:
```json
{
    "body": "> It's probably just that PmaxN as a rough estimate of the number of points is too simplistic of a complexity estimate.\n\nYes Sir, I agree with that, it should be Pmax<sup>dim_ambient_space</sup> by looking at the rational point function for the finite field. I have added some other corrections in complexity as well\n\n```C++\nT(n) = (dim**2)*Pmax**(dim) + (dim_max**5 * (alpha/Pmax)**dim_scheme)\n# it is (alpha/Pmax)^dim_scheme, since only that many points will\n# be checked parallelly.\n# instead of N^5, it would be dim_max^5, since we do LLL() over \n# each component, hence only the dim_max would be leading term\n```\n\n\nI have tested this branch, it has shown good improvement, however for smaller bounds (< 4), the enumeration is better. How about changing rational point logic according to this?",
    "created_at": "2018-08-13T18:54:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359305",
    "user": "@raghukul01"
}
```

> It's probably just that PmaxN as a rough estimate of the number of points is too simplistic of a complexity estimate.

Yes Sir, I agree with that, it should be Pmax<sup>dim_ambient_space</sup> by looking at the rational point function for the finite field. I have added some other corrections in complexity as well

```C++
T(n) = (dim**2)*Pmax**(dim) + (dim_max**5 * (alpha/Pmax)**dim_scheme)
# it is (alpha/Pmax)^dim_scheme, since only that many points will
# be checked parallelly.
# instead of N^5, it would be dim_max^5, since we do LLL() over 
# each component, hence only the dim_max would be leading term
```


I have tested this branch, it has shown good improvement, however for smaller bounds (< 4), the enumeration is better. How about changing rational point logic according to this?



---

archive/issue_comments_359306.json:
```json
{
    "body": "I haven't reviewed the changes, but to answer your general question. X.rational_points() should do whatever is typically fastest. If that means enumeration for very small bounds and sieving after a certain cutoff, then by all means do it that way.",
    "created_at": "2018-08-14T01:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359306",
    "user": "@bhutz"
}
```

I haven't reviewed the changes, but to answer your general question. X.rational_points() should do whatever is typically fastest. If that means enumeration for very small bounds and sieving after a certain cutoff, then by all means do it that way.



---

archive/issue_comments_359307.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-11-16T20:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359307",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359308.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-20T17:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359308",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359309.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-11-20T17:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359309",
    "user": "@bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359310.json:
```json
{
    "body": "This example (with low codimension) is very slow:\n\n\n```\nPP.<x,y,z,u,v,a,b,c> = ProductProjectiveSpaces([2,1,2], QQ)\nX = PP.subscheme([x*u^2*a, b*z*u*v,z*v^2*c ])\nX.rational_points(bound=2)\n```\n",
    "created_at": "2019-11-20T20:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359310",
    "user": "atowsley"
}
```

This example (with low codimension) is very slow:


```
PP.<x,y,z,u,v,a,b,c> = ProductProjectiveSpaces([2,1,2], QQ)
X = PP.subscheme([x*u^2*a, b*z*u*v,z*v^2*c ])
X.rational_points(bound=2)
```




---

archive/issue_comments_359311.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-11-20T20:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359311",
    "user": "atowsley"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-20T20:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359312",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359313.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2019-11-20T20:55:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359313",
    "user": "atowsley"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_359314.json:
```json
{
    "body": "Changing keywords from \"algebraic scheme, gsoc2018\" to \"algebraic scheme, gsoc2018, sd104\".",
    "created_at": "2019-11-20T21:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359314",
    "user": "atowsley"
}
```

Changing keywords from "algebraic scheme, gsoc2018" to "algebraic scheme, gsoc2018, sd104".



---

archive/issue_comments_359315.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-28T21:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25464#issuecomment-359315",
    "user": "@vbraun"
}
```

Resolution: fixed
