# Issue 12281: Refactor integer vectors using ClonableIntArray Cython data structure

archive/issues_012281.json:
```json
{
    "body": "Assignee: nborie\n\nCC:  sage-combinat @fchapoton @darijgr\n\nKeywords: Integer, vectors, cython, clone, Cernay2012\n\nWhy that ? Because :\n\n* Integer Vectors have no element class\n* Integer Vectors elements must be immutable and hashable\n* Clean the old code with new specification\n* Add documentation\n* Deal with coeherence beetween extra arguments of the constructor\n* ...\n\nIssue created by migration from https://trac.sagemath.org/ticket/12453\n\n",
    "created_at": "2012-02-06T15:59:44Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Refactor integer vectors using ClonableIntArray Cython data structure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12281",
    "user": "https://trac.sagemath.org/admin/accounts/users/nborie"
}
```
Assignee: nborie

CC:  sage-combinat @fchapoton @darijgr

Keywords: Integer, vectors, cython, clone, Cernay2012

Why that ? Because :

* Integer Vectors have no element class
* Integer Vectors elements must be immutable and hashable
* Clean the old code with new specification
* Add documentation
* Deal with coeherence beetween extra arguments of the constructor
* ...

Issue created by migration from https://trac.sagemath.org/ticket/12453





---

archive/issue_comments_144147.json:
```json
{
    "body": "Initial version.",
    "created_at": "2013-02-22T04:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144147",
    "user": "https://github.com/tscrim"
}
```

Initial version.



---

archive/issue_comments_144148.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-02-22T04:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144148",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_144149.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-06-04T06:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144149",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144150.json:
```json
{
    "body": "Please update the patch as it does not apply on sage-5.10\n\n```\npatching file sage/combinat/integer_vector_weighted.py\nHunk #1 FAILED at 2\nHunk #3 FAILED at 64\nHunk #4 FAILED at 173\n```\n",
    "created_at": "2013-06-04T06:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144150",
    "user": "https://github.com/videlec"
}
```

Please update the patch as it does not apply on sage-5.10

```
patching file sage/combinat/integer_vector_weighted.py
Hunk #1 FAILED at 2
Hunk #3 FAILED at 64
Hunk #4 FAILED at 173
```




---

archive/issue_comments_144151.json:
```json
{
    "body": "New version (which can be commuted past #14101 and #14772 at minor cost due to doc[string] changes). Also part of #12913.",
    "created_at": "2013-07-08T16:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144151",
    "user": "https://github.com/tscrim"
}
```

New version (which can be commuted past #14101 and #14772 at minor cost due to doc[string] changes). Also part of #12913.



---

archive/issue_comments_144152.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-08T16:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144152",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144153.json:
```json
{
    "body": "Changing type from task to enhancement.",
    "created_at": "2013-07-14T08:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144153",
    "user": "https://github.com/tscrim"
}
```

Changing type from task to enhancement.



---

archive/issue_comments_144154.json:
```json
{
    "body": "Attachment [trac_12453-refactor_integer_vectors-ts.patch](tarball://root/attachments/some-uuid/ticket12453/trac_12453-refactor_integer_vectors-ts.patch) by @tscrim created at 2013-07-19 18:36:27",
    "created_at": "2013-07-19T18:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144154",
    "user": "https://github.com/tscrim"
}
```

Attachment [trac_12453-refactor_integer_vectors-ts.patch](tarball://root/attachments/some-uuid/ticket12453/trac_12453-refactor_integer_vectors-ts.patch) by @tscrim created at 2013-07-19 18:36:27



---

archive/issue_events_033552.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33552"
}
```



---

archive/issue_comments_144155.json:
```json
{
    "body": "Branch version at public/refactor_integer_vectors-12453 but trac is responding with a 'unicode' object not callable error.",
    "created_at": "2013-12-20T02:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144155",
    "user": "https://github.com/tscrim"
}
```

Branch version at public/refactor_integer_vectors-12453 but trac is responding with a 'unicode' object not callable error.



---

archive/issue_comments_144156.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-12-21T15:41:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144156",
    "user": "https://github.com/tscrim"
}
```

New commits:



---

archive/issue_comments_144157.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-25T18:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144157",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_033553.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33553"
}
```



---

archive/issue_events_033554.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33554"
}
```



---

archive/issue_comments_144158.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-02-08T17:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144158",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144159.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-13T05:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144159",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144160.json:
```json
{
    "body": "Before this branch\n\n```\nsage: %time _=list(IntegerVectors(5,22))\nCPU times: user 1.78 s, sys: 8 ms, total: 1.78 s\nWall time: 1.81 s\n```\n\n\nAfter the branch\n\n```\nsage: %time _=list(IntegerVectors(5,22))\nCPU times: user 19.3 s, sys: 60 ms, total: 19.4 s\nWall time: 19.6 s\n```\n\n\nWith a 5-lines code\n\n```\nfrom itertools import combinations\ndef integervectors(n,k):\n    L = n+k-1\n    for x in combinations(range(L),k-1):\n        l = [x[i] - x[i-1]-1 for i in range(1,k-1)]\n        l.insert(0,x[0])\n        l.append(L-x[-1]-1)\n        yield l\n\nsage: %time _=list(integervectors(5,22))\nCPU times: user 492 ms, sys: 16 ms, total: 508 ms\nWall time: 515 ms\n```\n\n\nI think this can be classified as a severe regression. Besides,  it is probably better to avoid this kind of stuff present in your branch:\n\n\n```\nfor c in IntegerVectors(self.size - k, i-1):\n    c = list(c)\n```\n\n\nIf you only want the data, don't generate complex objects in the first place.\n\nNathann",
    "created_at": "2014-04-04T16:59:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144160",
    "user": "https://github.com/nathanncohen"
}
```

Before this branch

```
sage: %time _=list(IntegerVectors(5,22))
CPU times: user 1.78 s, sys: 8 ms, total: 1.78 s
Wall time: 1.81 s
```


After the branch

```
sage: %time _=list(IntegerVectors(5,22))
CPU times: user 19.3 s, sys: 60 ms, total: 19.4 s
Wall time: 19.6 s
```


With a 5-lines code

```
from itertools import combinations
def integervectors(n,k):
    L = n+k-1
    for x in combinations(range(L),k-1):
        l = [x[i] - x[i-1]-1 for i in range(1,k-1)]
        l.insert(0,x[0])
        l.append(L-x[-1]-1)
        yield l

sage: %time _=list(integervectors(5,22))
CPU times: user 492 ms, sys: 16 ms, total: 508 ms
Wall time: 515 ms
```


I think this can be classified as a severe regression. Besides,  it is probably better to avoid this kind of stuff present in your branch:


```
for c in IntegerVectors(self.size - k, i-1):
    c = list(c)
```


If you only want the data, don't generate complex objects in the first place.

Nathann



---

archive/issue_comments_144161.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-04-04T16:59:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144161",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144162.json:
```json
{
    "body": "While this algorithm works (modulo corner cases), it doesn't return them in lex order (which is something we'd want to do). Can you give a variant of it which does yield in lex order?",
    "created_at": "2014-04-04T21:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144162",
    "user": "https://github.com/tscrim"
}
```

While this algorithm works (modulo corner cases), it doesn't return them in lex order (which is something we'd want to do). Can you give a variant of it which does yield in lex order?



---

archive/issue_comments_144163.json:
```json
{
    "body": "Nevermind, I think I have one.",
    "created_at": "2014-04-04T21:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144163",
    "user": "https://github.com/tscrim"
}
```

Nevermind, I think I have one.



---

archive/issue_comments_144164.json:
```json
{
    "body": "?\n\nOn which instance doesn't it give a lexicographic  ordering ? `O_o`\n\nNathann",
    "created_at": "2014-04-04T21:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144164",
    "user": "https://github.com/nathanncohen"
}
```

?

On which instance doesn't it give a lexicographic  ordering ? `O_o`

Nathann



---

archive/issue_comments_144165.json:
```json
{
    "body": "(1,2) gives: `[0, 1] [1, 0]`. In fact, try `(3,3)` and it's not something easily tweaked.",
    "created_at": "2014-04-04T21:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144165",
    "user": "https://github.com/tscrim"
}
```

(1,2) gives: `[0, 1] [1, 0]`. In fact, try `(3,3)` and it's not something easily tweaked.



---

archive/issue_comments_144166.json:
```json
{
    "body": "`O_o`\n\n```\nsage: list(integervectors(1,2))\n[[0, 1], [1, 0]]\nsage: list(integervectors(3,3))\n[[0, 0, 3],\n [0, 1, 2],\n [0, 2, 1],\n [0, 3, 0],\n [1, 0, 2],\n [1, 1, 1],\n [1, 2, 0],\n [2, 0, 1],\n [2, 1, 0],\n [3, 0, 0]]\n```\n\n\nIsn't that the lexicographic ordering ? `O_o`\n\n```\nsage: list(integervectors(3,3)) == sorted(list(integervectors(3,3)))\nTrue\n```\n",
    "created_at": "2014-04-04T21:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144166",
    "user": "https://github.com/nathanncohen"
}
```

`O_o`

```
sage: list(integervectors(1,2))
[[0, 1], [1, 0]]
sage: list(integervectors(3,3))
[[0, 0, 3],
 [0, 1, 2],
 [0, 2, 1],
 [0, 3, 0],
 [1, 0, 2],
 [1, 1, 1],
 [1, 2, 0],
 [2, 0, 1],
 [2, 1, 0],
 [3, 0, 0]]
```


Isn't that the lexicographic ordering ? `O_o`

```
sage: list(integervectors(3,3)) == sorted(list(integervectors(3,3)))
True
```




---

archive/issue_comments_144167.json:
```json
{
    "body": "I meant revlex.",
    "created_at": "2014-04-04T21:45:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144167",
    "user": "https://github.com/tscrim"
}
```

I meant revlex.



---

archive/issue_comments_144168.json:
```json
{
    "body": "> By your convention, I mean revlex.\n\nMe and quite a lot of people (wikipedia, dictionaries, phone books, Python) seem to agree on what a lexicographic ordering is `:-P`\n\nIt looks like `IntegerVector` returns them in decreasing lexicographic order, so I guess that's what you call \"revlex\" (sorry I always mix colex and revlex).\n\nWhat about computing the complement of x ? In Python  it wastes a lot of time, but the algorithm works.... `:-P`\n\n\n```\ndef integervectors(n,k):\n    L = n+k-1\n    for x in combinations(range(L),L-(k-1)):\n        x_complement = []\n        j = 0\n        for i in range(L):\n            if x[j] == i:\n                if j < L-(k-1)-1:\n\t\t    j += 1\n\t\tcontinue\n            else:\n                x_complement.append(i)\n\tx = x_complement\n        l = [x[i] - x[i-1]-1 for i in range(1,k-1)]\n        l.insert(0,x[0])\n        l.append(L-x[-1]-1)\n        yield l\n\nsage: list(integervectors(5,5)) == [list(map(int,x)) for x in IntegerVectors(5,5)]\nTrue\n```\n",
    "created_at": "2014-04-04T22:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144168",
    "user": "https://github.com/nathanncohen"
}
```

> By your convention, I mean revlex.

Me and quite a lot of people (wikipedia, dictionaries, phone books, Python) seem to agree on what a lexicographic ordering is `:-P`

It looks like `IntegerVector` returns them in decreasing lexicographic order, so I guess that's what you call "revlex" (sorry I always mix colex and revlex).

What about computing the complement of x ? In Python  it wastes a lot of time, but the algorithm works.... `:-P`


```
def integervectors(n,k):
    L = n+k-1
    for x in combinations(range(L),L-(k-1)):
        x_complement = []
        j = 0
        for i in range(L):
            if x[j] == i:
                if j < L-(k-1)-1:
		    j += 1
		continue
            else:
                x_complement.append(i)
	x = x_complement
        l = [x[i] - x[i-1]-1 for i in range(1,k-1)]
        l.insert(0,x[0])
        l.append(L-x[-1]-1)
        yield l

sage: list(integervectors(5,5)) == [list(map(int,x)) for x in IntegerVectors(5,5)]
True
```




---

archive/issue_comments_144169.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-04T22:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144170.json:
```json
{
    "body": "I thought I had a method but it didn't work. Python's `itertool` forces it through lex ordering, so I just did a brute compute and reverse (which is far less than ideal). I'll look into your revised algorithm tonight.",
    "created_at": "2014-04-04T22:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144170",
    "user": "https://github.com/tscrim"
}
```

I thought I had a method but it didn't work. Python's `itertool` forces it through lex ordering, so I just did a brute compute and reverse (which is far less than ideal). I'll look into your revised algorithm tonight.



---

archive/issue_comments_144171.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-04-15T02:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144171",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_033555.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33555"
}
```



---

archive/issue_events_033556.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33556"
}
```



---

archive/issue_comments_144172.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-01T21:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144173.json:
```json
{
    "body": "Hey Nathann,\n\nI've implemented your algorithm and everything seems to work. Can you do the rest of the review for this?",
    "created_at": "2014-08-01T21:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144173",
    "user": "https://github.com/tscrim"
}
```

Hey Nathann,

I've implemented your algorithm and everything seems to work. Can you do the rest of the review for this?



---

archive/issue_comments_144174.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-01T21:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144174",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144175.json:
```json
{
    "body": "Hello !\n\n> I've implemented your algorithm and everything seems to work. Can you do the rest of the review for this?\n\nNo, sorry. Your branch contains 14 commits, almost all of which are entitled \"Merge with develop\". Besides, I see some code in your branch in which you just change the indentation, and so it seems that I should not re-review all that code, but given how your branch is made I have no way to know what needs an actual review.\n\nBesides, I can spend time on the review of any \"local\" thing (like this enumeration algorithm) and I will do it gladly if you have anything specific in mind, but I hate parents, elements and almost anything that is immutable. I am the last person you want to review code like that.\n\nI would start to make unpleasant reviews like: \"It has been reported on Sage-devel that having a cached function return a UniqueRepresentation object resulted in a memory leak. Clearly those integer vectors will be used by cached function, so you are creating a new memory leak until this finally gets fixed\".\n\nhttps://groups.google.com/d/topic/sage-devel/q5uy_lI11jg/discussion\n\nSo I'm sorry but you probably want somebody else to review this ticket.\n\nNathann",
    "created_at": "2014-08-01T21:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144175",
    "user": "https://github.com/nathanncohen"
}
```

Hello !

> I've implemented your algorithm and everything seems to work. Can you do the rest of the review for this?

No, sorry. Your branch contains 14 commits, almost all of which are entitled "Merge with develop". Besides, I see some code in your branch in which you just change the indentation, and so it seems that I should not re-review all that code, but given how your branch is made I have no way to know what needs an actual review.

Besides, I can spend time on the review of any "local" thing (like this enumeration algorithm) and I will do it gladly if you have anything specific in mind, but I hate parents, elements and almost anything that is immutable. I am the last person you want to review code like that.

I would start to make unpleasant reviews like: "It has been reported on Sage-devel that having a cached function return a UniqueRepresentation object resulted in a memory leak. Clearly those integer vectors will be used by cached function, so you are creating a new memory leak until this finally gets fixed".

https://groups.google.com/d/topic/sage-devel/q5uy_lI11jg/discussion

So I'm sorry but you probably want somebody else to review this ticket.

Nathann



---

archive/issue_events_033557.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33557"
}
```



---

archive/issue_events_033558.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33558"
}
```



---

archive/issue_comments_144176.json:
```json
{
    "body": "needs rebase, des not apply",
    "created_at": "2015-05-22T20:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144176",
    "user": "https://github.com/fchapoton"
}
```

needs rebase, des not apply



---

archive/issue_comments_144177.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-22T20:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144177",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144178.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-25T19:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144179.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-25T19:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144179",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_033559.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-08-25T19:26:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33559"
}
```



---

archive/issue_events_033560.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2016-08-25T19:26:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33560"
}
```



---

archive/issue_comments_144180.json:
```json
{
    "body": "doc does not build:\n\n+[dochtml] OSError: [combinat ] /home/worker/sage-patchbot/local/lib/python2.7/site-packages/sage/combinat/integer_vector.py:docstring of sage.combinat.integer_vector.IntegerVectors_nnondescents:9: WARNING: Inline literal start-string without end-string.\n\nand one should no longer use `it.next()` bu instead use `next(it)`\n\n++            sage: [it.next() for x in range(10)]\n++            sage: [it.next() for x in range(10)]\n++            sage: [it.next() for x in range(10)]",
    "created_at": "2016-08-26T17:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144180",
    "user": "https://github.com/fchapoton"
}
```

doc does not build:

+[dochtml] OSError: [combinat ] /home/worker/sage-patchbot/local/lib/python2.7/site-packages/sage/combinat/integer_vector.py:docstring of sage.combinat.integer_vector.IntegerVectors_nnondescents:9: WARNING: Inline literal start-string without end-string.

and one should no longer use `it.next()` bu instead use `next(it)`

++            sage: [it.next() for x in range(10)]
++            sage: [it.next() for x in range(10)]
++            sage: [it.next() for x in range(10)]



---

archive/issue_comments_144181.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T18:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144182.json:
```json
{
    "body": "This should fix the doc (although I can't test right now because Sage is recompiling) and fixed the `next`.",
    "created_at": "2016-08-26T18:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144182",
    "user": "https://github.com/tscrim"
}
```

This should fix the doc (although I can't test right now because Sage is recompiling) and fixed the `next`.



---

archive/issue_comments_144183.json:
```json
{
    "body": "Followup, doc built cleanly for me.",
    "created_at": "2016-08-26T19:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144183",
    "user": "https://github.com/tscrim"
}
```

Followup, doc built cleanly for me.



---

archive/issue_comments_144184.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-27T11:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144184",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144185.json:
```json
{
    "body": "triggers doctest failures in sandpiles",
    "created_at": "2016-08-27T11:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144185",
    "user": "https://github.com/fchapoton"
}
```

triggers doctest failures in sandpiles



---

archive/issue_comments_144186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-27T17:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144187.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-27T17:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144187",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144188.json:
```json
{
    "body": "Fixed.",
    "created_at": "2016-08-27T17:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144188",
    "user": "https://github.com/tscrim"
}
```

Fixed.



---

archive/issue_comments_144189.json:
```json
{
    "body": "Patchbot is green.",
    "created_at": "2016-09-01T04:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144189",
    "user": "https://github.com/tscrim"
}
```

Patchbot is green.



---

archive/issue_comments_144190.json:
```json
{
    "body": "Before\n\n```\nsage: %timeit list(IntegerVectors(5,22))\n1 loop, best of 3: 190 ms per loop\n```\n\nAfter\n\n```\nsage: %timeit list(IntegerVectors(5,22)) \n1 loop, best of 3: 3.86 s per loop\n```\n\nwhich looks really bad..",
    "created_at": "2016-09-01T07:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144190",
    "user": "https://github.com/fchapoton"
}
```

Before

```
sage: %timeit list(IntegerVectors(5,22))
1 loop, best of 3: 190 ms per loop
```

After

```
sage: %timeit list(IntegerVectors(5,22)) 
1 loop, best of 3: 3.86 s per loop
```

which looks really bad..



---

archive/issue_comments_144191.json:
```json
{
    "body": "Basically all of the time is eaten up by `integer_vectors_nk_fast_iter`. I was hoping to line profile it, but that is broken since the IPython upgrade. I'm looking into this.",
    "created_at": "2016-09-01T14:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144191",
    "user": "https://github.com/tscrim"
}
```

Basically all of the time is eaten up by `integer_vectors_nk_fast_iter`. I was hoping to line profile it, but that is broken since the IPython upgrade. I'm looking into this.



---

archive/issue_comments_144192.json:
```json
{
    "body": "So it seems Nathann's algorithm is just slower than the original version, so I'm just reverting it. I would like to `%lprun` it... *sigh*",
    "created_at": "2016-09-01T14:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144192",
    "user": "https://github.com/tscrim"
}
```

So it seems Nathann's algorithm is just slower than the original version, so I'm just reverting it. I would like to `%lprun` it... *sigh*



---

archive/issue_comments_144193.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-01T14:55:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144193",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144194.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-01T15:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144195.json:
```json
{
    "body": "Now I get about a 3x slowdown for the iterator over the parent, but considering that this is basically overhead from the parent/element stuff, we won't be able to get much else. Plus we are at such small time scales and if you're iterating over the parent, then this should not be the bottleneck.\n\nHowever, calling the iterator itself is now about 10% faster than before. So I also update those parts of the codebase which want a honest list back and had them call the iterator directly.",
    "created_at": "2016-09-01T15:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144195",
    "user": "https://github.com/tscrim"
}
```

Now I get about a 3x slowdown for the iterator over the parent, but considering that this is basically overhead from the parent/element stuff, we won't be able to get much else. Plus we are at such small time scales and if you're iterating over the parent, then this should not be the bottleneck.

However, calling the iterator itself is now about 10% faster than before. So I also update those parts of the codebase which want a honest list back and had them call the iterator directly.



---

archive/issue_comments_144196.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-04T19:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144196",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144197.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-11T22:34:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144197",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144198.json:
```json
{
    "body": "Patchbot is green.",
    "created_at": "2016-09-12T14:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144198",
    "user": "https://github.com/tscrim"
}
```

Patchbot is green.



---

archive/issue_comments_144199.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-16T23:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144199",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144200.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-29T02:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144201.json:
```json
{
    "body": "Rebased on 7.4.beta6.",
    "created_at": "2016-09-29T02:13:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144201",
    "user": "https://github.com/tscrim"
}
```

Rebased on 7.4.beta6.



---

archive/issue_comments_144202.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-29T14:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144202",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144203.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-10T16:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144203",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144204.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-12-03T10:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144204",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144205.json:
```json
{
    "body": "does not apply",
    "created_at": "2016-12-03T10:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144205",
    "user": "https://github.com/fchapoton"
}
```

does not apply



---

archive/issue_comments_144206.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-05T01:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144206",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144207.json:
```json
{
    "body": "I would appreciate it if you could finish the review Fr\u00e9d\u00e9ric.",
    "created_at": "2016-12-05T01:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144207",
    "user": "https://github.com/tscrim"
}
```

I would appreciate it if you could finish the review Frédéric.



---

archive/issue_comments_144208.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-12-05T01:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144208",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144209.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-05T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144209",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144210.json:
```json
{
    "body": "typo \"yeilds Python\"\n\nI am not sure I am able to do a review. This is rather large a ticket..\n\nWould you please provide some timings ? I am still a lot worried about that.\n\nAnd explain again what is gained, maybe at the loss of some speed ?",
    "created_at": "2016-12-05T19:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144210",
    "user": "https://github.com/fchapoton"
}
```

typo "yeilds Python"

I am not sure I am able to do a review. This is rather large a ticket..

Would you please provide some timings ? I am still a lot worried about that.

And explain again what is gained, maybe at the loss of some speed ?



---

archive/issue_comments_144211.json:
```json
{
    "body": "before\n\n```\nsage: %timeit list(IntegerVectors(5,22))\n1 loop, best of 3: 193 ms per loop\n```\n\nafter\n\n```\nsage: %timeit list(IntegerVectors(5,22)) \n1 loop, best of 3: 622 ms per loop\n```\n\nso this is not so bad, but still a 3 times slowdown. What do we gain for this prize ?",
    "created_at": "2016-12-05T21:48:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144211",
    "user": "https://github.com/fchapoton"
}
```

before

```
sage: %timeit list(IntegerVectors(5,22))
1 loop, best of 3: 193 ms per loop
```

after

```
sage: %timeit list(IntegerVectors(5,22)) 
1 loop, best of 3: 622 ms per loop
```

so this is not so bad, but still a 3 times slowdown. What do we gain for this prize ?



---

archive/issue_comments_144212.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-05T22:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144213.json:
```json
{
    "body": "That is around what I am getting as well. The advantage is that this is now a proper parent class with elements and fits into the rest of Sage. If you want to have the speed but not the parent/element overhead, I provided an iterator for that:\n\n```\nsage: %timeit list(IntegerVectors(5,22))\n1 loop, best of 3: 238 ms per loop\nsage: from sage.combinat.integer_vector import integer_vectors_nk_fast_iter\nsage: %timeit list(integer_vectors_nk_fast_iter(5,22))\n10 loops, best of 3: 63.7 ms per loop\n```\n\nOld:\n\n```\nsage: %timeit list(IntegerVectors(5,22))\n10 loops, best of 3: 76.4 ms per loop\n```\n\n\nAlthough if you use `int` and Cython, you can get a *very* fast iterator. Although converting those back to `Integer`'s was actually slower than working directly with `Integer`'s.\n\nI now see the problem with why that was taking so long. The class I'm using actually stores the input data as `int`'s, not `Integer`'s. So I think I need to change the base class for the elements.",
    "created_at": "2016-12-05T22:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144213",
    "user": "https://github.com/tscrim"
}
```

That is around what I am getting as well. The advantage is that this is now a proper parent class with elements and fits into the rest of Sage. If you want to have the speed but not the parent/element overhead, I provided an iterator for that:

```
sage: %timeit list(IntegerVectors(5,22))
1 loop, best of 3: 238 ms per loop
sage: from sage.combinat.integer_vector import integer_vectors_nk_fast_iter
sage: %timeit list(integer_vectors_nk_fast_iter(5,22))
10 loops, best of 3: 63.7 ms per loop
```

Old:

```
sage: %timeit list(IntegerVectors(5,22))
10 loops, best of 3: 76.4 ms per loop
```


Although if you use `int` and Cython, you can get a *very* fast iterator. Although converting those back to `Integer`'s was actually slower than working directly with `Integer`'s.

I now see the problem with why that was taking so long. The class I'm using actually stores the input data as `int`'s, not `Integer`'s. So I think I need to change the base class for the elements.



---

archive/issue_comments_144214.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-05T22:50:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144214",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144215.json:
```json
{
    "body": "Okay, using `ClonableArray` makes things a little bit better:\n\n```\n%timeit list(IntegerVectors(5,22))\n1 loop, best of 3: 209 ms per loop\n```\n",
    "created_at": "2016-12-05T22:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144215",
    "user": "https://github.com/tscrim"
}
```

Okay, using `ClonableArray` makes things a little bit better:

```
%timeit list(IntegerVectors(5,22))
1 loop, best of 3: 209 ms per loop
```




---

archive/issue_comments_144216.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-05T23:32:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144217.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-05T23:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144218.json:
```json
{
    "body": "By not popping and pushing the list (the iterator wants a fixed length) and some reworking, I got it to:\n\n```\nsage: %timeit list(IntegerVectors(5,22))\n1 loop, best of 3: 188 ms per loop\n```\n\nAlthough I did get some slowdown because `rem` was not an `Integer` for the entire loop. So I think this is probably as fast as I can get it.",
    "created_at": "2016-12-05T23:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144218",
    "user": "https://github.com/tscrim"
}
```

By not popping and pushing the list (the iterator wants a fixed length) and some reworking, I got it to:

```
sage: %timeit list(IntegerVectors(5,22))
1 loop, best of 3: 188 ms per loop
```

Although I did get some slowdown because `rem` was not an `Integer` for the entire loop. So I think this is probably as fast as I can get it.



---

archive/issue_comments_144219.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-06T12:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144219",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_144220.json:
```json
{
    "body": "Looks better now indeed. I have made a reviewer's commit (cosmetic).\n\nOnce the bot is green, you can set a positive review.",
    "created_at": "2016-12-06T12:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144220",
    "user": "https://github.com/fchapoton"
}
```

Looks better now indeed. I have made a reviewer's commit (cosmetic).

Once the bot is green, you can set a positive review.



---

archive/issue_comments_144221.json:
```json
{
    "body": "Bot is essentially green, so positive review. Thank you.",
    "created_at": "2016-12-06T14:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144221",
    "user": "https://github.com/tscrim"
}
```

Bot is essentially green, so positive review. Thank you.



---

archive/issue_comments_144222.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-06T14:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144222",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_144223.json:
```json
{
    "body": "FYI I'm only merging tickets whose dependencies are merged git branches.",
    "created_at": "2016-12-07T23:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144223",
    "user": "https://github.com/vbraun"
}
```

FYI I'm only merging tickets whose dependencies are merged git branches.



---

archive/issue_events_033561.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-12-10T12:38:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12281#event-33561"
}
```



---

archive/issue_comments_144224.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-12-10T12:38:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12281#issuecomment-144224",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
