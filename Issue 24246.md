# Issue 24246: complex_field.py complex_number.pyx -> complex_mpfr.pyx

archive/issues_024246.json:
```json
{
    "body": "CC:  @mjungmath chapoton\n\nIn order to uniformize, simplify and in view of #24456 (see also #17713) we merge the two files `complex_field.py`, `complex_number.pyx` into a unique `complex_mpfr.pyx`.\n\nAs pynac used explicitely these modules, we had to provide a tiny patch.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24483\n\n",
    "created_at": "2018-01-07T13:25:10Z",
    "labels": [
        "basic arithmetic",
        "major",
        "enhancement"
    ],
    "title": "complex_field.py complex_number.pyx -> complex_mpfr.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24246",
    "user": "vdelecroix"
}
```
CC:  @mjungmath chapoton

In order to uniformize, simplify and in view of #24456 (see also #17713) we merge the two files `complex_field.py`, `complex_number.pyx` into a unique `complex_mpfr.pyx`.

As pynac used explicitely these modules, we had to provide a tiny patch.

Issue created by migration from https://trac.sagemath.org/ticket/24483





---

archive/issue_comments_339502.json:
```json
{
    "body": "Let us see about doctests\n----\nNew commits:",
    "created_at": "2018-01-07T15:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339502",
    "user": "vdelecroix"
}
```

Let us see about doctests
----
New commits:



---

archive/issue_comments_339503.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-07T15:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339503",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_339504.json:
```json
{
    "body": "patchbot not happy if Author is not given...",
    "created_at": "2018-01-07T17:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339504",
    "user": "vdelecroix"
}
```

patchbot not happy if Author is not given...



---

archive/issue_comments_339505.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-07T18:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339505",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_339506.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-08T08:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339506",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_339507.json:
```json
{
    "body": "Can we just do the renaming *without* deprecation for now? That way, we wouldn't need the fix the Pynac. If possible, I would like to avoid Sage-specific patches to upstream projects.",
    "created_at": "2018-01-08T11:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339507",
    "user": "jdemeyer"
}
```

Can we just do the renaming *without* deprecation for now? That way, we wouldn't need the fix the Pynac. If possible, I would like to avoid Sage-specific patches to upstream projects.



---

archive/issue_comments_339508.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> Can we just do the renaming *without* deprecation for now? That way, we wouldn't need the fix the Pynac. If possible, I would like to avoid Sage-specific patches to upstream projects.\n\nThe whole point is precisely to start a deprecation... though for ease of review I can move the deprecation in another ticket. Would that be better?",
    "created_at": "2018-01-08T11:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339508",
    "user": "vdelecroix"
}
```

Replying to [comment:9 jdemeyer]:
> Can we just do the renaming *without* deprecation for now? That way, we wouldn't need the fix the Pynac. If possible, I would like to avoid Sage-specific patches to upstream projects.

The whole point is precisely to start a deprecation... though for ease of review I can move the deprecation in another ticket. Would that be better?



---

archive/issue_comments_339509.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-08T14:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339509",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_339510.json:
```json
{
    "body": "All right. The import of `ComplexField` from `sage.rings.complex_field` is not deprecated anymore...",
    "created_at": "2018-01-08T14:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339510",
    "user": "vdelecroix"
}
```

All right. The import of `ComplexField` from `sage.rings.complex_field` is not deprecated anymore...



---

archive/issue_comments_339511.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-09T09:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339511",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_339512.json:
```json
{
    "body": "Great! Thanks Ralf. I will put back the deprecation.",
    "created_at": "2018-01-09T09:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339512",
    "user": "vdelecroix"
}
```

Great! Thanks Ralf. I will put back the deprecation.



---

archive/issue_comments_339513.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-09T09:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339513",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_339514.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-09T09:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339514",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_339515.json:
```json
{
    "body": "a lot of doctest failures...",
    "created_at": "2018-01-11T17:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339515",
    "user": "vdelecroix"
}
```

a lot of doctest failures...



---

archive/issue_comments_339516.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-11T17:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339516",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_339517.json:
```json
{
    "body": "Actually these are failing because the patchbot is not merging #24497 first!",
    "created_at": "2018-01-11T19:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339517",
    "user": "vdelecroix"
}
```

Actually these are failing because the patchbot is not merging #24497 first!



---

archive/issue_comments_339518.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-01-11T19:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339518",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_339519.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-01-15T16:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339519",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_339520.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-23T16:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339520",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_339521.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-02-23T16:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339521",
    "user": "rws"
}
```

New commits:



---

archive/issue_comments_339522.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-26T10:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339522",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_339523.json:
```json
{
    "body": "Got one doctest failure\n\n```\nsage -t src/sage/misc/citation.pyx\n**********************************************************************\nFile \"src/sage/misc/citation.pyx\", line 87, in sage.misc.citation.get_systems\nFailed example:\n    get_systems('((a+1)^2).expand()')\nExpected:\n    ['MPFR', 'ginac']\nGot:\n    ['ginac']\n**********************************************************************\n1 item had failures:\n   1 of  11 in sage.misc.citation.get_systems\n    [13 tests, 1 failure, 1.75 s]\n```\n",
    "created_at": "2018-02-26T10:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339523",
    "user": "vdelecroix"
}
```

Got one doctest failure

```
sage -t src/sage/misc/citation.pyx
**********************************************************************
File "src/sage/misc/citation.pyx", line 87, in sage.misc.citation.get_systems
Failed example:
    get_systems('((a+1)^2).expand()')
Expected:
    ['MPFR', 'ginac']
Got:
    ['ginac']
**********************************************************************
1 item had failures:
   1 of  11 in sage.misc.citation.get_systems
    [13 tests, 1 failure, 1.75 s]
```




---

archive/issue_comments_339524.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-10-09T07:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339524",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_339525.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-10-09T07:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339525",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_339526.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-09T13:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339526",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_339527.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-09T13:42:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339527",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_339528.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-09T13:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339528",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_339529.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-09T13:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339529",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_339530.json:
```json
{
    "body": "`@`gh-mjungmath: patchbot gave its green light! Could you do the review?",
    "created_at": "2020-10-10T07:30:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339530",
    "user": "vdelecroix"
}
```

`@`gh-mjungmath: patchbot gave its green light! Could you do the review?



---

archive/issue_comments_339531.json:
```json
{
    "body": "I can try. I just noticed minor things.\n\nThis one could use another line break:\n\n\n```diff\n        return Factorization([(R(gg).monic(), e) for gg, e in zip(*F)],\n                             f.leading_coefficient())\n+\ncdef class ComplexNumber(sage.structure.element.FieldElement):\n    \"\"\"\n    A floating point approximation to a complex number using any\n```\n\n\nDue to the new global import of `Integer`, you can also remove the following now unnecessary imports:\n\n\n```diff\n            sage: ComplexField().characteristic()\n            0\n        \"\"\"\n-        from .integer import Integer\n        return Integer(0)\n...\n            0.309016994374947 + 0.951056516295154*I\n        \"\"\"\n-        from .integer import Integer\n        n = Integer(n)\n        if n == 1:\n```\n\n\nMaybe there are more of those imports, but that's what I swiftly located.\n\nAs far as I can see it, some global variables are collected in the beginning of the file while others are placed right before the corresponding class/method. I think, some sort of unification with good commenting can be beneficial for readability. But maybe that's too pedantic right now and should be part of another ticket if necessary.",
    "created_at": "2020-10-10T23:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339531",
    "user": "@mjungmath"
}
```

I can try. I just noticed minor things.

This one could use another line break:


```diff
        return Factorization([(R(gg).monic(), e) for gg, e in zip(*F)],
                             f.leading_coefficient())
+
cdef class ComplexNumber(sage.structure.element.FieldElement):
    """
    A floating point approximation to a complex number using any
```


Due to the new global import of `Integer`, you can also remove the following now unnecessary imports:


```diff
            sage: ComplexField().characteristic()
            0
        """
-        from .integer import Integer
        return Integer(0)
...
            0.309016994374947 + 0.951056516295154*I
        """
-        from .integer import Integer
        n = Integer(n)
        if n == 1:
```


Maybe there are more of those imports, but that's what I swiftly located.

As far as I can see it, some global variables are collected in the beginning of the file while others are placed right before the corresponding class/method. I think, some sort of unification with good commenting can be beneficial for readability. But maybe that's too pedantic right now and should be part of another ticket if necessary.



---

archive/issue_comments_339532.json:
```json
{
    "body": "Replying to [ticket:24483 vdelecroix]:\n> Pynac used to explicitely depend on these modules but will use the more standard place `sage.rings.all` in the future (see #24497).\n\nThis comment in the ticket description perhaps needs clarification. I don't think we should be moving in the direction of encouraging imports from `*.all` modules.",
    "created_at": "2020-10-11T01:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339532",
    "user": "mkoeppe"
}
```

Replying to [ticket:24483 vdelecroix]:
> Pynac used to explicitely depend on these modules but will use the more standard place `sage.rings.all` in the future (see #24497).

This comment in the ticket description perhaps needs clarification. I don't think we should be moving in the direction of encouraging imports from `*.all` modules.



---

archive/issue_comments_339533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-11T07:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339533",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_339534.json:
```json
{
    "body": "Replying to [comment:36 gh-mjungmath]:\n> I can try. I just noticed minor things.\n>\n> [...]\n>\n\nThank you. I moved around the `late_import`. The remaining `cache` global variable is used in the function just after. It makes sense to keep it there as it is not used anywhere else in the code.",
    "created_at": "2020-10-11T07:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339534",
    "user": "vdelecroix"
}
```

Replying to [comment:36 gh-mjungmath]:
> I can try. I just noticed minor things.
>
> [...]
>

Thank you. I moved around the `late_import`. The remaining `cache` global variable is used in the function just after. It makes sense to keep it there as it is not used anywhere else in the code.



---

archive/issue_comments_339535.json:
```json
{
    "body": "The global variable `LOG_TEN_TWO_PLUS_EPSILON` can also be shifted to `create_ComplexNumber` since this is the only place where it is used.\n\nBesides, this constant is already defined in `sage.arith.constants`, but with a slightly different value it seems. However, this value is imported in `sage.rings.complex_interval` and `sage.rings.real_mpfi`, i.e. everywhere else, but for the very same purpose. If it doesn't affect the code too much, one can import this value from there as well for the sake of unification.",
    "created_at": "2020-10-11T09:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339535",
    "user": "@mjungmath"
}
```

The global variable `LOG_TEN_TWO_PLUS_EPSILON` can also be shifted to `create_ComplexNumber` since this is the only place where it is used.

Besides, this constant is already defined in `sage.arith.constants`, but with a slightly different value it seems. However, this value is imported in `sage.rings.complex_interval` and `sage.rings.real_mpfi`, i.e. everywhere else, but for the very same purpose. If it doesn't affect the code too much, one can import this value from there as well for the sake of unification.



---

archive/issue_comments_339536.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-11T09:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339536",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_339537.json:
```json
{
    "body": "Replying to [comment:41 gh-mjungmath]:\n> The global variable `LOG_TEN_TWO_PLUS_EPSILON` can also be shifted to `create_ComplexNumber` since this is the only place where it is used.\n> \n> Besides, this constant is already defined in `sage.arith.constants`, but with a slightly different value it seems. However, this value is imported in `sage.rings.complex_interval` and `sage.rings.real_mpfi`, i.e. everywhere else, but for the very same purpose. If it doesn't affect the code too much, one can import this value from there as well for the sake of unification.\n\nTrue. Fixed in the last commit.",
    "created_at": "2020-10-11T09:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339537",
    "user": "vdelecroix"
}
```

Replying to [comment:41 gh-mjungmath]:
> The global variable `LOG_TEN_TWO_PLUS_EPSILON` can also be shifted to `create_ComplexNumber` since this is the only place where it is used.
> 
> Besides, this constant is already defined in `sage.arith.constants`, but with a slightly different value it seems. However, this value is imported in `sage.rings.complex_interval` and `sage.rings.real_mpfi`, i.e. everywhere else, but for the very same purpose. If it doesn't affect the code too much, one can import this value from there as well for the sake of unification.

True. Fixed in the last commit.



---

archive/issue_comments_339538.json:
```json
{
    "body": "I think, this would be it from my side. When patchbot turns green, I can give a positive review.",
    "created_at": "2020-10-11T09:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339538",
    "user": "@mjungmath"
}
```

I think, this would be it from my side. When patchbot turns green, I can give a positive review.



---

archive/issue_comments_339539.json:
```json
{
    "body": "Replying to [comment:26 vdelecroix]:\n> Got one doctest failure\n> {{{\n> sage -t src/sage/misc/citation.pyx\n> **********************************************************************\n> File \"src/sage/misc/citation.pyx\", line 87, in sage.misc.citation.get_systems\n> Failed example:\n>     get_systems('((a+1)^2).expand()')\n> Expected:\n>     ['MPFR', 'ginac']\n> Got:\n>     ['ginac']\n> **********************************************************************\n> 1 item had failures:\n>    1 of  11 in sage.misc.citation.get_systems\n>     [13 tests, 1 failure, 1.75 s]\n> }}}\n\nIs it worth to investigate why this (former) \"spurious\" output is gone now?",
    "created_at": "2020-10-11T10:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339539",
    "user": "@mjungmath"
}
```

Replying to [comment:26 vdelecroix]:
> Got one doctest failure
> {{{
> sage -t src/sage/misc/citation.pyx
> **********************************************************************
> File "src/sage/misc/citation.pyx", line 87, in sage.misc.citation.get_systems
> Failed example:
>     get_systems('((a+1)^2).expand()')
> Expected:
>     ['MPFR', 'ginac']
> Got:
>     ['ginac']
> **********************************************************************
> 1 item had failures:
>    1 of  11 in sage.misc.citation.get_systems
>     [13 tests, 1 failure, 1.75 s]
> }}}

Is it worth to investigate why this (former) "spurious" output is gone now?



---

archive/issue_comments_339540.json:
```json
{
    "body": "This was a pretty bad doctest. It is removed in my commits\n\n```diff\ndiff --git a/src/sage/misc/citation.pyx b/src/sage/misc/citation.pyx\nindex 2de53c1..847f357 100644\n--- a/src/sage/misc/citation.pyx\n+++ b/src/sage/misc/citation.pyx\n@@ -40,7 +40,7 @@ systems['NTL'] = ['sage.libs.ntl',\n systems['FLINT'] = ['_flint']\n systems['GMP'] = ['sage.rings.integer.Integer']\n systems['MPFR'] = ['sage.rings.real_mpfr',\n-                   'sage.rings.complex_number']\n+                   'sage.rings.complex_mpfr']\n systems['MPFI'] = ['sage.rings.real_mpfi',\n                    'sage.rings.complex_interval']\n systems['M4RI'] = ['sage.matrix.matrix_mod2_dense']\n@@ -80,15 +80,6 @@ def get_systems(cmd):\n         sage: I = R.ideal(x^2+y^2, z^2+y)\n         sage: get_systems('I.primary_decomposition()')\n         ['Singular']\n-\n-    Here we get a spurious ``MPFR`` because some coercions need to be\n-    initialized. The second time it is gone::\n-\n-        sage: a = var('a')\n-        sage: get_systems('((a+1)^2).expand()')\n-        ['MPFR', 'ginac']\n-        sage: get_systems('((a+1)^2).expand()')\n-        ['ginac']\n     \"\"\"\n     import cProfile, pstats, re\n```\n",
    "created_at": "2020-10-11T10:58:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339540",
    "user": "vdelecroix"
}
```

This was a pretty bad doctest. It is removed in my commits

```diff
diff --git a/src/sage/misc/citation.pyx b/src/sage/misc/citation.pyx
index 2de53c1..847f357 100644
--- a/src/sage/misc/citation.pyx
+++ b/src/sage/misc/citation.pyx
@@ -40,7 +40,7 @@ systems['NTL'] = ['sage.libs.ntl',
 systems['FLINT'] = ['_flint']
 systems['GMP'] = ['sage.rings.integer.Integer']
 systems['MPFR'] = ['sage.rings.real_mpfr',
-                   'sage.rings.complex_number']
+                   'sage.rings.complex_mpfr']
 systems['MPFI'] = ['sage.rings.real_mpfi',
                    'sage.rings.complex_interval']
 systems['M4RI'] = ['sage.matrix.matrix_mod2_dense']
@@ -80,15 +80,6 @@ def get_systems(cmd):
         sage: I = R.ideal(x^2+y^2, z^2+y)
         sage: get_systems('I.primary_decomposition()')
         ['Singular']
-
-    Here we get a spurious ``MPFR`` because some coercions need to be
-    initialized. The second time it is gone::
-
-        sage: a = var('a')
-        sage: get_systems('((a+1)^2).expand()')
-        ['MPFR', 'ginac']
-        sage: get_systems('((a+1)^2).expand()')
-        ['ginac']
     """
     import cProfile, pstats, re
```




---

archive/issue_comments_339541.json:
```json
{
    "body": "Replying to [comment:46 vdelecroix]:\n> This was a pretty bad doctest. It is removed in my commits\n> {{{\n> #!diff\n> diff --git a/src/sage/misc/citation.pyx b/src/sage/misc/citation.pyx\n> index 2de53c1..847f357 100644\n> --- a/src/sage/misc/citation.pyx\n> +++ b/src/sage/misc/citation.pyx\n> `@``@` -40,7 +40,7 `@``@` systems['NTL'] = ['sage.libs.ntl',\n>  systems['FLINT'] = ['_flint']\n>  systems['GMP'] = ['sage.rings.integer.Integer']\n>  systems['MPFR'] = ['sage.rings.real_mpfr',\n> -                   'sage.rings.complex_number']\n> +                   'sage.rings.complex_mpfr']\n>  systems['MPFI'] = ['sage.rings.real_mpfi',\n>                     'sage.rings.complex_interval']\n>  systems['M4RI'] = ['sage.matrix.matrix_mod2_dense']\n> `@``@` -80,15 +80,6 `@``@` def get_systems(cmd):\n>          sage: I = R.ideal(x<sup>2+y</sup>2, z^2+y)\n>          sage: get_systems('I.primary_decomposition()')\n>          ['Singular']\n> -\n> -    Here we get a spurious ``MPFR`` because some coercions need to be\n> -    initialized. The second time it is gone::\n> -\n> -        sage: a = var('a')\n> -        sage: get_systems('((a+1)^2).expand()')\n> -        ['MPFR', 'ginac']\n> -        sage: get_systems('((a+1)^2).expand()')\n> -        ['ginac']\n>      \"\"\"\n>      import cProfile, pstats, re\n> }}}\n\nThanks. Removing the test seems sensible. However, I just ask myself why this ticket has that effect. Perhaps it is worth to investigate it?",
    "created_at": "2020-10-11T11:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339541",
    "user": "@mjungmath"
}
```

Replying to [comment:46 vdelecroix]:
> This was a pretty bad doctest. It is removed in my commits
> {{{
> #!diff
> diff --git a/src/sage/misc/citation.pyx b/src/sage/misc/citation.pyx
> index 2de53c1..847f357 100644
> --- a/src/sage/misc/citation.pyx
> +++ b/src/sage/misc/citation.pyx
> `@``@` -40,7 +40,7 `@``@` systems['NTL'] = ['sage.libs.ntl',
>  systems['FLINT'] = ['_flint']
>  systems['GMP'] = ['sage.rings.integer.Integer']
>  systems['MPFR'] = ['sage.rings.real_mpfr',
> -                   'sage.rings.complex_number']
> +                   'sage.rings.complex_mpfr']
>  systems['MPFI'] = ['sage.rings.real_mpfi',
>                     'sage.rings.complex_interval']
>  systems['M4RI'] = ['sage.matrix.matrix_mod2_dense']
> `@``@` -80,15 +80,6 `@``@` def get_systems(cmd):
>          sage: I = R.ideal(x<sup>2+y</sup>2, z^2+y)
>          sage: get_systems('I.primary_decomposition()')
>          ['Singular']
> -
> -    Here we get a spurious ``MPFR`` because some coercions need to be
> -    initialized. The second time it is gone::
> -
> -        sage: a = var('a')
> -        sage: get_systems('((a+1)^2).expand()')
> -        ['MPFR', 'ginac']
> -        sage: get_systems('((a+1)^2).expand()')
> -        ['ginac']
>      """
>      import cProfile, pstats, re
> }}}

Thanks. Removing the test seems sensible. However, I just ask myself why this ticket has that effect. Perhaps it is worth to investigate it?



---

archive/issue_comments_339542.json:
```json
{
    "body": "It might be complicated to track down precisely... with no reward as far as I can see.",
    "created_at": "2020-10-11T11:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339542",
    "user": "vdelecroix"
}
```

It might be complicated to track down precisely... with no reward as far as I can see.



---

archive/issue_comments_339543.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-11T12:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339543",
    "user": "@mjungmath"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_339544.json:
```json
{
    "body": "Patchbot morally green. LGTM.",
    "created_at": "2020-10-11T12:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339544",
    "user": "@mjungmath"
}
```

Patchbot morally green. LGTM.



---

archive/issue_comments_339545.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-10-11T12:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339545",
    "user": "vdelecroix"
}
```

Thank you!



---

archive/issue_comments_339546.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-10-31T18:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339546",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_339547.json:
```json
{
    "body": "Hi Vincent,\n\nWhat would you think of keeping files `complex_field.py` and `complex_number.pyx` that `import *` from the new location for a while, in the interest of backward compatibility?",
    "created_at": "2020-11-02T17:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339547",
    "user": "mmezzarobba"
}
```

Hi Vincent,

What would you think of keeping files `complex_field.py` and `complex_number.pyx` that `import *` from the new location for a while, in the interest of backward compatibility?



---

archive/issue_comments_339548.json:
```json
{
    "body": "Definitely (with deprecated lazy imports)!",
    "created_at": "2020-11-02T17:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339548",
    "user": "vdelecroix"
}
```

Definitely (with deprecated lazy imports)!



---

archive/issue_comments_339549.json:
```json
{
    "body": "Could you open a ticket?",
    "created_at": "2020-11-02T17:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339549",
    "user": "vdelecroix"
}
```

Could you open a ticket?



---

archive/issue_comments_339550.json:
```json
{
    "body": "\u2192 #30857",
    "created_at": "2020-11-03T16:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24246",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24246#issuecomment-339550",
    "user": "mmezzarobba"
}
```

→ #30857
