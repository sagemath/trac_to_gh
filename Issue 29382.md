# Issue 29382: tensors should have a sparse iterator

Issue created by migration from https://trac.sagemath.org/ticket/29619

Original creator: @mwageringel

Original creation time: 2020-04-29 17:36:59

CC:  egourgoulhon @lbrunswic @honglizhaobob tscrim

As observed on this [Ask SageMath question](https://ask.sagemath.org/question/51004), it does not seem to be possible to iterate over the non-zero entries of a tensor. This is unfortunate because the entries are stored in a sparse format, in a dictionary.

Since a tensor might have symmetries, this is more involved than just iterating over the dictionary, but such an iterator would immediately be useful for the implementation of the `display()` method, for instance.


---

Comment by mkoeppe created at 2020-04-29 19:52:43

Changing priority from minor to major.


---

Comment by egourgoulhon created at 2020-04-30 07:51:27

Thanks for opening this ticket. I've added a link to it in the "Algebraic part" section of the meta-ticket #18528.


---

Comment by mkoeppe created at 2020-08-13 16:54:32

See also: #30309 - Unify free module elements API: methods `dict`, `monomial_coefficients`, etc.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-06-15 17:48:42

`@`gh-honglizhaobob This is probably the best ticket for starting


---

Comment by @honglizhaobob created at 2021-06-18 15:45:37

Replying to [comment:7 mkoeppe]:
> `@`gh-honglizhaobob This is probably the best ticket for starting

Is there a set of unit test cases one needs to pass to ensure a justified change of data structure?


---

Comment by mkoeppe created at 2021-06-18 17:32:37

To clarify - here on this ticket, the data structure shouldn't be changed but instead methods added.

Sage mainly uses doctests - see https://doc.sagemath.org/html/en/developer/doctesting.html
but there are also unit tests, which are invoked within the doctests by `TestSuite(...).run()`.


---

Comment by git created at 2021-07-05 20:18:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-05 22:04:23


```
+        for multi_idx in self._comp.keys():
+            # access value in dictionary
+            coef = self._comp[multi_idx]
```

You can use `.items()` here - see https://docs.python.org/3/tutorial/datastructures.html#looping-techniques


---

Comment by mkoeppe created at 2022-08-30 06:32:12

New commits:


---

Comment by mkoeppe created at 2022-08-30 06:32:12

Changing status from new to needs_review.


---

Comment by git created at 2022-08-30 06:32:44

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-08-30 06:58:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2022-09-01 14:01:10

Thanks for implementing this. LGTM.


---

Comment by egourgoulhon created at 2022-09-01 14:01:10

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-09-01 14:49:48

Thanks!


---

Comment by vbraun created at 2022-09-20 20:23:19

Resolution: fixed
