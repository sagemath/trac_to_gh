# Issue 22641: Add gmp to libraries for libs/ecl and rings/bernmm

archive/issues_022641.json:
```json
{
    "body": "CC:  embray jpflori gouezel jdemeyer\n\nNeeded to build on Cygwin. Likely now needed from changes from #22728.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22878\n\n",
    "created_at": "2017-04-26T15:36:36Z",
    "labels": [
        "porting: Cygwin",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Add gmp to libraries for libs/ecl and rings/bernmm",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22641",
    "user": "tscrim"
}
```
CC:  embray jpflori gouezel jdemeyer

Needed to build on Cygwin. Likely now needed from changes from #22728.

Issue created by migration from https://trac.sagemath.org/ticket/22878





---

archive/issue_comments_315865.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-26T15:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315865",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_315866.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-26T15:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315866",
    "user": "tscrim"
}
```

New commits:



---

archive/issue_comments_315867.json:
```json
{
    "body": "Wouldn't it be better to modify the corresponding pxd files?\n\nThen we could remove the libraries lines from module.py.",
    "created_at": "2017-04-26T15:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315867",
    "user": "jpflori"
}
```

Wouldn't it be better to modify the corresponding pxd files?

Then we could remove the libraries lines from module.py.



---

archive/issue_comments_315868.json:
```json
{
    "body": "Do you mean adding `# distutils: libraries = gmp` (well, with what is needed) to the .pyx files?",
    "created_at": "2017-04-26T15:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315868",
    "user": "tscrim"
}
```

Do you mean adding `# distutils: libraries = gmp` (well, with what is needed) to the .pyx files?



---

archive/issue_comments_315869.json:
```json
{
    "body": "Adding:\n`# distutils: libraries = ecl gmp` to ecl.pxd.\n\nFor fes.pyx, there is no pxd file so...",
    "created_at": "2017-04-26T15:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315869",
    "user": "jpflori"
}
```

Adding:
`# distutils: libraries = ecl gmp` to ecl.pxd.

For fes.pyx, there is no pxd file so...



---

archive/issue_comments_315870.json:
```json
{
    "body": "But it should also work in the pyx file.",
    "created_at": "2017-04-26T16:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315870",
    "user": "jpflori"
}
```

But it should also work in the pyx file.



---

archive/issue_comments_315871.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-26T16:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315871",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_315872.json:
```json
{
    "body": "It's probably better to do it in the .pxd (I had only seen it done in .pyx before).",
    "created_at": "2017-04-26T16:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315872",
    "user": "tscrim"
}
```

It's probably better to do it in the .pxd (I had only seen it done in .pyx before).



---

archive/issue_comments_315873.json:
```json
{
    "body": "`@`jeroen: what do you think?",
    "created_at": "2017-04-26T16:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315873",
    "user": "jpflori"
}
```

`@`jeroen: what do you think?



---

archive/issue_comments_315874.json:
```json
{
    "body": "Oops, don't know why I was speaking of fes.pyx...\n\nFor bernmm, I agree that module.py is the right place to do it.\nIn fact we should definitely split back bernmm into a separate package.",
    "created_at": "2017-04-26T16:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315874",
    "user": "jpflori"
}
```

Oops, don't know why I was speaking of fes.pyx...

For bernmm, I agree that module.py is the right place to do it.
In fact we should definitely split back bernmm into a separate package.



---

archive/issue_comments_315875.json:
```json
{
    "body": "No worries; probably because it is there in the neighboring diff.",
    "created_at": "2017-04-26T16:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315875",
    "user": "tscrim"
}
```

No worries; probably because it is there in the neighboring diff.



---

archive/issue_comments_315876.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-26T17:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315876",
    "user": "embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_315877.json:
```json
{
    "body": "I tried reverting #22728 but that didn't seem fix the problem, so I guess that wasn't it after all, at least not on its own.  Somehow this broke just between 8.0.beta2 and 8.0.beta3 and I don't know why, which is disconcerting.  \n\nBut I think this is fine as a workaround, and is not the first time I've had to do this...",
    "created_at": "2017-04-26T17:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315877",
    "user": "embray"
}
```

I tried reverting #22728 but that didn't seem fix the problem, so I guess that wasn't it after all, at least not on its own.  Somehow this broke just between 8.0.beta2 and 8.0.beta3 and I don't know why, which is disconcerting.  

But I think this is fine as a workaround, and is not the first time I've had to do this...



---

archive/issue_comments_315878.json:
```json
{
    "body": "It could be also be related to #22805 or #22806. *shrugs* Well, if we fix all of the symptoms, then we've likely fixed the problem...",
    "created_at": "2017-04-26T17:47:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315878",
    "user": "tscrim"
}
```

It could be also be related to #22805 or #22806. *shrugs* Well, if we fix all of the symptoms, then we've likely fixed the problem...



---

archive/issue_comments_315879.json:
```json
{
    "body": "Replying to [comment:8 jpflori]:\n> `@`jeroen: what do you think?\n\nI think it should be added in the place which causes the dependency. For example, ECL depends on GMP, so it makes sense that every module which uses `ecl.pxd` should link against `gmp`.\n\nI would *not* add to `module_list.py`. Ideally, `module_list.py` should not exist in the first place. It's much cleaner to add the `# distutils` declarations in the Cython source file.",
    "created_at": "2017-04-26T17:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315879",
    "user": "jdemeyer"
}
```

Replying to [comment:8 jpflori]:
> `@`jeroen: what do you think?

I think it should be added in the place which causes the dependency. For example, ECL depends on GMP, so it makes sense that every module which uses `ecl.pxd` should link against `gmp`.

I would *not* add to `module_list.py`. Ideally, `module_list.py` should not exist in the first place. It's much cleaner to add the `# distutils` declarations in the Cython source file.



---

archive/issue_comments_315880.json:
```json
{
    "body": "Yes, it must have been #22806.  That's fine.  And yes, it used a `# distutils` declaration in this case.",
    "created_at": "2017-04-26T17:56:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315880",
    "user": "embray"
}
```

Yes, it must have been #22806.  That's fine.  And yes, it used a `# distutils` declaration in this case.



---

archive/issue_comments_315881.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-28T23:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22641",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22641#issuecomment-315881",
    "user": "vbraun"
}
```

Resolution: fixed
