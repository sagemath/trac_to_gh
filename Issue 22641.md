# Issue 22641: Add gmp to libraries for libs/ecl and rings/bernmm

Issue created by migration from https://trac.sagemath.org/ticket/22878

Original creator: tscrim

Original creation time: 2017-04-26 15:36:36

CC:  embray jpflori gouezel jdemeyer

Needed to build on Cygwin. Likely now needed from changes from #22728.


---

Comment by tscrim created at 2017-04-26 15:40:16

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-04-26 15:40:16

New commits:


---

Comment by jpflori created at 2017-04-26 15:46:29

Wouldn't it be better to modify the corresponding pxd files?

Then we could remove the libraries lines from module.py.


---

Comment by tscrim created at 2017-04-26 15:53:51

Do you mean adding `# distutils: libraries = gmp` (well, with what is needed) to the .pyx files?


---

Comment by jpflori created at 2017-04-26 15:56:55

Adding:
`# distutils: libraries = ecl gmp` to ecl.pxd.

For fes.pyx, there is no pxd file so...


---

Comment by jpflori created at 2017-04-26 16:10:29

But it should also work in the pyx file.


---

Comment by git created at 2017-04-26 16:14:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-04-26 16:15:22

It's probably better to do it in the .pxd (I had only seen it done in .pyx before).


---

Comment by jpflori created at 2017-04-26 16:17:14

`@`jeroen: what do you think?


---

Comment by jpflori created at 2017-04-26 16:18:19

Oops, don't know why I was speaking of fes.pyx...

For bernmm, I agree that module.py is the right place to do it.
In fact we should definitely split back bernmm into a separate package.


---

Comment by tscrim created at 2017-04-26 16:19:06

No worries; probably because it is there in the neighboring diff.


---

Comment by embray created at 2017-04-26 17:44:03

Changing status from needs_review to positive_review.


---

Comment by embray created at 2017-04-26 17:44:03

I tried reverting #22728 but that didn't seem fix the problem, so I guess that wasn't it after all, at least not on its own.  Somehow this broke just between 8.0.beta2 and 8.0.beta3 and I don't know why, which is disconcerting.  

But I think this is fine as a workaround, and is not the first time I've had to do this...


---

Comment by tscrim created at 2017-04-26 17:47:59

It could be also be related to #22805 or #22806. *shrugs* Well, if we fix all of the symptoms, then we've likely fixed the problem...


---

Comment by jdemeyer created at 2017-04-26 17:50:39

Replying to [comment:8 jpflori]:
> `@`jeroen: what do you think?

I think it should be added in the place which causes the dependency. For example, ECL depends on GMP, so it makes sense that every module which uses `ecl.pxd` should link against `gmp`.

I would _not_ add to `module_list.py`. Ideally, `module_list.py` should not exist in the first place. It's much cleaner to add the `# distutils` declarations in the Cython source file.


---

Comment by embray created at 2017-04-26 17:56:09

Yes, it must have been #22806.  That's fine.  And yes, it used a `# distutils` declaration in this case.


---

Comment by vbraun created at 2017-04-28 23:54:34

Resolution: fixed
