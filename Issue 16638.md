# Issue 16638: Some caching in orthogonal_array_recursive

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2014-08-24 22:51:14

CC:  vdelecroix

Win some perf with a couple of improvements. Nothing fantastic, but still worth taking.

Nathann


---

Comment by ncohen created at 2014-08-24 23:07:40

Changing status from new to needs_review.


---

Comment by ncohen created at 2014-08-24 23:08:42

Last 10 new commits:


---

Comment by git created at 2014-08-25 00:54:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-08-25 01:00:18

Hello,

What we win with my first commit is impressive!

About your commit: I do not like the fact that we cache twice the same data. `_OA_cache` already contains everything.

Vincent


---

Comment by vdelecroix created at 2014-08-25 01:00:23

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2014-08-25 08:52:44

Yo !

> What we win with my first commit is impressive!

The imports.... `T_T`

And they don't even appear in %prun `T_T`

> About your commit: I do not like the fact that we cache twice the same data. `_OA_cache` already contains everything.

Well, do you like the timings ? Actually, it seems that your removing the imports was an important part of why the recursive functions were so slow. With your modification my caching only saves one second over the 10 that it takes to build the table up to 1000, but well... I think it's worth keeping anyway. And perhaps we will remove that when everything will be in Cython for it will not save anything anymore.

Nathann


---

Comment by vdelecroix created at 2014-08-25 10:07:42

Another proposition at `public/16875-bis`. I implemented a `orthogonal_array_available` and hence avoid the double caching. I really do *not* like the fact that we cache twice the same information.

Vincent


---

Comment by ncohen created at 2014-08-25 11:27:55

Yo !

You may not like this additional caching (1Mb or RAM ? Yes I understand, that can be a problem) but what I do not like are public functions like yours with "the hack I need for my own code" that checks consecutive values. You just don't write that in a user-exposed function.

Here is a proposition: your two commits here are good and are useful, se we need them now. If this Mb of caching is a problem for you then we can remove it from this ticket and let it go like that.

Your function `orthogonal_array_available` looks a lot like the function `is_available(k,n_` I proposed to implement earlier in a "designs.orthogonal_arrays" orbject, along with `build(k,n)`, `best_k(n)`, etc... So if we have to do something like that we will do it properly with such functions.

I will also use the chance to convert the caching system to pure Cython, so that it will become a simple array lookup, nothing more complicated.

We can also keep this caching thing in the meantime, it's up to you.

Tell me and I will start writing the code.

Nathann


---

Comment by vdelecroix created at 2014-08-25 11:40:47

Hello,

> You may not like this additional caching (1Mb or RAM ? Yes I understand, that can be a problem) but what I do not like are public functions like yours with "the hack I need for my own code" that checks consecutive values. You just don't write that in a user-exposed function.

Because your caching is not "the hack I need for my own code"? Moreover, in my `orthogonal_array_available` it makes not a big difference to remove the `mult` parameter. And if you prefer, I can set the name to `_orthogonal_array_available`. My problem is not the fact that you use memory, but the fact that you cache twice the same data.

The simplest would be to let this ticket go without `_cache_m_zero_one_two` and without `orthogonal_array_available`. And it is clear that the good solution would be to implement the Cython version of the function you suggest: `is_available`.

Vincent


---

Comment by ncohen created at 2014-08-25 11:54:30

Changing status from needs_info to positive_review.


---

Comment by ncohen created at 2014-08-25 11:54:30

Yo !

> Because your caching is not "the hack I need for my own code"?

My function is cached and is named `_cache_m_zero_k_m`. It *SCREAMS* that it is not meant for users. Yours is named "orthogonal_arrayy_available" and supports a weird parameters aboit consecutive values.

> Moreover, in my `orthogonal_array_available` it makes not a big difference to remove the `mult` parameter. And if you prefer, I can set the name to `_orthogonal_array_available`. My problem is not the fact that you use memory, but the fact that you cache twice the same data.

You have nothing when the data being stored is 99% of useless pointers because it's dictionaries toward Integer objects, or when you store numbers between 0 and 1000 ont 64-bits integers, but it becomes a problem when instead of the useless data you store twice the same thing ? `:-P`

> The simplest would be to let this ticket go without `_cache_m_zero_one_two` and without `orthogonal_array_available`. And it is clear that the good solution would be to implement the Cython version of the function you suggest: `is_available`.

Okay ! Then I update this branch in a second and give it a positive review (all the code is yours). And I will begin to write this is_availabe function in a second, everything in Cython. Let's hope that it will make a big difference !

Nathann


---

Comment by git created at 2014-08-25 11:55:06

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by git created at 2014-08-25 11:55:06

Changing status from positive_review to needs_review.


---

Comment by vdelecroix created at 2014-08-25 12:10:39

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2014-08-25 12:10:39

(set back to positive review as a push changes the status)


---

Comment by ncohen created at 2014-08-25 15:28:48

Thanks !

Nathann


---

Comment by vbraun created at 2014-08-25 19:36:56

Resolution: fixed
