# Issue 12637: Solve does not give consistent results when a dummy variable is involved

archive/issues_012637.json:
```json
{
    "body": "Assignee: burcin\n\nCC:  kcrisman mjo eviatarbach\n\nKeywords: solve\n\nWhen working on another ticket (#11201) that involves documentation for the solve function, doing doctests proved to be frustrating. I added to the examples section of the docstring, and then multiple tests failed. I did some manual testing in sage and noticed a problem:\n\n\n\n```\nsage: var('x y')\n(x, y)\nsage: solve(cos(x)*sin(y)==1/2, x+y==0,x,y)\n[[x == 1/4*pi + pi*z6, y == -1/4*pi - pi*z6]]\n```\n\n\n\nThis is a perfectly valid answer, except that when I tried to solve the same equations again, the answer is different:\n\n\n\n```\nsage: solve(cos(x)*sin(y)==1/2, x+y==0,x,y)\n[[x == 1/4*pi + pi*z14, y == -1/4*pi - pi*z14]]\n```\n\n\n\nThis is still mathematically correct.\nIf I solve them many more times, z's coefficient keeps going up by 8:\n\n\n\n```\nsage: solve(cos(x)*sin(y)==1/2, x+y==0,x,y)\n[[x == 1/4*pi + pi*z22, y == -1/4*pi - pi*z22]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z30, y == -1/4*pi - pi*z30]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z38, y == -1/4*pi - pi*z38]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z46, y == -1/4*pi - pi*z46]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z54, y == -1/4*pi - pi*z54]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z62, y == -1/4*pi - pi*z62]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z70, y == -1/4*pi - pi*z70]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z78, y == -1/4*pi - pi*z78]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z86, y == -1/4*pi - pi*z86]]\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z94, y == -1/4*pi - pi*z94]]\n```\n\n\n\nAll still mathematically correct.\n\nThis is a problem when you are trying to add examples to the documentation for solve and many doctests fail because the coefficients for the dummy variable are shifted up by some integer amount. I have included the file expressions_pyx_doctests.txt to show more of what I am talking about. To cause this, I added two examples, and the examples that I added were not complained about in the doctest. Also, z's coefficient went up by 6 this time, different than 8 in the first example.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12809\n\n",
    "created_at": "2012-04-05T01:22:56Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "title": "Solve does not give consistent results when a dummy variable is involved",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12637",
    "user": "afleckenstein"
}
```
Assignee: burcin

CC:  kcrisman mjo eviatarbach

Keywords: solve

When working on another ticket (#11201) that involves documentation for the solve function, doing doctests proved to be frustrating. I added to the examples section of the docstring, and then multiple tests failed. I did some manual testing in sage and noticed a problem:



```
sage: var('x y')
(x, y)
sage: solve(cos(x)*sin(y)==1/2, x+y==0,x,y)
[[x == 1/4*pi + pi*z6, y == -1/4*pi - pi*z6]]
```



This is a perfectly valid answer, except that when I tried to solve the same equations again, the answer is different:



```
sage: solve(cos(x)*sin(y)==1/2, x+y==0,x,y)
[[x == 1/4*pi + pi*z14, y == -1/4*pi - pi*z14]]
```



This is still mathematically correct.
If I solve them many more times, z's coefficient keeps going up by 8:



```
sage: solve(cos(x)*sin(y)==1/2, x+y==0,x,y)
[[x == 1/4*pi + pi*z22, y == -1/4*pi - pi*z22]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z30, y == -1/4*pi - pi*z30]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z38, y == -1/4*pi - pi*z38]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z46, y == -1/4*pi - pi*z46]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z54, y == -1/4*pi - pi*z54]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z62, y == -1/4*pi - pi*z62]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z70, y == -1/4*pi - pi*z70]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z78, y == -1/4*pi - pi*z78]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z86, y == -1/4*pi - pi*z86]]
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z94, y == -1/4*pi - pi*z94]]
```



All still mathematically correct.

This is a problem when you are trying to add examples to the documentation for solve and many doctests fail because the coefficients for the dummy variable are shifted up by some integer amount. I have included the file expressions_pyx_doctests.txt to show more of what I am talking about. To cause this, I added two examples, and the examples that I added were not complained about in the doctest. Also, z's coefficient went up by 6 this time, different than 8 in the first example.


Issue created by migration from https://trac.sagemath.org/ticket/12809





---

archive/issue_comments_150506.json:
```json
{
    "body": "Attachment [expression_pyx_doctest.txt](tarball://root/attachments/some-uuid/ticket12809/expression_pyx_doctest.txt) by afleckenstein created at 2012-04-05 01:23:12",
    "created_at": "2012-04-05T01:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150506",
    "user": "afleckenstein"
}
```

Attachment [expression_pyx_doctest.txt](tarball://root/attachments/some-uuid/ticket12809/expression_pyx_doctest.txt) by afleckenstein created at 2012-04-05 01:23:12



---

archive/issue_comments_150507.json:
```json
{
    "body": "This is a known issue - I won't call it a problem, though some people (like the reporter) certainly have strong feelings on this.  People have tried to weasel out of it in changing doctests by putting ellipses in for the variable names, but in the end it's better to show the end user reading the documentation what a likely output actually looks like.  Concur that it's annoying for those writing doctests, but at least in one opinion this is not really a bug.\n\nThat said, if we can be smart enough with Maxima and how it's naming these dummy variables for this not to happen, or to return something different, that would be great.  But it's probably not worth the effort, given how many actual enhancements or bugs we can fix instead :-)",
    "created_at": "2012-04-05T01:45:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150507",
    "user": "kcrisman"
}
```

This is a known issue - I won't call it a problem, though some people (like the reporter) certainly have strong feelings on this.  People have tried to weasel out of it in changing doctests by putting ellipses in for the variable names, but in the end it's better to show the end user reading the documentation what a likely output actually looks like.  Concur that it's annoying for those writing doctests, but at least in one opinion this is not really a bug.

That said, if we can be smart enough with Maxima and how it's naming these dummy variables for this not to happen, or to return something different, that would be great.  But it's probably not worth the effort, given how many actual enhancements or bugs we can fix instead :-)



---

archive/issue_comments_150508.json:
```json
{
    "body": "Replying to [comment:1 kcrisman]:\n> This is a known issue - I won't call it a problem, though some people (like the reporter) certainly have strong feelings on this.  People have tried to weasel out of it in changing doctests by putting ellipses in for the variable names, but in the end it's better to show the end user reading the documentation what a likely output actually looks like. \n\nI completely disagree with you.  I think it is perfectly reasonable to replace an example like\n\n```\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z94, y == -1/4*pi - pi*z94]]\n```\n\nwith\n\n```\nsage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\n[[x == 1/4*pi + pi*z..., y == -1/4*pi - pi*z...]]\n```\n\n\nAlternatively, if this is NOT intended for somebody to actually read, then simply make it a \"unit test\", e.g., put all the tests into a function (e.g., \"test_solve\"), then do whatever you want to verify correctness of output using asserts, and finally put one single doctest in test_solve, which is:\n\n```\nsage: test_solve()\n```\n",
    "created_at": "2012-04-06T22:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150508",
    "user": "was"
}
```

Replying to [comment:1 kcrisman]:
> This is a known issue - I won't call it a problem, though some people (like the reporter) certainly have strong feelings on this.  People have tried to weasel out of it in changing doctests by putting ellipses in for the variable names, but in the end it's better to show the end user reading the documentation what a likely output actually looks like. 

I completely disagree with you.  I think it is perfectly reasonable to replace an example like

```
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z94, y == -1/4*pi - pi*z94]]
```

with

```
sage: solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
[[x == 1/4*pi + pi*z..., y == -1/4*pi - pi*z...]]
```


Alternatively, if this is NOT intended for somebody to actually read, then simply make it a "unit test", e.g., put all the tests into a function (e.g., "test_solve"), then do whatever you want to verify correctness of output using asserts, and finally put one single doctest in test_solve, which is:

```
sage: test_solve()
```




---

archive/issue_comments_150509.json:
```json
{
    "body": "This does suggest we may want to consider reseting Maxima's counter for dummy variables before calling solve.",
    "created_at": "2012-04-06T22:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150509",
    "user": "was"
}
```

This does suggest we may want to consider reseting Maxima's counter for dummy variables before calling solve.



---

archive/issue_comments_150510.json:
```json
{
    "body": "Replying to [comment:3 was]:\n> This does suggest we may want to consider reseting Maxima's counter for dummy variables before calling solve.\n\nIt would require care of the user to remember whether different occurrences of the same variable name refer to independent parameters or not, but to_poly has a convenience function to relabel the temporaries:\n\n```\n(%i1) load(to_poly_solver);\n(%o1) ...\n(%i2) display2d: false;\n(%o2) false\n(%i3) nicedummies(to_poly_solve([sin(x)=cos(x)],[x]));\n(%o3) %union([x = (4*%pi*%z0+%pi)/4])\n(%i4) nicedummies(to_poly_solve([sin(x)=cos(x)],[x]));\n(%o4) %union([x = (4*%pi*%z0+%pi)/4])\n```\n\nI think the slight inconvenience of getting new names every time is preferable to the ambiguity that is caused by reusing names among several equation solves. Another issue is that the maxima-to-sage conversion maps %z1 to z1 without checking. This can lead to further unintended name collisions.\n\n(but then again, if someone is willing to use the results returned by a CAS solve routine without checking, they're asking for trouble anyway)",
    "created_at": "2012-04-07T05:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150510",
    "user": "nbruin"
}
```

Replying to [comment:3 was]:
> This does suggest we may want to consider reseting Maxima's counter for dummy variables before calling solve.

It would require care of the user to remember whether different occurrences of the same variable name refer to independent parameters or not, but to_poly has a convenience function to relabel the temporaries:

```
(%i1) load(to_poly_solver);
(%o1) ...
(%i2) display2d: false;
(%o2) false
(%i3) nicedummies(to_poly_solve([sin(x)=cos(x)],[x]));
(%o3) %union([x = (4*%pi*%z0+%pi)/4])
(%i4) nicedummies(to_poly_solve([sin(x)=cos(x)],[x]));
(%o4) %union([x = (4*%pi*%z0+%pi)/4])
```

I think the slight inconvenience of getting new names every time is preferable to the ambiguity that is caused by reusing names among several equation solves. Another issue is that the maxima-to-sage conversion maps %z1 to z1 without checking. This can lead to further unintended name collisions.

(but then again, if someone is willing to use the results returned by a CAS solve routine without checking, they're asking for trouble anyway)



---

archive/issue_comments_150511.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2012-04-07T11:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150511",
    "user": "afleckenstein"
}
```

Changing priority from major to minor.



---

archive/issue_comments_150512.json:
```json
{
    "body": "I implemented `MaximaLibElement.nicedummies()`, but it seems that once you make the round-trip through sage, the information that zXX is a dummy is lost:\n\n\n```\nfrom sage.interfaces.maxima_lib import maxima_lib\nsage: y = var('y')                                      \nsage: soln = solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)\nsage: maxima_lib(soln[0][0])\nx=%pi*z36+%pi/4\nsage: maxima_lib(soln[0][0]).nicedummies()\nx=%pi*z36+%pi/4\n```\n\n\n(The function does actually work before you leave Maxima.)\n\nSo, we'd either have to add a `nicedummies` parameter to each of the routines that return them, or write our own implementation that works entirely within sage.",
    "created_at": "2012-04-13T03:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150512",
    "user": "mjo"
}
```

I implemented `MaximaLibElement.nicedummies()`, but it seems that once you make the round-trip through sage, the information that zXX is a dummy is lost:


```
from sage.interfaces.maxima_lib import maxima_lib
sage: y = var('y')                                      
sage: soln = solve([cos(x)*sin(x) == 1/2, x+y == 0],x,y)
sage: maxima_lib(soln[0][0])
x=%pi*z36+%pi/4
sage: maxima_lib(soln[0][0]).nicedummies()
x=%pi*z36+%pi/4
```


(The function does actually work before you leave Maxima.)

So, we'd either have to add a `nicedummies` parameter to each of the routines that return them, or write our own implementation that works entirely within sage.



---

archive/issue_comments_150513.json:
```json
{
    "body": "Replying to [comment:6 mjo]:\n> I implemented `MaximaLibElement.nicedummies()`, but it seems that once you make the round-trip through sage, the information that zXX is a dummy is lost\n\nThis is mainly for documentation and sufficient cross linking. In [this sage-devel thread](https://groups.google.com/group/sage-devel/msg/62404b9d395cce94?hl=en) the cause is described: maxima's `%z2` gets translated to `z2` in sage and then to `z2` in maxima, so the variables get renamed.\n\nSee `nicedummies`  in maxima's `share/contrib/topoly.lisp` to see how \"dummies\" get recognized (it's a property hanging off the symbol, not the name of the symbol)",
    "created_at": "2012-04-13T06:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150513",
    "user": "nbruin"
}
```

Replying to [comment:6 mjo]:
> I implemented `MaximaLibElement.nicedummies()`, but it seems that once you make the round-trip through sage, the information that zXX is a dummy is lost

This is mainly for documentation and sufficient cross linking. In [this sage-devel thread](https://groups.google.com/group/sage-devel/msg/62404b9d395cce94?hl=en) the cause is described: maxima's `%z2` gets translated to `z2` in sage and then to `z2` in maxima, so the variables get renamed.

See `nicedummies`  in maxima's `share/contrib/topoly.lisp` to see how "dummies" get recognized (it's a property hanging off the symbol, not the name of the symbol)



---

archive/issue_comments_150514.json:
```json
{
    "body": "Should we update the milestone?",
    "created_at": "2016-11-23T07:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12637#issuecomment-150514",
    "user": "pelegm"
}
```

Should we update the milestone?
