# Issue 13009: _limit_latex_ cannot handle direction argument

archive/issues_013009.json:
```json
{
    "body": "Assignee: @burcin\n\nCC:  @kcrisman\n\nKeywords: limit latex\n\nHere's my code and it's results (in italics):\n\n```\nsage: def fracintegral(func,xsub,n,a=0):                                       \n....:     t = var('t')                                     \n....:     assume(t > a)\n....:     assume(x > a)\n....:     return integrate((x-t)^(n-1)*func.subs({xsub:t}),t,a,x)/gamma(n)\n....: \nsage: fracintegral(x,x,1/2)\n4/3*x^(3/2)/sqrt(pi)\n```\n\n```\nsage: a = fracintegral(sin(x),x,1/2)\nsage: a\n-1/2*(sqrt(x)*sin(x)*expintegral_e(1/2, -I*x) + sqrt(x)*sin(x)*expintegral_e(1/2, I*x) + I*sqrt(x)*cos(x)*expintegral_e(1/2, -I*x) - I*sqrt(x)*cos(x)*expintegral_e(1/2, I*x) - 2*limit(-1/2*(I*expintegral_e(1/2, -I*t + I*x) - I*expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*cos(x) + 1/2*(expintegral_e(1/2, -I*t + I*x) + expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*sin(x), t, x, minus))/sqrt(pi)\n```\n\nThis works if pretty printing (Typeset) is off, but the very last line (a) throws the following error if it is turned on.\n\n```\nTraceback (most recent call last): \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0    File \"<stdin>\", line 1, in <module> \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"_sage_input_25.py\", line 10, in <module>     exec compile(u'open(\"!__    _code!__    _.py\",\"w\").write(\"# -*- coding: utf-8 -*-\\\\n\" + _support_.preparse_worksheet_cell(base64.b64decode(\"YQ==\"),globals())+\"\\\\n\"); execfile(os.path.abspath(\"!__    _code!__    _.py\")) \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"\", line 1, in <module> \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0    File \"/tmp/tmpdqa295/!__    _code!__    _.py\", line 2, in <module>     exec compile(u'a   File \"\", line 1, in <module> \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py\", line 2280, in pretty_print     view(object) \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py\", line 2006, in view     s = _latex_file_(objects, title=title, sep=sep, tiny=tiny, debug=debug, !**latex_options) \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py\", line 1661, in _latex_file_     L = latex(x) \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py\", line 909, in !__    call!__         return !LatexExpr    (x._latex_()) ''   ''   \n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"expression.pyx\", line 667, in sage.symbolic.expression.Expression._latex_ (sage/symbolic/!expression.cpp:4236    )\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"ring.pyx\", line 605, in sage.symbolic.ring.!SymbolicRing    ._latex_element_ (sage/symbolic/!ring.cpp:6658    ) \n\n         File \"pynac.pyx\", line 433, in sage.symbolic.pynac.py_latex_function (sage/symbolic/!pynac.cpp:4817    )\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 File \"pynac.pyx\", line 407, in sage.symbolic.pynac.py_latex_function_pystring (sage/symbolic/!pynac.cpp:4443    ) \n\n\u00a0\u00a0\u00a0\u00a0        !TypeError: _limit_latex_() takes exactly 4 arguments (5 given)\n```\n\nInterestingly, if I evaluate the fractional integral of sine directly (outside the function), it doesn't pop up any errors at all, AND simplifies to a simpler expression.\n\n```\nsage: integrate(t^(-1/2)*sin(t),t,0,x)\n1/4*((I - 1)*sqrt(2)*erf((1/2*I - 1/2)*sqrt(2)*sqrt(x)) + (I + 1)*sqrt(2)*erf((1/2*I + 1/2)*sqrt(2)*sqrt(x)))*sqrt(pi)\n```\n\n\n\nApply [attachment:trac_13181-limit_latex_direction.patch]\n\nIssue created by migration from https://trac.sagemath.org/ticket/13181\n\n",
    "closed_at": "2012-12-18T11:16:18Z",
    "created_at": "2012-06-29T08:37:20Z",
    "labels": [
        "component: calculus",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "_limit_latex_ cannot handle direction argument",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13009",
    "user": "https://trac.sagemath.org/admin/accounts/users/JoalHeagney"
}
```
Assignee: @burcin

CC:  @kcrisman

Keywords: limit latex

Here's my code and it's results (in italics):

```
sage: def fracintegral(func,xsub,n,a=0):                                       
....:     t = var('t')                                     
....:     assume(t > a)
....:     assume(x > a)
....:     return integrate((x-t)^(n-1)*func.subs({xsub:t}),t,a,x)/gamma(n)
....: 
sage: fracintegral(x,x,1/2)
4/3*x^(3/2)/sqrt(pi)
```

```
sage: a = fracintegral(sin(x),x,1/2)
sage: a
-1/2*(sqrt(x)*sin(x)*expintegral_e(1/2, -I*x) + sqrt(x)*sin(x)*expintegral_e(1/2, I*x) + I*sqrt(x)*cos(x)*expintegral_e(1/2, -I*x) - I*sqrt(x)*cos(x)*expintegral_e(1/2, I*x) - 2*limit(-1/2*(I*expintegral_e(1/2, -I*t + I*x) - I*expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*cos(x) + 1/2*(expintegral_e(1/2, -I*t + I*x) + expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*sin(x), t, x, minus))/sqrt(pi)
```

This works if pretty printing (Typeset) is off, but the very last line (a) throws the following error if it is turned on.

```
Traceback (most recent call last): 

            File "<stdin>", line 1, in <module> 

         File "_sage_input_25.py", line 10, in <module>     exec compile(u'open("!__    _code!__    _.py","w").write("# -*- coding: utf-8 -*-\\n" + _support_.preparse_worksheet_cell(base64.b64decode("YQ=="),globals())+"\\n"); execfile(os.path.abspath("!__    _code!__    _.py")) 

         File "", line 1, in <module> 

            File "/tmp/tmpdqa295/!__    _code!__    _.py", line 2, in <module>     exec compile(u'a   File "", line 1, in <module> 

         File "/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py", line 2280, in pretty_print     view(object) 

         File "/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py", line 2006, in view     s = _latex_file_(objects, title=title, sep=sep, tiny=tiny, debug=debug, !**latex_options) 

         File "/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py", line 1661, in _latex_file_     L = latex(x) 

         File "/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py", line 909, in !__    call!__         return !LatexExpr    (x._latex_()) ''   ''   

         File "expression.pyx", line 667, in sage.symbolic.expression.Expression._latex_ (sage/symbolic/!expression.cpp:4236    )

         File "ring.pyx", line 605, in sage.symbolic.ring.!SymbolicRing    ._latex_element_ (sage/symbolic/!ring.cpp:6658    ) 

         File "pynac.pyx", line 433, in sage.symbolic.pynac.py_latex_function (sage/symbolic/!pynac.cpp:4817    )

         File "pynac.pyx", line 407, in sage.symbolic.pynac.py_latex_function_pystring (sage/symbolic/!pynac.cpp:4443    ) 

            !TypeError: _limit_latex_() takes exactly 4 arguments (5 given)
```

Interestingly, if I evaluate the fractional integral of sine directly (outside the function), it doesn't pop up any errors at all, AND simplifies to a simpler expression.

```
sage: integrate(t^(-1/2)*sin(t),t,0,x)
1/4*((I - 1)*sqrt(2)*erf((1/2*I - 1/2)*sqrt(2)*sqrt(x)) + (I + 1)*sqrt(2)*erf((1/2*I + 1/2)*sqrt(2)*sqrt(x)))*sqrt(pi)
```



Apply [attachment:trac_13181-limit_latex_direction.patch]

Issue created by migration from https://trac.sagemath.org/ticket/13181





---

archive/issue_comments_157023.json:
```json
{
    "body": "Attachment [Fractional Integral.sws](tarball://root/attachments/some-uuid/ticket13181/Fractional Integral.sws) by JoalHeagney created at 2012-06-29 08:38:03\n\nFractional Integral Worksheet.",
    "created_at": "2012-06-29T08:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157023",
    "user": "https://trac.sagemath.org/admin/accounts/users/JoalHeagney"
}
```

Attachment [Fractional Integral.sws](tarball://root/attachments/some-uuid/ticket13181/Fractional Integral.sws) by JoalHeagney created at 2012-06-29 08:38:03

Fractional Integral Worksheet.



---

archive/issue_comments_157024.json:
```json
{
    "body": "The offending expression is `limit(-1/2*(I*expintegral_e(1/2, -I*t + I*x) - I*expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*cos(x) + 1/2*(expintegral_e(1/2, -I*t + I*x) + expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*sin(x), t, x, minus)`. Our `_limit_latex_()` function does not expect the last direction argument.",
    "created_at": "2012-11-19T12:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157024",
    "user": "https://github.com/burcin"
}
```

The offending expression is `limit(-1/2*(I*expintegral_e(1/2, -I*t + I*x) - I*expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*cos(x) + 1/2*(expintegral_e(1/2, -I*t + I*x) + expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*sin(x), t, x, minus)`. Our `_limit_latex_()` function does not expect the last direction argument.



---

archive/issue_comments_157025.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-11-19T13:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157025",
    "user": "https://github.com/burcin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_157026.json:
```json
{
    "body": "Patch up, please review.\n\nApply [attachment:trac_13181-limit_latex_direction.patch]",
    "created_at": "2012-11-19T13:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157026",
    "user": "https://github.com/burcin"
}
```

Patch up, please review.

Apply [attachment:trac_13181-limit_latex_direction.patch]



---

archive/issue_comments_157027.json:
```json
{
    "body": "Changing keywords from \"limits latex integrals\" to \"limit latex\".",
    "created_at": "2012-11-19T13:29:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157027",
    "user": "https://github.com/burcin"
}
```

Changing keywords from "limits latex integrals" to "limit latex".



---

archive/issue_comments_157028.json:
```json
{
    "body": "I like this.  Can you add a doctest that shows that both possible ways of input for the limit direction works?  Something like\n\n```\nsage: latex(limit(f,x=a,dir='right'))\n\\lim_{x \\to a^+}\\, f\\left(x\\right)\n```\nI guess we don't need `'above'` since that's deprecated!\n\nOtherwise I think this is nice.  Glad you figured out what was going on - I was too worried about the fractions and got distracted when I looked at this.",
    "created_at": "2012-11-19T15:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157028",
    "user": "https://github.com/kcrisman"
}
```

I like this.  Can you add a doctest that shows that both possible ways of input for the limit direction works?  Something like

```
sage: latex(limit(f,x=a,dir='right'))
\lim_{x \to a^+}\, f\left(x\right)
```
I guess we don't need `'above'` since that's deprecated!

Otherwise I think this is nice.  Glad you figured out what was going on - I was too worried about the fractions and got distracted when I looked at this.



---

archive/issue_comments_157029.json:
```json
{
    "body": "Attachment [trac_13181-limit_latex_direction.patch](tarball://root/attachments/some-uuid/ticket13181/trac_13181-limit_latex_direction.patch) by @burcin created at 2012-11-19 15:46:31",
    "created_at": "2012-11-19T15:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157029",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_13181-limit_latex_direction.patch](tarball://root/attachments/some-uuid/ticket13181/trac_13181-limit_latex_direction.patch) by @burcin created at 2012-11-19 15:46:31



---

archive/issue_comments_157030.json:
```json
{
    "body": "Replying to [comment:4 kcrisman]:\n> Can you add a doctest that shows that both possible ways of input for the limit direction works?\n\n\nSure. Patch updated with more doctests.",
    "created_at": "2012-11-19T15:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157030",
    "user": "https://github.com/burcin"
}
```

Replying to [comment:4 kcrisman]:
> Can you add a doctest that shows that both possible ways of input for the limit direction works?


Sure. Patch updated with more doctests.



---

archive/issue_comments_157031.json:
```json
{
    "body": "Thanks!\n\nI was going to ask for (or do myself) Python 3 string formatting, but [it turns out this is a little annoying with LaTeX](http://stackoverflow.com/questions/9161355/format-a-string-that-has-extra-curly-braces-in-it), so let's forget it for now to fix the bug.",
    "created_at": "2012-11-19T18:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157031",
    "user": "https://github.com/kcrisman"
}
```

Thanks!

I was going to ask for (or do myself) Python 3 string formatting, but [it turns out this is a little annoying with LaTeX](http://stackoverflow.com/questions/9161355/format-a-string-that-has-extra-curly-braces-in-it), so let's forget it for now to fix the bug.



---

archive/issue_comments_157032.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-19T18:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157032",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157033.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-18T11:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13009#issuecomment-157033",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_036333.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-18T11:16:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13009",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13009#event-36333"
}
```
