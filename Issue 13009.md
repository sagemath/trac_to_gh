# Issue 13009: Managed to break _limit_latex argument passing.

Issue created by migration from Trac.

Original creator: JoalHeagney

Original creation time: 2012-06-29 08:37:20

Assignee: burcin

CC:  kcrisman

Keywords: limits latex integrals

Here's my code and it's results (in italics):


```
def fracintegral(func,xsub,n,a=0):
    t = var('t')
    assume(t > a)
    assume(x > a)
    return integrate((x-t)^(n-1)*func.subs({xsub:t}),t,a,x)/gamma(n)
fracintegral(x,x,1/2)

```

_4/3*x!^(3/2)/sqrt(pi)_


```
a = fracintegral(sin(x),x,1/2)
a

```

_-1/2*(sqrt(x)*sin(x)*expintegral_e(1/2, -I*x) + sqrt(x)*sin(x)*expintegral_e(1/2, I*x) + I*sqrt(x)*cos(x)*expintegral_e(1/2, -I*x) - I*sqrt(x)*cos(x)*expintegral_e(1/2, I*x) - 2*limit(-1/2*(I*expintegral_e(1/2, -I*t + I*x) - I*expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*cos(x) + 1/2*(expintegral_e(1/2, -I*t + I*x) + expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*sin(x), t, x, minus))/sqrt(pi)_

This works if pretty printing (Typeset) is off, but the very last line (a) throws the following error if it is turned on.

_Traceback (most recent call last): _

_            File "<stdin>", line 1, in <module> _

_         File "_sage_input_25.py", line 10, in <module>     exec compile(u'open("!__    _code!__    _.py","w").write("# -*- coding: utf-8 -*-\\n" + _support_.preparse_worksheet_cell(base64.b64decode("YQ=="),globals())+"\\n"); execfile(os.path.abspath("!__    _code!__    _.py")) _

_         File "", line 1, in <module> _

_            File "/tmp/tmpdqa295/!__    _code!__    _.py", line 2, in <module>     exec compile(u'a   File "", line 1, in <module> _

_         File "/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py", line 2280, in pretty_print     view(object) _

_         File "/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py", line 2006, in view     s = _latex_file_(objects, title=title, sep=sep, tiny=tiny, debug=debug, !**latex_options) _

_         File "/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py", line 1661, in _latex_file_     L = latex(x) _

_         File "/home/joal/bin/sage-5.0.1/local/lib/python2.7/site-packages/sage/misc/latex.py", line 909, in !__    call!__         return LatexExpr    (x._latex_()) _   _   _

_         File "expression.pyx", line 667, in sage.symbolic.expression.Expression._latex_ (sage/symbolic/!expression.cpp:4236    )_

_         File "ring.pyx", line 605, in sage.symbolic.ring.SymbolicRing    ._latex_element_ (sage/symbolic/!ring.cpp:6658    ) _

_         _   _   File "pynac.pyx", line 433, in sage.symbolic.pynac.py_latex_function (sage/symbolic/!pynac.cpp:4817    ) _   _   _

_         File "pynac.pyx", line 407, in sage.symbolic.pynac.py_latex_function_pystring (sage/symbolic/!pynac.cpp:4443    ) _

_            TypeError: _limit_latex_() takes exactly 4 arguments (5 given)_

Interestingly, if I evaluate the fractional integral of sine directly (outside the function), it doesn't pop up any errors at all, AND simplifies to a simpler expression.


```
integrate(t^(-1/2)*sin(t),t,0,x)
```

_1/4*((I - 1)*sqrt(2)*erf((1/2*I - 1/2)*sqrt(2)*sqrt(x)) + (I + 1)*sqrt(2)*erf((1/2*I + 1/2)*sqrt(2)*sqrt(x)))*sqrt(pi)_


---

Attachment

Fractional Integral Worksheet.


---

Comment by burcin created at 2012-11-19 12:46:37

The offending expression is `limit(-1/2*(I*expintegral_e(1/2, -I*t + I*x) - I*expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*cos(x) + 1/2*(expintegral_e(1/2, -I*t + I*x) + expintegral_e(1/2, I*t - I*x))*sqrt(-t + x)*sin(x), t, x, minus)`. Our `_limit_latex_()` function does not expect the last direction argument.


---

Comment by burcin created at 2012-11-19 13:29:44

Changing status from new to needs_review.


---

Comment by burcin created at 2012-11-19 13:29:44

Patch up, please review.

Apply [attachment:trac_13181-limit_latex_direction.patch]


---

Comment by burcin created at 2012-11-19 13:29:44

Changing keywords from "limits latex integrals" to "limit latex".


---

Comment by kcrisman created at 2012-11-19 15:24:25

I like this.  Can you add a doctest that shows that both possible ways of input for the limit direction works?  Something like

```
sage: latex(limit(f,x=a,dir='right'))
\lim_{x \to a^+}\, f\left(x\right)
```

I guess we don't need `'above'` since that's deprecated!

Otherwise I think this is nice.  Glad you figured out what was going on - I was too worried about the fractions and got distracted when I looked at this.


---

Attachment


---

Comment by burcin created at 2012-11-19 15:47:40

Replying to [comment:4 kcrisman]:
> Can you add a doctest that shows that both possible ways of input for the limit direction works?

Sure. Patch updated with more doctests.


---

Comment by kcrisman created at 2012-11-19 18:59:01

Thanks!

I was going to ask for (or do myself) Python 3 string formatting, but [it turns out this is a little annoying with LaTeX](http://stackoverflow.com/questions/9161355/format-a-string-that-has-extra-curly-braces-in-it), so let's forget it for now to fix the bug.


---

Comment by kcrisman created at 2012-11-19 18:59:01

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-12-18 11:16:18

Resolution: fixed
