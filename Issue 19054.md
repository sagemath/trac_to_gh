# Issue 19054: Graph.spanning_trees does not like loops

archive/issues_019054.json:
```json
{
    "body": "\n```\nG = Graph({0:{0:'a', 1:'b'}, 1:{2: 'c'}, 2:{0: 'e'}}, loops=True)\nS = G.spanning_trees()\n```\n\ngoes \"boom\" (recursion depth exceeded). It also destroys G in the process, which shouldn't happen, I think.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19291\n\n",
    "created_at": "2015-09-25T04:45:06Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Graph.spanning_trees does not like loops",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19054",
    "user": "Stefan"
}
```

```
G = Graph({0:{0:'a', 1:'b'}, 1:{2: 'c'}, 2:{0: 'e'}}, loops=True)
S = G.spanning_trees()
```

goes "boom" (recursion depth exceeded). It also destroys G in the process, which shouldn't happen, I think.

Issue created by migration from https://trac.sagemath.org/ticket/19291





---

archive/issue_comments_261346.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-25T09:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19054#issuecomment-261346",
    "user": "ncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_261347.json:
```json
{
    "body": "Here is a fix. By the way, if you need this function for some hard computations know that there is room for much improvement in there.\n\nNathann\n----\nNew commits:",
    "created_at": "2015-09-25T09:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19054#issuecomment-261347",
    "user": "ncohen"
}
```

Here is a fix. By the way, if you need this function for some hard computations know that there is room for much improvement in there.

Nathann
----
New commits:



---

archive/issue_comments_261348.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-25T16:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19054#issuecomment-261348",
    "user": "Stefan"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_261349.json:
```json
{
    "body": "I was just exploring some graph methods, I don't actually need to use it for now.\n\nYour change forces a copy of the graph to be made regardless of whether there are loops. That's definitely safer than what happened before, but could be costly in terms of memory for big graphs. Still, I prefer the corresponding increase in safety of the code, so I will approve.",
    "created_at": "2015-09-25T16:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19054#issuecomment-261349",
    "user": "Stefan"
}
```

I was just exploring some graph methods, I don't actually need to use it for now.

Your change forces a copy of the graph to be made regardless of whether there are loops. That's definitely safer than what happened before, but could be costly in terms of memory for big graphs. Still, I prefer the corresponding increase in safety of the code, so I will approve.



---

archive/issue_comments_261350.json:
```json
{
    "body": "Replying to [comment:2 Stefan]:\n>  but could be costly in terms of memory for big graphs.\n\nWell, considering such running time, it is likely that no one will use this method for \"big graphs\".\n\n```\nsage: g = graphs.GridGraph([2,2,2])\nsage: %timeit g.spanning_trees()\n10 loops, best of 3: 99.4 ms per loop\nsage: g = graphs.GridGraph([2,2,3])\nsage: %timeit g.spanning_trees()\n1 loops, best of 3: 13.4 s per loop\nsage: g.order(),g.size()\n(12, 20)\n```\n",
    "created_at": "2015-09-26T09:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19054#issuecomment-261350",
    "user": "dcoudert"
}
```

Replying to [comment:2 Stefan]:
>  but could be costly in terms of memory for big graphs.

Well, considering such running time, it is likely that no one will use this method for "big graphs".

```
sage: g = graphs.GridGraph([2,2,2])
sage: %timeit g.spanning_trees()
10 loops, best of 3: 99.4 ms per loop
sage: g = graphs.GridGraph([2,2,3])
sage: %timeit g.spanning_trees()
1 loops, best of 3: 13.4 s per loop
sage: g.order(),g.size()
(12, 20)
```




---

archive/issue_comments_261351.json:
```json
{
    "body": "Yeah, precisely. Stefan: to answer your question, I did not mind adding a graph copy to this method because, well, given the way it is written, the amount of wasted time is so high that this copy makes no difference. If you ever need this method \"seriously\", it will have to be reimplemented.\n\nNathann",
    "created_at": "2015-09-26T11:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19054#issuecomment-261351",
    "user": "ncohen"
}
```

Yeah, precisely. Stefan: to answer your question, I did not mind adding a graph copy to this method because, well, given the way it is written, the amount of wasted time is so high that this copy makes no difference. If you ever need this method "seriously", it will have to be reimplemented.

Nathann



---

archive/issue_comments_261352.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-12T07:15:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19054",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19054#issuecomment-261352",
    "user": "vbraun"
}
```

Resolution: fixed
