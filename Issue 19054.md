# Issue 19054: Graph.spanning_trees does not like loops

Issue created by migration from https://trac.sagemath.org/ticket/19291

Original creator: Stefan

Original creation time: 2015-09-25 04:45:06


```
G = Graph({0:{0:'a', 1:'b'}, 1:{2: 'c'}, 2:{0: 'e'}}, loops=True)
S = G.spanning_trees()
```

goes "boom" (recursion depth exceeded). It also destroys G in the process, which shouldn't happen, I think.


---

Comment by ncohen created at 2015-09-25 09:58:47

Changing status from new to needs_review.


---

Comment by ncohen created at 2015-09-25 09:58:47

Here is a fix. By the way, if you need this function for some hard computations know that there is room for much improvement in there.

Nathann
----
New commits:


---

Comment by Stefan created at 2015-09-25 16:57:40

Changing status from needs_review to positive_review.


---

Comment by Stefan created at 2015-09-25 16:57:40

I was just exploring some graph methods, I don't actually need to use it for now.

Your change forces a copy of the graph to be made regardless of whether there are loops. That's definitely safer than what happened before, but could be costly in terms of memory for big graphs. Still, I prefer the corresponding increase in safety of the code, so I will approve.


---

Comment by dcoudert created at 2015-09-26 09:20:34

Replying to [comment:2 Stefan]:
>  but could be costly in terms of memory for big graphs.

Well, considering such running time, it is likely that no one will use this method for "big graphs".

```
sage: g = graphs.GridGraph([2,2,2])
sage: %timeit g.spanning_trees()
10 loops, best of 3: 99.4 ms per loop
sage: g = graphs.GridGraph([2,2,3])
sage: %timeit g.spanning_trees()
1 loops, best of 3: 13.4 s per loop
sage: g.order(),g.size()
(12, 20)
```



---

Comment by ncohen created at 2015-09-26 11:49:45

Yeah, precisely. Stefan: to answer your question, I did not mind adding a graph copy to this method because, well, given the way it is written, the amount of wasted time is so high that this copy makes no difference. If you ever need this method "seriously", it will have to be reimplemented.

Nathann


---

Comment by vbraun created at 2015-10-12 07:15:51

Resolution: fixed
