# Issue 21539: Galois representations over number fields speedup

Issue created by migration from Trac.

Original creator: cremona

Original creation time: 2016-10-27 15:39:49

Keywords: Galois representations

The code for computing Galois representations of elliptic curves over number fields (which is used in isogeny computation) uses the default iterator over primes of degree 1 in the number field.  Two problems: first, the method K.primes_of_degree_one_iter() only gives primes up to some norm bound, and that is not always large enough if left at the default.  Second, where the function is used only principal primes are wanted but the iterator starts at 2 wheras there are no principal primes of norm less than discriminant/4!

I put in a custom iterator which helps a lot.

I will upload a patch when I have recovered an example which fails badly.


---

Comment by cremona created at 2016-10-27 16:02:46

New commits:


---

Comment by cremona created at 2016-10-27 16:02:46

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-10-27 16:07:05

Two small things:

```diff
-    for l in D:
+    for l in D.iterkeys():
```

This change is unnecessary as the iteration over a dictionary is the keys (and `iterkeys` is going away in Python3).
Also, `xrange` is going away in Python3, so you should revert that change because the `from six.moves import range` already makes `range` an iterator, not a list.


---

Comment by cremona created at 2016-10-27 16:10:21

Thanks, will do.  I have no idea why I put in the iterkeys().


---

Comment by git created at 2016-10-27 16:12:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-11-02 16:07:25

You should add documentation to the new "deg_one_prime_iter" function.


---

Comment by cremona created at 2016-11-06 13:57:14

OK, I am working on this.


---

Comment by cremona created at 2016-11-06 13:57:14

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-11-08 12:33:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2016-11-08 12:34:02

Docstring and test added.


---

Comment by cremona created at 2016-11-08 12:34:02

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-11-08 15:22:44

Looking at the `primes` documentation, it says you can pass `oo` as the second argument. So I removed the `maxnorm` argument. I also did a few cosmetic changes. If you agree with my changes, then you can set a positive review.
----
New commits:


---

Comment by chapoton created at 2016-11-08 18:25:41

it.next() is not python3 compatible, use next(it) instead


---

Comment by git created at 2016-11-08 20:41:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2016-11-09 09:58:46

Replying to [comment:10 chapoton]:
> it.next() is not python3 compatible, use next(it) instead

I did not know that -- and in fact one thing I had done was to make the reverse change, thinking it was somehow more efficient.  Thanks.

I am happy with the changes since my commits.  What next?


---

Comment by chapoton created at 2016-11-09 11:23:22

doc does not build,  EXAMPLES: should be  EXAMPLES::


---

Comment by cremona created at 2016-11-09 12:07:39

OK, I'll fix that and put it back into my branch... (building docs takes such a long time it discourages proper testing!)


---

Comment by git created at 2016-11-09 15:40:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-11-09 15:41:40

I just took care of it. (Partial doc builds can help for this kind of testing.) Feel free to put your branch if you make other changes.


---

Comment by chapoton created at 2016-11-13 09:46:50

ok, looks good enough.


---

Comment by chapoton created at 2016-11-13 09:46:50

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-17 18:01:57

Resolution: fixed
