# Issue 22456: LatticePoset: Antidoubling, part 2

Issue created by migration from https://trac.sagemath.org/ticket/22693

Original creator: jmantysalo

Original creation time: 2017-03-28 04:12:55

CC:  mantepse tscrim

This patch adds a backend function to see if a lattice is constructible with Alan Day's doubling construction of convex subsets.

To be added to frontend #22648 later.


---

Comment by jmantysalo created at 2017-03-28 04:14:21

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2017-03-28 04:14:21

New commits:


---

Comment by jmantysalo created at 2017-03-30 04:55:52

Arghs, the example is incorrect. Example from http://www.math.hawaii.edu/~jb/inflation.pdf page 8 shows how to construct a lattice by doubling a non-convex set ("Reppe's lattice"), but begins with a 9-element lattice that is _not_ constructible by any doubling.


---

Comment by jmantysalo created at 2017-03-30 04:55:52

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-03-30 07:37:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-03-30 07:43:40

Now a correct example. It is done with


```
L = Posets.BooleanLattice(3)
L = L.day_doubling([1,3])

def double_no_check(self, S):
    S_ = [self._element_to_vertex(e) for e in S]

    g = self.hasse_diagram()
    g.relabel(lambda e: (e, 0))

    for e in S:
        g.add_edge((e, 0), (e, 1))
        for e_up in self.upper_covers(e):
            if e_up in S:
                g.add_edge((e, 1), (e_up, 1))
            else:
                g.delete_edge((e, 0), (e_up, 0))
                g.add_edge((e, 1), (e_up, 0))

    return LatticePoset(g)

L = double_no_check(L, [(3, 1), (6, 0), (2, 0), (5, 0), (1, 1), (4, 0)])
```


where `(3, 0)` shows that the subset to double is not convex.

I may be that there is no smaller example of a lattice costructible by doublings of some subset but not constructible by doublings of convex subset.


---

Comment by jmantysalo created at 2017-03-30 07:43:40

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-04-03 06:48:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-04-10 04:26:05

Is there something I can do to make reviewing easier?


---

Comment by jmantysalo created at 2017-04-19 05:56:39

Travis? The code is quite direct implementation from the paper.


---

Comment by tscrim created at 2017-04-19 15:26:48

One little thing:

```diff
-                for ji in congs_ji[cong]:
-                    if self.is_lequal(ji, mi):
-                        return False
+                if any(self.is_lequal(ji, mi) for ji in congs_ji[cong]):
+                    return False
```

IMO this is cleaner (and I think it might be marginally faster). Otherwise LGTM.


---

Comment by git created at 2017-04-19 16:39:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2017-04-20 04:07:06

Replying to [comment:9 tscrim]:
> One little thing:

Done. (And tested, just to be sure...)


---

Comment by tscrim created at 2017-04-20 04:11:04

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-04-20 04:11:04

Thanks.


---

Comment by vbraun created at 2017-04-23 12:57:51

Resolution: fixed
