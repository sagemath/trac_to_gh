# Issue 22456: LatticePoset: Antidoubling, part 2

archive/issues_022456.json:
```json
{
    "body": "CC:  @mantepse @tscrim\n\nThis patch adds a backend function to see if a lattice is constructible with Alan Day's doubling construction of convex subsets.\n\nTo be added to frontend #22648 later.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22693\n\n",
    "created_at": "2017-03-28T04:12:55Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "LatticePoset: Antidoubling, part 2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22456",
    "user": "@jm58660"
}
```
CC:  @mantepse @tscrim

This patch adds a backend function to see if a lattice is constructible with Alan Day's doubling construction of convex subsets.

To be added to frontend #22648 later.

Issue created by migration from https://trac.sagemath.org/ticket/22693





---

archive/issue_comments_312908.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-28T04:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312908",
    "user": "@jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_312909.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-03-28T04:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312909",
    "user": "@jm58660"
}
```

New commits:



---

archive/issue_comments_312910.json:
```json
{
    "body": "Arghs, the example is incorrect. Example from http://www.math.hawaii.edu/~jb/inflation.pdf page 8 shows how to construct a lattice by doubling a non-convex set (\"Reppe's lattice\"), but begins with a 9-element lattice that is *not* constructible by any doubling.",
    "created_at": "2017-03-30T04:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312910",
    "user": "@jm58660"
}
```

Arghs, the example is incorrect. Example from http://www.math.hawaii.edu/~jb/inflation.pdf page 8 shows how to construct a lattice by doubling a non-convex set ("Reppe's lattice"), but begins with a 9-element lattice that is *not* constructible by any doubling.



---

archive/issue_comments_312911.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-03-30T04:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312911",
    "user": "@jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_312912.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-30T07:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312912",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312913.json:
```json
{
    "body": "Now a correct example. It is done with\n\n\n```\nL = Posets.BooleanLattice(3)\nL = L.day_doubling([1,3])\n\ndef double_no_check(self, S):\n    S_ = [self._element_to_vertex(e) for e in S]\n\n    g = self.hasse_diagram()\n    g.relabel(lambda e: (e, 0))\n\n    for e in S:\n        g.add_edge((e, 0), (e, 1))\n        for e_up in self.upper_covers(e):\n            if e_up in S:\n                g.add_edge((e, 1), (e_up, 1))\n            else:\n                g.delete_edge((e, 0), (e_up, 0))\n                g.add_edge((e, 1), (e_up, 0))\n\n    return LatticePoset(g)\n\nL = double_no_check(L, [(3, 1), (6, 0), (2, 0), (5, 0), (1, 1), (4, 0)])\n```\n\n\nwhere `(3, 0)` shows that the subset to double is not convex.\n\nI may be that there is no smaller example of a lattice costructible by doublings of some subset but not constructible by doublings of convex subset.",
    "created_at": "2017-03-30T07:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312913",
    "user": "@jm58660"
}
```

Now a correct example. It is done with


```
L = Posets.BooleanLattice(3)
L = L.day_doubling([1,3])

def double_no_check(self, S):
    S_ = [self._element_to_vertex(e) for e in S]

    g = self.hasse_diagram()
    g.relabel(lambda e: (e, 0))

    for e in S:
        g.add_edge((e, 0), (e, 1))
        for e_up in self.upper_covers(e):
            if e_up in S:
                g.add_edge((e, 1), (e_up, 1))
            else:
                g.delete_edge((e, 0), (e_up, 0))
                g.add_edge((e, 1), (e_up, 0))

    return LatticePoset(g)

L = double_no_check(L, [(3, 1), (6, 0), (2, 0), (5, 0), (1, 1), (4, 0)])
```


where `(3, 0)` shows that the subset to double is not convex.

I may be that there is no smaller example of a lattice costructible by doublings of some subset but not constructible by doublings of convex subset.



---

archive/issue_comments_312914.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-03-30T07:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312914",
    "user": "@jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_312915.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-03T06:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312915",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312916.json:
```json
{
    "body": "Is there something I can do to make reviewing easier?",
    "created_at": "2017-04-10T04:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312916",
    "user": "@jm58660"
}
```

Is there something I can do to make reviewing easier?



---

archive/issue_comments_312917.json:
```json
{
    "body": "Travis? The code is quite direct implementation from the paper.",
    "created_at": "2017-04-19T05:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312917",
    "user": "@jm58660"
}
```

Travis? The code is quite direct implementation from the paper.



---

archive/issue_comments_312918.json:
```json
{
    "body": "One little thing:\n\n```diff\n-                for ji in congs_ji[cong]:\n-                    if self.is_lequal(ji, mi):\n-                        return False\n+                if any(self.is_lequal(ji, mi) for ji in congs_ji[cong]):\n+                    return False\n```\n\nIMO this is cleaner (and I think it might be marginally faster). Otherwise LGTM.",
    "created_at": "2017-04-19T15:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312918",
    "user": "@tscrim"
}
```

One little thing:

```diff
-                for ji in congs_ji[cong]:
-                    if self.is_lequal(ji, mi):
-                        return False
+                if any(self.is_lequal(ji, mi) for ji in congs_ji[cong]):
+                    return False
```

IMO this is cleaner (and I think it might be marginally faster). Otherwise LGTM.



---

archive/issue_comments_312919.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-19T16:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312919",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312920.json:
```json
{
    "body": "Replying to [comment:9 tscrim]:\n> One little thing:\n\nDone. (And tested, just to be sure...)",
    "created_at": "2017-04-20T04:07:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312920",
    "user": "@jm58660"
}
```

Replying to [comment:9 tscrim]:
> One little thing:

Done. (And tested, just to be sure...)



---

archive/issue_comments_312921.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-20T04:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312921",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_312922.json:
```json
{
    "body": "Thanks.",
    "created_at": "2017-04-20T04:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312922",
    "user": "@tscrim"
}
```

Thanks.



---

archive/issue_comments_312923.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-23T12:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22456",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22456#issuecomment-312923",
    "user": "@vbraun"
}
```

Resolution: fixed
