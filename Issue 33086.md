# Issue 33086: Cardinality of partitions of negative values

Issue created by migration from https://trac.sagemath.org/ticket/33323

Original creator: tscrim

Original creation time: 2022-02-11 06:55:27

CC:  darij chapoton jhpalmieri

This should work (as long as it accepts negative values, which there is nothing wrong with it, it is just an empty set), but it results in an overflow error:

```
sage: Partitions(-5)
Partitions of the integer -5
sage: _.cardinality()
```



---

Comment by tscrim created at 2022-02-11 07:04:08

That is for the default using `flint`, but `gap` is wrong:

```
sage: Pm5.cardinality(algorithm='gap')
1
sage: Pm5.cardinality(algorithm='pari')
0
```

This is needed for doctests on #30680.
----
New commits:


---

Comment by tscrim created at 2022-02-11 07:04:08

Changing status from new to needs_review.


---

Comment by chapoton created at 2022-02-11 07:46:25

I would rather think that most combinatorial objects return a `ValueError`:
see `DyckWords(-2)`, `BinaryTrees(-2)`, `Posets(-2)`,  `Tableaux(-2)` and `TamariIntervalPosets(-2)`.

`AlternatingSignMatrices(-2)` returns an `ArithmeticError`.

But `Compositions(-2)`, `SuperPartitions(-2)` and `Permutations(-2)`"work".

If you prefer, returning the empty set would be another solution. Do we have such an object ?


---

Comment by tscrim created at 2022-02-11 07:57:56

Perhaps it would be better for these to raise a `ValueError` to be consistent with other objects. However, we would also need to make sure that this continues to work:

```
sage: s = SymmetricFunctions(QQ).s()
sage: list(s.basis(-2))
[]
```


We do not seem to have a singular `EmptySet` object, just `EmptySetError`.


---

Comment by tscrim created at 2022-02-11 08:02:00

In order to keep that continuing to work, I think we would need a more long-term fix, which would include specifying the valid indices for the grading monoid of any graded module.


---

Comment by jhpalmieri created at 2022-02-11 20:46:04

This looks simple and these things work:

```
sage: P = Partitions(-3)
sage: P.cardinality()
0
sage: list(P)
[]
sage: for a in P: print(a)
sage:
```

I'm somewhat agnostic about whether `Partitions(-3)` should raise an error or return an empty set. It feels somewhat different in flavor than `Posets(-3)` because it doesn't make sense to ask for a poset with `-3` elements, while you could ask for all partitions of the number `-3` — there just aren't any. But I don't have strong feelings either way.


---

Comment by @darijgr created at 2022-02-11 20:49:52

For the sake of (e.g.) the Euler pentagonal number theorem, it makes the most sense to return the empty set. Otherwise, the sum needs to be broken up at some nasty bounds.


---

Comment by jhpalmieri created at 2022-02-13 01:18:12

This can also be a stopgap ticket until a more permanent solution is found.


---

Comment by tscrim created at 2022-02-13 01:18:58

An interesting comparison point:

```
sage: Pm = Permutations(-3)
sage: [x for x in Pm]    
[[]]
sage: Pm.cardinality()
ValueError: factorial -- must be nonnegative
```

So there are bugs there that can be handled on another ticket.


---

Comment by jhpalmieri created at 2022-02-17 17:48:45

In my opinion we should merge this ticket and then think about long-term solutions elsewhere.


---

Comment by tscrim created at 2022-02-18 00:10:40

`@`chapoton, any objections to John doing the review for this as a stopgap ticket?


---

Comment by chapoton created at 2022-02-18 08:02:08

no objection whatsoever ; I have no monopoly on reviews


---

Comment by tscrim created at 2022-02-18 10:57:48

We value your opinion. Plus, all objections should be resolved before a positive review too.


---

Comment by jhpalmieri created at 2022-02-18 19:31:02

Let's merge this as is, and on other tickets continue to think about how to handle these situations.


---

Comment by jhpalmieri created at 2022-02-18 19:31:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-02-21 21:56:07

Resolution: fixed
