# Issue 24272: little cleanup of alphabet

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2018-01-10 15:28:13

CC:  tscrim embray jdemeyer

for py3 compatibility, plsu a few pep8 details


---

Comment by chapoton created at 2018-01-10 15:29:13

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-01-10 15:29:13

New commits:


---

Comment by chapoton created at 2018-01-10 15:29:28

Changing type from PLEASE CHANGE to defect.


---

Comment by chapoton created at 2018-01-10 15:29:41

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by tscrim created at 2018-01-10 16:27:20

While I doubt this is an issue, this change:

```diff
-    if data == Infinity:
+    if data is Infinity:
```

is a slight behavior change because

```
sage: UnsignedInfinityRing.gen() == Infinity
True
sage: UnsignedInfinityRing.gen() is Infinity
False
```

So if this is okay to you or you revert this change, then you can set a positive review on my behalf.


---

Comment by chapoton created at 2018-01-10 16:30:05

Well, this change is the main point of the ticket. In python3, the comparison with == fails, whereas the check with "is" works.


---

Comment by tscrim created at 2018-01-10 16:44:14

That smells like a deeper problem as I don't see why the `==` should fail. In fact, most people in code would do checks of infinity objects by `==`. While that is an independent issue, it should not be necessary to change `==` to `is` for Python3.


---

Comment by chapoton created at 2018-01-10 19:49:54

Indeed, I was trying to cure symptoms and not the root of illness:

```
sage: from sage.combinat.words.alphabet import *
sage: build_alphabet(['a','b'])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-451f2d6eca53> in <module>()
----> 1 build_alphabet(['a','b'])

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/combinat/words/alphabet.py in build_alphabet(data, names, name)
    231         raise ValueError("invalid value for names")
    232 
--> 233     if data == Infinity:
    234         data = NonNegativeIntegers()
    235 

/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Element.__richcmp__ (build/cythonized/sage/structure/element.c:10052)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:20685)()

TypeError: '<' not supported between instances of 'sage.misc.inherit_comparison.InheritComparisonMetaclass' and 'type'
```



---

Comment by tscrim created at 2018-01-10 21:25:12

Could that be an issue with bytes/unicode vs str?


---

Comment by tscrim created at 2018-01-10 21:28:07

Or perhaps related to:

```
sage: InfinityRing('a')
A positive finite number
```

which comes from doing comparisons of the form `'a' < 0`?


---

Comment by chapoton created at 2018-01-11 07:38:25

comment:9 gives another error:

```
sage: InfinityRing('a')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-5b6ff3fa50ce> in <module>()
----> 1 InfinityRing('a')

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9406)()

/home/chapoton/sage3/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4972)()

/home/chapoton/sage3/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4840)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/infinity.py in _element_constructor_(self, x)
   1186 
   1187         # If we got here then x is not infinite
-> 1188         c = int(bool(x > 0)) - int(bool(x < 0))
   1189         return FiniteNumber(self, c)
   1190 

TypeError: '>' not supported between instances of 'str' and 'int'
```



---

Comment by embray created at 2018-01-11 11:16:08

I've fixed a ton of issues like these in my branch, though apparently not this specific one.  But yes, if a comparison that should have worked in Python 2 no longer works in Python 3 the thing to fix is the comparison, not remove it / brush the problem under the rug.


---

Comment by git created at 2018-01-11 15:08:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2018-01-11 15:10:37

ok. I have decided to downgrade this ticket to a trivial pep8 ticket.

I have undone the change, back to `data == Infinity`

Given Travis comment:4, I allow myself to set to positive.


---

Comment by chapoton created at 2018-01-11 15:10:37

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-01-15 22:29:18

Resolution: fixed
