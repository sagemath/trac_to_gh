# Issue 24272: little cleanup of alphabet

archive/issues_024272.json:
```json
{
    "body": "CC:  @tscrim @embray @jdemeyer\n\nfor py3 compatibility, plsu a few pep8 details\n\nIssue created by migration from https://trac.sagemath.org/ticket/24509\n\n",
    "created_at": "2018-01-10T15:28:13Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "little cleanup of alphabet",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24272",
    "user": "@fchapoton"
}
```
CC:  @tscrim @embray @jdemeyer

for py3 compatibility, plsu a few pep8 details

Issue created by migration from https://trac.sagemath.org/ticket/24509





---

archive/issue_comments_339829.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-01-10T15:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339829",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_339830.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-01-10T15:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339830",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_339831.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2018-01-10T15:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339831",
    "user": "@fchapoton"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_339832.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2018-01-10T15:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339832",
    "user": "@fchapoton"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_339833.json:
```json
{
    "body": "While I doubt this is an issue, this change:\n\n```diff\n-    if data == Infinity:\n+    if data is Infinity:\n```\n\nis a slight behavior change because\n\n```\nsage: UnsignedInfinityRing.gen() == Infinity\nTrue\nsage: UnsignedInfinityRing.gen() is Infinity\nFalse\n```\n\nSo if this is okay to you or you revert this change, then you can set a positive review on my behalf.",
    "created_at": "2018-01-10T16:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339833",
    "user": "@tscrim"
}
```

While I doubt this is an issue, this change:

```diff
-    if data == Infinity:
+    if data is Infinity:
```

is a slight behavior change because

```
sage: UnsignedInfinityRing.gen() == Infinity
True
sage: UnsignedInfinityRing.gen() is Infinity
False
```

So if this is okay to you or you revert this change, then you can set a positive review on my behalf.



---

archive/issue_comments_339834.json:
```json
{
    "body": "Well, this change is the main point of the ticket. In python3, the comparison with == fails, whereas the check with \"is\" works.",
    "created_at": "2018-01-10T16:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339834",
    "user": "@fchapoton"
}
```

Well, this change is the main point of the ticket. In python3, the comparison with == fails, whereas the check with "is" works.



---

archive/issue_comments_339835.json:
```json
{
    "body": "That smells like a deeper problem as I don't see why the `==` should fail. In fact, most people in code would do checks of infinity objects by `==`. While that is an independent issue, it should not be necessary to change `==` to `is` for Python3.",
    "created_at": "2018-01-10T16:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339835",
    "user": "@tscrim"
}
```

That smells like a deeper problem as I don't see why the `==` should fail. In fact, most people in code would do checks of infinity objects by `==`. While that is an independent issue, it should not be necessary to change `==` to `is` for Python3.



---

archive/issue_comments_339836.json:
```json
{
    "body": "Indeed, I was trying to cure symptoms and not the root of illness:\n\n```\nsage: from sage.combinat.words.alphabet import *\nsage: build_alphabet(['a','b'])\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-451f2d6eca53> in <module>()\n----> 1 build_alphabet(['a','b'])\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/combinat/words/alphabet.py in build_alphabet(data, names, name)\n    231         raise ValueError(\"invalid value for names\")\n    232 \n--> 233     if data == Infinity:\n    234         data = NonNegativeIntegers()\n    235 \n\n/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Element.__richcmp__ (build/cythonized/sage/structure/element.c:10052)()\n\n/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:20685)()\n\nTypeError: '<' not supported between instances of 'sage.misc.inherit_comparison.InheritComparisonMetaclass' and 'type'\n```\n",
    "created_at": "2018-01-10T19:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339836",
    "user": "@fchapoton"
}
```

Indeed, I was trying to cure symptoms and not the root of illness:

```
sage: from sage.combinat.words.alphabet import *
sage: build_alphabet(['a','b'])
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-451f2d6eca53> in <module>()
----> 1 build_alphabet(['a','b'])

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/combinat/words/alphabet.py in build_alphabet(data, names, name)
    231         raise ValueError("invalid value for names")
    232 
--> 233     if data == Infinity:
    234         data = NonNegativeIntegers()
    235 

/home/chapoton/sage3/src/sage/structure/element.pyx in sage.structure.element.Element.__richcmp__ (build/cythonized/sage/structure/element.c:10052)()

/home/chapoton/sage3/src/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel_cache_maps.richcmp (build/cythonized/sage/structure/coerce.c:20685)()

TypeError: '<' not supported between instances of 'sage.misc.inherit_comparison.InheritComparisonMetaclass' and 'type'
```




---

archive/issue_comments_339837.json:
```json
{
    "body": "Could that be an issue with bytes/unicode vs str?",
    "created_at": "2018-01-10T21:25:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339837",
    "user": "@tscrim"
}
```

Could that be an issue with bytes/unicode vs str?



---

archive/issue_comments_339838.json:
```json
{
    "body": "Or perhaps related to:\n\n```\nsage: InfinityRing('a')\nA positive finite number\n```\n\nwhich comes from doing comparisons of the form `'a' < 0`?",
    "created_at": "2018-01-10T21:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339838",
    "user": "@tscrim"
}
```

Or perhaps related to:

```
sage: InfinityRing('a')
A positive finite number
```

which comes from doing comparisons of the form `'a' < 0`?



---

archive/issue_comments_339839.json:
```json
{
    "body": "comment:9 gives another error:\n\n```\nsage: InfinityRing('a')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-5b6ff3fa50ce> in <module>()\n----> 1 InfinityRing('a')\n\n/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9406)()\n\n/home/chapoton/sage3/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4972)()\n\n/home/chapoton/sage3/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4840)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/infinity.py in _element_constructor_(self, x)\n   1186 \n   1187         # If we got here then x is not infinite\n-> 1188         c = int(bool(x > 0)) - int(bool(x < 0))\n   1189         return FiniteNumber(self, c)\n   1190 \n\nTypeError: '>' not supported between instances of 'str' and 'int'\n```\n",
    "created_at": "2018-01-11T07:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339839",
    "user": "@fchapoton"
}
```

comment:9 gives another error:

```
sage: InfinityRing('a')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-5b6ff3fa50ce> in <module>()
----> 1 InfinityRing('a')

/home/chapoton/sage3/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9406)()

/home/chapoton/sage3/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4972)()

/home/chapoton/sage3/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4840)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/rings/infinity.py in _element_constructor_(self, x)
   1186 
   1187         # If we got here then x is not infinite
-> 1188         c = int(bool(x > 0)) - int(bool(x < 0))
   1189         return FiniteNumber(self, c)
   1190 

TypeError: '>' not supported between instances of 'str' and 'int'
```




---

archive/issue_comments_339840.json:
```json
{
    "body": "I've fixed a ton of issues like these in my branch, though apparently not this specific one.  But yes, if a comparison that should have worked in Python 2 no longer works in Python 3 the thing to fix is the comparison, not remove it / brush the problem under the rug.",
    "created_at": "2018-01-11T11:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339840",
    "user": "@embray"
}
```

I've fixed a ton of issues like these in my branch, though apparently not this specific one.  But yes, if a comparison that should have worked in Python 2 no longer works in Python 3 the thing to fix is the comparison, not remove it / brush the problem under the rug.



---

archive/issue_comments_339841.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-01-11T15:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339841",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_339842.json:
```json
{
    "body": "ok. I have decided to downgrade this ticket to a trivial pep8 ticket.\n\nI have undone the change, back to `data == Infinity`\n\nGiven Travis comment:4, I allow myself to set to positive.",
    "created_at": "2018-01-11T15:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339842",
    "user": "@fchapoton"
}
```

ok. I have decided to downgrade this ticket to a trivial pep8 ticket.

I have undone the change, back to `data == Infinity`

Given Travis comment:4, I allow myself to set to positive.



---

archive/issue_comments_339843.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-01-11T15:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339843",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_339844.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-01-15T22:29:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24272",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24272#issuecomment-339844",
    "user": "@vbraun"
}
```

Resolution: fixed
