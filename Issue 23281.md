# Issue 23281: Update cypari2 with version including idealmoddivisor

archive/issues_023281.json:
```json
{
    "body": "CC:  @jdemeyer @defeo @videlec @kiwifb\n\nKeywords: cypari2, sd87\n\nUpdate cypari2 to a version including at least the commit:\n\nhttps://github.com/defeo/cypari2/commit/8f497cd27a04e292c52b31c44c569e50bab7a625\n\nThis exposes the function idealmoddivisor that is used in the ray class group and Hecke character code of ticket #15829.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23518\n\n",
    "created_at": "2017-07-22T14:45:31Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Update cypari2 with version including idealmoddivisor",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23281",
    "user": "https://github.com/rharron"
}
```
CC:  @jdemeyer @defeo @videlec @kiwifb

Keywords: cypari2, sd87

Update cypari2 to a version including at least the commit:

https://github.com/defeo/cypari2/commit/8f497cd27a04e292c52b31c44c569e50bab7a625

This exposes the function idealmoddivisor that is used in the ray class group and Hecke character code of ticket #15829.

Issue created by migration from https://trac.sagemath.org/ticket/23518





---

archive/issue_comments_325458.json:
```json
{
    "body": "any release coming soon ?",
    "created_at": "2017-08-07T16:41:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325458",
    "user": "https://github.com/fchapoton"
}
```

any release coming soon ?



---

archive/issue_comments_325459.json:
```json
{
    "body": "**ping** ? this is the current blocking point in my experimental python3 build.",
    "created_at": "2017-08-18T10:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325459",
    "user": "https://github.com/fchapoton"
}
```

**ping** ? this is the current blocking point in my experimental python3 build.



---

archive/issue_comments_325460.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2017-08-18T11:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325460",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_325461.json:
```json
{
    "body": "I don't really know about what kind of automated stuff happens on trac anymore, so let me ask this perhaps naive question: why is this a block for anything? I only created this ticket because of #15829 which itself is still under development (has never even been marked as \"needs review\").",
    "created_at": "2017-08-18T19:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325461",
    "user": "https://github.com/rharron"
}
```

I don't really know about what kind of automated stuff happens on trac anymore, so let me ask this perhaps naive question: why is this a block for anything? I only created this ticket because of #15829 which itself is still under development (has never even been marked as "needs review").



---

archive/issue_comments_325462.json:
```json
{
    "body": "Sorry, I have used your ticket for my own purposes. I need (for something having to do with making sage works with python3) to have a new release of cypari2. So I would just embark in this ticket, which is also asking for a release of cypari2.",
    "created_at": "2017-08-18T19:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325462",
    "user": "https://github.com/fchapoton"
}
```

Sorry, I have used your ticket for my own purposes. I need (for something having to do with making sage works with python3) to have a new release of cypari2. So I would just embark in this ticket, which is also asking for a release of cypari2.



---

archive/issue_comments_325463.json:
```json
{
    "body": "Aha! I understand now. It may be worth updating the ticket description: it might encourage people to work on this ticket!",
    "created_at": "2017-08-18T19:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325463",
    "user": "https://github.com/rharron"
}
```

Aha! I understand now. It may be worth updating the ticket description: it might encourage people to work on this ticket!



---

archive/issue_comments_325464.json:
```json
{
    "body": "Something very strange happens while testing the package:\n\n```\n[cypari-1.1.0] Testing cypari2.pari_instance\n[cypari-1.1.0] Traceback (most recent call last):\n[cypari-1.1.0]   File \"tests/rundoctest.py\", line 24, in <module>\n[cypari-1.1.0]     test = doctest.testmod(mod, optionflags=doctest.ELLIPSIS|doctest.REPORT_NDIFF|doctest.IGNORE_EXCEPTION_DETAIL)\n[cypari-1.1.0]   File \"/usr/local/src/sage-config/local/lib/python2.7/doctest.py\", line 1911, in testmod\n[cypari-1.1.0]     runner.run(test)\n[cypari-1.1.0]   File \"/usr/local/src/sage-config/local/lib/python2.7/doctest.py\", line 1454, in run\n[cypari-1.1.0]     return self.__run(test, compileflags, out)\n[cypari-1.1.0]   File \"/usr/local/src/sage-config/local/lib/python2.7/doctest.py\", line 1368, in __run\n[cypari-1.1.0]     exc_info)\n[cypari-1.1.0]   File \"/usr/local/src/sage-config/local/lib/python2.7/doctest.py\", line 1235, in report_unexpected_exception\n[cypari-1.1.0]     'Exception raised:\\n' + _indent(_exception_traceback(exc_info)))\n[cypari-1.1.0]   File \"/usr/local/src/sage-config/local/lib/python2.7/doctest.py\", line 1251, in _failure_header\n[cypari-1.1.0]     return '\\n'.join(out)\n[cypari-1.1.0] UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 16: ordinal not in range(128)\n```\n\n\nThis happens only when testing the Sage package. Any other way of running the testsuite works fine.\n\nI have absolutely no idea why and I hope that somebody else can fix it.\n----\nNew commits:",
    "created_at": "2017-08-23T10:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325464",
    "user": "https://github.com/jdemeyer"
}
```

Something very strange happens while testing the package:

```
[cypari-1.1.0] Testing cypari2.pari_instance
[cypari-1.1.0] Traceback (most recent call last):
[cypari-1.1.0]   File "tests/rundoctest.py", line 24, in <module>
[cypari-1.1.0]     test = doctest.testmod(mod, optionflags=doctest.ELLIPSIS|doctest.REPORT_NDIFF|doctest.IGNORE_EXCEPTION_DETAIL)
[cypari-1.1.0]   File "/usr/local/src/sage-config/local/lib/python2.7/doctest.py", line 1911, in testmod
[cypari-1.1.0]     runner.run(test)
[cypari-1.1.0]   File "/usr/local/src/sage-config/local/lib/python2.7/doctest.py", line 1454, in run
[cypari-1.1.0]     return self.__run(test, compileflags, out)
[cypari-1.1.0]   File "/usr/local/src/sage-config/local/lib/python2.7/doctest.py", line 1368, in __run
[cypari-1.1.0]     exc_info)
[cypari-1.1.0]   File "/usr/local/src/sage-config/local/lib/python2.7/doctest.py", line 1235, in report_unexpected_exception
[cypari-1.1.0]     'Exception raised:\n' + _indent(_exception_traceback(exc_info)))
[cypari-1.1.0]   File "/usr/local/src/sage-config/local/lib/python2.7/doctest.py", line 1251, in _failure_header
[cypari-1.1.0]     return '\n'.join(out)
[cypari-1.1.0] UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 16: ordinal not in range(128)
```


This happens only when testing the Sage package. Any other way of running the testsuite works fine.

I have absolutely no idea why and I hope that somebody else can fix it.
----
New commits:



---

archive/issue_comments_325465.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2017-08-23T10:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325465",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_325466.json:
```json
{
    "body": "How can I run this testsuite ?",
    "created_at": "2017-08-23T11:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325466",
    "user": "https://github.com/fchapoton"
}
```

How can I run this testsuite ?



---

archive/issue_comments_325467.json:
```json
{
    "body": "The failing testsuite is `./sage -i -c cypari`\n\nBut like I said, the strange thing is that manually running `spkg-check` works.",
    "created_at": "2017-08-23T11:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325467",
    "user": "https://github.com/jdemeyer"
}
```

The failing testsuite is `./sage -i -c cypari`

But like I said, the strange thing is that manually running `spkg-check` works.



---

archive/issue_comments_325468.json:
```json
{
    "body": "I can confirm the failure of `./sage -i -c cypari`, just the same as what you got.\n\nHow can I run manually \"spkg-check\" ?",
    "created_at": "2017-08-23T11:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325468",
    "user": "https://github.com/fchapoton"
}
```

I can confirm the failure of `./sage -i -c cypari`, just the same as what you got.

How can I run manually "spkg-check" ?



---

archive/issue_comments_325469.json:
```json
{
    "body": "wiht python3-sage, I get something else\n\n```\n[cypari-1.1.0] ****************************************************\n[cypari-1.1.0] Uninstalling cypari2-1.0.0:\n[cypari-1.1.0]   Successfully uninstalled cypari2-1.0.0\n[cypari-1.1.0] Installing package cypari2 using pip3\n[cypari-1.1.0] Ignoring indexes: https://pypi.python.org/simple\n[cypari-1.1.0] Processing /home/chapoton/sage3/local/var/tmp/sage/build/cypari-1.1.0/src\n[cypari-1.1.0]   Running setup.py (path:/tmp/pip-yihktdba-build/setup.py) egg_info for package from file:///home/chapoton/sage3/local/var/tmp/sage/build/cypari-1.1.0/src\n[cypari-1.1.0]     Running command python setup.py egg_info\n[cypari-1.1.0]     running egg_info\n[cypari-1.1.0]     creating pip-egg-info/cypari2.egg-info\n[cypari-1.1.0]     writing pip-egg-info/cypari2.egg-info/PKG-INFO\n[cypari-1.1.0]     writing dependency_links to pip-egg-info/cypari2.egg-info/dependency_links.txt\n[cypari-1.1.0]     writing top-level names to pip-egg-info/cypari2.egg-info/top_level.txt\n[cypari-1.1.0]     writing manifest file 'pip-egg-info/cypari2.egg-info/SOURCES.txt'\n[cypari-1.1.0]     Generating PARI functions: (!_) (#_) (%) (%#) (+_) (-_) Catalan Col Colrev (DEBUGLEVEL) Euler I List Map MatTraceback (most recent call last):\n[cypari-1.1.0]       File \"<string>\", line 1, in <module>\n[cypari-1.1.0]       File \"/tmp/pip-yihktdba-build/setup.py\", line 84, in <module>\n[cypari-1.1.0]         cmdclass=dict(build_ext=build_ext, bdist_egg=no_egg)\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/distutils/core.py\", line 148, in setup\n[cypari-1.1.0]         dist.run_commands()\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/distutils/dist.py\", line 955, in run_commands\n[cypari-1.1.0]         self.run_command(cmd)\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/distutils/dist.py\", line 974, in run_command\n[cypari-1.1.0]         cmd_obj.run()\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/egg_info.py\", line 279, in run\n[cypari-1.1.0]         self.find_sources()\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/egg_info.py\", line 294, in find_sources\n[cypari-1.1.0]         mm.run()\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/egg_info.py\", line 521, in run\n[cypari-1.1.0]         self.add_defaults()\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/egg_info.py\", line 557, in add_defaults\n[cypari-1.1.0]         sdist.add_defaults(self)\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/py36compat.py\", line 36, in add_defaults\n[cypari-1.1.0]         self._add_defaults_ext()\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/py36compat.py\", line 119, in _add_defaults_ext\n[cypari-1.1.0]         build_ext = self.get_finalized_command('build_ext')\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/distutils/cmd.py\", line 299, in get_finalized_command\n[cypari-1.1.0]         cmd_obj.ensure_finalized()\n[cypari-1.1.0]       File \"/home/chapoton/sage3/local/lib/python3.6/distutils/cmd.py\", line 107, in ensure_finalized\n[cypari-1.1.0]         self.finalize_options()\n[cypari-1.1.0]       File \"/tmp/pip-yihktdba-build/setup.py\", line 50, in finalize_options\n[cypari-1.1.0]         rebuild()\n[cypari-1.1.0]       File \"/tmp/pip-yihktdba-build/autogen/__init__.py\", line 26, in rebuild\n[cypari-1.1.0]         G()\n[cypari-1.1.0]       File \"/tmp/pip-yihktdba-build/autogen/generator.py\", line 336, in __call__\n[cypari-1.1.0]         self.handle_pari_function(**v)\n[cypari-1.1.0]       File \"/tmp/pip-yihktdba-build/autogen/generator.py\", line 239, in handle_pari_function\n[cypari-1.1.0]         self.gen_file, doc, obsolete)\n[cypari-1.1.0]       File \"/tmp/pip-yihktdba-build/autogen/generator.py\", line 313, in write_method\n[cypari-1.1.0]         print(s, file=file)\n[cypari-1.1.0]     UnicodeEncodeError: 'ascii' codec can't encode character '\\xa0' in position 314: ordinal not in range(128)\n[cypari-1.1.0] Cleaning up...\n[cypari-1.1.0] Command \"python setup.py egg_info\" failed with error code 1 in /tmp/pip-yihktdba-build/\n[cypari-1.1.0] Exception information:\n[cypari-1.1.0] Traceback (most recent call last):\n[cypari-1.1.0]   File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/basecommand.py\", line 215, in main\n[cypari-1.1.0]     status = self.run(options, args)\n[cypari-1.1.0]   File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/commands/install.py\", line 324, in run\n[cypari-1.1.0]     requirement_set.prepare_files(finder)\n[cypari-1.1.0]   File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/req/req_set.py\", line 380, in prepare_files\n[cypari-1.1.0]     ignore_dependencies=self.ignore_dependencies))\n[cypari-1.1.0]   File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/req/req_set.py\", line 634, in _prepare_file\n[cypari-1.1.0]     abstract_dist.prep_for_dist()\n[cypari-1.1.0]   File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/req/req_set.py\", line 129, in prep_for_dist\n[cypari-1.1.0]     self.req_to_install.run_egg_info()\n[cypari-1.1.0]   File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/req/req_install.py\", line 439, in run_egg_info\n[cypari-1.1.0]     command_desc='python setup.py egg_info')\n[cypari-1.1.0]   File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/utils/__init__.py\", line 707, in call_subprocess\n[cypari-1.1.0]     % (command_desc, proc.returncode, cwd))\n[cypari-1.1.0] pip.exceptions.InstallationError: Command \"python setup.py egg_info\" failed with error code 1 in /tmp/pip-yihktdba-build/\n[cypari-1.1.0] Error: installing with pip3 failed\n[cypari-1.1.0] \n[cypari-1.1.0] real\t0m4.142s\n[cypari-1.1.0] user\t0m2.116s\n[cypari-1.1.0] sys\t0m0.224s\n[cypari-1.1.0] ************************************************************************\n[cypari-1.1.0] Error installing package cypari-1.1.0\n[cypari-1.1.0] ************************************************************************\n```\n",
    "created_at": "2017-08-23T12:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325469",
    "user": "https://github.com/fchapoton"
}
```

wiht python3-sage, I get something else

```
[cypari-1.1.0] ****************************************************
[cypari-1.1.0] Uninstalling cypari2-1.0.0:
[cypari-1.1.0]   Successfully uninstalled cypari2-1.0.0
[cypari-1.1.0] Installing package cypari2 using pip3
[cypari-1.1.0] Ignoring indexes: https://pypi.python.org/simple
[cypari-1.1.0] Processing /home/chapoton/sage3/local/var/tmp/sage/build/cypari-1.1.0/src
[cypari-1.1.0]   Running setup.py (path:/tmp/pip-yihktdba-build/setup.py) egg_info for package from file:///home/chapoton/sage3/local/var/tmp/sage/build/cypari-1.1.0/src
[cypari-1.1.0]     Running command python setup.py egg_info
[cypari-1.1.0]     running egg_info
[cypari-1.1.0]     creating pip-egg-info/cypari2.egg-info
[cypari-1.1.0]     writing pip-egg-info/cypari2.egg-info/PKG-INFO
[cypari-1.1.0]     writing dependency_links to pip-egg-info/cypari2.egg-info/dependency_links.txt
[cypari-1.1.0]     writing top-level names to pip-egg-info/cypari2.egg-info/top_level.txt
[cypari-1.1.0]     writing manifest file 'pip-egg-info/cypari2.egg-info/SOURCES.txt'
[cypari-1.1.0]     Generating PARI functions: (!_) (#_) (%) (%#) (+_) (-_) Catalan Col Colrev (DEBUGLEVEL) Euler I List Map MatTraceback (most recent call last):
[cypari-1.1.0]       File "<string>", line 1, in <module>
[cypari-1.1.0]       File "/tmp/pip-yihktdba-build/setup.py", line 84, in <module>
[cypari-1.1.0]         cmdclass=dict(build_ext=build_ext, bdist_egg=no_egg)
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/distutils/core.py", line 148, in setup
[cypari-1.1.0]         dist.run_commands()
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/distutils/dist.py", line 955, in run_commands
[cypari-1.1.0]         self.run_command(cmd)
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/distutils/dist.py", line 974, in run_command
[cypari-1.1.0]         cmd_obj.run()
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/egg_info.py", line 279, in run
[cypari-1.1.0]         self.find_sources()
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/egg_info.py", line 294, in find_sources
[cypari-1.1.0]         mm.run()
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/egg_info.py", line 521, in run
[cypari-1.1.0]         self.add_defaults()
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/egg_info.py", line 557, in add_defaults
[cypari-1.1.0]         sdist.add_defaults(self)
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/py36compat.py", line 36, in add_defaults
[cypari-1.1.0]         self._add_defaults_ext()
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/site-packages/setuptools/command/py36compat.py", line 119, in _add_defaults_ext
[cypari-1.1.0]         build_ext = self.get_finalized_command('build_ext')
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/distutils/cmd.py", line 299, in get_finalized_command
[cypari-1.1.0]         cmd_obj.ensure_finalized()
[cypari-1.1.0]       File "/home/chapoton/sage3/local/lib/python3.6/distutils/cmd.py", line 107, in ensure_finalized
[cypari-1.1.0]         self.finalize_options()
[cypari-1.1.0]       File "/tmp/pip-yihktdba-build/setup.py", line 50, in finalize_options
[cypari-1.1.0]         rebuild()
[cypari-1.1.0]       File "/tmp/pip-yihktdba-build/autogen/__init__.py", line 26, in rebuild
[cypari-1.1.0]         G()
[cypari-1.1.0]       File "/tmp/pip-yihktdba-build/autogen/generator.py", line 336, in __call__
[cypari-1.1.0]         self.handle_pari_function(**v)
[cypari-1.1.0]       File "/tmp/pip-yihktdba-build/autogen/generator.py", line 239, in handle_pari_function
[cypari-1.1.0]         self.gen_file, doc, obsolete)
[cypari-1.1.0]       File "/tmp/pip-yihktdba-build/autogen/generator.py", line 313, in write_method
[cypari-1.1.0]         print(s, file=file)
[cypari-1.1.0]     UnicodeEncodeError: 'ascii' codec can't encode character '\xa0' in position 314: ordinal not in range(128)
[cypari-1.1.0] Cleaning up...
[cypari-1.1.0] Command "python setup.py egg_info" failed with error code 1 in /tmp/pip-yihktdba-build/
[cypari-1.1.0] Exception information:
[cypari-1.1.0] Traceback (most recent call last):
[cypari-1.1.0]   File "/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/basecommand.py", line 215, in main
[cypari-1.1.0]     status = self.run(options, args)
[cypari-1.1.0]   File "/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/commands/install.py", line 324, in run
[cypari-1.1.0]     requirement_set.prepare_files(finder)
[cypari-1.1.0]   File "/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/req/req_set.py", line 380, in prepare_files
[cypari-1.1.0]     ignore_dependencies=self.ignore_dependencies))
[cypari-1.1.0]   File "/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/req/req_set.py", line 634, in _prepare_file
[cypari-1.1.0]     abstract_dist.prep_for_dist()
[cypari-1.1.0]   File "/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/req/req_set.py", line 129, in prep_for_dist
[cypari-1.1.0]     self.req_to_install.run_egg_info()
[cypari-1.1.0]   File "/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/req/req_install.py", line 439, in run_egg_info
[cypari-1.1.0]     command_desc='python setup.py egg_info')
[cypari-1.1.0]   File "/home/chapoton/sage3/local/lib/python3.6/site-packages/pip/utils/__init__.py", line 707, in call_subprocess
[cypari-1.1.0]     % (command_desc, proc.returncode, cwd))
[cypari-1.1.0] pip.exceptions.InstallationError: Command "python setup.py egg_info" failed with error code 1 in /tmp/pip-yihktdba-build/
[cypari-1.1.0] Error: installing with pip3 failed
[cypari-1.1.0] 
[cypari-1.1.0] real	0m4.142s
[cypari-1.1.0] user	0m2.116s
[cypari-1.1.0] sys	0m0.224s
[cypari-1.1.0] ************************************************************************
[cypari-1.1.0] Error installing package cypari-1.1.0
[cypari-1.1.0] ************************************************************************
```




---

archive/issue_comments_325470.json:
```json
{
    "body": "Can I please have\n\n```\nfrom __past__ import bytes_literals\n```\n",
    "created_at": "2017-08-23T12:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325470",
    "user": "https://github.com/jdemeyer"
}
```

Can I please have

```
from __past__ import bytes_literals
```




---

archive/issue_comments_325471.json:
```json
{
    "body": "Sorry, I do not understand..\n\n**EDIT**: oh, some kind of joke ?",
    "created_at": "2017-08-23T12:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325471",
    "user": "https://github.com/fchapoton"
}
```

Sorry, I do not understand..

**EDIT**: oh, some kind of joke ?



---

archive/issue_comments_325472.json:
```json
{
    "body": "Yes, a joke of course.\n\nLet me just say that I'm not a fan of the way how Python deals with unicode encoding issues...",
    "created_at": "2017-08-23T12:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325472",
    "user": "https://github.com/jdemeyer"
}
```

Yes, a joke of course.

Let me just say that I'm not a fan of the way how Python deals with unicode encoding issues...



---

archive/issue_comments_325473.json:
```json
{
    "body": "OK, the issues are due to `LC_ALL=C`. This is something that will need to be fixed upstream.",
    "created_at": "2017-08-24T08:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325473",
    "user": "https://github.com/jdemeyer"
}
```

OK, the issues are due to `LC_ALL=C`. This is something that will need to be fixed upstream.



---

archive/issue_comments_325474.json:
```json
{
    "body": "I just saw your e-mail about this.  Did you figure it out?  You mentioned something about `LC_ALL=C`.  And by \"fixed upstream\" do you mean in cypari?  Should I take a look at how cypari is handling encodings?",
    "created_at": "2017-08-24T10:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325474",
    "user": "https://github.com/embray"
}
```

I just saw your e-mail about this.  Did you figure it out?  You mentioned something about `LC_ALL=C`.  And by "fixed upstream" do you mean in cypari?  Should I take a look at how cypari is handling encodings?



---

archive/issue_comments_325475.json:
```json
{
    "body": "Replying to [comment:23 embray]:\n> I just saw your e-mail about this.  Did you figure it out?\n\nYes. The issue is that Python's `open()` and `print()` functions depend on the locale:\n\n```\n$ LC_ALL=en_US.UTF-8 python3 -c 'print(open(\"/dev/null\"))'\n<_io.TextIOWrapper name='/dev/null' mode='r' encoding='UTF-8'>\n$ LC_ALL=C python3 -c 'print(open(\"/dev/null\"))'\n<_io.TextIOWrapper name='/dev/null' mode='r' encoding='ANSI_X3.4-1968'>\n```\n\n\nIt turns out that cypari2 was assuming that files were opened in UTF-8 mode. I now made this explicit with `open(...., encoding=\"utf-8\")` in Python 3.",
    "created_at": "2017-08-24T12:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325475",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:23 embray]:
> I just saw your e-mail about this.  Did you figure it out?

Yes. The issue is that Python's `open()` and `print()` functions depend on the locale:

```
$ LC_ALL=en_US.UTF-8 python3 -c 'print(open("/dev/null"))'
<_io.TextIOWrapper name='/dev/null' mode='r' encoding='UTF-8'>
$ LC_ALL=C python3 -c 'print(open("/dev/null"))'
<_io.TextIOWrapper name='/dev/null' mode='r' encoding='ANSI_X3.4-1968'>
```


It turns out that cypari2 was assuming that files were opened in UTF-8 mode. I now made this explicit with `open(...., encoding="utf-8")` in Python 3.



---

archive/issue_comments_325476.json:
```json
{
    "body": "By the way, this is a useful guide handling encodings when reading text files:\n\nhttp://python-notes.curiousefficiency.org/en/latest/python3/text_file_processing.html#text-file-processing\n\nI would suggest also adding `errors='surrogateescape'`.  This way if any file happens to contain non-ASCII characters that were written using any encoding other than UTF-8, it will at least handle the ASCII parts correctly and not blow up with a `UnicodeDecodeError`.",
    "created_at": "2017-08-24T12:32:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325476",
    "user": "https://github.com/embray"
}
```

By the way, this is a useful guide handling encodings when reading text files:

http://python-notes.curiousefficiency.org/en/latest/python3/text_file_processing.html#text-file-processing

I would suggest also adding `errors='surrogateescape'`.  This way if any file happens to contain non-ASCII characters that were written using any encoding other than UTF-8, it will at least handle the ASCII parts correctly and not blow up with a `UnicodeDecodeError`.



---

archive/issue_comments_325477.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-08-24T12:59:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_325478.json:
```json
{
    "body": "Replying to [comment:25 embray]:\n> I would suggest also adding `errors='surrogateescape'`.  This way if any file happens to contain non-ASCII characters that were written using any encoding other than UTF-8, it will at least handle the ASCII parts correctly and not blow up with a `UnicodeDecodeError`.\n\nThis is not applicable here. In this case, we *know* that all the files we deal with are UTF-8. The input files come from the PARI documentation which is written in UTF-8. And the output files contain auto-generated Cython code which has a `# -*- coding: utf-8 -*-` header.",
    "created_at": "2017-08-24T13:05:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325478",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 embray]:
> I would suggest also adding `errors='surrogateescape'`.  This way if any file happens to contain non-ASCII characters that were written using any encoding other than UTF-8, it will at least handle the ASCII parts correctly and not blow up with a `UnicodeDecodeError`.

This is not applicable here. In this case, we *know* that all the files we deal with are UTF-8. The input files come from the PARI documentation which is written in UTF-8. And the output files contain auto-generated Cython code which has a `# -*- coding: utf-8 -*-` header.



---

archive/issue_comments_325479.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-24T13:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325479",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_325480.json:
```json
{
    "body": "This version builds and passes its testsuite. I did not yet run Sage doctests.",
    "created_at": "2017-08-24T13:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325480",
    "user": "https://github.com/jdemeyer"
}
```

This version builds and passes its testsuite. I did not yet run Sage doctests.



---

archive/issue_comments_325481.json:
```json
{
    "body": "That's good, that makes it easy then.",
    "created_at": "2017-08-24T13:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325481",
    "user": "https://github.com/embray"
}
```

That's good, that makes it easy then.



---

archive/issue_comments_325482.json:
```json
{
    "body": "Side comment: the `# -*- coding: utf-8 -*-` header doesn't actually matter since Cython supports [PEP 3120](https://www.python.org/dev/peps/pep-3120/).",
    "created_at": "2017-08-24T13:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325482",
    "user": "https://github.com/jdemeyer"
}
```

Side comment: the `# -*- coding: utf-8 -*-` header doesn't actually matter since Cython supports [PEP 3120](https://www.python.org/dev/peps/pep-3120/).



---

archive/issue_comments_325483.json:
```json
{
    "body": "not yet smooth for python3:\n\n```\n[cypari-1.1.1]     Running setup.py install for cypari2: finished with status 'done'\n[cypari-1.1.1]   Removing source in /tmp/pip-qsn9psry-build\n[cypari-1.1.1] Successfully installed cypari2-1.1.1\n[cypari-1.1.1] Cleaning up...\n[cypari-1.1.1] \n[cypari-1.1.1] real\t3m51.177s\n[cypari-1.1.1] user\t3m42.104s\n[cypari-1.1.1] sys\t0m5.896s\n[cypari-1.1.1] Successfully installed cypari-1.1.1\n[cypari-1.1.1] Running the test suite for cypari-1.1.1...\n[cypari-1.1.1] make[2]: Entering directory '/home/chapoton/sage3/local/var/tmp/sage/build/cypari-1.1.1/src'\n[cypari-1.1.1] python tests/rundoctest.py\n[cypari-1.1.1] Traceback (most recent call last):\n[cypari-1.1.1]   File \"tests/rundoctest.py\", line 15, in <module>\n[cypari-1.1.1]     cypari2.string_utils.encoding = \"utf-8\"\n[cypari-1.1.1] AttributeError: 'module' object has no attribute 'string_utils'\n[cypari-1.1.1] Makefile:16: recipe for target 'check' failed\n[cypari-1.1.1] make[2]: *** [check] Error 1\n[cypari-1.1.1] make[2]: Leaving directory '/home/chapoton/sage3/local/var/tmp/sage/build/cypari-1.1.1/src'\n[cypari-1.1.1] \n[cypari-1.1.1] real\t0m0.346s\n[cypari-1.1.1] user\t0m0.120s\n[cypari-1.1.1] sys\t0m0.012s\n[cypari-1.1.1] ************************************************************************\n```\n",
    "created_at": "2017-08-24T13:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325483",
    "user": "https://github.com/fchapoton"
}
```

not yet smooth for python3:

```
[cypari-1.1.1]     Running setup.py install for cypari2: finished with status 'done'
[cypari-1.1.1]   Removing source in /tmp/pip-qsn9psry-build
[cypari-1.1.1] Successfully installed cypari2-1.1.1
[cypari-1.1.1] Cleaning up...
[cypari-1.1.1] 
[cypari-1.1.1] real	3m51.177s
[cypari-1.1.1] user	3m42.104s
[cypari-1.1.1] sys	0m5.896s
[cypari-1.1.1] Successfully installed cypari-1.1.1
[cypari-1.1.1] Running the test suite for cypari-1.1.1...
[cypari-1.1.1] make[2]: Entering directory '/home/chapoton/sage3/local/var/tmp/sage/build/cypari-1.1.1/src'
[cypari-1.1.1] python tests/rundoctest.py
[cypari-1.1.1] Traceback (most recent call last):
[cypari-1.1.1]   File "tests/rundoctest.py", line 15, in <module>
[cypari-1.1.1]     cypari2.string_utils.encoding = "utf-8"
[cypari-1.1.1] AttributeError: 'module' object has no attribute 'string_utils'
[cypari-1.1.1] Makefile:16: recipe for target 'check' failed
[cypari-1.1.1] make[2]: *** [check] Error 1
[cypari-1.1.1] make[2]: Leaving directory '/home/chapoton/sage3/local/var/tmp/sage/build/cypari-1.1.1/src'
[cypari-1.1.1] 
[cypari-1.1.1] real	0m0.346s
[cypari-1.1.1] user	0m0.120s
[cypari-1.1.1] sys	0m0.012s
[cypari-1.1.1] ************************************************************************
```




---

archive/issue_comments_325484.json:
```json
{
    "body": "Sigh... but Python 3 works fine outside of Sage in Travis CI, running the same commands (`pip install .` and `make check`).",
    "created_at": "2017-08-24T13:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325484",
    "user": "https://github.com/jdemeyer"
}
```

Sigh... but Python 3 works fine outside of Sage in Travis CI, running the same commands (`pip install .` and `make check`).



---

archive/issue_comments_325485.json:
```json
{
    "body": "Well, I am using \"export SAGE_PYTHON3=yes\", pull the branch here and \"sage -c -f cypari\" (in a dedicated sage install for py3 experimental work)\n\nMaybe it is because the python3 general setup is not firmly in place..",
    "created_at": "2017-08-24T14:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325485",
    "user": "https://github.com/fchapoton"
}
```

Well, I am using "export SAGE_PYTHON3=yes", pull the branch here and "sage -c -f cypari" (in a dedicated sage install for py3 experimental work)

Maybe it is because the python3 general setup is not firmly in place..



---

archive/issue_comments_325486.json:
```json
{
    "body": "Doctests pass (on Python 2).\n\nI don't understand why this fails with `SAGE_PYTHON3=yes`, especially given that the error seems to be not specific to Python 3 and given that it works with Python 3 outside of Sage. Maybe there is simply a problem with the particular setup of chapoton.\n\nIn any case, I suggest that this should not be a blocker for merging this ticket. It doesn't make the Python 3 situation any worse than before and it helps people who need to update `cypari2` for other reasons.",
    "created_at": "2017-08-24T15:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325486",
    "user": "https://github.com/jdemeyer"
}
```

Doctests pass (on Python 2).

I don't understand why this fails with `SAGE_PYTHON3=yes`, especially given that the error seems to be not specific to Python 3 and given that it works with Python 3 outside of Sage. Maybe there is simply a problem with the particular setup of chapoton.

In any case, I suggest that this should not be a blocker for merging this ticket. It doesn't make the Python 3 situation any worse than before and it helps people who need to update `cypari2` for other reasons.



---

archive/issue_comments_325487.json:
```json
{
    "body": "ok, ok. But still, if somebody could try to reproduce that error that I find..\n\nEDIT: I do not have a particular setup, I think.",
    "created_at": "2017-08-24T15:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325487",
    "user": "https://github.com/fchapoton"
}
```

ok, ok. But still, if somebody could try to reproduce that error that I find..

EDIT: I do not have a particular setup, I think.



---

archive/issue_comments_325488.json:
```json
{
    "body": "I'll have a look at the Python 3 issue. I agree with Jeroen it needn't hold up this issue but I can try to investigate ASAP (I need to do a `SAGE_PYTHON3=yes` build anyways to help with other issues on that).",
    "created_at": "2017-08-24T16:17:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325488",
    "user": "https://github.com/embray"
}
```

I'll have a look at the Python 3 issue. I agree with Jeroen it needn't hold up this issue but I can try to investigate ASAP (I need to do a `SAGE_PYTHON3=yes` build anyways to help with other issues on that).



---

archive/issue_comments_325489.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-29T12:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325489",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_325490.json:
```json
{
    "body": "ok, let this go in. We will see later what to do for tests to pass in python3.",
    "created_at": "2017-08-29T12:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325490",
    "user": "https://github.com/fchapoton"
}
```

ok, let this go in. We will see later what to do for tests to pass in python3.



---

archive/issue_comments_325491.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-02T09:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325491",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060300.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-09-02T09:34:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23281#event-60300"
}
```



---

archive/issue_comments_325492.json:
```json
{
    "body": "Any news from the `PYTHON3` front?",
    "created_at": "2017-09-05T13:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325492",
    "user": "https://github.com/jdemeyer"
}
```

Any news from the `PYTHON3` front?



---

archive/issue_comments_325493.json:
```json
{
    "body": "Not an answer on the cypari2 relation to python3..\n\nWell, this ticket fixes the issue that I had. One of the first blocking point for PYTHON3 is now the division problem in #22875. If you feel like handling this one, it would be great, because I do not understand exactly what you ask for there.\n\nAnd #23785 would be helpful too.",
    "created_at": "2017-09-05T13:59:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23281",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23281#issuecomment-325493",
    "user": "https://github.com/fchapoton"
}
```

Not an answer on the cypari2 relation to python3..

Well, this ticket fixes the issue that I had. One of the first blocking point for PYTHON3 is now the division problem in #22875. If you feel like handling this one, it would be great, because I do not understand exactly what you ask for there.

And #23785 would be helpful too.
