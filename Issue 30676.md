# Issue 30676: sagelib: Add setup.cfg [install_requires]

Issue created by migration from https://trac.sagemath.org/ticket/30913

Original creator: mkoeppe

Original creation time: 2020-11-14 07:21:10

CC:  dimpase @tobiasdiez jhpalmieri vdelecroix fbissey malb




---

Comment by mkoeppe created at 2020-11-15 03:43:04

Last 10 new commits:


---

Comment by mkoeppe created at 2020-11-15 03:43:04

Changing status from new to needs_review.


---

Comment by git created at 2020-11-15 04:21:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-20 00:44:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-11-20 02:07:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2020-11-20 19:46:22

Will this be able to deal with optional package declarations (in time)?


---

Comment by mkoeppe created at 2020-11-20 19:50:55

The plan for optional packages is that users would install a package such as `sagemath-meataxe` or `sagemath-tdlib` in addition to `sagemath-standard`.


---

Comment by git created at 2020-11-27 04:13:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-06 17:43:52

Changing keywords from "" to "sd111".


---

Comment by git created at 2020-12-10 19:25:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-10 19:28:43

Added instructions for testing to the ticket description. 
In particular, this reveals the missing dependencies of upstream Python packages tracked in #30922.


---

Comment by git created at 2020-12-10 19:36:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-12 01:01:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-12 01:22:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-12 06:05:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-12 06:26:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-12 06:27:41

To generate the `requirements.txt` file as well, need #29041


---

Comment by mkoeppe created at 2020-12-12 06:27:41

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-12-12 07:23:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-12 07:37:29

Changing status from needs_work to needs_review.


---

Comment by @tobiasdiez created at 2020-12-12 20:47:21

Since the setup.cfg and requirments.txt file are static (do not depend on the developers/users system), I would check them in as normal files instead of auto-generating them as part of the bootstrap. Then one would only need to update them as part of a package update (having a (doc)test to verify that the content of these files is always up-to-date).

A few more observations while scrolling through the code:
- I think the Licence file should be in the root, so that other tools (e.g. github) automatically pick them up.
- Are the symlinks really necessary? I would prefer if instead the path of the original is passed to e.g. setuptools.
- Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?


---

Comment by mkoeppe created at 2020-12-12 20:51:46

Replying to [comment:26 gh-tobiasdiez]:
> Since the setup.cfg and requirments.txt file are static (do not depend on the developers/users system), I would check them in as normal files instead of auto-generating them as part of the bootstrap.

No, this is preparation for modularization, in which we will have dozens of packages.
Auto-generation is key for maintainability.


---

Comment by mkoeppe created at 2020-12-12 20:53:28

Replying to [comment:26 gh-tobiasdiez]:
> - I think the Licence file should be in the root, so that other tools (e.g. github) automatically pick them up.

The new file is the license for sagelib. Different from the one in top-level, which is about the Sage distribution.


---

Comment by @tobiasdiez created at 2020-12-12 20:54:09

You can still auto-generate these files! My suggestion was to only to it when updating a package and not on bootstrap.


---

Comment by mkoeppe created at 2020-12-12 20:54:32

Replying to [comment:26 gh-tobiasdiez]:
> - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?

It needs to be configurable. For example `local` can be replaced by the user using `./configure --prefix`


---

Comment by @tobiasdiez created at 2020-12-12 20:57:10

Replying to [comment:30 mkoeppe]:
> Replying to [comment:26 gh-tobiasdiez]:
> > - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?
> 
> It needs to be configurable. For example `local` can be replaced by the user using `./configure --prefix`

What If I want to have the wheels outside of the current local folder?


---

Comment by mkoeppe created at 2020-12-12 20:57:52

Replying to [comment:29 gh-tobiasdiez]:
> You can still auto-generate these files! My suggestion was to only to it when updating a package and not on bootstrap.

I don't like to have generated files in the git repository. The only files for which we do that (the release manager does, actually) is to update Sage's own version files, and in the long term I would actually change that.


---

Comment by mkoeppe created at 2020-12-12 20:58:26

Replying to [comment:31 gh-tobiasdiez]:
> What If I want to have the wheels outside of the current local folder?

You pass the environment variable to tox


---

Comment by mkoeppe created at 2020-12-12 21:00:15

By the way, we could also generate Pipfile here on this ticket ...


---

Comment by mkoeppe created at 2020-12-12 21:11:41

Replying to [comment:26 gh-tobiasdiez]:
> - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?

I think I misunderstood your question. Yes, the variable `SAGE_SPKG_WHEELS` is expected to point to the full location of the wheels when set. 

But I made a mistake - the `simple` is not expected to be part of `SAGE_SPKG_WHEELS`


---

Comment by git created at 2020-12-12 21:14:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2020-12-12 21:49:13

Replying to [comment:35 mkoeppe]:
> Replying to [comment:26 gh-tobiasdiez]:
> > - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?
> 
> I think I misunderstood your question. Yes, the variable `SAGE_SPKG_WHEELS` is expected to point to the full location of the wheels when set. 
> 
> But I made a mistake - the `simple` is not expected to be part of `SAGE_SPKG_WHEELS`

And I missed that the SAGE_LOCAL part is only the fallback in case SAGE_SPKG_WHEELS doesn't exist.


---

Comment by git created at 2020-12-13 01:18:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2020-12-13 12:36:35

Changing status from needs_review to needs_work.


---

Comment by @tobiasdiez created at 2020-12-13 12:36:35

Thanks for also generating the pipfile. However, you are currently locking the version of most packages. The idea, however, is that the pipfile is quite liberal, and only specifies the minimal version requirements (e.g. if an older version of a package is known not to work for some reason). The specific package versions are in the pipfile.lock file, which can be automatically generated by pipenv (which also contains versions for the whole dependency tree).


---

Comment by mkoeppe created at 2020-12-13 17:59:21

Hm... If that is so, then we should generate this information from the version constraints that are in the files `install-requires.txt`.

But what if the user wants to lock the same versions that are defined in the Sage distribution?

And also my guess is that `Pipfile` should then also contain lists of packages that are not actual dependencies of `sagelib` but are present in the Sage distribution. Otherwise, `Pipfile` would just encode the same package and version requirements that are already known by `setup.cfg install-requires` -- that can't be the whole purpose of `Pipfile`.


---

Comment by @tobiasdiez created at 2020-12-13 21:46:47

I think we should really separate between sage-the-distribution and sage-the-library.

For a library, you specify the abstract dependencies via `install-requires`. It's important to do that without version information because otherwise that might lead to ugly dependency issues for users of that library (e.g. if another library requires incompatible dependency versions). The pipfile is not really necessary in this case, except that it defines a test/development environment. Here, the pipfile declares the abstract requirements, and the pipfile.lock is saying "these versions are known to work". So for sage, one might consider to sync the pipfile.lock with the version information in build/pkgs but that's really hard to do because pipenv also calculates hashes etc (I guess). 

For applications, you declare all dependencies in the pipfile, and use pipenv to create the whole concrete dependency tree meeting all restricts for all dependencies and their subdependencies. Adopting pipenv for this purpose in sage, you could remove all pip-packages from build/pkgs and let pipenv manage all Python dependencies. Then the pipfile indeed would need to declare all packages that are currently present in the sage distribution (so it would more or less correspond to the list of folders in build/pkgs) and the pipfile.lock contains the exact version information, including where to get it and the files hashes (so basically the content of the folders in build/pkgs).

See https://pipenv.pypa.io/en/latest/advanced/#pipfile-vs-setup-py for more details.

My proposal would be to use pipenv at the moment only for providing a test environment. In this case, one strategy would be to only put the pipfile (with it's abstract dependencies) under version control, and generate the pipenv.lock as a build artifact (so that if the test fail, one could regenerate the exact same environment locally). Moreover, there could be a second pipfile (and pipfile.lock) in the build folder, specifying the same versions as in the build/pkgs folder (to make it simpler to create a test environment that equals the distributed environment).


---

Comment by mkoeppe created at 2020-12-13 21:54:15

Replying to [comment:42 gh-tobiasdiez]:
> I think we should really separate between sage-the-distribution and sage-the-library.
> 
> For a library, you specify the abstract dependencies via `install-requires`. It's important to do that without version information because otherwise that might lead to ugly dependency issues for users of that library (e.g. if another library requires incompatible dependency versions).

"Without version information" -- surely you mean "without fixing specific versions"


---

Comment by mkoeppe created at 2020-12-13 22:00:02

Replying to [comment:42 gh-tobiasdiez]:
> I think we should really separate between sage-the-distribution and sage-the-library.
> 
> For a library, [...]

Right, I would consider sagelib a library...

> For applications, 

... which the sage distribution should probably considered to be ...

> you declare all dependencies in the pipfile, and use pipenv to create the whole concrete dependency tree meeting all restricts for all dependencies and their subdependencies. Adopting pipenv for this purpose in sage, you could remove all pip-packages from build/pkgs and let pipenv manage all Python dependencies. 

Well, we won't remove the Python packages from `build/pkgs`. But I want to enable the users to use `pipenv` for exactly this at their option. In particular in combination with #30896	(`./configure --without-sage-venv`) this would be an interesting way to build Sage.

> Then the pipfile indeed would need to declare all packages that are currently present in the sage distribution (so it would more or less correspond to the list of folders in build/pkgs) and the pipfile.lock contains the exact version information, including where to get it and the files hashes (so basically the content of the folders in build/pkgs).

Let's investigate if the `pipfile.lock` file really needs to include hashes or we can get away with automatically generating a weaker version


---

Comment by git created at 2020-12-15 01:06:04

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2020-12-15 01:06:24

Last 10 new commits:


---

Comment by @tobiasdiez created at 2020-12-15 12:57:36

Replying to [comment:43 mkoeppe]:
> "Without version information" -- surely you mean "without fixing specific versions"

Well, only specifying known upper and lower bounds for the versions. Maybe it would make sense to add min/max version information in build/pkgs?


> Let's investigate if the pipfile.lock file really needs to include hashes or we can get away with automatically generating a weaker version.

The hashes and the complete dependency tree is what makes pipenv special over requirements.txt. For applications (i.e. sage distribution), it should be fine to pin the versions in the pipfile (in the build folder). Normally you don't want to do this because it makes upgrades harder (if the versions are free, you can simply run `pipenv update` for this). But since upgrades are done differently in sage anyway, it should be fine.

So what you think about the following:
- One pipfile in build (pipfile.lock in gitignore) with all packages in the distribution and version information locked (for users to use pipenv to install pip packages)
- One pipfile in src (pipfile.lock in gitignore) with all dependencies of sagelib and version information as free as possible (for developers to generate a dev environment, and for CI as test environment)


---

Comment by mkoeppe created at 2020-12-16 22:01:35

Replying to [comment:47 gh-tobiasdiez]:
> Maybe it would make sense to add min/max version information in build/pkgs?

This information was recently added in the files `install-requires.txt`
and this is what we are generating `setup.cfg [install_requires]` from.


---

Comment by mkoeppe created at 2020-12-17 17:33:26

Replying to [comment:47 gh-tobiasdiez]:
> So what you think about the following:
> - One pipfile in build (pipfile.lock in gitignore) with all packages in the distribution and version information locked (for users to use pipenv to install pip packages)

Yes, we can do this; except I would put in `SAGE_ROOT`, not `SAGE_ROOT/build`. (We create environment files for conda there already. And `build` is the location of the `setup.py` of `sage_bootstrap` - so that would be confusing.)

> - One pipfile in src (pipfile.lock in gitignore) with all dependencies of sagelib and version information as free as possible (for developers to generate a dev environment, and for CI as test environment)  

OK.


---

Comment by git created at 2020-12-17 17:46:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-17 18:01:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-12-17 18:03:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-12-17 18:07:12

OK, here is a version as a starting point.


---

Comment by mkoeppe created at 2020-12-17 18:38:04

Help with getting the pipfiles in shape would be very welcome


---

Comment by @tobiasdiez created at 2020-12-18 12:33:17

Replying to [comment:48 mkoeppe]:
> This information was recently added in the files `install-requires.txt`
> and this is what we are generating `setup.cfg [install_requires]` from.

Ok, good to know!


---

Comment by @tobiasdiez created at 2020-12-18 12:35:34

Replying to [comment:54 mkoeppe]:
> Help with getting the pipfiles in shape would be very welcome

You took the initial pipfile from my ticket, right? They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).


---

Comment by @tobiasdiez created at 2020-12-18 12:38:52

For the files in build/pkgs/sagelib, are they meant for distribution? In this case, it's probably enough to add only the pipfile in the root there (since src/pipfile is for developers only).

Since the pipfile in the root seems to be only for distribution, why not put it directly in `build/pgks/sagelib`?


---

Comment by mkoeppe created at 2020-12-21 18:03:17

Replying to [comment:56 gh-tobiasdiez]:
> Replying to [comment:54 mkoeppe]:
> > Help with getting the pipfiles in shape would be very welcome
> 
> You took the initial pipfile from my ticket, right? 

Yes

> They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).

The version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.


---

Comment by @tobiasdiez created at 2020-12-22 10:28:55

Replying to [comment:58 mkoeppe]:
> > They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).
> 
> The version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.
> 

Pipenv will use the prebuilt wheels anyway, so there is no point in installing build dependencies for these packages, right?


---

Comment by mkoeppe created at 2020-12-22 14:24:28

Replying to [comment:59 gh-tobiasdiez]:
> > The version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.
> > 
> 
> Pipenv will use the prebuilt wheels anyway, so there is no point in installing build dependencies for these packages, right?

Most dependencies are actually not just build dependencies but runtime dependencies.
For example - `matplotlib` depends on `dateutil`


---

Comment by git created at 2021-01-18 20:35:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-18 20:46:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-19 01:52:23

When trying to use the "install-requires" method, I am running into the problem that Cython does not seem to find the `.pxd` files of build requirements that are provided in pip's build isolation, such as `cysignals`.


---

Comment by git created at 2021-01-19 07:36:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-20 22:48:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-20 23:03:32

`./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -r -v -v -v -e python-sagewheels-norequirements)'` now gets all the way to here:

```
/pkgs/sagelib/src/.tox/python-sagewheels-norequirements/bin/sage -c 'import sys; print("sys.path =", sys.path); import sage.all; print(sage.all.__file__)'
Traceback (most recent call last):
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/.tox/python-sagewheels-norequirements/bin/sage-location", line 11, in <module>
    SAGE_ROOT     = os.path.realpath(os.environ['SAGE_ROOT'])
  File "/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/os.py", line 679, in __getitem__
    raise KeyError(key) from None
KeyError: 'SAGE_ROOT'
```

So let's finally get rid of this `sage-location` business in #21783.


---

Comment by git created at 2021-01-21 02:08:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-21 02:18:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-21 02:20:15

`./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-pipenv-sagewheels)'` now leads to ...

```
pipenv.exceptions.ResolutionFailure: ERROR: Could not find a version that matches gmpy2>=2.1.0b5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenvt6rhur8arequirements/pipenv-53ckyr68-constraints.txt (line 2))
Tried: 2.0.1, 2.0.2, 2.0.3, 2.0.4, 2.0.5, 2.0.6, 2.0.7, 2.0.8
Skipped pre-versions: 2.1.0a1, 2.1.0a2, 2.1.0a3, 2.1.0a4, 2.1.0b1, 2.1.0b3, 2.1.0b4, 2.1.0b5, 2.1.0b5
```



---

Comment by git created at 2021-01-21 03:50:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-21 08:15:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-21 08:23:31

As is to be expected, if the correct version of a package is not already built in `local/var/lib/sage/wheels` and `pipenv` tries to build the wheel, this can fail

```
  Building wheels for collected packages: pplpy
    Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-jcmfqod5
    Destination directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-jcmfqod5
    Building wheel for pplpy (PEP 517): started
...
    ld: library not found for -lpari
    clang: error: linker command failed with exit code 1 (use -v to see invocation)
    error: command '/usr/bin/clang++' failed with exit code 1
    Building wheel for pplpy (PEP 517): finished with status 'error'
    ERROR: Failed building wheel for pplpy
  Failed to build pplpy
```



---

Comment by mkoeppe created at 2021-01-21 08:32:52


```
Using version 0.8.7 (newest of versions: 0.8.6, 0.8.7)
Collecting pplpy>=0.8.6
```



---

Comment by vdelecroix created at 2021-01-21 08:34:41

I released pplpy 0.8.7 to fix a weird issue with clang-11.0.0 on FreeBSD, see https://gitlab.com/videlec/pplpy/-/issues/21. As far as SageMath is concerned, there should be no difference.


---

Comment by mkoeppe created at 2021-01-21 18:12:58

Thanks for the update, Vincent. There is no problem.


---

Comment by git created at 2021-01-22 21:10:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-23 02:06:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-23 03:39:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-01-23 04:26:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-01-23 04:27:46

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2021-01-23 04:43:34

This seems to work well now - but the variants using pipenv fail in mysterious ways. I have marked these variants as "experimental" in the comments in `build/pkgs/sagelib/src/tox.ini`.

Ready for review.


---

Comment by @tobiasdiez created at 2021-01-23 10:29:51

What errors / problems do you have with pipenv?


---

Comment by mkoeppe created at 2021-01-23 18:52:44

Replying to [comment:95 gh-tobiasdiez]:
> What errors / problems do you have with pipenv?

Most recently - it did not accept the existing wheel of the latest version and is deciding to build another wheel of the same version:

```
Local files found: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/lib/sage/wheels/fpylll-0.5.4-cp39-cp39-macosx_10_15_x86_64.whl
Checked 2 links for project 'fpylll' against 2 hashes (1 matches, 1 no digest): discarding no candidates
Using version 0.5.4 (newest of versions: 0.5.4)
Collecting fpylll==0.5.4
  Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-unpack-hnc4lgb4
  Looking up "https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz" in the cache
  Current age based on date: 1384
  Ignoring unknown cache-control directive: immutable
  Freshness lifetime from max-age: 365000000
  The response is "fresh", returning cached response
  365000000 > 1384
  Using cached fpylll-0.5.4.tar.gz (115 kB)
  Added fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1)) to build tracker '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-req-tracker-6cth3jj8'
    Running setup.py (path:/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py) egg_info for package fpylll
    Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i
    Running command python setup.py egg_info
    running egg_info
    creating /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info
    writing /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/PKG-INFO
    writing dependency_links to /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/dependency_links.txt
    writing top-level names to /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/top_level.txt
    writing manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'
    Package fplll was not found in the pkg-config search path.
    Perhaps you should add the directory containing `fplll.pc'
    to the PKG_CONFIG_PATH environment variable
    No package 'fplll' found
    reading manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'
    reading manifest template 'MANIFEST.in'
    no previously-included directories found matching 'build'
    no previously-included directories found matching 'dist'
    writing manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'
  Source in /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll has version 0.5.4, which satisfies requirement fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1))
  Removed fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1)) from build tracker '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-req-tracker-6cth3jj8'
Building wheels for collected packages: fpylll
  Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab
  Building wheel for fpylll (setup.py): started
  Destination directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab
  Running command /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/.tox/python-sagewheels-pipenv-dist/bin/python -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py'"'"'; __file__='"'"'/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' bdist_wheel -d /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab
  running bdist_wheel
```


Overall, despite cranking up verbosity, it's quite opaque


---

Comment by @tobiasdiez created at 2021-01-23 19:45:01

Mhh, with this I have no experience, as I've always took the wheel from pypi or had the build dependencies installed. 

Maybe it works if you set `prefer_binary = true`. In general, the selection seems to follow the following criteria:
https://github.com/pypa/pipenv/blob/cda15b3b30e04e038ee286bced6c47a311f1e0ec/pipenv/patched/notpip/_internal/index/package_finder.py#L503-L517


---

Comment by mkoeppe created at 2021-01-23 19:55:47

Thanks, that's something to explore in a follow up.

For this ticket I think I don't want to spend more time on `pipenv`. The other, more elementary, ways of installing things are working fine.


---

Comment by @tobiasdiez created at 2021-02-04 22:23:18

One more point for discussion is if the pipfile should list the dependencies or if it is enough to only put them in the install_requires.
Normally, the advice seems to be to put them only in install_requires, but that's mainly to capture missing dependencies and not bother to keep the files in sync. But since they are now automatically generated, I'm not sure how to precede. 

Some discussions on this point: https://github.com/psf/requests/blob/967a05bfffcb68f97296eda197b062221c2ebc0d/Pipfile#L25 and "Problem: Hiding broken setup.py defined dependencies" in https://github.com/pypa/pipenv/issues/1911. See also discussion in https://github.com/pypa/pipenv/issues/1263 and https://pipenv-fork.readthedocs.io/en/latest/advanced.html#pipfile-vs-setup-py


---

Comment by mkoeppe created at 2021-02-04 23:12:24

Which of the two Pipfiles are you talking about?


---

Comment by @tobiasdiez created at 2021-02-05 13:27:54

Mostly the one in the src folder, but I guess the question actually applies to both.


---

Comment by mkoeppe created at 2021-02-05 19:04:24

As per previous discussion, `SAGE_ROOT/Pipfile.m4` (= `Pipfile-dist.m4`) locks all package versions to the one in the Sage distribution (see comment at top -- many packages are still missing in this file, this needs work). As `setup.cfg [install_requires]` only has version ranges, we cannot reduce this Pipfile.

I agree with your comment regarding `src/Pipfile.m4`. Indeed the packages that are already specified in `setup.cfg [install_requires]` should not appear here - mainly for clarity (as you point out, by design we do not have the synchronization issues mentioned in the discussions). I will make this change.

Actually for several packages, whether they should appear in `setup.cfg [install_requires]` or not is a bit of a question. Later refinements can happen later, and will certainly as modularization comes along.


---

Comment by @tobiasdiez created at 2021-02-05 19:13:33

Sounds good to me!


---

Comment by git created at 2021-02-05 19:16:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-02-05 19:18:38

Not much is left in `src/Pipfile.m4` now...

Any thoughts on `python_version`?


---

Comment by git created at 2021-02-05 19:21:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-02-05 19:26:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-02-05 19:27:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-02-05 19:48:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-02-05 19:49:49

Replying to [comment:107 mkoeppe]:
> Any thoughts on `python_version`? 

For now I have fixed it in `SAGE_ROOT/Pipfile`, added the supported range to `src/setup.cfg` and removed the setting from `src/Pipfile`


---

Comment by @tobiasdiez created at 2021-02-05 21:13:28

I agree, this seems to be the way to go.


---

Comment by git created at 2021-02-07 20:56:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-02-12 19:04:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-02-12 20:51:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-02-12 20:53:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-02-12 20:55:15

Rebased/squashed on top of current beta + dependencies (removing dependency on #30527), and avoiding changes to `src/` that conflicted with #31377.


---

Comment by git created at 2021-02-12 21:55:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-07 21:19:40

Changing priority from major to critical.


---

Comment by mkoeppe created at 2021-03-07 21:19:40

Now that most dependencies are merged, this ticket should be easier to review...


---

Comment by git created at 2021-03-14 23:58:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-19 21:04:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-22 04:47:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-22 19:46:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-23 02:19:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-24 06:19:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2021-03-24 11:22:08

on a clean repo I ran ./bootstrap and then

```
./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)
...
adding 'sagemath-standard-9.3rc0/sagemath_standard.egg-info/SOURCES.txt'
adding 'sagemath-standard-9.3rc0/sagemath_standard.egg-info/top_level.txt'
removing 'sagemath-standard-9.3rc0' (and everything under it)

GLOB finish: packaging after 3.96 seconds
copying new sdistfile to '/users/dimpase/.tox/distshare/sagemath-standard-9.3rc0.zip'
package .tmp/package/1/sagemath-standard-9.3rc0.zip links to dist/sagemath-standard-9.3rc0.zip (/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox)
python-sagewheels-nopypi start: getenv /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi
python-sagewheels-nopypi cannot reuse: no previous config /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/.tox-config1
python-sagewheels-nopypi create: /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi
  removing /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi
setting PATH=/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin:/home/scratch2/dimpase/sage/sage/build/bin:/home/scratch2/dimpase/sage/sage/src/bin:/home/scratch2/dimpase/sage/sage/local/bin:/home/scratch2/dimpase/sage/sage/local/bin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin
  /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox$ /usr/bin/python3 -m virtualenv --python /usr/bin/python3 python-sagewheels-nopypi >/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/log/python-sagewheels-nopypi-0.log
python-sagewheels-nopypi installdeps: -rrequirements.txt
setting PATH=/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin:/home/scratch2/dimpase/sage/sage/build/bin:/home/scratch2/dimpase/sage/sage/src/bin:/home/scratch2/dimpase/sage/sage/local/bin:/home/scratch2/dimpase/sage/sage/local/bin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin
  /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src$ /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt 
Ignoring pycygwin: markers 'sys_platform == "cygwin"' don't match your environment
Looking in links: file:///home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels
Collecting sage-conf==9.3.rc0 (from -r requirements.txt (line 12))
  Url 'file:///home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels' is ignored: it is neither a file nor a directory.
  Could not find a version that satisfies the requirement sage-conf==9.3.rc0 (from -r requirements.txt (line 12)) (from versions: )
No matching distribution found for sage-conf==9.3.rc0 (from -r requirements.txt (line 12))
ERROR: could not install deps [-rrequirements.txt]; v = InvocationError("'/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt'", 1)
python-sagewheels-nopypi finish: getenv after 2.13 seconds
_________________________________________________________________________________________________________ summary __________________________________________________________________________________________________________
ERROR:   python-sagewheels-nopypi: could not install deps [-rrequirements.txt]; v = InvocationError("'/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt'", 1)
cleanup /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip
```



---

Comment by dimpase created at 2021-03-24 11:24:53

maybe I missed some prelim stages, I have no idea.


---

Comment by mkoeppe created at 2021-03-24 15:42:32

I have extended the instructions in the ticket description: You need to configure and build the Sage distribution before running the tox commands shown.


---

Comment by dimpase created at 2021-03-24 18:56:30

another issue is logging. I have no idea where logs of this all go, in particular I noticed an error due to no space left on device, even though it should all be fine (unless there is an excessive use of ~/.sage, or /tmp)

but worst of all I can't find a log with this info, it was printed in terminal...


---

Comment by mkoeppe created at 2021-03-24 18:57:55

(wrong ticket)


---

Comment by mkoeppe created at 2021-03-24 18:59:21

You will find the logs in `build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi`


---

Comment by dimpase created at 2021-03-24 19:32:35


```
Processing /home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels/nbformat-5.0.7-py3-none-any.whl
Processing /home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels/widgetsnbextension-3.5.1-py2.py3-none-any.whl
INFO: pip is looking at multiple versions of ipython to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of ipykernel to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of gmpy2 to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of fpylll to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of <Python from Requires-Python> to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of cython to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of cysignals to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of cypari2 to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of cvxopt to determine which version is compatible with other requirements. This could take a while.
ERROR: Could not find a version that satisfies the requirement jupyterlab-widgets>=1.0.0; python_version >= "3.6" (from ipywidgets)
ERROR: No matching distribution found for jupyterlab-widgets>=1.0.0; python_version >= "3.6"
ERROR: invocation failed (exit code 1)
ERROR: could not install deps [-rrequirements.txt]; v = InvocationError('/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt', 1)
python-sagewheels-nopypi finish: getenv /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi after 1.87 seconds
______________________________________________________________ summary ______________________________________________________________
ERROR:   python-sagewheels-nopypi: could not install deps [-rrequirements.txt]; v = InvocationError('/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt', 1)
cleanup /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip
```


no idea about that `jupyterlab-widgets`, we don't even seem to have such a package in Sage.

PS. `./sage --pip install jupyterlab-widgets` didn't fix it.


---

Comment by mkoeppe created at 2021-03-24 19:39:16

We do have the SPKG`jupyterlab_widgets`. Running `make jupyterlab_widgets` will fix the problem.


---

Comment by git created at 2021-03-24 20:01:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-24 20:03:39

Or try with this fix (which makes no change to how we install things in the Sage distribution, but removes excessive dependencies from the wheels)


---

Comment by mkoeppe created at 2021-03-24 20:06:30

(Newer versions of `jupyterlab-widgets` have more disciplined dependencies via use of `jupyter_packaging`; after an upgrade in the Sage 9.4 series we will be able to make `jupyterlab-widgets` a standard package and drop the patch to `ipywidgets` again.)


---

Comment by dimpase created at 2021-03-24 20:42:17

ohh, nodejs getting installed as a sage package?!


---

Comment by dimpase created at 2021-03-24 20:53:54

Replying to [comment:141 mkoeppe]:
> We do have the SPKG`jupyterlab_widgets`. Running `make jupyterlab_widgets` will fix the problem. 

it did not. trying the latest commit now


---

Comment by dimpase created at 2021-03-24 21:47:58

the patch let it go further, but now this puzzling "no space left on device"

```
  copying sage/sets/finite_enumerated_set.py -> build/lib.linux-x86_64-3.7/sage/sets
  copying sage/sets/set.py -> build/lib.linux-x86_64-3.7/sage/sets
  error: could not write to 'build/lib.linux-x86_64-3.7/sage/sets/set.py': No space left on device
  Building wheel for sagemath-standard (PEP 517) ... error
  ERROR: Failed building wheel for sagemath-standard
Failed to build sagemath-standard
ERROR: Could not build wheels for sagemath-standard which use PEP 517 and cannot be installed directly
Exception information:
Traceback (most recent call last):
  File "/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/cli/base_command.py", line 189, in _main
    status = self.run(options, args)
  File "/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/cli/req_command.py", line 178, in wrapper
    return func(self, options, args)
  File "/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/commands/install.py", line 361, in run
    ", ".join(pep517_build_failure_names)
pip._internal.exceptions.InstallationError: Could not build wheels for sagemath-standard which use PEP 517 and cannot be installed directly
Removed build tracker: '/tmp/pip-req-tracker-rj13d2c8'
ERROR: invocation failed (exit code 1)
python-sagewheels-nopypi finish: installpkg /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip after 308.24 seconds
```


I really don't get is, there is almost 300Gb left on /home/scratch2/
Maybe it tries to copy stuff via some silly place like /tmp or /var or ~/.sage/, and the error comes from this? No idea.
----
New commits:


---

Comment by mkoeppe created at 2021-03-24 22:17:43

pip likes to use temporary directories, probably in /tmp or /var/tmp


---

Comment by mkoeppe created at 2021-03-24 22:18:32

Try setting `TMPDIR` to something elese


---

Comment by dimpase created at 2021-03-24 22:32:43

is TMPDIR an env.var. I can export before running this job? Or is it something pythonic?


---

Comment by mkoeppe created at 2021-03-24 22:45:37

Just the standard environment variable


---

Comment by dimpase created at 2021-03-25 10:07:09

OK, this run finishes, with some doctest errors, mainly in sphinx/docs related:

```
$ ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'
...
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/all.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/misc/package.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/misc/sagedoc.py  # 4 doctests failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/docs/conf.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/interfaces/gap.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_setup/find.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/__init__.py  # 35 doctests failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/sphinxbuild.py  # 13 doctests failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/utils.py  # 5 doctests failed
```


if this is expected, feel free to make it positive review.


---

Comment by mkoeppe created at 2021-03-25 16:11:46

Thanks for testing! Yes, this looks as expected. The documentation is not built by this invocation. We should disable the corresponding doctests, for example using #30778 - but that's something for the 9.4 series.


---

Comment by mkoeppe created at 2021-03-25 16:11:46

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-03-29 23:54:39

Setting priority to blocker to bring this ticket to the attention of the release bot.


---

Comment by mkoeppe created at 2021-03-29 23:54:39

Changing priority from critical to blocker.


---

Comment by mkoeppe created at 2021-04-10 18:50:12

Changing priority from blocker to critical.


---

Comment by vbraun created at 2021-05-27 20:30:52

Resolution: fixed
