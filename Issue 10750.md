# Issue 10750: Subscheme creation does not work from the notebook

Issue created by migration from https://trac.sagemath.org/ticket/10816

Original creator: novoselt

Original creation time: 2011-02-21 19:16:19

Assignee: AlexGhitza

CC:  vbraun jdemeyer

There is the following example in the documentation in `schemes\generic\projective_space.py`:

```
sage: A.<x,y,z> = ProjectiveSpace(2, QQ)
sage: X = A.subscheme([x*z^2, y^2*z, x*y^2]); X
Closed subscheme of Projective Space of dimension 2 over Rational Field defined by:
  x*z^2,
  y^2*z,
  x*y^2
```

The file passes tests fine in sage-4.6.2.rc0, I can also do it from the command line. But if I try to do it in the notebook, I get

```
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "_sage_input_4.py", line 10, in <module>
    exec compile(u'open("___code___.py","w").write("# -*- coding: utf-8 -*-\\n" + _support_.preparse_worksheet_cell(base64.b64decode("QS48eCx5LHo+ID0gUHJvamVjdGl2ZVNwYWNlKDIsIFFRKQpYID0gQS5zdWJzY2hlbWUoW3gqel4yLCB5XjIqeiwgeCp5XjJdKTsgWA=="),globals())+"\\n"); execfile(os.path.abspath("___code___.py"))
  File "", line 1, in <module>
    
  File "/tmp/tmpgPYl3N/___code___.py", line 4, in <module>
    exec compile(u'X = A.subscheme([x*z**_sage_const_2 , y**_sage_const_2 *z, x*y**_sage_const_2 ]); X
  File "", line 1, in <module>
    
  File "/home/novoselt/sage/local/lib/python2.6/site-packages/sage/schemes/generic/projective_space.py", line 501, in subscheme
    return algebraic_scheme.AlgebraicScheme_subscheme_projective(self, X)
AttributeError: 'module' object has no attribute 'AlgebraicScheme_subscheme_projective'
```

which I don't understand.

Everything is good in the notebook in sage-4.6, so it should been broken recently, perhaps by #10525, although I can't imagine how.


---

Comment by vbraun created at 2011-02-21 20:35:31

I think the problem is a circular import `projective_space` <-> `algebraic_scheme`


---

Comment by novoselt created at 2011-02-21 20:45:15

Maybe, but I don't see what is wrong with those imports.

What bugs me most is that it works from the command line, but not in the notebook, so there is probably a bug in the notebook, but I have no idea how to trace it.


---

Comment by vbraun created at 2011-02-22 10:46:25

Initial patch


---

Attachment

Removing the circular import fixes this for me. The bug was probably introduced in #10525, so it would be nice if we could push the patch into Sage-4.6.2. Its really uncontroversial.


---

Comment by vbraun created at 2011-02-22 10:49:25

Changing status from new to needs_review.


---

Comment by novoselt created at 2011-02-22 15:34:07

The patch looks fine, but what about other spaces, I suppose they have the same problem?

The main issue is that this error could not be detected automatically and you cannot demonstrate in a doctest that this patch has solved the problem. Who knows how many of the other doctests in Sage would fail in the notebook?.. Checking for circular imports by hands is very tedious and perhaps even impossible, so these issues must be caught during tests.


---

Comment by vbraun created at 2011-02-22 16:13:36

Can we first fix this bug before we embark on a discussion on how to extend the doctesting framework?

I think pylint and similar tools can already check for circular imports. Although bad style, I think the circular import here was actually ok. So there might be a bug in the worksheet. Since that is being rewritten right now, I don't think its useful to spend  much time tracking down the underlying issue.


---

Comment by jdemeyer created at 2011-02-22 16:21:42

Replying to [comment:3 vbraun]:
> Removing the circular import fixes this for me. The bug was probably introduced in #10525, so it would be nice if we could push the patch into Sage-4.6.2. Its really uncontroversial.

Agreed.


---

Comment by jdemeyer created at 2011-02-23 08:35:41

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-02-25 08:07:01

Resolution: fixed
