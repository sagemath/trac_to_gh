# Issue 15417: Extremely slow PARI discriminants

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2014-01-09 14:03:17

CC:  pbruin

This is weird and bad:

```
sage: x = polygen(ZpFM(3,10))
sage: p = ((x-1)^50 + x)._pari_init_()
sage: %time pari(p).poldisc()
CPU times: user 59.20 s, sys: 0.01 s, total: 59.21 s
Wall time: 59.35 s
2*3 + 3^4 + 2*3^6 + 3^7 + 2*3^8 + 2*3^9 + O(3^10)
sage: %time gp(p).poldisc()
CPU times: user 0.00 s, sys: 0.01 s, total: 0.01 s
Wall time: 0.16 s
2*3 + 3^4 + 2*3^6 + 3^7 + 2*3^8 + 2*3^9 + O(3^10)
```


The problem isn't PARI itself (given the speed of `gp`), it's somehow the PARI interface in Sage.


---

Comment by jdemeyer created at 2014-01-09 16:06:01

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-01-09 16:06:01

New commits:


---

Comment by jdemeyer created at 2014-01-09 16:07:02

This solution works well for Sage, maybe not for PARI/GP upstream.


---

Comment by roed created at 2014-01-10 00:01:54

I'm fine with this change.  I'm not yet familiar with reviewing SPKG changes using the new directory layout.  Why is SPKG.txt deleted in this commit?

More generally, are there other places in Sage where we should be more aggressive about increasing the Pari stack size?  If someone is using Pari nontrivially, our current stack size seems too small.  Should we increase the stack whenever a user does certain operations signaling that they're going to be using Pari extensively (e.g. create a number field of degree larger than 4, take the discriminant of a polynomial of large degree...)?


---

Comment by jdemeyer created at 2014-01-10 06:48:52

Replying to [comment:9 roed]:
> I'm fine with this change.  I'm not yet familiar with reviewing SPKG changes using the new directory layout.  Why is SPKG.txt deleted in this commit?
Not all of `SPKG.txt`, just the changelog.


---

Comment by jdemeyer created at 2014-01-10 08:56:31

Replying to [comment:9 roed]:
> More generally, are there other places in Sage where we should be more aggressive about increasing the Pari stack size?  If someone is using Pari nontrivially, our current stack size seems too small.  Should we increase the stack whenever a user does certain operations signaling that they're going to be using Pari extensively (e.g. create a number field of degree larger than 4, take the discriminant of a polynomial of large degree...)?
We could _detect_ the problem by adding some code to `gerepile...()` to count the number of garbage collections. We could for example give a warning if more than N happen per second (for a suitable value of N).


---

Comment by jdemeyer created at 2014-01-10 09:55:47

See #15659.


---

Comment by jdemeyer created at 2014-01-10 10:13:57

Replying to [comment:9 roed]:
> More generally, are there other places in Sage where we should be more aggressive about increasing the Pari stack size?
Yes, see #15660.


---

Comment by roed created at 2014-01-10 10:44:40

Cool.  I'm doctesting this ticket and will then give it a positive review.


---

Comment by roed created at 2014-01-12 00:09:38

Changing status from needs_review to positive_review.


---

Comment by roed created at 2014-01-12 00:09:38

Looks good.


---

Comment by vbraun created at 2014-01-13 16:31:34

Ok, this is not "critical"


---

Comment by vbraun created at 2014-01-13 16:31:34

Changing priority from critical to major.


---

Comment by vbraun created at 2014-02-02 16:57:19

Resolution: fixed
