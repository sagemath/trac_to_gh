# Issue 16918: add "sage -installed" and "sage -pip" commands

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2014-10-15 00:31:12

CC:  tmonteil

Add two commands to sage:
 - `sage -installed` to get the list of installed packages
 - `sage -pip` to run the Python package manager


---

Comment by vdelecroix created at 2014-10-15 00:35:36

New commits:


---

Comment by vdelecroix created at 2014-10-15 00:35:36

Changing status from new to needs_review.


---

Comment by kcrisman created at 2014-10-15 02:21:04

Huh - and the pip would be quite useful.    But even in the chunk you show, 

```
if [ "$1" = '-i' ]; then
     shift
     # If there are no further arguments, simply list all installed
```

This should even be documented somewhere, but maybe it hasn't been advertised well lately?  Not that it would be horrible to add this alias, though I don't know if some syntax warriors will complain because you allow `-installed` while `--installed` is the current vogue...


---

Comment by vdelecroix created at 2014-10-15 11:45:07

Hello,

Thanks for having a look.

I do not complain that `sage -i` has not been advertised. But I do that it is documented nowhere (neither in `src/bin/sage` nor in `src/bin/sage-pkg`)!

Currently we have the options `-optional`, `-standard` and `-experimental`. I am just adding an additional `-installed`. We can be smarter and more coherent by allowing multiple arguments and force to use the `-i` option like in

```
    $ sage -i --installed --optional --standard
    ... would list all installed package that are either ...
    ... optional or standard                             ...
    $ sage -i --not-installed
    ... would list all non installed packages ...
```

I am in favour of a more coherent scheme of options, but then we should forbid the older syntax (and instead write a deprecation message that explains the new syntax).

And I definitely do not understand why we do have two scripts (`src/bin/sage-spkg` and `src/bin/sage-list-packages`) for dealing with packages. Morever the current state is that `sage-spkg` is used to list the installed packages while `sage-list-packages` is the one to list the optional packages...

EDIT: and I just noticed that the `sage -i` starts with a useless line 'Currently installed packages:'. It is especially bad if you want to use it in other scripts.

Vincent


---

Comment by kcrisman created at 2014-10-15 12:53:12

> And I definitely do not understand why we do have two scripts
Alas, I can only point things out when it comes to these scripts - I am reluctant to tread on such long-standing traditions.  I do hope some others come to look at this, though, since at the very least it is not bad to add `-installed`.


---

Comment by jdemeyer created at 2014-10-16 10:31:36

Use spaces, not TABs for indentation.

Instead of `[ ! $(sage -installed | grep -c '^pip-') -eq 1 ]`,
I would go with `[ -x "$SAGE_LOCAL/bin/pip" ]`

And why not replace `echo "Pip is not installed. Run \"sage -i pip\" to install it."` by `sage -i pip || exit $?`?


---

Comment by jdemeyer created at 2014-10-16 10:31:36

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-10-17 15:05:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-10-17 15:05:49

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2014-10-17 15:06:31

Replying to [comment:5 jdemeyer]:
> Use spaces, not TABs for indentation.
> 
> Instead of `[ ! $(sage -installed | grep -c '^pip-') -eq 1 ]`,
> I would go with `[ -x "$SAGE_LOCAL/bin/pip" ]`

done. It is much simpler, thanks.
 
> And why not replace `echo "Pip is not installed. Run \"sage -i pip\" to install it."` by `sage -i pip || exit $?`?

I do not like to do things in a script that users did not ask for.

Vincent


---

Comment by git created at 2014-10-17 15:08:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2014-10-17 15:13:35

If you deprecate something, it should still work (i.e. don't remove the old code, just add the `echo` statements).

Also, please use `echo >&2` for these warnings.


---

Comment by jdemeyer created at 2014-10-17 15:13:35

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2014-10-17 15:14:44

In `--help`, you write `-installed` while only `--installed` works. I think you should stick to the de facto convention that both single and double dashes should work.


---

Comment by git created at 2014-10-17 15:23:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-10-17 15:24:16

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-10-21 07:45:09

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2014-10-21 07:45:09

In `sage-list-packages`:
* `"standard` -> `"standard"`
* `except A, B` -> `except A as B`
* The `except` clause should abort the program otherwise one gets

```
Traceback (most recent call last):
  File "/usr/local/src/sage-config/src/bin/sage-list-packages", line 80, in <module>
    available_version = dict([ split_pkgname(pkg) for pkg in get_remote_package_list(category)])
TypeError: 'int' object is not iterable
```



---

Comment by git created at 2014-10-21 10:36:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-10-21 10:37:17

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2014-10-21 10:37:17

Thanks for your comments. I did all the modifications in my last commit.


---

Comment by vdelecroix created at 2014-10-29 13:37:57

ping!


---

Comment by jdemeyer created at 2014-10-30 11:24:40

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2014-10-30 12:17:58

Thanks.


---

Comment by vbraun created at 2014-10-30 22:28:36

Resolution: fixed
