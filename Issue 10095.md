# Issue 10095: sha().an() assumes E is minimal.

archive/issues_010095.json:
```json
{
    "body": "Assignee: @JohnCremona\n\nCC:  @williamstein @rlmill @categorie\n\nKeywords: elliptic curves, sha, real period\n\nI noticed the following problem with sha().an()\n\n\n```\nsage: E=EllipticCurve([1215*1216,0]) # non-minimal model\nsage: E.sha().an()\n6.00000000000000\nsage: E.minimal_model().sha().an()\n1.00000000000000\n```\n\n\nIt looks like sha().an() assumes that E is minimal. The extra factor of 6 seems to be coming from the real period.\n\n\n```\nsage: E.period_lattice().omega()\n0.106360349280819\nsage: E.minimal_model().period_lattice().omega()\n0.638162095684913\n```\n\n\nIt's probably unfair to call this a bug, but it could definitely lead people astray.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10096\n\n",
    "created_at": "2010-10-07T20:42:47Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6.1",
    "title": "sha().an() assumes E is minimal.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10095",
    "user": "https://trac.sagemath.org/admin/accounts/users/weigandt"
}
```
Assignee: @JohnCremona

CC:  @williamstein @rlmill @categorie

Keywords: elliptic curves, sha, real period

I noticed the following problem with sha().an()


```
sage: E=EllipticCurve([1215*1216,0]) # non-minimal model
sage: E.sha().an()
6.00000000000000
sage: E.minimal_model().sha().an()
1.00000000000000
```


It looks like sha().an() assumes that E is minimal. The extra factor of 6 seems to be coming from the real period.


```
sage: E.period_lattice().omega()
0.106360349280819
sage: E.minimal_model().period_lattice().omega()
0.638162095684913
```


It's probably unfair to call this a bug, but it could definitely lead people astray.

Issue created by migration from https://trac.sagemath.org/ticket/10096





---

archive/issue_comments_101695.json:
```json
{
    "body": "I found the problem here.  an() uses the minimal model when it can do the job itself, which is when the rank is at most 1, but when the rank is at least 2 it passes the work to an_numerical(), and that did not use the minimal model.\n\nI am preparing a patch which fixes this.  And as I suspect that other related functions also need the minimal model (notably the p-adic one) I am now caching the minimal model and changing lots of occurrences of self.E to self.Emin.\n\nWatch this space...",
    "created_at": "2010-10-28T09:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10095#issuecomment-101695",
    "user": "https://github.com/JohnCremona"
}
```

I found the problem here.  an() uses the minimal model when it can do the job itself, which is when the rank is at most 1, but when the rank is at least 2 it passes the work to an_numerical(), and that did not use the minimal model.

I am preparing a patch which fixes this.  And as I suspect that other related functions also need the minimal model (notably the p-adic one) I am now caching the minimal model and changing lots of occurrences of self.E to self.Emin.

Watch this space...



---

archive/issue_comments_101696.json:
```json
{
    "body": "Applies to 4.6.rc0",
    "created_at": "2010-10-28T09:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10095#issuecomment-101696",
    "user": "https://github.com/JohnCremona"
}
```

Applies to 4.6.rc0



---

archive/issue_comments_101697.json:
```json
{
    "body": "Attachment [trac_10096-sha.patch](tarball://root/attachments/some-uuid/ticket10096/trac_10096-sha.patch) by @JohnCremona created at 2010-10-28 09:37:09\n\nThe patch fixes this.  the minimal model is computed on construction and used in place of the original (when the latter is not minimal).  New doctests show that the reported problem has gone away.\n\nIt would be helpful if someone could confirm that this is the correct thing to do also for the an_padic() function.  The doctests still pass, but I sust[ect that they are all with minimal curves anyway.  I was assuming (a) that the value of an_padic() was isomorphism-invariant, and (2) that using a minimal model would be at least as fast, possibly faster, than using a non-minimal model, even if both give the correct answer!",
    "created_at": "2010-10-28T09:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10095#issuecomment-101697",
    "user": "https://github.com/JohnCremona"
}
```

Attachment [trac_10096-sha.patch](tarball://root/attachments/some-uuid/ticket10096/trac_10096-sha.patch) by @JohnCremona created at 2010-10-28 09:37:09

The patch fixes this.  the minimal model is computed on construction and used in place of the original (when the latter is not minimal).  New doctests show that the reported problem has gone away.

It would be helpful if someone could confirm that this is the correct thing to do also for the an_padic() function.  The doctests still pass, but I sust[ect that they are all with minimal curves anyway.  I was assuming (a) that the value of an_padic() was isomorphism-invariant, and (2) that using a minimal model would be at least as fast, possibly faster, than using a non-minimal model, even if both give the correct answer!



---

archive/issue_comments_101698.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-10-28T09:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10095#issuecomment-101698",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_101699.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-11-03T06:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10095#issuecomment-101699",
    "user": "https://github.com/adeines"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_101700.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-11-10T22:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10095",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10095#issuecomment-101700",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
