# Issue 18587: Add MultiPolynomialIdeal.groebner_basis("libgiac")

Issue created by migration from Trac.

Original creator: malb

Original creation time: 2015-06-30 08:18:27

CC:  frederichan

Giac is an optional package and supports fast computation of Gröbner bases. Let's make that easily accessible.


---

Comment by frederichan created at 2015-06-30 08:56:40

Thank you.
NB: Currently giacpy is just an optional spkg not a sage library so there is no sage.lib.giac

I don't know if there is a suitable place on sage git to expand  the so called upstream spkg, I would be happy to put it in public so that sage developper could also modify it.


---

Comment by malb created at 2015-06-30 11:02:06

giacpy being optional is no problem. I'd suggest to add `sage.libs.libgiac` which imports the right stuff from giacpy and raises an error if that fails, e.g.


```python
def groebner_basis_libgiac(gens, epsilon=0, prot=False, <other args>):
   from giacpy import libgiac
   F = libgiac(gens)
   giacsettings.proba_epsilon=epsilon
   # get ring from gens, check term order etc.
   B = F.gbasis([P.gens()],'revlex') 
   # convert result to PolynomialSequence and return
```



---

Comment by frederichan created at 2015-06-30 11:36:05

Sorry  I am struggling with git (I am failing to create a branch), could you please start a branch with your function so that I can pull?

NB: you need to import giacsettings also.


---

Comment by frederichan created at 2015-06-30 12:33:23

ouf! this time I have succeed to push a trivial thing. I can start to work
----
New commits:


---

Comment by git created at 2015-06-30 13:43:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by malb created at 2015-06-30 13:44:17

I added a proof of concept implementation


---

Comment by git created at 2015-06-30 17:52:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2015-07-01 06:00:07

I have noticed that with giac1.2.0-13 (spkg version) it may happen that the giac answer contains a 0 term, but it is fixed in giac1.2.0-15. May be updating the spkg is the best solution?


---

Comment by git created at 2015-07-01 09:11:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by malb created at 2015-07-01 09:16:48

I cleaned it up a bit more. It still needs tests, documentation and a way to shut Giac up. Also, does Giac have an option to print a protocol of the GB computation (most systems do).

Finally, we get this doctest failure:


```
File "src/sage/libs/giac.py", line 19, in sage.libs.giac
Failed example:
    sig_on_count()
Expected:
    0
Got:
    1
```


which suggests there's a bug somewhere.


---

Comment by malb created at 2015-07-01 09:16:58

Updating Giac should be a separate ticket.


---

Comment by frederichan created at 2015-07-01 10:29:38

Thank you.
I am still working on this. I found a way for the info level.


---

Comment by frederichan created at 2015-07-02 07:52:37

The sig_count pb is from giacpy 0.4.8 Pygen `__iter__`, it could/should? be fixed in a separate trac?
we can avoid it with: 
` return PolynomialSequence(P, tuple(gb_giac), immutable=True)`
instead of just gb_giac. I don't remark time loss with tuple, should we adopt this?

is there a way to substitute efficiently variables in PolynomialRing (ex: 'i' will give use troubles in giac) if not I will just add some protection with an error message


---

Comment by frederichan created at 2015-07-02 08:06:10

sorry I wanted to say: I don't remark time loss with tuple. (so I have edited my comment:14)


---

Comment by malb created at 2015-07-02 08:06:33

Replying to [comment:14 frederichan]:
> The sig_count pb is from giacpy 0.4.8 Pygen `__iter__`, it could/should? be fixed in a separate trac?

yes, this should be a separate ticket but this ticket IMHO should depend on that ticket. That is, this ticket should wait until the fix is in.

> we can avoid it with: 
> ` return PolynomialSequence(P, tuple(gb_giac), immutable=True)`
> instead of just gb_giac. I remark time loss with tuple, should we adopt this?

You mean instead of `PolynomialSequence(gb_giac, P, immutable=True)`? I don't think we should work around a bug which should be fixed instead.


> is there a way to substitute efficiently variables in PolynomialRing (ex: 'i' will give use troubles in giac) if not I will just add some protection with an error message

You can try but it's not very fast:


```python
sage: P.<a,b,c,i> = QQ[]
sage: R.<x,y,z,w> = QQ[]
sage: f = P.random_element()
sage: R(f)
-2*y^2 - 1/4*y*z + 6*z*w - 2*z - 59/5
sage: %timeit R(f)
10000 loops, best of 3: 77.3 µs per loop
```


Maybe check `P.gens_dict().keys()` for problematic names and only switch over if there is a problem?


---

Comment by git created at 2015-07-04 09:40:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2015-07-04 10:16:14

giac gbasis have also a rur option to obtain a Rational Univariate Representation of a 0 dimensional ideal. Are you also interested by a more convient interface to this or should we leave it for later?


---

Comment by git created at 2015-07-04 19:35:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by malb created at 2015-07-05 13:56:55

I'm a one-feature-per-ticket kind of guy, so I'd put that rur enhancement in a separate ticket.


---

Comment by git created at 2015-07-08 10:29:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-08 11:33:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-08 12:07:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2015-07-08 13:31:33

Dear martin, thank you for the modifs.
About the doctests I don't trust even the first 2 characters: `//` of the message `// Giac ...`
I have not yet tested this giac spkg  1.2.0-19 on os X to see but last time I got pbs with the begining of this message on OSX versus linux. so I think that in a doctest it is safer to do it in 2 steps:
`sage: gb = J.groebner_basis('giac') # optional - giacpy, random`
`sage: gb # optional - giacpy`


---

Comment by git created at 2015-07-08 13:54:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by malb created at 2015-07-08 14:51:10

I guess this ticket is done then (?)


---

Comment by git created at 2015-07-08 16:52:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2015-07-08 16:57:03

may be I should also add some doc in multi_polynomial_ideal.py or pointer to the 
sage.libs.giac.groebner_basis doc


---

Comment by git created at 2015-07-09 10:40:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by malb created at 2015-07-09 11:02:40

Perhaps

```
sage: I9.groebner_basis("giac",proba_epsilon=1e-7) # optional - giacpy
```

should be tagged `long`?


---

Comment by frederichan created at 2015-07-09 11:12:35

On a 2012 (2core i5-2435M CPU `@` 2.40GHz) notebook with 4Go of RAM:


```
sage: A9=PolynomialRing(QQ,9,'x') # optional - giacpy
sage: I9=sage.rings.ideal.Katsura(A9) # optional - giacpy
sage: time I9.groebner_basis("giac",proba_epsilon=1e-7) # optional - giacpy
// Giac share root-directory:/home/fred/dev/sage/develop/sage.run/local/share/giac/
// Unable to find keyword file /home/fred/dev/sage/develop/sage.run/local/share/giac/doc/fr/keywords
// Giac share root-directory:/home/fred/dev/sage/develop/sage.run/local/share/giac/
Help file /home/fred/dev/sage/develop/sage.run/local/share/giac/doc/fr/aide_cas not found
Added 0 synonyms
Running a probabilistic check for the reconstructed Groebner basis. If successfull, error probability is less than 1e-07 and is estimated to be less than 10^-133. Use proba_epsilon:=0 to certify (this takes more time).
CPU times: user 3.29 s, sys: 19.9 ms, total: 3.31 s
Wall time: 3.23 s
Polynomial Sequence with 143 Polynomials in 9 Variables
```



---

Comment by malb created at 2015-07-09 11:22:15

Three seconds is long by sage doctest standards. We're running thousands of doctests.


---

Comment by frederichan created at 2015-07-09 12:31:40

OK so some others in giac.py need it also. I see that sometime there is an indication of the time. would 
# optional giacpy, long time (3s on a 2012 notebook)

be OK or is it too long.


---

Comment by malb created at 2015-07-09 12:35:41

It's fine but not mandatory to add this (I'd say)


---

Comment by git created at 2015-07-09 13:24:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2015-07-10 12:48:53

to change I have tried it on OSX(10.7) with #18841 and got no problems.


---

Comment by malb created at 2015-07-13 07:10:34

Changing status from new to needs_review.


---

Comment by git created at 2015-08-05 09:33:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2015-08-05 17:26:47

Changing status from needs_review to needs_work.


---

Comment by frederichan created at 2015-08-05 17:26:47

The zero ideal gives a segfault


---

Comment by git created at 2015-08-05 17:46:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2015-08-05 19:30:29

Changing status from needs_work to needs_review.


---

Comment by malb created at 2015-08-17 17:35:54

I think this ticket is done, i.e. I'm positively reviewing your contributions. If you review mine and agree with them, we can set this to positive review.


---

Comment by frederichan created at 2015-08-18 13:17:01

OK, I thought we had to wait for a third person. I will look if I can reproduce this doctest error:
[http://patchbot.sagemath.org/log/18824/Ubuntu/14.04/x86_64/3.13.0-61-generic/librae/2015-08-17%2014:47:28%20+0000?short](http://patchbot.sagemath.org/log/18824/Ubuntu/14.04/x86_64/3.13.0-61-generic/librae/2015-08-17%2014:47:28%20+0000?short)
do you think it could be related to this patch?


---

Comment by frederichan created at 2015-08-19 08:06:26

I am positively reviewing your changes.

I was not able to reproduce the previous  patchbot doctest error with sage 6.9.beta2.


---

Comment by malb created at 2015-08-19 09:14:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-08-21 01:56:21

Resolution: fixed
