# Issue 24449: Integration of complex piecewise analytic functions using arb

archive/issues_024449.json:
```json
{
    "body": "CC:  fredrik.johansson vdelecroix cheuberg\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24686\n\n",
    "created_at": "2018-02-07T16:58:07Z",
    "labels": [
        "numerical",
        "major",
        "enhancement"
    ],
    "title": "Integration of complex piecewise analytic functions using arb",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24449",
    "user": "mmezzarobba"
}
```
CC:  fredrik.johansson vdelecroix cheuberg



Issue created by migration from https://trac.sagemath.org/ticket/24686





---

archive/issue_comments_342922.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-02-07T17:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342922",
    "user": "mmezzarobba"
}
```

New commits:



---

archive/issue_comments_342923.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-07T17:20:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342923",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342924.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-07T17:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342924",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342925.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T07:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342925",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342926.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-08T08:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342926",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342927.json:
```json
{
    "body": "Sorry, I wrongly included a commit from another ticket... cleaner now!",
    "created_at": "2018-02-08T08:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342927",
    "user": "vdelecroix"
}
```

Sorry, I wrongly included a commit from another ticket... cleaner now!



---

archive/issue_comments_342928.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2018-02-08T10:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342928",
    "user": "vdelecroix"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_342929.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T16:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342929",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342930.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T16:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342930",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342931.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-08T17:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342931",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342932.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-09T17:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342932",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342933.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-09T17:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342933",
    "user": "mmezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_342934.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-09T17:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342934",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342935.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-02-09T17:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342935",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_342936.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-09T21:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342936",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342937.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-09T23:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342937",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342938.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-10T12:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342938",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-12T09:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342940.json:
```json
{
    "body": "I am not sure it is wise to have all of\n\n```\n    cdef IntegrationContext ctx = <IntegrationContext>param\n    if ctx.exn_type is not None or order >= 2:\n        acb_indeterminate(out)\n        return 0\n    cdef ComplexBall x = ComplexBall.__new__(ComplexBall)\n    assert prec == ctx.parent._prec\n```\n\ninside `sig_on`/`sig_off`.",
    "created_at": "2018-02-13T19:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342940",
    "user": "vdelecroix"
}
```

I am not sure it is wise to have all of

```
    cdef IntegrationContext ctx = <IntegrationContext>param
    if ctx.exn_type is not None or order >= 2:
        acb_indeterminate(out)
        return 0
    cdef ComplexBall x = ComplexBall.__new__(ComplexBall)
    assert prec == ctx.parent._prec
```

inside `sig_on`/`sig_off`.



---

archive/issue_comments_342941.json:
```json
{
    "body": "What is the point of\n\n```\n        if isinstance(a, (RealBall, ComplexBall)):\n            ca = <ComplexBall> self(a)\n        else:\n            ca = <ComplexBall> self.coerce(a)\n```\n\ninstead of the direct `<ComplexBall> self.coerce(a)`?",
    "created_at": "2018-02-13T19:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342941",
    "user": "vdelecroix"
}
```

What is the point of

```
        if isinstance(a, (RealBall, ComplexBall)):
            ca = <ComplexBall> self(a)
        else:
            ca = <ComplexBall> self.coerce(a)
```

instead of the direct `<ComplexBall> self.coerce(a)`?



---

archive/issue_comments_342942.json:
```json
{
    "body": "Replying to [comment:21 vdelecroix]:\n> I am not sure it is wise to have all of\n> {{{\n>     cdef IntegrationContext ctx = <IntegrationContext>param\n>     if ctx.exn_type is not None or order >= 2:\n>         acb_indeterminate(out)\n>         return 0\n>     cdef ComplexBall x = ComplexBall.__new__(ComplexBall)\n>     assert prec == ctx.parent._prec\n> }}}\n> inside `sig_on`/`sig_off`.\n\nI guess you are right, the `__new__` probably shouldn't be inside, thanks!",
    "created_at": "2018-02-14T08:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342942",
    "user": "mmezzarobba"
}
```

Replying to [comment:21 vdelecroix]:
> I am not sure it is wise to have all of
> {{{
>     cdef IntegrationContext ctx = <IntegrationContext>param
>     if ctx.exn_type is not None or order >= 2:
>         acb_indeterminate(out)
>         return 0
>     cdef ComplexBall x = ComplexBall.__new__(ComplexBall)
>     assert prec == ctx.parent._prec
> }}}
> inside `sig_on`/`sig_off`.

I guess you are right, the `__new__` probably shouldn't be inside, thanks!



---

archive/issue_comments_342943.json:
```json
{
    "body": "Replying to [comment:22 vdelecroix]:\n> What is the point of\n> {{{\n>         if isinstance(a, (RealBall, ComplexBall)):\n>             ca = <ComplexBall> self(a)\n>         else:\n>             ca = <ComplexBall> self.coerce(a)\n> }}}\n> instead of the direct `<ComplexBall> self.coerce(a)`?\n\nIt accepts balls of lower precision.",
    "created_at": "2018-02-14T08:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342943",
    "user": "mmezzarobba"
}
```

Replying to [comment:22 vdelecroix]:
> What is the point of
> {{{
>         if isinstance(a, (RealBall, ComplexBall)):
>             ca = <ComplexBall> self(a)
>         else:
>             ca = <ComplexBall> self.coerce(a)
> }}}
> instead of the direct `<ComplexBall> self.coerce(a)`?

It accepts balls of lower precision.



---

archive/issue_comments_342944.json:
```json
{
    "body": "Replying to [comment:24 mmezzarobba]:\n> Replying to [comment:22 vdelecroix]:\n> > What is the point of\n> > {{{\n> >         if isinstance(a, (RealBall, ComplexBall)):\n> >             ca = <ComplexBall> self(a)\n> >         else:\n> >             ca = <ComplexBall> self.coerce(a)\n> > }}}\n> > instead of the direct `<ComplexBall> self.coerce(a)`?\n> \n> It accepts balls of lower precision.\n\nDo we want this? What is guaranteed by the conversion `self(a)` when `a` is a ball in lower precision?",
    "created_at": "2018-02-14T11:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342944",
    "user": "vdelecroix"
}
```

Replying to [comment:24 mmezzarobba]:
> Replying to [comment:22 vdelecroix]:
> > What is the point of
> > {{{
> >         if isinstance(a, (RealBall, ComplexBall)):
> >             ca = <ComplexBall> self(a)
> >         else:
> >             ca = <ComplexBall> self.coerce(a)
> > }}}
> > instead of the direct `<ComplexBall> self.coerce(a)`?
> 
> It accepts balls of lower precision.

Do we want this? What is guaranteed by the conversion `self(a)` when `a` is a ball in lower precision?



---

archive/issue_comments_342945.json:
```json
{
    "body": "Replying to [comment:23 mmezzarobba]:\n> Replying to [comment:21 vdelecroix]:\n> > I am not sure it is wise to have all of\n> > {{{\n> >     cdef IntegrationContext ctx = <IntegrationContext>param\n> >     if ctx.exn_type is not None or order >= 2:\n> >         acb_indeterminate(out)\n> >         return 0\n> >     cdef ComplexBall x = ComplexBall.__new__(ComplexBall)\n> >     assert prec == ctx.parent._prec\n> > }}}\n> > inside `sig_on`/`sig_off`.\n> \n> I guess you are right, the `__new__` probably shouldn't be inside, thanks!\n\nThe cast `cdef IntegrationContext ctx = <IntegrationContext>param` and the `assert` are also concerned.",
    "created_at": "2018-02-14T11:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342945",
    "user": "vdelecroix"
}
```

Replying to [comment:23 mmezzarobba]:
> Replying to [comment:21 vdelecroix]:
> > I am not sure it is wise to have all of
> > {{{
> >     cdef IntegrationContext ctx = <IntegrationContext>param
> >     if ctx.exn_type is not None or order >= 2:
> >         acb_indeterminate(out)
> >         return 0
> >     cdef ComplexBall x = ComplexBall.__new__(ComplexBall)
> >     assert prec == ctx.parent._prec
> > }}}
> > inside `sig_on`/`sig_off`.
> 
> I guess you are right, the `__new__` probably shouldn't be inside, thanks!

The cast `cdef IntegrationContext ctx = <IntegrationContext>param` and the `assert` are also concerned.



---

archive/issue_comments_342946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-14T13:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342946",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_342947.json:
```json
{
    "body": "Replying to [comment:25 vdelecroix]:\n> Do we want this? What is guaranteed by the conversion `self(a)` when `a` is a ball in lower precision?\n\nI think we do. It stays exactly the same ball.",
    "created_at": "2018-02-14T13:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342947",
    "user": "mmezzarobba"
}
```

Replying to [comment:25 vdelecroix]:
> Do we want this? What is guaranteed by the conversion `self(a)` when `a` is a ball in lower precision?

I think we do. It stays exactly the same ball.



---

archive/issue_comments_342948.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-18T20:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342948",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_342949.json:
```json
{
    "body": "I just reread the code. I believe we did enough cross review to have a decent version!",
    "created_at": "2018-02-18T20:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342949",
    "user": "vdelecroix"
}
```

I just reread the code. I believe we did enough cross review to have a decent version!



---

archive/issue_comments_342950.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-02-20T23:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24449",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24449#issuecomment-342950",
    "user": "vbraun"
}
```

Resolution: fixed
