# Issue 30855: Merge ginac, pynac

archive/issues_030855.json:
```json
{
    "body": "CC:  @rwst @slel @kiwifb @williamstein @dimpase @kcrisman @davewittemorris @egourgoulhon @orlitzky @antonio-rojas @EmmanuelCharpentier @fchapoton\n\npynac is a fork of ginac. ginac appears to be under somewhat active development. \n\nWe should explore whether they can be merged again.\n\nSee also: \n- #30534 Repackage `pynac` as a pip-installable package\n\nIssue created by migration from https://trac.sagemath.org/ticket/31092\n\n",
    "created_at": "2020-12-21T20:07:28Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-pending",
    "title": "Merge ginac, pynac",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30855",
    "user": "@mkoeppe"
}
```
CC:  @rwst @slel @kiwifb @williamstein @dimpase @kcrisman @davewittemorris @egourgoulhon @orlitzky @antonio-rojas @EmmanuelCharpentier @fchapoton

pynac is a fork of ginac. ginac appears to be under somewhat active development. 

We should explore whether they can be merged again.

See also: 
- #30534 Repackage `pynac` as a pip-installable package

Issue created by migration from https://trac.sagemath.org/ticket/31092





---

archive/issue_comments_440964.json:
```json
{
    "body": "[Pynac](http://pynac.org) is more than [a fork of Ginac](https://github.com/pynac/pynac), though - my understanding is that nontrivial changes had to be made for it to use:\n\n> The main difference between Pynac and GiNaC is that Pynac relies on Sage to provide the operations on numerical types, while GiNaC depends on CLN for this purpose.\n\nIf that can be overcome somehow, that would be useful, of course.",
    "created_at": "2020-12-21T20:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440964",
    "user": "@kcrisman"
}
```

[Pynac](http://pynac.org) is more than [a fork of Ginac](https://github.com/pynac/pynac), though - my understanding is that nontrivial changes had to be made for it to use:

> The main difference between Pynac and GiNaC is that Pynac relies on Sage to provide the operations on numerical types, while GiNaC depends on CLN for this purpose.

If that can be overcome somehow, that would be useful, of course.



---

archive/issue_comments_440965.json:
```json
{
    "body": "Replying to [comment:1 kcrisman]:\n> [Pynac](http://pynac.org) is more than [a fork of Ginac](https://github.com/pynac/pynac), though - my understanding is that nontrivial changes had to be made for it to use:\n> \n> > The main difference between Pynac and GiNaC is that Pynac relies on Sage to provide the operations on numerical types, while GiNaC depends on CLN for this purpose.\n\nThat's right. In a merge of the projects, these differences would have to be activated by configure switches.",
    "created_at": "2020-12-23T18:35:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440965",
    "user": "@mkoeppe"
}
```

Replying to [comment:1 kcrisman]:
> [Pynac](http://pynac.org) is more than [a fork of Ginac](https://github.com/pynac/pynac), though - my understanding is that nontrivial changes had to be made for it to use:
> 
> > The main difference between Pynac and GiNaC is that Pynac relies on Sage to provide the operations on numerical types, while GiNaC depends on CLN for this purpose.

That's right. In a merge of the projects, these differences would have to be activated by configure switches.



---

archive/issue_comments_440966.json:
```json
{
    "body": "If you can persuade them to do that, that would be great - also make it easier for us to report things upstream with only one codebase.",
    "created_at": "2020-12-23T19:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440966",
    "user": "@kcrisman"
}
```

If you can persuade them to do that, that would be great - also make it easier for us to report things upstream with only one codebase.



---

archive/issue_comments_440967.json:
```json
{
    "body": "The overall structure of the source trees of ginac and pynac is still the same.",
    "created_at": "2021-01-20T23:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440967",
    "user": "@mkoeppe"
}
```

The overall structure of the source trees of ginac and pynac is still the same.



---

archive/issue_comments_440968.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440968",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_440969.json:
```json
{
    "body": "I've done quite a bit of digging around pynac before, but I don't remember most of the details I learned.\n\nOne thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.\n\nOTOH, I think adding support for Python objects to ginac is a potential win for them too...",
    "created_at": "2021-03-10T13:34:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440969",
    "user": "@embray"
}
```

I've done quite a bit of digging around pynac before, but I don't remember most of the details I learned.

One thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.

OTOH, I think adding support for Python objects to ginac is a potential win for them too...



---

archive/issue_comments_440970.json:
```json
{
    "body": "Replying to [comment:11 embray]:\n> I've done quite a bit of digging around pynac before, but I don't remember most of the details I learned.\n> \n> One thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.\n\nDo we have any clue about **why** pynac developers choose to fork ginac rather than wrapping it or adding support for Sage objects ?\n\n> OTOH, I think adding support for Python objects to ginac is a potential win for them too...\n\nHaving one well-maintained engine rather than three (I'm also thinking of `symengine`) would be beneficial to all parties...",
    "created_at": "2021-03-10T21:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440970",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:11 embray]:
> I've done quite a bit of digging around pynac before, but I don't remember most of the details I learned.
> 
> One thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.

Do we have any clue about **why** pynac developers choose to fork ginac rather than wrapping it or adding support for Sage objects ?

> OTOH, I think adding support for Python objects to ginac is a potential win for them too...

Having one well-maintained engine rather than three (I'm also thinking of `symengine`) would be beneficial to all parties...



---

archive/issue_comments_440971.json:
```json
{
    "body": "> > One thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.\n> \n> Do we have any clue about **why** pynac developers choose to fork ginac rather than wrapping it or adding support for Sage objects ?\n\nIf you troll through Trac and sage-devel you will eventually see a lot of details about this - I think it was at the time easier to just fork it to allow us to use different numbers than CLN.  I think also that ginac might not have been under as active of development at the time.\n\nBut in the end that is archaeology; if you are able to achieve this ticket's goals, that would be very useful in many ways.  A lot of ecosystems were not as well developed then.",
    "created_at": "2021-03-10T23:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440971",
    "user": "@kcrisman"
}
```

> > One thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.
> 
> Do we have any clue about **why** pynac developers choose to fork ginac rather than wrapping it or adding support for Sage objects ?

If you troll through Trac and sage-devel you will eventually see a lot of details about this - I think it was at the time easier to just fork it to allow us to use different numbers than CLN.  I think also that ginac might not have been under as active of development at the time.

But in the end that is archaeology; if you are able to achieve this ticket's goals, that would be very useful in many ways.  A lot of ecosystems were not as well developed then.



---

archive/issue_comments_440972.json:
```json
{
    "body": "I would be very surprised if the ginac developers showed any interest in merging with pynac.  [One of their web pages](https://www.ginac.de/ToDo.html) says: \"As an open-source project, GiNaC allows anybody to extend it. Please don't ask the developers to implement any fancy stuff you might need. They wrote everything they need (and quite a bit more) and they will continue extending it so it keeps up with their needs.\"",
    "created_at": "2021-03-11T06:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440972",
    "user": "@DaveWitteMorris"
}
```

I would be very surprised if the ginac developers showed any interest in merging with pynac.  [One of their web pages](https://www.ginac.de/ToDo.html) says: "As an open-source project, GiNaC allows anybody to extend it. Please don't ask the developers to implement any fancy stuff you might need. They wrote everything they need (and quite a bit more) and they will continue extending it so it keeps up with their needs."



---

archive/issue_comments_440973.json:
```json
{
    "body": "But I think if we had a very modularized way to extend it to be easily used by Python (I don't know what that would entail) that didn't impact anything for \"normal\" GiNaC users, and presented it as a pull request, they might be willing.",
    "created_at": "2021-03-11T13:31:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440973",
    "user": "@kcrisman"
}
```

But I think if we had a very modularized way to extend it to be easily used by Python (I don't know what that would entail) that didn't impact anything for "normal" GiNaC users, and presented it as a pull request, they might be willing.



---

archive/issue_comments_440974.json:
```json
{
    "body": "Replying to [comment:15 kcrisman]:\n> But I think if we had a very modularized way to extend it to be easily used by Python (I don't know what that would entail) that didn't impact anything for \"normal\" GiNaC users, and presented it as a pull request, they might be willing.\n\nThis would mirror the story followed for LibGAP.  Originally it was a fork of the main GAP codebase with some patches to allow it to be used as a library.  Later the GAP folks offered their own library interface since their needs called for it, and they were able to do it in a way that they were happy with.  Now gappy (#31404) builds on the official GAP API which allows GAP to be used from Python (and hence Sage) without any fancy patches or forks.\n\nI don't recall exactly what changes are needed for making ginac cooperate with Python.  I recall from past dealings that it's non-trivial.  But ginac is also written in C++ and could be extended via subclassing, rather than patching.  I'm also not entirely convinced it needs to be able to work directly on Python objects so long as there's an efficient translation layer.",
    "created_at": "2021-03-11T15:01:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30855#issuecomment-440974",
    "user": "@embray"
}
```

Replying to [comment:15 kcrisman]:
> But I think if we had a very modularized way to extend it to be easily used by Python (I don't know what that would entail) that didn't impact anything for "normal" GiNaC users, and presented it as a pull request, they might be willing.

This would mirror the story followed for LibGAP.  Originally it was a fork of the main GAP codebase with some patches to allow it to be used as a library.  Later the GAP folks offered their own library interface since their needs called for it, and they were able to do it in a way that they were happy with.  Now gappy (#31404) builds on the official GAP API which allows GAP to be used from Python (and hence Sage) without any fancy patches or forks.

I don't recall exactly what changes are needed for making ginac cooperate with Python.  I recall from past dealings that it's non-trivial.  But ginac is also written in C++ and could be extended via subclassing, rather than patching.  I'm also not entirely convinced it needs to be able to work directly on Python objects so long as there's an efficient translation layer.
