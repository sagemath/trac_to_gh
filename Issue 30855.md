# Issue 30855: Merge ginac, pynac

Issue created by migration from https://trac.sagemath.org/ticket/31092

Original creator: mkoeppe

Original creation time: 2020-12-21 20:07:28

CC:  rws slelievre fbissey was dimpase kcrisman @davewittemorris egourgoulhon mjo arojas charpent chapoton

pynac is a fork of ginac. ginac appears to be under somewhat active development. 

We should explore whether they can be merged again.

See also: 
- #30534 Repackage `pynac` as a pip-installable package


---

Comment by kcrisman created at 2020-12-21 20:50:42

[Pynac](http://pynac.org) is more than [a fork of Ginac](https://github.com/pynac/pynac), though - my understanding is that nontrivial changes had to be made for it to use:

> The main difference between Pynac and GiNaC is that Pynac relies on Sage to provide the operations on numerical types, while GiNaC depends on CLN for this purpose.

If that can be overcome somehow, that would be useful, of course.


---

Comment by mkoeppe created at 2020-12-23 18:35:29

Replying to [comment:1 kcrisman]:
> [Pynac](http://pynac.org) is more than [a fork of Ginac](https://github.com/pynac/pynac), though - my understanding is that nontrivial changes had to be made for it to use:
> 
> > The main difference between Pynac and GiNaC is that Pynac relies on Sage to provide the operations on numerical types, while GiNaC depends on CLN for this purpose.

That's right. In a merge of the projects, these differences would have to be activated by configure switches.


---

Comment by kcrisman created at 2020-12-23 19:44:32

If you can persuade them to do that, that would be great - also make it easier for us to report things upstream with only one codebase.


---

Comment by mkoeppe created at 2021-01-20 23:21:38

The overall structure of the source trees of ginac and pynac is still the same.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by embray created at 2021-03-10 13:34:50

I've done quite a bit of digging around pynac before, but I don't remember most of the details I learned.

One thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.

OTOH, I think adding support for Python objects to ginac is a potential win for them too...


---

Comment by charpent created at 2021-03-10 21:38:52

Replying to [comment:11 embray]:
> I've done quite a bit of digging around pynac before, but I don't remember most of the details I learned.
> 
> One thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.

Do we have any clue about **why** pynac developers choose to fork ginac rather than wrapping it or adding support for Sage objects ?

> OTOH, I think adding support for Python objects to ginac is a potential win for them too...

Having one well-maintained engine rather than three (I'm also thinking of `symengine`) would be beneficial to all parties...


---

Comment by kcrisman created at 2021-03-10 23:00:14

> > One thing I wonder is why ginac needs to be patched, rather than providing a Python wrapper around plain ginac.
> 
> Do we have any clue about **why** pynac developers choose to fork ginac rather than wrapping it or adding support for Sage objects ?

If you troll through Trac and sage-devel you will eventually see a lot of details about this - I think it was at the time easier to just fork it to allow us to use different numbers than CLN.  I think also that ginac might not have been under as active of development at the time.

But in the end that is archaeology; if you are able to achieve this ticket's goals, that would be very useful in many ways.  A lot of ecosystems were not as well developed then.


---

Comment by @DaveWitteMorris created at 2021-03-11 06:12:32

I would be very surprised if the ginac developers showed any interest in merging with pynac.  [One of their web pages](https://www.ginac.de/ToDo.html) says: "As an open-source project, GiNaC allows anybody to extend it. Please don't ask the developers to implement any fancy stuff you might need. They wrote everything they need (and quite a bit more) and they will continue extending it so it keeps up with their needs."


---

Comment by kcrisman created at 2021-03-11 13:31:58

But I think if we had a very modularized way to extend it to be easily used by Python (I don't know what that would entail) that didn't impact anything for "normal" GiNaC users, and presented it as a pull request, they might be willing.


---

Comment by embray created at 2021-03-11 15:01:10

Replying to [comment:15 kcrisman]:
> But I think if we had a very modularized way to extend it to be easily used by Python (I don't know what that would entail) that didn't impact anything for "normal" GiNaC users, and presented it as a pull request, they might be willing.

This would mirror the story followed for LibGAP.  Originally it was a fork of the main GAP codebase with some patches to allow it to be used as a library.  Later the GAP folks offered their own library interface since their needs called for it, and they were able to do it in a way that they were happy with.  Now gappy (#31404) builds on the official GAP API which allows GAP to be used from Python (and hence Sage) without any fancy patches or forks.

I don't recall exactly what changes are needed for making ginac cooperate with Python.  I recall from past dealings that it's non-trivial.  But ginac is also written in C++ and could be extended via subclassing, rather than patching.  I'm also not entirely convinced it needs to be able to work directly on Python objects so long as there's an efficient translation layer.
