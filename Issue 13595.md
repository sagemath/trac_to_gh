# Issue 13595: cvxopt needs to link against gmp/mpir on 32-bit Windows XP Cygwin

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2012-12-05 13:16:40

Assignee: tbd

CC:  jpflori

As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.


---

Comment by jpflori created at 2012-12-05 15:51:01

I guess overlinking was so muchfixed in #13160 it became underlinking.


---

Comment by kcrisman created at 2012-12-05 18:29:34

Maybe.  We do 

```
 # Set to 1 if you are installing the glpk module.
-BUILD_GLPK = 0 
+BUILD_GLPK = 1 
```

in setup.py.patch, and got rid of 

```
- if BUILD_GLPK:
--    glpk = Extension('glpk', libraries = ['glpk'],
-+    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],
-         include_dirs = [ GLPK_INC_DIR ],
--        library_dirs = [ GLPK_LIB_DIR ],
-+        library_dirs = libdirs + [ GLPK_LIB_DIR ],
-         sources = ['C/glpk.c'] )
-     extmods += [glpk];
- 
```

but Cygwin is notoriously finicky about extensions, so maybe we need to add this back in.  Have you seen any problems at all on Windows 7?  Maybe 

```

 # Directory containing libglpk (used only when BUILD_GLPK = 1).
-GLPK_LIB_DIR = '/usr/lib'
+GLPK_LIB_DIR = SAGE_LIB
 
 # Directory containing glpk.h (used only when BUILD_GLPK = 1).
-GLPK_INC_DIR = '/usr/include'
+GLPK_INC_DIR = SAGE_INCLUDE
```

is sufficient there, if those are even relevant here (are they where it is put, or where it looks for things it depends on?).


---

Comment by jpflori created at 2012-12-05 22:28:58

The fix is just to add back gmp and z as dependencies for glpk, or I guess so, more or less as your first solution proposes.
Your second solution won't work (or could but that's not a good idea, it will use the system gmp I guess).
I've got a quite working spkg, but will only post it tomorrow, too late for today.


---

Comment by kcrisman created at 2012-12-06 01:38:09

Sorry, the "second" thing is already in there, so that we use the Sage include and lib directories.  I am more or less suggesting that we add

```diff
+ if BUILD_GLPK:
+-    glpk = Extension('glpk', libraries = ['glpk'],
++    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],
+         include_dirs = [ GLPK_INC_DIR ],
+-        library_dirs = [ GLPK_LIB_DIR ],
++        library_dirs = libdirs + [ GLPK_LIB_DIR ],
+         sources = ['C/glpk.c'] )
+     extmods += [glpk];
+ 
```

back in the patch file, or at least I think so, at least if `__CYGWIN__` is defined.


---

Comment by jpflori created at 2012-12-06 09:58:23

Changing status from new to needs_review.


---

Comment by jpflori created at 2012-12-06 09:58:23

I've uploaded a working spkg at
http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg

It adds back the glpk needed dependencies removed at #13160.


---

Comment by kcrisman created at 2012-12-06 15:47:43

Just FYI, there are two hunks that succeed but are offset by one line each.  Otherwise this seems fine.  Builds ok on Mac and sage.math and XP Cygwin, passes tests on the `numerical_sage` doc module on Mac and sage.math.

By the way, at some point I also had a p1 spkg that (according to sage-devel list I said that) Volker had made, but I can't find what ticket, if any, that was related to.


---

Comment by kcrisman created at 2012-12-06 15:47:43

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-12-16 15:17:44

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-12-16 15:17:44

`SPKG.txt` has the wrong version number (cvxopt-1.1.5 instead of cvxopt-1.1.5.p0) and there should be a blank line after

```
## Changelog
```



---

Comment by jpflori created at 2012-12-17 09:37:20

Spkg diff, for review only.


---

Attachment

The newly uploaded spkg should be fine.


---

Comment by jpflori created at 2012-12-17 09:52:41

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2012-12-17 10:00:13

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-12-27 10:24:09

Resolution: fixed
