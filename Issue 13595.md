# Issue 13595: cvxopt needs to link against gmp/mpir on 32-bit Windows XP Cygwin

archive/issues_013595.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  jpflori\n\nAs in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13799\n\n",
    "created_at": "2012-12-05T13:16:40Z",
    "labels": [
        "component: porting: cygwin",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.6",
    "title": "cvxopt needs to link against gmp/mpir on 32-bit Windows XP Cygwin",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13595",
    "user": "https://github.com/kcrisman"
}
```
Assignee: tbd

CC:  jpflori

As in the summary.   Lots of `undefined reference to` messages about things like `__imp____gmpq_clear` and the like.

Issue created by migration from https://trac.sagemath.org/ticket/13799





---

archive/issue_comments_167903.json:
```json
{
    "body": "I guess overlinking was so muchfixed in #13160 it became underlinking.",
    "created_at": "2012-12-05T15:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167903",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I guess overlinking was so muchfixed in #13160 it became underlinking.



---

archive/issue_comments_167904.json:
```json
{
    "body": "Maybe.  We do \n\n```\n # Set to 1 if you are installing the glpk module.\n-BUILD_GLPK = 0 \n+BUILD_GLPK = 1 \n```\n\nin setup.py.patch, and got rid of \n\n```\n- if BUILD_GLPK:\n--    glpk = Extension('glpk', libraries = ['glpk'],\n-+    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],\n-         include_dirs = [ GLPK_INC_DIR ],\n--        library_dirs = [ GLPK_LIB_DIR ],\n-+        library_dirs = libdirs + [ GLPK_LIB_DIR ],\n-         sources = ['C/glpk.c'] )\n-     extmods += [glpk];\n- \n```\n\nbut Cygwin is notoriously finicky about extensions, so maybe we need to add this back in.  Have you seen any problems at all on Windows 7?  Maybe \n\n```\n\n # Directory containing libglpk (used only when BUILD_GLPK = 1).\n-GLPK_LIB_DIR = '/usr/lib'\n+GLPK_LIB_DIR = SAGE_LIB\n \n # Directory containing glpk.h (used only when BUILD_GLPK = 1).\n-GLPK_INC_DIR = '/usr/include'\n+GLPK_INC_DIR = SAGE_INCLUDE\n```\n\nis sufficient there, if those are even relevant here (are they where it is put, or where it looks for things it depends on?).",
    "created_at": "2012-12-05T18:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167904",
    "user": "https://github.com/kcrisman"
}
```

Maybe.  We do 

```
 # Set to 1 if you are installing the glpk module.
-BUILD_GLPK = 0 
+BUILD_GLPK = 1 
```

in setup.py.patch, and got rid of 

```
- if BUILD_GLPK:
--    glpk = Extension('glpk', libraries = ['glpk'],
-+    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],
-         include_dirs = [ GLPK_INC_DIR ],
--        library_dirs = [ GLPK_LIB_DIR ],
-+        library_dirs = libdirs + [ GLPK_LIB_DIR ],
-         sources = ['C/glpk.c'] )
-     extmods += [glpk];
- 
```

but Cygwin is notoriously finicky about extensions, so maybe we need to add this back in.  Have you seen any problems at all on Windows 7?  Maybe 

```

 # Directory containing libglpk (used only when BUILD_GLPK = 1).
-GLPK_LIB_DIR = '/usr/lib'
+GLPK_LIB_DIR = SAGE_LIB
 
 # Directory containing glpk.h (used only when BUILD_GLPK = 1).
-GLPK_INC_DIR = '/usr/include'
+GLPK_INC_DIR = SAGE_INCLUDE
```

is sufficient there, if those are even relevant here (are they where it is put, or where it looks for things it depends on?).



---

archive/issue_comments_167905.json:
```json
{
    "body": "The fix is just to add back gmp and z as dependencies for glpk, or I guess so, more or less as your first solution proposes.\nYour second solution won't work (or could but that's not a good idea, it will use the system gmp I guess).\nI've got a quite working spkg, but will only post it tomorrow, too late for today.",
    "created_at": "2012-12-05T22:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167905",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The fix is just to add back gmp and z as dependencies for glpk, or I guess so, more or less as your first solution proposes.
Your second solution won't work (or could but that's not a good idea, it will use the system gmp I guess).
I've got a quite working spkg, but will only post it tomorrow, too late for today.



---

archive/issue_comments_167906.json:
```json
{
    "body": "Sorry, the \"second\" thing is already in there, so that we use the Sage include and lib directories.  I am more or less suggesting that we add\n\n```diff\n+ if BUILD_GLPK:\n+-    glpk = Extension('glpk', libraries = ['glpk'],\n++    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],\n+         include_dirs = [ GLPK_INC_DIR ],\n+-        library_dirs = [ GLPK_LIB_DIR ],\n++        library_dirs = libdirs + [ GLPK_LIB_DIR ],\n+         sources = ['C/glpk.c'] )\n+     extmods += [glpk];\n+ \n```\n\nback in the patch file, or at least I think so, at least if `__CYGWIN__` is defined.",
    "created_at": "2012-12-06T01:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167906",
    "user": "https://github.com/kcrisman"
}
```

Sorry, the "second" thing is already in there, so that we use the Sage include and lib directories.  I am more or less suggesting that we add

```diff
+ if BUILD_GLPK:
+-    glpk = Extension('glpk', libraries = ['glpk'],
++    glpk = Extension('glpk', libraries = libraries+['glpk', 'gmp', 'z'],
+         include_dirs = [ GLPK_INC_DIR ],
+-        library_dirs = [ GLPK_LIB_DIR ],
++        library_dirs = libdirs + [ GLPK_LIB_DIR ],
+         sources = ['C/glpk.c'] )
+     extmods += [glpk];
+ 
```

back in the patch file, or at least I think so, at least if `__CYGWIN__` is defined.



---

archive/issue_comments_167907.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-12-06T09:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167907",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_167908.json:
```json
{
    "body": "I've uploaded a working spkg at\nhttp://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg\n\nIt adds back the glpk needed dependencies removed at #13160.",
    "created_at": "2012-12-06T09:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167908",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I've uploaded a working spkg at
http://boxen.math.washington.edu/home/jpflori/cvxopt-1.1.5.p0.spkg

It adds back the glpk needed dependencies removed at #13160.



---

archive/issue_comments_167909.json:
```json
{
    "body": "Just FYI, there are two hunks that succeed but are offset by one line each.  Otherwise this seems fine.  Builds ok on Mac and sage.math and XP Cygwin, passes tests on the `numerical_sage` doc module on Mac and sage.math.\n\nBy the way, at some point I also had a p1 spkg that (according to sage-devel list I said that) Volker had made, but I can't find what ticket, if any, that was related to.",
    "created_at": "2012-12-06T15:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167909",
    "user": "https://github.com/kcrisman"
}
```

Just FYI, there are two hunks that succeed but are offset by one line each.  Otherwise this seems fine.  Builds ok on Mac and sage.math and XP Cygwin, passes tests on the `numerical_sage` doc module on Mac and sage.math.

By the way, at some point I also had a p1 spkg that (according to sage-devel list I said that) Volker had made, but I can't find what ticket, if any, that was related to.



---

archive/issue_comments_167910.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-06T15:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167910",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_167911.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2012-12-16T15:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167911",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_167912.json:
```json
{
    "body": "`SPKG.txt` has the wrong version number (cvxopt-1.1.5 instead of cvxopt-1.1.5.p0) and there should be a blank line after\n\n```\n## Changelog\n```\n",
    "created_at": "2012-12-16T15:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167912",
    "user": "https://github.com/jdemeyer"
}
```

`SPKG.txt` has the wrong version number (cvxopt-1.1.5 instead of cvxopt-1.1.5.p0) and there should be a blank line after

```
## Changelog
```




---

archive/issue_comments_167913.json:
```json
{
    "body": "Spkg diff, for review only.",
    "created_at": "2012-12-17T09:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167913",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Spkg diff, for review only.



---

archive/issue_comments_167914.json:
```json
{
    "body": "Attachment [cvxopt-1.1.5.p0.diff](tarball://root/attachments/some-uuid/ticket13799/cvxopt-1.1.5.p0.diff) by jpflori created at 2012-12-17 09:38:34\n\nThe newly uploaded spkg should be fine.",
    "created_at": "2012-12-17T09:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167914",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [cvxopt-1.1.5.p0.diff](tarball://root/attachments/some-uuid/ticket13799/cvxopt-1.1.5.p0.diff) by jpflori created at 2012-12-17 09:38:34

The newly uploaded spkg should be fine.



---

archive/issue_comments_167915.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-12-17T09:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167915",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_167916.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-12-17T10:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167916",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_038679.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-12-27T10:24:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13595#event-38679"
}
```



---

archive/issue_comments_167917.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-12-27T10:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13595",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13595#issuecomment-167917",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
