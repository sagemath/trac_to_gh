# Issue 12053: Finite and some lazy factorial language

archive/issues_012053.json:
```json
{
    "body": "Assignee: Vincent Delecroix\n\nCC:  sstarosta slabbe tmonteil\n\nKeywords: word, factorial language, symbolic dynamics\n\n1) Implement a data structure (similar to a tree with label on edges) for finite factorial language which extends the actual SuffixTrie and SuffixTree in sage/combinat/words/suffix_tree.py (a \"RauzyCastle\").\n\n2.a) Use it in a static version for the implementation of finite factorial language\n\n2.b) Use it in a dynamical version for the implementation of some lazy languages (square free, cube free, overlap free, finite defect, ...)\n\ndependencies: #12224\n\nIssue created by migration from https://trac.sagemath.org/ticket/12225\n\n",
    "created_at": "2011-12-23T10:50:39Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Finite and some lazy factorial language",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12053",
    "user": "vdelecroix"
}
```
Assignee: Vincent Delecroix

CC:  sstarosta slabbe tmonteil

Keywords: word, factorial language, symbolic dynamics

1) Implement a data structure (similar to a tree with label on edges) for finite factorial language which extends the actual SuffixTrie and SuffixTree in sage/combinat/words/suffix_tree.py (a "RauzyCastle").

2.a) Use it in a static version for the implementation of finite factorial language

2.b) Use it in a dynamical version for the implementation of some lazy languages (square free, cube free, overlap free, finite defect, ...)

dependencies: #12224

Issue created by migration from https://trac.sagemath.org/ticket/12225





---

archive/issue_comments_139782.json:
```json
{
    "body": "Changing assignee from Vincent Delecroix to vdelecroix.",
    "created_at": "2011-12-23T11:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12053#issuecomment-139782",
    "user": "vdelecroix"
}
```

Changing assignee from Vincent Delecroix to vdelecroix.



---

archive/issue_comments_139783.json:
```json
{
    "body": "Nice ticket!\n\nRelated to this, I want to add that I want to remove the class and the file `nfactor_enumerable_word` from Sage. Currently, only Finite Word class inherits from it. So it would be easy to fix by just moving the methods to the Finite Word class. I am sorry for having introduced this class into Sage : it was an error. This job must be done inside of the appropriate Language class... I still haven't created the ticket for it, but I definitively will.\n\nS\u00e9bastien",
    "created_at": "2012-01-10T19:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12053#issuecomment-139783",
    "user": "slabbe"
}
```

Nice ticket!

Related to this, I want to add that I want to remove the class and the file `nfactor_enumerable_word` from Sage. Currently, only Finite Word class inherits from it. So it would be easy to fix by just moving the methods to the Finite Word class. I am sorry for having introduced this class into Sage : it was an error. This job must be done inside of the appropriate Language class... I still haven't created the ticket for it, but I definitively will.

Sébastien



---

archive/issue_comments_139784.json:
```json
{
    "body": "Hi Sebastien,\n\n> Nice ticket!\n\nThanks! It now needs work!\n\n> Related to this, I want to add that I want to remove the class and the file `nfactor_enumerable_word` from Sage. Currently, only Finite Word class inherits from it. So it would be easy to fix by just moving the methods to the Finite Word class. I am sorry for having introduced this class into Sage : it was an error. This job must be done inside of the appropriate Language class... I still haven't created the ticket for it, but I definitively will.\n\nI have some patch almost ready for it. It is just an update of suffix_trie into a prefix_suffix_trie. The data structure I used is perhaps not optimal (many dictionnaries that points toward other dictionnaries). It would be very nice to have a low-level implementation as the one used in Graph as well as a sparse and a dense version (certainly another ticket).\n\nBefore submitting a patch, I want to fix #12224 (Use Parent/Element and GradedEnumeratedSets for Language).\n\nI have a questions for you : do we remove suffix_trie and use this new class instead ? (I made some timings and it seems that mine is twice slower, which is not so good or not so bad) Anyway, if yes, it is for another ticket.",
    "created_at": "2012-01-10T21:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12053#issuecomment-139784",
    "user": "vdelecroix"
}
```

Hi Sebastien,

> Nice ticket!

Thanks! It now needs work!

> Related to this, I want to add that I want to remove the class and the file `nfactor_enumerable_word` from Sage. Currently, only Finite Word class inherits from it. So it would be easy to fix by just moving the methods to the Finite Word class. I am sorry for having introduced this class into Sage : it was an error. This job must be done inside of the appropriate Language class... I still haven't created the ticket for it, but I definitively will.

I have some patch almost ready for it. It is just an update of suffix_trie into a prefix_suffix_trie. The data structure I used is perhaps not optimal (many dictionnaries that points toward other dictionnaries). It would be very nice to have a low-level implementation as the one used in Graph as well as a sparse and a dense version (certainly another ticket).

Before submitting a patch, I want to fix #12224 (Use Parent/Element and GradedEnumeratedSets for Language).

I have a questions for you : do we remove suffix_trie and use this new class instead ? (I made some timings and it seems that mine is twice slower, which is not so good or not so bad) Anyway, if yes, it is for another ticket.



---

archive/issue_comments_139785.json:
```json
{
    "body": "> > Nice ticket!\n> \n> Thanks! It now needs work!\n\nIndeed...\n\n> I have some patch almost ready for it. It is just an update of suffix_trie into a prefix_suffix_trie. The data structure I used is perhaps not optimal (many dictionnaries that points toward other dictionnaries). It would be very nice to have a low-level implementation as the one used in Graph as well as a sparse and a dense version (certainly another ticket).\n\nI once rewrote the code of suffix_tree and was able to improve timing (something like 40%) just by choosing better data structures (dict instead of list or vice versa). My patches does not apply anymore because of conflicts but it is here : http://sage.math.washington.edu/home/slabbe/patches/ (starts with suffix_something). I did not push it any further, because I wanted instead to rewrite suffix tree code in cython, which we did for the suffix tree. But this construction is quadratic in the length of the (finite) word, and I want it to be linear. So, my next step was to implement the suffix_trie in cython, but I never did...\n\n> Before submitting a patch, I want to fix #12224 (Use Parent/Element and GradedEnumeratedSets for Language).\n> \n> I have a questions for you : do we remove suffix_trie and use this new class instead ? (I made some timings and it seems that mine is twice slower, which is not so good or not so bad) Anyway, if yes, it is for another ticket.\n\nWell, I would say not to delete it first. Just add a new implementation beside it. And, for some time, one could choose the algorithm or implementation. Later, we could delete the initial implementation.\n\n\n```\nsage: w.factors(algorithm=\"first slow python implementation\")\nsage: w.factors(algorithm=\"cython implementation\")\n```\n\n\nS\u00e9bastien",
    "created_at": "2012-01-10T22:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12053#issuecomment-139785",
    "user": "slabbe"
}
```

> > Nice ticket!
> 
> Thanks! It now needs work!

Indeed...

> I have some patch almost ready for it. It is just an update of suffix_trie into a prefix_suffix_trie. The data structure I used is perhaps not optimal (many dictionnaries that points toward other dictionnaries). It would be very nice to have a low-level implementation as the one used in Graph as well as a sparse and a dense version (certainly another ticket).

I once rewrote the code of suffix_tree and was able to improve timing (something like 40%) just by choosing better data structures (dict instead of list or vice versa). My patches does not apply anymore because of conflicts but it is here : http://sage.math.washington.edu/home/slabbe/patches/ (starts with suffix_something). I did not push it any further, because I wanted instead to rewrite suffix tree code in cython, which we did for the suffix tree. But this construction is quadratic in the length of the (finite) word, and I want it to be linear. So, my next step was to implement the suffix_trie in cython, but I never did...

> Before submitting a patch, I want to fix #12224 (Use Parent/Element and GradedEnumeratedSets for Language).
> 
> I have a questions for you : do we remove suffix_trie and use this new class instead ? (I made some timings and it seems that mine is twice slower, which is not so good or not so bad) Anyway, if yes, it is for another ticket.

Well, I would say not to delete it first. Just add a new implementation beside it. And, for some time, one could choose the algorithm or implementation. Later, we could delete the initial implementation.


```
sage: w.factors(algorithm="first slow python implementation")
sage: w.factors(algorithm="cython implementation")
```


Sébastien



---

archive/issue_comments_139786.json:
```json
{
    "body": "> Related to this, I want to add that I want to remove the class and the file `nfactor_enumerable_word` from Sage. \n\nThis is now : #12380",
    "created_at": "2012-01-29T04:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12053",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12053#issuecomment-139786",
    "user": "slabbe"
}
```

> Related to this, I want to add that I want to remove the class and the file `nfactor_enumerable_word` from Sage. 

This is now : #12380
