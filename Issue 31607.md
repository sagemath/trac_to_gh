# Issue 31607: Incorrect summation with binomial of non-atomic arguments.

archive/issues_031607.json:
```json
{
    "body": "CC:  @davewittemorris @slel\n\nKeywords: summation binomial\n\nFound in this as.sagemath [question](https://ask.sagemath.org/question/57195/incorrect-symbolic-sum-wbinomial-coefficients/) :\n\n```\nsage: var(\"t, n, k\")\n(t, n, k)\nsage: sum(t^(k - 1)*binomial(n - 1, k - 1), k, 1, n)\n0\n```\n\nBut :\n\n```\nsage: sum(t^(k)*binomial(n, k), k, 0, n-1)\n(t + 1)^n - t^n\n```\n\n\nThis is //not// a Maxima bug ; Maxima doesn't even try :\n\n```\nsage: maxima_calculus.interact()\n\n  --> Switching to Maxima_lib <--\n\nmaxima_lib: sum(binomial(k-1,n-1)*t^k, k, 1, n);\n'sum(binomial(k-1,n-1)*t^k,k,1,n)\nmaxima_lib: sum(binomial(k,n)*t^k, k, 0, n-1);\n'sum(binomial(k,n)*t^k,k,0,n-1)\nmaxima_lib: \n  --> Exiting back to Sage <--\n```\n\nDetails and workaround in my answer to the cited [question](https://ask.sagemath.org/question/57195/incorrect-symbolic-sum-wbinomial-coefficients/).\n\nIssue created by migration from https://trac.sagemath.org/ticket/31844\n\n",
    "created_at": "2021-05-22T10:02:17Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Incorrect summation with binomial of non-atomic arguments.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31607",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
CC:  @davewittemorris @slel

Keywords: summation binomial

Found in this as.sagemath [question](https://ask.sagemath.org/question/57195/incorrect-symbolic-sum-wbinomial-coefficients/) :

```
sage: var("t, n, k")
(t, n, k)
sage: sum(t^(k - 1)*binomial(n - 1, k - 1), k, 1, n)
0
```

But :

```
sage: sum(t^(k)*binomial(n, k), k, 0, n-1)
(t + 1)^n - t^n
```


This is //not// a Maxima bug ; Maxima doesn't even try :

```
sage: maxima_calculus.interact()

  --> Switching to Maxima_lib <--

maxima_lib: sum(binomial(k-1,n-1)*t^k, k, 1, n);
'sum(binomial(k-1,n-1)*t^k,k,1,n)
maxima_lib: sum(binomial(k,n)*t^k, k, 0, n-1);
'sum(binomial(k,n)*t^k,k,0,n-1)
maxima_lib: 
  --> Exiting back to Sage <--
```

Details and workaround in my answer to the cited [question](https://ask.sagemath.org/question/57195/incorrect-symbolic-sum-wbinomial-coefficients/).

Issue created by migration from https://trac.sagemath.org/ticket/31844





---

archive/issue_comments_450959.json:
```json
{
    "body": "My hunch is that the problem lies with the management of non-atomic arguments by `binomial`, but I haven't a clue on how to explore this.\n\nSuggestions ?",
    "created_at": "2021-05-22T10:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450959",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

My hunch is that the problem lies with the management of non-atomic arguments by `binomial`, but I haven't a clue on how to explore this.

Suggestions ?



---

archive/issue_comments_450960.json:
```json
{
    "body": "Contrary to what is said in the description, the \"equivalent sum obtained by shifting the summation index\" is **not** correct. In the equivalent sum, the top of the binomial coefficient needs to stay at `n-1`, not change to `n`:\n\n```\nsage: sum(t^(k)*binomial(n-1, k), k, 0, n-1)\n0\n```\n\nI don't know what is going on, but here is some additional data.  In this example, only `j=-1` is wrong:\n\n```\nsage: for j in range(-3, 4):\n....:     j, sum(t^k * binomial(n + j, k), k, 0, n + j)\n....:\n(-3, sum(t^k*binomial(n - 3, k), k, 0, n - 3))\n(-2, sum(t^k*binomial(n - 2, k), k, 0, n - 2))\n(-1, 0)\n(0, (t + 1)^n)\n(1, (t + 1)^(n + 1))\n(2, (t^2 + 2*t + 1)*(t + 1)^n)\n(3, (t^3 + 3*t^2 + 3*t + 1)*(t + 1)^n)\n```\n\nBut in this example, all of the negative values of `j` are wrong:\n\n```\nsage: for j in range(-3, 4):\n....:     j, sum(t^k * binomial(n + j, k), k, 0, n)\n....:\n(-3, (t + 1)^n)\n(-2, (t + 1)^n)\n(-1, (t + 1)^n)\n(0, (t + 1)^n)\n(1, (t + 1)^(n + 1) - t^(n + 1))\n(2, (t^2 + 2*t + 1)*(t + 1)^n - ((n + 2)*t + t^2)*t^n)\n(3, (t^3 + 3*t^2 + 3*t + 1)*(t + 1)^n \n    - 1/2*(2*(n + 3)*t^2 + 2*t^3 + (n^2 + 5*n + 6)*t)*t^n)\n```\n",
    "created_at": "2021-05-23T03:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450960",
    "user": "https://github.com/DaveWitteMorris"
}
```

Contrary to what is said in the description, the "equivalent sum obtained by shifting the summation index" is **not** correct. In the equivalent sum, the top of the binomial coefficient needs to stay at `n-1`, not change to `n`:

```
sage: sum(t^(k)*binomial(n-1, k), k, 0, n-1)
0
```

I don't know what is going on, but here is some additional data.  In this example, only `j=-1` is wrong:

```
sage: for j in range(-3, 4):
....:     j, sum(t^k * binomial(n + j, k), k, 0, n + j)
....:
(-3, sum(t^k*binomial(n - 3, k), k, 0, n - 3))
(-2, sum(t^k*binomial(n - 2, k), k, 0, n - 2))
(-1, 0)
(0, (t + 1)^n)
(1, (t + 1)^(n + 1))
(2, (t^2 + 2*t + 1)*(t + 1)^n)
(3, (t^3 + 3*t^2 + 3*t + 1)*(t + 1)^n)
```

But in this example, all of the negative values of `j` are wrong:

```
sage: for j in range(-3, 4):
....:     j, sum(t^k * binomial(n + j, k), k, 0, n)
....:
(-3, (t + 1)^n)
(-2, (t + 1)^n)
(-1, (t + 1)^n)
(0, (t + 1)^n)
(1, (t + 1)^(n + 1) - t^(n + 1))
(2, (t^2 + 2*t + 1)*(t + 1)^n - ((n + 2)*t + t^2)*t^n)
(3, (t^3 + 3*t^2 + 3*t + 1)*(t + 1)^n 
    - 1/2*(2*(n + 3)*t^2 + 2*t^3 + (n^2 + 5*n + 6)*t)*t^n)
```




---

archive/issue_comments_450961.json:
```json
{
    "body": "> Contrary to what is said in the description, the \"equivalent sum obtained by shifting the summation index\" is not correct. In the equivalent sum, the top of the binomial coefficient needs to stay at n-1, not change to n:\n\nOh yeah ?\n\n\n```\nsage: var(\"n, t, j, k, n1, k1\")\n(n, t, j, k, n1, k1)\nsage: foo = sum(t^k*binomial(n-1, k-1), k, 1, n, hold=True)\nsage: foo.unhold() # doubleplus ungood...\n0\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).unhold() # doubleplus ungood again...\n0\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold() # better\n(t + 1)^n1*t\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1) # better, and expressed in terms of the original variable\n(t + 1)^(n - 1)*t\n```\n\n\nA little numerical check won't hurt :\n\n\n```\nsage: foo.subs(n==5).unhold().factor() # Binomial has no problem with numerical values ==> reference\n(t + 1)^4*t\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).unhold().subs(n==5) # 0.subs(n==5) is still 0...\n0\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1).subs(n=5) # Correct...\n(t + 1)^4*t\n```\n\n\nAs for the extension to other offset values :\n\n\n```\nsage: sum(t^(k-j)*binomial(-j + n, -j + k), k, j, n) # Sage doesn't compute this\nsum(t^(-j + k)*binomial(-j + n, -j + k), k, j, n)\nsage: sum(t^(k-j)*binomial(-j + n, -j + k), k, j, n, hold=True).maxima_methods().changevar(k1==k-j, k1,  k).subs(n==n1+j).unhold().subs(n1==n-j) # same transformation as before\n(t + 1)^(-j + n)\nsage: sum(t^(k-j)*binomial(-j + n, -j + k), k, j, n, algorithm=\"giac\") # giac concurs\n(t + 1)^(-j + n)\nsage: sum(t^(k-j)*binomial(-j + n, -j + k), k, j, n, algorithm=\"mathematica\") # so does Mathematica\n(t + 1)^(-j + n)\n```\n\n\nNumerical checks left to the reader as an exercise...\n\nIt turns out that Sage can (awkwardly but) correctly solve the general case, and gets the special cases wrong. Premature optimization ?\n\n//Note :// the quantities you have computed are //not// those sought for by the original author. Re-read your code...",
    "created_at": "2021-05-23T21:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450961",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

> Contrary to what is said in the description, the "equivalent sum obtained by shifting the summation index" is not correct. In the equivalent sum, the top of the binomial coefficient needs to stay at n-1, not change to n:

Oh yeah ?


```
sage: var("n, t, j, k, n1, k1")
(n, t, j, k, n1, k1)
sage: foo = sum(t^k*binomial(n-1, k-1), k, 1, n, hold=True)
sage: foo.unhold() # doubleplus ungood...
0
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).unhold() # doubleplus ungood again...
0
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold() # better
(t + 1)^n1*t
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1) # better, and expressed in terms of the original variable
(t + 1)^(n - 1)*t
```


A little numerical check won't hurt :


```
sage: foo.subs(n==5).unhold().factor() # Binomial has no problem with numerical values ==> reference
(t + 1)^4*t
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).unhold().subs(n==5) # 0.subs(n==5) is still 0...
0
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1).subs(n=5) # Correct...
(t + 1)^4*t
```


As for the extension to other offset values :


```
sage: sum(t^(k-j)*binomial(-j + n, -j + k), k, j, n) # Sage doesn't compute this
sum(t^(-j + k)*binomial(-j + n, -j + k), k, j, n)
sage: sum(t^(k-j)*binomial(-j + n, -j + k), k, j, n, hold=True).maxima_methods().changevar(k1==k-j, k1,  k).subs(n==n1+j).unhold().subs(n1==n-j) # same transformation as before
(t + 1)^(-j + n)
sage: sum(t^(k-j)*binomial(-j + n, -j + k), k, j, n, algorithm="giac") # giac concurs
(t + 1)^(-j + n)
sage: sum(t^(k-j)*binomial(-j + n, -j + k), k, j, n, algorithm="mathematica") # so does Mathematica
(t + 1)^(-j + n)
```


Numerical checks left to the reader as an exercise...

It turns out that Sage can (awkwardly but) correctly solve the general case, and gets the special cases wrong. Premature optimization ?

//Note :// the quantities you have computed are //not// those sought for by the original author. Re-read your code...



---

archive/issue_comments_450962.json:
```json
{
    "body": "I'm sorry if I wasn't clear.  Replacing `n` with `6` in the original sum gives:\n\n```\nsage: sum(t^(k - 1)*binomial(6 - 1, k - 1), k, 1, 6)\nt^5 + 5*t^4 + 10*t^3 + 10*t^2 + 5*t + 1\n```\n\nBut replacing `n` with `6` in the \"equivalent\" sum gives:\n\n```\nsage: sum(t^(k)*binomial(6, k), k, 0, 6-1)\n6*t^5 + 15*t^4 + 20*t^3 + 15*t^2 + 6*t + 1\n```\n\nThis is not the same answer, which means that the two sums are mathematically different. On the other hand, replacing `n` with `6` in the sum I suggested gives:\n\n```\nsage: sum(t^(k)*binomial(6-1, k), k, 0, 6-1)\nt^5 + 5*t^4 + 10*t^3 + 10*t^2 + 5*t + 1\n```\n\nThis is the same answer as the original sum, and (unless I made a mistake) it will give the same answer for all values of `n`. I thought that was what we wanted, so that is why I said that `n-1` should not be changed to `n`. I apologize if I was not clear about what I meant, or if I misunderstood what you were trying to say.\n\nMy other examples were not intended to be directly related to the original question. However, since they are slightly different, and present some additional situations, I thought they might (but only might) help locate the bug. I don't think I need to re-read my code -- it acts exactly as I intended -- but I'm sorry if it wasted your time because I didn't explain my intentions properly.",
    "created_at": "2021-05-23T23:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450962",
    "user": "https://github.com/DaveWitteMorris"
}
```

I'm sorry if I wasn't clear.  Replacing `n` with `6` in the original sum gives:

```
sage: sum(t^(k - 1)*binomial(6 - 1, k - 1), k, 1, 6)
t^5 + 5*t^4 + 10*t^3 + 10*t^2 + 5*t + 1
```

But replacing `n` with `6` in the "equivalent" sum gives:

```
sage: sum(t^(k)*binomial(6, k), k, 0, 6-1)
6*t^5 + 15*t^4 + 20*t^3 + 15*t^2 + 6*t + 1
```

This is not the same answer, which means that the two sums are mathematically different. On the other hand, replacing `n` with `6` in the sum I suggested gives:

```
sage: sum(t^(k)*binomial(6-1, k), k, 0, 6-1)
t^5 + 5*t^4 + 10*t^3 + 10*t^2 + 5*t + 1
```

This is the same answer as the original sum, and (unless I made a mistake) it will give the same answer for all values of `n`. I thought that was what we wanted, so that is why I said that `n-1` should not be changed to `n`. I apologize if I was not clear about what I meant, or if I misunderstood what you were trying to say.

My other examples were not intended to be directly related to the original question. However, since they are slightly different, and present some additional situations, I thought they might (but only might) help locate the bug. I don't think I need to re-read my code -- it acts exactly as I intended -- but I'm sorry if it wasted your time because I didn't explain my intentions properly.



---

archive/issue_comments_450963.json:
```json
{
    "body": "You :\n> But replacing n with 6 in the \"equivalent\" sum gives:\n\n```\nsage: sum(t^(k)*binomial(6, k), k, 0, 6-1)\n6*t^5 + 15*t^4 + 20*t^3 + 15*t^2 + 6*t + 1\n```\n\n\nNope. Step by step :\n\n\n```\nsage: foo\nsum(t^k*binomial(n - 1, k - 1), k, 1, n)\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k)\nsum(t^(k1 + 1)*binomial(n - 1, k1), k1, 0, n - 1)\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1)\nsum(t^(k1 + 1)*binomial(n1, k1), k1, 0, n1)\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold()\n(t + 1)^n1*t\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1)\n(t + 1)^(n - 1)*t\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1).subs(n==6)\n(t + 1)^5*t\nsage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1).subs(n==6).expand()\nt^6 + 5*t^5 + 10*t^4 + 10*t^3 + 5*t^2 + t\n```\n\n\nYou:\n\n>This is not the same answer, which means that the two sums are mathematically different. On the other hand, replacing n with 6 in the sum I suggested gives:\n\n```\nsage: sum(t^(k)*binomial(6-1, k), k, 0, 6-1)\nt^5 + 5*t^4 + 10*t^3 + 10*t^2 + 5*t + 1\n```\n\n\nNope :\n\n```\n             +-- By your logic, this should be k-1,\n             |                           +-- and this should be 6 !\n             V                           V\nsage: sum(t^(k)*binomial(6-1, k), k, 0, 6-1)\nt^5 + 5*t^4 + 10*t^3 + 10*t^2 + 5*t + 1\n```\n\nBy the way :\n\n```\nsage: sum(t^(k-1)*binomial(6-1, k), k, 0, 6).expand()\nt^4 + 5*t^3 + 10*t^2 + 10*t + 1/t + 5\n```\n\n\n> I don't think I need to re-read my code\n\nI'm devastated to be of a different opinion...",
    "created_at": "2021-05-24T05:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450963",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

You :
> But replacing n with 6 in the "equivalent" sum gives:

```
sage: sum(t^(k)*binomial(6, k), k, 0, 6-1)
6*t^5 + 15*t^4 + 20*t^3 + 15*t^2 + 6*t + 1
```


Nope. Step by step :


```
sage: foo
sum(t^k*binomial(n - 1, k - 1), k, 1, n)
sage: foo.maxima_methods().changevar(k1==k-1, k1, k)
sum(t^(k1 + 1)*binomial(n - 1, k1), k1, 0, n - 1)
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1)
sum(t^(k1 + 1)*binomial(n1, k1), k1, 0, n1)
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold()
(t + 1)^n1*t
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1)
(t + 1)^(n - 1)*t
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1).subs(n==6)
(t + 1)^5*t
sage: foo.maxima_methods().changevar(k1==k-1, k1, k).subs(n==n1+1).unhold().subs(n1==n-1).subs(n==6).expand()
t^6 + 5*t^5 + 10*t^4 + 10*t^3 + 5*t^2 + t
```


You:

>This is not the same answer, which means that the two sums are mathematically different. On the other hand, replacing n with 6 in the sum I suggested gives:

```
sage: sum(t^(k)*binomial(6-1, k), k, 0, 6-1)
t^5 + 5*t^4 + 10*t^3 + 10*t^2 + 5*t + 1
```


Nope :

```
             +-- By your logic, this should be k-1,
             |                           +-- and this should be 6 !
             V                           V
sage: sum(t^(k)*binomial(6-1, k), k, 0, 6-1)
t^5 + 5*t^4 + 10*t^3 + 10*t^2 + 5*t + 1
```

By the way :

```
sage: sum(t^(k-1)*binomial(6-1, k), k, 0, 6).expand()
t^4 + 5*t^3 + 10*t^2 + 10*t + 1/t + 5
```


> I don't think I need to re-read my code

I'm devastated to be of a different opinion...



---

archive/issue_comments_450964.json:
```json
{
    "body": "I apologize for the confusion that my comments have caused, and that I got us sidetracked from finding (and fixing) bugs in the sage code. Let's focus on finding the problem.",
    "created_at": "2021-05-24T06:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450964",
    "user": "https://github.com/DaveWitteMorris"
}
```

I apologize for the confusion that my comments have caused, and that I got us sidetracked from finding (and fixing) bugs in the sage code. Let's focus on finding the problem.



---

archive/issue_comments_450965.json:
```json
{
    "body": "I also apologize for saying \"Contrary to what is said in the description ...\".  I should have chosen my words more carefully when trying to call attention to a closely related sum that still exhibited the bug. I certainly agree that the second sum in the ticket description can be obtained from the original sum by substitutions, and that sage evaluates it correctly (and that this was a very helpful observation!).",
    "created_at": "2021-05-24T17:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450965",
    "user": "https://github.com/DaveWitteMorris"
}
```

I also apologize for saying "Contrary to what is said in the description ...".  I should have chosen my words more carefully when trying to call attention to a closely related sum that still exhibited the bug. I certainly agree that the second sum in the ticket description can be obtained from the original sum by substitutions, and that sage evaluates it correctly (and that this was a very helpful observation!).



---

archive/issue_comments_450966.json:
```json
{
    "body": "I think this is a maxima bug, after all:\n\n```\nsage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='maxima')\n0\n```\n\nI confirmed this by testing directly in maxima:\n\n```\n(%i8)\tload(\"simplify_sum\");\n(%o8)\t\"/Applications/Maxima.app/Contents/Resources/opt/share/maxima/5.43.0/share/solve_rec/simplify_sum.mac\"\n(%i9)\tsimplify_sum(sum(t^(k-1)*binomial(n-1, k-1), k, 1, n));\n(%o9)\t0\n```\n\nFor comparison:\n\n```\nsage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='maple')\n(t + 1)^(n - 1)\n\nsage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='giac')\n(t + 1)^(n - 1)\n\nsage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='sympy')\n     ...\nAttributeError: Unable to convert SymPy result (=Piecewise((t*(t + 1)**(n - 1), ((Abs(t) <= 1) & (re(n) - 1 > 0)) | ((Abs(t) < 1) & (re(n) - 1 <= -1)) | (Ne(t, -1) & (Abs(t) <= 1) & (re(n) - 1 <= 0) & (re(n) - 1 > -1))), (Sum(t**k*binomial(n - 1, k - 1), (k, 1, n)), True))/t) into Sage\n```\n\nI don't have mathematica, so I didn't test `algorithm='mathematica'`, but it gave the correct result in comment:4, so it must be fine.",
    "created_at": "2021-05-25T20:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450966",
    "user": "https://github.com/DaveWitteMorris"
}
```

I think this is a maxima bug, after all:

```
sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='maxima')
0
```

I confirmed this by testing directly in maxima:

```
(%i8)	load("simplify_sum");
(%o8)	"/Applications/Maxima.app/Contents/Resources/opt/share/maxima/5.43.0/share/solve_rec/simplify_sum.mac"
(%i9)	simplify_sum(sum(t^(k-1)*binomial(n-1, k-1), k, 1, n));
(%o9)	0
```

For comparison:

```
sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='maple')
(t + 1)^(n - 1)

sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='giac')
(t + 1)^(n - 1)

sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='sympy')
     ...
AttributeError: Unable to convert SymPy result (=Piecewise((t*(t + 1)**(n - 1), ((Abs(t) <= 1) & (re(n) - 1 > 0)) | ((Abs(t) < 1) & (re(n) - 1 <= -1)) | (Ne(t, -1) & (Abs(t) <= 1) & (re(n) - 1 <= 0) & (re(n) - 1 > -1))), (Sum(t**k*binomial(n - 1, k - 1), (k, 1, n)), True))/t) into Sage
```

I don't have mathematica, so I didn't test `algorithm='mathematica'`, but it gave the correct result in comment:4, so it must be fine.



---

archive/issue_comments_450967.json:
```json
{
    "body": "You may be right :\n\nReplying to [comment:9 gh-DaveWitteMorris]:\n> I think this is a maxima bug, after all:\n> {{{\n> sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='maxima')\n> 0\n> }}}\n> I confirmed this by testing directly in maxima:\n> {{{\n> (%i8)\tload(\"simplify_sum\");\n> (%o8)\t\"/Applications/Maxima.app/Contents/Resources/opt/share/maxima/5.43.0/share/solve_rec/simplify_sum.mac\"\n> (%i9)\tsimplify_sum(sum(t^(k-1)*binomial(n-1, k-1), k, 1, n));\n> (%o9)\t0\n> }}}\n\nBy the way, addressing the general case :\n\n\n```\nsage: var(\"t, n, k, j\");\nsage: sum(t^(k - j)*binomial(n - j, k-j), k, j, n)\nsum(t^(-j + k)*binomial(-j + n, -j + k), k, j, n)\nsage: maxima_calculus.interact()\n\n  --> Switching to Maxima_lib <--\n\nmaxima_lib: load(\"simplify_sum\");\n\\\"/usr/local/sage-9/local/share/maxima/5.44.0/share/solve_rec/simplify_sum.mac\\\"\nmaxima_lib: simplify_sum(sum(binomial(n - j, k - j)*t^(k - j), k, j, n));\n'sum(binomial(n-j,k-j)*t^(k-j),k,j,n)\nmaxima_lib: subst([nj = n-j], simplify_sum(subst([n = nj+j],changevar(sum(binomial(n - j, k - j)*t^(k - j), k, j, n), kj = k - j, kj, k))));\n(t+1)^(n-j)\nmaxima_lib: \n  --> Exiting back to Sage <--\n```\n\n\n\n> For comparison:\n> {{{\n> sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='maple')\n> (t + 1)^(n - 1)\n> \n> sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='giac')\n> (t + 1)^(n - 1)\n> \n> sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='sympy')\n>      ...\n> AttributeError: Unable to convert SymPy result (=Piecewise((t*(t + 1)**(n - 1), ((Abs(t) <= 1) & (re(n) - 1 > 0)) | ((Abs(t) < 1) & (re(n) - 1 <= -1)) | (Ne(t, -1) & (Abs(t) <= 1) & (re(n) - 1 <= 0) & (re(n) - 1 > -1))), (Sum(t**k*binomial(n - 1, k - 1), (k, 1, n)), True))/t) into Sage\n\nThe latter can be (penibly) generalized as :\n\n\n```\nsage: from sympy import sympify, Sum as SSum\nsage: %time SSum(*map(sympify, (t^(k - j)*binomial(n - j, k-j), (k, j, n)))).doit().simplify().args[0][0]._sage_()\nCPU times: user 13.6 s, sys: 0 ns, total: 13.6 s\nWall time: 13.6 s\n(t + 1)^(-j + n)\n```\n\n\n\n> I don't have mathematica,\n\nwhich isn' //that// hard to steal ;-)\n\n> so I didn't test `algorithm='mathematica'`, but it gave the correct result in comment:4, so it must be fine.",
    "created_at": "2021-05-25T22:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450967",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

You may be right :

Replying to [comment:9 gh-DaveWitteMorris]:
> I think this is a maxima bug, after all:
> {{{
> sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='maxima')
> 0
> }}}
> I confirmed this by testing directly in maxima:
> {{{
> (%i8)	load("simplify_sum");
> (%o8)	"/Applications/Maxima.app/Contents/Resources/opt/share/maxima/5.43.0/share/solve_rec/simplify_sum.mac"
> (%i9)	simplify_sum(sum(t^(k-1)*binomial(n-1, k-1), k, 1, n));
> (%o9)	0
> }}}

By the way, addressing the general case :


```
sage: var("t, n, k, j");
sage: sum(t^(k - j)*binomial(n - j, k-j), k, j, n)
sum(t^(-j + k)*binomial(-j + n, -j + k), k, j, n)
sage: maxima_calculus.interact()

  --> Switching to Maxima_lib <--

maxima_lib: load("simplify_sum");
\"/usr/local/sage-9/local/share/maxima/5.44.0/share/solve_rec/simplify_sum.mac\"
maxima_lib: simplify_sum(sum(binomial(n - j, k - j)*t^(k - j), k, j, n));
'sum(binomial(n-j,k-j)*t^(k-j),k,j,n)
maxima_lib: subst([nj = n-j], simplify_sum(subst([n = nj+j],changevar(sum(binomial(n - j, k - j)*t^(k - j), k, j, n), kj = k - j, kj, k))));
(t+1)^(n-j)
maxima_lib: 
  --> Exiting back to Sage <--
```



> For comparison:
> {{{
> sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='maple')
> (t + 1)^(n - 1)
> 
> sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='giac')
> (t + 1)^(n - 1)
> 
> sage: symbolic_sum(t^(k-1)*binomial(n - 1, k - 1), k, 1, n, algorithm='sympy')
>      ...
> AttributeError: Unable to convert SymPy result (=Piecewise((t*(t + 1)**(n - 1), ((Abs(t) <= 1) & (re(n) - 1 > 0)) | ((Abs(t) < 1) & (re(n) - 1 <= -1)) | (Ne(t, -1) & (Abs(t) <= 1) & (re(n) - 1 <= 0) & (re(n) - 1 > -1))), (Sum(t**k*binomial(n - 1, k - 1), (k, 1, n)), True))/t) into Sage

The latter can be (penibly) generalized as :


```
sage: from sympy import sympify, Sum as SSum
sage: %time SSum(*map(sympify, (t^(k - j)*binomial(n - j, k-j), (k, j, n)))).doit().simplify().args[0][0]._sage_()
CPU times: user 13.6 s, sys: 0 ns, total: 13.6 s
Wall time: 13.6 s
(t + 1)^(-j + n)
```



> I don't have mathematica,

which isn' //that// hard to steal ;-)

> so I didn't test `algorithm='mathematica'`, but it gave the correct result in comment:4, so it must be fine.



---

archive/issue_comments_450968.json:
```json
{
    "body": "This is also Maxima bug [3788](https://sourceforge.net/p/maxima/bugs/3788/).",
    "created_at": "2021-05-25T22:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450968",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

This is also Maxima bug [3788](https://sourceforge.net/p/maxima/bugs/3788/).



---

archive/issue_comments_450969.json:
```json
{
    "body": "Thanks for making the upstream report!",
    "created_at": "2021-05-26T01:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450969",
    "user": "https://github.com/DaveWitteMorris"
}
```

Thanks for making the upstream report!



---

archive/issue_comments_450970.json:
```json
{
    "body": "Changing keywords from \"summation binomial\" to \"summation, binomial, maxima\".",
    "created_at": "2021-05-26T01:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450970",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing keywords from "summation binomial" to "summation, binomial, maxima".



---

archive/issue_comments_450971.json:
```json
{
    "body": "Replying to [comment:3 gh-DaveWitteMorris]:\n\n> Contrary to what is said in the description,\n> the \"equivalent sum obtained by shifting the\n> summation index\" is not correct.\n\nApologies for an earlier misleading edit to the\nticket description. If I understand correctly,\nthe sum earlier described as an \"equivalent sum\nobtained by shifting the summation index\" is\nindeed correctly computed, but not equivalent\nto the buggy one. Description amended now.",
    "created_at": "2021-05-26T23:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31607#issuecomment-450971",
    "user": "https://github.com/slel"
}
```

Replying to [comment:3 gh-DaveWitteMorris]:

> Contrary to what is said in the description,
> the "equivalent sum obtained by shifting the
> summation index" is not correct.

Apologies for an earlier misleading edit to the
ticket description. If I understand correctly,
the sum earlier described as an "equivalent sum
obtained by shifting the summation index" is
indeed correctly computed, but not equivalent
to the buggy one. Description amended now.



---

archive/issue_events_084104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31607#event-84104"
}
```



---

archive/issue_events_084105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31607#event-84105"
}
```



---

archive/issue_events_084106.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:41:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31607#event-84106"
}
```



---

archive/issue_events_084107.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31607#event-84107"
}
```



---

archive/issue_events_084108.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31607#event-84108"
}
```



---

archive/issue_events_084109.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31607#event-84109"
}
```



---

archive/issue_events_084110.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/31607",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/31607#event-84110"
}
```
