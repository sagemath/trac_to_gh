# Issue 23213: Smith form of p-adic matrices

archive/issues_023213.json:
```json
{
    "body": "CC:  roed saraedum tristanvaccon kedlaya\n\nKeywords: sd87\n\nCurrently Smith form are not implemented over inexact rings.\n\nThis ticket provides a (currently unoptimized) implementation of Smith normal form over complete discrete valuation rings/fields (e.g. p-adic rings/fields), together with a new implementation of the method `determinant` making use of Smith normal form and improving this way its behaviour regarding precision.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23450\n\n",
    "created_at": "2017-07-18T04:41:54Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "Smith form of p-adic matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23213",
    "user": "caruso"
}
```
CC:  roed saraedum tristanvaccon kedlaya

Keywords: sd87

Currently Smith form are not implemented over inexact rings.

This ticket provides a (currently unoptimized) implementation of Smith normal form over complete discrete valuation rings/fields (e.g. p-adic rings/fields), together with a new implementation of the method `determinant` making use of Smith normal form and improving this way its behaviour regarding precision.

Issue created by migration from https://trac.sagemath.org/ticket/23450





---

archive/issue_comments_324748.json:
```json
{
    "body": "This is great. I was hoping that you would implement this for a while ;)\n\nHave you thought about not creating a separate class for this but implementing it in the base ring (or in the category), i.e., provide `_matrix_smith_form` on the ring/category and call it from the generic matrix code if it is defined (otherwise fall back to the generic implementation). In other words, do what is already done for things like polynomial factorization.\n\nAlso, should this code be used for \"exact\" CDVRs such as the ones backed by absolute number fields?\n----\nNew commits:",
    "created_at": "2017-07-18T06:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324748",
    "user": "saraedum"
}
```

This is great. I was hoping that you would implement this for a while ;)

Have you thought about not creating a separate class for this but implementing it in the base ring (or in the category), i.e., provide `_matrix_smith_form` on the ring/category and call it from the generic matrix code if it is defined (otherwise fall back to the generic implementation). In other words, do what is already done for things like polynomial factorization.

Also, should this code be used for "exact" CDVRs such as the ones backed by absolute number fields?
----
New commits:



---

archive/issue_comments_324749.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to padics.",
    "created_at": "2017-07-18T15:11:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324749",
    "user": "saraedum"
}
```

Changing component from PLEASE CHANGE to padics.



---

archive/issue_comments_324750.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-19T04:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324750",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324751.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-19T05:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324751",
    "user": "caruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_324752.json:
```json
{
    "body": "Ok, I've moved the code to the category (CDVF and CDVR) as you suggested.\n\nI've also tried to be more rigourous regarding precision and figured out what is the correct precision on the transformation matrices. (My first implementation was too optimistic.) Actually, it turns out that finding the optimal precision is costly, except in the particular case where the input matrix is given at flat precision (i.e. all the entries are given at the same precision). For this reason, I've overestimated the loss of precision for a general input matrix (by reducing to the case of flat precision).\n\nI've also removed the method that computes the determinant of a matrix because again it only worked for matrices given at flat precision.\n\nThe ticket is ready for review.",
    "created_at": "2017-07-19T05:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324752",
    "user": "caruso"
}
```

Ok, I've moved the code to the category (CDVF and CDVR) as you suggested.

I've also tried to be more rigourous regarding precision and figured out what is the correct precision on the transformation matrices. (My first implementation was too optimistic.) Actually, it turns out that finding the optimal precision is costly, except in the particular case where the input matrix is given at flat precision (i.e. all the entries are given at the same precision). For this reason, I've overestimated the loss of precision for a general input matrix (by reducing to the case of flat precision).

I've also removed the method that computes the determinant of a matrix because again it only worked for matrices given at flat precision.

The ticket is ready for review.



---

archive/issue_comments_324753.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-19T20:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324753",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-20T02:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324754",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324755.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-20T05:39:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324755",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324756.json:
```json
{
    "body": "I think (hope) that this ticket is now *really* ready for review :-)",
    "created_at": "2017-07-20T05:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324756",
    "user": "caruso"
}
```

I think (hope) that this ticket is now *really* ready for review :-)



---

archive/issue_comments_324757.json:
```json
{
    "body": "I'll try to review this tomorrow.",
    "created_at": "2017-07-20T06:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324757",
    "user": "saraedum"
}
```

I'll try to review this tomorrow.



---

archive/issue_comments_324758.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-20T15:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324758",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324759.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-20T16:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324759",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324760.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T00:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324760",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324761.json:
```json
{
    "body": "Xavier, I am refactoring this a fair bit. Hope you don't mind.",
    "created_at": "2017-07-21T15:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324761",
    "user": "saraedum"
}
```

Xavier, I am refactoring this a fair bit. Hope you don't mind.



---

archive/issue_comments_324762.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-21T15:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324762",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_324763.json:
```json
{
    "body": "(and sorry, the category idea was a very bad call. I'm fixing it right now.)",
    "created_at": "2017-07-21T16:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324763",
    "user": "saraedum"
}
```

(and sorry, the category idea was a very bad call. I'm fixing it right now.)



---

archive/issue_comments_324764.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-07-21T16:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324764",
    "user": "saraedum"
}
```

New commits:



---

archive/issue_comments_324765.json:
```json
{
    "body": "\n```\nsage -t --warn-long 61.6 src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed\nsage -t --warn-long 61.6 src/sage/rings/padics/padic_extension_leaves.py  # 2 doctests failed\n```\n",
    "created_at": "2017-07-21T16:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324765",
    "user": "saraedum"
}
```


```
sage -t --warn-long 61.6 src/sage/rings/padics/padic_base_leaves.py  # 3 doctests failed
sage -t --warn-long 61.6 src/sage/rings/padics/padic_extension_leaves.py  # 2 doctests failed
```




---

archive/issue_comments_324766.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T16:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324766",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324767.json:
```json
{
    "body": "The problem is always:\n\n```\n    Failure in _test_matrix_smith:\n    Traceback (most recent call last):\n      File \"/projects/da1818ed-996d-4de6-acc6-361415b7725d/Src/sage-saraedum/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py\", line 293, in run\n        test_method(tester = tester)\n      File \"/projects/da1818ed-996d-4de6-acc6-361415b7725d/Src/sage-saraedum/local/lib/python2.7/site-packages/sage/rings/padics/local_generic.py\", line 768, in _test_matrix_smith\n        S,U,V = M.smith_form()\n      File \"sage/matrix/matrix2.pyx\", line 13267, in sage.matrix.matrix2.Matrix.smith_form (/projects/da1818ed-996d-4de6-acc6-361415b7725d/Src/sage-saraedum/src/build/cythonized/sage/matrix/matrix2.c:94870)\n        return R._matrix_smith_form(self,transformation=transformation)\n      File \"/projects/da1818ed-996d-4de6-acc6-361415b7725d/Src/sage-saraedum/local/lib/python2.7/site-packages/sage/rings/padics/local_generic.py\", line 727, in _matrix_smith_form\n        inv = (S[piv,piv] >> val).inverse_of_unit()\n      File \"sage/rings/padics/local_generic_element.pyx\", line 160, in sage.rings.padics.local_generic_element.LocalGenericElement.inverse_of_unit (build/cythonized/sage/rings/padics/local_generic_element.c:2339)\n        raise ZeroDivisionError(\"Inverse does not exist.\")\n    ZeroDivisionError: Inverse does not exist.\n```\n",
    "created_at": "2017-07-21T16:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324767",
    "user": "saraedum"
}
```

The problem is always:

```
    Failure in _test_matrix_smith:
    Traceback (most recent call last):
      File "/projects/da1818ed-996d-4de6-acc6-361415b7725d/Src/sage-saraedum/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 293, in run
        test_method(tester = tester)
      File "/projects/da1818ed-996d-4de6-acc6-361415b7725d/Src/sage-saraedum/local/lib/python2.7/site-packages/sage/rings/padics/local_generic.py", line 768, in _test_matrix_smith
        S,U,V = M.smith_form()
      File "sage/matrix/matrix2.pyx", line 13267, in sage.matrix.matrix2.Matrix.smith_form (/projects/da1818ed-996d-4de6-acc6-361415b7725d/Src/sage-saraedum/src/build/cythonized/sage/matrix/matrix2.c:94870)
        return R._matrix_smith_form(self,transformation=transformation)
      File "/projects/da1818ed-996d-4de6-acc6-361415b7725d/Src/sage-saraedum/local/lib/python2.7/site-packages/sage/rings/padics/local_generic.py", line 727, in _matrix_smith_form
        inv = (S[piv,piv] >> val).inverse_of_unit()
      File "sage/rings/padics/local_generic_element.pyx", line 160, in sage.rings.padics.local_generic_element.LocalGenericElement.inverse_of_unit (build/cythonized/sage/rings/padics/local_generic_element.c:2339)
        raise ZeroDivisionError("Inverse does not exist.")
    ZeroDivisionError: Inverse does not exist.
```




---

archive/issue_comments_324768.json:
```json
{
    "body": "Xavier: I am a bit confused. Is `integral_smith_form` the same as `change_ring(integer_ring).smith_form`?",
    "created_at": "2017-07-21T20:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324768",
    "user": "saraedum"
}
```

Xavier: I am a bit confused. Is `integral_smith_form` the same as `change_ring(integer_ring).smith_form`?



---

archive/issue_comments_324769.json:
```json
{
    "body": "If the coefficients of the matrix lie in the integer ring, it is. But `integral_smith_form` is defined for any matrix defined over the fraction field.",
    "created_at": "2017-07-21T20:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324769",
    "user": "caruso"
}
```

If the coefficients of the matrix lie in the integer ring, it is. But `integral_smith_form` is defined for any matrix defined over the fraction field.



---

archive/issue_comments_324770.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T20:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324770",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324771.json:
```json
{
    "body": "Ok. I got confused by the comment:\n\n```\n- if `d_i` denotes the `(i,i)` entry of `S`, then `d_i`\ndivides `d_{i+1}` in the ring of integers for all `i`.\n```\n\n----\nNew commits:",
    "created_at": "2017-07-21T21:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324771",
    "user": "saraedum"
}
```

Ok. I got confused by the comment:

```
- if `d_i` denotes the `(i,i)` entry of `S`, then `d_i`
divides `d_{i+1}` in the ring of integers for all `i`.
```

----
New commits:



---

archive/issue_comments_324772.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T21:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324772",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324773.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T22:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324773",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324774.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T22:20:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324774",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324775.json:
```json
{
    "body": "Xavier: That's about what I had in mind. What do you think? (There are still some failing tests.)",
    "created_at": "2017-07-21T22:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324775",
    "user": "saraedum"
}
```

Xavier: That's about what I had in mind. What do you think? (There are still some failing tests.)



---

archive/issue_comments_324776.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-21T22:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324776",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_324777.json:
```json
{
    "body": "Ok for factoring the code this way if you prefer.\n\nHowever, I think that the current code doesn't output the expected answer for matrices over Qp with `integral=None` (though I haven't checked it). In that case, I would say that the entries of Smith normal norm should all be 0 or 1.\n\nIn the doctest, I think that we should precise that we require (1) that the matrices U and V are invertible over the subring and (2) that d_{i+1}/d_i lies in the subring for all i.",
    "created_at": "2017-07-21T22:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324777",
    "user": "caruso"
}
```

Ok for factoring the code this way if you prefer.

However, I think that the current code doesn't output the expected answer for matrices over Qp with `integral=None` (though I haven't checked it). In that case, I would say that the entries of Smith normal norm should all be 0 or 1.

In the doctest, I think that we should precise that we require (1) that the matrices U and V are invertible over the subring and (2) that d_{i+1}/d_i lies in the subring for all i.



---

archive/issue_comments_324778.json:
```json
{
    "body": "Xavier: Could you write something about what it means for an entry on the diagonal to be zero (in the field case)? I mean it is somewhat unclear since we compute with inexact elements.",
    "created_at": "2017-07-22T15:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324778",
    "user": "saraedum"
}
```

Xavier: Could you write something about what it means for an entry on the diagonal to be zero (in the field case)? I mean it is somewhat unclear since we compute with inexact elements.



---

archive/issue_comments_324779.json:
```json
{
    "body": "doc does not build\n\n```\n+[dochtml] [matrices ] docstring of sage.matrix.matrix2.Matrix.smith_form:26: WARNING: Bullet list ends without a blank line; unexpected unindent.\n+[dochtml] [matrices ] docstring of sage.matrix.matrix2.Matrix.smith_form:29: WARNING: Bullet list ends without a blank line; unexpected unindent.\n```\n\nThe issue is in the INPUT field there.",
    "created_at": "2017-08-25T06:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324779",
    "user": "chapoton"
}
```

doc does not build

```
+[dochtml] [matrices ] docstring of sage.matrix.matrix2.Matrix.smith_form:26: WARNING: Bullet list ends without a blank line; unexpected unindent.
+[dochtml] [matrices ] docstring of sage.matrix.matrix2.Matrix.smith_form:29: WARNING: Bullet list ends without a blank line; unexpected unindent.
```

The issue is in the INPUT field there.



---

archive/issue_comments_324780.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-08-25T17:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324780",
    "user": "aly.deines"
}
```

New commits:



---

archive/issue_comments_324781.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-25T17:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324781",
    "user": "aly.deines"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_324782.json:
```json
{
    "body": "Changed to needs work because of above issues.",
    "created_at": "2017-08-25T17:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324782",
    "user": "aly.deines"
}
```

Changed to needs work because of above issues.



---

archive/issue_comments_324783.json:
```json
{
    "body": "*ping* - I could really use this p-adic smith form. (over `ZZp`)\nNeed help? (not an expert though)",
    "created_at": "2017-10-27T10:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324783",
    "user": "sbrandhorst"
}
```

*ping* - I could really use this p-adic smith form. (over `ZZp`)
Need help? (not an expert though)



---

archive/issue_comments_324784.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-12-05T14:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324784",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_324785.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-12-05T14:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324785",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_324786.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-12-05T14:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324786",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_324787.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-08T12:43:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324787",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324788.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T14:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324788",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324789.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T15:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324789",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T15:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324790",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324791.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T17:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324791",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324792.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-28T13:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324792",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324793.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-28T13:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324793",
    "user": "roed"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_324794.json:
```json
{
    "body": "If Xavier is happy with my changes, I'm happy to give this positive review.",
    "created_at": "2018-02-28T13:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324794",
    "user": "roed"
}
```

If Xavier is happy with my changes, I'm happy to give this positive review.



---

archive/issue_comments_324795.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-28T15:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324795",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324796.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-28T16:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324796",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324797.json:
```json
{
    "body": "I've fixed a small issue with precision.\n\nNow, everything seems fine to me. I let you give a positive review if you're OK (and if the patchbot is happy)",
    "created_at": "2018-02-28T16:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324797",
    "user": "caruso"
}
```

I've fixed a small issue with precision.

Now, everything seems fine to me. I let you give a positive review if you're OK (and if the patchbot is happy)



---

archive/issue_comments_324798.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-28T19:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324798",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_324799.json:
```json
{
    "body": "Patchbot is green, so positive review.",
    "created_at": "2018-02-28T19:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324799",
    "user": "roed"
}
```

Patchbot is green, so positive review.



---

archive/issue_comments_324800.json:
```json
{
    "body": "Tests fail\n\n```\n    UnboundLocalError: local variable 'precM' referenced before assignment\n```\n",
    "created_at": "2018-03-20T23:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324800",
    "user": "vbraun"
}
```

Tests fail

```
    UnboundLocalError: local variable 'precM' referenced before assignment
```




---

archive/issue_comments_324801.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-03-20T23:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324801",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_324802.json:
```json
{
    "body": "Let me add a bit of details, 6 doctests fails\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/rings/padics/padic_lattice_element.py  # 4 doctests failed\nsage -t --long /usr/lib64/python2.7/site-packages/sage/rings/padics/padic_base_leaves.py  # 2 doctests failed\n```\n\n and they all fail the same way\n\n```\nFile \"/usr/lib64/python2.7/site-packages/sage/rings/padics/padic_base_leaves.py\", line 879, in sage.rings.padics.padic_base_leaves.pAdicRingLattice.__init__\nFailed example:\n    TestSuite(R).run(skip='_test_teichmuller')\nExpected nothing\nGot:\n    Failure in _test_matrix_smith:\n    Traceback (most recent call last):\n      File \"/usr/lib64/python2.7/site-packages/sage/misc/sage_unittest.py\", line 294, in run\n        test_method(tester = tester)\n      File \"/usr/lib64/python2.7/site-packages/sage/rings/padics/local_generic.py\", line 1248, in _test_matrix_smith\n        S,U,V = M.smith_form(integral=base)\n      File \"sage/matrix/matrix2.pyx\", line 13416, in sage.matrix.matrix2.Matrix.smith_form (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/matrix/matrix2.c:96167)\n        return R._matrix_smith_form(self, transformation=transformation, integral=integral, exact=exact)\n      File \"/usr/lib64/python2.7/site-packages/sage/rings/padics/local_generic.py\", line 1148, in _matrix_smith_form\n        if inexact_ring and not allzero and val >= precM:\n    UnboundLocalError: local variable 'precM' referenced before assignment\n    ------------------------------------------------------------\n    The following tests failed: _test_matrix_smith\n```\n\nending in `local_generic.py`.",
    "created_at": "2018-03-21T00:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324802",
    "user": "fbissey"
}
```

Let me add a bit of details, 6 doctests fails

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/rings/padics/padic_lattice_element.py  # 4 doctests failed
sage -t --long /usr/lib64/python2.7/site-packages/sage/rings/padics/padic_base_leaves.py  # 2 doctests failed
```

 and they all fail the same way

```
File "/usr/lib64/python2.7/site-packages/sage/rings/padics/padic_base_leaves.py", line 879, in sage.rings.padics.padic_base_leaves.pAdicRingLattice.__init__
Failed example:
    TestSuite(R).run(skip='_test_teichmuller')
Expected nothing
Got:
    Failure in _test_matrix_smith:
    Traceback (most recent call last):
      File "/usr/lib64/python2.7/site-packages/sage/misc/sage_unittest.py", line 294, in run
        test_method(tester = tester)
      File "/usr/lib64/python2.7/site-packages/sage/rings/padics/local_generic.py", line 1248, in _test_matrix_smith
        S,U,V = M.smith_form(integral=base)
      File "sage/matrix/matrix2.pyx", line 13416, in sage.matrix.matrix2.Matrix.smith_form (/dev/shm/portage/sci-mathematics/sage-9999/work/sage-9999/src-python2_7/build/cythonized/sage/matrix/matrix2.c:96167)
        return R._matrix_smith_form(self, transformation=transformation, integral=integral, exact=exact)
      File "/usr/lib64/python2.7/site-packages/sage/rings/padics/local_generic.py", line 1148, in _matrix_smith_form
        if inexact_ring and not allzero and val >= precM:
    UnboundLocalError: local variable 'precM' referenced before assignment
    ------------------------------------------------------------
    The following tests failed: _test_matrix_smith
```

ending in `local_generic.py`.



---

archive/issue_comments_324803.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-22T22:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324803",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324804.json:
```json
{
    "body": "Should be fixed.",
    "created_at": "2018-03-22T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324804",
    "user": "caruso"
}
```

Should be fixed.



---

archive/issue_comments_324805.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-22T22:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324805",
    "user": "caruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_324806.json:
```json
{
    "body": "The patchbots continue to be noisy, but this looks good to me.",
    "created_at": "2018-03-29T20:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324806",
    "user": "roed"
}
```

The patchbots continue to be noisy, but this looks good to me.



---

archive/issue_comments_324807.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-29T20:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324807",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_324808.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-08T17:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23213",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23213#issuecomment-324808",
    "user": "vbraun"
}
```

Resolution: fixed
