# Issue 14228: Hash broken for unions, intersections, differences, and symmetric differences of sets

Issue created by migration from https://trac.sagemath.org/ticket/14432

Original creator: saraedum

Original creation time: 2013-04-09 17:48:28

Assignee: sage-combinat

Keywords: hash, set

The following code raises an exception:


```
sage: S=Set(ZZ).union(Set([infinity]))
sage: hash(S)
Traceback (most recent call last):
...
RuntimeError: maximum recursion depth exceeded
```


The same should happen for intersections, differences, and symmetric differences.


---

Attachment


---

Comment by saraedum created at 2013-04-09 18:45:50

Changing status from new to needs_review.


---

Comment by saraedum created at 2013-04-09 18:48:38

I do not have access to a 32-bit machine right now. Could someone fill in the missing hash values? Is there a way to compute them from the 64-bit values btw?


---

Comment by saraedum created at 2013-04-09 18:51:19

I decided to remove some duplicated code rather than adding a `__hash__` method to all the implementations - hope that is ok.


---

Comment by tscrim created at 2013-04-09 19:11:52

To test hashing, it is better to do tests like `hash(s) == hash(s)` that do not depend upon the specific value but instead show that the object is hashable and it's value does not change.


---

Comment by saraedum created at 2013-04-09 19:21:40

That's a good point. Thanks for the input. I will change my patch accordingly.


---

Comment by saraedum created at 2013-04-09 19:21:40

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2013-08-28 14:08:22

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2013-10-28 11:09:28

This patch does not apply cleanly on 5.13.beta0. And it's probably because it contains many dependencies #14482 `O_o`


```
~/sage$ git fetch trac u/saraedum/ticket/14432:hash
remote: Counting objects: 17, done.
remote: Compressing objects: 100% (12/12), done.
remote: Total 12 (delta 10), reused 0 (delta 0)
Unpacking objects: 100% (12/12), done.
From ssh://trac.sagemath.org:2222/sage
 * [new branch]      u/saraedum/ticket/14432 -> hash
~/sage$ git merge hash
Auto-merging src/sage/sets/set.py
CONFLICT (content): Merge conflict in src/sage/sets/set.py
Auto-merging src/sage/doctest/forker.py
CONFLICT (content): Merge conflict in src/sage/doctest/forker.py
Auto-merging build/pkgs/sagenb/package-version.txt
CONFLICT (content): Merge conflict in build/pkgs/sagenb/package-version.txt
Auto-merging build/pkgs/sagenb/checksums.ini
CONFLICT (content): Merge conflict in build/pkgs/sagenb/checksums.ini
Auto-merging build/pkgs/sagenb/SPKG.txt
CONFLICT (content): Merge conflict in build/pkgs/sagenb/SPKG.txt
Automatic merge failed; fix conflicts and then commit the result.
```

----
Last 10 new commits:


---

Comment by ncohen created at 2013-10-28 11:10:24

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-06-26 05:34:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2014-06-26 05:35:14

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2014-06-26 05:35:14

Changing keywords from "hash, set" to "hash, set, sd59".


---

Comment by tscrim created at 2014-07-02 16:33:45

I've made some minor review tweaks. If you're happy with them, then positive review.
----
New commits:


---

Comment by git created at 2014-07-02 16:35:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2015-01-22 20:52:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-01-24 13:18:41

Resolution: fixed
