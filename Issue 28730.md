# Issue 28730: implement easy cases of inverse_mod for general commutative rings

Issue created by migration from https://trac.sagemath.org/ticket/28967

Original creator: @DaveWitteMorris

Original creation time: 2020-01-07 19:25:28

The definition of `inverse_mod(x, I)` for the class `CommutativeRingElement` always raises a `NotImplementedError`. It would be better to return the correct value in the easy cases (when `x` is a unit, or `x` is in `I`). This would provide a complete implementation for fields.


---

Comment by @DaveWitteMorris created at 2020-01-07 20:33:41

Changing status from new to needs_review.


---

Comment by @DaveWitteMorris created at 2020-01-07 20:33:41

New commits:


---

Comment by @DaveWitteMorris created at 2020-01-07 22:00:26

Failed doctest (because I fixed a typo and didn't notice it was in a doctest).  Also, probably should have a better error message for commutative rings that do not implement `is_unit`.


---

Comment by @DaveWitteMorris created at 2020-01-07 22:00:26

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-01-08 00:21:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2020-01-08 00:25:47

Slightly improved the handling of `is_unit`, and changed the `ValueError` message to match the one given by univariate polynomial rings. Ticket #28969 should fix the doctest error.


---

Comment by @DaveWitteMorris created at 2020-01-08 00:25:47

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2020-01-14 17:04:44

The error message `Impossible inverse modulo` is a little strange to me, and moreover from the ticket description, it does not seem correct. Could we instead change it to

```
raise NotImplementedError("unable to compute the inverse modulo this ideal")
```


On #28969, it would have been good to also remove that period at the end of it in order to follow Python's error message convention. Oh well, that already has a positive review...


---

Comment by git created at 2020-01-15 02:49:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2020-01-15 02:51:25

Being a beginner at sagemath development, I thought I should copy an error message, instead of making up my own, but, since you agree that it is weird, I will change it. However, this is a `ValueError`, not a `NotImplementedError`, because the inverse does not exist. (This error message is for the case where x is in I and I is not the entire ring. Since x is in I, we have <x,I> = I. Also, if the inverse of x modulo I exists, then <x,I>  must be the entire ring. So I = <x,I> is the entire ring, which is a contradiction.)  I changed the error message to

```
raise ValueError("An element of a proper ideal does not have an inverse modulo that ideal")
```

----
New commits:


---

Comment by tscrim created at 2020-01-15 03:08:11

Changing component from linear algebra to commutative algebra.


---

Comment by tscrim created at 2020-01-15 03:08:11

I see, I misunderstood the case. If you could just change the error message to start with a lowercase letter (this is a general Python convention we follow), then you can set a positive review.


---

Comment by git created at 2020-01-15 03:49:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2020-01-15 03:51:17

Thanks for the comments and corrections. I'll try to write error messages correctly in the future.


---

Comment by tscrim created at 2020-01-15 04:27:35

Thanks.


---

Comment by tscrim created at 2020-01-15 04:27:35

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-01-20 21:17:47

Resolution: fixed
