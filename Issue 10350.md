# Issue 10350: Fix the way sage/misc/sagedoc.py reads doc/common/builder.py

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2010-11-28 15:20:51

Assignee: mvngu

The following code from `sage/misc/sagedoc.py` is horrible:

```
        # check if any documentation is missing.  first read the start
        # of SAGE_ROOT/devel/sage/doc/common/builder.py to find list
        # of languages, documents, and documents to omit
        doc_path = os.path.join(ROOT, 'devel', 'sage', 'doc')
        builder = open(os.path.join(doc_path, 'common', 'builder.py'))
        s = builder.read()[:1000]
        builder.close()
        # list of languages
        lang = []
        idx = s.find("LANGUAGES")
        if idx != -1:
            start = s[idx:].find('[')
            end =  s[idx:].find(']')
            if start != -1 and end != -1:
                lang = s[idx+start+1:idx+end].translate(None, "'\" ").split(",")
        # documents in SAGE_ROOT/devel/sage/doc/LANG/ to omit
        omit = []
        idx = s.find("OMIT")
        if idx != -1:
            start = s[idx:].find('[')
            end =  s[idx:].find(']')
            if start != -1 and end != -1:
                omit = s[idx+start+1:idx+end].translate(None, "'\" ").split(",")
```



---

Comment by jdemeyer created at 2010-11-28 18:46:54

Changing status from new to needs_review.


---

Comment by mhansen created at 2010-11-28 19:11:23

Changing status from needs_review to needs_work.


---

Comment by mhansen created at 2010-11-28 19:11:23

The method of saving the old path in this patch doesn't work since `oldpath = sys.path` has them both "pointing" to the same object.  Then, when you change `sys.path`, you also change `oldpath`.  You could change it to something like `oldpath = sys.path[:]`


---

Comment by jdemeyer created at 2010-11-28 22:11:33

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2010-11-28 22:11:33

Replying to [comment:2 mhansen]:
> The method of saving the old path in this patch doesn't work since `oldpath = sys.path` has them both "pointing" to the same object.  Then, when you change `sys.path`, you also change `oldpath`.  You could change it to something like `oldpath = sys.path[:]`

Thanks!  I've solved the problem with

```
sys.path = oldpath + [os.path.join(ROOT, 'devel', 'sage', 'doc', 'common')]
```



---

Comment by leif created at 2010-11-29 19:19:58

I wonder if the docbuilder "options" should go into a separate file, such that we don't (have to) import the whole `builder.py`.


---

Comment by jdemeyer created at 2010-11-29 20:02:00

Replying to [comment:4 leif]:
> I wonder if the docbuilder "options" should go into a separate file, such that we don't (have to) import the whole `builder.py`.

That's a possibility, but I think the current approach works fine (and `builder.py` is not such a big file).


---

Comment by leif created at 2010-11-29 20:15:18

Replying to [comment:5 jdemeyer]:
> Replying to [comment:4 leif]:
> > I wonder if the docbuilder "options" should go into a separate file, such that we don't (have to) import the whole `builder.py`.
> 
> That's a possibility, but I think the current approach works fine (and `builder.py` is not such a big file).

Well, importing the whole file could have very strange side-effects, at least in the future.

Another reason is users are likely to edit (just) these options. (Which however is sub-optimal by itself...)


---

Comment by jdemeyer created at 2010-11-29 20:20:23

I can see your point, maybe it would not be a bad idea to split the configuration from the code...


---

Comment by jdemeyer created at 2010-12-02 14:52:33

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2011-01-20 17:04:19

Changing status from needs_work to needs_review.


---

Attachment

SAGELIB patch


---

Comment by vbraun created at 2011-02-01 17:31:29

Definite improvement ;-)


---

Comment by vbraun created at 2011-02-01 17:31:29

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-02-07 08:14:10

Resolution: fixed
