# Issue 23527: deal with '-' in pip package names

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2017-08-31 09:34:15

CC:  fbissey embray jdemeyer mkoeppe

It is not uncommon for pip package names to have `-` in the name, e.g. `sphinxcontrib-websupport` that popped up on #14645.
However, currently there is no way to have Sage package of type `pip`
that would be the equivalent of the explicit call

```
./sage --pip install sphinxcontrib-websupport
```

as `-` is not allowed in Sage package names, at least
an attempt to specify `sphinxcontrib-websupport` in a Sage package
dependencies produces an error.


---

Comment by jdemeyer created at 2017-08-31 09:40:24

I don't really see this as a problem, for me it is "wontfix". The `pip` package thing was just a quick fix to add a bunch of packages easily. If it can't be a `pip` package, just make it an `optional` package, using a name like `sphinxcontrib_websupport`.


---

Comment by dimpase created at 2017-08-31 09:45:29

I suppose I can add this as a feature of packages of this type - the ability to have the actual name different from the Sage package name, it's the question where in the Sage source these changes should go to, can you point this out?


---

Comment by jdemeyer created at 2017-08-31 09:49:55

Replying to [comment:2 dimpase]:
> I suppose I can add *this* as a feature of packages of *this* type - the ability to have the actual name different from the Sage package name, it's the question where in the Sage source *these* changes should go to, can you point this out?

I don't understand this sentence, there are too much unspecified words like "this" and "these".


---

Comment by embray created at 2017-08-31 09:58:08

I'm sort of torn on this.  I agree with Jeroen that the 'pip' type package is kind of a hack in the first place.  But on the other hand, it is very convenient, as it avoids a lot of boilerplate.  Either way it doesn't belong as a package 'type' since it's not in the same category as "standard/optional/experimental".  We've talked about that before.  So for that reason alone it's probably better to just deprecated it.  But there should still be an easy, "one click" solution for making an spkg out of Python packages on PyPI.


---

Comment by dimpase created at 2017-08-31 10:06:21

Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 dimpase]:
> > I suppose I can add *this* as a feature of packages of *this* type - the ability to have the actual name different from the Sage package name, it's the question where in the Sage source *these* changes should go to, can you point this out?
> 
> I don't understand this sentence, there are too much unspecified words like "this" and "these".

*this* is an ability to specify the (external) pip package name which is not equal to the Sage package name of type pip. Such an ability would allow handling `-` in the (external) pip package names.

But I have no idea where things dealing with packages of type `pip` are handled in the build system and how - thus I ask for some pointers to the latter.


---

Comment by dimpase created at 2017-08-31 10:19:13

Another solution is to make '-' acceptable in Sage package names - I really don't know how much work this is and where to start.


---

Comment by jdemeyer created at 2017-08-31 10:28:24

Replying to [comment:6 dimpase]:
> Another solution is to make '-' acceptable in Sage package names - I really don't know how much work this is and where to start.

The problem is that `-` is used as a version separator. So `sphinxcontrib-websupport` would be understood as package `sphinxcontrib`, version `websupport`. And given that projects put all kinds of strange things in their version numbers, we cannot know that `websupport` is _not_ a version number.


---

Comment by embray created at 2017-08-31 13:09:50

I think the point is that the "pip" package type could be considered bad, and better not used for new packages.  Perhaps this should be made official.


---

Comment by dimpase created at 2017-08-31 13:31:42

Replying to [comment:7 jdemeyer]:
> Replying to [comment:6 dimpase]:
> > Another solution is to make '-' acceptable in Sage package names - I really don't know how much work this is and where to start.
> 
> The problem is that `-` is used as a version separator. So `sphinxcontrib-websupport` would be understood as package `sphinxcontrib`, version `websupport`. And given that projects put all kinds of strange things in their version numbers, we cannot know that `websupport` is _not_ a version number.

We still can, say, parse `ls SAGE_ROOT/build/pkgs/` for the list of package names, which could have `-` in them, and then build a list of pairs (package_name,package_version) by looking at `SAGE_ROOT/build/pkgs/<package_name>/package-version.txt`.


---

Comment by jdemeyer created at 2017-08-31 13:38:14

Replying to [comment:9 dimpase]:
> We still can, say, parse `ls SAGE_ROOT/build/pkgs/` for the list of package names, which could have `-` in them, and then build a list of pairs (package_name,package_version) by looking at `SAGE_ROOT/build/pkgs/<package_name>/package-version.txt`.

We can do many things, but the build system is already complicated enough without such hacks. And this `pkgname-version` convention is used in various places in the build system, it wouldn't be such a simple fix.


---

Comment by jdemeyer created at 2017-10-18 13:29:46

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-10-18 13:29:46

This isn't going to happen...


---

Comment by jdemeyer created at 2017-10-18 13:29:55

Changing status from needs_review to positive_review.


---

Comment by embray created at 2017-10-18 14:29:33

Does that mean this can be closed?


---

Comment by jdemeyer created at 2017-10-18 15:05:56

I would give Dima a chance to reply. But if he does not object, it can be closed.


---

Comment by dimpase created at 2017-10-19 09:51:56

Well, one person's wishlist might be another person's won't fix, I really don't see the rush behind closing this. 

The choice of '-' as a separator between the version and and the package name was not fortunate, this is clear.


---

Comment by jdemeyer created at 2017-10-19 20:09:13

Resolution: wontfix


---

Comment by jdemeyer created at 2017-10-19 20:09:13

Replying to [comment:16 dimpase]:
> Well, one person's wishlist might be another person's won't fix, I really don't see the rush behind closing this. 

There is also not much point in keeping wishlist tickets open that nobody is ever going to work on. If you really want to fix this, you can always reopen the ticket or create a new one.
