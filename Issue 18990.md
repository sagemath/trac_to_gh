# Issue 18990: Graphs: DFS and broken distance-parameter

archive/issues_018990.json:
```json
{
    "body": "CC:  @nathanncohen @vbraun\n\nThis bug is visible at least on normal 64-bit Linux machine running self-compiled Sage. Might be architechture-dependent.\n\n\n```\nG = DiGraph({1:[2,10],2:[3],3:[4],4:[5],5:[6],10:[4]})\nlist(G.depth_first_search(1, distance=3))\n```\n\n\nThis should output also `5` as it is three jumps from 1: `1->10->4->5`. It is not outputted because `4` is already marked as seen vertex for `1->2->3->4`.\n\nI found this when doing #19197 and there is already some discussion about it. I suspect that this might be used  in other places too, and that must be checked first.\n\nAlso note that #19223 might have collision as the fix may touch almost same lines.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19227\n\n",
    "created_at": "2015-09-17T04:20:48Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Graphs: DFS and broken distance-parameter",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18990",
    "user": "https://github.com/jm58660"
}
```
CC:  @nathanncohen @vbraun

This bug is visible at least on normal 64-bit Linux machine running self-compiled Sage. Might be architechture-dependent.


```
G = DiGraph({1:[2,10],2:[3],3:[4],4:[5],5:[6],10:[4]})
list(G.depth_first_search(1, distance=3))
```


This should output also `5` as it is three jumps from 1: `1->10->4->5`. It is not outputted because `4` is already marked as seen vertex for `1->2->3->4`.

I found this when doing #19197 and there is already some discussion about it. I suspect that this might be used  in other places too, and that must be checked first.

Also note that #19223 might have collision as the fix may touch almost same lines.

Issue created by migration from https://trac.sagemath.org/ticket/19227





---

archive/issue_comments_260242.json:
```json
{
    "body": "Accidentally I tested what happens if I remove `distance` from `breadth_first_search`. Nothing: all doctests, except the function's own, were successfull. Hence `breadth()` in `lattices.py` is first one to use the parameter.\n\nIt also seems that `distance` at `depth_first_search()` is unused. I am running doctests, but plain grep shows no matches. Hence I guess we can just deprecate this.",
    "created_at": "2015-09-17T10:49:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260242",
    "user": "https://github.com/jm58660"
}
```

Accidentally I tested what happens if I remove `distance` from `breadth_first_search`. Nothing: all doctests, except the function's own, were successfull. Hence `breadth()` in `lattices.py` is first one to use the parameter.

It also seems that `distance` at `depth_first_search()` is unused. I am running doctests, but plain grep shows no matches. Hence I guess we can just deprecate this.



---

archive/issue_comments_260243.json:
```json
{
    "body": "I had to delete and modify some examples. Otherwise this just gives deprecation warning.\n----\nNew commits:",
    "created_at": "2015-09-17T11:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260243",
    "user": "https://github.com/jm58660"
}
```

I had to delete and modify some examples. Otherwise this just gives deprecation warning.
----
New commits:



---

archive/issue_comments_260244.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-17T11:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260244",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_260245.json:
```json
{
    "body": "Err.. Given that it is is broken, that the output is architecture-dependent, and that people may have a misleading idea about what it does, why don't we just remove it? Volker repeats often enough that \"we don't need to deprecate bugs\". I only hope that in this case we agree that it is a bug (which isn't always the case when Volker uses that argument).\n\nNathann",
    "created_at": "2015-09-18T07:05:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260245",
    "user": "https://github.com/nathanncohen"
}
```

Err.. Given that it is is broken, that the output is architecture-dependent, and that people may have a misleading idea about what it does, why don't we just remove it? Volker repeats often enough that "we don't need to deprecate bugs". I only hope that in this case we agree that it is a bug (which isn't always the case when Volker uses that argument).

Nathann



---

archive/issue_comments_260246.json:
```json
{
    "body": "Replying to [comment:4 ncohen]:\n> Err.. Given that it is is broken, that the output is architecture-dependent, and that people may have a misleading idea about what it does, why don't we just remove it? Volker repeats often enough that \"we don't need to deprecate bugs\". I only hope that in this case we agree that it is a bug (which isn't always the case when Volker uses that argument).\n\nVbraun added to CC.\n\nI am not exactly sure what counts as a bug and what not. See #18944.\n\nI think that somebody might have code that uses this, maybe even working code (i.e. using DFS with `distance` only for trees). Can we give deprecation warning AND raise and exception? Then the user would at least know what has happened and why the code does not work any more.\n\nVolker, #19197 contains some discussion about this; that is where Nathann saw this bug.",
    "created_at": "2015-09-18T07:17:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260246",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:4 ncohen]:
> Err.. Given that it is is broken, that the output is architecture-dependent, and that people may have a misleading idea about what it does, why don't we just remove it? Volker repeats often enough that "we don't need to deprecate bugs". I only hope that in this case we agree that it is a bug (which isn't always the case when Volker uses that argument).

Vbraun added to CC.

I am not exactly sure what counts as a bug and what not. See #18944.

I think that somebody might have code that uses this, maybe even working code (i.e. using DFS with `distance` only for trees). Can we give deprecation warning AND raise and exception? Then the user would at least know what has happened and why the code does not work any more.

Volker, #19197 contains some discussion about this; that is where Nathann saw this bug.



---

archive/issue_comments_260247.json:
```json
{
    "body": "Hello,\n\nthe behavior of the `G.depth_first_search(1, distance=3)` is not machine dependent but it depends on the labels of the vertices which define an ordering between vertices. So if you relabel `10->1` and `1->10` in your example, you will get different result.\n\nI don't see a bug here, I see a definition problem: what are we expecting?\nIf we are not able to provide a clear definition of the expected behavior of the `distance` parameter, we should not have it in DFS.\n\nDavid.",
    "created_at": "2015-09-20T10:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260247",
    "user": "https://github.com/dcoudert"
}
```

Hello,

the behavior of the `G.depth_first_search(1, distance=3)` is not machine dependent but it depends on the labels of the vertices which define an ordering between vertices. So if you relabel `10->1` and `1->10` in your example, you will get different result.

I don't see a bug here, I see a definition problem: what are we expecting?
If we are not able to provide a clear definition of the expected behavior of the `distance` parameter, we should not have it in DFS.

David.



---

archive/issue_comments_260248.json:
```json
{
    "body": "Replying to [comment:6 dcoudert]:\n\n> the behavior of the `G.depth_first_search(1, distance=3)` is not machine dependent but it depends on the labels of the vertices which define an ordering between vertices.\n\nSo if you have labels `42` and `'hello!'`, it is machine-dependent.",
    "created_at": "2015-09-20T10:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260248",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:6 dcoudert]:

> the behavior of the `G.depth_first_search(1, distance=3)` is not machine dependent but it depends on the labels of the vertices which define an ordering between vertices.

So if you have labels `42` and `'hello!'`, it is machine-dependent.



---

archive/issue_comments_260249.json:
```json
{
    "body": "> I don't see a bug here, I see a definition problem: what are we expecting?\n> If we are not able to provide a clear definition of the expected behavior of the `distance` parameter, we should not have it in DFS.\n\nI agree with that, the fact that it is architecture-dependent is merely a way to show that we will never find a clear explanation of what can be expected.\n\nThe other reason is that this being named 'distance' is very misleading.\n\nNathann",
    "created_at": "2015-09-20T11:36:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260249",
    "user": "https://github.com/nathanncohen"
}
```

> I don't see a bug here, I see a definition problem: what are we expecting?
> If we are not able to provide a clear definition of the expected behavior of the `distance` parameter, we should not have it in DFS.

I agree with that, the fact that it is architecture-dependent is merely a way to show that we will never find a clear explanation of what can be expected.

The other reason is that this being named 'distance' is very misleading.

Nathann



---

archive/issue_comments_260250.json:
```json
{
    "body": "Now I agree that not only we don't have a proper definition, but also that the result is machine-dependent.\n\non my mac:\n\n```\nsage: 42>'hello!'\nTrue\n```\n\non a linux desktop I have \n\n```\nsage: 42>'hello!'\nFalse\n```\n\n\n\nCould you:\n- add your name as author\n- change in the ticket description, `This should output` -> `This could output`.\n- To show that the DFS can go backward, you could provide a simpler (and machine-independent) example, instead of this of `sorted([d_in.next(), d_in.next(), d_in.next()])`:\n\n```\nsage: D = digraphs.Path(10)\nsage: list(D.depth_first_search(5, neighbors=D.neighbors_in))\n[5, 4, 3, 2, 1, 0]\nsage: list(D.depth_first_search(5, neighbors=D.neighbors_out))\n[5, 6, 7, 8, 9]\n```\n\n\nThanks.\nDavid.",
    "created_at": "2015-09-20T11:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260250",
    "user": "https://github.com/dcoudert"
}
```

Now I agree that not only we don't have a proper definition, but also that the result is machine-dependent.

on my mac:

```
sage: 42>'hello!'
True
```

on a linux desktop I have 

```
sage: 42>'hello!'
False
```



Could you:
- add your name as author
- change in the ticket description, `This should output` -> `This could output`.
- To show that the DFS can go backward, you could provide a simpler (and machine-independent) example, instead of this of `sorted([d_in.next(), d_in.next(), d_in.next()])`:

```
sage: D = digraphs.Path(10)
sage: list(D.depth_first_search(5, neighbors=D.neighbors_in))
[5, 4, 3, 2, 1, 0]
sage: list(D.depth_first_search(5, neighbors=D.neighbors_out))
[5, 6, 7, 8, 9]
```


Thanks.
David.



---

archive/issue_comments_260251.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-09-20T11:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260251",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_260252.json:
```json
{
    "body": "I can make a better example later, when I am on faster computer.\n\nBut is plain path a good example? It won't show any difference between `depth_first_search()` and `breadth_first_search()`.\n\nOf course you can also do this; we can cross-review our codes.",
    "created_at": "2015-09-20T11:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260252",
    "user": "https://github.com/jm58660"
}
```

I can make a better example later, when I am on faster computer.

But is plain path a good example? It won't show any difference between `depth_first_search()` and `breadth_first_search()`.

Of course you can also do this; we can cross-review our codes.



---

archive/issue_comments_260253.json:
```json
{
    "body": "Could this be ok?\n\n```\nsage: D = digraphs.Path(10)\nsage: D.add_path([22,23,24,5])\nsage: D.add_path([5,33,34,35])\nsage: list(D.depth_first_search(5, neighbors=D.neighbors_in))\n[5, 4, 3, 2, 1, 0, 24, 23, 22]\nsage: list(D.breadth_first_search(5, neighbors=D.neighbors_in))\n[5, 24, 4, 23, 3, 22, 2, 1, 0]\nsage: list(D.depth_first_search(5, neighbors=D.neighbors_out))\n[5, 6, 7, 8, 9, 33, 34, 35]\nsage: list(D.breadth_first_search(5, neighbors=D.neighbors_out))\n[5, 33, 6, 34, 7, 35, 8, 9]\n```\n",
    "created_at": "2015-09-20T14:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260253",
    "user": "https://github.com/dcoudert"
}
```

Could this be ok?

```
sage: D = digraphs.Path(10)
sage: D.add_path([22,23,24,5])
sage: D.add_path([5,33,34,35])
sage: list(D.depth_first_search(5, neighbors=D.neighbors_in))
[5, 4, 3, 2, 1, 0, 24, 23, 22]
sage: list(D.breadth_first_search(5, neighbors=D.neighbors_in))
[5, 24, 4, 23, 3, 22, 2, 1, 0]
sage: list(D.depth_first_search(5, neighbors=D.neighbors_out))
[5, 6, 7, 8, 9, 33, 34, 35]
sage: list(D.breadth_first_search(5, neighbors=D.neighbors_out))
[5, 33, 6, 34, 7, 35, 8, 9]
```




---

archive/issue_comments_260254.json:
```json
{
    "body": "Replying to [comment:11 dcoudert]:\n> Could this be ok?\n\nSeems good example to me. Nathann is a specialist in graphs, so maybe I'll also wait to see if he sees something wrong with that.",
    "created_at": "2015-09-20T15:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260254",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:11 dcoudert]:
> Could this be ok?

Seems good example to me. Nathann is a specialist in graphs, so maybe I'll also wait to see if he sees something wrong with that.



---

archive/issue_comments_260255.json:
```json
{
    "body": "> Seems good example to me. Nathann is a specialist in graphs, so maybe I'll also wait to see if he sees something wrong with that.\n\nErr. Well. David is the head of the team in which I work these days. I have not followed your recent exchanges on the possible outputs of the faulty command, but if you need the reassurance of a graph specialist you needn't look further.\n\nNathann",
    "created_at": "2015-09-20T15:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260255",
    "user": "https://github.com/nathanncohen"
}
```

> Seems good example to me. Nathann is a specialist in graphs, so maybe I'll also wait to see if he sees something wrong with that.

Err. Well. David is the head of the team in which I work these days. I have not followed your recent exchanges on the possible outputs of the faulty command, but if you need the reassurance of a graph specialist you needn't look further.

Nathann



---

archive/issue_comments_260256.json:
```json
{
    "body": "Replying to [comment:13 ncohen]:\n\n> Err. Well. David is the head of the team in which I work these days. I have not followed your recent exchanges on the possible outputs of the faulty command, but if you need the reassurance of a graph specialist you needn't look further.\n\nOK. Let's say \"specialist in graph theory with SageMath\" `:=)`. Anyways, I will add that example. (Assuming I got this compiled... had to say `make distclean`, something has gone wrong when `make` was interrupted.)",
    "created_at": "2015-09-20T15:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260256",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:13 ncohen]:

> Err. Well. David is the head of the team in which I work these days. I have not followed your recent exchanges on the possible outputs of the faulty command, but if you need the reassurance of a graph specialist you needn't look further.

OK. Let's say "specialist in graph theory with SageMath" `:=)`. Anyways, I will add that example. (Assuming I got this compiled... had to say `make distclean`, something has gone wrong when `make` was interrupted.)



---

archive/issue_comments_260257.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-20T18:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_260258.json:
```json
{
    "body": "Don't forget to set the ticket to `needs review` when ready.\nDavid.",
    "created_at": "2015-09-20T21:11:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260258",
    "user": "https://github.com/dcoudert"
}
```

Don't forget to set the ticket to `needs review` when ready.
David.



---

archive/issue_comments_260259.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-09-21T03:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260259",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_260260.json:
```json
{
    "body": "Replying to [comment:16 dcoudert]:\n> Don't forget to set the ticket to `needs review` when ready.\n\nNow it is, compiles and tests passed and html manual builds. (Got `ImportError` from `Config`?? Recompiled everything.)",
    "created_at": "2015-09-21T03:49:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260260",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:16 dcoudert]:
> Don't forget to set the ticket to `needs review` when ready.

Now it is, compiles and tests passed and html manual builds. (Got `ImportError` from `Config`?? Recompiled everything.)



---

archive/issue_comments_260261.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-09-21T16:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260261",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_260262.json:
```json
{
    "body": "For me the patch is good to go.\nThanks,\nDavid.",
    "created_at": "2015-09-21T16:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260262",
    "user": "https://github.com/dcoudert"
}
```

For me the patch is good to go.
Thanks,
David.



---

archive/issue_comments_260263.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-22T14:49:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18990#issuecomment-260263",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_018138.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2015-09-22T14:49:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18990",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18990#event-18138"
}
```
