# Issue 14935: update 4ti2 to version 1.6

Issue created by migration from https://trac.sagemath.org/ticket/15172

Original creator: dimpase

Original creation time: 2013-09-07 13:25:11

CC:  novoselt mmarco dperkinson mhampton

Keywords: 4ti2

version 1.6 is [released](http://4ti2.de).

The updated [spkg http://boxen.math.washington.edu/home/dima/packages/4ti2-1.6.spkg]


---

Comment by dimpase created at 2013-09-07 13:31:55

at the moment there is one test failure, which only occurs from `sage -t` run, but I can't reproduce it interactively:

```
$ ../../sage -t --optional='sage,4ti2' sage/interfaces/four_ti_2.py
Running doctests with ID 2013-09-07-09-09-54-b455bb50.
Doctesting 1 file.
sage -t sage/interfaces/four_ti_2.py
**********************************************************************
File "sage/interfaces/four_ti_2.py", line 284, in sage.interfaces.four_ti_2.FourTi2.call
Failed example:
    four_ti_2.read_matrix("test_file.gro") # optional - 4ti2
Expected:
    [-5  0  2]
    [-5  3  0]
Got:
    []
**********************************************************************
1 item had failures:
   1 of   5 in sage.interfaces.four_ti_2.FourTi2.call
    [50 tests, 1 failure, 0.55 s]
----------------------------------------------------------------------
sage -t sage/interfaces/four_ti_2.py  # 1 doctest failed
```



---

Comment by dimpase created at 2013-09-07 13:31:55

Changing type from defect to enhancement.


---

Comment by dimpase created at 2013-09-07 13:35:27

Changing status from new to needs_info.


---

Comment by dimpase created at 2013-09-07 13:35:55

Changing status from needs_info to needs_work.


---

Comment by jdemeyer created at 2013-09-07 14:38:03

Why add `# optional - 4ti2` where it was not needed before?


---

Comment by jdemeyer created at 2013-09-07 14:41:33

The following

```
        cwd = os.getcwd() # Save working directory in order to restore it.
        os.chdir(self.directory())

        subprocess.call(cmd, shell=True)

        os.chdir(cwd) # Restore previous working directory.
```

should be replaced by

```
        subprocess.call(cmd, shell=True, cwd=self.directory())
```



---

Comment by novoselt created at 2013-09-07 15:33:03

As I understand in the patch "-q" is for quiet mode, but why there is a need to silence stderr explicitly? Shouldn't commands output no errors if used correctly?


---

Comment by dimpase created at 2013-09-07 17:18:15

Replying to [comment:6 novoselt]:
> As I understand in the patch "-q" is for quiet mode, but why there is a need to silence stderr explicitly? Shouldn't commands output no errors if used correctly?

there is no '-q' switch for `ppi`, for some reason. So its stderr output needs to be silenced.


---

Comment by dimpase created at 2013-09-07 17:23:55

Replying to [comment:5 jdemeyer]:

Do you mean it's an equivalent way to do the same thing?

OK, I'll change this. Meanwhile I just uploaded patch which fixes the issue that was stopping me here; it's actually due to filename semantics changed. Now `groebner bla.foo` appends the suffix `gro` to `bla.foo`, rather than replacing the suffix.


---

Attachment

updated patch


---

Comment by dimpase created at 2013-09-07 17:47:02

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2013-09-07 17:47:02

OK, it looks as if I fixed everything.


---

Comment by dimpase created at 2013-09-07 17:57:37

There are quite a few changes in the `4ti2`-dependent part of `sandpile.py`, due to a change in output format of zslove, which prints matrix dimensions on one row now, and changed order in its output. Also, I needed to take care of deprecated `vertex_set` in `SimplicialComplex`.


---

Comment by jdemeyer created at 2013-09-07 22:14:13

Replying to [comment:8 dimpase]:
> Replying to [comment:5 jdemeyer]:
> 
> Do you mean it's an equivalent way to do the same thing?
Essentially yes. Instead of changing directory globally and then changing it back, we simply change directory for the executed command.


---

Comment by dimpase created at 2013-09-09 02:12:56

I've made a small change in spkg-install. Now everything, not only executables, is installed, so  that one can link against 4ti2's libraries.


---

Comment by vbraun created at 2013-10-06 17:06:11

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-10-06 17:06:11

Looks good to me.


---

Comment by jdemeyer created at 2013-10-12 17:06:45

Resolution: fixed
