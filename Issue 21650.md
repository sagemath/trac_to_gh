# Issue 21650: py3 making __nonzero__ an alias for __bool__ in rings folder

Issue created by migration from https://trac.sagemath.org/ticket/21887

Original creator: chapoton

Original creation time: 2016-11-17 16:15:08

as a step to py3

part of #16076

here only in the rings folder




---

Comment by chapoton created at 2016-11-17 16:16:00

New commits:


---

Comment by jdemeyer created at 2016-11-17 16:40:47

This is not needed for Cython extension types. Cython understands both special methods `__nonzero__` and `__bool__`.

There is one potential caveat: if you _really_ need `__nonzero__` and `__bool__` non-special methods (that is, you really need `obj.__bool__` and not just `bool(obj)` or `not obj`), your trick might be needed.


---

Comment by git created at 2016-11-17 16:42:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-11-17 16:45:37

So should I refrain to make changes to any pyx or pxi files ?

I would prefer to have something uniform, even if it is not necessary. Does it do any harm to do that also in pyx files ?


---

Comment by jdemeyer created at 2016-11-17 17:03:55

Replying to [comment:4 chapoton]:
> Does it do any harm to do that also in pyx files ?

There is no obvious harm, apart from code bloat.


---

Comment by jdemeyer created at 2016-11-17 20:14:02

OK, I actually tested it and it doesn't work...

```
/usr/local/src/sage-config/src/sage/rings/complex_number.pyx in init sage.rings.complex_number (/usr/local/src/sage-config/src/build/cythonized/sage/rings/complex_number.c:25899)()
    860                                       imag_string, digit_precision_bound)
    861 
    862     def __bool__(self):
    863         """
    864         Return ``True`` if ``self`` is not zero. This is an internal function;
    865         use :meth:`is_zero()` instead.
    866 
    867         EXAMPLES::
    868 
    869             sage: z = 1 + CC(I)
    870             sage: z.is_zero()
    871             False
    872         """
    873         return not (mpfr_zero_p(self.__re) and mpfr_zero_p(self.__im))
    874 
--> 875     __nonzero__ =__bool__
        global __nonzero__ = undefined
        global __bool__ = undefined
    876 
    877     def prec(self):
    878         """
    879         Return precision of this complex number.
    880 
    881         EXAMPLES::
    882 
    883             sage: i = ComplexField(2000).0
    884             sage: i.prec()
    885             2000
    886         """
    887         return self._parent.prec()
    888 
    889     def real(self):
    890         """

NameError: name '__bool__' is not defined
```


I guess Cython extension types don't allow such assignment of special methods.


---

Comment by jdemeyer created at 2016-11-17 20:22:43

To fix code like `obj.__nonzero__()` (for example in `src/sage/rings/complex_interval.pyx`), I would just use `bool(obj)`. That should "just work" in Python 2 and Python 3.


---

Comment by git created at 2016-11-17 20:44:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-11-17 21:16:02

`.pxi` files should be treated just like `.pyx` files.


---

Comment by git created at 2016-11-17 21:18:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-17 21:28:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-11-18 07:20:33

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-11-18 07:20:33

ok, works now, green bot, setting to needs_review


---

Comment by jdemeyer created at 2016-11-18 09:31:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-19 22:09:51

Resolution: fixed
