# Issue 21650: py3 making __nonzero__ an alias for __bool__ in rings folder

archive/issues_021650.json:
```json
{
    "body": "as a step to py3\n\npart of #16076\n\nhere only in the rings folder\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21887\n\n",
    "created_at": "2016-11-17T16:15:08Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "title": "py3 making __nonzero__ an alias for __bool__ in rings folder",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21650",
    "user": "chapoton"
}
```
as a step to py3

part of #16076

here only in the rings folder



Issue created by migration from https://trac.sagemath.org/ticket/21887





---

archive/issue_comments_300701.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-17T16:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300701",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_300702.json:
```json
{
    "body": "This is not needed for Cython extension types. Cython understands both special methods `__nonzero__` and `__bool__`.\n\nThere is one potential caveat: if you *really* need `__nonzero__` and `__bool__` non-special methods (that is, you really need `obj.__bool__` and not just `bool(obj)` or `not obj`), your trick might be needed.",
    "created_at": "2016-11-17T16:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300702",
    "user": "jdemeyer"
}
```

This is not needed for Cython extension types. Cython understands both special methods `__nonzero__` and `__bool__`.

There is one potential caveat: if you *really* need `__nonzero__` and `__bool__` non-special methods (that is, you really need `obj.__bool__` and not just `bool(obj)` or `not obj`), your trick might be needed.



---

archive/issue_comments_300703.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-17T16:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300703",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300704.json:
```json
{
    "body": "So should I refrain to make changes to any pyx or pxi files ?\n\nI would prefer to have something uniform, even if it is not necessary. Does it do any harm to do that also in pyx files ?",
    "created_at": "2016-11-17T16:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300704",
    "user": "chapoton"
}
```

So should I refrain to make changes to any pyx or pxi files ?

I would prefer to have something uniform, even if it is not necessary. Does it do any harm to do that also in pyx files ?



---

archive/issue_comments_300705.json:
```json
{
    "body": "Replying to [comment:4 chapoton]:\n> Does it do any harm to do that also in pyx files ?\n\nThere is no obvious harm, apart from code bloat.",
    "created_at": "2016-11-17T17:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300705",
    "user": "jdemeyer"
}
```

Replying to [comment:4 chapoton]:
> Does it do any harm to do that also in pyx files ?

There is no obvious harm, apart from code bloat.



---

archive/issue_comments_300706.json:
```json
{
    "body": "OK, I actually tested it and it doesn't work...\n\n```\n/usr/local/src/sage-config/src/sage/rings/complex_number.pyx in init sage.rings.complex_number (/usr/local/src/sage-config/src/build/cythonized/sage/rings/complex_number.c:25899)()\n    860                                       imag_string, digit_precision_bound)\n    861 \n    862     def __bool__(self):\n    863         \"\"\"\n    864         Return ``True`` if ``self`` is not zero. This is an internal function;\n    865         use :meth:`is_zero()` instead.\n    866 \n    867         EXAMPLES::\n    868 \n    869             sage: z = 1 + CC(I)\n    870             sage: z.is_zero()\n    871             False\n    872         \"\"\"\n    873         return not (mpfr_zero_p(self.__re) and mpfr_zero_p(self.__im))\n    874 \n--> 875     __nonzero__ =__bool__\n        global __nonzero__ = undefined\n        global __bool__ = undefined\n    876 \n    877     def prec(self):\n    878         \"\"\"\n    879         Return precision of this complex number.\n    880 \n    881         EXAMPLES::\n    882 \n    883             sage: i = ComplexField(2000).0\n    884             sage: i.prec()\n    885             2000\n    886         \"\"\"\n    887         return self._parent.prec()\n    888 \n    889     def real(self):\n    890         \"\"\"\n\nNameError: name '__bool__' is not defined\n```\n\n\nI guess Cython extension types don't allow such assignment of special methods.",
    "created_at": "2016-11-17T20:14:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300706",
    "user": "jdemeyer"
}
```

OK, I actually tested it and it doesn't work...

```
/usr/local/src/sage-config/src/sage/rings/complex_number.pyx in init sage.rings.complex_number (/usr/local/src/sage-config/src/build/cythonized/sage/rings/complex_number.c:25899)()
    860                                       imag_string, digit_precision_bound)
    861 
    862     def __bool__(self):
    863         """
    864         Return ``True`` if ``self`` is not zero. This is an internal function;
    865         use :meth:`is_zero()` instead.
    866 
    867         EXAMPLES::
    868 
    869             sage: z = 1 + CC(I)
    870             sage: z.is_zero()
    871             False
    872         """
    873         return not (mpfr_zero_p(self.__re) and mpfr_zero_p(self.__im))
    874 
--> 875     __nonzero__ =__bool__
        global __nonzero__ = undefined
        global __bool__ = undefined
    876 
    877     def prec(self):
    878         """
    879         Return precision of this complex number.
    880 
    881         EXAMPLES::
    882 
    883             sage: i = ComplexField(2000).0
    884             sage: i.prec()
    885             2000
    886         """
    887         return self._parent.prec()
    888 
    889     def real(self):
    890         """

NameError: name '__bool__' is not defined
```


I guess Cython extension types don't allow such assignment of special methods.



---

archive/issue_comments_300707.json:
```json
{
    "body": "To fix code like `obj.__nonzero__()` (for example in `src/sage/rings/complex_interval.pyx`), I would just use `bool(obj)`. That should \"just work\" in Python 2 and Python 3.",
    "created_at": "2016-11-17T20:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300707",
    "user": "jdemeyer"
}
```

To fix code like `obj.__nonzero__()` (for example in `src/sage/rings/complex_interval.pyx`), I would just use `bool(obj)`. That should "just work" in Python 2 and Python 3.



---

archive/issue_comments_300708.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-17T20:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300708",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300709.json:
```json
{
    "body": "`.pxi` files should be treated just like `.pyx` files.",
    "created_at": "2016-11-17T21:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300709",
    "user": "jdemeyer"
}
```

`.pxi` files should be treated just like `.pyx` files.



---

archive/issue_comments_300710.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-17T21:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300710",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-17T21:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300711",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_300712.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-18T07:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300712",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_300713.json:
```json
{
    "body": "ok, works now, green bot, setting to needs_review",
    "created_at": "2016-11-18T07:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300713",
    "user": "chapoton"
}
```

ok, works now, green bot, setting to needs_review



---

archive/issue_comments_300714.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-18T09:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300714",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_300715.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-19T22:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21650",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21650#issuecomment-300715",
    "user": "vbraun"
}
```

Resolution: fixed
