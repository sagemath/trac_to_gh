# Issue 12387: Chinese translation of "A tour of Sage"

Issue created by migration from Trac.

Original creator: mvngu

Original creation time: 2012-02-22 05:58:38

Assignee: mvngu

CC:  lq52655963@163.com vbraun

As the subject says.  The attachment is from "kehengsite", who didn't give their real name.  The attachment needs to be converted to Sphinx.


---

Attachment

I have asked one of my Chinese colleagues to take a look at the contents for review.


---

Attachment

[attachment:A_tour_of_sage_Zh.pdf Attached] in the pdf file are some comments by my colleague _Chengmin Wang_. Many thanks to him.


---

Comment by Kehengsite created at 2012-02-26 05:29:23

Changing assignee from mvngu to Kehengsite.


---

Comment by Kehengsite created at 2012-02-26 05:29:23

In the next,I will add instalation guide to this document.But at first,I need a few days to make understand how this trac syetem works.


---

Comment by dimpase created at 2012-02-26 06:15:00

Replying to [comment:6 Kehengsite]:

latex->rst [converter http://johnmacfarlane.net/pandoc/]


---

Attachment

Finished intsallation guide


---

Comment by Kehengsite created at 2012-03-31 14:09:46

Waiting to be converted to rst


---

Comment by dimpase created at 2012-03-31 17:06:43

Changing status from new to needs_info.


---

Comment by dimpase created at 2012-03-31 17:06:43

Replying to [comment:8 Kehengsite]:
> Waiting to be converted to rst
If I try to run latex and then dvips on these files I get 

```
$ dvips A_tour_of_sage_Zh
This is dvips(k) 5.991 Copyright 2011 Radical Eye Software (www.radicaleye.com)
' TeX output 2012.04.01:0058' -> A_tour_of_sage_Zh.ps

kpathsea: Running mktexpk --mfmode ljfour --bdpi 600 --mag 1+437/600 --dpi 1037 unihei52
mktexpk: don't know how to create bitmap font for unihei52.
mktexpk: perhaps unihei52 is missing from the map file.
kpathsea: Appending font creation commands to missfont.log.
dvips: Font unihei52 not found; using cmr10

</usr/local/texlive/2011/texmf-dist/fonts/pk/ljfour/public/cm/dpi600/cmr10.pk>
dvips: ! invalid char 159 from font unihei52
```

If I try pdflatex I get

```
!pdfTeX error: pdflatex (file simsun.ttc): cannot open TrueType font file for reading
 ==> Fatal error occurred, no output PDF file produced!
```


Is it a problem with my TeX installation (TeXLive 2011 on MacOSX) ?
Or something non-standard in this file?
I tried googling for these errors, but most of the results are in Chinese, and I can't see what 
is the problem...


---

Comment by Kehengsite created at 2012-04-01 10:29:24

I use CTeX distrbution (www.ctex.org) to finish this work,in the compiling process,

several Chinese fonts were needed. so,if you use TeXLive to commpile the .tex file,as 

lack of CTeX macro,it won't success.
  
  In fact,I'm trying to find a perfect way to convert this .tex file to rst,but yet 

successed. Now,I'm working on it!

  Thinks very much for you help anyway!


---

Comment by Kehengsite created at 2012-04-01 10:33:24

Replying to [comment:9 dimpase]:
> Replying to [comment:8 Kehengsite]:
> > Waiting to be converted to rst
> If I try to run latex and then dvips on these files I get 
> {{{
> $ dvips A_tour_of_sage_Zh
> This is dvips(k) 5.991 Copyright 2011 Radical Eye Software (www.radicaleye.com)
> ' TeX output 2012.04.01:0058' -> A_tour_of_sage_Zh.ps
> 
> kpathsea: Running mktexpk --mfmode ljfour --bdpi 600 --mag 1+437/600 --dpi 1037 unihei52
> mktexpk: don't know how to create bitmap font for unihei52.
> mktexpk: perhaps unihei52 is missing from the map file.
> kpathsea: Appending font creation commands to missfont.log.
> dvips: Font unihei52 not found; using cmr10
> 
> </usr/local/texlive/2011/texmf-dist/fonts/pk/ljfour/public/cm/dpi600/cmr10.pk>
> dvips: ! invalid char 159 from font unihei52
> }}}
> If I try pdflatex I get
> {{{
> !pdfTeX error: pdflatex (file simsun.ttc): cannot open TrueType font file for reading
>  ==> Fatal error occurred, no output PDF file produced!
> }}}
> 
> Is it a problem with my TeX installation (TeXLive 2011 on MacOSX) ?
> Or something non-standard in this file?
> I tried googling for these errors, but most of the results are in Chinese, and I can't see what 
> is the problem...
> 
I use CTeX distrbution (www.ctex.org) to finish this work,in the compiling process, 

several Chinese fonts were needed. so,if you use TeXLive to commpile the .tex file,as 

lack of CTeX macro,it won't success. 

In fact,I'm trying to find a perfect way to convert this .tex file to rst,but yet 

successed. Now,I'm working on it! 

Thinks very much for you help anyway!


---

Comment by dimpase created at 2013-06-05 17:42:15

this is a real UTF challenge :â€“)


---

Comment by vbraun created at 2013-06-05 17:59:46

First question, is this simplified or traditional chinese? ;-)


---

Comment by dimpase created at 2013-06-06 06:56:20

converted to rST using pandoc


---

Attachment

Replying to [comment:13 vbraun]:
> First question, is this simplified or traditional chinese? ;-)

Simplified. I just attached the result of using pandoc on the latex source. It will surely need more reformatting etc. 

Now one has to figure out where it should go, and how to run sphinx on it...


---

Comment by vbraun created at 2013-06-06 08:23:53

The attached patch lets you build the html version with

```
sage -docbuild zh_CN/a_tour_of_sage html
```

There are some errors because I'm missing the images (we need them as png, not pdf for the html docs)


---

Comment by dimpase created at 2013-06-06 08:33:33

Replying to [comment:15 vbraun]:
> The attached patch lets you build the html version with
> {{{
> sage -docbuild zh_CN/a_tour_of_sage html
> }}}
> There are some errors because I'm missing the images (we need them as png, not pdf for the html docs)

I presume one can steal the images from this document in other languages...


---

Comment by vbraun created at 2013-06-06 08:49:48

And there is a lot of installation stuff before the "A Tour OF Sage" starts, which is not present in the English version. Shouldn't that be broken out to a separate document?


---

Comment by dimpase created at 2013-06-06 09:02:29

Replying to [comment:17 vbraun]:
> And there is a lot of installation stuff before the "A Tour OF Sage" starts, which is not present in the English version. Shouldn't that be broken out to a separate document?

Indeed. I was wondering if there is a corresponding part of Sage docs that has this info.


---

Comment by vbraun created at 2013-06-06 11:10:16

I've fixed up the images and the pdf build. The latter pretty much requires xelatex; Apparently you can also use standard pdflatex but then you need the CJK package which is not in TeXlive. So I think its better to use xelatex, and simply disable it if xelatex is not available.


---

Attachment

pdf output


---

Comment by vbraun created at 2013-06-06 11:14:10

Changing status from needs_info to needs_review.


---

Comment by dimpase created at 2013-06-06 16:27:11

PDF doc does not build for me:

```
sage -docbuild zh_CN/a_tour_of_sage pdf                 
[a_tour_of] loading translations [zh_CN]... done
[a_tour_of] Compiling the master document
[a_tour_of] building [latex]: all documents
[a_tour_of] Merging environment/index files...
[a_tour_of] ... done (0 todos, 1 index, 0 citations, 0 modules)
[a_tour_of] Saved pickle file: citations.pickle
[a_tour_of] processing SageTutorial_zh_CN.tex... index
[a_tour_of] resolving references...
[a_tour_of] writing... done
[a_tour_of] copying images... interact_screenshot.jpg sin_plot.png circles_plot.png plot_3d.jpg eigen_plot.png
[a_tour_of] copying TeX support files... done
[a_tour_of] build succeeded, 1 warning.
env </dev/null pool_size=4000000 save_size=50000 extra_mem_top=2000000 xelatex  'SageTutorial_zh_CN.tex'
This is XeTeX, Version 3.1415926-2.2-0.9995.2 (TeX Live 2009/Debian)
(Fatal format file error; I'm stymied)
make: *** [SageTutorial_zh_CN.pdf] Error 1
Traceback (most recent call last):
  File "/usr/local/src/sage/sage-5.10.rc1/devel/sage/doc/common/builder.py", line 1454, in <module>
    getattr(get_builder(name), type)()
  File "/usr/local/src/sage/sage-5.10.rc1/devel/sage/doc/common/builder.py", line 208, in pdf
    raise RuntimeError("failed to run $MAKE all-pdf in %s"%tex_dir)
RuntimeError: failed to run $MAKE all-pdf in /usr/local/src/sage/sage-5.10.rc1/devel/sage/doc/output/latex/zh_CN/a_tour_of_sage
```

Just in Sage shell in `sage/doc/output/latex/zh_CN/a_tour_of_sage` I get 

```
$ make    
env </dev/null pool_size=4000000 save_size=50000 extra_mem_top=2000000 xelatex  'SageTutorial_zh_CN.tex'
This is XeTeX, Version 3.1415926-2.2-0.9995.2 (TeX Live 2009/Debian)
(Fatal format file error; I'm stymied)
make: *** [SageTutorial_zh_CN.pdf] Error 1
```


This seems to indicate that xelatex cannot find the right format file.
Indeed, it works on "normal" files. Also note that
and in the normal shell I get

```
$ make
env </dev/null pool_size=4000000 save_size=50000 extra_mem_top=2000000 xelatex  'SageTutorial_zh_CN.tex'
This is XeTeX, Version 3.1415926-2.2-0.9995.2 (TeX Live 2009/Debian)
entering extended mode
(./SageTutorial_zh_CN.tex
LaTeX2e <2009/09/24>
Babel <v3.8l> and hyphenation patterns for english, usenglishmax, dumylang, noh
yphenation, farsi, arabic, croatian, bulgarian, ukrainian, russian, czech, slov
ak, danish, dutch, finnish, french, basque, ngerman, german, german-x-2009-06-1
9, ngerman-x-2009-06-19, ibycus, monogreek, greek, ancientgreek, hungarian, san
skrit, italian, latin, latvian, lithuanian, mongolian2a, mongolian, bokmal, nyn
orsk, romanian, irish, coptic, serbian, turkish, welsh, esperanto, uppersorbian
, estonian, indonesian, interlingua, icelandic, kurmanji, slovenian, polish, po
rtuguese, spanish, galician, catalan, swedish, ukenglish, pinyin, loaded.
(./sphinxmanual.cls
Document Class: sphinxmanual 2009/06/02 Document class (Sphinx manual)
(/usr/share/texmf-texlive/tex/latex/base/report.cls
Document Class: report 2007/10/19 v1.4h Standard LaTeX document class
(/usr/share/texmf-texlive/tex/latex/base/size10.clo)))
! Undefined control sequence.
l.5 \DeclareUnicodeCharacter
                            {00A0}{\nobreakspace}
?
! Emergency stop.
l.5 \DeclareUnicodeCharacter
                            {00A0}{\nobreakspace}
No pages of output.
Transcript written on SageTutorial_zh_CN.log.
make: *** [SageTutorial_zh_CN.pdf] Error 1
```



---

Comment by dimpase created at 2013-06-06 17:29:08

With `TexLive 2012`, the error is less strange:

```
sage -docbuild zh_CN/a_tour_of_sage pdf
[a_tour_of] loading translations [zh_CN]... done
[a_tour_of] Compiling the master document
[a_tour_of] building [latex]: all documents
[a_tour_of] updating environment: 0 added, 1 changed, 0 removed
[a_tour_of] reading sources... [100%] index
[a_tour_of] Merging environment/index files...
[a_tour_of] ... done (0 todos, 1 index, 0 citations, 0 modules)
[a_tour_of] Saved pickle file: citations.pickle
[a_tour_of] pickling environment... done
[a_tour_of] checking consistency... done
[a_tour_of] processing SageTutorial_zh_CN.tex... index
[a_tour_of] resolving references...
[a_tour_of] writing... done
[a_tour_of] copying images... interact_screenshot.jpg sin_plot.png circles_plot.png plot_3d.jpg eigen_plot.png
[a_tour_of] copying TeX support files... done
[a_tour_of] build succeeded, 1 warning.
env </dev/null pool_size=4000000 save_size=50000 extra_mem_top=2000000 xelatex  'SageTutorial_zh_CN.tex'
This is XeTeX, Version 3.1415926-2.4-0.9998 (TeX Live 2012)
 restricted \write18 enabled.
entering extended mode
(./SageTutorial_zh_CN.tex
LaTeX2e <2011/06/27>
Babel <v3.8m> and hyphenation patterns for english, dumylang, nohyphenation, ge
rman-x-2012-05-30, ngerman-x-2012-05-30, afrikaans, ancientgreek, ibycus, arabi
c, armenian, basque, bulgarian, catalan, pinyin, coptic, croatian, czech, danis
h, dutch, ukenglish, usenglishmax, esperanto, estonian, ethiopic, farsi, finnis
h, french, friulan, galician, german, ngerman, swissgerman, monogreek, greek, h
ungarian, icelandic, assamese, bengali, gujarati, hindi, kannada, malayalam, ma
rathi, oriya, panjabi, tamil, telugu, indonesian, interlingua, irish, italian,
kurmanji, latin, latvian, lithuanian, mongolian, mongolianlmc, bokmal, nynorsk,
 piedmontese, polish, portuguese, romanian, romansh, russian, sanskrit, serbian
, serbianc, slovak, slovenian, spanish, swedish, turkish, turkmen, ukrainian, u
ppersorbian, welsh, loaded.
(./sphinxmanual.cls
Document Class: sphinxmanual 2009/06/02 Document class (Sphinx manual)
(/usr/local/texlive/2012/texmf-dist/tex/latex/base/report.cls
Document Class: report 2007/10/19 v1.4h Standard LaTeX document class
(/usr/local/texlive/2012/texmf-dist/tex/latex/base/size10.clo)))
! Undefined control sequence.
l.5 \DeclareUnicodeCharacter
                            {00A0}{\nobreakspace}
?
! Emergency stop.
l.5 \DeclareUnicodeCharacter
                            {00A0}{\nobreakspace}
No pages of output.
Transcript written on SageTutorial_zh_CN.log.
make: *** [SageTutorial_zh_CN.pdf] Error 1
Traceback (most recent call last):
  File "/usr/local/src/sage/sage-5.10.rc1/devel/sage/doc/common/builder.py", line 1454, in <module>
    getattr(get_builder(name), type)()
  File "/usr/local/src/sage/sage-5.10.rc1/devel/sage/doc/common/builder.py", line 208, in pdf
    raise RuntimeError("failed to run $MAKE all-pdf in %s"%tex_dir)
RuntimeError: failed to run $MAKE all-pdf in /usr/local/src/sage/sage-5.10.rc1/devel/sage/doc/output/latex/zh_CN/a_tour_of_sage
```



---

Comment by vbraun created at 2013-06-06 17:39:54

Did you delete the old (cached) latex file? I.e. `rm -rf doc/output` before running the docbuild. It seems that your latex file contains precisely what I disabled...


---

Comment by dimpase created at 2013-06-06 18:05:15

Replying to [comment:23 vbraun]:
> Did you delete the old (cached) latex file? I.e. `rm -rf doc/output` before running the docbuild. It seems that your latex file contains precisely what I disabled...

I just tried this, makes no difference. By the way, `ru/tutorial pdf` builds OK.


---

Comment by vbraun created at 2013-06-06 20:46:31

Sorry, I had the wrong latex file cached. Fixed in the updated patch.


---

Comment by dimpase created at 2013-06-07 07:05:12

Replying to [comment:26 vbraun]:
> Sorry, I had the wrong latex file cached. Fixed in the updated patch.

OK, it's all good. I was missing system zh, etc, fonts on Debian.


---

Comment by jdemeyer created at 2013-06-07 14:30:35

Using `subprocess.check_output()` in the docbuilder is dangerous, it caused #14626. So either you need to be very sure that this cannot happen again or you need to apply a workaround similar to #14626.


---

Comment by vbraun created at 2013-06-07 15:19:32

Fixed.


---

Comment by dimpase created at 2013-06-08 03:58:31

Changing status from needs_review to needs_info.


---

Comment by dimpase created at 2013-06-08 03:58:31

There are few more or less trivial issues with the text:
 1) references to Sage are quite outdated

 2) the part corresponding to the "Tour fo Sage" has strange formatting (extra sub-headers)

 3) it should be proofread by a native speaker just in case

Fixing 1) ought to be done by (with help of) a native speaker, as it's not really clear what's going on there. I'll ask someone to have a look, but he unfortunately doesn't work with Sage. Should I ask for a rough English translation of the 1st part, so that links/refs can be adjusted?

I've also emailed the original author asking if (s)he can help.


---

Comment by vbraun created at 2013-06-08 10:50:31

I don't think its a good idea to translate English->Chinese->English and then edit that as an English speaker ;-)

The installation instructions should be rewritten to not reference a particular version number (as in http://www.sagemath.org/doc/installation/). And separated into a different page, at least. Ideally we'd have a separate translation of the installation instructions, but that is a bigger task.

Also, I don't think its really necessary to spend time on typesetting nitpicks in the pdf version. The html output is the one we should be worrying about.


---

Comment by dimpase created at 2013-06-08 17:49:01

the rST doc, for review only (it's also in the patch)


---

Attachment

Updated patch


---

Comment by vbraun created at 2013-06-18 23:09:14

Updated with better check for XeTeX


---

Comment by dimpase created at 2013-06-19 09:42:49

Replying to [comment:33 vbraun]:
> I don't think its a good idea to translate English->Chinese->English and then edit that as an English speaker ;-)
> 
> The installation instructions should be rewritten to not reference a particular version number (as in http://www.sagemath.org/doc/installation/). And separated into a different page, at least. Ideally we'd have a separate translation of the installation instructions, but that is a bigger task.

Hopefully my student will work on this next month.


---

Comment by chapoton created at 2014-07-18 12:58:18

Changing keywords from "" to "chinese".


---

Comment by chapoton created at 2014-08-31 18:48:53

The files seem to be pretty outdated, with many references to Sage 4.8 (sic).
----
New commits:


---

Comment by chapoton created at 2014-08-31 18:48:53

Changing status from needs_info to needs_work.


---

Comment by git created at 2014-11-17 20:19:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-11-17 20:23:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-11-20 16:34:13

Changing component from documentation to translations.


---

Comment by kcrisman created at 2014-12-04 18:21:53

A couple comments.  
* First, do we even care about `zh` versus `zh_CN` and friends?   In which case we may want to change some of our other doc - but I'm not interested in breaking links for this sake.  But thought I'd ask.
* I agree we should break this out into a (small) separate installation document with updated references.  (Google translate is a lot more powerful than it used to be.)   Hopefully not too hard to do.
* I'm not quite as worried about it diverging from the "original" tour because
  * the tour is really not THAT useful
  * our translations always diverge from the "up-to-date"
  * we can think about it as no translation is one-to-one, like the LOTR movies versus the books...
 
  but if it's important to keep them the same, that will probably mean this stagnates and is only available on the website of the guy.  Honestly, this tour is better than the "real" one though I understand why that one is the way it is (mimicking some old Wolfram document, right?).
* I agree that the subheadings are (mostly) superfluous, and will probably remove them.
* I note that the plot thing in the "tour" is actually completely mysterious in the standard doc.  See #17444.

I have a native speaker who has agreed (in principle) to proofread this (and #9577) as well.


---

Comment by kcrisman created at 2014-12-04 20:11:44

I'm having _exactly_ the same pdf build problem Dima had in the now-vanquished comment:27.    I do have `xelatex` and

```
$ latex -v
pdfTeX 3.1415926-2.4-1.40.13 (TeX Live 2012)
kpathsea version 6.1.0
Copyright 2012 Peter Breitenlohner (eTeX)/Han The Thanh (pdfTeX).
There is NO warranty.  Redistribution of this software is
covered by the terms of both the pdfTeX copyright and
the Lesser GNU General Public License.
For more information about these matters, see the file
named COPYING and the pdfTeX source.
Primary author of pdfTeX: Peter Breitenlohner (eTeX)/Han The Thanh (pdfTeX).
Compiled with libpng 1.5.10; using libpng 1.5.10
Compiled with zlib 1.2.7; using zlib 1.2.7
Compiled with xpdf version 3.03
```

I don't know how to update these fonts, browsing tex.SX left me unenlightened.


---

Comment by kcrisman created at 2014-12-04 20:15:27

Incidentally, in the installation bit, I think it's not so horrible if we have old version names in the thing, as long as it's clear those are _samples_.  However, the reference to Cygwin needs to go, since it's not exactly easy even though it's now more or less supported.

Also, I think the bottom bit about versions of the document and the second paragraph at the top about the author's own reasons for doing it, while both okay, are not really useful.  I'm not sure how to interpret the CC-BY-SA, since there is no actual attribution in the document of the author!


---

Comment by kcrisman created at 2014-12-04 20:19:58

Note the author's gh site seems to be https://github.com/kehengsite
----
New commits:


---

Comment by git created at 2014-12-04 20:21:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-12-04 20:24:08

I think I got everything but the original things Dima pointed out.  So need yet to:
>  1) references to Sage are quite outdated
In some fashion fix this;
>  2) the part corresponding to the "Tour fo Sage" has strange formatting (extra sub-headers)
Fix this; and
>  3) it should be proofread by a native speaker just in case
Do this.

Oh, and also probably change the project name since the "tutorial" is #9577!


---

Comment by kcrisman created at 2014-12-05 15:08:15

I have pdf success!  The real problem is that TeXlive 2012 assumes some Windows default fonts.  Unfortunately, those are different from both the Linux defaults and the Mac defaults, which are _themselves_ not the same!

```diff

--- a/src/doc/zh_CN/a_tour_of_sage/conf.py
+++ b/src/doc/zh_CN/a_tour_of_sage/conf.py
`@``@` -41,9 +41,12 `@``@` latex_elements['utf8extra'] = ''
 
 latex_elements['preamble'] = """
 \usepackage[noindent,UTF8]{ctexcap}
-\setCJKmainfont{AR PL UMing CN}
-\setCJKsansfont{WenQuanYi Zen Hei}
-\setCJKmonofont{WenQuanYi Zen Hei Mono}
+\setCJKmainfont[BoldFont=STHeiti,ItalicFont=STKaiti]{STSong}
+\setCJKsansfont[BoldFont=STHeiti]{STXihei}
+\setCJKmonofont{STFangsong}
+%\setCJKmainfont{AR PL UMing CN}
+%\setCJKsansfont{WenQuanYi Zen Hei}
+%\setCJKmonofont{WenQuanYi Zen Hei Mono}
 \usepackage{amsmath}
 \usepackage{amssymb}
 """
```

I couldn't find a good font that both support without extra work.  Unfortunately, that means that Volker's workaround for auto-detecting xelatex isn't good enough, because even with this not all of them will work the same.  What do you guys think?

Edit: I may have a solution using the `fallback` option that at least some cjk packages have.  Editit: or maybe not, that appears to be a fallback for characters not in the font, not for a _missing_ font... I'll try it, anyway.


---

Comment by kcrisman created at 2014-12-05 16:58:39

See the answer to [this tex.SX question](http://tex.stackexchange.com/questions/215564/what-chinese-fonts-can-i-rely-on-to-be-in-mac-and-linux) for what would be a solution if one had recent enough TeX Live, perhaps.


---

Comment by kcrisman created at 2014-12-05 17:52:57

Okay, update: Linux Chinese fonts are a mess and not standardized, Mac seems to share nearly zero pre-installed ones with them anyway, and the only portable solution is to require everyone to upgrade to TeX Live 2014!  (Or so it seems.)


---

Comment by kcrisman created at 2014-12-05 18:21:44

Volker, do you think we could modify `enable_if_necessary` in src/doc/common/CJKsupport.py in such a way to check for TeX Live 2014 and just require that for building pdf here (and/or whatever fonts are eventually hard-coded in)?


---

Comment by kcrisman created at 2014-12-06 04:15:30

This is very much a hack, but should guarantee at least a one-stop shop for certain Mac and Linux - although I note sage.math does not have this TeX Live version.  Does the build machine have it?

```diff
diff --git a/src/doc/common/CJKsupport.py b/src/doc/common/CJKsupport.py
index 4635793..209f409 100644
--- a/src/doc/common/CJKsupport.py
+++ b/src/doc/common/CJKsupport.py
`@``@` -19,11 +19,17 `@``@` def enable_if_necessary(lang, latex_directory):
         print "which you do not have installed"
         disable(latex_directory, lang)
         return False
+    if not have_texlive_2014():
+        print "Disabling pdf documentation for {0} because it requires TeX Live 2014+".for
+        print "by default, which you do not have installed"
+        disable(latex_directory, lang)
+        return False
     fixup_makefile(os.path.join(latex_directory, 'Makefile'), lang)
     return True
 
 
 HAVE_XELATEX = None
+HAVE_TEXLIVE_2014 = None
 
 def have_xelatex():
     """
`@``@` -43,6 +49,26 `@``@` def have_xelatex():
             HAVE_XELATEX = False
     return HAVE_XELATEX
 
+def have_texlive_2014():
+    """
+    Return whether TeX Live 2014+ is installed, so that you
+    have the Fandol fonts
+
+    EXAMPLES::
+
+        sage: import os, sys; sys.path.append(os.environ['SAGE_DOC']+'/common/'); import C
+        sage: CJKsupport.have_texlive_2014() in [True, False]
+        True
+    """
+    global HAVE_TEXLIVE_2014
+    if HAVE_TEXLIVE_2014 is None:
+        try:
+            S = check_output(["kpsewhich", "--var-value", "TEXMFDIST"])
+            fontdir = os.path.join(S.split()[0],'fonts/opentype/public')
+            HAVE_TEXLIVE_2014 = 'fandol' in check_output(['ls', fontdir])
+         except OSError:
+            HAVE_TEXLIVE_2014 = False
+
 
 def fixup_makefile(makefile, lang):
     """
`@``@` -63,7 +89,7 `@``@` DISABLED_LATEX_FILE = r"""
 \begin{document}
 
 Running LaTeX for documents containing CJK fonts requires XeTeX, which
-you do not have installed. Consult your latex installation manual to
+you may not have installed. Consult your latex installation manual to
 find out how you can add it.
 \begin{itemize}
 \item 
`@``@` -71,6 +97,12 `@``@` find out how you can add it.
   \texttt{tlmgr install common-xetex}
 \end{itemize}
 
+If you have XeTeX but are using TeXlive before 2014, or another package,
+you will need to modify src/doc/common/CJKsupport.py by having the function
+have_texlive_2014 return True, and replace the default fonts in the conf.py
+for the file you are compiling to fonts available on your system or
+latex installation.
+
 \end{document}
 """
```



---

Comment by chapoton created at 2015-11-09 08:48:47

I tried to use the same trick as for japanese..
----
New commits:


---

Comment by kcrisman created at 2015-11-09 17:52:25


```
+        For the special case of the ja docs, run 'all-pdf-ja(ex,to run
+        platex)' there.
```

Should this also read the zh docs?

If you found a trick that works on Mac and at least some Linux with pdf, that would be very good indeed!  Make sure it works on both.


---

Comment by git created at 2016-03-22 14:19:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-03-25 08:39:02

Branch pushed to git repo; I updated commit sha1. New commits:
