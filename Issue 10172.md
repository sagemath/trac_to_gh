# Issue 10172: asking if polynomial element in list gives error

Issue created by migration from Trac.

Original creator: mariah

Original creation time: 2010-10-25 20:16:46

Assignee: malb


```
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: R = BooleanPolynomialRing(256,'x')
sage: LR = [R.gen(i) for i in range(256)]
sage: S = PolynomialRing(GF(2),256,'y')
sage: S.gen(8) in LR
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
| Sage Version 4.5.3, Release Date: 2010-09-04                       |
| Type notebook() for the GUI, and license() for information.        |
/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/<ipython console> in <module>()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so in sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular.__richcmp__ (sage/rings/polynomial/multi_polynomial_libsingular.cpp:13767)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/element.so in sage.structure.element.Element._richcmp (sage/structure/element.c:6487)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:7226)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.coercion_maps (sage/structure/coerce.c:8783)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/coerce.so in sage.structure.coerce.CoercionModel_cache_maps.discover_coercion (sage/structure/coerce.c:10329)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.coerce_map_from (sage/structure/parent.c:5339)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.discover_coerce_map_from (sage/structure/parent.c:12084)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/parent_old.so in sage.structure.parent_old.Parent._coerce_map_from_ (sage/structure/parent_old.c:5955)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/parent_old.so in sage.structure.parent_old.Parent.coerce_map_from_c (sage/structure/parent_old.c:1838)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/parent_old.so in sage.structure.parent_old.Parent.coerce_map_from_c_impl (sage/structure/parent_old.c:2544)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/parent_old.so in sage.structure.parent_old.Parent.has_coerce_map_from_c (sage/structure/parent_old.c:4471)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/parent_old.so in sage.structure.parent_old.Parent.has_coerce_map_from_c_impl (sage/structure/parent_old.c:4687)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/structure/parent_old.so in sage.structure.parent_old.Parent._coerce_c (sage/structure/parent_old.c:3561)()

/home/mariah/sage/sage-4.5.3-x86_64-Linux-core2-fc/local/lib/python2.6/site-packages/sage/rings/polynomial/pbori.so in sage.rings.polynomial.pbori.BooleanPolynomialRing._coerce_c_impl (sage/rings/polynomial/pbori.cpp:6564)()

ValueError: cannot coerce polynomial y0 to Boolean PolynomialRing in x0, x1, x2, x3, x4, x5, x6, x7, x8, x9, x10, x11, x12, x13, x14, x15, x16, x17, x18, x19, x20, x21, x22, x23, x24, x25, x26, x27, x28, x29, x30, x31, x32, x33, x34, x35, x36, x37, x38, x39, x40, x41, x42, x43, x44, x45, x46, x47, x48, x49, x50, x51, x52, x53, x54, x55, x56, x57, x58, x59, x60, x61, x62, x63, x64, x65, x66, x67, x68, x69, x70, x71, x72, x73, x74, x75, x76, x77, x78, x79, x80, x81, x82, x83, x84, x85, x86, x87, x88, x89, x90, x91, x92, x93, x94, x95, x96, x97, x98, x99, x100, x101, x102, x103, x104, x105, x106, x107, x108, x109, x110, x111, x112, x113, x114, x115, x116, x117, x118, x119, x120, x121, x122, x123, x124, x125, x126, x127, x128, x129, x130, x131, x132, x133, x134, x135, x136, x137, x138, x139, x140, x141, x142, x143, x144, x145, x146, x147, x148, x149, x150, x151, x152, x153, x154, x155, x156, x157, x158, x159, x160, x161, x162, x163, x164, x165, x166, x167, x168, x169, x170, x171, x172, x173, x174, x175, x176, x177, x178, x179, x180, x181, x182, x183, x184, x185, x186, x187, x188, x189, x190, x191, x192, x193, x194, x195, x196, x197, x198, x199, x200, x201, x202, x203, x204, x205, x206, x207, x208, x209, x210, x211, x212, x213, x214, x215, x216, x217, x218, x219, x220, x221, x222, x223, x224, x225, x226, x227, x228, x229, x230, x231, x232, x233, x234, x235, x236, x237, x238, x239, x240, x241, x242, x243, x244, x245, x246, x247, x248, x249, x250, x251, x252, x253, x254, x255: name y0 not defined
sage: 
```



---

Comment by spancratz created at 2011-01-09 00:41:00

The following code already triggers the bug(?),


```
sage: R = BooleanPolynomialRing(256,'x')
sage: S = PolynomialRing(GF(2),256,'y')
sage: R(S.gen(8))
```



---

Comment by wjp created at 2011-01-09 01:24:38

That's something different I think. In the reported bug a failing coercion is being reported while it should probably just be returning False.

Compare with:


```
sage: R.<x,y> = ZZ[]
sage: S.<z> = ZZ[]
sage: z in R
False
```


vs


```
sage: R(z)
*kaboom*
```



---

Comment by wjp created at 2011-01-09 01:41:51

The reason for this seems to be that `sage.rings.polynomial.pbori.BooleanPolynomialRing.__contains__` tries a coercion and only catches `TypeError`, while the failing coercion raises a `ValueError` (in `sage.rings.polynomial.pbori.BooleanPolynomialRing._coerce_c_impl` ).


---

Attachment

I attached a patch that changes the exception raised to a TypeError as this seems to be more consistent with the rest of sage.


---

Comment by wjp created at 2011-01-09 02:08:20

Changing status from new to needs_review.


---

Comment by gbe created at 2011-01-09 02:26:03

Patch applies cleanly, and doctest passes both before and after application.

Running

```
sage: R = BooleanPolynomialRing(256,'x')
sage: LR = [R.gen(i) for i in range(256)]
sage: S = PolynomialRing(GF(2),256,'y')
sage: S.gen(8) in LR
```

now returns false as expected.

Running

```
sage: R = BooleanPolynomialRing(256,'x')
sage: S = PolynomialRing(GF(2),256,'y')
sage: R(S.gen(8))
```

still blows up, but with a TypeError instead of a ValueError now. This is the correct behavior (I believe) for

```
R(S.gen(8)
```

in this situation.


---

Comment by gbe created at 2011-01-09 02:26:03

Changing status from needs_review to positive_review.


---

Comment by gbe created at 2011-01-09 02:26:31

Changing type from PLEASE CHANGE to defect.


---

Comment by jdemeyer created at 2011-01-26 22:26:56

Resolution: fixed
