# Issue 10056: Change import location for decorator_defaults in sagenb interact.py

archive/issues_010056.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @johanrosenkilde\n\nThis line is in the interact.py file in sagenb:\n\n\n```\nfrom sage.misc.misc import decorator_defaults\n```\n\n\n#9907 moved this to sage.misc.decorators, so the import location should be changed after it is merged.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10057\n\n",
    "created_at": "2010-10-02T19:44:08Z",
    "labels": [
        "notebook",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.5",
    "title": "Change import location for decorator_defaults in sagenb interact.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10056",
    "user": "@jasongrout"
}
```
Assignee: jason, was

CC:  @johanrosenkilde

This line is in the interact.py file in sagenb:


```
from sage.misc.misc import decorator_defaults
```


#9907 moved this to sage.misc.decorators, so the import location should be changed after it is merged.

Issue created by migration from https://trac.sagemath.org/ticket/10057





---

archive/issue_comments_101369.json:
```json
{
    "body": "Attachment [trac_10057.patch](tarball://root/attachments/some-uuid/ticket10057/trac_10057.patch) by @mwhansen created at 2010-10-09 20:10:01",
    "created_at": "2010-10-09T20:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101369",
    "user": "@mwhansen"
}
```

Attachment [trac_10057.patch](tarball://root/attachments/some-uuid/ticket10057/trac_10057.patch) by @mwhansen created at 2010-10-09 20:10:01



---

archive/issue_comments_101370.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-10-09T20:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101370",
    "user": "@mwhansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_101371.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2012-01-10T10:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101371",
    "user": "@zimmermann6"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_101372.json:
```json
{
    "body": "Mike,\n\nI started to review that ticket, but I'm puzzled since\n\n```\nsage: from sage.misc.misc import decorator_defaults\n```\n\nstill works. Shouldn't it fail?\n\nAlso, shouldn't the patch include a doctest?\n\nPaul",
    "created_at": "2012-01-10T10:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101372",
    "user": "@zimmermann6"
}
```

Mike,

I started to review that ticket, but I'm puzzled since

```
sage: from sage.misc.misc import decorator_defaults
```

still works. Shouldn't it fail?

Also, shouldn't the patch include a doctest?

Paul



---

archive/issue_comments_101373.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd35.5\".",
    "created_at": "2012-01-10T10:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101373",
    "user": "@zimmermann6"
}
```

Changing keywords from "" to "sd35.5".



---

archive/issue_comments_101374.json:
```json
{
    "body": "Replying to [comment:3 zimmerma]:\n> Mike,\n> \n> I started to review that ticket, but I'm puzzled since\n> {{{\n> sage: from sage.misc.misc import decorator_defaults\n> }}}\n> still works. Shouldn't it fail?\n> \n\nThe reason it doesn't fail is because sage.misc.misc contains an import statement, importing decorator_defaults among other (line 2735). This was introduced in #9907 for backwards compatibility, in case users assumed that these decorators would still be in sage.misc.misc. I assumed this would be a temporary thing, just as for keyword and attribute changes. #9907 was merged 14 months ago, so this is longer than the deprecation lifetime, but on the other hand, no deprecation warning has been issued to users doing the wrong thing for these past 14 months. I'm not sure what is usually done under such circumstances. Also, removing the import statement from sage.misc.misc will result in the pickle jar breaking, and I'm not sure how to remedy that and what consequences it might have. Need expert opinion here.\n\n> Also, shouldn't the patch include a doctest?\n\nMaybe that's just me, but isn't it a bit too much including a doctest just for a relocation of a function? It's still the same function.",
    "created_at": "2012-01-10T12:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101374",
    "user": "@johanrosenkilde"
}
```

Replying to [comment:3 zimmerma]:
> Mike,
> 
> I started to review that ticket, but I'm puzzled since
> {{{
> sage: from sage.misc.misc import decorator_defaults
> }}}
> still works. Shouldn't it fail?
> 

The reason it doesn't fail is because sage.misc.misc contains an import statement, importing decorator_defaults among other (line 2735). This was introduced in #9907 for backwards compatibility, in case users assumed that these decorators would still be in sage.misc.misc. I assumed this would be a temporary thing, just as for keyword and attribute changes. #9907 was merged 14 months ago, so this is longer than the deprecation lifetime, but on the other hand, no deprecation warning has been issued to users doing the wrong thing for these past 14 months. I'm not sure what is usually done under such circumstances. Also, removing the import statement from sage.misc.misc will result in the pickle jar breaking, and I'm not sure how to remedy that and what consequences it might have. Need expert opinion here.

> Also, shouldn't the patch include a doctest?

Maybe that's just me, but isn't it a bit too much including a doctest just for a relocation of a function? It's still the same function.



---

archive/issue_comments_101375.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-01-10T13:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101375",
    "user": "@zimmermann6"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_101376.json:
```json
{
    "body": "ok I understand. But then I don't know what a reviewer is supposed to do for such a patch.\nAnyway I put it back to needs review.\n\nPaul",
    "created_at": "2012-01-10T13:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101376",
    "user": "@zimmermann6"
}
```

ok I understand. But then I don't know what a reviewer is supposed to do for such a patch.
Anyway I put it back to needs review.

Paul



---

archive/issue_comments_101377.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-06-18T20:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101377",
    "user": "@kcrisman"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_101378.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2014-12-06T20:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101378",
    "user": "@jdemeyer"
}
```

Resolution: invalid



---

archive/issue_comments_101379.json:
```json
{
    "body": "I'm working on a sagenb pull request.",
    "created_at": "2014-12-06T20:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101379",
    "user": "@jdemeyer"
}
```

I'm working on a sagenb pull request.



---

archive/issue_comments_101380.json:
```json
{
    "body": "Resolution changed from invalid to ",
    "created_at": "2014-12-06T20:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101380",
    "user": "@kcrisman"
}
```

Resolution changed from invalid to 



---

archive/issue_comments_101381.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2014-12-06T20:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101381",
    "user": "@kcrisman"
}
```

Changing status from closed to new.



---

archive/issue_comments_101382.json:
```json
{
    "body": "Hey, only the release manager gets to close a ticket!  ;-)\n\nMore seriously, should we remove the 'deprecated' import or is the pickle jar issue mentioned [comment:4 above] serious enough to not do that?  Anyway, better to keep this as an \"upstream tracking\" ticket, as sagenb will still need to be upgraded for this (and whatever else - https://github.com/sagemath/sagenb/pull/267 could use review, for instance).",
    "created_at": "2014-12-06T20:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101382",
    "user": "@kcrisman"
}
```

Hey, only the release manager gets to close a ticket!  ;-)

More seriously, should we remove the 'deprecated' import or is the pickle jar issue mentioned [comment:4 above] serious enough to not do that?  Anyway, better to keep this as an "upstream tracking" ticket, as sagenb will still need to be upgraded for this (and whatever else - https://github.com/sagemath/sagenb/pull/267 could use review, for instance).



---

archive/issue_comments_101383.json:
```json
{
    "body": "Changing component from notebook to packages: standard.",
    "created_at": "2014-12-06T20:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101383",
    "user": "@jdemeyer"
}
```

Changing component from notebook to packages: standard.



---

archive/issue_comments_101384.json:
```json
{
    "body": "OK, I'll rework the ticket.",
    "created_at": "2014-12-06T20:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101384",
    "user": "@jdemeyer"
}
```

OK, I'll rework the ticket.



---

archive/issue_comments_101385.json:
```json
{
    "body": "Okay.  Now if you can at least look at https://github.com/sagemath/sagenb/pull/282 for me (since you already have a working sagenb development environment) I would be grateful.  Given its importance, I'd also appreciate a look at https://github.com/sagemath/sagenb/pull/267 but I know that one requires just slightly more testing, though in reality both patches are fairly trivial.",
    "created_at": "2014-12-08T16:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101385",
    "user": "@kcrisman"
}
```

Okay.  Now if you can at least look at https://github.com/sagemath/sagenb/pull/282 for me (since you already have a working sagenb development environment) I would be grateful.  Given its importance, I'd also appreciate a look at https://github.com/sagemath/sagenb/pull/267 but I know that one requires just slightly more testing, though in reality both patches are fairly trivial.



---

archive/issue_comments_101386.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-12-22T15:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101386",
    "user": "@kcrisman"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_101387.json:
```json
{
    "body": "For reference to #17490, I used `gnutar` and not the standard Mac `tar`, so hopefully that is resolved temporarily with this sagenb.\n----\nNew commits:",
    "created_at": "2014-12-22T15:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101387",
    "user": "@kcrisman"
}
```

For reference to #17490, I used `gnutar` and not the standard Mac `tar`, so hopefully that is resolved temporarily with this sagenb.
----
New commits:



---

archive/issue_comments_101388.json:
```json
{
    "body": "Replying to [comment:18 kcrisman]:\n> For reference to #17490, I used `gnutar` and not the standard Mac `tar`, so hopefully that is resolved temporarily with this sagenb.\n\nAt least I see\n\n```\njdemeyer@tamiyo:/usr/local/src/sage-git/upstream$ file sagenb-*\nsagenb-0.10.8.2.tar: POSIX tar archive (GNU)\nsagenb-0.11.0.tar:   POSIX tar archive\nsagenb-0.11.1.tar:   POSIX tar archive\nsagenb-0.11.2.tar:   POSIX tar archive (GNU)\n```\n",
    "created_at": "2014-12-22T16:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101388",
    "user": "@jdemeyer"
}
```

Replying to [comment:18 kcrisman]:
> For reference to #17490, I used `gnutar` and not the standard Mac `tar`, so hopefully that is resolved temporarily with this sagenb.

At least I see

```
jdemeyer@tamiyo:/usr/local/src/sage-git/upstream$ file sagenb-*
sagenb-0.10.8.2.tar: POSIX tar archive (GNU)
sagenb-0.11.0.tar:   POSIX tar archive
sagenb-0.11.1.tar:   POSIX tar archive
sagenb-0.11.2.tar:   POSIX tar archive (GNU)
```




---

archive/issue_comments_101389.json:
```json
{
    "body": "I don't know that this will *fix* #17490, though I can fix the upstream release instructions.  But that is a good sign.\n\nAnyway, ready for review.  Most stuff is either obvious fixes or stuff that doesn't affect day-to-day notebook operations (the translation stuff).",
    "created_at": "2014-12-22T16:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101389",
    "user": "@kcrisman"
}
```

I don't know that this will *fix* #17490, though I can fix the upstream release instructions.  But that is a good sign.

Anyway, ready for review.  Most stuff is either obvious fixes or stuff that doesn't affect day-to-day notebook operations (the translation stuff).



---

archive/issue_comments_101390.json:
```json
{
    "body": "I guess a review will be mostly \"does it build and pass doctests?\", assuming that everything was actually reviewed upstream.",
    "created_at": "2014-12-22T16:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101390",
    "user": "@jdemeyer"
}
```

I guess a review will be mostly "does it build and pass doctests?", assuming that everything was actually reviewed upstream.



---

archive/issue_comments_101391.json:
```json
{
    "body": "I think it is worth checking whether there is any serious regression of behavior - make sure worksheets still work, test random functionality, etc. as a whole.  Especially worth making sure the *Sage* tickets mentioned above are actually fixed by the upgrade.  The only possible issue I can foresee is if one of the packages upstream of upstream changed a doctest - I had some bizarre Sage failure related to Babel but I don't see how it could have come from a 'standard' sagenb installation. \n\nWhich reminds me that #17482 is just waiting for your say-so, I made the change you requested.",
    "created_at": "2014-12-22T17:11:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101391",
    "user": "@kcrisman"
}
```

I think it is worth checking whether there is any serious regression of behavior - make sure worksheets still work, test random functionality, etc. as a whole.  Especially worth making sure the *Sage* tickets mentioned above are actually fixed by the upgrade.  The only possible issue I can foresee is if one of the packages upstream of upstream changed a doctest - I had some bizarre Sage failure related to Babel but I don't see how it could have come from a 'standard' sagenb installation. 

Which reminds me that #17482 is just waiting for your say-so, I made the change you requested.



---

archive/issue_comments_101392.json:
```json
{
    "body": "Can someone check whether this could cause\n\n```\nsage -t --long src/sage/symbolic/expression.pyx\nFailed example:\n    import sagenb.misc.support as s\nExpected nothing\nGot:\n    doctest:14: ImportWarning: Not importing directory '/Users/...sage/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/localedata': missing __init__.py\n```\n\nor whether that is just because of my sagenb setup, not a problem per se?  There is a similar failure in \n\n```\nsage -t --long src/sage/combinat/cluster_algebra_quiver/quiver.py\nsage -t --long src/sage/misc/dev_tools.py\n```\n\nAlso the usual\n\n```\n\nFile \"src/sage/repl/notebook_ipython.py\", line 60, in sage.repl.notebook_ipython.have_prerequisites\nFailed example:\n    from sage.repl.notebook_ipython import have_prerequisites\nExpected nothing\nGot:\n    doctest:57: PowmInsecureWarning: Not using mpz_powm_sec.  You should rebuild using libgmp >= 5 to avoid timing attack vulnerability.\n\n```\n\nalso in\n\n```\nsage -t --long src/sage/repl/zmq_kernel.py\n```\n\nthough I don't (yet) have beta4.",
    "created_at": "2014-12-22T19:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101392",
    "user": "@kcrisman"
}
```

Can someone check whether this could cause

```
sage -t --long src/sage/symbolic/expression.pyx
Failed example:
    import sagenb.misc.support as s
Expected nothing
Got:
    doctest:14: ImportWarning: Not importing directory '/Users/...sage/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/localedata': missing __init__.py
```

or whether that is just because of my sagenb setup, not a problem per se?  There is a similar failure in 

```
sage -t --long src/sage/combinat/cluster_algebra_quiver/quiver.py
sage -t --long src/sage/misc/dev_tools.py
```

Also the usual

```

File "src/sage/repl/notebook_ipython.py", line 60, in sage.repl.notebook_ipython.have_prerequisites
Failed example:
    from sage.repl.notebook_ipython import have_prerequisites
Expected nothing
Got:
    doctest:57: PowmInsecureWarning: Not using mpz_powm_sec.  You should rebuild using libgmp >= 5 to avoid timing attack vulnerability.

```

also in

```
sage -t --long src/sage/repl/zmq_kernel.py
```

though I don't (yet) have beta4.



---

archive/issue_comments_101393.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-12-22T19:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101393",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_101394.json:
```json
{
    "body": "Indeed, this is a regression:\n\n```\nsage -t --long src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 10721, in sage.symbolic.expression.get_dynamic_class_for_function\nFailed example:\n    import sagenb.misc.support as s\nExpected nothing\nGot:\n    doctest:14: ImportWarning: Not importing directory '/usr/local/src/sage-git/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/localedata': missing __init__.py\n**********************************************************************\n```\n",
    "created_at": "2014-12-22T19:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101394",
    "user": "@jdemeyer"
}
```

Indeed, this is a regression:

```
sage -t --long src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 10721, in sage.symbolic.expression.get_dynamic_class_for_function
Failed example:
    import sagenb.misc.support as s
Expected nothing
Got:
    doctest:14: ImportWarning: Not importing directory '/usr/local/src/sage-git/local/lib/python2.7/site-packages/Babel-1.3-py2.7.egg/babel/localedata': missing __init__.py
**********************************************************************
```




---

archive/issue_comments_101395.json:
```json
{
    "body": "See https://github.com/voleg/babel/commit/14796d7f5d3d175b3feac73c2fe8bb87037514d5",
    "created_at": "2014-12-22T19:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101395",
    "user": "@jdemeyer"
}
```

See https://github.com/voleg/babel/commit/14796d7f5d3d175b3feac73c2fe8bb87037514d5



---

archive/issue_comments_101396.json:
```json
{
    "body": "I have to admit I cannot figure out what change would have done this; we already have Babel 1.3 in previous Sage.  Maybe an unintended side effect of the changes in imports w.r.t. `sagenb.misc.support`?  Also notice this *only* happens in doctests, not at the command line.",
    "created_at": "2014-12-22T20:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101396",
    "user": "@kcrisman"
}
```

I have to admit I cannot figure out what change would have done this; we already have Babel 1.3 in previous Sage.  Maybe an unintended side effect of the changes in imports w.r.t. `sagenb.misc.support`?  Also notice this *only* happens in doctests, not at the command line.



---

archive/issue_comments_101397.json:
```json
{
    "body": "Replying to [comment:29 kcrisman]:\n> we already have Babel 1.3 in previous Sage\nYes, but the previous Notebook version didn't actually *use* babel.\n\n> Also notice this *only* happens in doctests, not at the command line.\nWarnings in Python can be enabled/disabled. Apparently, this warning is enabled in doctests (which is probably a good thing) but not in the command line.",
    "created_at": "2014-12-22T20:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101397",
    "user": "@jdemeyer"
}
```

Replying to [comment:29 kcrisman]:
> we already have Babel 1.3 in previous Sage
Yes, but the previous Notebook version didn't actually *use* babel.

> Also notice this *only* happens in doctests, not at the command line.
Warnings in Python can be enabled/disabled. Apparently, this warning is enabled in doctests (which is probably a good thing) but not in the command line.



---

archive/issue_comments_101398.json:
```json
{
    "body": "Okay, I think it is stuff like https://github.com/sagemath/sagenb/commit/5ffa976e0d76b674e09cd6bddd2d1bd6105f166c - it actually happens in other places we import babel (or `flask.ext.babel`) but those were not doctested in Sage.\n\nUnfortunately, the `util/fetch_deps.py` in sagenb doesn't exactly make it easy to just apply patches.",
    "created_at": "2014-12-22T20:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101398",
    "user": "@kcrisman"
}
```

Okay, I think it is stuff like https://github.com/sagemath/sagenb/commit/5ffa976e0d76b674e09cd6bddd2d1bd6105f166c - it actually happens in other places we import babel (or `flask.ext.babel`) but those were not doctested in Sage.

Unfortunately, the `util/fetch_deps.py` in sagenb doesn't exactly make it easy to just apply patches.



---

archive/issue_comments_101399.json:
```json
{
    "body": "> Yes, but the previous Notebook version didn't actually use babel.\n\nSure it did - e.g. https://github.com/sagemath/sagenb/commit/5511a2a01322b66fefdc942e41c4d3d95b1f1677",
    "created_at": "2014-12-22T20:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101399",
    "user": "@kcrisman"
}
```

> Yes, but the previous Notebook version didn't actually use babel.

Sure it did - e.g. https://github.com/sagemath/sagenb/commit/5511a2a01322b66fefdc942e41c4d3d95b1f1677



---

archive/issue_comments_101400.json:
```json
{
    "body": "> Unfortunately, the `util/fetch_deps.py` in sagenb doesn't exactly make it easy to just apply patches.\nWorst case we could put this file in the egg at the very end, but that is pretty hackish.",
    "created_at": "2014-12-22T20:23:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101400",
    "user": "@kcrisman"
}
```

> Unfortunately, the `util/fetch_deps.py` in sagenb doesn't exactly make it easy to just apply patches.
Worst case we could put this file in the egg at the very end, but that is pretty hackish.



---

archive/issue_comments_101401.json:
```json
{
    "body": "By the way, if you or others could test the *rest* of the upgrade, or at any rate normal functioning of nb, then we could have just this issue to deal with.",
    "created_at": "2014-12-22T20:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101401",
    "user": "@kcrisman"
}
```

By the way, if you or others could test the *rest* of the upgrade, or at any rate normal functioning of nb, then we could have just this issue to deal with.



---

archive/issue_comments_101402.json:
```json
{
    "body": "Yes, I was sloppy. To be more precise: running the doctests with sagenb-0.11.1 didn't import the `babel` package.\n\nTo patch `babel`: it's probably best to remove `babel` from `sagenb` and install it like a normal package (this should really be done for all packages inside `sagenb`).",
    "created_at": "2014-12-22T20:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101402",
    "user": "@jdemeyer"
}
```

Yes, I was sloppy. To be more precise: running the doctests with sagenb-0.11.1 didn't import the `babel` package.

To patch `babel`: it's probably best to remove `babel` from `sagenb` and install it like a normal package (this should really be done for all packages inside `sagenb`).



---

archive/issue_comments_101403.json:
```json
{
    "body": "At least, the `babel` failure is the only doctest failure.",
    "created_at": "2014-12-22T20:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101403",
    "user": "@jdemeyer"
}
```

At least, the `babel` failure is the only doctest failure.



---

archive/issue_comments_101404.json:
```json
{
    "body": "> To patch babel: it's probably best to remove babel from sagenb and install it like a normal package (this should really be done for all packages inside sagenb).\n\nYes, but easier said than done.  I won't have time for this today, and I'm a little hazy on exactly how all the dependencies for sagenb might get properly imported from Sage itself.\n\nIt would also be nice if upstream were responsive at all to their many pull requests (this seems to be the case for several projects pocoo has \"taken over\").",
    "created_at": "2014-12-22T20:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101404",
    "user": "@kcrisman"
}
```

> To patch babel: it's probably best to remove babel from sagenb and install it like a normal package (this should really be done for all packages inside sagenb).

Yes, but easier said than done.  I won't have time for this today, and I'm a little hazy on exactly how all the dependencies for sagenb might get properly imported from Sage itself.

It would also be nice if upstream were responsive at all to their many pull requests (this seems to be the case for several projects pocoo has "taken over").



---

archive/issue_comments_101405.json:
```json
{
    "body": "Alternatively, if you just want to fix the doctest failure, you could import the `babel` stuff inside the method where you need it.",
    "created_at": "2014-12-22T20:54:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101405",
    "user": "@jdemeyer"
}
```

Alternatively, if you just want to fix the doctest failure, you could import the `babel` stuff inside the method where you need it.



---

archive/issue_comments_101406.json:
```json
{
    "body": "Hmm, that might be easier.",
    "created_at": "2014-12-22T20:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101406",
    "user": "@kcrisman"
}
```

Hmm, that might be easier.



---

archive/issue_comments_101407.json:
```json
{
    "body": "> Hmm, that might be easier.\n\nNot that I wouldn't be averse to shipping the dependencies separately again!  I just feel like any time I have for sagenb is better used for actual bugs, of which there are already plenty.",
    "created_at": "2014-12-22T20:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101407",
    "user": "@kcrisman"
}
```

> Hmm, that might be easier.

Not that I wouldn't be averse to shipping the dependencies separately again!  I just feel like any time I have for sagenb is better used for actual bugs, of which there are already plenty.



---

archive/issue_comments_101408.json:
```json
{
    "body": "> Hmm, that might be easier.\nYes, that fixes it - and since there is only that one function, it's not a problem to import it in that one place.\n\nI'll have a fix and new package in a little bit.  I hope.",
    "created_at": "2014-12-22T21:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101408",
    "user": "@kcrisman"
}
```

> Hmm, that might be easier.
Yes, that fixes it - and since there is only that one function, it's not a problem to import it in that one place.

I'll have a fix and new package in a little bit.  I hope.



---

archive/issue_comments_101409.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-12-22T21:12:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101409",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_101410.json:
```json
{
    "body": "Okay, it was a forced push but should be okay now.  Same address for the updated spkg.  Here is the diff - once this has positive review I'll push it all back upstream.\n\n```diff\ndiff --git a/sagenb/misc/misc.py b/sagenb/misc/misc.py\nindex 88b3eef..5a647f7 100644\n--- a/sagenb/misc/misc.py\n+++ b/sagenb/misc/misc.py\n@@ -20,8 +20,6 @@ Check that github issue #195 is fixed::\n #############################################################################\n \n from pkg_resources import resource_filename\n-from babel import Locale\n-from babel.core import UnknownLocaleError\n \n def stub(f):\n     def g(*args, **kwds):\n@@ -517,6 +515,8 @@ def translations_path():\n     return os.path.join(SAGENB_ROOT, 'translations')\n \n def get_languages():\n+    from babel import Locale\n+    from babel.core import UnknownLocaleError\n     langs = []\n     dir_names = [lang for lang in os.listdir(translations_path())\n                        if lang != 'en_US']\n```\n",
    "created_at": "2014-12-22T21:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101410",
    "user": "@kcrisman"
}
```

Okay, it was a forced push but should be okay now.  Same address for the updated spkg.  Here is the diff - once this has positive review I'll push it all back upstream.

```diff
diff --git a/sagenb/misc/misc.py b/sagenb/misc/misc.py
index 88b3eef..5a647f7 100644
--- a/sagenb/misc/misc.py
+++ b/sagenb/misc/misc.py
@@ -20,8 +20,6 @@ Check that github issue #195 is fixed::
 #############################################################################
 
 from pkg_resources import resource_filename
-from babel import Locale
-from babel.core import UnknownLocaleError
 
 def stub(f):
     def g(*args, **kwds):
@@ -517,6 +515,8 @@ def translations_path():
     return os.path.join(SAGENB_ROOT, 'translations')
 
 def get_languages():
+    from babel import Locale
+    from babel.core import UnknownLocaleError
     langs = []
     dir_names = [lang for lang in os.listdir(translations_path())
                        if lang != 'en_US']
```




---

archive/issue_comments_101411.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-12-22T21:15:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101411",
    "user": "@kcrisman"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_101412.json:
```json
{
    "body": "All long doctests pass this time.",
    "created_at": "2014-12-23T21:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101412",
    "user": "@jdemeyer"
}
```

All long doctests pass this time.



---

archive/issue_comments_101413.json:
```json
{
    "body": "And I assume that it is still a gnu tar archive?  \n\nOkay, I think anyone can put this to positive review if they don't see any regressions in actual behavior.",
    "created_at": "2014-12-24T02:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101413",
    "user": "@kcrisman"
}
```

And I assume that it is still a gnu tar archive?  

Okay, I think anyone can put this to positive review if they don't see any regressions in actual behavior.



---

archive/issue_comments_101414.json:
```json
{
    "body": "I'm tagging this upstream, so any additional problems will have to be 1) after Christmas and 2) version 0.11.3.",
    "created_at": "2014-12-24T02:49:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101414",
    "user": "@kcrisman"
}
```

I'm tagging this upstream, so any additional problems will have to be 1) after Christmas and 2) version 0.11.3.



---

archive/issue_comments_101415.json:
```json
{
    "body": "The tarball is made correctly, I don't get any warnings when extracting it.\n\nI also checked that the tarball contents matches the git repo. I noticed a few missing files: [https://github.com/sagemath/sagenb/issues/327](https://github.com/sagemath/sagenb/issues/327) I consider this a serious issue (especially with the `COPYING` file missing), but not serious enough to block this ticket.",
    "created_at": "2014-12-24T09:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101415",
    "user": "@jdemeyer"
}
```

The tarball is made correctly, I don't get any warnings when extracting it.

I also checked that the tarball contents matches the git repo. I noticed a few missing files: [https://github.com/sagemath/sagenb/issues/327](https://github.com/sagemath/sagenb/issues/327) I consider this a serious issue (especially with the `COPYING` file missing), but not serious enough to block this ticket.



---

archive/issue_comments_101416.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-24T09:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101416",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_101417.json:
```json
{
    "body": "* #11275: fixed\n* #8738: fixed\n* #8427: fixed\n* #17490: fixed",
    "created_at": "2014-12-24T09:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101417",
    "user": "@jdemeyer"
}
```

* #11275: fixed
* #8738: fixed
* #8427: fixed
* #17490: fixed



---

archive/issue_comments_101418.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2014-12-24T09:49:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101418",
    "user": "@jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_101419.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-02T15:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10056",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10056#issuecomment-101419",
    "user": "@vbraun"
}
```

Resolution: fixed
