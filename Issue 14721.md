# Issue 14721: Implement pseudo-Conway polynomials

archive/issues_014721.json:
```json
{
    "body": "CC:  roed jpflori mraum fstromberg jcooley davidloeffler dfesti\n\nKeywords: Conway polynomial sd51\n\nThis patch implements pseudo-Conway polynomials, which will be used later to enable coercion between finite fields.  This has been split off from #8335, and will be a dependency of that ticket.\n\nThe attached patch passes most doctests, but not all, and has to be cleaned up a bit.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14958\n\n",
    "created_at": "2013-07-23T15:00:22Z",
    "labels": [
        "finite rings",
        "major",
        "enhancement"
    ],
    "title": "Implement pseudo-Conway polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14721",
    "user": "pbruin"
}
```
CC:  roed jpflori mraum fstromberg jcooley davidloeffler dfesti

Keywords: Conway polynomial sd51

This patch implements pseudo-Conway polynomials, which will be used later to enable coercion between finite fields.  This has been split off from #8335, and will be a dependency of that ticket.

The attached patch passes most doctests, but not all, and has to be cleaned up a bit.

Issue created by migration from https://trac.sagemath.org/ticket/14958





---

archive/issue_comments_187621.json:
```json
{
    "body": "CC-ing the authors of #8335 and Sage Days 51 participants on this split-off ticket.",
    "created_at": "2013-07-23T15:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187621",
    "user": "pbruin"
}
```

CC-ing the authors of #8335 and Sage Days 51 participants on this split-off ticket.



---

archive/issue_comments_187622.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-23T22:42:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187622",
    "user": "pbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_187623.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-07-23T22:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187623",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_187624.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-07-24T13:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187624",
    "user": "pbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_187625.json:
```json
{
    "body": "I rebased and updated the code written by David Roe and Jean-Pierre Flori.\n\nOne important question before me or someone else reviews this: why does this patch introduce objects that are called pseudo-Conway polynomial ***trees***?  This strongly suggests that the system of compatible finite fields that it represents forms a tree, which is definitely NOT the case.  This is the whole reason why all of this work needs to be done to get such a system of finite fields!",
    "created_at": "2013-07-24T14:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187625",
    "user": "pbruin"
}
```

I rebased and updated the code written by David Roe and Jean-Pierre Flori.

One important question before me or someone else reviews this: why does this patch introduce objects that are called pseudo-Conway polynomial ***trees***?  This strongly suggests that the system of compatible finite fields that it represents forms a tree, which is definitely NOT the case.  This is the whole reason why all of this work needs to be done to get such a system of finite fields!



---

archive/issue_comments_187626.json:
```json
{
    "body": "The last patch still needed some cleaning up; here is a new one.",
    "created_at": "2013-07-29T11:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187626",
    "user": "pbruin"
}
```

The last patch still needed some cleaning up; here is a new one.



---

archive/issue_comments_187627.json:
```json
{
    "body": "implement pseudo-Conway polynomials",
    "created_at": "2013-07-29T11:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187627",
    "user": "pbruin"
}
```

implement pseudo-Conway polynomials



---

archive/issue_comments_187628.json:
```json
{
    "body": "Attachment [trac_14958-pseudo_conway.patch](tarball://root/attachments/some-uuid/ticket14958/trac_14958-pseudo_conway.patch) by pbruin created at 2013-07-29 12:40:29\n\nReasons for status change to needs_info:\n\n- the 'tree' terminology (see http://trac.sagemath.org/ticket/14958#comment:6); I think that `PseudoConwayPolyTree` should be changed to `PseudoConwayLattice` or something similar.\n\n- during Sage Days 51, Jenny Cooley found a paper claiming that there is a mistake in one of the algorithms in the article of Heath and Loehr cited in the code.  We should check that the error is not in this patch.\n  - R. Gurjar, Generating Conway polynomials, [http://home.iitk.ac.in/~rgurjar/projects/conwayPolynomial.pdf](http://home.iitk.ac.in/~rgurjar/projects/conwayPolynomial.pdf)",
    "created_at": "2013-07-29T12:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187628",
    "user": "pbruin"
}
```

Attachment [trac_14958-pseudo_conway.patch](tarball://root/attachments/some-uuid/ticket14958/trac_14958-pseudo_conway.patch) by pbruin created at 2013-07-29 12:40:29

Reasons for status change to needs_info:

- the 'tree' terminology (see http://trac.sagemath.org/ticket/14958#comment:6); I think that `PseudoConwayPolyTree` should be changed to `PseudoConwayLattice` or something similar.

- during Sage Days 51, Jenny Cooley found a paper claiming that there is a mistake in one of the algorithms in the article of Heath and Loehr cited in the code.  We should check that the error is not in this patch.
  - R. Gurjar, Generating Conway polynomials, [http://home.iitk.ac.in/~rgurjar/projects/conwayPolynomial.pdf](http://home.iitk.ac.in/~rgurjar/projects/conwayPolynomial.pdf)



---

archive/issue_comments_187629.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-07-29T12:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187629",
    "user": "pbruin"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_187630.json:
```json
{
    "body": "Replying to [comment:8 pbruin]:\n> Reasons for status change to needs_info:\n> \n> - the 'tree' terminology (see http://trac.sagemath.org/ticket/14958#comment:6); I think that `PseudoConwayPolyTree` should be changed to `PseudoConwayLattice` or something similar.\n> \nI agree.\nI also don't really feel satisfied with the way all these polynomials are stored right now, but I'm not sure I'll come up with anything quickly.\n\n> - during Sage Days 51, Jenny Cooley found a paper claiming that there is a mistake in one of the algorithms in the article of Heath and Loehr cited in the code.  We should check that the error is not in this patch.\n>   - R. Gurjar, Generating Conway polynomials, [http://home.iitk.ac.in/~rgurjar/projects/conwayPolynomial.pdf](http://home.iitk.ac.in/~rgurjar/projects/conwayPolynomial.pdf)\nI think it's fixed in David's implementation.\nThat's what got me confused at http://trac.sagemath.org/ticket/8335#comment:55 because I thought the addition David made were not needed, and then i realized they were: http://trac.sagemath.org/ticket/8335#comment:57.",
    "created_at": "2013-07-29T12:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187630",
    "user": "jpflori"
}
```

Replying to [comment:8 pbruin]:
> Reasons for status change to needs_info:
> 
> - the 'tree' terminology (see http://trac.sagemath.org/ticket/14958#comment:6); I think that `PseudoConwayPolyTree` should be changed to `PseudoConwayLattice` or something similar.
> 
I agree.
I also don't really feel satisfied with the way all these polynomials are stored right now, but I'm not sure I'll come up with anything quickly.

> - during Sage Days 51, Jenny Cooley found a paper claiming that there is a mistake in one of the algorithms in the article of Heath and Loehr cited in the code.  We should check that the error is not in this patch.
>   - R. Gurjar, Generating Conway polynomials, [http://home.iitk.ac.in/~rgurjar/projects/conwayPolynomial.pdf](http://home.iitk.ac.in/~rgurjar/projects/conwayPolynomial.pdf)
I think it's fixed in David's implementation.
That's what got me confused at http://trac.sagemath.org/ticket/8335#comment:55 because I thought the addition David made were not needed, and then i realized they were: http://trac.sagemath.org/ticket/8335#comment:57.



---

archive/issue_comments_187631.json:
```json
{
    "body": "I'd say David used the term tree because a PCPT objecgt only contains one layer of references, i.e. a pseudo-conway poly and refs to the PCPTs for n/q where q is a prime divisor of n.\n\nSome minor remarks:\n* I think we should add a warning that PCPTs are only weakrefed. I saw that you correctly took care of that in #8335, thanks for that.\n* At some point the new doc says \"The following demonstrate coercions\", shouldn't it be \"demonstrates\"? (please pardon me if I'm wrong, I'm no english expert).\n* The doc changes corresponding to the fix mentionned in http://trac.sagemath.org/ticket/8335#comment:59 are missing; it should not read:\n\n```\n            If False, then `n` is prime and \n            no references are stored (since there is no compatibility \n            condition).\n```\n\n  but:\n  {{{\n            If ``False``, then `n == 1` and no references are stored \n            (since there is no compatiblity condition).\n  }}}",
    "created_at": "2013-07-29T13:24:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187631",
    "user": "jpflori"
}
```

I'd say David used the term tree because a PCPT objecgt only contains one layer of references, i.e. a pseudo-conway poly and refs to the PCPTs for n/q where q is a prime divisor of n.

Some minor remarks:
* I think we should add a warning that PCPTs are only weakrefed. I saw that you correctly took care of that in #8335, thanks for that.
* At some point the new doc says "The following demonstrate coercions", shouldn't it be "demonstrates"? (please pardon me if I'm wrong, I'm no english expert).
* The doc changes corresponding to the fix mentionned in http://trac.sagemath.org/ticket/8335#comment:59 are missing; it should not read:

```
            If False, then `n` is prime and 
            no references are stored (since there is no compatibility 
            condition).
```

  but:
  {{{
            If ``False``, then `n == 1` and no references are stored 
            (since there is no compatiblity condition).
  }}}



---

archive/issue_comments_187632.json:
```json
{
    "body": "The last patch renames some classes, methods and functions.\n\nIt also fixes doctests and documentation.\n\n\n```\nPatchbot, apply:\n* trac_14958-pseudo_conway.patch\n* trac_14958-rename-doctests.patch\n```\n",
    "created_at": "2013-07-30T12:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187632",
    "user": "jpflori"
}
```

The last patch renames some classes, methods and functions.

It also fixes doctests and documentation.


```
Patchbot, apply:
* trac_14958-pseudo_conway.patch
* trac_14958-rename-doctests.patch
```




---

archive/issue_comments_187633.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-07-30T12:23:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187633",
    "user": "jpflori"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_187634.json:
```json
{
    "body": "Attachment [trac_14958-rename-doctests.patch](tarball://root/attachments/some-uuid/ticket14958/trac_14958-rename-doctests.patch) by pbruin created at 2013-07-31 14:22:12\n\nReplying to [comment:11 jpflori]:\n> The last patch renames some classes, methods and functions.\n> \n> It also fixes doctests and documentation.\n\nThese changes all look good to me.\n\nActually, I realised that we never call `irreducible_element(n, algorithm='pseudo-conway')` in #8335, so it is not even necessary to allow this parameter.  In fact, it may cause confusion, since creating a single pseudo-Conway polynomial really only makes sense in the context of a lattice.  Without that, a pseudo-Conway polynomial is nothing more than a primitive polynomial!\n\nI confess that I never got around to learning what exactly `weakref` does, until now.  I just read the relevant parts of [http://www.python.org/dev/peps/pep-0205/](http://www.python.org/dev/peps/pep-0205/) and see why we may have to be careful.  I think this question is mostly relevant to #8335, so let's not move that discussion here; let me just say for now that I agree that `weakref` does not appear to be the ideal solution to our caching problem.",
    "created_at": "2013-07-31T14:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187634",
    "user": "pbruin"
}
```

Attachment [trac_14958-rename-doctests.patch](tarball://root/attachments/some-uuid/ticket14958/trac_14958-rename-doctests.patch) by pbruin created at 2013-07-31 14:22:12

Replying to [comment:11 jpflori]:
> The last patch renames some classes, methods and functions.
> 
> It also fixes doctests and documentation.

These changes all look good to me.

Actually, I realised that we never call `irreducible_element(n, algorithm='pseudo-conway')` in #8335, so it is not even necessary to allow this parameter.  In fact, it may cause confusion, since creating a single pseudo-Conway polynomial really only makes sense in the context of a lattice.  Without that, a pseudo-Conway polynomial is nothing more than a primitive polynomial!

I confess that I never got around to learning what exactly `weakref` does, until now.  I just read the relevant parts of [http://www.python.org/dev/peps/pep-0205/](http://www.python.org/dev/peps/pep-0205/) and see why we may have to be careful.  I think this question is mostly relevant to #8335, so let's not move that discussion here; let me just say for now that I agree that `weakref` does not appear to be the ideal solution to our caching problem.



---

archive/issue_comments_187635.json:
```json
{
    "body": "While working on #14990, it occurred to me that this patch could be simplified substantially.  I am attaching a new version that gives an extremely intuitive interface to pseudo-Conway lattices:\n\n```\nclass PseudoConwayLattice(SageObject)\n    def __init__(self, p, use_database=True)\n    def polynomial(self, n)\n```\n\nThis is morally equivalent to a construction of an algebraic closure of **F**<sub>*p*</sub> with a method that returns the unique subfield of degree *n*.\n\nThe method `get_pseudo_conway_polynomial()` is now simply called `polynomial()`.  The functions `find_pseudo_conway_polynomial_tree()` and `compute_pseudo_conway_polynomial()` have been dissolved into `__init__()` and `polynomial()`.  The global variables to implement caching are gone.",
    "created_at": "2013-08-06T00:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187635",
    "user": "pbruin"
}
```

While working on #14990, it occurred to me that this patch could be simplified substantially.  I am attaching a new version that gives an extremely intuitive interface to pseudo-Conway lattices:

```
class PseudoConwayLattice(SageObject)
    def __init__(self, p, use_database=True)
    def polynomial(self, n)
```

This is morally equivalent to a construction of an algebraic closure of **F**<sub>*p*</sub> with a method that returns the unique subfield of degree *n*.

The method `get_pseudo_conway_polynomial()` is now simply called `polynomial()`.  The functions `find_pseudo_conway_polynomial_tree()` and `compute_pseudo_conway_polynomial()` have been dissolved into `__init__()` and `polynomial()`.  The global variables to implement caching are gone.



---

archive/issue_comments_187636.json:
```json
{
    "body": "Attachment [trac_14958-pseudo_conway_simplified.patch](tarball://root/attachments/some-uuid/ticket14958/trac_14958-pseudo_conway_simplified.patch) by pbruin created at 2013-08-06 00:26:32\n\nimplement pseudo-Conway polynomials (replaces both previous patches)",
    "created_at": "2013-08-06T00:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187636",
    "user": "pbruin"
}
```

Attachment [trac_14958-pseudo_conway_simplified.patch](tarball://root/attachments/some-uuid/ticket14958/trac_14958-pseudo_conway_simplified.patch) by pbruin created at 2013-08-06 00:26:32

implement pseudo-Conway polynomials (replaces both previous patches)



---

archive/issue_comments_187637.json:
```json
{
    "body": "apply trac_14958-pseudo_conway_simplified.patch",
    "created_at": "2013-08-06T00:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187637",
    "user": "pbruin"
}
```

apply trac_14958-pseudo_conway_simplified.patch



---

archive/issue_comments_187638.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-08-06T11:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187638",
    "user": "jpflori"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_187639.json:
```json
{
    "body": "Now we've departed from the idea of implementing what should be provided by the algebraic closure constructions, the new patch is fine for me.",
    "created_at": "2013-08-06T11:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187639",
    "user": "jpflori"
}
```

Now we've departed from the idea of implementing what should be provided by the algebraic closure constructions, the new patch is fine for me.



---

archive/issue_comments_187640.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-10-07T06:49:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14721",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14721#issuecomment-187640",
    "user": "jdemeyer"
}
```

Resolution: fixed
