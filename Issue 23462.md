# Issue 23462: torsion_quadratic_module_symmetric

Issue created by migration from https://trac.sagemath.org/ticket/23699

Original creator: sbrandhorst

Original creation time: 2017-08-24 13:52:41

We want to model the following:
Let A be a finite abelian group. A (symmetric) torsion bilinear form is
b: A x A --> QQ/ZZ.

A torsion quadratic form is
q: A --> QQ/2ZZ
such that q(na)=n*n*q(a)   a for a in A.

This class should consist of:

- an Abelian group with a distinguished basis
- an "inner product matrix" defining the bilinear/quadratic form.
- Elements should have methods to compute q and b

It should behave much like sage/modules/free_quadratic_module

methods should include:
- create a free quadratic submodule from generators
- orthogonal complements
- a canonical form
- isomorphisms
- brown invariants
- the orthogonal decompositions into its p-primary parts


---

Comment by git created at 2017-09-30 22:21:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-09-30 22:39:17

Changing keywords from "" to "sd91".


---

Comment by roed created at 2017-10-01 22:51:27

New commits:


---

Comment by git created at 2017-10-06 21:07:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-09 06:42:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-10 09:52:21

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2017-10-10 12:33:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-10-10 12:36:44

Changing status from new to needs_review.


---

Comment by git created at 2017-10-20 11:05:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-22 13:44:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-22 14:00:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-22 15:41:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-22 19:34:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ursula created at 2017-10-22 21:20:53

Why do all of the examples start with an import command?  It seems like this is basic functionality that should be available within Sage without extra work.

Minor note: the first documentation line of `TorsionQuadraticModule` doesn't wrap properly.


---

Comment by ursula created at 2017-10-22 21:28:51

Changing keywords from "sd91" to "sd91, sd90".


---

Comment by ursula created at 2017-10-22 21:36:49

The primary_part docstring has a typo: it says "Return the m-primary part of this torsion quadraticm module as a submodule", with an extra m on the end of 'quadratic'.


---

Comment by git created at 2017-10-22 22:04:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-22 22:05:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ursula created at 2017-10-23 17:47:34

The documentation builds, but the math mode doesn't display correctly (at least in my installation).  All doctests pass.


---

Comment by ursula created at 2017-10-23 22:31:55

Many of the examples use T.0 or T.1.  Please use T.gen(0), etc. instead: this makes it easier to look up the intended meaning of the code.


---

Comment by ursula created at 2017-10-23 22:31:55

Changing status from needs_review to needs_work.


---

Comment by ursula created at 2017-10-23 23:13:29

The example for gram_matrix_quadratic constructs a matrix called D4_gram directly.  The command `DynkinDiagram('D',4).cartan_matrix()` will create the same matrix.  Would it be clearer to do so?


---

Comment by ursula created at 2017-10-24 20:58:32

Replacing ```` with $$ in the documentation solves the problems with LaTeX display.


---

Comment by sbrandhorst created at 2017-10-25 06:13:54

Actually the confusion was between strings and raw strings. Some were raw and some not. 
I removed all raw strings. For me it works fine with chrome. With Firefox I get some math processing errors. But I guess that is just because the browser is outdated.


---

Comment by git created at 2017-10-25 06:15:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-25 06:22:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-25 06:27:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-10-25 06:27:29

Changing status from needs_work to needs_review.


---

Comment by roed created at 2017-10-25 07:02:28

Replying to [comment:31 sbrandhorst]:
> Actually the confusion was between strings and raw strings. Some were raw and some not. 
> I removed all raw strings. For me it works fine with chrome. With Firefox I get some math processing errors. But I guess that is just because the browser is outdated. 

Why did you remove all the raw strings?  I would have gone the other way and made all docstrings raw strings....

Also, you shouldn't use $ in documentation, but single backticks for mathmode (or `.. mathmode::` for display mode).


---

Comment by git created at 2017-10-25 07:15:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-10-25 07:15:33

Indeed less backslashes look nicer.
----
New commits:


---

Comment by tscrim created at 2017-10-27 04:30:18

Some questions:

- Should we import `TorsionQuadraticModule` and `IntegralLattice` into the global namespace? I feel like there are more natural constructions for these modules, say as a quotient object and by using vector space constructions. That way we do not pollute the global namespace. There probably is a stronger case not to import the former, but it is good to avoid both.
- Is `free_quadratic_module_integer_symmetric.py` included in the documentation? I don't see it in `modules/index.rst`.

Some comments:

- You should do tests with `TestSuite(foo).run()`.
- Your `TorsionQuadraticModuleElement.__init__` docstring closing `"""` is not correctly indented.
- It should be ```self``` in docstrings since it is Python code.
- Try to keep lines <79 characters, especially in documentation.
- Not every method has tests (`__init__` is a good place for the `TestSuite(foo).run()` and is where I always put them).
- Change this and similar for Python3 and general Python error string conventions
  {{{#!diff
-ValueError, "The modulus must divide (V,W)."
+ValueError("the modulus must divide (V,W)")
  }}}
- `INPUT:` items do not end with a period/full-stop.
- Many one-line descriptions are missing a period/full-stop.
- `gram_matrix_quadratic` `OUTPUT:` is over indented.


---

Comment by tscrim created at 2017-10-27 04:30:18

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-10-27 07:14:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-10-27 07:22:55

O.K. the use case that I have in mind is to create a `TorsionQuadraticModule` from an
`IntegralLattice`. So there is indeed no use to pollute the global namespace. 

You are right, one could check if a `free_quadratic_module` is an `IntegralLattice` in the `FreeQuadraticModule` factory function. Do we want that?

I any case I want an `IntegralLattice` factory function in the global namespace.
At the moment it has little functionality, but later I plan to extend its functionality to create
lattices from keywords, like the ADE-lattices, Leech, ... or an interface with the lmfdb.


---

Comment by sbrandhorst created at 2017-10-27 07:23:21

Changing status from needs_work to needs_review.


---

Comment by ursula created at 2017-10-27 11:45:43

As someone who works in an area of geometry that uses these objects, I absolutely want `IntegralLattice` as part of the global name space.  I also want the ability to work directly with the associated discriminant groups, and ask questions about whether one is isomorphic to another, in the same genus, etc.  There are some classifications of possible discriminant groups which mean being able to access `TorsionQuadraticModule` directly might be helpful.

Creating ADE lattices should be very quick, since as I note above we already have the appropriate matrices in the `DynkinDiagram` code.


---

Comment by sbrandhorst created at 2017-10-27 12:25:25

Replying to [comment:43 ursula]:
> Creating ADE lattices should be very quick, since as I note above we already have the appropriate matrices in the `DynkinDiagram` code.

Let's make the factory functions a separate ticket.


---

Comment by tscrim created at 2017-10-27 13:20:42

Fair enough. This is not my area of expertise, so if you think it is useful, then I have no objections other than it should be a `lazy_import`. My suggestion stemmed from thinking such a construction would be similar to this:

```
sage: V = (ZZ^3).span([[1/2,5,2],[3/7,2,-1],[1/3,1/5,-2]])
```


Also, one other minor doc point, in `free_quadratic_module_integer_symmetric.py`, the examples in the module-level docstring are over-indented.

Ursula, are you going to be handling the rest of the review, or at least the mathematical side?


---

Comment by ursula created at 2017-10-27 13:35:40

I'm definitely looking at the math but don't have a lot of reviewing time outside Sage Days, so any help is appreciated.


---

Comment by tscrim created at 2017-10-28 01:49:55

If the math is good, then I can do the rest of the review.


---

Comment by git created at 2017-10-28 12:18:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-11-03 07:58:03

*ping* :-)


---

Comment by ursula created at 2017-11-03 13:20:08

Confirmed documentation now displays math correctly!


---

Comment by git created at 2017-11-03 14:26:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-11-06 07:16:27

I went through and made a lot of mostly minor changes to keep line lengths short, code and doc clean and as consistent as is possible in Sage, and removing trailing whitespace. It would be nice to have a natural top-level way to construct a `TorsionQuadraticModule` that is not adding to the global namespace. That is to say, we should be able to do `V / W` for appropriate objects `V` and `W` and/or something like `V.torsion_quotient(W)` (I am sure that is not a good name, please suggest alternatives). I just am not sure enough in the math to say what `V` and `W` should be. However, if that is something that could wait for another ticket, then you cab set a positive review if my changes look good and you add your name to the authors (and `@`ursula to the reviewers).
----
New commits:


---

Comment by git created at 2017-11-06 10:45:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-11-06 10:52:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-11-06 11:09:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-11-06 11:16:07

We could enable `V/W`. But since that does not work for all `V, W` it feels odd.
I would delegate such decisions to a different ticket if the need arises.

Thank you for the review. I am happy with your changes and
did some trivial additions. Positive review if you are happy with my changes.


---

Comment by tscrim created at 2017-11-06 12:15:59

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-11-06 12:15:59

Replying to [comment:56 sbrandhorst]:
> We could enable `V/W`. But since that does not work for all `V, W` it feels odd.
> I would delegate such decisions to a different ticket if the need arises.

It doesn't feel that odd to me. That is what generic code and `NotImplementedError`'s are for. However, a later ticket it will be.

> Thank you for the review. I am happy with your changes and
> did some trivial additions. Positive review if you are happy with my changes.

Thank you.


---

Comment by git created at 2017-11-07 08:39:26

Changing status from positive_review to needs_review.


---

Comment by git created at 2017-11-07 08:39:26

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by sbrandhorst created at 2017-11-07 08:39:59

Let us see what the patchbot says now.


---

Comment by tscrim created at 2017-11-07 10:37:40

Whoops, forgot about those. Thanks.


---

Comment by tscrim created at 2017-11-07 10:37:40

Changing status from needs_review to positive_review.


---

Comment by sbrandhorst created at 2017-11-09 16:47:19

There are some patchbot failures. However, they look quite unrelated.


---

Comment by vbraun created at 2017-12-11 01:03:41

Resolution: fixed
