# Issue 19929: Implement non-recursive iterator for (weighted) integer vectors

archive/issues_019929.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  sage-combinat chapoton vdelecroix\n\nBy implementing a non-recursive iterator, we avoid some overhead. With this branch, we get the following:\n\n```\nsage: I = IntegerVectors(12,7)\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 20.8 ms per loop\nsage: I = WeightedIntegerVectors(12, [4,1,2,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 291 \u00b5s per loop\nsage: I = WeightedIntegerVectors(12, [2,1,1,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 556 \u00b5s per loop\nsage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 56.4 ms per loop\nsage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n1 loop, best of 3: 443 ms per loop\n```\n\nversus the current version:\n\n```\nsage: I = IntegerVectors(12,7)\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 50.3 ms per loop\nsage: %timeit list(I.__iter__())\nThe slowest run took 8.13 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000 loops, best of 3: 301 \u00b5s per loop\nsage: I = WeightedIntegerVectors(12, [2,1,1,2])\nsage: %timeit list(I.__iter__())\n1000 loops, best of 3: 554 \u00b5s per loop\nsage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n10 loops, best of 3: 68.1 ms per loop\nsage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])\nsage: %timeit list(I.__iter__())\n1 loop , best of 3: 528 ms per loop\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20166\n\n",
    "created_at": "2016-03-05T14:45:49Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Implement non-recursive iterator for (weighted) integer vectors",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19929",
    "user": "tscrim"
}
```
Assignee: sage-combinat

CC:  sage-combinat chapoton vdelecroix

By implementing a non-recursive iterator, we avoid some overhead. With this branch, we get the following:

```
sage: I = IntegerVectors(12,7)
sage: %timeit list(I.__iter__())
10 loops, best of 3: 20.8 ms per loop
sage: I = WeightedIntegerVectors(12, [4,1,2,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 291 µs per loop
sage: I = WeightedIntegerVectors(12, [2,1,1,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 556 µs per loop
sage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
10 loops, best of 3: 56.4 ms per loop
sage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
1 loop, best of 3: 443 ms per loop
```

versus the current version:

```
sage: I = IntegerVectors(12,7)
sage: %timeit list(I.__iter__())
10 loops, best of 3: 50.3 ms per loop
sage: %timeit list(I.__iter__())
The slowest run took 8.13 times longer than the fastest. This could mean that an intermediate result is being cached.
1000 loops, best of 3: 301 µs per loop
sage: I = WeightedIntegerVectors(12, [2,1,1,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 554 µs per loop
sage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
10 loops, best of 3: 68.1 ms per loop
sage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
1 loop , best of 3: 528 ms per loop
```


Issue created by migration from https://trac.sagemath.org/ticket/20166





---

archive/issue_comments_274324.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274324",
    "user": "tscrim"
}
```

New commits:



---

archive/issue_comments_274325.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-05T14:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274325",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_274326.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-10T08:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274326",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274327.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-15T16:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274327",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274328.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-16T14:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274328",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_274329.json:
```json
{
    "body": "Up to twice faster than your version ;-)\n\n- it is always a bad idea to use `list.insert(0, XX)` and `list.pop(0)`. Lists are implemented as C arrays, and modifications at the bottom is `O(n)`. Whereas `list.append()` and `list.pop()` are always `O(1)` (if we ignore memory allocation).\n\n- it is always good to avoid coercion `int / ZZ`.\n\nIt is good to go for me",
    "created_at": "2016-04-16T14:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274329",
    "user": "vdelecroix"
}
```

Up to twice faster than your version ;-)

- it is always a bad idea to use `list.insert(0, XX)` and `list.pop(0)`. Lists are implemented as C arrays, and modifications at the bottom is `O(n)`. Whereas `list.append()` and `list.pop()` are always `O(1)` (if we ignore memory allocation).

- it is always good to avoid coercion `int / ZZ`.

It is good to go for me



---

archive/issue_comments_274330.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-16T18:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274330",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_274331.json:
```json
{
    "body": "LGTM. Thank you!",
    "created_at": "2016-04-16T18:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274331",
    "user": "tscrim"
}
```

LGTM. Thank you!



---

archive/issue_comments_274332.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-17T11:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274332",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_274333.json:
```json
{
    "body": "I think this causes the problem at #20491.",
    "created_at": "2016-04-23T23:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19929",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19929#issuecomment-274333",
    "user": "jhpalmieri"
}
```

I think this causes the problem at #20491.
