# Issue 19929: Implement non-recursive iterator for (weighted) integer vectors

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2016-03-05 14:45:49

Assignee: sage-combinat

CC:  sage-combinat chapoton vdelecroix

By implementing a non-recursive iterator, we avoid some overhead. With this branch, we get the following:

```
sage: I = IntegerVectors(12,7)
sage: %timeit list(I.__iter__())
10 loops, best of 3: 20.8 ms per loop
sage: I = WeightedIntegerVectors(12, [4,1,2,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 291 µs per loop
sage: I = WeightedIntegerVectors(12, [2,1,1,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 556 µs per loop
sage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
10 loops, best of 3: 56.4 ms per loop
sage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
1 loop, best of 3: 443 ms per loop
```

versus the current version:

```
sage: I = IntegerVectors(12,7)
sage: %timeit list(I.__iter__())
10 loops, best of 3: 50.3 ms per loop
sage: %timeit list(I.__iter__())
The slowest run took 8.13 times longer than the fastest. This could mean that an intermediate result is being cached.
1000 loops, best of 3: 301 µs per loop
sage: I = WeightedIntegerVectors(12, [2,1,1,2])
sage: %timeit list(I.__iter__())
1000 loops, best of 3: 554 µs per loop
sage: I = WeightedIntegerVectors(17, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
10 loops, best of 3: 68.1 ms per loop
sage: I = WeightedIntegerVectors(26, [2,1,1,2,1,1,2])
sage: %timeit list(I.__iter__())
1 loop , best of 3: 528 ms per loop
```



---

Comment by tscrim created at 2016-03-05 14:47:42

New commits:


---

Comment by tscrim created at 2016-03-05 14:47:42

Changing status from new to needs_review.


---

Comment by git created at 2016-04-10 08:57:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-04-15 16:05:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-04-16 14:03:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-04-16 14:05:48

Up to twice faster than your version ;-)

 - it is always a bad idea to use `list.insert(0, XX)` and `list.pop(0)`. Lists are implemented as C arrays, and modifications at the bottom is `O(n)`. Whereas `list.append()` and `list.pop()` are always `O(1)` (if we ignore memory allocation).

 - it is always good to avoid coercion `int / ZZ`.

It is good to go for me


---

Comment by tscrim created at 2016-04-16 18:45:09

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-04-16 18:45:09

LGTM. Thank you!


---

Comment by vbraun created at 2016-04-17 11:27:32

Resolution: fixed


---

Comment by jhpalmieri created at 2016-04-23 23:35:34

I think this causes the problem at #20491.
