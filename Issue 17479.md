# Issue 17479: AsymptoticExpression

Issue created by migration from Trac.

Original creator: behackl

Original creation time: 2015-02-02 18:33:03

CC:  dkrenn cheuberg ncohen vdelecroix tmonteil

Keywords: asymptotics

We want to implement asymptotic expressions like (5 * n * 2<sup>n</sup> - 2 * n<sup>2/3</sup> + O(n * log(n))) based on our implementation of asymptotic terms (i.e. objects which contain a growth and possibly some additional information; see ticket #17715) and the MutablePoset data structure (see ticket #17693). 

Basically, an asymptotic expression represents the sum of asymptotic terms. The terms are stored within an MutablePoset, which is helpful for the management of the terms, as absorption of terms (and their predecessors w.r.t. growth) can be handled efficiently. 

For example:
    (n<sup>3</sup> + n<sup>2</sup> + n + 1) + (O(n<sup>2</sup>)) evaluates to (n<sup>3</sup> + O(n<sup>2</sup>)), 
    because the O term absorbs n<sup>2</sup> and its predecessors, which is information that is stored in the MutablePoset.
    
Another more complex example would be:
    (4 * n<sup>2</sup> * t + 3 * n * t<sup>2</sup> + O(n)) + (O(n<sup>2</sup> * t<sup>3/2</sup>)) evaluates to (3 * n * t<sup>2</sup> + O(n<sup>2</sup> * t<sup>3/2</sup>)).
    Here, the MutablePoset behind the term (4 * n<sup>2</sup> * t + 3 * n * t<sup>2</sup> + O(n)) incorporates the relations `n <= 4 * n^2 * t` and `n <= 3 * n * t^2`, whereas the expression (O(n<sup>2</sup> * t<sup>3/2</sup>)) only contains the term n<sup>2</sup> * t<sup>3/2</sup>, and thus the corresponding MutablePoset contains no relations. Adding these two terms translates into merging the two underlying posets. By inserting the term O(n<sup>2</sup> * t<sup>3/2</sup>) into the first poset, new relations `4 * n^2 * t <= n^2 * t^(3/2)` and `n <= n^2 * t^(3/2)` are discovered. 
    As O terms absorb terms of weaker or equal growth, the term 4 * n<sup>2</sup> * t and O(n) are removed from the poset. As noted above, the remaining elements form the asymptotic expression (3 * n * t<sup>2</sup> + O(n<sup>2</sup> * t<sup>3/2</sup>)).
    
Concretely, we plan to implement the elements AsymptoticExpression (with parent AsymptoticRing) whose objects act as described above.

See meta-ticket #17601 for the planned structure.


---

Comment by behackl created at 2015-02-02 18:33:22

Changing type from PLEASE CHANGE to enhancement.


---

Comment by behackl created at 2015-07-15 16:40:09

Changing keywords from "asymptotics" to "asymptotics, gsoc15".


---

Comment by git created at 2015-07-16 14:28:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-20 12:48:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-21 16:21:17

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-07-21 16:45:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-07-28 18:46:17

Last 10 new commits:


---

Comment by git created at 2015-07-29 08:56:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2015-08-12 12:15:59

Last 10 new commits:


---

Comment by git created at 2015-08-12 15:07:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-13 20:08:33

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-08-14 14:17:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2015-08-17 18:43:57

Last 10 new commits:


---

Comment by git created at 2015-08-18 18:13:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2015-08-20 07:51:38

Changing status from new to needs_review.


---

Comment by dkrenn created at 2015-08-20 08:05:48

During the project #17601 (the last months in course of GSOC2015 as mentor) I did a very careful reviewing of all code. This includes the code of this ticket. Now this is clearly a positive_review from my side.


---

Comment by behackl created at 2015-08-20 17:31:43

Last 10 new commits:


---

Comment by git created at 2015-08-20 17:32:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-08-21 17:56:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2015-09-09 15:04:33

Merged 6.9.beta5
----
New commits:


---

Comment by dkrenn created at 2015-09-15 17:27:40

Changing component from symbolics to asymptotic expansions.


---

Comment by behackl created at 2015-09-21 09:34:21

Merged positively reviewed version of #17715 into this branch.
----
Last 10 new commits:


---

Comment by git created at 2015-09-22 11:58:02

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by cheuberg created at 2015-09-23 19:01:33

I have read the code and the documentation. I have pushed a few reviewer commits (please cross-review). Apart from that, I have a few comments/questions:
1. Introductory examples, `A.an_element()`: why is this not tested?
2. `AsymptoticExpression.__init__`: all doctests are indirect; however seeing `simplify` in action as well as a poset might be more interesting.
3. `AsymptoticExpression.__pow__`: How difficult would it be to allow the computation of `(y<sup>2)</sup>(3/2)` ?
4. `AsymptoticExpression.__pow__`: move powers of asymptotic terms to the respective classes instead of the hack here.
5. `AsymptoticRing`: "TEST": what is the purpose of this test? Isn't all that already tested?
6. `AsymptoticRing.__classcall__`: the if clause `if names is not None` does not seem to be prepared to multiple generators.
7. `AsymptoticRing.__classcall__`: deal with parameter `category`
8. `AsymptoticRing.__init__`: include doctests for error conditions.
9. `AsymptoticRing._element_constructor_`: clarify that `data=0` is required if `summands is not None`
10. `AsymptoticRing._element_constructor_`: doctests for use of `summands`, for error conditions
11. `AsymptoticRing._coerce_map_from_`: why is the test `if R == MutablePoset` required?
----
Last 10 new commits:


---

Comment by cheuberg created at 2015-09-23 19:01:33

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2015-09-23 19:17:34

One more comment:
12. In my opinion, with this ticket, the documentation should no longer be hidden, because the asymptotic ring in this version does something which was previously impossible in [SageMath](SageMath) (fractional exponents).


---

Comment by dkrenn created at 2015-09-29 08:11:51

Code breaks on 6.9.rc0 (change of imports in `sage/rings/all.py`). Merge 6.9.rc0 and adapt.


---

Comment by behackl created at 2015-09-29 08:40:15

Merged `6.9.rc0` and fixed imports.
----
New commits:


---

Comment by git created at 2015-09-29 13:49:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2015-09-29 13:49:35

Hello Clemens!

I cross-reviewed your changes (they look fine), and here are some answers to your comments:

Replying to [comment:33 cheuberg]:
> I have read the code and the documentation. I have pushed a few reviewer commits (please cross-review). Apart from that, I have a few comments/questions:
> 1. Introductory examples, `A.an_element()`: why is this not tested?

Because this already gives the result of our implementation of `an_element` from #19048. It is tested there.

> 2. `AsymptoticExpression.__init__`: all doctests are indirect; however seeing `simplify` in action as well as a poset might be more interesting.

I copied and adapted a doctest from `_simplify_`.

> 3. `AsymptoticExpression.__pow__`: How difficult would it be to allow the computation of `(y<sup>2)</sup>(3/2)` ?
> 4. `AsymptoticExpression.__pow__`: move powers of asymptotic terms to the respective classes instead of the hack here.

Both 3. and 4. are fixed in #19083: especially the `__pow__`-methods were heavily changed and split.

> 5. `AsymptoticRing`: "TEST": what is the purpose of this test? Isn't all that already tested?

Cannot recall the intention behind this test. Deleted.

> 6. `AsymptoticRing.__classcall__`: the if clause `if names is not None` does not seem to be prepared to multiple generators.

This is because this world works entirely without cartesian products. Our efforts on the "cartesian product" front get merged with the "asymptotic ring" font in #19073.

> 7. `AsymptoticRing.__classcall__`: deal with parameter `category`

The entire `__classcall__` has been rewritten in #19083, categories are handled correctly there.

> 8. `AsymptoticRing.__init__`: include doctests for error conditions.

Done.

> 9. `AsymptoticRing._element_constructor_`: clarify that `data=0` is required if `summands is not None`

Added a similar note as for the element constructor of the growth group.

> 10. `AsymptoticRing._element_constructor_`: doctests for use of `summands`, for error conditions

Done. (And fixed the typo in 'ambiguous' `;-)`)

> 11. `AsymptoticRing._coerce_map_from_`: why is the test `if R == MutablePoset` required?

This is a premature fix for a problem arising in #19083: when passing a `MutablePoset` to the ring such that the element constructor builds an expansion, `coerce_map_from` is called with the class of the poset (as the poset has no parent). Without this, a lot of bad stuff happens.


---

Comment by behackl created at 2015-09-29 13:49:35

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-09-29 14:48:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-09-29 14:51:36

Replying to [comment:34 cheuberg]:
> One more comment:
> 12. In my opinion, with this ticket, the documentation should no longer be hidden, because the asymptotic ring in this version does something which was previously impossible in [SageMath](SageMath) (fractional exponents).

any thoughts on that?

Apart from that, I reviewed your changes and added two minor reviewer commits.


---

Comment by dkrenn created at 2015-09-29 16:59:10

Replying to [comment:41 cheuberg]:
> Replying to [comment:34 cheuberg]:
> > One more comment:
> > 12. In my opinion, with this ticket, the documentation should no longer be hidden, because the asymptotic ring in this version does something which was previously impossible in [SageMath](SageMath) (fractional exponents).
> 
> any thoughts on that?

Included.

> Apart from that, I reviewed your changes and added two minor reviewer commits.

...ok.
----
New commits:


---

Comment by dkrenn created at 2015-09-29 16:59:25

Changing status from needs_review to positive_review.


---

Comment by cheuberg created at 2015-09-29 17:59:34


```
.. toctree::
   :hidden:

   asymptotic_expansions_index
```

could now be removed from `src/doc/en/reference/rings/index.rst` .

But this can wait until one of the follow-up tickets.

And in `src/doc/output/html/en/reference/rings/asymptotic_expansions_index.html`, the very first line could be a pointer towards the introductory material in the asymptotic ring instead of a logical listing starting with the growth group.


---

Comment by dkrenn created at 2015-09-29 18:37:17

Replying to [comment:45 cheuberg]:
> {{{
> .. toctree::
>    :hidden:
> 
>    asymptotic_expansions_index
> }}}
> could now be removed from `src/doc/en/reference/rings/index.rst` .
> 
> But this can wait until one of the follow-up tickets.

Ok (probably #19083).

> And in `src/doc/output/html/en/reference/rings/asymptotic_expansions_index.html`, the very first line could be a pointer towards the introductory material in the asymptotic ring instead of a logical listing starting with the growth group.

This is done in #19083.


---

Comment by vbraun created at 2015-10-12 07:16:40

Resolution: fixed
