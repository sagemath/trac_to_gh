# Issue 15035: Bruhat posets and Bruhat graphs for parabolic subgroups

archive/issues_015035.json:
```json
{
    "body": "CC:  nthiery bump tscrim aschilling\n\nThis patch extends the functionality of bruhat_poset and introduces new parabolic_bruhat_graph for finite Weyl groups. \n\nLet W be a finite Weyl group and let W_S be the subgroup of W generated by reflections associated with a subset S of simple roots. Then the cosets W / W_S have unique representatives of minimal length which are ordered by the Bruhat order of W. Similarly for W_S \\ W. These poset structures appear in many places, e.g. intersection cohomology of generalized flag varieties or nilpotent Lie algebra cohomology.\n\nThis patch adds a parameters index_set (= S) and side (left / right).\n\n\n----\n\n\nIntroducing parabolic_bruhat_graph is ugly. Ideally, one would just extend the existing bruhat_graph. However, this method is based upon bruhat_interval which belongs to categories/coxeter_groups.py \n\nI was unsure where to put the code, which I haven't written yet nor which I need  in the foreseeable future anyway. Since it seems that the best course of action would be to implement class (or category?) for parabolic subroot systems / groups I think that one more method for Weyl group is not much of an issue.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15272\n\n",
    "created_at": "2013-10-12T21:52:36Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "Bruhat posets and Bruhat graphs for parabolic subgroups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15035",
    "user": "vittucek"
}
```
CC:  nthiery bump tscrim aschilling

This patch extends the functionality of bruhat_poset and introduces new parabolic_bruhat_graph for finite Weyl groups. 

Let W be a finite Weyl group and let W_S be the subgroup of W generated by reflections associated with a subset S of simple roots. Then the cosets W / W_S have unique representatives of minimal length which are ordered by the Bruhat order of W. Similarly for W_S \ W. These poset structures appear in many places, e.g. intersection cohomology of generalized flag varieties or nilpotent Lie algebra cohomology.

This patch adds a parameters index_set (= S) and side (left / right).


----


Introducing parabolic_bruhat_graph is ugly. Ideally, one would just extend the existing bruhat_graph. However, this method is based upon bruhat_interval which belongs to categories/coxeter_groups.py 

I was unsure where to put the code, which I haven't written yet nor which I need  in the foreseeable future anyway. Since it seems that the best course of action would be to implement class (or category?) for parabolic subroot systems / groups I think that one more method for Weyl group is not much of an issue.

Issue created by migration from https://trac.sagemath.org/ticket/15272





---

archive/issue_comments_192206.json:
```json
{
    "body": "Attachment [trac_15272_parabolic_bruhat_posets.patch](tarball://root/attachments/some-uuid/ticket15272/trac_15272_parabolic_bruhat_posets.patch) by vittucek created at 2013-10-12 22:09:24",
    "created_at": "2013-10-12T22:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192206",
    "user": "vittucek"
}
```

Attachment [trac_15272_parabolic_bruhat_posets.patch](tarball://root/attachments/some-uuid/ticket15272/trac_15272_parabolic_bruhat_posets.patch) by vittucek created at 2013-10-12 22:09:24



---

archive/issue_comments_192207.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-03T11:12:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192207",
    "user": "vittucek"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_192208.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-03-18T17:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192208",
    "user": "vittucek"
}
```

New commits:



---

archive/issue_comments_192209.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-19T12:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192209",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192210.json:
```json
{
    "body": "There is a merge conflict with develop:\n\n```\n        x = x.coset_representative(index_set,side)\n        y = y.coset_representative(index_set,side)\n        g = self.bruhat_poset(index_set, crossed_nodes, side, facade=True).interval(x,y)\n        ref = self.reflections()\n        d = {}\n        for x in g:\n<<<<<<< HEAD\n            d[x] = [y for y in g if x.length() < y.length() and x*y.inverse() in ref]\n=======\n            d[x] = {}\n            for y in g:\n                if side == \"right\":\n                    r = y*x.inverse()\n                else:\n                    r = x.inverse()*y\n                if x.length() < y.length() and ref.has_key(r):\n                    d[x][y] = r\n>>>>>>> 92888b345acb3f6726c1d38ab16d4f1366fbb757\n        return DiGraph(d)\n```\n\nI'm pushing a branch (warning: branch change!) in which I resolve this in favor of your patch's version (the longer one, with the \"for y in g\" loop and the dictionary rather than the list). If this is wrong, please let me know.\n----\nNew commits:",
    "created_at": "2014-03-25T23:43:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192210",
    "user": "darij"
}
```

There is a merge conflict with develop:

```
        x = x.coset_representative(index_set,side)
        y = y.coset_representative(index_set,side)
        g = self.bruhat_poset(index_set, crossed_nodes, side, facade=True).interval(x,y)
        ref = self.reflections()
        d = {}
        for x in g:
<<<<<<< HEAD
            d[x] = [y for y in g if x.length() < y.length() and x*y.inverse() in ref]
=======
            d[x] = {}
            for y in g:
                if side == "right":
                    r = y*x.inverse()
                else:
                    r = x.inverse()*y
                if x.length() < y.length() and ref.has_key(r):
                    d[x][y] = r
>>>>>>> 92888b345acb3f6726c1d38ab16d4f1366fbb757
        return DiGraph(d)
```

I'm pushing a branch (warning: branch change!) in which I resolve this in favor of your patch's version (the longer one, with the "for y in g" loop and the dictionary rather than the list). If this is wrong, please let me know.
----
New commits:



---

archive/issue_comments_192211.json:
```json
{
    "body": "That said, what do you think about pulling the `if side == \"right\"` check outside of the loop, so as to not repeat it over and over?",
    "created_at": "2014-03-25T23:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192211",
    "user": "darij"
}
```

That said, what do you think about pulling the `if side == "right"` check outside of the loop, so as to not repeat it over and over?



---

archive/issue_comments_192212.json:
```json
{
    "body": "Oh, and also the conflict was because some other patch replaced `ref.has_key(...)` by `... in ref`. Maybe do the same in your code? (I don't know what the difference is; it just sounds like a logical thing to do.)",
    "created_at": "2014-03-25T23:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192212",
    "user": "darij"
}
```

Oh, and also the conflict was because some other patch replaced `ref.has_key(...)` by `... in ref`. Maybe do the same in your code? (I don't know what the difference is; it just sounds like a logical thing to do.)



---

archive/issue_comments_192213.json:
```json
{
    "body": "The `has_key` is being deprecated (removed?) in python3 in favor of the `in` syntax (which I believe is faster...?). Also I agree with Darij since this loop is so small, I'd pull the `side == \"right\"` statement outside as:\n\n```\nif side == \"right\":\n    for y in g:\n        r = y*x.inverse()\n    if x.length() < y.length() and r in ref:\n        d[x][y] = r\nelse:\n    for y in g:\n        r = x.inverse()*y\n    if x.length() < y.length() and r in ref:\n        d[x][y] = r\n```\n",
    "created_at": "2014-03-26T02:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192213",
    "user": "tscrim"
}
```

The `has_key` is being deprecated (removed?) in python3 in favor of the `in` syntax (which I believe is faster...?). Also I agree with Darij since this loop is so small, I'd pull the `side == "right"` statement outside as:

```
if side == "right":
    for y in g:
        r = y*x.inverse()
    if x.length() < y.length() and r in ref:
        d[x][y] = r
else:
    for y in g:
        r = x.inverse()*y
    if x.length() < y.length() and r in ref:
        d[x][y] = r
```




---

archive/issue_comments_192214.json:
```json
{
    "body": "Replying to [comment:7 darij]:\n> There is a merge conflict with develop:\n> {{{\n>         x = x.coset_representative(index_set,side)\n>         y = y.coset_representative(index_set,side)\n>         g = self.bruhat_poset(index_set, crossed_nodes, side, facade=True).interval(x,y)\n>         ref = self.reflections()\n>         d = {}\n>         for x in g:\n> <<<<<<< HEAD\n>             d[x] = [y for y in g if x.length() < y.length() and x*y.inverse() in ref]\n> =======\n>             d[x] = {}\n>             for y in g:\n>                 if side == \"right\":\n>                     r = y*x.inverse()\n>                 else:\n>                     r = x.inverse()*y\n>                 if x.length() < y.length() and ref.has_key(r):\n>                     d[x][y] = r\n> >>>>>>> 92888b345acb3f6726c1d38ab16d4f1366fbb757\n>         return DiGraph(d)\n> }}}\n> I'm pushing a branch (warning: branch change!) in which I resolve this in favor of your patch's version (the longer one, with the \"for y in g\" loop and the dictionary rather than the list). If this is wrong, please let me know.\n> ----\n\nThanks!  I've made the change you've requested (and moreover I've switched the order of tests to benefit from short-circuiting. I didn't know how to add the patch on top of your branch (insufficient permissions?) so I just went with what `sage -dev push` suggested. I hope that's fine.\n----\nNew commits:",
    "created_at": "2014-03-26T14:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192214",
    "user": "vittucek"
}
```

Replying to [comment:7 darij]:
> There is a merge conflict with develop:
> {{{
>         x = x.coset_representative(index_set,side)
>         y = y.coset_representative(index_set,side)
>         g = self.bruhat_poset(index_set, crossed_nodes, side, facade=True).interval(x,y)
>         ref = self.reflections()
>         d = {}
>         for x in g:
> <<<<<<< HEAD
>             d[x] = [y for y in g if x.length() < y.length() and x*y.inverse() in ref]
> =======
>             d[x] = {}
>             for y in g:
>                 if side == "right":
>                     r = y*x.inverse()
>                 else:
>                     r = x.inverse()*y
>                 if x.length() < y.length() and ref.has_key(r):
>                     d[x][y] = r
> >>>>>>> 92888b345acb3f6726c1d38ab16d4f1366fbb757
>         return DiGraph(d)
> }}}
> I'm pushing a branch (warning: branch change!) in which I resolve this in favor of your patch's version (the longer one, with the "for y in g" loop and the dictionary rather than the list). If this is wrong, please let me know.
> ----

Thanks!  I've made the change you've requested (and moreover I've switched the order of tests to benefit from short-circuiting. I didn't know how to add the patch on top of your branch (insufficient permissions?) so I just went with what `sage -dev push` suggested. I hope that's fine.
----
New commits:



---

archive/issue_comments_192215.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-26T20:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192215",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_192216.json:
```json
{
    "body": "Replying to [comment:9 darij]:\n> Oh, and also the conflict was because some other patch replaced `ref.has_key(...)` by `... in ref`. Maybe do the same in your code? (I don't know what the difference is; it just sounds like a logical thing to do.)\n\nEhm. I have done this change too hastily. As it turns out `ref` is not a dictionary but a `FiniteFamily` which means that its `__contains__` method looks at the values. It's `__contains__` method was changed #15784 to use `in` in favor of `has_key`.",
    "created_at": "2014-03-26T20:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192216",
    "user": "vittucek"
}
```

Replying to [comment:9 darij]:
> Oh, and also the conflict was because some other patch replaced `ref.has_key(...)` by `... in ref`. Maybe do the same in your code? (I don't know what the difference is; it just sounds like a logical thing to do.)

Ehm. I have done this change too hastily. As it turns out `ref` is not a dictionary but a `FiniteFamily` which means that its `__contains__` method looks at the values. It's `__contains__` method was changed #15784 to use `in` in favor of `has_key`.



---

archive/issue_comments_192217.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-21T16:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192217",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_192218.json:
```json
{
    "body": "does not apply",
    "created_at": "2015-04-21T16:17:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15035#issuecomment-192218",
    "user": "chapoton"
}
```

does not apply
