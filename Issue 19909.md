# Issue 19909: Bug in computing the Gröner fan

Issue created by migration from Trac.

Original creator: stumpc5

Original creation time: 2016-03-02 11:19:03

Keywords: Gröbner basis, Gröbner fan, gfan

I get

```
sage: P = PolynomialRing(QQ,"x11,x12,x13,x14,x15,x21,x22,x23,x24,x25,x31,x32,x33,x34,x35"); x = P.gens(); M = Matrix(3,x)
sage: M
[x11 x12 x13 x14 x15]
[x21 x22 x23 x24 x25]
[x31 x32 x33 x34 x35]
sage: I = P.ideal(M.minors(2))
sage: gf = I.groebner_fan()
sage: rgbs = gf.reduced_groebner_bases()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Unknown variable:olynomialSequencewith30Polynomialsin15Variable
gfan_bases: parser.cpp:276: virtual Monomial CharacterBasedParser::parseMonomial(const PolynomialRing&): Assertion `0' failed.
```

The same computation with 3 or 4 columns does work.


---

Comment by stumpc5 created at 2016-03-02 11:28:22

The following is actually also really annoying when doing many computations:

```
sage: P = PolynomialRing(QQ,3*5,"x"); x = P.gens(); M = Matrix(3,x)
sage: M
[ x0  x1  x2  x3  x4]
[ x5  x6  x7  x8  x9]
[x10 x11 x12 x13 x14]
sage: I = P.ideal(M.minors(2))
sage: I.groebner_fan()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
...
RuntimeError: Ring variables cannot contain each other as prefixes
```



---

Comment by dimpase created at 2016-03-02 14:27:25

this is a limitation of gfan, cf. Sect. A.2 (p.34) of http://home.math.au.dk/jensen/software/gfan/gfanmanual0.5.pdf

a better interface should automatically do renaming.

see also [5.y.o. post on sage-support](https://groups.google.com/d/topic/sage-support/-Cs3U7-nILw/discussion)


---

Comment by stumpc5 created at 2016-03-02 14:35:02

> a better interface should automatically do renaming.

This applies only to my comment about the variable names, or do you also mean to address the bug report?


---

Comment by dimpase created at 2016-03-02 14:47:26

Replying to [comment:3 stumpc5]:
> > a better interface should automatically do renaming.
> 
> This applies only to my comment about the variable names, or do you also mean to address the bug report?

I meant to say that the Sage gfan interface should do automatic variable renaming to prevent this sort of a problem. Should not be hard to fix, in fact.


---

Comment by stumpc5 created at 2016-03-02 15:31:43

The problem is that the gfan code uses `ideal_to_gfan_format` which expects the generators of an ideal to come as a list. But they don't:

```
sage: P = PolynomialRing(QQ,"x11,x12,x13,x14,x21,x22,x23,x24,x31,x32,x33,x34"); x = P.gens(); M = Matrix(3,x)
sage: I = P.ideal(M.minors(2))
sage: I.gens()
[-x12*x21 + x11*x22, -x13*x21 + x11*x23, -x14*x21 + x11*x24, -x13*x22 + x12*x23, -x14*x22 + x12*x24, -x14*x23 + x13*x24, -x12*x31 + x11*x32, -x13*x31 + x11*x33, -x14*x31 + x11*x34, -x13*x32 + x12*x33, -x14*x32 + x12*x34, -x14*x33 + x13*x34, -x22*x31 + x21*x32, -x23*x31 + x21*x33, -x24*x31 + x21*x34, -x23*x32 + x22*x33, -x24*x32 + x22*x34, -x24*x33 + x23*x34]
sage: P = PolynomialRing(QQ,"x11,x12,x13,x14,x15,x21,x22,x23,x24,x25,x31,x32,x33,x34,x35"); x = P.gens(); M = Matrix(3,x)
sage: I = P.ideal(M.minors(2))
sage: I.gens()
Polynomial Sequence with 30 Polynomials in 15 Variables
```


I will provide a patch preparsing `I.gens()` before giving it to `ideal_to_gfan_format`.


---

Comment by stumpc5 created at 2016-03-02 16:02:51

Changing status from new to needs_review.


---

Comment by stumpc5 created at 2016-03-02 16:02:51

New commits:


---

Comment by mmarco created at 2016-03-02 17:27:21

That is indeed the problem. Did you test that the testsuite passes and the documentation builds correctly?

If you did, put your name on the Authors field, and you can set it to positive review.


---

Comment by dimpase created at 2016-03-03 22:22:26

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-03-05 09:47:54

Resolution: fixed
