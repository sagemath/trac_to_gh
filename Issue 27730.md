# Issue 27730: Py3: Fix RecursivelyEnumeratedSet BFS for python3.

archive/issues_027730.json:
```json
{
    "body": "CC:  slabbe chapoton tscrim nthiery\n\nIn RecursivelyEnumeratedSet_graded.breadth_first_search_iterator, use list for next_level instead of set in order to iterate over his elements in the same order on each run.\n    \nThis fix python3 errors inthe combinat.root_system.weyl_group and root_lattice_realisations module.\n\nBut this modification causes some new doctests failures in weylgroup :\n\n\n```\nvklein@tuono:~/odk/sage$ sage -t --long src/sage/combinat/root_system/weyl_group.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2019-06-11-11-15-20-edaa5a63.\nGit branch: HEAD\nUsing --optional=build,cmake,dochtml,memlimit,mpir,primecount,python2,sage\nDoctesting 1 file.\nsage -t --long src/sage/combinat/root_system/weyl_group.py\n**********************************************************************\nFile \"src/sage/combinat/root_system/weyl_group.py\", line 1128, in sage.combinat.root_system.weyl_group.WeylGroup_permutation._coerce_map_from_\nFailed example:\n    W.has_coerce_map_from(W5)\nExpected:\n    False\nGot:\n    True\n...\nFile \"src/sage/combinat/root_system/weyl_group.py\", line 1157, in sage.combinat.root_system.weyl_group.WeylGroup_permutation.simple_reflection\nFailed example:\n    **with  W = WeylGroup(['A',4], implementation=\"permutation\")**\n    W.simple_reflections()\nExpected:\n    Finite family {1: (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20),\n                   2: (1,6)(2,12)(3,7)(5,8)(11,16)(13,17)(15,18),\n                   3: (2,7)(3,13)(4,5)(6,9)(12,17)(14,15)(16,19),\n                   4: (3,5)(4,14)(7,8)(9,10)(13,15)(17,18)(19,20)}\nGot:\n    Finite family {1: (1,11)(2,5)(6,8)(9,10)(12,15)(16,18)(19,20), \n                   2: (1,5)(2,12)(3,6)(7,9)(11,15)(13,16)(17,19),\n                   3: (2,6)(3,13)(4,7)(5,8)(12,16)(14,17)(15,18),\n                   4: (3,7)(4,14)(6,9)(8,10)(13,17)(16,19)(18,20)}\n```\n\n\nI need help to look if the two results of `W.simple_reflections()` are both correct or not and what's the result of `W.has_coerce_map_from(W5)` is supposed to be.\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27967\n\n",
    "created_at": "2019-06-11T09:22:09Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Py3: Fix RecursivelyEnumeratedSet BFS for python3.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27730",
    "user": "vklein"
}
```
CC:  slabbe chapoton tscrim nthiery

In RecursivelyEnumeratedSet_graded.breadth_first_search_iterator, use list for next_level instead of set in order to iterate over his elements in the same order on each run.
    
This fix python3 errors inthe combinat.root_system.weyl_group and root_lattice_realisations module.

But this modification causes some new doctests failures in weylgroup :


```
vklein@tuono:~/odk/sage$ sage -t --long src/sage/combinat/root_system/weyl_group.py 
too many failed tests, not using stored timings
Running doctests with ID 2019-06-11-11-15-20-edaa5a63.
Git branch: HEAD
Using --optional=build,cmake,dochtml,memlimit,mpir,primecount,python2,sage
Doctesting 1 file.
sage -t --long src/sage/combinat/root_system/weyl_group.py
**********************************************************************
File "src/sage/combinat/root_system/weyl_group.py", line 1128, in sage.combinat.root_system.weyl_group.WeylGroup_permutation._coerce_map_from_
Failed example:
    W.has_coerce_map_from(W5)
Expected:
    False
Got:
    True
...
File "src/sage/combinat/root_system/weyl_group.py", line 1157, in sage.combinat.root_system.weyl_group.WeylGroup_permutation.simple_reflection
Failed example:
    **with  W = WeylGroup(['A',4], implementation="permutation")**
    W.simple_reflections()
Expected:
    Finite family {1: (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20),
                   2: (1,6)(2,12)(3,7)(5,8)(11,16)(13,17)(15,18),
                   3: (2,7)(3,13)(4,5)(6,9)(12,17)(14,15)(16,19),
                   4: (3,5)(4,14)(7,8)(9,10)(13,15)(17,18)(19,20)}
Got:
    Finite family {1: (1,11)(2,5)(6,8)(9,10)(12,15)(16,18)(19,20), 
                   2: (1,5)(2,12)(3,6)(7,9)(11,15)(13,16)(17,19),
                   3: (2,6)(3,13)(4,7)(5,8)(12,16)(14,17)(15,18),
                   4: (3,7)(4,14)(6,9)(8,10)(13,17)(16,19)(18,20)}
```


I need help to look if the two results of `W.simple_reflections()` are both correct or not and what's the result of `W.has_coerce_map_from(W5)` is supposed to be.



Issue created by migration from https://trac.sagemath.org/ticket/27967





---

archive/issue_comments_391696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-11T09:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391696",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391697.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2019-06-11T09:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391697",
    "user": "vklein"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_391698.json:
```json
{
    "body": "Not clear to me that you can just replace set by list.. There could be repetitions..",
    "created_at": "2019-06-12T14:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391698",
    "user": "chapoton"
}
```

Not clear to me that you can just replace set by list.. There could be repetitions..



---

archive/issue_comments_391699.json:
```json
{
    "body": "I think repetitions are filtered:\n\n```\nif y is None or y in next_level:\n    continue\nnext_level.append(y)\n```\n",
    "created_at": "2019-06-12T15:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391699",
    "user": "vklein"
}
```

I think repetitions are filtered:

```
if y is None or y in next_level:
    continue
next_level.append(y)
```




---

archive/issue_comments_391700.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391700",
    "user": "embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_391701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-06-17T22:29:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391701",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391702.json:
```json
{
    "body": "\n```diff\n-        cdef set next_level\n+        cdef list next_level\n+        cdef set set_next_level\n```\n\n\nI do not like the idea of having two structures (list + set) to store the same elements. This may make the algorithm use twice as much memory. There must be a way to achieve this using only one.\n\nAlso, why should the enumeration order be certified? This is not claimed in the documentation. I know it would be very nice for the doctests of other codes using it, but I believe it is an error to expect such a thing. I would rather think the code using RES should fix themselves instead.",
    "created_at": "2019-06-21T15:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391702",
    "user": "slabbe"
}
```


```diff
-        cdef set next_level
+        cdef list next_level
+        cdef set set_next_level
```


I do not like the idea of having two structures (list + set) to store the same elements. This may make the algorithm use twice as much memory. There must be a way to achieve this using only one.

Also, why should the enumeration order be certified? This is not claimed in the documentation. I know it would be very nice for the doctests of other codes using it, but I believe it is an error to expect such a thing. I would rather think the code using RES should fix themselves instead.



---

archive/issue_comments_391703.json:
```json
{
    "body": "> Also, why should the enumeration order be certified? This is not claimed in the documentation. I know it would be very nice for the doctests of other codes using it, but I believe it is an error to expect such a thing. I would rather think the code using RES should fix themselves instead.\n\nThe code using RES can't really fix that by sorting the results because the results are potentially too big and will take too much time to sort and therefore cancel the goal of using a generator.\n\nThe only other way i can think of now is tagging the tests with #py2 #py3 and hope order will remain the same across configuration and future python3 version.",
    "created_at": "2019-06-28T09:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391703",
    "user": "vklein"
}
```

> Also, why should the enumeration order be certified? This is not claimed in the documentation. I know it would be very nice for the doctests of other codes using it, but I believe it is an error to expect such a thing. I would rather think the code using RES should fix themselves instead.

The code using RES can't really fix that by sorting the results because the results are potentially too big and will take too much time to sort and therefore cancel the goal of using a generator.

The only other way i can think of now is tagging the tests with #py2 #py3 and hope order will remain the same across configuration and future python3 version.



---

archive/issue_comments_391704.json:
```json
{
    "body": "Fixes for root_lattice_realizations are now in #28167.",
    "created_at": "2019-07-11T13:23:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391704",
    "user": "vklein"
}
```

Fixes for root_lattice_realizations are now in #28167.



---

archive/issue_comments_391705.json:
```json
{
    "body": "I was thinking instead of these changes to fix doctest failures in `weyl_group.py`. What do you think?\n\n```diff\ndiff --git a/src/sage/combinat/root_system/weyl_group.py b/src/sage/combinat/root_system/weyl_group.py\nindex 360d9bf320..e34dbe88b0 100644\n--- a/src/sage/combinat/root_system/weyl_group.py\n+++ b/src/sage/combinat/root_system/weyl_group.py\n@@ -355,8 +355,11 @@ class WeylGroup_gens(UniqueRepresentation,\n         EXAMPLES::\n \n             sage: W = WeylGroup(\"B2\", prefix=\"s\")\n-            sage: refdict = W.reflections(); refdict\n+            sage: refdict = W.reflections()\n+            sage: refdict # random\n             Finite family {(1, -1): s1, (0, 1): s2, (1, 1): s2*s1*s2, (1, 0): s1*s2*s1}\n+            sage: [(a, refdict[a]) for a in sorted(dict(refdict))]\n+            [((1, 0), s1*s2*s1), ((1, -1), s1), ((1, 1), s2*s1*s2), ((0, 1), s2)]\n             sage: [r+refdict[r].action(r) for r in refdict.keys()]\n             [(0, 0), (0, 0), (0, 0), (0, 0)]\n \n@@ -1153,13 +1156,18 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):\n         EXAMPLES::\n \n             sage: W = WeylGroup(['A',4], implementation=\"permutation\")\n-            sage: W.simple_reflection(1)\n+            sage: a = W.simple_reflection(1)\n+            sage: a # random\n             (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20)\n-            sage: W.simple_reflections()\n+            sage: a.is_reflection()\n+            True\n+            sage: W.simple_reflections() # random\n             Finite family {1: (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20),\n                            2: (1,6)(2,12)(3,7)(5,8)(11,16)(13,17)(15,18),\n                            3: (2,7)(3,13)(4,5)(6,9)(12,17)(14,15)(16,19),\n                            4: (3,5)(4,14)(7,8)(9,10)(13,15)(17,18)(19,20)}\n+            sage: W == W.subgroup(W.simple_reflections())\n+            True\n         \"\"\"\n         return self.gens()[self._index_set_inverse[i]]\n \n@@ -1229,19 +1237,19 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):\n         EXAMPLES::\n \n             sage: W = WeylGroup(['G',2], implementation=\"permutation\")\n-            sage: W.roots()\n-            ((1, 0),\n+            sage: sorted(W.roots())\n+            [(-3, -2),\n+             (-3, -1),\n+             (-2, -1),\n+             (-1, -1),\n+             (-1, 0),\n+             (0, -1),\n              (0, 1),\n+             (1, 0),\n              (1, 1),\n-             (3, 1),\n              (2, 1),\n-             (3, 2),\n-             (-1, 0),\n-             (0, -1),\n-             (-1, -1),\n-             (-3, -1),\n-             (-2, -1),\n-             (-3, -2))\n+             (3, 1),\n+             (3, 2)]\n         \"\"\"\n         Q = self._cartan_type.root_system().root_lattice()\n         roots = ([x.to_vector() for x in Q.positive_roots()]\n@@ -1257,7 +1265,7 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):\n         EXAMPLES::\n \n             sage: W = WeylGroup(['C',3], implementation=\"permutation\")\n-            sage: W.positive_roots()\n+            sage: W.positive_roots() # py2\n             ((1, 0, 0),\n              (0, 1, 0),\n              (0, 0, 1),\n@@ -1267,6 +1275,16 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):\n              (2, 2, 1),\n              (1, 1, 1),\n              (1, 2, 1))\n+            sage: W.positive_roots() # py3\n+            ((1, 0, 0),\n+             (0, 1, 0),\n+             (0, 0, 1),\n+             (0, 1, 1),\n+             (0, 2, 1),\n+             (1, 1, 0),\n+             (2, 2, 1),\n+             (1, 1, 1),\n+             (1, 2, 1))\n         \"\"\"\n         return self.roots()[:self.number_of_reflections()]\n \n```\n",
    "created_at": "2019-07-22T00:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391705",
    "user": "jhpalmieri"
}
```

I was thinking instead of these changes to fix doctest failures in `weyl_group.py`. What do you think?

```diff
diff --git a/src/sage/combinat/root_system/weyl_group.py b/src/sage/combinat/root_system/weyl_group.py
index 360d9bf320..e34dbe88b0 100644
--- a/src/sage/combinat/root_system/weyl_group.py
+++ b/src/sage/combinat/root_system/weyl_group.py
@@ -355,8 +355,11 @@ class WeylGroup_gens(UniqueRepresentation,
         EXAMPLES::
 
             sage: W = WeylGroup("B2", prefix="s")
-            sage: refdict = W.reflections(); refdict
+            sage: refdict = W.reflections()
+            sage: refdict # random
             Finite family {(1, -1): s1, (0, 1): s2, (1, 1): s2*s1*s2, (1, 0): s1*s2*s1}
+            sage: [(a, refdict[a]) for a in sorted(dict(refdict))]
+            [((1, 0), s1*s2*s1), ((1, -1), s1), ((1, 1), s2*s1*s2), ((0, 1), s2)]
             sage: [r+refdict[r].action(r) for r in refdict.keys()]
             [(0, 0), (0, 0), (0, 0), (0, 0)]
 
@@ -1153,13 +1156,18 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):
         EXAMPLES::
 
             sage: W = WeylGroup(['A',4], implementation="permutation")
-            sage: W.simple_reflection(1)
+            sage: a = W.simple_reflection(1)
+            sage: a # random
             (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20)
-            sage: W.simple_reflections()
+            sage: a.is_reflection()
+            True
+            sage: W.simple_reflections() # random
             Finite family {1: (1,11)(2,6)(7,9)(8,10)(12,16)(17,19)(18,20),
                            2: (1,6)(2,12)(3,7)(5,8)(11,16)(13,17)(15,18),
                            3: (2,7)(3,13)(4,5)(6,9)(12,17)(14,15)(16,19),
                            4: (3,5)(4,14)(7,8)(9,10)(13,15)(17,18)(19,20)}
+            sage: W == W.subgroup(W.simple_reflections())
+            True
         """
         return self.gens()[self._index_set_inverse[i]]
 
@@ -1229,19 +1237,19 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):
         EXAMPLES::
 
             sage: W = WeylGroup(['G',2], implementation="permutation")
-            sage: W.roots()
-            ((1, 0),
+            sage: sorted(W.roots())
+            [(-3, -2),
+             (-3, -1),
+             (-2, -1),
+             (-1, -1),
+             (-1, 0),
+             (0, -1),
              (0, 1),
+             (1, 0),
              (1, 1),
-             (3, 1),
              (2, 1),
-             (3, 2),
-             (-1, 0),
-             (0, -1),
-             (-1, -1),
-             (-3, -1),
-             (-2, -1),
-             (-3, -2))
+             (3, 1),
+             (3, 2)]
         """
         Q = self._cartan_type.root_system().root_lattice()
         roots = ([x.to_vector() for x in Q.positive_roots()]
@@ -1257,7 +1265,7 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):
         EXAMPLES::
 
             sage: W = WeylGroup(['C',3], implementation="permutation")
-            sage: W.positive_roots()
+            sage: W.positive_roots() # py2
             ((1, 0, 0),
              (0, 1, 0),
              (0, 0, 1),
@@ -1267,6 +1275,16 @@ class WeylGroup_permutation(UniqueRepresentation, PermutationGroup_generic):
              (2, 2, 1),
              (1, 1, 1),
              (1, 2, 1))
+            sage: W.positive_roots() # py3
+            ((1, 0, 0),
+             (0, 1, 0),
+             (0, 0, 1),
+             (0, 1, 1),
+             (0, 2, 1),
+             (1, 1, 0),
+             (2, 2, 1),
+             (1, 1, 1),
+             (1, 2, 1))
         """
         return self.roots()[:self.number_of_reflections()]
 
```




---

archive/issue_comments_391706.json:
```json
{
    "body": "However, I am also getting another doctest failure, which leads me to this, which might be a serious problem.\n\nPython 2:\n\n```\nsage: W = WeylGroup(['A',3], implementation=\"permutation\")\nsage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W\nFalse\n```\n\n\nPython 3:\n\n```\nsage: W = WeylGroup(['A',3], implementation=\"permutation\")\nsage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W\nTrue\n```\n\n\nIs this a serious problem? It seems to me that `W` should be the same group, regardless of the version of Python.",
    "created_at": "2019-07-22T00:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391706",
    "user": "jhpalmieri"
}
```

However, I am also getting another doctest failure, which leads me to this, which might be a serious problem.

Python 2:

```
sage: W = WeylGroup(['A',3], implementation="permutation")
sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W
False
```


Python 3:

```
sage: W = WeylGroup(['A',3], implementation="permutation")
sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W
True
```


Is this a serious problem? It seems to me that `W` should be the same group, regardless of the version of Python.



---

archive/issue_comments_391707.json:
```json
{
    "body": "Replying to [comment:10 slabbe]:\n> I do not like the idea of having two structures (list + set) to store the same elements. This may make the algorithm use twice as much memory. There must be a way to achieve this using only one.\n\nThe following change can improve memory usage, at least if the branching factor is large, say 2 or more. The difference here is that elements are generally returned much earlier during the search: by an entire generation earlier. In other words, it is possible to explore one level further before running out of memory.\n\n\n```diff\n--- a/src/sage/sets/recursively_enumerated_set.pyx\n+++ b/src/sage/sets/recursively_enumerated_set.pyx\n@@ -1166,18 +1166,21 @@ cdef class RecursivelyEnumeratedSet_graded(RecursivelyEnumeratedSet_generic):\n         cdef int depth\n         if max_depth is None:\n             max_depth = self._max_depth\n         current_level = self._seeds\n+        if max_depth >= 0:\n+            for x in current_level:\n+                yield x\n         depth = 0\n-        while current_level and depth <= max_depth:\n+        while current_level and depth < max_depth:\n             next_level = list()\n             set_next_level = set()\n\n             for x in current_level:\n-                yield x\n                 for y in self.successors(x):\n                     if y is None or y in set_next_level:\n                         continue\n+                    yield y\n                     next_level.append(y)\n                     set_next_level.add(y)\n             current_level = next_level\n             depth += 1\n```\n\n\nIf the branching factor is small, closer to 1, then memory consumption is probably less of a problem. However, also consider that the proposed solution replaces 2 sets by 1 set and 2 lists. Lists have a much smaller memory footprint and iteration is faster.\n\nAside from that, in most cases, the elements iterated over will add much more to the memory consumption than the additional list.\n\nThis solution should also be applied to the generic (non-graded) case. That case does not require an additional list \u2013 replacing a set by a list is enough. As far as I can tell, this would also help with #28227.",
    "created_at": "2019-07-22T19:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391707",
    "user": "@mwageringel"
}
```

Replying to [comment:10 slabbe]:
> I do not like the idea of having two structures (list + set) to store the same elements. This may make the algorithm use twice as much memory. There must be a way to achieve this using only one.

The following change can improve memory usage, at least if the branching factor is large, say 2 or more. The difference here is that elements are generally returned much earlier during the search: by an entire generation earlier. In other words, it is possible to explore one level further before running out of memory.


```diff
--- a/src/sage/sets/recursively_enumerated_set.pyx
+++ b/src/sage/sets/recursively_enumerated_set.pyx
@@ -1166,18 +1166,21 @@ cdef class RecursivelyEnumeratedSet_graded(RecursivelyEnumeratedSet_generic):
         cdef int depth
         if max_depth is None:
             max_depth = self._max_depth
         current_level = self._seeds
+        if max_depth >= 0:
+            for x in current_level:
+                yield x
         depth = 0
-        while current_level and depth <= max_depth:
+        while current_level and depth < max_depth:
             next_level = list()
             set_next_level = set()

             for x in current_level:
-                yield x
                 for y in self.successors(x):
                     if y is None or y in set_next_level:
                         continue
+                    yield y
                     next_level.append(y)
                     set_next_level.add(y)
             current_level = next_level
             depth += 1
```


If the branching factor is small, closer to 1, then memory consumption is probably less of a problem. However, also consider that the proposed solution replaces 2 sets by 1 set and 2 lists. Lists have a much smaller memory footprint and iteration is faster.

Aside from that, in most cases, the elements iterated over will add much more to the memory consumption than the additional list.

This solution should also be applied to the generic (non-graded) case. That case does not require an additional list – replacing a set by a list is enough. As far as I can tell, this would also help with #28227.



---

archive/issue_comments_391708.json:
```json
{
    "body": "What needs to be done to move this ticket along? It is one of the main obstacles to having tests pass with Python 3. (See #28298.)",
    "created_at": "2019-08-03T22:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391708",
    "user": "jhpalmieri"
}
```

What needs to be done to move this ticket along? It is one of the main obstacles to having tests pass with Python 3. (See #28298.)



---

archive/issue_comments_391709.json:
```json
{
    "body": "Replying to [comment:14 jhpalmieri]:\n> However, I am also getting another doctest failure, which leads me to this, which might be a serious problem.\n> \n> Python 2:\n> {{{\n> sage: W = WeylGroup(['A',3], implementation=\"permutation\")\n> sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W\n> False\n> }}}\n> \n> Python 3:\n> {{{\n> sage: W = WeylGroup(['A',3], implementation=\"permutation\")\n> sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W\n> True\n> }}}\n> \n> Is this a serious problem? It seems to me that `W` should be the same group, regardless of the version of Python.\n\n`W` is a permutation group on the roots `W.roots()`, so the concrete representation in terms of permutations depends on the order of these roots, which differs between Python 2 and 3. Hence, this should not be a serious problem.\n\nIf this appears in the doctests (?), in order to obtain consistent results between Python versions, this could be solved by writing the permutation as a conjugation with the permutation that sorts the roots. That is, unless `RecursivelyEnumeratedSet` itself is changed as suggested in this ticket.",
    "created_at": "2019-08-04T15:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391709",
    "user": "@mwageringel"
}
```

Replying to [comment:14 jhpalmieri]:
> However, I am also getting another doctest failure, which leads me to this, which might be a serious problem.
> 
> Python 2:
> {{{
> sage: W = WeylGroup(['A',3], implementation="permutation")
> sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W
> False
> }}}
> 
> Python 3:
> {{{
> sage: W = WeylGroup(['A',3], implementation="permutation")
> sage: Permutation('(1,7)(2,5)(4,6)(8,11)(10,12)') in W
> True
> }}}
> 
> Is this a serious problem? It seems to me that `W` should be the same group, regardless of the version of Python.

`W` is a permutation group on the roots `W.roots()`, so the concrete representation in terms of permutations depends on the order of these roots, which differs between Python 2 and 3. Hence, this should not be a serious problem.

If this appears in the doctests (?), in order to obtain consistent results between Python versions, this could be solved by writing the permutation as a conjugation with the permutation that sorts the roots. That is, unless `RecursivelyEnumeratedSet` itself is changed as suggested in this ticket.



---

archive/issue_comments_391710.json:
```json
{
    "body": "Replying to [comment:17 gh-mwageringel]:\n> If this appears in the doctests (?), in order to obtain consistent results between Python versions, this could be solved by writing the permutation as a conjugation with the permutation that sorts the roots. That is, unless `RecursivelyEnumeratedSet` itself is changed as suggested in this ticket.\n\nIt doesn't appear in the doctests: I was experimenting with alternate possible doctests that might work with both Python versions.",
    "created_at": "2019-08-05T20:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391710",
    "user": "jhpalmieri"
}
```

Replying to [comment:17 gh-mwageringel]:
> If this appears in the doctests (?), in order to obtain consistent results between Python versions, this could be solved by writing the permutation as a conjugation with the permutation that sorts the roots. That is, unless `RecursivelyEnumeratedSet` itself is changed as suggested in this ticket.

It doesn't appear in the doctests: I was experimenting with alternate possible doctests that might work with both Python versions.



---

archive/issue_comments_391711.json:
```json
{
    "body": "How should we proceed here? I am happy if others take the approach in this ticket, but will that happen soon? If not, I can provide cosmetic doctest patches (as in comment:13) so that tests pass on Python 3, on a separate ticket as a stopgap. Any opinions?",
    "created_at": "2019-08-06T19:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391711",
    "user": "jhpalmieri"
}
```

How should we proceed here? I am happy if others take the approach in this ticket, but will that happen soon? If not, I can provide cosmetic doctest patches (as in comment:13) so that tests pass on Python 3, on a separate ticket as a stopgap. Any opinions?



---

archive/issue_comments_391712.json:
```json
{
    "body": "Regarding the first new doctest failure from the ticket description (`W.has_coerce_map_from(W5)` returning `True`): with this branch, I get\n\n```\nsage: W = WeylGroup([\"B\",4], implementation=\"permutation\")\nsage: W5 = WeylGroup([\"C\",4], implementation=\"permutation\")\nsage: W.gens() == W5.gens()\nTrue\n```\n\nI'm guessing that's what's going on: the identity map is a coercion map in this case.\n\nThe documentation is not consistent with the code. The documentation for `_coerce_map_from_` says `Return ``True`` if ``P`` is a Weyl group of the same Cartan type and ``False`` otherwise.` The code says\n\n```\n        if isinstance(P, WeylGroup_gens) and P.cartan_type() is self.cartan_type():\n            return True\n        return super(WeylGroup_permutation, self)._coerce_map_from_(P)\n```\n\nSo if `P` has the same Cartan type, return `True`, but otherwise, call something else: don't just automatically return `False` as the documentation says. I'm not sure what to do here.",
    "created_at": "2019-08-13T22:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391712",
    "user": "jhpalmieri"
}
```

Regarding the first new doctest failure from the ticket description (`W.has_coerce_map_from(W5)` returning `True`): with this branch, I get

```
sage: W = WeylGroup(["B",4], implementation="permutation")
sage: W5 = WeylGroup(["C",4], implementation="permutation")
sage: W.gens() == W5.gens()
True
```

I'm guessing that's what's going on: the identity map is a coercion map in this case.

The documentation is not consistent with the code. The documentation for `_coerce_map_from_` says `Return ``True`` if ``P`` is a Weyl group of the same Cartan type and ``False`` otherwise.` The code says

```
        if isinstance(P, WeylGroup_gens) and P.cartan_type() is self.cartan_type():
            return True
        return super(WeylGroup_permutation, self)._coerce_map_from_(P)
```

So if `P` has the same Cartan type, return `True`, but otherwise, call something else: don't just automatically return `False` as the documentation says. I'm not sure what to do here.



---

archive/issue_comments_391713.json:
```json
{
    "body": "I've created #28351 as a stopgap to fix the py3 doctests. If the approach here can be worked out, then it's easy enough to change the doctests again.",
    "created_at": "2019-08-13T22:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391713",
    "user": "jhpalmieri"
}
```

I've created #28351 as a stopgap to fix the py3 doctests. If the approach here can be worked out, then it's easy enough to change the doctests again.



---

archive/issue_comments_391714.json:
```json
{
    "body": "Sorry for not commenting on this sooner. So the problem might stem from the fact that these groups are isomorphic as (Coxeter) groups, but not as Weyl groups. For a Weyl group, it also acts on a set of roots (a set of vectors whose hyperplanes define the reflections and the set is closed under these reflections), which between type B and C are dual (there are two different lengths of the roots, and they are interchanged between the two types).\n\nHowever, when doing the permutation implementation, we are effectively forgetting about the roots themselves, but instead (as pointed out in comment:17) it just depends on how the roots are permuted around. So when the ordering of the roots changes, the permutation group changes.\n\nNow for the `_coerce_map_from_`, that is a trickier thing to handle. I think we should just return `False` as per the documentation and not let the base class (i.e., the generic permutation group code) handle it precisely because we define this as a Weyl group.",
    "created_at": "2019-08-17T02:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391714",
    "user": "tscrim"
}
```

Sorry for not commenting on this sooner. So the problem might stem from the fact that these groups are isomorphic as (Coxeter) groups, but not as Weyl groups. For a Weyl group, it also acts on a set of roots (a set of vectors whose hyperplanes define the reflections and the set is closed under these reflections), which between type B and C are dual (there are two different lengths of the roots, and they are interchanged between the two types).

However, when doing the permutation implementation, we are effectively forgetting about the roots themselves, but instead (as pointed out in comment:17) it just depends on how the roots are permuted around. So when the ordering of the roots changes, the permutation group changes.

Now for the `_coerce_map_from_`, that is a trickier thing to handle. I think we should just return `False` as per the documentation and not let the base class (i.e., the generic permutation group code) handle it precisely because we define this as a Weyl group.



---

archive/issue_comments_391715.json:
```json
{
    "body": "For `_coerce_map_from`, I like the idea of changing the code so it is consistent with the documentation.\n\nWhat about concerns about memory usage, and the other aspects of comment:10? (If we were guaranteed to use Python 3.7 or later, we could use dictionaries, since they are [apparently insertion ordered](https://mail.python.org/pipermail/python-dev/2017-December/151283.html). What's their memory usage like, compared to a list plus a set?)",
    "created_at": "2019-08-19T16:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391715",
    "user": "jhpalmieri"
}
```

For `_coerce_map_from`, I like the idea of changing the code so it is consistent with the documentation.

What about concerns about memory usage, and the other aspects of comment:10? (If we were guaranteed to use Python 3.7 or later, we could use dictionaries, since they are [apparently insertion ordered](https://mail.python.org/pipermail/python-dev/2017-December/151283.html). What's their memory usage like, compared to a list plus a set?)



---

archive/issue_comments_391716.json:
```json
{
    "body": "This branch works for me with Python 2 and Python 3, but the issue of memory usage has not been addressed.\n----\nNew commits:",
    "created_at": "2019-08-19T18:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391716",
    "user": "jhpalmieri"
}
```

This branch works for me with Python 2 and Python 3, but the issue of memory usage has not been addressed.
----
New commits:



---

archive/issue_comments_391717.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-08-19T18:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391717",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391718.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-08-23T12:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391718",
    "user": "slabbe"
}
```

New commits:



---

archive/issue_comments_391719.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2019-08-23T12:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391719",
    "user": "slabbe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_391720.json:
```json
{
    "body": "Since Python 2.7, there is OrderedDict that we may use. It is written in pure Python, but according to the first answer of [this question](https://stackoverflow.com/questions/8176513/ordereddict-performance-compared-to-deque) \"*Starting with Python 3.5, `OrderedDict()` now has a C implementation.*\"\n\nMy commit seems to work on Python 2. I did not check on Python 3.",
    "created_at": "2019-08-23T12:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391720",
    "user": "slabbe"
}
```

Since Python 2.7, there is OrderedDict that we may use. It is written in pure Python, but according to the first answer of [this question](https://stackoverflow.com/questions/8176513/ordereddict-performance-compared-to-deque) "*Starting with Python 3.5, `OrderedDict()` now has a C implementation.*"

My commit seems to work on Python 2. I did not check on Python 3.



---

archive/issue_comments_391721.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-08-23T12:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391721",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_391722.json:
```json
{
    "body": "I give positive review to commits `\u200b22c2c91`, `\u200b9c19a38` and `a352ddc`. Another one should validate my owns commits `4a6392b, \u200bc5fe69c, \u200bc9442b4` and `\u200b902e26e`.\n\nTests passed in py2 and py3 on the whole `sage.combinat.root_system` module and on `recursively_enumerated_set`.",
    "created_at": "2019-08-23T13:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391722",
    "user": "vklein"
}
```

I give positive review to commits `​22c2c91`, `​9c19a38` and `a352ddc`. Another one should validate my owns commits `4a6392b, ​c5fe69c, ​c9442b4` and `​902e26e`.

Tests passed in py2 and py3 on the whole `sage.combinat.root_system` module and on `recursively_enumerated_set`.



---

archive/issue_comments_391723.json:
```json
{
    "body": "It seems there are some failing tests on the patchbot. Will take a look next week.",
    "created_at": "2019-08-23T16:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391723",
    "user": "slabbe"
}
```

It seems there are some failing tests on the patchbot. Will take a look next week.



---

archive/issue_comments_391724.json:
```json
{
    "body": "I disagree with the recent changes. Using `OrderedDict` does not address the memory concerns that were brought up, as `OrderedDict` will internally store the insertion order in addition to the dictionary. Yet, as explained in comment:15, storing 1 set and 2 lists should usually be more memory efficient than storing 2 ordered dicts. It is faster than using `OrderedDict` too, especially in Python 2. So I would prefer to go back to the old branch.",
    "created_at": "2019-08-23T17:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391724",
    "user": "@mwageringel"
}
```

I disagree with the recent changes. Using `OrderedDict` does not address the memory concerns that were brought up, as `OrderedDict` will internally store the insertion order in addition to the dictionary. Yet, as explained in comment:15, storing 1 set and 2 lists should usually be more memory efficient than storing 2 ordered dicts. It is faster than using `OrderedDict` too, especially in Python 2. So I would prefer to go back to the old branch.



---

archive/issue_comments_391725.json:
```json
{
    "body": "Replying to [comment:33 slabbe]:\n> It seems there are some failing tests on the patchbot. Will take a look next week.\n\nThese don't seem like a big deal, at least as far as I can tell. If we have to fix them (that is, if the failures are due to using `OrderedDict` and we decide to keep using it), then please also make this change:\n\n```diff\ndiff --git a/src/sage/categories/coxeter_groups.py b/src/sage/categories/coxeter_groups.py\nindex b7beca409b..c6037f6c42 100644\n--- a/src/sage/categories/coxeter_groups.py\n+++ b/src/sage/categories/coxeter_groups.py\n@@ -1655,7 +1655,6 @@ class CoxeterGroups(Category_singleton):\n                 sage: W = WeylGroup([\"A\", 3])\n                 sage: s = W.simple_reflections()\n                 sage: w0 = s[1]\n-                sage: w1 = s[1]*s[2]*s[3]\n                 sage: w0.absolute_covers()\n                 [\n                 [0 0 1 0]  [0 1 0 0]  [0 0 0 1]  [0 1 0 0]  [0 1 0 0]\n```\n",
    "created_at": "2019-08-27T18:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391725",
    "user": "jhpalmieri"
}
```

Replying to [comment:33 slabbe]:
> It seems there are some failing tests on the patchbot. Will take a look next week.

These don't seem like a big deal, at least as far as I can tell. If we have to fix them (that is, if the failures are due to using `OrderedDict` and we decide to keep using it), then please also make this change:

```diff
diff --git a/src/sage/categories/coxeter_groups.py b/src/sage/categories/coxeter_groups.py
index b7beca409b..c6037f6c42 100644
--- a/src/sage/categories/coxeter_groups.py
+++ b/src/sage/categories/coxeter_groups.py
@@ -1655,7 +1655,6 @@ class CoxeterGroups(Category_singleton):
                 sage: W = WeylGroup(["A", 3])
                 sage: s = W.simple_reflections()
                 sage: w0 = s[1]
-                sage: w1 = s[1]*s[2]*s[3]
                 sage: w0.absolute_covers()
                 [
                 [0 0 1 0]  [0 1 0 0]  [0 0 0 1]  [0 1 0 0]  [0 1 0 0]
```




---

archive/issue_comments_391726.json:
```json
{
    "body": "Replying to [comment:34 gh-mwageringel]:\n> I disagree with the recent changes. Using `OrderedDict` does not address the memory concerns that were brought up, as `OrderedDict` will internally store the insertion order in addition to the dictionary. Yet, as explained in comment:15, storing 1 set and 2 lists should usually be more memory efficient than storing 2 ordered dicts. It is faster than using `OrderedDict` too, especially in Python 2. So I would prefer to go back to the old branch.\n\nI don't have strong feelings either way, but I would very much like to get this resolved. Is the old branch good enough? You proposed some other explicit changes in comment:15, along with \"This solution should also be applied to the generic (non-graded) case.\"\n\nBy the way, is there a good way to test memory usage, say something analogous to `%timeit`?",
    "created_at": "2019-08-27T18:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391726",
    "user": "jhpalmieri"
}
```

Replying to [comment:34 gh-mwageringel]:
> I disagree with the recent changes. Using `OrderedDict` does not address the memory concerns that were brought up, as `OrderedDict` will internally store the insertion order in addition to the dictionary. Yet, as explained in comment:15, storing 1 set and 2 lists should usually be more memory efficient than storing 2 ordered dicts. It is faster than using `OrderedDict` too, especially in Python 2. So I would prefer to go back to the old branch.

I don't have strong feelings either way, but I would very much like to get this resolved. Is the old branch good enough? You proposed some other explicit changes in comment:15, along with "This solution should also be applied to the generic (non-graded) case."

By the way, is there a good way to test memory usage, say something analogous to `%timeit`?



---

archive/issue_comments_391727.json:
```json
{
    "body": "Replying to [comment:36 jhpalmieri]:\n> I don't have strong feelings either way, but I would very much like to get this resolved. Is the old branch good enough?\n\nNo \u2013 to be more precise, my criticism is just about commit `9c19a38` introducing the use of `OrderedDict`. All the other changes on the current branch look good to me and I will review them positively. The remaining doctest failures are not caused by `OrderedDict` specifically, but by the change in iteration order in general, so should still be fixed:\n\n```\nsage/categories/coxeter_groups.py\nsage/categories/finite_complex_reflection_groups.py\n```\n\n\n> You proposed some other explicit changes in comment:15, along with \"This solution should also be applied to the generic (non-graded) case.\"\n\nYes, I still think those changes would be useful, but since this ticket is primarily concerned with making the tests pass with Python 3, let us keep those changes for a follow-up ticket. Changing the non-graded case would probably entail new doctest failures.\n\n> By the way, is there a good way to test memory usage, say something analogous to `%timeit`?\n\nNot that I know of. You can use `sys.getsizeof()` to get the (shallow) size in bytes of an object, but it only works for types that implement `__sizeof__` (built-in types do so).",
    "created_at": "2019-08-28T18:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391727",
    "user": "@mwageringel"
}
```

Replying to [comment:36 jhpalmieri]:
> I don't have strong feelings either way, but I would very much like to get this resolved. Is the old branch good enough?

No – to be more precise, my criticism is just about commit `9c19a38` introducing the use of `OrderedDict`. All the other changes on the current branch look good to me and I will review them positively. The remaining doctest failures are not caused by `OrderedDict` specifically, but by the change in iteration order in general, so should still be fixed:

```
sage/categories/coxeter_groups.py
sage/categories/finite_complex_reflection_groups.py
```


> You proposed some other explicit changes in comment:15, along with "This solution should also be applied to the generic (non-graded) case."

Yes, I still think those changes would be useful, but since this ticket is primarily concerned with making the tests pass with Python 3, let us keep those changes for a follow-up ticket. Changing the non-graded case would probably entail new doctest failures.

> By the way, is there a good way to test memory usage, say something analogous to `%timeit`?

Not that I know of. You can use `sys.getsizeof()` to get the (shallow) size in bytes of an object, but it only works for types that implement `__sizeof__` (built-in types do so).



---

archive/issue_comments_391728.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-08-29T08:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391728",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_391729.json:
```json
{
    "body": "Just forced push my branch after removing commit \u200b9c19a38 but keeping \u200bcommit 22c2c91 whose hash is now \u200b870441e. Needs review.",
    "created_at": "2019-08-29T08:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391729",
    "user": "slabbe"
}
```

Just forced push my branch after removing commit ​9c19a38 but keeping ​commit 22c2c91 whose hash is now ​870441e. Needs review.



---

archive/issue_comments_391730.json:
```json
{
    "body": "Here are fixes for the doctests in `categories`.\n----\nNew commits:",
    "created_at": "2019-08-29T16:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391730",
    "user": "jhpalmieri"
}
```

Here are fixes for the doctests in `categories`.
----
New commits:



---

archive/issue_comments_391731.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-08-29T21:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391731",
    "user": "@mwageringel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_391732.json:
```json
{
    "body": "Thank you all. Everything looks good to me and all the relevant tests pass with both Python 2 and 3 on my end. I am setting this to positive, Vincent, assuming you agree.\n\nI am not sure what the stopgap ticket is about, though, or what needs to be done with it.",
    "created_at": "2019-08-29T21:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391732",
    "user": "@mwageringel"
}
```

Thank you all. Everything looks good to me and all the relevant tests pass with both Python 2 and 3 on my end. I am setting this to positive, Vincent, assuming you agree.

I am not sure what the stopgap ticket is about, though, or what needs to be done with it.



---

archive/issue_comments_391733.json:
```json
{
    "body": "The stopgap can be closed. It was in case this ticket didn't get resolved soon: just fixes to Python 3 doctests with no changes to the code.",
    "created_at": "2019-08-29T21:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391733",
    "user": "jhpalmieri"
}
```

The stopgap can be closed. It was in case this ticket didn't get resolved soon: just fixes to Python 3 doctests with no changes to the code.



---

archive/issue_comments_391734.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-09-05T21:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391734",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_391735.json:
```json
{
    "body": "Follow-up ticket: #28674.",
    "created_at": "2019-10-29T23:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27730",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27730#issuecomment-391735",
    "user": "@mwageringel"
}
```

Follow-up ticket: #28674.
