# Issue 27327: Implement algorithms for tree specifically which have better time complexity than general graph

archive/issues_027327.json:
```json
{
    "body": "CC:  dcoudert\n\nCurrently, finding diameter and center of tree,etc. is only possible using method implemented for general graphs(having way higher time complexity than the ones which are specifically for trees). \\\\\nI am proposing to implement a class for tree and implement tree specific algorithms there. And whenever we encounter a graph which is tree and there is some better algorithm to compute the asked property for tree than general graph, we convert that graph into instance of Tree and call the relevant algorithm.\\\\\nThere are a large number of algorithms for tree which have significantly less time complexity than algorithms for general graph. So, this can benefit a lot.\\\\\nIf the idea is agreed upon, I will be happy to send a diff.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27564\n\n",
    "created_at": "2019-03-29T07:12:22Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Implement algorithms for tree specifically which have better time complexity than general graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27327",
    "user": "@abhayptp"
}
```
CC:  dcoudert

Currently, finding diameter and center of tree,etc. is only possible using method implemented for general graphs(having way higher time complexity than the ones which are specifically for trees). \\
I am proposing to implement a class for tree and implement tree specific algorithms there. And whenever we encounter a graph which is tree and there is some better algorithm to compute the asked property for tree than general graph, we convert that graph into instance of Tree and call the relevant algorithm.\\
There are a large number of algorithms for tree which have significantly less time complexity than algorithms for general graph. So, this can benefit a lot.\\
If the idea is agreed upon, I will be happy to send a diff.

Issue created by migration from https://trac.sagemath.org/ticket/27564





---

archive/issue_comments_385229.json:
```json
{
    "body": "You propose to make a class Tree with a specific backend like we have for bipartite graphs, or just to implement a collection of algorithms optimized for trees ?",
    "created_at": "2019-03-29T08:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385229",
    "user": "dcoudert"
}
```

You propose to make a class Tree with a specific backend like we have for bipartite graphs, or just to implement a collection of algorithms optimized for trees ?



---

archive/issue_comments_385230.json:
```json
{
    "body": "Till now, I was only thinking to implement a collection of algorithms optimized for tree at one place to prevent code clutter in the current algorithms. I can not think right now how having a specific backend for trees will prove to be helpful because data structure of Tree is same as Graph unlike Bipartite graph.",
    "created_at": "2019-03-29T08:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385230",
    "user": "@abhayptp"
}
```

Till now, I was only thinking to implement a collection of algorithms optimized for tree at one place to prevent code clutter in the current algorithms. I can not think right now how having a specific backend for trees will prove to be helpful because data structure of Tree is same as Graph unlike Bipartite graph.



---

archive/issue_comments_385231.json:
```json
{
    "body": "For example, another possible use case I can think of is this:\\\\\nFinding if two trees are isomorphic is possible in O(V) time, which is way better than general algorithm for graph isomorphism(no polynomial time solution for graph isomorphism yet found).\\\\\nReference:\\\\\n[http://wwwmayr.in.tum.de/konferenzen/Jass08/courses/1/smal/Smal_Paper.pdf](http://wwwmayr.in.tum.de/konferenzen/Jass08/courses/1/smal/Smal_Paper.pdf)\\\\\nBut implementing this algorithm in is_isomorphic() function will introduce lot of code clutter.",
    "created_at": "2019-03-29T08:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385231",
    "user": "@abhayptp"
}
```

For example, another possible use case I can think of is this:\\
Finding if two trees are isomorphic is possible in O(V) time, which is way better than general algorithm for graph isomorphism(no polynomial time solution for graph isomorphism yet found).\\
Reference:\\
[http://wwwmayr.in.tum.de/konferenzen/Jass08/courses/1/smal/Smal_Paper.pdf](http://wwwmayr.in.tum.de/konferenzen/Jass08/courses/1/smal/Smal_Paper.pdf)\\
But implementing this algorithm in is_isomorphic() function will introduce lot of code clutter.



---

archive/issue_comments_385232.json:
```json
{
    "body": "I think that the tree needs to be rooted for checking the isomorphism in O(V) time. But in graph module rooted trees are not defined. But I think in combinat module rooted trees are defined.",
    "created_at": "2019-03-29T11:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385232",
    "user": "@rajat1433"
}
```

I think that the tree needs to be rooted for checking the isomorphism in O(V) time. But in graph module rooted trees are not defined. But I think in combinat module rooted trees are defined.



---

archive/issue_comments_385233.json:
```json
{
    "body": "I do not recommend to use the rooted trees of combinat here. If you need a root, you can for instance find the center of the tree in linear time.",
    "created_at": "2019-03-29T11:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385233",
    "user": "dcoudert"
}
```

I do not recommend to use the rooted trees of combinat here. If you need a root, you can for instance find the center of the tree in linear time.



---

archive/issue_comments_385234.json:
```json
{
    "body": "Yes, the paper describes the same trick for checking isomorphism for unrooted trees.\\\\\nWe do not need to define a separate class for tree I think. Just a separate file will suffice which will contain all the tree related algorithms. `@`dcoudert opinions?",
    "created_at": "2019-03-29T11:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385234",
    "user": "@abhayptp"
}
```

Yes, the paper describes the same trick for checking isomorphism for unrooted trees.\\
We do not need to define a separate class for tree I think. Just a separate file will suffice which will contain all the tree related algorithms. `@`dcoudert opinions?



---

archive/issue_comments_385235.json:
```json
{
    "body": "Feel free to initialize.",
    "created_at": "2019-03-30T08:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385235",
    "user": "dcoudert"
}
```

Feel free to initialize.



---

archive/issue_comments_385236.json:
```json
{
    "body": "Tests and documentation is yet to be added and some changes are yet to be done. I will update status to 'Needs review' once it's done.\n----\nNew commits:",
    "created_at": "2019-04-01T15:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385236",
    "user": "@abhayptp"
}
```

Tests and documentation is yet to be added and some changes are yet to be done. I will update status to 'Needs review' once it's done.
----
New commits:



---

archive/issue_comments_385237.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-03T16:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385237",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385238.json:
```json
{
    "body": "Added documentation and examples. I have included tree_isomorphism in is_isomorphic function. So, whenever G.is_isomorphic(H) is called and G and H are trees(and edge labels is false), isomorphism is checked using tree_isomorphism function. \\\\ \n\nI have tested the function by writing a script of generating some small random trees and comparing the output of tree_isomorphism and is_isomorphic. If anyone has a better idea, please suggest.\n\nedge_labels=True case can also be handled using tree_isomorphism I think. I will send another diff once I implement it. \\\\ \\\\\n \nI am not sure, if I should include tree_diameter() in diameter() functions, since currently it works on only unweighted trees. Same for tree_center.",
    "created_at": "2019-04-03T16:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385238",
    "user": "@abhayptp"
}
```

Added documentation and examples. I have included tree_isomorphism in is_isomorphic function. So, whenever G.is_isomorphic(H) is called and G and H are trees(and edge labels is false), isomorphism is checked using tree_isomorphism function. \\ 

I have tested the function by writing a script of generating some small random trees and comparing the output of tree_isomorphism and is_isomorphic. If anyone has a better idea, please suggest.

edge_labels=True case can also be handled using tree_isomorphism I think. I will send another diff once I implement it. \\ \\
 
I am not sure, if I should include tree_diameter() in diameter() functions, since currently it works on only unweighted trees. Same for tree_center.



---

archive/issue_comments_385239.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-03T16:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385239",
    "user": "@abhayptp"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_385240.json:
```json
{
    "body": "\n```diff\n-        if self.is_tree() and other.is_tree() and not edge_labels:\n+        if not edge_labels and self.is_tree() and other.is_tree():\n```\n\n\n\nMethod `tree_diameter`\n- some code style improvements needed like\n\n```diff\n-    Returns diameter of unweighted tree.\n-    Input:\n+    Return the diameter of the unweighted tree.\n+\n+    INPUT:\n```\n\n\n```diff\n-    - ``endpoints`` -- boolean(default: ``False``); whether to return\n-    enpoints of diameter or not\n+    - ``endpoints`` -- boolean (default: ``False``); whether to return\n+      enpoints of diameter or not\n```\n\n\n- it would be nice to document the algorithm used here ( a few sentences)\n\n- this will break if `G` is empty: `u = next(G.vertex_iterator())`\n- and also if the input graph is not a tree, is not connected, etc.\n\n- instead of `shortest_path_lengths`, you must use `G.breadth_first_search(u, report_distance=True)`. You will then observe that the last reported distance is also the largest one.\n\n- Why are you only considering unweighted graphs ?",
    "created_at": "2019-04-04T08:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385240",
    "user": "dcoudert"
}
```


```diff
-        if self.is_tree() and other.is_tree() and not edge_labels:
+        if not edge_labels and self.is_tree() and other.is_tree():
```



Method `tree_diameter`
- some code style improvements needed like

```diff
-    Returns diameter of unweighted tree.
-    Input:
+    Return the diameter of the unweighted tree.
+
+    INPUT:
```


```diff
-    - ``endpoints`` -- boolean(default: ``False``); whether to return
-    enpoints of diameter or not
+    - ``endpoints`` -- boolean (default: ``False``); whether to return
+      enpoints of diameter or not
```


- it would be nice to document the algorithm used here ( a few sentences)

- this will break if `G` is empty: `u = next(G.vertex_iterator())`
- and also if the input graph is not a tree, is not connected, etc.

- instead of `shortest_path_lengths`, you must use `G.breadth_first_search(u, report_distance=True)`. You will then observe that the last reported distance is also the largest one.

- Why are you only considering unweighted graphs ?



---

archive/issue_comments_385241.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-05T19:30:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385241",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-05T19:33:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385242",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_385243.json:
```json
{
    "body": ">some code style improvements needed like\ndone\n>it would be nice to document the algorithm used here ( a few sentences)\ndone\n>this will break if G is empty: u = next(G.vertex_iterator()) and also if the input graph is not a tree, is not connected, etc.\nupdated.\n>instead of shortest_path_lengths, you must use G.breadth_first_search(u, report_distance=True). You will then observe that the last reported distance is also the largest one.\nNow, I have also added the compatibility for weighted trees. To avoid redundant code for finding shortest paths, I am using Dijkstra algorithm(so, using shortest_path_lengths). I know we can find it in linear time. But I don't think using dijkstra algorithm will affect performance that much. Or shall I write function for finding shortest_path_lenghts in trees?\n>Why are you only considering unweighted graphs ?\nNow, it is compatible for weighted graphs. But the given algorithm works only for non-negative weights for diameter. In case of center, positive weights since including 0 weight will imply that centers can lie on vertex other than diameter. \\\\",
    "created_at": "2019-04-05T19:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385243",
    "user": "@abhayptp"
}
```

>some code style improvements needed like
done
>it would be nice to document the algorithm used here ( a few sentences)
done
>this will break if G is empty: u = next(G.vertex_iterator()) and also if the input graph is not a tree, is not connected, etc.
updated.
>instead of shortest_path_lengths, you must use G.breadth_first_search(u, report_distance=True). You will then observe that the last reported distance is also the largest one.
Now, I have also added the compatibility for weighted trees. To avoid redundant code for finding shortest paths, I am using Dijkstra algorithm(so, using shortest_path_lengths). I know we can find it in linear time. But I don't think using dijkstra algorithm will affect performance that much. Or shall I write function for finding shortest_path_lenghts in trees?
>Why are you only considering unweighted graphs ?
Now, it is compatible for weighted graphs. But the given algorithm works only for non-negative weights for diameter. In case of center, positive weights since including 0 weight will imply that centers can lie on vertex other than diameter. \\



---

archive/issue_comments_385244.json:
```json
{
    "body": "Now, I see that diameter and center can also be found out for negative weighted trees using a different approach.",
    "created_at": "2019-04-05T19:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385244",
    "user": "@abhayptp"
}
```

Now, I see that diameter and center can also be found out for negative weighted trees using a different approach.



---

archive/issue_comments_385245.json:
```json
{
    "body": "Replying to [comment:16 gh-abhayptp]:\n> >some code style improvements needed like\n> done\nYou should check the developer manual http://doc.sagemath.org/html/en/developer/ and in particular http://doc.sagemath.org/html/en/developer/coding_basics.html\n\nWhen we define a method, we have first a short (1 line) description of what the method returns. Then, separated by an empty line, we have a longer description, the input block, etc.\n\n\n```\ndef tree_diameter(T, endpoints=False, path=False, by_weight=False):\n    r\"\"\"\n    Return the diameter of the tree `T`.\n\n    This method use 2-sweep to compute the diameter of the tree `T`. That is,\n    it first chooses some random vertex `x` and finds the most distant vertex\n    `u` from `x`. The diameter of `T` is the largest distance from `u`.\n\n    It works only on non-negative weighted trees.\n\n    INPUT:\n\n    - ``T`` -- a Graph\n```\n\n\n- Note that I use `r\"\"\"` instead of `\"\"\"` to indicate the use of latex. Indeed, you can ut latex code like ``G`` or ``\\sqrt{x^2 + 1}``.\n\n- when an input is described on multiple lines, you must add 2 spaces\n\n```diff\n-    - ``endpoints`` -- boolean (default: ``False``); whether to return\n-    enpoints of diameter or not\n+    - ``endpoints`` -- boolean (default: ``False``); whether to return\n+      enpoints of diameter or not\n```\n\n\n\n- Concerning the usage of weights, you can for instance check the documentation of method `shortest_path`. We usually allow to pass a `weight_function`.\n\n- You can simplify you code as follows\n\n```diff\n+    if by_weight:\n+        from operator import itemgetter\n+        path_lengths = G.shortest_path_lengths(x, algorithm='Dijkstra_Boost', by_weight=True)\n+        u = max(path_lengths.items(), key=itemgetter(1))[0]\n+        path_lengths = G.shortest_path_lengths(u, algorithm='Dijkstra_Boost', by_weight=True)\n+        (v, dist) = max(path_lengths.items(), key=itemgetter(1))\n+    else:\n+        for u in G.breadth_first_search(x):\n+            pass\n+        for v, dist in G.breadth_first_search(u, report_distance=True):\n+            pass\n```\n\n\n- Note that it's better to use `.items()` instead of `.iteritems()` for Python 3 compatibility\n\nI let you do the same for the other methods.",
    "created_at": "2019-04-06T16:37:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385245",
    "user": "dcoudert"
}
```

Replying to [comment:16 gh-abhayptp]:
> >some code style improvements needed like
> done
You should check the developer manual http://doc.sagemath.org/html/en/developer/ and in particular http://doc.sagemath.org/html/en/developer/coding_basics.html

When we define a method, we have first a short (1 line) description of what the method returns. Then, separated by an empty line, we have a longer description, the input block, etc.


```
def tree_diameter(T, endpoints=False, path=False, by_weight=False):
    r"""
    Return the diameter of the tree `T`.

    This method use 2-sweep to compute the diameter of the tree `T`. That is,
    it first chooses some random vertex `x` and finds the most distant vertex
    `u` from `x`. The diameter of `T` is the largest distance from `u`.

    It works only on non-negative weighted trees.

    INPUT:

    - ``T`` -- a Graph
```


- Note that I use `r"""` instead of `"""` to indicate the use of latex. Indeed, you can ut latex code like ``G`` or ``\sqrt{x^2 + 1}``.

- when an input is described on multiple lines, you must add 2 spaces

```diff
-    - ``endpoints`` -- boolean (default: ``False``); whether to return
-    enpoints of diameter or not
+    - ``endpoints`` -- boolean (default: ``False``); whether to return
+      enpoints of diameter or not
```



- Concerning the usage of weights, you can for instance check the documentation of method `shortest_path`. We usually allow to pass a `weight_function`.

- You can simplify you code as follows

```diff
+    if by_weight:
+        from operator import itemgetter
+        path_lengths = G.shortest_path_lengths(x, algorithm='Dijkstra_Boost', by_weight=True)
+        u = max(path_lengths.items(), key=itemgetter(1))[0]
+        path_lengths = G.shortest_path_lengths(u, algorithm='Dijkstra_Boost', by_weight=True)
+        (v, dist) = max(path_lengths.items(), key=itemgetter(1))
+    else:
+        for u in G.breadth_first_search(x):
+            pass
+        for v, dist in G.breadth_first_search(u, report_distance=True):
+            pass
```


- Note that it's better to use `.items()` instead of `.iteritems()` for Python 3 compatibility

I let you do the same for the other methods.



---

archive/issue_comments_385246.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385246",
    "user": "embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_385247.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385247",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_385248.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385248",
    "user": "mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_385249.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-20T07:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385249",
    "user": "dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_385250.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385250",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_385251.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27327",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27327#issuecomment-385251",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
