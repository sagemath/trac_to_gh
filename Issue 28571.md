# Issue 28571: failing internet and imagemagick doctests because argument must be str, not bytes

Issue created by migration from https://trac.sagemath.org/ticket/28808

Original creator: slabbe

Original creation time: 2019-11-27 15:13:44

CC:  tscrim embray


```
sage -t --optional=sage,optional,external src/sage/repl/load.py src/sage/misc/latex.py src/sage/plot/animate.py
```


gives


```
----------------------------------------------------------------------
sage -t src/sage/repl/load.py  # 1 doctest failed
sage -t src/sage/misc/latex.py  # 1 doctest failed
sage -t src/sage/plot/animate.py  # 7 doctests failed
----------------------------------------------------------------------
External software detected for doctesting: imagemagick,internet,latex
```


with errors of that kind:


```
sage -t src/sage/repl/load.py
**********************************************************************
File "src/sage/repl/load.py", line 157, in sage.repl.load.load
Failed example:
    sage.repl.load.load('https://github.com/jasongrout/minimum_rank/raw/minimum_rank_1_0_0/minrank.py', globals())  # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.load.load[16]>", line 1, in <module>
        sage.repl.load.load('https://github.com/jasongrout/minimum_rank/raw/minimum_rank_1_0_0/minrank.py', globals())  # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/repl/load.py", line 235, in load
        filename = get_remote_file(filename, verbose=False)
      File "/home/slabbe/GitBox/sage/local/lib/python3.7/site-packages/sage/misc/remote_file.py", line 49, in get_remote_file
        f.write(content.read())
    TypeError: write() argument must be str, not bytes
**********************************************************************
```



---

Comment by slabbe created at 2019-12-10 08:48:24

spliting this ticket:

- failures with plot/animate.py are now in #28868
- failures with 1 imagemagick failing doctest in misc/latex.py is now in #28867


---

Comment by chapoton created at 2019-12-11 07:25:27

see https://github.com/jasongrout/minimum_rank/pull/5


---

Comment by chapoton created at 2019-12-12 14:58:19

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-12-12 14:58:19

I have changed the example, using the sage patchbot instead.
----
New commits:


---

Comment by tscrim created at 2019-12-12 20:42:10

LGTM.


---

Comment by tscrim created at 2019-12-12 20:42:10

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-12-17 22:46:36

Resolution: fixed


---

Comment by slabbe created at 2020-01-20 08:22:19

The link `https://raw.githubusercontent.com/sagemath/sage-patchbot/2.8.4/sage_patchbot/util.py` added in this ticket is currently broken. See #29047


---

Comment by chapoton created at 2020-01-20 08:24:04

Erik, could you please fix that ?


---

Comment by chapoton created at 2020-01-20 16:26:25

ok, fixed in #29047
