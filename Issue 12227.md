# Issue 12227: Get pycrypto to build on FreeBSD

archive/issues_012227.json:
```json
{
    "body": "Assignee: @peterjeremy\n\nCC:  @peterjeremy jpflori\n\nStephen Montgomery-Smith reports:\n\n```\nOK, I started working on building sage.  So far I can get all the spkg's to build except:\n\ngap-4.4.12.p6\npycrypto-2.1.0\nsingular-3-1-3-3.p3\nmaxima-5.23.2.p3\nsage-4.8\n\nThe build problem with pycrypto-2.1.0 and singular-3-1-3-3.p3 are easy to fix.  \n```\nThe patch is apparently\n\n```\n\n--- pycrypto-2.1.0/src/src/libtom/tomcrypt_pk.h-orig\t2012-01-21 19:43:56.000000000 +0000\n+++ pycrypto-2.1.0/src/src/libtom/tomcrypt_pk.h\t2012-01-21 19:45:01.000000000 +0000\n@@ -496,7 +496,7 @@\n int der_printable_value_decode(int v);\n \n /* UTF-8 */\n-#if (defined(SIZE_MAX) || __STDC_VERSION__ >= 199901L || defined(WCHAR_MAX) || defined(_WCHAR_T) || defined(_WCHAR_T_DEFINED)) && !defined(LTC_NO_WCHAR)\n+#if (defined(SIZE_MAX) || __STDC_VERSION__ >= 199901L || defined(WCHAR_MAX) || defined(_WCHAR_T) || defined(_WCHAR_T_DEFINED) || defined(_GCC_WCHAR_T)) && !defined(LTC_NO_WCHAR)\n #include <wchar.h>\n #else\n typedef ulong32 wchar_t;\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/12399\n\n",
    "created_at": "2012-01-31T02:13:28Z",
    "labels": [
        "component: porting: bsd",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "Get pycrypto to build on FreeBSD",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12227",
    "user": "https://github.com/kcrisman"
}
```
Assignee: @peterjeremy

CC:  @peterjeremy jpflori

Stephen Montgomery-Smith reports:

```
OK, I started working on building sage.  So far I can get all the spkg's to build except:

gap-4.4.12.p6
pycrypto-2.1.0
singular-3-1-3-3.p3
maxima-5.23.2.p3
sage-4.8

The build problem with pycrypto-2.1.0 and singular-3-1-3-3.p3 are easy to fix.  
```
The patch is apparently

```

--- pycrypto-2.1.0/src/src/libtom/tomcrypt_pk.h-orig	2012-01-21 19:43:56.000000000 +0000
+++ pycrypto-2.1.0/src/src/libtom/tomcrypt_pk.h	2012-01-21 19:45:01.000000000 +0000
@@ -496,7 +496,7 @@
 int der_printable_value_decode(int v);
 
 /* UTF-8 */
-#if (defined(SIZE_MAX) || __STDC_VERSION__ >= 199901L || defined(WCHAR_MAX) || defined(_WCHAR_T) || defined(_WCHAR_T_DEFINED)) && !defined(LTC_NO_WCHAR)
+#if (defined(SIZE_MAX) || __STDC_VERSION__ >= 199901L || defined(WCHAR_MAX) || defined(_WCHAR_T) || defined(_WCHAR_T_DEFINED) || defined(_GCC_WCHAR_T)) && !defined(LTC_NO_WCHAR)
 #include <wchar.h>
 #else
 typedef ulong32 wchar_t;
```

Issue created by migration from https://trac.sagemath.org/ticket/12399





---

archive/issue_comments_142524.json:
```json
{
    "body": "I can confirm that this ticket is still required for building sage with FreeBSD.  It should be harmless to all other OS builds.\n\nAdd a new file patches/src.libtom.tomcrypt_pk.h (you will have to add the patches directory as well)\n\n```\n--- src/src/libtom/tomcrypt_pk.h-orig\t2012-01-21 19:43:56.000000000 +0000\n+++ src/src/libtom/tomcrypt_pk.h\t2012-01-21 19:45:01.000000000 +0000\n@@ -496,7 +496,7 @@\n int der_printable_value_decode(int v);\n \n /* UTF-8 */\n-#if (defined(SIZE_MAX) || __STDC_VERSION__ >= 199901L || defined(WCHAR_MAX) || defined(_WCHAR_T) || defined(_WCHAR_T_DEFINED)) && !defined(LTC_NO_WCHAR)\n+#if (defined(SIZE_MAX) || __STDC_VERSION__ >= 199901L || defined(WCHAR_MAX) || defined(_WCHAR_T) || defined(_WCHAR_T_DEFINED) || defined(_GCC_WCHAR_T)) && !defined(LTC_NO_WCHAR)\n #include <wchar.h>\n #else\n typedef ulong32 wchar_t;\n```\n\nand patch spkg-install as follows:\n\n```\n--- pycrypto-2.1.0/spkg-install-orig\t2012-04-08 01:30:47.000000000 +0000\n+++ pycrypto-2.1.0/spkg-install\t2012-04-08 01:31:41.000000000 +0000\n@@ -12,6 +12,8 @@\n     LDFLAGS=\"-m64 \"; export LDFLAGS\n fi\n \n+patch -p0 < patches/src.libtom.tomcrypt_pk.h\n+\n CFLAGS=\"-I$SAGE_LOCAL/include -L$SAGE_LOCAL/lib $CFLAGS\"\n export CFLAGS\n \n```",
    "created_at": "2012-04-08T14:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142524",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

I can confirm that this ticket is still required for building sage with FreeBSD.  It should be harmless to all other OS builds.

Add a new file patches/src.libtom.tomcrypt_pk.h (you will have to add the patches directory as well)

```
--- src/src/libtom/tomcrypt_pk.h-orig	2012-01-21 19:43:56.000000000 +0000
+++ src/src/libtom/tomcrypt_pk.h	2012-01-21 19:45:01.000000000 +0000
@@ -496,7 +496,7 @@
 int der_printable_value_decode(int v);
 
 /* UTF-8 */
-#if (defined(SIZE_MAX) || __STDC_VERSION__ >= 199901L || defined(WCHAR_MAX) || defined(_WCHAR_T) || defined(_WCHAR_T_DEFINED)) && !defined(LTC_NO_WCHAR)
+#if (defined(SIZE_MAX) || __STDC_VERSION__ >= 199901L || defined(WCHAR_MAX) || defined(_WCHAR_T) || defined(_WCHAR_T_DEFINED) || defined(_GCC_WCHAR_T)) && !defined(LTC_NO_WCHAR)
 #include <wchar.h>
 #else
 typedef ulong32 wchar_t;
```

and patch spkg-install as follows:

```
--- pycrypto-2.1.0/spkg-install-orig	2012-04-08 01:30:47.000000000 +0000
+++ pycrypto-2.1.0/spkg-install	2012-04-08 01:31:41.000000000 +0000
@@ -12,6 +12,8 @@
     LDFLAGS="-m64 "; export LDFLAGS
 fi
 
+patch -p0 < patches/src.libtom.tomcrypt_pk.h
+
 CFLAGS="-I$SAGE_LOCAL/include -L$SAGE_LOCAL/lib $CFLAGS"
 export CFLAGS
 
```



---

archive/issue_comments_142525.json:
```json
{
    "body": "I erased this comment and the following comment as they were wrong.",
    "created_at": "2012-04-14T03:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142525",
    "user": "https://trac.sagemath.org/admin/accounts/users/stephen"
}
```

I erased this comment and the following comment as they were wrong.



---

archive/issue_comments_142526.json:
```json
{
    "body": "All that's needed here is a new spkg with an spkg-install that checks whether the patch was applied correctly.",
    "created_at": "2012-06-20T19:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142526",
    "user": "https://github.com/kcrisman"
}
```

All that's needed here is a new spkg with an spkg-install that checks whether the patch was applied correctly.



---

archive/issue_comments_142527.json:
```json
{
    "body": "The fix is still needed and let pycrypto build on FreeBSD 9.0 x86.\nI'll package a spkg this weekend.",
    "created_at": "2013-04-05T11:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142527",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The fix is still needed and let pycrypto build on FreeBSD 9.0 x86.
I'll package a spkg this weekend.



---

archive/issue_comments_142528.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-07-04T20:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142528",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_142529.json:
```json
{
    "body": "The week-end was kind of long.\nUploaded a simple spkg.\n\nFollow up ticket to upgrade pycrypto at #14854.\nNote the patch should still be needed.\nThe patched file did not change.\nTime for an upstream bug report I guess.",
    "created_at": "2013-07-04T20:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142529",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

The week-end was kind of long.
Uploaded a simple spkg.

Follow up ticket to upgrade pycrypto at #14854.
Note the patch should still be needed.
The patched file did not change.
Time for an upstream bug report I guess.



---

archive/issue_comments_142530.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg pycrypto\".",
    "created_at": "2013-07-04T20:53:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142530",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Changing keywords from "" to "spkg pycrypto".



---

archive/issue_comments_142531.json:
```json
{
    "body": "Attachment [pycrypto-2.1.0.p0.diff](tarball://root/attachments/some-uuid/ticket12399/pycrypto-2.1.0.p0.diff) by jpflori created at 2013-07-04 21:10:13\n\nSpkg diff, for review only.",
    "created_at": "2013-07-04T21:10:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142531",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Attachment [pycrypto-2.1.0.p0.diff](tarball://root/attachments/some-uuid/ticket12399/pycrypto-2.1.0.p0.diff) by jpflori created at 2013-07-04 21:10:13

Spkg diff, for review only.



---

archive/issue_events_033243.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12227#event-33243"
}
```



---

archive/issue_comments_142532.json:
```json
{
    "body": "I've made a git branch and reported upstream at:\n* https://bugs.launchpad.net/pycrypto/+bug/1264130",
    "created_at": "2013-12-25T16:32:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142532",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I've made a git branch and reported upstream at:
* https://bugs.launchpad.net/pycrypto/+bug/1264130



---

archive/issue_comments_142533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-25T16:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142533",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_142534.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-26T14:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12227#issuecomment-142534",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_033244.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-12-26T14:49:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/12227",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/12227#event-33244"
}
```
