# Issue 28670: remove the method MathematicaElement.N()

Issue created by migration from https://trac.sagemath.org/ticket/28907

Original creator: @mwageringel

Original creation time: 2019-12-22 20:14:27

CC:  dimpase mkoeppe

Keywords: mathematica

Currently, the method `MathematicaElement.N()` returns a string [#point2 (2)], which is not useful for further computations. It also contradicts the convention of interface elements that `mathematica(1/3).N()` is a more pythonic syntax for `mathematica.N(mathematica(1/3))`, as is the case for all the dynamically added methods in interfaces. So for consistencey, the method `N()` should return a `MathematicaElement` instead of a string.

This ticket removes the method altogether, for simplicity, as it is not needed anymore [#point1 (1)]. Now a call to `mathematica(1/3).N()` dynamically redirects to Mathematica's `N[]` function and returns a `MathematicaElement` as expected.

------

This change also reveaved an issue with serialization of Mathematica elements, which is also fixed by this ticket (see `_reduce()`). The corresponding doctest was actually just serializing a string. This is now fixed:

```
sage: a = mathematica('N[Pi/2,50]')
sage: loads(dumps(a)) == a            # should be True
...
TypeError: Error executing code in Mathematica
CODE:
	sage8=
1.5707963267948966192313216916397514420985846996875529104874722961539082059438`50.;
Mathematica ERROR:
```


------

More details:

[=#point1 (1)] In the past, Sage's object hierarchy used to define a method `N()`, so it had to be overwritten in the interface, but that is no longer the case.

[=#point2 (2)] The return type was changed to string in #18888 as a workaround to an apparent bug in Mathematica itself. This bug does not seem to exist anymore in Mathematica 12, so the workaround is not needed anymore. Indeed, in the following computation, the decimal representation gets correctly truncated after 10 digits

```
Mathematica 12.0.0 Kernel for Linux x86 (64-bit)
Copyright 1988-2019 Wolfram Research, Inc.

In[1]:= x2=N[Pi,10]
Out[1]= 3.141592654
In[2]:= InputForm[x2,NumberMarks->False]
Out[2]//InputForm= 3.1415926536
```

whereas, in [ticket:18888#comment:20] with Mathematica 10.0, the same computation did not truncate the output

```
In[4]:= InputForm[x2,NumberMarks->False]
Out[4]//InputForm= 3.14159265358979323846264338327950419993
```




---

Comment by @mwageringel created at 2019-12-22 20:27:55

New commits:


---

Comment by @mwageringel created at 2019-12-22 20:27:55

Changing status from new to needs_review.


---

Comment by dimpase created at 2019-12-23 04:02:19

Shouldn't there be a deprecation period set up, before removal?


---

Comment by @mwageringel created at 2019-12-23 09:34:23

It is difficult to deprecate this, as the method does not change name, but effectively just changes the return type. However, the string that is currently returned by this method cannot be used to compute anything else in a meaningful way, so it is unlikely that any existing code depends on the return type being a string.


---

Comment by dimpase created at 2020-01-08 18:01:24

seems that I don't have access to Mathematica any more, so I can't test :-(


---

Comment by dimpase created at 2020-01-09 11:06:03

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-01-09 11:06:03

OK, got mathematica reinstalled on my desktop, all is good with this branch, thanks!


---

Comment by @mwageringel created at 2020-01-09 18:28:45

Thank you.


---

Comment by vbraun created at 2020-01-11 17:45:01

Resolution: fixed
