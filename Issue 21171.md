# Issue 21171: Bug in FreeQuadraticModule.discriminant()

Issue created by migration from https://trac.sagemath.org/ticket/21408

Original creator: sbrandhorst

Original creation time: 2016-09-03 09:18:10

Keywords: discriminant, FreeQuadraticModule


```
sage: q=FreeQuadraticModule(ZZ,2,inner_product_matrix=1)
sage: q
Ambient free quadratic module of rank 2 over the principal ideal domain Integer Ring
Inner product matrix:
[1 0]
[0 1]
sage: q.determinant()
1
sage: q.discriminant()
-2
```



This output is wrong. The discriminant should be -1.

The following is another related bug. I guess thats where the error of the first bug lies as well.



```
sage: q=FreeQuadraticModule(QQ,2,inner_product_matrix=1)
sage: q.determinant()
1
sage: q.discriminant()
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-204-22cd2398c8db> in <module>()
----> 1 q.discriminant()

/usr/lib/sagemath/local/lib/python2.7/site-packages/sage/modules/free_quadratic_module.pyc in discriminant(self)
    377         else:
    378             r = (n-1)//2
--> 379         return (-1)^r*self.gram_matrix().determinant()
    380
    381     def gram_matrix(self):

sage/structure/element.pyx in sage.structure.element.Element.__xor__ (/usr/lib/sagemath//src/build/cythonized/sage/structure/element.c:8229)()

RuntimeError: Use ** for exponentiation, not '^', which means xor
in Python, and has the wrong precedence.
```


This occurred on two different machines running sage 7.0 and 7.2 on Ubuntu 14.04.4 LTS and Fedora 24
(both x64).

This is my first ticket. Since it seems to be an easy fix, I will try to do that myself. 


---

Comment by chapoton created at 2016-09-03 12:36:04

Welcome! The next step is to set-up git and trac so that you can push branches here.

Some explanations are there:

https://github.com/sagemath/git-developer-guide/blob/master/developer/manual_git.rst

Please ask if you have any questions.


---

Comment by sbrandhorst created at 2016-09-03 15:50:30

Thank you.
Okay. I changed the code, did a commit and pushed it. What is next?


---

Comment by chapoton created at 2016-09-03 17:19:39

Next step is to find a reviewer. That will be me.

The correction of the code is ok. In the developer guide, it is explained that it is good to add a doctest that checks that previously bad answer is now correct.
Can you please add one (or two) such doctest in the documentation of the discriminant function ? Simply take the two examples in the description and make them doctests. Maybe in the TESTS:: section rather than in the EXAMPLES:: section.
To see what is the correct syntax for the doctest (which is written in ReST language), just have a look at other methods.


---

Comment by git created at 2016-09-04 14:50:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-09-04 14:54:03

Looks good. Please set the status of this ticket to "needs_review" by clicking on "modify ticket" then "needs review". (In fact, this should have been done before, to ask for review).


---

Comment by sbrandhorst created at 2016-09-04 14:57:05

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-09-04 14:59:28

Thanks. I am happy with your changes, so I set the status to positive review and I fill the reviewer field with my complete name.

Congratulations for your first ticket in sage.


---

Comment by chapoton created at 2016-09-04 14:59:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-09-04 22:07:43

Resolution: fixed


---

Comment by leif created at 2016-09-09 02:12:31

Next time post a link to the ticket you opened in (one of) the thread(s) on sage-devel... ;-)

And/or cc the people from the thread.

(I actually had the same fix lying around here, thought John C. would perhaps open a ticket, and just read in the "release notes" for beta4 it was already fixed; luckily, since I was about to open one myself.)

The mark-up in the docstrings of that file needs work as well, but that's (now) for another ticket.
