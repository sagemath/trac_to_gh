# Issue 22526: Assumptions on symbols not preserved with some unevaluated integrals

Issue created by migration from https://trac.sagemath.org/ticket/22763

Original creator: rws

Original creation time: 2017-04-05 14:14:29

CC:  nbruin

In a fresh Sage, assumptions on symbols within expressions are preserved when Maxima returns the same expression in an unevaluated integral. But in this case the domain/flag information of `m` is somehow cleared/deleted:

```
sage: _ = var('m')
sage: (x^m / sqrt(2+3*x)).integral(x)
integrate(x^m/sqrt(3*x + 2), x)
sage: _= var('m', domain='integer')
sage: (x^m / sqrt(2+3*x)).integral(x)
integrate(x^m/sqrt(3*x + 2), x)
sage: _.operands()[0].operands()[1]
x^m
sage: _.operands()[1].is_integer()
False
```

`assume(m, 'integer')` cannot restore the flag of `m` in the returned integral.

The problem does not occur without the first two lines.  Maybe the first creation of `m` does somehow irrevocably set something in Maxima (or Sage's module for backtranslation)?



---

Comment by rws created at 2017-04-05 14:22:08

#22650 depends on this.


---

Comment by rws created at 2017-04-06 07:31:30

It looks like `sage.interfaces.maxima_lib.sr_to_max` has several symbol dicts. `sage_sym_dict`'s keys are symbols and registered constants. At the first encounter of `(x^m / sqrt(2+3*x)).integral(x)` `m` is inserted there. The hash of the second `m` is the same, and presumably that's why there is no change in the dictionary. As the `m`s are different the hash should be different too and there is the Pynac bug that if fixed should fix this ticket too. Alternatively the dicts should be updated in `var` when variables are created.


---

Comment by rws created at 2017-04-06 15:32:25

Actually hashes have nothing to do with it. The vars are not the keys in the dictionary and, even if they were, hash makes no difference because keys are compared via `bool(a==b)`, ie `ex.__nonzero__()` is used and there lhs-rhs is zero even for vars with different flags or hashes.


---

Comment by rws created at 2017-04-07 07:59:44

New commits:


---

Comment by rws created at 2017-04-07 07:59:44

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-10-21 11:55:30

red branch => needs work


---

Comment by chapoton created at 2021-10-21 11:55:30

Changing status from needs_review to needs_work.
