# Issue 26696: Subsets_s should support unsortable sets

archive/issues_026696.json:
```json
{
    "body": "CC:  @fchapoton\n\nIt should not force sorting the set, which may be unsortable.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26933\n\n",
    "created_at": "2018-12-21T14:52:54Z",
    "labels": [
        "python3",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.7",
    "title": "Subsets_s should support unsortable sets",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26696",
    "user": "@jdemeyer"
}
```
CC:  @fchapoton

It should not force sorting the set, which may be unsortable.

Issue created by migration from https://trac.sagemath.org/ticket/26933





---

archive/issue_comments_375441.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-21T15:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375441",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_375442.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-12-21T15:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375442",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_375443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-01-01T10:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375443",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375444.json:
```json
{
    "body": "I wonder whether it is really worth the trouble (and performance hit) to keep the order of the ground set.\n\n```\nsage: S = [1, 8, -5, 3/2, 'a', x]\nsage: import random\nsage: L = [choice(S) for _ in range(10000)]\nsage: %timeit list(set(L))\n1000 loops, best of 3: 708 \u00b5s per loop\nsage: %timeit list(stable_uniq(L))\n1000 loops, best of 3: 1.4 ms per loop\n```\n\n\n(Currently, essentially all the time in `Subsets_s.__init__` is spent in `uniq`.)",
    "created_at": "2019-01-01T11:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375444",
    "user": "@mantepse"
}
```

I wonder whether it is really worth the trouble (and performance hit) to keep the order of the ground set.

```
sage: S = [1, 8, -5, 3/2, 'a', x]
sage: import random
sage: L = [choice(S) for _ in range(10000)]
sage: %timeit list(set(L))
1000 loops, best of 3: 708 Âµs per loop
sage: %timeit list(stable_uniq(L))
1000 loops, best of 3: 1.4 ms per loop
```


(Currently, essentially all the time in `Subsets_s.__init__` is spent in `uniq`.)



---

archive/issue_comments_375445.json:
```json
{
    "body": "It is not really fair to compare a builtin Python class `set` to a (pure) Python function. So the fact it is a 2x slowdown on a set that large is quite good IMO. It is a nice side-effect that the order of the groundset is preserved, but that looks like it is a facet of the (simple) implementation. This is also not the tool you should be using in a tight loop anyways, so I am not worried about the slowdown here. Thus I am giving this a positive review.",
    "created_at": "2019-01-01T17:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375445",
    "user": "@tscrim"
}
```

It is not really fair to compare a builtin Python class `set` to a (pure) Python function. So the fact it is a 2x slowdown on a set that large is quite good IMO. It is a nice side-effect that the order of the groundset is preserved, but that looks like it is a facet of the (simple) implementation. This is also not the tool you should be using in a tight loop anyways, so I am not worried about the slowdown here. Thus I am giving this a positive review.



---

archive/issue_comments_375446.json:
```json
{
    "body": "fine with me, too!",
    "created_at": "2019-01-01T17:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375446",
    "user": "@mantepse"
}
```

fine with me, too!



---

archive/issue_comments_375447.json:
```json
{
    "body": "Travis, I think you forgot to set the flag to \"positive\".",
    "created_at": "2019-01-01T19:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375447",
    "user": "@mantepse"
}
```

Travis, I think you forgot to set the flag to "positive".



---

archive/issue_comments_375448.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-01T19:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375448",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375449.json:
```json
{
    "body": "I just realized something... the existing `uniq(X)` really just does `sorted(set(X))`. It seems a bit silly to write a function just for that and one can also wonder if the sorting is the right thing to do in general.\n\nSo I suggest that this new `stable_uniq` would *replace* `uniq`. Of course, a deprecation period is needed for that. So I'd rather use a private name like `_stable_uniq` for now.",
    "created_at": "2019-01-02T22:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375449",
    "user": "@jdemeyer"
}
```

I just realized something... the existing `uniq(X)` really just does `sorted(set(X))`. It seems a bit silly to write a function just for that and one can also wonder if the sorting is the right thing to do in general.

So I suggest that this new `stable_uniq` would *replace* `uniq`. Of course, a deprecation period is needed for that. So I'd rather use a private name like `_stable_uniq` for now.



---

archive/issue_comments_375450.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2019-01-02T22:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375450",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_375451.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-02T22:32:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375451",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375452.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-01-02T22:32:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375452",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_375453.json:
```json
{
    "body": "That is good with me.",
    "created_at": "2019-01-03T05:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375453",
    "user": "@tscrim"
}
```

That is good with me.



---

archive/issue_comments_375454.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-03T05:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375454",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375455.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-01-04T09:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375455",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_375456.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2019-01-04T09:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375456",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_375457.json:
```json
{
    "body": "Trivial rebase to 8.6.rc0",
    "created_at": "2019-01-04T09:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375457",
    "user": "@jdemeyer"
}
```

Trivial rebase to 8.6.rc0



---

archive/issue_comments_375458.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-01-04T09:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375458",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375459.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375459",
    "user": "@embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_375460.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-01-23T14:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26696",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26696#issuecomment-375460",
    "user": "@vbraun"
}
```

Resolution: fixed
