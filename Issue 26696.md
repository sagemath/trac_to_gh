# Issue 26696: Subsets_s should support unsortable sets

Issue created by migration from https://trac.sagemath.org/ticket/26933

Original creator: jdemeyer

Original creation time: 2018-12-21 14:52:54

CC:  chapoton

It should not force sorting the set, which may be unsortable.


---

Comment by jdemeyer created at 2018-12-21 15:31:01

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-12-21 15:31:01

New commits:


---

Comment by git created at 2019-01-01 10:08:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mantepse created at 2019-01-01 11:40:01

I wonder whether it is really worth the trouble (and performance hit) to keep the order of the ground set.

```
sage: S = [1, 8, -5, 3/2, 'a', x]
sage: import random
sage: L = [choice(S) for _ in range(10000)]
sage: %timeit list(set(L))
1000 loops, best of 3: 708 Âµs per loop
sage: %timeit list(stable_uniq(L))
1000 loops, best of 3: 1.4 ms per loop
```


(Currently, essentially all the time in `Subsets_s.__init__` is spent in `uniq`.)


---

Comment by tscrim created at 2019-01-01 17:36:55

It is not really fair to compare a builtin Python class `set` to a (pure) Python function. So the fact it is a 2x slowdown on a set that large is quite good IMO. It is a nice side-effect that the order of the groundset is preserved, but that looks like it is a facet of the (simple) implementation. This is also not the tool you should be using in a tight loop anyways, so I am not worried about the slowdown here. Thus I am giving this a positive review.


---

Comment by mantepse created at 2019-01-01 17:45:25

fine with me, too!


---

Comment by mantepse created at 2019-01-01 19:40:50

Travis, I think you forgot to set the flag to "positive".


---

Comment by tscrim created at 2019-01-01 19:58:44

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2019-01-02 22:09:28

I just realized something... the existing `uniq(X)` really just does `sorted(set(X))`. It seems a bit silly to write a function just for that and one can also wonder if the sorting is the right thing to do in general.

So I suggest that this new `stable_uniq` would _replace_ `uniq`. Of course, a deprecation period is needed for that. So I'd rather use a private name like `_stable_uniq` for now.


---

Comment by jdemeyer created at 2019-01-02 22:09:28

Changing status from positive_review to needs_work.


---

Comment by git created at 2019-01-02 22:32:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2019-01-02 22:32:44

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2019-01-03 05:29:31

That is good with me.


---

Comment by tscrim created at 2019-01-03 05:29:31

Changing status from needs_review to positive_review.


---

Comment by git created at 2019-01-04 09:29:01

Changing status from positive_review to needs_review.


---

Comment by git created at 2019-01-04 09:29:01

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:


---

Comment by jdemeyer created at 2019-01-04 09:29:46

Trivial rebase to 8.6.rc0


---

Comment by jdemeyer created at 2019-01-04 09:29:46

Changing status from needs_review to positive_review.


---

Comment by embray created at 2019-01-15 18:16:10

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by vbraun created at 2019-01-23 14:17:43

Resolution: fixed
