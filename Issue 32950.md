# Issue 32950: Allow gcc/gfortran 12

archive/issues_032950.json:
```json
{
    "body": "CC:  @culler @dimpase @kiwifb @antonio-rojas\n\nhttps://gcc.gnu.org/gcc-12/changes.html\n\nIssue created by migration from https://trac.sagemath.org/ticket/33187\n\n",
    "created_at": "2022-01-16T05:43:59Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Allow gcc/gfortran 12",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32950",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @culler @dimpase @kiwifb @antonio-rojas

https://gcc.gnu.org/gcc-12/changes.html

Issue created by migration from https://trac.sagemath.org/ticket/33187





---

archive/issue_comments_469389.json:
```json
{
    "body": "`tox -e docker-fedora-36-minimal` gives build failures in 2 packages: `singular`, `giac`\n----\nNew commits:",
    "created_at": "2022-01-20T23:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469389",
    "user": "https://github.com/mkoeppe"
}
```

`tox -e docker-fedora-36-minimal` gives build failures in 2 packages: `singular`, `giac`
----
New commits:



---

archive/issue_comments_469390.json:
```json
{
    "body": "So rejecting GCC 12 is justified.",
    "created_at": "2022-01-20T23:35:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469390",
    "user": "https://github.com/mkoeppe"
}
```

So rejecting GCC 12 is justified.



---

archive/issue_comments_469391.json:
```json
{
    "body": "Singular:\n\n```\n/usr/bin/bash ../../libtool  --tag=CXX   --mode=compile g++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../.. -I../../libpolys -I../../libpolys -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src  -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include -I/sage/local/include   -g -O2 -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-rtti -c -o vspace.lo vspace.cc\nlibtool: compile:  g++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../.. -I../../libpolys -I../../libpolys -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include -I/sage/local/include -g -O2 -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-rtti -c vspace.cc  -fPIC -DPIC -o .libs/vspace.o\nvspace.cc: In function 'void vspace::internals::vmem_free(vaddr_t)':\nvspace.cc:753:26: error: expected primary-expression before ',' token\n  753 |   vaddr -= offsetof(Block, data);\n      |                          ^\nvspace.cc:753:28: error: 'data' was not declared in this scope\n  753 |   vaddr -= offsetof(Block, data);\n      |                            ^~~~\nvspace.cc:753:12: error: 'offsetof' was not declared in this scope\n  753 |   vaddr -= offsetof(Block, data);\n      |            ^~~~~~~~\nvspace.cc:562:1: note: 'offsetof' is defined in header '<cstddef>'; did you forget to '#include <cstddef>'?\n  561 | #include <sys/stat.h>\n  +++ |+#include <cstddef>\n  562 | \n```\n",
    "created_at": "2022-01-20T23:38:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469391",
    "user": "https://github.com/mkoeppe"
}
```

Singular:

```
/usr/bin/bash ../../libtool  --tag=CXX   --mode=compile g++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../.. -I../../libpolys -I../../libpolys -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src  -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include -I/sage/local/include   -g -O2 -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-rtti -c -o vspace.lo vspace.cc
libtool: compile:  g++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../.. -I../../libpolys -I../../libpolys -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include -I/sage/local/include -g -O2 -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-rtti -c vspace.cc  -fPIC -DPIC -o .libs/vspace.o
vspace.cc: In function 'void vspace::internals::vmem_free(vaddr_t)':
vspace.cc:753:26: error: expected primary-expression before ',' token
  753 |   vaddr -= offsetof(Block, data);
      |                          ^
vspace.cc:753:28: error: 'data' was not declared in this scope
  753 |   vaddr -= offsetof(Block, data);
      |                            ^~~~
vspace.cc:753:12: error: 'offsetof' was not declared in this scope
  753 |   vaddr -= offsetof(Block, data);
      |            ^~~~~~~~
vspace.cc:562:1: note: 'offsetof' is defined in header '<cstddef>'; did you forget to '#include <cstddef>'?
  561 | #include <sys/stat.h>
  +++ |+#include <cstddef>
  562 | 
```




---

archive/issue_comments_469392.json:
```json
{
    "body": "Giac:\n\n```\ntex.cc: In function 'std::string giac::gen2tex(const gen&, const context*)':\ntex.cc:1383:12: error: conversion from 'int' to 'std::string' {aka 'std::__cxx11::basic_string<char>'} is ambiguous\n 1383 |     return 0;\n      |            ^\n```\n",
    "created_at": "2022-01-20T23:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469392",
    "user": "https://github.com/mkoeppe"
}
```

Giac:

```
tex.cc: In function 'std::string giac::gen2tex(const gen&, const context*)':
tex.cc:1383:12: error: conversion from 'int' to 'std::string' {aka 'std::__cxx11::basic_string<char>'} is ambiguous
 1383 |     return 0;
      |            ^
```




---

archive/issue_comments_469393.json:
```json
{
    "body": "I suppose we should update these two packages first and then see if the failures persist",
    "created_at": "2022-01-20T23:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469393",
    "user": "https://github.com/mkoeppe"
}
```

I suppose we should update these two packages first and then see if the failures persist



---

archive/issue_comments_469394.json:
```json
{
    "body": "Are you trying to compile `giac` with an explicit `std=c++14` or earlier? I see that you remove any explicit `c++17` in `spkg-install.in`, but that shouldn't be sufficient when the compiler default to `c++17` without any explicit options.",
    "created_at": "2022-01-21T00:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469394",
    "user": "https://github.com/kiwifb"
}
```

Are you trying to compile `giac` with an explicit `std=c++14` or earlier? I see that you remove any explicit `c++17` in `spkg-install.in`, but that shouldn't be sufficient when the compiler default to `c++17` without any explicit options.



---

archive/issue_comments_469395.json:
```json
{
    "body": "Yes, that's probably it",
    "created_at": "2022-01-21T01:53:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469395",
    "user": "https://github.com/mkoeppe"
}
```

Yes, that's probably it



---

archive/issue_comments_469396.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2022-01-30T21:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469396",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_469397.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-01T23:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469398.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-02T01:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469398",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_469399.json:
```json
{
    "body": "Tested using `tox -e docker-ubuntu-trusty-standard -- giac`\nand `tox -e docker-fedora-36-standard -- giac`.",
    "created_at": "2022-02-02T01:21:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469399",
    "user": "https://github.com/mkoeppe"
}
```

Tested using `tox -e docker-ubuntu-trusty-standard -- giac`
and `tox -e docker-fedora-36-standard -- giac`.



---

archive/issue_comments_469400.json:
```json
{
    "body": "The next error on `fedora-36`:\n\n```\n\nCondition of type: SIMPLE-ERROR\nError code 1 when executing\n(EXT:RUN-PROGRAM \"gcc\" (\"-o\" \"binary-ecl/maxima-package.fas\" \"-L/usr/lib64/\" \"/tmp/eclinit9XnKcY.o\" \"binary-ecl/maxima-package.o\" \"-shared\" \"-Wl,-z,relro\" \"-Wl,--as-needed\" \"-Wl,-z,now\" \"-specs=/usr/lib/rpm/redhat/redhat-hardened-ld\" \"-specs=/usr/lib/rpm/redhat/redhat-annobin-cc1\" \"-Wl,--build-id=sha1\" \"-Wl,-dT,/builddir/build/BUILD/.package_note-ecl-21.2.1-4.fc36.x86_64.ld\" \"-Wl,-z,relro\" \"-Wl,--as-needed\" \"-Wl,-z,now\" ...)):\n/usr/bin/ld: cannot open linker script file /builddir/build/BUILD/.package_note-ecl-21.2.1-4.fc36.x86_64.ld: No such file or directory\ncollect2: error: ld returned 1 exit status\nAvailable restarts:\n\n1. (CONTINUE) Continues anyway.\n2. (RESTART-TOPLEVEL) Go back to Top-Level REPL.\n\nBroken at DO-COMPILE-ECL. In: #<process TOP-LEVEL 0x7fd8e977af80>.\n File: #P\"/sage/local/var/tmp/sage/build/maxima-5.45.0.p0/src/src/maxima.system\" (Position #1601)\n>> \n```\n\nbut that looks just like a broken system package `ecl`.",
    "created_at": "2022-02-02T04:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469400",
    "user": "https://github.com/mkoeppe"
}
```

The next error on `fedora-36`:

```

Condition of type: SIMPLE-ERROR
Error code 1 when executing
(EXT:RUN-PROGRAM "gcc" ("-o" "binary-ecl/maxima-package.fas" "-L/usr/lib64/" "/tmp/eclinit9XnKcY.o" "binary-ecl/maxima-package.o" "-shared" "-Wl,-z,relro" "-Wl,--as-needed" "-Wl,-z,now" "-specs=/usr/lib/rpm/redhat/redhat-hardened-ld" "-specs=/usr/lib/rpm/redhat/redhat-annobin-cc1" "-Wl,--build-id=sha1" "-Wl,-dT,/builddir/build/BUILD/.package_note-ecl-21.2.1-4.fc36.x86_64.ld" "-Wl,-z,relro" "-Wl,--as-needed" "-Wl,-z,now" ...)):
/usr/bin/ld: cannot open linker script file /builddir/build/BUILD/.package_note-ecl-21.2.1-4.fc36.x86_64.ld: No such file or directory
collect2: error: ld returned 1 exit status
Available restarts:

1. (CONTINUE) Continues anyway.
2. (RESTART-TOPLEVEL) Go back to Top-Level REPL.

Broken at DO-COMPILE-ECL. In: #<process TOP-LEVEL 0x7fd8e977af80>.
 File: #P"/sage/local/var/tmp/sage/build/maxima-5.45.0.p0/src/src/maxima.system" (Position #1601)
>> 
```

but that looks just like a broken system package `ecl`.



---

archive/issue_comments_469401.json:
```json
{
    "body": "`EXTRA_CONFIGURE_ARGS=\"--without-system-ecl\" tox -e docker-fedora-36-standard ` builds successfully.",
    "created_at": "2022-02-02T19:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469401",
    "user": "https://github.com/mkoeppe"
}
```

`EXTRA_CONFIGURE_ARGS="--without-system-ecl" tox -e docker-fedora-36-standard ` builds successfully.



---

archive/issue_comments_469402.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-02T19:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469402",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_469403.json:
```json
{
    "body": "lgtm",
    "created_at": "2022-02-03T17:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469403",
    "user": "https://github.com/dimpase"
}
```

lgtm



---

archive/issue_comments_469404.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-03T17:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469404",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_469405.json:
```json
{
    "body": "Thanks!",
    "created_at": "2022-02-03T18:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469405",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_events_029848.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-12T22:07:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32950#event-29848"
}
```



---

archive/issue_comments_469406.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-12T22:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32950",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32950#issuecomment-469406",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
