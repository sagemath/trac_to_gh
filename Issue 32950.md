# Issue 32950: Allow gcc/gfortran 12

Issue created by migration from https://trac.sagemath.org/ticket/33187

Original creator: mkoeppe

Original creation time: 2022-01-16 05:43:59

CC:  culler dimpase fbissey arojas

https://gcc.gnu.org/gcc-12/changes.html


---

Comment by mkoeppe created at 2022-01-20 23:34:42

`tox -e docker-fedora-36-minimal` gives build failures in 2 packages: `singular`, `giac`
----
New commits:


---

Comment by mkoeppe created at 2022-01-20 23:35:14

So rejecting GCC 12 is justified.


---

Comment by mkoeppe created at 2022-01-20 23:38:21

Singular:

```
/usr/bin/bash ../../libtool  --tag=CXX   --mode=compile g++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../..  -I../.. -I../.. -I../../libpolys -I../../libpolys -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src  -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include -I/sage/local/include   -g -O2 -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-rtti -c -o vspace.lo vspace.cc
libtool: compile:  g++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../.. -I../../libpolys -I../../libpolys -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include -I/sage/local/include -g -O2 -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -fno-enforce-eh-specs -fconserve-space -funroll-loops -fno-rtti -c vspace.cc  -fPIC -DPIC -o .libs/vspace.o
vspace.cc: In function 'void vspace::internals::vmem_free(vaddr_t)':
vspace.cc:753:26: error: expected primary-expression before ',' token
  753 |   vaddr -= offsetof(Block, data);
      |                          ^
vspace.cc:753:28: error: 'data' was not declared in this scope
  753 |   vaddr -= offsetof(Block, data);
      |                            ^~~~
vspace.cc:753:12: error: 'offsetof' was not declared in this scope
  753 |   vaddr -= offsetof(Block, data);
      |            ^~~~~~~~
vspace.cc:562:1: note: 'offsetof' is defined in header '<cstddef>'; did you forget to '#include <cstddef>'?
  561 | #include <sys/stat.h>
  +++ |+#include <cstddef>
  562 | 
```



---

Comment by mkoeppe created at 2022-01-20 23:39:14

Giac:

```
tex.cc: In function 'std::string giac::gen2tex(const gen&, const context*)':
tex.cc:1383:12: error: conversion from 'int' to 'std::string' {aka 'std::__cxx11::basic_string<char>'} is ambiguous
 1383 |     return 0;
      |            ^
```



---

Comment by mkoeppe created at 2022-01-20 23:40:46

I suppose we should update these two packages first and then see if the failures persist


---

Comment by fbissey created at 2022-01-21 00:05:41

Are you trying to compile `giac` with an explicit `std=c++14` or earlier? I see that you remove any explicit `c++17` in `spkg-install.in`, but that shouldn't be sufficient when the compiler default to `c++17` without any explicit options.


---

Comment by mkoeppe created at 2022-01-21 01:53:23

Yes, that's probably it


---

Comment by mkoeppe created at 2022-01-30 21:22:36

Changing priority from major to critical.


---

Comment by git created at 2022-02-01 23:44:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-02 01:20:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-02 01:21:44

Tested using `tox -e docker-ubuntu-trusty-standard -- giac`
and `tox -e docker-fedora-36-standard -- giac`.


---

Comment by mkoeppe created at 2022-02-02 04:01:26

The next error on `fedora-36`:

```

Condition of type: SIMPLE-ERROR
Error code 1 when executing
(EXT:RUN-PROGRAM "gcc" ("-o" "binary-ecl/maxima-package.fas" "-L/usr/lib64/" "/tmp/eclinit9XnKcY.o" "binary-ecl/maxima-package.o" "-shared" "-Wl,-z,relro" "-Wl,--as-needed" "-Wl,-z,now" "-specs=/usr/lib/rpm/redhat/redhat-hardened-ld" "-specs=/usr/lib/rpm/redhat/redhat-annobin-cc1" "-Wl,--build-id=sha1" "-Wl,-dT,/builddir/build/BUILD/.package_note-ecl-21.2.1-4.fc36.x86_64.ld" "-Wl,-z,relro" "-Wl,--as-needed" "-Wl,-z,now" ...)):
/usr/bin/ld: cannot open linker script file /builddir/build/BUILD/.package_note-ecl-21.2.1-4.fc36.x86_64.ld: No such file or directory
collect2: error: ld returned 1 exit status
Available restarts:

1. (CONTINUE) Continues anyway.
2. (RESTART-TOPLEVEL) Go back to Top-Level REPL.

Broken at DO-COMPILE-ECL. In: #<process TOP-LEVEL 0x7fd8e977af80>.
 File: #P"/sage/local/var/tmp/sage/build/maxima-5.45.0.p0/src/src/maxima.system" (Position #1601)
>> 
```

but that looks just like a broken system package `ecl`.


---

Comment by mkoeppe created at 2022-02-02 19:23:45

`EXTRA_CONFIGURE_ARGS="--without-system-ecl" tox -e docker-fedora-36-standard ` builds successfully.


---

Comment by mkoeppe created at 2022-02-02 19:25:51

Changing status from new to needs_review.


---

Comment by dimpase created at 2022-02-03 17:12:00

lgtm


---

Comment by dimpase created at 2022-02-03 17:12:00

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-02-03 18:01:15

Thanks!


---

Comment by vbraun created at 2022-02-12 22:07:00

Resolution: fixed
