# Issue 29516: Build fails on Python 3.5.2

Issue created by migration from https://trac.sagemath.org/ticket/29753

Original creator: vbraun

Original creation time: 2020-05-28 19:18:14


```
[sagelib-9.1] ************************************************************************
[sagelib-9.1] Traceback (most recent call last):
[sagelib-9.1]   File "setup.py", line 73, in <module>
[sagelib-9.1]     from sage_setup.find import find_extra_files
[sagelib-9.1]   File "/var/lib/buildbot/slave/sage2_git/build/src/sage_setup/find.py", line 15, in <module>
[sagelib-9.1]     import importlib.machinery
[sagelib-9.1] ImportError: No module named machinery
[sagelib-9.1] ************************************************************************
[sagelib-9.1] Error building the Sage library
[sagelib-9.1] ************************************************************************
```



---

Comment by mkoeppe created at 2020-05-28 23:16:31

What code is invoking this? Please post config.log


---

Comment by mkoeppe created at 2020-05-28 23:26:32

In particular, please clarify what you mean by building "on Python 3.5.2" in light of my explanation in https://groups.google.com/d/msg/sage-devel/fgsSsJmVVXo/n2BQBSaBAAAJ


---

Comment by mkoeppe created at 2020-05-29 14:49:40

Changing priority from major to blocker.


---

Comment by mkoeppe created at 2020-05-29 14:49:40

Changing status from new to needs_info.


---

Comment by @kliem created at 2020-05-31 05:31:42

You probably already found out: This is caused by #27472.

I see this error on the standard-python2-gcc_spkg tests.

E.g. https://github.com/kliem/sage-test-27122/runs/722743058


---

Comment by mkoeppe created at 2020-06-01 19:06:37

Replying to [comment:4 gh-kliem]:
> You probably already found out: This is caused by #27472.

Could you elaborate? I don't understand this ticket, and unfortunately it seems that Volker does not see my requests for more information.


---

Comment by @kliem created at 2020-06-01 20:45:48

Sorry, this has nothing to do with #27472. The line 15 in `sage_setup/find.py` it is complaining about was added in #28000 (remove python2 support from sage lib).

To me it looks like this also removed python2 support for building sage, which was not the plan I believe (I think the agreement was that python2 may still be used to build sage). The module `importlib.machinery` just doesn't exist in python2 and hence the error.

I think the title of this ticket here is not correct as it appears to have nothing to do with python 3.5.2. It appears that the kucalc buildbot just doesn't have python3 installed. It should then in the build process automatically install python3, but it doesn't even get there.


---

Comment by mkoeppe created at 2020-06-01 20:48:58

But why would `sage_setup/find.py` be invoked using system python2?


---

Comment by @kliem created at 2020-06-01 20:53:34

That's pretty much the first thing it runs. So apparently rejecting python2 wasn't very successful. E.g. it tries to install `scipy` before `python3`, which doesn't look like it did really reject the wrong system python.


---

Comment by mkoeppe created at 2020-06-01 20:54:24

Are you referring to a build `--with-python=2`?


---

Comment by mkoeppe created at 2020-06-01 20:54:58

That is being removed in 9.2.


---

Comment by @kliem created at 2020-06-01 20:57:06

I'm refering to the github testrun `ubuntu-bionic, standard-python2-gcc_spkg` (and likewise all `... standard-python2-gcc_spkg`).

To my understanding this tries to install sage on a system, where all standard packages are installed but not python3 (instead python2). Is this correct?


---

Comment by mkoeppe created at 2020-06-01 20:58:56

No, the factor `python2` means that `./configure --with-python=2` is called. And that is scheduled to be removed in 9.2 (the removal of this option is done in #29669).


---

Comment by @kliem created at 2020-06-01 21:00:41

Ok. Using this option the build fails exactly as in the description of this ticket.


---

Comment by mkoeppe created at 2020-06-01 21:02:08

Changing status from needs_info to needs_review.


---

Comment by mkoeppe created at 2020-06-01 21:02:08

OK, then let's assume that this is also what Volker meant. Marking it as invalid.


---

Comment by @kliem created at 2020-06-01 21:11:15

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-06-01 21:11:15

I agree, this import error really shouldn't happen in python 3.5.2, see https://docs.python.org/3.5/library/importlib.html. The module is present in 3.5.2 and an import error implies that not python 3.5.2 was used but probably some python2.


---

Comment by chapoton created at 2020-06-20 06:25:38

Resolution: invalid
