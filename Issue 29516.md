# Issue 29516: Build fails on Python 3.5.2

archive/issues_029516.json:
```json
{
    "body": "\n```\n[sagelib-9.1] ************************************************************************\n[sagelib-9.1] Traceback (most recent call last):\n[sagelib-9.1]   File \"setup.py\", line 73, in <module>\n[sagelib-9.1]     from sage_setup.find import find_extra_files\n[sagelib-9.1]   File \"/var/lib/buildbot/slave/sage2_git/build/src/sage_setup/find.py\", line 15, in <module>\n[sagelib-9.1]     import importlib.machinery\n[sagelib-9.1] ImportError: No module named machinery\n[sagelib-9.1] ************************************************************************\n[sagelib-9.1] Error building the Sage library\n[sagelib-9.1] ************************************************************************\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29753\n\n",
    "created_at": "2020-05-28T19:18:14Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Build fails on Python 3.5.2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29516",
    "user": "vbraun"
}
```

```
[sagelib-9.1] ************************************************************************
[sagelib-9.1] Traceback (most recent call last):
[sagelib-9.1]   File "setup.py", line 73, in <module>
[sagelib-9.1]     from sage_setup.find import find_extra_files
[sagelib-9.1]   File "/var/lib/buildbot/slave/sage2_git/build/src/sage_setup/find.py", line 15, in <module>
[sagelib-9.1]     import importlib.machinery
[sagelib-9.1] ImportError: No module named machinery
[sagelib-9.1] ************************************************************************
[sagelib-9.1] Error building the Sage library
[sagelib-9.1] ************************************************************************
```


Issue created by migration from https://trac.sagemath.org/ticket/29753





---

archive/issue_comments_419030.json:
```json
{
    "body": "What code is invoking this? Please post config.log",
    "created_at": "2020-05-28T23:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419030",
    "user": "mkoeppe"
}
```

What code is invoking this? Please post config.log



---

archive/issue_comments_419031.json:
```json
{
    "body": "In particular, please clarify what you mean by building \"on Python 3.5.2\" in light of my explanation in https://groups.google.com/d/msg/sage-devel/fgsSsJmVVXo/n2BQBSaBAAAJ",
    "created_at": "2020-05-28T23:26:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419031",
    "user": "mkoeppe"
}
```

In particular, please clarify what you mean by building "on Python 3.5.2" in light of my explanation in https://groups.google.com/d/msg/sage-devel/fgsSsJmVVXo/n2BQBSaBAAAJ



---

archive/issue_comments_419032.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2020-05-29T14:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419032",
    "user": "mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_419033.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2020-05-29T14:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419033",
    "user": "mkoeppe"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_419034.json:
```json
{
    "body": "You probably already found out: This is caused by #27472.\n\nI see this error on the standard-python2-gcc_spkg tests.\n\nE.g. https://github.com/kliem/sage-test-27122/runs/722743058",
    "created_at": "2020-05-31T05:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419034",
    "user": "@kliem"
}
```

You probably already found out: This is caused by #27472.

I see this error on the standard-python2-gcc_spkg tests.

E.g. https://github.com/kliem/sage-test-27122/runs/722743058



---

archive/issue_comments_419035.json:
```json
{
    "body": "Replying to [comment:4 gh-kliem]:\n> You probably already found out: This is caused by #27472.\n\nCould you elaborate? I don't understand this ticket, and unfortunately it seems that Volker does not see my requests for more information.",
    "created_at": "2020-06-01T19:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419035",
    "user": "mkoeppe"
}
```

Replying to [comment:4 gh-kliem]:
> You probably already found out: This is caused by #27472.

Could you elaborate? I don't understand this ticket, and unfortunately it seems that Volker does not see my requests for more information.



---

archive/issue_comments_419036.json:
```json
{
    "body": "Sorry, this has nothing to do with #27472. The line 15 in `sage_setup/find.py` it is complaining about was added in #28000 (remove python2 support from sage lib).\n\nTo me it looks like this also removed python2 support for building sage, which was not the plan I believe (I think the agreement was that python2 may still be used to build sage). The module `importlib.machinery` just doesn't exist in python2 and hence the error.\n\nI think the title of this ticket here is not correct as it appears to have nothing to do with python 3.5.2. It appears that the kucalc buildbot just doesn't have python3 installed. It should then in the build process automatically install python3, but it doesn't even get there.",
    "created_at": "2020-06-01T20:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419036",
    "user": "@kliem"
}
```

Sorry, this has nothing to do with #27472. The line 15 in `sage_setup/find.py` it is complaining about was added in #28000 (remove python2 support from sage lib).

To me it looks like this also removed python2 support for building sage, which was not the plan I believe (I think the agreement was that python2 may still be used to build sage). The module `importlib.machinery` just doesn't exist in python2 and hence the error.

I think the title of this ticket here is not correct as it appears to have nothing to do with python 3.5.2. It appears that the kucalc buildbot just doesn't have python3 installed. It should then in the build process automatically install python3, but it doesn't even get there.



---

archive/issue_comments_419037.json:
```json
{
    "body": "But why would `sage_setup/find.py` be invoked using system python2?",
    "created_at": "2020-06-01T20:48:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419037",
    "user": "mkoeppe"
}
```

But why would `sage_setup/find.py` be invoked using system python2?



---

archive/issue_comments_419038.json:
```json
{
    "body": "That's pretty much the first thing it runs. So apparently rejecting python2 wasn't very successful. E.g. it tries to install `scipy` before `python3`, which doesn't look like it did really reject the wrong system python.",
    "created_at": "2020-06-01T20:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419038",
    "user": "@kliem"
}
```

That's pretty much the first thing it runs. So apparently rejecting python2 wasn't very successful. E.g. it tries to install `scipy` before `python3`, which doesn't look like it did really reject the wrong system python.



---

archive/issue_comments_419039.json:
```json
{
    "body": "Are you referring to a build `--with-python=2`?",
    "created_at": "2020-06-01T20:54:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419039",
    "user": "mkoeppe"
}
```

Are you referring to a build `--with-python=2`?



---

archive/issue_comments_419040.json:
```json
{
    "body": "That is being removed in 9.2.",
    "created_at": "2020-06-01T20:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419040",
    "user": "mkoeppe"
}
```

That is being removed in 9.2.



---

archive/issue_comments_419041.json:
```json
{
    "body": "I'm refering to the github testrun `ubuntu-bionic, standard-python2-gcc_spkg` (and likewise all `... standard-python2-gcc_spkg`).\n\nTo my understanding this tries to install sage on a system, where all standard packages are installed but not python3 (instead python2). Is this correct?",
    "created_at": "2020-06-01T20:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419041",
    "user": "@kliem"
}
```

I'm refering to the github testrun `ubuntu-bionic, standard-python2-gcc_spkg` (and likewise all `... standard-python2-gcc_spkg`).

To my understanding this tries to install sage on a system, where all standard packages are installed but not python3 (instead python2). Is this correct?



---

archive/issue_comments_419042.json:
```json
{
    "body": "No, the factor `python2` means that `./configure --with-python=2` is called. And that is scheduled to be removed in 9.2 (the removal of this option is done in #29669).",
    "created_at": "2020-06-01T20:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419042",
    "user": "mkoeppe"
}
```

No, the factor `python2` means that `./configure --with-python=2` is called. And that is scheduled to be removed in 9.2 (the removal of this option is done in #29669).



---

archive/issue_comments_419043.json:
```json
{
    "body": "Ok. Using this option the build fails exactly as in the description of this ticket.",
    "created_at": "2020-06-01T21:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419043",
    "user": "@kliem"
}
```

Ok. Using this option the build fails exactly as in the description of this ticket.



---

archive/issue_comments_419044.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-06-01T21:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419044",
    "user": "mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_419045.json:
```json
{
    "body": "OK, then let's assume that this is also what Volker meant. Marking it as invalid.",
    "created_at": "2020-06-01T21:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419045",
    "user": "mkoeppe"
}
```

OK, then let's assume that this is also what Volker meant. Marking it as invalid.



---

archive/issue_comments_419046.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-01T21:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419046",
    "user": "@kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_419047.json:
```json
{
    "body": "I agree, this import error really shouldn't happen in python 3.5.2, see https://docs.python.org/3.5/library/importlib.html. The module is present in 3.5.2 and an import error implies that not python 3.5.2 was used but probably some python2.",
    "created_at": "2020-06-01T21:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419047",
    "user": "@kliem"
}
```

I agree, this import error really shouldn't happen in python 3.5.2, see https://docs.python.org/3.5/library/importlib.html. The module is present in 3.5.2 and an import error implies that not python 3.5.2 was used but probably some python2.



---

archive/issue_comments_419048.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2020-06-20T06:25:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29516#issuecomment-419048",
    "user": "chapoton"
}
```

Resolution: invalid
