# Issue 24425: Upgrade scipoptsuite to 5.0.0

Issue created by migration from Trac.

Original creator: moritz

Original creation time: 2018-02-05 18:10:39

CC:  mkoeppe jipilab vklein

Before working on #21003, it might be a good idea to get the current version of the scipoptsuite running. This ticket should be very similar to #22557.


Upstream archive: â€‹http://scip.zib.de/download.php?fname=scipoptsuite-5.0.0.tgz (DO NOT put on sage servers -- we cannot redistribute this archive)


---

Comment by moritz created at 2018-02-05 18:15:36

There is some more work to be done. First it doesn't find the patches (some of which might need to be modified, and then SoPlex is not found)


```
OK, installing scipoptsuite-5.0.0 now...
[scipoptsuite-5.0.0] Using cached file /home/moritz/sage/upstream/scipoptsuite-5.0.0.tgz
[scipoptsuite-5.0.0] scipoptsuite-5.0.0
[scipoptsuite-5.0.0] ====================================================
[scipoptsuite-5.0.0] Setting up build directory for scipoptsuite-5.0.0
[scipoptsuite-5.0.0] Finished extraction
[scipoptsuite-5.0.0] No patch files found in ../patches
[scipoptsuite-5.0.0] ****************************************************
[scipoptsuite-5.0.0] Host system:
[scipoptsuite-5.0.0] Linux knoe 4.14.0-3-amd64 #1 SMP Debian 4.14.13-1 (2018-01-14) x86_64 GNU/Linux
[scipoptsuite-5.0.0] ****************************************************
[scipoptsuite-5.0.0] C compiler: gcc
[scipoptsuite-5.0.0] C compiler version:
[scipoptsuite-5.0.0] Using built-in specs.
[scipoptsuite-5.0.0] COLLECT_GCC=/usr/bin/gcc
[scipoptsuite-5.0.0] COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/7/lto-wrapper
[scipoptsuite-5.0.0] OFFLOAD_TARGET_NAMES=nvptx-none
[scipoptsuite-5.0.0] OFFLOAD_TARGET_DEFAULT=1
[scipoptsuite-5.0.0] Target: x86_64-linux-gnu
[scipoptsuite-5.0.0] Configured with: ../src/configure -v --with-pkgversion='Debian 7.3.0-1' --with-bugurl=file:///usr/share/doc/gcc-7/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++ --prefix=/usr --with-gcc-major-version-only --program-suffix=-7 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --with-sysroot=/ --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-libmpx --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
[scipoptsuite-5.0.0] Thread model: posix
[scipoptsuite-5.0.0] gcc version 7.3.0 (Debian 7.3.0-1) 
[scipoptsuite-5.0.0] ****************************************************
[scipoptsuite-5.0.0] Could not find SoPlex tarball in the scipoptsuite tarball.  Something is wrong.
```

----
New commits:


---

Comment by git created at 2018-04-04 20:52:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by moritz created at 2018-04-04 22:02:55

I changed this to using `cmake`. So this expects, that the user has `cmake` installed, but on the other hand otherwise it won't by possible to install PySCIPOpt later, which is what is needed for #21003. The Makefile system is not compatible with PySCIPOpt, see https://github.com/SCIP-Interfaces/PySCIPOpt/blob/master/INSTALL.rst.

Here are the cmake-instructions for scip: http://scip.zib.de/doc/html/CMAKE.php
----
New commits:


---

Comment by jipilab created at 2018-04-04 22:31:18

Does compile on debian stretch with cmake.


---

Comment by fbissey created at 2018-04-04 23:34:16

Please add `-DCMAKE_VERBOSE_MAKEFILE=ON` to the cmake invocation so that building is verbose by default.


---

Comment by mkoeppe created at 2018-04-05 14:46:53

Please add the dependency on cmake to the `dependencies` file...


---

Comment by git created at 2018-04-05 14:47:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-05 17:08:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-05 19:38:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-05 19:41:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-04-05 21:57:14

Is this ready for reviewing?


---

Comment by moritz created at 2018-04-05 21:59:51

Replying to [comment:15 mkoeppe]:
> Is this ready for reviewing?
yes!


---

Comment by moritz created at 2018-04-05 22:17:30

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2018-04-05 22:18:17

The `/usr/local` business that I saw on my computer may have come in because the cmake scripts look too creatively for libgmp or other libraries. Let's see if it's possible to prescribe looking in SAGE_LOCAL to make it more robust.


---

Comment by moritz created at 2018-04-05 22:23:42

Replying to [comment:18 mkoeppe]:
> The `/usr/local` business that I saw on my computer may have come in because the cmake scripts look too creatively for libgmp or other libraries. Let's see if it's possible to prescribe looking in SAGE_LOCAL to make it more robust.
> 
That would be great!


---

Comment by git created at 2018-04-05 23:11:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2018-04-05 23:15:45

Please try if this still works for you with my patches.

There are still unrelated problems on Mac OS X:

```
[scipoptsuite-5.0.1] -- Installing: /Users/mkoeppe/s/sage/some-sage-install-prefix/bin/scip
[scipoptsuite-5.0.1] error: /Library/Developer/CommandLineTools/usr/bin/install_name_tool: for: /Users/mkoeppe/s/sage/some-sage-install-prefix/bin/scip (for architecture x86_64) option "-add_rpath /Users/mkoeppe/s/sage/some-sage-install-prefix/lib" would duplicate path, file already has LC_RPATH for: /Users/mkoeppe/s/sage/some-sage-install-prefix/lib

$ otool -L /Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libscip.*
/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libscip.5.0.1.0.dylib:
	libscip.5.0.dylib (compatibility version 5.0.0, current version 5.0.1)
	/usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.8)
	/usr/lib/libedit.3.dylib (compatibility version 2.0.0, current version 3.0.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libhistory.6.dylib (compatibility version 6.0.0, current version 6.3.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libgmp.23.dylib (compatibility version 24.0.0, current version 24.3.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libgmpxx.8.dylib (compatibility version 13.0.0, current version 13.3.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libbliss.2.dylib (compatibility version 3.0.0, current version 3.0.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1238.0.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.24.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
```



---

Comment by fbissey created at 2018-04-05 23:29:04

On OS X it looks like using the rpath sets the install name so you have a complaint about doing something that's already been done. Could you run `otool -L` on the `scip` executable to see what's already there?


---

Comment by moritz created at 2018-04-05 23:32:45

It still works with the new patches on debian unstable.


---

Comment by mkoeppe created at 2018-04-05 23:36:14

Replying to [comment:22 fbissey]:
> On OS X it looks like using the rpath sets the install name so you have a complaint about doing something that's already been done. Could you run `otool -L` on the `scip` executable to see what's already there?

Well, the `scip` executable is not even linked against the shared library `libscip`. But here you go:

```
$ otool -L /Users/mkoeppe/s/sage/some-sage-install-prefix/bin/scip 
/Users/mkoeppe/s/sage/some-sage-install-prefix/bin/scip:
	/usr/lib/libz.1.dylib (compatibility version 1.0.0, current version 1.2.8)
	/usr/lib/libedit.3.dylib (compatibility version 2.0.0, current version 3.0.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libhistory.6.dylib (compatibility version 6.0.0, current version 6.3.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libgmp.23.dylib (compatibility version 24.0.0, current version 24.3.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libgmpxx.8.dylib (compatibility version 13.0.0, current version 13.3.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libbliss.2.dylib (compatibility version 3.0.0, current version 3.0.0)
	/usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1238.0.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libstdc++.6.dylib (compatibility version 7.0.0, current version 7.24.0)
	/Users/mkoeppe/s/sage/some-sage-install-prefix/lib/libgcc_s.1.dylib (compatibility version 1.0.0, current version 1.0.0)
```



---

Comment by fbissey created at 2018-04-05 23:39:50

Well the complaint was never about `libscip` but about adding an rpath that was already set another way. I may have to look at the CMakeList.txt, something may be extra baggage in there.


---

Comment by moritz created at 2018-04-06 00:19:26

`@`fbissey: can you install the package scipoptsuite using this ticket?


---

Comment by mkoeppe created at 2018-04-06 00:22:35

Replying to [comment:25 fbissey]:
> Well the complaint was never about `libscip` but about adding an rpath that was already set another way. I may have to look at the CMakeList.txt, something may be extra baggage in there.
I only showed you one of the errors, but there is also an identical one for the library.


---

Comment by fbissey created at 2018-04-06 02:12:40

Replying to [comment:26 moritz]:
> `@`fbissey: can you install the package scipoptsuite using this ticket?

Sorry, I haven't been testing the ticket, only providing technical input from my knowledge of OS X and cmake.


---

Comment by mkoeppe created at 2018-04-06 16:13:13

#25109 upgrades cmake, perhaps this helps to fix these problems on Mac OS X.


---

Comment by mkoeppe created at 2018-04-08 20:12:55

Changing keywords from "" to "IMA-PolyGeom".


---

Comment by jipilab created at 2018-04-11 21:49:35

Installation works flawlessly on debian-stretch.


---

Comment by vdelecroix created at 2018-04-13 11:38:39

also fine on archlinux!


---

Comment by vdelecroix created at 2018-04-13 11:39:46

And I believe you want more dependencies like `bliss` and `mpir/gmp`.


---

Comment by git created at 2018-04-16 10:31:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-16 10:38:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2018-04-16 10:40:16

Replying to [comment:29 mkoeppe]:
> #25109 upgrades cmake, perhaps this helps to fix these problems on Mac OS X.

I have put in a fix for the bad install name on Mac (but not the probably harmless warnings regarding the rpath). 
The upgrade of cmake is not necessary (I backed it out again).


---

Comment by git created at 2018-04-16 11:31:02

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by moritz created at 2018-04-16 11:33:31

I rebased and put the dependencies as suggested by Vincent. 

Also, I reviewed the parts written by Matthias.


---

Comment by mkoeppe created at 2018-04-16 11:56:36

cmake should be an order-only dependency. See my commit 737e606 that I put by mistake only on the branch for #21003


---

Comment by vdelecroix created at 2018-04-16 12:43:26

For gmp/mpir you should use `$(MP_LIBRARY)` and not their names (that moreover do conflict: you can not install both gmp and mpir on a system).


---

Comment by vdelecroix created at 2018-04-16 12:43:35

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-04-16 18:45:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by moritz created at 2018-04-16 18:46:09

Changing status from needs_work to needs_review.


---

Comment by moritz created at 2018-04-16 18:52:44

Changing status from needs_review to needs_work.


---

Comment by moritz created at 2018-04-16 19:02:36

When I run the checks with `./sage -f scipoptsuite -c`, it says:


`44% tests passed, 23 tests failed out of 4`.

I believe this is mainly due to the fact that IPOPT is not installed, but I am not sure.


---

Comment by vdelecroix created at 2018-04-16 19:30:23

Replying to [comment:48 moritz]:
> When I run the checks with `./sage -f scipoptsuite -c`, it says:
> 
> 
> `44% tests passed, 23 tests failed out of 4`.
> 
> I believe this is mainly due to the fact that IPOPT is not installed, but I am not sure.

Don't you have a full log? You should always run the testsuite with verbosity at maximum.


---

Attachment


---

Comment by moritz created at 2018-04-16 20:44:35

I have a long full log.


---

Comment by moritz created at 2018-04-16 21:19:33

Changing status from needs_work to needs_review.


---

Comment by moritz created at 2018-04-16 21:19:33

I guess it is ok, at least scip is running. Perhaps we could do another automatic install of IPOPT in another ticket.


---

Comment by fbissey created at 2018-04-16 21:33:41

Looks fishy to me. We have segfault in free-ing pointers in several places. Some other fault may be due to something missing.


---

Comment by moritz created at 2018-04-16 21:45:14

Changing status from needs_review to needs_work.


---

Comment by moritz created at 2018-04-16 21:45:14

I will try to figure out what is going on and if the new dependencies are to blame.


---

Comment by fbissey created at 2018-04-16 21:45:52

We want to use `zlib` from sage rather than the system. Add `-DZLIB_ROOT=$SAGE_LOCAL` should do that trick. I am still investigating a few things.


---

Comment by fbissey created at 2018-04-16 22:01:26


```
1133/1133 Test #1133: applications-polyscip-tenfelde_podehl ............................................................   Passed    0.10 sec

100% tests passed, 0 tests failed out of 1133
```


this is a system install with pretty much the same stuff configured than you (optional: zlib, readline, gmp[real gmp not mpir] and bliss - no ipopt or criterion).

I note that I have more tests than you (???).

In your log, the zlib identified in the tests is the one from sage (1.2.11) while the one spotted at configuration time was the system one (1.2.8) - that certainly could spell trouble.

Running tests after install really hurts. In any case you shouldn't have to do anything special to use the installed version of `scip` unless the testsuite has been badly written. cmake know to have different runtime path for tests and install.


---

Comment by fbissey created at 2018-04-16 22:08:27

Your config.log also shows that bliss and readline from the system rather than sage have been detected by cmake. This needs fixing.


---

Comment by fbissey created at 2018-04-16 22:14:39

For readline set `-DReadline_ROOT_DIR=${SAGE_LOCAL}`. For bliss try `-DBLISS_DIR=${SAGE_ROOT}`.


---

Comment by fbissey created at 2018-04-16 22:26:50

Not sure how you managed things, `FindIPOPT.cmake` doesn't fail gracefully in case of missing IPOPT. Is there another patch somewhere or is it cmake version dependent (3.9.6 here)? In my first test directly on the system I used ccmake and didn't pay much attention to that error that was easily overcome from the menu. I had to pass `-DIPOPT=OFF` for the configuration to succeed from plain `cmake`.


---

Comment by fbissey created at 2018-04-16 22:31:51

Replying to [comment:57 fbissey]:
> For readline set `-DReadline_ROOT_DIR=${SAGE_LOCAL}`. For bliss try `-DBLISS_DIR=${SAGE_ROOT}`.

Sorry SAGE_LOCAL not SAGE_ROOT!


---

Comment by fbissey created at 2018-04-16 23:06:12

So

```
(sage-sh) fbissey`@`moonloop:build$ cmake .. -DCMAKE_INSTALL_PREFIX="$SAGE_LOCAL"/ -DCMAKE_VERBOSE_MAKEFILE=ON -DGMP_DIR=${SAGE_LOCAL} -DZLIB_ROOT=${SAGE_LOCAL} -DReadline_ROOT_DIR=${SAGE_LOCAL} -DBLISS_DIR=${SAGE_LOCAL} -DIPOPT=OFF
-- The C compiler identification is Clang 5.0.1
-- The CXX compiler identification is Clang 5.0.1
-- Check for working C compiler: /usr/lib/llvm/5/bin/clang
-- Check for working C compiler: /usr/lib/llvm/5/bin/clang -- works
-- Detecting C compiler ABI info
-- Detecting C compiler ABI info - done
-- Detecting C compile features
-- Detecting C compile features - done
-- Check for working CXX compiler: /usr/lib/llvm/5/bin/clang++
-- Check for working CXX compiler: /usr/lib/llvm/5/bin/clang++ -- works
-- Detecting CXX compiler ABI info
-- Detecting CXX compiler ABI info - done
-- Detecting CXX compile features
-- Detecting CXX compile features - done
-- Found BISON: /usr/bin/bison (found version "3.0.4") 
-- Found FLEX: /usr/bin/flex (found version "2.6.4") 
-- Found GMP: /home/fbissey/sandbox/git-fork/sage-clang5/local/include  
-- Build type: Release
-- Found ZLIB: /home/fbissey/sandbox/git-fork/sage-clang5/local/lib/libz.so (found version "1.2.11") 
-- Build shared libraries: ON
-- Build type: Release
-- LEGACY mode for old compilers: OFF
-- Found Readline: /home/fbissey/sandbox/git-fork/sage-clang5/local/include  
-- Found BLISS: /home/fbissey/sandbox/git-fork/sage-clang5/local/include  
-- Looking for FE_DOWNWARD
-- Looking for FE_DOWNWARD - found
-- Could NOT find CRITERION (missing: CRITERION_LIBRARY CRITERION_INCLUDE_DIR) 
-- The following OPTIONAL packages have been found:

 * ZLIB
 * Readline
 * GMP
 * BLISS

-- The following REQUIRED packages have been found:

 * BISON
 * FLEX
 * SOPLEX
 * SCIP

-- The following OPTIONAL packages have not been found:

 * Criterion

-- Configuring done
-- Generating done
-- Build files have been written to: /home/fbissey/sandbox/git-fork/sage-clang5/scipoptsuite-5.0.1/build
(sage-sh) fbissey`@`moonloop:build$ make -j8
...
(sage-sh) fbissey`@`moonloop:build$ make install
...
(sage-sh) fbissey`@`moonloop:build$ make -j8 test
...
1133/1133 Test #1133: applications-polyscip-tenfelde_podehl ............................................................   Passed    0.10 sec

100% tests passed, 0 tests failed out of 1133

Total Test time (real) = 512.79 sec
```

Note: with cmake, one does `make test` not `make check` (that's autotools). That probably explains why you had not not quite 500 tests and I have 1133. `MAINFILE` was not useful in any way. I believe a number of your error were mismatched between detected system libraries and sage libraries found by runpath. The IPOPT detection problem needs to be addressed.


---

Comment by fbissey created at 2018-04-17 02:46:14

This is bad. `FindIPOPT.cmake` never defines `IPOPT_FOUND`. `scip/CMakeList.txt` relies on it being not false to enable `IPOPT`.

```
if(IPOPT_FOUND)
    include_directories(${IPOPT_INCLUDE_DIRS})
    #on debian IPOPT package needs this definition to work
    add_definitions( -DHAVE_CSTDDEF )
    set(NLPI_LIBRARIES ${IPOPT_LIBRARIES})
    set(nlpi nlpi/nlpi_ipopt.cpp)
else()
    set(nlpi nlpi/nlpi_ipopt_dummy.c)
endif()
```

because `IPOPT_FOUND` is never set the behavior depends completely on camke implementation of unset variables. In its current state `IPOPT` detection is broken and can only work by luck or lack of it. This should be reported upstream.

Proposed patch

```diff
diff --git a/scip/cmake/Modules/FindIPOPT.cmake b/scip/cmake/Modules/FindIPOPT.cmake
index 4d65120..00f4c34 100644
--- a/scip/cmake/Modules/FindIPOPT.cmake
+++ b/scip/cmake/Modules/FindIPOPT.cmake
`@``@` -35,6 +35,7 `@``@`
 # (To distribute this file outside of YCM, substitute the full
 #  License text for the above reference.)
 
+SET(IPOPT_FOUND FALSE)
 
 if(NOT WIN32)
   # On non Windows systems we use PkgConfig to find IPOPT
`@``@` -62,6 +63,7 `@``@` if(NOT WIN32)
                      PATHS ${_PC_IPOPT_LIBRARY_DIRS})
         list(APPEND IPOPT_LIBRARIES ${${_LIBRARY}_PATH})
       endforeach()
+      set(IPOPT_FOUND TRUE)
     else()
       set(IPOPT_DEFINITIONS "")
     endif()
`@``@` -114,6 +116,7 `@``@` if(NOT WIN32)
           endif()
           mark_as_advanced(IPOPT_SEARCH_FOR_${LIB})
         endforeach()
+        set(IPOPT_FOUND TRUE)
       endif()
     endif()
 
`@``@` -180,6 +183,7 `@``@` else()
         endif()
         mark_as_advanced(IPOPT_SEARCH_FOR_${LIB})
       endforeach()
+      set(IPOPT_FOUND TRUE)
     endif()
   endif()
 
`@``@` -188,16 +192,18 `@``@` else()
 endif()
 
 # parse the version number
-if(EXISTS ${IPOPT_INCLUDE_DIRS} )
-  file(STRINGS ${IPOPT_INCLUDE_DIRS}/IpoptConfig.h CONFIGFILE)
-
-  foreach(STR ${CONFIGFILE})
-    if("${STR}" MATCHES "^#define IPOPT_VERSION ")
-      string(REGEX REPLACE "#define IPOPT_VERSION " "" IPOPT_VERSION ${STR})
-      string(REGEX REPLACE "\"" "" IPOPT_VERSION ${IPOPT_VERSION})
-    endif()
-  endforeach()
-  # MESSAGE("found Ipopt ${IPOPT_VERSION}")
+if(IPOPT_FOUND)
+  if(EXISTS ${IPOPT_INCLUDE_DIRS} )
+    file(STRINGS ${IPOPT_INCLUDE_DIRS}/IpoptConfig.h CONFIGFILE)
+
+    foreach(STR ${CONFIGFILE})
+      if("${STR}" MATCHES "^#define IPOPT_VERSION ")
+        string(REGEX REPLACE "#define IPOPT_VERSION " "" IPOPT_VERSION ${STR})
+        string(REGEX REPLACE "\"" "" IPOPT_VERSION ${IPOPT_VERSION})
+      endif()
+    endforeach()
+    # MESSAGE("found Ipopt ${IPOPT_VERSION}")
+  endif()
 endif()
 
 mark_as_advanced(IPOPT_INCLUDE_DIRS
```



---

Comment by git created at 2018-04-17 10:02:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by moritz created at 2018-04-17 10:07:35

This now works fine for me, with all 1133 tests passed! 

However without IPOPT (I don't have it installed)


---

Comment by moritz created at 2018-04-17 10:10:42

If I have IPOPT installed if fails like this:

```
[scipoptsuite-5.0.1] gcc version 7.3.0 (Debian 7.3.0-16) 
[scipoptsuite-5.0.1] ****************************************************
[scipoptsuite-5.0.1] Building scipoptsuite with cmake
[scipoptsuite-5.0.1] -- The C compiler identification is GNU 7.3.0
[scipoptsuite-5.0.1] -- The CXX compiler identification is GNU 7.3.0
[scipoptsuite-5.0.1] -- Check for working C compiler: /home/moritz/sage/local/libexec/ccache/gcc
[scipoptsuite-5.0.1] -- Check for working C compiler: /home/moritz/sage/local/libexec/ccache/gcc -- works
[scipoptsuite-5.0.1] -- Detecting C compiler ABI info
[scipoptsuite-5.0.1] -- Detecting C compiler ABI info - done
[scipoptsuite-5.0.1] -- Detecting C compile features
[scipoptsuite-5.0.1] -- Detecting C compile features - done
[scipoptsuite-5.0.1] -- Check for working CXX compiler: /home/moritz/sage/local/libexec/ccache/g++
[scipoptsuite-5.0.1] -- Check for working CXX compiler: /home/moritz/sage/local/libexec/ccache/g++ -- works
[scipoptsuite-5.0.1] -- Detecting CXX compiler ABI info
[scipoptsuite-5.0.1] -- Detecting CXX compiler ABI info - done
[scipoptsuite-5.0.1] -- Detecting CXX compile features
[scipoptsuite-5.0.1] -- Detecting CXX compile features - done
[scipoptsuite-5.0.1] -- Found BISON: /usr/bin/bison (found version "3.0.4") 
[scipoptsuite-5.0.1] -- Found FLEX: /usr/bin/flex (found version "2.6.4") 
[scipoptsuite-5.0.1] -- Found GMP: /home/moritz/sage/local/include  
[scipoptsuite-5.0.1] -- Build type: Release
[scipoptsuite-5.0.1] -- Found ZLIB: /home/moritz/sage/local/lib/libz.so (found version "1.2.11") 
[scipoptsuite-5.0.1] -- Build shared libraries: ON
[scipoptsuite-5.0.1] -- Build type: Release
[scipoptsuite-5.0.1] -- LEGACY mode for old compilers: OFF
[scipoptsuite-5.0.1] -- Found Readline: /home/moritz/sage/local/include  
[scipoptsuite-5.0.1] -- Found BLISS: /home/moritz/sage/local/include  
[scipoptsuite-5.0.1] CMake Error at scip/cmake/Modules/FindIPOPT.cmake:191 (if):
[scipoptsuite-5.0.1]   if given arguments:
[scipoptsuite-5.0.1] 
[scipoptsuite-5.0.1]     "EXISTS" "/usr/local/include/coin" "/usr/local/include/coin/ThirdParty"
[scipoptsuite-5.0.1] 
[scipoptsuite-5.0.1]   Unknown arguments specified
[scipoptsuite-5.0.1] Call Stack (most recent call first):
[scipoptsuite-5.0.1]   scip/CMakeLists.txt:386 (find_package)

```


And this is also true with the patch suggested by fbissey (thanks for your efforts, by the way!)
It works fine with the flag `-DIPOPT=FALSE`.


---

Comment by git created at 2018-04-17 10:11:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2018-04-17 10:18:13

I did some test runs with ipopt installed or not after patching `FindIPOPT.cmake`. I tested no IPOPT, IPOTP-3.11.9 and 3.12.9. Detection worked as expected in all cases (no IPOTPT, version to low since 3.12.0 is minimum, and enabled with 3.12.9). But coinor packages can be messy so I am not sure all kinds of installs are properly supported. They may need hints like bliss, readline and zlib.

On a further note while it compiled all right with my install of IPOPT 3.12.9, numerous tests failed then. I am guessing my version was too high again.

Lastly the spkg-install on this branch is a bit messy we should standardise all the instances of SAGE_LOCAL in the cmake call to `"${SAGE_LOCAL}"` and not three different syntax.


---

Comment by moritz created at 2018-04-17 10:19:59

Here is a suggestion: We simply pass `-DIPOPT=FALSE` and don't worry about including IPOPT. This can then be fixed as soon as a new scipoptsuite version comes out, where the detection of IPOPT with cmake is fixed.


---

Comment by git created at 2018-04-17 10:23:11

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by fbissey created at 2018-04-17 10:25:50

Replying to [comment:68 moritz]:
> Here is a suggestion: We simply pass `-DIPOPT=FALSE` and don't worry about including IPOPT. This can then be fixed as soon as a new scipoptsuite version comes out, where the detection of IPOPT with cmake is fixed. 

I am fine with that. Your install in `/usr/local` cannot be processed properly by the current `FindIPOPT.cmake`. Something more sophisticated needs to be done. I have some ideas but that's getting involved.


---

Comment by git created at 2018-04-17 10:26:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by moritz created at 2018-04-17 10:29:06

I accidentally pushed changes from #21003 in between. Now it is back on the correct branch


---

Comment by git created at 2018-04-17 10:29:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by moritz created at 2018-04-17 10:30:13

Replying to [comment:70 fbissey]:
> Replying to [comment:68 moritz]:
> > Here is a suggestion: We simply pass `-DIPOPT=FALSE` and don't worry about including IPOPT. This can then be fixed as soon as a new scipoptsuite version comes out, where the detection of IPOPT with cmake is fixed. 
> 
> I am fine with that. Your install in `/usr/local` cannot be processed properly by the current `FindIPOPT.cmake`. Something more sophisticated needs to be done. I have some ideas but that's getting involved.
Ok, great! Thats what I did!
----
New commits:


---

Comment by moritz created at 2018-04-17 10:31:07

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2018-04-17 10:34:19

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2018-04-17 10:34:19

I believe it is good to go.


---

Comment by vbraun created at 2018-05-08 17:26:20

Resolution: fixed
