# Issue 17912: Can add vertex to immutable graph once

Issue created by migration from https://trac.sagemath.org/ticket/18149

Original creator: vbraun

Original creation time: 2015-04-09 10:44:03


```
sage: g = Graph({0:[1,2,3], 2:[4]}, immutable=True)
sage: g.add_vertex()
5
sage: g.add_vertex()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-8-ec8a05af84d7> in <module>()
----> 1 g.add_vertex()

/home/vbraun/Code/sage.git/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in add_vertex(self, name)
   8476 
   8477         """
-> 8478         return self._backend.add_vertex(name)
   8479 
   8480     def add_vertices(self, vertices):

/home/vbraun/Code/sage.git/src/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.add_vertex (build/cythonized/sage/graphs/base/c_graph.c:13807)()
   1533             retval = name
   1534 
-> 1535         check_vertex(name,
   1536                      self.vertex_ints,
   1537                      self.vertex_labels,

/home/vbraun/Code/sage.git/src/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.check_vertex (build/cythonized/sage/graphs/base/c_graph.c:11994)()
   1199     u_int = bitset_first_in_complement(G.active_vertices)
   1200     if u_int == -1:
-> 1201         G.realloc(2*G.active_vertices.size)
   1202         if reverse:
   1203             G_rev.realloc(2*G_rev.active_vertices.size)

/home/vbraun/Code/sage.git/src/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraph.realloc (build/cythonized/sage/graphs/base/c_graph.c:9528)()
    721             30
    722         """
--> 723         raise NotImplementedError()
    724 
    725     ###################################

NotImplementedError: 
```



---

Comment by ncohen created at 2015-04-09 12:35:24

`O_o`


---

Comment by ncohen created at 2015-04-09 13:10:10

Sorry about that. Needs review.

Nathann


---

Comment by ncohen created at 2015-04-09 13:10:10

Changing status from new to needs_review.


---

Comment by git created at 2015-04-09 13:10:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-09 13:11:24

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dcoudert created at 2015-04-10 04:02:05

In fact you fixed 2 issues. Now we have:

```
sage: g = Graph({0:[1,2,3], 2:[4]}, immutable=True)
sage: g.add_vertex()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: an integer is required
sage: g.add_vertex(6)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: Thou shalt not add a vertex to an immutable graph
```


For me the patch is OK, although this "Thou shalt not" is weird.

David.


---

Comment by dcoudert created at 2015-04-10 04:02:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-04-14 19:43:03

Resolution: fixed
