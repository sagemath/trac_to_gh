# Issue 22524: Update Sage patches to R; fix build on Cygwin

Issue created by migration from https://trac.sagemath.org/ticket/22761

Original creator: embray

Original creation time: 2017-04-05 09:35:42

CC:  jpflori gouezel tscrim

Keywords: cygwin windows r

I regenerated some of the patches we maintain for R, from a repository based on R 3.3.3, the current version in Sage since #20523.  So the new patches should apply more cleanly.  I also updated a few of the patches slightly:

* Updated `hardcoded_dirs.patch` so that it only takes action if `$SAGE_LOCAL` is actually set.  Otherwise it would set an invalid `$R_HOME_DIR`.  This was confusing for testing the validity of the patch set outside the context of Sage.

* The original `m4_macro_bug.patch` only patched the m4 script, but did not update the `configure` script with the resulting changes.

* The patches for Cygwin were not being applied (see [comment:13:ticket:22627]).  This fixes that, but also reworks the original `cygwin.patch` in such a way that it doesn't break building on other platforms.  Instead it includes new logic for handling a DLL import library (referred to as `LDLIB`) that is only used where relevant (I think this would useful to MinGW as well but we're not worrying about that right now).

This fixes building R 3.3.3 on Cygwin.


---

Comment by embray created at 2017-04-05 09:35:54

Changing status from new to needs_review.


---

Comment by embray created at 2017-04-05 10:26:31

Changing status from needs_review to needs_work.


---

Comment by embray created at 2017-04-05 10:26:31

Looks like the Cygwin aspect of this still needs work, as building rpy2 demonstrates for me.  I'm not sure libR.dll is being installed in the correct place.


---

Comment by embray created at 2017-04-05 10:40:25

Changing status from needs_work to needs_review.


---

Comment by embray created at 2017-04-05 10:40:25

Nevermind, this seems to have more to do with rpy2 I think.


---

Comment by embray created at 2017-04-05 11:55:59

Changing status from needs_review to needs_work.


---

Comment by embray created at 2017-04-05 11:55:59

Sorry, I think it is this after all.  I can't reproduce the problem on an older branch, and there were no changes to rpy2.  I think it's probably an installation path issue with the new build changes to R.


---

Comment by git created at 2017-04-05 13:09:31

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2017-04-05 13:13:55

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-04-05 13:19:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2017-04-05 13:20:12

New commits:


---

Comment by gouezel created at 2017-04-08 19:31:40

Does not apply


---

Comment by gouezel created at 2017-04-08 19:31:40

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-04-10 10:13:50

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2017-04-10 10:14:53

I think there was some weird disconnect between when I made this branch, and when #22627 was _actually_ merged into develop...


---

Comment by embray created at 2017-04-10 10:14:53

Changing status from needs_work to needs_review.


---

Comment by embray created at 2017-04-21 17:33:03

Changing priority from major to blocker.


---

Comment by tscrim created at 2017-04-21 17:52:31

Built for me okay on Cygwin. Off to the buildbots.


---

Comment by tscrim created at 2017-04-21 17:52:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-04-23 12:57:57

Resolution: fixed


---

Comment by embray created at 2017-04-24 11:00:22

Thanks!
