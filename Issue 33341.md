# Issue 33341: Add VS code config for debbuing doctests

Issue created by migration from https://trac.sagemath.org/ticket/33578

Original creator: @tobiasdiez

Original creation time: 2022-03-27 13:46:58

CC:  mkoeppe

Add VS code launch config that allows running and debugging doctests in an active file. To test (should work on gitpod as well):
- Open some python file
- Go to "Run & Debug" tab by clicking the play symbol with the little bug on it on the very left (or Ctrl + Shift + D)
- Next to the green play button at the top, select "Sage: Test" from the dropdown, then click the play button.


---

Comment by @tobiasdiez created at 2022-03-27 13:47:06

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-03-27 18:09:28

This would probably be better with `sage -t --verbose`


---

Comment by mkoeppe created at 2022-03-27 18:39:01

It's not running within `sage-env`, so lots of doctest failures happen.


---

Comment by mkoeppe created at 2022-03-27 18:43:42

Also a behavior like `./sage -t --debug` would be good, which drops into the debugger on failure.


---

Comment by mkoeppe created at 2022-03-27 18:44:30

Changing status from needs_review to needs_work.


---

Comment by @tobiasdiez created at 2022-03-27 19:02:55

Replying to [comment:4 mkoeppe]:
> It's not running within `sage-env`, so lots of doctest failures happen.
> 

I think this is not easily possible as I have to specify a python script as the "program".


---

Comment by @tobiasdiez created at 2022-03-27 19:03:42

Replying to [comment:2 mkoeppe]:
> This would probably be better with `sage -t --verbose`

Do you think that's generally helpful? Some of the python files contain quite some tests, so the output may be quite overwhelming.


---

Comment by @tobiasdiez created at 2022-03-27 19:05:01

Replying to [comment:5 mkoeppe]:
> Also a behavior like `./sage -t --debug` would be good, which drops into the debugger on failure.

Everything is already run in the debugger and things like "break on error" can be configured there.


---

Comment by mkoeppe created at 2022-03-27 19:09:03

Replying to [comment:9 gh-tobiasdiez]:
> Everything is already run in the debugger and things like "break on error" can be configured there.

But the doctest framework catches the exceptions


---

Comment by mkoeppe created at 2022-03-27 19:09:34

Replying to [comment:8 gh-tobiasdiez]:
> Replying to [comment:2 mkoeppe]:
> > This would probably be better with `sage -t --verbose`
> 
> Do you think that's generally helpful? Some of the python files contain quite some tests, so the output may be quite overwhelming.

Mostly in conjunction with dropping the user into the debugger


---

Comment by mkoeppe created at 2022-03-27 19:17:22

Replying to [comment:7 gh-tobiasdiez]:
> Replying to [comment:4 mkoeppe]:
> > It's not running within `sage-env`, so lots of doctest failures happen.
> 
> I think this is not easily possible as I have to specify a python script as the "program". 

It would probably already help to include `SAGE_LOCAL/bin` in PATH until #30818 is done


---

Comment by @tobiasdiez created at 2022-03-28 08:51:34

Replying to [comment:10 mkoeppe]:
> Replying to [comment:9 gh-tobiasdiez]:
> > Everything is already run in the debugger and things like "break on error" can be configured there.
> 
> But the doctest framework catches the exceptions

The debug statement doesn't play nicely with vscode debugger (it breaks in the console but not in the vs code debugger).


---

Comment by @tobiasdiez created at 2022-03-28 08:52:27

Replying to [comment:11 mkoeppe]:
> Replying to [comment:8 gh-tobiasdiez]:
> > Replying to [comment:2 mkoeppe]:
> > > This would probably be better with `sage -t --verbose`
> > 
> > Do you think that's generally helpful? Some of the python files contain quite some tests, so the output may be quite overwhelming.
> 
> Mostly in conjunction with dropping the user into the debugger

Added although I still find it not very helpful.


---

Comment by @tobiasdiez created at 2022-03-28 08:52:37

Changing status from needs_work to needs_review.


---

Comment by @tobiasdiez created at 2022-03-28 08:53:46

Replying to [comment:12 mkoeppe]:
> Replying to [comment:7 gh-tobiasdiez]:
> > Replying to [comment:4 mkoeppe]:
> > > It's not running within `sage-env`, so lots of doctest failures happen.
> > 
> > I think this is not easily possible as I have to specify a python script as the "program". 
> 
> It would probably already help to include `SAGE_LOCAL/bin` in PATH until #30818 is done

I can set env variables (using `env`) but don't know how to append things. As #30818 is also making good process I don't thing this is very important.


---

Comment by git created at 2022-03-28 08:54:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-03-28 16:09:04

Replying to [comment:13 gh-tobiasdiez]:
> Replying to [comment:10 mkoeppe]:
> > Replying to [comment:9 gh-tobiasdiez]:
> > > Everything is already run in the debugger and things like "break on error" can be configured there.
> > 
> > But the doctest framework catches the exceptions
> 
> The debug statement doesn't play nicely with vscode debugger (it breaks in the console but not in the vs code debugger).

Yes, `--debug` explicitly invokes pdb. So we would need an option to just raise an exception on failure.


---

Comment by @tobiasdiez created at 2022-03-28 17:53:43

Yes, that would be a small improvement. VS code also provides the option to break whenever an exception is raised (in user code). This should be good enough (combined with the option to ignore certain exceptions). (Moreover, once we switch to pytest, this will be handled automatically as exceptions reaching pytest count as "unhandled".)


---

Comment by @tobiasdiez created at 2022-04-16 21:39:06

Can we please get this in?


---

Comment by mkoeppe created at 2022-04-16 22:22:16

Changing status from needs_review to positive_review.


---

Comment by @tobiasdiez created at 2022-04-17 21:27:51

Thanks!


---

Comment by mkoeppe created at 2022-05-07 18:35:50

Changing priority from major to blocker.


---

Comment by vbraun created at 2022-05-12 21:42:20

Resolution: fixed
