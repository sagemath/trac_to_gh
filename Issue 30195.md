# Issue 30195: Slice Doesn't Work For Unramified or 2-Step Padic Extensions

Issue created by migration from https://trac.sagemath.org/ticket/30432

Original creator: @n-vi

Original creation time: 2020-08-24 13:13:47

Keywords: slice

The slice function, implemented in sage/src/sage/rings/padics/local_generic_element.pyx, only works for padic base-field or eisenstein-extension elements.

Example for an unramified element that slice fails on:

```
sage: T.<t> = Qp(5).extension(x^2-2)
sage: a = T(3*5^-1 + 1 + (3*t + 4)*5^2)
sage: a.slice(0,1)
---------------------------------------------------------------------------
...
TypeError: can't multiply sequence by non-int of type 'sage.rings.padics.qadic_flint_CR.qAdicCappedRelativeElement'
```


Example for a 2-step extension element that slice fails on:

```
sage: F.<a> = Qp(5).extension(x^2-3)
sage: H.<y> = F[]
sage: T.<w> = F.extension((4*5^-2 + 2*5^-1 + 4 + (2*a + 2)*5 + 3*a*5^3 + 4*5^4 + 3*5^5 + (2*a + 2)*5^8 + (4*a + 3)*5^9 + 2*a*5^10 + (3*a + 3)*5^11 + (3*a + 1)*5^12 + (3*a + 2)*5^13 + 4*5^14 + (2*a + 4)*5^15 + (4*a + 1)*5^16 + (a + 1)*5^17 + O(5^18))*y^2 + (a + 2*a*5 + a*5^2 + 4*a*5^3 + (2*a + 4)*5^4 + (3*a + 4)*5^5 + (a + 1)*5^6 + a*5^7 + (2*a + 4)*5^8 + 3*5^9 + 2*5^10 + 5^12 + (4*a + 2)*5^13 + 5^14 + 5^15 + 3*a*5^16 + (a + 2)*5^17 + 4*5^18 + (3*a + 1)*5^19 + O(5^20))*y + (2*a + 2)*5^-1 + 3 + 5 + a*5^2 + (4*a + 2)*5^3 + (4*a + 1)*5^4 + (3*a + 4)*5^5 + (4*a + 4)*5^6 + (3*a + 2)*5^7 + (4*a + 4)*5^8 + 3*5^9 + (a + 3)*5^10 + (4*a + 3)*5^11 + 5^12 + (2*a + 2)*5^14 + 4*a*5^15 + (2*a + 2)*5^16 + (4*a + 4)*5^17 + O(5^18))
sage: b = T(3*w^-36 + (2*a + 2)*w^-23)
sage: b.slice(-25,2)
---------------------------------------------------------------------------
...
TypeError: can't multiply sequence by non-int of type 'sage.rings.padics.relative_ramified_CR.RelativeRamifiedCappedRelativeElement'
```



---

Comment by @n-vi created at 2020-08-25 09:46:53

New commits:


---

Comment by @n-vi created at 2020-08-25 09:46:53

Changing status from new to needs_review.


---

Comment by saraedum created at 2020-09-17 23:53:03

I remember that I stumbled upon this at some point. So thanks a lot for fixing it.


```
+        Currently implemented for one-step eisenstein or unramified padic
+        extensions, or for two-step (unramified and then eisenstein) 
+        extensions.
```


Hm…sounds like it does not work for base rings? Or is there some other ring that I am missing?


```
where p is the uniformizer
```


I think it's much easier to read this if we replace `p` with `pi` or `π`.

It does not really matter, but I think it's nicer to our users to put the information into the exception:


```patch
-        # sage currently supports only Eisenstein / unramified expansions.
         else:
-            raise NotImplementedError
+            raise NotImplementedError("slice() not implemented for %s extensions"%(ext_type,))        
```


I am not sure whether you really need all these cases in the code. Couldn't something like this already do the trick?


```python
unramified_generator = self.parent()(self.parent().residue_field().gen()).lift_to_precision() # not sure whether that's correct in general
for c in islice(self.expansion(lift_mode=lift_mode), int(start), int(stop), int(k)):
  genpow = 1
  if not isinstance(c, list): c = [c]
  for d in c:
    ans += d * genpow * ppow                    
    genpow *= generator
  ppow *= pk
```



---

Comment by saraedum created at 2020-09-17 23:53:03

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-09-21 14:54:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @n-vi created at 2020-09-21 15:01:19

Hi Julian, thanks for the comments, they greatly improve the code.

Since the documentation of the method specifies the rings for which it is implemented, I currently gave up on checking that the extension type is eisenstein or unramified, because it seemed a bit costly, and perhaps the generalization that you have suggested would apply to other extensions as well, when they are implemented in sage.
However, if you think it preferable, I can add the following bit of code:

```
from sage.rings.padics.padic_extension_generic import pAdicExtensionGeneric

if isinstance(self.parent(), pAdicExtensionGeneric):
    ext_type = self.parent()._extension_type()
    if ext_type != "Eisenstein" and ext_type != "Unramified":
        raise NotImplementedError("slice() not implemented for %s extensions"%(ext_type,))
```



---

Comment by @n-vi created at 2020-09-21 15:01:37

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2020-10-29 22:25:13

I think you can drop this since it's currently implemented always.


```
+        Currently implemented for padic base-rings, one-step eisenstein
+        or unramified extensions, or two-step (unramified and then eisenstein)
+        extensions.
```



---

Comment by saraedum created at 2020-10-29 22:27:06

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2020-10-29 22:27:06

Looks great otherwise.


---

Comment by git created at 2020-11-20 14:04:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @n-vi created at 2020-11-20 14:05:00

Thanks Julian, I removed the comment as suggested.


---

Comment by @n-vi created at 2020-11-20 14:05:10

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2020-11-22 00:46:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-11-29 11:57:57

Resolution: fixed
