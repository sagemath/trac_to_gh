# Issue 16548: derivative operator translation to maxima

Issue created by migration from Trac.

Original creator: nbruin

Original creation time: 2014-08-08 22:40:01

CC:  kcrisman rws burcin

Currently, we are failing to properly convert certain expressions to maxima when they contain differential operators:

```
sage: function('f')
sage: maxima_calculus(f(x).diff(x))
'diff(f(_SAGE_VAR_x),_SAGE_VAR_x,1)
sage: maxima_calculus(f(x+1).diff(x)) #this is bad!
?%at('diff(f(t0),t0,1),[t0=x+1])
```

note the bare `x` in the bottom line. That should be a `_SAGE_VAR_`.

As it turns out, a lot of conversion here is happening with string manipulations, circumventing the standard conversion machinery. That also means that functions that have a non-trivial `_maxima_init_evaled_` will not get translated using it. It's better to do everything using the standard conversion.


---

Comment by nbruin created at 2014-08-08 22:46:56

Changing status from new to needs_review.


---

Comment by nbruin created at 2014-08-08 22:46:56

Hopefully these changes do the trick. `maxima_lib.sr_to_max` was already doing something along these lines, so no changes are required there.
----
New commits:


---

Comment by rws created at 2014-08-10 08:59:29

Passes ptestlong and looks good.


---

Comment by rws created at 2014-08-10 08:59:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-08-11 15:01:22

Resolution: fixed
