# Issue 33083: Rework on Thebe for live sage documentation

archive/issues_033083.json:
```json
{
    "body": "CC:  @jhpalmieri\n\nAs Thebe is not working in our Sage documentation, we turned it off.\n\nThis ticket is to revive Thebe as a long term goal.\n\nRelated tickets:\n\n- #24593\n\nIssue created by migration from https://trac.sagemath.org/ticket/33320\n\n",
    "created_at": "2022-02-10T12:20:51Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Rework on Thebe for live sage documentation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33083",
    "user": "@kwankyu"
}
```
CC:  @jhpalmieri

As Thebe is not working in our Sage documentation, we turned it off.

This ticket is to revive Thebe as a long term goal.

Related tickets:

- #24593

Issue created by migration from https://trac.sagemath.org/ticket/33320





---

archive/issue_comments_471603.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to documentation.",
    "created_at": "2022-03-22T02:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471603",
    "user": "@mkoeppe"
}
```

Changing component from PLEASE CHANGE to documentation.



---

archive/issue_comments_471604.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-22T08:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471604",
    "user": "@kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_471605.json:
```json
{
    "body": "Achieved by #33507.",
    "created_at": "2022-03-22T08:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471605",
    "user": "@kwankyu"
}
```

Achieved by #33507.



---

archive/issue_comments_471606.json:
```json
{
    "body": "Isn't the goal that every cell on every documentation page can be activated?",
    "created_at": "2022-03-22T16:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471606",
    "user": "@mkoeppe"
}
```

Isn't the goal that every cell on every documentation page can be activated?



---

archive/issue_comments_471607.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-03-23T00:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471607",
    "user": "@kwankyu"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_471608.json:
```json
{
    "body": "Replying to [comment:5 mkoeppe]:\n> Isn't the goal that every cell on every documentation page can be activated?\n\nOkay. I felt I was missing something.",
    "created_at": "2022-03-23T00:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471608",
    "user": "@kwankyu"
}
```

Replying to [comment:5 mkoeppe]:
> Isn't the goal that every cell on every documentation page can be activated?

Okay. I felt I was missing something.



---

archive/issue_comments_471609.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-03-24T12:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471609",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_471610.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-03-25T02:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471610",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_471611.json:
```json
{
    "body": "To use a local jupyter server for live doc: in `src/sage/docs/conf.py`,\n\n```\n# comment out if local jupyter server is running\njupyter_sphinx_thebelab_config.update({\n    'binderOptions': {\n        'repo': \"sagemath/sage-binder-env\",\n    },\n})\n```\n\nand rebuild the doc.\n\n\n\nTo view the live doc, run\n\n```\nsage --notebook=jupyterlab --ServerApp.token='secret' --ServerApp.allow_origin='null' --ServerApp.disable_check_xsrf=true\n```\n\nand open the doc.",
    "created_at": "2022-03-25T02:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471611",
    "user": "@kwankyu"
}
```

To use a local jupyter server for live doc: in `src/sage/docs/conf.py`,

```
# comment out if local jupyter server is running
jupyter_sphinx_thebelab_config.update({
    'binderOptions': {
        'repo': "sagemath/sage-binder-env",
    },
})
```

and rebuild the doc.



To view the live doc, run

```
sage --notebook=jupyterlab --ServerApp.token='secret' --ServerApp.allow_origin='null' --ServerApp.disable_check_xsrf=true
```

and open the doc.



---

archive/issue_comments_471612.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-25T05:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471612",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471613.json:
```json
{
    "body": "Now the procedure to use a local server is \n\n```\nexport JUPYTER_SERVER='http://localhost:8888'\nexport JUPYTER_SERVER_TOKEN='secret'\n```\n\nand rebuild the doc. No need to touch `conf.py`.",
    "created_at": "2022-03-25T05:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471613",
    "user": "@kwankyu"
}
```

Now the procedure to use a local server is 

```
export JUPYTER_SERVER='http://localhost:8888'
export JUPYTER_SERVER_TOKEN='secret'
```

and rebuild the doc. No need to touch `conf.py`.



---

archive/issue_comments_471614.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2022-03-26T13:36:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471614",
    "user": "@kwankyu"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_471615.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-26T13:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471615",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471616.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-26T22:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471616",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471617.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-27T08:41:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471617",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471618.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-27T10:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471618",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471619.json:
```json
{
    "body": "This is now ready to play with.",
    "created_at": "2022-03-27T12:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471619",
    "user": "@kwankyu"
}
```

This is now ready to play with.



---

archive/issue_comments_471620.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-27T20:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471620",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471621.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-28T01:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471621",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471622.json:
```json
{
    "body": "Just uploaded a late commit. Building live doc takes triple times more time. So `LIVE_DOC=no` is the default.",
    "created_at": "2022-03-28T01:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471622",
    "user": "@kwankyu"
}
```

Just uploaded a late commit. Building live doc takes triple times more time. So `LIVE_DOC=no` is the default.



---

archive/issue_comments_471623.json:
```json
{
    "body": "Matthias, the lines 150-154 of `execute.py` should be removed.",
    "created_at": "2022-03-28T05:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471623",
    "user": "@kwankyu"
}
```

Matthias, the lines 150-154 of `execute.py` should be removed.



---

archive/issue_comments_471624.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-28T13:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471624",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471625.json:
```json
{
    "body": "Replying to [comment:32 klee]:\n> Matthias, the lines 150-154 of `execute.py` should be removed.\n\nI fixed the patch.",
    "created_at": "2022-03-28T13:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471625",
    "user": "@kwankyu"
}
```

Replying to [comment:32 klee]:
> Matthias, the lines 150-154 of `execute.py` should be removed.

I fixed the patch.



---

archive/issue_comments_471626.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-29T05:52:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471626",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471627.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-29T06:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471627",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471628.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-30T02:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471628",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471629.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-30T02:14:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471629",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_471630.json:
```json
{
    "body": "I thought about reducing live doc building time. But it seems that this should be done on jupyter-sphinx side, or rather by forking it to make our own tailored for sage. In short, this belongs to a wishlist.\n\nAs the live doc is optional, it is safe to merge this branch now.",
    "created_at": "2022-03-30T02:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471630",
    "user": "@kwankyu"
}
```

I thought about reducing live doc building time. But it seems that this should be done on jupyter-sphinx side, or rather by forking it to make our own tailored for sage. In short, this belongs to a wishlist.

As the live doc is optional, it is safe to merge this branch now.



---

archive/issue_comments_471631.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-30T02:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471631",
    "user": "@kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_471632.json:
```json
{
    "body": "I think the new environment variables should use a prefix `SAGE_` and it would be good if they could be set by `src/sage_docbuild/__init__.py` like it sets environment variables `SAGE_SKIP_PLOT_DIRECTIVE` etc.  I don't think they should go through `sage.env`.",
    "created_at": "2022-03-30T02:40:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471632",
    "user": "@mkoeppe"
}
```

I think the new environment variables should use a prefix `SAGE_` and it would be good if they could be set by `src/sage_docbuild/__init__.py` like it sets environment variables `SAGE_SKIP_PLOT_DIRECTIVE` etc.  I don't think they should go through `sage.env`.



---

archive/issue_comments_471633.json:
```json
{
    "body": "Some questions:\n\n- Should the live docs be built in a different location (for example \"html_live\") so that it can coexist with the static documentation? Then it would play a role more like the PDF documentation.\n\n- Should building the live docs be an option for `./configure`, and/or a `make` target, like the PDF docs? (Separately, I wonder if options like `SAGE_SKIP_PLOT_DIRECTIVE` should also be controlled by `./configure` arguments.)",
    "created_at": "2022-03-30T03:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471633",
    "user": "@jhpalmieri"
}
```

Some questions:

- Should the live docs be built in a different location (for example "html_live") so that it can coexist with the static documentation? Then it would play a role more like the PDF documentation.

- Should building the live docs be an option for `./configure`, and/or a `make` target, like the PDF docs? (Separately, I wonder if options like `SAGE_SKIP_PLOT_DIRECTIVE` should also be controlled by `./configure` arguments.)



---

archive/issue_comments_471634.json:
```json
{
    "body": "Replying to [comment:46 jhpalmieri]:\n> Some questions:\n> \n> - Should the live docs be built in a different location (for example \"html_live\") so that it can coexist with the static documentation? Then it would play a role more like the PDF documentation.\n\nLive html docs are exactly like the normal html docs with additional \"make live\" capability. You may see the live docs as an upgrade version. So it makes not much sense to have both.",
    "created_at": "2022-03-30T09:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471634",
    "user": "@kwankyu"
}
```

Replying to [comment:46 jhpalmieri]:
> Some questions:
> 
> - Should the live docs be built in a different location (for example "html_live") so that it can coexist with the static documentation? Then it would play a role more like the PDF documentation.

Live html docs are exactly like the normal html docs with additional "make live" capability. You may see the live docs as an upgrade version. So it makes not much sense to have both.



---

archive/issue_comments_471635.json:
```json
{
    "body": "Replying to [comment:46 jhpalmieri]:\n> - Should building the live docs be an option for `./configure`, and/or a `make` target, like the PDF docs? \n\nI think it's possible to choose live or static by `./configure`, but Matthias will know it better.",
    "created_at": "2022-03-30T09:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471635",
    "user": "@kwankyu"
}
```

Replying to [comment:46 jhpalmieri]:
> - Should building the live docs be an option for `./configure`, and/or a `make` target, like the PDF docs? 

I think it's possible to choose live or static by `./configure`, but Matthias will know it better.



---

archive/issue_comments_471636.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-30T09:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471636",
    "user": "@kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_471637.json:
```json
{
    "body": "Replying to [comment:44 mkoeppe]:\n> I think the new environment variables should use a prefix `SAGE_` and it would be good if they could be set by `src/sage_docbuild/__init__.py` like it sets environment variables `SAGE_SKIP_PLOT_DIRECTIVE` etc.  I don't think they should go through `sage.env`.\n\nOkay. I am working on it.",
    "created_at": "2022-03-30T09:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471637",
    "user": "@kwankyu"
}
```

Replying to [comment:44 mkoeppe]:
> I think the new environment variables should use a prefix `SAGE_` and it would be good if they could be set by `src/sage_docbuild/__init__.py` like it sets environment variables `SAGE_SKIP_PLOT_DIRECTIVE` etc.  I don't think they should go through `sage.env`.

Okay. I am working on it.



---

archive/issue_comments_471638.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-30T09:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471638",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471639.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-30T14:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471639",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471640.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-30T14:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471640",
    "user": "@kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_471641.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-01T05:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471641",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-03T12:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471642",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471643.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-03T13:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471643",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_471644.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-03T13:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471644",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_471645.json:
```json
{
    "body": "So if I understand correctly, both (1) during the documentation build and (2) when viewing the documentation, either (a) binder is used or (b) a local Jupyter is used.\n\nIs it possible to do 1(b) and 2(a)?",
    "created_at": "2022-04-03T16:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471645",
    "user": "@mkoeppe"
}
```

So if I understand correctly, both (1) during the documentation build and (2) when viewing the documentation, either (a) binder is used or (b) a local Jupyter is used.

Is it possible to do 1(b) and 2(a)?



---

archive/issue_comments_471646.json:
```json
{
    "body": "Replying to [comment:60 mkoeppe]:\n> So if I understand correctly, both (1) during the documentation build and (2) when viewing the documentation, either (a) binder is used or (b) a local Jupyter is used.\n> \n> Is it possible to do 1(b) and 2(a)?\n\nWhen you do 1(b), thebe configuration is baked into the htmls, so you cannot do 2(a).\n\nIf you want to do 1(a) for the whole documentation, and do 2(b) for a specific documentation, for instance 'prep', then \n\n```\nexport SAGE_JUPYTER_SERVER=http://localhost:8888\nexport SAGE_JUPYTER_SERVER_TOKEN=secret\nsage --docbuild --live-doc prep html\n```\n\nshould work, but does not. I don't understand why. Instead you should do\n\n```\nsage --docbuild prep html\nexport SAGE_JUPYTER_SERVER=http://localhost:8888\nexport SAGE_JUPYTER_SERVER_TOKEN=secret\nsage --docbuild --live-doc prep html\n```\n\nThis is because sphinx recognizes the changes of the config variable `jupyter_execute_default_kernel` but not of `jupyter_sphinx_thebelab_config`. Any idea why?",
    "created_at": "2022-04-04T01:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471646",
    "user": "@kwankyu"
}
```

Replying to [comment:60 mkoeppe]:
> So if I understand correctly, both (1) during the documentation build and (2) when viewing the documentation, either (a) binder is used or (b) a local Jupyter is used.
> 
> Is it possible to do 1(b) and 2(a)?

When you do 1(b), thebe configuration is baked into the htmls, so you cannot do 2(a).

If you want to do 1(a) for the whole documentation, and do 2(b) for a specific documentation, for instance 'prep', then 

```
export SAGE_JUPYTER_SERVER=http://localhost:8888
export SAGE_JUPYTER_SERVER_TOKEN=secret
sage --docbuild --live-doc prep html
```

should work, but does not. I don't understand why. Instead you should do

```
sage --docbuild prep html
export SAGE_JUPYTER_SERVER=http://localhost:8888
export SAGE_JUPYTER_SERVER_TOKEN=secret
sage --docbuild --live-doc prep html
```

This is because sphinx recognizes the changes of the config variable `jupyter_execute_default_kernel` but not of `jupyter_sphinx_thebelab_config`. Any idea why?



---

archive/issue_comments_471647.json:
```json
{
    "body": "Replying to [comment:61 klee]:\n> This is because sphinx recognizes the changes of the config variable `jupyter_execute_default_kernel` but not of `jupyter_sphinx_thebelab_config`. Any idea why?\n\nIt is because jupyter-sphinx enrolls `jupyter_execute_default_kernel` as a config value of type `env` and `jupyter_sphinx_thebelab_config` as a config value of type `html`.",
    "created_at": "2022-04-04T05:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471647",
    "user": "@kwankyu"
}
```

Replying to [comment:61 klee]:
> This is because sphinx recognizes the changes of the config variable `jupyter_execute_default_kernel` but not of `jupyter_sphinx_thebelab_config`. Any idea why?

It is because jupyter-sphinx enrolls `jupyter_execute_default_kernel` as a config value of type `env` and `jupyter_sphinx_thebelab_config` as a config value of type `html`.



---

archive/issue_comments_471648.json:
```json
{
    "body": "I just tried the full docbuild from scratch with the local Jupyter. The build first failed with\n\n```\n[sagemath_doc_html-none] [reference] preparing documents... skipping loading of indexes... done\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:34: WARNING: unknown document: categories/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:41: WARNING: unknown document: polynomial_rings/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:43: WARNING: unknown document: finite_rings/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:58: WARNING: unknown document: calculus/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:84: WARNING: unknown document: combinat/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:85: WARNING: unknown document: graphs/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:89: WARNING: unknown document: coding/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:90: WARNING: unknown document: cryptography/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:99: WARNING: unknown document: discrete_geometry/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:102: WARNING: unknown document: manifolds/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:133: WARNING: unknown document: curves/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:134: WARNING: unknown document: arithmetic_curves/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:139: WARNING: unknown document: databases/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:149: WARNING: unknown document: misc/index\n[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:150: WARNING: unknown document: doctest/index\n[sagemath_doc_html-none] [reference] The inventory files are in local/share/doc/sage/inventory/en/reference.\n[sagemath_doc_html-none] Error building the documentation.\n```\n\nbut re-running it, it succeeded. \n\nThen, running the command from the ticket description, I got:\n\n```\n$ sage --notebook=jupyterlab --ServerApp.token='secret' --ServerApp.allow_origin='null' --ServerApp.disable_check_xsrf=true --ServerApp.open_browser=false\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.6.beta7, Release Date: 2022-04-02               \u2502\n\u2502 Using Python 3.10.2. Type \"help()\" for help.                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nPlease wait while the Jupyterlab server starts...\n[I 2022-04-04 00:50:38.225 ServerApp] jupyterlab | extension was successfully linked.\n[W 2022-04-04 00:50:38.230 NotebookApp] 'disable_check_xsrf' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.\n[I 2022-04-04 00:50:38.239 ServerApp] nbclassic | extension was successfully linked.\n[I 2022-04-04 00:50:38.489 ServerApp] notebook_shim | extension was successfully linked.\n[I 2022-04-04 00:50:38.588 ServerApp] notebook_shim | extension was successfully loaded.\n[I 2022-04-04 00:50:38.590 LabApp] JupyterLab extension loaded from /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/jupyterlab\n[I 2022-04-04 00:50:38.590 LabApp] JupyterLab application directory is /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.10/share/jupyter/lab\n[I 2022-04-04 00:50:38.594 ServerApp] jupyterlab | extension was successfully loaded.\n[I 2022-04-04 00:50:38.601 ServerApp] nbclassic | extension was successfully loaded.\n[I 2022-04-04 00:50:38.602 ServerApp] The port 8888 is already in use, trying another port.\n[I 2022-04-04 00:50:38.603 ServerApp] Serving notebooks from local directory: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11\n[I 2022-04-04 00:50:38.603 ServerApp] Jupyter Server 1.15.6 is running at:\n[I 2022-04-04 00:50:38.603 ServerApp] http://localhost:8889/lab?token=...\n[I 2022-04-04 00:50:38.603 ServerApp]  or http://127.0.0.1:8889/lab?token=...\n[I 2022-04-04 00:50:38.603 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).\n```\n\nProbably, if possible, the instructions should be refined so that the server app does not fall back to another port but rather gives a hard error.",
    "created_at": "2022-04-04T08:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471648",
    "user": "@mkoeppe"
}
```

I just tried the full docbuild from scratch with the local Jupyter. The build first failed with

```
[sagemath_doc_html-none] [reference] preparing documents... skipping loading of indexes... done
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:34: WARNING: unknown document: categories/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:41: WARNING: unknown document: polynomial_rings/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:43: WARNING: unknown document: finite_rings/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:58: WARNING: unknown document: calculus/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:84: WARNING: unknown document: combinat/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:85: WARNING: unknown document: graphs/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:89: WARNING: unknown document: coding/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:90: WARNING: unknown document: cryptography/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:99: WARNING: unknown document: discrete_geometry/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:102: WARNING: unknown document: manifolds/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:133: WARNING: unknown document: curves/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:134: WARNING: unknown document: arithmetic_curves/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:139: WARNING: unknown document: databases/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:149: WARNING: unknown document: misc/index
[sagemath_doc_html-none] [reference] /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/doc/en/reference/index.rst:150: WARNING: unknown document: doctest/index
[sagemath_doc_html-none] [reference] The inventory files are in local/share/doc/sage/inventory/en/reference.
[sagemath_doc_html-none] Error building the documentation.
```

but re-running it, it succeeded. 

Then, running the command from the ticket description, I got:

```
$ sage --notebook=jupyterlab --ServerApp.token='secret' --ServerApp.allow_origin='null' --ServerApp.disable_check_xsrf=true --ServerApp.open_browser=false
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.6.beta7, Release Date: 2022-04-02               │
│ Using Python 3.10.2. Type "help()" for help.                       │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
Please wait while the Jupyterlab server starts...
[I 2022-04-04 00:50:38.225 ServerApp] jupyterlab | extension was successfully linked.
[W 2022-04-04 00:50:38.230 NotebookApp] 'disable_check_xsrf' has moved from NotebookApp to ServerApp. This config will be passed to ServerApp. Be sure to update your config before our next release.
[I 2022-04-04 00:50:38.239 ServerApp] nbclassic | extension was successfully linked.
[I 2022-04-04 00:50:38.489 ServerApp] notebook_shim | extension was successfully linked.
[I 2022-04-04 00:50:38.588 ServerApp] notebook_shim | extension was successfully loaded.
[I 2022-04-04 00:50:38.590 LabApp] JupyterLab extension loaded from /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/jupyterlab
[I 2022-04-04 00:50:38.590 LabApp] JupyterLab application directory is /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.10/share/jupyter/lab
[I 2022-04-04 00:50:38.594 ServerApp] jupyterlab | extension was successfully loaded.
[I 2022-04-04 00:50:38.601 ServerApp] nbclassic | extension was successfully loaded.
[I 2022-04-04 00:50:38.602 ServerApp] The port 8888 is already in use, trying another port.
[I 2022-04-04 00:50:38.603 ServerApp] Serving notebooks from local directory: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11
[I 2022-04-04 00:50:38.603 ServerApp] Jupyter Server 1.15.6 is running at:
[I 2022-04-04 00:50:38.603 ServerApp] http://localhost:8889/lab?token=...
[I 2022-04-04 00:50:38.603 ServerApp]  or http://127.0.0.1:8889/lab?token=...
[I 2022-04-04 00:50:38.603 ServerApp] Use Control-C to stop this server and shut down all kernels (twice to skip confirmation).
```

Probably, if possible, the instructions should be refined so that the server app does not fall back to another port but rather gives a hard error.



---

archive/issue_comments_471649.json:
```json
{
    "body": "Overall, this looks quite promising, but I think there are still a few things that need to be improved to make it ready for the public. One thing is that the interaction is very limited - one cannot edit the inputs, so all one can do is reproduce the result that the doctest is already showing. (Also, in doctest blocks with more than one command, it only shows the last result or the first error.)",
    "created_at": "2022-04-04T08:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471649",
    "user": "@mkoeppe"
}
```

Overall, this looks quite promising, but I think there are still a few things that need to be improved to make it ready for the public. One thing is that the interaction is very limited - one cannot edit the inputs, so all one can do is reproduce the result that the doctest is already showing. (Also, in doctest blocks with more than one command, it only shows the last result or the first error.)



---

archive/issue_comments_471650.json:
```json
{
    "body": "Replying to [comment:63 mkoeppe]:\n> I just tried the full docbuild from scratch with the local Jupyter. The build first failed with ... but re-running it, it succeeded. \n\nYou mean `make doc-clean; make doc-uninstall; make`? \n\nThe first failure seems not related with this ticket...\n\n> Probably, if possible, the instructions should be refined so that the server app does not fall back to another port but rather gives a hard error.\n\nDone.",
    "created_at": "2022-04-04T08:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471650",
    "user": "@kwankyu"
}
```

Replying to [comment:63 mkoeppe]:
> I just tried the full docbuild from scratch with the local Jupyter. The build first failed with ... but re-running it, it succeeded. 

You mean `make doc-clean; make doc-uninstall; make`? 

The first failure seems not related with this ticket...

> Probably, if possible, the instructions should be refined so that the server app does not fall back to another port but rather gives a hard error.

Done.



---

archive/issue_comments_471651.json:
```json
{
    "body": "Replying to [comment:64 mkoeppe]:\n> Overall, this looks quite promising, but I think there are still a few things that need to be improved to make it ready for the public. One thing is that the interaction is very limited - one cannot edit the inputs, so all one can do is reproduce the result that the doctest is already showing.\n\nI think this is the primary purpose of the documentation -- running the examples as they are. If they want to do variations, they should go to jupyter and copy-paste.\n\nOf course, it is easy to allow user modifications. A couple of configuration changes. But first we have to decide what behavior we want.\n\n> (Also, in doctest blocks with more than one command, it only shows the last result or the first error.)\n\nThis is to be done by editing the documentation. We cannot make jupyter-sphinx an AI.",
    "created_at": "2022-04-04T08:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471651",
    "user": "@kwankyu"
}
```

Replying to [comment:64 mkoeppe]:
> Overall, this looks quite promising, but I think there are still a few things that need to be improved to make it ready for the public. One thing is that the interaction is very limited - one cannot edit the inputs, so all one can do is reproduce the result that the doctest is already showing.

I think this is the primary purpose of the documentation -- running the examples as they are. If they want to do variations, they should go to jupyter and copy-paste.

Of course, it is easy to allow user modifications. A couple of configuration changes. But first we have to decide what behavior we want.

> (Also, in doctest blocks with more than one command, it only shows the last result or the first error.)

This is to be done by editing the documentation. We cannot make jupyter-sphinx an AI.



---

archive/issue_comments_471652.json:
```json
{
    "body": "Replying to [comment:67 klee]:\n> > (Also, in doctest blocks with more than one command, it only shows the last result or the first error.)\n> \n> This is to be done by editing the documentation. We cannot make jupyter-sphinx an AI.\n\nWe can get output from each input line. Then we will have \"Run\" button for each line. Do we want that?",
    "created_at": "2022-04-04T08:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471652",
    "user": "@kwankyu"
}
```

Replying to [comment:67 klee]:
> > (Also, in doctest blocks with more than one command, it only shows the last result or the first error.)
> 
> This is to be done by editing the documentation. We cannot make jupyter-sphinx an AI.

We can get output from each input line. Then we will have "Run" button for each line. Do we want that?



---

archive/issue_comments_471653.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-05T09:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471653",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471654.json:
```json
{
    "body": "With the latest commit, live doc building is almost as fast as building the static doc.",
    "created_at": "2022-04-05T09:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471654",
    "user": "@kwankyu"
}
```

With the latest commit, live doc building is almost as fast as building the static doc.



---

archive/issue_comments_471655.json:
```json
{
    "body": "Selective build works now well. You can quickly switch between binder server and local server.",
    "created_at": "2022-04-05T09:38:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471655",
    "user": "@kwankyu"
}
```

Selective build works now well. You can quickly switch between binder server and local server.



---

archive/issue_comments_471656.json:
```json
{
    "body": "As live doc building is as fast as building static doc, it makes sense to switch to the live doc (with binder server) as default. Binder servers seem slow though (at least to me).",
    "created_at": "2022-04-05T09:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471656",
    "user": "@kwankyu"
}
```

As live doc building is as fast as building static doc, it makes sense to switch to the live doc (with binder server) as default. Binder servers seem slow though (at least to me).



---

archive/issue_comments_471657.json:
```json
{
    "body": "I think the branch is good enough (frankly, very nice!) to make it into sage 9.6, as this ticket supersedes #33507: `sagemath_doc_html: Use jupyter-sphinx for 3D graphics`.",
    "created_at": "2022-04-05T09:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471657",
    "user": "@kwankyu"
}
```

I think the branch is good enough (frankly, very nice!) to make it into sage 9.6, as this ticket supersedes #33507: `sagemath_doc_html: Use jupyter-sphinx for 3D graphics`.



---

archive/issue_comments_471658.json:
```json
{
    "body": "I just found this project:\n\nhttps://sphinx-thebe.readthedocs.io/en/latest/index.html\n\nIt may be more suitable for us.",
    "created_at": "2022-04-11T08:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471658",
    "user": "@kwankyu"
}
```

I just found this project:

https://sphinx-thebe.readthedocs.io/en/latest/index.html

It may be more suitable for us.



---

archive/issue_comments_471659.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-04-11T08:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471659",
    "user": "@kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_471660.json:
```json
{
    "body": "Replying to [comment:78 klee]:\n> https://sphinx-thebe.readthedocs.io/en/latest/index.html\n> \n> It may be more suitable for us.\n\nsphinx-thebe translates nodes\n\n```\n.. container::\n   :class: thebe\n   \n   1 + 1\n```\n\nto html elements that can be activated by thebe.\n\njupyter-sphinx executes nodes\n\n```\n.. jupyter_execute::\n\n   1 + 1\n```\n\nby jupyter and insert the output to the built htmls and can also insert html elements that can be activated by thebe.\n\nPresently we are using jupyter-sphinx but suppressing jupyter execution part (somewhat clumsily), which we don't need currently.\n\nThere is also a discussion (https://github.com/jupyter/jupyter-sphinx/issues/137) about using sphinx-thebe for jupyter-sphinx's thebe part. It is unclear how much this progressed.\n\nSo I think that from where we stand, there is no clear benefit of switching to sphinx-thebe.",
    "created_at": "2022-04-12T06:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471660",
    "user": "@kwankyu"
}
```

Replying to [comment:78 klee]:
> https://sphinx-thebe.readthedocs.io/en/latest/index.html
> 
> It may be more suitable for us.

sphinx-thebe translates nodes

```
.. container::
   :class: thebe
   
   1 + 1
```

to html elements that can be activated by thebe.

jupyter-sphinx executes nodes

```
.. jupyter_execute::

   1 + 1
```

by jupyter and insert the output to the built htmls and can also insert html elements that can be activated by thebe.

Presently we are using jupyter-sphinx but suppressing jupyter execution part (somewhat clumsily), which we don't need currently.

There is also a discussion (https://github.com/jupyter/jupyter-sphinx/issues/137) about using sphinx-thebe for jupyter-sphinx's thebe part. It is unclear how much this progressed.

So I think that from where we stand, there is no clear benefit of switching to sphinx-thebe.



---

archive/issue_comments_471661.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-12T06:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471661",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471662.json:
```json
{
    "body": "#33507 introduced a performance regression in sage html documentation by inserting \n\n```\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js\"></script>\n<script src=\"https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js\"></script>\n```\n  \nwhich loads rather big javascripts to every page and incurs a slow page loading. You may notice this if compared with the previous sage documentation.\n\nThe last commit contains a patch to fix this.",
    "created_at": "2022-04-12T07:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471662",
    "user": "@kwankyu"
}
```

#33507 introduced a performance regression in sage html documentation by inserting 

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
```
  
which loads rather big javascripts to every page and incurs a slow page loading. You may notice this if compared with the previous sage documentation.

The last commit contains a patch to fix this.



---

archive/issue_comments_471663.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-12T07:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471663",
    "user": "@kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_471664.json:
```json
{
    "body": "Is there a way to fix this with a patch that could be accepted upstream? \n\n(See #31543)",
    "created_at": "2022-04-12T16:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471664",
    "user": "@mkoeppe"
}
```

Is there a way to fix this with a patch that could be accepted upstream? 

(See #31543)



---

archive/issue_comments_471665.json:
```json
{
    "body": "Replying to [comment:84 mkoeppe]:\n> Is there a way to fix this with a patch that could be accepted upstream? \n> \n> (See #31543)\n\nThere would be no simple patch. Even if there is a (big) patch, they may not accept it because it is not fixing a bug. \n\nIf we don't like patched source, then perhaps we should switch to sphinx-thebe.",
    "created_at": "2022-04-13T00:10:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471665",
    "user": "@kwankyu"
}
```

Replying to [comment:84 mkoeppe]:
> Is there a way to fix this with a patch that could be accepted upstream? 
> 
> (See #31543)

There would be no simple patch. Even if there is a (big) patch, they may not accept it because it is not fixing a bug. 

If we don't like patched source, then perhaps we should switch to sphinx-thebe.



---

archive/issue_comments_471666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-13T04:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471666",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471667.json:
```json
{
    "body": "Replying to [comment:67 klee]:\n> Replying to [comment:64 mkoeppe]:\n> > One thing is that the interaction is very limited - one cannot edit the inputs, so all one can do is reproduce the result that the doctest is already showing.\n> \n> I think this is the primary purpose of the documentation -- running the examples as they are. If they want to do variations, they should go to jupyter and copy-paste.\n> \n> Of course, it is easy to allow user modifications. A couple of configuration changes. But first we have to decide what behavior we want.\n\nUsing live docs, I realized that many example code blocks in sage documentation are not ready for live run, and frequently needs user's editing before run. Hence I changed my mind, and the last commit makes code blocks editable.",
    "created_at": "2022-04-13T04:38:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471667",
    "user": "@kwankyu"
}
```

Replying to [comment:67 klee]:
> Replying to [comment:64 mkoeppe]:
> > One thing is that the interaction is very limited - one cannot edit the inputs, so all one can do is reproduce the result that the doctest is already showing.
> 
> I think this is the primary purpose of the documentation -- running the examples as they are. If they want to do variations, they should go to jupyter and copy-paste.
> 
> Of course, it is easy to allow user modifications. A couple of configuration changes. But first we have to decide what behavior we want.

Using live docs, I realized that many example code blocks in sage documentation are not ready for live run, and frequently needs user's editing before run. Hence I changed my mind, and the last commit makes code blocks editable.



---

archive/issue_comments_471668.json:
```json
{
    "body": "Note that code-mirror configuration doesn't work. It seems an issue of the current thebe.",
    "created_at": "2022-04-13T04:41:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471668",
    "user": "@kwankyu"
}
```

Note that code-mirror configuration doesn't work. It seems an issue of the current thebe.



---

archive/issue_comments_471669.json:
```json
{
    "body": "Note also that it is now a lot easy to copy-paste code blocks into jupyter :)",
    "created_at": "2022-04-13T04:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471669",
    "user": "@kwankyu"
}
```

Note also that it is now a lot easy to copy-paste code blocks into jupyter :)



---

archive/issue_comments_471670.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-24T07:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471670",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471671.json:
```json
{
    "body": "The last commit fixes a bug that causes a failure when `.. JUPYTER_EXECUTE::` is directly used without `execute` tag.",
    "created_at": "2022-04-24T08:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471671",
    "user": "@kwankyu"
}
```

The last commit fixes a bug that causes a failure when `.. JUPYTER_EXECUTE::` is directly used without `execute` tag.



---

archive/issue_comments_471672.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-25T07:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471672",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471673.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-04-29T19:00:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33083",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33083#issuecomment-471673",
    "user": "@kwankyu"
}
```

Changing status from needs_review to needs_work.
