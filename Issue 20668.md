# Issue 20668: converting frobby into a new-style package

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2016-06-29 14:19:31

CC:  vdelecroix mkoeppe

currenly frobby is broken due to a C++ issue which Macaulay2 people know how to fix.

This ticket will convert frobby into a new-style package and apply this fix.


---

Comment by dimpase created at 2016-06-29 15:57:15

New commits:


---

Comment by git created at 2016-06-30 09:02:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-06-30 09:06:38

`SPKG_CHECK=yes sage -i frobby` returns OK, and all the tests in the frobby interface pass. There are some C++ issues in the debugging version of the program, but they can be ignored for our purposes.


---

Comment by dimpase created at 2016-06-30 09:06:38

Changing status from new to needs_review.


---

Comment by embray created at 2016-06-30 15:23:34

Does frobby have any dependencies that should be listed?


---

Comment by dimpase created at 2016-06-30 15:29:30

Replying to [comment:6 embray]:
> Does frobby have any dependencies that should be listed?

it only depends on a standard Sage package (MPIR - which is impersonating GMP here).


---

Comment by embray created at 2016-06-30 15:41:38

Probably still good to add a `dependencies` file for that.  You can use `$(MP_LIBRARY)` for this.


---

Comment by git created at 2016-06-30 15:47:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-06-30 15:49:37

Replying to [comment:8 embray]:
> Probably still good to add a `dependencies` file for that.  You can use `$(MP_LIBRARY)` for this.

done. Indeed, this seems to be the correct thing to do.


---

Comment by mkoeppe created at 2016-07-07 20:22:53

Upstream tarball = ?


---

Comment by mkoeppe created at 2016-07-07 21:09:14

`sage -f -c frobby` gives:

```
[frobby-0.9.0.p2] Running the test suite for frobby-0.9.0.p2...
[frobby-0.9.0.p2] g++   -Wall -I /Users/mkoeppe/cvs/sage/local/include -Wno-uninitialized -Wno-unused-parameter -std=c++11 -g -D DEBUG -fno-inline -Wextra -Wno-uninitialized -Wno-unused-parameter -c src/main.cpp -o bin/debug/main.o
[frobby-0.9.0.p2] In file included from /Users/mkoeppe/cvs/sage/local/include/c++/4.9.2/map:60:0,
[frobby-0.9.0.p2]                  from src/CliParams.h:24,
[frobby-0.9.0.p2]                  from src/Action.h:21,
[frobby-0.9.0.p2]                  from src/main.cpp:20:
[frobby-0.9.0.p2] /Users/mkoeppe/cvs/sage/local/include/c++/4.9.2/bits/stl_tree.h: In member function 'std::_Rb_tree_node<_Val>* std::_Rb_tree<_Key, _Val, _KeyOfValue, _Compare, _Alloc>::_M_create_node(_Args&& ...)':
[frobby-0.9.0.p2] /Users/mkoeppe/cvs/sage/local/include/c++/4.9.2/bits/stl_tree.h:420:14: error: '__tmp' does not name a type
[frobby-0.9.0.p2]         ::new(__tmp) _Rb_tree_node<_Val>;
[frobby-0.9.0.p2]               ^
[frobby-0.9.0.p2] make[2]: *** [bin/debug/main.o] Error 1
```

but then it happily continues ("All normal tests passed.")


---

Comment by mkoeppe created at 2016-07-07 21:15:55

Also, there is the optional frobgrob script, which depends on 4ti2. See the manual


---

Comment by dimpase created at 2016-07-07 21:24:02

Replying to [comment:13 mkoeppe]:
> `sage -f -c frobby` gives:
> {{{
> [frobby-0.9.0.p2] Running the test suite for frobby-0.9.0.p2...
> [frobby-0.9.0.p2] g++   -Wall -I /Users/mkoeppe/cvs/sage/local/include -Wno-uninitialized -Wno-unused-parameter -std=c++11 -g -D DEBUG -fno-inline -Wextra -Wno-uninitialized -Wno-unused-parameter -c src/main.cpp -o bin/debug/main.o
> [frobby-0.9.0.p2] In file included from /Users/mkoeppe/cvs/sage/local/include/c++/4.9.2/map:60:0,
> [frobby-0.9.0.p2]                  from src/CliParams.h:24,
> [frobby-0.9.0.p2]                  from src/Action.h:21,
> [frobby-0.9.0.p2]                  from src/main.cpp:20:
> [frobby-0.9.0.p2] /Users/mkoeppe/cvs/sage/local/include/c++/4.9.2/bits/stl_tree.h: In member function 'std::_Rb_tree_node<_Val>* std::_Rb_tree<_Key, _Val, _KeyOfValue, _Compare, _Alloc>::_M_create_node(_Args&& ...)':
> [frobby-0.9.0.p2] /Users/mkoeppe/cvs/sage/local/include/c++/4.9.2/bits/stl_tree.h:420:14: error: '__tmp' does not name a type
> [frobby-0.9.0.p2]         ::new(__tmp) _Rb_tree_node<_Val>;
> [frobby-0.9.0.p2]               ^
> [frobby-0.9.0.p2] make[2]: *** [bin/debug/main.o] Error 1
> }}}
> but then it happily continues ("All normal tests passed.")

yes, I have seen this. This concerns debugging version of the program only, IMHO. My C++ is too rusty to get any idea what goes wrong there, besides vague recollections of "iterator traits" etc I got nightmares about... Hopefully it's OK as it is.


---

Comment by dimpase created at 2016-07-07 21:25:59

Replying to [comment:14 mkoeppe]:
> Also, there is the optional frobgrob script, which depends on 4ti2. See the manual

should 4ti2 be in frobby dependencies?


---

Comment by mkoeppe created at 2016-07-07 21:29:52

Replying to [comment:16 dimpase]:
> Replying to [comment:14 mkoeppe]:
> > Also, there is the optional frobgrob script, which depends on 4ti2. See the manual
> 
> should 4ti2 be in frobby dependencies? 

If I understand the manual correctly, 4ti2 is only used by the frobgrob script, which is currently not installed.
I think it should be installed; and 4ti2 should be a "recommended package" rather than a real dependency (like those many packages that one "should" install before polymake).


---

Comment by mkoeppe created at 2016-07-07 21:37:02

(However, Debian for example does not install "frobgrob".)


---

Comment by tscrim created at 2016-07-08 04:35:35

Judging only from the warning, I think the warning is coming from the fact that the forward declaration of `new` in the header has an input parameter `__tmp` that not been given an explicit type. Just add the type given in the implementation to the header and it should go away.


---

Comment by mkoeppe created at 2016-07-11 20:09:41

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2016-07-11 20:09:41

Follow-up (frobgrob): #21004.


---

Comment by vbraun created at 2016-07-12 07:26:48

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2016-07-12 07:26:48

Reviewer name


---

Comment by mkoeppe created at 2016-07-12 08:14:59

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-07-13 18:35:43

Resolution: fixed
