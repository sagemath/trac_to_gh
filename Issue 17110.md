# Issue 17110: matplotlib 1.3.1 breaks Sage make build

Issue created by migration from https://trac.sagemath.org/ticket/17347

Original creator: darij

Original creation time: 2014-11-15 00:35:35

Keywords: matplotlib, make, install

https://www.dropbox.com/s/geklcqrouaejj2k/mpl-fail.log?dl=0

Also, sage doesn't want to build without an internet connection because of matplotlib. Not sure if this is correct behavior.


---

Comment by jdemeyer created at 2014-11-15 09:36:22

Which version of Sage is this?


---

Comment by darij created at 2014-11-15 16:08:47

The newest one, 6.4.


---

Comment by vbraun created at 2014-11-16 18:47:45

Building shall not require internet. This is also kind-of tested on the buildbot my poisoning the proxy variables.


---

Comment by darij created at 2014-11-16 18:48:59

Building does require internet: it breaks with a socket exception if I am offline. Good to hear that this is not supposed to be so, but it is a bug.


---

Comment by vbraun created at 2014-11-16 18:54:53

I think there is something wrong with your installation, it can't find numpy but we do install numpy before matplotlib. Also, your log is multiple concatenated logs. Try "make distclean && make"


---

Comment by fbissey created at 2014-11-16 22:03:57


```
BUILDING MATPLOTLIB
            matplotlib: yes [1.3.1]
                python: yes [2.7.8 (default, Jul 19 2014, 08:57:06)  [GCC
                        4.6.3]]
              platform: yes [linux2]

REQUIRED DEPENDENCIES AND EXTENSIONS
                 numpy: yes [version 1.8.1]
              dateutil: yes [using dateutil version 2.2]
               tornado: yes [tornado was not found. It is required for the
                        WebAgg backend. pip/easy_install may attempt to
                        install it after matplotlib.]
             pyparsing: yes [using pyparsing version 2.0.1]
                 pycxx: yes [Couldn't import.  Using local copy.]
                libagg: yes [pkg-config information for 'libagg' could not
                        be found. Using local copy.]
              freetype: yes [version 17.1.11]
                   png: yes [version 1.2.51]
```

It says tornado was not found. numpy is found, and tornado is listed as a dep of ipython but not matplotib. Which is funny because I thought tornado was included in sage because it was unbundled from matplotlib in version 1.3 and I am thought it was part of the matplotlib ticket. If not I am considering myself negligent because I spent quite some time reviewing the ticket - including having to get pkg-config included for it.


---

Comment by fbissey created at 2014-11-16 22:23:47

Ha now I understand your comment Volker. It is rather incriminating that in the first install attempt only tornado was not found (and it is a proper dep of matplotlib I didn't look properly the first time) but in the last attempt numpy was not found. I think someone messed up their install by that stage.


---

Comment by darij created at 2014-11-17 01:36:11

So there is a dependency of matplotlib which is not scheduled for installation before matplotlib by the makefile? Or is the tornado thing a red herring?

Anyway, thank you -- `make distclean` fixed it. Feel free to drop this ticket if there is nothing in here that remains to be fixed.


---

Comment by fbissey created at 2014-11-17 01:40:23

Replying to [comment:8 darij]:
> So there is a dependency of matplotlib which is not scheduled for installation before matplotlib by the makefile? Or is the tornado thing a red herring?

A red herring it was at the top of the file you put on dropbox, may be it wasn't done the first time you installed MPL on 6.4.betaX but it is sorted now.

> 
> Anyway, thank you -- `make distclean` fixed it. Feel free to drop this ticket if there is nothing in here that remains to be fixed.

I don't think so. I think your install was in a unhappy state for some reason. the distclean restored it a clean and happy state. 

I personally think this should be closed.


---

Comment by fbissey created at 2014-11-17 01:40:23

Resolution: invalid


---

Comment by jdemeyer created at 2014-11-17 08:10:04

For the record, both numpy and tornado are listed as explicit dependencies of matplotlib in `build/deps`. So I agree that there is no bug here.
