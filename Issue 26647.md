# Issue 26647: Replace Combinatorial Object to Clonable List in DickWords

Issue created by migration from Trac.

Original creator: boussica

Original creation time: 2018-12-12 16:27:42

CC:  vklein hivert

Part of #26883 meta-ticket.


---

Comment by vklein created at 2018-12-12 16:31:36

New commits:


---

Comment by vklein created at 2018-12-12 17:43:32

rebase on 8.5.rc0
----
New commits:


---

Comment by git created at 2018-12-14 15:07:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-12-14 17:02:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hivert created at 2018-12-14 17:11:00

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-12-15 08:01:57

one pyflakes warning (see patchbot plugins); coverage not 100%


---

Comment by chapoton created at 2018-12-15 08:01:57

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-12-16 00:08:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by hivert created at 2018-12-16 00:09:26

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-12-16 01:00:19

-1 on going through an essentially trivial `_element_constructor_` in internal code that should give valid output. At the very least, you should not run the checks when constructing objects from internal code.

I am also a little skeptical of this change:

```diff
-        if isinstance(word, DyckWord) and word.parent() is self:
+        D = DyckWords_all()
+        if isinstance(word, DyckWord) and word.parent() is D:
             return word
-        return self.element_class(self, list(word))
+        return D.element_class(D, word)
```

`_element_constructor_` should return an element of ``self`` as these are not façade parents. (Actually, the first check here can be removed because the coercion framework would have already caught that case before it got to the `_element_constructor_`.)

Given this change, I am very nervous about the resulting parent of the Dyck path. I suspect you are doing this because `ClonableList` also includes the parent in the check and you are subsequently forcing everything to be elements of the `DyckWords_all` to have comparisons work. This is bad practice and can mask a host of other subtle issues, especially when mixing façade parents with code that is making a parent act like a façade parent.

This looks like a bug to me:

```diff
                 sage: DyckWords().height_poset().an_element()   # indirect doctest
-                [1, 0, 1, 0, 1, 0, 1, 0, 1, 0]
+                [1, 0, 1, 0, 1, 0, 1, 0, 1, 1]
```



---

Comment by tscrim created at 2018-12-16 01:00:29

Changing status from needs_review to needs_work.


---

Comment by embray created at 2019-01-15 18:15:21

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by hivert created at 2019-06-21 08:21:00

Replying to [comment:12 tscrim]:
> -1 on going through an essentially trivial `_element_constructor_` in internal code that should give valid output. At the very least, you should not run the checks when constructing objects from internal code.

This is something that we need to discuss in relation with set factories. The idea of those is to allow the user to change the class and parent on an enumerating algorithm. Here you hardcoded the class and the parent. I strongly disagree with that. I'm using  `_element_constructor_` as a single entry point to allows for customisation.
 
> `_element_constructor_` should return an element of ``self`` as these are not façade parents. (Actually, the first check here can be removed because the coercion framework would have already caught that case before it got to the `_element_constructor_`.)

Again this is something that shoul'nt be hard coded.

> I suspect you are doing this because `ClonableList` also includes the parent in the check and you are subsequently forcing everything to be elements of the `DyckWords_all` to have comparisons work. 

I'm not doing anything particular with parent for comparison that following the standard `element.__richcmp__` mechanism which compare the parent or use a coercion mechanism to ensure that the elements have the same parent. It seem that you decided to change this overall policy for some particular combinatorial objects which confuses me. 

> This is bad practice and can mask a host of other subtle issues, especially when mixing façade parents with code that is making a parent act like a façade parent. 

Any examples ?


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
