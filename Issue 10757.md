# Issue 10757: environment variable SAGE_SPKG_INSTALL_DOCS to build and install spkg docs

archive/issues_010757.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  drkirkby @kcrisman\n\nThere are lots of times when it would be convenient to have the documentation of various spkgs installed in a local or system Sage installation.  For example, it seems that I'm always wishing that I had that at an airport or on an airplane.  At one point a long time ago, we had an extradocs spkg, but it was never maintained.  So here is a proposal:\n\nWhen building an spkg, if the SAGE_SPKG_INSTALL_DOCS environment variable is yes, then the docs are built (if available in the spkg) and are installed in $SAGE_ROOT/local/share/doc/<SPKG NAME>/\n\nFor example, numpy includes the docs with the sources.  I'd like to insert the following at the bottom of the numpy spkg-install:\n\n```\nif [ \"x$SAGE_SPKG_INSTALL_DOCS\" = xyes ] ; then\n    cd doc\n    make html\n    if [ $? -ne 0 ]; then\n    echo \"Error building numpy.\"\n    exit 1\n    fi\n    mkdir -p $SAGE_ROOT/local/share/doc/numpy\n    cp -r build/html $SAGE_ROOT/local/share/doc/numpy\nfi\n```\nThis builds the numpy docs and makes a directory $SAGE_ROOT/local/share/doc/numpy/html/ that contains the standalone html documentation for numpy.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10823\n\n",
    "created_at": "2011-02-22T20:26:49Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "environment variable SAGE_SPKG_INSTALL_DOCS to build and install spkg docs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10757",
    "user": "https://github.com/jasongrout"
}
```
Assignee: tbd

CC:  drkirkby @kcrisman

There are lots of times when it would be convenient to have the documentation of various spkgs installed in a local or system Sage installation.  For example, it seems that I'm always wishing that I had that at an airport or on an airplane.  At one point a long time ago, we had an extradocs spkg, but it was never maintained.  So here is a proposal:

When building an spkg, if the SAGE_SPKG_INSTALL_DOCS environment variable is yes, then the docs are built (if available in the spkg) and are installed in $SAGE_ROOT/local/share/doc/<SPKG NAME>/

For example, numpy includes the docs with the sources.  I'd like to insert the following at the bottom of the numpy spkg-install:

```
if [ "x$SAGE_SPKG_INSTALL_DOCS" = xyes ] ; then
    cd doc
    make html
    if [ $? -ne 0 ]; then
    echo "Error building numpy."
    exit 1
    fi
    mkdir -p $SAGE_ROOT/local/share/doc/numpy
    cp -r build/html $SAGE_ROOT/local/share/doc/numpy
fi
```
This builds the numpy docs and makes a directory $SAGE_ROOT/local/share/doc/numpy/html/ that contains the standalone html documentation for numpy.

Issue created by migration from https://trac.sagemath.org/ticket/10823





---

archive/issue_comments_113514.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-02-22T21:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113514",
    "user": "https://github.com/jasongrout"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_113515.json:
```json
{
    "body": "CCing our resident shell script expert for comments: David, is there anything else that should be done in the above snippet of shell script?",
    "created_at": "2011-02-22T21:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113515",
    "user": "https://github.com/jasongrout"
}
```

CCing our resident shell script expert for comments: David, is there anything else that should be done in the above snippet of shell script?



---

archive/issue_comments_113516.json:
```json
{
    "body": "Replying to [comment:6 jason]:\n> CCing our resident shell script expert for comments: David, is there anything else that should be done in the above snippet of shell script?\n\n\nI would indent the \n\n```\n    echo \"Error building numpy docs.\"\n    exit 1\n```\n\nfor clarity. Apart from that, it looks OK. It will put the docs in a directory \n\n```\n$SAGE_ROOT/local/share/doc/numpy/html\n```\n\nnot \n\n```\n$SAGE_ROOT/local/share/doc/numpy\n```\n\nbut I think that's a good idea, as some docs might be in pdf, others in html etc. \n\nI think it would be more normal to copy the files, rather than move them, so the build directory remains intact. (It usually gets deleted anyway, but there are ways of saving the contents). \n\nOverall, I think this is a good proposal. Lots of programs used by Sage have documentation which we don't use. There may be other tools needed to generate some of the files - (GNU info for example). In cases like that, it might be worth checking if the right tool existed.",
    "created_at": "2011-02-22T23:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113516",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Replying to [comment:6 jason]:
> CCing our resident shell script expert for comments: David, is there anything else that should be done in the above snippet of shell script?


I would indent the 

```
    echo "Error building numpy docs."
    exit 1
```

for clarity. Apart from that, it looks OK. It will put the docs in a directory 

```
$SAGE_ROOT/local/share/doc/numpy/html
```

not 

```
$SAGE_ROOT/local/share/doc/numpy
```

but I think that's a good idea, as some docs might be in pdf, others in html etc. 

I think it would be more normal to copy the files, rather than move them, so the build directory remains intact. (It usually gets deleted anyway, but there are ways of saving the contents). 

Overall, I think this is a good proposal. Lots of programs used by Sage have documentation which we don't use. There may be other tools needed to generate some of the files - (GNU info for example). In cases like that, it might be worth checking if the right tool existed.



---

archive/issue_comments_113517.json:
```json
{
    "body": "PS, \nI think the Sage users (or is it developers?) guide needs to be modified to document the variable. One of the manuals, (I forget which) has all the environment variables documented on one page. So I think the changes to the documentation need to be reviewed here, which will be a trivial review. \n\nThen each .spkg with the changes would need to be on separate tickets.",
    "created_at": "2011-02-22T23:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113517",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

PS, 
I think the Sage users (or is it developers?) guide needs to be modified to document the variable. One of the manuals, (I forget which) has all the environment variables documented on one page. So I think the changes to the documentation need to be reviewed here, which will be a trivial review. 

Then each .spkg with the changes would need to be on separate tickets.



---

archive/issue_comments_113518.json:
```json
{
    "body": "Okay, the doc patches are up here and the description notes which tickets are for the spkgs that I put up earlier.",
    "created_at": "2011-02-23T01:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113518",
    "user": "https://github.com/jasongrout"
}
```

Okay, the doc patches are up here and the description notes which tickets are for the spkgs that I put up earlier.



---

archive/issue_comments_113519.json:
```json
{
    "body": "Okay, that's it for now, so feel free to review this and the spkgs noted in the description!",
    "created_at": "2011-02-23T03:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113519",
    "user": "https://github.com/jasongrout"
}
```

Okay, that's it for now, so feel free to review this and the spkgs noted in the description!



---

archive/issue_comments_113520.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-02-25T21:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113520",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_113521.json:
```json
{
    "body": "Sorry for the delay. I spent about an hour replying to this yesterday when my wife accidentally pulled the power cord from my laptop, which did not have a battery in it at the time. So it was all lost. \n\nFrom what I recall\n\n* 'make' should be $MAKE\n* There should be a link added to this page http://www.sagemath.org/doc/ (which is generated from the docs in Sage) to show the place where the new documentation can be found. \n* The line with ` echo \"SAGE_LOCAL undefined ... exiting\";` in `doc/en/developer/producing_spkgs.rst` has an extra semi-colon on the end. Since that is in the same file as here, that might as well be fixed at the same time. Also replace 'make' by $MAKE there.\n* The ticket description shows `make html` but the patch `make doc`. There is no standard way of creating documentation. Hence the developers guide should make it clearer that this section of `spk-install` will probably need changing depending on the package, and should not be copied verbatim and expected to work. \n* There's a possibility that building some of the documentation may require external programs like GNU info, LaTeX. makeinfo etc. This needs to be mentioned in the docs. \n* The patch says the documentation gets installed in the file `$SAGE_ROOT/local/share/doc/SPKG_NAME/`. I think there should be in front of $SPKG_NAME  - just as with SAGE_ROOT. Also, a more accurate description is that the docs are installed in one or more directories below `$SAGE_ROOT/local/share/doc/SPKG_NAME/`\n\nClearly adding the code to the packages is quite simple, but unless it is well documented it's not going to be much use. People must be able to find the documentation, which I think will be most easily done if on the main page http://www.sagemath.org/doc/ \n\nHave you given thought to what is to be done if one can build both HTML and PDF docs? I suggesting building both might be best, but I don't know. \n\nOverall though, I think this is a good idea. \n\nDave",
    "created_at": "2011-02-25T21:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113521",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Sorry for the delay. I spent about an hour replying to this yesterday when my wife accidentally pulled the power cord from my laptop, which did not have a battery in it at the time. So it was all lost. 

From what I recall

* 'make' should be $MAKE
* There should be a link added to this page http://www.sagemath.org/doc/ (which is generated from the docs in Sage) to show the place where the new documentation can be found. 
* The line with ` echo "SAGE_LOCAL undefined ... exiting";` in `doc/en/developer/producing_spkgs.rst` has an extra semi-colon on the end. Since that is in the same file as here, that might as well be fixed at the same time. Also replace 'make' by $MAKE there.
* The ticket description shows `make html` but the patch `make doc`. There is no standard way of creating documentation. Hence the developers guide should make it clearer that this section of `spk-install` will probably need changing depending on the package, and should not be copied verbatim and expected to work. 
* There's a possibility that building some of the documentation may require external programs like GNU info, LaTeX. makeinfo etc. This needs to be mentioned in the docs. 
* The patch says the documentation gets installed in the file `$SAGE_ROOT/local/share/doc/SPKG_NAME/`. I think there should be in front of $SPKG_NAME  - just as with SAGE_ROOT. Also, a more accurate description is that the docs are installed in one or more directories below `$SAGE_ROOT/local/share/doc/SPKG_NAME/`

Clearly adding the code to the packages is quite simple, but unless it is well documented it's not going to be much use. People must be able to find the documentation, which I think will be most easily done if on the main page http://www.sagemath.org/doc/ 

Have you given thought to what is to be done if one can build both HTML and PDF docs? I suggesting building both might be best, but I don't know. 

Overall though, I think this is a good idea. 

Dave



---

archive/issue_comments_113522.json:
```json
{
    "body": "Replying to [comment:17 drkirkby]:\n\n>  * The patch says the documentation gets installed in the file `$SAGE_ROOT/local/share/doc/SPKG_NAME/`. I think there should be in front of $SPKG_NAME  - just as with SAGE_ROOT. Also, a more accurate description is that the docs are installed in one or more directories below `$SAGE_ROOT/local/share/doc/SPKG_NAME/`\n\n\nI meant to say there was a $ sign missing. So it should be\n\n`$SAGE_ROOT/local/share/doc/$SPKG_NAME/`, with files stored in one or more directories below `$SAGE_ROOT/local/share/doc/$SPKG_NAME/`\n\nDave",
    "created_at": "2011-02-26T01:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113522",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Replying to [comment:17 drkirkby]:

>  * The patch says the documentation gets installed in the file `$SAGE_ROOT/local/share/doc/SPKG_NAME/`. I think there should be in front of $SPKG_NAME  - just as with SAGE_ROOT. Also, a more accurate description is that the docs are installed in one or more directories below `$SAGE_ROOT/local/share/doc/SPKG_NAME/`


I meant to say there was a $ sign missing. So it should be

`$SAGE_ROOT/local/share/doc/$SPKG_NAME/`, with files stored in one or more directories below `$SAGE_ROOT/local/share/doc/$SPKG_NAME/`

Dave



---

archive/issue_comments_113523.json:
```json
{
    "body": "Replying to [comment:17 drkirkby]:\n> Sorry for the delay. I spent about an hour replying to this yesterday when my wife accidentally pulled the power cord from my laptop, which did not have a battery in it at the time. So it was all lost. \n> \n\n\nThanks very much for your time and thoughtful care in reviewing this (twice, even!)\n\n\n> From what I recall\n> \n> * 'make' should be $MAKE\n> * The ticket description shows `make html` but the patch `make doc`. There is no standard way of creating documentation. Hence the developers guide should make it clearer that this section of `spk-install` will probably need changing depending on the package, and should not be copied verbatim and expected to work. \n\n\nYou're right that I just put example instructions up there.  Instead, I'll just put a comment (I've modified the description accordingly).\n\n>  * The line with ` echo \"SAGE_LOCAL undefined ... exiting\";` in `doc/en/developer/producing_spkgs.rst` has an extra semi-colon on the end. Since that is in the same file as here, that might as well be fixed at the same time. Also replace 'make' by $MAKE there.\n\n\nOkay, though it's not really in the direct scope of this ticket, since I'm modifying the file anyway, I'll throw this in too.\n\n\n>  * There should be a link added to this page http://www.sagemath.org/doc/ (which is generated from the docs in Sage) to show the place where the new documentation can be found. \n \n> \n> Clearly adding the code to the packages is quite simple, but unless it is well documented it's not going to be much use. People must be able to find the documentation, which I think will be most easily done if on the main page http://www.sagemath.org/doc/ \n\n\nDo you happen to know what file this is generated from?  I'd also consider this a separate ticket, since there are questions about how to deal with this on sagemath.org, and the fact that the link probably ought not be there if we don't generate the docs, maybe.\n\n\n>  * There's a possibility that building some of the documentation may require external programs like GNU info, LaTeX. makeinfo etc. This needs to be mentioned in the docs. \n\n\nFix coming up.\n\n\n>  * The patch says the documentation gets installed in the file `$SAGE_ROOT/local/share/doc/SPKG_NAME/`. I think there should be in front of $SPKG_NAME  - just as with SAGE_ROOT. Also, a more accurate description is that the docs are installed in one or more directories below `$SAGE_ROOT/local/share/doc/SPKG_NAME/`\n\n\nI didn't put the $ since $SPKG_NAME is not a variable that works in the spkg-install file.  My hope was to help them realize that they needed to manually fill in SPKG_NAME.  I'll put a note to that effect.\n\n\n> \n> Have you given thought to what is to be done if one can build both HTML and PDF docs? I suggesting building both might be best, but I don't know. \n\n\nPersonally, in the spkgs I modified, I just built the html documentation unless the default package documentation-building command built pdf too (I believe pari was that way).  I think both might be best, but having just html documentation built requires less (latex is not required, IIRC).\n\n> \n> Overall though, I think this is a good idea. \n\n\nThanks!",
    "created_at": "2011-02-26T03:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113523",
    "user": "https://github.com/jasongrout"
}
```

Replying to [comment:17 drkirkby]:
> Sorry for the delay. I spent about an hour replying to this yesterday when my wife accidentally pulled the power cord from my laptop, which did not have a battery in it at the time. So it was all lost. 
> 


Thanks very much for your time and thoughtful care in reviewing this (twice, even!)


> From what I recall
> 
> * 'make' should be $MAKE
> * The ticket description shows `make html` but the patch `make doc`. There is no standard way of creating documentation. Hence the developers guide should make it clearer that this section of `spk-install` will probably need changing depending on the package, and should not be copied verbatim and expected to work. 


You're right that I just put example instructions up there.  Instead, I'll just put a comment (I've modified the description accordingly).

>  * The line with ` echo "SAGE_LOCAL undefined ... exiting";` in `doc/en/developer/producing_spkgs.rst` has an extra semi-colon on the end. Since that is in the same file as here, that might as well be fixed at the same time. Also replace 'make' by $MAKE there.


Okay, though it's not really in the direct scope of this ticket, since I'm modifying the file anyway, I'll throw this in too.


>  * There should be a link added to this page http://www.sagemath.org/doc/ (which is generated from the docs in Sage) to show the place where the new documentation can be found. 
 
> 
> Clearly adding the code to the packages is quite simple, but unless it is well documented it's not going to be much use. People must be able to find the documentation, which I think will be most easily done if on the main page http://www.sagemath.org/doc/ 


Do you happen to know what file this is generated from?  I'd also consider this a separate ticket, since there are questions about how to deal with this on sagemath.org, and the fact that the link probably ought not be there if we don't generate the docs, maybe.


>  * There's a possibility that building some of the documentation may require external programs like GNU info, LaTeX. makeinfo etc. This needs to be mentioned in the docs. 


Fix coming up.


>  * The patch says the documentation gets installed in the file `$SAGE_ROOT/local/share/doc/SPKG_NAME/`. I think there should be in front of $SPKG_NAME  - just as with SAGE_ROOT. Also, a more accurate description is that the docs are installed in one or more directories below `$SAGE_ROOT/local/share/doc/SPKG_NAME/`


I didn't put the $ since $SPKG_NAME is not a variable that works in the spkg-install file.  My hope was to help them realize that they needed to manually fill in SPKG_NAME.  I'll put a note to that effect.


> 
> Have you given thought to what is to be done if one can build both HTML and PDF docs? I suggesting building both might be best, but I don't know. 


Personally, in the spkgs I modified, I just built the html documentation unless the default package documentation-building command built pdf too (I believe pari was that way).  I think both might be best, but having just html documentation built requires less (latex is not required, IIRC).

> 
> Overall though, I think this is a good idea. 


Thanks!



---

archive/issue_comments_113524.json:
```json
{
    "body": "Replying to [comment:20 jason]:\n> Replying to [comment:17 drkirkby]:\n\n\n\n\n> >  * There should be a link added to this page http://www.sagemath.org/doc/ (which is generated from the docs in Sage) to show the place where the new documentation can be found. \n \n> > \n> > Clearly adding the code to the packages is quite simple, but unless it is well documented it's not going to be much use. People must be able to find the documentation, which I think will be most easily done if on the main page http://www.sagemath.org/doc/ \n\n\n\nThis is now #10853\n\n\n\n> >  * There's a possibility that building some of the documentation may require external programs like GNU info, LaTeX. makeinfo etc. This needs to be mentioned in the docs. \n \n> \n> Fix coming up.\n\n\nDone.\n\n> \n> \n> >  * The patch says the documentation gets installed in the file `$SAGE_ROOT/local/share/doc/SPKG_NAME/`. I think there should be in front of $SPKG_NAME  - just as with SAGE_ROOT. Also, a more accurate description is that the docs are installed in one or more directories below `$SAGE_ROOT/local/share/doc/SPKG_NAME/`\n \n> \n> I didn't put the $ since $SPKG_NAME is not a variable that works in the spkg-install file.  My hope was to help them realize that they needed to manually fill in SPKG_NAME.  I'll put a note to that effect.\n\n\nPACKAGE_NAME is used quite a bit in other places in that file, so I used that.  That is understood in that file to be a placeholder to be replaced for a specific package.",
    "created_at": "2011-02-26T05:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113524",
    "user": "https://github.com/jasongrout"
}
```

Replying to [comment:20 jason]:
> Replying to [comment:17 drkirkby]:




> >  * There should be a link added to this page http://www.sagemath.org/doc/ (which is generated from the docs in Sage) to show the place where the new documentation can be found. 
 
> > 
> > Clearly adding the code to the packages is quite simple, but unless it is well documented it's not going to be much use. People must be able to find the documentation, which I think will be most easily done if on the main page http://www.sagemath.org/doc/ 



This is now #10853



> >  * There's a possibility that building some of the documentation may require external programs like GNU info, LaTeX. makeinfo etc. This needs to be mentioned in the docs. 
 
> 
> Fix coming up.


Done.

> 
> 
> >  * The patch says the documentation gets installed in the file `$SAGE_ROOT/local/share/doc/SPKG_NAME/`. I think there should be in front of $SPKG_NAME  - just as with SAGE_ROOT. Also, a more accurate description is that the docs are installed in one or more directories below `$SAGE_ROOT/local/share/doc/SPKG_NAME/`
 
> 
> I didn't put the $ since $SPKG_NAME is not a variable that works in the spkg-install file.  My hope was to help them realize that they needed to manually fill in SPKG_NAME.  I'll put a note to that effect.


PACKAGE_NAME is used quite a bit in other places in that file, so I used that.  That is understood in that file to be a placeholder to be replaced for a specific package.



---

archive/issue_comments_113525.json:
```json
{
    "body": "Things should be ready for review...",
    "created_at": "2011-02-26T05:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113525",
    "user": "https://github.com/jasongrout"
}
```

Things should be ready for review...



---

archive/issue_comments_113526.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-02-26T05:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113526",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113527.json:
```json
{
    "body": "I take your point about `$SPKG_NAME`. Leaving it as `SPKG_NAME` is the right thing to do. \n\nThe file `devel/sage-main/doc/en/website/templates/index.html` looks to be the one that generates http://www.sagemath.org/doc/ We can discuss that on #10853\n\nI forgot, what is shown as lines 221 to 224 in `doc/en/developer/producing_spkgs.rst` are indented one space too much. \n\nI don't have a strong feeling on the following, and are happy to give it a positive review either way, but something that should at least be considered. \n\nShould `doc/en/developer/producing_spkgs.rst` state the **developer** should check if any required software is actually installed? Or is it better to let the installation fail if the program is not installed? I assume there should be a helpful message like \"latex not found\" generated by a package that needs it.\n\nIt might be helpful to add something like this to the sample spkg-install file, inside your `if [ \"x$SAGE_SPKG_INSTALL_DOCS\" = xyes ] ; then`. \n\n```\n# Before trying to build the documentation, check if any needed programs are \n# present. In the example below we check for 'latex', but this will depend on the package.\n# Some packages may need no extra tools installed, others may require some. \n# We use 'command -v' for testing this, and not 'which' since 'which' is not\n# portable, whereas 'command -v' is defined by POSIX \n# if [ `command -v latex` ] ; then \n#   echo \"Good, latex was found, so building the documentation\"\n# else\n#   echo \"Sorry, can't build the documentation for SPKG_NAME as latex is not installed\"\n# fi\n```\n\nAs I say, I don't have a strong opinion. \n\nFix the indentation and I'll give this a positive review, or make the developer do more work in testing for the required software. You choose! \n\nDave",
    "created_at": "2011-02-26T11:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113527",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

I take your point about `$SPKG_NAME`. Leaving it as `SPKG_NAME` is the right thing to do. 

The file `devel/sage-main/doc/en/website/templates/index.html` looks to be the one that generates http://www.sagemath.org/doc/ We can discuss that on #10853

I forgot, what is shown as lines 221 to 224 in `doc/en/developer/producing_spkgs.rst` are indented one space too much. 

I don't have a strong feeling on the following, and are happy to give it a positive review either way, but something that should at least be considered. 

Should `doc/en/developer/producing_spkgs.rst` state the **developer** should check if any required software is actually installed? Or is it better to let the installation fail if the program is not installed? I assume there should be a helpful message like "latex not found" generated by a package that needs it.

It might be helpful to add something like this to the sample spkg-install file, inside your `if [ "x$SAGE_SPKG_INSTALL_DOCS" = xyes ] ; then`. 

```
# Before trying to build the documentation, check if any needed programs are 
# present. In the example below we check for 'latex', but this will depend on the package.
# Some packages may need no extra tools installed, others may require some. 
# We use 'command -v' for testing this, and not 'which' since 'which' is not
# portable, whereas 'command -v' is defined by POSIX 
# if [ `command -v latex` ] ; then 
#   echo "Good, latex was found, so building the documentation"
# else
#   echo "Sorry, can't build the documentation for SPKG_NAME as latex is not installed"
# fi
```

As I say, I don't have a strong opinion. 

Fix the indentation and I'll give this a positive review, or make the developer do more work in testing for the required software. You choose! 

Dave



---

archive/issue_comments_113528.json:
```json
{
    "body": "Question: How much does this add to the size of a Sage download?  It's at least conceivable that it would be not be negligible.",
    "created_at": "2011-02-26T21:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113528",
    "user": "https://github.com/kcrisman"
}
```

Question: How much does this add to the size of a Sage download?  It's at least conceivable that it would be not be negligible.



---

archive/issue_comments_113529.json:
```json
{
    "body": "Replying to [comment:24 kcrisman]:\n> Question: How much does this add to the size of a Sage download?  It's at least conceivable that it would be not be negligible.  \n\n\nIf we continue as now, not building the documentation, then only a 1000 or so bytes for the patches. \n\nIf we changed the way we built binaries, and included all the documentation, then I could believe the download size would increase significantly - I would guess someone in the range 10 to 100 MB. \n\nDave",
    "created_at": "2011-02-27T01:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113529",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Replying to [comment:24 kcrisman]:
> Question: How much does this add to the size of a Sage download?  It's at least conceivable that it would be not be negligible.  


If we continue as now, not building the documentation, then only a 1000 or so bytes for the patches. 

If we changed the way we built binaries, and included all the documentation, then I could believe the download size would increase significantly - I would guess someone in the range 10 to 100 MB. 

Dave



---

archive/issue_comments_113530.json:
```json
{
    "body": "Replying to [comment:25 drkirkby]:\n> Replying to [comment:24 kcrisman]:\n> > Question: How much does this add to the size of a Sage download?  It's at least conceivable that it would be not be negligible.  \n\n> \n> If we continue as now, not building the documentation, then only a 1000 or so bytes for the patches. \n> \n\n\nSorry for the spam - I guess I didn't realize this would be an *optional* variable!",
    "created_at": "2011-02-27T02:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113530",
    "user": "https://github.com/kcrisman"
}
```

Replying to [comment:25 drkirkby]:
> Replying to [comment:24 kcrisman]:
> > Question: How much does this add to the size of a Sage download?  It's at least conceivable that it would be not be negligible.  

> 
> If we continue as now, not building the documentation, then only a 1000 or so bytes for the patches. 
> 


Sorry for the spam - I guess I didn't realize this would be an *optional* variable!



---

archive/issue_comments_113531.json:
```json
{
    "body": "Attachment [trac-10823-doc.patch](tarball://root/attachments/some-uuid/ticket10823/trac-10823-doc.patch) by @jasongrout created at 2011-03-01 02:59:01",
    "created_at": "2011-03-01T02:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113531",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac-10823-doc.patch](tarball://root/attachments/some-uuid/ticket10823/trac-10823-doc.patch) by @jasongrout created at 2011-03-01 02:59:01



---

archive/issue_comments_113532.json:
```json
{
    "body": "Okay, I attached a new patch which should take care of all of David's concerns.\n\nThanks for the careful review!",
    "created_at": "2011-03-01T03:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113532",
    "user": "https://github.com/jasongrout"
}
```

Okay, I attached a new patch which should take care of all of David's concerns.

Thanks for the careful review!



---

archive/issue_comments_113533.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-01T13:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113533",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_113534.json:
```json
{
    "body": "This is fine, so positive review. I'll look to review the individual packages that make use of the environment variable, but for now at least it is properly documented in both the Installation and Developer guides.",
    "created_at": "2011-03-01T13:58:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113534",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

This is fine, so positive review. I'll look to review the individual packages that make use of the environment variable, but for now at least it is properly documented in both the Installation and Developer guides.



---

archive/issue_comments_113535.json:
```json
{
    "body": "I'm putting this back to needs_work, as I realised after looking at a revised Matplotlib package (#10828) that simply copying the \"docs\" directory might in some cases copy a lot of unnecessary files. The spkg-install should tell developers to remove unnecessary files from $SAGE_ROOT/local/share/doc/SPKG_NAME. Again this will depend on the package, but something like:\n\n```\nfind \"$SAGE_ROOT/local/share/doc/SPKG_NAME\" -name '*.py'  -exec rm -f {} \\;\n```\n\nshould get rid of the .py files for example. \n\nDave",
    "created_at": "2011-03-02T01:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113535",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

I'm putting this back to needs_work, as I realised after looking at a revised Matplotlib package (#10828) that simply copying the "docs" directory might in some cases copy a lot of unnecessary files. The spkg-install should tell developers to remove unnecessary files from $SAGE_ROOT/local/share/doc/SPKG_NAME. Again this will depend on the package, but something like:

```
find "$SAGE_ROOT/local/share/doc/SPKG_NAME" -name '*.py'  -exec rm -f {} \;
```

should get rid of the .py files for example. 

Dave



---

archive/issue_comments_113536.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-03-02T01:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113536",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_113537.json:
```json
{
    "body": "Attachment [trac-10823-doc-2.patch](tarball://root/attachments/some-uuid/ticket10823/trac-10823-doc-2.patch) by @jasongrout created at 2011-03-02 04:23:38\n\napply on top of previous patches",
    "created_at": "2011-03-02T04:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113537",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac-10823-doc-2.patch](tarball://root/attachments/some-uuid/ticket10823/trac-10823-doc-2.patch) by @jasongrout created at 2011-03-02 04:23:38

apply on top of previous patches



---

archive/issue_comments_113538.json:
```json
{
    "body": "I added a further note to the documentation.",
    "created_at": "2011-03-02T04:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113538",
    "user": "https://github.com/jasongrout"
}
```

I added a further note to the documentation.



---

archive/issue_comments_113539.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-02T04:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113539",
    "user": "https://github.com/jasongrout"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_113540.json:
```json
{
    "body": "That's fine.",
    "created_at": "2011-03-02T04:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113540",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

That's fine.



---

archive/issue_comments_113541.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-02T04:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113541",
    "user": "https://trac.sagemath.org/admin/accounts/users/drkirkby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_027953.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2011-03-08T21:48:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10757#event-27953"
}
```



---

archive/issue_comments_113542.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-03-08T21:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113542",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_113543.json:
```json
{
    "body": "See #11197 for a follow-up ticket for implementing building docs after Sage is built.",
    "created_at": "2011-04-14T13:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10757",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10757#issuecomment-113543",
    "user": "https://github.com/jasongrout"
}
```

See #11197 for a follow-up ticket for implementing building docs after Sage is built.
