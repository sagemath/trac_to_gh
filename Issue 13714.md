# Issue 13714: systemwide install of cremona database permission issues

archive/issues_013714.json:
```json
{
    "body": "Assignee: @williamstein\n\nCC:  @JohnCremona @ohanar\n\nI did a clean install of sage as root, then installed the cremona database optional package, but other users can't use it, because it is readable only by the owner (root):\n\n```\nroot@01salvus:/usr/local/sage-5.3# ls -lh data/\ntotal 24K\ndrwxr-xr-x  2 root root 4.0K Sep 28 10:08 conway_polynomials\ndrwxrwxr-x  2 root root 4.0K Jan  6 11:03 cremona\ndrwxr-xr-x  2 root root 4.0K Sep 28 10:15 ellcurves\ndrwxrwxr-x 28 root root 4.0K Sep 28 10:16 extcode\ndrwxr-xr-x  2 root root 4.0K Apr  4  2012 graphs\ndrwxr-xr-x  2 root root 4.0K Feb 10  2010 reflexive_polytopes\nroot@01salvus:/usr/local/sage-5.3# ls -lh data/cremona/\ntotal 356M\n-rw------- 1 root root 347M Jan  6 11:03 cremona.db\n-rw-r--r-- 1 root root 8.2M Sep 28 10:15 cremona_mini.db\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/13918\n\n",
    "created_at": "2013-01-06T19:05:23Z",
    "labels": [
        "component: packages: huge",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.9",
    "title": "systemwide install of cremona database permission issues",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13714",
    "user": "https://github.com/williamstein"
}
```
Assignee: @williamstein

CC:  @JohnCremona @ohanar

I did a clean install of sage as root, then installed the cremona database optional package, but other users can't use it, because it is readable only by the owner (root):

```
root@01salvus:/usr/local/sage-5.3# ls -lh data/
total 24K
drwxr-xr-x  2 root root 4.0K Sep 28 10:08 conway_polynomials
drwxrwxr-x  2 root root 4.0K Jan  6 11:03 cremona
drwxr-xr-x  2 root root 4.0K Sep 28 10:15 ellcurves
drwxrwxr-x 28 root root 4.0K Sep 28 10:16 extcode
drwxr-xr-x  2 root root 4.0K Apr  4  2012 graphs
drwxr-xr-x  2 root root 4.0K Feb 10  2010 reflexive_polytopes
root@01salvus:/usr/local/sage-5.3# ls -lh data/cremona/
total 356M
-rw------- 1 root root 347M Jan  6 11:03 cremona.db
-rw-r--r-- 1 root root 8.2M Sep 28 10:15 cremona_mini.db
```

Issue created by migration from https://trac.sagemath.org/ticket/13918





---

archive/issue_comments_169937.json:
```json
{
    "body": "Hmm, I do this all the time with no problem, but what I do is build\nand install extra spkgs as me (not root), then copy all to\n/usr/local/sage, then run sage as root, then change all ownerships and\npermissions.\n\nHowever it would be easy to change the line in the spkg-install which\ncopies that .db file into SAGE_DATA so that it is world-readable.  It\nprobably all reults in the line \"umask 077\" in my own .bashrc file.",
    "created_at": "2013-01-06T19:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13714#issuecomment-169937",
    "user": "https://github.com/JohnCremona"
}
```

Hmm, I do this all the time with no problem, but what I do is build
and install extra spkgs as me (not root), then copy all to
/usr/local/sage, then run sage as root, then change all ownerships and
permissions.

However it would be easy to change the line in the spkg-install which
copies that .db file into SAGE_DATA so that it is world-readable.  It
probably all reults in the line "umask 077" in my own .bashrc file.



---

archive/issue_comments_169938.json:
```json
{
    "body": "Replying to [comment:1 cremona]:\n> Hmm, I do this all the time with no problem, but what I do is build\n> and install extra spkgs as me (not root), then copy all to\n> /usr/local/sage, then run sage as root, then change all ownerships and\n> permissions.\n\n\nWell I had absolutely no idea when I built/installed Sage that I would be installing the cremona database :-). \n\n> However it would be easy to change the line in the spkg-install which\n> copies that .db file into SAGE_DATA so that it is world-readable.  It\n> probably all results in the line \"umask 077\" in my own .bashrc file.\n\n\nThat would make a lot of sense to me. \n\nWilliam",
    "created_at": "2013-01-06T19:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13714#issuecomment-169938",
    "user": "https://github.com/williamstein"
}
```

Replying to [comment:1 cremona]:
> Hmm, I do this all the time with no problem, but what I do is build
> and install extra spkgs as me (not root), then copy all to
> /usr/local/sage, then run sage as root, then change all ownerships and
> permissions.


Well I had absolutely no idea when I built/installed Sage that I would be installing the cremona database :-). 

> However it would be easy to change the line in the spkg-install which
> copies that .db file into SAGE_DATA so that it is world-readable.  It
> probably all results in the line "umask 077" in my own .bashrc file.


That would make a lot of sense to me. 

William



---

archive/issue_comments_169939.json:
```json
{
    "body": "Deal:  try the new spkg at #13547, where there is a new spkg which has been there since October waiting for a review.  I just changed 1 bit (approx) in it so that the file cremona.db now has permissions 644 (was 600), and that should work.\n\nA positive review for #13547 would also be welcome.",
    "created_at": "2013-01-06T20:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13714#issuecomment-169939",
    "user": "https://github.com/JohnCremona"
}
```

Deal:  try the new spkg at #13547, where there is a new spkg which has been there since October waiting for a review.  I just changed 1 bit (approx) in it so that the file cremona.db now has permissions 644 (was 600), and that should work.

A positive review for #13547 would also be welcome.



---

archive/issue_events_039087.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-04-22T20:24:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13714",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13714#event-39087"
}
```



---

archive/issue_comments_169940.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2013-04-22T20:24:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13714",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13714#issuecomment-169940",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: duplicate
