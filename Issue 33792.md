# Issue 33792: bug in elliptic curve saturation: bugfix in eclib required.

archive/issues_033792.json:
```json
{
    "body": "CC:  @dimpase @mkoeppe\n\nIn eclib version v20210310 the code for saturating points on elliptic curves over QQ was greatly improved, but a small logic error was introduced leading to the following:\n\n```\nsage: E = EllipticCurve([0, 0, 0, -17607, -889490])\nsage: Q = E([-82,54])\nsage: E.saturation([2*Q])\n([(-82 : 54 : 1)], 2, 2.36570863272098)\nsage: E.saturation([2*Q], max_prime=10)\n([(11649/16 : -1234751/64 : 1)], 1, 9.46283453088392)\n```\n\nThe point list [2*Q] is certainly not saturated at 2, and when no saturation bound is given this is detected automaically OK, but when any bound is given it is not.  (The reason, for those interested, is that the code in eclib treats primes dividing Tamagawa numbers separately, and here 2 is such a prime.)\n\nI don't see a way to fix this in Sage other than fixing the bug in eclib (which I will now do) and update eclib.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34029\n\n",
    "created_at": "2022-06-20T10:26:30Z",
    "labels": [
        "component: elliptic curves",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "bug in elliptic curve saturation: bugfix in eclib required.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33792",
    "user": "https://github.com/JohnCremona"
}
```
CC:  @dimpase @mkoeppe

In eclib version v20210310 the code for saturating points on elliptic curves over QQ was greatly improved, but a small logic error was introduced leading to the following:

```
sage: E = EllipticCurve([0, 0, 0, -17607, -889490])
sage: Q = E([-82,54])
sage: E.saturation([2*Q])
([(-82 : 54 : 1)], 2, 2.36570863272098)
sage: E.saturation([2*Q], max_prime=10)
([(11649/16 : -1234751/64 : 1)], 1, 9.46283453088392)
```

The point list [2*Q] is certainly not saturated at 2, and when no saturation bound is given this is detected automaically OK, but when any bound is given it is not.  (The reason, for those interested, is that the code in eclib treats primes dividing Tamagawa numbers separately, and here 2 is such a prime.)

I don't see a way to fix this in Sage other than fixing the bug in eclib (which I will now do) and update eclib.

Issue created by migration from https://trac.sagemath.org/ticket/34029





---

archive/issue_comments_479695.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2022-06-21T15:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479695",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_479696.json:
```json
{
    "body": "I hope I can get the new eclib version working more easily than last time (the last version was 20210625, so almost exactly a year ago).\n\nIn my new branch (based on current develop branch) I updated the package-version.txt and fixed the checksum.ini, after putting the new tar.bz2 file into upstream/.  I deleted the patch in the patches directory since those changes are in the upstream source now. Then \"sage -i -c eclib\" worked fine, all checks passed.  But when I run anything relevant I get errors:\n\n```\nsage: E = EllipticCurve([0,0,0,-17607,-889490])\nsage: E.rank()\n```\n\ngives a segfault.\n\nThe new version should be completely compatible, i.e. no changes are needed to the interface.\n\n\n```\n./sage -t src/sage/libs/eclib/constructor.py\n```\n\nis fine, but \n\n```\n./sage -t src/sage/libs/eclib/interface.py\n```\n\ncauses a lot of segfaults, e.g.\n\n```\nsage -t --warn-long 94.9 --random-seed=269743671597642066957592066085711042976 src/sage/libs/eclib/interface.py\n**********************************************************************\nFile \"src/sage/libs/eclib/interface.py\", line 155, in sage.libs.eclib.interface.mwrank_EllipticCurve.set_verbose\nFailed example:\n    E.saturate() # no output\nException raised:\n    Traceback (most recent call last):\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.eclib.interface.mwrank_EllipticCurve.set_verbose[1]>\", line 1, in <module>\n        E.saturate() # no output\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py\", line 570, in saturate\n        self.__two_descent_data().saturate(bound, lower)\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py\", line 370, in __two_descent_data\n        self.two_descent(self.__verbose)\n      File \"/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py\", line 348, in two_descent\n        self.__descent.do_descent(self.__curve,\n      File \"sage/libs/eclib/mwrank.pyx\", line 1061, in sage.libs.eclib.mwrank._two_descent.do_descent (build/cythonized/sage/libs/eclib/mwrank.cpp:5622)\n        sig_on()\n    cysignals.signals.SignalError: Segmentation fault\n```\n\n\nI'll post the branch here and hope someone can help.  Dima usually can!",
    "created_at": "2022-06-21T15:23:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479696",
    "user": "https://github.com/JohnCremona"
}
```

I hope I can get the new eclib version working more easily than last time (the last version was 20210625, so almost exactly a year ago).

In my new branch (based on current develop branch) I updated the package-version.txt and fixed the checksum.ini, after putting the new tar.bz2 file into upstream/.  I deleted the patch in the patches directory since those changes are in the upstream source now. Then "sage -i -c eclib" worked fine, all checks passed.  But when I run anything relevant I get errors:

```
sage: E = EllipticCurve([0,0,0,-17607,-889490])
sage: E.rank()
```

gives a segfault.

The new version should be completely compatible, i.e. no changes are needed to the interface.


```
./sage -t src/sage/libs/eclib/constructor.py
```

is fine, but 

```
./sage -t src/sage/libs/eclib/interface.py
```

causes a lot of segfaults, e.g.

```
sage -t --warn-long 94.9 --random-seed=269743671597642066957592066085711042976 src/sage/libs/eclib/interface.py
**********************************************************************
File "src/sage/libs/eclib/interface.py", line 155, in sage.libs.eclib.interface.mwrank_EllipticCurve.set_verbose
Failed example:
    E.saturate() # no output
Exception raised:
    Traceback (most recent call last):
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.eclib.interface.mwrank_EllipticCurve.set_verbose[1]>", line 1, in <module>
        E.saturate() # no output
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py", line 570, in saturate
        self.__two_descent_data().saturate(bound, lower)
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py", line 370, in __two_descent_data
        self.two_descent(self.__verbose)
      File "/home/john/sage/local/lib/python3.10/site-packages/sage/libs/eclib/interface.py", line 348, in two_descent
        self.__descent.do_descent(self.__curve,
      File "sage/libs/eclib/mwrank.pyx", line 1061, in sage.libs.eclib.mwrank._two_descent.do_descent (build/cythonized/sage/libs/eclib/mwrank.cpp:5622)
        sig_on()
    cysignals.signals.SignalError: Segmentation fault
```


I'll post the branch here and hope someone can help.  Dima usually can!



---

archive/issue_comments_479697.json:
```json
{
    "body": "I will go and read the latest edition of the developers' guide to see why this does not work:\n\n```\n$ git push trac eclib-20220621:trac/u/cremona/34029\nX11 forwarding request failed on channel 0\nEnumerating objects: 13, done.\nCounting objects: 100% (13/13), done.\nDelta compression using up to 8 threads\nCompressing objects: 100% (6/6), done.\nWriting objects: 100% (7/7), 686 bytes | 686.00 KiB/s, done.\nTotal 7 (delta 4), reused 0 (delta 0)\nremote: FATAL: W refs/heads/trac/u/cremona/34029 sage cremona DENIED by fallthru\nremote: error: hook declined to update refs/heads/trac/u/cremona/34029\nTo trac.sagemath.org:sage.git\n ! [remote rejected]       eclib-20220621 -> trac/u/cremona/34029 (hook declined)\nerror: failed to push some refs to 'git@trac.sagemath.org:sage.git'\n```\n",
    "created_at": "2022-06-21T15:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479697",
    "user": "https://github.com/JohnCremona"
}
```

I will go and read the latest edition of the developers' guide to see why this does not work:

```
$ git push trac eclib-20220621:trac/u/cremona/34029
X11 forwarding request failed on channel 0
Enumerating objects: 13, done.
Counting objects: 100% (13/13), done.
Delta compression using up to 8 threads
Compressing objects: 100% (6/6), done.
Writing objects: 100% (7/7), 686 bytes | 686.00 KiB/s, done.
Total 7 (delta 4), reused 0 (delta 0)
remote: FATAL: W refs/heads/trac/u/cremona/34029 sage cremona DENIED by fallthru
remote: error: hook declined to update refs/heads/trac/u/cremona/34029
To trac.sagemath.org:sage.git
 ! [remote rejected]       eclib-20220621 -> trac/u/cremona/34029 (hook declined)
error: failed to push some refs to 'git@trac.sagemath.org:sage.git'
```




---

archive/issue_comments_479698.json:
```json
{
    "body": "Well, in fact I found the problem in an email from Volker to me from 2013.... (delete \"trac/\" from the remote branch name).\n----\nNew commits:",
    "created_at": "2022-06-21T15:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479698",
    "user": "https://github.com/JohnCremona"
}
```

Well, in fact I found the problem in an email from Volker to me from 2013.... (delete "trac/" from the remote branch name).
----
New commits:



---

archive/issue_comments_479699.json:
```json
{
    "body": "seems that output changed, thus doctests fail, e.g.\n\n```\nFile \"src/sage/libs/eclib/mwrank.pyx\", line 589, in sage.libs.eclib.mwrank._mw.__init__\nFailed example:\n    EQ.search(1)\nExpected:\n    P1 = [0:1:0]         is torsion point, order 1\n    P1 = [-3:0:1]         is generator number 1\n    saturating up to 20...Saturation index bound (for points of good reduction)  = 3\n    Reducing saturation bound from given value 20 to computed index bound 3\n    Checking saturation at [ 2 3 ]\n...\n\nGot:\n    P1 = [0:1:0]         is torsion point, order 1\n    P1 = [-3:0:1]         is generator number 1\n    saturating up to 20...Saturation index bound (for points of good reduction)  = 3\n    Reducing saturation bound from given value 20 to computed index bound 3\n    Tamagawa index primes are [ 2 ]\n    Checking saturation at [ 2 3 ]\n...\n```\n\n\nso the new output has the line `Tamagawa index primes are [ 2 ]`, and the old does not.",
    "created_at": "2022-06-22T08:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479699",
    "user": "https://github.com/dimpase"
}
```

seems that output changed, thus doctests fail, e.g.

```
File "src/sage/libs/eclib/mwrank.pyx", line 589, in sage.libs.eclib.mwrank._mw.__init__
Failed example:
    EQ.search(1)
Expected:
    P1 = [0:1:0]         is torsion point, order 1
    P1 = [-3:0:1]         is generator number 1
    saturating up to 20...Saturation index bound (for points of good reduction)  = 3
    Reducing saturation bound from given value 20 to computed index bound 3
    Checking saturation at [ 2 3 ]
...

Got:
    P1 = [0:1:0]         is torsion point, order 1
    P1 = [-3:0:1]         is generator number 1
    saturating up to 20...Saturation index bound (for points of good reduction)  = 3
    Reducing saturation bound from given value 20 to computed index bound 3
    Tamagawa index primes are [ 2 ]
    Checking saturation at [ 2 3 ]
...
```


so the new output has the line `Tamagawa index primes are [ 2 ]`, and the old does not.



---

archive/issue_comments_479700.json:
```json
{
    "body": "or here:\n\n```\nFile \"src/sage/libs/eclib/interface.py\", line 1213, in sage.libs.eclib.interface.mwrank_MordellWeil.sat\nurate\nFailed example:\n    EQ.saturate()\nExpected:\n    saturating basis...Saturation index bound (for points of good reduction) = 3\n    Tamagawa index primes are [ ]\n    Checking saturation at [ 2 3 ]\n    Checking 2-saturation\n    Points were proved 2-saturated (max q used = 11)\n    Checking 3-saturation\n    Points were proved 3-saturated (max q used = 13)\n    done\n    (True, 1, '[ ]')\nGot:\n    saturating basis...Saturation index bound (for points of good reduction)  = 3\n    Tamagawa index primes are [ 2 ]\n    Checking saturation at [ 2 3 ]\n    Checking 2-saturation \n    Points were proved 2-saturated (max q used = 11)\n    Checking 3-saturation \n    Points were proved 3-saturated (max q used = 13)\n    done\n    (True, 1, '[ ]')\n```\n\nagain, `Tamagawa index primes are [ 2 ]` vs `Tamagawa index primes are [ ]`",
    "created_at": "2022-06-22T08:40:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479700",
    "user": "https://github.com/dimpase"
}
```

or here:

```
File "src/sage/libs/eclib/interface.py", line 1213, in sage.libs.eclib.interface.mwrank_MordellWeil.sat
urate
Failed example:
    EQ.saturate()
Expected:
    saturating basis...Saturation index bound (for points of good reduction) = 3
    Tamagawa index primes are [ ]
    Checking saturation at [ 2 3 ]
    Checking 2-saturation
    Points were proved 2-saturated (max q used = 11)
    Checking 3-saturation
    Points were proved 3-saturated (max q used = 13)
    done
    (True, 1, '[ ]')
Got:
    saturating basis...Saturation index bound (for points of good reduction)  = 3
    Tamagawa index primes are [ 2 ]
    Checking saturation at [ 2 3 ]
    Checking 2-saturation 
    Points were proved 2-saturated (max q used = 11)
    Checking 3-saturation 
    Points were proved 3-saturated (max q used = 13)
    done
    (True, 1, '[ ]')
```

again, `Tamagawa index primes are [ 2 ]` vs `Tamagawa index primes are [ ]`



---

archive/issue_comments_479701.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2022-06-22T08:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479701",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_479702.json:
```json
{
    "body": "Yes of course, I did not mark the ticket as ready for review yet.  But yesterday I could not even test it for the reasons I mentioned. I'll reinstall today and try again.\n\nBut thanks for testing.   The explanation for the difference in \"Tamagawa index primes\" is that these should include primes dividing the number of real components (which is 2 here) as well as the p-adic components (which are all 1 here).\n\nI'll fix the doctests once I can get the new code to work.  I don't know why it is giving me segfaults.  \"sage -mwrank\" works OK.",
    "created_at": "2022-06-22T09:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479702",
    "user": "https://github.com/JohnCremona"
}
```

Yes of course, I did not mark the ticket as ready for review yet.  But yesterday I could not even test it for the reasons I mentioned. I'll reinstall today and try again.

But thanks for testing.   The explanation for the difference in "Tamagawa index primes" is that these should include primes dividing the number of real components (which is 2 here) as well as the p-adic components (which are all 1 here).

I'll fix the doctests once I can get the new code to work.  I don't know why it is giving me segfaults.  "sage -mwrank" works OK.



---

archive/issue_comments_479703.json:
```json
{
    "body": "The good news is that I rebuilt sage from scratch and now it works.  I'll fix the doctests and update the branch.",
    "created_at": "2022-06-22T11:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479703",
    "user": "https://github.com/JohnCremona"
}
```

The good news is that I rebuilt sage from scratch and now it works.  I'll fix the doctests and update the branch.



---

archive/issue_comments_479704.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-22T13:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479705.json:
```json
{
    "body": "Commit 7293ebf fixes the doctests, I will add a new doctest to show that the problem posted here has been solved before setting to \"needs review\".",
    "created_at": "2022-06-22T14:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479705",
    "user": "https://github.com/JohnCremona"
}
```

Commit 7293ebf fixes the doctests, I will add a new doctest to show that the problem posted here has been solved before setting to "needs review".



---

archive/issue_comments_479706.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-22T16:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479707.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-06-22T16:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479707",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_479708.json:
```json
{
    "body": "Changing keywords from \"\" to \"eclib\".",
    "created_at": "2022-06-22T16:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479708",
    "user": "https://github.com/JohnCremona"
}
```

Changing keywords from "" to "eclib".



---

archive/issue_comments_479709.json:
```json
{
    "body": "The two failing doctests in the logs have nothing to do with the changes on this ticket.",
    "created_at": "2022-06-23T07:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479709",
    "user": "https://github.com/JohnCremona"
}
```

The two failing doctests in the logs have nothing to do with the changes on this ticket.



---

archive/issue_comments_479710.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-06-23T10:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479710",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_479711.json:
```json
{
    "body": "One also needs to deal with potentially outdated eclibs provided by the system.\nMeaning that you have to decide whether to allow the older versions at all\n\ncurrently 20210625 is allowed from the system, and no other versions (cf. #31443)\n\nAnyway, build/pkgs/eclib/spkg-configure.m4 has to be updated.\nE.g. if you only want to allow 20220621, you simply need to replace the corresponding value\nin this file.\n\nIf you want to allow more, it'd be more work.\nOne can also do testing for eclib bugs there, and rejecting buggy system eclib\n(that's what we do with Pari).\n\n\n\nIndeed, testing this on Fedora 34 (which has 20210625) and getting\n\n```\nFile \"src/sage/schemes/elliptic_curves/ell_rational_field.py\", line 2615, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.saturation\nFailed example:\n    E.saturation([2*Q], max_prime=10)\nExpected:\n    ([(-82 : 54 : 1)], 2, 2.36570863272098)\nGot:\n    ([(11649/16 : -1234751/64 : 1)], 1, 9.46283453088392)\n...\nFile \"src/sage/libs/eclib/interface.py\", line 727, in sage.libs.eclib.interface.mwrank_MordellWeil\nFailed example:\n    EQ.search(1)\nExpected:\n    P1 = [0:1:0]     is torsion point, order 1\n    P1 = [-3:0:1]     is generator number 1\n    saturating up to 20...Saturation index bound (for points of good reduction)  = 3\n    Reducing saturation bound from given value 20 to computed index bound 3\n    Tamagawa index primes are [ 2 ]\n    Checking saturation at [ 2 3 ]\n    Checking 2-saturation \n...\nGot:\n    P1 = [0:1:0]         is torsion point, order 1\n    P1 = [-3:0:1]         is generator number 1\n    saturating up to 20...Saturation index bound (for points of good reduction)  = 3\n    Reducing saturation bound from given value 20 to computed index bound 3\n    Checking saturation at [ 2 3 ]\n    Checking 2-saturation \n...\n```\n\n(no wonder, it's the old eclib tested against updated doctests)",
    "created_at": "2022-06-23T10:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479711",
    "user": "https://github.com/dimpase"
}
```

One also needs to deal with potentially outdated eclibs provided by the system.
Meaning that you have to decide whether to allow the older versions at all

currently 20210625 is allowed from the system, and no other versions (cf. #31443)

Anyway, build/pkgs/eclib/spkg-configure.m4 has to be updated.
E.g. if you only want to allow 20220621, you simply need to replace the corresponding value
in this file.

If you want to allow more, it'd be more work.
One can also do testing for eclib bugs there, and rejecting buggy system eclib
(that's what we do with Pari).



Indeed, testing this on Fedora 34 (which has 20210625) and getting

```
File "src/sage/schemes/elliptic_curves/ell_rational_field.py", line 2615, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.saturation
Failed example:
    E.saturation([2*Q], max_prime=10)
Expected:
    ([(-82 : 54 : 1)], 2, 2.36570863272098)
Got:
    ([(11649/16 : -1234751/64 : 1)], 1, 9.46283453088392)
...
File "src/sage/libs/eclib/interface.py", line 727, in sage.libs.eclib.interface.mwrank_MordellWeil
Failed example:
    EQ.search(1)
Expected:
    P1 = [0:1:0]     is torsion point, order 1
    P1 = [-3:0:1]     is generator number 1
    saturating up to 20...Saturation index bound (for points of good reduction)  = 3
    Reducing saturation bound from given value 20 to computed index bound 3
    Tamagawa index primes are [ 2 ]
    Checking saturation at [ 2 3 ]
    Checking 2-saturation 
...
Got:
    P1 = [0:1:0]         is torsion point, order 1
    P1 = [-3:0:1]         is generator number 1
    saturating up to 20...Saturation index bound (for points of good reduction)  = 3
    Reducing saturation bound from given value 20 to computed index bound 3
    Checking saturation at [ 2 3 ]
    Checking 2-saturation 
...
```

(no wonder, it's the old eclib tested against updated doctests)



---

archive/issue_comments_479712.json:
```json
{
    "body": "Thanks Dima, I wanted to ask you about that m4 file.  I think we should just allow only eclib 20220621.  And I expect to make a similar restriction for future releases.  The only downside for (most of) those building Sage is that Sage will build eclib, as it always has done.\n\nI'll update that m4 file.",
    "created_at": "2022-06-23T10:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479712",
    "user": "https://github.com/JohnCremona"
}
```

Thanks Dima, I wanted to ask you about that m4 file.  I think we should just allow only eclib 20220621.  And I expect to make a similar restriction for future releases.  The only downside for (most of) those building Sage is that Sage will build eclib, as it always has done.

I'll update that m4 file.



---

archive/issue_comments_479713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-23T10:29:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479713",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479714.json:
```json
{
    "body": "lgtm",
    "created_at": "2022-06-23T12:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479714",
    "user": "https://github.com/dimpase"
}
```

lgtm



---

archive/issue_comments_479715.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2022-06-23T12:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479715",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_479716.json:
```json
{
    "body": "We can actually hardcode this design, so that spkg-configure.m4 gets the version from package-version.\nBut that's a minor issue.",
    "created_at": "2022-06-23T12:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479716",
    "user": "https://github.com/dimpase"
}
```

We can actually hardcode this design, so that spkg-configure.m4 gets the version from package-version.
But that's a minor issue.



---

archive/issue_comments_479717.json:
```json
{
    "body": "Replying to [comment:19 dimpase]:\n> We can actually hardcode this design, so that spkg-configure.m4 gets the version from package-version.\n> But that's a minor issue.\n\nThanks.  If the hard-coding is easy we could do that now?",
    "created_at": "2022-06-23T12:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479717",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:19 dimpase]:
> We can actually hardcode this design, so that spkg-configure.m4 gets the version from package-version.
> But that's a minor issue.

Thanks.  If the hard-coding is easy we could do that now?



---

archive/issue_comments_479718.json:
```json
{
    "body": "I tried\n\n```diff\n--- a/build/pkgs/eclib/spkg-configure.m4\n+++ b/build/pkgs/eclib/spkg-configure.m4\n@@ -1,7 +1,7 @@\n SAGE_SPKG_CONFIGURE([eclib], [\n   SAGE_SPKG_DEPCHECK([ntl pari flint], [\n     dnl Trac #31443, #34029: use existing eclib only if the version reported by pkg-config is correct\n-    m4_pushdef([SAGE_ECLIB_VER],[\"20220621\"])\n+    m4_pushdef([SAGE_ECLIB_VER],[\"m4_include([build/pkgs/eclib/package-version.txt])\"])\n     PKG_CHECK_MODULES([ECLIB], [eclib = SAGE_ECLIB_VER], [\n       AC_CACHE_CHECK([for mwrank version == SAGE_ECLIB_VER], [ac_cv_path_MWRANK], [\n         AC_PATH_PROGS_FEATURE_CHECK([MWRANK], [mwrank], [\n```\n\nbut my m4 foo is not strong enough to make it work without warnings (something about multiple inclusion of this file pops up). Maybe Matthias knows a fix.",
    "created_at": "2022-06-23T13:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479718",
    "user": "https://github.com/dimpase"
}
```

I tried

```diff
--- a/build/pkgs/eclib/spkg-configure.m4
+++ b/build/pkgs/eclib/spkg-configure.m4
@@ -1,7 +1,7 @@
 SAGE_SPKG_CONFIGURE([eclib], [
   SAGE_SPKG_DEPCHECK([ntl pari flint], [
     dnl Trac #31443, #34029: use existing eclib only if the version reported by pkg-config is correct
-    m4_pushdef([SAGE_ECLIB_VER],["20220621"])
+    m4_pushdef([SAGE_ECLIB_VER],["m4_include([build/pkgs/eclib/package-version.txt])"])
     PKG_CHECK_MODULES([ECLIB], [eclib = SAGE_ECLIB_VER], [
       AC_CACHE_CHECK([for mwrank version == SAGE_ECLIB_VER], [ac_cv_path_MWRANK], [
         AC_PATH_PROGS_FEATURE_CHECK([MWRANK], [mwrank], [
```

but my m4 foo is not strong enough to make it work without warnings (something about multiple inclusion of this file pops up). Maybe Matthias knows a fix.



---

archive/issue_comments_479719.json:
```json
{
    "body": "I've also started a round of tests on https://github.com/sagemath/sagetrac-mirror/actions/runs/2554535605 - just in case.",
    "created_at": "2022-06-24T08:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479719",
    "user": "https://github.com/dimpase"
}
```

I've also started a round of tests on https://github.com/sagemath/sagetrac-mirror/actions/runs/2554535605 - just in case.



---

archive/issue_comments_479720.json:
```json
{
    "body": "We do use `m4_include` for a similar purpose in `build/pkgs/perl_mongodb/spkg-configure.m4`. I think you are overquoting",
    "created_at": "2022-06-25T19:16:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479720",
    "user": "https://github.com/mkoeppe"
}
```

We do use `m4_include` for a similar purpose in `build/pkgs/perl_mongodb/spkg-configure.m4`. I think you are overquoting



---

archive/issue_comments_479721.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-07-09T22:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33792#issuecomment-479721",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_030459.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-07-09T22:33:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33792",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33792#event-30459"
}
```
