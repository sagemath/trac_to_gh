# Issue 18497: Construct an interactive_simplex_method.LPDictionary from a MixedIntegerLinearProgram

Issue created by migration from https://trac.sagemath.org/ticket/18734

Original creator: mkoeppe

Original creation time: 2015-06-19 03:32:31

CC:  ncohen yzh zwang novoselt dimpase vdelecroix

Keywords: lp

For teaching, presentation, and debugging purposes, it could be powerful 
to have a function that sets up a sage.numerical.interactive_simplex_method.LPDictionary
corresponding to the current basis of a MixedIntegerLinearProgram (with all variables real). 

#18685 added the prerequisite basis status information for the case of the GLPK backend.
#18688 provides corresponding MixedIntegerLinearProgram methods.

#18732 adds the missing functions for retrieving the data of the dictionary (for the GLPK backend). 
#18733 provides corresponding MixedIntegerLinearProgram methods.


---

Comment by mkoeppe created at 2015-06-19 03:32:48

Changing type from PLEASE CHANGE to enhancement.


---

Comment by mkoeppe created at 2015-06-19 03:32:48

Changing component from PLEASE CHANGE to numerical.


---

Comment by mkoeppe created at 2015-06-30 06:39:38

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2015-06-30 06:39:38

New commits:


---

Comment by git created at 2015-06-30 07:05:00

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2015-06-30 07:28:39

Hello,

You assume in this code that the backend is GLPK. Also, I have to say that I do not like this `get_variables` function much. It returns to the users the symbolic variables of the LP, to which he already has access through his calls to `new_variable`. We may need this kind of things for our own methods, but in this case I think that it would be better to work directly with the integer id of the variables than with the symbolic ones.

That woud lead us to make function like `get_values` accept an integer parameter (a variable's id), which is not a bad move. Especially if we plan to work with the dual LP later.

Also, return `[k for k in self._variables.keys()]` is better written as `self._variables().keys()`

Nathann

P.S.: Oh. And what about renaming "construct_interactive_lp" to "interactive_linear_program"? We usually try to write the long names in Sage.


---

Comment by ncohen created at 2015-06-30 07:28:39

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-06-30 18:47:29

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-06-30 18:51:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2015-06-30 19:38:25

Hi Nathann,

`new_variable` has been dropped for this ticket, and the method has been renamed to `interactive_linear_program` as you suggest.

The code is indeed GLPK-specific (explicit testing for it has been added) -- more general support would require designing a common interface to basis status, which is #18688.


---

Comment by mkoeppe created at 2015-06-30 19:38:25

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2015-07-01 10:45:49

Hello !

> `new_variable` has been dropped for this ticket, and the method has been renamed to `interactive_linear_program` as you suggest.

Thanks!

> The code is indeed GLPK-specific (explicit testing for it has been added) -- more general support would require designing a common interface to basis status, which is #18688.

Okayokayokay. For as long as a meaningful exception is raised when the backend is not one that the code handle, it's fine by me. Especially since in this case the 'right backend' is GLPK. It's more awkward when the only backend that supports a feature is one that Sage does not ship by default.

Nathann


---

Comment by vdelecroix created at 2015-08-15 15:59:19

Hello,

There are some possible improvements in the documentation:
- some of the lines are too long. Try to make them the same width as they are in the rest of the file.
- If you mention a class you can make a clickable reference to it by using :class:`name_of_the_class`
- You wrote ```"std"``` (as a string) and ```standard``` (as a variable). I guess both of them should be strings.
- you should add a line break after `TESTS::`

For all of these, look at the [reference manual](http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings).

Vincent


---

Comment by chapoton created at 2015-08-28 08:11:29

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-09-02 20:46:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2015-09-02 20:49:52

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-09-11 06:51:06

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-09-11 06:51:06

branch does not apply, needs rebase


---

Comment by git created at 2015-09-11 23:52:30

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2015-09-11 23:55:14

It's rebased.


---

Comment by mkoeppe created at 2015-09-11 23:55:14

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2015-09-14 13:17:10


```
+        TESTS::
+            sage: b = p.get_backend()
```

There should be a blank line in between these two lines.


---

Comment by git created at 2015-09-16 18:20:44

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2015-09-18 22:46:28

Needs review.


---

Comment by git created at 2015-10-24 04:37:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2015-10-24 05:14:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2015-10-24 17:11:14

This supports two backends now: GLPK, COIN. 
Needs review.


---

Comment by git created at 2015-11-02 17:16:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2015-11-11 23:49:50

there is an indentation error that prevents docs from building. Here is how it should be:

```
diff --git a/src/sage/numerical/mip.pyx b/src/sage/numerical/mip.pyx
index 76a7eff..01ce34a 100644
--- a/src/sage/numerical/mip.pyx
+++ b/src/sage/numerical/mip.pyx
@@ -2489,9 +2489,9 @@ cdef class MixedIntegerLinearProgram(SageObject):
         INPUT:
 
         - ``form`` -- (default: ``"standard"``) a string specifying return type:
-        either ``None``, or ``"std"`` or ``"standard"``, respectively returns an
-        instance of :class:`InteractiveLPProblem` or an instance of 
-        :class:`InteractiveLPProblemStandardForm`
+          either ``None``, or ``"std"`` or ``"standard"``, respectively returns an
+          instance of :class:`InteractiveLPProblem` or an instance of 
+          :class:`InteractiveLPProblemStandardForm`
 
         OUTPUT:
 
```



---

Attachment

doctest errors with Sage 6.10 beta3.


---

Comment by dimpase created at 2015-11-11 23:54:27

please see doctest errors in the attachment. Looks like there should be more dependencies, no?


---

Comment by dimpase created at 2015-11-11 23:55:05

Changing status from needs_review to needs_info.


---

Comment by git created at 2015-11-16 17:50:57

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by zwang created at 2015-11-16 17:51:57

Changing status from needs_info to needs_review.


---

Comment by zwang created at 2015-11-16 17:51:57

fixed.


---

Comment by dimpase created at 2015-11-16 19:57:20


```
$ sage -tp --long src/sage/numerical/mip.pyx 
Running doctests with ID 2015-11-16-19-56-36-49d68035.
Git branch: boo
Using --optional=bliss,cbc,d3js,database_gap,database_jones_numfield,gap_packages,mpir,nauty,python2,sage,scons
Doctesting 1 file using 4 threads.
sage -t --long --warn-long 46.3 src/sage/numerical/mip.pyx
**********************************************************************
File "src/sage/numerical/mip.pyx", line 2527, in sage.numerical.mip.MixedIntegerLinearProgram.number_of_variables.interactive_linear_program
Failed example:
    d2.is_optimal()
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of  24 in sage.numerical.mip.MixedIntegerLinearProgram.number_of_variables.interactive_linear_program
    [514 tests, 1 failure, 1.41 s]
----------------------------------------------------------------------
sage -t --long --warn-long 46.3 src/sage/numerical/mip.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 1.5 seconds
    cpu time: 1.4 seconds
    cumulative wall time: 1.4 seconds
```



---

Attachment

what I get as 'view(d2)' in the latest test error


---

Comment by dimpase created at 2015-11-16 20:05:09

this is on Ubuntu 14.04, x86_64


---

Comment by chapoton created at 2015-11-24 07:30:58

tests do not pass, see patchbot reports


---

Comment by chapoton created at 2015-11-24 07:30:58

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2016-01-15 12:24:52

ping?


---

Comment by novoselt created at 2016-01-17 19:04:14

Just to comment on the test error: of course it is not optimal since it has a positive coefficient and of course it is optimal since that is just numerical noise. There were some places in interactive problems/dictionaries that were trying to mitigate such issues, but they were not perfect and we agreed to just get rid of them all together - the code is for learning "ideal simplex method" and works perfectly with rationals, numeric computations and errors are a different topic and are taken care off by "real solvers".


---

Comment by mkoeppe created at 2016-03-03 08:01:25

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2016-03-03 08:01:25

Changed the example so that the optimal dictionary is not dual degenerate, so the test should now work. 

Also removed the "get_variables" method which had creeped in again.
And rebased to current develop.

Needs review.
----
New commits:


---

Comment by dimpase created at 2016-03-03 08:19:37

`form == None` should be `form is None`.

And there should be test(s) for non-default value(s) of the parameter `form`.


---

Comment by dimpase created at 2016-03-03 09:25:24

I also do not like that the code seems to assume that the default backend is always GLPK. If this is true this needs to be fixed. One might run

```
default_mip_solver()
```

to see the default.


---

Comment by git created at 2016-03-04 00:48:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-03-04 12:25:54

you don't seem to need `slack_names` if `form is None`, why would you always create them?


```
+        # Construct slack names
+        slack_names = [format(back_end.row_name(i), 'w', i) for i in range(back_end.nrows())]
+
+        A = coef_matrix
+        b = upper_bound_vector
+        c = objective_coefs_vector
+        x = var_names
+        w = slack_names
+
+        if form is None:
+            from sage.numerical.interactive_simplex_method import InteractiveLPProblem
+            return InteractiveLPProblem(A, b, c, x), None
+        elif form == 'standard' or form == 'std':
+            from sage.numerical.interactive_simplex_method import InteractiveLPProblemStandardForm
```



---

Comment by git created at 2016-03-05 04:53:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-03-05 09:32:11

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2016-03-05 09:32:11

ok, good :)


---

Comment by dimpase created at 2016-03-05 09:36:12

sorry, please have a look at the patchbots' output:

```
 OUTPUT::
```

in mip.pyx should be 

```
 OUTPUT:
```



---

Comment by dimpase created at 2016-03-05 09:36:12

Changing status from positive_review to needs_work.


---

Comment by dimpase created at 2016-03-05 09:37:06

after you fix this little typo, please feel free to set the ticket to positive review.


---

Comment by git created at 2016-03-05 15:58:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2016-03-05 16:00:54

Fixed, it should have been "EXAMPLE::" actually.

Thanks for reviewing, Dima.


---

Comment by mkoeppe created at 2016-03-05 16:00:54

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-03-06 10:03:19

Resolution: fixed
