# Issue 20262: Graphs: docstring of _add_ conflicts with function

archive/issues_020262.json:
```json
{
    "body": "CC:  @dcoudert mcognetta\n\n`(Graph({'a': []})+Graph({'b': []})).vertices()` gives `[0, 1]`, but docstring of `__add__` says \"If there are common vertices to both, they will be renamed.\" I do not know which way it should be.\n\nAlso there is no error checking, so `Graph({0:[]})+'junk'` does and returns nothing.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/20499\n\n",
    "created_at": "2016-04-25T16:28:55Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Graphs: docstring of _add_ conflicts with function",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20262",
    "user": "https://github.com/jm58660"
}
```
CC:  @dcoudert mcognetta

`(Graph({'a': []})+Graph({'b': []})).vertices()` gives `[0, 1]`, but docstring of `__add__` says "If there are common vertices to both, they will be renamed." I do not know which way it should be.

Also there is no error checking, so `Graph({0:[]})+'junk'` does and returns nothing.


Issue created by migration from https://trac.sagemath.org/ticket/20499





---

archive/issue_comments_278844.json:
```json
{
    "body": "David, a question. How should this function work?\n\n- Not at all, remove this.\n- As now, i.e. always relabel to integers.\n- Keep vertices, raise exception if there is a common vertex.\n- Keep vertices, do like `union()` does.\n- Keep vertices, but relabel common ones (like the docstring now says).",
    "created_at": "2016-04-26T08:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278844",
    "user": "https://github.com/jm58660"
}
```

David, a question. How should this function work?

- Not at all, remove this.
- As now, i.e. always relabel to integers.
- Keep vertices, raise exception if there is a common vertex.
- Keep vertices, do like `union()` does.
- Keep vertices, but relabel common ones (like the docstring now says).



---

archive/issue_comments_278845.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2016-04-26T08:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278845",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_278846.json:
```json
{
    "body": "The current implementation of the `add` method is\n\n```\n        if isinstance(other_graph, GenericGraph):\n            return self.disjoint_union(other_graph, labels='integers')\n```\n\nSo it forces to relabel vertices as integer in `[0..n-1]`.\n\nAt the least, we should raise an error for cases such as `Graph({0:[]})+'junk'`. Indeed, the other ordering raises an error\n\n```\nsage: 'junk'+Graph({0:[]})\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-99-2e66a308aaff> in <module>()\n----> 1 'junk'+Graph({Integer(0):[]})\n\nTypeError: cannot concatenate 'str' and 'Graph' objects\n```\n\n\nNow, the semantic of `+` is the disjoint union, and I believe this is the right choice.\nWe should however ensure that the doc of `__add__`, `disjoint_union`, `union`, `__mul__` and may be `join`, are clear enough and without ambiguity for users.\n\nConcerning the relabel to integers part, I agree that this is often painful. We could propose and intermediate behavior like: relabel only if some vertices have same label. But again some people will complain.\n\nDavid.",
    "created_at": "2016-04-27T13:34:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278846",
    "user": "https://github.com/dcoudert"
}
```

The current implementation of the `add` method is

```
        if isinstance(other_graph, GenericGraph):
            return self.disjoint_union(other_graph, labels='integers')
```

So it forces to relabel vertices as integer in `[0..n-1]`.

At the least, we should raise an error for cases such as `Graph({0:[]})+'junk'`. Indeed, the other ordering raises an error

```
sage: 'junk'+Graph({0:[]})
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-99-2e66a308aaff> in <module>()
----> 1 'junk'+Graph({Integer(0):[]})

TypeError: cannot concatenate 'str' and 'Graph' objects
```


Now, the semantic of `+` is the disjoint union, and I believe this is the right choice.
We should however ensure that the doc of `__add__`, `disjoint_union`, `union`, `__mul__` and may be `join`, are clear enough and without ambiguity for users.

Concerning the relabel to integers part, I agree that this is often painful. We could propose and intermediate behavior like: relabel only if some vertices have same label. But again some people will complain.

David.



---

archive/issue_comments_278847.json:
```json
{
    "body": "It seems that example given uses consecutive integeres. But yes, your suggestions sounds reasonable. But now I see this:\n\n\n```\nsage: G = Graph({'a': ['b']})\nsage: G\nGraph on 2 vertices\nsage: G+G\n disjoint_union : Graph on 4 vertices\nsage: H = graphs.CycleGraph(3)\nsage: H\nCycle graph: Graph on 3 vertices\nsage: H+H\nCycle graph disjoint_union Cycle graph: Graph on 6 vertices\n```\n\n\nMaybe the `__str__` needs modification also.",
    "created_at": "2016-04-28T04:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278847",
    "user": "https://github.com/jm58660"
}
```

It seems that example given uses consecutive integeres. But yes, your suggestions sounds reasonable. But now I see this:


```
sage: G = Graph({'a': ['b']})
sage: G
Graph on 2 vertices
sage: G+G
 disjoint_union : Graph on 4 vertices
sage: H = graphs.CycleGraph(3)
sage: H
Cycle graph: Graph on 3 vertices
sage: H+H
Cycle graph disjoint_union Cycle graph: Graph on 6 vertices
```


Maybe the `__str__` needs modification also.



---

archive/issue_comments_278848.json:
```json
{
    "body": "Right, we could improve the naming part of `disjoint_union`. Currently it is:\n\n```\n        G._name = '%s disjoint_union %s'%(self.name(), other.name())\n```\n\n\nI just saw that there is a deprecation warning in `disjoint_union`. See #17053.\nSo some decisions have already been taken on how to relabel vertices.",
    "created_at": "2016-04-28T06:26:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278848",
    "user": "https://github.com/dcoudert"
}
```

Right, we could improve the naming part of `disjoint_union`. Currently it is:

```
        G._name = '%s disjoint_union %s'%(self.name(), other.name())
```


I just saw that there is a deprecation warning in `disjoint_union`. See #17053.
So some decisions have already been taken on how to relabel vertices.



---

archive/issue_comments_278849.json:
```json
{
    "body": "Should I open a discussion about this in sage-devel?",
    "created_at": "2016-04-28T07:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278849",
    "user": "https://github.com/jm58660"
}
```

Should I open a discussion about this in sage-devel?



---

archive/issue_comments_278850.json:
```json
{
    "body": "That's a good idea.\nAt least, interested people could add comments here.",
    "created_at": "2016-04-28T09:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278850",
    "user": "https://github.com/dcoudert"
}
```

That's a good idea.
At least, interested people could add comments here.



---

archive/issue_comments_278851.json:
```json
{
    "body": "Replying to [comment:2 dcoudert]:\n> The current implementation of the `add` method is\n> {{{\n>         if isinstance(other_graph, GenericGraph):\n>             return self.disjoint_union(other_graph, labels='integers')\n> }}}\n> So it forces to relabel vertices as integer in `[0..n-1]`.\n> \n> At the least, we should raise an error for cases such as `Graph({0:[]})+'junk'`. Indeed, the other ordering raises an error\n> {{{\n> sage: 'junk'+Graph({0:[]})\n> ---------------------------------------------------------------------------\n> TypeError                                 Traceback (most recent call last)\n> <ipython-input-99-2e66a308aaff> in <module>()\n> ----> 1 'junk'+Graph({Integer(0):[]})\n> \n> TypeError: cannot concatenate 'str' and 'Graph' objects\n> }}}\n> \n> Now, the semantic of `+` is the disjoint union, and I believe this is the right choice.\n> We should however ensure that the doc of `__add__`, `disjoint_union`, `union`, `__mul__` and may be `join`, are clear enough and without ambiguity for users.\n> \n> Concerning the relabel to integers part, I agree that this is often painful. We could propose and intermediate behavior like: relabel only if some vertices have same label. But again some people will complain.\n> \n> David.\n\nI like the idea of only relabeling (the entire graph) if there are common vertices. NetworkX automatically relabels everything to integers when adding graphs and they get along fine without people complaining. We could possibly think about doing something with recording the previously named values when relabeling them. That way people could choose to invert the labeling if it was really necessary. Our add function could pass in a dictionary of the previous labels as an attribute in the newly created graph.\nIn the end, I think that relabeling to integers is best. If people know they need to preserve vertex names, they can take precautions beforehand.",
    "created_at": "2016-04-29T04:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278851",
    "user": "https://trac.sagemath.org/admin/accounts/users/mcognetta"
}
```

Replying to [comment:2 dcoudert]:
> The current implementation of the `add` method is
> {{{
>         if isinstance(other_graph, GenericGraph):
>             return self.disjoint_union(other_graph, labels='integers')
> }}}
> So it forces to relabel vertices as integer in `[0..n-1]`.
> 
> At the least, we should raise an error for cases such as `Graph({0:[]})+'junk'`. Indeed, the other ordering raises an error
> {{{
> sage: 'junk'+Graph({0:[]})
> ---------------------------------------------------------------------------
> TypeError                                 Traceback (most recent call last)
> <ipython-input-99-2e66a308aaff> in <module>()
> ----> 1 'junk'+Graph({Integer(0):[]})
> 
> TypeError: cannot concatenate 'str' and 'Graph' objects
> }}}
> 
> Now, the semantic of `+` is the disjoint union, and I believe this is the right choice.
> We should however ensure that the doc of `__add__`, `disjoint_union`, `union`, `__mul__` and may be `join`, are clear enough and without ambiguity for users.
> 
> Concerning the relabel to integers part, I agree that this is often painful. We could propose and intermediate behavior like: relabel only if some vertices have same label. But again some people will complain.
> 
> David.

I like the idea of only relabeling (the entire graph) if there are common vertices. NetworkX automatically relabels everything to integers when adding graphs and they get along fine without people complaining. We could possibly think about doing something with recording the previously named values when relabeling them. That way people could choose to invert the labeling if it was really necessary. Our add function could pass in a dictionary of the previous labels as an attribute in the newly created graph.
In the end, I think that relabeling to integers is best. If people know they need to preserve vertex names, they can take precautions beforehand.



---

archive/issue_comments_278852.json:
```json
{
    "body": "Replying to [comment:7 mcognetta]:\n\n> In the end, I think that relabeling to integers is best. If people know they need to preserve vertex names, they can take precautions beforehand.\n\nOK for me. Then it would be like `.disjoint_union(other, labels=\u2019integers\u2019)`. Current behaviour would be maintained, so there is no need for a deprecation. Should `disjoint_union` have an option to get really direct union (and raise an exception it graphs have common vertices)? If not, I will add an example like we now have for disjoint union of posets.\n\nAnd then there is the naming thing.\n\nBut first I will wait for three days to see if there will be opinions against this.",
    "created_at": "2016-04-29T06:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278852",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:7 mcognetta]:

> In the end, I think that relabeling to integers is best. If people know they need to preserve vertex names, they can take precautions beforehand.

OK for me. Then it would be like `.disjoint_union(other, labels=’integers’)`. Current behaviour would be maintained, so there is no need for a deprecation. Should `disjoint_union` have an option to get really direct union (and raise an exception it graphs have common vertices)? If not, I will add an example like we now have for disjoint union of posets.

And then there is the naming thing.

But first I will wait for three days to see if there will be opinions against this.



---

archive/issue_comments_278853.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-05-02T06:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278853",
    "user": "https://github.com/jm58660"
}
```

New commits:



---

archive/issue_comments_278854.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-05-02T06:26:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278854",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_278855.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-05-06T07:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278855",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_278856.json:
```json
{
    "body": "* \"Labels of the resultin\" -> \"Labels of the resulting\"\n* a doctest is needed for the `TypeError` case of the `__add__` method.\n* the error message could be improved, for instance to something similar to\n\n```\nsage: 1+'a'\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n...\nTypeError: unsupported operand parent(s) for '+': 'Integer Ring' and '<type 'str'>'\n```\n\nWe could using something like that, which is valid for both `Graph` and `DiGraph`.\n\n```\nraise TypeError(\"adding a '{}' and a '{}' is not defined\".format(typeof(self),typeof(other))\n```\n\n* I'm not fully aware of python3 syntax, but I suggest to avoid using `G._name = '%s disjoint_union %s'%(a, b)` and to prefer `G._name = '{} disjoint_union {}'.format(a, b)`. Well actually this is certainly more robust: `G.name('{} disjoint_union {}'.format(a, b))`.",
    "created_at": "2016-05-06T07:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278856",
    "user": "https://github.com/dcoudert"
}
```

* "Labels of the resultin" -> "Labels of the resulting"
* a doctest is needed for the `TypeError` case of the `__add__` method.
* the error message could be improved, for instance to something similar to

```
sage: 1+'a'
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
...
TypeError: unsupported operand parent(s) for '+': 'Integer Ring' and '<type 'str'>'
```

We could using something like that, which is valid for both `Graph` and `DiGraph`.

```
raise TypeError("adding a '{}' and a '{}' is not defined".format(typeof(self),typeof(other))
```

* I'm not fully aware of python3 syntax, but I suggest to avoid using `G._name = '%s disjoint_union %s'%(a, b)` and to prefer `G._name = '{} disjoint_union {}'.format(a, b)`. Well actually this is certainly more robust: `G.name('{} disjoint_union {}'.format(a, b))`.



---

archive/issue_comments_278857.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-09T08:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_278858.json:
```json
{
    "body": "Replying to [comment:13 dcoudert]:\n\nI didi three changes as you suggested.\n\n> * I'm not fully aware of python3 syntax, but I suggest to avoid using `G._name = '%s disjoint_union %s'%(a, b)` and to prefer `G._name = '{} disjoint_union {}'.format(a, b)`. Well actually this is certainly more robust: `G.name('{} disjoint_union {}'.format(a, b))`. \n\nThis will give an error: immutable graph can not change name. I suggest we keep this as it is now and think about this later.",
    "created_at": "2016-05-09T08:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278858",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:13 dcoudert]:

I didi three changes as you suggested.

> * I'm not fully aware of python3 syntax, but I suggest to avoid using `G._name = '%s disjoint_union %s'%(a, b)` and to prefer `G._name = '{} disjoint_union {}'.format(a, b)`. Well actually this is certainly more robust: `G.name('{} disjoint_union {}'.format(a, b))`. 

This will give an error: immutable graph can not change name. I suggest we keep this as it is now and think about this later.



---

archive/issue_comments_278859.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-05-09T08:34:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278859",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_278860.json:
```json
{
    "body": "The error message is confusing since the order of types is the reverse of the one used in the operation.\n\n```\n+            sage: G+42\n+            Traceback (most recent call last):\n+            ...\n+            TypeError: adding a <type 'sage.rings.integer.Integer'> to a <class 'sage.graphs.graph.Graph'> is not defined\n```\n\n\nI was not aware of the problem with immutable graphs. So ok to assign directly to `G._name`.\nHowever, you should replace `G._name = '%s disjoint_union %s'%(a, b)` with `G._name = '{} disjoint_union {}'.format(a, b)`.\nSome people are actively working on making sage python3 compliant. No need to add extra work.",
    "created_at": "2016-05-09T10:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278860",
    "user": "https://github.com/dcoudert"
}
```

The error message is confusing since the order of types is the reverse of the one used in the operation.

```
+            sage: G+42
+            Traceback (most recent call last):
+            ...
+            TypeError: adding a <type 'sage.rings.integer.Integer'> to a <class 'sage.graphs.graph.Graph'> is not defined
```


I was not aware of the problem with immutable graphs. So ok to assign directly to `G._name`.
However, you should replace `G._name = '%s disjoint_union %s'%(a, b)` with `G._name = '{} disjoint_union {}'.format(a, b)`.
Some people are actively working on making sage python3 compliant. No need to add extra work.



---

archive/issue_comments_278861.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-09T10:35:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_278862.json:
```json
{
    "body": "OK, done that.\n\n(But I think that naming question should be considered later. Maybe the design can be made better.)",
    "created_at": "2016-05-09T10:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278862",
    "user": "https://github.com/jm58660"
}
```

OK, done that.

(But I think that naming question should be considered later. Maybe the design can be made better.)



---

archive/issue_comments_278863.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-09T12:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278863",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_278864.json:
```json
{
    "body": "The patch is good to go.\nThanks,\nDavid.",
    "created_at": "2016-05-09T12:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278864",
    "user": "https://github.com/dcoudert"
}
```

The patch is good to go.
Thanks,
David.



---

archive/issue_comments_278865.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-17T07:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20262#issuecomment-278865",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_055394.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-05-17T07:16:29Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20262",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20262#event-55394"
}
```
