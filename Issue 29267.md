# Issue 29267: ./configure + homebrew: recommend the script .homebrew-build-env

archive/issues_029267.json:
```json
{
    "body": "CC:  @mkoeppe @dimpase @dcoudert\n\nWhen homebrew is detected, the \"hints\" at the end of running `./configure` should suggest running the script `.homebrew-build-env`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29504\n\n",
    "created_at": "2020-04-13T21:15:10Z",
    "labels": [
        "build: configure",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "./configure + homebrew: recommend the script .homebrew-build-env",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29267",
    "user": "@jhpalmieri"
}
```
CC:  @mkoeppe @dimpase @dcoudert

When homebrew is detected, the "hints" at the end of running `./configure` should suggest running the script `.homebrew-build-env`.

Issue created by migration from https://trac.sagemath.org/ticket/29504





---

archive/issue_comments_414884.json:
```json
{
    "body": "Questions: \n\n- should `.homebrew-build-env` have a `#!...` line at the top?\n- with zsh, the new default shell on OS X, `. .homebrew-build-env` fails, but `source .homebrew-build-env` works. Do we always suggest `source .homebrew...`, or is there a reason to suggest `. .homebrew...`, for example when using bash? With zsh:\n\n```\n% . .homebrew-build-env     \n.: no such file or directory: .homebrew-build-env\n```\n\n I guess in zsh, the correct invocation with `.` would be `. ./.homebrew-...`: you have to specify the path.",
    "created_at": "2020-04-13T21:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414884",
    "user": "@jhpalmieri"
}
```

Questions: 

- should `.homebrew-build-env` have a `#!...` line at the top?
- with zsh, the new default shell on OS X, `. .homebrew-build-env` fails, but `source .homebrew-build-env` works. Do we always suggest `source .homebrew...`, or is there a reason to suggest `. .homebrew...`, for example when using bash? With zsh:

```
% . .homebrew-build-env     
.: no such file or directory: .homebrew-build-env
```

 I guess in zsh, the correct invocation with `.` would be `. ./.homebrew-...`: you have to specify the path.



---

archive/issue_comments_414885.json:
```json
{
    "body": "Replying to [comment:1 jhpalmieri]:\n> Questions: \n> \n> - should `.homebrew-build-env` have a `#!...` line at the top?\n> - with zsh, the new default shell on OS X, `. .homebrew-build-env` fails, but `source .homebrew-build-env` works. Do we always suggest `source .homebrew...`, or is there a reason to suggest `. .homebrew...`, for example when using bash? With zsh:\n> {{{\n> % . .homebrew-build-env     \n> .: no such file or directory: .homebrew-build-env\n> }}}\n>  I guess in zsh, the correct invocation with `.` would be `. ./.homebrew-...`: you have to specify the path.\n\nGood idea. We should recommend `source ./.homebrew-build-env` then.\n\nNo `#!` because it must be sourced, not executed",
    "created_at": "2020-04-13T23:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414885",
    "user": "@mkoeppe"
}
```

Replying to [comment:1 jhpalmieri]:
> Questions: 
> 
> - should `.homebrew-build-env` have a `#!...` line at the top?
> - with zsh, the new default shell on OS X, `. .homebrew-build-env` fails, but `source .homebrew-build-env` works. Do we always suggest `source .homebrew...`, or is there a reason to suggest `. .homebrew...`, for example when using bash? With zsh:
> {{{
> % . .homebrew-build-env     
> .: no such file or directory: .homebrew-build-env
> }}}
>  I guess in zsh, the correct invocation with `.` would be `. ./.homebrew-...`: you have to specify the path.

Good idea. We should recommend `source ./.homebrew-build-env` then.

No `#!` because it must be sourced, not executed



---

archive/issue_comments_414886.json:
```json
{
    "body": "References: \n\n_ environment variables - What is the difference between '.' and 'source' in shells? - Unix & Linux Stack Exchange\nhttps://unix.stackexchange.com/questions/58514/what-is-the-difference-between-and-source-in-shells\n\nbash - running script with \". \" and with \"source \" - Unix & Linux Stack Exchange\nhttps://unix.stackexchange.com/questions/17815/running-script-with-and-with-source",
    "created_at": "2020-04-13T23:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414886",
    "user": "@mkoeppe"
}
```

References: 

_ environment variables - What is the difference between '.' and 'source' in shells? - Unix & Linux Stack Exchange
https://unix.stackexchange.com/questions/58514/what-is-the-difference-between-and-source-in-shells

bash - running script with ". " and with "source " - Unix & Linux Stack Exchange
https://unix.stackexchange.com/questions/17815/running-script-with-and-with-source



---

archive/issue_comments_414887.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-14T00:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414887",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_414888.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-04-14T00:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414888",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_414889.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-04-14T00:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414889",
    "user": "@mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_414890.json:
```json
{
    "body": "Thank you for working on this, but this only prints the message if there are uninstalled homebrew packages. Otherwise, this code gets executed before the message has a chance to be printed:\n\n```\nif [ -z \"$system_packages\" ]; then\n    # No command needed to install nothing\n    exit 0\nfi\n```\n",
    "created_at": "2020-04-14T02:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414890",
    "user": "@jhpalmieri"
}
```

Thank you for working on this, but this only prints the message if there are uninstalled homebrew packages. Otherwise, this code gets executed before the message has a chance to be printed:

```
if [ -z "$system_packages" ]; then
    # No command needed to install nothing
    exit 0
fi
```




---

archive/issue_comments_414891.json:
```json
{
    "body": "Replying to [ticket:29504 jhpalmieri]:\n> When homebrew is detected, the \"hints\" at the end of running `./configure` should suggest running the script `.homebrew-build-env`.\n\nIf one sources this file, one would always need to make sure that it is sourced whenever one runs `make` or `sage -b`, right? If so, the hint should mention this. Still, I would probably forget about it sooner or later and end up with a broken build.",
    "created_at": "2020-04-14T16:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414891",
    "user": "@mwageringel"
}
```

Replying to [ticket:29504 jhpalmieri]:
> When homebrew is detected, the "hints" at the end of running `./configure` should suggest running the script `.homebrew-build-env`.

If one sources this file, one would always need to make sure that it is sourced whenever one runs `make` or `sage -b`, right? If so, the hint should mention this. Still, I would probably forget about it sooner or later and end up with a broken build.



---

archive/issue_comments_414892.json:
```json
{
    "body": "Replying to [comment:7 gh-mwageringel]:\n> Replying to [ticket:29504 jhpalmieri]:\n> > When homebrew is detected, the \"hints\" at the end of running `./configure` should suggest running the script `.homebrew-build-env`.\n> \n> If one sources this file, one would always need to make sure that it is sourced whenever one runs `make` or `sage -b`, right? If so, the hint should mention this. Still, I would probably forget about it sooner or later and end up with a broken build.\n\nAre you suggesting deleting the file altogether, or automatically running it every time?",
    "created_at": "2020-04-14T16:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414892",
    "user": "@jhpalmieri"
}
```

Replying to [comment:7 gh-mwageringel]:
> Replying to [ticket:29504 jhpalmieri]:
> > When homebrew is detected, the "hints" at the end of running `./configure` should suggest running the script `.homebrew-build-env`.
> 
> If one sources this file, one would always need to make sure that it is sourced whenever one runs `make` or `sage -b`, right? If so, the hint should mention this. Still, I would probably forget about it sooner or later and end up with a broken build.

Are you suggesting deleting the file altogether, or automatically running it every time?



---

archive/issue_comments_414893.json:
```json
{
    "body": "Replying to [comment:8 jhpalmieri]:\n> Are you suggesting deleting the file altogether, or automatically running it every time?\n\nI am not suggesting to delete it, as it is used by the tox system, but, if my understanding is correct, then it certainly seems less error-prone if Sage could be configured to source it during the build process.",
    "created_at": "2020-04-14T17:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414893",
    "user": "@mwageringel"
}
```

Replying to [comment:8 jhpalmieri]:
> Are you suggesting deleting the file altogether, or automatically running it every time?

I am not suggesting to delete it, as it is used by the tox system, but, if my understanding is correct, then it certainly seems less error-prone if Sage could be configured to source it during the build process.



---

archive/issue_comments_414894.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-14T20:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414894",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414895.json:
```json
{
    "body": "How about this version?\n\n```\nconfigure: notice: the following SPKGs did not find equivalent system packages: cbc gp2c libsemigroups ninja_build pari_elldata pari_galpol pari_nftables pari_seadata perl_term_readline_gnu\nchecking for the package system in use... homebrew\nconfigure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:\nconfigure:   $ brew install ninja\n# Afterwards: \n# To automatically take care of homebrew messages regarding \n# keg-only packages for the current shell session:\n# $ source /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.homebrew-build-env\n# Add this to your shell profile if you want it to persist between shell sessions.\nconfigure: After installation, re-run configure using:\nconfigure:   $ ./config.status --recheck && ./config.status\n```\n",
    "created_at": "2020-04-14T20:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414895",
    "user": "@mkoeppe"
}
```

How about this version?

```
configure: notice: the following SPKGs did not find equivalent system packages: cbc gp2c libsemigroups ninja_build pari_elldata pari_galpol pari_nftables pari_seadata perl_term_readline_gnu
checking for the package system in use... homebrew
configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:
configure:   $ brew install ninja
# Afterwards: 
# To automatically take care of homebrew messages regarding 
# keg-only packages for the current shell session:
# $ source /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/.homebrew-build-env
# Add this to your shell profile if you want it to persist between shell sessions.
configure: After installation, re-run configure using:
configure:   $ ./config.status --recheck && ./config.status
```




---

archive/issue_comments_414896.json:
```json
{
    "body": "Replying to [comment:9 gh-mwageringel]:\n> ...  if Sage could be configured to source it during the build process.\n\nI would like to keep all interactions with the system package manager on the level of hints issued to the user.\nThe user should be in charge of their environment.",
    "created_at": "2020-04-14T21:01:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414896",
    "user": "@mkoeppe"
}
```

Replying to [comment:9 gh-mwageringel]:
> ...  if Sage could be configured to source it during the build process.

I would like to keep all interactions with the system package manager on the level of hints issued to the user.
The user should be in charge of their environment.



---

archive/issue_comments_414897.json:
```json
{
    "body": "My initial reaction is that this won't work, since I have multiple Sage builds in different directories, but then I realized that the same script `.homebrew-build-env` works in all of those directories at the same time. So this would be fine with me.\n\nThe other option would be that running `source .homebrew-build-env` once would change the configuration so that future builds within that directory would automatically have `PKG_CONFIG_PATH`, etc., keep the same values. I think that's what `@`gh-mwageringel was suggesting.",
    "created_at": "2020-04-14T21:04:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414897",
    "user": "@jhpalmieri"
}
```

My initial reaction is that this won't work, since I have multiple Sage builds in different directories, but then I realized that the same script `.homebrew-build-env` works in all of those directories at the same time. So this would be fine with me.

The other option would be that running `source .homebrew-build-env` once would change the configuration so that future builds within that directory would automatically have `PKG_CONFIG_PATH`, etc., keep the same values. I think that's what `@`gh-mwageringel was suggesting.



---

archive/issue_comments_414898.json:
```json
{
    "body": "Replying to [comment:13 jhpalmieri]:\n> The other option would be that running `source .homebrew-build-env` once would change the configuration so that future builds within that directory would automatically have `PKG_CONFIG_PATH`, etc., keep the same values. I think that's what `@`gh-mwageringel was suggesting.\n\nOK, I think this would actually be best handled via #29507 rather than making it homebrew-specific. Something for 9.2.",
    "created_at": "2020-04-14T21:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414898",
    "user": "@mkoeppe"
}
```

Replying to [comment:13 jhpalmieri]:
> The other option would be that running `source .homebrew-build-env` once would change the configuration so that future builds within that directory would automatically have `PKG_CONFIG_PATH`, etc., keep the same values. I think that's what `@`gh-mwageringel was suggesting.

OK, I think this would actually be best handled via #29507 rather than making it homebrew-specific. Something for 9.2.



---

archive/issue_comments_414899.json:
```json
{
    "body": "I would suggest waiting until #29507 is resolved, instead of adding this message now and then possibly changing it after #29507. (But if others feel strongly that it should go in now, I won't object. I like the wording in comment:11.)",
    "created_at": "2020-04-15T02:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414899",
    "user": "@jhpalmieri"
}
```

I would suggest waiting until #29507 is resolved, instead of adding this message now and then possibly changing it after #29507. (But if others feel strongly that it should go in now, I won't object. I like the wording in comment:11.)



---

archive/issue_comments_414900.json:
```json
{
    "body": "The only thing that would change with the #29507 is the last sentence; and it won't be a problem if users have already put this line in their shell profiles.\n\nSo I would be in favor of getting this into 9.1. Otherwise, this will be an FAQ on sage-support",
    "created_at": "2020-04-15T02:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414900",
    "user": "@mkoeppe"
}
```

The only thing that would change with the #29507 is the last sentence; and it won't be a problem if users have already put this line in their shell profiles.

So I would be in favor of getting this into 9.1. Otherwise, this will be an FAQ on sage-support



---

archive/issue_comments_414901.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2020-04-15T03:24:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414901",
    "user": "@mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_414902.json:
```json
{
    "body": "Replying to [comment:16 mkoeppe]:\n> The only thing that would change with the #29507 is the last sentence; and it won't be a problem if users have already put this line in their shell profiles.\n> \n> So I would be in favor of getting this into 9.1. Otherwise, this will be an FAQ on sage-support\n\nOkay. I think it will still be an FAQ, since people are not in the habit of running `./configure` before running `make`.\n\nI still don't see the message at the end of `./configure`, though, when I have installed all of the recommended packages:\n\n```\n$ ./configure\n...\nconfigure: notice: the following SPKGs did not find equivalent system packages: cbc gp2c libsemigroups pari_elldata pari_galpol pari_nftables pari_seadata perl_term_readline_gnu\nchecking for the package system in use... homebrew\nconfigure: No equivalent system packages for homebrew are known to Sage\n$\n```\n",
    "created_at": "2020-04-15T17:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414902",
    "user": "@jhpalmieri"
}
```

Replying to [comment:16 mkoeppe]:
> The only thing that would change with the #29507 is the last sentence; and it won't be a problem if users have already put this line in their shell profiles.
> 
> So I would be in favor of getting this into 9.1. Otherwise, this will be an FAQ on sage-support

Okay. I think it will still be an FAQ, since people are not in the habit of running `./configure` before running `make`.

I still don't see the message at the end of `./configure`, though, when I have installed all of the recommended packages:

```
$ ./configure
...
configure: notice: the following SPKGs did not find equivalent system packages: cbc gp2c libsemigroups pari_elldata pari_galpol pari_nftables pari_seadata perl_term_readline_gnu
checking for the package system in use... homebrew
configure: No equivalent system packages for homebrew are known to Sage
$
```




---

archive/issue_comments_414903.json:
```json
{
    "body": "I tried and saw the message at the end of `./configure`.\n\nBy the way, for some reason I made a `make distclean`, and its first action was to run `./configure`...  and again after typing `make`.",
    "created_at": "2020-04-15T17:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414903",
    "user": "@dcoudert"
}
```

I tried and saw the message at the end of `./configure`.

By the way, for some reason I made a `make distclean`, and its first action was to run `./configure`...  and again after typing `make`.



---

archive/issue_comments_414904.json:
```json
{
    "body": "Replying to [comment:12 mkoeppe]:\n> Replying to [comment:9 gh-mwageringel]:\n> > ...  if Sage could be configured to source it during the build process.\n> \n> I would like to keep all interactions with the system package manager on the level of hints issued to the user.\n> The user should be in charge of their environment.\n\nOk, fair enough. The new message is better indeed. Adding the `source` statement to one's shell profile has the potential to cause problems when compiling things outside of Sage I believe, as there must be a reason these packages are keg-only, so hopefully only users who understand the consequences of that (not me) do that.",
    "created_at": "2020-04-15T17:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414904",
    "user": "@mwageringel"
}
```

Replying to [comment:12 mkoeppe]:
> Replying to [comment:9 gh-mwageringel]:
> > ...  if Sage could be configured to source it during the build process.
> 
> I would like to keep all interactions with the system package manager on the level of hints issued to the user.
> The user should be in charge of their environment.

Ok, fair enough. The new message is better indeed. Adding the `source` statement to one's shell profile has the potential to cause problems when compiling things outside of Sage I believe, as there must be a reason these packages are keg-only, so hopefully only users who understand the consequences of that (not me) do that.



---

archive/issue_comments_414905.json:
```json
{
    "body": "Replying to [comment:20 dcoudert]:\n> By the way, for some reason I made a `make distclean`, and its first action was to run `./configure`...  and again after typing `make`.\nWe have two tickets for reducing the number of times that `configure` gets run: #29460 (Run configure less often) and #29310 (\"make distclean\" should not run \"./configure\")",
    "created_at": "2020-04-15T17:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414905",
    "user": "@mkoeppe"
}
```

Replying to [comment:20 dcoudert]:
> By the way, for some reason I made a `make distclean`, and its first action was to run `./configure`...  and again after typing `make`.
We have two tickets for reducing the number of times that `configure` gets run: #29460 (Run configure less often) and #29310 ("make distclean" should not run "./configure")



---

archive/issue_comments_414906.json:
```json
{
    "body": "Thank you so much ! :))",
    "created_at": "2020-04-15T17:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414906",
    "user": "@dcoudert"
}
```

Thank you so much ! :))



---

archive/issue_comments_414907.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> I still don't see the message at the end of `./configure`, though, when I have installed all of the recommended packages:\n\nRight, sorry, there's one more place to fix",
    "created_at": "2020-04-15T17:49:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414907",
    "user": "@mkoeppe"
}
```

Replying to [comment:19 jhpalmieri]:
> I still don't see the message at the end of `./configure`, though, when I have installed all of the recommended packages:

Right, sorry, there's one more place to fix



---

archive/issue_comments_414908.json:
```json
{
    "body": "what is this `gettext` in `for l in gettext; do` in `.homebrew-build-env` ?\nI'm confused.",
    "created_at": "2020-04-15T17:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414908",
    "user": "@dimpase"
}
```

what is this `gettext` in `for l in gettext; do` in `.homebrew-build-env` ?
I'm confused.



---

archive/issue_comments_414909.json:
```json
{
    "body": "Replying to [comment:25 dimpase]:\n> what is this `gettext` in `for l in gettext; do` in `.homebrew-build-env` ?\n> I'm confused.\n\nThe loop runs once with `l` equal to `\"gettext\"`, right? I assume it's written like this in case more packages eventually need to be treated the same way.",
    "created_at": "2020-04-15T17:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414909",
    "user": "@jhpalmieri"
}
```

Replying to [comment:25 dimpase]:
> what is this `gettext` in `for l in gettext; do` in `.homebrew-build-env` ?
> I'm confused.

The loop runs once with `l` equal to `"gettext"`, right? I assume it's written like this in case more packages eventually need to be treated the same way.



---

archive/issue_comments_414910.json:
```json
{
    "body": "Replying to [comment:26 jhpalmieri]:\n> Replying to [comment:25 dimpase]:\n> > what is this `gettext` in `for l in gettext; do` in `.homebrew-build-env` ?\n> > I'm confused.\n> \n> The loop runs once with `l` equal to `\"gettext\"`, right? I assume it's written like this in case more packages eventually need to be treated the same way.\nThat's right.",
    "created_at": "2020-04-15T17:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414910",
    "user": "@mkoeppe"
}
```

Replying to [comment:26 jhpalmieri]:
> Replying to [comment:25 dimpase]:
> > what is this `gettext` in `for l in gettext; do` in `.homebrew-build-env` ?
> > I'm confused.
> 
> The loop runs once with `l` equal to `"gettext"`, right? I assume it's written like this in case more packages eventually need to be treated the same way.
That's right.



---

archive/issue_comments_414911.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> I still don't see the message at the end of `./configure`, though, when I have installed all of the recommended packages:\n> {{{\n> $ ./configure\n> ...\n> configure: notice: the following SPKGs did not find equivalent system packages: cbc gp2c libsemigroups pari_elldata pari_galpol pari_nftables pari_seadata perl_term_readline_gnu\n> checking for the package system in use... homebrew\n> configure: No equivalent system packages for homebrew are known to Sage\n> $\n> }}}\nWait... why do you want to see a message here? Everything is in order",
    "created_at": "2020-04-15T17:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414911",
    "user": "@mkoeppe"
}
```

Replying to [comment:19 jhpalmieri]:
> I still don't see the message at the end of `./configure`, though, when I have installed all of the recommended packages:
> {{{
> $ ./configure
> ...
> configure: notice: the following SPKGs did not find equivalent system packages: cbc gp2c libsemigroups pari_elldata pari_galpol pari_nftables pari_seadata perl_term_readline_gnu
> checking for the package system in use... homebrew
> configure: No equivalent system packages for homebrew are known to Sage
> $
> }}}
Wait... why do you want to see a message here? Everything is in order



---

archive/issue_comments_414912.json:
```json
{
    "body": "Replying to [comment:27 mkoeppe]:\n> Replying to [comment:26 jhpalmieri]:\n> > Replying to [comment:25 dimpase]:\n> > > what is this `gettext` in `for l in gettext; do` in `.homebrew-build-env` ?\n> > > I'm confused.\n> > \n> > The loop runs once with `l` equal to `\"gettext\"`, right? I assume it's written like this in case more packages eventually need to be treated the same way.\n> That's right.\n\nthanks. That was too creative for me :-)",
    "created_at": "2020-04-15T17:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414912",
    "user": "@dimpase"
}
```

Replying to [comment:27 mkoeppe]:
> Replying to [comment:26 jhpalmieri]:
> > Replying to [comment:25 dimpase]:
> > > what is this `gettext` in `for l in gettext; do` in `.homebrew-build-env` ?
> > > I'm confused.
> > 
> > The loop runs once with `l` equal to `"gettext"`, right? I assume it's written like this in case more packages eventually need to be treated the same way.
> That's right.

thanks. That was too creative for me :-)



---

archive/issue_comments_414913.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> I think it will still be an FAQ, since people are not in the habit of running `./configure` before running `make`.\n\nWell, we could do #29316 (Require ./configure before make)...\n\nAt least we should make sure that `./configure` appears in all build instructions. We changed some in #29496 (Update README.md and Installation Guide) already, but there are more",
    "created_at": "2020-04-15T18:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414913",
    "user": "@mkoeppe"
}
```

Replying to [comment:19 jhpalmieri]:
> I think it will still be an FAQ, since people are not in the habit of running `./configure` before running `make`.

Well, we could do #29316 (Require ./configure before make)...

At least we should make sure that `./configure` appears in all build instructions. We changed some in #29496 (Update README.md and Installation Guide) already, but there are more



---

archive/issue_comments_414914.json:
```json
{
    "body": "Replying to [comment:28 mkoeppe]:\n> Wait... why do you want to see a message here? Everything is in order\n\nThat's a fair question. Maybe I don't need to see the message? Are we convinced that if `./configure` finds everything, then all of Sage's packages will also find everything? (It turns out that I had run `source .homebrew-...` earlier in that shell session, which is why `./configure` was happy.)\n\nA minor point: when I see the message, I see\n\n```\n# Afterwards: \n# To automatically take care of homebrew messages regarding \n# keg-only packages for the current shell session:\n# $ source ./.homebrew-build-env\n# Add this to your shell profile if you want it to persist between shell sessions.\n```\n\nIt would be nice if it gave an absolute path so I could cut and paste it into my shell profile. But this is not a big deal: someone who has been installing homebrew packages probably knows enough to change this. But would this change be helpful?\n\n```diff\ndiff --git a/build/bin/sage-print-system-package-command b/build/bin/sage-print-system-package-command\nindex 7802d447df..ee3d3c0c5b 100755\n--- a/build/bin/sage-print-system-package-command\n+++ b/build/bin/sage-print-system-package-command\n@@ -45,7 +45,7 @@ case $system:$command in\n     homebrew*:install)\n         echo \"# To automatically take care of homebrew messages regarding \"\n         echo \"# keg-only packages for the current shell session:\"\n-        [ -n \"$SAGE_ROOT\" ] || SAGE_ROOT=.\n+        [ -n \"$SAGE_ROOT\" ] || SAGE_ROOT=`pwd`\n         echo \"# $ source $SAGE_ROOT/.homebrew-build-env\"\n         echo \"# Add this to your shell profile if you want it to persist between shell sessions.\"\n         ;;\n```\n",
    "created_at": "2020-04-15T18:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414914",
    "user": "@jhpalmieri"
}
```

Replying to [comment:28 mkoeppe]:
> Wait... why do you want to see a message here? Everything is in order

That's a fair question. Maybe I don't need to see the message? Are we convinced that if `./configure` finds everything, then all of Sage's packages will also find everything? (It turns out that I had run `source .homebrew-...` earlier in that shell session, which is why `./configure` was happy.)

A minor point: when I see the message, I see

```
# Afterwards: 
# To automatically take care of homebrew messages regarding 
# keg-only packages for the current shell session:
# $ source ./.homebrew-build-env
# Add this to your shell profile if you want it to persist between shell sessions.
```

It would be nice if it gave an absolute path so I could cut and paste it into my shell profile. But this is not a big deal: someone who has been installing homebrew packages probably knows enough to change this. But would this change be helpful?

```diff
diff --git a/build/bin/sage-print-system-package-command b/build/bin/sage-print-system-package-command
index 7802d447df..ee3d3c0c5b 100755
--- a/build/bin/sage-print-system-package-command
+++ b/build/bin/sage-print-system-package-command
@@ -45,7 +45,7 @@ case $system:$command in
     homebrew*:install)
         echo "# To automatically take care of homebrew messages regarding "
         echo "# keg-only packages for the current shell session:"
-        [ -n "$SAGE_ROOT" ] || SAGE_ROOT=.
+        [ -n "$SAGE_ROOT" ] || SAGE_ROOT=`pwd`
         echo "# $ source $SAGE_ROOT/.homebrew-build-env"
         echo "# Add this to your shell profile if you want it to persist between shell sessions."
         ;;
```




---

archive/issue_comments_414915.json:
```json
{
    "body": "Replying to [comment:31 jhpalmieri]:\n> A minor point: when I see the message, I see\n> {{{\n> # Afterwards: \n> # To automatically take care of homebrew messages regarding \n> # keg-only packages for the current shell session:\n> # $ source ./.homebrew-build-env\n> # Add this to your shell profile if you want it to persist between shell sessions.\n> }}}\n> It would be nice if it gave an absolute path so I could cut and paste it into my shell profile. But this is not a big deal: someone who has been installing homebrew packages probably knows enough to change this. But would this change be helpful?\n\nDid you run bootstrap? There is already a change that does that",
    "created_at": "2020-04-15T18:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414915",
    "user": "@mkoeppe"
}
```

Replying to [comment:31 jhpalmieri]:
> A minor point: when I see the message, I see
> {{{
> # Afterwards: 
> # To automatically take care of homebrew messages regarding 
> # keg-only packages for the current shell session:
> # $ source ./.homebrew-build-env
> # Add this to your shell profile if you want it to persist between shell sessions.
> }}}
> It would be nice if it gave an absolute path so I could cut and paste it into my shell profile. But this is not a big deal: someone who has been installing homebrew packages probably knows enough to change this. But would this change be helpful?

Did you run bootstrap? There is already a change that does that



---

archive/issue_comments_414916.json:
```json
{
    "body": "Running bootstrap fixes it. When does that need to be run? The only information I see says to run it if `./configure` doesn't exist.",
    "created_at": "2020-04-15T18:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414916",
    "user": "@jhpalmieri"
}
```

Running bootstrap fixes it. When does that need to be run? The only information I see says to run it if `./configure` doesn't exist.



---

archive/issue_comments_414917.json:
```json
{
    "body": "Replying to [comment:31 jhpalmieri]:\n> Replying to [comment:28 mkoeppe]:\n> > Wait... why do you want to see a message here? Everything is in order\n> \n> That's a fair question. Maybe I don't need to see the message? Are we convinced that if `./configure` finds everything, then all of Sage's packages will also find everything? \n\nThis strong statement is not true because of #29448 (configure finds libpng but matplotlib does not) and perhaps also #27205 (Sage ignores libs from pkgconfig).\n\nBut a weaker statement is true: The set of settings that I make in `.homebrew-build-env` is minimal so that configure finds everything.",
    "created_at": "2020-04-15T18:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414917",
    "user": "@mkoeppe"
}
```

Replying to [comment:31 jhpalmieri]:
> Replying to [comment:28 mkoeppe]:
> > Wait... why do you want to see a message here? Everything is in order
> 
> That's a fair question. Maybe I don't need to see the message? Are we convinced that if `./configure` finds everything, then all of Sage's packages will also find everything? 

This strong statement is not true because of #29448 (configure finds libpng but matplotlib does not) and perhaps also #27205 (Sage ignores libs from pkgconfig).

But a weaker statement is true: The set of settings that I make in `.homebrew-build-env` is minimal so that configure finds everything.



---

archive/issue_comments_414918.json:
```json
{
    "body": "Replying to [comment:33 jhpalmieri]:\n> Running bootstrap fixes it. When does that need to be run? The only information I see says to run it if `./configure` doesn't exist.\nYou only need to run it on the ticket because the configure tarball is not current.",
    "created_at": "2020-04-15T18:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414918",
    "user": "@mkoeppe"
}
```

Replying to [comment:33 jhpalmieri]:
> Running bootstrap fixes it. When does that need to be run? The only information I see says to run it if `./configure` doesn't exist.
You only need to run it on the ticket because the configure tarball is not current.



---

archive/issue_comments_414919.json:
```json
{
    "body": "Okay, let's proceed with this. Thank you for being so patient with all of my questions.",
    "created_at": "2020-04-15T19:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414919",
    "user": "@jhpalmieri"
}
```

Okay, let's proceed with this. Thank you for being so patient with all of my questions.



---

archive/issue_comments_414920.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-15T19:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414920",
    "user": "@jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414921.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-04-15T21:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414921",
    "user": "@mkoeppe"
}
```

Thank you!



---

archive/issue_comments_414922.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-16T22:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29267#issuecomment-414922",
    "user": "@vbraun"
}
```

Resolution: fixed
