# Issue 19732: asymptotic expansion generator: singularity analysis (log-type)

Issue created by migration from Trac.

Original creator: behackl

Original creation time: 2016-01-27 10:16:14

CC:  dkrenn cheuberg

Follow-up to #19532. This ticket is for implementation of the case `beta != 0`. 


---

Comment by behackl created at 2016-01-27 19:01:59

Implemented the generator for `beta != 0`; some doctests still have to be written, but the method should work in general.
----
Last 10 new commits:


---

Comment by git created at 2016-01-28 23:49:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by behackl created at 2016-01-29 09:11:37

Changing status from new to needs_review.


---

Comment by cheuberg created at 2016-01-30 16:43:52

I had a first look at this implementation.

1. I am not sure that three different implementations (beta=0, beta in ZZ and beta>0, otherwise) are needed: the only difference is the range over with `k`, `l`, `r` iterate and possibly the growth groups. But the basic coefficients stay the same. Perhaps we should even abolish the function `_sa_coefficients_e_` because collecting for a single `Gamma(alpha)` is not really worthwhile. That would mean removing the parameter `skip_constant_factor` which seems to be less important here.

2. the error term in the case of beta not in NN is not good, it should depend on beta (I very much prefer the strategy for beta in ZZ).

3. summation index `k` should be replaced by `r` in case beta not in ZZ in order to have consistent naming of summation indices.

4. Could you please post values for `compare_with_values` for `alpha=2` and `beta=1/2`? With `precision=10`, I get 

```
[(5, -140.014037108338),
 (10, -432.585380667007),
 (20, -1894.51971835043),
 (40, -5905.52939497361),
 (80, -13574.5908343596)]
```

  which I do not find convincing. Of course, convergence will be bad due to slow growth of logarithms, so larger values might be of interest, but I do currently lack computer power to test it myself. But that might be a consequence of 2.


---

Comment by cheuberg created at 2016-01-30 16:43:52

Changing status from needs_review to needs_work.


---

Comment by cheuberg created at 2016-02-07 13:46:58

Replying to [comment:4 cheuberg]:
> 2. the error term in the case of beta not in NN is not good, it should depend on beta (I very much prefer the strategy for beta in ZZ).

at second glance, the error term seems to be fine.

> 4. Could you please post values for `compare_with_values` for `alpha=2` and `beta=1/2`? With `precision=10`, I get 
> {{{
> [(5, -140.014037108338),
>  (10, -432.585380667007),
>  (20, -1894.51971835043),
>  (40, -5905.52939497361),
>  (80, -13574.5908343596)]
> }}}
>   which I do not find convincing. Of course, convergence will be bad due to slow growth of logarithms, so larger values might be of interest, but I do currently lack computer power to test it myself. But that might be a consequence of 2.

this is settled, much larger values apparently lead to convergence.


---

Comment by cheuberg created at 2016-02-07 16:36:19

Changing status from needs_work to needs_review.


---

Comment by cheuberg created at 2016-02-07 16:36:19

Replying to [comment:4 cheuberg]:
> 1. I am not sure that three different implementations (beta=0, beta in ZZ and beta>0, otherwise) are needed: the only difference is the range over with `k`, `l`, `r` iterate and possibly the growth groups. But the basic coefficients stay the same. Perhaps we should even abolish the function `_sa_coefficients_e_` because collecting for a single `Gamma(alpha)` is not really worthwhile. That would mean removing the parameter `skip_constant_factor` which seems to be less important here.

done.

> 3. summation index `k` should be replaced by `r` in case beta not in ZZ in order to have consistent naming of summation indices.

done.

This amounts to a major rewrite of the code (old case beta=0 as well as new case). Please review.
----
New commits:


---

Comment by dkrenn created at 2016-02-12 13:37:16

Merged #20043 due to a conflict; is now on 7.1.beta3.
----
New commits:


---

Comment by git created at 2016-02-12 13:51:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2016-02-12 18:04:46

Replying to [comment:11 git]:
> ||[dd7dabf](http://git.sagemath.org/sage.git/commit/?id=dd7dabf33622b4c2d7257d2e43f4970092b6867a)||`Trac #19969: fix doctest`||

cross-reviewed the merge and the changes.


---

Comment by dkrenn created at 2016-02-12 18:20:58

I'm in the middle of the review.

I didn't investigate further, but the (correct) result of

```
sage: asymptotic_expansions.SingularityAnalysis('n',
....:     alpha=0, beta=2, precision=23).subs(n=n-2)
```

does not seem to depend on the precision anymore for values at least 13.


---

Comment by git created at 2016-02-12 18:24:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-02-12 18:28:24

Code looks good. I didn't review the extension of `_sa_coefficients_lambda_` directly (only indirectly, since the overall results are correct). Git blame says Benjamin has done these changes; Clemens, did you have a look at these changes?

`@`Clemens: You should add yourself as author as well.


---

Comment by cheuberg created at 2016-02-13 08:51:12

Replying to [comment:13 dkrenn]:
> I'm in the middle of the review.
> 
> I didn't investigate further, but the (correct) result of
> {{{
> sage: asymptotic_expansions.SingularityAnalysis('n',
> ....:     alpha=0, beta=2, precision=23).subs(n=n-2)
> }}}
> does not seem to depend on the precision anymore for values at least 13.

What is `n`? Could it be that it is the generator of an asymptotic ring with lower default precision?

I cannot reproduce the problem:

```
result = {}
for p in range(1, 20):
    a = asymptotic_expansions.SingularityAnalysis('n', alpha=0, beta=2, precision=p)
    n = a.parent().gen()
    result[p] = a.subs(n=n-2)
    error = result[p] - result[p].exact_part()
    if p >= 2:
        print p, error, result[p] - result[p-1]
```

yields

```
2 O(n^(-1)) O(n^(-1)*log(n))
3 O(n^(-2)*log(n)^2) O(n^(-1))
4 O(n^(-2)*log(n)) O(n^(-2)*log(n)^2)
5 O(n^(-2)) O(n^(-2)*log(n))
6 O(n^(-3)*log(n)^2) O(n^(-2))
7 O(n^(-3)*log(n)) O(n^(-3)*log(n)^2)
8 O(n^(-3)) O(n^(-3)*log(n))
9 O(n^(-4)*log(n)^2) O(n^(-3))
10 O(n^(-4)*log(n)) O(n^(-4)*log(n)^2)
11 O(n^(-4)) O(n^(-4)*log(n))
12 O(n^(-5)*log(n)^2) O(n^(-4))
13 O(n^(-5)*log(n)) O(n^(-5)*log(n)^2)
14 O(n^(-5)) O(n^(-5)*log(n))
15 O(n^(-6)*log(n)^2) O(n^(-5))
16 O(n^(-6)*log(n)) O(n^(-6)*log(n)^2)
17 O(n^(-6)) O(n^(-6)*log(n))
18 O(n^(-7)*log(n)^2) O(n^(-6))
19 O(n^(-7)*log(n)) O(n^(-7)*log(n)^2)
```

so the result gets better in every iteration. Due to cancellations, some of the coefficients are not present ...


---

Comment by cheuberg created at 2016-02-13 09:17:01

Replying to [comment:15 dkrenn]:
> Code looks good. I didn't review the extension of `_sa_coefficients_lambda_` directly (only indirectly, since the overall results are correct). Git blame says Benjamin has done these changes; Clemens, did you have a look at these changes?

Yes. The only difference is that `(1+1/v) * (1+v*t).log()` representing the logarithm of the denominator `z^(n+1)` has been changed to `(1+1/v+beta) * (1+v*t).log()` representing the logarithm of the denominator `z^(n+1+beta)` where the additional factor `z^beta` comes from the renormalization of the logarithmic factor.

> `@`Clemens: You should add yourself as author as well.

Done, thanks for the reminder.


---

Comment by git created at 2016-02-13 09:34:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-02-13 09:43:10

Replying to [comment:16 cheuberg]:
> What is `n`? Could it be that it is the generator of an asymptotic ring with lower default precision?

Indeed, `n` was the problem. Thanks for pointing this out.

I'm finished my review. I've added an additional test. Please cross-review this commit and the minor changes yesterday. It's a positive review from my side.


---

Comment by cheuberg created at 2016-02-13 13:00:27

Replying to [comment:19 dkrenn]:
> I'm finished my review. I've added an additional test. Please cross-review this commit and the minor changes yesterday. It's a positive review from my side.

Done, thanks.


---

Comment by cheuberg created at 2016-02-13 13:00:27

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2016-02-13 19:25:31

During review of #19944 I've noticed that

```
sage: asymptotic_expansions.SingularityAnalysis('n', 2, -1, precision=1)
```

raises a `NotImplementedOZero`-error, but

```
sage: asymptotic_expansions.SingularityAnalysis('n', 2, -1, precision=0)
O((1/2)^n*n^(-2))
```

which is *not incorrect*, but also seems not to be consistent to the above. Is there a particular reason for this?


---

Comment by dkrenn created at 2016-02-13 19:28:08

Changing status from positive_review to needs_info.


---

Comment by cheuberg created at 2016-02-14 10:34:10

Replying to [comment:21 dkrenn]:
> which is *not incorrect*, but also seems not to be consistent to the above. Is there a particular reason for this?

It was an easy option to implement the transfer theorem: `O((1-z)^(-alpha) log(1/(1-z))^beta )` -> `O(n^(alpha-1) log^beta(n))`.

Having this for `precision=0` allows us to reuse the same logic for handling the location of the singularity, for constructing the ring etc. It even does not require us the write any specific code, apart from the one position where we explicitly do not `raise NotImplementedOZero`.

Finally, setting `precision=0` calls for an `O`-term to be returned, so returning the `O`-term which arises naturally seems to be a good option.

In some sense, returning `NotImplementedOZero` at all is perhaps some kind of hack, but the alternative would be to return something like `O(n^(alpha-1-precision))` which does not seem to be that attractive --- and would cause pain later on in #19944.


---

Comment by cheuberg created at 2016-02-14 10:34:10

Changing status from needs_info to needs_review.


---

Comment by dkrenn created at 2016-02-14 10:42:19

Changing status from needs_review to positive_review.


---

Comment by dkrenn created at 2016-02-14 10:42:19

Replying to [comment:23 cheuberg]:
> Replying to [comment:21 dkrenn]:
> > which is *not incorrect*, but also seems not to be consistent to the above. Is there a particular reason for this?
> 
> It was an easy option to implement the transfer theorem: `O((1-z)^(-alpha) log(1/(1-z))^beta )` -> `O(n^(alpha-1) log^beta(n))`.
> 
> Having this for `precision=0` allows us to reuse the same logic for handling the location of the singularity, for constructing the ring etc. It even does not require us the write any specific code, apart from the one position where we explicitly do not `raise NotImplementedOZero`.
> 
> Finally, setting `precision=0` calls for an `O`-term to be returned, so returning the `O`-term which arises naturally seems to be a good option.
> 
> In some sense, returning `NotImplementedOZero` at all is perhaps some kind of hack, but the alternative would be to return something like `O(n^(alpha-1-precision))` which does not seem to be that attractive --- and would cause pain later on in #19944.

Ok, thank you for your explanation.


---

Comment by git created at 2016-02-14 11:17:28

Changing status from positive_review to needs_review.


---

Comment by git created at 2016-02-14 11:17:28

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2016-02-14 11:20:06

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dkrenn created at 2016-02-14 11:21:18

Replying to [comment:25 git]:
> Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
> ||[d3b48c7](http://git.sagemath.org/sage.git/commit/?id=d3b48c7070f8b3a7e0851c5ed6d62e5d95472a0a)||`Trac #20049: \zeta in GF in SingularityAnalysis-generator`||

Accidentally pushed on wrong ticket; is corrected now.


---

Comment by cheuberg created at 2016-02-14 12:13:49

Changing status from needs_review to positive_review.


---

Comment by cheuberg created at 2016-02-14 12:13:49

Replying to [comment:27 dkrenn]:
> Replying to [comment:25 git]:
> > Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
> > ||[d3b48c7](http://git.sagemath.org/sage.git/commit/?id=d3b48c7070f8b3a7e0851c5ed6d62e5d95472a0a)||`Trac #20049: \zeta in GF in SingularityAnalysis-generator`||
> 
> Accidentally pushed on wrong ticket; is corrected now.
In that case, let's set it back to `positive_review`.


---

Comment by vbraun created at 2016-02-15 19:28:35

Resolution: fixed
