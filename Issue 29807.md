# Issue 29807: tox.ini: Test on voidlinux

Issue created by migration from https://trac.sagemath.org/ticket/30044

Original creator: mkoeppe

Original creation time: 2020-07-02 04:15:53

CC:  dimpase mjo @kliem slelievre

https://groups.google.com/d/msg/sage-devel/kiEh8JgbWeQ/Oqe77sQTCAAJ

https://hub.docker.com/r/voidlinux/voidlinux

https://github.com/void-linux/xbps


---

Comment by mkoeppe created at 2020-07-07 19:14:59

New commits:


---

Comment by git created at 2020-07-07 19:16:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-08 13:51:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-12 18:31:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-22 17:16:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-07-24 17:36:12

This works well enough to reproduce at least some of the reported build errors. Needs review


---

Comment by mkoeppe created at 2020-07-24 17:36:12

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-08-10 23:36:58

Let's get this in please


---

Comment by @kliem created at 2020-08-11 04:55:35

I'm running some tests to see whether voidlinux somehow works with github actions:

https://github.com/kliem/sage/pull/22/checks


---

Comment by @kliem created at 2020-08-11 12:45:39

In principle this seems capable of reproducing problems. However, I'm getting errors in log file artifacts. Did I do something wrong? Is it a problem with github? Is it caused by this ticket?


---

Comment by @kliem created at 2020-08-11 12:47:40


```diff
diff --git a/.github/workflows/tox.yml b/.github/workflows/tox.yml
index d6f46bd7b1..27f2f34dd4 100644
--- a/.github/workflows/tox.yml
+++ b/.github/workflows/tox.yml
@@ -36,7 +36,7 @@ jobs:
       fail-fast: false
       max-parallel: 20
       matrix:
-        tox_system_factor: [ubuntu-trusty, ubuntu-xenial, ubuntu-bionic, ubuntu-eoan, ubuntu-focal, debian-jessie, debian-stretch, debian-buster, debian-bullseye, debian-sid, linuxmint-17, linuxmint-18, linuxmint-19, linuxmint-19.3, fedora-26, fedora-27, fedora-28, fedora-29, fedora-30, fedora-31, fedora-32, centos-7, centos-8, gentoo, archlinux-latest, slackware-14.2, conda-forge, ubuntu-bionic-i386, ubuntu-eoan-i386, debian-buster-i386, centos-7-i386]
+        tox_system_factor: [debian-buster, voidlinux]
         tox_packages_factor: [minimal, standard]
     env:
       TOX_ENV: docker-${{ matrix.tox_system_factor }}-${{ matrix.tox_packages_factor }}
@@ -94,173 +94,3 @@ jobs:
             done || echo "(Ignoring errors)"
           fi
         if: always()
-
-  local-macos:
-
-    runs-on: macos-latest
-    strategy:
-      fail-fast: false
-      max-parallel: 4
-      matrix:
-        tox_system_factor: [homebrew-macos, homebrew-macos-python3_xcode, homebrew-macos-python3_xcode-nokegonly, homebrew-macos-python3_pythonorg, homebrew-macos-python3_xcode-gcc_spkg, conda-forge-macos]
-        tox_packages_factor: [minimal, standard]
-    env:
-      TOX_ENV: local-${{ matrix.tox_system_factor }}-${{ matrix.tox_packages_factor }}
-      LOGS_ARTIFACT_NAME: logs-commit-${{ github.sha }}-tox-local-${{ matrix.tox_system_factor }}-${{ matrix.tox_packages_factor }}
-    steps:
-      - uses: actions/checkout@v2
-      - name: Install test prerequisites
-        run: |
-          brew install tox
-      - name: Install python3 from python.org
-        # As of 2020-03-30 (https://github.com/actions/virtual-environments/blob/master/images/macos/macos-10.15-Readme.md),
-        # Python 3.7.7 is installed on GitHub Actions runners.  But we install our own copy from the python.org binary package.
-        run: |
-          curl -o python3.pkg https://www.python.org/ftp/python/3.7.7/python-3.7.7-macosx10.9.pkg
-          sudo installer -verbose -pkg python3.pkg -target /
-        if: contains(matrix.tox_system_factor, 'python3_pythonorg')
-      - name: Build and test with tox
-        # We use a high parallelization on purpose in order to catch possible parallelization bugs in the build scripts.
-        # For doctesting, we use a lower parallelization to avoid timeouts.
-        run: |
-          MAKE="make -j12" tox -e $TOX_ENV -- SAGE_NUM_THREADS=4 $TARGETS
-      - name: Prepare logs artifact
-        run: |
-          mkdir -p "artifacts/$LOGS_ARTIFACT_NAME"; cp -r .tox/*/log "artifacts/$LOGS_ARTIFACT_NAME"
-        if: always()
-      - uses: actions/upload-artifact@v1
-        with:
-          path: artifacts
-          name: ${{ env.LOGS_ARTIFACT_NAME }}
-        if: always()
-      - name: Print out logs for immediate inspection
-        # and markup the output with GitHub Actions logging commands
-        run: |
-          .github/workflows/scan-logs.sh "artifacts/$LOGS_ARTIFACT_NAME"
-        if: always()
-
-  local-ubuntu:
-
-    runs-on: ubuntu-latest
-    strategy:
-      fail-fast: false
-      max-parallel: 1
-      matrix:
-        tox_system_factor: [conda-forge-ubuntu]
-        tox_packages_factor: [minimal, standard]
-    env:
-      TOX_ENV: local-${{ matrix.tox_system_factor }}-${{ matrix.tox_packages_factor }}
-      LOGS_ARTIFACT_NAME: logs-commit-${{ github.sha }}-tox-local-${{ matrix.tox_system_factor }}-${{ matrix.tox_packages_factor }}
-    steps:
-      - uses: actions/checkout@v2
-      - name: Install test prerequisites
-        run: |
-          sudo DEBIAN_FRONTEND=noninteractive apt-get update
-          sudo DEBIAN_FRONTEND=noninteractive apt-get install python-tox
-      - name: Build and test with tox
-        # We use a high parallelization on purpose in order to catch possible parallelization bugs in the build scripts.
-        # For doctesting, we use a lower parallelization to avoid timeouts.
-        run: |
-          MAKE="make -j12" tox -e $TOX_ENV -- SAGE_NUM_THREADS=4 $TARGETS
-      - name: Prepare logs artifact
-        run: |
-          mkdir -p "artifacts/$LOGS_ARTIFACT_NAME"; cp -r .tox/*/log "artifacts/$LOGS_ARTIFACT_NAME"
-        if: always()
-      - uses: actions/upload-artifact@v1
-        with:
-          path: artifacts
-          name: ${{ env.LOGS_ARTIFACT_NAME }}
-        if: always()
-      - name: Print out logs for immediate inspection
-        # and markup the output with GitHub Actions logging commands
-        run: |
-          .github/workflows/scan-logs.sh "artifacts/$LOGS_ARTIFACT_NAME"
-        if: always()
-
-  dist:
-
-    runs-on: ubuntu-latest
-    steps:
-      - uses: actions/checkout@v2
-        with:
-          fetch-depth: 500
-      - name: fetch tags
-        run: git fetch --depth=1 origin +refs/tags/*:refs/tags/*
-      - name: Install bootstrap prerequisites
-        run: |
-          sudo DEBIAN_FRONTEND=noninteractive apt-get update
-          sudo DEBIAN_FRONTEND=noninteractive apt-get install $(sed "s/#.*//;" build/pkgs/debian-bootstrap.txt)
-      - name: Bootstrap with sage-update-version
-        # We set SAGE_ROOT and SAGE_SRC by hand
-        # because 'sage -sh' does not work with an unconfigured tree,
-        # giving: Error: SAGE_SCRIPTS_DIR is set to a bad value
-        run: |
-          git config --global user.email "nobody@example.com"
-          git config --global user.name "Sage GitHub CI"
-          SAGE_ROOT=. SAGE_SRC=./src src/bin/sage-update-version $(git describe)
-      - name: make dist
-        run: |
-          ./configure && make dist
-      - uses: actions/upload-artifact@v2
-        with:
-          path: "dist/*.tar.gz"
-          name: dist
-
-  local-macos-nohomebrew:
-
-    needs: [dist]
-
-    runs-on: macos-latest
-    strategy:
-      fail-fast: false
-      max-parallel: 4
-      matrix:
-        tox_system_factor: [macos-nobootstrap, macos-nobootstrap-python3_pythonorg]
-        tox_packages_factor: [minimal]
-    env:
-      TOX_ENV: local-${{ matrix.tox_system_factor }}-${{ matrix.tox_packages_factor }}
-      LOGS_ARTIFACT_NAME: logs-commit-${{ github.sha }}-tox-local-${{ matrix.tox_system_factor }}-${{ matrix.tox_packages_factor }}
-    steps:
-      - uses: actions/checkout@v2
-        if: "!contains(matrix.tox_system_factor, 'nobootstrap')"
-      - uses: actions/download-artifact@v2
-        with:
-          path: .
-          name: dist
-        if: contains(matrix.tox_system_factor, 'nobootstrap')
-      - name: Unpack sage dist
-        run: |
-          tar xf sage*.tar.gz --strip-components=1
-        if: contains(matrix.tox_system_factor, 'nobootstrap')
-      - name: Move homebrew away
-        run: |
-          (cd /usr/local && for a in bin etc include lib opt sbin share; do mv $a $a-moved; done)
-      - name: Install test prerequisites
-        run: |
-          /usr/bin/python3 -m pip install --user tox
-      - name: Install python3 from python.org
-        # As of 2020-03-30 (https://github.com/actions/virtual-environments/blob/master/images/macos/macos-10.15-Readme.md),
-        # Python 3.7.7 is installed on GitHub Actions runners.  But we install our own copy from the python.org binary package.
-        run: |
-          curl -o python3.pkg https://www.python.org/ftp/python/3.7.7/python-3.7.7-macosx10.9.pkg
-          sudo installer -verbose -pkg python3.pkg -target /
-        if: contains(matrix.tox_system_factor, 'python3_pythonorg')
-      - name: Build and test with tox
-        # We use a high parallelization on purpose in order to catch possible parallelization bugs in the build scripts.
-        # For doctesting, we use a lower parallelization to avoid timeouts.
-        run: |
-          MAKE="make -j12" tox -e $TOX_ENV -- SAGE_NUM_THREADS=4 $TARGETS
-      - name: Prepare logs artifact
-        run: |
-          mkdir -p "artifacts/$LOGS_ARTIFACT_NAME"; cp -r .tox/*/log "artifacts/$LOGS_ARTIFACT_NAME"
-        if: always()
-      - uses: actions/upload-artifact@v1
-        with:
-          path: artifacts
-          name: ${{ env.LOGS_ARTIFACT_NAME }}
-        if: always()
-      - name: Print out logs for immediate inspection
-        # and markup the output with GitHub Actions logging commands
-        run: |
-          .github/workflows/scan-logs.sh "artifacts/$LOGS_ARTIFACT_NAME"
-        if: always()
```



---

Comment by mkoeppe created at 2020-08-11 14:22:57

Replying to [comment:13 gh-kliem]:
> In principle this seems capable of reproducing problems. However, I'm getting errors in log file artifacts. Did I do something wrong? Is it a problem with github? Is it caused by this ticket?
It's a problem with github. I have had a lot of trouble with it in the past weeks.


---

Comment by @kliem created at 2020-08-11 14:30:37

Changing status from needs_review to positive_review.


---

Comment by @kliem created at 2020-08-11 14:30:37

LGTM.


---

Comment by vbraun created at 2020-08-14 22:23:17

Resolution: fixed
