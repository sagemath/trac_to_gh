# Issue 25815: Update to OpenBLAS 0.3.2

Issue created by migration from https://trac.sagemath.org/ticket/26052

Original creator: thansen

Original creation time: 2018-08-12 17:23:01

CC:  jpflori vbraun jdemeyer moritz aram.dermenjian fbissey embray tscrim

OpenBLAS 0.3.2 came out and was uploaded to Debian. When attempting to build the sage 8.3 Debian package (with one thread) with this version, OpenBLAS causes a crash during the docbuild, see attached log.

A bug in OpenBLAS that involves the same error message ("OpenBLAS : Program will terminate because you tried to start too many threads.") is https://github.com/xianyi/OpenBLAS/issues/1641

Our temporary workaround for now is to use Atlas (which we already used before for architectures which are not supported by OpenBLAS).

Please consider updating OpenBLAS in sage.


---

Attachment


---

Comment by fbissey created at 2018-08-16 00:16:49

I am not experiencing this problem in sage-on-gentoo. However I decided to only use "regular threads" and no "openmp threads" in openblas some time ago. I suspect that is why I am not affected at this stage. It may be that I have the wrong picture of threading in openblas as well.


---

Comment by fbissey created at 2018-10-25 22:05:31

I believe the problem has been addressed in 0.3.3 where they decided to switch back to the previous behavior with threads until they have fixed all the issues that have cropped in 0.3.2.

For the record I am using 0.3.3 (without openmp threads) in my own sage-on-gentoo builds.


---

Comment by fbissey created at 2018-11-14 04:31:51

Changing status from new to needs_review.


---

Comment by fbissey created at 2018-11-14 04:31:51

All the cygwin patches failed but most of the bits appears to have been merged upstream. Still someone should check cygwin with this release.
----
New commits:


---

Comment by embray created at 2018-11-29 13:32:24

I can confirm that the aforementioned cygwin-related patches should be safe to remove as I've had them accepted upstream for some time.  I'll still want to run tests on this though.  I think I can go ahead and get that started now.


---

Comment by embray created at 2018-11-29 13:34:07

I am rebasing this on 8.5.beta5 first though, though that shouldn't make too much difference.


---

Comment by embray created at 2018-11-29 13:39:27

Also I'm getting invalid checksum when I use the tarball downloaded from github...?


---

Comment by dimpase created at 2018-11-29 13:41:30

Replying to [comment:9 embray]:
> Also I'm getting invalid checksum when I use the tarball downloaded from github...?

could you wget the tar file and rename it? That oh so clever github API might do something more than that...


---

Comment by dimpase created at 2018-11-29 13:46:49

hmm, no, indeed, it seems to be wrong (and as I came here from a duplicate ticket I had for the same task, I already had my tarfile all set...)
What I get is md5 30e2f8d7317e84dde5a37152173848f1


---

Comment by embray created at 2018-11-29 13:47:56

I'm not sure what you mean.  That's exactly what I did.  That's...disconcerting.  I would hope that tarballs downloaded from [GitHub](GitHub) wouldn't differ depending on when they were downloaded >_>


---

Comment by dimpase created at 2018-11-29 14:08:59

well, let us wait for NZ to comment on this


---

Comment by embray created at 2018-11-29 14:11:10

Either way I'm going ahead with building it.


---

Comment by fbissey created at 2018-11-29 19:00:51

Replying to [comment:12 embray]:
> I'm not sure what you mean.  That's exactly what I did.  That's...disconcerting.  I would hope that tarballs downloaded from [GitHub](GitHub) wouldn't differ depending on when they were downloaded >_>

Unfortunately, it is known to happen https://github.com/cschwan/sage-on-gentoo/issues/529 . It may be that the release are not cut properly since there are repos for which I have no issues. In any case github lets you upload your own tarball prepared with sdist and the like. And people should really do it.

So someone will have to host a reference tarball until it makes it to the sage mirror.


---

Comment by dimpase created at 2018-11-29 19:35:06

I've raised https://github.com/xianyi/OpenBLAS/issues/1891


---

Comment by embray created at 2018-11-30 12:53:43

Ok, looks good to me otherwise.


---

Comment by fbissey created at 2018-11-30 20:11:14

Ok added the tarball matching the checksum in the description. Since Erik says he is happy with it I am switching it to positive review.


---

Comment by fbissey created at 2018-11-30 20:11:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-12-01 13:43:33

Resolution: fixed
