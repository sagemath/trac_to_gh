# Issue 30146: New package type: optional-enabled-by-default

Issue created by migration from https://trac.sagemath.org/ticket/30383

Original creator: mkoeppe

Original creation time: 2020-08-17 18:17:19

CC:  jhpalmieri mjo slelievre slabbe dimpase embray @kliem

These would be like "optional" packages, but enabled by default. 

Like "standard" packages, they would be included in the distribution built by `make dist`.

Users can use `configure --disable-SPKG` to disable them.


---

Comment by mkoeppe created at 2020-09-13 19:59:40

Suggestions for a better name for this new package type are welcome


---

Comment by mkoeppe created at 2020-09-14 23:09:35

Alternatively, we could also make it possible to disable any standard package.


---

Comment by mkoeppe created at 2020-09-15 00:56:38

New commits:


---

Comment by mkoeppe created at 2020-09-15 01:11:43

Changing status from new to needs_review.


---

Comment by mjo created at 2020-09-16 00:55:10

Doesn't this create a bajillion ./configure options that basically do nothing (because the packages are dependencies), and another bajillion that cause sage to function improperly (test suite failures, etc.)?

I think the original approach was more on-track, although I wouldn't have created a separate package type for it (we don't need to proliferate a new package type throughout the build system every time we tweak a bit of metadata). Instead I would have added an "enabled by default" (default: no) feature somewhere to the optional packages. Long-term, a way to control (and depend on) optional features is needed, but that's a much larger undertaking akin to USE flags in Gentoo.


---

Comment by mkoeppe created at 2020-09-16 00:56:50

Replying to [comment:12 mjo]:
> Doesn't this create a bajillion ./configure options that basically do nothing (because the packages are dependencies), and another bajillion that cause sage to function improperly (test suite failures, etc.)?

Yes, a gazillion of "advanced options"


---

Comment by mkoeppe created at 2020-09-16 00:59:44

Most "standard" packages are not really required in any strict sense other than passing doctests that test particular features. Making it possible to disable them gives users a remedy when the build fails on a system


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111


---

Comment by git created at 2020-12-15 01:15:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-04 23:03:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2021-03-04 23:09:59

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-03-05 00:34:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-05 03:35:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-07 21:02:34

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2021-03-08 18:47:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-03-08 19:10:00

Changing status from needs_work to needs_review.


---

Comment by git created at 2021-03-08 19:10:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-08 19:13:55

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-03-08 19:32:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-08 19:34:30

This version of the ticket no longer offers `--disable...` options for all standard packages, which was criticized previously.


---

Comment by mkoeppe created at 2021-03-08 19:34:30

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2021-03-10 21:28:32

Why the change to `matplotlib` dependencies? Also the change in line 66 of `m4/sage_spkg_configure.m4` renders very strangely (strange font for "default") when I click  on the branch [here for example](https://git.sagemath.org/sage.git/diff/m4/sage_spkg_configure.m4?id=4542f019b39fc0c582c88dd1d89bb46a0b199a84) or view the diff on my computer. Any ideas what that's about?


---

Comment by git created at 2021-03-10 21:34:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-10 21:36:24

Replying to [comment:31 jhpalmieri]:
> Why the change to `matplotlib` dependencies? 

Thanks for catching this - I had thought I could get rid of `tornado` at some point but `jupyterlab_widgets` also needs it as a dependency, so that wouldn't help.


---

Comment by mkoeppe created at 2021-03-10 21:37:26

Replying to [comment:31 jhpalmieri]:
> the change in line 66 of `m4/sage_spkg_configure.m4` renders very strangely (strange font for "default") when I click  on the branch [here for example](https://git.sagemath.org/sage.git/diff/m4/sage_spkg_configure.m4?id=4542f019b39fc0c582c88dd1d89bb46a0b199a84) or view the diff on my computer. Any ideas what that's about?

Sorry, I was playing with Unicode superscripts. If it does not render nice, I can just go back to using ascii


---

Comment by git created at 2021-03-10 21:50:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-03-11 22:25:01

Typo in the comments? In `m4/sage_spkg_collect.m4`, the descriptions for `SAGE_OPTIONAL_INSTALLED_PACKAGES` and `SAGE_OPTIONAL_CLEANED_PACKAGES` are the same. Should `installed` be changed to `uninstalled` as the last word in the description for the `CLEANED` version?

Configuring with `--disable-notebook` does indeed disable the notebook, as advertised. Sage builds, and so does the documentation. I was a little surprised that all doctests passed, too.

I don't know the syntax well enough to be able to thoroughly review this, unfortunately. Anyone else?


---

Comment by git created at 2021-03-11 22:28:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-11 22:29:34

Replying to [comment:37 jhpalmieri]:
> Configuring with `--disable-notebook` does indeed disable the notebook, as advertised. Sage builds, and so does the documentation. I was a little surprised that all doctests passed, too.

This is, in fact, a weakness in our doctest coverage. We have nothing at all that tests whether the Jupyter notebook works.


---

Comment by git created at 2021-03-11 22:31:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-03-15 00:03:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-03-15 00:04:37

Changing priority from major to critical.


---

Comment by jhpalmieri created at 2021-03-17 03:39:29

Replying to [comment:39 mkoeppe]:
> Replying to [comment:37 jhpalmieri]:
> > Configuring with `--disable-notebook` does indeed disable the notebook, as advertised. Sage builds, and so does the documentation. I was a little surprised that all doctests passed, too.
> 
> This is, in fact, a weakness in our doctest coverage. We have nothing at all that tests whether the Jupyter notebook works. 

Maybe related to the fact that you can't start the notebook once you are running Sage from the command line? With SageNB you could run `notebook()` from within Sage, but this is not possible any more, or at least not in an obvious way, or maybe it just hasn't been implemented by us.


---

Comment by mkoeppe created at 2021-03-17 04:15:38

I think it's just that nobody has worked on writing such tests. I guess there must be technologies for automatically testing web apps but I don't know about them or if Jupyter already uses them.


---

Comment by mkoeppe created at 2021-03-17 04:39:42

Replying to [comment:46 jhpalmieri]:
> With SageNB you could run `notebook()` from within Sage, but this is not possible any more, or at least not in an obvious way

This is certainly a feature that I certainly could have used if it was available. Transforming an existing Python process to a Jupyter kernel just amounts to running `sage.repl.ipython_kernel.__main__`, I think.  But to my understanding no feature in the Jupyter notebook allows to connect to an existing running kernel.  I found some discussions in this direction, for example https://github.com/jupyter/help/issues/298, https://github.com/ipython/ipython/issues/4066


---

Comment by dimpase created at 2021-03-17 10:26:43

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2021-03-17 10:26:43

this looks good to go.


---

Comment by mkoeppe created at 2021-03-17 14:37:33

Thanks!


---

Comment by vbraun created at 2021-03-20 15:27:50

Resolution: fixed
