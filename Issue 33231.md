# Issue 33231: Feature for gfan

Issue created by migration from https://trac.sagemath.org/ticket/33468

Original creator: mkoeppe

Original creation time: 2022-03-06 03:12:32

CC:  slabbe




---

Comment by mkoeppe created at 2022-03-25 19:19:10

New commits:


---

Comment by mkoeppe created at 2022-03-25 19:25:28

Changing status from new to needs_review.


---

Comment by slabbe created at 2022-03-27 07:38:36

`from .join_feature import JoinFeature` is not used in gfan.py


---

Comment by git created at 2022-03-27 15:58:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2022-03-29 13:23:15

I added a commit on top to add docstring and doctest for the `__call__` method (after merging with beta6). It made me realize that the `format` argument is just ignored in the code of `__call__`. Should we remove/deprecate it?

----
New commits:


---

Comment by mkoeppe created at 2022-03-29 18:09:20

Replying to [comment:8 slabbe]:
> I added a commit on top to add docstring and doctest for the `__call__` method (after merging with beta6).

Thank you!

> It made me realize that the `format` argument is just ignored in the code of `__call__`. Should we remove/deprecate it?

Good idea, let's deprecate it


---

Comment by git created at 2022-03-29 20:21:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2022-03-29 20:25:02

Replying to [comment:9 mkoeppe]:
> Good idea, let's deprecate it 

Done.


---

Comment by mkoeppe created at 2022-03-29 20:51:54


```
$ ./sage -tox -e pycodestyle src/sage/interfaces/gfan.py 
pycodestyle installed: pycodestyle==2.8.0
pycodestyle run-test-pre: PYTHONHASHSEED='1743415609'
pycodestyle run-test: commands[0] | pycodestyle sage/interfaces/gfan.py
sage/interfaces/gfan.py:28:1: E265 block comment should start with '# '
sage/interfaces/gfan.py:41:1: E265 block comment should start with '# '
sage/interfaces/gfan.py:52:24: E741 ambiguous variable name 'I'
sage/interfaces/gfan.py:85:12: E714 test for object identity should be 'is not'
sage/interfaces/gfan.py:88:21: E128 continuation line under-indented for visual indent
sage/interfaces/gfan.py:89:21: E128 continuation line under-indented for visual indent
sage/interfaces/gfan.py:90:21: E128 continuation line under-indented for visual indent
sage/interfaces/gfan.py:114:1: E305 expected 2 blank lines after class or function definition, found 1
3       E128 continuation line under-indented for visual indent
2       E265 block comment should start with '# '
1       E305 expected 2 blank lines after class or function definition, found 1
1       E714 test for object identity should be 'is not'
1       E741 ambiguous variable name 'I'
```



---

Comment by slabbe created at 2022-03-29 21:26:17

hahaha, more comments than lines of code added!

Ok, I will check this out tomorrow.


---

Comment by git created at 2022-03-31 09:17:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2022-03-31 09:19:01

After `sage -pip intall tox`, I now get:

```
$ ./sage -tox -e pycodestyle src/sage/interfaces/gfan.py
pycodestyle installed: pycodestyle==2.8.0
pycodestyle run-test-pre: PYTHONHASHSEED='1348994557'
pycodestyle run-test: commands[0] | pycodestyle sage/interfaces/gfan.py
______________________________________________ summary ______________________________________________
  pycodestyle: commands succeeded
  congratulations :)
```


Needs review.


---

Comment by mkoeppe created at 2022-03-31 13:08:38

I don't think we can rename `I` to `input` - it is a breaking interface change, as `gfan(I=...)` will not work any more.


---

Comment by slabbe created at 2022-04-01 07:15:00

True. I did that to fix one of the pycodestyle warning `E741 ambiguous variable name 'I'`.

Either I revert that change or I use ``@`rename_keword(I=input)`. Any preference?


---

Comment by git created at 2022-04-01 07:53:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2022-04-01 07:56:46

So, I added a commit using the rename keyword stuff.

Also, I checked that `sage -grep "gfan(I="` does not return any use case in the sage code.


---

Comment by mkoeppe created at 2022-04-01 15:59:38

I'm getting deprecation warnings in the doctests

```
File "src/sage/rings/polynomial/groebner_fan.py", line 979, in sage.rings.polynomial.groebner_fan.GroebnerFan.weight_vectors
Failed example:
    g.weight_vectors()
Expected:
    [(3, 7, 1), (5, 1, 2), (7, 1, 4), (5, 1, 4), (1, 1, 1), (1, 4, 8), (1, 4, 10)]
Got:
    doctest:warning
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/bin/sage-runtests", line 149, in <module>
        err = DC.run()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/control.py", line 1343, in run
        self.run_doctests()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/control.py", line 1044, in run_doctests
        self.dispatcher.dispatch()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 2016, in dispatch
        self.parallel_dispatch()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 1911, in parallel_dispatch
        w.start()  # This might take some time
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 2185, in start
        super(DocTestWorker, self).start()
      File "/usr/local/Cellar/python@3.10/3.10.2/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/local/Cellar/python@3.10/3.10.2/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/local/Cellar/python@3.10/3.10.2/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/local/Cellar/python@3.10/3.10.2/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/local/Cellar/python@3.10/3.10.2/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/popen_fork.py", line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/local/Cellar/python@3.10/3.10.2/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 2157, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 2487, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 2539, in _run
        result = runner.run(test)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 866, in run
        return self._run(test, compileflags, out)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.groebner_fan.GroebnerFan.weight_vectors[2]>", line 1, in <module>
        g.weight_vectors()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/rings/polynomial/groebner_fan.py", line 988, in weight_vectors
        ans, err = gfan_processes.communicate(input=str_to_bytes(self.gfan()))
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/rings/polynomial/groebner_fan.py", line 1130, in gfan
        s = gfan(I, cmd, verbose=self.__verbose, format=format)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/misc/decorators.py", line 651, in wrapper
        return func(*args, **kwds)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/interfaces/gfan.py", line 96, in __call__
        deprecation(33468, 'argument `format` is ignored in the code: '
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/misc/superseded.py", line 99, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/misc/superseded.py", line 180, in warning
        warn(message, warning_class, stacklevel)
      File "/usr/local/Cellar/python@3.10/3.10.2/Frameworks/Python.framework/Versions/3.10/lib/python3.10/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    DeprecationWarning: argument `format` is ignored in the code: it is now deprecated. Please update your code without this argument as it will be removed in a later version of SageMath.
    See https://trac.sagemath.org/33468 for details.
    [(3, 7, 1), (5, 1, 2), (7, 1, 4), (5, 1, 4), (1, 1, 1), (1, 4, 8), (1, 4, 10)]
```



---

Comment by mkoeppe created at 2022-04-02 20:29:29

Changing status from needs_review to needs_work.


---

Comment by slabbe created at 2022-04-07 09:18:21

Indeed, the patchbot says the following doctests are failing:

```
----------------------------------------------------------------------
sage -t --long --random-seed=201618586090654190254950585468856090968 src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
sage -t --long --random-seed=201618586090654190254950585468856090968 src/sage/rings/polynomial/groebner_fan.py  # 3 doctests failed
sage -t --long --random-seed=201618586090654190254950585468856090968 src/doc/ru/tutorial/tour_advanced.rst  # 1 doctest failed
sage -t --long --random-seed=201618586090654190254950585468856090968 src/doc/en/tutorial/tour_advanced.rst  # 1 doctest failed
sage -t --long --random-seed=201618586090654190254950585468856090968 src/doc/fr/tutorial/tour_advanced.rst  # 1 doctest failed
sage -t --long --random-seed=201618586090654190254950585468856090968 src/doc/pt/tutorial/tour_advanced.rst  # 1 doctest failed
sage -t --long --random-seed=201618586090654190254950585468856090968 src/doc/ja/tutorial/tour_advanced.rst  # 1 doctest failed
sage -t --long --random-seed=201618586090654190254950585468856090968 src/doc/de/tutorial/tour_advanced.rst  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by git created at 2022-04-07 09:20:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by slabbe created at 2022-04-07 09:20:57

I rebased on beta7.


---

Comment by slabbe created at 2022-04-07 09:41:28

updated description with new added deprecation warnings


---

Comment by git created at 2022-04-07 09:46:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by slabbe created at 2022-04-07 09:48:08

I added a deprecation of the format argument in groebner_fan.py file. I checked that it fixes the issues listed in comment:22.

Needs review!


---

Comment by slabbe created at 2022-04-07 09:48:08

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-04-07 17:41:24

Thanks for all your work on this ticket! LGTM. The patchbot failures are unrelated.


---

Comment by tscrim created at 2022-04-08 08:26:56

Is comment:28 suppose to be a positive review?


---

Comment by slabbe created at 2022-04-08 11:34:03

I think Matthias was waiting for someone to review his commit.

I give a positive review to Matthias' commits.


---

Comment by slabbe created at 2022-04-08 11:34:03

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-04-08 17:46:47

Thank you!


---

Comment by vbraun created at 2022-04-10 13:12:36

Resolution: fixed
