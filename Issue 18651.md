# Issue 18651: failing optional mathematica tests

archive/issues_018651.json:
```json
{
    "body": "CC:  @vbraun @slel @mkoeppe\n\nWith\n\n\n```\n$ sage --version\nSageMath Version 6.8.beta8, Release Date: 2015-07-10\n$ mathematica --version\n10.0\n```\n\n\nThe command\n\n\n```\nsage -t --warn-long 2.3 --optional=sage,mathematica src/sage/symbolic/expression.pyx src/sage/tests/benchmark.py src/sage/misc/functional.py src/sage/symbolic/constants.py src/sage/calculus/calculus.py src/sage/interfaces/mathematica.py src/sage/symbolic/integration/integral.py src/sage/symbolic/constants_c.pyx src/sage/matrix/matrix1.pyx src/sage/modules/free_module_element.pyx\n```\n\n\ngives:\n\n\n```\n# sage -t --warn-long 2.3 src/sage/symbolic/expression.pyx  # 1 doctest failed\n# sage -t --warn-long 2.3 src/sage/symbolic/constants.py  # 3 doctests failed\n# sage -t --warn-long 2.3 src/sage/interfaces/mathematica.py  # 30 doctests failed\n# sage -t --warn-long 2.3 src/sage/symbolic/constants_c.pyx  # 1 doctest failed\n# sage -t --warn-long 2.3 src/sage/matrix/matrix1.pyx  # 2 doctests failed\n# sage -t --warn-long 2.3 src/sage/modules/free_module_element.pyx  # 1 doctest failed\n```\n\n\nFull log is attached.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18888\n\n",
    "created_at": "2015-07-13T12:31:15Z",
    "labels": [
        "component: interfaces: optional",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "failing optional mathematica tests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18651",
    "user": "https://github.com/seblabbe"
}
```
CC:  @vbraun @slel @mkoeppe

With


```
$ sage --version
SageMath Version 6.8.beta8, Release Date: 2015-07-10
$ mathematica --version
10.0
```


The command


```
sage -t --warn-long 2.3 --optional=sage,mathematica src/sage/symbolic/expression.pyx src/sage/tests/benchmark.py src/sage/misc/functional.py src/sage/symbolic/constants.py src/sage/calculus/calculus.py src/sage/interfaces/mathematica.py src/sage/symbolic/integration/integral.py src/sage/symbolic/constants_c.pyx src/sage/matrix/matrix1.pyx src/sage/modules/free_module_element.pyx
```


gives:


```
# sage -t --warn-long 2.3 src/sage/symbolic/expression.pyx  # 1 doctest failed
# sage -t --warn-long 2.3 src/sage/symbolic/constants.py  # 3 doctests failed
# sage -t --warn-long 2.3 src/sage/interfaces/mathematica.py  # 30 doctests failed
# sage -t --warn-long 2.3 src/sage/symbolic/constants_c.pyx  # 1 doctest failed
# sage -t --warn-long 2.3 src/sage/matrix/matrix1.pyx  # 2 doctests failed
# sage -t --warn-long 2.3 src/sage/modules/free_module_element.pyx  # 1 doctest failed
```


Full log is attached.

Issue created by migration from https://trac.sagemath.org/ticket/18888





---

archive/issue_comments_253674.json:
```json
{
    "body": "Attachment [mathematica.log](tarball://root/attachments/some-uuid/ticket18888/mathematica.log) by @seblabbe created at 2015-07-13 12:31:36",
    "created_at": "2015-07-13T12:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253674",
    "user": "https://github.com/seblabbe"
}
```

Attachment [mathematica.log](tarball://root/attachments/some-uuid/ticket18888/mathematica.log) by @seblabbe created at 2015-07-13 12:31:36



---

archive/issue_comments_253675.json:
```json
{
    "body": "I get similar doctest failures with Sage 6.7 and Mathematica 10 running on OS X.  It looks to me like it's an issue with how Sage is formatting things; the output of the doctests often looks like it is TeX'ed.  In particular, I think somehow the _latex_ method of `sage.interfaces.mathematica.MathematicaElement` is being called instead of just __repr__ as you would expect.  Here's a simple example: \n\n\n\n```\nsage: e = mathematica('{{1,2},{3,4}}') \nsage: e\n\\left(\n                 \\begin{array}{cc}\n                  1 & 2 \\                  3 & 4 \\                 \\end{array}\n                 \\right)\nsage: repr(e)\n'{{1, 2}, {3, 4}}'\nsage: str(e)\n        {{1, 2}, {3, 4}}\nsage: e._latex_()\n'\\\\left(\\n                  \\\\begin{array}{cc}\\n                   1 & 2 [...]\n\n```\n",
    "created_at": "2015-07-13T17:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253675",
    "user": "https://github.com/NathanDunfield"
}
```

I get similar doctest failures with Sage 6.7 and Mathematica 10 running on OS X.  It looks to me like it's an issue with how Sage is formatting things; the output of the doctests often looks like it is TeX'ed.  In particular, I think somehow the _latex_ method of `sage.interfaces.mathematica.MathematicaElement` is being called instead of just __repr__ as you would expect.  Here's a simple example: 



```
sage: e = mathematica('{{1,2},{3,4}}') 
sage: e
\left(
                 \begin{array}{cc}
                  1 & 2 \                  3 & 4 \                 \end{array}
                 \right)
sage: repr(e)
'{{1, 2}, {3, 4}}'
sage: str(e)
        {{1, 2}, {3, 4}}
sage: e._latex_()
'\\left(\n                  \\begin{array}{cc}\n                   1 & 2 [...]

```




---

archive/issue_comments_253676.json:
```json
{
    "body": "After fixing my sage install I got similar issues too. I am running 6.8.beta8 with Mathematica 10.1\n\nI did few checks and it looks like __repr__ is the method being called; to see this just do the following changes\n\n\n```\ndiff --git a/src/sage/interfaces/mathematica.py b/src/sage/interfaces/mathematica.py\nindex aa5a848..e348927 100644\n--- a/src/sage/interfaces/mathematica.py\n+++ b/src/sage/interfaces/mathematica.py\n@@ -654,6 +654,8 @@ class MathematicaElement(ExpectElement):\n         return z[i+1:].strip()\n \n     def __repr__(self):\n+        import traceback\n+        for s in traceback.format_stack():\n+            print s\n         P = self._check_valid()\n         return P.get(self._name, ascii_art=False).strip()\n```\n\n\nThen run\n\n\n```\n$ sage -br\nsage: mathematica(pi)\n  File \"/opt/sage/src/bin/sage-ipython\", line 14, in <module>\n    app.start()\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/ipapp.py\", line 371, in start\n    self.shell.mainloop()\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py\", line 383, in mainloop\n    self.interact(display_banner=display_banner)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py\", line 507, in interact\n    self.run_cell(source_raw, store_history=True)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2871, in run_cell\n    interactivity=interactivity, compiler=compiler, result=result)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 2981, in run_ast_nodes\n    if self.run_code(code, result):\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py\", line 3035, in run_code\n    exec(code_obj, self.user_global_ns, self.user_ns)\n\n  File \"<ipython-input-1-568cde928ef5>\", line 1, in <module>\n    mathematica(pi)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/displayhook.py\", line 232, in __call__\n    format_dict, md_dict = self.compute_format_data(result)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/IPython/core/displayhook.py\", line 138, in compute_format_data\n    return self.shell.display_formatter.format(result)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/formatter.py\", line 128, in format\n    return self.dm.displayhook(obj)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 745, in displayhook\n    plain_text, rich_output = self._rich_output_formatter(obj, dict())\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py\", line 610, in _rich_output_formatter\n    plain_text = self._backend.plain_text_formatter(obj, **rich_repr_kwds)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py\", line 305, in plain_text_formatter\n    plain_text = self._apply_pretty_printer(SagePrettyPrinter, obj)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py\", line 250, in _apply_pretty_printer\n    printer.pretty(obj)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/pretty_print.py\", line 147, in pretty\n    ok = representation(obj, self, cycle)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/fancy_repr.py\", line 276, in __call__\n    output = repr(obj)\n\n  File \"/opt/sage/local/lib/python2.7/site-packages/sage/interfaces/mathematica.py\", line 658, in __repr__\n    for s in traceback.format_stack():\n\n\\pi\n```\n",
    "created_at": "2015-07-14T13:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253676",
    "user": "https://github.com/etn40ff"
}
```

After fixing my sage install I got similar issues too. I am running 6.8.beta8 with Mathematica 10.1

I did few checks and it looks like __repr__ is the method being called; to see this just do the following changes


```
diff --git a/src/sage/interfaces/mathematica.py b/src/sage/interfaces/mathematica.py
index aa5a848..e348927 100644
--- a/src/sage/interfaces/mathematica.py
+++ b/src/sage/interfaces/mathematica.py
@@ -654,6 +654,8 @@ class MathematicaElement(ExpectElement):
         return z[i+1:].strip()
 
     def __repr__(self):
+        import traceback
+        for s in traceback.format_stack():
+            print s
         P = self._check_valid()
         return P.get(self._name, ascii_art=False).strip()
```


Then run


```
$ sage -br
sage: mathematica(pi)
  File "/opt/sage/src/bin/sage-ipython", line 14, in <module>
    app.start()

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/ipapp.py", line 371, in start
    self.shell.mainloop()

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py", line 383, in mainloop
    self.interact(display_banner=display_banner)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/terminal/interactiveshell.py", line 507, in interact
    self.run_cell(source_raw, store_history=True)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 2871, in run_cell
    interactivity=interactivity, compiler=compiler, result=result)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 2981, in run_ast_nodes
    if self.run_code(code, result):

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.py", line 3035, in run_code
    exec(code_obj, self.user_global_ns, self.user_ns)

  File "<ipython-input-1-568cde928ef5>", line 1, in <module>
    mathematica(pi)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/displayhook.py", line 232, in __call__
    format_dict, md_dict = self.compute_format_data(result)

  File "/opt/sage/local/lib/python2.7/site-packages/IPython/core/displayhook.py", line 138, in compute_format_data
    return self.shell.display_formatter.format(result)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/formatter.py", line 128, in format
    return self.dm.displayhook(obj)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 745, in displayhook
    plain_text, rich_output = self._rich_output_formatter(obj, dict())

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 610, in _rich_output_formatter
    plain_text = self._backend.plain_text_formatter(obj, **rich_repr_kwds)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py", line 305, in plain_text_formatter
    plain_text = self._apply_pretty_printer(SagePrettyPrinter, obj)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py", line 250, in _apply_pretty_printer
    printer.pretty(obj)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/pretty_print.py", line 147, in pretty
    ok = representation(obj, self, cycle)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/repl/display/fancy_repr.py", line 276, in __call__
    output = repr(obj)

  File "/opt/sage/local/lib/python2.7/site-packages/sage/interfaces/mathematica.py", line 658, in __repr__
    for s in traceback.format_stack():

\pi
```




---

archive/issue_comments_253677.json:
```json
{
    "body": "another annoying bug is that if mathematica is not installed then\n\n```\nsage: mathematica(1) # or whatever\n```\n\njust hangs, and even Ctrl-C is unable to interrupt this.",
    "created_at": "2015-07-15T14:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253677",
    "user": "https://github.com/dimpase"
}
```

another annoying bug is that if mathematica is not installed then

```
sage: mathematica(1) # or whatever
```

just hangs, and even Ctrl-C is unable to interrupt this.



---

archive/issue_comments_253678.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n> another annoying bug is that if mathematica is not installed then\n> {{{\n> sage: mathematica(1) # or whatever\n> }}}\n> just hangs, and even Ctrl-C is unable to interrupt this.\n\nthis is fixed in #18908",
    "created_at": "2015-07-17T11:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253678",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:4 dimpase]:
> another annoying bug is that if mathematica is not installed then
> {{{
> sage: mathematica(1) # or whatever
> }}}
> just hangs, and even Ctrl-C is unable to interrupt this.

this is fixed in #18908



---

archive/issue_comments_253679.json:
```json
{
    "body": "The root of the \"too much TeX\" problem seems to be that at the moment by default mathematica interface outputs in LaTeX mode. I think this should be changed to plain. One way to change this is as follows.\n\n```\n--- a/src/sage/interfaces/mathematica.py\n+++ b/src/sage/interfaces/mathematica.py\n@@ -885,9 +885,10 @@ class MathematicaElement(ExpectElement):\n                     self.save, kwds, '.png', OutputImagePng)\n         else:\n             OutputLatex = display_manager.types.OutputLatex\n-            if display_manager.preferences.text == 'plain':\n+            dmp = display_manager.preferences.text\n+            if dmp is None or dmp == 'plain':\n                 return\n-            if OutputLatex in display_manager.supported_output():\n+            if dmp == 'latex' and OutputLatex in display_manager.supported_output():\n                 return OutputLatex(self._latex_())\n         \n     def show(self, ImageSize=600):\n```\n\nafter this change only 9 doctests in `sage/interfaces/mathematica.py` are failing, and these are mostly due to floating point noise. \n\nPlease tell me if I should proceed with this change. (One will have to document this properly too).",
    "created_at": "2015-07-17T12:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253679",
    "user": "https://github.com/dimpase"
}
```

The root of the "too much TeX" problem seems to be that at the moment by default mathematica interface outputs in LaTeX mode. I think this should be changed to plain. One way to change this is as follows.

```
--- a/src/sage/interfaces/mathematica.py
+++ b/src/sage/interfaces/mathematica.py
@@ -885,9 +885,10 @@ class MathematicaElement(ExpectElement):
                     self.save, kwds, '.png', OutputImagePng)
         else:
             OutputLatex = display_manager.types.OutputLatex
-            if display_manager.preferences.text == 'plain':
+            dmp = display_manager.preferences.text
+            if dmp is None or dmp == 'plain':
                 return
-            if OutputLatex in display_manager.supported_output():
+            if dmp == 'latex' and OutputLatex in display_manager.supported_output():
                 return OutputLatex(self._latex_())
         
     def show(self, ImageSize=600):
```

after this change only 9 doctests in `sage/interfaces/mathematica.py` are failing, and these are mostly due to floating point noise. 

Please tell me if I should proceed with this change. (One will have to document this properly too).



---

archive/issue_comments_253680.json:
```json
{
    "body": "changes around `display_manager` are due to Volker. I wonder whether he overlooked the fact that normally `display_manager.preferences.text is None` rather than `display_manager.preferences.text == 'plain'` holds.",
    "created_at": "2015-07-17T13:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253680",
    "user": "https://github.com/dimpase"
}
```

changes around `display_manager` are due to Volker. I wonder whether he overlooked the fact that normally `display_manager.preferences.text is None` rather than `display_manager.preferences.text == 'plain'` holds.



---

archive/issue_comments_253681.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2015-07-17T13:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253681",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_253682.json:
```json
{
    "body": "there is something going on with 'N()' that I don't get:\n\n```\nsage: mathematica('N[Pi,10]')\n3.1415926535897932384626433832795028842\nsage: mathematica.eval('N[Pi,10]')\n         3.141592654\nsage: mathematica('Pi').N(10)\n3.1415926535897932384626433832795028842\nsage: \n```\n\nunless we do that `eval`, we get way too many digits.",
    "created_at": "2015-07-17T15:19:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253682",
    "user": "https://github.com/dimpase"
}
```

there is something going on with 'N()' that I don't get:

```
sage: mathematica('N[Pi,10]')
3.1415926535897932384626433832795028842
sage: mathematica.eval('N[Pi,10]')
         3.141592654
sage: mathematica('Pi').N(10)
3.1415926535897932384626433832795028842
sage: 
```

unless we do that `eval`, we get way too many digits.



---

archive/issue_comments_253683.json:
```json
{
    "body": "Replying to [comment:9 dimpase]:\n\nI neither know how to deal with displaying images (via rich_repr...), nor what to do with `N()`. Otherwise, see the branch",
    "created_at": "2015-07-17T15:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253683",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:9 dimpase]:

I neither know how to deal with displaying images (via rich_repr...), nor what to do with `N()`. Otherwise, see the branch



---

archive/issue_comments_253684.json:
```json
{
    "body": "Changing keywords from \"\" to \"mathematica\".",
    "created_at": "2016-01-18T08:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253684",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "mathematica".



---

archive/issue_comments_253685.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-03-12T13:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253685",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_253686.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-03-12T13:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253686",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_253687.json:
```json
{
    "body": "with Mathematica 9 on 64-bit Linux, all tests pass with this branch. Please test and tell if this is the case on other systems/versions.",
    "created_at": "2016-03-12T13:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253687",
    "user": "https://github.com/dimpase"
}
```

with Mathematica 9 on 64-bit Linux, all tests pass with this branch. Please test and tell if this is the case on other systems/versions.



---

archive/issue_comments_253688.json:
```json
{
    "body": "With Mathematica 10.3.1 for Mac OS X x86 (64-bit),\nvarious test failures related to number of displayed digits.\nSee log attached.",
    "created_at": "2016-03-12T16:41:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253688",
    "user": "https://github.com/mkoeppe"
}
```

With Mathematica 10.3.1 for Mac OS X x86 (64-bit),
various test failures related to number of displayed digits.
See log attached.



---

archive/issue_comments_253689.json:
```json
{
    "body": "Attachment [mathematica-10.3.1-2016-03-12.log](tarball://root/attachments/some-uuid/ticket18888/mathematica-10.3.1-2016-03-12.log) by @mkoeppe created at 2016-03-12 16:42:58",
    "created_at": "2016-03-12T16:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253689",
    "user": "https://github.com/mkoeppe"
}
```

Attachment [mathematica-10.3.1-2016-03-12.log](tarball://root/attachments/some-uuid/ticket18888/mathematica-10.3.1-2016-03-12.log) by @mkoeppe created at 2016-03-12 16:42:58



---

archive/issue_comments_253690.json:
```json
{
    "body": "The `display_manager.preferences.text == None` is for you to decide; Just return what you think a good default for Mathematica objects is. Generally it is the same as `plain`, so feel free to implement that.\n\nE.g. one difference is the behavior of\n\n```\nsage: pretty_print(1/x)\n\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\frac{1}{x}\nsage: %display text plain\nsage: pretty_print(1/x)       # I specifically asked for plain text \n1/x\n```\n",
    "created_at": "2016-03-12T18:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253690",
    "user": "https://github.com/vbraun"
}
```

The `display_manager.preferences.text == None` is for you to decide; Just return what you think a good default for Mathematica objects is. Generally it is the same as `plain`, so feel free to implement that.

E.g. one difference is the behavior of

```
sage: pretty_print(1/x)
\newcommand{\Bold}[1]{\mathbf{#1}}\frac{1}{x}
sage: %display text plain
sage: pretty_print(1/x)       # I specifically asked for plain text 
1/x
```




---

archive/issue_comments_253691.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> With Mathematica 10.3.1 for Mac OS X x86 (64-bit),\n> various test failures related to number of displayed digits.\n> See log attached.\n\nMatthias, it seems that in your setup N() and n() methods of Mathematica objects are mixed up. For me on Linux, with 64-bit Mathematica 9,  I have\n\n```\nsage: t=mathematica('Pi')\nsage: t.n?\nDocstring:\n   Return a numerical approximation of x with at least prec bits of\n   precision.\n\n   EXAMPLES:\n[...]\nInit docstring: x.__init__(...) initializes x; see help(type(x)) for signature\nFile:           /home/scratch/dimpase/sage/sage/src/sage/structure/element.pyx\nType:           builtin_function_or_method\nsage: t.N?\nSignature:      t.N(*args)\nDocstring:\n   EXAMPLES:\n[...]\nInit docstring: x.__init__(...) initializes x; see help(type(x)) for signature\nFile:           /home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/interfaces/mathematica.py\nType:           instancemethod\nsage: t.n(20)\n3.1416\nsage: t.N(20)\n3.141592653589793238462643383279502884197169399375105820975\n```\n\n\nWhat is the output of these (in particular, two last) commands for you?",
    "created_at": "2016-03-12T20:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253691",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:15 mkoeppe]:
> With Mathematica 10.3.1 for Mac OS X x86 (64-bit),
> various test failures related to number of displayed digits.
> See log attached.

Matthias, it seems that in your setup N() and n() methods of Mathematica objects are mixed up. For me on Linux, with 64-bit Mathematica 9,  I have

```
sage: t=mathematica('Pi')
sage: t.n?
Docstring:
   Return a numerical approximation of x with at least prec bits of
   precision.

   EXAMPLES:
[...]
Init docstring: x.__init__(...) initializes x; see help(type(x)) for signature
File:           /home/scratch/dimpase/sage/sage/src/sage/structure/element.pyx
Type:           builtin_function_or_method
sage: t.N?
Signature:      t.N(*args)
Docstring:
   EXAMPLES:
[...]
Init docstring: x.__init__(...) initializes x; see help(type(x)) for signature
File:           /home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/interfaces/mathematica.py
Type:           instancemethod
sage: t.n(20)
3.1416
sage: t.N(20)
3.141592653589793238462643383279502884197169399375105820975
```


What is the output of these (in particular, two last) commands for you?



---

archive/issue_comments_253692.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> With Mathematica 10.3.1 for Mac OS X x86 (64-bit),\n\nit might be that your Mathematica is 32-bit, no?",
    "created_at": "2016-03-12T20:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253692",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:15 mkoeppe]:
> With Mathematica 10.3.1 for Mac OS X x86 (64-bit),

it might be that your Mathematica is 32-bit, no?



---

archive/issue_comments_253693.json:
```json
{
    "body": "Here's the output:\n\n\n```\nsage: sage: t.n(20)\n3.1416\nsage: sage: t.N(20)\n3.14159265358979323846\n```\n\n\nReplying to [comment:18 dimpase]:\n> Replying to [comment:15 mkoeppe]:\n> > With Mathematica 10.3.1 for Mac OS X x86 (64-bit),\n> \n> it might be that your Mathematica is 32-bit, no?\n\nNo. I copy-pasted from the banner that it displays at start; and also verified by calling ` mathematica.SystemInformation()`.\n \nNote that in the docstrings that you copied, it guarantees \"at least\" ... digits.\nSo the tests should probably not rely on a particular number of digits.",
    "created_at": "2016-03-13T00:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253693",
    "user": "https://github.com/mkoeppe"
}
```

Here's the output:


```
sage: sage: t.n(20)
3.1416
sage: sage: t.N(20)
3.14159265358979323846
```


Replying to [comment:18 dimpase]:
> Replying to [comment:15 mkoeppe]:
> > With Mathematica 10.3.1 for Mac OS X x86 (64-bit),
> 
> it might be that your Mathematica is 32-bit, no?

No. I copy-pasted from the banner that it displays at start; and also verified by calling ` mathematica.SystemInformation()`.
 
Note that in the docstrings that you copied, it guarantees "at least" ... digits.
So the tests should probably not rely on a particular number of digits.



---

archive/issue_comments_253694.json:
```json
{
    "body": "OK, at least I understand the reason for `N()` to output seemingly random length things. I set up logging output to a file, as follows, to see this:\n\n```\n--- a/src/sage/interfaces/mathematica.py\n+++ b/src/sage/interfaces/mathematica.py\n@@ -401,7 +401,7 @@ class Mathematica(ExtraTabCompletion, Expect):\n     \"\"\"\n     Interface to the Mathematica interpreter.\n     \"\"\"\n-    def __init__(self, maxread=None, script_subdirectory=None, logfile=None, server=None, server_tmpdir=None):\n+    def __init__(self, maxread=None, script_subdirectory=None, logfile=\"/tmp/xxx.log\", server=None, server_tmpdir=None):\n         Expect.__init__(self,\n                         name = 'mathematica',\n                         prompt = 'In[[0-9]+]:=',\n```\n\nNamely, the interface works with M-ca's `InputForm`; e.g. when `mathematica('Pi').N(10)`\nis computed, intermediate data is stored in `InputForm`, and it is on my system \n\n```\n3.14159265358979323846264338327950419993`10.\n```\n\nIn more detail:\n\n```\nIn[1]:= x2=N[Pi,10]                                                                                       \nOut[1]= 3.141592654\nIn[2]:= InputForm[x2]                                                                                     \nOut[2]//InputForm= 3.14159265358979323846264338327950419993`10.\nIn[3]:= 3.14159265358979323846264338327950419993`10.                                                      \nOut[3]= 3.141592654                                                                                             \nIn[4]:= InputForm[x2,NumberMarks->False]                                                                  \nOut[4]//InputForm= 3.14159265358979323846264338327950419993\n```\n\nThen `get()` is called, and it does (line 528 of `mathematica.py`)\n\n```\nreturn self.eval('InputForm[%s, NumberMarks->False]'%var, strip=True)\n```\n\nstripping `10` after the tick away (this is what `NumberMarks->False` does)! Oops...\nOne workaround would be to provide an implementation of `N()` avoiding `get` all together.",
    "created_at": "2016-03-13T15:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253694",
    "user": "https://github.com/dimpase"
}
```

OK, at least I understand the reason for `N()` to output seemingly random length things. I set up logging output to a file, as follows, to see this:

```
--- a/src/sage/interfaces/mathematica.py
+++ b/src/sage/interfaces/mathematica.py
@@ -401,7 +401,7 @@ class Mathematica(ExtraTabCompletion, Expect):
     """
     Interface to the Mathematica interpreter.
     """
-    def __init__(self, maxread=None, script_subdirectory=None, logfile=None, server=None, server_tmpdir=None):
+    def __init__(self, maxread=None, script_subdirectory=None, logfile="/tmp/xxx.log", server=None, server_tmpdir=None):
         Expect.__init__(self,
                         name = 'mathematica',
                         prompt = 'In[[0-9]+]:=',
```

Namely, the interface works with M-ca's `InputForm`; e.g. when `mathematica('Pi').N(10)`
is computed, intermediate data is stored in `InputForm`, and it is on my system 

```
3.14159265358979323846264338327950419993`10.
```

In more detail:

```
In[1]:= x2=N[Pi,10]                                                                                       
Out[1]= 3.141592654
In[2]:= InputForm[x2]                                                                                     
Out[2]//InputForm= 3.14159265358979323846264338327950419993`10.
In[3]:= 3.14159265358979323846264338327950419993`10.                                                      
Out[3]= 3.141592654                                                                                             
In[4]:= InputForm[x2,NumberMarks->False]                                                                  
Out[4]//InputForm= 3.14159265358979323846264338327950419993
```

Then `get()` is called, and it does (line 528 of `mathematica.py`)

```
return self.eval('InputForm[%s, NumberMarks->False]'%var, strip=True)
```

stripping `10` after the tick away (this is what `NumberMarks->False` does)! Oops...
One workaround would be to provide an implementation of `N()` avoiding `get` all together.



---

archive/issue_comments_253695.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-13T16:15:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253695",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_253696.json:
```json
{
    "body": "And here is a (hilarious) trace of the communications with M-ca, upon calling `mathematica('Pi').n(10)`.\n\n```\nMathematica 9.0 for Linux x86 (64-bit)\nCopyright 1988-2013 Wolfram Research, Inc.\nIn[1]:= sage0=Pi;\nIn[2]:= sage1=0;\nIn[3]:= sage2=gen[sage1];\nIn[4]:= sage1=prec[sage0];\nIn[5]:= sage3=1;\nIn[6]:= sage3=10;\nIn[7]:= sage3 < sage1\nOut[7]= 10 < prec[Pi]\nIn[8]:= sage3 > sage1\nOut[8]= 10 > prec[Pi]\nIn[9]:= sage3 == sage1\nOut[9]= 10 == prec[Pi]\nIn[10]:= sage3=1.0000;\nIn[11]:= sage0\nOut[11]= Pi\nIn[12]:= sage3=1.0000*I;\nIn[13]:= InputForm[sage0, NumberMarks->False]\nOut[13]//InputForm= Pi\nIn[14]:= \n```\n\n\ncertainly, M-ca does not know `gen` or `prec`, and thus the comparisons like\n\n```\nIn[7]:= sage3 < sage1\nOut[7]= 10 < prec[Pi]\n```\n\nfail miserably. Could anyone advice me on how to get the Sage part of the trace?\nI have no clue where these `gen` and `prec` come from.",
    "created_at": "2016-03-13T16:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253696",
    "user": "https://github.com/dimpase"
}
```

And here is a (hilarious) trace of the communications with M-ca, upon calling `mathematica('Pi').n(10)`.

```
Mathematica 9.0 for Linux x86 (64-bit)
Copyright 1988-2013 Wolfram Research, Inc.
In[1]:= sage0=Pi;
In[2]:= sage1=0;
In[3]:= sage2=gen[sage1];
In[4]:= sage1=prec[sage0];
In[5]:= sage3=1;
In[6]:= sage3=10;
In[7]:= sage3 < sage1
Out[7]= 10 < prec[Pi]
In[8]:= sage3 > sage1
Out[8]= 10 > prec[Pi]
In[9]:= sage3 == sage1
Out[9]= 10 == prec[Pi]
In[10]:= sage3=1.0000;
In[11]:= sage0
Out[11]= Pi
In[12]:= sage3=1.0000*I;
In[13]:= InputForm[sage0, NumberMarks->False]
Out[13]//InputForm= Pi
In[14]:= 
```


certainly, M-ca does not know `gen` or `prec`, and thus the comparisons like

```
In[7]:= sage3 < sage1
Out[7]= 10 < prec[Pi]
```

fail miserably. Could anyone advice me on how to get the Sage part of the trace?
I have no clue where these `gen` and `prec` come from.



---

archive/issue_comments_253697.json:
```json
{
    "body": "OK, we don't need to implement `n()` here, only `N()`. As far as `n()` goes, part of trouble comes from Sage being unable to do `n()` of constants in the `SR` (symbolic ring) properly. E.g.\n\n```\nsage: pi.n(10)\n3.1\n```\n\nWe can also implement `n()` as `sage().n()`, not sure if we should. E.g. `gap(2/3).n()` is not implemented. Perhaps explicitly making it throw `NotImplementedError` is the best?",
    "created_at": "2016-03-13T17:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253697",
    "user": "https://github.com/dimpase"
}
```

OK, we don't need to implement `n()` here, only `N()`. As far as `n()` goes, part of trouble comes from Sage being unable to do `n()` of constants in the `SR` (symbolic ring) properly. E.g.

```
sage: pi.n(10)
3.1
```

We can also implement `n()` as `sage().n()`, not sure if we should. E.g. `gap(2/3).n()` is not implemented. Perhaps explicitly making it throw `NotImplementedError` is the best?



---

archive/issue_comments_253698.json:
```json
{
    "body": "Whats wrong? With hindsight you need \n\n```\nsage: log(3.14 / 0.005, 2)\n9.29462074889163\n```\n\nbits of precision to know the next decimal digit, and there is probably a guard (binary) digit:\n\n```\nsage: pi.n(11)\n3.14\nsage: pi.n(digits=10)\n3.141592654\n```\n",
    "created_at": "2016-03-13T18:08:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253698",
    "user": "https://github.com/vbraun"
}
```

Whats wrong? With hindsight you need 

```
sage: log(3.14 / 0.005, 2)
9.29462074889163
```

bits of precision to know the next decimal digit, and there is probably a guard (binary) digit:

```
sage: pi.n(11)
3.14
sage: pi.n(digits=10)
3.141592654
```




---

archive/issue_comments_253699.json:
```json
{
    "body": "Replying to [comment:25 vbraun]:\n> Whats wrong? With hindsight you need \n> {{{\n> sage: log(3.14 / 0.005, 2)\n> 9.29462074889163\n> }}}\n> bits of precision to know the next decimal digit, and there is probably a guard (binary) digit:\n> {{{\n> sage: pi.n(11)\n> 3.14\n> sage: pi.n(digits=10)\n> 3.141592654\n> }}}\nwell, I am struggling to understand the error here:\nE.g. how would you explain the following:\n(it sort of works if the precision is specified...)\n\n\n```\nsage: mathematica('Pi').n()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-0b9c467a05fb> in <module>()\n----> 1 mathematica('Pi').n()\n\n/home/scratch/dimpase/sage/sage/src/sage/structure/element.pyx in sage.structure.element.Element.numerical_approx (build/cythonized/sage/structure/element.c:7330)()\n    717         \"\"\"\n    718         from sage.misc.functional import numerical_approx\n--> 719         return numerical_approx(self, prec=prec, digits=digits,\n    720                                 algorithm=algorithm)\n    721     n = numerical_approx\n\n/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/misc/functional.pyc in numerical_approx(x, prec, digits, algorithm)\n   1330 \n   1331     if prec > inprec:\n-> 1332         raise TypeError(\"cannot approximate to a precision of %s bits, use at most %s bits\" % (prec, inprec))\n   1333 \n   1334     # The issue is not precision, try conversion instead\n\nTypeError: cannot approximate to a precision of 53 bits, use at most          prec[Pi] bits\n```\n",
    "created_at": "2016-03-13T21:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253699",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:25 vbraun]:
> Whats wrong? With hindsight you need 
> {{{
> sage: log(3.14 / 0.005, 2)
> 9.29462074889163
> }}}
> bits of precision to know the next decimal digit, and there is probably a guard (binary) digit:
> {{{
> sage: pi.n(11)
> 3.14
> sage: pi.n(digits=10)
> 3.141592654
> }}}
well, I am struggling to understand the error here:
E.g. how would you explain the following:
(it sort of works if the precision is specified...)


```
sage: mathematica('Pi').n()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-0b9c467a05fb> in <module>()
----> 1 mathematica('Pi').n()

/home/scratch/dimpase/sage/sage/src/sage/structure/element.pyx in sage.structure.element.Element.numerical_approx (build/cythonized/sage/structure/element.c:7330)()
    717         """
    718         from sage.misc.functional import numerical_approx
--> 719         return numerical_approx(self, prec=prec, digits=digits,
    720                                 algorithm=algorithm)
    721     n = numerical_approx

/home/scratch/dimpase/sage/sage/local/lib/python2.7/site-packages/sage/misc/functional.pyc in numerical_approx(x, prec, digits, algorithm)
   1330 
   1331     if prec > inprec:
-> 1332         raise TypeError("cannot approximate to a precision of %s bits, use at most %s bits" % (prec, inprec))
   1333 
   1334     # The issue is not precision, try conversion instead

TypeError: cannot approximate to a precision of 53 bits, use at most          prec[Pi] bits
```




---

archive/issue_comments_253700.json:
```json
{
    "body": "Well I don't have Mathematica, you'll have to look at `sage.misc.functional.numerical_approx` yourself. Whats `mathematica('Pi').prec()`?",
    "created_at": "2016-03-13T23:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253700",
    "user": "https://github.com/vbraun"
}
```

Well I don't have Mathematica, you'll have to look at `sage.misc.functional.numerical_approx` yourself. Whats `mathematica('Pi').prec()`?



---

archive/issue_comments_253701.json:
```json
{
    "body": "Replying to [comment:27 vbraun]:\n> Well I don't have Mathematica, you'll have to look at `sage.misc.functional.numerical_approx` yourself. Whats `mathematica('Pi').prec()`?\n\nit is a symbolic Mathematica expression `prec[Pi]`. It cannot be evaluated to anything.\nEvaluating `mathematica('Pi').n()`, on Mathematica side I see the following:\n\n```\nIn[1]:= sage0=Pi;\nIn[2]:= sage1=0;\nIn[3]:= sage2=gen[sage1];\nIn[4]:= sage1=prec[sage0];\nIn[5]:= sage3=1;\nIn[6]:= sage3=53;\nIn[7]:= sage1 < sage3\nOut[7]= prec[Pi] < 53\nIn[8]:= sage1 > sage3\nOut[8]= prec[Pi] > 53\nIn[9]:= sage1 == sage3\nOut[9]= prec[Pi] == 53\nIn[10]:= sage1\nOut[10]= prec[Pi]\n```\n\n\n(in comment 22 I posted the corresponding log for `.n(10)` (I made a typo, wrote that it is `.n()`, now corrected there).",
    "created_at": "2016-03-13T23:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253701",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:27 vbraun]:
> Well I don't have Mathematica, you'll have to look at `sage.misc.functional.numerical_approx` yourself. Whats `mathematica('Pi').prec()`?

it is a symbolic Mathematica expression `prec[Pi]`. It cannot be evaluated to anything.
Evaluating `mathematica('Pi').n()`, on Mathematica side I see the following:

```
In[1]:= sage0=Pi;
In[2]:= sage1=0;
In[3]:= sage2=gen[sage1];
In[4]:= sage1=prec[sage0];
In[5]:= sage3=1;
In[6]:= sage3=53;
In[7]:= sage1 < sage3
Out[7]= prec[Pi] < 53
In[8]:= sage1 > sage3
Out[8]= prec[Pi] > 53
In[9]:= sage1 == sage3
Out[9]= prec[Pi] == 53
In[10]:= sage1
Out[10]= prec[Pi]
```


(in comment 22 I posted the corresponding log for `.n(10)` (I made a typo, wrote that it is `.n()`, now corrected there).



---

archive/issue_comments_253702.json:
```json
{
    "body": "The mathematica interface needs to implement `prec()` and/or `n()` methods. Right now they just fall through to the `__getattr__` hook and are translated in nonsensical Mathematica functions.",
    "created_at": "2016-03-14T00:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253702",
    "user": "https://github.com/vbraun"
}
```

The mathematica interface needs to implement `prec()` and/or `n()` methods. Right now they just fall through to the `__getattr__` hook and are translated in nonsensical Mathematica functions.



---

archive/issue_comments_253703.json:
```json
{
    "body": "Replying to [comment:29 vbraun]:\n> The mathematica interface needs to implement `prec()` and/or `n()` methods. Right now they just fall through to the `__getattr__` hook and are translated in nonsensical Mathematica functions. \n\nOK, I have implemented `n()`, and it works. \n\nBut I am at loss as to how to implement `N()` (i.e. the Mathematica function call).\nThe problem is that `get()` method of Mathematica class in \nhttps://github.com/sagemath/sage/blob/develop/src/sage/interfaces/mathematica.py#L517\nshould get the parameter `ascii_art` set to True while it calls Mathematica via Expect.\nAnd I cannot find an interface that would do this for me.",
    "created_at": "2016-03-15T12:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253703",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:29 vbraun]:
> The mathematica interface needs to implement `prec()` and/or `n()` methods. Right now they just fall through to the `__getattr__` hook and are translated in nonsensical Mathematica functions. 

OK, I have implemented `n()`, and it works. 

But I am at loss as to how to implement `N()` (i.e. the Mathematica function call).
The problem is that `get()` method of Mathematica class in 
https://github.com/sagemath/sage/blob/develop/src/sage/interfaces/mathematica.py#L517
should get the parameter `ascii_art` set to True while it calls Mathematica via Expect.
And I cannot find an interface that would do this for me.



---

archive/issue_comments_253704.json:
```json
{
    "body": "I don't understand, the `.N()` method should just be whatever it is by default. I.e. call mathematica and wrap whatever the output of N() is.",
    "created_at": "2016-03-15T13:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253704",
    "user": "https://github.com/vbraun"
}
```

I don't understand, the `.N()` method should just be whatever it is by default. I.e. call mathematica and wrap whatever the output of N() is.



---

archive/issue_comments_253705.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-15T13:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253706.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-15T13:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253706",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_253707.json:
```json
{
    "body": "Replying to [comment:31 vbraun]:\n> I don't understand, the `.N()` method should just be whatever it is by default. I.e. call mathematica and wrap whatever the output of N() is. \nThe thing is that\n\n```\nself.parent().N(self, *args)\n```\n\ndoe not work properly, as data is kept in `InputFormat` on Mathematica side, e.g. 1.111111111111 with\nprecision 5 is not kept the way one expects, 1.1111, but as 1.111111111111<backtick>5. And that <backtick> gets stripped off by `get()`, getting the precision info lost in the process. \n\nSo I ended up calling `self.parent().eval()` directly, took me the whole morning to figure out the right way. Anyhow, ready for review now!",
    "created_at": "2016-03-15T13:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253707",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:31 vbraun]:
> I don't understand, the `.N()` method should just be whatever it is by default. I.e. call mathematica and wrap whatever the output of N() is. 
The thing is that

```
self.parent().N(self, *args)
```

doe not work properly, as data is kept in `InputFormat` on Mathematica side, e.g. 1.111111111111 with
precision 5 is not kept the way one expects, 1.1111, but as 1.111111111111<backtick>5. And that <backtick> gets stripped off by `get()`, getting the precision info lost in the process. 

So I ended up calling `self.parent().eval()` directly, took me the whole morning to figure out the right way. Anyhow, ready for review now!



---

archive/issue_comments_253708.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-15T21:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253708",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_253709.json:
```json
{
    "body": "All good, except:\n\n\n```\nFile \"src/sage/symbolic/constants.py\", line 1082, in sage.symbolic.constants.Khinchin\nFailed example:\n    m.N(200)                                 # optional - mathematica\nExpected:\n    2.685452001065306445309714835481795693820382293994462953051152345557218859537152002801141174931847697995153465905288090082897677716410963051792533483259668381852315421332119499626039328522044819409618068664166343945732171166692445674          \nGot:\n            2.6854520010653064453097148354817956938203822939944629530511523455572 \n    >    188595371520028011411749318476979951534659052880900828976777164109630517 \n    >    925334832596683818523154213321194996260393285220448194096181\n```\n",
    "created_at": "2016-03-15T21:21:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253709",
    "user": "https://github.com/mkoeppe"
}
```

All good, except:


```
File "src/sage/symbolic/constants.py", line 1082, in sage.symbolic.constants.Khinchin
Failed example:
    m.N(200)                                 # optional - mathematica
Expected:
    2.685452001065306445309714835481795693820382293994462953051152345557218859537152002801141174931847697995153465905288090082897677716410963051792533483259668381852315421332119499626039328522044819409618068664166343945732171166692445674          
Got:
            2.6854520010653064453097148354817956938203822939944629530511523455572 
    >    188595371520028011411749318476979951534659052880900828976777164109630517 
    >    925334832596683818523154213321194996260393285220448194096181
```




---

archive/issue_comments_253710.json:
```json
{
    "body": "Replying to [comment:34 mkoeppe]:\n> All good, except:\noh, I forgot to check doctests in these files... Will do shortly.",
    "created_at": "2016-03-15T22:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253710",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:34 mkoeppe]:
> All good, except:
oh, I forgot to check doctests in these files... Will do shortly.



---

archive/issue_comments_253711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-15T23:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253712.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-15T23:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253712",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_253713.json:
```json
{
    "body": "Tests pass now. Didn't look at your code changes.",
    "created_at": "2016-03-15T23:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253713",
    "user": "https://github.com/mkoeppe"
}
```

Tests pass now. Didn't look at your code changes.



---

archive/issue_comments_253714.json:
```json
{
    "body": "Replying to [comment:32 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[7f9f0e0](http://git.sagemath.org/sage.git/commit/?id=7f9f0e0a79f3b35e4f78abe10efbbc3977b6964f)||`cleaning up N() and n()`||\n\nAny reason to use `pres` rather than `prec` to abbreviate \"precision\"?",
    "created_at": "2016-03-16T04:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253714",
    "user": "https://github.com/slel"
}
```

Replying to [comment:32 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[7f9f0e0](http://git.sagemath.org/sage.git/commit/?id=7f9f0e0a79f3b35e4f78abe10efbbc3977b6964f)||`cleaning up N() and n()`||

Any reason to use `pres` rather than `prec` to abbreviate "precision"?



---

archive/issue_comments_253715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-16T08:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253716.json:
```json
{
    "body": "With Mathematica 10.3.1 for Mac OS X x86 (64-bit), all tests passed. \n\nThe old doctests showed that the results of `math_bessel_K(nu,x)` were different on 32-bit and 64-bit machines.\n\n```\n@@ -310,14 +306,13 @@ For more details, see the documentation for ``._sage_()``.\n OTHER Examples::\n \n     sage: def math_bessel_K(nu,x):\n     ...       return mathematica(nu).BesselK(x).N(20)\n     ...\n     sage: math_bessel_K(2,I)                      # optional - mathematica\n-    0.180489972066962*I - 2.592886175491197             # 32-bit\n-    -2.59288617549119697817 + 0.18048997206696202663*I  # 64-bit\n+    -2.5928861754911969782 + 0.1804899720669620266 I\n```\n\nHave they become identical now? \n\nAlso, I was puzzled by the discrepancy between\n\n```\nsage: mathematica('Pi').N(10)\n         3.141592654\n```\n\nand\n\n```\nsage: mathematica('Pi').n(10)\n3.1\n```\n\nAfter reading up on the code, I understand that `MathematicaElement.N()` sets the precision in decimal digits, whereas `MathematicaElement.n()` sets the precision in bits, so that the two examples above behave as\n\n```\nsage: pi.n(digits=10)\n3.141592654\n```\n\nand\n\n```\nsage: pi.n(10)\n3.1\n```\n\nrespectively.\nIs such difference between `.N()` and `.n()` intended for `MathematicaElement`? Then maybe this should be specified in the documentations? Does it make sense to implement `mathematica('Pi').n(digits=10)` as well?",
    "created_at": "2016-03-29T03:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253716",
    "user": "https://github.com/yuan-zhou"
}
```

With Mathematica 10.3.1 for Mac OS X x86 (64-bit), all tests passed. 

The old doctests showed that the results of `math_bessel_K(nu,x)` were different on 32-bit and 64-bit machines.

```
@@ -310,14 +306,13 @@ For more details, see the documentation for ``._sage_()``.
 OTHER Examples::
 
     sage: def math_bessel_K(nu,x):
     ...       return mathematica(nu).BesselK(x).N(20)
     ...
     sage: math_bessel_K(2,I)                      # optional - mathematica
-    0.180489972066962*I - 2.592886175491197             # 32-bit
-    -2.59288617549119697817 + 0.18048997206696202663*I  # 64-bit
+    -2.5928861754911969782 + 0.1804899720669620266 I
```

Have they become identical now? 

Also, I was puzzled by the discrepancy between

```
sage: mathematica('Pi').N(10)
         3.141592654
```

and

```
sage: mathematica('Pi').n(10)
3.1
```

After reading up on the code, I understand that `MathematicaElement.N()` sets the precision in decimal digits, whereas `MathematicaElement.n()` sets the precision in bits, so that the two examples above behave as

```
sage: pi.n(digits=10)
3.141592654
```

and

```
sage: pi.n(10)
3.1
```

respectively.
Is such difference between `.N()` and `.n()` intended for `MathematicaElement`? Then maybe this should be specified in the documentations? Does it make sense to implement `mathematica('Pi').n(digits=10)` as well?



---

archive/issue_comments_253717.json:
```json
{
    "body": "Replying to [comment:42 yzh]:\n> With Mathematica 10.3.1 for Mac OS X x86 (64-bit), all tests passed. \n> \n> The old doctests showed that the results of `math_bessel_K(nu,x)` were different on 32-bit and 64-bit machines.\n> {{{\n> `@``@` -310,14 +306,13 `@``@` For more details, see the documentation for ``._sage_()``.\n>  OTHER Examples::\n>  \n>      sage: def math_bessel_K(nu,x):\n>      ...       return mathematica(nu).BesselK(x).N(20)\n>      ...\n>      sage: math_bessel_K(2,I)                      # optional - mathematica\n> -    0.180489972066962*I - 2.592886175491197             # 32-bit\n> -    -2.59288617549119697817 + 0.18048997206696202663*I  # 64-bit\n> +    -2.5928861754911969782 + 0.1804899720669620266 I\n> }}}\nthe difference was due to a bug that is now fixed, I think.\n\n> Have they become identical now? \nthey should be.\nI don't have 32-bit Mathematical to test, but I think it should be the same.\n> \n> Also, I was puzzled by the discrepancy between\n> {{{\n> sage: mathematica('Pi').N(10)\n>          3.141592654\n> }}}\n> and\n> {{{\n> sage: mathematica('Pi').n(10)\n> 3.1\n> }}}\n> After reading up on the code, I understand that `MathematicaElement.N()` sets the precision in decimal digits, whereas `MathematicaElement.n()` sets the precision in bits, so that the two examples above behave as\n> {{{\n> sage: pi.n(digits=10)\n> 3.141592654\n> }}}\n> and\n> {{{\n> sage: pi.n(10)\n> 3.1\n> }}}\n> respectively.\n> Is such difference between `.N()` and `.n()` intended for `MathematicaElement`? Then maybe this should be specified in the documentations? Does it make sense to implement `mathematica('Pi').n(digits=10)` as well?\n\nthe idea is that N() is a Mathematica function, and n() is a Sage function.",
    "created_at": "2016-03-29T06:47:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253717",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:42 yzh]:
> With Mathematica 10.3.1 for Mac OS X x86 (64-bit), all tests passed. 
> 
> The old doctests showed that the results of `math_bessel_K(nu,x)` were different on 32-bit and 64-bit machines.
> {{{
> `@``@` -310,14 +306,13 `@``@` For more details, see the documentation for ``._sage_()``.
>  OTHER Examples::
>  
>      sage: def math_bessel_K(nu,x):
>      ...       return mathematica(nu).BesselK(x).N(20)
>      ...
>      sage: math_bessel_K(2,I)                      # optional - mathematica
> -    0.180489972066962*I - 2.592886175491197             # 32-bit
> -    -2.59288617549119697817 + 0.18048997206696202663*I  # 64-bit
> +    -2.5928861754911969782 + 0.1804899720669620266 I
> }}}
the difference was due to a bug that is now fixed, I think.

> Have they become identical now? 
they should be.
I don't have 32-bit Mathematical to test, but I think it should be the same.
> 
> Also, I was puzzled by the discrepancy between
> {{{
> sage: mathematica('Pi').N(10)
>          3.141592654
> }}}
> and
> {{{
> sage: mathematica('Pi').n(10)
> 3.1
> }}}
> After reading up on the code, I understand that `MathematicaElement.N()` sets the precision in decimal digits, whereas `MathematicaElement.n()` sets the precision in bits, so that the two examples above behave as
> {{{
> sage: pi.n(digits=10)
> 3.141592654
> }}}
> and
> {{{
> sage: pi.n(10)
> 3.1
> }}}
> respectively.
> Is such difference between `.N()` and `.n()` intended for `MathematicaElement`? Then maybe this should be specified in the documentations? Does it make sense to implement `mathematica('Pi').n(digits=10)` as well?

the idea is that N() is a Mathematica function, and n() is a Sage function.



---

archive/issue_comments_253718.json:
```json
{
    "body": "> Does it make sense to implement mathematica('Pi').n(digits=10) as well?\noops, right, there is a typo in n() implementation. I'll fix it at once.",
    "created_at": "2016-03-29T07:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253718",
    "user": "https://github.com/dimpase"
}
```

> Does it make sense to implement mathematica('Pi').n(digits=10) as well?
oops, right, there is a typo in n() implementation. I'll fix it at once.



---

archive/issue_comments_253719.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-29T07:01:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253719",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_253720.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-29T10:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253721.json:
```json
{
    "body": "OK, fixed. Please have a look.",
    "created_at": "2016-03-29T10:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253721",
    "user": "https://github.com/dimpase"
}
```

OK, fixed. Please have a look.



---

archive/issue_comments_253722.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-29T10:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253722",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_253723.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-29T10:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253723",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_253724.json:
```json
{
    "body": "Thanks a lot for the nice work.",
    "created_at": "2016-03-29T18:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253724",
    "user": "https://github.com/yuan-zhou"
}
```

Thanks a lot for the nice work.



---

archive/issue_comments_253725.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-03-29T18:55:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253725",
    "user": "https://github.com/yuan-zhou"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_253726.json:
```json
{
    "body": "invisible space",
    "created_at": "2016-03-30T16:32:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253726",
    "user": "https://github.com/vbraun"
}
```

invisible space



---

archive/issue_events_017834.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-03-31T18:41:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18651#event-17834"
}
```



---

archive/issue_comments_253727.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-31T18:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18651#issuecomment-253727",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
