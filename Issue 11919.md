# Issue 11919: bug in add_constraint to MixedIntegerLinearProgram

archive/issues_011919.json:
```json
{
    "body": "Assignee: ncohen\n\nCC:  ncohen kini vbraun\n\nconstraints with 0 on one size of an inequality get lost, somehow:\n\n```\nsage: p = MixedIntegerLinearProgram(maximization=True)\nsage: A = p.new_variable()\nsage: p.add_constraint(A[0]==1)\nsage: p.add_constraint(0<= A[1]-A[0])\nsage: p.show()\nMaximization:\n \nConstraints:\n  1.0 <= x_0 <= 1.0\nVariables:\n  x_0 is a continuous variable (min=0.0, max=+oo)\n  x_1 is a continuous variable (min=0.0, max=+oo)\n```\n\n\nhomogenizing the constraint fixes this problem:\n\n```\nsage: p.add_constraint(0*A[0]<= A[1]-A[0])\nsage: p.show()\nMaximization:\n \nConstraints:\n  1.0 <= x_0 <= 1.0\n  x_0 -x_1 <= 0.0\nVariables:\n  x_0 is a continuous variable (min=0.0, max=+oo)\n  x_1 is a continuous variable (min=0.0, max=+oo)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/12091\n\n",
    "created_at": "2011-11-27T17:33:11Z",
    "labels": [
        "linear programming",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.5",
    "title": "bug in add_constraint to MixedIntegerLinearProgram",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11919",
    "user": "dimpase"
}
```
Assignee: ncohen

CC:  ncohen kini vbraun

constraints with 0 on one size of an inequality get lost, somehow:

```
sage: p = MixedIntegerLinearProgram(maximization=True)
sage: A = p.new_variable()
sage: p.add_constraint(A[0]==1)
sage: p.add_constraint(0<= A[1]-A[0])
sage: p.show()
Maximization:
 
Constraints:
  1.0 <= x_0 <= 1.0
Variables:
  x_0 is a continuous variable (min=0.0, max=+oo)
  x_1 is a continuous variable (min=0.0, max=+oo)
```


homogenizing the constraint fixes this problem:

```
sage: p.add_constraint(0*A[0]<= A[1]-A[0])
sage: p.show()
Maximization:
 
Constraints:
  1.0 <= x_0 <= 1.0
  x_0 -x_1 <= 0.0
Variables:
  x_0 is a continuous variable (min=0.0, max=+oo)
  x_1 is a continuous variable (min=0.0, max=+oo)
```


Issue created by migration from https://trac.sagemath.org/ticket/12091





---

archive/issue_comments_136670.json:
```json
{
    "body": "I spent days already on this problem, so I should at least update the ticket. This does not work because of.... that :\n\n```\nsage: p = MixedIntegerLinearProgram()\nsage: b = p.new_variable()\nsage: b[2] + b[4] >= 5\n5 <= x_0 +x_1\nsage: 5 <= b[2] + b[4]\nTrue\n```\n\n\nIt is as easy as that. And of course, calling ``p.add_constraint(True)`` can not do anything useful. That comes from the fact that the way it is implemented the comparison methods I wrote for the LP variables are totally ignored when there is an integer on the left of the equation.\n\nI went through hell (aka the coercion system) to make it work, and after getting back from hell (writing new classes, using categories, parents objets, elements objects, ...) Sage finally understood that it has to coerce integers to \"LinearFunction\" objects before applying the ``<=`` operation.\n\nI was happy at this point. And then I noticed that when I typed ``3*b[i]`` in Sage, it first converted the \"3\" to a ``LinearFunction`` object and then tried to multiply linear functions between themselves. And multiply linear functions is *never* a good idea.\n\nSo unless there is a magical way to make it work (without destroying all the code... I mean, even reaching that former point amounted to something like 100 additional lines of code totally exclusively dealing with categories and coercion), I'd stand for big \"DO NOT PUT AN INTEGER BY ITSELF ON THE LEFT SIDE OF A LP INEQUALITY\" in the doc.\n\nBut I'd prefer to find a magical way, of course..\n\nNathann",
    "created_at": "2012-02-20T08:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136670",
    "user": "ncohen"
}
```

I spent days already on this problem, so I should at least update the ticket. This does not work because of.... that :

```
sage: p = MixedIntegerLinearProgram()
sage: b = p.new_variable()
sage: b[2] + b[4] >= 5
5 <= x_0 +x_1
sage: 5 <= b[2] + b[4]
True
```


It is as easy as that. And of course, calling ``p.add_constraint(True)`` can not do anything useful. That comes from the fact that the way it is implemented the comparison methods I wrote for the LP variables are totally ignored when there is an integer on the left of the equation.

I went through hell (aka the coercion system) to make it work, and after getting back from hell (writing new classes, using categories, parents objets, elements objects, ...) Sage finally understood that it has to coerce integers to "LinearFunction" objects before applying the ``<=`` operation.

I was happy at this point. And then I noticed that when I typed ``3*b[i]`` in Sage, it first converted the "3" to a ``LinearFunction`` object and then tried to multiply linear functions between themselves. And multiply linear functions is *never* a good idea.

So unless there is a magical way to make it work (without destroying all the code... I mean, even reaching that former point amounted to something like 100 additional lines of code totally exclusively dealing with categories and coercion), I'd stand for big "DO NOT PUT AN INTEGER BY ITSELF ON THE LEFT SIDE OF A LP INEQUALITY" in the doc.

But I'd prefer to find a magical way, of course..

Nathann



---

archive/issue_comments_136671.json:
```json
{
    "body": "I might be clueless, but this asks a modification of the Sage pre-parser. The pre-parser might be able to add the crap necessary for the Hell (aka coersion framework) to freeze over and do the right thing...\n\nDima",
    "created_at": "2012-02-20T13:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136671",
    "user": "dimpase"
}
```

I might be clueless, but this asks a modification of the Sage pre-parser. The pre-parser might be able to add the crap necessary for the Hell (aka coersion framework) to freeze over and do the right thing...

Dima



---

archive/issue_comments_136672.json:
```json
{
    "body": "Replying to [comment:4 dimpase]:\n> I might be clueless, but this asks a modification of the Sage pre-parser. The pre-parser might be able to add the crap necessary for the Hell (aka coersion framework) to freeze over and do the right thing...\n\nNot sure about the preparser. But I feel that at least some of the bugs (the examples I added) can be fixed by modifying the Linear* classes I mentioned. I had been hacking it for about a day, but I haven't yet got the right solution. The constants are indeed way more trickier to handle, since there seems to be no way of knowing when we have normal inequalities and when we have LP ones.",
    "created_at": "2012-02-20T13:55:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136672",
    "user": "ppurka"
}
```

Replying to [comment:4 dimpase]:
> I might be clueless, but this asks a modification of the Sage pre-parser. The pre-parser might be able to add the crap necessary for the Hell (aka coersion framework) to freeze over and do the right thing...

Not sure about the preparser. But I feel that at least some of the bugs (the examples I added) can be fixed by modifying the Linear* classes I mentioned. I had been hacking it for about a day, but I haven't yet got the right solution. The constants are indeed way more trickier to handle, since there seems to be no way of knowing when we have normal inequalities and when we have LP ones.



---

archive/issue_comments_136673.json:
```json
{
    "body": "Replying to [comment:5 ppurka]:\n> The constants are indeed way more trickier to handle, since there seems to be no way of knowing when we have normal inequalities and when we have LP ones.\n\nHow come? The LP inequalities have LP variables. So one of the tokens will be such a variable...",
    "created_at": "2012-02-20T14:02:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136673",
    "user": "dimpase"
}
```

Replying to [comment:5 ppurka]:
> The constants are indeed way more trickier to handle, since there seems to be no way of knowing when we have normal inequalities and when we have LP ones.

How come? The LP inequalities have LP variables. So one of the tokens will be such a variable...



---

archive/issue_comments_136674.json:
```json
{
    "body": "Replying to [comment:6 dimpase]:\n> How come? The LP inequalities have LP variables. So one of the tokens will be such a variable...\n\nMy understanding is this:\n\nWhen you start with `5 <= b[0]` your program will see the *number* 5 not an object from the class `LinearConstraint` or `LinearFunction`. So, `LinearConstraint.__le__` won't be called. This is ok when you have the opposite `b[0] >= 5`.",
    "created_at": "2012-02-20T14:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136674",
    "user": "ppurka"
}
```

Replying to [comment:6 dimpase]:
> How come? The LP inequalities have LP variables. So one of the tokens will be such a variable...

My understanding is this:

When you start with `5 <= b[0]` your program will see the *number* 5 not an object from the class `LinearConstraint` or `LinearFunction`. So, `LinearConstraint.__le__` won't be called. This is ok when you have the opposite `b[0] >= 5`.



---

archive/issue_comments_136675.json:
```json
{
    "body": "Replying to [comment:7 ppurka]:\n> Replying to [comment:6 dimpase]:\n> > How come? The LP inequalities have LP variables. So one of the tokens will be such a variable...\n> \n> My understanding is this:\n> \n> When you start with `5 <= b[0]` your program will see the *number* 5 not an object from the class `LinearConstraint` or `LinearFunction`. So, `LinearConstraint.__le__` won't be called. This is ok when you have the opposite `b[0] >= 5`.\n\nOK, this just means that the preparser should keep looking further if he sees a constant...\nIMHO it's some kind of basic compiler/interpreter piece of technology.",
    "created_at": "2012-02-20T14:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136675",
    "user": "dimpase"
}
```

Replying to [comment:7 ppurka]:
> Replying to [comment:6 dimpase]:
> > How come? The LP inequalities have LP variables. So one of the tokens will be such a variable...
> 
> My understanding is this:
> 
> When you start with `5 <= b[0]` your program will see the *number* 5 not an object from the class `LinearConstraint` or `LinearFunction`. So, `LinearConstraint.__le__` won't be called. This is ok when you have the opposite `b[0] >= 5`.

OK, this just means that the preparser should keep looking further if he sees a constant...
IMHO it's some kind of basic compiler/interpreter piece of technology.



---

archive/issue_comments_136676.json:
```json
{
    "body": "Why do you see the problem at the preparser level ? This kind of lines can also appear fron the inside of Sage's code, where the preparser does nothing.. Or am I mistaken ?\n\nNathann",
    "created_at": "2012-02-20T14:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136676",
    "user": "ncohen"
}
```

Why do you see the problem at the preparser level ? This kind of lines can also appear fron the inside of Sage's code, where the preparser does nothing.. Or am I mistaken ?

Nathann



---

archive/issue_comments_136677.json:
```json
{
    "body": "Replying to [comment:9 ncohen]:\n> Why do you see the problem at the preparser level ? This kind of lines can also appear fron the inside of Sage's code, where the preparser does nothing.. Or am I mistaken ?\n\nNothing? Why? Surely you can use symbolic functions in Sage library code, why not? It gets preparsed all right.",
    "created_at": "2012-02-20T14:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136677",
    "user": "dimpase"
}
```

Replying to [comment:9 ncohen]:
> Why do you see the problem at the preparser level ? This kind of lines can also appear fron the inside of Sage's code, where the preparser does nothing.. Or am I mistaken ?

Nothing? Why? Surely you can use symbolic functions in Sage library code, why not? It gets preparsed all right.



---

archive/issue_comments_136678.json:
```json
{
    "body": "Oh, I thought the preparser was the piece of code that replaced 5 by Integer(5) when using the console, and that you had to rely on yourself when writing code from the inside of Sage. That's why I was convinced that the only way out of this mess was to deal with the coercion system.\n\nNathann",
    "created_at": "2012-02-20T14:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136678",
    "user": "ncohen"
}
```

Oh, I thought the preparser was the piece of code that replaced 5 by Integer(5) when using the console, and that you had to rely on yourself when writing code from the inside of Sage. That's why I was convinced that the only way out of this mess was to deal with the coercion system.

Nathann



---

archive/issue_comments_136679.json:
```json
{
    "body": "Replying to [comment:10 dimpase]:\n> Replying to [comment:9 ncohen]:\n> > Why do you see the problem at the preparser level ? This kind of lines can also appear fron the inside of Sage's code, where the preparser does nothing.. Or am I mistaken ?\n> \n> Nothing? Why? Surely you can use symbolic functions in Sage library code, why not? It gets preparsed all right.\n\nActually no. Not everything gets preparsed. I ran into this problem not long ago, where the `^` wasn't preparsed since it was in a separate file I was importing.",
    "created_at": "2012-02-20T14:30:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136679",
    "user": "ppurka"
}
```

Replying to [comment:10 dimpase]:
> Replying to [comment:9 ncohen]:
> > Why do you see the problem at the preparser level ? This kind of lines can also appear fron the inside of Sage's code, where the preparser does nothing.. Or am I mistaken ?
> 
> Nothing? Why? Surely you can use symbolic functions in Sage library code, why not? It gets preparsed all right.

Actually no. Not everything gets preparsed. I ran into this problem not long ago, where the `^` wasn't preparsed since it was in a separate file I was importing.



---

archive/issue_comments_136680.json:
```json
{
    "body": "AFAIK nothing gets preparsed from the library. The library is pure Python, not \"Sage code\" (thankfully).",
    "created_at": "2012-02-20T14:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136680",
    "user": "kini"
}
```

AFAIK nothing gets preparsed from the library. The library is pure Python, not "Sage code" (thankfully).



---

archive/issue_comments_136681.json:
```json
{
    "body": "Replying to [comment:13 kini]:\n> AFAIK nothing gets preparsed from the library. The library is pure Python, not \"Sage code\" (thankfully).\n\nI recall in our MTH213 code we certainly used symbolic functions inside .py files. I might be delusional, however...",
    "created_at": "2012-02-20T14:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136681",
    "user": "dimpase"
}
```

Replying to [comment:13 kini]:
> AFAIK nothing gets preparsed from the library. The library is pure Python, not "Sage code" (thankfully).

I recall in our MTH213 code we certainly used symbolic functions inside .py files. I might be delusional, however...



---

archive/issue_comments_136682.json:
```json
{
    "body": "Well I guess you can, but I don't think the manipulation of symbolic variables requires the preparser to do its job. I mean, adding LP variables is already some kind of symbolic computation and all it requires is to define __add__, __mul__, etc ...\n\nNathann",
    "created_at": "2012-02-20T14:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136682",
    "user": "ncohen"
}
```

Well I guess you can, but I don't think the manipulation of symbolic variables requires the preparser to do its job. I mean, adding LP variables is already some kind of symbolic computation and all it requires is to define __add__, __mul__, etc ...

Nathann



---

archive/issue_comments_136683.json:
```json
{
    "body": "dimpase: if you mean the syntax\n\n\n```\nf(x) = x^2\n```\n\n\nthen no, we definitely did not use it in .py files :) But you certainly don't NEED the preparser for any Sage functionality. Well, unless you count the preparser itself as \"Sage functionality\". For example the above is equivalent to\n\n\n```python\nf = (x^2).function(x)\n```\n",
    "created_at": "2012-02-20T14:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136683",
    "user": "kini"
}
```

dimpase: if you mean the syntax


```
f(x) = x^2
```


then no, we definitely did not use it in .py files :) But you certainly don't NEED the preparser for any Sage functionality. Well, unless you count the preparser itself as "Sage functionality". For example the above is equivalent to


```python
f = (x^2).function(x)
```




---

archive/issue_comments_136684.json:
```json
{
    "body": "Replying to [comment:16 kini]:\n> we definitely did not use it in .py files :) But you certainly don't NEED the preparser for any Sage functionality. Well, unless you count the preparser itself as \"Sage functionality\". \n\nwell, anyway. Actually, I don't see why Sage library files can't be .sage file, is it some kind of religion?  (OK, you'd need to preparse them once, I guess).\n\nIt's obviously makes things unnecessarily verbose to rely upon Python's idea of what a well-formed mathematical expression might be.",
    "created_at": "2012-02-20T14:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136684",
    "user": "dimpase"
}
```

Replying to [comment:16 kini]:
> we definitely did not use it in .py files :) But you certainly don't NEED the preparser for any Sage functionality. Well, unless you count the preparser itself as "Sage functionality". 

well, anyway. Actually, I don't see why Sage library files can't be .sage file, is it some kind of religion?  (OK, you'd need to preparse them once, I guess).

It's obviously makes things unnecessarily verbose to rely upon Python's idea of what a well-formed mathematical expression might be.



---

archive/issue_comments_136685.json:
```json
{
    "body": "> well, anyway. Actually, I don't see why Sage library files can't be .sage file, is it some kind of religion?\n\nYeah, at some point we stopped blaming God for everything. We should do it again `:-D`\n\n> It's obviously makes things unnecessarily verbose to rely upon Python's idea of what a well-formed mathematical expression might be.\n\n+1\n\nThat's precisely why I had to create a \"Sum\" function for LP variables. Because I refused to add n variables in n^2 times, and that it is the only way to do it with __add__ methods. And this \"Sum\" method fixes the problem but is a bad solution.\n\nNathann",
    "created_at": "2012-02-20T15:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136685",
    "user": "ncohen"
}
```

> well, anyway. Actually, I don't see why Sage library files can't be .sage file, is it some kind of religion?

Yeah, at some point we stopped blaming God for everything. We should do it again `:-D`

> It's obviously makes things unnecessarily verbose to rely upon Python's idea of what a well-formed mathematical expression might be.

+1

That's precisely why I had to create a "Sum" function for LP variables. Because I refused to add n variables in n^2 times, and that it is the only way to do it with __add__ methods. And this "Sum" method fixes the problem but is a bad solution.

Nathann



---

archive/issue_comments_136686.json:
```json
{
    "body": "I disagree. The library should remain Python because \"Sage code\" is not a well defined language. In fact I would go so far to say that it is a complete ad-hoc hash. I try to avoid using it whenever I can.\n\nNathann: I don't see how that is an argument for including .sage files in the Sage library... or maybe it wasn't meant that way?",
    "created_at": "2012-02-20T15:08:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136686",
    "user": "kini"
}
```

I disagree. The library should remain Python because "Sage code" is not a well defined language. In fact I would go so far to say that it is a complete ad-hoc hash. I try to avoid using it whenever I can.

Nathann: I don't see how that is an argument for including .sage files in the Sage library... or maybe it wasn't meant that way?



---

archive/issue_comments_136687.json:
```json
{
    "body": "Replying to [comment:19 kini]:\n> I disagree. The library should remain Python because \"Sage code\" is not a well defined language. In fact I would go so far to say that it is a complete ad-hoc hash. I try to avoid using it whenever I can.\n> \n\nlet's make it well-defined then!",
    "created_at": "2012-02-20T15:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136687",
    "user": "dimpase"
}
```

Replying to [comment:19 kini]:
> I disagree. The library should remain Python because "Sage code" is not a well defined language. In fact I would go so far to say that it is a complete ad-hoc hash. I try to avoid using it whenever I can.
> 

let's make it well-defined then!



---

archive/issue_comments_136688.json:
```json
{
    "body": "> Nathann: I don't see how that is an argument for including .sage files in the Sage library... or maybe it wasn't meant that way?\n\nOh. Well, my \"+1\" was just about Dima's remark that what we were fighting in this situation was precisely Python's management of + / * - operators...  Looks like in this situation it is clearly our main problem `:-)`\n\nNathann",
    "created_at": "2012-02-20T15:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136688",
    "user": "ncohen"
}
```

> Nathann: I don't see how that is an argument for including .sage files in the Sage library... or maybe it wasn't meant that way?

Oh. Well, my "+1" was just about Dima's remark that what we were fighting in this situation was precisely Python's management of + / * - operators...  Looks like in this situation it is clearly our main problem `:-)`

Nathann



---

archive/issue_comments_136689.json:
```json
{
    "body": "The problem with the `a <= b <= c` is actually a problem with python. According to [this](http://www.python.org/dev/peps/pep-0207/), chained inequalities behave as follows:\n\n```\n# Trying to do x < y < z\n             temp1 = x < y\n             if temp1:\n               return y < z\n             else:\n               return temp1\n```\n\nAccording to one of my colleagues this behavior is different in python-3 (and that python-3 has the behavior we want), but I haven't checked (I will need to install python-3).\n\nOne workaround is to explicitly group the inequalities. So, instead of inputting `a <= b <= c`, if we do `(a <= b) <= c` then it works. Since we are not moving to python-3 any time soon, the documentation should be updated to either discourage chained inequalities or to use explicitly grouped chained inequalities.",
    "created_at": "2012-04-05T14:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136689",
    "user": "ppurka"
}
```

The problem with the `a <= b <= c` is actually a problem with python. According to [this](http://www.python.org/dev/peps/pep-0207/), chained inequalities behave as follows:

```
# Trying to do x < y < z
             temp1 = x < y
             if temp1:
               return y < z
             else:
               return temp1
```

According to one of my colleagues this behavior is different in python-3 (and that python-3 has the behavior we want), but I haven't checked (I will need to install python-3).

One workaround is to explicitly group the inequalities. So, instead of inputting `a <= b <= c`, if we do `(a <= b) <= c` then it works. Since we are not moving to python-3 any time soon, the documentation should be updated to either discourage chained inequalities or to use explicitly grouped chained inequalities.



---

archive/issue_comments_136690.json:
```json
{
    "body": "This can be closed as a duplicate as soon as #13646 is done.",
    "created_at": "2012-10-24T16:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136690",
    "user": "dimpase"
}
```

This can be closed as a duplicate as soon as #13646 is done.



---

archive/issue_comments_136691.json:
```json
{
    "body": "Replying to [comment:23 dimpase]:\n> This can be closed as a duplicate as soon as #13646 is done. \nNope. The problem with the chained inequalities still remains.",
    "created_at": "2012-10-24T16:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136691",
    "user": "ppurka"
}
```

Replying to [comment:23 dimpase]:
> This can be closed as a duplicate as soon as #13646 is done. 
Nope. The problem with the chained inequalities still remains.



---

archive/issue_comments_136692.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2012-10-24T22:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136692",
    "user": "dimpase"
}
```

Changing priority from critical to major.



---

archive/issue_comments_136693.json:
```json
{
    "body": "Patch fixes chained constraints:\n\n```\n    sage: p = MixedIntegerLinearProgram()\n    sage: b = p.new_variable()\n    sage: b[0] <= b[1] <= 2\n    x_0 <= x_1 <= 2\n    sage: list(b[0] <= b[1] <= 2)\n    [x_0, x_1, 2]\n    sage: 1 >= b[1] >= 2*b[0]\n    2*x_0 <= x_1 <= 1\n    sage: b[2] >= b[1] >= 2*b[0]\n    2*x_0 <= x_1 <= x_2\n```\n",
    "created_at": "2012-10-25T21:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136693",
    "user": "vbraun"
}
```

Patch fixes chained constraints:

```
    sage: p = MixedIntegerLinearProgram()
    sage: b = p.new_variable()
    sage: b[0] <= b[1] <= 2
    x_0 <= x_1 <= 2
    sage: list(b[0] <= b[1] <= 2)
    [x_0, x_1, 2]
    sage: 1 >= b[1] >= 2*b[0]
    2*x_0 <= x_1 <= 1
    sage: b[2] >= b[1] >= 2*b[0]
    2*x_0 <= x_1 <= x_2
```




---

archive/issue_comments_136694.json:
```json
{
    "body": "Replying to [comment:26 vbraun]:\n> Patch fixes chained constraints:\nindeed! What about more convoluted cases:\n\n```\nsage: b[0] <= 555/11*b[1] >= 2\n2 <= x_0 <= 555/11*x_1\nsage: b[0] <= 555/11*b[1] == 2\n555/11*x_1 == 2\n```\n\nthe 1st one ought to become 2 inequalities, and the 2nd an inequality and an equation.\nIn both cases, the behaviour is rather strange...\n\nWell, I don't know how easy is to make these work, or at least throw an error.",
    "created_at": "2012-10-26T09:28:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136694",
    "user": "dimpase"
}
```

Replying to [comment:26 vbraun]:
> Patch fixes chained constraints:
indeed! What about more convoluted cases:

```
sage: b[0] <= 555/11*b[1] >= 2
2 <= x_0 <= 555/11*x_1
sage: b[0] <= 555/11*b[1] == 2
555/11*x_1 == 2
```

the 1st one ought to become 2 inequalities, and the 2nd an inequality and an equation.
In both cases, the behaviour is rather strange...

Well, I don't know how easy is to make these work, or at least throw an error.



---

archive/issue_comments_136695.json:
```json
{
    "body": "I agree that it is odd behavior. The whole idea of automatically converting all inequalities into less-or-equal is broken, even before my patch:\n\n```\nsage: (b[0] <= b[1]) >= b[2]\nx_2 <= x_0 <= x_1\n```\n\nInequalities need to remember `>=` vs. `<=` for us to be able to raise an error. The second example is a bug in my patch.",
    "created_at": "2012-10-26T09:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136695",
    "user": "vbraun"
}
```

I agree that it is odd behavior. The whole idea of automatically converting all inequalities into less-or-equal is broken, even before my patch:

```
sage: (b[0] <= b[1]) >= b[2]
x_2 <= x_0 <= x_1
```

Inequalities need to remember `>=` vs. `<=` for us to be able to raise an error. The second example is a bug in my patch.



---

archive/issue_comments_136696.json:
```json
{
    "body": "Replying to [comment:28 vbraun]:\n> I agree that it is odd behavior. The whole idea of automatically converting all inequalities into less-or-equal is broken, even before my patch:\n> {{{\n> sage: (b[0] <= b[1]) >= b[2]\n> x_2 <= x_0 <= x_1\n> }}}\n> Inequalities need to remember `>=` vs. `<=` for us to be able to raise an error. \n\nAnything wrong with having that much more in the inequalities class? \n\nPotentially one would also want to have `<` and `>` and a proper integration with Sage's polyhedra.\n\nYour patch also inspires a grand plan for [linear matrix inequalities](http://en.wikipedia.org/wiki/Linear_matrix_inequality) in Sage...",
    "created_at": "2012-10-26T10:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136696",
    "user": "dimpase"
}
```

Replying to [comment:28 vbraun]:
> I agree that it is odd behavior. The whole idea of automatically converting all inequalities into less-or-equal is broken, even before my patch:
> {{{
> sage: (b[0] <= b[1]) >= b[2]
> x_2 <= x_0 <= x_1
> }}}
> Inequalities need to remember `>=` vs. `<=` for us to be able to raise an error. 

Anything wrong with having that much more in the inequalities class? 

Potentially one would also want to have `<` and `>` and a proper integration with Sage's polyhedra.

Your patch also inspires a grand plan for [linear matrix inequalities](http://en.wikipedia.org/wiki/Linear_matrix_inequality) in Sage...



---

archive/issue_comments_136697.json:
```json
{
    "body": "I think mixed chained inequalities/equalities could be errored out. That would ensure that such obtuse inputs are taken care of.\n\nThe reason for providing chained inequalities is to actually give inequalities in the form `2 <= x[0] <= 3` or `2 >= x[1] >= 1`, instead of having to set them separately. These types of inequalities are quite common to encounter, and it helps the user if the mathematical expressions can be transferred to sage in a straightforward manner.\n\nExamples like `x[0] <= x[1] >= x[2]` or `x[0] <= x[1] == 2` are quite unusual. I have never seen such expressions come up naturally. The first example, for instance, says nothing about the relation between `x[0]` and `x[2]` and hence one would typically never encounter inequations (written) like that.",
    "created_at": "2012-10-26T11:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136697",
    "user": "ppurka"
}
```

I think mixed chained inequalities/equalities could be errored out. That would ensure that such obtuse inputs are taken care of.

The reason for providing chained inequalities is to actually give inequalities in the form `2 <= x[0] <= 3` or `2 >= x[1] >= 1`, instead of having to set them separately. These types of inequalities are quite common to encounter, and it helps the user if the mathematical expressions can be transferred to sage in a straightforward manner.

Examples like `x[0] <= x[1] >= x[2]` or `x[0] <= x[1] == 2` are quite unusual. I have never seen such expressions come up naturally. The first example, for instance, says nothing about the relation between `x[0]` and `x[2]` and hence one would typically never encounter inequations (written) like that.



---

archive/issue_comments_136698.json:
```json
{
    "body": "I agree that one should raise an error. But to be able to do this you must not auto-convert to less-or-equal. And thats definitely doable ;-)",
    "created_at": "2012-10-26T11:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136698",
    "user": "vbraun"
}
```

I agree that one should raise an error. But to be able to do this you must not auto-convert to less-or-equal. And thats definitely doable ;-)



---

archive/issue_comments_136699.json:
```json
{
    "body": "Replying to [comment:31 vbraun]:\n> I agree that one should raise an error. But to be able to do this you must not auto-convert to less-or-equal. And thats definitely doable ;-)\n\nHi Volker, will you work on this? Just to indicate the ticket status right.",
    "created_at": "2012-10-28T06:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136699",
    "user": "dimpase"
}
```

Replying to [comment:31 vbraun]:
> I agree that one should raise an error. But to be able to do this you must not auto-convert to less-or-equal. And thats definitely doable ;-)

Hi Volker, will you work on this? Just to indicate the ticket status right.



---

archive/issue_comments_136700.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2012-10-28T06:51:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136700",
    "user": "dimpase"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_136701.json:
```json
{
    "body": "Probably won't have time to work on this in the next two weeks...",
    "created_at": "2012-10-28T11:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136701",
    "user": "vbraun"
}
```

Probably won't have time to work on this in the next two weeks...



---

archive/issue_comments_136702.json:
```json
{
    "body": "Updated patch",
    "created_at": "2012-11-06T17:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136702",
    "user": "vbraun"
}
```

Updated patch



---

archive/issue_comments_136703.json:
```json
{
    "body": "Attachment [trac_12091_constraints_parents.patch](tarball://root/attachments/some-uuid/ticket12091/trac_12091_constraints_parents.patch) by vbraun created at 2012-11-06 17:41:43\n\nI've removed the \"cdef double c\" in `show()`, so the following works:\n\n```\n            sage: p = MixedIntegerLinearProgram(solver= 'ppl')\n            sage: x = p.new_variable()\n            sage: p.set_objective(x[1] + 1/2*x[2])\n            sage: p.add_constraint(-3/5*x[1] + 2/7*x[2], max=2/5)\n            sage: p.show()\n            Maximization:\n              x_0 + 1/2 x_1\n            Constraints:\n              constraint_0: -3/5 x_0 + 2/7 x_1 <= 2/5\n            Variables:\n              x_0 is a continuous variable (min=0, max=+oo)\n              x_1 is a continuous variable (min=0, max=+oo)\n```\n",
    "created_at": "2012-11-06T17:41:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136703",
    "user": "vbraun"
}
```

Attachment [trac_12091_constraints_parents.patch](tarball://root/attachments/some-uuid/ticket12091/trac_12091_constraints_parents.patch) by vbraun created at 2012-11-06 17:41:43

I've removed the "cdef double c" in `show()`, so the following works:

```
            sage: p = MixedIntegerLinearProgram(solver= 'ppl')
            sage: x = p.new_variable()
            sage: p.set_objective(x[1] + 1/2*x[2])
            sage: p.add_constraint(-3/5*x[1] + 2/7*x[2], max=2/5)
            sage: p.show()
            Maximization:
              x_0 + 1/2 x_1
            Constraints:
              constraint_0: -3/5 x_0 + 2/7 x_1 <= 2/5
            Variables:
              x_0 is a continuous variable (min=0, max=+oo)
              x_1 is a continuous variable (min=0, max=+oo)
```




---

archive/issue_comments_136704.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2012-11-08T15:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136704",
    "user": "dimpase"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_136705.json:
```json
{
    "body": "As far as I am concerned, better parsing of things like `x[0] <= x[1] >= x[2]` or `x[0] <= x[1] == 2` can wait till another ticket.",
    "created_at": "2012-11-08T15:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136705",
    "user": "dimpase"
}
```

As far as I am concerned, better parsing of things like `x[0] <= x[1] >= x[2]` or `x[0] <= x[1] == 2` can wait till another ticket.



---

archive/issue_comments_136706.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-11-08T15:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136706",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136707.json:
```json
{
    "body": "Fair enough but can you make another ticket about invalid combinations? Otherwise its too easy to forget ;-)",
    "created_at": "2012-11-09T15:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136707",
    "user": "vbraun"
}
```

Fair enough but can you make another ticket about invalid combinations? Otherwise its too easy to forget ;-)



---

archive/issue_comments_136708.json:
```json
{
    "body": "Replying to [comment:39 vbraun]:\n> Fair enough but can you make another ticket about invalid combinations? Otherwise its too easy to forget ;-)\nSure! Please see #13696.",
    "created_at": "2012-11-10T11:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136708",
    "user": "dimpase"
}
```

Replying to [comment:39 vbraun]:
> Fair enough but can you make another ticket about invalid combinations? Otherwise its too easy to forget ;-)
Sure! Please see #13696.



---

archive/issue_comments_136709.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-11-17T08:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11919",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11919#issuecomment-136709",
    "user": "jdemeyer"
}
```

Resolution: fixed
