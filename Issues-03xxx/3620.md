# Issue 3620: [with patch; positive review]  minpoly absurdly slow for elements of finte fields

archive/issues_003620.json:
```json
{
    "body": "\n```\nIt goes via pari calls, rather than invoking ntl directly. \n\ne.g., computing the minpoly of a random element in GF(2^300)\ntakes about  a minute in sage and a second in Magma.  It's slow\nbecause PARI is really really slow.  Just getting the matrix and\nasking for its charpoly is vastly vaster in sage already, so doing\nthat would be a good first step. \n```\n\nAssignee: tbd\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/3620\n\n",
    "closed_at": "2008-07-10T10:04:37Z",
    "created_at": "2008-07-09T00:03:58Z",
    "labels": [
        "component: algebra",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.0.4",
    "title": "[with patch; positive review]  minpoly absurdly slow for elements of finte fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/3620",
    "user": "https://github.com/robertwb"
}
```

```
It goes via pari calls, rather than invoking ntl directly. 

e.g., computing the minpoly of a random element in GF(2^300)
takes about  a minute in sage and a second in Magma.  It's slow
because PARI is really really slow.  Just getting the matrix and
asking for its charpoly is vastly vaster in sage already, so doing
that would be a good first step. 
```

Assignee: tbd

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/3620





---

archive/issue_events_008305.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-07-09T00:49:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "milestone": "sage-3.0.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3620#event-8305"
}
```



---

archive/issue_comments_027599.json:
```json
{
    "body": "<a id='comment:1'></a>\nBut note, we may want to use our own implementation since minpoly and charpoly of *matrices* over finite fields in sage is so fast.",
    "created_at": "2008-07-09T00:49:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27599",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:1'></a>
But note, we may want to use our own implementation since minpoly and charpoly of *matrices* over finite fields in sage is so fast.



---

archive/issue_comments_027600.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,6 @@\n It goes via pari calls, rather than invoking ntl directly. \n+\n+e.g., computing the minpoly of a random element in GF(2^300)\n+takes about  a minute in sage and a second in Magma.  It's slow\n+because PARI is really really slow.  Just getting the matrix and\n+asking for its charpoly is vastly vaster in sage already, so doing that would be a good first step. \n``````\n",
    "created_at": "2008-07-09T00:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27600",
    "user": "https://github.com/williamstein"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,6 @@
 It goes via pari calls, rather than invoking ntl directly. 
+
+e.g., computing the minpoly of a random element in GF(2^300)
+takes about  a minute in sage and a second in Magma.  It's slow
+because PARI is really really slow.  Just getting the matrix and
+asking for its charpoly is vastly vaster in sage already, so doing that would be a good first step. 
``````




---

archive/issue_comments_027601.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n+\n+```\n It goes via pari calls, rather than invoking ntl directly. \n \n e.g., computing the minpoly of a random element in GF(2^300)\n takes about  a minute in sage and a second in Magma.  It's slow\n because PARI is really really slow.  Just getting the matrix and\n asking for its charpoly is vastly vaster in sage already, so doing that would be a good first step. \n+```\n``````\n",
    "created_at": "2008-07-09T00:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27601",
    "user": "https://github.com/mwhansen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
+
+```
 It goes via pari calls, rather than invoking ntl directly. 
 
 e.g., computing the minpoly of a random element in GF(2^300)
 takes about  a minute in sage and a second in Magma.  It's slow
 because PARI is really really slow.  Just getting the matrix and
 asking for its charpoly is vastly vaster in sage already, so doing that would be a good first step. 
+```
``````




---

archive/issue_comments_027602.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,5 +5,6 @@\n e.g., computing the minpoly of a random element in GF(2^300)\n takes about  a minute in sage and a second in Magma.  It's slow\n because PARI is really really slow.  Just getting the matrix and\n-asking for its charpoly is vastly vaster in sage already, so doing that would be a good first step. \n+asking for its charpoly is vastly vaster in sage already, so doing\n+that would be a good first step. \n ```\n``````\n",
    "created_at": "2008-07-09T00:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27602",
    "user": "https://github.com/mwhansen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,5 +5,6 @@
 e.g., computing the minpoly of a random element in GF(2^300)
 takes about  a minute in sage and a second in Magma.  It's slow
 because PARI is really really slow.  Just getting the matrix and
-asking for its charpoly is vastly vaster in sage already, so doing that would be a good first step. 
+asking for its charpoly is vastly vaster in sage already, so doing
+that would be a good first step. 
 ```
``````




---

archive/issue_comments_027603.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2008-07-09T18:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27603",
    "user": "https://github.com/williamstein"
}
```

Changing priority from major to blocker.



---

archive/issue_events_008306.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-07-09T18:46:04Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "milestone": "sage-3.0.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3620#event-8306"
}
```



---

archive/issue_events_008307.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-07-09T18:46:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "milestone": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3620#event-8307"
}
```



---

archive/issue_comments_027604.json:
```json
{
    "body": "<a id='comment:6'></a>\nHere is an example that illustrates the difference:\n\n```\nsage: k.<a> = GF(2^100)\nsage: time g = k.random_element().charpoly()\nCPU times: user 1.17 s, sys: 0.02 s, total: 1.18 s\nWall time: 1.36 s\nsage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^100)));')\n'Time: 0.000'\n```\n\nHere's the sage code that does the charpoly computation:\n\n```\nsage: a.charpoly??\n        from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing\n        R = PolynomialRing(self.parent().prime_subfield(), var)\n        return R(self._pari_().charpoly('x').lift())\n```\n\nIt turns out that pari is just totally abysmal at computing charpolys of Mod's.\n\n```\nsage: f = k.random_element()._pari_()\nsage: time g = f.charpoly('x')\nCPU times: user 1.13 s, sys: 0.01 s, total: 1.14 s\nWall time: 1.26 s\nsage: f.type()\n't_POLMOD'\n```\n\nFortunately Sage matrices aren't quite as bad, though of course this is still vastly\nslower than Magma:\n\n```\nsage: time g = k.random_element().matrix().charpoly()\nCPU times: user 0.36 s, sys: 0.00 s, total: 0.36 s\nWall time: 0.37 s\n\n```\n\nAsymptotically though this is still vastly better than the current situation:\n\n```\nage: k.<a> = GF(2^200)\nsage: time g = k.random_element().matrix().charpoly()\nCPU times: user 2.21 s, sys: 0.03 s, total: 2.24 s\nWall time: 2.24 s\nsage: time g = k.random_element().charpoly()\nCPU times: user 14.14 s, sys: 0.08 s, total: 14.22 s\nWall time: 14.27 s\n```\n\nBut still this sucks compared to magma\n\n```\nsage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^200)));')\n'Time: 0.000'\nsage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^200)));')\n'Time: 0.000'\nsage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^300)));')\n'Time: 0.000'\nsage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^400)));')\n'Time: 0.010'\nsage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^600)));')\n'Time: 0.010'\nsage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^1000)));')\n'Time: 0.030'\n```\n\nI looked at NTL seems to have no functions at all for charpoly or minpoly\nof elements of GF(2^n).  :-(\n\nhttp://www.shoup.net/ntl/doc/GF2E.txt",
    "created_at": "2008-07-09T19:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27604",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:6'></a>
Here is an example that illustrates the difference:

```
sage: k.<a> = GF(2^100)
sage: time g = k.random_element().charpoly()
CPU times: user 1.17 s, sys: 0.02 s, total: 1.18 s
Wall time: 1.36 s
sage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^100)));')
'Time: 0.000'
```

Here's the sage code that does the charpoly computation:

```
sage: a.charpoly??
        from sage.rings.polynomial.polynomial_ring_constructor import PolynomialRing
        R = PolynomialRing(self.parent().prime_subfield(), var)
        return R(self._pari_().charpoly('x').lift())
```

It turns out that pari is just totally abysmal at computing charpolys of Mod's.

```
sage: f = k.random_element()._pari_()
sage: time g = f.charpoly('x')
CPU times: user 1.13 s, sys: 0.01 s, total: 1.14 s
Wall time: 1.26 s
sage: f.type()
't_POLMOD'
```

Fortunately Sage matrices aren't quite as bad, though of course this is still vastly
slower than Magma:

```
sage: time g = k.random_element().matrix().charpoly()
CPU times: user 0.36 s, sys: 0.00 s, total: 0.36 s
Wall time: 0.37 s

```

Asymptotically though this is still vastly better than the current situation:

```
age: k.<a> = GF(2^200)
sage: time g = k.random_element().matrix().charpoly()
CPU times: user 2.21 s, sys: 0.03 s, total: 2.24 s
Wall time: 2.24 s
sage: time g = k.random_element().charpoly()
CPU times: user 14.14 s, sys: 0.08 s, total: 14.22 s
Wall time: 14.27 s
```

But still this sucks compared to magma

```
sage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^200)));')
'Time: 0.000'
sage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^200)));')
'Time: 0.000'
sage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^300)));')
'Time: 0.000'
sage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^400)));')
'Time: 0.010'
sage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^600)));')
'Time: 0.010'
sage: magma.eval('time f := CharacteristicPolynomial(Random(GF(2^1000)));')
'Time: 0.030'
```

I looked at NTL seems to have no functions at all for charpoly or minpoly
of elements of GF(2^n).  :-(

http://www.shoup.net/ntl/doc/GF2E.txt



---

archive/issue_comments_027605.json:
```json
{
    "body": "<a id='comment:7'></a>\nalso note:\n\n```\nsage: k.<a> = GF(2^500)\nsage: time g = k.random_element()\nCPU times: user 0.06 s, sys: 0.00 s, total: 0.06 s\nWall time: 0.06 s\nsage: time m = g.matrix()\nCPU times: user 11.59 s, sys: 0.82 s, total: 12.41 s\nWall time: 12.41 s\nsage: time f = m.charpoly()\nCPU times: user 20.51 s, sys: 0.01 s, total: 20.52 s\nWall time: 20.51 s\n```",
    "created_at": "2008-07-09T19:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27605",
    "user": "https://trac.sagemath.org/admin/accounts/users/dmharvey"
}
```

<a id='comment:7'></a>
also note:

```
sage: k.<a> = GF(2^500)
sage: time g = k.random_element()
CPU times: user 0.06 s, sys: 0.00 s, total: 0.06 s
Wall time: 0.06 s
sage: time m = g.matrix()
CPU times: user 11.59 s, sys: 0.82 s, total: 12.41 s
Wall time: 12.41 s
sage: time f = m.charpoly()
CPU times: user 20.51 s, sys: 0.01 s, total: 20.52 s
Wall time: 20.51 s
```



---

archive/issue_comments_027606.json:
```json
{
    "body": "Attachment [sage-3620.patch](tarball://root/attachments/some-uuid/ticket3620/sage-3620.patch) by @williamstein created at 2008-07-09 19:53:25",
    "created_at": "2008-07-09T19:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27606",
    "user": "https://github.com/williamstein"
}
```

Attachment [sage-3620.patch](tarball://root/attachments/some-uuid/ticket3620/sage-3620.patch) by @williamstein created at 2008-07-09 19:53:25



---

archive/issue_comments_027607.json:
```json
{
    "body": "<a id='comment:9'></a>\n1. dmharvey -- i have no clue what the point of your remark is above.\n\n2. the point of my patch, by the way, is just to be a first tiny step.",
    "created_at": "2008-07-09T19:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27607",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>
1. dmharvey -- i have no clue what the point of your remark is above.

2. the point of my patch, by the way, is just to be a first tiny step.



---

archive/issue_comments_027608.json:
```json
{
    "body": "<a id='comment:10'></a>\nLooks good to me.  Should there be another ticket for improving this further.",
    "created_at": "2008-07-09T20:12:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27608",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:10'></a>
Looks good to me.  Should there be another ticket for improving this further.



---

archive/issue_comments_027609.json:
```json
{
    "body": "<a id='comment:11'></a>\nMy point is just that computing the matrix and computing its charpoly both take non-negligble time.",
    "created_at": "2008-07-09T20:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27609",
    "user": "https://trac.sagemath.org/admin/accounts/users/dmharvey"
}
```

<a id='comment:11'></a>
My point is just that computing the matrix and computing its charpoly both take non-negligble time.



---

archive/issue_comments_027610.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2008-07-10T02:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27610",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_events_008308.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-07-10T02:01:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3620#event-8308"
}
```



---

archive/issue_comments_027611.json:
```json
{
    "body": "<a id='comment:12'></a>\nMerged in Sage 3.0.4.rc3",
    "created_at": "2008-07-10T02:01:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27611",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:12'></a>
Merged in Sage 3.0.4.rc3



---

archive/issue_comments_027612.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2008-07-10T06:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27612",
    "user": "https://github.com/robertwb"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_027613.json:
```json
{
    "body": "Changing status from closed to reopened.",
    "created_at": "2008-07-10T06:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27613",
    "user": "https://github.com/robertwb"
}
```

Changing status from closed to reopened.



---

archive/issue_events_008309.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-07-10T06:47:42Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3620#event-8309"
}
```



---

archive/issue_comments_027614.json:
```json
{
    "body": "<a id='comment:13'></a>\nIt looks like NTL does have minimal polynomial computations, though provided in http://www.shoup.net/ntl/doc/GF2X.txt rather than http://www.shoup.net/ntl/doc/GF2E.txt . We should probably use the proof flag to decide the algorithm. Trace could be wrapped as well. \n\nAlso, the computation of matrix() is using the completely generic code, which has got to be sub-optimal for manipulating elements of GF(2).",
    "created_at": "2008-07-10T06:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27614",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:13'></a>
It looks like NTL does have minimal polynomial computations, though provided in http://www.shoup.net/ntl/doc/GF2X.txt rather than http://www.shoup.net/ntl/doc/GF2E.txt . We should probably use the proof flag to decide the algorithm. Trace could be wrapped as well. 

Also, the computation of matrix() is using the completely generic code, which has got to be sub-optimal for manipulating elements of GF(2).



---

archive/issue_comments_027615.json:
```json
{
    "body": "<a id='comment:14'></a>\nRobert,\n\nI see no reason to reason to reopen this ticket since what you describe seems to be an improvement/additional change. Please open another ticket since the attached patch has been merged in Sage 3.0.4.\n\nCheers,\n\nMichael",
    "created_at": "2008-07-10T10:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27615",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:14'></a>
Robert,

I see no reason to reason to reopen this ticket since what you describe seems to be an improvement/additional change. Please open another ticket since the attached patch has been merged in Sage 3.0.4.

Cheers,

Michael



---

archive/issue_comments_027616.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2008-07-10T10:04:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3620#issuecomment-27616",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_events_008310.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-07-10T10:04:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/3620",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3620#event-8310"
}
```
