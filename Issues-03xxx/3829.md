# Issue 3829: wester.py disagrees with Wester!!!

archive/issues_003829.json:
```json
{
    "body": "\n```\nsage: # (YES) Ln(Tan(x/2+Pi/4))-ArcSinh(Tan(x))=0\nsage: # Yes, in that the thing is clearly not equal to 0!\nsage: f = log(tan(x/2 + pi/4)) - arcsin(tan(x))\nsage: bool(f == 0)\nFalse\n```\n\nThe problem with this doctest is actually quite simple:\n\n```\nArcSinh != arcsin\n```\n\nAAARRRRGGGHGHHHHH!!!!!!\n\nBut the proof was fun...\n\n**Assignee:** @garyfurnish\n\n**Author:** Burcin Erocal\n\n**Reviewer:** Alex Ghitza\n\n**Merged:** 4.0.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/3829\n\n",
    "closed_at": "2009-06-13T20:33:12Z",
    "created_at": "2008-08-13T00:51:01Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.0.2",
    "title": "wester.py disagrees with Wester!!!",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/3829",
    "user": "https://github.com/rlmill"
}
```

```
sage: # (YES) Ln(Tan(x/2+Pi/4))-ArcSinh(Tan(x))=0
sage: # Yes, in that the thing is clearly not equal to 0!
sage: f = log(tan(x/2 + pi/4)) - arcsin(tan(x))
sage: bool(f == 0)
False
```

The problem with this doctest is actually quite simple:

```
ArcSinh != arcsin
```

AAARRRRGGGHGHHHHH!!!!!!

But the proof was fun...

**Assignee:** @garyfurnish

**Author:** Burcin Erocal

**Reviewer:** Alex Ghitza

**Merged:** 4.0.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/3829





---

archive/issue_events_022182.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-13T02:48:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "milestone": "sage-3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22182"
}
```



---

archive/issue_comments_022498.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,8 +1,18 @@\n \n ```\n+sage: # (YES) Ln(Tan(x/2+Pi/4))-ArcSinh(Tan(x))=0\n+sage: # Yes, in that the thing is clearly not equal to 0!\n sage: f = log(tan(x/2 + pi/4)) - arcsin(tan(x))\n sage: bool(f == 0)\n False\n ```\n \n-This just plain disagrees with Wester's benchmarks. The function is identically zero. I'm going to go through `wester.py` and check to see if there are any more...\n+The problem with this doctest is actually quite simple:\n+\n+```\n+ArcSinh != arcsin\n+```\n+\n+AAARRRRGGGHGHHHHH!!!!!!\n+\n+But the proof was fun...\n``````\n",
    "created_at": "2008-08-13T03:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22498",
    "user": "https://github.com/rlmill"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,8 +1,18 @@
 
 ```
+sage: # (YES) Ln(Tan(x/2+Pi/4))-ArcSinh(Tan(x))=0
+sage: # Yes, in that the thing is clearly not equal to 0!
 sage: f = log(tan(x/2 + pi/4)) - arcsin(tan(x))
 sage: bool(f == 0)
 False
 ```
 
-This just plain disagrees with Wester's benchmarks. The function is identically zero. I'm going to go through `wester.py` and check to see if there are any more...
+The problem with this doctest is actually quite simple:
+
+```
+ArcSinh != arcsin
+```
+
+AAARRRRGGGHGHHHHH!!!!!!
+
+But the proof was fun...
``````




---

archive/issue_comments_022499.json:
```json
{
    "body": "<a id='comment:3'></a>\nBut, we *still* have bool(...) False, so all the above comments apply.\n\n```\nsage: # (YES) Ln(Tan(x/2+Pi/4))-ArcSinh(Tan(x))=0\nsage: # Yes, in that the thing is clearly not equal to 0!\nsage: f = log(tan(x/2 + pi/4)) - arcsinh(tan(x))\nsage: bool(f == 0)\nFalse\n```\n\nAnd there should be a patch attached to this ticket that fixes the doctest to have an h, and also \ndoes not put (YES) in the comment.     \n\nThe reason the above is unfortunately not a Sage bug is that in Maxima bool(...) only returns True when its algorithm can definitely prove Truth, and not otherwise.  And that's documented.",
    "created_at": "2008-08-13T03:56:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22499",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>
But, we *still* have bool(...) False, so all the above comments apply.

```
sage: # (YES) Ln(Tan(x/2+Pi/4))-ArcSinh(Tan(x))=0
sage: # Yes, in that the thing is clearly not equal to 0!
sage: f = log(tan(x/2 + pi/4)) - arcsinh(tan(x))
sage: bool(f == 0)
False
```

And there should be a patch attached to this ticket that fixes the doctest to have an h, and also 
does not put (YES) in the comment.     

The reason the above is unfortunately not a Sage bug is that in Maxima bool(...) only returns True when its algorithm can definitely prove Truth, and not otherwise.  And that's documented.



---

archive/attachments_003957.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_3829-wester.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket3829/trac_3829-wester.patch",
    "created_at": "2009-02-08T14:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/burcin"
}
```



---

archive/issue_comments_022500.json:
```json
{
    "body": "",
    "created_at": "2009-02-08T14:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22500",
    "user": "https://github.com/burcin"
}
```





---

archive/issue_comments_022501.json:
```json
{
    "body": "<a id='comment:4'></a>\nattachment:trac_3829-wester.patch fixes the typo.\n\nI am not sure how to handle the new results of evaluating the function f. I pasted the new values obtained on my laptop. If they vary on different platforms, we could replace that line with a test that they are < 1e-10.",
    "created_at": "2009-02-08T15:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22501",
    "user": "https://github.com/burcin"
}
```

<a id='comment:4'></a>
attachment:trac_3829-wester.patch fixes the typo.

I am not sure how to handle the new results of evaluating the function f. I pasted the new values obtained on my laptop. If they vary on different platforms, we could replace that line with a test that they are < 1e-10.



---

archive/issue_events_022183.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-02-08T15:02:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22183"
}
```



---

archive/issue_events_022184.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-02-09T16:06:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22184"
}
```



---

archive/issue_events_022185.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-02-09T16:06:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22185"
}
```



---

archive/issue_comments_022502.json:
```json
{
    "body": "<a id='comment:5'></a>\nHaving `(NO)` in the comment is worse, because the identity is true! What should be there is a short explanation of why `bool(f == 0)` returns False, even though we know it is true.",
    "created_at": "2009-02-09T16:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22502",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:5'></a>
Having `(NO)` in the comment is worse, because the identity is true! What should be there is a short explanation of why `bool(f == 0)` returns False, even though we know it is true.



---

archive/attachments_003958.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_3829-wester.take2.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket3829/trac_3829-wester.take2.patch",
    "created_at": "2009-02-09T16:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/burcin"
}
```



---

archive/issue_comments_022503.json:
```json
{
    "body": "",
    "created_at": "2009-02-09T16:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22503",
    "user": "https://github.com/burcin"
}
```





---

archive/issue_comments_022504.json:
```json
{
    "body": "<a id='comment:6'></a>\nI thought the (NO) in the comments indicates that Sage does not give the answer Wester says it should.\n\nI added a comment explaning the Sage/Maxima policy on equality of symbolic expressions.",
    "created_at": "2009-02-09T16:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22504",
    "user": "https://github.com/burcin"
}
```

<a id='comment:6'></a>
I thought the (NO) in the comments indicates that Sage does not give the answer Wester says it should.

I added a comment explaning the Sage/Maxima policy on equality of symbolic expressions.



---

archive/issue_events_022186.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-02-09T16:56:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22186"
}
```



---

archive/issue_events_022187.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2009-02-09T16:56:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22187"
}
```



---

archive/issue_events_022188.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-02-09T17:09:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22188"
}
```



---

archive/issue_events_022189.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-02-09T17:09:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22189"
}
```



---

archive/issue_comments_022505.json:
```json
{
    "body": "<a id='comment:8'></a>\nWhy should this be considered true? The equality clearly doesn't hold for all x. Try for example evaluating numerically with x = 3.\n\nOr is some nonstandard branch cut convention implied here?",
    "created_at": "2009-02-10T15:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22505",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:8'></a>
Why should this be considered true? The equality clearly doesn't hold for all x. Try for example evaluating numerically with x = 3.

Or is some nonstandard branch cut convention implied here?



---

archive/issue_comments_022506.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [fredrik.johansson](#comment%3A8):\n> Why should this be considered true? The equality clearly doesn't hold for all x. Try for example evaluating numerically with x = 3.\n> \n> Or is some nonstandard branch cut convention implied here?\n\n\nFredrik,\n\nI spent quite some time convincing myself that that identity is true. The proof is attached as PDF. You must be able to take the logarithm of `tan(x/2 + pi/4)` in order for the identity to make sense, but for any branch you take where it makes sense it is true. The problem with evaluating numerically at `x = 3` is that symbolic log doesn't like negative numbers, and `tan(3/2 + pi/4) = -1.15265520898227` so it returns a `NaN`.",
    "created_at": "2009-02-10T16:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22506",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:9'></a>
Replying to [fredrik.johansson](#comment%3A8):
> Why should this be considered true? The equality clearly doesn't hold for all x. Try for example evaluating numerically with x = 3.
> 
> Or is some nonstandard branch cut convention implied here?


Fredrik,

I spent quite some time convincing myself that that identity is true. The proof is attached as PDF. You must be able to take the logarithm of `tan(x/2 + pi/4)` in order for the identity to make sense, but for any branch you take where it makes sense it is true. The problem with evaluating numerically at `x = 3` is that symbolic log doesn't like negative numbers, and `tan(3/2 + pi/4) = -1.15265520898227` so it returns a `NaN`.



---

archive/issue_comments_022507.json:
```json
{
    "body": "<a id='comment:10'></a>\nOoops, unfortunately this patch has bitrotted: \n\n```\nsage-3.4.1.rc3/devel/sage$ patch -p1 --dry-run < trac_3829-wester.take2.patch \npatching file sage/calculus/wester.py\nHunk #1 FAILED at 253.\n1 out of 1 hunk FAILED -- saving rejects to file sage/calculus/wester.py.rej\n```\nI was paranoid about merging this since it potentially introduces numerical noise and I thought that 3.4.1 was about done for the last couple weeks, so sorry about that.\n\nCheers,\n\nMichael",
    "created_at": "2009-04-13T02:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22507",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:10'></a>
Ooops, unfortunately this patch has bitrotted: 

```
sage-3.4.1.rc3/devel/sage$ patch -p1 --dry-run < trac_3829-wester.take2.patch 
patching file sage/calculus/wester.py
Hunk #1 FAILED at 253.
1 out of 1 hunk FAILED -- saving rejects to file sage/calculus/wester.py.rej
```
I was paranoid about merging this since it potentially introduces numerical noise and I thought that 3.4.1 was about done for the last couple weeks, so sorry about that.

Cheers,

Michael



---

archive/issue_events_022190.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2009-04-13T02:30:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "rename": {
        "from": "wester.py disagrees with Wester!!!",
        "to": "[needs rebase] wester.py disagrees with Wester!!!"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22190"
}
```



---

archive/issue_comments_022508.json:
```json
{
    "body": "<a id='comment:11'></a>\nApply only `trac_3829-rebased.patch`, which is rebased against 4.0.",
    "created_at": "2009-05-31T13:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22508",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:11'></a>
Apply only `trac_3829-rebased.patch`, which is rebased against 4.0.



---

archive/issue_events_022191.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-05-31T13:44:34Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "rename": {
        "from": "[needs rebase] wester.py disagrees with Wester!!!",
        "to": "wester.py disagrees with Wester!!!"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22191"
}
```



---

archive/attachments_003959.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "trac_3829-rebased.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket3829/trac_3829-rebased.patch",
    "created_at": "2009-05-31T13:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/aghitza"
}
```



---

archive/issue_comments_022509.json:
```json
{
    "body": "rebased against 4.0",
    "created_at": "2009-05-31T13:46:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22509",
    "user": "https://github.com/aghitza"
}
```

rebased against 4.0



---

archive/issue_comments_022510.json:
```json
{
    "body": "**Merged:** 4.0.2.alpha0",
    "created_at": "2009-06-13T20:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22510",
    "user": "https://github.com/ncalexan"
}
```

**Merged:** 4.0.2.alpha0



---

archive/issue_comments_022511.json:
```json
{
    "body": "**Author:** Burcin Erocal",
    "created_at": "2009-06-13T20:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22511",
    "user": "https://github.com/ncalexan"
}
```

**Author:** Burcin Erocal



---

archive/issue_events_022192.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T20:33:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22192"
}
```



---

archive/issue_events_022193.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-13T20:33:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3829#event-22193"
}
```



---

archive/issue_comments_022512.json:
```json
{
    "body": "**Reviewer:** Alex Ghitza",
    "created_at": "2009-06-13T20:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3829",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3829#issuecomment-22512",
    "user": "https://github.com/ncalexan"
}
```

**Reviewer:** Alex Ghitza
