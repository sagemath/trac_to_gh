# Issue 3416: Weierstrass form and Jacobian for cubics and certain other genus-one curves

archive/issues_003416.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "Implement transformations to put a general cubic (with a point) into Weierstrass form:\n\n```\nsage: R.<u,v,w> = QQ[]\nsage: EllipticCurve(u^3+v^3+w^3, [1,-1,0])   \nElliptic Curve defined by y^2 + 2*x*y - 1/3*y = x^3 - x^2 + 1/3*x - 1/27 over Rational Field\nsage: EllipticCurve_from_cubic(u^3+v^3+w^3, [1,-1,0])\nScheme morphism:\n  From: Closed subscheme of Projective Space of dimension 2 over Rational Field defined by:\n  u^3 + v^3 + w^3\n  To:   Elliptic Curve defined by y^2 + 2*x*y - 1/3*y = x^3 - x^2 + 1/3*x - 1/27 over Rational Field\n  Defn: Defined on coordinates by sending (u : v : w) to\n        (w : -v - w : -3*u - 3*v)\n```\nAlso, Jacobians (without specifying point):\n\n```\nsage: R.<u,v,w> = QQ[]\nsage: Jacobian(u^3+v^3+w^3)\nElliptic Curve defined by y^2 = x^3 - 27/4 over Rational Field\nsage: Jacobian(u^3+v^3+w^3, morphism=True)\nScheme morphism:\n  From: Projective Curve over Rational Field defined by u^3 + v^3 + w^3\n  To:   Elliptic Curve defined by y^2 = x^3 - 27/4 over Rational Field\n  Defn: Defined on coordinates by sending (u : v : w) to\n        (u*v^7*w + u*v^4*w^4 + u*v*w^7 : v^9 + 3/2*v^6*w^3 - 3/2*v^3*w^6 - w^9 : -v^6*w^3 - v^3*w^6)\n```\n\n\nApply:\n\n* [attachment: trac_3416_elliptic_curve_from_cubic_vb.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)\n* [attachment: trac_3416_jacobians.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)\n* [attachment: trac_3416_fixes.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_fixes.patch.gz)\n* [attachment: trac_3416_magma.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_magma.patch.gz)\n\nSee [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.\n\nDepends on #12553\nDepends on #13084\nDepends on #13458\n\nCC:  @novoselt\n\nKeywords: **nagell, weierstrass, cubic, editor_wstein**\n\nReviewer: **John Cremona, Marco Streng, Nils Bruin**\n\nAuthor: **Niels Duif, Volker Braun**\n\nMerged: **sage-5.12.beta3**\n\nComponent: **elliptic curves**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/3416_\n\n",
    "closed_at": "2013-08-20T12:58:04Z",
    "created_at": "2008-06-13T16:19:39Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-5.12",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Weierstrass form and Jacobian for cubics and certain other genus-one curves",
    "type": "issue",
    "updated_at": "2013-10-28T19:54:29Z",
    "url": "https://github.com/sagemath/sage/issues/3416",
    "user": "https://github.com/bobmoretti"
}
```
Implement transformations to put a general cubic (with a point) into Weierstrass form:

```
sage: R.<u,v,w> = QQ[]
sage: EllipticCurve(u^3+v^3+w^3, [1,-1,0])   
Elliptic Curve defined by y^2 + 2*x*y - 1/3*y = x^3 - x^2 + 1/3*x - 1/27 over Rational Field
sage: EllipticCurve_from_cubic(u^3+v^3+w^3, [1,-1,0])
Scheme morphism:
  From: Closed subscheme of Projective Space of dimension 2 over Rational Field defined by:
  u^3 + v^3 + w^3
  To:   Elliptic Curve defined by y^2 + 2*x*y - 1/3*y = x^3 - x^2 + 1/3*x - 1/27 over Rational Field
  Defn: Defined on coordinates by sending (u : v : w) to
        (w : -v - w : -3*u - 3*v)
```
Also, Jacobians (without specifying point):

```
sage: R.<u,v,w> = QQ[]
sage: Jacobian(u^3+v^3+w^3)
Elliptic Curve defined by y^2 = x^3 - 27/4 over Rational Field
sage: Jacobian(u^3+v^3+w^3, morphism=True)
Scheme morphism:
  From: Projective Curve over Rational Field defined by u^3 + v^3 + w^3
  To:   Elliptic Curve defined by y^2 = x^3 - 27/4 over Rational Field
  Defn: Defined on coordinates by sending (u : v : w) to
        (u*v^7*w + u*v^4*w^4 + u*v*w^7 : v^9 + 3/2*v^6*w^3 - 3/2*v^3*w^6 - w^9 : -v^6*w^3 - v^3*w^6)
```


Apply:

* [attachment: trac_3416_elliptic_curve_from_cubic_vb.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)
* [attachment: trac_3416_jacobians.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)
* [attachment: trac_3416_fixes.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_fixes.patch.gz)
* [attachment: trac_3416_magma.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_magma.patch.gz)

See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.

Depends on #12553
Depends on #13084
Depends on #13458

CC:  @novoselt

Keywords: **nagell, weierstrass, cubic, editor_wstein**

Reviewer: **John Cremona, Marco Streng, Nils Bruin**

Author: **Niels Duif, Volker Braun**

Merged: **sage-5.12.beta3**

Component: **elliptic curves**

_Issue created by migration from https://trac.sagemath.org/ticket/3416_





---

archive/issue_events_036733.json:
```json
{
    "actor": "https://github.com/bobmoretti",
    "created_at": "2008-06-13T16:19:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36733"
}
```



---

archive/issue_events_036734.json:
```json
{
    "actor": "https://github.com/bobmoretti",
    "created_at": "2008-06-13T16:19:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36734"
}
```



---

archive/issue_events_036735.json:
```json
{
    "actor": "https://github.com/bobmoretti",
    "created_at": "2008-06-13T16:19:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36735"
}
```



---

archive/issue_events_036736.json:
```json
{
    "actor": "https://github.com/bobmoretti",
    "created_at": "2008-06-13T16:19:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36736"
}
```



---

archive/issue_events_036737.json:
```json
{
    "actor": "https://github.com/bobmoretti",
    "created_at": "2008-06-13T16:19:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "c: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36737"
}
```



---

archive/issue_events_036738.json:
```json
{
    "actor": "https://github.com/bobmoretti",
    "created_at": "2008-06-13T16:19:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36738"
}
```



---

archive/issue_events_036739.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-13T16:19:39Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "subject": "https://github.com/bobmoretti",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36739"
}
```



---

archive/issue_comments_018403.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[weier.patch.gz](https://github.com/sagemath/sage/files/ticket3416/weier.patch.gz)**\n\nSince y^2 = quartic is also genus 1, I'm curious if there is a corresponding function planned to compute the Weierstrass form of a quartic hyperelliptic.",
    "created_at": "2008-06-13T17:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18403",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[weier.patch.gz](https://github.com/sagemath/sage/files/ticket3416/weier.patch.gz)**

Since y^2 = quartic is also genus 1, I'm curious if there is a corresponding function planned to compute the Weierstrass form of a quartic hyperelliptic.



---

archive/issue_comments_018404.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nYou can't give your own code a negative review :-).  I changed it to \"not ready for review\".",
    "created_at": "2008-06-13T22:21:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18404",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:2" align="right">comment:2</div>

You can't give your own code a negative review :-).  I changed it to "not ready for review".



---

archive/issue_events_036740.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-13T22:21:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "title_is": "[not ready for review] Weierstrass form for cubics",
    "title_was": "Weierstrass form for cubics [with patch, with negative review]",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36740"
}
```



---

archive/issue_comments_018405.json:
```json
{
    "body": "Changed keywords from **nagell, weierstrass, cubic** to **nagell, weierstrass, cubic, editor_wstein**",
    "created_at": "2008-06-20T05:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18405",
    "user": "https://github.com/craigcitro"
}
```

Changed keywords from **nagell, weierstrass, cubic** to **nagell, weierstrass, cubic, editor_wstein**



---

archive/issue_comments_018406.json:
```json
{
    "body": "Attachment: **[Weierstrass.sage.gz](https://github.com/sagemath/sage/files/ticket3416/Weierstrass.sage.gz)**\n\nAlgorithm 7.4.10 of GTM 138",
    "created_at": "2009-04-30T22:06:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18406",
    "user": "https://github.com/syazdani77"
}
```

Attachment: **[Weierstrass.sage.gz](https://github.com/sagemath/sage/files/ticket3416/Weierstrass.sage.gz)**

Algorithm 7.4.10 of GTM 138



---

archive/issue_comments_018407.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI believe the formulas used here are incorrect. I'm not sure, but they appear similar to the erroneous formula's from Cohen's book. I'm currently working on an implementation that uses different formulas. I expect that to be done within two weeks.\n\nOne of my colleagues is working on y<sup>2</sup> = quartic, which I will implement for him. I expect this to be done within a couple of weeks. During Sage Days 23 plans were made for other curves too, but I'm not sure anyone is working on those.",
    "created_at": "2010-07-13T23:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18407",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:5" align="right">comment:5</div>

I believe the formulas used here are incorrect. I'm not sure, but they appear similar to the erroneous formula's from Cohen's book. I'm currently working on an implementation that uses different formulas. I expect that to be done within two weeks.

One of my colleagues is working on y<sup>2</sup> = quartic, which I will implement for him. I expect this to be done within a couple of weeks. During Sage Days 23 plans were made for other curves too, but I'm not sure anyone is working on those.



---

archive/issue_comments_018408.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@sagetrac-Niels](#comment%3A5):\n> I believe the formulas used here are incorrect. I'm not sure, but they appear similar to the erroneous formula's \n> from Cohen's book. I'm currently working on an implementation that uses different formulas.\n>  I expect that to be done within two weeks.\n\nYes, they are definitely the wrong formulas in Cohen's book.\n\n -- William",
    "created_at": "2010-07-13T23:32:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18408",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@sagetrac-Niels](#comment%3A5):
> I believe the formulas used here are incorrect. I'm not sure, but they appear similar to the erroneous formula's 
> from Cohen's book. I'm currently working on an implementation that uses different formulas.
>  I expect that to be done within two weeks.

Yes, they are definitely the wrong formulas in Cohen's book.

 -- William



---

archive/issue_comments_018409.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nHenri Cohen writes (2010-08-12):\n\n```\nConcerning the formulas for a general cubic in my first book, the situation is precisely the following:\n\n1) They were directly copied from an APECS script written by Ian Connell.\n\n2) The final Weirstrass equation is correct, as is the transformation from\nthe cubic coordinates to the Weierstrass ones. On the other hand, the reverse\ntransformation has a mistake, which I never took time to find, should be easy\n(it may be the other way round).\n\n3) This is in my errata sheets. In my more recent books, I indicate that there is indeed a\nmistake, and explain the algorithm (well-known of course), in less detail with no explicit\nformulas, so that a student should be able to reconstruct them.\n```\nThis suggests that very minor corrections are all that is required.",
    "created_at": "2010-08-13T09:03:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18409",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:7" align="right">comment:7</div>

Henri Cohen writes (2010-08-12):

```
Concerning the formulas for a general cubic in my first book, the situation is precisely the following:

1) They were directly copied from an APECS script written by Ian Connell.

2) The final Weirstrass equation is correct, as is the transformation from
the cubic coordinates to the Weierstrass ones. On the other hand, the reverse
transformation has a mistake, which I never took time to find, should be easy
(it may be the other way round).

3) This is in my errata sheets. In my more recent books, I indicate that there is indeed a
mistake, and explain the algorithm (well-known of course), in less detail with no explicit
formulas, so that a student should be able to reconstruct them.
```
This suggests that very minor corrections are all that is required.



---

archive/issue_comments_018410.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI have found that the descriptions in:\n\nCassels, J. W. S. Lectures on elliptic curves. London Mathematical Society Student Texts, 24. Cambridge University Press, Cambridge, 1991.\n\ngive excellent recipes for writing down isomorphisms from cubics, y!^2=quartic and intersections of two quadrics in P!^2 with a rational point to their Jacobians in weierstrass form.\n\nThe alternative method of writing down maps of degrees 3, 2, 4 (respectively) to their Jacobians using invariant theory (see Tom Fisher et al.) often results in nicer models, because there are less arbitrary choices to be made.",
    "created_at": "2010-08-13T23:29:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18410",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:8" align="right">comment:8</div>

I have found that the descriptions in:

Cassels, J. W. S. Lectures on elliptic curves. London Mathematical Society Student Texts, 24. Cambridge University Press, Cambridge, 1991.

give excellent recipes for writing down isomorphisms from cubics, y!^2=quartic and intersections of two quadrics in P!^2 with a rational point to their Jacobians in weierstrass form.

The alternative method of writing down maps of degrees 3, 2, 4 (respectively) to their Jacobians using invariant theory (see Tom Fisher et al.) often results in nicer models, because there are less arbitrary choices to be made.



---

archive/issue_comments_018411.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@nbruin](#comment%3A8):\n> I have found that the descriptions in:\n> \n> Cassels, J. W. S. Lectures on elliptic curves. London Mathematical Society Student Texts, 24. Cambridge University Press, Cambridge, 1991.\n> \n> give excellent recipes for writing down isomorphisms from cubics, y!^2=quartic and intersections of two quadrics in P!^2 with a rational point to their Jacobians in weierstrass form.\n> \n> The alternative method of writing down maps of degrees 3, 2, 4 (respectively) to their Jacobians using invariant theory (see Tom Fisher et al.) often results in nicer models, because there are less arbitrary choices to be made.\n\nSure, and it would be great to have all these genus one modes in Sage!\n\n(you can call me) al",
    "created_at": "2010-08-14T11:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18411",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@nbruin](#comment%3A8):
> I have found that the descriptions in:
> 
> Cassels, J. W. S. Lectures on elliptic curves. London Mathematical Society Student Texts, 24. Cambridge University Press, Cambridge, 1991.
> 
> give excellent recipes for writing down isomorphisms from cubics, y!^2=quartic and intersections of two quadrics in P!^2 with a rational point to their Jacobians in weierstrass form.
> 
> The alternative method of writing down maps of degrees 3, 2, 4 (respectively) to their Jacobians using invariant theory (see Tom Fisher et al.) often results in nicer models, because there are less arbitrary choices to be made.

Sure, and it would be great to have all these genus one modes in Sage!

(you can call me) al



---

archive/issue_comments_018412.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@nbruin](#comment%3A8):\n> I have found that the descriptions in:\n> \n> Cassels, J. W. S. Lectures on elliptic curves. London Mathematical Society Student Texts, 24. Cambridge University Press, Cambridge, 1991.\n> \n> give excellent recipes for writing down isomorphisms from cubics, y!^2=quartic and intersections of two quadrics in P!^2 with a rational point to their Jacobians in weierstrass form.\n> \n> The alternative method of writing down maps of degrees 3, 2, 4 (respectively) to their Jacobians using invariant theory (see Tom Fisher et al.) often results in nicer models, because there are less arbitrary choices to be made.\n\n\nThanks for the advice. I will browse through the suggested literature to find the most convenient way of implementing cubic to Weierstrass. I plan to finish this before the end of August.\n\nIf I have more time I will try some quartics and see whether I can get the nicer formulas using J-invariants.",
    "created_at": "2010-08-15T09:22:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18412",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@nbruin](#comment%3A8):
> I have found that the descriptions in:
> 
> Cassels, J. W. S. Lectures on elliptic curves. London Mathematical Society Student Texts, 24. Cambridge University Press, Cambridge, 1991.
> 
> give excellent recipes for writing down isomorphisms from cubics, y!^2=quartic and intersections of two quadrics in P!^2 with a rational point to their Jacobians in weierstrass form.
> 
> The alternative method of writing down maps of degrees 3, 2, 4 (respectively) to their Jacobians using invariant theory (see Tom Fisher et al.) often results in nicer models, because there are less arbitrary choices to be made.


Thanks for the advice. I will browse through the suggested literature to find the most convenient way of implementing cubic to Weierstrass. I plan to finish this before the end of August.

If I have more time I will try some quartics and see whether I can get the nicer formulas using J-invariants.



---

archive/issue_comments_018413.json:
```json
{
    "body": "Attachment: **[14532.patch.gz](https://github.com/sagemath/sage/files/ticket3416/14532.patch.gz)**",
    "created_at": "2010-10-24T13:50:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18413",
    "user": "https://github.com/sagetrac-Niels"
}
```

Attachment: **[14532.patch.gz](https://github.com/sagemath/sage/files/ticket3416/14532.patch.gz)**



---

archive/issue_events_036741.json:
```json
{
    "actor": "https://github.com/sagetrac-Niels",
    "created_at": "2010-10-24T13:56:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36741"
}
```



---

archive/issue_events_036742.json:
```json
{
    "actor": "https://github.com/sagetrac-Niels",
    "created_at": "2010-10-24T13:56:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36742"
}
```



---

archive/issue_comments_018414.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nAttachment: **[cnotes.pdf.gz](https://github.com/sagemath/sage/files/ticket3416/cnotes.pdf.gz)**\n\nHere is my first ever Sage patch: 14532.patch. It creates an elliptic curve from any homogeneous cubic. The cubic is transformed to Weierstrass, and birational maps between the equations are given. The case y<sup>2</sup> = quartic is not covered.\n\nThe patch is based upon Sage 4.4.4.\n\nThe used transformations are from Section 4.4 of the course notes: \"G1CRPC: Rational Points on Curves\", which I uploaded as cnotes.pdf.\n\nPlease review my patch, and provide extensive feedback.",
    "created_at": "2010-10-24T13:56:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18414",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:11" align="right">comment:11</div>

Attachment: **[cnotes.pdf.gz](https://github.com/sagemath/sage/files/ticket3416/cnotes.pdf.gz)**

Here is my first ever Sage patch: 14532.patch. It creates an elliptic curve from any homogeneous cubic. The cubic is transformed to Weierstrass, and birational maps between the equations are given. The case y<sup>2</sup> = quartic is not covered.

The patch is based upon Sage 4.4.4.

The used transformations are from Section 4.4 of the course notes: "G1CRPC: Rational Points on Curves", which I uploaded as cnotes.pdf.

Please review my patch, and provide extensive feedback.



---

archive/issue_events_036743.json:
```json
{
    "actor": "https://github.com/novoselt",
    "created_at": "2010-10-24T18:02:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "title_is": "Weierstrass form for cubics",
    "title_was": "[not ready for review] Weierstrass form for cubics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36743"
}
```



---

archive/issue_comments_018415.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nJust a couple of quick comments, as I have not yet had a chance to look at the patch properly or try it out.  First:  I'm not sure we really want my old lecture notes attached to this ticket!  There is nothing you are using there that is not in standard other sources.  But if they are there, they should be attributed ;)\n\nSecondly, you absolutely cannot have print statements giving part of the output as a side-effect.  Better to return a tuple consisting of the elliptic curve and the morphisms.  This will break backwards compatibility, since the Magma version does not so this (though he underlying Magma function surely does), but it could be controlled by an extra parameter which defaults to False.",
    "created_at": "2010-10-24T19:22:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18415",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:13" align="right">comment:13</div>

Just a couple of quick comments, as I have not yet had a chance to look at the patch properly or try it out.  First:  I'm not sure we really want my old lecture notes attached to this ticket!  There is nothing you are using there that is not in standard other sources.  But if they are there, they should be attributed ;)

Secondly, you absolutely cannot have print statements giving part of the output as a side-effect.  Better to return a tuple consisting of the elliptic curve and the morphisms.  This will break backwards compatibility, since the Magma version does not so this (though he underlying Magma function surely does), but it could be controlled by an extra parameter which defaults to False.



---

archive/issue_comments_018416.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@JohnCremona](#comment%3A13):\n> I'm not sure we really want my old lecture notes attached to this ticket!  There is nothing you are using there that is not in standard other sources.  But if they are there, they should be attributed ;)\n\nThe problem is that most of the standard other sources contain incorrect formulas. These lecture notes are the first source I found with correct formulas. The main reason for including them is that it may help people in reviewing the patch. If anyone finds the same transformations in a standard source, please let me know.\n \n> Secondly, you absolutely cannot have print statements giving part of the output as a side-effect.  Better to return a tuple consisting of the elliptic curve and the morphisms.  This will break backwards compatibility, since the Magma version does not so this (though he underlying Magma function surely does), but it could be controlled by an extra parameter which defaults to False.\n\nOk, I can change that. Is there nice a way to represent such a morphism in Sage? I have difficulty expressing a transformation like the following as a single morphism (just an example from the top of my head):\n\nx -> x<sup>2</sup> - y\n\ny -> x<sup>2</sup> + y\n\nz -> z<sup>2</sup>\n\nThen multiply with 6/(x<sup>2</sup> z)",
    "created_at": "2010-10-25T06:53:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18416",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@JohnCremona](#comment%3A13):
> I'm not sure we really want my old lecture notes attached to this ticket!  There is nothing you are using there that is not in standard other sources.  But if they are there, they should be attributed ;)

The problem is that most of the standard other sources contain incorrect formulas. These lecture notes are the first source I found with correct formulas. The main reason for including them is that it may help people in reviewing the patch. If anyone finds the same transformations in a standard source, please let me know.
 
> Secondly, you absolutely cannot have print statements giving part of the output as a side-effect.  Better to return a tuple consisting of the elliptic curve and the morphisms.  This will break backwards compatibility, since the Magma version does not so this (though he underlying Magma function surely does), but it could be controlled by an extra parameter which defaults to False.

Ok, I can change that. Is there nice a way to represent such a morphism in Sage? I have difficulty expressing a transformation like the following as a single morphism (just an example from the top of my head):

x -> x<sup>2</sup> - y

y -> x<sup>2</sup> + y

z -> z<sup>2</sup>

Then multiply with 6/(x<sup>2</sup> z)



---

archive/issue_events_036744.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-11-20T17:39:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36744"
}
```



---

archive/issue_events_036745.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2010-11-20T17:39:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36745"
}
```



---

archive/issue_comments_018417.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI tried to define the morphism properly, which should work, but it doesn't since in defining the morphism Sage checks that the polynomials used a homogeneous of the same degree (see line 458 of schemes.generic.morphism.py), but the degree function is not defined for elements of the coordinate ring.  This can be fixed:  although in general QuotientRingElement s have no degree, in this situation (where the quotient is by a homogeneous ideal) the degree is well-defined.",
    "created_at": "2010-11-20T17:39:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18417",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:15" align="right">comment:15</div>

I tried to define the morphism properly, which should work, but it doesn't since in defining the morphism Sage checks that the polynomials used a homogeneous of the same degree (see line 458 of schemes.generic.morphism.py), but the degree function is not defined for elements of the coordinate ring.  This can be fixed:  although in general QuotientRingElement s have no degree, in this situation (where the quotient is by a homogeneous ideal) the degree is well-defined.



---

archive/issue_comments_018418.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nSee #10297 for a separate report on this (and, soon, a patch).",
    "created_at": "2010-11-20T18:48:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18418",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:16" align="right">comment:16</div>

See #10297 for a separate report on this (and, soon, a patch).



---

archive/issue_comments_018419.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@JohnCremona](#comment%3A16):\n> See #10297 for a separate report on this (and, soon, a patch).\n\nThe patch is there, so please review it!  The example I used there is one of the examples from the patch here.\n\nReplacing the curve E used there with\n\n```\n\nsage: E=EllipticCurve([0,0,0,0,-6400/3])\nsage: H=C.Hom(E)\nsage: f = H([zbar,xbar-ybar,-(xbar+ybar)/80])\nsage: f\nScheme morphism:\n  From: Projective Curve over Rational Field defined by x^3 + y^3 + 60*z^3\n  To:   Elliptic Curve defined by y^2 = x^3 - 6400/3 over Rational Field\n  Defn: Defined on coordinates by sending (x : y : z) to\n        (zbar : xbar - ybar : -1/80*xbar - 1/80*ybar)\n```\nsuccessfully defines the morphism.  I recommend that the function here just returns the morphism, since one can recover E from\n\n```\nsage: f.codomain()\nElliptic Curve defined by y^2 = x^3 - 6400/3 over Rational Field\n```\n\nThis will not be the end of the story, as I now cannot apply f to a point on C to get a point on E, but that's because of another difficulty like the one at #10297, so should be fixed separately.",
    "created_at": "2010-11-20T19:06:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18419",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@JohnCremona](#comment%3A16):
> See #10297 for a separate report on this (and, soon, a patch).

The patch is there, so please review it!  The example I used there is one of the examples from the patch here.

Replacing the curve E used there with

```

sage: E=EllipticCurve([0,0,0,0,-6400/3])
sage: H=C.Hom(E)
sage: f = H([zbar,xbar-ybar,-(xbar+ybar)/80])
sage: f
Scheme morphism:
  From: Projective Curve over Rational Field defined by x^3 + y^3 + 60*z^3
  To:   Elliptic Curve defined by y^2 = x^3 - 6400/3 over Rational Field
  Defn: Defined on coordinates by sending (x : y : z) to
        (zbar : xbar - ybar : -1/80*xbar - 1/80*ybar)
```
successfully defines the morphism.  I recommend that the function here just returns the morphism, since one can recover E from

```
sage: f.codomain()
Elliptic Curve defined by y^2 = x^3 - 6400/3 over Rational Field
```

This will not be the end of the story, as I now cannot apply f to a point on C to get a point on E, but that's because of another difficulty like the one at #10297, so should be fixed separately.



---

archive/issue_comments_018420.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@JohnCremona](#comment%3A17):\n> Replying to [@JohnCremona](#comment%3A16):\n> > See #10297 for a separate report on this (and, soon, a patch).\n\n> \n> The patch is there, so please review it!  The example I used there is one of the examples from the patch here.\n> \n> Replacing the curve E used there with\n> \n> ```\n> \n> sage: E=EllipticCurve([0,0,0,0,-6400/3])\n> sage: H=C.Hom(E)\n> sage: f = H([zbar,xbar-ybar,-(xbar+ybar)/80])\n> sage: f\n> Scheme morphism:\n>   From: Projective Curve over Rational Field defined by x^3^ + y^3^ + 60*z^3^\n>   To:   Elliptic Curve defined by y^2^ = x^3^ - 6400/3 over Rational Field\n>   Defn: Defined on coordinates by sending (x : y : z) to\n>         (zbar : xbar - ybar : -1/80*xbar - 1/80*ybar)\n> ```\n> successfully defines the morphism.  I recommend that the function here just returns the morphism, since one can recover E from\n> \n> ```\n> sage: f.codomain()\n> Elliptic Curve defined by y^2^ = x^3^ - 6400/3 over Rational Field\n> ```\n> \n> This will not be the end of the story, as I now cannot apply f to a point on C to get a point on E, but that's because of another difficulty like the one at #10297, so should be fixed separately.\n\nThe example you give almost works. However, the map f sending (x : y : z) to (zbar : xbar - ybar : -1/80*xbar - 1/80*ybar) is the inverse of the map we are looking for. The map f is from the Elliptic Curve defined by y<sup>2</sup> = x<sup>3</sup> - 6400/3 to the Curve defined by x<sup>3</sup> + y<sup>3</sup> + 60*z<sup>3</sup>, not the other way around.\n\nI would like to include both the map f and its inverse f<sup>-1</sup> as (optional) output. Also, it would be nice to include the projective scaling necessary after the rational transformation. Unfortunately, the map f<sup>-1</sup> from \"x<sup>3</sup> + y<sup>3</sup> + 60*z<sup>3</sup>\" to \"y<sup>2</sup> - x<sup>3</sup> + 6400/3\" is not homogeneous:\n\nx -> 1/2*y - 40\n\ny -> -1/2*y - 40\n\nz -> x\n\nThen multiply the equation with 1/60.\n\nThe map f is homogeneous, but I'm not sure I can get a homogeneous f<sup>-1</sup> from there.\n\nI suggest that I include the morphisms as an optional tuple of strings. Does anyone have a better suggestion?",
    "created_at": "2011-03-28T14:55:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18420",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@JohnCremona](#comment%3A17):
> Replying to [@JohnCremona](#comment%3A16):
> > See #10297 for a separate report on this (and, soon, a patch).

> 
> The patch is there, so please review it!  The example I used there is one of the examples from the patch here.
> 
> Replacing the curve E used there with
> 
> ```
> 
> sage: E=EllipticCurve([0,0,0,0,-6400/3])
> sage: H=C.Hom(E)
> sage: f = H([zbar,xbar-ybar,-(xbar+ybar)/80])
> sage: f
> Scheme morphism:
>   From: Projective Curve over Rational Field defined by x^3^ + y^3^ + 60*z^3^
>   To:   Elliptic Curve defined by y^2^ = x^3^ - 6400/3 over Rational Field
>   Defn: Defined on coordinates by sending (x : y : z) to
>         (zbar : xbar - ybar : -1/80*xbar - 1/80*ybar)
> ```
> successfully defines the morphism.  I recommend that the function here just returns the morphism, since one can recover E from
> 
> ```
> sage: f.codomain()
> Elliptic Curve defined by y^2^ = x^3^ - 6400/3 over Rational Field
> ```
> 
> This will not be the end of the story, as I now cannot apply f to a point on C to get a point on E, but that's because of another difficulty like the one at #10297, so should be fixed separately.

The example you give almost works. However, the map f sending (x : y : z) to (zbar : xbar - ybar : -1/80*xbar - 1/80*ybar) is the inverse of the map we are looking for. The map f is from the Elliptic Curve defined by y<sup>2</sup> = x<sup>3</sup> - 6400/3 to the Curve defined by x<sup>3</sup> + y<sup>3</sup> + 60*z<sup>3</sup>, not the other way around.

I would like to include both the map f and its inverse f<sup>-1</sup> as (optional) output. Also, it would be nice to include the projective scaling necessary after the rational transformation. Unfortunately, the map f<sup>-1</sup> from "x<sup>3</sup> + y<sup>3</sup> + 60*z<sup>3</sup>" to "y<sup>2</sup> - x<sup>3</sup> + 6400/3" is not homogeneous:

x -> 1/2*y - 40

y -> -1/2*y - 40

z -> x

Then multiply the equation with 1/60.

The map f is homogeneous, but I'm not sure I can get a homogeneous f<sup>-1</sup> from there.

I suggest that I include the morphisms as an optional tuple of strings. Does anyone have a better suggestion?



---

archive/issue_comments_018421.json:
```json
{
    "body": "Attachment: **[trac_3416_elliptic_curve_from_cubic.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic.patch.gz)**\n\npatch_2011_04_26",
    "created_at": "2011-04-26T08:09:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18421",
    "user": "https://github.com/sagetrac-Niels"
}
```

Attachment: **[trac_3416_elliptic_curve_from_cubic.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic.patch.gz)**

patch_2011_04_26



---

archive/issue_comments_018422.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI now have the morphisms as optional output, which defaults to False. The output uses print statements, because I still cannot find a better form for the general non-homogeneous morphisms. I tried using strings instead, but adding a polynomial to a string did not work.\n\nI hope this solution is okay for now. If anyone has a better suggestion for the representation, I will be happy to update my patch, or repatch it.",
    "created_at": "2011-04-26T08:17:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18422",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:19" align="right">comment:19</div>

I now have the morphisms as optional output, which defaults to False. The output uses print statements, because I still cannot find a better form for the general non-homogeneous morphisms. I tried using strings instead, but adding a polynomial to a string did not work.

I hope this solution is okay for now. If anyone has a better suggestion for the representation, I will be happy to update my patch, or repatch it.



---

archive/issue_events_036746.json:
```json
{
    "actor": "https://github.com/sagetrac-Niels",
    "created_at": "2011-04-26T08:17:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36746"
}
```



---

archive/issue_events_036747.json:
```json
{
    "actor": "https://github.com/sagetrac-Niels",
    "created_at": "2011-04-26T08:17:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36747"
}
```



---

archive/issue_events_036748.json:
```json
{
    "actor": "https://github.com/sagetrac-Niels",
    "created_at": "2011-04-27T08:34:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36748"
}
```



---

archive/issue_events_036749.json:
```json
{
    "actor": "https://github.com/sagetrac-Niels",
    "created_at": "2011-04-27T08:34:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36749"
}
```



---

archive/issue_comments_018423.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI am writing my own documentation about the transformation from cubic to Weierstrass. I will upload it within the next few days.\n\nI think I spotted a minor error in my patch. When P is not a flex, the program finds a second point P2 using the chord and tangent method. However, if P2 is a flex, I think the program will return an error. This is a simple fix, which will be up soon.",
    "created_at": "2011-04-27T08:34:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18423",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:20" align="right">comment:20</div>

I am writing my own documentation about the transformation from cubic to Weierstrass. I will upload it within the next few days.

I think I spotted a minor error in my patch. When P is not a flex, the program finds a second point P2 using the chord and tangent method. However, if P2 is a flex, I think the program will return an error. This is a simple fix, which will be up soon.



---

archive/issue_comments_018424.json:
```json
{
    "body": "Attachment: **[trac_3416_elliptic_curve_from_cubic2.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic2.patch.gz)**\n\npatch_2011_04_27 with the fix for when P2 is a flex",
    "created_at": "2011-04-27T09:47:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18424",
    "user": "https://github.com/sagetrac-Niels"
}
```

Attachment: **[trac_3416_elliptic_curve_from_cubic2.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic2.patch.gz)**

patch_2011_04_27 with the fix for when P2 is a flex



---

archive/issue_comments_018425.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI'm sorry, I spotted another error when P2 is a flex. I'm fixing this today. I expect the new patch to be up today, and also the documentation. The documentation makes me confident that the new patch will be error-free.",
    "created_at": "2011-04-29T08:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18425",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:21" align="right">comment:21</div>

I'm sorry, I spotted another error when P2 is a flex. I'm fixing this today. I expect the new patch to be up today, and also the documentation. The documentation makes me confident that the new patch will be error-free.



---

archive/issue_comments_018426.json:
```json
{
    "body": "patch_2011_04_29 with additional fix",
    "created_at": "2011-04-29T09:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18426",
    "user": "https://github.com/sagetrac-Niels"
}
```

patch_2011_04_29 with additional fix



---

archive/issue_comments_018427.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nAttachment: **[trac_3416_elliptic_curve_from_cubic3.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic3.patch.gz)**\n\nThe documentation is also up now. Comments on the documentation are welcome.\n\nPlease review my patch (trac_3416_elliptic_curve_from_cubic3.patch), and suggest any improvements it may need. The documentation describes how the patch works.",
    "created_at": "2011-04-29T10:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18427",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:22" align="right">comment:22</div>

Attachment: **[trac_3416_elliptic_curve_from_cubic3.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic3.patch.gz)**

The documentation is also up now. Comments on the documentation are welcome.

Please review my patch (trac_3416_elliptic_curve_from_cubic3.patch), and suggest any improvements it may need. The documentation describes how the patch works.



---

archive/issue_events_036750.json:
```json
{
    "actor": "https://github.com/sagetrac-Niels",
    "created_at": "2011-04-29T10:41:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36750"
}
```



---

archive/issue_events_036751.json:
```json
{
    "actor": "https://github.com/sagetrac-Niels",
    "created_at": "2011-04-29T10:41:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36751"
}
```



---

archive/issue_comments_018428.json:
```json
{
    "body": "Documentation of patch3, including the source code - updated 2011_05_02",
    "created_at": "2011-05-02T20:25:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18428",
    "user": "https://github.com/sagetrac-Niels"
}
```

Documentation of patch3, including the source code - updated 2011_05_02



---

archive/issue_comments_018429.json:
```json
{
    "body": "Author: **Niels Duif**",
    "created_at": "2011-07-04T21:56:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18429",
    "user": "https://github.com/mstreng"
}
```

Author: **Niels Duif**



---

archive/issue_events_036752.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-07-04T21:56:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36752"
}
```



---

archive/issue_comments_018430.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,7 @@\n-This code still needs a bit of polishing and testing, but it's nearly ready to go. I am marking this with a negative review since it's not quite release ready, but people can check it out.\n+Implement transformations to put a general cubic (with a point) into Weierstrass form.\n \n-This includes code for finding the transformation maps.\n+Apply:\n \n--Bobby\n+* [attachment: trac_3416_elliptic_curve_from_cubic3.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic3.patch.gz)\n+\n+See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.\n``````\n",
    "created_at": "2011-07-04T21:56:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18430",
    "user": "https://github.com/mstreng"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,7 @@
-This code still needs a bit of polishing and testing, but it's nearly ready to go. I am marking this with a negative review since it's not quite release ready, but people can check it out.
+Implement transformations to put a general cubic (with a point) into Weierstrass form.
 
-This includes code for finding the transformation maps.
+Apply:
 
--Bobby
+* [attachment: trac_3416_elliptic_curve_from_cubic3.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic3.patch.gz)
+
+See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.
``````




---

archive/issue_comments_018431.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nAttachment: **[cubic_to_weierstrass_documentation.pdf.gz](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz)**\n\nDid I understand correctly that one should apply trac_3416_elliptic_curve_from_cubic3.patch only?",
    "created_at": "2011-07-04T21:56:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18431",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:23" align="right">comment:23</div>

Attachment: **[cubic_to_weierstrass_documentation.pdf.gz](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz)**

Did I understand correctly that one should apply trac_3416_elliptic_curve_from_cubic3.patch only?



---

archive/issue_comments_018432.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@mstreng](#comment%3A23):\n> Did I understand correctly that one should apply trac_3416_elliptic_curve_from_cubic3.patch only?\n> \n\nYes, number 3 only, I guess I should have removed the other patches. Thanks for pointing this out.",
    "created_at": "2011-07-06T07:09:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18432",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@mstreng](#comment%3A23):
> Did I understand correctly that one should apply trac_3416_elliptic_curve_from_cubic3.patch only?
> 

Yes, number 3 only, I guess I should have removed the other patches. Thanks for pointing this out.



---

archive/issue_comments_018433.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nYou can't remove patches (unless you have special rights on the trac server). But whenever you upload a patch, you can help reviewers and release managers by writting (preferably both in comments and in the ticket description) which patches to apply and in which order. If you follow a [certain syntax](http://wiki.sagemath.org/buildbot) in the comments, then an additional bonus is that your patches will get automatically tested by the buildbot.\n\nI almost gave you a negative review because of the following, but it seems that this is not something introduced by you, but just an error that was already there:\n\nThe documentation of `EllipticCurve_from_cubic` says that P should be a tuple, but the function only accepts lists (e.g. `[-1,0,1]`), not tuples (e.g. `(-1,0,1)`). Well, I guess I need to work harder for a review.",
    "created_at": "2011-07-06T09:28:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18433",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:25" align="right">comment:25</div>

You can't remove patches (unless you have special rights on the trac server). But whenever you upload a patch, you can help reviewers and release managers by writting (preferably both in comments and in the ticket description) which patches to apply and in which order. If you follow a [certain syntax](http://wiki.sagemath.org/buildbot) in the comments, then an additional bonus is that your patches will get automatically tested by the buildbot.

I almost gave you a negative review because of the following, but it seems that this is not something introduced by you, but just an error that was already there:

The documentation of `EllipticCurve_from_cubic` says that P should be a tuple, but the function only accepts lists (e.g. `[-1,0,1]`), not tuples (e.g. `(-1,0,1)`). Well, I guess I need to work harder for a review.



---

archive/issue_comments_018434.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n\n```\nsage -t -long devel/sage/sage/schemes/elliptic_curves/constructor.py\n**********************************************************************\nError: TAB character found.\n```\nYou can't use TAB characters in python. Please replace it by the appropriate number of spaces. You can probably set up your editor so that it never uses TAB characters (and uses spaces instead).\n\nI'll read your code and give you a few suggestions for the next version.",
    "created_at": "2011-07-06T10:19:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18434",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:26" align="right">comment:26</div>


```
sage -t -long devel/sage/sage/schemes/elliptic_curves/constructor.py
**********************************************************************
Error: TAB character found.
```
You can't use TAB characters in python. Please replace it by the appropriate number of spaces. You can probably set up your editor so that it never uses TAB characters (and uses spaces instead).

I'll read your code and give you a few suggestions for the next version.



---

archive/issue_comments_018435.json:
```json
{
    "body": "Reviewer: **Marco Streng**",
    "created_at": "2011-07-06T10:19:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18435",
    "user": "https://github.com/mstreng"
}
```

Reviewer: **Marco Streng**



---

archive/issue_events_036753.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-07-06T10:19:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36753"
}
```



---

archive/issue_events_036754.json:
```json
{
    "actor": "https://github.com/mstreng",
    "created_at": "2011-07-06T10:19:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36754"
}
```



---

archive/issue_comments_018436.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nOk, here are some more comments, and a few cases where your code does not work:\n\nMost importantly: I don't like the output strings, I would definitely prefer actual `SchemeMorphism_on_points_projective_space` objects. This makes the method much more useful (as you can just evaluate these in points to transfer points between the curves). It also makes your patch much easier to review (as reviewers don't need to manually copy printed strings to test correctness of your output). I don't think this change is a lot of work: you can just feed your polynomials to E.hom, and you can find an example in the parametrization function [here](https://github.com/sagemath/sage/files/ticket727/trac_727_conics_without_number_fields.patch.gz). I'm afraid it would require accepting an actual plane projective curve as input `f` instead of a polynomial. For backwards compatibility, you can change polynomials into curves when you get them as input.\n\nAnyway, here are some comments on the code as it is:\n\nIf you stick with printing: in the description of the ``equivalence`` parameter: replace \"given\" by \"*printed*\" to make clear that it is only printed, not really given as a Sage object. The \"*\"'s around \"printed\" make it italic for emphasis.\n\nI would have called the \"equivalence\" parameter \"transformation\" instead.\n\nIn all your examples:\n\n```\nsage: var(\"x y z\")\n(x, y, z)\nsage: R.<x,y,z>=QQ[]\nsage: f=R(x^3+y^3+z^3)\n```\nThe second input overwrites the x, y, and z of the first input, so the first two lines (one input and one output) can (and hence should) be removed. Also, `x<sup>3+y</sup>3+z^3` is already in R, so remove \"R(\" and \")\".\n\nI don't understand the purpose of the \"Then multiply the equation with\". The three substitutions already give a map in projective space, right?\n\nYour function seems to require the variable names to be \"x,y,z\", this is not right:\n\n```\nsage: Q.<a,b,c>=QQ[]\nsage: EllipticCurve_from_cubic(a^3+b^3+60*c^3, [1,-1,0], equivalence=True)\n\u2026\nKeyError: 'y'\n```\n\nThere are cases that your code cannot handle:\n\n```\nsage: P.<x,y,z> = QQ[]\nsage: EllipticCurve_from_cubic(x^3+y^3+z^3, [-1,1,0])\nElliptic Curve defined by y^2 + 2*x*y + 1/3*y = x^3 - x^2 - 1/3*x - 1/27 over Rational Field\nsage: EllipticCurve_from_cubic(x^3+y^3+z^3, [-1,0,1])\n\u2026\nZeroDivisionError: \n```",
    "created_at": "2011-07-06T11:02:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18436",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:27" align="right">comment:27</div>

Ok, here are some more comments, and a few cases where your code does not work:

Most importantly: I don't like the output strings, I would definitely prefer actual `SchemeMorphism_on_points_projective_space` objects. This makes the method much more useful (as you can just evaluate these in points to transfer points between the curves). It also makes your patch much easier to review (as reviewers don't need to manually copy printed strings to test correctness of your output). I don't think this change is a lot of work: you can just feed your polynomials to E.hom, and you can find an example in the parametrization function [here](https://github.com/sagemath/sage/files/ticket727/trac_727_conics_without_number_fields.patch.gz). I'm afraid it would require accepting an actual plane projective curve as input `f` instead of a polynomial. For backwards compatibility, you can change polynomials into curves when you get them as input.

Anyway, here are some comments on the code as it is:

If you stick with printing: in the description of the ``equivalence`` parameter: replace "given" by "*printed*" to make clear that it is only printed, not really given as a Sage object. The "*"'s around "printed" make it italic for emphasis.

I would have called the "equivalence" parameter "transformation" instead.

In all your examples:

```
sage: var("x y z")
(x, y, z)
sage: R.<x,y,z>=QQ[]
sage: f=R(x^3+y^3+z^3)
```
The second input overwrites the x, y, and z of the first input, so the first two lines (one input and one output) can (and hence should) be removed. Also, `x<sup>3+y</sup>3+z^3` is already in R, so remove "R(" and ")".

I don't understand the purpose of the "Then multiply the equation with". The three substitutions already give a map in projective space, right?

Your function seems to require the variable names to be "x,y,z", this is not right:

```
sage: Q.<a,b,c>=QQ[]
sage: EllipticCurve_from_cubic(a^3+b^3+60*c^3, [1,-1,0], equivalence=True)

KeyError: 'y'
```

There are cases that your code cannot handle:

```
sage: P.<x,y,z> = QQ[]
sage: EllipticCurve_from_cubic(x^3+y^3+z^3, [-1,1,0])
Elliptic Curve defined by y^2 + 2*x*y + 1/3*y = x^3 - x^2 - 1/3*x - 1/27 over Rational Field
sage: EllipticCurve_from_cubic(x^3+y^3+z^3, [-1,0,1])

ZeroDivisionError: 
```



---

archive/issue_comments_018437.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@mstreng](#comment%3A25):\n> I almost gave you a negative review because of the following, but it seems that this is not something introduced by you, but just an error that was already there:\n> \n> The documentation of `EllipticCurve_from_cubic` says that P should be a tuple, but the function only accepts lists (e.g. `[-1,0,1]`), not tuples (e.g. `(-1,0,1)`). Well, I guess I need to work harder for a review.\n\nNever mind this comment: it does accept tuples, it just does not accept `(-1,0,1)`, only `(-1,1,0)`.",
    "created_at": "2011-07-06T11:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18437",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@mstreng](#comment%3A25):
> I almost gave you a negative review because of the following, but it seems that this is not something introduced by you, but just an error that was already there:
> 
> The documentation of `EllipticCurve_from_cubic` says that P should be a tuple, but the function only accepts lists (e.g. `[-1,0,1]`), not tuples (e.g. `(-1,0,1)`). Well, I guess I need to work harder for a review.

Never mind this comment: it does accept tuples, it just does not accept `(-1,0,1)`, only `(-1,1,0)`.



---

archive/issue_comments_018438.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nps. `are_projectively_equivalent` needs documentation including tests. Even though it is not available to the user, it must make sense to developers who want to edit your code.",
    "created_at": "2011-07-06T11:16:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18438",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:29" align="right">comment:29</div>

ps. `are_projectively_equivalent` needs documentation including tests. Even though it is not available to the user, it must make sense to developers who want to edit your code.



---

archive/issue_comments_018439.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nI very strongly agree that outputting the map as strings is not acceptable, and makes using this output impossible.  I said as much in an earlier review, and the response was that the author could not work out how to return maps.\n\nIn a spirit of cooperation and so that this can eventually be finished, let's try to carry out Marco's suggestion to construct a hom properly.  I seem to remember that when I tried this last it failed for some rather silly reason, but we really should be able to get this to work!",
    "created_at": "2011-07-06T11:26:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18439",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:30" align="right">comment:30</div>

I very strongly agree that outputting the map as strings is not acceptable, and makes using this output impossible.  I said as much in an earlier review, and the response was that the author could not work out how to return maps.

In a spirit of cooperation and so that this can eventually be finished, let's try to carry out Marco's suggestion to construct a hom properly.  I seem to remember that when I tried this last it failed for some rather silly reason, but we really should be able to get this to work!



---

archive/issue_comments_018440.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nNice work! Haven't tested it, but I did scan over the patch. Some remarks:\n\n- Your examples are misleading. You call `var(\"x y z\")` and then construct a polynomial ring. The call to `var` is irrelevant and should be removed.\n\n- Line 578. Why don't you take R=parent(F)? In fact, why do you define R at all? I don't think you use it.\n\n- Line 587. Don't use chord-tangent to determine if a point is a flex, but see if the hessian (determinant of the matrix of double derivatives of F) vanishes at P. That allows you to get rid of \"chord_and_tangent\" and of \"are_projectively_equivalent\" (for which you should a library routine instead of writing your own, if you really need it elsewhere. Sage's projective spaces and their points should be able to do this for you.\n\nFor the interfacing with magma:\n\nI think you can be a little more elegant here. Consider the following example\n\n```\nR.<x,y,z>=QQ[]\nf=x^3+y^3+z^3\nP=(0,1,-1)\n```\nYou can now do (and this should apply generally):\n\n```\nP2_magma=f.parent().magma().Proj()\nC_magma=P2.Curve(f)\nE_magma,mp_magma=C.EllipticCurve(C_magma(P),nvals=Integer(2))\nE_magma.aInvariants().sage()\n```\nTo extract the map, one would hope to be able to do\n\n```\nmp.DefiningPolynomials().sage()\n```\nand the fact that this fails is not really the fault of the code here. The proper solution would be to extend the coercion system to the magma interface, but that doesn't sound very appealing.\n\nIn any case, I don't think you should be hard-coding the Rationals as a base ring here and you should not be calling MinimalModel either, because you don't do that in the sage version.\n\n---\n\nFinally, for the transformation: Yes, return a morphism or failing that, a list of 3 homogeneous polynomials in the parent of F that would be the appropriate input for the \"hom\" constructor.\n\nIf you are implementing your algorithm \"bare bones\" (internally, you just work with polynomials and you don't use any of the scheme machinery and your input consists of a homogeneous poly rather than a plane curve) there could be some value of also making your output available \"bare bones\", i.e., just return the list [a1,a2,a3,a4,a6] and a list of polynomials describing the map.\n\nThere is a cost to using schemes, ambient spaces etc., so there may be a benefit in having the raw functionality available in a form that avoids it. Once you have a routine that does the heavy lifting, it's straightforward to write a wrapper that provides an interface in scheme language.\n\n(there is also a benefit in using scheme language, so if you choose to write your code in terms of such higher level constructs, it makes little sense to wrap it to provide a \"raw\" interface as well)",
    "created_at": "2011-07-06T17:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18440",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:31" align="right">comment:31</div>

Nice work! Haven't tested it, but I did scan over the patch. Some remarks:

- Your examples are misleading. You call `var("x y z")` and then construct a polynomial ring. The call to `var` is irrelevant and should be removed.

- Line 578. Why don't you take R=parent(F)? In fact, why do you define R at all? I don't think you use it.

- Line 587. Don't use chord-tangent to determine if a point is a flex, but see if the hessian (determinant of the matrix of double derivatives of F) vanishes at P. That allows you to get rid of "chord_and_tangent" and of "are_projectively_equivalent" (for which you should a library routine instead of writing your own, if you really need it elsewhere. Sage's projective spaces and their points should be able to do this for you.

For the interfacing with magma:

I think you can be a little more elegant here. Consider the following example

```
R.<x,y,z>=QQ[]
f=x^3+y^3+z^3
P=(0,1,-1)
```
You can now do (and this should apply generally):

```
P2_magma=f.parent().magma().Proj()
C_magma=P2.Curve(f)
E_magma,mp_magma=C.EllipticCurve(C_magma(P),nvals=Integer(2))
E_magma.aInvariants().sage()
```
To extract the map, one would hope to be able to do

```
mp.DefiningPolynomials().sage()
```
and the fact that this fails is not really the fault of the code here. The proper solution would be to extend the coercion system to the magma interface, but that doesn't sound very appealing.

In any case, I don't think you should be hard-coding the Rationals as a base ring here and you should not be calling MinimalModel either, because you don't do that in the sage version.

---

Finally, for the transformation: Yes, return a morphism or failing that, a list of 3 homogeneous polynomials in the parent of F that would be the appropriate input for the "hom" constructor.

If you are implementing your algorithm "bare bones" (internally, you just work with polynomials and you don't use any of the scheme machinery and your input consists of a homogeneous poly rather than a plane curve) there could be some value of also making your output available "bare bones", i.e., just return the list [a1,a2,a3,a4,a6] and a list of polynomials describing the map.

There is a cost to using schemes, ambient spaces etc., so there may be a benefit in having the raw functionality available in a form that avoids it. Once you have a routine that does the heavy lifting, it's straightforward to write a wrapper that provides an interface in scheme language.

(there is also a benefit in using scheme language, so if you choose to write your code in terms of such higher level constructs, it makes little sense to wrap it to provide a "raw" interface as well)



---

archive/issue_comments_018441.json:
```json
{
    "body": "Changed reviewer from **Marco Streng** to **Marco Streng, Nils Bruin**",
    "created_at": "2011-07-06T17:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18441",
    "user": "https://github.com/mstreng"
}
```

Changed reviewer from **Marco Streng** to **Marco Streng, Nils Bruin**



---

archive/issue_comments_018442.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@nbruin](#comment%3A31):\n> If you are implementing your algorithm \"bare bones\" (internally, you just work with polynomials and you don't use any of the scheme machinery and your input consists of a homogeneous poly rather than a plane curve) there could be some value of also making your output available \"bare bones\", i.e., just return the list [a1,a2,a3,a4,a6] and a list of polynomials describing the map.\n> \n> There is a cost to using schemes, ambient spaces etc., so there may be a benefit in having the raw functionality available in a form that avoids it. Once you have a routine that does the heavy lifting, it's straightforward to write a wrapper that provides an interface in scheme language.\n\nI like this idea. So Niels's code could simply output three lists: the [a1,a2,a3,a4,a6] and 2 lists of 3 polynomials each. Outputting instead of printing should be an easy enough change.\n\nAnd then a new member function of `ProjectiveCurve_generic` could call it (or an analogous \"`y^2`=quartic\" function) and convert the output to an `EllipticCurve...` and two `SchemeMorphism...` objects.",
    "created_at": "2011-07-06T17:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18442",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@nbruin](#comment%3A31):
> If you are implementing your algorithm "bare bones" (internally, you just work with polynomials and you don't use any of the scheme machinery and your input consists of a homogeneous poly rather than a plane curve) there could be some value of also making your output available "bare bones", i.e., just return the list [a1,a2,a3,a4,a6] and a list of polynomials describing the map.
> 
> There is a cost to using schemes, ambient spaces etc., so there may be a benefit in having the raw functionality available in a form that avoids it. Once you have a routine that does the heavy lifting, it's straightforward to write a wrapper that provides an interface in scheme language.

I like this idea. So Niels's code could simply output three lists: the [a1,a2,a3,a4,a6] and 2 lists of 3 polynomials each. Outputting instead of printing should be an easy enough change.

And then a new member function of `ProjectiveCurve_generic` could call it (or an analogous "`y^2`=quartic" function) and convert the output to an `EllipticCurve...` and two `SchemeMorphism...` objects.



---

archive/issue_comments_018443.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@mstreng](#comment%3A32):\n> And then a new member function of `ProjectiveCurve_generic` could call it (or an analogous \"`y^2`=quartic\" function) and convert the output to an `EllipticCurve...` and two `SchemeMorphism...` objects.\n\n(ps. this part is for a later ticket, of course)",
    "created_at": "2011-07-06T18:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18443",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@mstreng](#comment%3A32):
> And then a new member function of `ProjectiveCurve_generic` could call it (or an analogous "`y^2`=quartic" function) and convert the output to an `EllipticCurve...` and two `SchemeMorphism...` objects.

(ps. this part is for a later ticket, of course)



---

archive/issue_comments_018444.json:
```json
{
    "body": "Changed reviewer from **Marco Streng, Nils Bruin** to **John Cremona, Marco Streng, Nils Bruin**",
    "created_at": "2011-07-06T18:02:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18444",
    "user": "https://github.com/mstreng"
}
```

Changed reviewer from **Marco Streng, Nils Bruin** to **John Cremona, Marco Streng, Nils Bruin**



---

archive/issue_comments_018445.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThank you all for the comments. I will have another go at making this patch work.",
    "created_at": "2011-07-06T19:27:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18445",
    "user": "https://github.com/sagetrac-Niels"
}
```

<div id="comment:34" align="right">comment:34</div>

Thank you all for the comments. I will have another go at making this patch work.



---

archive/issue_comments_018446.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThis has arisen once again on sage-nt: is anyone interested in making this work at last?",
    "created_at": "2012-12-02T12:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18446",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:35" align="right">comment:35</div>

This has arisen once again on sage-nt: is anyone interested in making this work at last?



---

archive/issue_comments_018447.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThere is also the pointless version #13084, #13458. The way I see it, it has the advantage that you don't have to specify a point to get the Weierstrass form. The price to pay is that you don't get an explicit isomorphism with the Weierstrass cubic.\n\nActually, the Magma `aInvariants` function that the current code calls\n\n```\n    cmd = 'aInvariants(MinimalModel(EllipticCurve(Curve(Scheme(P, %s)),P!%s)));'%(F, P) \n    s = magma.eval(cmd) \n    return EllipticCurve(rings.RationalField(), eval(s)) \n```\nimplements the same algorithm as #13084, see http://magma.maths.usyd.edu.au/magma/handbook/text/1379. Which is why it doesn't return a morphism. \n\nI'm not entirely sure how to merge the two approaches but it seems that you should only require a point if you actually need the isomorphism to the Weierstrass model.",
    "created_at": "2012-12-02T14:00:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18447",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:36" align="right">comment:36</div>

There is also the pointless version #13084, #13458. The way I see it, it has the advantage that you don't have to specify a point to get the Weierstrass form. The price to pay is that you don't get an explicit isomorphism with the Weierstrass cubic.

Actually, the Magma `aInvariants` function that the current code calls

```
    cmd = 'aInvariants(MinimalModel(EllipticCurve(Curve(Scheme(P, %s)),P!%s)));'%(F, P) 
    s = magma.eval(cmd) 
    return EllipticCurve(rings.RationalField(), eval(s)) 
```
implements the same algorithm as #13084, see http://magma.maths.usyd.edu.au/magma/handbook/text/1379. Which is why it doesn't return a morphism. 

I'm not entirely sure how to merge the two approaches but it seems that you should only require a point if you actually need the isomorphism to the Weierstrass model.



---

archive/issue_comments_018448.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nSure --without any points you can easily write down a W. equation for the Jacobian of the plane cubic.  Even if the cubic has no rational points, such as the famous `3x<sup>3+4y</sup>3+5z^3=0`.  But that is not usual what people want, and should have a different name (such as \"Jacobian\").",
    "created_at": "2012-12-02T14:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18448",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:37" align="right">comment:37</div>

Sure --without any points you can easily write down a W. equation for the Jacobian of the plane cubic.  Even if the cubic has no rational points, such as the famous `3x<sup>3+4y</sup>3+5z^3=0`.  But that is not usual what people want, and should have a different name (such as "Jacobian").



---

archive/issue_comments_018449.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nAnd what is done by Maple in\nhttp://www.maplesoft.com/support/help/Maple/view.aspx?path=algcurves/Weierstrassform\n?\n\nIt does return the maps in both directions without using any points.",
    "created_at": "2012-12-02T15:03:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18449",
    "user": "https://github.com/novoselt"
}
```

<div id="comment:38" align="right">comment:38</div>

And what is done by Maple in
http://www.maplesoft.com/support/help/Maple/view.aspx?path=algcurves/Weierstrassform
?

It does return the maps in both directions without using any points.



---

archive/issue_comments_018450.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@novoselt](#comment%3A38):\n> And what is done by Maple in\n> http://www.maplesoft.com/support/help/Maple/view.aspx?path=algcurves/Weierstrassform\n> ?\n> \n> It does return the maps in both directions without using any points.\n\nI have no idea.  The definition there is wrong:  an elliptic curve is not just a genus 1 curve, it is a genus one curve with a specified point.  Perhaps Maple tries to find a point (it does say that the function can be speeded up by providing one), and perhaps if there is no rational point it uses something generic, or a point defined over an extension.  Without a notion of field of definition, you could do anything.   Note that Magma's function does not require a point to be specified;  if none is given it tries to find one, uses it if it finds one and otherwise raises a run-time error.\n\nSomeone with Maple could try the Selmer curve (of my previous post) to see what it does.",
    "created_at": "2012-12-02T15:44:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18450",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@novoselt](#comment%3A38):
> And what is done by Maple in
> http://www.maplesoft.com/support/help/Maple/view.aspx?path=algcurves/Weierstrassform
> ?
> 
> It does return the maps in both directions without using any points.

I have no idea.  The definition there is wrong:  an elliptic curve is not just a genus 1 curve, it is a genus one curve with a specified point.  Perhaps Maple tries to find a point (it does say that the function can be speeded up by providing one), and perhaps if there is no rational point it uses something generic, or a point defined over an extension.  Without a notion of field of definition, you could do anything.   Note that Magma's function does not require a point to be specified;  if none is given it tries to find one, uses it if it finds one and otherwise raises a run-time error.

Someone with Maple could try the Selmer curve (of my previous post) to see what it does.



---

archive/issue_comments_018451.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI think Maple does the same as #13458: it returns a rational multi-covering. This you can also get without a point.\n\nCurrently I don't like the way the transformation is returned in this ticket. A bunch of text, really? Can't we return concatenated maps or something that can be accessed programmatically? Or, failing that, a custom python object that can be queried for the defining polynomials.\n\nThe good news is that we seem to have all relevant algorithms implemented, we just need to settle on an interface. My suggestion would be\n\nA constructor function EllipticCurve_from_curve(equation, point=None, proof=False)\nIf proof=False then just the Weierstrass form is returned using whatever algorithm is fastest (probably ignoring the given point).\nIf proof=True and no point is given, a pair (E,f) of elliptic curve and rational covering map from the curve to the Weierstrass form is returned.\nIf proof=True and a point is given, then a pair (E,f) is returned such that f is an isomorphism.\nMake EllipticCurve_from_cubic an alias for EllipticCurve_from_curve. The latter will also handle e.g. y^2=quartic(x) e.g., so it shouldn't mention cubic.",
    "created_at": "2012-12-02T15:45:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18451",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:40" align="right">comment:40</div>

I think Maple does the same as #13458: it returns a rational multi-covering. This you can also get without a point.

Currently I don't like the way the transformation is returned in this ticket. A bunch of text, really? Can't we return concatenated maps or something that can be accessed programmatically? Or, failing that, a custom python object that can be queried for the defining polynomials.

The good news is that we seem to have all relevant algorithms implemented, we just need to settle on an interface. My suggestion would be

A constructor function EllipticCurve_from_curve(equation, point=None, proof=False)
If proof=False then just the Weierstrass form is returned using whatever algorithm is fastest (probably ignoring the given point).
If proof=True and no point is given, a pair (E,f) of elliptic curve and rational covering map from the curve to the Weierstrass form is returned.
If proof=True and a point is given, then a pair (E,f) is returned such that f is an isomorphism.
Make EllipticCurve_from_cubic an alias for EllipticCurve_from_curve. The latter will also handle e.g. y^2=quartic(x) e.g., so it shouldn't mention cubic.



---

archive/issue_comments_018452.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nDoes anybody have an objection to my suggestion of implementing a constructor function `EllipticCurve_from_curve(equation, point=None, proof=False)`, or perhaps `certificate=False`, that by default returns the Weierstrass form of the Jacobian and otherwise a morphism? I can work over this ticket but it would be nice if we can agree on the interface first.",
    "created_at": "2013-02-12T11:57:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18452",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:41" align="right">comment:41</div>

Does anybody have an objection to my suggestion of implementing a constructor function `EllipticCurve_from_curve(equation, point=None, proof=False)`, or perhaps `certificate=False`, that by default returns the Weierstrass form of the Jacobian and otherwise a morphism? I can work over this ticket but it would be nice if we can agree on the interface first.



---

archive/issue_comments_018453.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@vbraun](#comment%3A41):\n> Does anybody have an objection to my suggestion\n\nNo objection, but a few comments:\n\n* Don't call it \"proof\", since your proposal always gives provenly correct output. I'm not a fan of \"certificate\" either. How about \"morphism\" or \"morphisms\"?\n* In the case of an isomorphism, could you also return its inverse?\n* When a point is provided, I would prefer the default to be to output the isomorphisms too, as most applications will need them.\n\nAnyway, thanks for picking this up again!",
    "created_at": "2013-02-12T12:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18453",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@vbraun](#comment%3A41):
> Does anybody have an objection to my suggestion

No objection, but a few comments:

* Don't call it "proof", since your proposal always gives provenly correct output. I'm not a fan of "certificate" either. How about "morphism" or "morphisms"?
* In the case of an isomorphism, could you also return its inverse?
* When a point is provided, I would prefer the default to be to output the isomorphisms too, as most applications will need them.

Anyway, thanks for picking this up again!



---

archive/issue_comments_018454.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThanks from me too.  Is the plan as follows:  input is a smooth plane cubic, possibly with a rational point.  If there is a point given then the output includes a Weierstrass model birational to the input curve, in fact  isomorphic to it, with a linear projective change of coordinates if the point was a flex and a more complicated (quadratic) map on `P^2` inducing the isomorphism otherwise;  while if there is no point given then the curve returned is the Jacobian.  In the latter case one could also return a map from the input curve to the Jacobian, namely the associated 3-covering map of degree 9.  And no attempt is made to find rational points if none are given.\n\nThat seems reasonable to me, provided that the documentation makes it clear how different the output will be in the two cases (point supplied or not).",
    "created_at": "2013-02-12T12:42:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18454",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:43" align="right">comment:43</div>

Thanks from me too.  Is the plan as follows:  input is a smooth plane cubic, possibly with a rational point.  If there is a point given then the output includes a Weierstrass model birational to the input curve, in fact  isomorphic to it, with a linear projective change of coordinates if the point was a flex and a more complicated (quadratic) map on `P^2` inducing the isomorphism otherwise;  while if there is no point given then the curve returned is the Jacobian.  In the latter case one could also return a map from the input curve to the Jacobian, namely the associated 3-covering map of degree 9.  And no attempt is made to find rational points if none are given.

That seems reasonable to me, provided that the documentation makes it clear how different the output will be in the two cases (point supplied or not).



---

archive/issue_comments_018455.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@JohnCremona](#comment%3A43):\n> If there is a point given then the output includes a Weierstrass model birational to the input curve, in fact  isomorphic to it\n\n[...]\n> In the latter case one could also return a map from the input curve to the Jacobian, namely the associated 3-covering map of degree 9.  And no attempt is made to find rational points if none are given.\n\nSince the two cases are distinct (in one case the cubic is birational over the base field to the returned curve, in the other case not necessarily) I think we cannot treat those cases silently as the same. At the very least it needs an option. I would prefer a different routine for the latter. `Jacobian` comes to mind.",
    "created_at": "2013-02-12T18:51:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18455",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@JohnCremona](#comment%3A43):
> If there is a point given then the output includes a Weierstrass model birational to the input curve, in fact  isomorphic to it

[...]
> In the latter case one could also return a map from the input curve to the Jacobian, namely the associated 3-covering map of degree 9.  And no attempt is made to find rational points if none are given.

Since the two cases are distinct (in one case the cubic is birational over the base field to the returned curve, in the other case not necessarily) I think we cannot treat those cases silently as the same. At the very least it needs an option. I would prefer a different routine for the latter. `Jacobian` comes to mind.



---

archive/issue_comments_018456.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nSo how about\n\n```\ndef EllipticCurve_from_cubic_and_point(F, P, morphism=False):\n   ...\n\ndef EllipticCurve_from_Jacobian(F, morphism=False):\n   ...\n```",
    "created_at": "2013-02-12T19:34:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18456",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:45" align="right">comment:45</div>

So how about

```
def EllipticCurve_from_cubic_and_point(F, P, morphism=False):
   ...

def EllipticCurve_from_Jacobian(F, morphism=False):
   ...
```



---

archive/issue_comments_018457.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@vbraun](#comment%3A45):\n> So how about\n> \n> ```\n> def EllipticCurve_from_cubic_and_point(F, P, morphism=False):\n>    ...\n> \n> def EllipticCurve_from_Jacobian(F, morphism=False):\n>    ...\n> ```\n\nThe latter is not right -- it's the Jacobian elliptic curve which is returned!  We could call it just Jacobian() and raise a NotImplemented error if the genus is >1?\n\nThe first is fine though rather long.",
    "created_at": "2013-02-12T19:44:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18457",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@vbraun](#comment%3A45):
> So how about
> 
> ```
> def EllipticCurve_from_cubic_and_point(F, P, morphism=False):
>    ...
> 
> def EllipticCurve_from_Jacobian(F, morphism=False):
>    ...
> ```

The latter is not right -- it's the Jacobian elliptic curve which is returned!  We could call it just Jacobian() and raise a NotImplemented error if the genus is >1?

The first is fine though rather long.



---

archive/issue_comments_018458.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@vbraun](#comment%3A45):\n> \n> ```\n> def EllipticCurve_from_cubic_and_point(F, P, morphism=False):\n> ```\n\nI think the name is a bit long, and I prefer \"True\" as the default. And can't we add this functionality to the existing constructor `EllipticCurve` instead of creating a new function?\n\n> ```\n> def EllipticCurve_from_Jacobian(F, morphism=False):\n> ```\n\n-1: the name sounds like the Jacobian is the input, while actually it is the output. Perhaps `EllipticCurveJacobian`, or add this functionality to the existing constructor `Jacobian`?",
    "created_at": "2013-02-12T19:51:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18458",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@vbraun](#comment%3A45):
> 
> ```
> def EllipticCurve_from_cubic_and_point(F, P, morphism=False):
> ```

I think the name is a bit long, and I prefer "True" as the default. And can't we add this functionality to the existing constructor `EllipticCurve` instead of creating a new function?

> ```
> def EllipticCurve_from_Jacobian(F, morphism=False):
> ```

-1: the name sounds like the Jacobian is the input, while actually it is the output. Perhaps `EllipticCurveJacobian`, or add this functionality to the existing constructor `Jacobian`?



---

archive/issue_comments_018459.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI think it should \n\n   EllipticCurve_from_cubic(F, P=None, morphism=False)\n\nand initially give an error if you don't specify P.  In many cases (in practice -- in general this is the world's most exciting open problem), one can *find* P, and that could be implemented.  \n\nIf you take a cubic F, take *any* random rational point P on F, and compute the corresponding elliptic curve, then put it in the unique minimal Weierstrass form with a_1,a_2,a_3 tiny, then the result does not depend on P.",
    "created_at": "2013-02-12T19:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18459",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:48" align="right">comment:48</div>

I think it should 

   EllipticCurve_from_cubic(F, P=None, morphism=False)

and initially give an error if you don't specify P.  In many cases (in practice -- in general this is the world's most exciting open problem), one can *find* P, and that could be implemented.  

If you take a cubic F, take *any* random rational point P on F, and compute the corresponding elliptic curve, then put it in the unique minimal Weierstrass form with a_1,a_2,a_3 tiny, then the result does not depend on P.



---

archive/issue_comments_018460.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nWe should reorganize the constructor around a tab-completable `elliptic_curve.<something>` hierarchy just like `matrix.<tab>` and `groups.<tab>`. But thats for another ticket.\n\nSo I take it we should go with\n\n```\ndef EllipticCurve_Jacobian(F, morphism=False):\n    ...\n```\nwhich would eventually become `elliptic_curve.Jacobian(...)`.",
    "created_at": "2013-02-12T20:09:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18460",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:49" align="right">comment:49</div>

We should reorganize the constructor around a tab-completable `elliptic_curve.<something>` hierarchy just like `matrix.<tab>` and `groups.<tab>`. But thats for another ticket.

So I take it we should go with

```
def EllipticCurve_Jacobian(F, morphism=False):
    ...
```
which would eventually become `elliptic_curve.Jacobian(...)`.



---

archive/issue_comments_018461.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI'm not thrilled about EllipticCurve_Jacobian for a few reasons:\n\n1. Introducing a new function into the global namespace just to deprecate it later is just very, very annoying to users.  Please don't do that.  \n\n2. Why not just \"EllipticCurve(...)\".  It is not ambiguous.  We have EllipticCurve_from_blah in some cases in order to resolve ambiguity, e.g., c4c6 and j.  But there is no ambiguity if a cubic polynomial is given.\n\n3. I would prefer adding a global Jacobian function than EllipticCurve_Jacobian.  E.g., something like\n\n```\n    def Jacobian(C, **kwds):\n        try:\n            return C.jacobian(**kwds)\n        except AttributeError:\n            if its a cubic... call your code above.\n```\n\nThere are genus 2 Jacobians, etc., for which typing Jacobian(C) (or Jac(C)) would be convenient. \n\nMaybe include Jacobian(matrix) for calculus students :-)\n\nWilliam",
    "created_at": "2013-02-12T20:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18461",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:50" align="right">comment:50</div>

I'm not thrilled about EllipticCurve_Jacobian for a few reasons:

1. Introducing a new function into the global namespace just to deprecate it later is just very, very annoying to users.  Please don't do that.  

2. Why not just "EllipticCurve(...)".  It is not ambiguous.  We have EllipticCurve_from_blah in some cases in order to resolve ambiguity, e.g., c4c6 and j.  But there is no ambiguity if a cubic polynomial is given.

3. I would prefer adding a global Jacobian function than EllipticCurve_Jacobian.  E.g., something like

```
    def Jacobian(C, **kwds):
        try:
            return C.jacobian(**kwds)
        except AttributeError:
            if its a cubic... call your code above.
```

There are genus 2 Jacobians, etc., for which typing Jacobian(C) (or Jac(C)) would be convenient. 

Maybe include Jacobian(matrix) for calculus students :-)

William



---

archive/issue_events_036755.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-02-14T18:14:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "title_is": "Weierstrass form and Jacobian for cubics and certain other genus-one curves",
    "title_was": "Weierstrass form for cubics",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36755"
}
```



---

archive/issue_comments_018462.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,35 @@\n-Implement transformations to put a general cubic (with a point) into Weierstrass form.\n+Implement transformations to put a general cubic (with a point) into Weierstrass form:\n+\n+```\n+sage: R.<u,v,w> = QQ[]\n+sage: EllipticCurve(u^3+v^3+w^3, [1,-1,0])   \n+Elliptic Curve defined by y^2 + 2*x*y - 1/3*y = x^3 - x^2 + 1/3*x - 1/27 over Rational Field\n+sage: EllipticCurve_from_cubic(u^3+v^3+w^3, [1,-1,0])\n+Scheme morphism:\n+  From: Closed subscheme of Projective Space of dimension 2 over Rational Field defined by:\n+  u^3 + v^3 + w^3\n+  To:   Elliptic Curve defined by y^2 + 2*x*y - 1/3*y = x^3 - x^2 + 1/3*x - 1/27 over Rational Field\n+  Defn: Defined on coordinates by sending (u : v : w) to\n+        (w : -v - w : -3*u - 3*v)\n+```\n+Also, Jacobians (without specifying point):\n+\n+```\n+sage: R.<u,v,w> = QQ[]\n+sage: Jacobian(u^3+v^3+w^3)\n+Elliptic Curve defined by y^2 = x^3 - 27/4 over Rational Field\n+sage: Jacobian(u^3+v^3+w^3, morphism=True)\n+Scheme morphism:\n+  From: Projective Curve over Rational Field defined by u^3 + v^3 + w^3\n+  To:   Elliptic Curve defined by y^2 = x^3 - 27/4 over Rational Field\n+  Defn: Defined on coordinates by sending (u : v : w) to\n+        (u*v^7*w + u*v^4*w^4 + u*v*w^7 : v^9 + 3/2*v^6*w^3 - 3/2*v^3*w^6 - w^9 : -v^6*w^3 - v^3*w^6)\n+```\n+\n \n Apply:\n \n-* [attachment: trac_3416_elliptic_curve_from_cubic3.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic3.patch.gz)\n+* [attachment: trac_3416_elliptic_curve_from_cubic_vb.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)\n+* [attachment: trac_3416_jacobians.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)\n \n See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.\n``````\n",
    "created_at": "2013-02-14T18:14:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18462",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,35 @@
-Implement transformations to put a general cubic (with a point) into Weierstrass form.
+Implement transformations to put a general cubic (with a point) into Weierstrass form:
+
+```
+sage: R.<u,v,w> = QQ[]
+sage: EllipticCurve(u^3+v^3+w^3, [1,-1,0])   
+Elliptic Curve defined by y^2 + 2*x*y - 1/3*y = x^3 - x^2 + 1/3*x - 1/27 over Rational Field
+sage: EllipticCurve_from_cubic(u^3+v^3+w^3, [1,-1,0])
+Scheme morphism:
+  From: Closed subscheme of Projective Space of dimension 2 over Rational Field defined by:
+  u^3 + v^3 + w^3
+  To:   Elliptic Curve defined by y^2 + 2*x*y - 1/3*y = x^3 - x^2 + 1/3*x - 1/27 over Rational Field
+  Defn: Defined on coordinates by sending (u : v : w) to
+        (w : -v - w : -3*u - 3*v)
+```
+Also, Jacobians (without specifying point):
+
+```
+sage: R.<u,v,w> = QQ[]
+sage: Jacobian(u^3+v^3+w^3)
+Elliptic Curve defined by y^2 = x^3 - 27/4 over Rational Field
+sage: Jacobian(u^3+v^3+w^3, morphism=True)
+Scheme morphism:
+  From: Projective Curve over Rational Field defined by u^3 + v^3 + w^3
+  To:   Elliptic Curve defined by y^2 = x^3 - 27/4 over Rational Field
+  Defn: Defined on coordinates by sending (u : v : w) to
+        (u*v^7*w + u*v^4*w^4 + u*v*w^7 : v^9 + 3/2*v^6*w^3 - 3/2*v^3*w^6 - w^9 : -v^6*w^3 - v^3*w^6)
+```
+
 
 Apply:
 
-* [attachment: trac_3416_elliptic_curve_from_cubic3.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic3.patch.gz)
+* [attachment: trac_3416_elliptic_curve_from_cubic_vb.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)
+* [attachment: trac_3416_jacobians.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)
 
 See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.
``````




---

archive/issue_comments_018463.json:
```json
{
    "body": "Changed author from **Niels Duif** to **Niels Duif, Volker Braun**",
    "created_at": "2013-02-14T18:14:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18463",
    "user": "https://github.com/vbraun"
}
```

Changed author from **Niels Duif** to **Niels Duif, Volker Braun**



---

archive/issue_events_036756.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-02-14T18:14:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36756"
}
```



---

archive/issue_events_036757.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-02-14T18:14:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36757"
}
```



---

archive/issue_comments_018464.json:
```json
{
    "body": "Dependencies: **#12553, #13084, #13458**",
    "created_at": "2013-02-14T18:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18464",
    "user": "https://github.com/vbraun"
}
```

Dependencies: **#12553, #13084, #13458**



---

archive/issue_comments_018465.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nFor the patchbot:\n\napply trac_3416_elliptic_curve_from_cubic_vb.patch, trac_3416_jacobians.patch",
    "created_at": "2013-02-14T18:16:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18465",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:52" align="right">comment:52</div>

For the patchbot:

apply trac_3416_elliptic_curve_from_cubic_vb.patch, trac_3416_jacobians.patch



---

archive/issue_comments_018466.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nYou have done a really nice job wit hthis.  I am in the middle of reading the code and will test it as soon as I can.",
    "created_at": "2013-02-15T13:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18466",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:53" align="right">comment:53</div>

You have done a really nice job wit hthis.  I am in the middle of reading the code and will test it as soon as I can.



---

archive/issue_comments_018467.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nI like this code, and the patches apply cleanly to 5.7.rc0 even without the dependencies applied, but doctesting fails without the dependencies.  I would like someone else to review the dependencies since I want to be able to finish reviewing this one!",
    "created_at": "2013-02-17T20:32:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18467",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:54" align="right">comment:54</div>

I like this code, and the patches apply cleanly to 5.7.rc0 even without the dependencies applied, but doctesting fails without the dependencies.  I would like someone else to review the dependencies since I want to be able to finish reviewing this one!



---

archive/issue_comments_018468.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nTiniest nitpick. In the documentation:\n\n```\nA genus one curve is a torus with a complex coordinate system\n```\nThat's only true in characteristic 0 via the Lefschetz principle (for instance, for a genus one curve over `QQ(t)` or `CC(t)` this is a decidedly painful description) and simply untrue in positive characteristic. Yet, the code here should still work without a problem for most of these. I'd say just leave this sentence out. The rest seems fine without it.",
    "created_at": "2013-02-17T21:24:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18468",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:55" align="right">comment:55</div>

Tiniest nitpick. In the documentation:

```
A genus one curve is a torus with a complex coordinate system
```
That's only true in characteristic 0 via the Lefschetz principle (for instance, for a genus one curve over `QQ(t)` or `CC(t)` this is a decidedly painful description) and simply untrue in positive characteristic. Yet, the code here should still work without a problem for most of these. I'd say just leave this sentence out. The rest seems fine without it.



---

archive/issue_comments_018469.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nThis was just my attempt to give a one-paragraph introduction of what the Jacobian is; I'm aware (and do say) that it is not 100% mathematically waterproof. How about I add a sentence that I'm just talking about CC here. I think we should at least give some idea of what a genus-one curve is thats understandable to somebody who is not a algebraic geometer or number theorist...",
    "created_at": "2013-02-17T21:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18469",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:56" align="right">comment:56</div>

This was just my attempt to give a one-paragraph introduction of what the Jacobian is; I'm aware (and do say) that it is not 100% mathematically waterproof. How about I add a sentence that I'm just talking about CC here. I think we should at least give some idea of what a genus-one curve is thats understandable to somebody who is not a algebraic geometer or number theorist...



---

archive/issue_comments_018470.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nReplying to [@vbraun](#comment%3A56):\n> This was just my attempt to give a one-paragraph introduction of what the Jacobian is; I'm aware (and do say) that it is not 100% mathematically waterproof. How about I add a sentence that I'm just talking about CC here. I think we should at least give some idea of what a genus-one curve is thats understandable to somebody who is not a algebraic geometer or number theorist...\n\nAnd then proceed to describe what an elliptic curve is in terms of line bundles :-). Including `CC` here is indeed a solution, but this code is only interesting if you consider curves over base fields *different from* `CC`.\n\nI don't think you're ever going to get a useful 1-paragraph description that's helpful for anybody who doesn't already know what a genus 1 curve is and what their Jacobians are, so I wouldn't bother and just take the terms as self-evident (and include a literature reference).\n\n(It's a slightly simplified *description* of what the module does, by the way. Not a *version*.",
    "created_at": "2013-02-17T22:24:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18470",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:57" align="right">comment:57</div>

Replying to [@vbraun](#comment%3A56):
> This was just my attempt to give a one-paragraph introduction of what the Jacobian is; I'm aware (and do say) that it is not 100% mathematically waterproof. How about I add a sentence that I'm just talking about CC here. I think we should at least give some idea of what a genus-one curve is thats understandable to somebody who is not a algebraic geometer or number theorist...

And then proceed to describe what an elliptic curve is in terms of line bundles :-). Including `CC` here is indeed a solution, but this code is only interesting if you consider curves over base fields *different from* `CC`.

I don't think you're ever going to get a useful 1-paragraph description that's helpful for anybody who doesn't already know what a genus 1 curve is and what their Jacobians are, so I wouldn't bother and just take the terms as self-evident (and include a literature reference).

(It's a slightly simplified *description* of what the module does, by the way. Not a *version*.



---

archive/issue_comments_018471.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nI agree with Nils regarding the documentation -- no textbook needed!",
    "created_at": "2013-02-17T22:31:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18471",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:58" align="right">comment:58</div>

I agree with Nils regarding the documentation -- no textbook needed!



---

archive/issue_comments_018472.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nThanks for all the work! I have not looked at it in detail, but do have a few comments:\n\n* The following worked without the patch (using Magma), but gives a `ZeroDivisionError` with the patch: (see also [here](#comment%3A27))\n> \n> ```\n> sage: P.<x,y,z> = QQ[]\n> sage: EllipticCurve_from_cubic(x^3+y^3+z^3, [-1,0,1])\n> \u2026\n> ZeroDivisionError: \n> ```\n\n  That is because the code this patch is built on is incomplete (it misses a few such cases).\n\n* There is a backwards incompatibility in `EllipticCurve_from_cubic`. Input:\n\n  ```\n  sage: P.<X,Y,Z> = QQ[]                               \n  sage: EllipticCurve_from_cubic(X^3+Y^3+Z^3, [1,-1,0])\n  ```\n  Output: an elliptic curve without the patch, a morphism with the patch\n\n* Why not add a \"morphism\" parameter to `EllipticCurve` too? That way, `EllipticCurve_from_cubic` is not needed at all. This will make the global namespace smaller (leading to smaller startup times and less confusion on which function to use when). And as an added bonus, it allows a smooth deprecation of `EllipticCurve_from_cubic`, rather than the backwards incompatibility mentioned above.\n\n* When I do\n\n  ```\n  sage: Jacobian?\n  ```\n  I get \n\n  ```\n  ...\n  Source File:    /scratch/tsg250/sage-5.5.rc0/devel/sage/sage/misc/lazy_import.so\n  ...\n       * A polynomial, see \"Jacobian_of_equation()\" for details.\n    \n       * A curve, see \"Jacobian_of_curve()\" for details.\n  ```\n  But \"`Jacobian_of_equation?`\" and \"`Jacobian_of_curve?`\" don't work, because they are not in the global namespace. And it takes some effort to find out that\n\n  ```\n  sage: sage.schemes.elliptic_curves.jacobian.Jacobian_of_curve?\n  ```\n  works, unless someone first tells me that `Jacobian_of_curve` is in `sage.schemes.elliptic_curves.jacobian`.",
    "created_at": "2013-02-18T10:09:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18472",
    "user": "https://github.com/mstreng"
}
```

<div id="comment:59" align="right">comment:59</div>

Thanks for all the work! I have not looked at it in detail, but do have a few comments:

* The following worked without the patch (using Magma), but gives a `ZeroDivisionError` with the patch: (see also [here](#comment%3A27))
> 
> ```
> sage: P.<x,y,z> = QQ[]
> sage: EllipticCurve_from_cubic(x^3+y^3+z^3, [-1,0,1])
> 
> ZeroDivisionError: 
> ```

  That is because the code this patch is built on is incomplete (it misses a few such cases).

* There is a backwards incompatibility in `EllipticCurve_from_cubic`. Input:

  ```
  sage: P.<X,Y,Z> = QQ[]                               
  sage: EllipticCurve_from_cubic(X^3+Y^3+Z^3, [1,-1,0])
  ```
  Output: an elliptic curve without the patch, a morphism with the patch

* Why not add a "morphism" parameter to `EllipticCurve` too? That way, `EllipticCurve_from_cubic` is not needed at all. This will make the global namespace smaller (leading to smaller startup times and less confusion on which function to use when). And as an added bonus, it allows a smooth deprecation of `EllipticCurve_from_cubic`, rather than the backwards incompatibility mentioned above.

* When I do

  ```
  sage: Jacobian?
  ```
  I get 

  ```
  ...
  Source File:    /scratch/tsg250/sage-5.5.rc0/devel/sage/sage/misc/lazy_import.so
  ...
       * A polynomial, see "Jacobian_of_equation()" for details.
    
       * A curve, see "Jacobian_of_curve()" for details.
  ```
  But "`Jacobian_of_equation?`" and "`Jacobian_of_curve?`" don't work, because they are not in the global namespace. And it takes some effort to find out that

  ```
  sage: sage.schemes.elliptic_curves.jacobian.Jacobian_of_curve?
  ```
  works, unless someone first tells me that `Jacobian_of_curve` is in `sage.schemes.elliptic_curves.jacobian`.



---

archive/issue_comments_018473.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nThe old `EllipticCurve_from_cubic` just computed the Jacobian using Magma. So, strictly speaking, we replace the wrong output with the correct output. Its intentionally backwards incompatible.\n\nI don't particularly like adding extra keyword arguments to `EllipticCurve` that only make sense in very special circumstances. If you want to reduce the number of global symbols, which I'm all in favor of, then one should combine the constructors into a class `EllipticCurve.from_foobar()` to disambiguate.\n\nThat'll also fix your last problem that the HTML hyperlinks don't translate particularly well into the text-mode help.",
    "created_at": "2013-02-18T14:08:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18473",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:60" align="right">comment:60</div>

The old `EllipticCurve_from_cubic` just computed the Jacobian using Magma. So, strictly speaking, we replace the wrong output with the correct output. Its intentionally backwards incompatible.

I don't particularly like adding extra keyword arguments to `EllipticCurve` that only make sense in very special circumstances. If you want to reduce the number of global symbols, which I'm all in favor of, then one should combine the constructors into a class `EllipticCurve.from_foobar()` to disambiguate.

That'll also fix your last problem that the HTML hyperlinks don't translate particularly well into the text-mode help.



---

archive/issue_comments_018474.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@vbraun](#comment%3A60):\n> I don't particularly like adding extra keyword arguments to `EllipticCurve` that only make sense in very special circumstances. If you want to reduce the number of global symbols, which I'm all in favor of, then one should combine the constructors into a class `EllipticCurve.from_foobar()` to disambiguate.\n\nWhether an (iso)morphism should be returned as well applies to more than very special circumstances. When creating an elliptic curve from a given algebraic curve plus rational point it's always relevant. In fact, keeping track of the transformations involved really does cost extra work, especially if you want the inverse as well. I doubt someone's going to bother to write a faster version that doesn't track the morphism, but as a general user interface it makes sense.\n\nRoutines are usually named after the thing they produce, so from `EllipticCurve_from_cubic` one expects an elliptic curve. `Isomorphism_from_cubic_curve_to_jacobian` would produce a morphism. Unless you claim `EllipticCurve_from_cubic` is only an internal routine, in which case it can return anything it likes.\n\nI don't quite know how to return extra optional information. We could return a tuple with as a second value the morphism so that we get the extremely magmaesque\n\n```\nE,phi = EllipticCurve_from_cubic(x^3+y^3+z^3,[1,0,-1],morphism=True)\n```\nbut that does mean the return type changes significantly upon supplying a keyword argument. Mandating\n\n```\nE, = EllipticCurve_from_cubic(x^3+y^3+z^3,[1,0,-1],morphism=False)\n```\nseems a no-go.\n\nI like the idea of returning morphisms to package up all relevant information. I did so quite a bit in Magma. I've noticed that this wasn't picked up by other users/authors, though, and that a few interface routines grew that picked apart the morphisms and returned domain and codomain separately. Perhaps that provides you with a data point of how successful morphism-based return values are in practice. It seems the majority of the mathematicians prefer to concentrate on the dots rather than the arrows ...",
    "created_at": "2013-02-18T17:06:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18474",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@vbraun](#comment%3A60):
> I don't particularly like adding extra keyword arguments to `EllipticCurve` that only make sense in very special circumstances. If you want to reduce the number of global symbols, which I'm all in favor of, then one should combine the constructors into a class `EllipticCurve.from_foobar()` to disambiguate.

Whether an (iso)morphism should be returned as well applies to more than very special circumstances. When creating an elliptic curve from a given algebraic curve plus rational point it's always relevant. In fact, keeping track of the transformations involved really does cost extra work, especially if you want the inverse as well. I doubt someone's going to bother to write a faster version that doesn't track the morphism, but as a general user interface it makes sense.

Routines are usually named after the thing they produce, so from `EllipticCurve_from_cubic` one expects an elliptic curve. `Isomorphism_from_cubic_curve_to_jacobian` would produce a morphism. Unless you claim `EllipticCurve_from_cubic` is only an internal routine, in which case it can return anything it likes.

I don't quite know how to return extra optional information. We could return a tuple with as a second value the morphism so that we get the extremely magmaesque

```
E,phi = EllipticCurve_from_cubic(x^3+y^3+z^3,[1,0,-1],morphism=True)
```
but that does mean the return type changes significantly upon supplying a keyword argument. Mandating

```
E, = EllipticCurve_from_cubic(x^3+y^3+z^3,[1,0,-1],morphism=False)
```
seems a no-go.

I like the idea of returning morphisms to package up all relevant information. I did so quite a bit in Magma. I've noticed that this wasn't picked up by other users/authors, though, and that a few interface routines grew that picked apart the morphisms and returned domain and codomain separately. Perhaps that provides you with a data point of how successful morphism-based return values are in practice. It seems the majority of the mathematicians prefer to concentrate on the dots rather than the arrows ...



---

archive/issue_comments_018475.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nAnother possibility (which is easy in Python) is to enhance objects with extra structure. For example,\n\n```\nsage: K.<a,b> = NumberField([x^2+1,x^3-2]); K\nNumber Field in a with defining polynomial x^2 + 1 over its base field\nsage: L.<c> = K.absolute_field(); L\nNumber Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5\nsage: L.structure()\n(Isomorphism map:\n  From: Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5\n  To:   Number Field in a with defining polynomial x^2 + 1 over its base field, Isomorphism map:\n  From: Number Field in a with defining polynomial x^2 + 1 over its base field\n  To:   Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5)\n```\n\nIn our case, we could do:\n\n```\nsage: E = EllipticCurve_from_cubic(x^3+y^3+z^3, [1,0,-1])\nsage: E.extra_defining_data()\n{'cubic':x^3+y^3+z^3, 'morphism':..., 'point':[1,0,-1]}\n```\n\nIf the morphism gets computed, it's there; if it doesn't get computed, it isn't.\nWhether or not it gets computed can be determined as you suggest\n\n```\nE = EllipticCurve_from_cubic(x^3+y^3+z^3, [1,0,-1], morphism=False)\n```\nBUT the input does not impact the return type -- you get an elliptic curve no matter what.\n\nI not sure I agree with the assertion that people/algorithms will always compute the morphism.  There are alternative algorithms for computing the jacobian of a genus 1 curve that give the Jacobian without giving the morphism -- one involves computing the a_p and doing a search for curves with those a_p, and another involves \"Fermionic Fock Spaces\" (I think). \n\nTo me the above proposal fits better with how one thinks in mathematics; when you construct one object from another, you might as well remember you did so, and take advantage of it. \n\nAnother possibility would be to add a \"jacobian_structure()\" method to elliptic curves, which usually returns the identity map E-->E, but in the above case, returns a morphism X-->E.  More generally, it could return a simply transitive group-object, i.e., a map E x X --> X, but that's getting complicated.",
    "created_at": "2013-02-18T17:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18475",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:62" align="right">comment:62</div>

Another possibility (which is easy in Python) is to enhance objects with extra structure. For example,

```
sage: K.<a,b> = NumberField([x^2+1,x^3-2]); K
Number Field in a with defining polynomial x^2 + 1 over its base field
sage: L.<c> = K.absolute_field(); L
Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5
sage: L.structure()
(Isomorphism map:
  From: Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5
  To:   Number Field in a with defining polynomial x^2 + 1 over its base field, Isomorphism map:
  From: Number Field in a with defining polynomial x^2 + 1 over its base field
  To:   Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5)
```

In our case, we could do:

```
sage: E = EllipticCurve_from_cubic(x^3+y^3+z^3, [1,0,-1])
sage: E.extra_defining_data()
{'cubic':x^3+y^3+z^3, 'morphism':..., 'point':[1,0,-1]}
```

If the morphism gets computed, it's there; if it doesn't get computed, it isn't.
Whether or not it gets computed can be determined as you suggest

```
E = EllipticCurve_from_cubic(x^3+y^3+z^3, [1,0,-1], morphism=False)
```
BUT the input does not impact the return type -- you get an elliptic curve no matter what.

I not sure I agree with the assertion that people/algorithms will always compute the morphism.  There are alternative algorithms for computing the jacobian of a genus 1 curve that give the Jacobian without giving the morphism -- one involves computing the a_p and doing a search for curves with those a_p, and another involves "Fermionic Fock Spaces" (I think). 

To me the above proposal fits better with how one thinks in mathematics; when you construct one object from another, you might as well remember you did so, and take advantage of it. 

Another possibility would be to add a "jacobian_structure()" method to elliptic curves, which usually returns the identity map E-->E, but in the above case, returns a morphism X-->E.  More generally, it could return a simply transitive group-object, i.e., a map E x X --> X, but that's getting complicated.



---

archive/issue_comments_018476.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nI just want to point out that this is all more complicated and less discoverable than just returning the morphism. Even if the function is not called `Morphism_from_cubic_to_elliptic_curve` I think we are smart enough to guess what the result means. \n\nFor the record, this is the current state:\n* `EllipticCurve(x<sup>3+y</sup>3+z^3, [1,-1,0])` returns elliptic curve\n* `EllipticCurve_from_cubic(x<sup>3+y</sup>3+z^3, [1,-1,0])` returns morphism\n* `EllipticCurve_from_cubic(x<sup>3+y</sup>3+z^3, [1,-1,0], morphism=True)` returns morphism\n* `EllipticCurve_from_cubic(x<sup>3+y</sup>3+z^3, [1,-1,0], morphism=False)` returns elliptic curve\n* `Jacobian(x<sup>3+y</sup>3+z^3)` returns elliptic curve\n* `Jacobian(x<sup>3+y</sup>3+z^3, morphism=False)` returns elliptic curve\n* `Jacobian(x<sup>3+y</sup>3+z^3, morphism=True)` returns morphism (but not isomorphism)\n\nWe can always tack on defining data to the elliptic curve in another ticket, so imho the only discussion that is relevant to this ticket is whether `morphism` should default to true or false.",
    "created_at": "2013-02-18T18:23:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18476",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:63" align="right">comment:63</div>

I just want to point out that this is all more complicated and less discoverable than just returning the morphism. Even if the function is not called `Morphism_from_cubic_to_elliptic_curve` I think we are smart enough to guess what the result means. 

For the record, this is the current state:
* `EllipticCurve(x<sup>3+y</sup>3+z^3, [1,-1,0])` returns elliptic curve
* `EllipticCurve_from_cubic(x<sup>3+y</sup>3+z^3, [1,-1,0])` returns morphism
* `EllipticCurve_from_cubic(x<sup>3+y</sup>3+z^3, [1,-1,0], morphism=True)` returns morphism
* `EllipticCurve_from_cubic(x<sup>3+y</sup>3+z^3, [1,-1,0], morphism=False)` returns elliptic curve
* `Jacobian(x<sup>3+y</sup>3+z^3)` returns elliptic curve
* `Jacobian(x<sup>3+y</sup>3+z^3, morphism=False)` returns elliptic curve
* `Jacobian(x<sup>3+y</sup>3+z^3, morphism=True)` returns morphism (but not isomorphism)

We can always tack on defining data to the elliptic curve in another ticket, so imho the only discussion that is relevant to this ticket is whether `morphism` should default to true or false.



---

archive/issue_comments_018477.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nReplying to [@williamstein](#comment%3A62):\n> Another possibility (which is easy in Python) is to enhance objects with extra structure. For example,\n> \n> ```\n> sage: K.<a,b> = NumberField([x^2+1,x^3-2]); K\n> Number Field in a with defining polynomial x^2 + 1 over its base field\n> sage: L.<c> = K.absolute_field(); L\n> Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5\n> sage: L.structure()\n> (Isomorphism map:\n>   From: Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5\n>   To:   Number Field in a with defining polynomial x^2 + 1 over its base field, Isomorphism map:\n>   From: Number Field in a with defining polynomial x^2 + 1 over its base field\n>   To:   Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5)\n> ```\n\nAren't elliptic curves parents as well? That means they're unique. That makes it difficult to hang such information off them, because it means that all this structure information must be part of the constructor input.\n\nThe natural implementation of a lot of these constructors would be via a factory function that will punt to `EllipticCurve([a1,a2,a3,a4,a6])` to actually create the elliptic curve, so at the moment of \"unique instantiation\" the extra data isn't naturally available.\n\nYou can't go scribbling into fields on this elliptic curve because you risk overwriting information another constructor has already put there and which might still be relied upon elsewhere in the code.\n\nI'm starting to doubt that having unique parents is such a good design decision. Making one of the most complex objects in your system immutable complicates a lot of things.",
    "created_at": "2013-02-18T18:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18477",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:64" align="right">comment:64</div>

Replying to [@williamstein](#comment%3A62):
> Another possibility (which is easy in Python) is to enhance objects with extra structure. For example,
> 
> ```
> sage: K.<a,b> = NumberField([x^2+1,x^3-2]); K
> Number Field in a with defining polynomial x^2 + 1 over its base field
> sage: L.<c> = K.absolute_field(); L
> Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5
> sage: L.structure()
> (Isomorphism map:
>   From: Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5
>   To:   Number Field in a with defining polynomial x^2 + 1 over its base field, Isomorphism map:
>   From: Number Field in a with defining polynomial x^2 + 1 over its base field
>   To:   Number Field in c with defining polynomial x^6 + 3*x^4 + 4*x^3 + 3*x^2 - 12*x + 5)
> ```

Aren't elliptic curves parents as well? That means they're unique. That makes it difficult to hang such information off them, because it means that all this structure information must be part of the constructor input.

The natural implementation of a lot of these constructors would be via a factory function that will punt to `EllipticCurve([a1,a2,a3,a4,a6])` to actually create the elliptic curve, so at the moment of "unique instantiation" the extra data isn't naturally available.

You can't go scribbling into fields on this elliptic curve because you risk overwriting information another constructor has already put there and which might still be relied upon elsewhere in the code.

I'm starting to doubt that having unique parents is such a good design decision. Making one of the most complex objects in your system immutable complicates a lot of things.



---

archive/issue_comments_018478.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nTotally OT, but elliptic curves currently don't even attempt to be unique:\n\n```\nsage: EllipticCurve('37b2') is EllipticCurve('37b2')\nFalse\n```",
    "created_at": "2013-02-18T19:09:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18478",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:65" align="right">comment:65</div>

Totally OT, but elliptic curves currently don't even attempt to be unique:

```
sage: EllipticCurve('37b2') is EllipticCurve('37b2')
False
```



---

archive/issue_comments_018479.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@vbraun](#comment%3A65):\n> Totally OT, but elliptic curves currently don't even attempt to be unique.\n\nOK! perhaps elliptic curves provide a way out of the quagmire of uniqueness of parents:\n\n```\nsage: E=EllipticCurve([1,2,3,4,3])\nsage: E([0,1,0])\n(0 : 1 : 0)\nsage: P=E([0,1,0])\nsage: P.parent()\nAbelian group of points on Elliptic Curve defined by y^2 + x*y + 3*y = x^3 + 2*x^2 + 4*x + 3 over Rational Field\n```\nIt seems elliptic curves are parents: `E.parent()` gives an error and `E.category()` does not (although it returns a rather questionable \"Category of sets\", but who cares), but the example above suggest they don't actually occur as parents of elements. I guess they do occur as domains and codomains of maps, though (see `E.multiplication_by_m_isogeny(2)`). If those get trapped in the coercion framework, something might choke on uniqueness assumptions.",
    "created_at": "2013-02-18T21:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18479",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@vbraun](#comment%3A65):
> Totally OT, but elliptic curves currently don't even attempt to be unique.

OK! perhaps elliptic curves provide a way out of the quagmire of uniqueness of parents:

```
sage: E=EllipticCurve([1,2,3,4,3])
sage: E([0,1,0])
(0 : 1 : 0)
sage: P=E([0,1,0])
sage: P.parent()
Abelian group of points on Elliptic Curve defined by y^2 + x*y + 3*y = x^3 + 2*x^2 + 4*x + 3 over Rational Field
```
It seems elliptic curves are parents: `E.parent()` gives an error and `E.category()` does not (although it returns a rather questionable "Category of sets", but who cares), but the example above suggest they don't actually occur as parents of elements. I guess they do occur as domains and codomains of maps, though (see `E.multiplication_by_m_isogeny(2)`). If those get trapped in the coercion framework, something might choke on uniqueness assumptions.



---

archive/issue_comments_018480.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@williamstein](#comment%3A62):\n\n> I not sure I agree with the assertion that people/algorithms will always compute the morphism.  There are alternative algorithms for computing the jacobian of a genus 1 curve that give the Jacobian without giving the morphism -- one involves computing the a_p and doing a search for curves with those a_p, and another involves \"Fermionic Fock Spaces\" (I think). \n> \n\nA basic (plane cubic) --> (Jacobian elliptic curve) function could be very much simpler, you just compute the classical S, T invariants as in Salmon and these are the c4,c6 (up to constant factors) of the Jacobian.\n\nMy guess is that most of the use this function will get will be from people who want to find rational points on the elliptic curve and map them back to \"their\" cubic, so we should make this easy and not requiring a PhD to understand.",
    "created_at": "2013-02-19T08:51:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18480",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@williamstein](#comment%3A62):

> I not sure I agree with the assertion that people/algorithms will always compute the morphism.  There are alternative algorithms for computing the jacobian of a genus 1 curve that give the Jacobian without giving the morphism -- one involves computing the a_p and doing a search for curves with those a_p, and another involves "Fermionic Fock Spaces" (I think). 
> 

A basic (plane cubic) --> (Jacobian elliptic curve) function could be very much simpler, you just compute the classical S, T invariants as in Salmon and these are the c4,c6 (up to constant factors) of the Jacobian.

My guess is that most of the use this function will get will be from people who want to find rational points on the elliptic curve and map them back to "their" cubic, so we should make this easy and not requiring a PhD to understand.



---

archive/issue_comments_018481.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@JohnCremona](#comment%3A67):\n> A basic (plane cubic) --> (Jacobian elliptic curve) function could be very much simpler, you just compute the classical S, T invariants as in Salmon and these are the c4,c6 (up to constant factors) of the Jacobian.\n\nThis is precisely what `Jacobian()` does, for the record.",
    "created_at": "2013-02-19T15:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18481",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@JohnCremona](#comment%3A67):
> A basic (plane cubic) --> (Jacobian elliptic curve) function could be very much simpler, you just compute the classical S, T invariants as in Salmon and these are the c4,c6 (up to constant factors) of the Jacobian.

This is precisely what `Jacobian()` does, for the record.



---

archive/issue_comments_018482.json:
```json
{
    "body": "Attachment: **[trac_3416_jacobians.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)**\n\nImproved patch",
    "created_at": "2013-02-24T03:01:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18482",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_3416_jacobians.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)**

Improved patch



---

archive/issue_comments_018483.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,5 +31,6 @@\n \n * [attachment: trac_3416_elliptic_curve_from_cubic_vb.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)\n * [attachment: trac_3416_jacobians.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)\n+* [attachment: trac_3416_fixes.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_fixes.patch.gz)\n \n See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.\n``````\n",
    "created_at": "2013-02-24T03:15:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18483",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,5 +31,6 @@
 
 * [attachment: trac_3416_elliptic_curve_from_cubic_vb.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)
 * [attachment: trac_3416_jacobians.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)
+* [attachment: trac_3416_fixes.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_fixes.patch.gz)
 
 See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.
``````




---

archive/issue_comments_018484.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nThe last patch fixes Miguel's `ZeroDivisionError` and sanitizes the code that was responsible for coordinate choices for the Weierstrass form.\n\nI've also removed any attempt at explaining what a genus-one curve is in the jacobian module.",
    "created_at": "2013-02-24T03:15:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18484",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:69" align="right">comment:69</div>

The last patch fixes Miguel's `ZeroDivisionError` and sanitizes the code that was responsible for coordinate choices for the Weierstrass form.

I've also removed any attempt at explaining what a genus-one curve is in the jacobian module.



---

archive/issue_comments_018485.json:
```json
{
    "body": "Attachment: **[trac_3416_elliptic_curve_from_cubic_vb.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)**\n\nUpdated patch",
    "created_at": "2013-05-17T17:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18485",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_3416_elliptic_curve_from_cubic_vb.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)**

Updated patch



---

archive/issue_comments_018486.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nPatch updated for sage-5.10.beta3",
    "created_at": "2013-05-17T17:34:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18486",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:70" align="right">comment:70</div>

Patch updated for sage-5.10.beta3



---

archive/issue_comments_018487.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nThe three patches apply fine to 5.11.beta3;  doing some testing now.",
    "created_at": "2013-06-26T13:33:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18487",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:71" align="right">comment:71</div>

The three patches apply fine to 5.11.beta3;  doing some testing now.



---

archive/issue_comments_018488.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nI get doctest failures in jacobian.py.   Al else in the elliptic_curves directory pass.\n\nSecondly,  in are_projectively_equivalent(P, Q) the function and exit with True as soon as the condition ratio[0]*p == ratio[1]*q holds, so those two lines should be replaced by\n\n```\nelse return ratio[0]*p == ratio[1]*q: \n```\nbut I don't know why the function does not just \n\n```\nreturn Matrix([P,Q]).rank() < 2 \n```\n?",
    "created_at": "2013-06-26T13:43:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18488",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:72" align="right">comment:72</div>

I get doctest failures in jacobian.py.   Al else in the elliptic_curves directory pass.

Secondly,  in are_projectively_equivalent(P, Q) the function and exit with True as soon as the condition ratio[0]*p == ratio[1]*q holds, so those two lines should be replaced by

```
else return ratio[0]*p == ratio[1]*q: 
```
but I don't know why the function does not just 

```
return Matrix([P,Q]).rank() < 2 
```
?



---

archive/issue_comments_018489.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nWhich doctest is failing? They all pass on my machine (also sage-5.11.beta3)\n\nI don't have a strong preference on how `are_projectively_equivalent()` should implement the check, I just kept that from the previous patch. Constructing a matrix and computing its rank incurs some overhead but that doesn't really matter here, so the matrix version should be used.",
    "created_at": "2013-06-26T14:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18489",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:73" align="right">comment:73</div>

Which doctest is failing? They all pass on my machine (also sage-5.11.beta3)

I don't have a strong preference on how `are_projectively_equivalent()` should implement the check, I just kept that from the previous patch. Constructing a matrix and computing its rank incurs some overhead but that doesn't really matter here, so the matrix version should be used.



---

archive/issue_comments_018490.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nSorry, I had assumed that the problem would be reproducible.  This is with 5.11.beta3 on which I had done nothing at all before adding the three patches:\n\n```\njec@fermat%../../sage -t sage/schemes/elliptic_curves/jacobian.py \nRunning doctests with ID 2013-06-26-17-52-06-6d628e14.\nDoctesting 1 file.\nsage -t sage/schemes/elliptic_curves/jacobian.py\n**********************************************************************\nFile \"sage/schemes/elliptic_curves/jacobian.py\", line 94, in sage.schemes.elliptic_curves.jacobian.Jacobian\nFailed example:\n    Jacobian(C, morphism=True)\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 486, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 845, in execute\n        exec compiled in globs\n      File \"<doctest sage.schemes.elliptic_curves.jacobian.Jacobian[7]>\", line 1, in <module>\n        Jacobian(C, morphism=True)\n      File \"lazy_import.pyx\", line 313, in sage.misc.lazy_import.LazyImport.__call__ (sage/misc/lazy_import.c:2475)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py\", line 120, in Jacobian\n        return Jacobian_of_curve(X, morphism=morphism, **kwds)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py\", line 151, in Jacobian_of_curve\n        return Jacobian_of_equation(eqn, curve=curve)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py\", line 235, in Jacobian_of_equation\n        X, Y, Z = WeierstrassForm(polynomial, variables=variables, transformation=True)\n    TypeError: WeierstrassForm() got an unexpected keyword argument 'transformation'\n**********************************************************************\nFile \"sage/schemes/elliptic_curves/jacobian.py\", line 192, in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation\nFailed example:\n    h = Jacobian(f, curve=Curve(f));  h\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 486, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 845, in execute\n        exec compiled in globs\n      File \"<doctest sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation[4]>\", line 1, in <module>\n        h = Jacobian(f, curve=Curve(f));  h\n      File \"lazy_import.pyx\", line 313, in sage.misc.lazy_import.LazyImport.__call__ (sage/misc/lazy_import.c:2475)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py\", line 116, in Jacobian\n        return Jacobian_of_equation(X, **kwds)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py\", line 235, in Jacobian_of_equation\n        X, Y, Z = WeierstrassForm(polynomial, variables=variables, transformation=True)\n    TypeError: WeierstrassForm() got an unexpected keyword argument 'transformation'\n**********************************************************************\nFile \"sage/schemes/elliptic_curves/jacobian.py\", line 200, in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation\nFailed example:\n    h([1,-1,0])\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 486, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 845, in execute\n        exec compiled in globs\n      File \"<doctest sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation[5]>\", line 1, in <module>\n        h([Integer(1),-Integer(1),Integer(0)])\n    NameError: name 'h' is not defined\n**********************************************************************\nFile \"sage/schemes/elliptic_curves/jacobian.py\", line 206, in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation\nFailed example:\n    E = h.codomain()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 486, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 845, in execute\n        exec compiled in globs\n      File \"<doctest sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation[6]>\", line 1, in <module>\n        E = h.codomain()\n    NameError: name 'h' is not defined\n**********************************************************************\nFile \"sage/schemes/elliptic_curves/jacobian.py\", line 207, in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation\nFailed example:\n    E.defining_polynomial()(h.defining_polynomials()).factor()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 486, in _run\n        self.execute(example, compiled, test.globs)\n      File \"/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 845, in execute\n        exec compiled in globs\n      File \"<doctest sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation[7]>\", line 1, in <module>\n        E.defining_polynomial()(h.defining_polynomials()).factor()\n    NameError: name 'E' is not defined\n**********************************************************************\n2 items had failures:\n   1 of   9 in sage.schemes.elliptic_curves.jacobian.Jacobian\n   4 of  13 in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation\n    [39 tests, 5 failures, 2.61 s]\n----------------------------------------------------------------------\nsage -t sage/schemes/elliptic_curves/jacobian.py  # 5 doctests failed\n```\n\nNote that\n\n```\nsage: search_def(\"WeierstrassForm\")\nschemes/toric/weierstrass.py:355:def WeierstrassForm(polynomial, variables=None):\nschemes/toric/weierstrass.py:614:def WeierstrassForm_P2(polynomial, variables=None):\nschemes/toric/weierstrass.py:814:def WeierstrassForm_P1xP1(biquadric, variables=None):\nschemes/toric/weierstrass.py:952:def WeierstrassForm_P2_112(polynomial, variables=None):\n```\nIs there a missing dependency?",
    "created_at": "2013-06-26T16:56:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18490",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:74" align="right">comment:74</div>

Sorry, I had assumed that the problem would be reproducible.  This is with 5.11.beta3 on which I had done nothing at all before adding the three patches:

```
jec@fermat%../../sage -t sage/schemes/elliptic_curves/jacobian.py 
Running doctests with ID 2013-06-26-17-52-06-6d628e14.
Doctesting 1 file.
sage -t sage/schemes/elliptic_curves/jacobian.py
**********************************************************************
File "sage/schemes/elliptic_curves/jacobian.py", line 94, in sage.schemes.elliptic_curves.jacobian.Jacobian
Failed example:
    Jacobian(C, morphism=True)
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 486, in _run
        self.execute(example, compiled, test.globs)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 845, in execute
        exec compiled in globs
      File "<doctest sage.schemes.elliptic_curves.jacobian.Jacobian[7]>", line 1, in <module>
        Jacobian(C, morphism=True)
      File "lazy_import.pyx", line 313, in sage.misc.lazy_import.LazyImport.__call__ (sage/misc/lazy_import.c:2475)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py", line 120, in Jacobian
        return Jacobian_of_curve(X, morphism=morphism, **kwds)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py", line 151, in Jacobian_of_curve
        return Jacobian_of_equation(eqn, curve=curve)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py", line 235, in Jacobian_of_equation
        X, Y, Z = WeierstrassForm(polynomial, variables=variables, transformation=True)
    TypeError: WeierstrassForm() got an unexpected keyword argument 'transformation'
**********************************************************************
File "sage/schemes/elliptic_curves/jacobian.py", line 192, in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation
Failed example:
    h = Jacobian(f, curve=Curve(f));  h
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 486, in _run
        self.execute(example, compiled, test.globs)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 845, in execute
        exec compiled in globs
      File "<doctest sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation[4]>", line 1, in <module>
        h = Jacobian(f, curve=Curve(f));  h
      File "lazy_import.pyx", line 313, in sage.misc.lazy_import.LazyImport.__call__ (sage/misc/lazy_import.c:2475)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py", line 116, in Jacobian
        return Jacobian_of_equation(X, **kwds)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/jacobian.py", line 235, in Jacobian_of_equation
        X, Y, Z = WeierstrassForm(polynomial, variables=variables, transformation=True)
    TypeError: WeierstrassForm() got an unexpected keyword argument 'transformation'
**********************************************************************
File "sage/schemes/elliptic_curves/jacobian.py", line 200, in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation
Failed example:
    h([1,-1,0])
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 486, in _run
        self.execute(example, compiled, test.globs)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 845, in execute
        exec compiled in globs
      File "<doctest sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation[5]>", line 1, in <module>
        h([Integer(1),-Integer(1),Integer(0)])
    NameError: name 'h' is not defined
**********************************************************************
File "sage/schemes/elliptic_curves/jacobian.py", line 206, in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation
Failed example:
    E = h.codomain()
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 486, in _run
        self.execute(example, compiled, test.globs)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 845, in execute
        exec compiled in globs
      File "<doctest sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation[6]>", line 1, in <module>
        E = h.codomain()
    NameError: name 'h' is not defined
**********************************************************************
File "sage/schemes/elliptic_curves/jacobian.py", line 207, in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation
Failed example:
    E.defining_polynomial()(h.defining_polynomials()).factor()
Exception raised:
    Traceback (most recent call last):
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 486, in _run
        self.execute(example, compiled, test.globs)
      File "/home/jec/sage-5.11.beta3/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 845, in execute
        exec compiled in globs
      File "<doctest sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation[7]>", line 1, in <module>
        E.defining_polynomial()(h.defining_polynomials()).factor()
    NameError: name 'E' is not defined
**********************************************************************
2 items had failures:
   1 of   9 in sage.schemes.elliptic_curves.jacobian.Jacobian
   4 of  13 in sage.schemes.elliptic_curves.jacobian.Jacobian_of_equation
    [39 tests, 5 failures, 2.61 s]
----------------------------------------------------------------------
sage -t sage/schemes/elliptic_curves/jacobian.py  # 5 doctests failed
```

Note that

```
sage: search_def("WeierstrassForm")
schemes/toric/weierstrass.py:355:def WeierstrassForm(polynomial, variables=None):
schemes/toric/weierstrass.py:614:def WeierstrassForm_P2(polynomial, variables=None):
schemes/toric/weierstrass.py:814:def WeierstrassForm_P1xP1(biquadric, variables=None):
schemes/toric/weierstrass.py:952:def WeierstrassForm_P2_112(polynomial, variables=None):
```
Is there a missing dependency?



---

archive/issue_comments_018491.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nThe `transformation` keyword argument is from #13458, which is listed as a dependency",
    "created_at": "2013-06-26T17:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18491",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:75" align="right">comment:75</div>

The `transformation` keyword argument is from #13458, which is listed as a dependency



---

archive/issue_comments_018492.json:
```json
{
    "body": "Attachment: **[trac_3416_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_fixes.patch.gz)**\n\nUpdated patch",
    "created_at": "2013-06-26T17:04:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18492",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_3416_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_fixes.patch.gz)**

Updated patch



---

archive/issue_comments_018493.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nI've switched `are_projectively_equvalent` to the matrix version in the updated patch.",
    "created_at": "2013-06-26T17:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18493",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:76" align="right">comment:76</div>

I've switched `are_projectively_equvalent` to the matrix version in the updated patch.



---

archive/issue_comments_018494.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@vbraun](#comment%3A75):\n> The `transformation` keyword argument is from #13458, which is listed as a dependency\n\nVery sorry: I'm sure when I looked all three had the line through (I cannot see the colours very well).\nTesting again, with your new revision...",
    "created_at": "2013-06-26T17:09:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18494",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@vbraun](#comment%3A75):
> The `transformation` keyword argument is from #13458, which is listed as a dependency

Very sorry: I'm sure when I looked all three had the line through (I cannot see the colours very well).
Testing again, with your new revision...



---

archive/issue_events_036758.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-06-26T17:21:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36758"
}
```



---

archive/issue_events_036759.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-06-26T17:21:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36759"
}
```



---

archive/issue_comments_018495.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nI'm now happy to give this a positive review -- at last!  Thanks to Volker for the hard work which gives a lot more than this ticket originally promised.\n\nI do not feel qualified to positively review #13458 though, so I hope this is not being inconsistent of me.",
    "created_at": "2013-06-26T17:21:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18495",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:78" align="right">comment:78</div>

I'm now happy to give this a positive review -- at last!  Thanks to Volker for the hard work which gives a lot more than this ticket originally promised.

I do not feel qualified to positively review #13458 though, so I hope this is not being inconsistent of me.



---

archive/issue_events_036760.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:29:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36760"
}
```



---

archive/issue_events_036761.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-07-21T21:29:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36761"
}
```



---

archive/issue_comments_018496.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nSorry, there are some issues with these patches:\n\nMost importantly, the doctests for `Jacobian_magma_from_plane_curve` don't actually use the function `Jacobian_magma_from_plane_curve`. So the function which is \"useful for doctesting\" doesn't seem to be used in any doctest.\n\nThen some details: I would replace\n\n```\nsage: x,y,z=PolynomialRing(QQ,3,'xyz').gens()\n```\nby\n\n```\nsage: R.<x,y,z> = PolynomialRing(QQ,3)\n```\nor\n\n```\nsage: R.<x,y,z> = QQ[]\n```\n\nAnd also replace\n\n```\nsage: f = x**5 + 1184*x**3 + 1846*x**2 + 956*x + 560\n```\nby\n\n```\nsage: f = x^5 + 1184*x^3 + 1846*x^2 + 956*x + 560\n```",
    "created_at": "2013-08-13T13:17:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18496",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:80" align="right">comment:80</div>

Sorry, there are some issues with these patches:

Most importantly, the doctests for `Jacobian_magma_from_plane_curve` don't actually use the function `Jacobian_magma_from_plane_curve`. So the function which is "useful for doctesting" doesn't seem to be used in any doctest.

Then some details: I would replace

```
sage: x,y,z=PolynomialRing(QQ,3,'xyz').gens()
```
by

```
sage: R.<x,y,z> = PolynomialRing(QQ,3)
```
or

```
sage: R.<x,y,z> = QQ[]
```

And also replace

```
sage: f = x**5 + 1184*x**3 + 1846*x**2 + 956*x + 560
```
by

```
sage: f = x^5 + 1184*x^3 + 1846*x^2 + 956*x + 560
```



---

archive/issue_events_036762.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T13:17:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36762"
}
```



---

archive/issue_events_036763.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T13:17:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36763"
}
```



---

archive/issue_comments_018497.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nI didn't write the `Jacobian_magma_...` functions, for the record. I just moved it out of `constructor.py` into a less visible location. I don't think that beautifying them makes any sense, the docstring is pretty clear that you shouldn't base your work on it. If anything, it should be removed altogether. Though IMHO that is not particularly urgent. \n\nThe attached patch changes the function call so that it is doctested.",
    "created_at": "2013-08-13T13:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18497",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:81" align="right">comment:81</div>

I didn't write the `Jacobian_magma_...` functions, for the record. I just moved it out of `constructor.py` into a less visible location. I don't think that beautifying them makes any sense, the docstring is pretty clear that you shouldn't base your work on it. If anything, it should be removed altogether. Though IMHO that is not particularly urgent. 

The attached patch changes the function call so that it is doctested.



---

archive/issue_events_036764.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-08-13T13:41:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36764"
}
```



---

archive/issue_events_036765.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2013-08-13T13:41:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36765"
}
```



---

archive/issue_comments_018498.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -32,5 +32,6 @@\n * [attachment: trac_3416_elliptic_curve_from_cubic_vb.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)\n * [attachment: trac_3416_jacobians.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)\n * [attachment: trac_3416_fixes.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_fixes.patch.gz)\n+* [attachment: trac_3416_magma.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_magma.patch.gz)\n \n See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.\n``````\n",
    "created_at": "2013-08-13T13:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18498",
    "user": "https://github.com/vbraun"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -32,5 +32,6 @@
 * [attachment: trac_3416_elliptic_curve_from_cubic_vb.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_elliptic_curve_from_cubic_vb.patch.gz)
 * [attachment: trac_3416_jacobians.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_jacobians.patch.gz)
 * [attachment: trac_3416_fixes.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_fixes.patch.gz)
+* [attachment: trac_3416_magma.patch](https://github.com/sagemath/sage/files/ticket3416/trac_3416_magma.patch.gz)
 
 See [attachment: cubic_to_weierstrass_documentation.pdf](https://github.com/sagemath/sage/files/ticket3416/cubic_to_weierstrass_documentation.pdf.gz) for details on how the algorithm works.
``````




---

archive/issue_comments_018499.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nCan any of the \"official\" reviewers of this ticket please check that these doctests pass with magma with\n\n```\n./sage -t --optional=sage,magma devel/sage/sage/schemes/elliptic_curves\n```",
    "created_at": "2013-08-13T13:45:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18499",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:83" align="right">comment:83</div>

Can any of the "official" reviewers of this ticket please check that these doctests pass with magma with

```
./sage -t --optional=sage,magma devel/sage/sage/schemes/elliptic_curves
```



---

archive/issue_comments_018500.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nReplying to [@jdemeyer](#comment%3A83):\n> Can any of the \"official\" reviewers of this ticket please check that these doctests pass with magma with\n> \n> ```\n> ./sage -t --optional=sage,magma devel/sage/sage/schemes/elliptic_curves\n> ```\n\nI just did, and there are some problems, which I am now fixing.\n\nI note that the dependent #13458 is marged as having been merged, but only in 5.12.beta0 which is in the future for most of us!\n\nJohn",
    "created_at": "2013-08-13T13:47:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18500",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:84" align="right">comment:84</div>

Replying to [@jdemeyer](#comment%3A83):
> Can any of the "official" reviewers of this ticket please check that these doctests pass with magma with
> 
> ```
> ./sage -t --optional=sage,magma devel/sage/sage/schemes/elliptic_curves
> ```

I just did, and there are some problems, which I am now fixing.

I note that the dependent #13458 is marged as having been merged, but only in 5.12.beta0 which is in the future for most of us!

John



---

archive/issue_comments_018501.json:
```json
{
    "body": "<div id=\"comment:85\" align=\"right\">comment:85</div>\n\nAm I doing something stupid here?  I have 5.11.rc0 with the patches from #13458 and this ticket applied.  Now\n\n```\nsage: R.<x,y,z> = QQ[]\nsage: f = x^3+y^3+60*z^3                            \nsage: from sage.schemes.elliptic_curves.jacobian import Jacobian_magma_equation\nsage: E = Jacobian_magma_equation(f)\n(...)\nNameError: global name 'SR' is not defined\n```\ndespite\n\n```\nsage: SR\nSymbolic Ring\n```\nThe relevant line works fine by itself:\n\n```\nsage: cmd = \"P<%s,%s,%s> := ProjectivePlane(RationalField());\"%SR(f).variables()\nsage: cmd\n'P<x,y,z> := ProjectivePlane(RationalField());'\n```",
    "created_at": "2013-08-13T14:12:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18501",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:85" align="right">comment:85</div>

Am I doing something stupid here?  I have 5.11.rc0 with the patches from #13458 and this ticket applied.  Now

```
sage: R.<x,y,z> = QQ[]
sage: f = x^3+y^3+60*z^3                            
sage: from sage.schemes.elliptic_curves.jacobian import Jacobian_magma_equation
sage: E = Jacobian_magma_equation(f)
(...)
NameError: global name 'SR' is not defined
```
despite

```
sage: SR
Symbolic Ring
```
The relevant line works fine by itself:

```
sage: cmd = "P<%s,%s,%s> := ProjectivePlane(RationalField());"%SR(f).variables()
sage: cmd
'P<x,y,z> := ProjectivePlane(RationalField());'
```



---

archive/issue_comments_018502.json:
```json
{
    "body": "<div id=\"comment:86\" align=\"right\">comment:86</div>\n\nI've added the missing import, should work now.",
    "created_at": "2013-08-13T14:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18502",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:86" align="right">comment:86</div>

I've added the missing import, should work now.



---

archive/issue_comments_018503.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nReplying to [@vbraun](#comment%3A86):\n> I've added the missing import, should work now.\n\nThat's odd as I would not have expected it to be necessary to import SR for a doctest.\n\nAnyway, that function is still wrong since 2 lines later it refers to P which I presume is a point on the curve, but there is no parameter P.  Shall we just delete this completely redundant function?\n\nThe next function `Jacobian_magma_from_plane_curve` needs a minor fix in the last line since rings is not imported.  It's fine with\n\n```\n    from sage.rings.all import QQ\n    return EllipticCurve(QQ, eval(s))\n```",
    "created_at": "2013-08-13T14:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18503",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:87" align="right">comment:87</div>

Replying to [@vbraun](#comment%3A86):
> I've added the missing import, should work now.

That's odd as I would not have expected it to be necessary to import SR for a doctest.

Anyway, that function is still wrong since 2 lines later it refers to P which I presume is a point on the curve, but there is no parameter P.  Shall we just delete this completely redundant function?

The next function `Jacobian_magma_from_plane_curve` needs a minor fix in the last line since rings is not imported.  It's fine with

```
    from sage.rings.all import QQ
    return EllipticCurve(QQ, eval(s))
```



---

archive/issue_comments_018504.json:
```json
{
    "body": "Attachment: **[trac_3416_magma.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_magma.patch.gz)**\n\nUpdated patch",
    "created_at": "2013-08-13T14:57:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18504",
    "user": "https://github.com/vbraun"
}
```

Attachment: **[trac_3416_magma.patch.gz](https://github.com/sagemath/sage/files/ticket3416/trac_3416_magma.patch.gz)**

Updated patch



---

archive/issue_comments_018505.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nUpdated patch removes both `Jacobian_magma_...` functions since they don't really add anything useful.",
    "created_at": "2013-08-13T14:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18505",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:88" align="right">comment:88</div>

Updated patch removes both `Jacobian_magma_...` functions since they don't really add anything useful.



---

archive/issue_events_036766.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-08-13T15:25:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36766"
}
```



---

archive/issue_events_036767.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2013-08-13T15:25:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36767"
}
```



---

archive/issue_comments_018506.json:
```json
{
    "body": "<div id=\"comment:89\" align=\"right\">comment:89</div>\n\nReplying to [@vbraun](#comment%3A88):\n> Updated patch removes both `Jacobian_magma_...` functions since they don't really add anything useful.\n\nNow the optional tests certainly pass!  Back to positive review, and I hope that Jeroen is happy.",
    "created_at": "2013-08-13T15:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18506",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:89" align="right">comment:89</div>

Replying to [@vbraun](#comment%3A88):
> Updated patch removes both `Jacobian_magma_...` functions since they don't really add anything useful.

Now the optional tests certainly pass!  Back to positive review, and I hope that Jeroen is happy.



---

archive/issue_comments_018507.json:
```json
{
    "body": "<div id=\"comment:90\" align=\"right\">comment:90</div>\n\nReplying to [@JohnCremona](#comment%3A89):\n> Replying to [@vbraun](#comment%3A88):\n> > Updated patch removes both `Jacobian_magma_...` functions since they don't really add anything useful.\n\n> \n> Now the optional tests certainly pass!\n\nObviously :-)\n\n> I hope that Jeroen is happy.\n\nSure!",
    "created_at": "2013-08-13T15:28:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18507",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:90" align="right">comment:90</div>

Replying to [@JohnCremona](#comment%3A89):
> Replying to [@vbraun](#comment%3A88):
> > Updated patch removes both `Jacobian_magma_...` functions since they don't really add anything useful.

> 
> Now the optional tests certainly pass!

Obviously :-)

> I hope that Jeroen is happy.

Sure!



---

archive/issue_comments_018508.json:
```json
{
    "body": "Merged: **sage-5.12.beta3**",
    "created_at": "2013-08-20T12:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18508",
    "user": "https://github.com/jdemeyer"
}
```

Merged: **sage-5.12.beta3**



---

archive/issue_events_036768.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:58:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36768"
}
```



---

archive/issue_events_036769.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-20T12:58:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3416#event-36769"
}
```



---

archive/issue_comments_018509.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nSee #15340 for a follow-up.",
    "created_at": "2013-10-28T19:54:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3416",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3416#issuecomment-18509",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:92" align="right">comment:92</div>

See #15340 for a follow-up.
