# Issue 3980: Find_root bug

archive/issues_003980.json:
```json
{
    "body": "The reciprocal of tangent is not a constant function, but Sage says otherwise.  \n\n```\nsage: z=tan\nsage: z\ntan\nsage: 1/z\n1/tan\nsage: find_root(1/z,1,2)\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n<snip>\n\n/Applications/sage/local/lib/python2.5/site-packages/sage/numerical/optimize.py in find_root(f, a, b, xtol, rtol, maxiter, full_output)\n     52     \"\"\"\n     53     try:\n---> 54         return f.find_root(a=a,b=b,xtol=xtol,rtol=rtol,maxiter=maxiter,full_output=full_output)\n     55     except AttributeError:\n     56         pass\n\n/Applications/sage/local/lib/python2.5/site-packages/sage/calculus/calculus.py in find_root(self, a, b, var, xtol, rtol, maxiter, full_output)\n   3088                     return a\n   3089                 else:\n-> 3090                     raise RuntimeError, \"no zero in the interval, since constant expression is not 0.\"\n   3091             var = repr(w[0])\n   3092 \n\nRuntimeError: no zero in the interval, since constant expression is not 0.\n```\n\n\n**Assignee:** @jicama\n\nIssue created by migration from https://trac.sagemath.org/ticket/3980\n\n",
    "closed_at": "2008-10-01T10:32:42Z",
    "created_at": "2008-08-28T20:38:30Z",
    "labels": [
        "component: calculus",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.1.3",
    "title": "Find_root bug",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/3980",
    "user": "https://github.com/kcrisman"
}
```
The reciprocal of tangent is not a constant function, but Sage says otherwise.  

```
sage: z=tan
sage: z
tan
sage: 1/z
1/tan
sage: find_root(1/z,1,2)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

<snip>

/Applications/sage/local/lib/python2.5/site-packages/sage/numerical/optimize.py in find_root(f, a, b, xtol, rtol, maxiter, full_output)
     52     """
     53     try:
---> 54         return f.find_root(a=a,b=b,xtol=xtol,rtol=rtol,maxiter=maxiter,full_output=full_output)
     55     except AttributeError:
     56         pass

/Applications/sage/local/lib/python2.5/site-packages/sage/calculus/calculus.py in find_root(self, a, b, var, xtol, rtol, maxiter, full_output)
   3088                     return a
   3089                 else:
-> 3090                     raise RuntimeError, "no zero in the interval, since constant expression is not 0."
   3091             var = repr(w[0])
   3092 

RuntimeError: no zero in the interval, since constant expression is not 0.
```


**Assignee:** @jicama

Issue created by migration from https://trac.sagemath.org/ticket/3980





---

archive/issue_comments_023773.json:
```json
{
    "body": "**Changing assignee** from jkantor to @burcin.",
    "created_at": "2008-08-31T15:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23773",
    "user": "https://github.com/jicama"
}
```

**Changing assignee** from jkantor to @burcin.



---

archive/issue_events_023331.json:
```json
{
    "actor": "https://github.com/jicama",
    "created_at": "2008-08-31T15:10:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "component: numerical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23331"
}
```



---

archive/issue_events_023332.json:
```json
{
    "actor": "https://github.com/jicama",
    "created_at": "2008-08-31T15:10:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "component: calculus",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23332"
}
```



---

archive/issue_comments_023774.json:
```json
{
    "body": "<a id='comment:2'></a>\nI have a less obscure example of this.  \n\n```\nsage: find_root(sin, -1, 1)\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n/Volumes/Place/anakha/sage-3.1.2.alpha4/<ipython console> in <module>()\n\n/Volumes/Place/anakha/sage-3.1.2.alpha4/local/lib/python2.5/site-packages/sage/numerical/optimize.py in find_root(f, a, b, xtol, rtol, maxiter, full_output)\n     52     \"\"\"\n     53     try:\n---> 54         return f.find_root(a=a,b=b,xtol=xtol,rtol=rtol,maxiter=maxiter,full_output=full_output)\n     55     except AttributeError:\n     56         pass\n\n/Volumes/Place/anakha/sage-3.1.2.alpha4/local/lib/python2.5/site-packages/sage/calculus/calculus.py in find_root(self, a, b, var, xtol, rtol, maxiter, full_output)\n   3120                     return a\n   3121                 else:\n-> 3122                     raise RuntimeError, \"no zero in the interval, since constant expression is not 0.\"\n   3123             var = repr(w[0])\n   3124 \n\nRuntimeError: no zero in the interval, since constant expression is not 0.\n```\n\nAnd I have traced down the bug to this:\n\n```\nsage: sin.variables()\n()\nsage: (1/tan).variables()\n()\n```\n\nSince these expressions contain no variables they are deemed constant and since they are not equal to 0 they have no roots.  You can fix your example by trying:\n\n```\nsage: find_root(1/tan(x), 1, 2)\n1.5707963267948968\n```\n\nAlso note that this works:\n\n```\nsage: (1/tan)(1)\n1/tan(1)\n```\n\nAlthough, technically no variables are there to be replaced.\n\nI don't know if this is really a bug or not, or how to fix it.",
    "created_at": "2008-09-08T20:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23774",
    "user": "https://trac.sagemath.org/admin/accounts/users/anakha"
}
```

<a id='comment:2'></a>
I have a less obscure example of this.  

```
sage: find_root(sin, -1, 1)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

/Volumes/Place/anakha/sage-3.1.2.alpha4/<ipython console> in <module>()

/Volumes/Place/anakha/sage-3.1.2.alpha4/local/lib/python2.5/site-packages/sage/numerical/optimize.py in find_root(f, a, b, xtol, rtol, maxiter, full_output)
     52     """
     53     try:
---> 54         return f.find_root(a=a,b=b,xtol=xtol,rtol=rtol,maxiter=maxiter,full_output=full_output)
     55     except AttributeError:
     56         pass

/Volumes/Place/anakha/sage-3.1.2.alpha4/local/lib/python2.5/site-packages/sage/calculus/calculus.py in find_root(self, a, b, var, xtol, rtol, maxiter, full_output)
   3120                     return a
   3121                 else:
-> 3122                     raise RuntimeError, "no zero in the interval, since constant expression is not 0."
   3123             var = repr(w[0])
   3124 

RuntimeError: no zero in the interval, since constant expression is not 0.
```

And I have traced down the bug to this:

```
sage: sin.variables()
()
sage: (1/tan).variables()
()
```

Since these expressions contain no variables they are deemed constant and since they are not equal to 0 they have no roots.  You can fix your example by trying:

```
sage: find_root(1/tan(x), 1, 2)
1.5707963267948968
```

Also note that this works:

```
sage: (1/tan)(1)
1/tan(1)
```

Although, technically no variables are there to be replaced.

I don't know if this is really a bug or not, or how to fix it.



---

archive/issue_comments_023775.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe problem is that find_root is asking the wrong question of its first argument.  It asks \"what are your variables?\"  Instead, it should ask \"do you return a number when called with one argument?\"  I will try to code this up when I get a chance.",
    "created_at": "2008-09-08T22:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23775",
    "user": "https://github.com/jicama"
}
```

<a id='comment:3'></a>
The problem is that find_root is asking the wrong question of its first argument.  It asks "what are your variables?"  Instead, it should ask "do you return a number when called with one argument?"  I will try to code this up when I get a chance.



---

archive/issue_events_023333.json:
```json
{
    "actor": "https://github.com/jicama",
    "created_at": "2008-09-09T02:01:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23333"
}
```



---

archive/issue_comments_023776.json:
```json
{
    "body": "<a id='comment:4'></a>\nHere's a patch that avoids asking the function what it's variables are.",
    "created_at": "2008-09-09T02:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23776",
    "user": "https://github.com/jicama"
}
```

<a id='comment:4'></a>
Here's a patch that avoids asking the function what it's variables are.



---

archive/issue_comments_023777.json:
```json
{
    "body": "**Changing assignee** from @burcin to @jicama.",
    "created_at": "2008-09-09T02:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23777",
    "user": "https://github.com/jicama"
}
```

**Changing assignee** from @burcin to @jicama.



---

archive/issue_events_023334.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mhampton",
    "created_at": "2008-09-21T03:29:41Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23334"
}
```



---

archive/issue_events_023335.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mhampton",
    "created_at": "2008-09-21T03:29:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23335"
}
```



---

archive/issue_comments_023778.json:
```json
{
    "body": "<a id='comment:5'></a>\nSomehow this is now too permissive, since the following should return an error:\n\n```\nsage: var('t')\nsage: find_root(1/t-x,0,2)\n     1.0000000000005\n```",
    "created_at": "2008-09-21T03:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23778",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:5'></a>
Somehow this is now too permissive, since the following should return an error:

```
sage: var('t')
sage: find_root(1/t-x,0,2)
     1.0000000000005
```



---

archive/attachments_004188.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3980.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket3980/3980.patch",
    "created_at": "2008-09-29T23:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/jicama"
}
```



---

archive/issue_comments_023779.json:
```json
{
    "body": "",
    "created_at": "2008-09-29T23:26:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23779",
    "user": "https://github.com/jicama"
}
```





---

archive/issue_comments_023780.json:
```json
{
    "body": "<a id='comment:6'></a>\nGood catch mhampton.  I modified the patch to throw a NotImplementedError if self.number_of_variables() is greater than 1.  This is closer to the old behavior.  I added a new test to explicitly check the case you gave above.",
    "created_at": "2008-09-29T23:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23780",
    "user": "https://github.com/jicama"
}
```

<a id='comment:6'></a>
Good catch mhampton.  I modified the patch to throw a NotImplementedError if self.number_of_variables() is greater than 1.  This is closer to the old behavior.  I added a new test to explicitly check the case you gave above.



---

archive/issue_events_023336.json:
```json
{
    "actor": "https://github.com/jicama",
    "created_at": "2008-09-29T23:29:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23336"
}
```



---

archive/issue_events_023337.json:
```json
{
    "actor": "https://github.com/jicama",
    "created_at": "2008-09-29T23:29:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23337"
}
```



---

archive/issue_comments_023781.json:
```json
{
    "body": "<a id='comment:7'></a>\nOK, this passes tests and it seems OK.  One thing I noticed, which I think can be considered beyond the scope of this patch, is that \n\n\n```\nvar('t')\nplot(sin(t*x),-1,1)\n```\nquickly fails with \"ValueError: free variable: x\", which is good, but:\n\n```\nplot(lambda t: sin(t*x),-1,1)\n```\ntries to plot 400 values and finally gives \n\n```\nverbose 0 (3585: plot.py, _plot) WARNING: When plotting, failed to evaluate function at 400 points.\nverbose 0 (3585: plot.py, _plot) Last error message: 'float() argument must be a string or a number'\n```\nand an empty plot.  It would be nice to speed up that failure if you know an easy way.",
    "created_at": "2008-10-01T01:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23781",
    "user": "https://trac.sagemath.org/admin/accounts/users/mhampton"
}
```

<a id='comment:7'></a>
OK, this passes tests and it seems OK.  One thing I noticed, which I think can be considered beyond the scope of this patch, is that 


```
var('t')
plot(sin(t*x),-1,1)
```
quickly fails with "ValueError: free variable: x", which is good, but:

```
plot(lambda t: sin(t*x),-1,1)
```
tries to plot 400 values and finally gives 

```
verbose 0 (3585: plot.py, _plot) WARNING: When plotting, failed to evaluate function at 400 points.
verbose 0 (3585: plot.py, _plot) Last error message: 'float() argument must be a string or a number'
```
and an empty plot.  It would be nice to speed up that failure if you know an easy way.



---

archive/issue_events_023338.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mhampton",
    "created_at": "2008-10-01T01:57:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23338"
}
```



---

archive/issue_events_023339.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mhampton",
    "created_at": "2008-10-01T01:57:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23339"
}
```



---

archive/issue_events_023340.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-01T10:32:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23340"
}
```



---

archive/issue_events_023341.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-01T10:32:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23341"
}
```



---

archive/issue_comments_023782.json:
```json
{
    "body": "<a id='comment:8'></a>\nMerged in Sage 3.1.3.alpha3.",
    "created_at": "2008-10-01T10:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3980#issuecomment-23782",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:8'></a>
Merged in Sage 3.1.3.alpha3.



---

archive/issue_events_023342.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-01T10:32:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "milestone": "sage-3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23342"
}
```



---

archive/issue_events_023343.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-01T10:32:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3980",
    "milestone": "sage-3.1.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3980#event-23343"
}
```
