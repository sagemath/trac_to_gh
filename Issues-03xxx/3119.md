# Issue 3119: elliptic curves -- implement gens function for non-integral models

archive/issues_003119.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "The following should now be trivial to support given all the cool transformations of models code that John Cremona and Robert Bradshaw added to Sage.   Just transform the curve to minimal form, find the isomorphism explicitly, then transform the answers back. \n\n```\nsage: E = EllipticCurve([-3/8,-2/3])\nsage: E.gens()\n---------------------------------------------------------------------------\n<type 'exceptions.NotImplementedError'>   Traceback (most recent call last)\n\n/Users/was/edu/2007-2008/sage/homework/5/<ipython console> in <module>()\n\n/Users/was/build/sage/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py in gens(self, verbose, rank1_search, algorithm, only_use_mwrank, proof)\n   1349         # end if (not_use_mwrank)\n   1350         if not self.is_integral():\n-> 1351             raise NotImplementedError, \"gens via mwrank only implemented for curves with integer coefficients.\"\n   1352         if algorithm == \"mwrank_lib\":\n   1353             misc.verbose(\"Calling mwrank C++ library.\")\n\n<type 'exceptions.NotImplementedError'>: gens via mwrank only implemented for curves with integer coefficients.\n```\n\nSee how trivial this will now be to implement:\n\n```\nsage: F = E.minimal_model()\nsage: phi = F.isomorphism_to(E)\nsage: [phi(z) for z in F.gens()]\n[(10/9 : 29/54 : 1)]\n```\n\nWhat could be easier?\n\n\nKeywords: **editor_wstein**\n\nComponent: **number theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/3119_\n\n",
    "closed_at": "2008-08-11T02:05:02Z",
    "created_at": "2008-05-07T04:23:04Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "elliptic curves -- implement gens function for non-integral models",
    "type": "issue",
    "updated_at": "2008-08-11T02:05:02Z",
    "url": "https://github.com/sagemath/sage/issues/3119",
    "user": "https://github.com/williamstein"
}
```
The following should now be trivial to support given all the cool transformations of models code that John Cremona and Robert Bradshaw added to Sage.   Just transform the curve to minimal form, find the isomorphism explicitly, then transform the answers back. 

```
sage: E = EllipticCurve([-3/8,-2/3])
sage: E.gens()
---------------------------------------------------------------------------
<type 'exceptions.NotImplementedError'>   Traceback (most recent call last)

/Users/was/edu/2007-2008/sage/homework/5/<ipython console> in <module>()

/Users/was/build/sage/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py in gens(self, verbose, rank1_search, algorithm, only_use_mwrank, proof)
   1349         # end if (not_use_mwrank)
   1350         if not self.is_integral():
-> 1351             raise NotImplementedError, "gens via mwrank only implemented for curves with integer coefficients."
   1352         if algorithm == "mwrank_lib":
   1353             misc.verbose("Calling mwrank C++ library.")

<type 'exceptions.NotImplementedError'>: gens via mwrank only implemented for curves with integer coefficients.
```

See how trivial this will now be to implement:

```
sage: F = E.minimal_model()
sage: phi = F.isomorphism_to(E)
sage: [phi(z) for z in F.gens()]
[(10/9 : 29/54 : 1)]
```

What could be easier?


Keywords: **editor_wstein**

Component: **number theory**

_Issue created by migration from https://trac.sagemath.org/ticket/3119_





---

archive/issue_events_033077.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-05-07T04:23:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "milestone_number": null,
    "milestone_title": "sage-3.1.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33077"
}
```



---

archive/issue_events_033078.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-05-07T04:23:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33078"
}
```



---

archive/issue_events_033079.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-05-07T04:23:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33079"
}
```



---

archive/issue_events_033080.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-05-07T04:23:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33080"
}
```



---

archive/issue_events_033081.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-05-07T04:23:04Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33081"
}
```



---

archive/issue_comments_016456.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIn fact it is even easier than that!  For about 6 months mwrank has had the ability to deal with non-integral and non-minimal models.  In this case simply commenting out lines 1350 and 1351 in ell_rational_field.py produces this:\n\n```\nsage: E = EllipticCurve([-3/8,-2/3])\nsage: E.gens()\n[(10/9 : 29/54 : 1)]\n```\n\nPatch coming up.",
    "created_at": "2008-05-26T13:39:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16456",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:1" align="right">comment:1</div>

In fact it is even easier than that!  For about 6 months mwrank has had the ability to deal with non-integral and non-minimal models.  In this case simply commenting out lines 1350 and 1351 in ell_rational_field.py produces this:

```
sage: E = EllipticCurve([-3/8,-2/3])
sage: E.gens()
[(10/9 : 29/54 : 1)]
```

Patch coming up.



---

archive/issue_events_033082.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-05-26T13:55:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "title_is": "[with patch: needs review] elliptic curves -- implement gens function for non-integral models",
    "title_was": "elliptic curves -- implement gens function for non-integral models",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33082"
}
```



---

archive/issue_comments_016457.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nAttachment: **[trac-3119.patch.gz](https://github.com/sagemath/sage/files/ticket3119/trac-3119.patch.gz)**\n\nThe attached patch fixes the (spurious) error caused by an unnecessary testing for a case (non-integral curves) which are in fact well handled by mwrank.  At the same time I deleted the first TODO item from gens() since non-minimal models are similarly catered for.\n\nTwo new doctests illustrate the successful running of gens() on non-integral and non-minimal curves.\n\nOne small other thing:  when gens() calls mwrank it passes the command-line parameter \"-p 100\" which helps curves with large coefficients and 2-torsion and is otherwise harmless.  This is pending a more intelligent handling of mwrank options in gens() (which is nontrivial since gens() needs to parse the output from mwrank and this is seriously affected by what parameters the user passes!).\n\nIn fact it would be much better to avoid the mwrank console at all for gens() and just use the library.  This is in progress (see #1949)",
    "created_at": "2008-05-26T13:55:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16457",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:2" align="right">comment:2</div>

Attachment: **[trac-3119.patch.gz](https://github.com/sagemath/sage/files/ticket3119/trac-3119.patch.gz)**

The attached patch fixes the (spurious) error caused by an unnecessary testing for a case (non-integral curves) which are in fact well handled by mwrank.  At the same time I deleted the first TODO item from gens() since non-minimal models are similarly catered for.

Two new doctests illustrate the successful running of gens() on non-integral and non-minimal curves.

One small other thing:  when gens() calls mwrank it passes the command-line parameter "-p 100" which helps curves with large coefficients and 2-torsion and is otherwise harmless.  This is pending a more intelligent handling of mwrank options in gens() (which is nontrivial since gens() needs to parse the output from mwrank and this is seriously affected by what parameters the user passes!).

In fact it would be much better to avoid the mwrank console at all for gens() and just use the library.  This is in progress (see #1949)



---

archive/issue_comments_016458.json:
```json
{
    "body": "Apply after first patch",
    "created_at": "2008-05-26T17:48:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16458",
    "user": "https://github.com/JohnCremona"
}
```

Apply after first patch



---

archive/issue_events_033083.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-05-26T17:49:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "title_is": "[with patches: needs review] elliptic curves -- implement gens function for non-integral models",
    "title_was": "[with patch: needs review] elliptic curves -- implement gens function for non-integral models",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33083"
}
```



---

archive/issue_comments_016459.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[9774.patch.gz](https://github.com/sagemath/sage/files/ticket3119/9774.patch.gz)**\n\nAnother patch (to be applied after previous) fixing two other things:\n\nFirst:  I finally got rid of the terrible behaviour of the mwrank_EllipticCurve constructor with non-integral input.  It now throws an error.  [Although mwrank can take non-integral elliptic curves in some circumstances, this will require more work.]\n\nSecond:  There was a bug in the gens() function for \n\nBefore:\n\n```\nsage: E=EllipticCurve('389a1').change_weierstrass_model([1/20,0,0,0])\nsage: E.gens(algorithm=\"mwrank_lib\")\n[(0 : 1 : 0), (0 : 1 : 0)]\n```\nwhich is not just wrong but very wrong!\n\nAfter:\n\n```\nsage: E=EllipticCurve('389a1').change_weierstrass_model([1/20,0,0,0])\nsage: E.gens(algorithm='mwrank_lib')\n[(-400 : 8000 : 1), (0 : -8000 : 1)]\n```",
    "created_at": "2008-05-26T17:49:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16459",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[9774.patch.gz](https://github.com/sagemath/sage/files/ticket3119/9774.patch.gz)**

Another patch (to be applied after previous) fixing two other things:

First:  I finally got rid of the terrible behaviour of the mwrank_EllipticCurve constructor with non-integral input.  It now throws an error.  [Although mwrank can take non-integral elliptic curves in some circumstances, this will require more work.]

Second:  There was a bug in the gens() function for 

Before:

```
sage: E=EllipticCurve('389a1').change_weierstrass_model([1/20,0,0,0])
sage: E.gens(algorithm="mwrank_lib")
[(0 : 1 : 0), (0 : 1 : 0)]
```
which is not just wrong but very wrong!

After:

```
sage: E=EllipticCurve('389a1').change_weierstrass_model([1/20,0,0,0])
sage: E.gens(algorithm='mwrank_lib')
[(-400 : 8000 : 1), (0 : -8000 : 1)]
```



---

archive/issue_comments_016460.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nComment:  The one-line change to wrap.cc which (really) fixes the bug exemplified above is actually unnecessary in the sense that there was an underlying bug in eclib which should be fixed instead.  The currect code still works, however.\n\nTechnical detail:  eclib provides support for non-minimal and non-integral curves via a slight subterfuge whereby the curve actually worked is integral and minimal, and a scaling factor is stored.   mwrank itself (and all other executables in eclib) manage this fine: they construct the two_descent object using a vector of 5 rationals rather than a curvedata type.  The constructor from a curvedata type is still there and is the one used by Sage -- but it forgot to set the scale factor to 1.  This messes up the points returned by member function getbasis().   The currect fix is to have sage call getpbasis() instead (which does not do this scaling) which is OK if and only if the model was integral to start with.  Which it is, currently, since we do not yet have a constructor for mwrank_EllipticCurve which takes non-integral rationals.\n\nI'll be fixing eclib in due course.",
    "created_at": "2008-05-26T20:55:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16460",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:4" align="right">comment:4</div>

Comment:  The one-line change to wrap.cc which (really) fixes the bug exemplified above is actually unnecessary in the sense that there was an underlying bug in eclib which should be fixed instead.  The currect code still works, however.

Technical detail:  eclib provides support for non-minimal and non-integral curves via a slight subterfuge whereby the curve actually worked is integral and minimal, and a scaling factor is stored.   mwrank itself (and all other executables in eclib) manage this fine: they construct the two_descent object using a vector of 5 rationals rather than a curvedata type.  The constructor from a curvedata type is still there and is the one used by Sage -- but it forgot to set the scale factor to 1.  This messes up the points returned by member function getbasis().   The currect fix is to have sage call getpbasis() instead (which does not do this scaling) which is OK if and only if the model was integral to start with.  Which it is, currently, since we do not yet have a constructor for mwrank_EllipticCurve which takes non-integral rationals.

I'll be fixing eclib in due course.



---

archive/issue_comments_016461.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[eclib.patch.gz](https://github.com/sagemath/sage/files/ticket3119/eclib.patch.gz)**\n\nExtra patch added to fix the same bug in a better way.  Now wrap.cc should not need to be changed -- just checking...",
    "created_at": "2008-05-26T21:29:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16461",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[eclib.patch.gz](https://github.com/sagemath/sage/files/ticket3119/eclib.patch.gz)**

Extra patch added to fix the same bug in a better way.  Now wrap.cc should not need to be changed -- just checking...



---

archive/issue_comments_016462.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAttachment: **[trac-3119a.patch.gz](https://github.com/sagemath/sage/files/ticket3119/trac-3119a.patch.gz)**\n\nLatest patch trac-3119a.patch undoes one change in the original patch (the one-line change to wrap.cc) since the same thing is fixed better by patching eclib.  I have tested this, so I hope it is clear.",
    "created_at": "2008-05-26T22:11:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16462",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:6" align="right">comment:6</div>

Attachment: **[trac-3119a.patch.gz](https://github.com/sagemath/sage/files/ticket3119/trac-3119a.patch.gz)**

Latest patch trac-3119a.patch undoes one change in the original patch (the one-line change to wrap.cc) since the same thing is fixed better by patching eclib.  I have tested this, so I hope it is clear.



---

archive/issue_comments_016463.json:
```json
{
    "body": "Changed keywords from none to **editor_wstein**",
    "created_at": "2008-06-15T21:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16463",
    "user": "https://github.com/craigcitro"
}
```

Changed keywords from none to **editor_wstein**



---

archive/issue_events_033084.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-15T22:16:48Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "title_is": "[with patches: under review by wstein] elliptic curves -- implement gens function for non-integral models",
    "title_was": "[with patches: needs review] elliptic curves -- implement gens function for non-integral models",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33084"
}
```



---

archive/issue_comments_016464.json:
```json
{
    "body": "this is the *fourth* patch to the sage main repo that has to be applied",
    "created_at": "2008-06-16T00:34:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16464",
    "user": "https://github.com/williamstein"
}
```

this is the *fourth* patch to the sage main repo that has to be applied



---

archive/issue_comments_016465.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nAttachment: **[sage-3119-part4.patch.gz](https://github.com/sagemath/sage/files/ticket3119/sage-3119-part4.patch.gz)**\n\nREFEREE REPORT:\n\nExcellent.  However there are several doctest failures after applying the patches:\n\n```\nD-69-91-137-77:~ was$ sage -t d/sage/sage/schemes/elliptic_curves/ell_rational_field.pysage -t  d/sage/sage/schemes/elliptic_curves/ell_rational_field.py\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 145:\n    sage: E.gens()         # causes actual rank to be computed\nExpected:\n    [(0 : -1 : 1)]\nGot:\n    [(0 : 0 : 1)]\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 147:\n    sage: E.rank()         # the correct rank\nExpected:\n    1\nGot:\n    99\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 1413:\n    sage: E.gens()\nExpected:\n    [(0 : -1 : 1)]\nGot:\n    [(0 : 0 : 1)]\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 1538:\n    sage: Q=5*P; Q\nExpected:\n    (1/4 : -3/8 : 1)\nGot:\n    (1/4 : -5/8 : 1)\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 1540:\n    sage: E.saturation([Q])\nExpected:\n    ([(0 : -1 : 1)], '5', 0.0511114075779915)\nGot:\n    ([(0 : 0 : 1)], '5', 0.0511114075779915)\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 252:\n    sage: E.gens()\nExpected:\n    [(-2 : 3 : 1), (-7/4 : 25/8 : 1), (1 : -1 : 1)]\nGot:\n    [(-2 : 3 : 1), (-1 : 3 : 1), (0 : 2 : 1)]\n**********************************************************************\n5 items had failures:\n   2 of   6 in __main__.example_2\n   1 of   4 in __main__.example_32\n   2 of   5 in __main__.example_35\n   1 of   6 in __main__.example_62\n   1 of   8 in __main__.example_7\n***Test Failed*** 7 failures.\nFor whitespace errors, see the file /Users/was/s/tmp/.doctest_ell_rational_field.py\n\t [47.8 s]\nexit code: 1024\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  d/sage/sage/schemes/elliptic_curves/ell_rational_field.py\nTotal time for all tests: 47.8 seconds\n```\n\n}}}",
    "created_at": "2008-06-16T00:35:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16465",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:9" align="right">comment:9</div>

Attachment: **[sage-3119-part4.patch.gz](https://github.com/sagemath/sage/files/ticket3119/sage-3119-part4.patch.gz)**

REFEREE REPORT:

Excellent.  However there are several doctest failures after applying the patches:

```
D-69-91-137-77:~ was$ sage -t d/sage/sage/schemes/elliptic_curves/ell_rational_field.pysage -t  d/sage/sage/schemes/elliptic_curves/ell_rational_field.py
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 145:
    sage: E.gens()         # causes actual rank to be computed
Expected:
    [(0 : -1 : 1)]
Got:
    [(0 : 0 : 1)]
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 147:
    sage: E.rank()         # the correct rank
Expected:
    1
Got:
    99
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 1413:
    sage: E.gens()
Expected:
    [(0 : -1 : 1)]
Got:
    [(0 : 0 : 1)]
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 1538:
    sage: Q=5*P; Q
Expected:
    (1/4 : -3/8 : 1)
Got:
    (1/4 : -5/8 : 1)
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 1540:
    sage: E.saturation([Q])
Expected:
    ([(0 : -1 : 1)], '5', 0.0511114075779915)
Got:
    ([(0 : 0 : 1)], '5', 0.0511114075779915)
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 252:
    sage: E.gens()
Expected:
    [(-2 : 3 : 1), (-7/4 : 25/8 : 1), (1 : -1 : 1)]
Got:
    [(-2 : 3 : 1), (-1 : 3 : 1), (0 : 2 : 1)]
**********************************************************************
5 items had failures:
   2 of   6 in __main__.example_2
   1 of   4 in __main__.example_32
   2 of   5 in __main__.example_35
   1 of   6 in __main__.example_62
   1 of   8 in __main__.example_7
***Test Failed*** 7 failures.
For whitespace errors, see the file /Users/was/s/tmp/.doctest_ell_rational_field.py
	 [47.8 s]
exit code: 1024
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  d/sage/sage/schemes/elliptic_curves/ell_rational_field.py
Total time for all tests: 47.8 seconds
```

}}}



---

archive/issue_events_033085.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-16T00:36:05Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "title_is": "[with patches: needs work] elliptic curves -- implement gens function for non-integral models",
    "title_was": "[with patches: under review by wstein] elliptic curves -- implement gens function for non-integral models",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33085"
}
```



---

archive/issue_comments_016466.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWilliam -- my patches to sort this one out included a (tiny) patch to eclib source code which I posted here.  Without that patch the issue is *not* fixed.  Can you confirm whether or not you were testing with a patched eclib?  John",
    "created_at": "2008-06-16T13:23:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16466",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:11" align="right">comment:11</div>

William -- my patches to sort this one out included a (tiny) patch to eclib source code which I posted here.  Without that patch the issue is *not* fixed.  Can you confirm whether or not you were testing with a patched eclib?  John



---

archive/issue_comments_016467.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nYes, I had that fix applied.  Does everything *definitely* work for you with that patch applied?",
    "created_at": "2008-06-19T23:03:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16467",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:12" align="right">comment:12</div>

Yes, I had that fix applied.  Does everything *definitely* work for you with that patch applied?



---

archive/issue_comments_016468.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI applied all 4 patches to a fresh install of 3.0.3.rc0, which I believe is the same as 3.0.3.  I did not apply the eclib patch which I assumed had been already applied to 3.0.3 (if Michael reads this could he confirm?).  And there were no problems:\n\n```\njohn@ubuntu%sage -t /home/john/sage-3.0.3.rc0/devel/sage-3119/sage/schemes/elliptic_curves/ell_rational_field.py \nsage -t  devel/sage-3119/sage/schemes/elliptic_curves/ell_rational_field.py\n\t [112.5 s]\n``` \nSo this is rather mysterious.\n\nIncidentally some of those tests are taking a bit long.",
    "created_at": "2008-06-20T20:33:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16468",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:13" align="right">comment:13</div>

I applied all 4 patches to a fresh install of 3.0.3.rc0, which I believe is the same as 3.0.3.  I did not apply the eclib patch which I assumed had been already applied to 3.0.3 (if Michael reads this could he confirm?).  And there were no problems:

```
john@ubuntu%sage -t /home/john/sage-3.0.3.rc0/devel/sage-3119/sage/schemes/elliptic_curves/ell_rational_field.py 
sage -t  devel/sage-3119/sage/schemes/elliptic_curves/ell_rational_field.py
	 [112.5 s]
``` 
So this is rather mysterious.

Incidentally some of those tests are taking a bit long.



---

archive/issue_comments_016469.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nDouble check:\n* New build of 3.0.3\n* new clone set up\n* Apply the four patches attached excluding the eclib one\n* Rebuild eclib after applying the eclib patch\nNow all doctests pass in ell_rational_field and so does the one above which definitely does not work without eclib being correctly patched.\n\nHence I humbly ask that the reviewer re-checks!",
    "created_at": "2008-06-22T16:58:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16469",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:14" align="right">comment:14</div>

Double check:
* New build of 3.0.3
* new clone set up
* Apply the four patches attached excluding the eclib one
* Rebuild eclib after applying the eclib patch
Now all doctests pass in ell_rational_field and so does the one above which definitely does not work without eclib being correctly patched.

Hence I humbly ask that the reviewer re-checks!



---

archive/issue_comments_016470.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThe newly patched eclib at  http://www.warwick.ac.uk/staff/J.E.Cremona/eclib-20080310.p3.spkg contains several small fixes *including* the eclib.patch attached to this ticket already.",
    "created_at": "2008-06-23T21:14:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16470",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:15" align="right">comment:15</div>

The newly patched eclib at  http://www.warwick.ac.uk/staff/J.E.Cremona/eclib-20080310.p3.spkg contains several small fixes *including* the eclib.patch attached to this ticket already.



---

archive/issue_comments_016471.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI have split of the spkg to #3509.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-25T08:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16471",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:16" align="right">comment:16</div>

I have split of the spkg to #3509.

Cheers,

Michael



---

archive/issue_comments_016472.json:
```json
{
    "body": "*New* simpler patch replacing all previous ones for this ticket",
    "created_at": "2008-06-28T15:59:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16472",
    "user": "https://github.com/JohnCremona"
}
```

*New* simpler patch replacing all previous ones for this ticket



---

archive/issue_comments_016473.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAttachment: **[sage-3119-new.patch.gz](https://github.com/sagemath/sage/files/ticket3119/sage-3119-new.patch.gz)**\n\nI have combined and simplified the confusion of earlier patches, so now only *one* need to be applied: sage-3119-new.patch.  This is based in version 3.0.4.alpha0.  Note that it requires  eclib-20080310.p3 which is not in 3.0.4.alpha0 but is in alpha1 (the one which did not build) so reviewers should test with 3.0.4.alpha2 (or later). If run with the older eclib, the doctests in ell_rational_field.py still pass but take about 4 times as long (proving that the patch to eclib is not quite as trivial as it appears).",
    "created_at": "2008-06-28T16:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16473",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:17" align="right">comment:17</div>

Attachment: **[sage-3119-new.patch.gz](https://github.com/sagemath/sage/files/ticket3119/sage-3119-new.patch.gz)**

I have combined and simplified the confusion of earlier patches, so now only *one* need to be applied: sage-3119-new.patch.  This is based in version 3.0.4.alpha0.  Note that it requires  eclib-20080310.p3 which is not in 3.0.4.alpha0 but is in alpha1 (the one which did not build) so reviewers should test with 3.0.4.alpha2 (or later). If run with the older eclib, the doctests in ell_rational_field.py still pass but take about 4 times as long (proving that the patch to eclib is not quite as trivial as it appears).



---

archive/issue_events_033086.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-06-28T16:06:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "title_is": "[with new patche: needs review -- easy] elliptic curves -- implement gens function for non-integral models",
    "title_was": "[with patches: needs work] elliptic curves -- implement gens function for non-integral models",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33086"
}
```



---

archive/issue_events_033087.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-06-29T16:51:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "title_is": "[with patch: needs review -- easy] elliptic curves -- implement gens function for non-integral models",
    "title_was": "[with new patche: needs review -- easy] elliptic curves -- implement gens function for non-integral models",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33087"
}
```



---

archive/issue_events_033088.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2008-08-09T08:26:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "title_is": "[with patch: needs review] elliptic curves -- implement gens function for non-integral models",
    "title_was": "[with patch: needs review -- easy] elliptic curves -- implement gens function for non-integral models",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33088"
}
```



---

archive/issue_comments_016474.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI have checked that this patch still applies cleanly and passes tests with 3.1.alpha0.\n\nIt is a *very simple* patch -- the serious change happened in eclib and has already been merged.\n\nPlease will someone help put this to bed!",
    "created_at": "2008-08-09T08:26:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16474",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:19" align="right">comment:19</div>

I have checked that this patch still applies cleanly and passes tests with 3.1.alpha0.

It is a *very simple* patch -- the serious change happened in eclib and has already been merged.

Please will someone help put this to bed!



---

archive/issue_comments_016475.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThis works for me with 3.0.6.  The sage library patch looks good; I haven't checked the already merged changes to eclib.\n\nApply!",
    "created_at": "2008-08-10T21:01:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16475",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:20" align="right">comment:20</div>

This works for me with 3.0.6.  The sage library patch looks good; I haven't checked the already merged changes to eclib.

Apply!



---

archive/issue_events_033089.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2008-08-10T21:01:23Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "title_is": "elliptic curves -- implement gens function for non-integral models",
    "title_was": "[with patch: needs review] elliptic curves -- implement gens function for non-integral models",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33089"
}
```



---

archive/issue_events_033090.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2008-08-10T21:01:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33090"
}
```



---

archive/issue_comments_016476.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nPatch looks good to me, but there is a minimal doctest issue related to numerical noise that I fixed:\n\n```\nsage -t -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.1.alpha1/tmp/ell_rational_field.py\", line 1475:\n    sage: EllipticCurve([0, 0, 1, -79, 342]).regulator(proof=False)  # long time (seconds)\nExpected:\n    14.7905275701310\nGot:\n    14.7905275701311\n**********************************************************************\n```\n\nCheers,\n\nMichael",
    "created_at": "2008-08-11T01:45:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16476",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:21" align="right">comment:21</div>

Patch looks good to me, but there is a minimal doctest issue related to numerical noise that I fixed:

```
sage -t -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.1.alpha1/tmp/ell_rational_field.py", line 1475:
    sage: EllipticCurve([0, 0, 1, -79, 342]).regulator(proof=False)  # long time (seconds)
Expected:
    14.7905275701310
Got:
    14.7905275701311
**********************************************************************
```

Cheers,

Michael



---

archive/issue_comments_016477.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nMerged in Sage 3.1.alpha1",
    "created_at": "2008-08-11T02:05:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3119#issuecomment-16477",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:22" align="right">comment:22</div>

Merged in Sage 3.1.alpha1



---

archive/issue_events_033091.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-08-11T02:05:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "milestone_number": null,
    "milestone_title": "sage-3.1.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33091"
}
```



---

archive/issue_events_033092.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-08-11T02:05:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "milestone_number": null,
    "milestone_title": "sage-3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33092"
}
```



---

archive/issue_events_033093.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-08-11T02:05:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33093"
}
```



---

archive/issue_events_033094.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-08-11T02:05:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3119",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3119#event-33094"
}
```
