# Issue 3119: [with positive review] elliptic curves -- implement gens function for non-integral models

archive/issues_003119.json:
```json
{
    "body": "The following should now be trivial to support given all the cool transformations of models code that John Cremona and Robert Bradshaw added to Sage.   Just transform the curve to minimal form, find the isomorphism explicitly, then transform the answers back. \n\n```\nsage: E = EllipticCurve([-3/8,-2/3])\nsage: E.gens()\n---------------------------------------------------------------------------\n<type 'exceptions.NotImplementedError'>   Traceback (most recent call last)\n\n/Users/was/edu/2007-2008/sage/homework/5/<ipython console> in <module>()\n\n/Users/was/build/sage/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py in gens(self, verbose, rank1_search, algorithm, only_use_mwrank, proof)\n   1349         # end if (not_use_mwrank)\n   1350         if not self.is_integral():\n-> 1351             raise NotImplementedError, \"gens via mwrank only implemented for curves with integer coefficients.\"\n   1352         if algorithm == \"mwrank_lib\":\n   1353             misc.verbose(\"Calling mwrank C++ library.\")\n\n<type 'exceptions.NotImplementedError'>: gens via mwrank only implemented for curves with integer coefficients.\n```\n\nSee how trivial this will now be to implement:\n\n```\nsage: F = E.minimal_model()\nsage: phi = F.isomorphism_to(E)\nsage: [phi(z) for z in F.gens()]\n[(10/9 : 29/54 : 1)]\n```\n\nWhat could be easier?\n\n\n**Assignee:** @williamstein\n\n**Keywords:** editor_wstein\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/3119\n\n",
    "closed_at": "2008-08-11T02:05:02Z",
    "created_at": "2008-05-07T04:23:04Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.1",
    "title": "[with positive review] elliptic curves -- implement gens function for non-integral models",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/3119",
    "user": "https://github.com/williamstein"
}
```
The following should now be trivial to support given all the cool transformations of models code that John Cremona and Robert Bradshaw added to Sage.   Just transform the curve to minimal form, find the isomorphism explicitly, then transform the answers back. 

```
sage: E = EllipticCurve([-3/8,-2/3])
sage: E.gens()
---------------------------------------------------------------------------
<type 'exceptions.NotImplementedError'>   Traceback (most recent call last)

/Users/was/edu/2007-2008/sage/homework/5/<ipython console> in <module>()

/Users/was/build/sage/local/lib/python2.5/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py in gens(self, verbose, rank1_search, algorithm, only_use_mwrank, proof)
   1349         # end if (not_use_mwrank)
   1350         if not self.is_integral():
-> 1351             raise NotImplementedError, "gens via mwrank only implemented for curves with integer coefficients."
   1352         if algorithm == "mwrank_lib":
   1353             misc.verbose("Calling mwrank C++ library.")

<type 'exceptions.NotImplementedError'>: gens via mwrank only implemented for curves with integer coefficients.
```

See how trivial this will now be to implement:

```
sage: F = E.minimal_model()
sage: phi = F.isomorphism_to(E)
sage: [phi(z) for z in F.gens()]
[(10/9 : 29/54 : 1)]
```

What could be easier?


**Assignee:** @williamstein

**Keywords:** editor_wstein

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/3119





---

archive/issue_comments_024509.json:
```json
{
    "body": "<a id='comment:1'></a>\nIn fact it is even easier than that!  For about 6 months mwrank has had the ability to deal with non-integral and non-minimal models.  In this case simply commenting out lines 1350 and 1351 in ell_rational_field.py produces this:\n\n```\nsage: E = EllipticCurve([-3/8,-2/3])\nsage: E.gens()\n[(10/9 : 29/54 : 1)]\n```\n\nPatch coming up.",
    "created_at": "2008-05-26T13:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24509",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
In fact it is even easier than that!  For about 6 months mwrank has had the ability to deal with non-integral and non-minimal models.  In this case simply commenting out lines 1350 and 1351 in ell_rational_field.py produces this:

```
sage: E = EllipticCurve([-3/8,-2/3])
sage: E.gens()
[(10/9 : 29/54 : 1)]
```

Patch coming up.



---

archive/issue_events_009100.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "rename": {
        "from": "elliptic curves -- implement gens function for non-integral models",
        "to": "[with patch: needs review] elliptic curves -- implement gens function for non-integral models"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9100"
}
```



---

archive/issue_comments_024510.json:
```json
{
    "body": "<a id='comment:2'></a>\nAttachment [trac-3119.patch](tarball://root/attachments/some-uuid/ticket3119/trac-3119.patch) by @JohnCremona created at 2008-05-26 13:55:17\n\nThe attached patch fixes the (spurious) error caused by an unnecessary testing for a case (non-integral curves) which are in fact well handled by mwrank.  At the same time I deleted the first TODO item from gens() since non-minimal models are similarly catered for.\n\nTwo new doctests illustrate the successful running of gens() on non-integral and non-minimal curves.\n\nOne small other thing:  when gens() calls mwrank it passes the command-line parameter \"-p 100\" which helps curves with large coefficients and 2-torsion and is otherwise harmless.  This is pending a more intelligent handling of mwrank options in gens() (which is nontrivial since gens() needs to parse the output from mwrank and this is seriously affected by what parameters the user passes!).\n\nIn fact it would be much better to avoid the mwrank console at all for gens() and just use the library.  This is in progress (see #1949)",
    "created_at": "2008-05-26T13:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24510",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
Attachment [trac-3119.patch](tarball://root/attachments/some-uuid/ticket3119/trac-3119.patch) by @JohnCremona created at 2008-05-26 13:55:17

The attached patch fixes the (spurious) error caused by an unnecessary testing for a case (non-integral curves) which are in fact well handled by mwrank.  At the same time I deleted the first TODO item from gens() since non-minimal models are similarly catered for.

Two new doctests illustrate the successful running of gens() on non-integral and non-minimal curves.

One small other thing:  when gens() calls mwrank it passes the command-line parameter "-p 100" which helps curves with large coefficients and 2-torsion and is otherwise harmless.  This is pending a more intelligent handling of mwrank options in gens() (which is nontrivial since gens() needs to parse the output from mwrank and this is seriously affected by what parameters the user passes!).

In fact it would be much better to avoid the mwrank console at all for gens() and just use the library.  This is in progress (see #1949)



---

archive/issue_comments_024511.json:
```json
{
    "body": "Apply after first patch",
    "created_at": "2008-05-26T17:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24511",
    "user": "https://github.com/JohnCremona"
}
```

Apply after first patch



---

archive/issue_events_009101.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "rename": {
        "from": "[with patch: needs review] elliptic curves -- implement gens function for non-integral models",
        "to": "[with patches: needs review] elliptic curves -- implement gens function for non-integral models"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9101"
}
```



---

archive/issue_comments_024512.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [9774.patch](tarball://root/attachments/some-uuid/ticket3119/9774.patch) by @JohnCremona created at 2008-05-26 17:49:03\n\nAnother patch (to be applied after previous) fixing two other things:\n\nFirst:  I finally got rid of the terrible behaviour of the mwrank_EllipticCurve constructor with non-integral input.  It now throws an error.  [Although mwrank can take non-integral elliptic curves in some circumstances, this will require more work.]\n\nSecond:  There was a bug in the gens() function for \n\nBefore:\n\n```\nsage: E=EllipticCurve('389a1').change_weierstrass_model([1/20,0,0,0])\nsage: E.gens(algorithm=\"mwrank_lib\")\n[(0 : 1 : 0), (0 : 1 : 0)]\n```\nwhich is not just wrong but very wrong!\n\nAfter:\n\n```\nsage: E=EllipticCurve('389a1').change_weierstrass_model([1/20,0,0,0])\nsage: E.gens(algorithm='mwrank_lib')\n[(-400 : 8000 : 1), (0 : -8000 : 1)]\n```",
    "created_at": "2008-05-26T17:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24512",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
Attachment [9774.patch](tarball://root/attachments/some-uuid/ticket3119/9774.patch) by @JohnCremona created at 2008-05-26 17:49:03

Another patch (to be applied after previous) fixing two other things:

First:  I finally got rid of the terrible behaviour of the mwrank_EllipticCurve constructor with non-integral input.  It now throws an error.  [Although mwrank can take non-integral elliptic curves in some circumstances, this will require more work.]

Second:  There was a bug in the gens() function for 

Before:

```
sage: E=EllipticCurve('389a1').change_weierstrass_model([1/20,0,0,0])
sage: E.gens(algorithm="mwrank_lib")
[(0 : 1 : 0), (0 : 1 : 0)]
```
which is not just wrong but very wrong!

After:

```
sage: E=EllipticCurve('389a1').change_weierstrass_model([1/20,0,0,0])
sage: E.gens(algorithm='mwrank_lib')
[(-400 : 8000 : 1), (0 : -8000 : 1)]
```



---

archive/issue_comments_024513.json:
```json
{
    "body": "<a id='comment:4'></a>\nComment:  The one-line change to wrap.cc which (really) fixes the bug exemplified above is actually unnecessary in the sense that there was an underlying bug in eclib which should be fixed instead.  The currect code still works, however.\n\nTechnical detail:  eclib provides support for non-minimal and non-integral curves via a slight subterfuge whereby the curve actually worked is integral and minimal, and a scaling factor is stored.   mwrank itself (and all other executables in eclib) manage this fine: they construct the two_descent object using a vector of 5 rationals rather than a curvedata type.  The constructor from a curvedata type is still there and is the one used by Sage -- but it forgot to set the scale factor to 1.  This messes up the points returned by member function getbasis().   The currect fix is to have sage call getpbasis() instead (which does not do this scaling) which is OK if and only if the model was integral to start with.  Which it is, currently, since we do not yet have a constructor for mwrank_EllipticCurve which takes non-integral rationals.\n\nI'll be fixing eclib in due course.",
    "created_at": "2008-05-26T20:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24513",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:4'></a>
Comment:  The one-line change to wrap.cc which (really) fixes the bug exemplified above is actually unnecessary in the sense that there was an underlying bug in eclib which should be fixed instead.  The currect code still works, however.

Technical detail:  eclib provides support for non-minimal and non-integral curves via a slight subterfuge whereby the curve actually worked is integral and minimal, and a scaling factor is stored.   mwrank itself (and all other executables in eclib) manage this fine: they construct the two_descent object using a vector of 5 rationals rather than a curvedata type.  The constructor from a curvedata type is still there and is the one used by Sage -- but it forgot to set the scale factor to 1.  This messes up the points returned by member function getbasis().   The currect fix is to have sage call getpbasis() instead (which does not do this scaling) which is OK if and only if the model was integral to start with.  Which it is, currently, since we do not yet have a constructor for mwrank_EllipticCurve which takes non-integral rationals.

I'll be fixing eclib in due course.



---

archive/issue_comments_024514.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [eclib.patch](tarball://root/attachments/some-uuid/ticket3119/eclib.patch) by @JohnCremona created at 2008-05-26 21:29:09\n\nExtra patch added to fix the same bug in a better way.  Now wrap.cc should not need to be changed -- just checking...",
    "created_at": "2008-05-26T21:29:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24514",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
Attachment [eclib.patch](tarball://root/attachments/some-uuid/ticket3119/eclib.patch) by @JohnCremona created at 2008-05-26 21:29:09

Extra patch added to fix the same bug in a better way.  Now wrap.cc should not need to be changed -- just checking...



---

archive/issue_comments_024515.json:
```json
{
    "body": "<a id='comment:6'></a>\nAttachment [trac-3119a.patch](tarball://root/attachments/some-uuid/ticket3119/trac-3119a.patch) by @JohnCremona created at 2008-05-26 22:11:45\n\nLatest patch trac-3119a.patch undoes one change in the original patch (the one-line change to wrap.cc) since the same thing is fixed better by patching eclib.  I have tested this, so I hope it is clear.",
    "created_at": "2008-05-26T22:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24515",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>
Attachment [trac-3119a.patch](tarball://root/attachments/some-uuid/ticket3119/trac-3119a.patch) by @JohnCremona created at 2008-05-26 22:11:45

Latest patch trac-3119a.patch undoes one change in the original patch (the one-line change to wrap.cc) since the same thing is fixed better by patching eclib.  I have tested this, so I hope it is clear.



---

archive/issue_comments_024516.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"editor_wstein\".",
    "created_at": "2008-06-15T21:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24516",
    "user": "https://github.com/craigcitro"
}
```

**Changing keywords** from "" to "editor_wstein".



---

archive/issue_events_009102.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "rename": {
        "from": "[with patches: needs review] elliptic curves -- implement gens function for non-integral models",
        "to": "[with patches: under review by wstein] elliptic curves -- implement gens function for non-integral models"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9102"
}
```



---

archive/issue_comments_024517.json:
```json
{
    "body": "this is the *fourth* patch to the sage main repo that has to be applied",
    "created_at": "2008-06-16T00:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24517",
    "user": "https://github.com/williamstein"
}
```

this is the *fourth* patch to the sage main repo that has to be applied



---

archive/issue_comments_024518.json:
```json
{
    "body": "<a id='comment:9'></a>\nAttachment [sage-3119-part4.patch](tarball://root/attachments/some-uuid/ticket3119/sage-3119-part4.patch) by @williamstein created at 2008-06-16 00:35:57\n\nREFEREE REPORT:\n\nExcellent.  However there are several doctest failures after applying the patches:\n\n```\nD-69-91-137-77:~ was$ sage -t d/sage/sage/schemes/elliptic_curves/ell_rational_field.pysage -t  d/sage/sage/schemes/elliptic_curves/ell_rational_field.py\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 145:\n    sage: E.gens()         # causes actual rank to be computed\nExpected:\n    [(0 : -1 : 1)]\nGot:\n    [(0 : 0 : 1)]\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 147:\n    sage: E.rank()         # the correct rank\nExpected:\n    1\nGot:\n    99\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 1413:\n    sage: E.gens()\nExpected:\n    [(0 : -1 : 1)]\nGot:\n    [(0 : 0 : 1)]\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 1538:\n    sage: Q=5*P; Q\nExpected:\n    (1/4 : -3/8 : 1)\nGot:\n    (1/4 : -5/8 : 1)\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 1540:\n    sage: E.saturation([Q])\nExpected:\n    ([(0 : -1 : 1)], '5', 0.0511114075779915)\nGot:\n    ([(0 : 0 : 1)], '5', 0.0511114075779915)\n**********************************************************************\nFile \"/Users/was/s/tmp/ell_rational_field.py\", line 252:\n    sage: E.gens()\nExpected:\n    [(-2 : 3 : 1), (-7/4 : 25/8 : 1), (1 : -1 : 1)]\nGot:\n    [(-2 : 3 : 1), (-1 : 3 : 1), (0 : 2 : 1)]\n**********************************************************************\n5 items had failures:\n   2 of   6 in __main__.example_2\n   1 of   4 in __main__.example_32\n   2 of   5 in __main__.example_35\n   1 of   6 in __main__.example_62\n   1 of   8 in __main__.example_7\n***Test Failed*** 7 failures.\nFor whitespace errors, see the file /Users/was/s/tmp/.doctest_ell_rational_field.py\n\t [47.8 s]\nexit code: 1024\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  d/sage/sage/schemes/elliptic_curves/ell_rational_field.py\nTotal time for all tests: 47.8 seconds\n```\n\n}}}",
    "created_at": "2008-06-16T00:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24518",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:9'></a>
Attachment [sage-3119-part4.patch](tarball://root/attachments/some-uuid/ticket3119/sage-3119-part4.patch) by @williamstein created at 2008-06-16 00:35:57

REFEREE REPORT:

Excellent.  However there are several doctest failures after applying the patches:

```
D-69-91-137-77:~ was$ sage -t d/sage/sage/schemes/elliptic_curves/ell_rational_field.pysage -t  d/sage/sage/schemes/elliptic_curves/ell_rational_field.py
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 145:
    sage: E.gens()         # causes actual rank to be computed
Expected:
    [(0 : -1 : 1)]
Got:
    [(0 : 0 : 1)]
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 147:
    sage: E.rank()         # the correct rank
Expected:
    1
Got:
    99
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 1413:
    sage: E.gens()
Expected:
    [(0 : -1 : 1)]
Got:
    [(0 : 0 : 1)]
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 1538:
    sage: Q=5*P; Q
Expected:
    (1/4 : -3/8 : 1)
Got:
    (1/4 : -5/8 : 1)
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 1540:
    sage: E.saturation([Q])
Expected:
    ([(0 : -1 : 1)], '5', 0.0511114075779915)
Got:
    ([(0 : 0 : 1)], '5', 0.0511114075779915)
**********************************************************************
File "/Users/was/s/tmp/ell_rational_field.py", line 252:
    sage: E.gens()
Expected:
    [(-2 : 3 : 1), (-7/4 : 25/8 : 1), (1 : -1 : 1)]
Got:
    [(-2 : 3 : 1), (-1 : 3 : 1), (0 : 2 : 1)]
**********************************************************************
5 items had failures:
   2 of   6 in __main__.example_2
   1 of   4 in __main__.example_32
   2 of   5 in __main__.example_35
   1 of   6 in __main__.example_62
   1 of   8 in __main__.example_7
***Test Failed*** 7 failures.
For whitespace errors, see the file /Users/was/s/tmp/.doctest_ell_rational_field.py
	 [47.8 s]
exit code: 1024
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  d/sage/sage/schemes/elliptic_curves/ell_rational_field.py
Total time for all tests: 47.8 seconds
```

}}}



---

archive/issue_events_009103.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "rename": {
        "from": "[with patches: under review by wstein] elliptic curves -- implement gens function for non-integral models",
        "to": "[with patches: needs work] elliptic curves -- implement gens function for non-integral models"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9103"
}
```



---

archive/issue_comments_024519.json:
```json
{
    "body": "<a id='comment:11'></a>\nWilliam -- my patches to sort this one out included a (tiny) patch to eclib source code which I posted here.  Without that patch the issue is *not* fixed.  Can you confirm whether or not you were testing with a patched eclib?  John",
    "created_at": "2008-06-16T13:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24519",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:11'></a>
William -- my patches to sort this one out included a (tiny) patch to eclib source code which I posted here.  Without that patch the issue is *not* fixed.  Can you confirm whether or not you were testing with a patched eclib?  John



---

archive/issue_comments_024520.json:
```json
{
    "body": "<a id='comment:12'></a>\nYes, I had that fix applied.  Does everything *definitely* work for you with that patch applied?",
    "created_at": "2008-06-19T23:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24520",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'></a>
Yes, I had that fix applied.  Does everything *definitely* work for you with that patch applied?



---

archive/issue_comments_024521.json:
```json
{
    "body": "<a id='comment:13'></a>\nI applied all 4 patches to a fresh install of 3.0.3.rc0, which I believe is the same as 3.0.3.  I did not apply the eclib patch which I assumed had been already applied to 3.0.3 (if Michael reads this could he confirm?).  And there were no problems:\n\n```\njohn@ubuntu%sage -t /home/john/sage-3.0.3.rc0/devel/sage-3119/sage/schemes/elliptic_curves/ell_rational_field.py \nsage -t  devel/sage-3119/sage/schemes/elliptic_curves/ell_rational_field.py\n\t [112.5 s]\n``` \nSo this is rather mysterious.\n\nIncidentally some of those tests are taking a bit long.",
    "created_at": "2008-06-20T20:33:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24521",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
I applied all 4 patches to a fresh install of 3.0.3.rc0, which I believe is the same as 3.0.3.  I did not apply the eclib patch which I assumed had been already applied to 3.0.3 (if Michael reads this could he confirm?).  And there were no problems:

```
john@ubuntu%sage -t /home/john/sage-3.0.3.rc0/devel/sage-3119/sage/schemes/elliptic_curves/ell_rational_field.py 
sage -t  devel/sage-3119/sage/schemes/elliptic_curves/ell_rational_field.py
	 [112.5 s]
``` 
So this is rather mysterious.

Incidentally some of those tests are taking a bit long.



---

archive/issue_comments_024522.json:
```json
{
    "body": "<a id='comment:14'></a>\nDouble check:\n* New build of 3.0.3\n* new clone set up\n* Apply the four patches attached excluding the eclib one\n* Rebuild eclib after applying the eclib patch\nNow all doctests pass in ell_rational_field and so does the one above which definitely does not work without eclib being correctly patched.\n\nHence I humbly ask that the reviewer re-checks!",
    "created_at": "2008-06-22T16:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24522",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>
Double check:
* New build of 3.0.3
* new clone set up
* Apply the four patches attached excluding the eclib one
* Rebuild eclib after applying the eclib patch
Now all doctests pass in ell_rational_field and so does the one above which definitely does not work without eclib being correctly patched.

Hence I humbly ask that the reviewer re-checks!



---

archive/issue_comments_024523.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe newly patched eclib at  http://www.warwick.ac.uk/staff/J.E.Cremona/eclib-20080310.p3.spkg contains several small fixes *including* the eclib.patch attached to this ticket already.",
    "created_at": "2008-06-23T21:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24523",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:15'></a>
The newly patched eclib at  http://www.warwick.ac.uk/staff/J.E.Cremona/eclib-20080310.p3.spkg contains several small fixes *including* the eclib.patch attached to this ticket already.



---

archive/issue_comments_024524.json:
```json
{
    "body": "<a id='comment:16'></a>\nI have split of the spkg to #3509.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-25T08:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24524",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:16'></a>
I have split of the spkg to #3509.

Cheers,

Michael



---

archive/issue_comments_024525.json:
```json
{
    "body": "*New* simpler patch replacing all previous ones for this ticket",
    "created_at": "2008-06-28T15:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24525",
    "user": "https://github.com/JohnCremona"
}
```

*New* simpler patch replacing all previous ones for this ticket



---

archive/issue_comments_024526.json:
```json
{
    "body": "<a id='comment:17'></a>\nAttachment [sage-3119-new.patch](tarball://root/attachments/some-uuid/ticket3119/sage-3119-new.patch) by @JohnCremona created at 2008-06-28 16:06:21\n\nI have combined and simplified the confusion of earlier patches, so now only *one* need to be applied: sage-3119-new.patch.  This is based in version 3.0.4.alpha0.  Note that it requires  eclib-20080310.p3 which is not in 3.0.4.alpha0 but is in alpha1 (the one which did not build) so reviewers should test with 3.0.4.alpha2 (or later). If run with the older eclib, the doctests in ell_rational_field.py still pass but take about 4 times as long (proving that the patch to eclib is not quite as trivial as it appears).",
    "created_at": "2008-06-28T16:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24526",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:17'></a>
Attachment [sage-3119-new.patch](tarball://root/attachments/some-uuid/ticket3119/sage-3119-new.patch) by @JohnCremona created at 2008-06-28 16:06:21

I have combined and simplified the confusion of earlier patches, so now only *one* need to be applied: sage-3119-new.patch.  This is based in version 3.0.4.alpha0.  Note that it requires  eclib-20080310.p3 which is not in 3.0.4.alpha0 but is in alpha1 (the one which did not build) so reviewers should test with 3.0.4.alpha2 (or later). If run with the older eclib, the doctests in ell_rational_field.py still pass but take about 4 times as long (proving that the patch to eclib is not quite as trivial as it appears).



---

archive/issue_events_009104.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "rename": {
        "from": "[with patches: needs work] elliptic curves -- implement gens function for non-integral models",
        "to": "[with new patche: needs review -- easy] elliptic curves -- implement gens function for non-integral models"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9104"
}
```



---

archive/issue_events_009105.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "rename": {
        "from": "[with new patche: needs review -- easy] elliptic curves -- implement gens function for non-integral models",
        "to": "[with patch: needs review -- easy] elliptic curves -- implement gens function for non-integral models"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9105"
}
```



---

archive/issue_events_009106.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "rename": {
        "from": "[with patch: needs review -- easy] elliptic curves -- implement gens function for non-integral models",
        "to": "[with patch: needs review] elliptic curves -- implement gens function for non-integral models"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9106"
}
```



---

archive/issue_comments_024527.json:
```json
{
    "body": "<a id='comment:19'></a>\nI have checked that this patch still applies cleanly and passes tests with 3.1.alpha0.\n\nIt is a *very simple* patch -- the serious change happened in eclib and has already been merged.\n\nPlease will someone help put this to bed!",
    "created_at": "2008-08-09T08:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24527",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:19'></a>
I have checked that this patch still applies cleanly and passes tests with 3.1.alpha0.

It is a *very simple* patch -- the serious change happened in eclib and has already been merged.

Please will someone help put this to bed!



---

archive/issue_comments_024528.json:
```json
{
    "body": "<a id='comment:20'></a>\nThis works for me with 3.0.6.  The sage library patch looks good; I haven't checked the already merged changes to eclib.\n\nApply!",
    "created_at": "2008-08-10T21:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24528",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:20'></a>
This works for me with 3.0.6.  The sage library patch looks good; I haven't checked the already merged changes to eclib.

Apply!



---

archive/issue_events_009107.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "rename": {
        "from": "[with patch: needs review] elliptic curves -- implement gens function for non-integral models",
        "to": "[with positive review] elliptic curves -- implement gens function for non-integral models"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9107"
}
```



---

archive/issue_comments_024529.json:
```json
{
    "body": "<a id='comment:21'></a>\nPatch looks good to me, but there is a minimal doctest issue related to numerical noise that I fixed:\n\n```\nsage -t -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py\n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.1.alpha1/tmp/ell_rational_field.py\", line 1475:\n    sage: EllipticCurve([0, 0, 1, -79, 342]).regulator(proof=False)  # long time (seconds)\nExpected:\n    14.7905275701310\nGot:\n    14.7905275701311\n**********************************************************************\n```\n\nCheers,\n\nMichael",
    "created_at": "2008-08-11T01:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24529",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:21'></a>
Patch looks good to me, but there is a minimal doctest issue related to numerical noise that I fixed:

```
sage -t -long devel/sage/sage/schemes/elliptic_curves/ell_rational_field.py
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.1.alpha1/tmp/ell_rational_field.py", line 1475:
    sage: EllipticCurve([0, 0, 1, -79, 342]).regulator(proof=False)  # long time (seconds)
Expected:
    14.7905275701310
Got:
    14.7905275701311
**********************************************************************
```

Cheers,

Michael



---

archive/issue_comments_024530.json:
```json
{
    "body": "<a id='comment:22'></a>\nMerged in Sage 3.1.alpha1",
    "created_at": "2008-08-11T02:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24530",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:22'></a>
Merged in Sage 3.1.alpha1



---

archive/issue_events_009108.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-11T02:05:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "milestone": "sage-3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9108"
}
```



---

archive/issue_comments_024531.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-08-11T02:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3119#issuecomment-24531",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_events_009109.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-11T02:05:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/3119",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3119#event-9109"
}
```
