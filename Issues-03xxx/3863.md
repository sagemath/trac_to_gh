# Issue 3863: Have numerical evaluation of unevaluated integrals call numerical integral

archive/issues_003863.json:
```json
{
    "assignees": [
        "https://github.com/mwhansen"
    ],
    "body": "<div id=\"comment:0\"></div>\n\n\n```\n----------------------------------------------------------------------\n| SAGE Version 3.0.6, Release Date: 2008-07-30                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n\nsage: x = var('x')\nsage: integrate(x^2.7 * e^(-2.4*x), x, 0, 3).n()\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/drake/sage-3.0.6.final/<ipython console> in <module>()\n\n/home/was/s/local/lib/python2.5/site-packages/sage/calculus/calculus.py in numerical_approx(self, prec, digits)\n   1266         except TypeError:\n   1267             # try to return a complex result\n-> 1268             approx = self._complex_mpfr_field_(ComplexField(prec))\n   1269 \n   1270         return approx\n\n/home/was/s/local/lib/python2.5/site-packages/sage/calculus/calculus.py in _complex_mpfr_field_(self, field)\n   1419 \n   1420     def _complex_mpfr_field_(self, field):\n-> 1421         raise TypeError\n   1422 \n   1423     def _complex_double_(self, C):\n\nTypeError: \nsage: \n```\n\nOddly, the `plot` function has no difficulty, so *some* part of Sage can numerically evaluate the function:\n\n```\nplot(x^2.7 * e^(-2.4*x), x, 0, 3)\n```\nworks fine.\n\nSome values for the exponents do work -- it seems like the exponent of `x` needs to be an integer or half-integer:\n\n```\n(2.7, -2.4): this is the above example\n(27/10, -2.4): same error as above\n(1.5, -2.4): works\n(1.6, -2.4): same error as above\n(1.6, -2.0): same error as above\n(1.0, -2.4): works\n(5.5, -2.4): works\n```\n\nComponent: **calculus**\n\nKeywords: **integration integral calculus symbolic numerical**\n\nAuthor: **Golam Mortuza Hossain, Burcin Erocal**\n\nReviewer: **Dan Drake**\n\nMerged: **sage-4.4.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/3863_\n\n",
    "closed_at": "2010-04-15T20:16:07Z",
    "created_at": "2008-08-15T00:46:06Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20calculus",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20calculus",
        "https://github.com/sagemath/sage/labels/c%3A%20numerical"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Have numerical evaluation of unevaluated integrals call numerical integral",
    "type": "issue",
    "updated_at": "2010-04-15T20:16:07Z",
    "url": "https://github.com/sagemath/sage/issues/3863",
    "user": "https://github.com/dandrake"
}
```
<div id="comment:0"></div>


```
----------------------------------------------------------------------
| SAGE Version 3.0.6, Release Date: 2008-07-30                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------

sage: x = var('x')
sage: integrate(x^2.7 * e^(-2.4*x), x, 0, 3).n()
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/drake/sage-3.0.6.final/<ipython console> in <module>()

/home/was/s/local/lib/python2.5/site-packages/sage/calculus/calculus.py in numerical_approx(self, prec, digits)
   1266         except TypeError:
   1267             # try to return a complex result
-> 1268             approx = self._complex_mpfr_field_(ComplexField(prec))
   1269 
   1270         return approx

/home/was/s/local/lib/python2.5/site-packages/sage/calculus/calculus.py in _complex_mpfr_field_(self, field)
   1419 
   1420     def _complex_mpfr_field_(self, field):
-> 1421         raise TypeError
   1422 
   1423     def _complex_double_(self, C):

TypeError: 
sage: 
```

Oddly, the `plot` function has no difficulty, so *some* part of Sage can numerically evaluate the function:

```
plot(x^2.7 * e^(-2.4*x), x, 0, 3)
```
works fine.

Some values for the exponents do work -- it seems like the exponent of `x` needs to be an integer or half-integer:

```
(2.7, -2.4): this is the above example
(27/10, -2.4): same error as above
(1.5, -2.4): works
(1.6, -2.4): same error as above
(1.6, -2.0): same error as above
(1.0, -2.4): works
(5.5, -2.4): works
```

Component: **calculus**

Keywords: **integration integral calculus symbolic numerical**

Author: **Golam Mortuza Hossain, Burcin Erocal**

Reviewer: **Dan Drake**

Merged: **sage-4.4.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/3863_





---

archive/issue_events_042518.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2008-08-15T00:46:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "milestone_number": null,
    "milestone_title": "sage-4.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42518"
}
```



---

archive/issue_events_042519.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2008-08-15T00:46:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42519"
}
```



---

archive/issue_events_042520.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2008-08-15T00:46:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42520"
}
```



---

archive/issue_events_042521.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2008-08-15T00:46:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42521"
}
```



---

archive/issue_events_042522.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2008-08-15T00:46:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42522"
}
```



---

archive/issue_events_042523.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-08-15T00:46:06Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "subject": "https://github.com/dandrake",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42523"
}
```



---

archive/issue_comments_021380.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nWith the new symbolics in 4.0.rc0, this still doesn't work; the error is now:\n\n```\nsage: integrate(x^2.7 * exp(-2.4*x), x, 0, 3).n()\nERROR: An unexpected error occurred while tokenizing input\nThe following traceback may be corrupted or invalid\nThe error message is: ('EOF in multi-line statement', (10003, 0))\n\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/drake/.sage/temp/sage.math.washington.edu/22166/_home_drake__sage_init_sage_0.py in <module>()\n\n/scratch/drake/4.0.rc0/local/lib/python2.5/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.n (sage/symbolic/expression.cpp:15691)()\n\n/scratch/drake/4.0.rc0/local/lib/python2.5/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.pyobject (sage/symbolic/expression.cpp:2641)()\n\nTypeError: self must be a numeric expression\n```\nPutting parentheses around the 2.7 and -2.4 didn't change anything.",
    "created_at": "2009-05-21T11:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21380",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:1" align="right">comment:1</div>

With the new symbolics in 4.0.rc0, this still doesn't work; the error is now:

```
sage: integrate(x^2.7 * exp(-2.4*x), x, 0, 3).n()
ERROR: An unexpected error occurred while tokenizing input
The following traceback may be corrupted or invalid
The error message is: ('EOF in multi-line statement', (10003, 0))

---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/drake/.sage/temp/sage.math.washington.edu/22166/_home_drake__sage_init_sage_0.py in <module>()

/scratch/drake/4.0.rc0/local/lib/python2.5/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.n (sage/symbolic/expression.cpp:15691)()

/scratch/drake/4.0.rc0/local/lib/python2.5/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.pyobject (sage/symbolic/expression.cpp:2641)()

TypeError: self must be a numeric expression
```
Putting parentheses around the 2.7 and -2.4 didn't change anything.



---

archive/issue_comments_021381.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe essential problem is that with half-integer or integer exponents of x, Maxima can symbolically integrate this using Erf.   Otherwise it can't (that doesn't mean it's not possible, just that Maxima doesn't know).  Before, Sage tried to turn the expression into a complex one if it couldn't evaluate it, but that doesn't do much for a real (unevaluated) integral; now the new symbolics just complain that it's not numeric, which of course it isn't.\n\nMy view is that the correct fix is to put some kind of check in for when \"integrate\" is part of the output string fed into .n() and in that case at least attempt to use numerical_integral or something.  Of course that has the problem that things like \n\n```\nsage: integrate(1/(1+x^7))\n1/7*log(x + 1) - 1/7*integrate((x^5 - 2*x^4 + 3*x^3 - 4*x^2 + 5*x - 6)/(x^6 - x^5 + x^4 - x^3 + x^2 - x + 1), x)\n```\nMaxima is able to partly symbolically integrate, leaving\n\n```\nsage: integrate(1/(1+x^7),x,0,1)\n```\nin trouble.  But at least a check for \"integrate\" at the beginning could help.",
    "created_at": "2009-05-22T15:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21381",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:2" align="right">comment:2</div>

The essential problem is that with half-integer or integer exponents of x, Maxima can symbolically integrate this using Erf.   Otherwise it can't (that doesn't mean it's not possible, just that Maxima doesn't know).  Before, Sage tried to turn the expression into a complex one if it couldn't evaluate it, but that doesn't do much for a real (unevaluated) integral; now the new symbolics just complain that it's not numeric, which of course it isn't.

My view is that the correct fix is to put some kind of check in for when "integrate" is part of the output string fed into .n() and in that case at least attempt to use numerical_integral or something.  Of course that has the problem that things like 

```
sage: integrate(1/(1+x^7))
1/7*log(x + 1) - 1/7*integrate((x^5 - 2*x^4 + 3*x^3 - 4*x^2 + 5*x - 6)/(x^6 - x^5 + x^4 - x^3 + x^2 - x + 1), x)
```
Maxima is able to partly symbolically integrate, leaving

```
sage: integrate(1/(1+x^7),x,0,1)
```
in trouble.  But at least a check for "integrate" at the beginning could help.



---

archive/issue_comments_021382.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@kcrisman](#comment%3A2):\n> The essential problem is that with half-integer or integer exponents of x, Maxima can symbolically integrate this using Erf.   Otherwise it can't (that doesn't mean it's not possible, just that Maxima doesn't know).  Before, Sage tried to turn the expression into a complex one if it couldn't evaluate it, but that doesn't do much for a real (unevaluated) integral; now the new symbolics just complain that it's not numeric, which of course it isn't.\n\nAh, that makes sense. I don't mind that just naively running `.n()` doesn't work; we could have, like Mathematica, some sort of numerical_integrate that would try to evaluate the integral, and then punt to something like Simpson's rule to just estimate it. I'm sure, though, that there's vastly better ways to actually do numerical integrals than just a plain vanilla Calculus 1 application of Simpson's Rule.",
    "created_at": "2009-05-23T01:50:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21382",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@kcrisman](#comment%3A2):
> The essential problem is that with half-integer or integer exponents of x, Maxima can symbolically integrate this using Erf.   Otherwise it can't (that doesn't mean it's not possible, just that Maxima doesn't know).  Before, Sage tried to turn the expression into a complex one if it couldn't evaluate it, but that doesn't do much for a real (unevaluated) integral; now the new symbolics just complain that it's not numeric, which of course it isn't.

Ah, that makes sense. I don't mind that just naively running `.n()` doesn't work; we could have, like Mathematica, some sort of numerical_integrate that would try to evaluate the integral, and then punt to something like Simpson's rule to just estimate it. I'm sure, though, that there's vastly better ways to actually do numerical integrals than just a plain vanilla Calculus 1 application of Simpson's Rule.



---

archive/issue_comments_021383.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOh, totally, and of course we have numerical_integrate and nintegral (one is Maxima, one is GSL I think).  So I guess what I'm saying is that when someone has time (which won't be me until June due to the (US) holiday and then a conference) it should be relatively straightforward to at least do something in the generic code for .n() on whatever kind of object (symbolic?) an expression like integrate(f(x),x,a,b) is like\n\n```\ntry:\n    usual code\nexcept TypeError:\n    if \"integrate\" is in the string:\n        either reraise the TypeError with a message suggesting the use of numerical_integrate\n        or actually try to string-magic replace \"integrate\" with \"numerical_integrate\", which should be possible (you'd have to take [0] of that result, of course)\n    else:\n        do whatever used to happen with a TypeError\n```\nI think that it is reasonable for a user to expect that .n() numerically evaluates an expression as best as possible, even one Maxima can't evaluate!  And all these methods are much more sophisticated than Simpson, certainly, so that's not the issue.",
    "created_at": "2009-05-23T18:52:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21383",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:4" align="right">comment:4</div>

Oh, totally, and of course we have numerical_integrate and nintegral (one is Maxima, one is GSL I think).  So I guess what I'm saying is that when someone has time (which won't be me until June due to the (US) holiday and then a conference) it should be relatively straightforward to at least do something in the generic code for .n() on whatever kind of object (symbolic?) an expression like integrate(f(x),x,a,b) is like

```
try:
    usual code
except TypeError:
    if "integrate" is in the string:
        either reraise the TypeError with a message suggesting the use of numerical_integrate
        or actually try to string-magic replace "integrate" with "numerical_integrate", which should be possible (you'd have to take [0] of that result, of course)
    else:
        do whatever used to happen with a TypeError
```
I think that it is reasonable for a user to expect that .n() numerically evaluates an expression as best as possible, even one Maxima can't evaluate!  And all these methods are much more sophisticated than Simpson, certainly, so that's not the issue.



---

archive/issue_comments_021384.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nActually, the solution is much cleaner since .n() will call the `_evalf_` method on the integrate function which we can just have resort to a numerical integral if it is definite and has no free variables.\n\nI'll look into this later.",
    "created_at": "2009-06-04T23:28:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21384",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:5" align="right">comment:5</div>

Actually, the solution is much cleaner since .n() will call the `_evalf_` method on the integrate function which we can just have resort to a numerical integral if it is definite and has no free variables.

I'll look into this later.



---

archive/issue_events_042524.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2009-06-04T23:28:02Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "subject": "https://github.com/mwhansen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42524"
}
```



---

archive/issue_events_042525.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-04T23:28:02Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "subject": "https://github.com/mwhansen",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42525"
}
```



---

archive/issue_comments_021385.json:
```json
{
    "body": "Changed keywords from **integration integral calculus symbolic** to **integration integral calculus symbolic numerical**",
    "created_at": "2009-12-22T17:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21385",
    "user": "https://github.com/kcrisman"
}
```

Changed keywords from **integration integral calculus symbolic** to **integration integral calculus symbolic numerical**



---

archive/issue_events_042526.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-12-22T17:27:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20numerical",
    "label_color": "0000ff",
    "label_name": "c: numerical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42526"
}
```



---

archive/issue_events_042527.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2009-12-22T17:27:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "title_is": "Have numerical evaluation of unevaluated integrals call numerical integral",
    "title_was": "numerical integration of x^2.7 * e^(-2.4*x) fails",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42527"
}
```



---

archive/issue_comments_021386.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nUpdate: in 4.3.alpha1 with Maxima 5.20.1, we now get\n\n```\nsage: integrate(x^2.7 * e^(-2.4*x), x, 0, 3)\n119/6144*2^(3/5)*3^(3/10)*5^(7/10)*gamma(7/10) - 125/20736*2^(3/5)*3^(3/10)*5^(7/10)*gamma_incomplete(37/10, 36/5)\n```\nBut it won't evaluate the gamma_incomplete, since for some reason we aren't translating it to gamma_inc or incomplete_gamma, which are the supported functions; however, otherwise it is correct (as comparing with results of numerical_integral).\n\nThis does not fix the problem, of course, but I will change the summary to get at the fundamental thing mhansen and I discussed, and open a separate ticket (if it doesn't exist) for the gamma_incomplete not being translated correctly from Maxima.  That is #7748.\n\nDo we in the meantime have the `_evalf_` method on a symbolic integral that can be changed?",
    "created_at": "2009-12-22T17:27:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21386",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:6" align="right">comment:6</div>

Update: in 4.3.alpha1 with Maxima 5.20.1, we now get

```
sage: integrate(x^2.7 * e^(-2.4*x), x, 0, 3)
119/6144*2^(3/5)*3^(3/10)*5^(7/10)*gamma(7/10) - 125/20736*2^(3/5)*3^(3/10)*5^(7/10)*gamma_incomplete(37/10, 36/5)
```
But it won't evaluate the gamma_incomplete, since for some reason we aren't translating it to gamma_inc or incomplete_gamma, which are the supported functions; however, otherwise it is correct (as comparing with results of numerical_integral).

This does not fix the problem, of course, but I will change the summary to get at the fundamental thing mhansen and I discussed, and open a separate ticket (if it doesn't exist) for the gamma_incomplete not being translated correctly from Maxima.  That is #7748.

Do we in the meantime have the `_evalf_` method on a symbolic integral that can be changed?



---

archive/issue_comments_021387.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@kcrisman](#comment%3A6):\n> Do we in the meantime have the `_evalf_` method on a symbolic integral that can be changed?\n\n#6465 has a patch with such an `_evalf_` method. It needs a rebase though. I'm still playing with the symbolic functions in pynac. If nobody gets to it, I'll update those patches after I'm done with pynac.",
    "created_at": "2009-12-22T22:50:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21387",
    "user": "https://github.com/burcin"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@kcrisman](#comment%3A6):
> Do we in the meantime have the `_evalf_` method on a symbolic integral that can be changed?

#6465 has a patch with such an `_evalf_` method. It needs a rebase though. I'm still playing with the symbolic functions in pynac. If nobody gets to it, I'll update those patches after I'm done with pynac.



---

archive/issue_comments_021388.json:
```json
{
    "body": "Attachment: **[trac_3863-doctest.patch.gz](https://github.com/sagemath/sage/files/ticket3863/trac_3863-doctest.patch.gz)**\n\ntrivial doctest",
    "created_at": "2010-04-05T13:02:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21388",
    "user": "https://github.com/burcin"
}
```

Attachment: **[trac_3863-doctest.patch.gz](https://github.com/sagemath/sage/files/ticket3863/trac_3863-doctest.patch.gz)**

trivial doctest



---

archive/issue_comments_021389.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis was fixed by #6465. Despite the fact that we still have problems with numerical integration (#8321), the problem addressed here is solved. I suggest that we add a doctest and close this ticket.\n\n[attachment: trac_3863-doctest.patch](https://github.com/sagemath/sage/files/ticket3863/trac_3863-doctest.patch.gz) adds a trivial doctest. Here is the same computation in Maple: \n\n```\n    |\\^/|     Maple 12 (IBM INTEL LINUX)\n._|\\|   |/|_. Copyright (c) Maplesoft, a division of Waterloo Maple Inc. 2008\n \\  MAPLE  /  All rights reserved. Maple is a trademark of\n <____ ____>  Waterloo Maple Inc.\n      |       Type ? for help.\n> Digits:=30;                             \n                                 Digits := 30\n\n> evalf(Int(x^2.7 * exp(-2.4*x), x=0..3));\nmemory used=3.8MB, alloc=3.1MB, time=0.06\nmemory used=7.6MB, alloc=4.4MB, time=0.13\nmemory used=11.4MB, alloc=4.4MB, time=0.21\n                       0.154572952320789711837207551604\n```",
    "created_at": "2010-04-05T13:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21389",
    "user": "https://github.com/burcin"
}
```

<div id="comment:8" align="right">comment:8</div>

This was fixed by #6465. Despite the fact that we still have problems with numerical integration (#8321), the problem addressed here is solved. I suggest that we add a doctest and close this ticket.

[attachment: trac_3863-doctest.patch](https://github.com/sagemath/sage/files/ticket3863/trac_3863-doctest.patch.gz) adds a trivial doctest. Here is the same computation in Maple: 

```
    |\^/|     Maple 12 (IBM INTEL LINUX)
._|\|   |/|_. Copyright (c) Maplesoft, a division of Waterloo Maple Inc. 2008
 \  MAPLE  /  All rights reserved. Maple is a trademark of
 <____ ____>  Waterloo Maple Inc.
      |       Type ? for help.
> Digits:=30;                             
                                 Digits := 30

> evalf(Int(x^2.7 * exp(-2.4*x), x=0..3));
memory used=3.8MB, alloc=3.1MB, time=0.06
memory used=7.6MB, alloc=4.4MB, time=0.13
memory used=11.4MB, alloc=4.4MB, time=0.21
                       0.154572952320789711837207551604
```



---

archive/issue_events_042528.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-04-05T13:07:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42528"
}
```



---

archive/issue_comments_021390.json:
```json
{
    "body": "Author: **Golam Mortuza Hossain, Burcin Erocal**",
    "created_at": "2010-04-05T13:07:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21390",
    "user": "https://github.com/burcin"
}
```

Author: **Golam Mortuza Hossain, Burcin Erocal**



---

archive/issue_events_042529.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2010-04-06T11:45:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42529"
}
```



---

archive/issue_events_042530.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2010-04-06T11:45:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42530"
}
```



---

archive/issue_comments_021391.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHrm, the doctest from the patch doesn't work for me:\n\n```\n----------------------------------------------------------------------\n| Sage Version 4.3.5, Release Date: 2010-03-28                       |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\nLoading Sage library. Current Mercurial branch is: review\nsage: integrate(x^2.7 * e^(-2.4*x), x, 0, 3).n() \n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/scratch/sage-4.3.5/<ipython console> in <module>()\n\n/scratch/sage-4.3.5/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.n (sage/symbolic/expression.cpp:17049)()\n\nTypeError: cannot evaluate symbolic expression numerically\n```",
    "created_at": "2010-04-06T11:45:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21391",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:9" align="right">comment:9</div>

Hrm, the doctest from the patch doesn't work for me:

```
----------------------------------------------------------------------
| Sage Version 4.3.5, Release Date: 2010-03-28                       |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------
Loading Sage library. Current Mercurial branch is: review
sage: integrate(x^2.7 * e^(-2.4*x), x, 0, 3).n() 
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/scratch/sage-4.3.5/<ipython console> in <module>()

/scratch/sage-4.3.5/local/lib/python2.6/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.n (sage/symbolic/expression.cpp:17049)()

TypeError: cannot evaluate symbolic expression numerically
```



---

archive/issue_comments_021392.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThanks for the quick feedback Dan.\n\nNow I remember why I didn't suggest to close this ticket earlier. Conversion of the result back from maxima was broken (#7661). Can you try with the patch from #7661 applied. Here is a quick link [attachment: trac_7661-maxima_convert_back.patch:ticket:7661.](https://github.com/sagemath/sage/files/ticket3863/3d02d29a2aeb600f8b6720b7e10a56c8.gz)",
    "created_at": "2010-04-06T12:53:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21392",
    "user": "https://github.com/burcin"
}
```

<div id="comment:10" align="right">comment:10</div>

Thanks for the quick feedback Dan.

Now I remember why I didn't suggest to close this ticket earlier. Conversion of the result back from maxima was broken (#7661). Can you try with the patch from #7661 applied. Here is a quick link [attachment: trac_7661-maxima_convert_back.patch:ticket:7661.](https://github.com/sagemath/sage/files/ticket3863/3d02d29a2aeb600f8b6720b7e10a56c8.gz)



---

archive/issue_events_042531.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-04-06T12:53:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42531"
}
```



---

archive/issue_events_042532.json:
```json
{
    "actor": "https://github.com/burcin",
    "created_at": "2010-04-06T12:53:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42532"
}
```



---

archive/issue_comments_021393.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@burcin](#comment%3A10):\n> Thanks for the quick feedback Dan.\n> \n> Now I remember why I didn't suggest to close this ticket earlier. Conversion of the result back from maxima was broken (#7661). Can you try with the patch from #7661 applied. Here is a quick link [attachment: trac_7661-maxima_convert_back.patch:ticket:7661.](https://github.com/sagemath/sage/files/ticket3863/3d02d29a2aeb600f8b6720b7e10a56c8.gz)\n\nUh oh...that patch doesn't apply. On top of vanilla 4.3.5, it fails in calculus.py and random_tests.py. I tried to fix the failing hunk in calculus.py (and ignored random_tests.py, since that seemed like a harmless change), but with that applied, it still fails for me.\n\nI tried applying the patches from #7748 on top of the #7661 patch, but Sage doesn't even properly start:\n\n```\n/scratch/sage-4.3.5/local/lib/python2.6/site-packages/sage/functions/other.py in <module>()\n    540 # We have to add the wrapper function manually to the symbol_table when we have\n\n    541 # two functions with different number of arguments and the same name\n\n--> 542 symbol_table['functions']['gamma'] = gamma\n    543 \n    544 class Function_gamma_inc(BuiltinFunction):\n\nNameError: name 'gamma' is not defined\nError importing ipy_profile_sage - perhaps you should run %upgrade?\nWARNING: Loading of ipy_profile_sage failed.\n```\n\nAny ideas?",
    "created_at": "2010-04-06T13:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21393",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@burcin](#comment%3A10):
> Thanks for the quick feedback Dan.
> 
> Now I remember why I didn't suggest to close this ticket earlier. Conversion of the result back from maxima was broken (#7661). Can you try with the patch from #7661 applied. Here is a quick link [attachment: trac_7661-maxima_convert_back.patch:ticket:7661.](https://github.com/sagemath/sage/files/ticket3863/3d02d29a2aeb600f8b6720b7e10a56c8.gz)

Uh oh...that patch doesn't apply. On top of vanilla 4.3.5, it fails in calculus.py and random_tests.py. I tried to fix the failing hunk in calculus.py (and ignored random_tests.py, since that seemed like a harmless change), but with that applied, it still fails for me.

I tried applying the patches from #7748 on top of the #7661 patch, but Sage doesn't even properly start:

```
/scratch/sage-4.3.5/local/lib/python2.6/site-packages/sage/functions/other.py in <module>()
    540 # We have to add the wrapper function manually to the symbol_table when we have

    541 # two functions with different number of arguments and the same name

--> 542 symbol_table['functions']['gamma'] = gamma
    543 
    544 class Function_gamma_inc(BuiltinFunction):

NameError: name 'gamma' is not defined
Error importing ipy_profile_sage - perhaps you should run %upgrade?
WARNING: Loading of ipy_profile_sage failed.
```

Any ideas?



---

archive/issue_comments_021394.json:
```json
{
    "body": "Reviewer: **Dan Drake**",
    "created_at": "2010-04-06T15:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21394",
    "user": "https://github.com/burcin"
}
```

Reviewer: **Dan Drake**



---

archive/issue_comments_021395.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nApparently #7661 depends on #7748, which already has a positive review, but requires 3 patches to be applied. Instructions are here: [#7748 comment:15](https://github.com/sagemath/sage/issues/7748#comment:15)\n\nI'm sorry for the inconvenience. Many thanks for helping me sort through the dependencies.",
    "created_at": "2010-04-06T15:54:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21395",
    "user": "https://github.com/burcin"
}
```

<div id="comment:12" align="right">comment:12</div>

Apparently #7661 depends on #7748, which already has a positive review, but requires 3 patches to be applied. Instructions are here: [#7748 comment:15](https://github.com/sagemath/sage/issues/7748#comment:15)

I'm sorry for the inconvenience. Many thanks for helping me sort through the dependencies.



---

archive/issue_comments_021396.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@burcin](#comment%3A12):\n> Apparently #7661 depends on #7748, which already has a positive review, but requires 3 patches to be applied. Instructions are here: [#7748 comment:15](https://github.com/sagemath/sage/issues/7748#comment:15)\n\nSuccess! With vanilla 4.3.5 and the following patches applied, the doctest passes!\n\n```\n$ hg qapplied\ntrac_7748-exp_integral_ver2.4.3.3.alpha1.patch\ntrac_7748-incomplete_gamma_ver2.4.3.3.alpha1.patch\ntrac_7748-gamma_wrapper.3.patch\ntrac_7661-maxima_convert_back.patch\ntrac_3863-doctest.patch\n```\nWith the same set of patches applied to 4.3.3 on bsd.math, the doctest also passes. Positive review here.",
    "created_at": "2010-04-07T02:28:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21396",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@burcin](#comment%3A12):
> Apparently #7661 depends on #7748, which already has a positive review, but requires 3 patches to be applied. Instructions are here: [#7748 comment:15](https://github.com/sagemath/sage/issues/7748#comment:15)

Success! With vanilla 4.3.5 and the following patches applied, the doctest passes!

```
$ hg qapplied
trac_7748-exp_integral_ver2.4.3.3.alpha1.patch
trac_7748-incomplete_gamma_ver2.4.3.3.alpha1.patch
trac_7748-gamma_wrapper.3.patch
trac_7661-maxima_convert_back.patch
trac_3863-doctest.patch
```
With the same set of patches applied to 4.3.3 on bsd.math, the doctest also passes. Positive review here.



---

archive/issue_events_042533.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2010-04-07T02:28:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42533"
}
```



---

archive/issue_events_042534.json:
```json
{
    "actor": "https://github.com/dandrake",
    "created_at": "2010-04-07T02:28:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42534"
}
```



---

archive/issue_comments_021397.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nRelease manager: this ticket depends on #7748 and #7761.",
    "created_at": "2010-04-07T02:46:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21397",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:14" align="right">comment:14</div>

Release manager: this ticket depends on #7748 and #7761.



---

archive/issue_comments_021398.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@dandrake](#comment%3A14):\n> Release manager: this ticket depends on #7748 and #7761. \n\nAck, typo: it's #7748 and #7661.",
    "created_at": "2010-04-07T02:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21398",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@dandrake](#comment%3A14):
> Release manager: this ticket depends on #7748 and #7761. 

Ack, typo: it's #7748 and #7661.



---

archive/issue_comments_021399.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nMerged \"trac_3863-doctest.patch\" in 4.4.alpha0.",
    "created_at": "2010-04-15T20:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21399",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Merged "trac_3863-doctest.patch" in 4.4.alpha0.



---

archive/issue_comments_021400.json:
```json
{
    "body": "Merged: **sage-4.4.alpha0**",
    "created_at": "2010-04-15T20:16:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3863#issuecomment-21400",
    "user": "https://github.com/jhpalmieri"
}
```

Merged: **sage-4.4.alpha0**



---

archive/issue_events_042535.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-15T20:16:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42535"
}
```



---

archive/issue_events_042536.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-04-15T20:16:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3863",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3863#event-42536"
}
```
