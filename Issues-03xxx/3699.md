# Issue 3699: rewrite free_module.py to use basis matrices everywhere

archive/issues_003699.json:
```json
{
    "assignees": [],
    "body": "You should only do this on top of patch #3514.\n\n**Author:** John Cremona\n\n**Reviewer:** Alex Ghitza\n\n**Merged:** 4.0.1.rc0\n\nIssue created by migration from https://trac.sagemath.org/ticket/3699\n\n",
    "closed_at": "2009-06-03T18:29:24Z",
    "created_at": "2008-07-21T21:39:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebra",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.0.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "rewrite free_module.py to use basis matrices everywhere",
    "type": "issue",
    "updated_at": "2009-06-06T20:48:54Z",
    "url": "https://github.com/sagemath/sage/issues/3699",
    "user": "https://github.com/mwhansen"
}
```
You should only do this on top of patch #3514.

**Author:** John Cremona

**Reviewer:** Alex Ghitza

**Merged:** 4.0.1.rc0

Issue created by migration from https://trac.sagemath.org/ticket/3699





---

archive/issue_events_033135.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2008-07-21T21:39:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "milestone_number": null,
    "milestone_title": "sage-4.0.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3699#event-33135"
}
```



---

archive/issue_events_033136.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2008-07-21T21:39:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebra",
    "label_color": "08517b",
    "label_name": "component: algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3699#event-33136"
}
```



---

archive/issue_events_033137.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2008-07-21T21:39:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3699#event-33137"
}
```



---

archive/issue_comments_021199.json:
```json
{
    "body": "<a id='comment:1'></a>\nI'm not sure exactly what you mean here, but if it would involve computing the basis_matrix for all `FreeModules` (even in the `FreeModule_ambient` case, where currently the basis_matrix is only computed lazily when requested) I think it's a bad idea unless the following can be vastly sped up:\n\n```\nsage: %time K = FreeModule(ZZ, 2000)\nCPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\nWall time: 0.00 s\nsage: %time _ = K.basis_matrix()\nCPU times: user 191.08 s, sys: 19.63 s, total: 210.71 s\nWall time: 210.69 s\n```",
    "created_at": "2008-08-02T14:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21199",
    "user": "https://github.com/sagetrac-cwitty"
}
```

<a id='comment:1'></a>
I'm not sure exactly what you mean here, but if it would involve computing the basis_matrix for all `FreeModules` (even in the `FreeModule_ambient` case, where currently the basis_matrix is only computed lazily when requested) I think it's a bad idea unless the following can be vastly sped up:

```
sage: %time K = FreeModule(ZZ, 2000)
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
Wall time: 0.00 s
sage: %time _ = K.basis_matrix()
CPU times: user 191.08 s, sys: 19.63 s, total: 210.71 s
Wall time: 210.69 s
```



---

archive/issue_comments_021200.json:
```json
{
    "body": "<a id='comment:2'></a>\n> I'm not sure exactly what you mean here, but if it would involve computing the \n> basis_matrix for all FreeModules (even in the FreeModule_ambient case, where\n> currently the basis_matrix is only computed lazily when requested) I think \n> it's a bad idea unless the following can be vastly sped up:\n\nIt would *only* involve computing the basis matrix for proper *submodules*, where\ncurrently exactly equivalent (namely a list of basis vectors) but vastly \nharder to work with data is computed and carried around. \n\nBy the way, regarding your example, that is just creating the 2000x2000 identity\nmatrix, which can be sped up, see:\n\n```\nsage: time a = identity_matrix(ZZ,2000)\nCPU times: user 0.27 s, sys: 0.05 s, total: 0.32 s\n```\n\nA cheap easy patch that vastly speeds up sage would be one that optimizes the\nbasis_matrix function for ambient free modules to just call the identity matrix\ncommand :-).",
    "created_at": "2008-08-03T17:27:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21200",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
> I'm not sure exactly what you mean here, but if it would involve computing the 
> basis_matrix for all FreeModules (even in the FreeModule_ambient case, where
> currently the basis_matrix is only computed lazily when requested) I think 
> it's a bad idea unless the following can be vastly sped up:

It would *only* involve computing the basis matrix for proper *submodules*, where
currently exactly equivalent (namely a list of basis vectors) but vastly 
harder to work with data is computed and carried around. 

By the way, regarding your example, that is just creating the 2000x2000 identity
matrix, which can be sped up, see:

```
sage: time a = identity_matrix(ZZ,2000)
CPU times: user 0.27 s, sys: 0.05 s, total: 0.32 s
```

A cheap easy patch that vastly speeds up sage would be one that optimizes the
basis_matrix function for ambient free modules to just call the identity matrix
command :-).



---

archive/issue_comments_021201.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Attachment:** [trac_3699.patch.gz](https://github.com/sagemath/sage/files/ticket3699/trac_3699.patch.gz)\n\nPatch attached which does what I think was intended.  Based on 3.4, all tests in sage/modules should pass.",
    "created_at": "2009-03-22T18:31:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21201",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
**Attachment:** [trac_3699.patch.gz](https://github.com/sagemath/sage/files/ticket3699/trac_3699.patch.gz)

Patch attached which does what I think was intended.  Based on 3.4, all tests in sage/modules should pass.



---

archive/issue_events_033138.json:
```json
{
    "actor": "https://github.com/JohnCremona",
    "created_at": "2009-03-22T18:37:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3699#event-33138"
}
```



---

archive/issue_comments_021202.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis still applies fine to 4.0 and is still in need of a review -- should be very quick!  All doctests in sage/modules pass.",
    "created_at": "2009-05-30T15:47:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21202",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
This still applies fine to 4.0 and is still in need of a review -- should be very quick!  All doctests in sage/modules pass.



---

archive/issue_comments_021203.json:
```json
{
    "body": "<a id='comment:6'></a>\nLooks good to me.",
    "created_at": "2009-06-02T08:56:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21203",
    "user": "https://github.com/aghitza"
}
```

<a id='comment:6'></a>
Looks good to me.



---

archive/issue_events_033139.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-06-02T08:56:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3699#event-33139"
}
```



---

archive/issue_events_033140.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-06-02T08:56:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3699#event-33140"
}
```



---

archive/issue_events_033141.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-03T18:29:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3699#event-33141"
}
```



---

archive/issue_events_033142.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2009-06-03T18:29:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3699#event-33142"
}
```



---

archive/issue_comments_021204.json:
```json
{
    "body": "<a id='comment:7'></a>\nMerged in 4.0.1.rc0.",
    "created_at": "2009-06-03T18:29:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21204",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:7'></a>
Merged in 4.0.1.rc0.



---

archive/issue_comments_021205.json:
```json
{
    "body": "**Merged:** 4.0.1.rc0",
    "created_at": "2009-06-06T20:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21205",
    "user": "https://github.com/mwhansen"
}
```

**Merged:** 4.0.1.rc0



---

archive/issue_comments_021206.json:
```json
{
    "body": "**Author:** John Cremona",
    "created_at": "2009-06-06T20:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21206",
    "user": "https://github.com/mwhansen"
}
```

**Author:** John Cremona



---

archive/issue_comments_021207.json:
```json
{
    "body": "**Reviewer:** Alex Ghitza",
    "created_at": "2009-06-06T20:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3699",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3699#issuecomment-21207",
    "user": "https://github.com/mwhansen"
}
```

**Reviewer:** Alex Ghitza
