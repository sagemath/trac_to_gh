# Issue 3889: extend parameter for number field sqrt method

archive/issues_003889.json:
```json
{
    "body": "Number field element sqrt should support the extend parameter in analogy with other sqrt functions.\n\n```\nsage: ZZ(4).sqrt(extend=False)\n2\nsage: CyclotomicField(4)(4).sqrt(extend=False)\n...\nTypeError: sqrt() got an unexpected keyword argument 'extend'\n```\n\nIf it would even have the parameter and raise a NotImplementedError if extend==True, that would aid in writing generic code for the present.\n\n**Assignee:** @loefflerd\n\n**CC:**  @tscrim @videlec\n\n**Branch/Commit:** [b46078a359d0b8621a46dca8b757a10f5830c9a5](https://github.com/sagemath/sagetrac-mirror/commit/b46078a359d0b8621a46dca8b757a10f5830c9a5)\n\n**Reviewer:** Travis Scrimshaw, Vincent Delecroix\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton, Jonathan Kliem\n\nIssue created by migration from https://trac.sagemath.org/ticket/3889\n\n",
    "closed_at": "2021-01-24T10:37:53Z",
    "created_at": "2008-08-18T13:50:47Z",
    "labels": [
        "component: number fields",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "title": "extend parameter for number field sqrt method",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/3889",
    "user": "https://trac.sagemath.org/admin/accounts/users/jbmohler"
}
```
Number field element sqrt should support the extend parameter in analogy with other sqrt functions.

```
sage: ZZ(4).sqrt(extend=False)
2
sage: CyclotomicField(4)(4).sqrt(extend=False)
...
TypeError: sqrt() got an unexpected keyword argument 'extend'
```

If it would even have the parameter and raise a NotImplementedError if extend==True, that would aid in writing generic code for the present.

**Assignee:** @loefflerd

**CC:**  @tscrim @videlec

**Branch/Commit:** [b46078a359d0b8621a46dca8b757a10f5830c9a5](https://github.com/sagemath/sagetrac-mirror/commit/b46078a359d0b8621a46dca8b757a10f5830c9a5)

**Reviewer:** Travis Scrimshaw, Vincent Delecroix

**Author:** Frédéric Chapoton, Jonathan Kliem

Issue created by migration from https://trac.sagemath.org/ticket/3889





---

archive/issue_events_022086.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T07:07:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "label": "bug",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22086"
}
```



---

archive/issue_events_022087.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2009-01-23T07:07:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "label": "enhancement",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22087"
}
```



---

archive/issue_comments_022501.json:
```json
{
    "body": "**Changing assignee** from @williamstein to @loefflerd.",
    "created_at": "2009-07-21T08:04:16Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22501",
    "user": "https://github.com/loefflerd"
}
```

**Changing assignee** from @williamstein to @loefflerd.



---

archive/issue_events_022088.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-21T08:04:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "label": "component: number theory",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22088"
}
```



---

archive/issue_events_022089.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-21T08:04:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "label": "component: number fields",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22089"
}
```



---

archive/issue_comments_022502.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n 2\n sage: CyclotomicField(4)(4).sqrt(extend=False)\n ...\n-TypeError: 'extend' is an invalid keyword argument for this function\n+TypeError: sqrt() got an unexpected keyword argument 'extend'\n ```\n \n If it would even have the parameter and raise a NotImplementedError if extend==True, that would aid in writing generic code for the present.\n``````\n",
    "created_at": "2011-10-09T11:05:49Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22502",
    "user": "https://github.com/jdemeyer"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 2
 sage: CyclotomicField(4)(4).sqrt(extend=False)
 ...
-TypeError: 'extend' is an invalid keyword argument for this function
+TypeError: sqrt() got an unexpected keyword argument 'extend'
 ```
 
 If it would even have the parameter and raise a NotImplementedError if extend==True, that would aid in writing generic code for the present.
``````




---

archive/issue_events_022090.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22090"
}
```



---

archive/issue_events_022091.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22091"
}
```



---

archive/issue_events_022092.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22092"
}
```



---

archive/issue_events_022093.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22093"
}
```



---

archive/issue_events_022094.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22094"
}
```



---

archive/issue_events_022095.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22095"
}
```



---

archive/issue_events_022096.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22096"
}
```



---

archive/issue_events_022097.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22097"
}
```



---

archive/issue_comments_022503.json:
```json
{
    "body": "<a id='comment:8'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc3600f96bc83573671511187fa5f1317a6b2ff7\">bc3600f</a></td><td><code>trac 3889 add extend keyword for sqrt in number fields</code></td></tr></table>\n",
    "created_at": "2020-10-18T08:45:34Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22503",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc3600f96bc83573671511187fa5f1317a6b2ff7">bc3600f</a></td><td><code>trac 3889 add extend keyword for sqrt in number fields</code></td></tr></table>




---

archive/issue_comments_022504.json:
```json
{
    "body": "**Branch:** [u/chapoton/3889](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/3889)",
    "created_at": "2020-10-18T08:45:34Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22504",
    "user": "https://github.com/fchapoton"
}
```

**Branch:** [u/chapoton/3889](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/3889)



---

archive/issue_events_022098.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-10-18T08:45:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22098"
}
```



---

archive/issue_events_022099.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-10-18T08:45:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22099"
}
```



---

archive/issue_comments_022505.json:
```json
{
    "body": "**Author:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2020-10-18T08:45:34Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22505",
    "user": "https://github.com/fchapoton"
}
```

**Author:** Frédéric Chapoton



---

archive/issue_events_022100.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2020-10-18T08:45:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22100"
}
```



---

archive/issue_comments_022506.json:
```json
{
    "body": "**Commit:** [bc3600f96bc83573671511187fa5f1317a6b2ff7](https://github.com/sagemath/sagetrac-mirror/commit/bc3600f96bc83573671511187fa5f1317a6b2ff7)",
    "created_at": "2020-10-18T08:45:34Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22506",
    "user": "https://github.com/fchapoton"
}
```

**Commit:** [bc3600f96bc83573671511187fa5f1317a6b2ff7](https://github.com/sagemath/sagetrac-mirror/commit/bc3600f96bc83573671511187fa5f1317a6b2ff7)



---

archive/issue_comments_022507.json:
```json
{
    "body": "<a id='comment:9'></a>\ngreen bot, please review",
    "created_at": "2020-10-18T12:20:15Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22507",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
green bot, please review



---

archive/issue_comments_022508.json:
```json
{
    "body": "<a id='comment:11'></a>\nIt might be good to allow `extend` to take a string input to set the extension's variable name. Otherwise, LGTM.",
    "created_at": "2020-10-19T23:37:33Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22508",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
It might be good to allow `extend` to take a string input to set the extension's variable name. Otherwise, LGTM.



---

archive/issue_comments_022509.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2020-10-19T23:37:33Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22509",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_022510.json:
```json
{
    "body": "<a id='comment:12'></a>\nI can see 2 places where a parameter \"name\" is used:\n\n```\nsrc/sage/rings/power_series_ring_element.pyx:    def sqrt(self, prec=None, extend=False, all=False, name=None):\nsrc/sage/rings/ring_extension_element.pyx:    def sqrt(self, extend=True, all=False, name=None):\n```",
    "created_at": "2020-10-20T07:12:31Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22510",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
I can see 2 places where a parameter "name" is used:

```
src/sage/rings/power_series_ring_element.pyx:    def sqrt(self, prec=None, extend=False, all=False, name=None):
src/sage/rings/ring_extension_element.pyx:    def sqrt(self, extend=True, all=False, name=None):
```



---

archive/issue_comments_022511.json:
```json
{
    "body": "**Changing commit** from \"[bc3600f96bc83573671511187fa5f1317a6b2ff7](https://github.com/sagemath/sagetrac-mirror/commit/bc3600f96bc83573671511187fa5f1317a6b2ff7)\" to \"[7840c068381246d92cae723ce8ece7ff56974873](https://github.com/sagemath/sagetrac-mirror/commit/7840c068381246d92cae723ce8ece7ff56974873)\".",
    "created_at": "2020-10-20T07:54:14Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22511",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bc3600f96bc83573671511187fa5f1317a6b2ff7](https://github.com/sagemath/sagetrac-mirror/commit/bc3600f96bc83573671511187fa5f1317a6b2ff7)" to "[7840c068381246d92cae723ce8ece7ff56974873](https://github.com/sagemath/sagetrac-mirror/commit/7840c068381246d92cae723ce8ece7ff56974873)".



---

archive/issue_comments_022512.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a5b352d046abcf6efe16ac00175947414ccd429\">1a5b352</a></td><td><code>Merge branch 'u/chapoton/3889' in 9.2.rc3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7840c068381246d92cae723ce8ece7ff56974873\">7840c06</a></td><td><code>add the name keyword for extended sqrt in number_fields</code></td></tr></table>\n",
    "created_at": "2020-10-20T07:54:14Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22512",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a5b352d046abcf6efe16ac00175947414ccd429">1a5b352</a></td><td><code>Merge branch 'u/chapoton/3889' in 9.2.rc3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7840c068381246d92cae723ce8ece7ff56974873">7840c06</a></td><td><code>add the name keyword for extended sqrt in number_fields</code></td></tr></table>




---

archive/issue_comments_022513.json:
```json
{
    "body": "<a id='comment:14'></a>\nI have added an optional parameter for the name.",
    "created_at": "2020-10-20T08:08:29Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22513",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
I have added an optional parameter for the name.



---

archive/issue_comments_022514.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe specicifications does not match the following behavior\n\n```\nsage: CyclotomicField(4)(2).sqrt(extend=False)\nsqrt(2)\n```\nOf course, this is no due to your changes, but this function is just wrong in returning symbolic ring stuff without notice.",
    "created_at": "2020-10-20T09:04:28Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22514",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
The specicifications does not match the following behavior

```
sage: CyclotomicField(4)(2).sqrt(extend=False)
sqrt(2)
```
Of course, this is no due to your changes, but this function is just wrong in returning symbolic ring stuff without notice.



---

archive/issue_comments_022515.json:
```json
{
    "body": "<a id='comment:16'></a>\nEt donc ? que faire ?",
    "created_at": "2020-10-20T09:26:27Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22515",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
Et donc ? que faire ?



---

archive/issue_comments_022516.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [chapoton](#comment%3A16):\n> Et donc ? que faire ?\n\nMany ways to solve it\n\n1. Do not return symbolic as one can do `SR(my_stuff).sqrt()`\n\n2. Add a `symbolic` argument\n\n3. Make `extend` a three fold alternative\n   - `extend=None`: old behavior\n   - `extend=False`: return in the current number field or raise an error\n   - `extend=True`: return in the current number field or an extended one if needed",
    "created_at": "2020-10-20T09:32:18Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22516",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
Replying to [chapoton](#comment%3A16):
> Et donc ? que faire ?

Many ways to solve it

1. Do not return symbolic as one can do `SR(my_stuff).sqrt()`

2. Add a `symbolic` argument

3. Make `extend` a three fold alternative
   - `extend=None`: old behavior
   - `extend=False`: return in the current number field or raise an error
   - `extend=True`: return in the current number field or an extended one if needed



---

archive/issue_comments_022517.json:
```json
{
    "body": "**Changing commit** from \"[7840c068381246d92cae723ce8ece7ff56974873](https://github.com/sagemath/sagetrac-mirror/commit/7840c068381246d92cae723ce8ece7ff56974873)\" to \"[ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93](https://github.com/sagemath/sagetrac-mirror/commit/ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93)\".",
    "created_at": "2020-10-20T11:20:08Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7840c068381246d92cae723ce8ece7ff56974873](https://github.com/sagemath/sagetrac-mirror/commit/7840c068381246d92cae723ce8ece7ff56974873)" to "[ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93](https://github.com/sagemath/sagetrac-mirror/commit/ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93)".



---

archive/issue_comments_022518.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93\">ec8ba00</a></td><td><code>do  not use SR in sqrt for number fields</code></td></tr></table>\n",
    "created_at": "2020-10-20T11:20:08Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22518",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93">ec8ba00</a></td><td><code>do  not use SR in sqrt for number fields</code></td></tr></table>




---

archive/issue_comments_022519.json:
```json
{
    "body": "<a id='comment:19'></a>\nalors, j'ai vir\u00e9 SR (option 1)",
    "created_at": "2020-10-20T11:23:52Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22519",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:19'></a>
alors, j'ai viré SR (option 1)



---

archive/issue_comments_022520.json:
```json
{
    "body": "<a id='comment:20'></a>\nTu noteras qu'il y a un probl\u00e8me de retrocompatibilit\u00e9.",
    "created_at": "2020-10-20T12:19:07Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22520",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>
Tu noteras qu'il y a un problème de retrocompatibilité.



---

archive/issue_comments_022521.json:
```json
{
    "body": "<a id='comment:21'></a>\nalors je remets le bloc SR ?",
    "created_at": "2020-10-20T13:55:20Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22521",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>
alors je remets le bloc SR ?



---

archive/issue_comments_022522.json:
```json
{
    "body": "<a id='comment:22'></a>\nOui avec un `DeprecationWarning` disant de faire `SR(my_number_field_element).sqrt()`.",
    "created_at": "2020-10-21T16:20:13Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22522",
    "user": "https://github.com/videlec"
}
```

<a id='comment:22'></a>
Oui avec un `DeprecationWarning` disant de faire `SR(my_number_field_element).sqrt()`.



---

archive/issue_comments_022523.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8498168b11310919868f03e66acfdacc5ed71f87\">8498168</a></td><td><code>deprecate fallback to SR sqrt for number field elements</code></td></tr></table>\n",
    "created_at": "2020-10-21T18:49:52Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22523",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8498168b11310919868f03e66acfdacc5ed71f87">8498168</a></td><td><code>deprecate fallback to SR sqrt for number field elements</code></td></tr></table>




---

archive/issue_comments_022524.json:
```json
{
    "body": "**Changing commit** from \"[ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93](https://github.com/sagemath/sagetrac-mirror/commit/ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93)\" to \"[8498168b11310919868f03e66acfdacc5ed71f87](https://github.com/sagemath/sagetrac-mirror/commit/8498168b11310919868f03e66acfdacc5ed71f87)\".",
    "created_at": "2020-10-21T18:49:52Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22524",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93](https://github.com/sagemath/sagetrac-mirror/commit/ec8ba002a60232e3e4bf5721c3d7a91dbb6cdb93)" to "[8498168b11310919868f03e66acfdacc5ed71f87](https://github.com/sagemath/sagetrac-mirror/commit/8498168b11310919868f03e66acfdacc5ed71f87)".



---

archive/issue_comments_022525.json:
```json
{
    "body": "**Changing commit** from \"[8498168b11310919868f03e66acfdacc5ed71f87](https://github.com/sagemath/sagetrac-mirror/commit/8498168b11310919868f03e66acfdacc5ed71f87)\" to \"[d1ffcea612a5c591af58987095ab8e6d1043a2e5](https://github.com/sagemath/sagetrac-mirror/commit/d1ffcea612a5c591af58987095ab8e6d1043a2e5)\".",
    "created_at": "2020-10-21T18:52:59Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[8498168b11310919868f03e66acfdacc5ed71f87](https://github.com/sagemath/sagetrac-mirror/commit/8498168b11310919868f03e66acfdacc5ed71f87)" to "[d1ffcea612a5c591af58987095ab8e6d1043a2e5](https://github.com/sagemath/sagetrac-mirror/commit/d1ffcea612a5c591af58987095ab8e6d1043a2e5)".



---

archive/issue_comments_022526.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1ffcea612a5c591af58987095ab8e6d1043a2e5\">d1ffcea</a></td><td><code>fix</code></td></tr></table>\n",
    "created_at": "2020-10-21T18:52:59Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22526",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1ffcea612a5c591af58987095ab8e6d1043a2e5">d1ffcea</a></td><td><code>fix</code></td></tr></table>




---

archive/issue_comments_022527.json:
```json
{
    "body": "<a id='comment:25'></a>\nJe ne comprends pas pourquoi la deprecation n'est pas d\u00e9clench\u00e9e par le doctest.",
    "created_at": "2020-10-21T18:54:23Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22527",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:25'></a>
Je ne comprends pas pourquoi la deprecation n'est pas déclenchée par le doctest.



---

archive/issue_comments_022528.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [chapoton](#comment%3A25):\n> Je ne comprends pas pourquoi la deprecation n'est pas d\u00e9clench\u00e9e par le doctest.\n\nhttps://trac.sagemath.org/ticket/28500",
    "created_at": "2020-10-21T19:28:01Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22528",
    "user": "https://github.com/videlec"
}
```

<a id='comment:26'></a>
Replying to [chapoton](#comment%3A25):
> Je ne comprends pas pourquoi la deprecation n'est pas déclenchée par le doctest.

https://trac.sagemath.org/ticket/28500



---

archive/issue_comments_022529.json:
```json
{
    "body": "<a id='comment:27'></a>\nca pose de gros problemes dans src/sage/geometry/polyhedron/base.py",
    "created_at": "2020-10-25T08:22:07Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22529",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>
ca pose de gros problemes dans src/sage/geometry/polyhedron/base.py



---

archive/issue_comments_022530.json:
```json
{
    "body": "<a id='comment:28'></a>\nThe problem I'm having with `src/sage/geometry/polyhedron.base.py` is the following:\n\nGiven a number field `K` with specified embedding into `AA`. How do I obtain a positive square root (i.e. the parent has a specified embedding as well).\n\nIt is very unnatural if it isn't well-defined if the volume is positive or negative.",
    "created_at": "2020-10-26T08:57:20Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22530",
    "user": "https://github.com/kliem"
}
```

<a id='comment:28'></a>
The problem I'm having with `src/sage/geometry/polyhedron.base.py` is the following:

Given a number field `K` with specified embedding into `AA`. How do I obtain a positive square root (i.e. the parent has a specified embedding as well).

It is very unnatural if it isn't well-defined if the volume is positive or negative.



---

archive/issue_comments_022531.json:
```json
{
    "body": "<a id='comment:29'></a>\nReplying to [gh-kliem](#comment%3A28):\n> The problem I'm having with `src/sage/geometry/polyhedron.base.py` is the following:\n> \n> Given a number field `K` with specified embedding into `AA`. How do I obtain a positive square root (i.e. the parent has a specified embedding as well).\n> \n> It is very unnatural if it isn't well-defined if the volume is positive or negative.\n\nJust move the volume answer to `AA`. A number field version can easily be reconstructed\n\n```\nsage: K.<sqrt2> = QuadraticField(2, embedding=AA(2).sqrt())                                                                                                                                    \nsage: v = AA(12*sqrt2 - 15).sqrt()                                                                                                                                                             \nsage: L, vL, phi = v.as_number_field_element(minimal=True, embedded=True)                                                                                                                      \nsage: vL                                                                                                                                                                                       \n-a^3 + a^2 + 4*a + 3\nsage: vL.n()                                                                                                                                                                                   \n1.40376734129169\n```",
    "created_at": "2020-10-26T09:18:16Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22531",
    "user": "https://github.com/videlec"
}
```

<a id='comment:29'></a>
Replying to [gh-kliem](#comment%3A28):
> The problem I'm having with `src/sage/geometry/polyhedron.base.py` is the following:
> 
> Given a number field `K` with specified embedding into `AA`. How do I obtain a positive square root (i.e. the parent has a specified embedding as well).
> 
> It is very unnatural if it isn't well-defined if the volume is positive or negative.

Just move the volume answer to `AA`. A number field version can easily be reconstructed

```
sage: K.<sqrt2> = QuadraticField(2, embedding=AA(2).sqrt())                                                                                                                                    
sage: v = AA(12*sqrt2 - 15).sqrt()                                                                                                                                                             
sage: L, vL, phi = v.as_number_field_element(minimal=True, embedded=True)                                                                                                                      
sage: vL                                                                                                                                                                                       
-a^3 + a^2 + 4*a + 3
sage: vL.n()                                                                                                                                                                                   
1.40376734129169
```



---

archive/issue_comments_022532.json:
```json
{
    "body": "<a id='comment:30'></a>\nThis works for the volume of polyhedra now.\n\nI did change the behaviour. The new default `None` is deprecated now and `extend=False` raises a `ValueError` to be consistent with other rings. The new default should then be `extend=True` once we remove the deprecation warning.\n\nThe `QR` method of method of matrices does not raise correctly a `TypeError`, if the base ring does not support the required roots. (Before it would sometimes implicitly extend even though the documentation tells us that the base ring must support roots.)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/096771197824560522fcb4d89e7abf22d0e8bb41\">0967711</a></td><td><code>Merge branch 'u/chapoton/3889' of git://trac.sagemath.org/sage into test/3889</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e1242362c83753a931df8c88b5d98f60872eeb3\">5e12423</a></td><td><code>raise error when `extend=False`</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77d0fce43c10513eab21e98043fa22b08c1a3a50\">77d0fce</a></td><td><code>do not raise deprecation error for QR method of matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/93803bc9c80a88f0132c23ff08f9e1b031edc4a0\">93803bc</a></td><td><code>do not use symbolic ring for volume of polyhedra</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f1bde7014f6c1bbb506a8ccbfe323d0f2181b08\">6f1bde7</a></td><td><code>update deprecation message</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/198883c209f27f3d92687b59da52df00f43965ac\">198883c</a></td><td><code>less changes</code></td></tr></table>\n",
    "created_at": "2020-10-26T11:25:59Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22532",
    "user": "https://github.com/kliem"
}
```

<a id='comment:30'></a>
This works for the volume of polyhedra now.

I did change the behaviour. The new default `None` is deprecated now and `extend=False` raises a `ValueError` to be consistent with other rings. The new default should then be `extend=True` once we remove the deprecation warning.

The `QR` method of method of matrices does not raise correctly a `TypeError`, if the base ring does not support the required roots. (Before it would sometimes implicitly extend even though the documentation tells us that the base ring must support roots.)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/096771197824560522fcb4d89e7abf22d0e8bb41">0967711</a></td><td><code>Merge branch 'u/chapoton/3889' of git://trac.sagemath.org/sage into test/3889</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e1242362c83753a931df8c88b5d98f60872eeb3">5e12423</a></td><td><code>raise error when `extend=False`</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77d0fce43c10513eab21e98043fa22b08c1a3a50">77d0fce</a></td><td><code>do not raise deprecation error for QR method of matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/93803bc9c80a88f0132c23ff08f9e1b031edc4a0">93803bc</a></td><td><code>do not use symbolic ring for volume of polyhedra</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f1bde7014f6c1bbb506a8ccbfe323d0f2181b08">6f1bde7</a></td><td><code>update deprecation message</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/198883c209f27f3d92687b59da52df00f43965ac">198883c</a></td><td><code>less changes</code></td></tr></table>




---

archive/issue_comments_022533.json:
```json
{
    "body": "**Changing commit** from \"[d1ffcea612a5c591af58987095ab8e6d1043a2e5](https://github.com/sagemath/sagetrac-mirror/commit/d1ffcea612a5c591af58987095ab8e6d1043a2e5)\" to \"[198883c209f27f3d92687b59da52df00f43965ac](https://github.com/sagemath/sagetrac-mirror/commit/198883c209f27f3d92687b59da52df00f43965ac)\".",
    "created_at": "2020-10-26T11:25:59Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22533",
    "user": "https://github.com/kliem"
}
```

**Changing commit** from "[d1ffcea612a5c591af58987095ab8e6d1043a2e5](https://github.com/sagemath/sagetrac-mirror/commit/d1ffcea612a5c591af58987095ab8e6d1043a2e5)" to "[198883c209f27f3d92687b59da52df00f43965ac](https://github.com/sagemath/sagetrac-mirror/commit/198883c209f27f3d92687b59da52df00f43965ac)".



---

archive/issue_comments_022534.json:
```json
{
    "body": "**Changing author** from \"Fr\u00e9d\u00e9ric Chapoton\" to \"Fr\u00e9d\u00e9ric Chapoton, Jonathan Kliem\".",
    "created_at": "2020-10-26T11:25:59Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22534",
    "user": "https://github.com/kliem"
}
```

**Changing author** from "Frédéric Chapoton" to "Frédéric Chapoton, Jonathan Kliem".



---

archive/issue_comments_022535.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/3889](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/3889)\" to \"[u/gh-kliem/3889](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/3889)\".",
    "created_at": "2020-10-26T11:25:59Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22535",
    "user": "https://github.com/kliem"
}
```

**Changing branch** from "[u/chapoton/3889](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/3889)" to "[u/gh-kliem/3889](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/3889)".



---

archive/issue_comments_022536.json:
```json
{
    "body": "<a id='comment:31'></a>\nThe doctest testing the deprecation warning still does not work.",
    "created_at": "2020-10-26T11:26:23Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22536",
    "user": "https://github.com/kliem"
}
```

<a id='comment:31'></a>
The doctest testing the deprecation warning still does not work.



---

archive/issue_comments_022537.json:
```json
{
    "body": "<a id='comment:32'></a>\nHaving a deprecated default is the worse that can be!",
    "created_at": "2020-10-26T11:28:45Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22537",
    "user": "https://github.com/videlec"
}
```

<a id='comment:32'></a>
Having a deprecated default is the worse that can be!



---

archive/issue_comments_022538.json:
```json
{
    "body": "<a id='comment:33'></a>\nHow else can you tell users that they should think about what they really want?",
    "created_at": "2020-10-26T11:35:21Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22538",
    "user": "https://github.com/kliem"
}
```

<a id='comment:33'></a>
How else can you tell users that they should think about what they really want?



---

archive/issue_comments_022539.json:
```json
{
    "body": "**Changing commit** from \"[198883c209f27f3d92687b59da52df00f43965ac](https://github.com/sagemath/sagetrac-mirror/commit/198883c209f27f3d92687b59da52df00f43965ac)\" to \"[88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38](https://github.com/sagemath/sagetrac-mirror/commit/88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38)\".",
    "created_at": "2020-10-26T11:36:17Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22539",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[198883c209f27f3d92687b59da52df00f43965ac](https://github.com/sagemath/sagetrac-mirror/commit/198883c209f27f3d92687b59da52df00f43965ac)" to "[88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38](https://github.com/sagemath/sagetrac-mirror/commit/88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38)".



---

archive/issue_comments_022540.json:
```json
{
    "body": "<a id='comment:34'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38\">88d17ce</a></td><td><code>small fixes</code></td></tr></table>\n",
    "created_at": "2020-10-26T11:36:17Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22540",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38">88d17ce</a></td><td><code>small fixes</code></td></tr></table>




---

archive/issue_comments_022541.json:
```json
{
    "body": "<a id='comment:35'></a>\n`extend=False` should just throw an error (if extension is needed) and don't do something weird like changing to symbolic ring.\n\nTo do `elt.sqrt(extend=False)` is correct behaviour and it should just raise and error, like with other rings. Also `extend=False` is a bad default, because it is not the default for `functions.other.sqrt`.\n\nThe idea of this default deprecation message is that users code needs to be updated and this is how you notify them, isn't it?",
    "created_at": "2020-10-26T11:43:11Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22541",
    "user": "https://github.com/kliem"
}
```

<a id='comment:35'></a>
`extend=False` should just throw an error (if extension is needed) and don't do something weird like changing to symbolic ring.

To do `elt.sqrt(extend=False)` is correct behaviour and it should just raise and error, like with other rings. Also `extend=False` is a bad default, because it is not the default for `functions.other.sqrt`.

The idea of this default deprecation message is that users code needs to be updated and this is how you notify them, isn't it?



---

archive/issue_comments_022542.json:
```json
{
    "body": "<a id='comment:36'></a>\nThen again we could just not do a deprecation warning at all and change the default to `extend=True`.\n\nThis is what it boils down to for `functions.other.sqrt` anyway.",
    "created_at": "2020-10-26T12:14:02Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22542",
    "user": "https://github.com/kliem"
}
```

<a id='comment:36'></a>
Then again we could just not do a deprecation warning at all and change the default to `extend=True`.

This is what it boils down to for `functions.other.sqrt` anyway.



---

archive/issue_comments_022543.json:
```json
{
    "body": "**Changing commit** from \"[88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38](https://github.com/sagemath/sagetrac-mirror/commit/88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38)\" to \"[0487ce09fd2a6638cb940e2005dd4fb01f86c656](https://github.com/sagemath/sagetrac-mirror/commit/0487ce09fd2a6638cb940e2005dd4fb01f86c656)\".",
    "created_at": "2020-10-26T12:20:36Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22543",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38](https://github.com/sagemath/sagetrac-mirror/commit/88d17ce6a29b7b8836b9f8004bb46b7b9d17cc38)" to "[0487ce09fd2a6638cb940e2005dd4fb01f86c656](https://github.com/sagemath/sagetrac-mirror/commit/0487ce09fd2a6638cb940e2005dd4fb01f86c656)".



---

archive/issue_comments_022544.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0487ce09fd2a6638cb940e2005dd4fb01f86c656\">0487ce0</a></td><td><code>remove deprecation warning</code></td></tr></table>\n",
    "created_at": "2020-10-26T12:20:36Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22544",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0487ce09fd2a6638cb940e2005dd4fb01f86c656">0487ce0</a></td><td><code>remove deprecation warning</code></td></tr></table>




---

archive/issue_comments_022545.json:
```json
{
    "body": "<a id='comment:38'></a>\nI removed the deprecation warning. The main problem is that `functions.other.sqrt` calls the method `sqrt` without optional arguments and claims that the default is to extend.\n\nIn this way it requires:\n- that any `sqrt` method must extend by default without deprecation warning etc,\n- any `sqrt` method does have an `extend` argument.\n\nIf we want to keep the deprecation message we need to alter `functions.other.sqrt`.\n\nFeel free to reject my changes alltogether or change anything you like. I just joined in because there was trouble with polyhedra.",
    "created_at": "2020-10-26T12:24:39Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22545",
    "user": "https://github.com/kliem"
}
```

<a id='comment:38'></a>
I removed the deprecation warning. The main problem is that `functions.other.sqrt` calls the method `sqrt` without optional arguments and claims that the default is to extend.

In this way it requires:
- that any `sqrt` method must extend by default without deprecation warning etc,
- any `sqrt` method does have an `extend` argument.

If we want to keep the deprecation message we need to alter `functions.other.sqrt`.

Feel free to reject my changes alltogether or change anything you like. I just joined in because there was trouble with polyhedra.



---

archive/issue_comments_022546.json:
```json
{
    "body": "<a id='comment:39'></a>\nThere is still one failing doctest, see patchbot report",
    "created_at": "2020-10-27T17:32:15Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22546",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:39'></a>
There is still one failing doctest, see patchbot report



---

archive/issue_comments_022547.json:
```json
{
    "body": "<a id='comment:40'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/457bc0508b1df788c7710d8aad94df322fc78c48\">457bc05</a></td><td><code>properly change the default</code></td></tr></table>\n",
    "created_at": "2020-10-27T22:50:02Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22547",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:40'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/457bc0508b1df788c7710d8aad94df322fc78c48">457bc05</a></td><td><code>properly change the default</code></td></tr></table>




---

archive/issue_comments_022548.json:
```json
{
    "body": "**Changing commit** from \"[0487ce09fd2a6638cb940e2005dd4fb01f86c656](https://github.com/sagemath/sagetrac-mirror/commit/0487ce09fd2a6638cb940e2005dd4fb01f86c656)\" to \"[457bc0508b1df788c7710d8aad94df322fc78c48](https://github.com/sagemath/sagetrac-mirror/commit/457bc0508b1df788c7710d8aad94df322fc78c48)\".",
    "created_at": "2020-10-27T22:50:02Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[0487ce09fd2a6638cb940e2005dd4fb01f86c656](https://github.com/sagemath/sagetrac-mirror/commit/0487ce09fd2a6638cb940e2005dd4fb01f86c656)" to "[457bc0508b1df788c7710d8aad94df322fc78c48](https://github.com/sagemath/sagetrac-mirror/commit/457bc0508b1df788c7710d8aad94df322fc78c48)".



---

archive/issue_comments_022549.json:
```json
{
    "body": "<a id='comment:41'></a>\nI am not sure what this `sqrt` method is trying to achieve. Giving an answer is not a necessity. Especially if the answer is \"the square root of your number\". Currently, I find that only the `extend=False` looks reasonable.\n\nI see several problems\n- `QQ` is a particular case of number fields, and `ZZ` is a particular case of `QQ`. For both `ZZ` and `QQ` the behavior of `sqrt` should be compatible with what is proposed for number fields.\n- The proposal is not compatible with embeddings. Many users would expect `K(2).sqrt() + K(3).sqrt()` to work. Especially with `K=QQ`.",
    "created_at": "2020-10-28T07:52:27Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22549",
    "user": "https://github.com/videlec"
}
```

<a id='comment:41'></a>
I am not sure what this `sqrt` method is trying to achieve. Giving an answer is not a necessity. Especially if the answer is "the square root of your number". Currently, I find that only the `extend=False` looks reasonable.

I see several problems
- `QQ` is a particular case of number fields, and `ZZ` is a particular case of `QQ`. For both `ZZ` and `QQ` the behavior of `sqrt` should be compatible with what is proposed for number fields.
- The proposal is not compatible with embeddings. Many users would expect `K(2).sqrt() + K(3).sqrt()` to work. Especially with `K=QQ`.



---

archive/issue_comments_022550.json:
```json
{
    "body": "<a id='comment:42'></a>\nI tried to make the behavior consistent, this is why I changed the default to `extend=True`.\n\nBut I see the problem that `ZZ` and `QQ` still choose symbolic expressions instead. Should we change them all or just leave it at symbolic expressions? (The polyhedron problem is still solved by this, because by the `extend=False` option, you can stabely raise an error.)\n\nCompatibily of embeddings can be achieved, at least when `all=False`: If `K` has a specified complex embedding, we just use this to specify an ambedding of the extension. In case `K` is `QQ` we just go with `AA`. This way `K(2).sqrt() + K(3).sqrt()` would still work, at least when `K` has a specified complex embedding that contains both `K(2).sqrt()` and `K(3).sqrt()`.",
    "created_at": "2020-10-28T08:26:22Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22550",
    "user": "https://github.com/kliem"
}
```

<a id='comment:42'></a>
I tried to make the behavior consistent, this is why I changed the default to `extend=True`.

But I see the problem that `ZZ` and `QQ` still choose symbolic expressions instead. Should we change them all or just leave it at symbolic expressions? (The polyhedron problem is still solved by this, because by the `extend=False` option, you can stabely raise an error.)

Compatibily of embeddings can be achieved, at least when `all=False`: If `K` has a specified complex embedding, we just use this to specify an ambedding of the extension. In case `K` is `QQ` we just go with `AA`. This way `K(2).sqrt() + K(3).sqrt()` would still work, at least when `K` has a specified complex embedding that contains both `K(2).sqrt()` and `K(3).sqrt()`.



---

archive/issue_comments_022551.json:
```json
{
    "body": "<a id='comment:43'></a>\nSo I agree that it should be consistent. However, there will be a backwards incompatibility issue to deal with if we make this change. At least with the current change, there is at least a type distinction that can be employed to justify the difference. If we do make a change for `ZZ` and `QQ`, then we should only do it once as it will likely be a bit painful for users expecting it in `SR`. That is my 2 cents.",
    "created_at": "2020-11-01T23:25:32Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22551",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:43'></a>
So I agree that it should be consistent. However, there will be a backwards incompatibility issue to deal with if we make this change. At least with the current change, there is at least a type distinction that can be employed to justify the difference. If we do make a change for `ZZ` and `QQ`, then we should only do it once as it will likely be a bit painful for users expecting it in `SR`. That is my 2 cents.



---

archive/issue_comments_022552.json:
```json
{
    "body": "**Changing commit** from \"[457bc0508b1df788c7710d8aad94df322fc78c48](https://github.com/sagemath/sagetrac-mirror/commit/457bc0508b1df788c7710d8aad94df322fc78c48)\" to \"[758de17979dfa617144fb5a22c998e7e6102a647](https://github.com/sagemath/sagetrac-mirror/commit/758de17979dfa617144fb5a22c998e7e6102a647)\".",
    "created_at": "2021-01-11T09:12:27Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22552",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[457bc0508b1df788c7710d8aad94df322fc78c48](https://github.com/sagemath/sagetrac-mirror/commit/457bc0508b1df788c7710d8aad94df322fc78c48)" to "[758de17979dfa617144fb5a22c998e7e6102a647](https://github.com/sagemath/sagetrac-mirror/commit/758de17979dfa617144fb5a22c998e7e6102a647)".



---

archive/issue_comments_022553.json:
```json
{
    "body": "<a id='comment:44'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12ed75d4e1d002aadd9926a2dff07cee818d7d0b\">12ed75d</a></td><td><code>Merge branch 'u/gh-kliem/3889' of git://trac.sagemath.org/sage into u/gh-kliem/3889</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/758de17979dfa617144fb5a22c998e7e6102a647\">758de17</a></td><td><code>consistent behaviour with ZZ and QQ</code></td></tr></table>\n",
    "created_at": "2021-01-11T09:12:27Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12ed75d4e1d002aadd9926a2dff07cee818d7d0b">12ed75d</a></td><td><code>Merge branch 'u/gh-kliem/3889' of git://trac.sagemath.org/sage into u/gh-kliem/3889</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/758de17979dfa617144fb5a22c998e7e6102a647">758de17</a></td><td><code>consistent behaviour with ZZ and QQ</code></td></tr></table>




---

archive/issue_comments_022554.json:
```json
{
    "body": "<a id='comment:45'></a>\nOk. This should now behave consistenly with `ZZ` and `QQ`.\nIf `self` is a square, just return the root.\nIf `self` is not a square, raise an error if `extend=False` and use symbolic ring if `extend=True` (default).\n\nOf course one could argue, that this behavior isn't optimal and there are better choices for a square root construction (e.g. extend the number field), but it is really hard to guess what the user wants precisely (e.g. for polytopes volume, if we need to extend anyway, we might as well go to `AA`).",
    "created_at": "2021-01-11T09:15:49Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22554",
    "user": "https://github.com/kliem"
}
```

<a id='comment:45'></a>
Ok. This should now behave consistenly with `ZZ` and `QQ`.
If `self` is a square, just return the root.
If `self` is not a square, raise an error if `extend=False` and use symbolic ring if `extend=True` (default).

Of course one could argue, that this behavior isn't optimal and there are better choices for a square root construction (e.g. extend the number field), but it is really hard to guess what the user wants precisely (e.g. for polytopes volume, if we need to extend anyway, we might as well go to `AA`).



---

archive/issue_comments_022555.json:
```json
{
    "body": "<a id='comment:46'></a>\nI am a little worried about this change:\n\n```diff\ndiff --git a/src/sage/matrix/matrix2.pyx b/src/sage/matrix/matrix2.pyx\nindex 5e190ea..7ce4196 100644\n--- a/src/sage/matrix/matrix2.pyx\n+++ b/src/sage/matrix/matrix2.pyx\n@@ -10136,7 +10136,7 @@ cdef class Matrix(Matrix1):\n             hip = v.hermitian_inner_product(v)\n             if hip != 0:\n                 try:\n-                    scale = sqrt(hip)\n+                    scale = sqrt(hip, extend=False)\n                     q = (1/scale)*v\n                     Q.append(q)\n                     R[row,i] = scale\n```\nSince this can take in general rings, such as one whose elements could have a `sqrt` that does not take `extend` as a parameter, this could behave differently than before. How would you classify this behavior? A bug in the `sqrt` implementation? Or am I just being paranoid about this?",
    "created_at": "2021-01-12T00:28:03Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22555",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:46'></a>
I am a little worried about this change:

```diff
diff --git a/src/sage/matrix/matrix2.pyx b/src/sage/matrix/matrix2.pyx
index 5e190ea..7ce4196 100644
--- a/src/sage/matrix/matrix2.pyx
+++ b/src/sage/matrix/matrix2.pyx
@@ -10136,7 +10136,7 @@ cdef class Matrix(Matrix1):
             hip = v.hermitian_inner_product(v)
             if hip != 0:
                 try:
-                    scale = sqrt(hip)
+                    scale = sqrt(hip, extend=False)
                     q = (1/scale)*v
                     Q.append(q)
                     R[row,i] = scale
```
Since this can take in general rings, such as one whose elements could have a `sqrt` that does not take `extend` as a parameter, this could behave differently than before. How would you classify this behavior? A bug in the `sqrt` implementation? Or am I just being paranoid about this?



---

archive/issue_comments_022556.json:
```json
{
    "body": "<a id='comment:47'></a>\nYes, I agree, there is a number of rings that don't have this keyword.",
    "created_at": "2021-01-12T08:06:22Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22556",
    "user": "https://github.com/kliem"
}
```

<a id='comment:47'></a>
Yes, I agree, there is a number of rings that don't have this keyword.



---

archive/issue_comments_022557.json:
```json
{
    "body": "<a id='comment:48'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b46078a359d0b8621a46dca8b757a10f5830c9a5\">b46078a</a></td><td><code>revert change to matrix</code></td></tr></table>\n",
    "created_at": "2021-01-12T08:16:56Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b46078a359d0b8621a46dca8b757a10f5830c9a5">b46078a</a></td><td><code>revert change to matrix</code></td></tr></table>




---

archive/issue_comments_022558.json:
```json
{
    "body": "**Changing commit** from \"[758de17979dfa617144fb5a22c998e7e6102a647](https://github.com/sagemath/sagetrac-mirror/commit/758de17979dfa617144fb5a22c998e7e6102a647)\" to \"[b46078a359d0b8621a46dca8b757a10f5830c9a5](https://github.com/sagemath/sagetrac-mirror/commit/b46078a359d0b8621a46dca8b757a10f5830c9a5)\".",
    "created_at": "2021-01-12T08:16:56Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22558",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[758de17979dfa617144fb5a22c998e7e6102a647](https://github.com/sagemath/sagetrac-mirror/commit/758de17979dfa617144fb5a22c998e7e6102a647)" to "[b46078a359d0b8621a46dca8b757a10f5830c9a5](https://github.com/sagemath/sagetrac-mirror/commit/b46078a359d0b8621a46dca8b757a10f5830c9a5)".



---

archive/issue_comments_022559.json:
```json
{
    "body": "<a id='comment:49'></a>\nReading closely, the documentation of `QR` does not claim that the base ring is preserved. In particular it mentions that it is not preserved, when the base ring is not a field. It just mentions that the base ring must have have roots. In that way, I guess that `QQ` has roots in sage (just not preserving the ring).\n\nThe change in `QR` was required, because of some design decision that I reverted already.",
    "created_at": "2021-01-12T08:20:06Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22559",
    "user": "https://github.com/kliem"
}
```

<a id='comment:49'></a>
Reading closely, the documentation of `QR` does not claim that the base ring is preserved. In particular it mentions that it is not preserved, when the base ring is not a field. It just mentions that the base ring must have have roots. In that way, I guess that `QQ` has roots in sage (just not preserving the ring).

The change in `QR` was required, because of some design decision that I reverted already.



---

archive/issue_comments_022560.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw\" to \"Travis Scrimshaw Vincent Delecroix\".",
    "created_at": "2021-01-14T05:55:25Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22560",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Travis Scrimshaw" to "Travis Scrimshaw Vincent Delecroix".



---

archive/issue_comments_022561.json:
```json
{
    "body": "<a id='comment:50'></a>\nI am ready to set a positive review. Vincent, any additional comments or things to address before I do so?",
    "created_at": "2021-01-14T05:55:25Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22561",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:50'></a>
I am ready to set a positive review. Vincent, any additional comments or things to address before I do so?



---

archive/issue_events_022101.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-01-14T10:13:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22101"
}
```



---

archive/issue_events_022102.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-01-14T10:13:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22102"
}
```



---

archive/issue_comments_022562.json:
```json
{
    "body": "<a id='comment:51'></a>\nNothing to add. Thanks.",
    "created_at": "2021-01-14T10:13:15Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22562",
    "user": "https://github.com/videlec"
}
```

<a id='comment:51'></a>
Nothing to add. Thanks.



---

archive/issue_comments_022563.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw Vincent Delecroix\" to \"Travis Scrimshaw, Vincent Delecroix\".",
    "created_at": "2021-01-14T10:13:15Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22563",
    "user": "https://github.com/videlec"
}
```

**Changing reviewer** from "Travis Scrimshaw Vincent Delecroix" to "Travis Scrimshaw, Vincent Delecroix".



---

archive/issue_comments_022564.json:
```json
{
    "body": "<a id='comment:52'></a>\nThank you.",
    "created_at": "2021-01-14T10:14:15Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22564",
    "user": "https://github.com/kliem"
}
```

<a id='comment:52'></a>
Thank you.



---

archive/issue_comments_022565.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-kliem/3889](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/3889)\" to \"[b46078a359d0b8621a46dca8b757a10f5830c9a5](https://github.com/sagemath/sagetrac-mirror/commit/b46078a359d0b8621a46dca8b757a10f5830c9a5)\".",
    "created_at": "2021-01-24T10:37:53Z",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3889#issuecomment-22565",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-kliem/3889](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/3889)" to "[b46078a359d0b8621a46dca8b757a10f5830c9a5](https://github.com/sagemath/sagetrac-mirror/commit/b46078a359d0b8621a46dca8b757a10f5830c9a5)".



---

archive/issue_events_022103.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-24T10:37:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22103"
}
```



---

archive/issue_events_022104.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "01c9f0b24499d4f5cad8e346738a03126a865ed9",
    "created_at": "2021-01-24T10:37:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3889",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3889#event-22104"
}
```
