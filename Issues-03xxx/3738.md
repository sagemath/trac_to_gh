# Issue 3738: [with two positive reviews] new coercion model

archive/issues_003738.json:
```json
{
    "body": "This set of patches pulls the core coercion infrastructure from the coercion branch, without actually converting any of the Parents over. All Parents now descent from old_parent.Parent, which has a couple of compatibility routines. \n\nWith this in place Parents can be migrated one at a time. Other coercion branch features should be separate tickets. \n\n**Assignee:** @robertwb\n\nIssue created by migration from https://trac.sagemath.org/ticket/3738\n\n",
    "closed_at": "2008-08-14T16:57:44Z",
    "created_at": "2008-07-29T08:49:17Z",
    "labels": [
        "component: coercion",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.1",
    "title": "[with two positive reviews] new coercion model",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/3738",
    "user": "https://github.com/robertwb"
}
```
This set of patches pulls the core coercion infrastructure from the coercion branch, without actually converting any of the Parents over. All Parents now descent from old_parent.Parent, which has a couple of compatibility routines. 

With this in place Parents can be migrated one at a time. Other coercion branch features should be separate tickets. 

**Assignee:** @robertwb

Issue created by migration from https://trac.sagemath.org/ticket/3738





---

archive/attachments_003965.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-0-generators.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-0-generators.patch",
    "created_at": "2008-07-29T09:18:58Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-0-generators.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/attachments_003966.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-1-new_parent.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-1-new_parent.patch",
    "created_at": "2008-07-29T09:18:58Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-1-new_parent.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021442.json:
```json
{
    "body": "**Attachment:** [3738-0-generators.patch](https://github.com/sagemath/sage/files/ticket3738/3738-0-generators.patch)\n\n**Attachment:** [3738-1-new_parent.patch](https://github.com/sagemath/sage/files/ticket3738/3738-1-new_parent.patch)",
    "created_at": "2008-07-29T09:18:58Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21442",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-0-generators.patch](https://github.com/sagemath/sage/files/ticket3738/3738-0-generators.patch)

**Attachment:** [3738-1-new_parent.patch](https://github.com/sagemath/sage/files/ticket3738/3738-1-new_parent.patch)



---

archive/attachments_003967.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-2-new_parent_fixes.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-2-new_parent_fixes.patch",
    "created_at": "2008-07-29T09:19:11Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-2-new_parent_fixes.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021443.json:
```json
{
    "body": "**Attachment:** [3738-2-new_parent_fixes.patch](https://github.com/sagemath/sage/files/ticket3738/3738-2-new_parent_fixes.patch)",
    "created_at": "2008-07-29T09:19:11Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21443",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-2-new_parent_fixes.patch](https://github.com/sagemath/sage/files/ticket3738/3738-2-new_parent_fixes.patch)



---

archive/attachments_003968.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-3-new_coercion_model.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-3-new_coercion_model.patch",
    "created_at": "2008-07-29T09:19:47Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-3-new_coercion_model.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021444.json:
```json
{
    "body": "**Attachment:** [3738-3-new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket3738/3738-3-new_coercion_model.patch)",
    "created_at": "2008-07-29T09:19:47Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21444",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-3-new_coercion_model.patch](https://github.com/sagemath/sage/files/ticket3738/3738-3-new_coercion_model.patch)



---

archive/attachments_003969.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-4-coerce_name_fixes.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-4-coerce_name_fixes.patch",
    "created_at": "2008-07-29T09:20:00Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-4-coerce_name_fixes.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021445.json:
```json
{
    "body": "**Attachment:** [3738-4-coerce_name_fixes.patch](https://github.com/sagemath/sage/files/ticket3738/3738-4-coerce_name_fixes.patch)",
    "created_at": "2008-07-29T09:20:00Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21445",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-4-coerce_name_fixes.patch](https://github.com/sagemath/sage/files/ticket3738/3738-4-coerce_name_fixes.patch)



---

archive/attachments_003970.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-5-coerce_compat_layer.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-5-coerce_compat_layer.patch",
    "created_at": "2008-07-29T09:20:12Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-5-coerce_compat_layer.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021446.json:
```json
{
    "body": "**Attachment:** [3738-5-coerce_compat_layer.patch](https://github.com/sagemath/sage/files/ticket3738/3738-5-coerce_compat_layer.patch)",
    "created_at": "2008-07-29T09:20:12Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21446",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-5-coerce_compat_layer.patch](https://github.com/sagemath/sage/files/ticket3738/3738-5-coerce_compat_layer.patch)



---

archive/attachments_003971.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-6-coerce_tests_pass.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-6-coerce_tests_pass.patch",
    "created_at": "2008-07-29T09:20:35Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-6-coerce_tests_pass.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021447.json:
```json
{
    "body": "**Attachment:** [3738-6-coerce_tests_pass.patch](https://github.com/sagemath/sage/files/ticket3738/3738-6-coerce_tests_pass.patch)",
    "created_at": "2008-07-29T09:20:35Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21447",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-6-coerce_tests_pass.patch](https://github.com/sagemath/sage/files/ticket3738/3738-6-coerce_tests_pass.patch)



---

archive/attachments_003972.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-8-old_check.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-8-old_check.patch",
    "created_at": "2008-07-29T09:20:58Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-8-old_check.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021448.json:
```json
{
    "body": "**Attachment:** [3738-8-old_check.patch](https://github.com/sagemath/sage/files/ticket3738/3738-8-old_check.patch)",
    "created_at": "2008-07-29T09:20:58Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21448",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-8-old_check.patch](https://github.com/sagemath/sage/files/ticket3738/3738-8-old_check.patch)



---

archive/attachments_003973.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-9-ccallmap.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-9-ccallmap.patch",
    "created_at": "2008-07-29T09:21:11Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-9-ccallmap.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021449.json:
```json
{
    "body": "**Attachment:** [3738-9-ccallmap.patch](https://github.com/sagemath/sage/files/ticket3738/3738-9-ccallmap.patch)",
    "created_at": "2008-07-29T09:21:11Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21449",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-9-ccallmap.patch](https://github.com/sagemath/sage/files/ticket3738/3738-9-ccallmap.patch)



---

archive/issue_events_020994.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-07-29T09:22:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3738#event-20994"
}
```



---

archive/attachments_003974.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-10-coerce_docs.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-10-coerce_docs.patch",
    "created_at": "2008-07-29T09:22:05Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-10-coerce_docs.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021450.json:
```json
{
    "body": "<a id='comment:1'></a>\n**Attachment:** [3738-10-coerce_docs.patch](https://github.com/sagemath/sage/files/ticket3738/3738-10-coerce_docs.patch)",
    "created_at": "2008-07-29T09:22:05Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21450",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:1'></a>
**Attachment:** [3738-10-coerce_docs.patch](https://github.com/sagemath/sage/files/ticket3738/3738-10-coerce_docs.patch)



---

archive/issue_events_020995.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-07-29T16:33:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "rename": {
        "from": "new coercion model",
        "to": "[almost ready for review] new coercion model"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3738#event-20995"
}
```



---

archive/issue_events_020996.json:
```json
{
    "actor": "https://github.com/robertwb",
    "created_at": "2008-07-30T04:23:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "rename": {
        "from": "[almost ready for review] new coercion model",
        "to": "new coercion model"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3738#event-20996"
}
```



---

archive/attachments_003975.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-7-maps.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-7-maps.patch",
    "created_at": "2008-07-30T04:23:37Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-7-maps.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021451.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Attachment:** [3738-7-maps.patch](https://github.com/sagemath/sage/files/ticket3738/3738-7-maps.patch)",
    "created_at": "2008-07-30T04:23:37Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21451",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:3'></a>
**Attachment:** [3738-7-maps.patch](https://github.com/sagemath/sage/files/ticket3738/3738-7-maps.patch)



---

archive/attachments_003976.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-12-explain-div.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-12-explain-div.patch",
    "created_at": "2008-07-30T05:53:43Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-12-explain-div.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021452.json:
```json
{
    "body": "**Attachment:** [3738-12-explain-div.patch](https://github.com/sagemath/sage/files/ticket3738/3738-12-explain-div.patch)",
    "created_at": "2008-07-30T05:53:43Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21452",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-12-explain-div.patch](https://github.com/sagemath/sage/files/ticket3738/3738-12-explain-div.patch)



---

archive/attachments_003977.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-11-constructor.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-11-constructor.patch",
    "created_at": "2008-07-30T06:18:17Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-11-constructor.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021453.json:
```json
{
    "body": "**Attachment:** [3738-11-constructor.patch](https://github.com/sagemath/sage/files/ticket3738/3738-11-constructor.patch)",
    "created_at": "2008-07-30T06:18:17Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21453",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-11-constructor.patch](https://github.com/sagemath/sage/files/ticket3738/3738-11-constructor.patch)



---

archive/attachments_003978.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "coerce.hg",
    "asset_url": "tarball://root/attachments/ticket3738/coerce.hg",
    "created_at": "2008-07-31T16:48:36Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/coerce.hg",
    "user": "https://github.com/williamstein"
}
```



---

archive/issue_comments_021454.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Attachment:** [coerce.hg](https://github.com/sagemath/sage/files/ticket3738/coerce.hg)\n\nA remark about doctest coverage:\n\n```\nOn Jul 30, 2008, at 9:49 AM, William Stein wrote:\n\n>> I think this is probably something that it would be good for multiple\n>> people could look at. (Both those previously involved in coercion,\n>> and those not). It could help spread the work around too.\n>>\n>\n> Michael Abshoff commented to me that the new coercion code you've\n> posted introduces new functions that have no doctests.  Any comment?\n\n\nThat is a true accusation, though I feel there is some justification\nas many of the functions are not actually being used yet so it is\nhard to test them (they were being used in the coercion branch, so\nit's not completely untested code, they're just not used until\nParents are converted.) Also, a lot of them are generic helper\nfunctions that are supposed to be overridden. And a third point is\nthat much of this was written before the 100% doctest rule, and there\nis a significant portion that is renaming/re-factoring old code.\n\nThat being said, I have strived for better coverage (and\ndocumentation, not just tests). Currently in terms of new (or heavily\nmodified) code we have:\n\nsage/structure/coerce.pyx\nSCORE sage/structure/coerce.pyx: 100% (20 of 20)\n\nsage/structure/coerce_actions.pyx\nERROR: Please define a s == loads(dumps(s)) doctest.\nSCORE sage/structure/coerce_actions.pyx: 66% (10 of 15)\n\nMissing documentation:\n         * __init__(self, G, S)\n         * Element _call_(self, g, a)\n         * __init__(self, G, S)\n         * Element _call_(self, a, g)\n         * __cinit__(self)\n\nThe first 4 are methods of the RAction and LAction classes that are\nnot yet used anywhere in the Sage library (but code exists to\ninstantiate them if _l_action or _r_action is defined on the\nelements). I'm not sure if/how __cinit__ should be tested.\n\nsage/structure/coerce_dict.pyx\nSCORE sage/structure/coerce_dict.pyx: 100% (14 of 14)\n\nsage/structure/coerce_maps.pyx\nERROR: Please define a s == loads(dumps(s)) doctest.\nSCORE sage/structure/coerce_maps.pyx: 28% (7 of 25)\n\nMostly __init__ and _call_ methods, but since no Parents have been\nconverted over they are never used (and some can't even be used until\nwe have converted Parents). There still some room for improvement\nhere, and I will write some more documentation for this file.\nBoilerplate __init__ functions are particularly unenlightening to\ndoctest.\n\nsage/structure/generators.pyx\nSCORE sage/structure/generators.pyx: 11% (5 of 45)\n\n[we don't use this yet, other then the fact that there's a cdef'd\nslot to put the generators object. If coverage on this file is a\nproblem, I would go ahead and delete much of this file, and only put\nback things as they are needed]\n\n\nThat is where things stand. I will go add more doctests to\ncoerce_maps.pyx (though I know I can't hit 100% until it's actually\nused) but I think it would be good to start reviewing it, and I would\nadvocate that for this particular project it be grandfathered in to\nsome extent for practicalities sake. (This is not the case for future\ncoercion tickets, which should meet the 100% coverage standard.)\n```",
    "created_at": "2008-07-31T16:48:36Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21454",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:4'></a>
**Attachment:** [coerce.hg](https://github.com/sagemath/sage/files/ticket3738/coerce.hg)

A remark about doctest coverage:

```
On Jul 30, 2008, at 9:49 AM, William Stein wrote:

>> I think this is probably something that it would be good for multiple
>> people could look at. (Both those previously involved in coercion,
>> and those not). It could help spread the work around too.
>>
>
> Michael Abshoff commented to me that the new coercion code you've
> posted introduces new functions that have no doctests.  Any comment?


That is a true accusation, though I feel there is some justification
as many of the functions are not actually being used yet so it is
hard to test them (they were being used in the coercion branch, so
it's not completely untested code, they're just not used until
Parents are converted.) Also, a lot of them are generic helper
functions that are supposed to be overridden. And a third point is
that much of this was written before the 100% doctest rule, and there
is a significant portion that is renaming/re-factoring old code.

That being said, I have strived for better coverage (and
documentation, not just tests). Currently in terms of new (or heavily
modified) code we have:

sage/structure/coerce.pyx
SCORE sage/structure/coerce.pyx: 100% (20 of 20)

sage/structure/coerce_actions.pyx
ERROR: Please define a s == loads(dumps(s)) doctest.
SCORE sage/structure/coerce_actions.pyx: 66% (10 of 15)

Missing documentation:
         * __init__(self, G, S)
         * Element _call_(self, g, a)
         * __init__(self, G, S)
         * Element _call_(self, a, g)
         * __cinit__(self)

The first 4 are methods of the RAction and LAction classes that are
not yet used anywhere in the Sage library (but code exists to
instantiate them if _l_action or _r_action is defined on the
elements). I'm not sure if/how __cinit__ should be tested.

sage/structure/coerce_dict.pyx
SCORE sage/structure/coerce_dict.pyx: 100% (14 of 14)

sage/structure/coerce_maps.pyx
ERROR: Please define a s == loads(dumps(s)) doctest.
SCORE sage/structure/coerce_maps.pyx: 28% (7 of 25)

Mostly __init__ and _call_ methods, but since no Parents have been
converted over they are never used (and some can't even be used until
we have converted Parents). There still some room for improvement
here, and I will write some more documentation for this file.
Boilerplate __init__ functions are particularly unenlightening to
doctest.

sage/structure/generators.pyx
SCORE sage/structure/generators.pyx: 11% (5 of 45)

[we don't use this yet, other then the fact that there's a cdef'd
slot to put the generators object. If coverage on this file is a
problem, I would go ahead and delete much of this file, and only put
back things as they are needed]


That is where things stand. I will go add more doctests to
coerce_maps.pyx (though I know I can't hit 100% until it's actually
used) but I think it would be good to start reviewing it, and I would
advocate that for this particular project it be grandfathered in to
some extent for practicalities sake. (This is not the case for future
coercion tickets, which should meet the 100% coverage standard.)
```



---

archive/attachments_003979.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-13-docs.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-13-docs.patch",
    "created_at": "2008-08-03T09:30:15Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-13-docs.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021455.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Attachment:** [3738-13-docs.patch](https://github.com/sagemath/sage/files/ticket3738/3738-13-docs.patch)\n\nAdded a bunch of doctests to `parent.pyx` and `coerce_maps.pyx`.",
    "created_at": "2008-08-03T09:30:15Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21455",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:5'></a>
**Attachment:** [3738-13-docs.patch](https://github.com/sagemath/sage/files/ticket3738/3738-13-docs.patch)

Added a bunch of doctests to `parent.pyx` and `coerce_maps.pyx`.



---

archive/attachments_003980.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-fix-1.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-fix-1.patch",
    "created_at": "2008-08-06T05:55:16Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-fix-1.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021456.json:
```json
{
    "body": "**Attachment:** [3738-fix-1.patch](https://github.com/sagemath/sage/files/ticket3738/3738-fix-1.patch)",
    "created_at": "2008-08-06T05:55:16Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21456",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-fix-1.patch](https://github.com/sagemath/sage/files/ticket3738/3738-fix-1.patch)



---

archive/issue_comments_021457.json:
```json
{
    "body": "<a id='comment:6'></a>\nMerged \n\n* coerce.hg\n* 3738-13-docs.patch\n* 3738-fix-1.patch \n\nin Sage 3.1.alpha2. These patches are on probation, but unless something goes wrong I see them in 3.1.final :)\n\nBy the way: \"#3744 - Coercion between isomorphic parents should result in an element of the left operand's parent\" is in the bundle and hence has also been merged.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-13T22:15:25Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21457",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
Merged 

* coerce.hg
* 3738-13-docs.patch
* 3738-fix-1.patch 

in Sage 3.1.alpha2. These patches are on probation, but unless something goes wrong I see them in 3.1.final :)

By the way: "#3744 - Coercion between isomorphic parents should result in an element of the left operand's parent" is in the bundle and hence has also been merged.

Cheers,

Michael



---

archive/issue_comments_021458.json:
```json
{
    "body": "<a id='comment:7'></a>\nWith the patch applied I am seeing two doctest failures:\n\n```\nmabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.1.alpha2$ sage -t -long devel/sage/sage/algebras/steenrod_algebra_element.py\nsage -t -long devel/sage/sage/algebras/steenrod_algebra_element.py\n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/steenrod_algebra_element.py\", line 218:\n    sage: xm * y\nExpected:\n    Sq^{5} Sq^{1}\nGot:\n    Sq(3,1)\n**********************************************************************\n1 items had failures:\n   1 of  90 in __main__.example_0\n***Test Failed*** 1 failures.\nFor whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/.doctest_steenrod_algebra_element.py\n         [3.0 s]\nexit code: 1024\n```\nThe above seems to be harmless.\n\nThe next one is:\n\n```\nsage -t -long devel/sage/sage/sets/set.py\n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/set.py\", line 442:\n    sage: Set(ZZ).cardinality()\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/doctest.py\", line 1228, in __run\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_20[1]>\", line 1, in <module>\n        Set(ZZ).cardinality()###line 442:\n    sage: Set(ZZ).cardinality()\n      File \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/site-packages/sage/sets/set.py\", line 459, in cardinality\n        raise NotImplementedError, \"computation of cardinality of %s not yet implemented\"%self.__object\n    NotImplementedError: computation of cardinality of Integer Ring not yet implemented\n**********************************************************************\nFile \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/set.py\", line 816:\n    sage: X.cardinality()\nException raised:\n    Traceback (most recent call last):\n      File \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/doctest.py\", line 1228, in __run\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_42[5]>\", line 1, in <module>\n        X.cardinality()###line 816:\n    sage: X.cardinality()\n      File \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/site-packages/sage/sets/set.py\", line 819, in cardinality\n        return self.__X.cardinality() + self.__Y.cardinality()\n      File \"/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/site-packages/sage/sets/set.py\", line 459, in cardinality\n        raise NotImplementedError, \"computation of cardinality of %s not yet implemented\"%self.__object\n    NotImplementedError: computation of cardinality of Integer Ring not yet implemented\n**********************************************************************\n2 items had failures:\n   1 of   5 in __main__.example_20\n   1 of   6 in __main__.example_42\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/.doctest_set.py\n         [3.4 s]\n```\n\nCheers,\n\nMichael",
    "created_at": "2008-08-13T22:37:14Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21458",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:7'></a>
With the patch applied I am seeing two doctest failures:

```
mabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.1.alpha2$ sage -t -long devel/sage/sage/algebras/steenrod_algebra_element.py
sage -t -long devel/sage/sage/algebras/steenrod_algebra_element.py
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/steenrod_algebra_element.py", line 218:
    sage: xm * y
Expected:
    Sq^{5} Sq^{1}
Got:
    Sq(3,1)
**********************************************************************
1 items had failures:
   1 of  90 in __main__.example_0
***Test Failed*** 1 failures.
For whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/.doctest_steenrod_algebra_element.py
         [3.0 s]
exit code: 1024
```
The above seems to be harmless.

The next one is:

```
sage -t -long devel/sage/sage/sets/set.py
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/set.py", line 442:
    sage: Set(ZZ).cardinality()
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/doctest.py", line 1228, in __run
        compileflags, 1) in test.globs
      File "<doctest __main__.example_20[1]>", line 1, in <module>
        Set(ZZ).cardinality()###line 442:
    sage: Set(ZZ).cardinality()
      File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/site-packages/sage/sets/set.py", line 459, in cardinality
        raise NotImplementedError, "computation of cardinality of %s not yet implemented"%self.__object
    NotImplementedError: computation of cardinality of Integer Ring not yet implemented
**********************************************************************
File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/set.py", line 816:
    sage: X.cardinality()
Exception raised:
    Traceback (most recent call last):
      File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/doctest.py", line 1228, in __run
        compileflags, 1) in test.globs
      File "<doctest __main__.example_42[5]>", line 1, in <module>
        X.cardinality()###line 816:
    sage: X.cardinality()
      File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/site-packages/sage/sets/set.py", line 819, in cardinality
        return self.__X.cardinality() + self.__Y.cardinality()
      File "/scratch/mabshoff/release-cycle/sage-3.1.alpha2/local/lib/python2.5/site-packages/sage/sets/set.py", line 459, in cardinality
        raise NotImplementedError, "computation of cardinality of %s not yet implemented"%self.__object
    NotImplementedError: computation of cardinality of Integer Ring not yet implemented
**********************************************************************
2 items had failures:
   1 of   5 in __main__.example_20
   1 of   6 in __main__.example_42
***Test Failed*** 2 failures.
For whitespace errors, see the file /scratch/mabshoff/release-cycle/sage-3.1.alpha2/tmp/.doctest_set.py
         [3.4 s]
```

Cheers,

Michael



---

archive/issue_events_020997.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2008-08-14T02:06:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "rename": {
        "from": "new coercion model",
        "to": "[under review by rlm and ncalexan] new coercion model"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3738#event-20997"
}
```



---

archive/issue_comments_021459.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks Nick and Robert for looking at this. Craig Citro has been reviewing it as well. I'm attaching a patch for the sets doctest failure.",
    "created_at": "2008-08-14T04:37:42Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21459",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:9'></a>
Thanks Nick and Robert for looking at this. Craig Citro has been reviewing it as well. I'm attaching a patch for the sets doctest failure.



---

archive/attachments_003981.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-cardinality.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-cardinality.patch",
    "created_at": "2008-08-14T04:38:25Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-cardinality.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021460.json:
```json
{
    "body": "**Attachment:** [3738-cardinality.patch](https://github.com/sagemath/sage/files/ticket3738/3738-cardinality.patch)",
    "created_at": "2008-08-14T04:38:25Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21460",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-cardinality.patch](https://github.com/sagemath/sage/files/ticket3738/3738-cardinality.patch)



---

archive/issue_comments_021461.json:
```json
{
    "body": "<a id='comment:10'></a>\nSpent a few hours of reading with rlm.  We reviewed, quite carefully, patches 0, 1, 2, and 3.\n\nI am confident that:\n\n1) the new code is solid -- not necc. bug free, but fixable\n\n2) the likelihood of this set of patches causing catastrophic failure is very low -- the sticky points (__getattr__ :) appear to be covered.\n\nI support applying this patch and moving forward with the conversion process 'in vivo'.",
    "created_at": "2008-08-14T05:14:53Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21461",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:10'></a>
Spent a few hours of reading with rlm.  We reviewed, quite carefully, patches 0, 1, 2, and 3.

I am confident that:

1) the new code is solid -- not necc. bug free, but fixable

2) the likelihood of this set of patches causing catastrophic failure is very low -- the sticky points (__getattr__ :) appear to be covered.

I support applying this patch and moving forward with the conversion process 'in vivo'.



---

archive/attachments_003982.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "coercion_comments1.txt",
    "asset_url": "tarball://root/attachments/ticket3738/coercion_comments1.txt",
    "created_at": "2008-08-14T05:15:32Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/coercion_comments1.txt",
    "user": "https://github.com/rlmill"
}
```



---

archive/issue_comments_021462.json:
```json
{
    "body": "**Attachment:** [coercion_comments1.txt](https://github.com/sagemath/sage/files/ticket3738/coercion_comments1.txt)",
    "created_at": "2008-08-14T05:15:32Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21462",
    "user": "https://github.com/rlmill"
}
```

**Attachment:** [coercion_comments1.txt](https://github.com/sagemath/sage/files/ticket3738/coercion_comments1.txt)



---

archive/issue_comments_021463.json:
```json
{
    "body": "<a id='comment:11'></a>\nI also support moving forward with these patches applied. It seems much more feasible to continue incrementally like this.",
    "created_at": "2008-08-14T05:17:01Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21463",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:11'></a>
I also support moving forward with these patches applied. It seems much more feasible to continue incrementally like this.



---

archive/issue_events_020998.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2008-08-14T05:17:01Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "rename": {
        "from": "[under review by rlm and ncalexan] new coercion model",
        "to": "[with two positive reviews, under review by cc] new coercion model"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3738#event-20998"
}
```



---

archive/attachments_003983.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3738-referee-comments.patch",
    "asset_url": "tarball://root/attachments/ticket3738/3738-referee-comments.patch",
    "created_at": "2008-08-14T06:13:16Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket3738/3738-referee-comments.patch",
    "user": "https://github.com/robertwb"
}
```



---

archive/issue_comments_021464.json:
```json
{
    "body": "**Attachment:** [3738-referee-comments.patch](https://github.com/sagemath/sage/files/ticket3738/3738-referee-comments.patch)",
    "created_at": "2008-08-14T06:13:16Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21464",
    "user": "https://github.com/robertwb"
}
```

**Attachment:** [3738-referee-comments.patch](https://github.com/sagemath/sage/files/ticket3738/3738-referee-comments.patch)



---

archive/issue_comments_021465.json:
```json
{
    "body": "<a id='comment:12'></a>\nThank you for your good comments. I've incorporated some of the feedback in 3738-referee-comments.patch\n\n> There are no docs in generators.\n\nTrue. See my earlier comments.  \n\n> sage/structure/parent.pyx:128 - What is the syntax foo(bar=None, *, etc=None) doing? Does it throw away all but the first non-kwd arg?\n\nhttp://www.python.org/dev/peps/pep-3102/\n\n> Why not always pass the parent (_unique morphism)?\n\nThere are two use cases, the first is speed for some critical types (Integer, Rational, RealDoubleElement)--the PY_NEW needs a constructor that takes no arguments. The second is often the element constructor is a bound method, in which case the parent is implicitly already passed in. \n\n> sage/structure/parent.pyx:256 (typo) this it will always be \n\nFixed. \n\n> In the Parent class, why is it not the case that `__call__` delegates to coerce?\n\nCoerce throws a (potentially expensive) error on failure.\n\n> sage/structure/parent.pyx:256 - needs to be wrapped in a list to prevent modification\n\nNote sure what you mean here. \n\n> sage/structure/parent.pyx:~438 - Hom vs. hom should be explained in docs (definitions are there, but perhaps a warning)\n\nNot sure I understand what you mean by warning. These functions (and their documentation) are mostly verbatim from the old Parent. \n\n> sage/structure/parent.pyx:597-9 etc. - should this be a copy?\n\nYou're right, though now these lists aren't modified near as often. \n\n> sage/structure/parent.pyx:530-1 - why not use the _generic_convert_map here? why does coerce_list use _generic_convert_map? what is the difference?\n\nThis should be a coercion, not a conversion. Also, Hom could do something special here. (This code is not mine, don't want to break it now.) \n\n> sage/structure/parent.pyx:807-24 - needs to be resolved\n\nThis needs to be thought through some more, but I think leaving the code and comments there does a good job of expressing our intent. \n\n> sage/structure/parent.pyx:839 - what does '\"best\"' mean? (868 - will this change in future patches?)\n\nOne that has the lowest _coerce_cost sum, but in reality it isn't used yet. I've changed the docstring to reflect this. \n\n> Can you clarify why `_coerce_map_from_` is checked for overrides, but there is no such check for conversion?\n\nBecause `_coerce_map_from_` and `_has_coerce_map_from_` circularly call each other. I clarified this a bit more. \n\n> Why was coerce graph removed? :-(\n\nIt wasn't working. I want this too, but it should probably be a separate ticket. \n\n> sage/structure/category_object.pyx:500 WHY ARE YOU WRITING Pyrex?\n\nThat was old documentation, but I changed it. \n\n> All the comment blocks at the beginning of files are in the old style. i.e. copyright 2006... etc.\n\nLets fix this with another ticket. \n\n> Sometime it's pretty hard to figure out what's going on because there is some pretty damn random stuff with no docs or comments at all. (not a blocking comment, just saying...)\n\nI tried to be really explicit with what I'm doing (especially the new stuff) but I won't claim to be perfect. Please ask if there is a particularly befuddling spot. A lot of parent is really, really old code too. \n\n> Why are inexact morphisms bad, Mommy?\n\nBecause they may not commute (e.g. due to rounding errors), and potentially loose information. \n\n> sage/structure/coerce_actions - Why are left and right different, my friends? Python?\n\nAs an example, let R be a non-commutative ring, and a \\in R. Then a acts on elements in R[x] by multiplication on the left and by multiplication on the right. \n\n> sage/structure/coerce_actions.pyx:193 - typo \"rikght\"\n\nOops. \n\n> The inplace stuff needs more explanation.\n\nAdded comment. Currently the threshold is set to 0, so no inplace operations are used. \n\n> In coerce_map.pyx, \"differs\" should be \"defers\" in several places.\n\nOops again. \n\n> There are a lot of if-else statements which special case out things which are automatically handled by Python syntax. Is this for speed?\n\nProbably, do you have an example? \n\n> sage/structure/coerce.pyx gets four thumbs up.\n\nThanks.",
    "created_at": "2008-08-14T06:15:41Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21465",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:12'></a>
Thank you for your good comments. I've incorporated some of the feedback in 3738-referee-comments.patch

> There are no docs in generators.

True. See my earlier comments.  

> sage/structure/parent.pyx:128 - What is the syntax foo(bar=None, *, etc=None) doing? Does it throw away all but the first non-kwd arg?

http://www.python.org/dev/peps/pep-3102/

> Why not always pass the parent (_unique morphism)?

There are two use cases, the first is speed for some critical types (Integer, Rational, RealDoubleElement)--the PY_NEW needs a constructor that takes no arguments. The second is often the element constructor is a bound method, in which case the parent is implicitly already passed in. 

> sage/structure/parent.pyx:256 (typo) this it will always be 

Fixed. 

> In the Parent class, why is it not the case that `__call__` delegates to coerce?

Coerce throws a (potentially expensive) error on failure.

> sage/structure/parent.pyx:256 - needs to be wrapped in a list to prevent modification

Note sure what you mean here. 

> sage/structure/parent.pyx:~438 - Hom vs. hom should be explained in docs (definitions are there, but perhaps a warning)

Not sure I understand what you mean by warning. These functions (and their documentation) are mostly verbatim from the old Parent. 

> sage/structure/parent.pyx:597-9 etc. - should this be a copy?

You're right, though now these lists aren't modified near as often. 

> sage/structure/parent.pyx:530-1 - why not use the _generic_convert_map here? why does coerce_list use _generic_convert_map? what is the difference?

This should be a coercion, not a conversion. Also, Hom could do something special here. (This code is not mine, don't want to break it now.) 

> sage/structure/parent.pyx:807-24 - needs to be resolved

This needs to be thought through some more, but I think leaving the code and comments there does a good job of expressing our intent. 

> sage/structure/parent.pyx:839 - what does '"best"' mean? (868 - will this change in future patches?)

One that has the lowest _coerce_cost sum, but in reality it isn't used yet. I've changed the docstring to reflect this. 

> Can you clarify why `_coerce_map_from_` is checked for overrides, but there is no such check for conversion?

Because `_coerce_map_from_` and `_has_coerce_map_from_` circularly call each other. I clarified this a bit more. 

> Why was coerce graph removed? :-(

It wasn't working. I want this too, but it should probably be a separate ticket. 

> sage/structure/category_object.pyx:500 WHY ARE YOU WRITING Pyrex?

That was old documentation, but I changed it. 

> All the comment blocks at the beginning of files are in the old style. i.e. copyright 2006... etc.

Lets fix this with another ticket. 

> Sometime it's pretty hard to figure out what's going on because there is some pretty damn random stuff with no docs or comments at all. (not a blocking comment, just saying...)

I tried to be really explicit with what I'm doing (especially the new stuff) but I won't claim to be perfect. Please ask if there is a particularly befuddling spot. A lot of parent is really, really old code too. 

> Why are inexact morphisms bad, Mommy?

Because they may not commute (e.g. due to rounding errors), and potentially loose information. 

> sage/structure/coerce_actions - Why are left and right different, my friends? Python?

As an example, let R be a non-commutative ring, and a \in R. Then a acts on elements in R[x] by multiplication on the left and by multiplication on the right. 

> sage/structure/coerce_actions.pyx:193 - typo "rikght"

Oops. 

> The inplace stuff needs more explanation.

Added comment. Currently the threshold is set to 0, so no inplace operations are used. 

> In coerce_map.pyx, "differs" should be "defers" in several places.

Oops again. 

> There are a lot of if-else statements which special case out things which are automatically handled by Python syntax. Is this for speed?

Probably, do you have an example? 

> sage/structure/coerce.pyx gets four thumbs up.

Thanks.



---

archive/issue_comments_021466.json:
```json
{
    "body": "<a id='comment:13'></a>\n> > sage/structure/parent.pyx:256 - needs to be wrapped in a list to prevent modification\n\n> \n> Note sure what you mean here. \n\nThere are a few cases where input lists are assigned as is, and then returned to the user (think of gens).  That allows a user to say:\n\nsage: x = R.gens()\nsage: x[0] = 0\nsage: R.gens()\n*wrong*\n\n> > sage/structure/coerce_actions - Why are left and right different, my friends? Python?\n\n> \n> As an example, let R be a non-commutative ring, and a \\in R. Then a acts on elements in R[x] by multiplication on the left and by multiplication on the right. \n\nSorry, that wasn't clear.  One of the actions has in_place, the other does not.  Why are they so different?  Is it because there is a *= g but no g =* a?\n\n> > There are a lot of if-else statements which special case out things which are automatically handled by Python syntax. Is this for speed?\n\n> \n> Probably, do you have an example?\n\nThere is some code that checks if args is not None, and then kwds is not None, and dispatches f(x), f(x, *args), f(x, *args, **kwds) accordingly.  Seems odd.",
    "created_at": "2008-08-14T06:51:32Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21466",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:13'></a>
> > sage/structure/parent.pyx:256 - needs to be wrapped in a list to prevent modification

> 
> Note sure what you mean here. 

There are a few cases where input lists are assigned as is, and then returned to the user (think of gens).  That allows a user to say:

sage: x = R.gens()
sage: x[0] = 0
sage: R.gens()
*wrong*

> > sage/structure/coerce_actions - Why are left and right different, my friends? Python?

> 
> As an example, let R be a non-commutative ring, and a \in R. Then a acts on elements in R[x] by multiplication on the left and by multiplication on the right. 

Sorry, that wasn't clear.  One of the actions has in_place, the other does not.  Why are they so different?  Is it because there is a *= g but no g =* a?

> > There are a lot of if-else statements which special case out things which are automatically handled by Python syntax. Is this for speed?

> 
> Probably, do you have an example?

There is some code that checks if args is not None, and then kwds is not None, and dispatches f(x), f(x, *args), f(x, *args, **kwds) accordingly.  Seems odd.



---

archive/issue_comments_021467.json:
```json
{
    "body": "<a id='comment:14'></a>\n>>> sage/structure/parent.pyx:256 - needs to be wrapped in a list to prevent modification\n\n>> Not sure what you mean here.\n\n> There are a few cases where input lists are assigned as is, and then returned to the user (think of gens)...\n\nI think they're all OK now. Gens is not passed in this way for instance. \n\n\n>> sage/structure/coerce_actions - Why are left and right different, my friends? Python?\n\n>>  As an example, let R be a non-commutative ring, and a \\in R. Then a acts on elements in R[x] by multiplication on the left and by multiplication on the right.\n\n> Sorry, that wasn't clear. One of the actions has in_place, the other does not. Why are they so different? Is it because there is a *= g but no g =* a? \n\nYes, exactly. \n\n>>> There are a lot of if-else statements which special case out things which are automatically handled by Python syntax. Is this for speed?\n\n>> Probably, do you have an example?\n\n> There is some code that checks if args is not None, and then kwds is not None, and dispatches f(x), f(x, *args), f(x, *args, **kwds) accordingly. Seems odd. \n\nYes, this is for speed. Calling functions with variable-length arguments (and especially keywords) can be an non-negligible overhead for simple elements, and by by far the most common case is to have neither or just a single argument which the code is optimized for.",
    "created_at": "2008-08-14T07:17:23Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21467",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:14'></a>
>>> sage/structure/parent.pyx:256 - needs to be wrapped in a list to prevent modification

>> Not sure what you mean here.

> There are a few cases where input lists are assigned as is, and then returned to the user (think of gens)...

I think they're all OK now. Gens is not passed in this way for instance. 


>> sage/structure/coerce_actions - Why are left and right different, my friends? Python?

>>  As an example, let R be a non-commutative ring, and a \in R. Then a acts on elements in R[x] by multiplication on the left and by multiplication on the right.

> Sorry, that wasn't clear. One of the actions has in_place, the other does not. Why are they so different? Is it because there is a *= g but no g =* a? 

Yes, exactly. 

>>> There are a lot of if-else statements which special case out things which are automatically handled by Python syntax. Is this for speed?

>> Probably, do you have an example?

> There is some code that checks if args is not None, and then kwds is not None, and dispatches f(x), f(x, *args), f(x, *args, **kwds) accordingly. Seems odd. 

Yes, this is for speed. Calling functions with variable-length arguments (and especially keywords) can be an non-negligible overhead for simple elements, and by by far the most common case is to have neither or just a single argument which the code is optimized for.



---

archive/issue_comments_021468.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [robertwb](#comment%3A14):\n> >>> sage/structure/parent.pyx:256 - needs to be wrapped in a list to prevent modification\n\n> \n> >> Not sure what you mean here.\n\n> \n> > There are a few cases where input lists are assigned as is, and then returned to the user (think of gens)...\n\n> \n> I think they're all OK now. Gens is not passed in this way for instance. \n\nI seem to recall a few instances where this happened which wasn't covered by your latest patch. After looking for a while I can't find any, but I am pretty tired.\n\n\nI just want to say again, this code looks __SOLID__. Excellent work!",
    "created_at": "2008-08-14T07:53:13Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21468",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:15'></a>
Replying to [robertwb](#comment%3A14):
> >>> sage/structure/parent.pyx:256 - needs to be wrapped in a list to prevent modification

> 
> >> Not sure what you mean here.

> 
> > There are a few cases where input lists are assigned as is, and then returned to the user (think of gens)...

> 
> I think they're all OK now. Gens is not passed in this way for instance. 

I seem to recall a few instances where this happened which wasn't covered by your latest patch. After looking for a while I can't find any, but I am pretty tired.


I just want to say again, this code looks __SOLID__. Excellent work!



---

archive/issue_comments_021469.json:
```json
{
    "body": "<a id='comment:16'></a>\nI just want to pipe in and say that I'm really happy to see this getting merged. I haven't had as much time as I'd like to look through the code, but what I've seen looks good. I think that merging this and going from there is the way to go. My plan for refereeing is to start by writing some documentation about how exactly the new coercion code should be working, and seeing if it does as claimed. I'll start submitting some patches with more documentation as soon as I can, but since Nick and Robert have already looked over the first bits of this, I'm happy to say we merge it and go from there.",
    "created_at": "2008-08-14T10:14:15Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21469",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:16'></a>
I just want to pipe in and say that I'm really happy to see this getting merged. I haven't had as much time as I'd like to look through the code, but what I've seen looks good. I think that merging this and going from there is the way to go. My plan for refereeing is to start by writing some documentation about how exactly the new coercion code should be working, and seeing if it does as claimed. I'll start submitting some patches with more documentation as soon as I can, but since Nick and Robert have already looked over the first bits of this, I'm happy to say we merge it and go from there.



---

archive/issue_events_020999.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-08-14T10:14:15Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "rename": {
        "from": "[with two positive reviews, under review by cc] new coercion model",
        "to": "[with two positive reviews] new coercion model"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3738#event-20999"
}
```



---

archive/issue_comments_021470.json:
```json
{
    "body": "<a id='comment:18'></a>\nSomeone please review 3738-cardinality.patch and 3738-referee-comments.patch so that I can merge those two patches and close the ticket.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-14T16:47:41Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21470",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:18'></a>
Someone please review 3738-cardinality.patch and 3738-referee-comments.patch so that I can merge those two patches and close the ticket.

Cheers,

Michael



---

archive/issue_comments_021471.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [mabshoff](#comment%3A18):\n> Someone please review 3738-cardinality.patch and 3738-referee-comments.patch so that I can merge those two patches and close the ticket.\n\nI'll give this a positive review. I haven't run tests with `3738-cardinality.patch`, but it's an obvious typo fix. The patch `3738-cardinality.patch` addresses all of the issues in the referee comments (which are both Nick's and mine, for the record).\n\n + 1",
    "created_at": "2008-08-14T16:51:06Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21471",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:19'></a>
Replying to [mabshoff](#comment%3A18):
> Someone please review 3738-cardinality.patch and 3738-referee-comments.patch so that I can merge those two patches and close the ticket.

I'll give this a positive review. I haven't run tests with `3738-cardinality.patch`, but it's an obvious typo fix. The patch `3738-cardinality.patch` addresses all of the issues in the referee comments (which are both Nick's and mine, for the record).

 + 1



---

archive/issue_comments_021472.json:
```json
{
    "body": "<a id='comment:20'></a>\nRather,\n\nThe patch `3738-referee-comments.patch` addresses all of the issues in the referee comments (which are both Nick's and mine, for the record).",
    "created_at": "2008-08-14T16:55:33Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21472",
    "user": "https://github.com/rlmill"
}
```

<a id='comment:20'></a>
Rather,

The patch `3738-referee-comments.patch` addresses all of the issues in the referee comments (which are both Nick's and mine, for the record).



---

archive/issue_comments_021473.json:
```json
{
    "body": "<a id='comment:21'></a>\nMerged 3738-cardinality.patch and 3738-referee-comments.patch in Sage 3.1.rc0.\n\nCan someone please tell me how the credit should be assigned on this ticket? My impression:\n\nCode: Robert Bradshaw, David Roe\nReview: Nick Alexander, Robert Miller, Craig Citro\n\nCheers,\n\nMichael",
    "created_at": "2008-08-14T16:57:44Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21473",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:21'></a>
Merged 3738-cardinality.patch and 3738-referee-comments.patch in Sage 3.1.rc0.

Can someone please tell me how the credit should be assigned on this ticket? My impression:

Code: Robert Bradshaw, David Roe
Review: Nick Alexander, Robert Miller, Craig Citro

Cheers,

Michael



---

archive/issue_events_021000.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-14T16:57:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3738#event-21000"
}
```



---

archive/issue_events_021001.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-08-14T16:57:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3738#event-21001"
}
```



---

archive/issue_comments_021474.json:
```json
{
    "body": "<a id='comment:22'></a>\nI, ncalexan, am fine with review credit.",
    "created_at": "2008-08-14T17:22:16Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21474",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:22'></a>
I, ncalexan, am fine with review credit.



---

archive/issue_comments_021475.json:
```json
{
    "body": "<a id='comment:23'></a>\nWe need the following fix to make doctests pass with the patches applied:\n\n```\n--- a/sage/structure/parent.pyx Wed Aug 13 18:50:14 2008 -0700\n+++ b/sage/structure/parent.pyx Thu Aug 14 15:03:16 2008 -0700\n@@ -16,6 +16,8 @@\n cimport element\n cimport sage.categories.morphism as morphism\n cimport sage.categories.map as map\n+\n+from copy import copy\n```\nCredit goes to William.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-14T22:11:49Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21475",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:23'></a>
We need the following fix to make doctests pass with the patches applied:

```
--- a/sage/structure/parent.pyx Wed Aug 13 18:50:14 2008 -0700
+++ b/sage/structure/parent.pyx Thu Aug 14 15:03:16 2008 -0700
@@ -16,6 +16,8 @@
 cimport element
 cimport sage.categories.morphism as morphism
 cimport sage.categories.map as map
+
+from copy import copy
```
Credit goes to William.

Cheers,

Michael



---

archive/issue_comments_021476.json:
```json
{
    "body": "<a id='comment:24'></a>\nRe credit, that looks good to me.",
    "created_at": "2008-08-15T07:23:49Z",
    "issue": "https://github.com/sagemath/sage/issues/3738",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3738#issuecomment-21476",
    "user": "https://github.com/robertwb"
}
```

<a id='comment:24'></a>
Re credit, that looks good to me.
