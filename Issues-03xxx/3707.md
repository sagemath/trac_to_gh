# Issue 3707: Make all common Sage classes convertible to SymPy

archive/issues_003707.json:
```json
{
    "assignees": [
        "https://github.com/garyfurnish"
    ],
    "body": "The attached patch is here like a request for comments. \n\nWe are about to release a new sympy that contains thorough tests for Sage <-> SymPy conversion:\n\nhttp://hg.sympy.org/sympy/file/16cfc09420ee/sympy/test_external/test_sage.py\n\nWhen sage 3.0.6 gets released, I'll create a new sympy spkg and expand tests in Sage too, so that we are sure things work in Sage environment too.\n\nComponent: **calculus**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/3707_\n\n",
    "closed_at": "2008-08-22T19:36:43Z",
    "created_at": "2008-07-22T11:19:25Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20calculus",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.1.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make all common Sage classes convertible to SymPy",
    "type": "issue",
    "updated_at": "2008-08-22T19:36:43Z",
    "url": "https://github.com/sagemath/sage/issues/3707",
    "user": "https://github.com/certik"
}
```
The attached patch is here like a request for comments. 

We are about to release a new sympy that contains thorough tests for Sage <-> SymPy conversion:

http://hg.sympy.org/sympy/file/16cfc09420ee/sympy/test_external/test_sage.py

When sage 3.0.6 gets released, I'll create a new sympy spkg and expand tests in Sage too, so that we are sure things work in Sage environment too.

Component: **calculus**

_Issue created by migration from https://trac.sagemath.org/ticket/3707_





---

archive/issue_events_041029.json:
```json
{
    "actor": "https://github.com/certik",
    "created_at": "2008-07-22T11:19:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "milestone_number": null,
    "milestone_title": "sage-3.1.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41029"
}
```



---

archive/issue_events_041030.json:
```json
{
    "actor": "https://github.com/certik",
    "created_at": "2008-07-22T11:19:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41030"
}
```



---

archive/issue_events_041031.json:
```json
{
    "actor": "https://github.com/certik",
    "created_at": "2008-07-22T11:19:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41031"
}
```



---

archive/issue_events_041032.json:
```json
{
    "actor": "https://github.com/certik",
    "created_at": "2008-07-22T11:19:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41032"
}
```



---

archive/issue_events_041033.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-07-22T11:19:25Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "subject": "https://github.com/certik",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41033"
}
```



---

archive/issue_events_041034.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-07-22T23:05:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41034"
}
```



---

archive/issue_events_041035.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2008-08-10T13:18:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41035"
}
```



---

archive/issue_events_041036.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2008-08-10T13:18:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41036"
}
```



---

archive/issue_comments_020357.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\n**Review**\n* the patch contains functions without doctests and some without documentation\n* Maybe `import sympy` could be avoided in each method using a `late_import` tricK?",
    "created_at": "2008-08-10T13:18:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20357",
    "user": "https://github.com/malb"
}
```

<div id="comment:2" align="right">comment:2</div>

**Review**
* the patch contains functions without doctests and some without documentation
* Maybe `import sympy` could be avoided in each method using a `late_import` tricK?



---

archive/issue_comments_020358.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThanks for the review. I'll write doctests and learn about late_import() to see how I could use it.",
    "created_at": "2008-08-10T15:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20358",
    "user": "https://github.com/certik"
}
```

<div id="comment:3" align="right">comment:3</div>

Thanks for the review. I'll write doctests and learn about late_import() to see how I could use it.



---

archive/issue_comments_020359.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@certik](#comment:3):\n> Thanks for the review. I'll write doctests and learn about late_import() to see how I could use it.\n\nExamples of this idea (we don't have a framework for that), can be found in:\n\n* `sage.rings.finite_field_givaro`\n* `sage.libs.pari.gen`\n* `sage.rings.integer`\n\nLooking at those should get you started.",
    "created_at": "2008-08-10T16:14:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20359",
    "user": "https://github.com/malb"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@certik](#comment:3):
> Thanks for the review. I'll write doctests and learn about late_import() to see how I could use it.

Examples of this idea (we don't have a framework for that), can be found in:

* `sage.rings.finite_field_givaro`
* `sage.libs.pari.gen`
* `sage.rings.integer`

Looking at those should get you started.



---

archive/issue_comments_020360.json:
```json
{
    "body": "Attachment: **[sympy0.6.2fix.patch.gz](https://github.com/sagemath/sage/files/ticket3707/sympy0.6.2fix.patch.gz)**\n\napply this together with sympy-0.6.2.spkg",
    "created_at": "2008-08-17T20:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20360",
    "user": "https://github.com/certik"
}
```

Attachment: **[sympy0.6.2fix.patch.gz](https://github.com/sagemath/sage/files/ticket3707/sympy0.6.2fix.patch.gz)**

apply this together with sympy-0.6.2.spkg



---

archive/issue_comments_020361.json:
```json
{
    "body": "Attachment: **[sage_sympy.patch.gz](https://github.com/sagemath/sage/files/ticket3707/sage_sympy.patch.gz)**",
    "created_at": "2008-08-17T20:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20361",
    "user": "https://github.com/certik"
}
```

Attachment: **[sage_sympy.patch.gz](https://github.com/sagemath/sage/files/ticket3707/sage_sympy.patch.gz)**



---

archive/issue_comments_020362.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nPlease update this spkg:\n\nhttp://sage.math.washington.edu/home/ondrej/spkg/sympy-0.6.2.spkg\n\nand apply the above two patches.\n\nmalb: I wrote docstrings and doctests. I didn't use late_import(), as I think in pure python it won't slow things that much and there is a question where I should put this late_import(). But if you think it's necessary, I'll fix that.",
    "created_at": "2008-08-17T20:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20362",
    "user": "https://github.com/certik"
}
```

<div id="comment:5" align="right">comment:5</div>

Please update this spkg:

http://sage.math.washington.edu/home/ondrej/spkg/sympy-0.6.2.spkg

and apply the above two patches.

malb: I wrote docstrings and doctests. I didn't use late_import(), as I think in pure python it won't slow things that much and there is a question where I should put this late_import(). But if you think it's necessary, I'll fix that.



---

archive/issue_comments_020363.json:
```json
{
    "body": "Attachment: **[trac_3707_fixup.patch.gz](https://github.com/sagemath/sage/files/ticket3707/trac_3707_fixup.patch.gz)**\n\napply after the other patches",
    "created_at": "2008-08-18T10:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20363",
    "user": "https://github.com/malb"
}
```

Attachment: **[trac_3707_fixup.patch.gz](https://github.com/sagemath/sage/files/ticket3707/trac_3707_fixup.patch.gz)**

apply after the other patches



---

archive/issue_events_041037.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2008-08-18T10:11:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41037"
}
```



---

archive/issue_events_041038.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2008-08-18T10:11:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41038"
}
```



---

archive/issue_comments_020364.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\n**Referee Report**\n* one new function didn't have a doctest (fixed in attached patch)\n* some doctests were failing (fixed in attached patch)\n* `#indirect doctest` directive was missing to make `sage -coverage` happy (fixed in attached patch)\n* One typo (fixed in attached patch)\n\nI'd give the patches a positive review if my fixes are accepted by Ondrej. Ondrej, you now need to check my fixup patch and review it. If you settle for a positive review, then you can change the title to `positive review`.",
    "created_at": "2008-08-18T10:11:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20364",
    "user": "https://github.com/malb"
}
```

<div id="comment:6" align="right">comment:6</div>

**Referee Report**
* one new function didn't have a doctest (fixed in attached patch)
* some doctests were failing (fixed in attached patch)
* `#indirect doctest` directive was missing to make `sage -coverage` happy (fixed in attached patch)
* One typo (fixed in attached patch)

I'd give the patches a positive review if my fixes are accepted by Ondrej. Ondrej, you now need to check my fixup patch and review it. If you settle for a positive review, then you can change the title to `positive review`.



---

archive/issue_comments_020365.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOops, thanks you did so much work with it, this is weird, all tests passed for me before posting here. Let me investigate what went wrong, I'll report later.",
    "created_at": "2008-08-18T10:21:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20365",
    "user": "https://github.com/certik"
}
```

<div id="comment:7" align="right">comment:7</div>

Oops, thanks you did so much work with it, this is weird, all tests passed for me before posting here. Let me investigate what went wrong, I'll report later.



---

archive/issue_comments_020366.json:
```json
{
    "body": "Attachment: **[trac_3707_fixup.2.patch.gz](https://github.com/sagemath/sage/files/ticket3707/trac_3707_fixup.2.patch.gz)**",
    "created_at": "2008-08-19T22:23:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20366",
    "user": "https://github.com/certik"
}
```

Attachment: **[trac_3707_fixup.2.patch.gz](https://github.com/sagemath/sage/files/ticket3707/trac_3707_fixup.2.patch.gz)**



---

archive/issue_comments_020367.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nMy review is +1, only please apply this patch:\n\ntrac_3707_fixup.2.patch\n\ninstead of yours. The diff is this:\n\n```\n$ hg di\ndiff -r 25553a0bd339 sage/calculus/calculus.py\n--- a/sage/calculus/calculus.py\tMon Aug 18 11:04:52 2008 +0100\n+++ b/sage/calculus/calculus.py\tTue Aug 19 15:18:50 2008 -0700\n@@ -5099,7 +5099,8 @@\n \n         EXAMPLE:\n             sage: x,y = var('x,y')\n-            sage: sympy(x) # indirect doctest\n+            sage: import sympy\n+            sage: sympy.sympify(x) # indirect doctest\n             x\n         \"\"\"\n```\n\n\nyour version didn't pass doctests, but this should fix it. \n\nThanks again for the patch you did, it really helps. I hope all should be fine now. I'll attache the result of sage tests once it finishes.",
    "created_at": "2008-08-19T22:26:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20367",
    "user": "https://github.com/certik"
}
```

<div id="comment:8" align="right">comment:8</div>

My review is +1, only please apply this patch:

trac_3707_fixup.2.patch

instead of yours. The diff is this:

```
$ hg di
diff -r 25553a0bd339 sage/calculus/calculus.py
--- a/sage/calculus/calculus.py	Mon Aug 18 11:04:52 2008 +0100
+++ b/sage/calculus/calculus.py	Tue Aug 19 15:18:50 2008 -0700
@@ -5099,7 +5099,8 @@
 
         EXAMPLE:
             sage: x,y = var('x,y')
-            sage: sympy(x) # indirect doctest
+            sage: import sympy
+            sage: sympy.sympify(x) # indirect doctest
             x
         """
```


your version didn't pass doctests, but this should fix it. 

Thanks again for the patch you did, it really helps. I hope all should be fine now. I'll attache the result of sage tests once it finishes.



---

archive/issue_comments_020368.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nHere is a result of the tests:\n\nhttp://sage.math.washington.edu/home/ondrej/ext/sage/devel/sage/test.log\n\nall tests pass. :)\n\nSo as to me, it's ok to go in.",
    "created_at": "2008-08-19T23:20:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20368",
    "user": "https://github.com/certik"
}
```

<div id="comment:9" align="right">comment:9</div>

Here is a result of the tests:

http://sage.math.washington.edu/home/ondrej/ext/sage/devel/sage/test.log

all tests pass. :)

So as to me, it's ok to go in.



---

archive/issue_comments_020369.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI give this a positive review. Ondrej could give the release manager (probably mabshoff) a precise list of patches to apply in which order in a comment? I suspect:\n* sympy0.6.2fix.patch\n* sage_sympy.patch\n* trac_3707_fixup.2.patch\nin that order.",
    "created_at": "2008-08-19T23:47:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20369",
    "user": "https://github.com/malb"
}
```

<div id="comment:10" align="right">comment:10</div>

I give this a positive review. Ondrej could give the release manager (probably mabshoff) a precise list of patches to apply in which order in a comment? I suspect:
* sympy0.6.2fix.patch
* sage_sympy.patch
* trac_3707_fixup.2.patch
in that order.



---

archive/issue_events_041039.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2008-08-19T23:47:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41039"
}
```



---

archive/issue_events_041040.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2008-08-19T23:47:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41040"
}
```



---

archive/issue_comments_020370.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nYes, apply the new spkg first and then the patches in exactly this order.\n\nThanks for the review!",
    "created_at": "2008-08-20T07:30:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20370",
    "user": "https://github.com/certik"
}
```

<div id="comment:11" align="right">comment:11</div>

Yes, apply the new spkg first and then the patches in exactly this order.

Thanks for the review!



---

archive/issue_comments_020371.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nOndrej,\n\nI did a number of cleanups to spkg-install and SPKG.txt. SPKG.txt still needs some more work, but I guess this has been a step in the right direction. Please base future sympy.spkgs of this one - I did not change the version number.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-22T19:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20371",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:12" align="right">comment:12</div>

Ondrej,

I did a number of cleanups to spkg-install and SPKG.txt. SPKG.txt still needs some more work, but I guess this has been a step in the right direction. Please base future sympy.spkgs of this one - I did not change the version number.

Cheers,

Michael



---

archive/issue_comments_020372.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nMerged the patches listed above in Sage 3.1.2.alpha0",
    "created_at": "2008-08-22T19:36:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3707#issuecomment-20372",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:13" align="right">comment:13</div>

Merged the patches listed above in Sage 3.1.2.alpha0



---

archive/issue_events_041041.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-08-22T19:36:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41041"
}
```



---

archive/issue_events_041042.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-08-22T19:36:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3707",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3707#event-41042"
}
```
