# Issue 3426: bessel_K function is broken

archive/issues_003426.json:
```json
{
    "assignees": [
        "https://github.com/garyfurnish"
    ],
    "body": "Currently we have\n\n```\nsage: bessel_K(10 * I, 10)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/<ipython console> in <module>()\n\n/home/bober/sage/local/lib/python2.5/site-packages/sage/functions/special.py in bessel_K(nu, z, algorithm, prec)\n    586         from sage.libs.pari.all import pari\n    587         RR,a = _setup(prec)\n--> 588         b = RR(pari(nu).besselk(z))\n    589         pari.set_real_precision(a)\n    590         return b\n\n/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/real_mpfr.pyx in sage.rings.real_mpfr.RealField.__call__ (sage/rings/real_mpfr.c:3138)()\n\n/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/real_mpfr.pyx in sage.rings.real_mpfr.RealNumber._set (sage/rings/real_mpfr.c:5905)()\n\nTypeError: Unable to convert x (='0.000000098241574381992468+0.E-161*I') to real number.\nsage: bessel_K(10 * I, 10)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/<ipython console> in <module>()\n\n/home/bober/sage/local/lib/python2.5/site-packages/sage/functions/special.py in bessel_K(nu, z, algorithm, prec)\n    586         from sage.libs.pari.all import pari\n    587         RR,a = _setup(prec)\n--> 588         b = RR(pari(nu).besselk(z))\n    589         pari.set_real_precision(a)\n    590         return b\n\n/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/real_mpfr.pyx in sage.rings.real_mpfr.RealField.__call__ (sage/rings/real_mpfr.c:3138)()\n\n/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/real_mpfr.pyx in sage.rings.real_mpfr.RealNumber._set (sage/rings/real_mpfr.c:5905)()\n\nTypeError: Unable to convert x (='0.000000098241574381992468+0.E-161*I') to real number.\n```\n\nIn this case the result actually should be a real number, so we fix this by discarding the imaginary part of the result from pari. In other cases, however, the result is actually a complex number, and we shouldn't always be attempting to cast it to a real number (which the attached patch also fixes).\n\nCC:  @burcin @kcrisman @benjaminfjones\n\nKeywords: **bessel, bessel_K**\n\nReviewer: **Karl-Dieter Crisman, Benjamin Jones**\n\nComponent: **calculus**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/3426_\n\n",
    "closed_at": "2013-02-17T20:10:42Z",
    "created_at": "2008-06-14T22:10:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/c%3A%20calculus",
        "https://github.com/sagemath/sage/labels/duplicate"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "bessel_K function is broken",
    "type": "issue",
    "updated_at": "2013-02-17T20:10:42Z",
    "url": "https://github.com/sagemath/sage/issues/3426",
    "user": "https://github.com/sagetrac-bober"
}
```
Currently we have

```
sage: bessel_K(10 * I, 10)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/<ipython console> in <module>()

/home/bober/sage/local/lib/python2.5/site-packages/sage/functions/special.py in bessel_K(nu, z, algorithm, prec)
    586         from sage.libs.pari.all import pari
    587         RR,a = _setup(prec)
--> 588         b = RR(pari(nu).besselk(z))
    589         pari.set_real_precision(a)
    590         return b

/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/real_mpfr.pyx in sage.rings.real_mpfr.RealField.__call__ (sage/rings/real_mpfr.c:3138)()

/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/real_mpfr.pyx in sage.rings.real_mpfr.RealNumber._set (sage/rings/real_mpfr.c:5905)()

TypeError: Unable to convert x (='0.000000098241574381992468+0.E-161*I') to real number.
sage: bessel_K(10 * I, 10)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/<ipython console> in <module>()

/home/bober/sage/local/lib/python2.5/site-packages/sage/functions/special.py in bessel_K(nu, z, algorithm, prec)
    586         from sage.libs.pari.all import pari
    587         RR,a = _setup(prec)
--> 588         b = RR(pari(nu).besselk(z))
    589         pari.set_real_precision(a)
    590         return b

/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/real_mpfr.pyx in sage.rings.real_mpfr.RealField.__call__ (sage/rings/real_mpfr.c:3138)()

/home/bober/sage-3.0.2/devel/sage-bober/sage/functions/real_mpfr.pyx in sage.rings.real_mpfr.RealNumber._set (sage/rings/real_mpfr.c:5905)()

TypeError: Unable to convert x (='0.000000098241574381992468+0.E-161*I') to real number.
```

In this case the result actually should be a real number, so we fix this by discarding the imaginary part of the result from pari. In other cases, however, the result is actually a complex number, and we shouldn't always be attempting to cast it to a real number (which the attached patch also fixes).

CC:  @burcin @kcrisman @benjaminfjones

Keywords: **bessel, bessel_K**

Reviewer: **Karl-Dieter Crisman, Benjamin Jones**

Component: **calculus**

_Issue created by migration from https://trac.sagemath.org/ticket/3426_





---

archive/issue_events_037184.json:
```json
{
    "actor": "https://github.com/sagetrac-bober",
    "created_at": "2008-06-14T22:10:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37184"
}
```



---

archive/issue_events_037185.json:
```json
{
    "actor": "https://github.com/sagetrac-bober",
    "created_at": "2008-06-14T22:10:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37185"
}
```



---

archive/issue_events_037186.json:
```json
{
    "actor": "https://github.com/sagetrac-bober",
    "created_at": "2008-06-14T22:10:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37186"
}
```



---

archive/issue_events_037187.json:
```json
{
    "actor": "https://github.com/sagetrac-bober",
    "created_at": "2008-06-14T22:10:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37187"
}
```



---

archive/issue_events_037188.json:
```json
{
    "actor": "https://github.com/sagetrac-bober",
    "created_at": "2008-06-14T22:10:12Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "subject": "https://github.com/sagetrac-bober",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37188"
}
```



---

archive/issue_comments_018574.json:
```json
{
    "body": "Attachment: **[kbessel_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket3426/kbessel_fixes.patch.gz)**",
    "created_at": "2008-06-14T22:10:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18574",
    "user": "https://github.com/sagetrac-bober"
}
```

Attachment: **[kbessel_fixes.patch.gz](https://github.com/sagemath/sage/files/ticket3426/kbessel_fixes.patch.gz)**



---

archive/issue_events_037189.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-14T23:36:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37189"
}
```



---

archive/issue_events_037190.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-14T23:36:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "milestone_number": null,
    "milestone_title": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37190"
}
```



---

archive/issue_events_037191.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-14T23:36:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "title_is": "bessel_K function is broken",
    "title_was": "bessel_K function is broken (with patch, needs review)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37191"
}
```



---

archive/issue_events_037192.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-14T23:36:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37192"
}
```



---

archive/issue_events_037193.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-14T23:36:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37193"
}
```



---

archive/issue_events_037194.json:
```json
{
    "actor": "https://github.com/malb",
    "created_at": "2008-06-15T01:20:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20calculus",
    "label_color": "0000ff",
    "label_name": "c: calculus",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37194"
}
```



---

archive/issue_events_037195.json:
```json
{
    "actor": "https://github.com/sagetrac-bober",
    "created_at": "2008-06-15T01:20:19Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "subject": "https://github.com/malb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37195"
}
```



---

archive/issue_events_037196.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-15T01:20:19Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "subject": "https://github.com/malb",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37196"
}
```



---

archive/issue_events_037197.json:
```json
{
    "actor": "https://github.com/craigcitro",
    "created_at": "2008-06-15T22:05:19Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "title_is": "[under review] bessel_K function is broken",
    "title_was": "bessel_K function is broken",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37197"
}
```



---

archive/issue_comments_018575.json:
```json
{
    "body": "Changed keywords from **bessel, bessel_K** to **bessel, bessel_K, editor_gfurnish**",
    "created_at": "2008-06-15T22:05:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18575",
    "user": "https://github.com/craigcitro"
}
```

Changed keywords from **bessel, bessel_K** to **bessel, bessel_K, editor_gfurnish**



---

archive/issue_comments_018576.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nRegarding bessel_K being real for real argument and real or imaginary order, see, e.g. the appendix to H. Then, Maass cusp forms for large eigenvalues, Math. Comp. Volume 74, Number 249, pp. 363 - 381: \"The K-Bessel function K_ir(x) is ... real for real arguments x and real or imaginary order ir.\"",
    "created_at": "2008-06-16T04:18:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18576",
    "user": "https://github.com/sagetrac-bober"
}
```

<div id="comment:4" align="right">comment:4</div>

Regarding bessel_K being real for real argument and real or imaginary order, see, e.g. the appendix to H. Then, Maass cusp forms for large eigenvalues, Math. Comp. Volume 74, Number 249, pp. 363 - 381: "The K-Bessel function K_ir(x) is ... real for real arguments x and real or imaginary order ir."



---

archive/issue_comments_018577.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI can say that I agree that this is 100% correct.",
    "created_at": "2008-06-16T05:18:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18577",
    "user": "https://github.com/sagetrac-gregorybard"
}
```

<div id="comment:5" align="right">comment:5</div>

I can say that I agree that this is 100% correct.



---

archive/issue_events_037198.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T05:51:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "title_is": "bessel_K function is broken",
    "title_was": "[under review] bessel_K function is broken",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37198"
}
```



---

archive/issue_events_037199.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T05:51:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37199"
}
```



---

archive/issue_events_037200.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T05:51:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37200"
}
```



---

archive/issue_events_037201.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T05:55:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37201"
}
```



---

archive/issue_events_037202.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T05:55:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37202"
}
```



---

archive/issue_events_037203.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T05:55:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "milestone_number": null,
    "milestone_title": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37203"
}
```



---

archive/issue_events_037204.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T05:55:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37204"
}
```



---

archive/issue_events_037205.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-16T06:42:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37205"
}
```



---

archive/issue_events_037206.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-16T06:42:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "milestone_number": null,
    "milestone_title": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37206"
}
```



---

archive/issue_comments_018578.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI think a solution of the following type would be better.\n\n```\n\ntry:\n        from sage.libs.pari.all import pari\n        RR,a = _setup(prec)\n        b = RR(pari(nu).besselk(z))\n        pari.set_real_precision\n\nexcept TypeError:\n        CC,a = _setup(prec)\n        b = CC(pari(nu).besselk(z))\n        pari.set_real_precision(a)\n```",
    "created_at": "2008-06-17T17:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18578",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:9" align="right">comment:9</div>

I think a solution of the following type would be better.

```

try:
        from sage.libs.pari.all import pari
        RR,a = _setup(prec)
        b = RR(pari(nu).besselk(z))
        pari.set_real_precision

except TypeError:
        CC,a = _setup(prec)
        b = CC(pari(nu).besselk(z))
        pari.set_real_precision(a)
```



---

archive/issue_comments_018579.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nProbably the  correct code would be\n\n ```\n \n try:\n         from sage.libs.pari.all import pari\n         RR,a = _setup(prec)\n         b = RR(pari(nu).besselk(z))\n         pari.set_real_precision\n \n except TypeError:\n         CC,a = _setup_CC(prec)\n         b = CC(pari(nu).besselk(z))\n         pari.set_real_precision(a)\n ```",
    "created_at": "2008-06-17T18:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18579",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:10" align="right">comment:10</div>

Probably the  correct code would be

 ```
 
 try:
         from sage.libs.pari.all import pari
         RR,a = _setup(prec)
         b = RR(pari(nu).besselk(z))
         pari.set_real_precision
 
 except TypeError:
         CC,a = _setup_CC(prec)
         b = CC(pari(nu).besselk(z))
         pari.set_real_precision(a)
 ```



---

archive/issue_events_037207.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-23T09:36:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37207"
}
```



---

archive/issue_events_037208.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-23T09:36:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37208"
}
```



---

archive/issue_comments_018580.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nSince Rishi commented on this it might be a good idea to discuss his comments.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-23T09:36:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18580",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:11" align="right">comment:11</div>

Since Rishi commented on this it might be a good idea to discuss his comments.

Cheers,

Michael



---

archive/issue_comments_018581.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThe try code does not in my opinion work.  The issue here is correcting numerical instabilities, which attempting to coerce into RR will not do.  Positive review still.",
    "created_at": "2008-06-23T15:22:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18581",
    "user": "https://github.com/garyfurnish"
}
```

<div id="comment:12" align="right">comment:12</div>

The try code does not in my opinion work.  The issue here is correcting numerical instabilities, which attempting to coerce into RR will not do.  Positive review still.



---

archive/issue_events_037209.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-23T15:22:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37209"
}
```



---

archive/issue_events_037210.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-23T15:22:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37210"
}
```



---

archive/issue_comments_018582.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI am pretty confident that the try code works. Consider the following gp output. The current patch will try to coerce this to RR. If pari is right then this input after applying the patch will give a TypeError. \n\n```\n? besselk(2,-1.121)\n%1 = 1.234141459629829380224386595 - 0.5472316582663064541169798027*I\n```\n\nWe probably eliminate the double evaluation of bessel function using pari which my current suggestion does.",
    "created_at": "2008-06-23T18:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18582",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:13" align="right">comment:13</div>

I am pretty confident that the try code works. Consider the following gp output. The current patch will try to coerce this to RR. If pari is right then this input after applying the patch will give a TypeError. 

```
? besselk(2,-1.121)
%1 = 1.234141459629829380224386595 - 0.5472316582663064541169798027*I
```

We probably eliminate the double evaluation of bessel function using pari which my current suggestion does.



---

archive/issue_comments_018583.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI don't understand what double evaluation of the bessel function you are talking about.  Furthermore the entire point is that Pari can give wrong answers in some cases because of numerical cases.  Therefore we want to manually correct the numerical noise.  Trying to coerce into RR instead of clearing it completely misses the point.",
    "created_at": "2008-06-23T18:54:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18583",
    "user": "https://github.com/garyfurnish"
}
```

<div id="comment:14" align="right">comment:14</div>

I don't understand what double evaluation of the bessel function you are talking about.  Furthermore the entire point is that Pari can give wrong answers in some cases because of numerical cases.  Therefore we want to manually correct the numerical noise.  Trying to coerce into RR instead of clearing it completely misses the point.



---

archive/issue_comments_018584.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI refuse to believe such a large numerical instabilities. In fact maple gives the same answer as pari. I will investigate further and figure out. You cannot Willy nilly ignore the imaginary part.",
    "created_at": "2008-06-23T19:32:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18584",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:15" align="right">comment:15</div>

I refuse to believe such a large numerical instabilities. In fact maple gives the same answer as pari. I will investigate further and figure out. You cannot Willy nilly ignore the imaginary part.



---

archive/issue_comments_018585.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAnd Mathematica does the same as pari. \n\nI suggested the try: except: statement because it does not require deep understanding of Bessel's K function and probably in the end we might end up with this solution.",
    "created_at": "2008-06-23T19:39:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18585",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:16" align="right">comment:16</div>

And Mathematica does the same as pari. 

I suggested the try: except: statement because it does not require deep understanding of Bessel's K function and probably in the end we might end up with this solution.



---

archive/issue_comments_018586.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe try except statement does not significantly help the original complaint.  Either the identity is true or we should give the patch a negative review and close it as invalid.",
    "created_at": "2008-06-23T20:47:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18586",
    "user": "https://github.com/garyfurnish"
}
```

<div id="comment:17" align="right">comment:17</div>

The try except statement does not significantly help the original complaint.  Either the identity is true or we should give the patch a negative review and close it as invalid.



---

archive/issue_comments_018587.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\n\n```\nbesselk(nu,x,{flag = 0})\n\nK-Bessel function of index nu (which can be complex) and argument x. Only real and positive arguments x are allowed in the present version 2.3.3. If flag is equal to 1, uses another implementation of this function which is faster when x >> 1.\n\nThe library syntax is kbessel(nu,x,prec) and kbessel2(nu,x,prec) respectively.\n```\nTherefore pari gives incorrect answers for your negative x.  Perhaps this is another bug and we should merge this ticket and open another one for adding some error checking to besselk?",
    "created_at": "2008-06-23T20:56:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18587",
    "user": "https://github.com/garyfurnish"
}
```

<div id="comment:18" align="right">comment:18</div>


```
besselk(nu,x,{flag = 0})

K-Bessel function of index nu (which can be complex) and argument x. Only real and positive arguments x are allowed in the present version 2.3.3. If flag is equal to 1, uses another implementation of this function which is faster when x >> 1.

The library syntax is kbessel(nu,x,prec) and kbessel2(nu,x,prec) respectively.
```
Therefore pari gives incorrect answers for your negative x.  Perhaps this is another bug and we should merge this ticket and open another one for adding some error checking to besselk?



---

archive/issue_comments_018588.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe complaint is valid. In fact the current version is lot more broken that the patched version. The current version does not take any complex argument. The patched version only fails on negative real axis.",
    "created_at": "2008-06-23T21:22:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18588",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:19" align="right">comment:19</div>

The complaint is valid. In fact the current version is lot more broken that the patched version. The current version does not take any complex argument. The patched version only fails on negative real axis.



---

archive/issue_comments_018589.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOk lets patch this then and open a new ticket for the negative real axis case.",
    "created_at": "2008-06-23T21:58:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18589",
    "user": "https://github.com/garyfurnish"
}
```

<div id="comment:20" align="right">comment:20</div>

Ok lets patch this then and open a new ticket for the negative real axis case.



---

archive/issue_comments_018590.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI think \n\n```\nif (real(nu) == 0 or imag(nu) == 0) and (imag(z) == 0)\n```\n\nshould become\n\n```\nif (real(nu) == 0 or imag(nu) == 0) and (imag(z) == 0 and real(z) > 0)\n```",
    "created_at": "2008-06-23T22:07:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18590",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:21" align="right">comment:21</div>

I think 

```
if (real(nu) == 0 or imag(nu) == 0) and (imag(z) == 0)
```

should become

```
if (real(nu) == 0 or imag(nu) == 0) and (imag(z) == 0 and real(z) > 0)
```



---

archive/issue_comments_018591.json:
```json
{
    "body": "Following the philosophy that wrong answers are worse than errors, this patch should not go in as is. Probably the code in Rishi's most recent comment is all that is needed for a fix, as long as we're not missing something else. I can't fix this at exactly this moment, but the fix should be trivial. Anyway, even though I posted the original patch, I have to give this a -1.",
    "created_at": "2008-06-24T17:24:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18591",
    "user": "https://github.com/sagetrac-bober"
}
```

Following the philosophy that wrong answers are worse than errors, this patch should not go in as is. Probably the code in Rishi's most recent comment is all that is needed for a fix, as long as we're not missing something else. I can't fix this at exactly this moment, but the fix should be trivial. Anyway, even though I posted the original patch, I have to give this a -1.



---

archive/issue_events_037211.json:
```json
{
    "actor": "https://github.com/sagetrac-bober",
    "created_at": "2008-06-24T17:24:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "title_is": "[with mixed review] bessel_K function is broken",
    "title_was": "bessel_K function is broken",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37211"
}
```



---

archive/issue_comments_018592.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nrishi's code does not prevent brokenness at all (in fact it is 100% equivalent to attempting to trying to return RR(answer, prec).  The patch as is makes the answer \"more correct,\" and then we can go back and write code (that makes use of this patch) to make it 100% correct.  Alternatively, if someone wants to make a new patch that checks for real(z)>=0 in all cases and throws an error otherwise, I would give that a positive review.  However, the modification of real(z)>0 is not sufficient to ensure correctness.",
    "created_at": "2008-06-24T17:48:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18592",
    "user": "https://github.com/garyfurnish"
}
```

<div id="comment:23" align="right">comment:23</div>

rishi's code does not prevent brokenness at all (in fact it is 100% equivalent to attempting to trying to return RR(answer, prec).  The patch as is makes the answer "more correct," and then we can go back and write code (that makes use of this patch) to make it 100% correct.  Alternatively, if someone wants to make a new patch that checks for real(z)>=0 in all cases and throws an error otherwise, I would give that a positive review.  However, the modification of real(z)>0 is not sufficient to ensure correctness.



---

archive/issue_comments_018593.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis ticket has been sitting around for a while without any movement. Change the title so that the reports pick up this ticket correctly.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-01T02:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18593",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:24" align="right">comment:24</div>

This ticket has been sitting around for a while without any movement. Change the title so that the reports pick up this ticket correctly.

Cheers,

Michael



---

archive/issue_events_037212.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-01T02:41:24Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "title_is": "bessel_K function is broken",
    "title_was": "[with mixed review] bessel_K function is broken",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37212"
}
```



---

archive/issue_events_037213.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-01T02:41:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37213"
}
```



---

archive/issue_events_037214.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-01T02:41:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37214"
}
```



---

archive/issue_comments_018594.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI note that Alex added himself to the CC for this.   Whatever is done for this issue absolutely must take into account the work done for #4096, so at the least I suggest that the author of this patch looks at that one and reworks this.  Anything relying on Sage/pari precision questions is likely to be useless otherwise.",
    "created_at": "2008-09-23T11:45:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18594",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:26" align="right">comment:26</div>

I note that Alex added himself to the CC for this.   Whatever is done for this issue absolutely must take into account the work done for #4096, so at the least I suggest that the author of this patch looks at that one and reworks this.  Anything relying on Sage/pari precision questions is likely to be useless otherwise.



---

archive/issue_comments_018595.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI looked up the definition and properties of the Bessel functions in\nseveral references (Section 7.2 of the \"Bateman Manuscript Project\",\nfor instance).\n\nI uploaded a brand new patch that implements the behavior described\nthere, namely returning a real number if the result is theoretically\nknown to be real, and a complex number otherwise.  I added doctests\nthat document this behavior, and checked all of them against\nMathematica.  I did this for all three Bessel functions that are\nimplemented in special.py using Pari, namely J, K, and I.  I also put in a workaround for a silly Pari buglet that\ncomplains about negative integer values of nu.\n\nIn the process I uncovered a couple of unrelated issues with\nspecial.py and Bessel functions, for which I'll open separate tickets.\n\nThe patch is made against 3.1.3.alpha2.",
    "created_at": "2008-10-01T09:46:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18595",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:27" align="right">comment:27</div>

I looked up the definition and properties of the Bessel functions in
several references (Section 7.2 of the "Bateman Manuscript Project",
for instance).

I uploaded a brand new patch that implements the behavior described
there, namely returning a real number if the result is theoretically
known to be real, and a complex number otherwise.  I added doctests
that document this behavior, and checked all of them against
Mathematica.  I did this for all three Bessel functions that are
implemented in special.py using Pari, namely J, K, and I.  I also put in a workaround for a silly Pari buglet that
complains about negative integer values of nu.

In the process I uncovered a couple of unrelated issues with
special.py and Bessel functions, for which I'll open separate tickets.

The patch is made against 3.1.3.alpha2.



---

archive/issue_events_037215.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2008-10-01T09:46:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37215"
}
```



---

archive/issue_events_037216.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2008-10-01T09:46:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37216"
}
```



---

archive/issue_comments_018596.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nUh oh:\n\n```\nsage: bessel_J(0,0)\n---------------------------------------------------------------------------\nPariError                                 Traceback (most recent call last)\n\n/home/drake/.sage/temp/klee/32521/_home_drake__sage_init_sage_0.py in <module>()\n----> 1 \n      2 \n      3 \n      4 \n      5 \n\n/opt/sage-3.1.3.alpha2/local/lib/python2.5/site-packages/sage/functions/special.pyc in bessel_J(nu, z, algorithm, prec)\n    570             z = C(z)\n    571             K = C\n--> 572         pari_bes = pari(nu).besselj(z, precision=prec)\n    573         if K is R:\n    574             return fudge*K(pari_bes.real())\n\n/opt/sage-3.1.3.alpha2/local/lib/python2.5/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:34414)()\n   7865 \n   7866 \n-> 7867 \n   7868 \n   7869 \n\nPariError:  (8)\n```\n\nDoing `bessel_J(0, 0)` in 3.1.2 works fine. I get similar errors with this patch for other Bessel functions, too.",
    "created_at": "2008-10-10T00:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18596",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:28" align="right">comment:28</div>

Uh oh:

```
sage: bessel_J(0,0)
---------------------------------------------------------------------------
PariError                                 Traceback (most recent call last)

/home/drake/.sage/temp/klee/32521/_home_drake__sage_init_sage_0.py in <module>()
----> 1 
      2 
      3 
      4 
      5 

/opt/sage-3.1.3.alpha2/local/lib/python2.5/site-packages/sage/functions/special.pyc in bessel_J(nu, z, algorithm, prec)
    570             z = C(z)
    571             K = C
--> 572         pari_bes = pari(nu).besselj(z, precision=prec)
    573         if K is R:
    574             return fudge*K(pari_bes.real())

/opt/sage-3.1.3.alpha2/local/lib/python2.5/site-packages/sage/libs/pari/gen.so in sage.libs.pari.gen._pari_trap (sage/libs/pari/gen.c:34414)()
   7865 
   7866 
-> 7867 
   7868 
   7869 

PariError:  (8)
```

Doing `bessel_J(0, 0)` in 3.1.2 works fine. I get similar errors with this patch for other Bessel functions, too.



---

archive/issue_comments_018597.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThanks for catching this.  It actually comes from a bug in Pari:\n\n```\n? besselj(0, 0)\n%1 = 1.000000000000000000000000000\n? besselj(0.E-19, 0)\n  *** besselj: gpow: 0 to a non positive exponent.\n```\n\nI've reported it upstream, but I will post  a patch with a workaround while we wait.",
    "created_at": "2008-10-10T01:21:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18597",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:29" align="right">comment:29</div>

Thanks for catching this.  It actually comes from a bug in Pari:

```
? besselj(0, 0)
%1 = 1.000000000000000000000000000
? besselj(0.E-19, 0)
  *** besselj: gpow: 0 to a non positive exponent.
```

I've reported it upstream, but I will post  a patch with a workaround while we wait.



---

archive/issue_comments_018598.json:
```json
{
    "body": "apply instead of the previous patch",
    "created_at": "2008-10-10T12:27:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18598",
    "user": "https://github.com/aghitza"
}
```

apply instead of the previous patch



---

archive/issue_comments_018599.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nAttachment: **[trac3426-fix-bessel-fns.patch.gz](https://github.com/sagemath/sage/files/ticket3426/trac3426-fix-bessel-fns.patch.gz)**\n\nOK, I've replaced my patch with one that fixes the issue reported by Dan.",
    "created_at": "2008-10-10T12:28:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18599",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:30" align="right">comment:30</div>

Attachment: **[trac3426-fix-bessel-fns.patch.gz](https://github.com/sagemath/sage/files/ticket3426/trac3426-fix-bessel-fns.patch.gz)**

OK, I've replaced my patch with one that fixes the issue reported by Dan.



---

archive/issue_comments_018600.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nNow `bessel_J(0,0)` works but I'm seeing other problems. I'm concentrating here on the \"K\" functions since that's what this ticket is about. This is all with the current patch applied to 3.1.4.\n\n* `bessel_K(0, -1)` doesn't work at all; it just soaks up all the CPU and doesn't return. The correct answer is about `0.421024438240708 - 3.97746326050642*I`.\n\n* `bessel_K(-1*I - 1, 0)` gives an uninformative Pari error; the function isn't defined there. Mathematica says \"ComplexInfinity\"; can we give a better error message? Even just \"function not defined at 0\" would be fine.\n\n* `bessel_K(-1, -1)` says it can't convert `-0.601907230197235-1.77549968921218*I` to a real   number, which I agree with. :)  It looks like Pari has the right answer but we're trying to convert it to a real when we shouldn't be.\n\n* `bessel_K(0, -1 - I)` says \"incorrect type\", but Mathematica and Maple evaluate it just fine.",
    "created_at": "2008-10-20T05:57:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18600",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:31" align="right">comment:31</div>

Now `bessel_J(0,0)` works but I'm seeing other problems. I'm concentrating here on the "K" functions since that's what this ticket is about. This is all with the current patch applied to 3.1.4.

* `bessel_K(0, -1)` doesn't work at all; it just soaks up all the CPU and doesn't return. The correct answer is about `0.421024438240708 - 3.97746326050642*I`.

* `bessel_K(-1*I - 1, 0)` gives an uninformative Pari error; the function isn't defined there. Mathematica says "ComplexInfinity"; can we give a better error message? Even just "function not defined at 0" would be fine.

* `bessel_K(-1, -1)` says it can't convert `-0.601907230197235-1.77549968921218*I` to a real   number, which I agree with. :)  It looks like Pari has the right answer but we're trying to convert it to a real when we shouldn't be.

* `bessel_K(0, -1 - I)` says "incorrect type", but Mathematica and Maple evaluate it just fine.



---

archive/issue_events_037217.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2008-11-22T07:44:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37217"
}
```



---

archive/issue_events_037218.json:
```json
{
    "actor": "https://github.com/aghitza",
    "created_at": "2008-11-22T07:44:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37218"
}
```



---

archive/issue_comments_018601.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nSee #4626, which at least fixes the `bessel_J` problem.",
    "created_at": "2009-01-22T18:53:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18601",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:33" align="right">comment:33</div>

See #4626, which at least fixes the `bessel_J` problem.



---

archive/issue_comments_018602.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThis ticket is a huge mess :)\n\nI now think that we should just use mpmath to evaluate Bessel functions, see\n\nhttp://mpmath.googlecode.com/svn/trunk/doc/build/functions/bessel.html\n\nFor the examples that Dan gave:\n\n```\nsage: from mpmath import *\nsage: mp.dps = 25; mp.pretty = True\nsage: besselk(0, -1)\n(0.4210244382407083333356274 - 3.97746326050642263725661j)\nsage: besselk(-1*I - 1, 0)\n+inf\nsage: besselk(-1, -1)\n(-0.60190723019723457473754 - 1.775499689212180946878577j)\nsage: besselk(0, -1-I)\n(-1.479697108749625193260947 + 2.588306443392007370808151j)\n```",
    "created_at": "2010-01-20T07:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18602",
    "user": "https://github.com/aghitza"
}
```

<div id="comment:34" align="right">comment:34</div>

This ticket is a huge mess :)

I now think that we should just use mpmath to evaluate Bessel functions, see

http://mpmath.googlecode.com/svn/trunk/doc/build/functions/bessel.html

For the examples that Dan gave:

```
sage: from mpmath import *
sage: mp.dps = 25; mp.pretty = True
sage: besselk(0, -1)
(0.4210244382407083333356274 - 3.97746326050642263725661j)
sage: besselk(-1*I - 1, 0)
+inf
sage: besselk(-1, -1)
(-0.60190723019723457473754 - 1.775499689212180946878577j)
sage: besselk(0, -1-I)
(-1.479697108749625193260947 + 2.588306443392007370808151j)
```



---

archive/issue_comments_018603.json:
```json
{
    "body": "Changed keywords from **bessel, bessel_K, editor_gfurnish** to **bessel, bessel_K**",
    "created_at": "2010-01-20T07:13:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18603",
    "user": "https://github.com/aghitza"
}
```

Changed keywords from **bessel, bessel_K, editor_gfurnish** to **bessel, bessel_K**



---

archive/issue_comments_018604.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nFrom my quick experiments with the issues Bober was dealing with a year ago, I see that do not arise if we use mpmath, even when I set the precision to 5000.\n\nI agree with Alex Ghitza.\n\n\nI should say that the bessels functions for non integer indices have always bothered me. I believe computing will involve a log, and how do you consistently choose a branch.",
    "created_at": "2010-01-20T21:04:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18604",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:35" align="right">comment:35</div>

From my quick experiments with the issues Bober was dealing with a year ago, I see that do not arise if we use mpmath, even when I set the precision to 5000.

I agree with Alex Ghitza.


I should say that the bessels functions for non integer indices have always bothered me. I believe computing will involve a log, and how do you consistently choose a branch.



---

archive/issue_comments_018605.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI also agree with Alex -- both in that this ticket is a mess, and that we should just use mpmath. I'll see if I can work up a patch (although anyone else who wants to should feel free to do it).",
    "created_at": "2010-01-21T00:41:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18605",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:36" align="right">comment:36</div>

I also agree with Alex -- both in that this ticket is a mess, and that we should just use mpmath. I'll see if I can work up a patch (although anyone else who wants to should feel free to do it).



---

archive/issue_comments_018606.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nWith some experiments, I saw that the branch of the log taken is the negative real axis. We should mention this in the documentation when it is implemented. I believe ddrake is working up a patch.",
    "created_at": "2010-01-22T18:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18606",
    "user": "https://github.com/rishikesha"
}
```

<div id="comment:37" align="right">comment:37</div>

With some experiments, I saw that the branch of the log taken is the negative real axis. We should mention this in the documentation when it is implemented. I believe ddrake is working up a patch.



---

archive/issue_comments_018607.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nHere are some more problems with bessel_K: http://groups.google.com/group/sage-support/browse_thread/thread/84e5cd4fb1381ad5\n\nIn resolving this ticket, we should make sure to have doctests related to those problems!",
    "created_at": "2010-02-18T09:28:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18607",
    "user": "https://github.com/dandrake"
}
```

<div id="comment:39" align="right">comment:39</div>

Here are some more problems with bessel_K: http://groups.google.com/group/sage-support/browse_thread/thread/84e5cd4fb1381ad5

In resolving this ticket, we should make sure to have doctests related to those problems!



---

archive/issue_comments_018608.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThis would most likely be fixed by #4102.",
    "created_at": "2013-01-03T15:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18608",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:41" align="right">comment:41</div>

This would most likely be fixed by #4102.



---

archive/issue_comments_018609.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nYes, it will be fixed by #4102. I'll make a note to add a related doctest to that effect.",
    "created_at": "2013-01-03T23:07:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18609",
    "user": "https://github.com/benjaminfjones"
}
```

<div id="comment:42" align="right">comment:42</div>

Yes, it will be fixed by #4102. I'll make a note to add a related doctest to that effect.



---

archive/issue_comments_018610.json:
```json
{
    "body": "Reviewer: **Karl-Dieter Crisman, Benjamin Jones**",
    "created_at": "2013-02-08T17:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18610",
    "user": "https://github.com/kcrisman"
}
```

Reviewer: **Karl-Dieter Crisman, Benjamin Jones**



---

archive/issue_events_037219.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-02-08T17:34:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37219"
}
```



---

archive/issue_events_037220.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-02-08T17:34:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37220"
}
```



---

archive/issue_events_037221.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-02-08T17:34:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "milestone_number": null,
    "milestone_title": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37221"
}
```



---

archive/issue_events_037222.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-02-08T17:34:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37222"
}
```



---

archive/issue_events_037223.json:
```json
{
    "actor": "https://github.com/kcrisman",
    "created_at": "2013-02-08T17:34:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37223"
}
```



---

archive/issue_comments_018611.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nEverything here is now in a doctest in #4102, including the stuff in the thread from three (!) years ago.",
    "created_at": "2013-02-08T17:34:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3426#issuecomment-18611",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:43" align="right">comment:43</div>

Everything here is now in a doctest in #4102, including the stuff in the thread from three (!) years ago.



---

archive/issue_events_037224.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-17T20:10:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37224"
}
```



---

archive/issue_events_037225.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-17T20:10:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37225"
}
```



---

archive/issue_events_037226.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-02-17T20:10:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3426",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3426#event-37226"
}
```
