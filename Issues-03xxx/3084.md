# Issue 3084: Solve Sudoku faster!

archive/issues_003084.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-cwitty"
    ],
    "body": "I've got a faster Sudoku-solving class than what's currently in Sage.\n\nComponent: **misc**\n\nAuthor: **Rob Beezer, Tom Boothby**\n\nReviewer: **Nick Alexander**\n\nMerged: **sage-4.1.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/3084_\n\n",
    "closed_at": "2009-06-24T10:12:44Z",
    "created_at": "2008-05-02T21:59:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/p%3A%205%20%E2%80%93%20trivial",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Solve Sudoku faster!",
    "type": "issue",
    "updated_at": "2009-06-24T10:12:44Z",
    "url": "https://github.com/sagemath/sage/issues/3084",
    "user": "https://github.com/boothby"
}
```
I've got a faster Sudoku-solving class than what's currently in Sage.

Component: **misc**

Author: **Rob Beezer, Tom Boothby**

Reviewer: **Nick Alexander**

Merged: **sage-4.1.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/3084_





---

archive/issue_events_032885.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "milestone_number": null,
    "milestone_title": "sage-4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32885"
}
```



---

archive/issue_events_032886.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "000080",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32886"
}
```



---

archive/issue_events_032887.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/p%3A%205%20%E2%80%93%20trivial",
    "label_color": "fff9e5",
    "label_name": "p: 5 \u2013 trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32887"
}
```



---

archive/issue_events_032888.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32888"
}
```



---

archive/issue_events_032889.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "subject": "https://github.com/boothby",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32889"
}
```



---

archive/issue_comments_016245.json:
```json
{
    "body": "Attachment: **[sudoku.patch.gz](https://github.com/sagemath/sage/files/ticket3084/sudoku.patch.gz)**",
    "created_at": "2008-05-02T21:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16245",
    "user": "https://github.com/boothby"
}
```

Attachment: **[sudoku.patch.gz](https://github.com/sagemath/sage/files/ticket3084/sudoku.patch.gz)**



---

archive/issue_events_032890.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32890"
}
```



---

archive/issue_events_032891.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32891"
}
```



---

archive/issue_events_032892.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "subject": "https://github.com/boothby",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32892"
}
```



---

archive/issue_events_032893.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "subject": "https://github.com/boothby",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32893"
}
```



---

archive/issue_events_032894.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "000080",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32894"
}
```



---

archive/issue_events_032895.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2008-05-02T22:01:09Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "title_is": "[not ready] Solve Sudoku faster!",
    "title_was": "Solve Sudoku faster!",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32895"
}
```



---

archive/issue_comments_016246.json:
```json
{
    "body": "Apply just this patch",
    "created_at": "2009-06-07T00:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16246",
    "user": "https://github.com/rbeezer"
}
```

Apply just this patch



---

archive/issue_comments_016247.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAttachment: **[trac_3084_sudoku_class.patch.gz](https://github.com/sagemath/sage/files/ticket3084/trac_3084_sudoku_class.patch.gz)**\n\nCurrent patch has a \"sudoku puzzle\" class, with tools for input/output of puzzles and two algorithms for finding solutions, including obtaining multiple solutions.\n\nDLX algorithm by Tom Boothby consistently solves 9x9 hard puzzles at a rate of about 700 per second on modern, but not extravagant, hardware.  Cythonized backtracking algorithm by Rob Beezer is more variable in performance, and can solve some hard puzzles at the rate of 4000 per second, though other problems can take close to a full second.\n\nDLX will work on any size puzzle (array dimensions must be perfect squares), string format works on up to 36x36, backtracking works on up to 16x16 since memory is not allocated dynamically.",
    "created_at": "2009-06-07T00:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16247",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:3" align="right">comment:3</div>

Attachment: **[trac_3084_sudoku_class.patch.gz](https://github.com/sagemath/sage/files/ticket3084/trac_3084_sudoku_class.patch.gz)**

Current patch has a "sudoku puzzle" class, with tools for input/output of puzzles and two algorithms for finding solutions, including obtaining multiple solutions.

DLX algorithm by Tom Boothby consistently solves 9x9 hard puzzles at a rate of about 700 per second on modern, but not extravagant, hardware.  Cythonized backtracking algorithm by Rob Beezer is more variable in performance, and can solve some hard puzzles at the rate of 4000 per second, though other problems can take close to a full second.

DLX will work on any size puzzle (array dimensions must be perfect squares), string format works on up to 36x36, backtracking works on up to 16x16 since memory is not allocated dynamically.



---

archive/issue_comments_016248.json:
```json
{
    "body": "Author: **Rob Beezer, Tom Boothby**",
    "created_at": "2009-06-07T00:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16248",
    "user": "https://github.com/rbeezer"
}
```

Author: **Rob Beezer, Tom Boothby**



---

archive/issue_events_032896.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2009-06-07T00:10:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "title_is": "Solve Sudoku faster!",
    "title_was": "[not ready] Solve Sudoku faster!",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32896"
}
```



---

archive/issue_events_032897.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2009-06-07T00:10:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32897"
}
```



---

archive/issue_comments_016249.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIf the patch results in better performance, there should be (\"good\") code to illustrate this both before and after applying the patch. Such information is good for release tours.",
    "created_at": "2009-06-08T04:12:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16249",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:4" align="right">comment:4</div>

If the patch results in better performance, there should be ("good") code to illustrate this both before and after applying the patch. Such information is good for release tours.



---

archive/issue_comments_016250.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@sagetrac-mvngu](#comment:4):\n> If the patch results in better performance, there should be (\"good\") code to illustrate this both before and after applying the patch. Such information is good for release tours.\n\nMinh,\n\nHere you go.\n\nThanks,\nRob\n\n```\nOriginal doctest example\nA = '5...8..49...5...3..673....115..........2.8..........187....415..3...2...49..5...3'\n\nA 17-hint puzzle (no 16-hint puzzles known)\nB = '....1.9..8..4.....2.........7..3..........2.4.......58.6....13.7..2........8.....'\n\nDifficult for backtracking, Wikipedia's \"worst case\"\nC = '..............3.85..1.2.......5.7.....4...1...9.......5......73..2.1........4...9'\n\nTimings on 3 GHz Intel Core Duo, KUbuntu 8.10\n  4.0.1 = backtracking via recursive calls\n  DLX = Exact Cover, Dancing Links algorithm\n  BackTrack = Cythonized backtracking with propogation\n\n    4.0.1    Patch/DLX  Patch/BT    Factors\nA   34 ms    1.11 ms    187 us      31x, 182x\n\nB   1494 s   1.20 ms    441 ms      1245000x, 3388x\n\nC   4798 s   1.21 ms    944 ms      4000000x, 5000x\n```",
    "created_at": "2009-06-08T06:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16250",
    "user": "https://github.com/rbeezer"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@sagetrac-mvngu](#comment:4):
> If the patch results in better performance, there should be ("good") code to illustrate this both before and after applying the patch. Such information is good for release tours.

Minh,

Here you go.

Thanks,
Rob

```
Original doctest example
A = '5...8..49...5...3..673....115..........2.8..........187....415..3...2...49..5...3'

A 17-hint puzzle (no 16-hint puzzles known)
B = '....1.9..8..4.....2.........7..3..........2.4.......58.6....13.7..2........8.....'

Difficult for backtracking, Wikipedia's "worst case"
C = '..............3.85..1.2.......5.7.....4...1...9.......5......73..2.1........4...9'

Timings on 3 GHz Intel Core Duo, KUbuntu 8.10
  4.0.1 = backtracking via recursive calls
  DLX = Exact Cover, Dancing Links algorithm
  BackTrack = Cythonized backtracking with propogation

    4.0.1    Patch/DLX  Patch/BT    Factors
A   34 ms    1.11 ms    187 us      31x, 182x

B   1494 s   1.20 ms    441 ms      1245000x, 3388x

C   4798 s   1.21 ms    944 ms      4000000x, 5000x
```



---

archive/issue_comments_016251.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThis looks great, albeit with some long lines (in the algorithm description, not doctests).  Apply!\n\nOn sage.math:\n\n```\nsage: %timeit sage.games.sudoku.Sudoku('5...8..49...5...3..673....115..........2.8..........187....415..3...2...49..5...3').solve().next()\n1000 loops, best of 3: 1.37 ms per loop\nsage: %timeit sage.games.sudoku.Sudoku('....1.9..8..4.....2.........7..3..........2.4.......58.6....13.7..2........8.....').solve().next()\n1000 loops, best of 3: 1.48 ms per loop\nsage: %timeit sage.games.sudoku.Sudoku('..............3.85..1.2.......5.7.....4...1...9.......5......73..2.1........4...9').solve().next()1000 loops, best of 3: 1.48 ms per loop\n```",
    "created_at": "2009-06-15T19:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16251",
    "user": "https://github.com/ncalexan"
}
```

<div id="comment:6" align="right">comment:6</div>

This looks great, albeit with some long lines (in the algorithm description, not doctests).  Apply!

On sage.math:

```
sage: %timeit sage.games.sudoku.Sudoku('5...8..49...5...3..673....115..........2.8..........187....415..3...2...49..5...3').solve().next()
1000 loops, best of 3: 1.37 ms per loop
sage: %timeit sage.games.sudoku.Sudoku('....1.9..8..4.....2.........7..3..........2.4.......58.6....13.7..2........8.....').solve().next()
1000 loops, best of 3: 1.48 ms per loop
sage: %timeit sage.games.sudoku.Sudoku('..............3.85..1.2.......5.7.....4...1...9.......5......73..2.1........4...9').solve().next()1000 loops, best of 3: 1.48 ms per loop
```



---

archive/issue_events_032898.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-15T19:45:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32898"
}
```



---

archive/issue_events_032899.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-15T19:45:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32899"
}
```



---

archive/issue_comments_016252.json:
```json
{
    "body": "Reviewer: **Nick Alexander**",
    "created_at": "2009-06-15T19:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16252",
    "user": "https://github.com/ncalexan"
}
```

Reviewer: **Nick Alexander**



---

archive/issue_events_032900.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-24T10:12:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32900"
}
```



---

archive/issue_events_032901.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-24T10:12:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-32901"
}
```



---

archive/issue_comments_016253.json:
```json
{
    "body": "Merged: **sage-4.1.alpha0**",
    "created_at": "2009-06-24T10:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-16253",
    "user": "https://github.com/rlmill"
}
```

Merged: **sage-4.1.alpha0**
