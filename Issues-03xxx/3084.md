# Issue 3084: Solve Sudoku faster!

archive/issues_003084.json:
```json
{
    "assignees": [],
    "body": "I've got a faster Sudoku-solving class than what's currently in Sage.\n\n**Assignee:** cwitty\n\n**Author:** Rob Beezer, Tom Boothby\n\n**Reviewer:** Nick Alexander\n\n**Merged:** sage-4.1.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/3084\n\n",
    "closed_at": "2009-06-24T10:12:44Z",
    "created_at": "2008-05-02T21:59:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20misc",
        "https://github.com/sagemath/sage/labels/trivial",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Solve Sudoku faster!",
    "type": "issue",
    "updated_at": "2009-06-24T10:12:44Z",
    "url": "https://github.com/sagemath/sage/issues/3084",
    "user": "https://github.com/sagetrac-boothby"
}
```
I've got a faster Sudoku-solving class than what's currently in Sage.

**Assignee:** cwitty

**Author:** Rob Beezer, Tom Boothby

**Reviewer:** Nick Alexander

**Merged:** sage-4.1.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/3084





---

archive/issue_events_026474.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "milestone_number": null,
    "milestone_title": "sage-4.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26474"
}
```



---

archive/issue_events_026475.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting%3A%20cygwin",
    "label_color": "08517b",
    "label_name": "component: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26475"
}
```



---

archive/issue_events_026476.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/trivial",
    "label_color": "ff0000",
    "label_name": "trivial",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26476"
}
```



---

archive/issue_events_026477.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T21:59:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26477"
}
```



---

archive/issue_comments_017016.json:
```json
{
    "body": "**Attachment:** [sudoku.patch.gz](https://github.com/sagemath/sage/files/ticket3084/sudoku.patch.gz)",
    "created_at": "2008-05-02T21:59:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17016",
    "user": "https://github.com/sagetrac-boothby"
}
```

**Attachment:** [sudoku.patch.gz](https://github.com/sagemath/sage/files/ticket3084/sudoku.patch.gz)



---

archive/issue_events_026478.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26478"
}
```



---

archive/issue_events_026479.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "008080",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26479"
}
```



---

archive/issue_comments_017017.json:
```json
{
    "body": "**Changing assignee** from mabshoff to cwitty.",
    "created_at": "2008-05-02T22:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17017",
    "user": "https://github.com/sagetrac-boothby"
}
```

**Changing assignee** from mabshoff to cwitty.



---

archive/issue_events_026480.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting%3A%20cygwin",
    "label_color": "08517b",
    "label_name": "component: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26480"
}
```



---

archive/issue_events_026481.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T22:00:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20misc",
    "label_color": "08517b",
    "label_name": "component: misc",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26481"
}
```



---

archive/issue_events_026482.json:
```json
{
    "actor": "https://github.com/sagetrac-boothby",
    "created_at": "2008-05-02T22:01:09Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "rename": {
        "from": "Solve Sudoku faster!",
        "to": "[not ready] Solve Sudoku faster!"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26482"
}
```



---

archive/issue_comments_017018.json:
```json
{
    "body": "Apply just this patch",
    "created_at": "2009-06-07T00:01:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17018",
    "user": "https://github.com/rbeezer"
}
```

Apply just this patch



---

archive/issue_comments_017019.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\n**Attachment:** [trac_3084_sudoku_class.patch.gz](https://github.com/sagemath/sage/files/ticket3084/trac_3084_sudoku_class.patch.gz)\n\nCurrent patch has a \"sudoku puzzle\" class, with tools for input/output of puzzles and two algorithms for finding solutions, including obtaining multiple solutions.\n\nDLX algorithm by Tom Boothby consistently solves 9x9 hard puzzles at a rate of about 700 per second on modern, but not extravagant, hardware.  Cythonized backtracking algorithm by Rob Beezer is more variable in performance, and can solve some hard puzzles at the rate of 4000 per second, though other problems can take close to a full second.\n\nDLX will work on any size puzzle (array dimensions must be perfect squares), string format works on up to 36x36, backtracking works on up to 16x16 since memory is not allocated dynamically.",
    "created_at": "2009-06-07T00:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17019",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:3'>**Comment 3:**</a>
**Attachment:** [trac_3084_sudoku_class.patch.gz](https://github.com/sagemath/sage/files/ticket3084/trac_3084_sudoku_class.patch.gz)

Current patch has a "sudoku puzzle" class, with tools for input/output of puzzles and two algorithms for finding solutions, including obtaining multiple solutions.

DLX algorithm by Tom Boothby consistently solves 9x9 hard puzzles at a rate of about 700 per second on modern, but not extravagant, hardware.  Cythonized backtracking algorithm by Rob Beezer is more variable in performance, and can solve some hard puzzles at the rate of 4000 per second, though other problems can take close to a full second.

DLX will work on any size puzzle (array dimensions must be perfect squares), string format works on up to 36x36, backtracking works on up to 16x16 since memory is not allocated dynamically.



---

archive/issue_comments_017020.json:
```json
{
    "body": "**Author:** Rob Beezer, Tom Boothby",
    "created_at": "2009-06-07T00:10:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17020",
    "user": "https://github.com/rbeezer"
}
```

**Author:** Rob Beezer, Tom Boothby



---

archive/issue_events_026483.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2009-06-07T00:10:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "rename": {
        "from": "[not ready] Solve Sudoku faster!",
        "to": "Solve Sudoku faster!"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26483"
}
```



---

archive/issue_events_026484.json:
```json
{
    "actor": "https://github.com/rbeezer",
    "created_at": "2009-06-07T00:10:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26484"
}
```



---

archive/issue_comments_017021.json:
```json
{
    "body": "<a id='comment:4'>**Comment 4:**</a>\nIf the patch results in better performance, there should be (\"good\") code to illustrate this both before and after applying the patch. Such information is good for release tours.",
    "created_at": "2009-06-08T04:12:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17021",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<a id='comment:4'>**Comment 4:**</a>
If the patch results in better performance, there should be ("good") code to illustrate this both before and after applying the patch. Such information is good for release tours.



---

archive/issue_comments_017022.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nReplying to [mvngu](#comment%3A4):\n> If the patch results in better performance, there should be (\"good\") code to illustrate this both before and after applying the patch. Such information is good for release tours.\n\nMinh,\n\nHere you go.\n\nThanks,\nRob\n\n```\nOriginal doctest example\nA = '5...8..49...5...3..673....115..........2.8..........187....415..3...2...49..5...3'\n\nA 17-hint puzzle (no 16-hint puzzles known)\nB = '....1.9..8..4.....2.........7..3..........2.4.......58.6....13.7..2........8.....'\n\nDifficult for backtracking, Wikipedia's \"worst case\"\nC = '..............3.85..1.2.......5.7.....4...1...9.......5......73..2.1........4...9'\n\nTimings on 3 GHz Intel Core Duo, KUbuntu 8.10\n  4.0.1 = backtracking via recursive calls\n  DLX = Exact Cover, Dancing Links algorithm\n  BackTrack = Cythonized backtracking with propogation\n\n    4.0.1    Patch/DLX  Patch/BT    Factors\nA   34 ms    1.11 ms    187 us      31x, 182x\n\nB   1494 s   1.20 ms    441 ms      1245000x, 3388x\n\nC   4798 s   1.21 ms    944 ms      4000000x, 5000x\n```",
    "created_at": "2009-06-08T06:52:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17022",
    "user": "https://github.com/rbeezer"
}
```

<a id='comment:5'>**Comment 5:**</a>
Replying to [mvngu](#comment%3A4):
> If the patch results in better performance, there should be ("good") code to illustrate this both before and after applying the patch. Such information is good for release tours.

Minh,

Here you go.

Thanks,
Rob

```
Original doctest example
A = '5...8..49...5...3..673....115..........2.8..........187....415..3...2...49..5...3'

A 17-hint puzzle (no 16-hint puzzles known)
B = '....1.9..8..4.....2.........7..3..........2.4.......58.6....13.7..2........8.....'

Difficult for backtracking, Wikipedia's "worst case"
C = '..............3.85..1.2.......5.7.....4...1...9.......5......73..2.1........4...9'

Timings on 3 GHz Intel Core Duo, KUbuntu 8.10
  4.0.1 = backtracking via recursive calls
  DLX = Exact Cover, Dancing Links algorithm
  BackTrack = Cythonized backtracking with propogation

    4.0.1    Patch/DLX  Patch/BT    Factors
A   34 ms    1.11 ms    187 us      31x, 182x

B   1494 s   1.20 ms    441 ms      1245000x, 3388x

C   4798 s   1.21 ms    944 ms      4000000x, 5000x
```



---

archive/issue_comments_017023.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nThis looks great, albeit with some long lines (in the algorithm description, not doctests).  Apply!\n\nOn sage.math:\n\n```\nsage: %timeit sage.games.sudoku.Sudoku('5...8..49...5...3..673....115..........2.8..........187....415..3...2...49..5...3').solve().next()\n1000 loops, best of 3: 1.37 ms per loop\nsage: %timeit sage.games.sudoku.Sudoku('....1.9..8..4.....2.........7..3..........2.4.......58.6....13.7..2........8.....').solve().next()\n1000 loops, best of 3: 1.48 ms per loop\nsage: %timeit sage.games.sudoku.Sudoku('..............3.85..1.2.......5.7.....4...1...9.......5......73..2.1........4...9').solve().next()1000 loops, best of 3: 1.48 ms per loop\n```",
    "created_at": "2009-06-15T19:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17023",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:6'>**Comment 6:**</a>
This looks great, albeit with some long lines (in the algorithm description, not doctests).  Apply!

On sage.math:

```
sage: %timeit sage.games.sudoku.Sudoku('5...8..49...5...3..673....115..........2.8..........187....415..3...2...49..5...3').solve().next()
1000 loops, best of 3: 1.37 ms per loop
sage: %timeit sage.games.sudoku.Sudoku('....1.9..8..4.....2.........7..3..........2.4.......58.6....13.7..2........8.....').solve().next()
1000 loops, best of 3: 1.48 ms per loop
sage: %timeit sage.games.sudoku.Sudoku('..............3.85..1.2.......5.7.....4...1...9.......5......73..2.1........4...9').solve().next()1000 loops, best of 3: 1.48 ms per loop
```



---

archive/issue_events_026485.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-15T19:45:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26485"
}
```



---

archive/issue_events_026486.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2009-06-15T19:45:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26486"
}
```



---

archive/issue_comments_017024.json:
```json
{
    "body": "**Reviewer:** Nick Alexander",
    "created_at": "2009-06-15T19:45:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17024",
    "user": "https://github.com/ncalexan"
}
```

**Reviewer:** Nick Alexander



---

archive/issue_events_026487.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-24T10:12:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26487"
}
```



---

archive/issue_events_026488.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2009-06-24T10:12:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3084#event-26488"
}
```



---

archive/issue_comments_017025.json:
```json
{
    "body": "**Merged:** sage-4.1.alpha0",
    "created_at": "2009-06-24T10:12:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3084#issuecomment-17025",
    "user": "https://github.com/rlmill"
}
```

**Merged:** sage-4.1.alpha0
