# Issue 3130: [with patch, with positive review, rebased to 3.0.3.a1] permgps: added normal_subgroups and fixed image and kernel

archive/issues_003130.json:
```json
{
    "body": "Why SAGE doesn't support the computation of normal subgroups has been raised on sage-support. I needed it myself for a research problem so, added it. While constructing an example for the docstring, it dawned on me that image and kernel still only return a string. William Stein and David Kohel suggested that be fixed, maybe 2 years ago now, so I added that. While doctesting, I discovered that derived_series and friends is a random computation. (Very odd that a docstring failure hasn't been triggered until now.) Anyway, some \"# random\" comments were added to fix that.\nFinally, I rearranged the PermutationGroup class methods in a more alphabetical order for easier reading.\n\nPasses sage -testall. The diff file is huge but only because of the reordering of the methods. Really, it is a fairly simple pach.\n\n\nAssignee: joyner\n\nCC:  cwitty\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/3130\n\n",
    "closed_at": "2008-06-09T06:19:34Z",
    "created_at": "2008-05-08T03:57:46Z",
    "labels": [
        "component: group theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.0.3",
    "title": "[with patch, with positive review, rebased to 3.0.3.a1] permgps: added normal_subgroups and fixed image and kernel",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/3130",
    "user": "https://github.com/wdjoyner"
}
```
Why SAGE doesn't support the computation of normal subgroups has been raised on sage-support. I needed it myself for a research problem so, added it. While constructing an example for the docstring, it dawned on me that image and kernel still only return a string. William Stein and David Kohel suggested that be fixed, maybe 2 years ago now, so I added that. While doctesting, I discovered that derived_series and friends is a random computation. (Very odd that a docstring failure hasn't been triggered until now.) Anyway, some "# random" comments were added to fix that.
Finally, I rearranged the PermutationGroup class methods in a more alphabetical order for easier reading.

Passes sage -testall. The diff file is huge but only because of the reordering of the methods. Really, it is a fairly simple pach.


Assignee: joyner

CC:  cwitty

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/3130





---

archive/issue_comments_023393.json:
```json
{
    "body": "Attachment [9670.patch](tarball://root/attachments/some-uuid/ticket3130/9670.patch) by @wdjoyner created at 2008-05-08 03:58:37\n\npermgp.py+permgp_morphism.py patch based on 3.0.1",
    "created_at": "2008-05-08T03:58:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23393",
    "user": "https://github.com/wdjoyner"
}
```

Attachment [9670.patch](tarball://root/attachments/some-uuid/ticket3130/9670.patch) by @wdjoyner created at 2008-05-08 03:58:37

permgp.py+permgp_morphism.py patch based on 3.0.1



---

archive/issue_comments_023394.json:
```json
{
    "body": "<a id='comment:2'></a>This is not a review but I can review this patch. Here are a few preliminary comments.\n\nThe effect of the patch is obscured by the fact that the methods in PermutationGroup_generic have been reordered. The new order first places methods whose names start with underscore at the top, and then begins alphabetical order. However the alphabetical order breaks down after quotient_group. I get the impression that alphabetization of the methods was started but not completed. There are merits to alphabetical ordering of the methods but there are also disadvantages. For example, largest_moved_point and smallest_moved_point are no longer adjacent.\n\nThe patch affects (favorably) the examples at the head of permgroup_morphism.py. Many of the methods in this short file have no docstring and no doctests. It might be good to take this opportunity to add docstrings and doctests to these methods.\n\nThe patch addresses finding normal subgroups of a permutation group by adding a new method.\nThis might be an occasion to address a problem with the normalizer method. One is more\nlikely to want the normalizer of a subgroup than of an element. Currently the latter is implemented and the former not. See:\n\nhttp://groups.google.com/group/sage-devel/browse_thread/thread/a62aa2fc980375c3/e405621898a4f8d3?hl=en&lnk=gst&q=normalizer#e405621898a4f8d3\n\nThe normalizer_method should first test whether the parameter g is an element or itself a group. For example:\n\n```\n    def normalizer(self,g):\n        \"\"\"\n        Returns the normalizer of g in self.\n\n        EXAMPLES:\n            sage: G = PermutationGroup([[(1,2),(3,4)], [(1,2,3,4)]])\n            sage: g = G.random_element(); g\n            (1,3)\n            sage: G.normalizer(g)\n            Group( [ (1,3), (2,4) ] )\n            sage: g = G([(1,2,3,4)])\n            sage: G.normalizer(g)\n            Group( [ (1,2,3,4), (1,3)(2,4), (2,4) ] )\n\n        \"\"\"\n        if g in self:\n            N = self._gap_().Normalizer(str(g))\n        else:\n            N = self._gap_().Normalizer(gap(g).name()) \n        return N\n```\n\nI will review the patch within the next few days but in the meantime I'm offering these preliminary comments.",
    "created_at": "2008-05-29T16:04:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23394",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:2'></a>This is not a review but I can review this patch. Here are a few preliminary comments.

The effect of the patch is obscured by the fact that the methods in PermutationGroup_generic have been reordered. The new order first places methods whose names start with underscore at the top, and then begins alphabetical order. However the alphabetical order breaks down after quotient_group. I get the impression that alphabetization of the methods was started but not completed. There are merits to alphabetical ordering of the methods but there are also disadvantages. For example, largest_moved_point and smallest_moved_point are no longer adjacent.

The patch affects (favorably) the examples at the head of permgroup_morphism.py. Many of the methods in this short file have no docstring and no doctests. It might be good to take this opportunity to add docstrings and doctests to these methods.

The patch addresses finding normal subgroups of a permutation group by adding a new method.
This might be an occasion to address a problem with the normalizer method. One is more
likely to want the normalizer of a subgroup than of an element. Currently the latter is implemented and the former not. See:

http://groups.google.com/group/sage-devel/browse_thread/thread/a62aa2fc980375c3/e405621898a4f8d3?hl=en&lnk=gst&q=normalizer#e405621898a4f8d3

The normalizer_method should first test whether the parameter g is an element or itself a group. For example:

```
    def normalizer(self,g):
        """
        Returns the normalizer of g in self.

        EXAMPLES:
            sage: G = PermutationGroup([[(1,2),(3,4)], [(1,2,3,4)]])
            sage: g = G.random_element(); g
            (1,3)
            sage: G.normalizer(g)
            Group( [ (1,3), (2,4) ] )
            sage: g = G([(1,2,3,4)])
            sage: G.normalizer(g)
            Group( [ (1,2,3,4), (1,3)(2,4), (2,4) ] )

        """
        if g in self:
            N = self._gap_().Normalizer(str(g))
        else:
            N = self._gap_().Normalizer(gap(g).name()) 
        return N
```

I will review the patch within the next few days but in the meantime I'm offering these preliminary comments.



---

archive/issue_comments_023395.json:
```json
{
    "body": "<a id='comment:3'></a>I agree with everything said. I'm not looking forward to having to rebase this, but hopefully I can do that and fix whatever problems Dan finds at the same time.",
    "created_at": "2008-05-29T16:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23395",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:3'></a>I agree with everything said. I'm not looking forward to having to rebase this, but hopefully I can do that and fix whatever problems Dan finds at the same time.



---

archive/issue_comments_023396.json:
```json
{
    "body": "Attachment [9670-factored-a.patch](tarball://root/attachments/some-uuid/ticket3130/9670-factored-a.patch) by @dwbump created at 2008-05-29 20:32:43",
    "created_at": "2008-05-29T20:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23396",
    "user": "https://github.com/dwbump"
}
```

Attachment [9670-factored-a.patch](tarball://root/attachments/some-uuid/ticket3130/9670-factored-a.patch) by @dwbump created at 2008-05-29 20:32:43



---

archive/issue_comments_023397.json:
```json
{
    "body": "Attachment [9670-factored-b.patch](tarball://root/attachments/some-uuid/ticket3130/9670-factored-b.patch) by @dwbump created at 2008-05-29 20:33:19",
    "created_at": "2008-05-29T20:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23397",
    "user": "https://github.com/dwbump"
}
```

Attachment [9670-factored-b.patch](tarball://root/attachments/some-uuid/ticket3130/9670-factored-b.patch) by @dwbump created at 2008-05-29 20:33:19



---

archive/issue_comments_023398.json:
```json
{
    "body": "<a id='comment:4'></a>I uploaded two patches called 9670-factored-a.patch and 9670-factored-b.patch.\n\nThe union of these two patches is exactly David's patch 9670.patch.\n\nThe first patch 9670-factored-a.patch only reorders the methods of PermutationGroup_generic\ninto exactly the order of David's patch (except omitting the new method normal_subgroups).\nIt is guaranteed to have no effect, because no code is changed aside from this reordering.\n\nThe second patch goes on top. Importing these two patches is equivalent to David's patch.\n\nThe purpose of this exercise is to show exactly what David's patch does. The second patch\n9670-factored-b.patch shows the changed and new code.",
    "created_at": "2008-05-29T20:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23398",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:4'></a>I uploaded two patches called 9670-factored-a.patch and 9670-factored-b.patch.

The union of these two patches is exactly David's patch 9670.patch.

The first patch 9670-factored-a.patch only reorders the methods of PermutationGroup_generic
into exactly the order of David's patch (except omitting the new method normal_subgroups).
It is guaranteed to have no effect, because no code is changed aside from this reordering.

The second patch goes on top. Importing these two patches is equivalent to David's patch.

The purpose of this exercise is to show exactly what David's patch does. The second patch
9670-factored-b.patch shows the changed and new code.



---

archive/issue_comments_023399.json:
```json
{
    "body": "<a id='comment:5'></a>I just want to add that this applies cleanly to 3.0.2 and 3.0.3.alpha0 (thanks Dan!) and passes sage -testall on sage 3.0.2. I am currently testing it on 3.0.3.alpha0. If it passes (and I assume it will) then I'll add the functionality to normalizer suggested by Dan above and posta new patch based on 3.0.3.alpha0.",
    "created_at": "2008-05-29T23:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23399",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:5'></a>I just want to add that this applies cleanly to 3.0.2 and 3.0.3.alpha0 (thanks Dan!) and passes sage -testall on sage 3.0.2. I am currently testing it on 3.0.3.alpha0. If it passes (and I assume it will) then I'll add the functionality to normalizer suggested by Dan above and posta new patch based on 3.0.3.alpha0.



---

archive/issue_comments_023400.json:
```json
{
    "body": "<a id='comment:6'></a>If you are revising the patch, how about adding docstrings and tests in permgrp_morphism.py?\n\nDan",
    "created_at": "2008-05-30T02:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23400",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:6'></a>If you are revising the patch, how about adding docstrings and tests in permgrp_morphism.py?

Dan



---

archive/issue_comments_023401.json:
```json
{
    "body": "Attachment [9792.patch](tarball://root/attachments/some-uuid/ticket3130/9792.patch) by @wdjoyner created at 2008-05-30 03:41:48\n\npatch based on 3.0.3.alpha0",
    "created_at": "2008-05-30T03:41:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23401",
    "user": "https://github.com/wdjoyner"
}
```

Attachment [9792.patch](tarball://root/attachments/some-uuid/ticket3130/9792.patch) by @wdjoyner created at 2008-05-30 03:41:48

patch based on 3.0.3.alpha0



---

archive/issue_comments_023402.json:
```json
{
    "body": "<a id='comment:7'></a>I modified normalizer almost as suggested about (the version above returned a GAP Group; the one in the latext patch returns a SAGE PermutationGroup). Also, I straightened out the organization to the methods are now really in alphabetical order.\n\nPasses sage -testall.\n\nI don't think I should review this but if you twist my arm, I'll give it a positive review:-)",
    "created_at": "2008-05-30T03:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23402",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:7'></a>I modified normalizer almost as suggested about (the version above returned a GAP Group; the one in the latext patch returns a SAGE PermutationGroup). Also, I straightened out the organization to the methods are now really in alphabetical order.

Passes sage -testall.

I don't think I should review this but if you twist my arm, I'll give it a positive review:-)



---

archive/issue_comments_023403.json:
```json
{
    "body": "<a id='comment:8'></a>I'll review it. (Maybe not until tomorrow.)",
    "created_at": "2008-05-30T14:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23403",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:8'></a>I'll review it. (Maybe not until tomorrow.)



---

archive/issue_comments_023404.json:
```json
{
    "body": "<a id='comment:9'></a>The contents of the patch are as follows.\n\n(1) Methods of PermutationGroup_generic are alphabetized.\n\n(2) A comment on the Suzuki and Ree groups was moved to the file\npermgroup_named.py, where it properly belongs.\n\n(3) Certain tests are commented # random output.\n\n(4) A method normal_subgroup() of PermutationGroup_generic is added.\n\n(5) The method normalizer() of PermutationGroup_generic is enhanced.\nPreviously only the normalizer of an element was implemented; now\nyou can get the normalizer of a subgroup.\n\n(5) In permgroup_morphism.py PermutationGroupMorphism_im_gens gets\ncorrect kernel and image methods.\n\nI have looked at the patch carefully and tested it and found it good.\nI recommend merging it. Merge 9670.patch and 9792.patch.",
    "created_at": "2008-05-30T19:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23404",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:9'></a>The contents of the patch are as follows.

(1) Methods of PermutationGroup_generic are alphabetized.

(2) A comment on the Suzuki and Ree groups was moved to the file
permgroup_named.py, where it properly belongs.

(3) Certain tests are commented # random output.

(4) A method normal_subgroup() of PermutationGroup_generic is added.

(5) The method normalizer() of PermutationGroup_generic is enhanced.
Previously only the normalizer of an element was implemented; now
you can get the normalizer of a subgroup.

(5) In permgroup_morphism.py PermutationGroupMorphism_im_gens gets
correct kernel and image methods.

I have looked at the patch carefully and tested it and found it good.
I recommend merging it. Merge 9670.patch and 9792.patch.



---

archive/issue_comments_023405.json:
```json
{
    "body": "<a id='comment:10'></a>I am concerned about the added #random to doctests. Since we see GAP's random seed these doctests should be reproducible and it should be unneeded. I am CCing cwitty on the ticket - he might have some explanation or might know where the bug lurks [in case these is one].\n\nCheers,\n\nMichael",
    "created_at": "2008-05-31T06:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23405",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:10'></a>I am concerned about the added #random to doctests. Since we see GAP's random seed these doctests should be reproducible and it should be unneeded. I am CCing cwitty on the ticket - he might have some explanation or might know where the bug lurks [in case these is one].

Cheers,

Michael



---

archive/issue_comments_023406.json:
```json
{
    "body": "<a id='comment:11'></a>I'm not sure what Michael's comment means. I just have the following observation to report which might be relevant. Consider for example the \"random output\" comment in:\n\n```\n    def composition_series(self):\n        \"\"\"\n        Return the composition series of this group as a list of\n        permutation groups.\n\n        EXAMPLES:\n        These computations use pseudo-random numbers, so we set the\n        seed for reproducible testing.\n            sage: set_random_seed(0)\n            sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])\n            sage: G.composition_series()    # random output\n            [Permutation Group with generators [(1,2,3)(4,5), (3,4)],\n             Permutation Group with generators [(1,5)(3,4), (1,5)(2,3), (1,5,4)],\n             Permutation Group with generators [()]]\n```\nThe output of the block\n\n```\nsage: set_random_seed(0)\nsage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])\nsage: G.composition_series()  \n```\nis, when entered repeatedly,  not constant. However, once you enter the first 2 lines and then \n\n```\nsage: G.composition_series()  \n```\nrepeatedly, the answer is always the same.\n\nIt seems to me that \"# random output\" is to help the *reader* of the code recognize that their output might be different than the output given in the docstring. If that is the case, then for readability, it seems that some sort of comment on the random nature of the output should stay in the documentation somewhere. Does this seem reasonable?",
    "created_at": "2008-05-31T11:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23406",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:11'></a>I'm not sure what Michael's comment means. I just have the following observation to report which might be relevant. Consider for example the "random output" comment in:

```
    def composition_series(self):
        """
        Return the composition series of this group as a list of
        permutation groups.

        EXAMPLES:
        These computations use pseudo-random numbers, so we set the
        seed for reproducible testing.
            sage: set_random_seed(0)
            sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])
            sage: G.composition_series()    # random output
            [Permutation Group with generators [(1,2,3)(4,5), (3,4)],
             Permutation Group with generators [(1,5)(3,4), (1,5)(2,3), (1,5,4)],
             Permutation Group with generators [()]]
```
The output of the block

```
sage: set_random_seed(0)
sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])
sage: G.composition_series()  
```
is, when entered repeatedly,  not constant. However, once you enter the first 2 lines and then 

```
sage: G.composition_series()  
```
repeatedly, the answer is always the same.

It seems to me that "# random output" is to help the *reader* of the code recognize that their output might be different than the output given in the docstring. If that is the case, then for readability, it seems that some sort of comment on the random nature of the output should stay in the documentation somewhere. Does this seem reasonable?



---

archive/issue_comments_023407.json:
```json
{
    "body": "<a id='comment:12'></a>1. I think the fact that one sets the random seed in the doctest should be indication enough to the reader.\n\n2. There is absolutely no reason the composition series is random.  Why not return it in a deterministic order?",
    "created_at": "2008-05-31T13:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23407",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'></a>1. I think the fact that one sets the random seed in the doctest should be indication enough to the reader.

2. There is absolutely no reason the composition series is random.  Why not return it in a deterministic order?



---

archive/issue_comments_023408.json:
```json
{
    "body": "<a id='comment:13'></a>\n```\n2. There is absolutely no reason the composition series is random. Why not return it in a deterministic order? \n```\nThe order is not the issue.. The generators are randomly determined.",
    "created_at": "2008-05-31T13:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23408",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:13'></a>
```
2. There is absolutely no reason the composition series is random. Why not return it in a deterministic order? 
```
The order is not the issue.. The generators are randomly determined.



---

archive/issue_comments_023409.json:
```json
{
    "body": "<a id='comment:14'></a>In any case, I am confused as to what to do. Do I wait for cwitty to comment, or just remove the \"# random output\" lines in the cases when the random seed is set (then post a new patch), or ... ?",
    "created_at": "2008-05-31T19:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23409",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:14'></a>In any case, I am confused as to what to do. Do I wait for cwitty to comment, or just remove the "# random output" lines in the cases when the random seed is set (then post a new patch), or ... ?



---

archive/issue_comments_023410.json:
```json
{
    "body": "<a id='comment:15'></a>Any function that calls a GAP function that uses random numbers should set the GAP random number seed, as explained in the following excerpt from randstate.pyx:\n\n```\n\\item[GAP] If you are calling code in GAP that uses random numbers,\ncall \\method{set_seed_gap} at the beginning of your function, like this:\n\\begin{verbatim}\nfrom sage.misc.randstate import current_randstate\n...\n\n    current_randstate().set_seed_gap()\n\\end{verbatim}\n\nFetch the current \\class{randstate} with \\code{current_randstate()} in \nevery function that wants to use it; don't cache it globally or \nin a class.  (Such caching would break \\method{set_random_seed}).\n```\n\nYou can see several uses of this idiom in permgroup.py.",
    "created_at": "2008-05-31T20:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23410",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:15'></a>Any function that calls a GAP function that uses random numbers should set the GAP random number seed, as explained in the following excerpt from randstate.pyx:

```
\item[GAP] If you are calling code in GAP that uses random numbers,
call \method{set_seed_gap} at the beginning of your function, like this:
\begin{verbatim}
from sage.misc.randstate import current_randstate
...

    current_randstate().set_seed_gap()
\end{verbatim}

Fetch the current \class{randstate} with \code{current_randstate()} in 
every function that wants to use it; don't cache it globally or 
in a class.  (Such caching would break \method{set_random_seed}).
```

You can see several uses of this idiom in permgroup.py.



---

archive/issue_comments_023411.json:
```json
{
    "body": "<a id='comment:16'></a>Okay, but it isn't clear to me that GAP is calling GAP's random numbers. \nIn http://www.gap-system.org/Manuals/doc/htm/ref/CHAP028.htm#SSEC006.2\nit's stated that\n\n\"The method used by GAP to obtain random elements may depend on the type object.\"\n\nIs it true that the random method used to obtain generators of the terms in the CompositionSeries (and DerivedSeries, and friends) depends on the same seed used to generate random numbers? If this is not known, then I don't see why one uses the randstate.pyx function in permgroup.py. \n\nIn any case, I am still unsure if I am supposed to submit a new patch or not.",
    "created_at": "2008-06-02T01:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23411",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:16'></a>Okay, but it isn't clear to me that GAP is calling GAP's random numbers. 
In http://www.gap-system.org/Manuals/doc/htm/ref/CHAP028.htm#SSEC006.2
it's stated that

"The method used by GAP to obtain random elements may depend on the type object."

Is it true that the random method used to obtain generators of the terms in the CompositionSeries (and DerivedSeries, and friends) depends on the same seed used to generate random numbers? If this is not known, then I don't see why one uses the randstate.pyx function in permgroup.py. 

In any case, I am still unsure if I am supposed to submit a new patch or not.



---

archive/issue_comments_023412.json:
```json
{
    "body": "<a id='comment:17'></a>\"Is it true that the random method ... depends on the same seed used to generate random numbers?\"\n\nI think it's very likely to be true (for practical purposes, there seems to be a single global random number generator in GAP).  Did you check that the \"# random\" cases you added were actually random (that is, that they gave different answers on different doctest runs)?  With our current approach to doctesting pseudo-random numbers, slight modifications to the code could easily result in changing the results of the doctests to a new, consistent value.\n\nI think it's worth removing as many \"# random\" from the Sage doctests as possible (which is why I bothered to write randstate.pyx), but I don't think there's any formal policy forbidding new \"# random\" doctests (even if they are easily fixable).",
    "created_at": "2008-06-02T17:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23412",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:17'></a>"Is it true that the random method ... depends on the same seed used to generate random numbers?"

I think it's very likely to be true (for practical purposes, there seems to be a single global random number generator in GAP).  Did you check that the "# random" cases you added were actually random (that is, that they gave different answers on different doctest runs)?  With our current approach to doctesting pseudo-random numbers, slight modifications to the code could easily result in changing the results of the doctests to a new, consistent value.

I think it's worth removing as many "# random" from the Sage doctests as possible (which is why I bothered to write randstate.pyx), but I don't think there's any formal policy forbidding new "# random" doctests (even if they are easily fixable).



---

archive/issue_comments_023413.json:
```json
{
    "body": "<a id='comment:18'></a>Forgive my questions but I'm still confused. You asked\n\n\"Did you check that the \"# random\" cases you added were actually random (that is, that they gave different answers on different doctest runs)?\"\n\nI'm not sure if this answers your question but here are two consecutive runs which set the seed and give different answers. Is that what you mean?\n\n```\nsage: set_random_seed(0)\nsage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])\nsage: G.composition_series()\n\n[Permutation Group with generators [(1,2,3)(4,5), (3,4)],\n Permutation Group with generators [(1,5)(3,4), (1,5)(2,3), (1,5,4)],\n Permutation Group with generators [()]]\nsage: set_random_seed(0)\nsage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])\nsage: G.composition_series()\n\n[Permutation Group with generators [(1,2,3)(4,5), (3,4)],\n Permutation Group with generators [(1,5)(3,4), (1,5)(2,4), (2,4)(3,5)],\n Permutation Group with generators [()]]\n```",
    "created_at": "2008-06-02T21:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23413",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:18'></a>Forgive my questions but I'm still confused. You asked

"Did you check that the "# random" cases you added were actually random (that is, that they gave different answers on different doctest runs)?"

I'm not sure if this answers your question but here are two consecutive runs which set the seed and give different answers. Is that what you mean?

```
sage: set_random_seed(0)
sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])
sage: G.composition_series()

[Permutation Group with generators [(1,2,3)(4,5), (3,4)],
 Permutation Group with generators [(1,5)(3,4), (1,5)(2,3), (1,5,4)],
 Permutation Group with generators [()]]
sage: set_random_seed(0)
sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])
sage: G.composition_series()

[Permutation Group with generators [(1,2,3)(4,5), (3,4)],
 Permutation Group with generators [(1,5)(3,4), (1,5)(2,4), (2,4)(3,5)],
 Permutation Group with generators [()]]
```



---

archive/issue_comments_023414.json:
```json
{
    "body": "<a id='comment:19'></a>OK, this seems to be a general problem with randstate; I can reproduce similar problems in Sage 3.0.2.  I'm going to open a new ticket for the randstate bug; since the randstate issues have nothing to do with this patch, I'm going to reinstate bump's positive review.",
    "created_at": "2008-06-04T16:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23414",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:19'></a>OK, this seems to be a general problem with randstate; I can reproduce similar problems in Sage 3.0.2.  I'm going to open a new ticket for the randstate bug; since the randstate issues have nothing to do with this patch, I'm going to reinstate bump's positive review.



---

archive/issue_comments_023415.json:
```json
{
    "body": "<a id='comment:20'></a>(See #3364 for the new randstate ticket.)",
    "created_at": "2008-06-04T16:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23415",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:20'></a>(See #3364 for the new randstate ticket.)



---

archive/issue_comments_023416.json:
```json
{
    "body": "<a id='comment:21'></a>9670.patch no longer merges cleanly because of the following hunk:\n\n```\n@@ -402,21 +372,6 @@ class PermutationGroup_generic(group.Fin\n                 return PermutationGroupElement(x._gap_(), self, check = False)\n         raise TypeError, \"no implicit coercion of element into permutation group\"\n\n-    def list(self):\n-        \"\"\"\n-        Return list of all elements of this group.\n-\n-        EXAMPLES:\n-            sage: G = PermutationGroup([[(1,2,3,4)], [(1,2)]])\n-            sage: G.list()\n-            [(), (3,4), (2,3), (2,3,4), (2,4,3), (2,4), (1,2), (1,2)(3,4), (1,2,3), (1,2,3,4), (1,2,4,3), (1,2,4), (1,3,2), (1,3,4,2), (1,3), (1,3,4), (1,3)(2,4), (1,3,2,4), (1,4,3,2), (1,4,2), (1,4,3), (1,4), (1,4,2,3), (1,4)(2,3)]\n-        \"\"\"\n-        from sage.groups.perm_gps.permgroup_element import PermutationGroupElement\n-        X = self._gap_().Elements()\n-        n = X.Length()\n-        return [PermutationGroupElement(X[i], self, check = False)\n-                            for i in range(1,n+1)]\n-\n```\nThis is because of the fixes by William at #3353. This patch will need to be rebased against 3.0.3.alpha1 once it is out.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-04T21:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23416",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:21'></a>9670.patch no longer merges cleanly because of the following hunk:

```
@@ -402,21 +372,6 @@ class PermutationGroup_generic(group.Fin
                 return PermutationGroupElement(x._gap_(), self, check = False)
         raise TypeError, "no implicit coercion of element into permutation group"

-    def list(self):
-        """
-        Return list of all elements of this group.
-
-        EXAMPLES:
-            sage: G = PermutationGroup([[(1,2,3,4)], [(1,2)]])
-            sage: G.list()
-            [(), (3,4), (2,3), (2,3,4), (2,4,3), (2,4), (1,2), (1,2)(3,4), (1,2,3), (1,2,3,4), (1,2,4,3), (1,2,4), (1,3,2), (1,3,4,2), (1,3), (1,3,4), (1,3)(2,4), (1,3,2,4), (1,4,3,2), (1,4,2), (1,4,3), (1,4), (1,4,2,3), (1,4)(2,3)]
-        """
-        from sage.groups.perm_gps.permgroup_element import PermutationGroupElement
-        X = self._gap_().Elements()
-        n = X.Length()
-        return [PermutationGroupElement(X[i], self, check = False)
-                            for i in range(1,n+1)]
-
```
This is because of the fixes by William at #3353. This patch will need to be rebased against 3.0.3.alpha1 once it is out.

Cheers,

Michael



---

archive/issue_comments_023417.json:
```json
{
    "body": "<a id='comment:22'></a>Looking at 9670.patch the problem might be limited to the actual moving of the list(self) function. Replacing that version with the one written by William might be enough. I did not look at the second patch, so there might be more problems there. \n\nDavid: For the record since you asked: Rebasing does not mean copying over the old files into the 3.0.3.alpha1 and then exporting again. You need to merge all the fixes including the moving of the new list(self) function. It would also be good if you posted a single new patch.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-04T21:28:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23417",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:22'></a>Looking at 9670.patch the problem might be limited to the actual moving of the list(self) function. Replacing that version with the one written by William might be enough. I did not look at the second patch, so there might be more problems there. 

David: For the record since you asked: Rebasing does not mean copying over the old files into the 3.0.3.alpha1 and then exporting again. You need to merge all the fixes including the moving of the new list(self) function. It would also be good if you posted a single new patch.

Cheers,

Michael



---

archive/issue_comments_023418.json:
```json
{
    "body": "<a id='comment:23'></a>Since the patch must be rebased let me point out that the patch would be easier to evaluate it would be better if the patch were factored into two parts, one of which only reorders the methods of `PermutationGroup_generic` and the other part containing the actual changes. Observe that I factored David's original patch this way (see above) and found it necessary to do so in order to understand what the patch actually does. I did not repeat this exercise on the second part of the patch.",
    "created_at": "2008-06-05T13:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23418",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:23'></a>Since the patch must be rebased let me point out that the patch would be easier to evaluate it would be better if the patch were factored into two parts, one of which only reorders the methods of `PermutationGroup_generic` and the other part containing the actual changes. Observe that I factored David's original patch this way (see above) and found it necessary to do so in order to understand what the patch actually does. I did not repeat this exercise on the second part of the patch.



---

archive/issue_comments_023419.json:
```json
{
    "body": "<a id='comment:24'></a>I'm trying to rebase but don't know how to merge. When I try to apply the old patch I get\n\n```\nwdj@hera:~/sagefiles/sage-3.0.3.alpha1$ ./sage\n----------------------------------------------------------------------\n----------------------------------------------------------------------\nLoading SAGE library. Current Mercurial branch is: permgp\nsage: hg_sage.apply(\"/home/wdj/sagefiles/9792.patch\")\ncd \"/home/wdj/sagefiles/sage-3.0.3.alpha1/devel/sage\" && hg status\ncd \"/home/wdj/sagefiles/sage-3.0.3.alpha1/devel/sage\" && hg status\ncd \"/home/wdj/sagefiles/sage-3.0.3.alpha1/devel/sage\" && hg import   \"/home/wdj/sagefiles/9792.patch\"\napplying /home/wdj/sagefiles/9792.patch\npatching file sage/groups/perm_gps/permgroup.py\nHunk #1 FAILED at 60\nHunk #3 succeeded at 686 with fuzz 2 (offset -146 lines).\nHunk #4 succeeded at 724 with fuzz 2 (offset -146 lines).\nHunk #5 FAILED at 1365\nHunk #6 FAILED at 1780\nHunk #7 succeeded at 1831 with fuzz 1 (offset -22 lines).\n3 out of 8 hunks FAILED -- saving rejects to file sage/groups/perm_gps/permgroup.py.rej\nabort: patch failed to apply\n```\nThe methods in file permgroup.py.rej make no sense to me:\n| SAGE Version 3.0.3.alpha1, Release Date: 2008-06-04                |\n| Type notebook() for the GUI, and license() for information.        |\n```\n--- permgroup.py\n+++ permgroup.py\n@@ -61,7 +61,8 @@ AUTHOR:\n     - William Stein (2007-07): put is_isomorphic back (and make it better)\n     - David Joyner (2007-08): fixed bugs in composition_series, upper/lower_central_series, \n                               derived_series,\n-    - David Joyner (2008-05): added normal_subgroups  (requested feature)\n+    - David Joyner (2008-05): added normal_subgroups (requested feature), some rearrangement,\n+                              modified normalizer\n  \n REFERENCES:\n     Cameron, P., Permutation Groups. New York: Cambridge University Press, 1999.\n@@ -1289,171 +1367,6 @@ class PermutationGroup_generic(group.Fin\n         from permgroup_morphism import PermutationGroupMorphism_im_gens\n         return PermutationGroupMorphism_im_gens(self, right, srcs, dsts)\n \n-    def molien_series(self):\n-        r\"\"\"\n-        Returns the Moien series of a transtive permutation group.\n-        The function\n-        $$\n-        M(x) = (1/|G|)\\sum_{g\\in G} det(1-x*g)^(-1)\n-        $$\n-        is sometimes called the \"Molien series\" of G.\n-        GAP's \\code{MolienSeries} is associated to a character of a group G.\n-        How are these related? A group G, given as a permutation \n-        group on n points, has a \"natural\" representation of \n-        dimension n, given by permutation matrices. The Molien series \n-        of G is the one associated to that permutation representation of \n-        G using the above formula. Character values then count fixed \n-        points of the corresponding permutations. \n-        \n-        EXAMPLES:\n-            sage: G = SymmetricGroup(5)\n-            sage: G.molien_series()                              # requires optional gap_packages\n-            1/(-x^15 + x^14 + x^13 - x^10 - x^9 - x^8 + x^7 + x^6 + x^5 - x^2 - x + 1)\n-            sage: G = SymmetricGroup(3)\n-            sage: G.molien_series()                              # requires optional gap_packages\n-            1/(-x^6 + x^5 + x^4 - x^2 - x + 1)\n-\n-        \"\"\"\n-        G = self\n-        GG = G._gap_init_()\n-        gap.eval(\"pi := NaturalCharacter( %s )\"%GG)\n-        gap.eval(\"cc := ConstituentsOfCharacter( pi )\")\n-        M = gap.eval(\"M := MolienSeries(Sum(cc))\")\n-        R = PolynomialRing(RationalField(),\"x\")\n-\tx = R.gen()\n-        nn = gap.eval(\"NumeratorOfRationalFunction(M)\")\n-        dd = gap.eval(\"DenominatorOfRationalFunction(M)\")\n-        FF = FractionField(R)\n-        return FF(nn.replace(\"_1\",\"\"))/FF(dd.replace(\"_1\",\"\"))\n-    \n-    def normal_subgroups(self):\n-        \"\"\"\n-        Return the normal subgroups of this group as a (sorted in increasing\n-        order) list of permutation groups.\n-\n-        The normal subgroups of $H = PSL(2,7)xPSL(2,7)$ are $1$, two copies\n-        of $PSL(2,7)$ and $H$ itself, as the following example shows.\n-        EXAMPLES:\n-            sage: G = PSL(2,7)\n-            sage: D = G.direct_product(G)\n-            sage: H = D[0]\n-            sage: NH = H.normal_subgroups()\n-            sage: len(NH)\n-            4\n-            sage: NH[1].is_isomorphic(G)\n-            True\n-            sage: NH[2].is_isomorphic(G)\n-            True\n-\n-        \"\"\"\n-        ans = []\n-        NS = self._gap_().NormalSubgroups()\n-        n = NS.Length()\n-        for i in range(1,n+1):\n-            ans.append(PermutationGroup(NS[i].GeneratorsOfGroup()))\n-        return ans\n-\n-    def normalizer(self,g):\n-        \"\"\"\n-        Returns the normalizer of g in self.\n-\n-        EXAMPLES:\n-            sage: G = PermutationGroup([[(1,2),(3,4)], [(1,2,3,4)]])\n-            sage: g = G.random_element(); g\n-            (1,3)\n-            sage: G.normalizer(g)\n-            Group( [ (1,3), (2,4) ] )\n-            sage: g = G([(1,2,3,4)])\n-            sage: G.normalizer(g)\n-            Group( [ (1,2,3,4), (1,3)(2,4), (2,4) ] )\n-\n-        \"\"\"\n-        N = self._gap_().Normalizer(str(g))\n-        return N\n-\n-    def poincare_series(self, p=2, n=10):\n-        \"\"\"\n-        Returns the Poincare series of G mod p (p must be a prime), for n>1 \n-        large. In other words, if you input a finite group G, a prime p, \n-        and a positive integer n, it returns a quotient of polynomials \n-        f(x)=P(x)/Q(x) whose coefficient of $x^k$ equals the rank of the \n-        vector space $H_k(G,ZZ/pZZ)$, for all k in the range $1\\leq k \\leq n$. \n-        \n-        REQUIRES:\n-            GAP package HAP (in gap_packages-*.spkg).\n-\n-        EXAMPLES: \n-            sage: G = SymmetricGroup(5)\n-            sage: G.poincare_series(2,10)                              # requires optional gap_packages\n-            (x^2 + 1)/(x^4 - x^3 - x + 1)\n-            sage: G = SymmetricGroup(3)\n-            sage: G.poincare_series(2,10)                              # requires optional gap_packages\n-            1/(-x + 1)\n-\n-        AUTHORS:\n-            David Joyner and Graham Ellis\n-        \"\"\"\n-        gap.eval('RequirePackage(\"HAP\")')\n-        from sage.rings.arith import is_prime\n-        if not (p == 0 or is_prime(p)):\n-            raise ValueError, \"p must be 0 or prime\"\n-        G = self\n-        GG = G._gap_init_()\n-        ff = gap.eval(\"ff := PoincareSeriesPrimePart(%s,%s,%s)\"%(GG,p,n))\n-        R = PolynomialRing(RationalField(),\"x\")\n-\tx = R.gen()\n-        nn = gap.eval(\"NumeratorOfRationalFunction(ff)\")\n-        dd = gap.eval(\"DenominatorOfRationalFunction(ff)\")\n-        FF = FractionField(R)\n-        return FF(nn)/FF(dd)\n-\n-    def smallest_moved_point(self):\n-        \"\"\"\n-        Return the smallest point moved by a permutation in this group.\n-        \n-        EXAMPLES:\n-            sage: G = PermutationGroup([[(3,4)], [(2,3,4)]])\n-            sage: G.smallest_moved_point()\n-            2\n-            sage: G = PermutationGroup([[(1,2),(3,4)], [(1,2,3,4,10)]])\n-            sage: G.smallest_moved_point()\n-            1\n-        \"\"\"\n-        try:\n-            return self.__smallest_moved_point\n-        except AttributeError:\n-            n = Integer(self._gap_().SmallestMovedPoint())\n-        self.__smallest_moved_point = n\n-        return n\n-\n-    def sylow_subgroup(self, p):\n-        \"\"\"\n-        Returns a Sylow p-subgroups of the finite group G, where p is\n-        a prime. This is a p-subgroup of G whose index in G is coprime to p.\n-        Wraps the GAP function SylowSubgroup.\n-\n-        EXAMPLES:\n-            sage: G = PermutationGroup(['(1,2,3)', '(2,3)'])\n-            sage: G.sylow_subgroup(2)\n-            Permutation Group with generators [(2,3)]\n-            sage: G.sylow_subgroup(5)\n-            Permutation Group with generators [()]\n-\n-        \"\"\"\n-        from sage.groups.perm_gps.permgroup_element import PermutationGroupElement\n-        G = self\n-        gap.eval(\"G := %s\"%G._gap_init_())\n-        gap.eval(\"Ssgp := SylowSubgroup(G, %s);\"%p)\n-        gap.eval(\"gens := GeneratorsOfGroup( Ssgp );\")\n-        N = Integer(gap.eval(\"N := Length(gens);\"))\n-        if N>0:\n-            gens = [PermutationGroupElement(gap.eval(\"gens[%s];\"%j)) for j in range(1,N+1)]\n-            H = PermutationGroup(gens)\n-        else:\n-            H = PermutationGroup([()])\n-        return H\n-\n-        \n     ######################  Boolean tests #####################\n     \n     def is_abelian(self):\n@@ -1704,54 +1617,6 @@ class PermutationGroup_generic(group.Fin\n         ans = self._gap_().IsTransitive()\n         return ans.bool()\n     \n-    ############## Series ######################\n-    \n-    def composition_series(self):\n-        \"\"\"\n-        Return the composition series of this group as a list of\n-        permutation groups.\n-\n-        EXAMPLES:\n-        These computations use pseudo-random numbers, so we set the\n-        seed for reproducible testing.\n-            sage: set_random_seed(0)\n-            sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])\n-            sage: G.composition_series()    # random output\n-            [Permutation Group with generators [(1,2,3)(4,5), (3,4)],\n-             Permutation Group with generators [(1,5)(3,4), (1,5)(2,3), (1,5,4)],\n-             Permutation Group with generators [()]]\n-\n-        \"\"\"\n-        current_randstate().set_seed_gap()\n-        ans = []\n-        DS = self._gap_().CompositionSeries()\n-        n = DS.Length()\n-        for i in range(1,n+1):\n-            ans.append(PermutationGroup(DS[i].GeneratorsOfGroup()))\n-        return ans\n-\n-    def derived_series(self):\n-        \"\"\"\n-        Return the derived series of this group as a list of\n-        permutation groups.\n-\n-        EXAMPLES:\n-        These computations use pseudo-random numbers, so we set the\n-        seed for reproducible testing.\n-            sage: set_random_seed(0)\n-            sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])\n-            sage: G.derived_series()    # random output\n-            [Permutation Group with generators [(1,2,3)(4,5), (3,4)], \n-             Permutation Group with generators [(1,5)(3,4), (1,5)(2,4), (2,4)(3,5)]]\n-        \"\"\"\n-        current_randstate().set_seed_gap()\n-        ans = []\n-        DS = self._gap_().DerivedSeries()\n-        n = DS.Length()\n-        for i in range(1,n+1):\n-            ans.append(PermutationGroup(DS[i].GeneratorsOfGroup()))\n-        return ans\n-    \n     def lower_central_series(self):\n         \"\"\"\n         Return the lower central series of this group as a list of\n```\n\nWhy would these be rejected? AFAIK, they have nothing to do with the list(self) function. In any case, I don't know what to do with these. The link http://hgbook.red-bean.com/hgbookch12.html simply says \"it is usually best to fix up the rejected hunks\", but that isn't very specific. These passes sage -testall before, so I don't know what there is to fix.",
    "created_at": "2008-06-07T13:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23419",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:24'></a>I'm trying to rebase but don't know how to merge. When I try to apply the old patch I get

```
wdj@hera:~/sagefiles/sage-3.0.3.alpha1$ ./sage
----------------------------------------------------------------------
----------------------------------------------------------------------
Loading SAGE library. Current Mercurial branch is: permgp
sage: hg_sage.apply("/home/wdj/sagefiles/9792.patch")
cd "/home/wdj/sagefiles/sage-3.0.3.alpha1/devel/sage" && hg status
cd "/home/wdj/sagefiles/sage-3.0.3.alpha1/devel/sage" && hg status
cd "/home/wdj/sagefiles/sage-3.0.3.alpha1/devel/sage" && hg import   "/home/wdj/sagefiles/9792.patch"
applying /home/wdj/sagefiles/9792.patch
patching file sage/groups/perm_gps/permgroup.py
Hunk #1 FAILED at 60
Hunk #3 succeeded at 686 with fuzz 2 (offset -146 lines).
Hunk #4 succeeded at 724 with fuzz 2 (offset -146 lines).
Hunk #5 FAILED at 1365
Hunk #6 FAILED at 1780
Hunk #7 succeeded at 1831 with fuzz 1 (offset -22 lines).
3 out of 8 hunks FAILED -- saving rejects to file sage/groups/perm_gps/permgroup.py.rej
abort: patch failed to apply
```
The methods in file permgroup.py.rej make no sense to me:
| SAGE Version 3.0.3.alpha1, Release Date: 2008-06-04                |
| Type notebook() for the GUI, and license() for information.        |
```
--- permgroup.py
+++ permgroup.py
@@ -61,7 +61,8 @@ AUTHOR:
     - William Stein (2007-07): put is_isomorphic back (and make it better)
     - David Joyner (2007-08): fixed bugs in composition_series, upper/lower_central_series, 
                               derived_series,
-    - David Joyner (2008-05): added normal_subgroups  (requested feature)
+    - David Joyner (2008-05): added normal_subgroups (requested feature), some rearrangement,
+                              modified normalizer
  
 REFERENCES:
     Cameron, P., Permutation Groups. New York: Cambridge University Press, 1999.
@@ -1289,171 +1367,6 @@ class PermutationGroup_generic(group.Fin
         from permgroup_morphism import PermutationGroupMorphism_im_gens
         return PermutationGroupMorphism_im_gens(self, right, srcs, dsts)
 
-    def molien_series(self):
-        r"""
-        Returns the Moien series of a transtive permutation group.
-        The function
-        $$
-        M(x) = (1/|G|)\sum_{g\in G} det(1-x*g)^(-1)
-        $$
-        is sometimes called the "Molien series" of G.
-        GAP's \code{MolienSeries} is associated to a character of a group G.
-        How are these related? A group G, given as a permutation 
-        group on n points, has a "natural" representation of 
-        dimension n, given by permutation matrices. The Molien series 
-        of G is the one associated to that permutation representation of 
-        G using the above formula. Character values then count fixed 
-        points of the corresponding permutations. 
-        
-        EXAMPLES:
-            sage: G = SymmetricGroup(5)
-            sage: G.molien_series()                              # requires optional gap_packages
-            1/(-x^15 + x^14 + x^13 - x^10 - x^9 - x^8 + x^7 + x^6 + x^5 - x^2 - x + 1)
-            sage: G = SymmetricGroup(3)
-            sage: G.molien_series()                              # requires optional gap_packages
-            1/(-x^6 + x^5 + x^4 - x^2 - x + 1)
-
-        """
-        G = self
-        GG = G._gap_init_()
-        gap.eval("pi := NaturalCharacter( %s )"%GG)
-        gap.eval("cc := ConstituentsOfCharacter( pi )")
-        M = gap.eval("M := MolienSeries(Sum(cc))")
-        R = PolynomialRing(RationalField(),"x")
-	x = R.gen()
-        nn = gap.eval("NumeratorOfRationalFunction(M)")
-        dd = gap.eval("DenominatorOfRationalFunction(M)")
-        FF = FractionField(R)
-        return FF(nn.replace("_1",""))/FF(dd.replace("_1",""))
-    
-    def normal_subgroups(self):
-        """
-        Return the normal subgroups of this group as a (sorted in increasing
-        order) list of permutation groups.
-
-        The normal subgroups of $H = PSL(2,7)xPSL(2,7)$ are $1$, two copies
-        of $PSL(2,7)$ and $H$ itself, as the following example shows.
-        EXAMPLES:
-            sage: G = PSL(2,7)
-            sage: D = G.direct_product(G)
-            sage: H = D[0]
-            sage: NH = H.normal_subgroups()
-            sage: len(NH)
-            4
-            sage: NH[1].is_isomorphic(G)
-            True
-            sage: NH[2].is_isomorphic(G)
-            True
-
-        """
-        ans = []
-        NS = self._gap_().NormalSubgroups()
-        n = NS.Length()
-        for i in range(1,n+1):
-            ans.append(PermutationGroup(NS[i].GeneratorsOfGroup()))
-        return ans
-
-    def normalizer(self,g):
-        """
-        Returns the normalizer of g in self.
-
-        EXAMPLES:
-            sage: G = PermutationGroup([[(1,2),(3,4)], [(1,2,3,4)]])
-            sage: g = G.random_element(); g
-            (1,3)
-            sage: G.normalizer(g)
-            Group( [ (1,3), (2,4) ] )
-            sage: g = G([(1,2,3,4)])
-            sage: G.normalizer(g)
-            Group( [ (1,2,3,4), (1,3)(2,4), (2,4) ] )
-
-        """
-        N = self._gap_().Normalizer(str(g))
-        return N
-
-    def poincare_series(self, p=2, n=10):
-        """
-        Returns the Poincare series of G mod p (p must be a prime), for n>1 
-        large. In other words, if you input a finite group G, a prime p, 
-        and a positive integer n, it returns a quotient of polynomials 
-        f(x)=P(x)/Q(x) whose coefficient of $x^k$ equals the rank of the 
-        vector space $H_k(G,ZZ/pZZ)$, for all k in the range $1\leq k \leq n$. 
-        
-        REQUIRES:
-            GAP package HAP (in gap_packages-*.spkg).
-
-        EXAMPLES: 
-            sage: G = SymmetricGroup(5)
-            sage: G.poincare_series(2,10)                              # requires optional gap_packages
-            (x^2 + 1)/(x^4 - x^3 - x + 1)
-            sage: G = SymmetricGroup(3)
-            sage: G.poincare_series(2,10)                              # requires optional gap_packages
-            1/(-x + 1)
-
-        AUTHORS:
-            David Joyner and Graham Ellis
-        """
-        gap.eval('RequirePackage("HAP")')
-        from sage.rings.arith import is_prime
-        if not (p == 0 or is_prime(p)):
-            raise ValueError, "p must be 0 or prime"
-        G = self
-        GG = G._gap_init_()
-        ff = gap.eval("ff := PoincareSeriesPrimePart(%s,%s,%s)"%(GG,p,n))
-        R = PolynomialRing(RationalField(),"x")
-	x = R.gen()
-        nn = gap.eval("NumeratorOfRationalFunction(ff)")
-        dd = gap.eval("DenominatorOfRationalFunction(ff)")
-        FF = FractionField(R)
-        return FF(nn)/FF(dd)
-
-    def smallest_moved_point(self):
-        """
-        Return the smallest point moved by a permutation in this group.
-        
-        EXAMPLES:
-            sage: G = PermutationGroup([[(3,4)], [(2,3,4)]])
-            sage: G.smallest_moved_point()
-            2
-            sage: G = PermutationGroup([[(1,2),(3,4)], [(1,2,3,4,10)]])
-            sage: G.smallest_moved_point()
-            1
-        """
-        try:
-            return self.__smallest_moved_point
-        except AttributeError:
-            n = Integer(self._gap_().SmallestMovedPoint())
-        self.__smallest_moved_point = n
-        return n
-
-    def sylow_subgroup(self, p):
-        """
-        Returns a Sylow p-subgroups of the finite group G, where p is
-        a prime. This is a p-subgroup of G whose index in G is coprime to p.
-        Wraps the GAP function SylowSubgroup.
-
-        EXAMPLES:
-            sage: G = PermutationGroup(['(1,2,3)', '(2,3)'])
-            sage: G.sylow_subgroup(2)
-            Permutation Group with generators [(2,3)]
-            sage: G.sylow_subgroup(5)
-            Permutation Group with generators [()]
-
-        """
-        from sage.groups.perm_gps.permgroup_element import PermutationGroupElement
-        G = self
-        gap.eval("G := %s"%G._gap_init_())
-        gap.eval("Ssgp := SylowSubgroup(G, %s);"%p)
-        gap.eval("gens := GeneratorsOfGroup( Ssgp );")
-        N = Integer(gap.eval("N := Length(gens);"))
-        if N>0:
-            gens = [PermutationGroupElement(gap.eval("gens[%s];"%j)) for j in range(1,N+1)]
-            H = PermutationGroup(gens)
-        else:
-            H = PermutationGroup([()])
-        return H
-
-        
     ######################  Boolean tests #####################
     
     def is_abelian(self):
@@ -1704,54 +1617,6 @@ class PermutationGroup_generic(group.Fin
         ans = self._gap_().IsTransitive()
         return ans.bool()
     
-    ############## Series ######################
-    
-    def composition_series(self):
-        """
-        Return the composition series of this group as a list of
-        permutation groups.
-
-        EXAMPLES:
-        These computations use pseudo-random numbers, so we set the
-        seed for reproducible testing.
-            sage: set_random_seed(0)
-            sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])
-            sage: G.composition_series()    # random output
-            [Permutation Group with generators [(1,2,3)(4,5), (3,4)],
-             Permutation Group with generators [(1,5)(3,4), (1,5)(2,3), (1,5,4)],
-             Permutation Group with generators [()]]
-
-        """
-        current_randstate().set_seed_gap()
-        ans = []
-        DS = self._gap_().CompositionSeries()
-        n = DS.Length()
-        for i in range(1,n+1):
-            ans.append(PermutationGroup(DS[i].GeneratorsOfGroup()))
-        return ans
-
-    def derived_series(self):
-        """
-        Return the derived series of this group as a list of
-        permutation groups.
-
-        EXAMPLES:
-        These computations use pseudo-random numbers, so we set the
-        seed for reproducible testing.
-            sage: set_random_seed(0)
-            sage: G = PermutationGroup([[(1,2,3),(4,5)],[(3,4)]])
-            sage: G.derived_series()    # random output
-            [Permutation Group with generators [(1,2,3)(4,5), (3,4)], 
-             Permutation Group with generators [(1,5)(3,4), (1,5)(2,4), (2,4)(3,5)]]
-        """
-        current_randstate().set_seed_gap()
-        ans = []
-        DS = self._gap_().DerivedSeries()
-        n = DS.Length()
-        for i in range(1,n+1):
-            ans.append(PermutationGroup(DS[i].GeneratorsOfGroup()))
-        return ans
-    
     def lower_central_series(self):
         """
         Return the lower central series of this group as a list of
```

Why would these be rejected? AFAIK, they have nothing to do with the list(self) function. In any case, I don't know what to do with these. The link http://hgbook.red-bean.com/hgbookch12.html simply says "it is usually best to fix up the rejected hunks", but that isn't very specific. These passes sage -testall before, so I don't know what there is to fix.



---

archive/issue_comments_023420.json:
```json
{
    "body": "<a id='comment:25'></a>Perhaps I'm misreading something, but it seems like the files size before William's patch http://trac.sagemath.org/sage_trac/ticket/3353 is 72K and now it is 80K. So, I'm leary of just taking my file and replacing the list method by William's. Maybe I should just completely redo the entire thing? To me that would be more straightforward than dealing with hg-rejected methods. If I should do this, should I also start a new ticket?",
    "created_at": "2008-06-07T18:51:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23420",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:25'></a>Perhaps I'm misreading something, but it seems like the files size before William's patch http://trac.sagemath.org/sage_trac/ticket/3353 is 72K and now it is 80K. So, I'm leary of just taking my file and replacing the list method by William's. Maybe I should just completely redo the entire thing? To me that would be more straightforward than dealing with hg-rejected methods. If I should do this, should I also start a new ticket?



---

archive/issue_comments_023421.json:
```json
{
    "body": "<a id='comment:26'></a>It seems to me that the patch has to be redone but without starting a new ticket. I'd prefer to see just the changes to the methods without alphabetizing. That way the effect of the patch is clear. A separate patch putting the methods in alphabetical order could be a separate ticket. I think it is good practice if code-cleanup patches (such as realphabetizing, tab removal, etc.) do the cleanup but have no other effect. Especially realphabetizing the methods should not be mixed with actual code changes since one can't tell that a method hasn't been changed when it is moved to another spot. This was a problem when I reviewed the patch.",
    "created_at": "2008-06-08T12:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23421",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:26'></a>It seems to me that the patch has to be redone but without starting a new ticket. I'd prefer to see just the changes to the methods without alphabetizing. That way the effect of the patch is clear. A separate patch putting the methods in alphabetical order could be a separate ticket. I think it is good practice if code-cleanup patches (such as realphabetizing, tab removal, etc.) do the cleanup but have no other effect. Especially realphabetizing the methods should not be mixed with actual code changes since one can't tell that a method hasn't been changed when it is moved to another spot. This was a problem when I reviewed the patch.



---

archive/issue_comments_023422.json:
```json
{
    "body": "<a id='comment:27'></a>I agree with Dan: Post a new patch that adds normal_subgroups and fixes image and kernel only against 3.0.3.a1. Then open a new ticket that sorts all the functions alphabetically.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-09T00:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23422",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:27'></a>I agree with Dan: Post a new patch that adds normal_subgroups and fixes image and kernel only against 3.0.3.a1. Then open a new ticket that sorts all the functions alphabetically.

Cheers,

Michael



---

archive/issue_comments_023423.json:
```json
{
    "body": "<a id='comment:28'></a>Please apply both of these patches. The 2 pass sage -testall. There is no alphabetical resorting in this patch.",
    "created_at": "2008-06-09T02:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23423",
    "user": "https://github.com/wdjoyner"
}
```

<a id='comment:28'></a>Please apply both of these patches. The 2 pass sage -testall. There is no alphabetical resorting in this patch.



---

archive/issue_comments_023424.json:
```json
{
    "body": "Attachment [9807.patch](tarball://root/attachments/some-uuid/ticket3130/9807.patch) by @wdjoyner created at 2008-06-09 02:19:06\n\nthis and 9807 are based on sage 3.0.3alpha1",
    "created_at": "2008-06-09T02:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23424",
    "user": "https://github.com/wdjoyner"
}
```

Attachment [9807.patch](tarball://root/attachments/some-uuid/ticket3130/9807.patch) by @wdjoyner created at 2008-06-09 02:19:06

this and 9807 are based on sage 3.0.3alpha1



---

archive/issue_comments_023425.json:
```json
{
    "body": "<a id='comment:29'></a>Attachment [9808.patch](tarball://root/attachments/some-uuid/ticket3130/9808.patch) by @dwbump created at 2008-06-09 05:41:25\n\nI went through the patch (9807.patch+9808.patch) and it looks good to me. It is\nexactly what was discussed before without the realphabetizing.\n\nI hope that this ticket is closed before 3364. When 3364 is closed maybe someone\ncan come back and remove the # random output comments this patch adds.",
    "created_at": "2008-06-09T05:41:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23425",
    "user": "https://github.com/dwbump"
}
```

<a id='comment:29'></a>Attachment [9808.patch](tarball://root/attachments/some-uuid/ticket3130/9808.patch) by @dwbump created at 2008-06-09 05:41:25

I went through the patch (9807.patch+9808.patch) and it looks good to me. It is
exactly what was discussed before without the realphabetizing.

I hope that this ticket is closed before 3364. When 3364 is closed maybe someone
can come back and remove the # random output comments this patch adds.



---

archive/issue_comments_023426.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2008-06-09T06:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23426",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_comments_023427.json:
```json
{
    "body": "<a id='comment:30'></a>Merged in Sage 3.0.3.alpha2",
    "created_at": "2008-06-09T06:19:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3130#issuecomment-23427",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:30'></a>Merged in Sage 3.0.3.alpha2



---

archive/issue_events_007066.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-06-09T06:19:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/3130",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3130#event-7066"
}
```
