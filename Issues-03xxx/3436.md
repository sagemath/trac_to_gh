# Issue 3436: random_matrix() with prescribed density buggy

archive/issues_003436.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "Matrices with prescribed density are not generated correctly:\n\n```\nsage: M = random_matrix(GF(65537), 100, 100, sparse=True, density=0.1)\nsage: len(M.nonzero_positions())\n940\nsage: M = random_matrix(GF(2), 100, 100, sparse=True, density=0.1)\nsage: len(M.nonzero_positions())\n465\n```\n\nTo wit: the actual density of the matrix over GF(2) is only approximately half of what we expect. This happens because the randomize() function populating the entries does not check whether the random element picked actually is non-zero. Apparently, all of the matrix classes are affected by this bug.\n\nCC:  @craigcitro\n\nComponent: **linear algebra**\n\nAuthor: **Sebastian Pancratz**\n\nReviewer: **Tom Boothby, Craig Citro**\n\nMerged: **sage-4.3.2.alpha0**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/3436_\n\n",
    "closed_at": "2010-01-24T00:28:15Z",
    "created_at": "2008-06-16T04:56:11Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "random_matrix() with prescribed density buggy",
    "type": "issue",
    "updated_at": "2010-01-24T00:28:15Z",
    "url": "https://github.com/sagemath/sage/issues/3436",
    "user": "https://github.com/sagetrac-rpw"
}
```
Matrices with prescribed density are not generated correctly:

```
sage: M = random_matrix(GF(65537), 100, 100, sparse=True, density=0.1)
sage: len(M.nonzero_positions())
940
sage: M = random_matrix(GF(2), 100, 100, sparse=True, density=0.1)
sage: len(M.nonzero_positions())
465
```

To wit: the actual density of the matrix over GF(2) is only approximately half of what we expect. This happens because the randomize() function populating the entries does not check whether the random element picked actually is non-zero. Apparently, all of the matrix classes are affected by this bug.

CC:  @craigcitro

Component: **linear algebra**

Author: **Sebastian Pancratz**

Reviewer: **Tom Boothby, Craig Citro**

Merged: **sage-4.3.2.alpha0**

_Issue created by migration from https://trac.sagemath.org/ticket/3436_





---

archive/issue_events_037065.json:
```json
{
    "actor": "https://github.com/sagetrac-rpw",
    "created_at": "2008-06-16T04:56:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37065"
}
```



---

archive/issue_events_037066.json:
```json
{
    "actor": "https://github.com/sagetrac-rpw",
    "created_at": "2008-06-16T04:56:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37066"
}
```



---

archive/issue_events_037067.json:
```json
{
    "actor": "https://github.com/sagetrac-rpw",
    "created_at": "2008-06-16T04:56:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37067"
}
```



---

archive/issue_events_037068.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-16T04:56:11Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "subject": "https://github.com/sagetrac-rpw",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37068"
}
```



---

archive/issue_events_037069.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-16T04:58:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "milestone_number": null,
    "milestone_title": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37069"
}
```



---

archive/issue_comments_018626.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI'll also point out that the documentation for random_matrix says that density should be an integer, not a float -- see also randomize in matrix2.pyx and random_element in matrix_space.py -- while in matrix_integer_dense.pyx, randomize says that density should be a float.",
    "created_at": "2009-02-07T00:11:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18626",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:2" align="right">comment:2</div>

I'll also point out that the documentation for random_matrix says that density should be an integer, not a float -- see also randomize in matrix2.pyx and random_element in matrix_space.py -- while in matrix_integer_dense.pyx, randomize says that density should be a float.



---

archive/issue_comments_018627.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nSome more examples with sage 4.1.  The last few examples show that the density is about an order of magnitude smaller than what we asked for.\n\n```\nsage: A=random_matrix(ZZ,1000,density=1e-3,sparse=True)  \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n0.000814000000000000\nsage: A=random_matrix(ZZ,10000,density=1e-4,sparse=True)  \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n0.0000796700000000000\nsage: A=random_matrix(ZZ,100000,density=1e-5,sparse=True) \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n1.13230000000000e-6\nsage: A=random_matrix(ZZ,100000,density=1e-6,sparse=True) \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n1.12600000000000e-7\nsage: A=random_matrix(ZZ,100000,density=1e-7,sparse=True) \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n1.08000000000000e-8\n```",
    "created_at": "2009-07-20T14:15:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18627",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">comment:3</div>

Some more examples with sage 4.1.  The last few examples show that the density is about an order of magnitude smaller than what we asked for.

```
sage: A=random_matrix(ZZ,1000,density=1e-3,sparse=True)  
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
0.000814000000000000
sage: A=random_matrix(ZZ,10000,density=1e-4,sparse=True)  
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
0.0000796700000000000
sage: A=random_matrix(ZZ,100000,density=1e-5,sparse=True) 
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
1.13230000000000e-6
sage: A=random_matrix(ZZ,100000,density=1e-6,sparse=True) 
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
1.12600000000000e-7
sage: A=random_matrix(ZZ,100000,density=1e-7,sparse=True) 
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
1.08000000000000e-8
```



---

archive/issue_comments_018628.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@jasongrout](#comment:3):\n> Some more examples with sage 4.1.  The last few examples show that the density is about an order of magnitude smaller than what we asked for.\n\nWhen I tried this, I got answers like the first two: the ratio of (fraction of nonzero entries) / (density) was about 4/5.  This is consistent with the observation in the ticket description that the randomize function doesn't check whether the random element is zero: for integers, the documentation for `random_element` says that the default distribution gives `Pr(X = 0) = 1/5`. \n\nI would try to write a patch for this but pretty much all of the matrix code is written in Cython, which I don't know, so anything I write would likely be buggy and slow things down by a factor of 100.",
    "created_at": "2009-09-30T03:40:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18628",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@jasongrout](#comment:3):
> Some more examples with sage 4.1.  The last few examples show that the density is about an order of magnitude smaller than what we asked for.

When I tried this, I got answers like the first two: the ratio of (fraction of nonzero entries) / (density) was about 4/5.  This is consistent with the observation in the ticket description that the randomize function doesn't check whether the random element is zero: for integers, the documentation for `random_element` says that the default distribution gives `Pr(X = 0) = 1/5`. 

I would try to write a patch for this but pretty much all of the matrix code is written in Cython, which I don't know, so anything I write would likely be buggy and slow things down by a factor of 100.



---

archive/issue_comments_018629.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttached a patch.  It introduces a new method in ``ring.pyx``, ``_random_nonzero_element``, which by default calls ``random_element`` until a non-zero element has been obtained.\n\nOn the matrix end, I've introduced a new parameter ``nonzero`` to the ``randomize`` methods in the various matrix implementations.  If this is set to ``True``, the modified entries are guaranteed to be non-zero, whereas if it is set to ``False`` they are not.  The method ``random_element`` on a matrix space now calls ``randomize`` on a zero matrix with ``nonzero=True``.\n\nFinally, this is now also used to ensure that generating a fraction field element does not cause a division by zero error.\n\nSebastian",
    "created_at": "2010-01-17T10:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18629",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:5" align="right">comment:5</div>

Attached a patch.  It introduces a new method in ``ring.pyx``, ``_random_nonzero_element``, which by default calls ``random_element`` until a non-zero element has been obtained.

On the matrix end, I've introduced a new parameter ``nonzero`` to the ``randomize`` methods in the various matrix implementations.  If this is set to ``True``, the modified entries are guaranteed to be non-zero, whereas if it is set to ``False`` they are not.  The method ``random_element`` on a matrix space now calls ``randomize`` on a zero matrix with ``nonzero=True``.

Finally, this is now also used to ensure that generating a fraction field element does not cause a division by zero error.

Sebastian



---

archive/issue_comments_018630.json:
```json
{
    "body": "Author: **spancratz**",
    "created_at": "2010-01-17T10:18:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18630",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Author: **spancratz**



---

archive/issue_events_037070.json:
```json
{
    "actor": "https://github.com/sagetrac-spancratz",
    "created_at": "2010-01-17T10:18:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37070"
}
```



---

archive/issue_comments_018631.json:
```json
{
    "body": "Attachment: **[trac3436_a.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_a.patch.gz)**\n\nFirst patch",
    "created_at": "2010-01-17T10:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18631",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Attachment: **[trac3436_a.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_a.patch.gz)**

First patch



---

archive/issue_comments_018632.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI've attached the patch now.  I've called it \"First patch\" since I've only doctested ``sage/matrix/`` and adjusted some docstrings as needed, but I expect that a few more such little changes might come up during a full test.\n\nSebastian",
    "created_at": "2010-01-17T10:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18632",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:6" align="right">comment:6</div>

I've attached the patch now.  I've called it "First patch" since I've only doctested ``sage/matrix/`` and adjusted some docstrings as needed, but I expect that a few more such little changes might come up during a full test.

Sebastian



---

archive/issue_comments_018633.json:
```json
{
    "body": "Attachment: **[trac3436_b.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_b.patch.gz)**\n\nAdditional patch (more doctests)",
    "created_at": "2010-01-17T19:46:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18633",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Attachment: **[trac3436_b.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_b.patch.gz)**

Additional patch (more doctests)



---

archive/issue_comments_018634.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nThe additional patch takes care of the remaining three doctest failures.  This should now pass all doctests done with ``./sage -t devel/sage/sage``.\n\nSebastian",
    "created_at": "2010-01-17T19:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18634",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:7" align="right">comment:7</div>

The additional patch takes care of the remaining three doctest failures.  This should now pass all doctests done with ``./sage -t devel/sage/sage``.

Sebastian



---

archive/issue_comments_018635.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThis looks good with one notable exception.  Due to implementation details, Matrix_cyclo_dense.randomize() makes overly dense matrices.  This should be pretty easy to fix.",
    "created_at": "2010-01-18T08:18:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18635",
    "user": "https://github.com/boothby"
}
```

<div id="comment:8" align="right">comment:8</div>

This looks good with one notable exception.  Due to implementation details, Matrix_cyclo_dense.randomize() makes overly dense matrices.  This should be pretty easy to fix.



---

archive/issue_events_037071.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2010-01-18T08:18:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37071"
}
```



---

archive/issue_events_037072.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2010-01-18T08:18:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37072"
}
```



---

archive/issue_comments_018636.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI mentioned this to Tom, but just in case no one gets to it: implementing this for cyclotomic matrices should be pretty easy once you find out about the `set_unsafe` method on dense cyclotomic matrices. You can use the same generic code that loops over any other matrix, but use `set_unsafe` and (as long as you're really not going outside the bounds of the matrix!) it'll take care of setting the entry in the matrix correctly and quickly.",
    "created_at": "2010-01-18T08:23:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18636",
    "user": "https://github.com/craigcitro"
}
```

<div id="comment:9" align="right">comment:9</div>

I mentioned this to Tom, but just in case no one gets to it: implementing this for cyclotomic matrices should be pretty easy once you find out about the `set_unsafe` method on dense cyclotomic matrices. You can use the same generic code that loops over any other matrix, but use `set_unsafe` and (as long as you're really not going outside the bounds of the matrix!) it'll take care of setting the entry in the matrix correctly and quickly.



---

archive/issue_comments_018637.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nCraig:  the approach you suggest does not seem to work out quite as nicely, since the ``randomize`` method accepts two parameters ``num_bound`` and ``den_bound``, which are accept by the rational field but *not* by the cyclotomic field.  A way around this problem is to generate the cyclotomic numbers ourselves in the matrix method, as a sequence of rationals of length the degree of the field extension.  I'll write that now.\n\nSebastian",
    "created_at": "2010-01-18T18:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18637",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:10" align="right">comment:10</div>

Craig:  the approach you suggest does not seem to work out quite as nicely, since the ``randomize`` method accepts two parameters ``num_bound`` and ``den_bound``, which are accept by the rational field but *not* by the cyclotomic field.  A way around this problem is to generate the cyclotomic numbers ourselves in the matrix method, as a sequence of rationals of length the degree of the field extension.  I'll write that now.

Sebastian



---

archive/issue_comments_018638.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI'm a little confused -- why aren't we just using `K.random_element()` where `K` is whatever ring the entries lie in? The `num_bound` and `den_bound` definitely aren't uniform, though we could definitely easily add them for cyclotomic fields ...",
    "created_at": "2010-01-18T19:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18638",
    "user": "https://github.com/craigcitro"
}
```

<div id="comment:11" align="right">comment:11</div>

I'm a little confused -- why aren't we just using `K.random_element()` where `K` is whatever ring the entries lie in? The `num_bound` and `den_bound` definitely aren't uniform, though we could definitely easily add them for cyclotomic fields ...



---

archive/issue_comments_018639.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI think that is the same reason why certain matrices have their ``randomize`` methods implemented themselves in the very first place:  speed.\n\nPersonally, I don't really care about this (the speed of generating random matrices), but since others do, I don't think this patch should make anything significantly slower.",
    "created_at": "2010-01-18T20:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18639",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:12" align="right">comment:12</div>

I think that is the same reason why certain matrices have their ``randomize`` methods implemented themselves in the very first place:  speed.

Personally, I don't really care about this (the speed of generating random matrices), but since others do, I don't think this patch should make anything significantly slower.



---

archive/issue_comments_018640.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n> Personally, I don't really care about this (the speed of generating random matrices),\n\nI care because this gets used a *LOT* in benchmarking and automated testing of linear algebra algorithms.",
    "created_at": "2010-01-18T22:16:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18640",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:13" align="right">comment:13</div>

> Personally, I don't really care about this (the speed of generating random matrices),

I care because this gets used a *LOT* in benchmarking and automated testing of linear algebra algorithms.



---

archive/issue_comments_018641.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nall that has to happen here is\n\n1) write a for loop that fills in the entries with set_unsafe\n\n2) update the polynomial quotient ring and numberfield random_element methods to pass *args and **kwargs down the line.",
    "created_at": "2010-01-18T22:44:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18641",
    "user": "https://github.com/boothby"
}
```

<div id="comment:14" align="right">comment:14</div>

all that has to happen here is

1) write a for loop that fills in the entries with set_unsafe

2) update the polynomial quotient ring and numberfield random_element methods to pass *args and **kwargs down the line.



---

archive/issue_comments_018642.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nTom, before you wrote your message, I already wrote the code for the randomize method, by including a _randomize_column method in matrix_rational_dense, and this is then used in the cyclotomic matrix code.  This way, the code doesn't have to modify any more classes than it does already.  I'll do some testing and upload it later.\n\nAlso, I talked to Robert Miller and he said this patch needs to be re-based to 4.3.1.rc0, so I'll do that, too.\n\nSebastian",
    "created_at": "2010-01-18T23:16:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18642",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:15" align="right">comment:15</div>

Tom, before you wrote your message, I already wrote the code for the randomize method, by including a _randomize_column method in matrix_rational_dense, and this is then used in the cyclotomic matrix code.  This way, the code doesn't have to modify any more classes than it does already.  I'll do some testing and upload it later.

Also, I talked to Robert Miller and he said this patch needs to be re-based to 4.3.1.rc0, so I'll do that, too.

Sebastian



---

archive/issue_comments_018643.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI view the fact that the random_element methods don't pass *args and **kwargs down the line as a bug -- and if you have to rebase, we might as well fix those up too.  Moreover, I'm not convinced that randomizing columns is the right way to go -- though I haven't seen your implementation, so I might be wrong.",
    "created_at": "2010-01-19T01:22:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18643",
    "user": "https://github.com/boothby"
}
```

<div id="comment:16" align="right">comment:16</div>

I view the fact that the random_element methods don't pass *args and **kwargs down the line as a bug -- and if you have to rebase, we might as well fix those up too.  Moreover, I'm not convinced that randomizing columns is the right way to go -- though I haven't seen your implementation, so I might be wrong.



---

archive/issue_comments_018644.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI've now finished the implementation, but I still need to re-base it.  Here are some timings.  First, the old implementation:\n\n```\nsage: MS = MatrixSpace(CyclotomicField(10), 100, 100)\nsage: timeit('A = MS.random_element()')\n25 loops, best of 3: 17.5 ms per loop\nsage: timeit('A = MS.random_element(density=0.1)')\n25 loops, best of 3: 8.89 ms per loop\nsage: A = MS.random_element(density=0.1)\nsage: n(len(A.nonzero_positions())/10000)\n0.231700000000000\n```\nSecond, the new implementation:\n\n```\nsage: MS = MatrixSpace(CyclotomicField(10), 100, 100)\nsage: timeit('A = MS.random_element()')\n25 loops, best of 3: 22 ms per loop\nsage: timeit('A = MS.random_element(density=0.1)')\n25 loops, best of 3: 9.36 ms per loop\nsage: timeit('A = MS.random_element(density=0.1, nonzero=True)')\n25 loops, best of 3: 9.35 ms per loop\nsage: timeit('A = MS.random_element(density=0.1, nonzero=False)')\n25 loops, best of 3: 9.37 ms per loop\nsage: A = MS.random_element(density=0.1, nonzero=True)\nsage: n(len(A.nonzero_positions())/10000)\n0.0963000000000000\n```",
    "created_at": "2010-01-19T01:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18644",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:17" align="right">comment:17</div>

I've now finished the implementation, but I still need to re-base it.  Here are some timings.  First, the old implementation:

```
sage: MS = MatrixSpace(CyclotomicField(10), 100, 100)
sage: timeit('A = MS.random_element()')
25 loops, best of 3: 17.5 ms per loop
sage: timeit('A = MS.random_element(density=0.1)')
25 loops, best of 3: 8.89 ms per loop
sage: A = MS.random_element(density=0.1)
sage: n(len(A.nonzero_positions())/10000)
0.231700000000000
```
Second, the new implementation:

```
sage: MS = MatrixSpace(CyclotomicField(10), 100, 100)
sage: timeit('A = MS.random_element()')
25 loops, best of 3: 22 ms per loop
sage: timeit('A = MS.random_element(density=0.1)')
25 loops, best of 3: 9.36 ms per loop
sage: timeit('A = MS.random_element(density=0.1, nonzero=True)')
25 loops, best of 3: 9.35 ms per loop
sage: timeit('A = MS.random_element(density=0.1, nonzero=False)')
25 loops, best of 3: 9.37 ms per loop
sage: A = MS.random_element(density=0.1, nonzero=True)
sage: n(len(A.nonzero_positions())/10000)
0.0963000000000000
```



---

archive/issue_comments_018645.json:
```json
{
    "body": "Third patch, for matrices over cyclotomic fields",
    "created_at": "2010-01-19T01:59:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18645",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Third patch, for matrices over cyclotomic fields



---

archive/issue_comments_018646.json:
```json
{
    "body": "Attachment: **[trac3436_c.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_c.patch.gz)**\n\nAttachment: **[trac3436_rb.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_rb.patch.gz)**\n\nRebase of the first three patches to 4.3.1.rc0",
    "created_at": "2010-01-19T02:22:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18646",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Attachment: **[trac3436_c.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_c.patch.gz)**

Attachment: **[trac3436_rb.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_rb.patch.gz)**

Rebase of the first three patches to 4.3.1.rc0



---

archive/issue_events_037073.json:
```json
{
    "actor": "https://github.com/sagetrac-spancratz",
    "created_at": "2010-01-19T02:24:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37073"
}
```



---

archive/issue_events_037074.json:
```json
{
    "actor": "https://github.com/sagetrac-spancratz",
    "created_at": "2010-01-19T02:24:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37074"
}
```



---

archive/issue_comments_018647.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI've now re-based the patch.  I still need to run tests, I'll write back later to confirm if everything passes.\n\nTom, which random element methods are you referring to?\n\nSebastian",
    "created_at": "2010-01-19T02:24:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18647",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:18" align="right">comment:18</div>

I've now re-based the patch.  I still need to run tests, I'll write back later to confirm if everything passes.

Tom, which random element methods are you referring to?

Sebastian



---

archive/issue_comments_018648.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe re-base makes *lots* of doctests fail, I'll update the patch and post another one when I am done.\n\nSebastian",
    "created_at": "2010-01-19T02:56:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18648",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:19" align="right">comment:19</div>

The re-base makes *lots* of doctests fail, I'll update the patch and post another one when I am done.

Sebastian



---

archive/issue_comments_018649.json:
```json
{
    "body": "Fixes the doctests for the rebase",
    "created_at": "2010-01-19T03:52:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18649",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Fixes the doctests for the rebase



---

archive/issue_comments_018650.json:
```json
{
    "body": "Attachment: **[trac3436_rb_doctests.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_rb_doctests.patch.gz)**\n\nrandom_element method in polynomial quotient rings (and number fields) passes on args and kwds",
    "created_at": "2010-01-19T04:16:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18650",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Attachment: **[trac3436_rb_doctests.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_rb_doctests.patch.gz)**

random_element method in polynomial quotient rings (and number fields) passes on args and kwds



---

archive/issue_comments_018651.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nAttachment: **[trac3436_rb_poly.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_rb_poly.patch.gz)**\n\nTom suggested that we should change the code for random matrix generation over cyclotomic fields to rely on the random element generation code in the cyclotomic field, mostly in order to reduce code size.\n\nThe patch above now ensures that the polynomial quotient rings (and number fields) pass on additional arguments.\n\nThis patch should be applied in addition to all the other ones, in any case.\n\nThe next step is to compare the timings of the above code to Tom's suggestion.  If there is no noticeable speed difference, we should go with Tom's suggestion as it provides for cleaner code.  Otherwise, we should leave it done in the above patches.  We'll see.",
    "created_at": "2010-01-19T04:19:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18651",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:20" align="right">comment:20</div>

Attachment: **[trac3436_rb_poly.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_rb_poly.patch.gz)**

Tom suggested that we should change the code for random matrix generation over cyclotomic fields to rely on the random element generation code in the cyclotomic field, mostly in order to reduce code size.

The patch above now ensures that the polynomial quotient rings (and number fields) pass on additional arguments.

This patch should be applied in addition to all the other ones, in any case.

The next step is to compare the timings of the above code to Tom's suggestion.  If there is no noticeable speed difference, we should go with Tom's suggestion as it provides for cleaner code.  Otherwise, we should leave it done in the above patches.  We'll see.



---

archive/issue_comments_018652.json:
```json
{
    "body": "Attachment: **[trac3436-tb.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436-tb.patch.gz)**",
    "created_at": "2010-01-19T04:22:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18652",
    "user": "https://github.com/boothby"
}
```

Attachment: **[trac3436-tb.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436-tb.patch.gz)**



---

archive/issue_comments_018653.json:
```json
{
    "body": "Addendum to the last patch on polynomial quotients",
    "created_at": "2010-01-19T04:34:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18653",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Addendum to the last patch on polynomial quotients



---

archive/issue_comments_018654.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nAttachment: **[trac3436_rb_poly2.2.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_rb_poly2.2.patch.gz)**\n\nHere are the timings for the code that Tom wrote, which gets rid of the \"ugly\" code I wrote for generating the random matrices over cyclotomic fields and instead uses the generic code of random elements in cyclotomic fields (implemented by two of the patches above):\n\n```\nsage: MS = MatrixSpace(CyclotomicField(10), 100, 100)\nsage: time A = MS.random_element()\nCPU times: user 27.11 s, sys: 0.35 s, total: 27.46 s\nWall time: 27.46 s\n```\n\nI suspect that the slowness of this code is largely due to the fact that for every random element of the cyclotomic field, two conversions take place.  One of a random list of rationals into the polynomial ring, and then another of that polynomial into the polynomial quotient ring.\n\nI don't think there is much we can do about this at the moment.  Thus, I propose that we should apply all of the patches on this ticket apart from ``trac3436-tb.patch``.  I'll flatten them a little, (1) main patch (2) ``random_element`` in polynomial rings, polynomial quotient rings, and number fields.  Hopefully, this will then pass all doctests and we'll be done.\n\nAny comments?\n\nPS: Of course, I'll include the fixed doctests (64-bit difference) from Tom's patch.",
    "created_at": "2010-01-19T04:49:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18654",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:21" align="right">comment:21</div>

Attachment: **[trac3436_rb_poly2.2.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_rb_poly2.2.patch.gz)**

Here are the timings for the code that Tom wrote, which gets rid of the "ugly" code I wrote for generating the random matrices over cyclotomic fields and instead uses the generic code of random elements in cyclotomic fields (implemented by two of the patches above):

```
sage: MS = MatrixSpace(CyclotomicField(10), 100, 100)
sage: time A = MS.random_element()
CPU times: user 27.11 s, sys: 0.35 s, total: 27.46 s
Wall time: 27.46 s
```

I suspect that the slowness of this code is largely due to the fact that for every random element of the cyclotomic field, two conversions take place.  One of a random list of rationals into the polynomial ring, and then another of that polynomial into the polynomial quotient ring.

I don't think there is much we can do about this at the moment.  Thus, I propose that we should apply all of the patches on this ticket apart from ``trac3436-tb.patch``.  I'll flatten them a little, (1) main patch (2) ``random_element`` in polynomial rings, polynomial quotient rings, and number fields.  Hopefully, this will then pass all doctests and we'll be done.

Any comments?

PS: Of course, I'll include the fixed doctests (64-bit difference) from Tom's patch.



---

archive/issue_comments_018655.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI'll eat crow here -- spancratz's implementation is so much faster, we'd be dumb not to use it.  I'll test a clean build once you post the new patches.",
    "created_at": "2010-01-19T04:54:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18655",
    "user": "https://github.com/boothby"
}
```

<div id="comment:22" align="right">comment:22</div>

I'll eat crow here -- spancratz's implementation is so much faster, we'd be dumb not to use it.  I'll test a clean build once you post the new patches.



---

archive/issue_comments_018656.json:
```json
{
    "body": "Main patch",
    "created_at": "2010-01-19T05:25:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18656",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Main patch



---

archive/issue_comments_018657.json:
```json
{
    "body": "Attachment: **[trac3436_main.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_main.patch.gz)**\n\nAttachment: **[trac3436_poly.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_poly.patch.gz)**\n\nPolynomial part",
    "created_at": "2010-01-19T05:26:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18657",
    "user": "https://github.com/sagetrac-spancratz"
}
```

Attachment: **[trac3436_main.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_main.patch.gz)**

Attachment: **[trac3436_poly.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_poly.patch.gz)**

Polynomial part



---

archive/issue_comments_018658.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI've now uploaded all the work we did in two patches, one for the matrix generation (and all the additional code all over the place necessary) as ``trac3436_main.patch`` and another one for the polynomial quotient ring (and number field) part as ``trac3436_poly.patch``.\n\nI am running tests now.  I've got the feeling that it might fail doctests in two files on the remote machine at Oxford but that it'll pass those on my local machine.  But we'll see.  I'll report back once that's done.\n\nSebastian",
    "created_at": "2010-01-19T05:32:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18658",
    "user": "https://github.com/sagetrac-spancratz"
}
```

<div id="comment:23" align="right">comment:23</div>

I've now uploaded all the work we did in two patches, one for the matrix generation (and all the additional code all over the place necessary) as ``trac3436_main.patch`` and another one for the polynomial quotient ring (and number field) part as ``trac3436_poly.patch``.

I am running tests now.  I've got the feeling that it might fail doctests in two files on the remote machine at Oxford but that it'll pass those on my local machine.  But we'll see.  I'll report back once that's done.

Sebastian



---

archive/issue_comments_018659.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nSo I'm tempted to (re-)propose a fix in the other direction. As Tom noted, the problem with the \"smaller\" bit of code is that generating random elements in a cyclotomic field is insanely slow. Rather than program around that, why not fix it? I'm going to sit down and look at this now ...",
    "created_at": "2010-01-19T05:42:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18659",
    "user": "https://github.com/craigcitro"
}
```

<div id="comment:24" align="right">comment:24</div>

So I'm tempted to (re-)propose a fix in the other direction. As Tom noted, the problem with the "smaller" bit of code is that generating random elements in a cyclotomic field is insanely slow. Rather than program around that, why not fix it? I'm going to sit down and look at this now ...



---

archive/issue_comments_018660.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nAttachment: **[trac3436_whitespace.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_whitespace.patch.gz)**\n\nI attached a minor patch that fixes two whitespace problems in the doctests that caused failures.\n\nCurrent patch list:\n\ntrac3436_main.patch\ntrac3436_poly.patch\ntrac3436_whitespace.patch",
    "created_at": "2010-01-19T06:00:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18660",
    "user": "https://github.com/wjp"
}
```

<div id="comment:25" align="right">comment:25</div>

Attachment: **[trac3436_whitespace.patch.gz](https://github.com/sagemath/sage/files/ticket3436/trac3436_whitespace.patch.gz)**

I attached a minor patch that fixes two whitespace problems in the doctests that caused failures.

Current patch list:

trac3436_main.patch
trac3436_poly.patch
trac3436_whitespace.patch



---

archive/issue_comments_018661.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOkay, so I'm finally convinced. I just spent some time optimizing generation of random number field elements, and got something like a ~150X speedup -- and the resulting randomization for cyclotomic matrices was **still** something like six times slower than the original version. So I'm going to make a new ticket with that code, but I think the code that Sebastian's been writing is definitely the winner. (Tom said he was going to review it in the morning, so I'll let him do that.)\n\nThe underlying reason for the speed difference is easy to understand -- we represent elements of number fields as NTL polynomials, so the process of randomly generating the matrix entries involves a huge number of copies of the data: once from sage Integers to NTL integers in generating a random element of the number field, and then *two* copies (due to the way things are getting moved around) in moving the values from the NTL polynomial into the matrix entries. There's just no way this is going to beat code that just generates entries down the line right in the matrix.\n\nI'll add a note on this ticket once I clean up and post the faster number field random element code ...",
    "created_at": "2010-01-19T09:16:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18661",
    "user": "https://github.com/craigcitro"
}
```

<div id="comment:26" align="right">comment:26</div>

Okay, so I'm finally convinced. I just spent some time optimizing generation of random number field elements, and got something like a ~150X speedup -- and the resulting randomization for cyclotomic matrices was **still** something like six times slower than the original version. So I'm going to make a new ticket with that code, but I think the code that Sebastian's been writing is definitely the winner. (Tom said he was going to review it in the morning, so I'll let him do that.)

The underlying reason for the speed difference is easy to understand -- we represent elements of number fields as NTL polynomials, so the process of randomly generating the matrix entries involves a huge number of copies of the data: once from sage Integers to NTL integers in generating a random element of the number field, and then *two* copies (due to the way things are getting moved around) in moving the values from the NTL polynomial into the matrix entries. There's just no way this is going to beat code that just generates entries down the line right in the matrix.

I'll add a note on this ticket once I clean up and post the faster number field random element code ...



---

archive/issue_events_037075.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2010-01-19T20:53:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37075"
}
```



---

archive/issue_events_037076.json:
```json
{
    "actor": "https://github.com/boothby",
    "created_at": "2010-01-19T20:53:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37076"
}
```



---

archive/issue_comments_018662.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nLooks good / all tests pass.",
    "created_at": "2010-01-19T20:53:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18662",
    "user": "https://github.com/boothby"
}
```

<div id="comment:27" align="right">comment:27</div>

Looks good / all tests pass.



---

archive/issue_comments_018663.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nFor the sake of it, I thought I'd mention that I posted my random number field element code at #8007. If we one day move away from NTL for representing elements of polynomials, I think that the \"generic\" approach Tom and I were trying to push above would probably be a good thing.",
    "created_at": "2010-01-20T04:54:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18663",
    "user": "https://github.com/craigcitro"
}
```

<div id="comment:28" align="right">comment:28</div>

For the sake of it, I thought I'd mention that I posted my random number field element code at #8007. If we one day move away from NTL for representing elements of polynomials, I think that the "generic" approach Tom and I were trying to push above would probably be a good thing.



---

archive/issue_comments_018664.json:
```json
{
    "body": "Changed author from **spancratz** to **Sebastian Pancratz**",
    "created_at": "2010-01-24T00:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18664",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Changed author from **spancratz** to **Sebastian Pancratz**



---

archive/issue_comments_018665.json:
```json
{
    "body": "Merged: **sage-4.3.2.alpha0**",
    "created_at": "2010-01-24T00:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18665",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Merged: **sage-4.3.2.alpha0**



---

archive/issue_comments_018666.json:
```json
{
    "body": "Reviewer: **Tom Boothby, Craig Citro**",
    "created_at": "2010-01-24T00:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18666",
    "user": "https://github.com/sagetrac-mvngu"
}
```

Reviewer: **Tom Boothby, Craig Citro**



---

archive/issue_comments_018667.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nMerged patches in this order:\n\n1. [trac3436_main.patch](https://github.com/sagemath/sage/files/ticket3436/trac3436_main.patch.gz)\n2. [trac3436_poly.patch](https://github.com/sagemath/sage/files/ticket3436/trac3436_poly.patch.gz)\n3. [trac3436_whitespace.patch](https://github.com/sagemath/sage/files/ticket3436/trac3436_whitespace.patch.gz)",
    "created_at": "2010-01-24T00:28:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3436#issuecomment-18667",
    "user": "https://github.com/sagetrac-mvngu"
}
```

<div id="comment:29" align="right">comment:29</div>

Merged patches in this order:

1. [trac3436_main.patch](https://github.com/sagemath/sage/files/ticket3436/trac3436_main.patch.gz)
2. [trac3436_poly.patch](https://github.com/sagemath/sage/files/ticket3436/trac3436_poly.patch.gz)
3. [trac3436_whitespace.patch](https://github.com/sagemath/sage/files/ticket3436/trac3436_whitespace.patch.gz)



---

archive/issue_events_037077.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-24T00:28:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37077"
}
```



---

archive/issue_events_037078.json:
```json
{
    "actor": "https://github.com/sagetrac-mvngu",
    "created_at": "2010-01-24T00:28:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3436",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3436#event-37078"
}
```
