# Issue 3436: random_matrix() with prescribed density buggy

archive/issues_003436.json:
```json
{
    "body": "Matrices with prescribed density are not generated correctly:\n\n```\nsage: M = random_matrix(GF(65537), 100, 100, sparse=True, density=0.1)\nsage: len(M.nonzero_positions())\n940\nsage: M = random_matrix(GF(2), 100, 100, sparse=True, density=0.1)\nsage: len(M.nonzero_positions())\n465\n```\n\nTo wit: the actual density of the matrix over GF(2) is only approximately half of what we expect. This happens because the randomize() function populating the entries does not check whether the random element picked actually is non-zero. Apparently, all of the matrix classes are affected by this bug.\n\nAssignee: @williamstein\n\nCC:  @craigcitro\n\nResolution: fixed\n\nAuthor: Sebastian Pancratz\n\nReviewer: Tom Boothby, Craig Citro\n\nMerged: sage-4.3.2.alpha0\n\nIssue created by migration from https://trac.sagemath.org/ticket/3436\n\n",
    "closed_at": "2010-01-24T00:28:15Z",
    "created_at": "2008-06-16T04:56:11Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.3.2",
    "title": "random_matrix() with prescribed density buggy",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/3436",
    "user": "https://trac.sagemath.org/admin/accounts/users/rpw"
}
```
Matrices with prescribed density are not generated correctly:

```
sage: M = random_matrix(GF(65537), 100, 100, sparse=True, density=0.1)
sage: len(M.nonzero_positions())
940
sage: M = random_matrix(GF(2), 100, 100, sparse=True, density=0.1)
sage: len(M.nonzero_positions())
465
```

To wit: the actual density of the matrix over GF(2) is only approximately half of what we expect. This happens because the randomize() function populating the entries does not check whether the random element picked actually is non-zero. Apparently, all of the matrix classes are affected by this bug.

Assignee: @williamstein

CC:  @craigcitro

Resolution: fixed

Author: Sebastian Pancratz

Reviewer: Tom Boothby, Craig Citro

Merged: sage-4.3.2.alpha0

Issue created by migration from https://trac.sagemath.org/ticket/3436





---

archive/issue_events_010104.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-06-16T04:58:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "milestone": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3436#event-10104"
}
```



---

archive/issue_comments_027718.json:
```json
{
    "body": "<a id='comment:2'></a>\nI'll also point out that the documentation for random_matrix says that density should be an integer, not a float -- see also randomize in matrix2.pyx and random_element in matrix_space.py -- while in matrix_integer_dense.pyx, randomize says that density should be a float.",
    "created_at": "2009-02-07T00:11:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27718",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
I'll also point out that the documentation for random_matrix says that density should be an integer, not a float -- see also randomize in matrix2.pyx and random_element in matrix_space.py -- while in matrix_integer_dense.pyx, randomize says that density should be a float.



---

archive/issue_comments_027719.json:
```json
{
    "body": "<a id='comment:3'></a>\nSome more examples with sage 4.1.  The last few examples show that the density is about an order of magnitude smaller than what we asked for.\n\n```\nsage: A=random_matrix(ZZ,1000,density=1e-3,sparse=True)  \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n0.000814000000000000\nsage: A=random_matrix(ZZ,10000,density=1e-4,sparse=True)  \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n0.0000796700000000000\nsage: A=random_matrix(ZZ,100000,density=1e-5,sparse=True) \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n1.13230000000000e-6\nsage: A=random_matrix(ZZ,100000,density=1e-6,sparse=True) \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n1.12600000000000e-7\nsage: A=random_matrix(ZZ,100000,density=1e-7,sparse=True) \nsage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())\n1.08000000000000e-8\n```",
    "created_at": "2009-07-20T14:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27719",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:3'></a>
Some more examples with sage 4.1.  The last few examples show that the density is about an order of magnitude smaller than what we asked for.

```
sage: A=random_matrix(ZZ,1000,density=1e-3,sparse=True)  
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
0.000814000000000000
sage: A=random_matrix(ZZ,10000,density=1e-4,sparse=True)  
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
0.0000796700000000000
sage: A=random_matrix(ZZ,100000,density=1e-5,sparse=True) 
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
1.13230000000000e-6
sage: A=random_matrix(ZZ,100000,density=1e-6,sparse=True) 
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
1.12600000000000e-7
sage: A=random_matrix(ZZ,100000,density=1e-7,sparse=True) 
sage: RR(len(A.nonzero_positions()))/(A.nrows()*A.ncols())
1.08000000000000e-8
```



---

archive/issue_comments_027720.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [jason](#comment%3A3):\n> Some more examples with sage 4.1.  The last few examples show that the density is about an order of magnitude smaller than what we asked for.\n\n\nWhen I tried this, I got answers like the first two: the ratio of (fraction of nonzero entries) / (density) was about 4/5.  This is consistent with the observation in the ticket description that the randomize function doesn't check whether the random element is zero: for integers, the documentation for `random_element` says that the default distribution gives `Pr(X = 0) = 1/5`. \n\nI would try to write a patch for this but pretty much all of the matrix code is written in Cython, which I don't know, so anything I write would likely be buggy and slow things down by a factor of 100.",
    "created_at": "2009-09-30T03:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27720",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
Replying to [jason](#comment%3A3):
> Some more examples with sage 4.1.  The last few examples show that the density is about an order of magnitude smaller than what we asked for.


When I tried this, I got answers like the first two: the ratio of (fraction of nonzero entries) / (density) was about 4/5.  This is consistent with the observation in the ticket description that the randomize function doesn't check whether the random element is zero: for integers, the documentation for `random_element` says that the default distribution gives `Pr(X = 0) = 1/5`. 

I would try to write a patch for this but pretty much all of the matrix code is written in Cython, which I don't know, so anything I write would likely be buggy and slow things down by a factor of 100.



---

archive/issue_comments_027721.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttached a patch.  It introduces a new method in ``ring.pyx``, ``_random_nonzero_element``, which by default calls ``random_element`` until a non-zero element has been obtained.\n\nOn the matrix end, I've introduced a new parameter ``nonzero`` to the ``randomize`` methods in the various matrix implementations.  If this is set to ``True``, the modified entries are guaranteed to be non-zero, whereas if it is set to ``False`` they are not.  The method ``random_element`` on a matrix space now calls ``randomize`` on a zero matrix with ``nonzero=True``.\n\nFinally, this is now also used to ensure that generating a fraction field element does not cause a division by zero error.\n\nSebastian",
    "created_at": "2010-01-17T10:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27721",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:5'></a>
Attached a patch.  It introduces a new method in ``ring.pyx``, ``_random_nonzero_element``, which by default calls ``random_element`` until a non-zero element has been obtained.

On the matrix end, I've introduced a new parameter ``nonzero`` to the ``randomize`` methods in the various matrix implementations.  If this is set to ``True``, the modified entries are guaranteed to be non-zero, whereas if it is set to ``False`` they are not.  The method ``random_element`` on a matrix space now calls ``randomize`` on a zero matrix with ``nonzero=True``.

Finally, this is now also used to ensure that generating a fraction field element does not cause a division by zero error.

Sebastian



---

archive/issue_comments_027722.json:
```json
{
    "body": "Author: spancratz",
    "created_at": "2010-01-17T10:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27722",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Author: spancratz



---

archive/issue_comments_027723.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-01-17T10:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27723",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_027724.json:
```json
{
    "body": "Upstream: N/A",
    "created_at": "2010-01-17T10:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27724",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Upstream: N/A



---

archive/issue_comments_027725.json:
```json
{
    "body": "Attachment [trac3436_a.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_a.patch) by spancratz created at 2010-01-17 10:52:52\n\nFirst patch",
    "created_at": "2010-01-17T10:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27725",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Attachment [trac3436_a.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_a.patch) by spancratz created at 2010-01-17 10:52:52

First patch



---

archive/issue_comments_027726.json:
```json
{
    "body": "<a id='comment:6'></a>\nI've attached the patch now.  I've called it \"First patch\" since I've only doctested ``sage/matrix/`` and adjusted some docstrings as needed, but I expect that a few more such little changes might come up during a full test.\n\nSebastian",
    "created_at": "2010-01-17T10:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27726",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:6'></a>
I've attached the patch now.  I've called it "First patch" since I've only doctested ``sage/matrix/`` and adjusted some docstrings as needed, but I expect that a few more such little changes might come up during a full test.

Sebastian



---

archive/issue_comments_027727.json:
```json
{
    "body": "Attachment [trac3436_b.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_b.patch) by spancratz created at 2010-01-17 19:46:56\n\nAdditional patch (more doctests)",
    "created_at": "2010-01-17T19:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27727",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Attachment [trac3436_b.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_b.patch) by spancratz created at 2010-01-17 19:46:56

Additional patch (more doctests)



---

archive/issue_comments_027728.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe additional patch takes care of the remaining three doctest failures.  This should now pass all doctests done with ``./sage -t devel/sage/sage``.\n\nSebastian",
    "created_at": "2010-01-17T19:48:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27728",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:7'></a>
The additional patch takes care of the remaining three doctest failures.  This should now pass all doctests done with ``./sage -t devel/sage/sage``.

Sebastian



---

archive/issue_comments_027729.json:
```json
{
    "body": "<a id='comment:8'></a>\nThis looks good with one notable exception.  Due to implementation details, Matrix_cyclo_dense.randomize() makes overly dense matrices.  This should be pretty easy to fix.",
    "created_at": "2010-01-18T08:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27729",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:8'></a>
This looks good with one notable exception.  Due to implementation details, Matrix_cyclo_dense.randomize() makes overly dense matrices.  This should be pretty easy to fix.



---

archive/issue_comments_027730.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2010-01-18T08:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27730",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_027731.json:
```json
{
    "body": "<a id='comment:9'></a>\nI mentioned this to Tom, but just in case no one gets to it: implementing this for cyclotomic matrices should be pretty easy once you find out about the `set_unsafe` method on dense cyclotomic matrices. You can use the same generic code that loops over any other matrix, but use `set_unsafe` and (as long as you're really not going outside the bounds of the matrix!) it'll take care of setting the entry in the matrix correctly and quickly.",
    "created_at": "2010-01-18T08:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27731",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:9'></a>
I mentioned this to Tom, but just in case no one gets to it: implementing this for cyclotomic matrices should be pretty easy once you find out about the `set_unsafe` method on dense cyclotomic matrices. You can use the same generic code that loops over any other matrix, but use `set_unsafe` and (as long as you're really not going outside the bounds of the matrix!) it'll take care of setting the entry in the matrix correctly and quickly.



---

archive/issue_comments_027732.json:
```json
{
    "body": "<a id='comment:10'></a>\nCraig:  the approach you suggest does not seem to work out quite as nicely, since the ``randomize`` method accepts two parameters ``num_bound`` and ``den_bound``, which are accept by the rational field but *not* by the cyclotomic field.  A way around this problem is to generate the cyclotomic numbers ourselves in the matrix method, as a sequence of rationals of length the degree of the field extension.  I'll write that now.\n\nSebastian",
    "created_at": "2010-01-18T18:59:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27732",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:10'></a>
Craig:  the approach you suggest does not seem to work out quite as nicely, since the ``randomize`` method accepts two parameters ``num_bound`` and ``den_bound``, which are accept by the rational field but *not* by the cyclotomic field.  A way around this problem is to generate the cyclotomic numbers ourselves in the matrix method, as a sequence of rationals of length the degree of the field extension.  I'll write that now.

Sebastian



---

archive/issue_comments_027733.json:
```json
{
    "body": "<a id='comment:11'></a>\nI'm a little confused -- why aren't we just using `K.random_element()` where `K` is whatever ring the entries lie in? The `num_bound` and `den_bound` definitely aren't uniform, though we could definitely easily add them for cyclotomic fields ...",
    "created_at": "2010-01-18T19:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27733",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:11'></a>
I'm a little confused -- why aren't we just using `K.random_element()` where `K` is whatever ring the entries lie in? The `num_bound` and `den_bound` definitely aren't uniform, though we could definitely easily add them for cyclotomic fields ...



---

archive/issue_comments_027734.json:
```json
{
    "body": "<a id='comment:12'></a>\nI think that is the same reason why certain matrices have their ``randomize`` methods implemented themselves in the very first place:  speed.\n\nPersonally, I don't really care about this (the speed of generating random matrices), but since others do, I don't think this patch should make anything significantly slower.",
    "created_at": "2010-01-18T20:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27734",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:12'></a>
I think that is the same reason why certain matrices have their ``randomize`` methods implemented themselves in the very first place:  speed.

Personally, I don't really care about this (the speed of generating random matrices), but since others do, I don't think this patch should make anything significantly slower.



---

archive/issue_comments_027735.json:
```json
{
    "body": "<a id='comment:13'></a>\n> Personally, I don't really care about this (the speed of generating random matrices),\n\n\nI care because this gets used a *LOT* in benchmarking and automated testing of linear algebra algorithms.",
    "created_at": "2010-01-18T22:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27735",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:13'></a>
> Personally, I don't really care about this (the speed of generating random matrices),


I care because this gets used a *LOT* in benchmarking and automated testing of linear algebra algorithms.



---

archive/issue_comments_027736.json:
```json
{
    "body": "<a id='comment:14'></a>\nall that has to happen here is\n\n1) write a for loop that fills in the entries with set_unsafe\n\n2) update the polynomial quotient ring and numberfield random_element methods to pass *args and **kwargs down the line.",
    "created_at": "2010-01-18T22:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27736",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:14'></a>
all that has to happen here is

1) write a for loop that fills in the entries with set_unsafe

2) update the polynomial quotient ring and numberfield random_element methods to pass *args and **kwargs down the line.



---

archive/issue_comments_027737.json:
```json
{
    "body": "<a id='comment:15'></a>\nTom, before you wrote your message, I already wrote the code for the randomize method, by including a _randomize_column method in matrix_rational_dense, and this is then used in the cyclotomic matrix code.  This way, the code doesn't have to modify any more classes than it does already.  I'll do some testing and upload it later.\n\nAlso, I talked to Robert Miller and he said this patch needs to be re-based to 4.3.1.rc0, so I'll do that, too.\n\nSebastian",
    "created_at": "2010-01-18T23:16:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27737",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:15'></a>
Tom, before you wrote your message, I already wrote the code for the randomize method, by including a _randomize_column method in matrix_rational_dense, and this is then used in the cyclotomic matrix code.  This way, the code doesn't have to modify any more classes than it does already.  I'll do some testing and upload it later.

Also, I talked to Robert Miller and he said this patch needs to be re-based to 4.3.1.rc0, so I'll do that, too.

Sebastian



---

archive/issue_comments_027738.json:
```json
{
    "body": "<a id='comment:16'></a>\nI view the fact that the random_element methods don't pass *args and **kwargs down the line as a bug -- and if you have to rebase, we might as well fix those up too.  Moreover, I'm not convinced that randomizing columns is the right way to go -- though I haven't seen your implementation, so I might be wrong.",
    "created_at": "2010-01-19T01:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27738",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:16'></a>
I view the fact that the random_element methods don't pass *args and **kwargs down the line as a bug -- and if you have to rebase, we might as well fix those up too.  Moreover, I'm not convinced that randomizing columns is the right way to go -- though I haven't seen your implementation, so I might be wrong.



---

archive/issue_comments_027739.json:
```json
{
    "body": "<a id='comment:17'></a>\nI've now finished the implementation, but I still need to re-base it.  Here are some timings.  First, the old implementation:\n\n```\nsage: MS = MatrixSpace(CyclotomicField(10), 100, 100)\nsage: timeit('A = MS.random_element()')\n25 loops, best of 3: 17.5 ms per loop\nsage: timeit('A = MS.random_element(density=0.1)')\n25 loops, best of 3: 8.89 ms per loop\nsage: A = MS.random_element(density=0.1)\nsage: n(len(A.nonzero_positions())/10000)\n0.231700000000000\n```\nSecond, the new implementation:\n\n```\nsage: MS = MatrixSpace(CyclotomicField(10), 100, 100)\nsage: timeit('A = MS.random_element()')\n25 loops, best of 3: 22 ms per loop\nsage: timeit('A = MS.random_element(density=0.1)')\n25 loops, best of 3: 9.36 ms per loop\nsage: timeit('A = MS.random_element(density=0.1, nonzero=True)')\n25 loops, best of 3: 9.35 ms per loop\nsage: timeit('A = MS.random_element(density=0.1, nonzero=False)')\n25 loops, best of 3: 9.37 ms per loop\nsage: A = MS.random_element(density=0.1, nonzero=True)\nsage: n(len(A.nonzero_positions())/10000)\n0.0963000000000000\n```",
    "created_at": "2010-01-19T01:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27739",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:17'></a>
I've now finished the implementation, but I still need to re-base it.  Here are some timings.  First, the old implementation:

```
sage: MS = MatrixSpace(CyclotomicField(10), 100, 100)
sage: timeit('A = MS.random_element()')
25 loops, best of 3: 17.5 ms per loop
sage: timeit('A = MS.random_element(density=0.1)')
25 loops, best of 3: 8.89 ms per loop
sage: A = MS.random_element(density=0.1)
sage: n(len(A.nonzero_positions())/10000)
0.231700000000000
```
Second, the new implementation:

```
sage: MS = MatrixSpace(CyclotomicField(10), 100, 100)
sage: timeit('A = MS.random_element()')
25 loops, best of 3: 22 ms per loop
sage: timeit('A = MS.random_element(density=0.1)')
25 loops, best of 3: 9.36 ms per loop
sage: timeit('A = MS.random_element(density=0.1, nonzero=True)')
25 loops, best of 3: 9.35 ms per loop
sage: timeit('A = MS.random_element(density=0.1, nonzero=False)')
25 loops, best of 3: 9.37 ms per loop
sage: A = MS.random_element(density=0.1, nonzero=True)
sage: n(len(A.nonzero_positions())/10000)
0.0963000000000000
```



---

archive/issue_comments_027740.json:
```json
{
    "body": "Third patch, for matrices over cyclotomic fields",
    "created_at": "2010-01-19T01:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27740",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Third patch, for matrices over cyclotomic fields



---

archive/issue_comments_027741.json:
```json
{
    "body": "Attachment [trac3436_rb.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_rb.patch) by spancratz created at 2010-01-19 02:22:57\n\nRebase of the first three patches to 4.3.1.rc0",
    "created_at": "2010-01-19T02:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27741",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Attachment [trac3436_rb.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_rb.patch) by spancratz created at 2010-01-19 02:22:57

Rebase of the first three patches to 4.3.1.rc0



---

archive/issue_comments_027742.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2010-01-19T02:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27742",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_027743.json:
```json
{
    "body": "<a id='comment:18'></a>\nI've now re-based the patch.  I still need to run tests, I'll write back later to confirm if everything passes.\n\nTom, which random element methods are you referring to?\n\nSebastian",
    "created_at": "2010-01-19T02:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27743",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:18'></a>
I've now re-based the patch.  I still need to run tests, I'll write back later to confirm if everything passes.

Tom, which random element methods are you referring to?

Sebastian



---

archive/issue_comments_027744.json:
```json
{
    "body": "<a id='comment:19'></a>\nThe re-base makes *lots* of doctests fail, I'll update the patch and post another one when I am done.\n\nSebastian",
    "created_at": "2010-01-19T02:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27744",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:19'></a>
The re-base makes *lots* of doctests fail, I'll update the patch and post another one when I am done.

Sebastian



---

archive/issue_comments_027745.json:
```json
{
    "body": "Fixes the doctests for the rebase",
    "created_at": "2010-01-19T03:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27745",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Fixes the doctests for the rebase



---

archive/issue_comments_027746.json:
```json
{
    "body": "Attachment [trac3436_rb_doctests.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_rb_doctests.patch) by spancratz created at 2010-01-19 04:16:22\n\nrandom_element method in polynomial quotient rings (and number fields) passes on args and kwds",
    "created_at": "2010-01-19T04:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27746",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Attachment [trac3436_rb_doctests.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_rb_doctests.patch) by spancratz created at 2010-01-19 04:16:22

random_element method in polynomial quotient rings (and number fields) passes on args and kwds



---

archive/issue_comments_027747.json:
```json
{
    "body": "<a id='comment:20'></a>\nAttachment [trac3436_rb_poly.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_rb_poly.patch) by spancratz created at 2010-01-19 04:19:45\n\nTom suggested that we should change the code for random matrix generation over cyclotomic fields to rely on the random element generation code in the cyclotomic field, mostly in order to reduce code size.\n\nThe patch above now ensures that the polynomial quotient rings (and number fields) pass on additional arguments.\n\nThis patch should be applied in addition to all the other ones, in any case.\n\nThe next step is to compare the timings of the above code to Tom's suggestion.  If there is no noticeable speed difference, we should go with Tom's suggestion as it provides for cleaner code.  Otherwise, we should leave it done in the above patches.  We'll see.",
    "created_at": "2010-01-19T04:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27747",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:20'></a>
Attachment [trac3436_rb_poly.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_rb_poly.patch) by spancratz created at 2010-01-19 04:19:45

Tom suggested that we should change the code for random matrix generation over cyclotomic fields to rely on the random element generation code in the cyclotomic field, mostly in order to reduce code size.

The patch above now ensures that the polynomial quotient rings (and number fields) pass on additional arguments.

This patch should be applied in addition to all the other ones, in any case.

The next step is to compare the timings of the above code to Tom's suggestion.  If there is no noticeable speed difference, we should go with Tom's suggestion as it provides for cleaner code.  Otherwise, we should leave it done in the above patches.  We'll see.



---

archive/issue_comments_027748.json:
```json
{
    "body": "Attachment [trac3436-tb.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436-tb.patch) by boothby created at 2010-01-19 04:22:09",
    "created_at": "2010-01-19T04:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27748",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

Attachment [trac3436-tb.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436-tb.patch) by boothby created at 2010-01-19 04:22:09



---

archive/issue_comments_027749.json:
```json
{
    "body": "Addendum to the last patch on polynomial quotients",
    "created_at": "2010-01-19T04:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27749",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Addendum to the last patch on polynomial quotients



---

archive/issue_comments_027750.json:
```json
{
    "body": "<a id='comment:21'></a>\nAttachment [trac3436_rb_poly2.2.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_rb_poly2.2.patch) by spancratz created at 2010-01-19 04:49:46\n\nHere are the timings for the code that Tom wrote, which gets rid of the \"ugly\" code I wrote for generating the random matrices over cyclotomic fields and instead uses the generic code of random elements in cyclotomic fields (implemented by two of the patches above):\n\n```\nsage: MS = MatrixSpace(CyclotomicField(10), 100, 100)\nsage: time A = MS.random_element()\nCPU times: user 27.11 s, sys: 0.35 s, total: 27.46 s\nWall time: 27.46 s\n```\n\nI suspect that the slowness of this code is largely due to the fact that for every random element of the cyclotomic field, two conversions take place.  One of a random list of rationals into the polynomial ring, and then another of that polynomial into the polynomial quotient ring.\n\nI don't think there is much we can do about this at the moment.  Thus, I propose that we should apply all of the patches on this ticket apart from ``trac3436-tb.patch``.  I'll flatten them a little, (1) main patch (2) ``random_element`` in polynomial rings, polynomial quotient rings, and number fields.  Hopefully, this will then pass all doctests and we'll be done.\n\nAny comments?\n\nPS: Of course, I'll include the fixed doctests (64-bit difference) from Tom's patch.",
    "created_at": "2010-01-19T04:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27750",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:21'></a>
Attachment [trac3436_rb_poly2.2.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_rb_poly2.2.patch) by spancratz created at 2010-01-19 04:49:46

Here are the timings for the code that Tom wrote, which gets rid of the "ugly" code I wrote for generating the random matrices over cyclotomic fields and instead uses the generic code of random elements in cyclotomic fields (implemented by two of the patches above):

```
sage: MS = MatrixSpace(CyclotomicField(10), 100, 100)
sage: time A = MS.random_element()
CPU times: user 27.11 s, sys: 0.35 s, total: 27.46 s
Wall time: 27.46 s
```

I suspect that the slowness of this code is largely due to the fact that for every random element of the cyclotomic field, two conversions take place.  One of a random list of rationals into the polynomial ring, and then another of that polynomial into the polynomial quotient ring.

I don't think there is much we can do about this at the moment.  Thus, I propose that we should apply all of the patches on this ticket apart from ``trac3436-tb.patch``.  I'll flatten them a little, (1) main patch (2) ``random_element`` in polynomial rings, polynomial quotient rings, and number fields.  Hopefully, this will then pass all doctests and we'll be done.

Any comments?

PS: Of course, I'll include the fixed doctests (64-bit difference) from Tom's patch.



---

archive/issue_comments_027751.json:
```json
{
    "body": "<a id='comment:22'></a>\nI'll eat crow here -- spancratz's implementation is so much faster, we'd be dumb not to use it.  I'll test a clean build once you post the new patches.",
    "created_at": "2010-01-19T04:54:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27751",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:22'></a>
I'll eat crow here -- spancratz's implementation is so much faster, we'd be dumb not to use it.  I'll test a clean build once you post the new patches.



---

archive/issue_comments_027752.json:
```json
{
    "body": "Main patch",
    "created_at": "2010-01-19T05:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27752",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Main patch



---

archive/issue_comments_027753.json:
```json
{
    "body": "Attachment [trac3436_poly.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_poly.patch) by spancratz created at 2010-01-19 05:26:18\n\nPolynomial part",
    "created_at": "2010-01-19T05:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27753",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

Attachment [trac3436_poly.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_poly.patch) by spancratz created at 2010-01-19 05:26:18

Polynomial part



---

archive/issue_comments_027754.json:
```json
{
    "body": "<a id='comment:23'></a>\nI've now uploaded all the work we did in two patches, one for the matrix generation (and all the additional code all over the place necessary) as ``trac3436_main.patch`` and another one for the polynomial quotient ring (and number field) part as ``trac3436_poly.patch``.\n\nI am running tests now.  I've got the feeling that it might fail doctests in two files on the remote machine at Oxford but that it'll pass those on my local machine.  But we'll see.  I'll report back once that's done.\n\nSebastian",
    "created_at": "2010-01-19T05:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27754",
    "user": "https://trac.sagemath.org/admin/accounts/users/spancratz"
}
```

<a id='comment:23'></a>
I've now uploaded all the work we did in two patches, one for the matrix generation (and all the additional code all over the place necessary) as ``trac3436_main.patch`` and another one for the polynomial quotient ring (and number field) part as ``trac3436_poly.patch``.

I am running tests now.  I've got the feeling that it might fail doctests in two files on the remote machine at Oxford but that it'll pass those on my local machine.  But we'll see.  I'll report back once that's done.

Sebastian



---

archive/issue_comments_027755.json:
```json
{
    "body": "<a id='comment:24'></a>\nSo I'm tempted to (re-)propose a fix in the other direction. As Tom noted, the problem with the \"smaller\" bit of code is that generating random elements in a cyclotomic field is insanely slow. Rather than program around that, why not fix it? I'm going to sit down and look at this now ...",
    "created_at": "2010-01-19T05:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27755",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:24'></a>
So I'm tempted to (re-)propose a fix in the other direction. As Tom noted, the problem with the "smaller" bit of code is that generating random elements in a cyclotomic field is insanely slow. Rather than program around that, why not fix it? I'm going to sit down and look at this now ...



---

archive/issue_comments_027756.json:
```json
{
    "body": "<a id='comment:25'></a>\nAttachment [trac3436_whitespace.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_whitespace.patch) by @wjp created at 2010-01-19 06:00:34\n\nI attached a minor patch that fixes two whitespace problems in the doctests that caused failures.\n\nCurrent patch list:\n\ntrac3436_main.patch\ntrac3436_poly.patch\ntrac3436_whitespace.patch",
    "created_at": "2010-01-19T06:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27756",
    "user": "https://github.com/wjp"
}
```

<a id='comment:25'></a>
Attachment [trac3436_whitespace.patch](tarball://root/attachments/some-uuid/ticket3436/trac3436_whitespace.patch) by @wjp created at 2010-01-19 06:00:34

I attached a minor patch that fixes two whitespace problems in the doctests that caused failures.

Current patch list:

trac3436_main.patch
trac3436_poly.patch
trac3436_whitespace.patch



---

archive/issue_comments_027757.json:
```json
{
    "body": "<a id='comment:26'></a>\nOkay, so I'm finally convinced. I just spent some time optimizing generation of random number field elements, and got something like a ~150X speedup -- and the resulting randomization for cyclotomic matrices was **still** something like six times slower than the original version. So I'm going to make a new ticket with that code, but I think the code that Sebastian's been writing is definitely the winner. (Tom said he was going to review it in the morning, so I'll let him do that.)\n\nThe underlying reason for the speed difference is easy to understand -- we represent elements of number fields as NTL polynomials, so the process of randomly generating the matrix entries involves a huge number of copies of the data: once from sage Integers to NTL integers in generating a random element of the number field, and then *two* copies (due to the way things are getting moved around) in moving the values from the NTL polynomial into the matrix entries. There's just no way this is going to beat code that just generates entries down the line right in the matrix.\n\nI'll add a note on this ticket once I clean up and post the faster number field random element code ...",
    "created_at": "2010-01-19T09:16:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27757",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:26'></a>
Okay, so I'm finally convinced. I just spent some time optimizing generation of random number field elements, and got something like a ~150X speedup -- and the resulting randomization for cyclotomic matrices was **still** something like six times slower than the original version. So I'm going to make a new ticket with that code, but I think the code that Sebastian's been writing is definitely the winner. (Tom said he was going to review it in the morning, so I'll let him do that.)

The underlying reason for the speed difference is easy to understand -- we represent elements of number fields as NTL polynomials, so the process of randomly generating the matrix entries involves a huge number of copies of the data: once from sage Integers to NTL integers in generating a random element of the number field, and then *two* copies (due to the way things are getting moved around) in moving the values from the NTL polynomial into the matrix entries. There's just no way this is going to beat code that just generates entries down the line right in the matrix.

I'll add a note on this ticket once I clean up and post the faster number field random element code ...



---

archive/issue_comments_027758.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-01-19T20:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27758",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_027759.json:
```json
{
    "body": "<a id='comment:27'></a>\nLooks good / all tests pass.",
    "created_at": "2010-01-19T20:53:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27759",
    "user": "https://trac.sagemath.org/admin/accounts/users/boothby"
}
```

<a id='comment:27'></a>
Looks good / all tests pass.



---

archive/issue_comments_027760.json:
```json
{
    "body": "<a id='comment:28'></a>\nFor the sake of it, I thought I'd mention that I posted my random number field element code at #8007. If we one day move away from NTL for representing elements of polynomials, I think that the \"generic\" approach Tom and I were trying to push above would probably be a good thing.",
    "created_at": "2010-01-20T04:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27760",
    "user": "https://github.com/craigcitro"
}
```

<a id='comment:28'></a>
For the sake of it, I thought I'd mention that I posted my random number field element code at #8007. If we one day move away from NTL for representing elements of polynomials, I think that the "generic" approach Tom and I were trying to push above would probably be a good thing.



---

archive/issue_comments_027761.json:
```json
{
    "body": "Changing author from \"spancratz\" to \"Sebastian Pancratz\"",
    "created_at": "2010-01-24T00:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27761",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Changing author from "spancratz" to "Sebastian Pancratz"



---

archive/issue_comments_027762.json:
```json
{
    "body": "Merged: sage-4.3.2.alpha0",
    "created_at": "2010-01-24T00:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27762",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Merged: sage-4.3.2.alpha0



---

archive/issue_comments_027763.json:
```json
{
    "body": "Reviewer: Tom Boothby, Craig Citro",
    "created_at": "2010-01-24T00:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27763",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Reviewer: Tom Boothby, Craig Citro



---

archive/issue_comments_027764.json:
```json
{
    "body": "<a id='comment:29'></a>\nMerged patches in this order:\n\n1. [trac3436_main.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/3436/trac3436_main.patch)\n2. [trac3436_poly.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/3436/trac3436_poly.patch)\n3. [trac3436_whitespace.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/3436/trac3436_whitespace.patch)",
    "created_at": "2010-01-24T00:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27764",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

<a id='comment:29'></a>
Merged patches in this order:

1. [trac3436_main.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/3436/trac3436_main.patch)
2. [trac3436_poly.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/3436/trac3436_poly.patch)
3. [trac3436_whitespace.patch](http://trac.sagemath.org/sage_trac/attachment/ticket/3436/trac3436_whitespace.patch)



---

archive/issue_comments_027765.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-01-24T00:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3436#issuecomment-27765",
    "user": "https://trac.sagemath.org/admin/accounts/users/mvngu"
}
```

Resolution: fixed



---

archive/issue_events_010105.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mvngu",
    "created_at": "2010-01-24T00:28:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/3436",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3436#event-10105"
}
```
