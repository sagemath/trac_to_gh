# Issue 3621: sage.finance - add expand and refine finance.Stock

archive/issues_003621.json:
```json
{
    "assignees": [],
    "body": "There was an issue with Stock.historical() only returning stock information from Jan 1, 1990 onward and no earlier. The addition of an explicit enddate to the Google Finance query seems to fix this. Fix is demonstrated in the doctests of Stock.historical()\n\nUses the datetime.date python module.\n\n**Assignee:** @cswiercz\n\n**CC:**  jkantor\n\n**Keywords:** finance, historical, stock, Stock\n\nIssue created by migration from https://trac.sagemath.org/ticket/3621\n\n",
    "closed_at": "2008-11-28T08:35:56Z",
    "created_at": "2008-07-09T00:34:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20finance",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.2.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage.finance - add expand and refine finance.Stock",
    "type": "issue",
    "updated_at": "2008-11-28T08:35:56Z",
    "url": "https://github.com/sagemath/sage/issues/3621",
    "user": "https://github.com/cswiercz"
}
```
There was an issue with Stock.historical() only returning stock information from Jan 1, 1990 onward and no earlier. The addition of an explicit enddate to the Google Finance query seems to fix this. Fix is demonstrated in the doctests of Stock.historical()

Uses the datetime.date python module.

**Assignee:** @cswiercz

**CC:**  jkantor

**Keywords:** finance, historical, stock, Stock

Issue created by migration from https://trac.sagemath.org/ticket/3621





---

archive/issue_events_032257.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-09T00:34:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "milestone_number": null,
    "milestone_title": "sage-3.2.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32257"
}
```



---

archive/issue_events_032258.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-09T00:34:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20finance",
    "label_color": "08517b",
    "label_name": "component: finance",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32258"
}
```



---

archive/issue_events_032259.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-09T00:34:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32259"
}
```



---

archive/issue_events_032260.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-09T00:34:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32260"
}
```



---

archive/issue_comments_020593.json:
```json
{
    "body": "Replying to [ticket:3621 cswiercz]:\n> There was an issue with Stock.historical() only returning stock information from Jan 1, 1990 onward and no earlier. The addition of an explicit enddate to the Google Finance query seems to fix this. Fix is demonstrated in the doctests of Stock.historical()\n> \n> Uses the datetime.date python module.\n\nThis ticket depends on #3356.",
    "created_at": "2008-07-09T16:56:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20593",
    "user": "https://github.com/cswiercz"
}
```

Replying to [ticket:3621 cswiercz]:
> There was an issue with Stock.historical() only returning stock information from Jan 1, 1990 onward and no earlier. The addition of an explicit enddate to the Google Finance query seems to fix this. Fix is demonstrated in the doctests of Stock.historical()
> 
> Uses the datetime.date python module.

This ticket depends on #3356.



---

archive/issue_comments_020594.json:
```json
{
    "body": "**Changing assignee** from @cswiercz to @cswiercz, brettnak.",
    "created_at": "2008-07-18T21:38:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20594",
    "user": "https://github.com/sagetrac-brettnak"
}
```

**Changing assignee** from @cswiercz to @cswiercz, brettnak.



---

archive/issue_comments_020595.json:
```json
{
    "body": "<a id='comment:5'></a>\nadd_load_file1.patch - Split up .historical into three parts.  Added a .load_file() function that will load data from a specified file if the file formatted correctly.\neg. 'date,open,high,low,close,volume\\n...'",
    "created_at": "2008-07-21T02:51:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20595",
    "user": "https://github.com/sagetrac-brettnak"
}
```

<a id='comment:5'></a>
add_load_file1.patch - Split up .historical into three parts.  Added a .load_file() function that will load data from a specified file if the file formatted correctly.
eg. 'date,open,high,low,close,volume\n...'



---

archive/issue_comments_020596.json:
```json
{
    "body": "<a id='comment:6'></a>\n.load_file() does not work for large files due to python's .read() size limitations.  Next patch will read the file by line to get around this.",
    "created_at": "2008-07-21T03:00:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20596",
    "user": "https://github.com/sagetrac-brettnak"
}
```

<a id='comment:6'></a>
.load_file() does not work for large files due to python's .read() size limitations.  Next patch will read the file by line to get around this.



---

archive/issue_comments_020597.json:
```json
{
    "body": "**Changing assignee** from @cswiercz, brettnak to @cswiercz.",
    "created_at": "2008-07-28T02:24:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20597",
    "user": "https://github.com/cswiercz"
}
```

**Changing assignee** from @cswiercz, brettnak to @cswiercz.



---

archive/issue_events_032261.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-28T02:24:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32261"
}
```



---

archive/issue_comments_020598.json:
```json
{
    "body": "<a id='comment:8'></a>\nREFEREE REPORT:\n\nGreat work!  Now be professionals and fix everything below :-)\n\n* The function `_load_from_csv(self, R)` in stock.py is missing a doctest\n\n* I like the Day --> OHCL change. \n\n* Member functions in the Sage library should never be upper case, so\n\n```\n    def Open(self, *args, **kwds):\n```\nmust become\n\n```\n    def open(self, *args, **kwds):\n```\n\n* The doctest for Open contains `\\code{self.google()`.  Since the docstring is a string that \\c gets turned into a weird character.  You have to do either `\\\\code{self.google()` or (better) just replace `\"\"\"` at the top by `r\"\"\"`.  Same for `def Close`, etc.  \n\n* This doctest SUCKS:\n\n```\n+            sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires s\nource file\n+            [\n```\nWe actually *do* test all optional doctests sometimes, and do expect them to pass on a reasonably configured machine.   I suggest the following workaround.  Make a subdirectory of SAGE_ROOT/examples called \"finance\".  Put your file in there.  Do hg ci in there to add it to the examples repo.  Post a patch using \"hg export tip\" in that repo.  If you get stuck, let me know.   Then in the doctest just put SAGE_ROOT + 'examples/finance/your_filename.txt'.   And you won't have to make it optional, which is always a plus. \n\n* This code in your patch (in the function load_from_file) contains a bug:\n\n```\n+        try:\n+            R = file_obj.read();\n+        except IOError:\n+            raise IOError, msg + \"Bad path or file name\"\n```\n\nYou mean to write:\n\n```\n+        try:\n+            R = file_obj.read();\n+        except IOError, msg :\n+            raise IOError, msg + \"Bad path or file name\"\n```\nA doctest should illustrate this exception maybe, so you would have caught this bug.\n\n* 5 Doctests in stock.py fail:\n\n```\nsage -t --optional devel/sage-review/sage/finance/stock.py\n**********************************************************************\nFile \"/Users/was/s/tmp/stock.py\", line 274:\n    sage: finance.Stock('vmw').Open()    # optional -- requires internet\nExpected:\n    [52.1100, 60.9900, 59.0000, 56.0500, 57.2500 ... 38.5300, 36.1800, 32.6300, 36.7000, 34.5000]\nGot:\n    [52.1100, 60.9900, 59.0000, 56.0500, 57.2500 ... 36.1800, 32.6300, 36.7000, 34.5000, 34.0000]\n**********************************************************************\nFile \"/Users/was/s/tmp/stock.py\", line 308:\n    sage: c.google(startdate='Feb+1,+2008', enddate='Mar+1,+2008')    # optional -- requires internet\nExpected:\n    [\n     31-Jan-08 55.60 57.35 55.52 56.67    2607800,\n      1-Feb-08 56.98 58.14 55.06 57.85    2489400,\n      4-Feb-08 58.00 60.47 56.91 58.05    1840300,\n      5-Feb-08 57.60 59.30 57.17 59.30    1711700,\n      6-Feb-08 60.32 62.00 59.50 61.52    2209700\n    ]\nGot:\n    [\n     31-Jan-08 55.60 57.35 55.52 56.67    2607800,\n      1-Feb-08 56.98 58.14 55.06 57.85    2489400,\n      4-Feb-08 58.00 60.47 56.91 58.05    1840300,\n      5-Feb-08 57.60 59.30 57.17 59.30    1711700,\n      6-Feb-08 60.32 62.00 59.50 61.52    2209700,\n      7-Feb-08 60.50 62.75 59.56 60.80    1521700,\n      8-Feb-08 60.90 61.39 60.07 60.27     956400,\n     11-Feb-08 61.22 62.24 60.90 61.42    1132600,\n     12-Feb-08 62.00 63.00 61.56 62.26     989000,\n     13-Feb-08 63.00 63.50 62.18 62.93     919500,\n     14-Feb-08 63.10 63.33 61.25 62.10    1333000,\n     15-Feb-08 61.20 62.57 59.25 59.81    1598200,\n     19-Feb-08 60.99 61.50 56.50 57.38    1685900,\n     20-Feb-08 56.23 59.83 56.23 59.45     913600,\n     21-Feb-08 59.46 60.00 57.50 57.91    1124000,\n     22-Feb-08 58.00 58.48 55.00 56.55    1449100,\n     25-Feb-08 56.55 58.60 56.01 58.29     907900,\n     26-Feb-08 59.30 60.70 57.43 60.18    2050400,\n     27-Feb-08 60.00 60.50 58.42 59.86    1285200,\n     28-Feb-08 59.79 60.96 59.16 59.95     984500,\n     29-Feb-08 59.26 59.95 58.32 58.67     842200\n    ]\n**********************************************************************\nFile \"/Users/was/s/tmp/stock.py\", line 321:\n    sage: finance.Stock('vmw').Close()    # optional -- requires internet\nExpected:\n    [57.7100, 56.9900, 55.5500, 57.3300, 65.9900 ... 36.9400, 37.9700, 37.0000, 34.7500, 34.0700]\nGot:\n    [57.7100, 56.9900, 55.5500, 57.3300, 65.9900 ... 37.9700, 37.0000, 34.7500, 34.0700, 34.6900]\n**********************************************************************\nFile \"/Users/was/s/tmp/stock.py\", line 352:\n    sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires source file\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/was/s/local/lib/python2.5/doctest.py\", line 1228, in __run\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_12[1]>\", line 1, in <module>\n        finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:Integer(5)]    # optional -- requires source file###line 352:\n    sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires source file\n      File \"/Users/was/s/local/lib/python2.5/site-packages/sage/finance/stock.py\", line 375, in load_from_file\n        file_obj = open(file, 'r')\n    IOError: [Errno 2] No such file or directory: '/Users/cswiercz/GOOG-minutely.txt'\n**********************************************************************\nFile \"/Users/was/s/tmp/stock.py\", line 366:\n    sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires source file\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/was/s/local/lib/python2.5/doctest.py\", line 1228, in __run\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_12[2]>\", line 1, in <module>\n        finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:Integer(5)]    # optional -- requires source file###line 366:\n    sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires source file\n      File \"/Users/was/s/local/lib/python2.5/site-packages/sage/finance/stock.py\", line 375, in load_from_file\n        file_obj = open(file, 'r')\n    IOError: [Errno 2] No such file or directory: '/Users/cswiercz/GOOG-minutely.txt'\n**********************************************************************\nFile \"/Users/was/s/tmp/stock.py\", line 407:\n    sage: finance.Stock('aapl').google()[:2]    # optional -- requires internet\nExpected:\n    [\n      2-Jan-90 8.81 9.38 8.75 9.31    6542800,\n      3-Jan-90 9.50 9.50 9.38 9.38    7428400\n    ]\nGot:\n    [\n     30-Jul-07 144.33 145.45 139.57 141.43   39535300,\n     31-Jul-07 142.97 143.48 131.52 131.76   62942600\n    ]\n**********************************************************************\nFile \"/Users/was/s/tmp/stock.py\", line 211:\n    sage: sage.finance.stock.Stock(\"AAPL\", 22144).google()[:5] #optional -- requires internet\nExpected:\n        [\n          2-Jan-90 8.81 9.38 8.75 9.31    6542800,\n          3-Jan-90 9.50 9.50 9.38 9.38    7428400,\n          4-Jan-90 9.56 9.69 9.31 9.41    7911200,\n          5-Jan-90 9.44 9.56 9.25 9.44    4404000,\n          8-Jan-90 9.38 9.50 9.25 9.50    3627600\n        ]\nGot:\n    [\n     30-Jul-07 144.33 145.45 139.57 141.43   39535300,\n     31-Jul-07 142.97 143.48 131.52 131.76   62942600,\n      1-Aug-07 133.64 135.38 127.77 135.00   62505600,\n      2-Aug-07 136.65 136.96 134.15 136.49   30451600,\n      3-Aug-07 135.26 135.95 131.50 131.85   24256700\n    ]\n**********************************************************************\n5 items had failures:\n   1 of   6 in __main__.example_10\n   2 of   6 in __main__.example_11\n   2 of   3 in __main__.example_12\n   1 of   2 in __main__.example_14\n   1 of   5 in __main__.example_9\n***Test Failed*** 7 failures.\nFor whitespace errors, see the file /Users/was/s/tmp/.doctest_stock.py\n```",
    "created_at": "2008-07-29T18:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20598",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:8'></a>
REFEREE REPORT:

Great work!  Now be professionals and fix everything below :-)

* The function `_load_from_csv(self, R)` in stock.py is missing a doctest

* I like the Day --> OHCL change. 

* Member functions in the Sage library should never be upper case, so

```
    def Open(self, *args, **kwds):
```
must become

```
    def open(self, *args, **kwds):
```

* The doctest for Open contains `\code{self.google()`.  Since the docstring is a string that \c gets turned into a weird character.  You have to do either `\\code{self.google()` or (better) just replace `"""` at the top by `r"""`.  Same for `def Close`, etc.  

* This doctest SUCKS:

```
+            sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires s
ource file
+            [
```
We actually *do* test all optional doctests sometimes, and do expect them to pass on a reasonably configured machine.   I suggest the following workaround.  Make a subdirectory of SAGE_ROOT/examples called "finance".  Put your file in there.  Do hg ci in there to add it to the examples repo.  Post a patch using "hg export tip" in that repo.  If you get stuck, let me know.   Then in the doctest just put SAGE_ROOT + 'examples/finance/your_filename.txt'.   And you won't have to make it optional, which is always a plus. 

* This code in your patch (in the function load_from_file) contains a bug:

```
+        try:
+            R = file_obj.read();
+        except IOError:
+            raise IOError, msg + "Bad path or file name"
```

You mean to write:

```
+        try:
+            R = file_obj.read();
+        except IOError, msg :
+            raise IOError, msg + "Bad path or file name"
```
A doctest should illustrate this exception maybe, so you would have caught this bug.

* 5 Doctests in stock.py fail:

```
sage -t --optional devel/sage-review/sage/finance/stock.py
**********************************************************************
File "/Users/was/s/tmp/stock.py", line 274:
    sage: finance.Stock('vmw').Open()    # optional -- requires internet
Expected:
    [52.1100, 60.9900, 59.0000, 56.0500, 57.2500 ... 38.5300, 36.1800, 32.6300, 36.7000, 34.5000]
Got:
    [52.1100, 60.9900, 59.0000, 56.0500, 57.2500 ... 36.1800, 32.6300, 36.7000, 34.5000, 34.0000]
**********************************************************************
File "/Users/was/s/tmp/stock.py", line 308:
    sage: c.google(startdate='Feb+1,+2008', enddate='Mar+1,+2008')    # optional -- requires internet
Expected:
    [
     31-Jan-08 55.60 57.35 55.52 56.67    2607800,
      1-Feb-08 56.98 58.14 55.06 57.85    2489400,
      4-Feb-08 58.00 60.47 56.91 58.05    1840300,
      5-Feb-08 57.60 59.30 57.17 59.30    1711700,
      6-Feb-08 60.32 62.00 59.50 61.52    2209700
    ]
Got:
    [
     31-Jan-08 55.60 57.35 55.52 56.67    2607800,
      1-Feb-08 56.98 58.14 55.06 57.85    2489400,
      4-Feb-08 58.00 60.47 56.91 58.05    1840300,
      5-Feb-08 57.60 59.30 57.17 59.30    1711700,
      6-Feb-08 60.32 62.00 59.50 61.52    2209700,
      7-Feb-08 60.50 62.75 59.56 60.80    1521700,
      8-Feb-08 60.90 61.39 60.07 60.27     956400,
     11-Feb-08 61.22 62.24 60.90 61.42    1132600,
     12-Feb-08 62.00 63.00 61.56 62.26     989000,
     13-Feb-08 63.00 63.50 62.18 62.93     919500,
     14-Feb-08 63.10 63.33 61.25 62.10    1333000,
     15-Feb-08 61.20 62.57 59.25 59.81    1598200,
     19-Feb-08 60.99 61.50 56.50 57.38    1685900,
     20-Feb-08 56.23 59.83 56.23 59.45     913600,
     21-Feb-08 59.46 60.00 57.50 57.91    1124000,
     22-Feb-08 58.00 58.48 55.00 56.55    1449100,
     25-Feb-08 56.55 58.60 56.01 58.29     907900,
     26-Feb-08 59.30 60.70 57.43 60.18    2050400,
     27-Feb-08 60.00 60.50 58.42 59.86    1285200,
     28-Feb-08 59.79 60.96 59.16 59.95     984500,
     29-Feb-08 59.26 59.95 58.32 58.67     842200
    ]
**********************************************************************
File "/Users/was/s/tmp/stock.py", line 321:
    sage: finance.Stock('vmw').Close()    # optional -- requires internet
Expected:
    [57.7100, 56.9900, 55.5500, 57.3300, 65.9900 ... 36.9400, 37.9700, 37.0000, 34.7500, 34.0700]
Got:
    [57.7100, 56.9900, 55.5500, 57.3300, 65.9900 ... 37.9700, 37.0000, 34.7500, 34.0700, 34.6900]
**********************************************************************
File "/Users/was/s/tmp/stock.py", line 352:
    sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires source file
Exception raised:
    Traceback (most recent call last):
      File "/Users/was/s/local/lib/python2.5/doctest.py", line 1228, in __run
        compileflags, 1) in test.globs
      File "<doctest __main__.example_12[1]>", line 1, in <module>
        finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:Integer(5)]    # optional -- requires source file###line 352:
    sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires source file
      File "/Users/was/s/local/lib/python2.5/site-packages/sage/finance/stock.py", line 375, in load_from_file
        file_obj = open(file, 'r')
    IOError: [Errno 2] No such file or directory: '/Users/cswiercz/GOOG-minutely.txt'
**********************************************************************
File "/Users/was/s/tmp/stock.py", line 366:
    sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires source file
Exception raised:
    Traceback (most recent call last):
      File "/Users/was/s/local/lib/python2.5/doctest.py", line 1228, in __run
        compileflags, 1) in test.globs
      File "<doctest __main__.example_12[2]>", line 1, in <module>
        finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:Integer(5)]    # optional -- requires source file###line 366:
    sage: finance.Stock('goog').load_from_file('/Users/cswiercz/GOOG-minutely.txt')[:5]    # optional -- requires source file
      File "/Users/was/s/local/lib/python2.5/site-packages/sage/finance/stock.py", line 375, in load_from_file
        file_obj = open(file, 'r')
    IOError: [Errno 2] No such file or directory: '/Users/cswiercz/GOOG-minutely.txt'
**********************************************************************
File "/Users/was/s/tmp/stock.py", line 407:
    sage: finance.Stock('aapl').google()[:2]    # optional -- requires internet
Expected:
    [
      2-Jan-90 8.81 9.38 8.75 9.31    6542800,
      3-Jan-90 9.50 9.50 9.38 9.38    7428400
    ]
Got:
    [
     30-Jul-07 144.33 145.45 139.57 141.43   39535300,
     31-Jul-07 142.97 143.48 131.52 131.76   62942600
    ]
**********************************************************************
File "/Users/was/s/tmp/stock.py", line 211:
    sage: sage.finance.stock.Stock("AAPL", 22144).google()[:5] #optional -- requires internet
Expected:
        [
          2-Jan-90 8.81 9.38 8.75 9.31    6542800,
          3-Jan-90 9.50 9.50 9.38 9.38    7428400,
          4-Jan-90 9.56 9.69 9.31 9.41    7911200,
          5-Jan-90 9.44 9.56 9.25 9.44    4404000,
          8-Jan-90 9.38 9.50 9.25 9.50    3627600
        ]
Got:
    [
     30-Jul-07 144.33 145.45 139.57 141.43   39535300,
     31-Jul-07 142.97 143.48 131.52 131.76   62942600,
      1-Aug-07 133.64 135.38 127.77 135.00   62505600,
      2-Aug-07 136.65 136.96 134.15 136.49   30451600,
      3-Aug-07 135.26 135.95 131.50 131.85   24256700
    ]
**********************************************************************
5 items had failures:
   1 of   6 in __main__.example_10
   2 of   6 in __main__.example_11
   2 of   3 in __main__.example_12
   1 of   2 in __main__.example_14
   1 of   5 in __main__.example_9
***Test Failed*** 7 failures.
For whitespace errors, see the file /Users/was/s/tmp/.doctest_stock.py
```



---

archive/issue_events_032262.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-07-29T18:29:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32262"
}
```



---

archive/issue_events_032263.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-07-29T18:29:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32263"
}
```



---

archive/issue_events_032264.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-07-29T18:29:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "milestone_number": null,
    "milestone_title": "sage-3.1.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32264"
}
```



---

archive/issue_events_032265.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-07-29T18:29:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "milestone_number": null,
    "milestone_title": "sage-3.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32265"
}
```



---

archive/issue_events_032266.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-30T19:01:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32266"
}
```



---

archive/issue_events_032267.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-30T19:01:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32267"
}
```



---

archive/issue_comments_020599.json:
```json
{
    "body": "<a id='comment:11'></a>\nFaulty formatting with part5.patch? Following error message when applying the patch.\n\n\n```\nsage: hg_sage.apply(\"https://github.com/sagemath/sage/files/ticket3621/sage-3621-part6.patch.gz\")\nAttempting to load remote file: https://github.com/sagemath/sage/files/ticket3621/sage-3621-part6.patch.gz?format=raw\nLoading: [...]\ncd \"/Users/cswiercz/sage/devel/sage\" && hg status\ncd \"/Users/cswiercz/sage/devel/sage\" && hg status\ncd \"/Users/cswiercz/sage/devel/sage\" && hg import   \"/Users/cswiercz/.sage/temp/D_69_91_144_189.dhcp4.washington.edu/1527/tmp_5.patch\"\napplying /Users/cswiercz/.sage/temp/D_69_91_144_189.dhcp4.washington.edu/1527/tmp_5.patch\npatching file sage/finance/stock.py\nHunk #1 FAILED at 2\nHunk #2 FAILED at 13\nHunk #3 FAILED at 47\nHunk #4 FAILED at 137\nHunk #5 FAILED at 160\nHunk #6 FAILED at 174\nHunk #7 FAILED at 189\nHunk #8 FAILED at 202\nHunk #9 FAILED at 221\nHunk #10 FAILED at 277\n10 out of 10 hunks FAILED -- saving rejects to file sage/finance/stock.py.rej\nabort: patch failed to apply\n```",
    "created_at": "2008-07-31T21:43:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20599",
    "user": "https://github.com/cswiercz"
}
```

<a id='comment:11'></a>
Faulty formatting with part5.patch? Following error message when applying the patch.


```
sage: hg_sage.apply("https://github.com/sagemath/sage/files/ticket3621/sage-3621-part6.patch.gz")
Attempting to load remote file: https://github.com/sagemath/sage/files/ticket3621/sage-3621-part6.patch.gz?format=raw
Loading: [...]
cd "/Users/cswiercz/sage/devel/sage" && hg status
cd "/Users/cswiercz/sage/devel/sage" && hg status
cd "/Users/cswiercz/sage/devel/sage" && hg import   "/Users/cswiercz/.sage/temp/D_69_91_144_189.dhcp4.washington.edu/1527/tmp_5.patch"
applying /Users/cswiercz/.sage/temp/D_69_91_144_189.dhcp4.washington.edu/1527/tmp_5.patch
patching file sage/finance/stock.py
Hunk #1 FAILED at 2
Hunk #2 FAILED at 13
Hunk #3 FAILED at 47
Hunk #4 FAILED at 137
Hunk #5 FAILED at 160
Hunk #6 FAILED at 174
Hunk #7 FAILED at 189
Hunk #8 FAILED at 202
Hunk #9 FAILED at 221
Hunk #10 FAILED at 277
10 out of 10 hunks FAILED -- saving rejects to file sage/finance/stock.py.rej
abort: patch failed to apply
```



---

archive/issue_events_032268.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-31T21:43:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32268"
}
```



---

archive/issue_events_032269.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-07-31T21:43:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32269"
}
```



---

archive/issue_comments_020600.json:
```json
{
    "body": "<a id='comment:12'></a>\nPatch 6 is a duplicate of patch 5.  Part 6 is supposed to add a new doctest.  I will add that shortly.",
    "created_at": "2008-07-31T22:15:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20600",
    "user": "https://github.com/sagetrac-brettnak"
}
```

<a id='comment:12'></a>
Patch 6 is a duplicate of patch 5.  Part 6 is supposed to add a new doctest.  I will add that shortly.



---

archive/issue_events_032270.json:
```json
{
    "actor": "https://github.com/sagetrac-brettnak",
    "created_at": "2008-08-02T21:31:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32270"
}
```



---

archive/issue_events_032271.json:
```json
{
    "actor": "https://github.com/sagetrac-brettnak",
    "created_at": "2008-08-02T21:31:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32271"
}
```



---

archive/issue_comments_020601.json:
```json
{
    "body": "**Changing assignee** from @cswiercz to @cswiercz, brettnak.",
    "created_at": "2008-08-02T21:32:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20601",
    "user": "https://github.com/sagetrac-brettnak"
}
```

**Changing assignee** from @cswiercz to @cswiercz, brettnak.



---

archive/issue_events_032272.json:
```json
{
    "actor": "https://github.com/sagetrac-brettnak",
    "created_at": "2008-08-02T21:32:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32272"
}
```



---

archive/issue_comments_020602.json:
```json
{
    "body": "**Changing assignee** from @cswiercz, brettnak to @cswiercz.",
    "created_at": "2008-08-05T21:01:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20602",
    "user": "https://github.com/cswiercz"
}
```

**Changing assignee** from @cswiercz, brettnak to @cswiercz.



---

archive/issue_events_032273.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-08-05T21:01:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "rename": {
        "from": "Finance -- Fix Stock.historical(), addition of enddate input",
        "to": "sage.finance - add expand and refine finance.Stock"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32273"
}
```



---

archive/issue_events_032274.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-08-05T21:01:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32274"
}
```



---

archive/issue_comments_020603.json:
```json
{
    "body": "<a id='comment:16'></a>\nI am not so sure you guys should give each other positive reviews in this form. I would also either prefer clear instructions on which patches to merge in what order or alternatively a new unified patch. I do not want a bundle.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-06T01:00:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20603",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:16'></a>
I am not so sure you guys should give each other positive reviews in this form. I would also either prefer clear instructions on which patches to merge in what order or alternatively a new unified patch. I do not want a bundle.

Cheers,

Michael



---

archive/issue_comments_020604.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mabshoff](#comment%3A16):\n> I am not so sure you guys should give each other positive reviews in this form. I would also either prefer clear instructions on which patches to merge in what order or alternatively a new unified patch. I do not want a bundle.\n\nThe patches should be merged in order as posted, that is:\n\n\nall_updates_and_cid.patch\n\n\nadd_load_file1.patch\n\n\nadd_close.patch\n\n\nload_file_bug_fix.patch\n\n\nsage-3621-part5.patch\n\n\nsage-3621-example.patch\n\n\nsage-3621-part6.patch\n\n\nsage-3621-part7.patch\n\n\nsage-3621-part8.patch\n\n\nsage-3621-part9.patch\n\n\nsage-3621-part10.patch\n\n\n\nShall I set it back to [with patch, needs review]?",
    "created_at": "2008-08-06T14:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20604",
    "user": "https://github.com/cswiercz"
}
```

<a id='comment:17'></a>
Replying to [mabshoff](#comment%3A16):
> I am not so sure you guys should give each other positive reviews in this form. I would also either prefer clear instructions on which patches to merge in what order or alternatively a new unified patch. I do not want a bundle.

The patches should be merged in order as posted, that is:


all_updates_and_cid.patch


add_load_file1.patch


add_close.patch


load_file_bug_fix.patch


sage-3621-part5.patch


sage-3621-example.patch


sage-3621-part6.patch


sage-3621-part7.patch


sage-3621-part8.patch


sage-3621-part9.patch


sage-3621-part10.patch



Shall I set it back to [with patch, needs review]?



---

archive/issue_comments_020605.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [@cswiercz](#comment%3A17):\n> Replying to [mabshoff](#comment%3A16):\n> > I am not so sure you guys should give each other positive reviews in this form. I would also either prefer clear instructions on which patches to merge in what order or alternatively a new unified patch. I do not want a bundle.\n\n> \n> The patches should be merged in order as posted, that is:\n> \n> \n> all_updates_and_cid.patch\n> \n> \n> add_load_file1.patch\n> \n> \n> add_close.patch\n> \n> \n> load_file_bug_fix.patch\n> \n> \n> sage-3621-part5.patch\n> \n> \n> sage-3621-example.patch\n> \n> \n> sage-3621-part6.patch\n> \n> \n> sage-3621-part7.patch\n> \n> \n> sage-3621-part8.patch\n> \n> \n> sage-3621-part9.patch\n> \n> \n> sage-3621-part10.patch\n\nThanks.\n\n> Shall I set it back to [with patch, needs review]?\n\nI am talking with William about this, but it seems unclear to me who gave a review to what. For example: Chris posted sage-3621-part10.patch and also gave that patch a positive review. It seems like a minor patch, but we should follow procedure here.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-06T17:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20605",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:18'></a>
Replying to [@cswiercz](#comment%3A17):
> Replying to [mabshoff](#comment%3A16):
> > I am not so sure you guys should give each other positive reviews in this form. I would also either prefer clear instructions on which patches to merge in what order or alternatively a new unified patch. I do not want a bundle.

> 
> The patches should be merged in order as posted, that is:
> 
> 
> all_updates_and_cid.patch
> 
> 
> add_load_file1.patch
> 
> 
> add_close.patch
> 
> 
> load_file_bug_fix.patch
> 
> 
> sage-3621-part5.patch
> 
> 
> sage-3621-example.patch
> 
> 
> sage-3621-part6.patch
> 
> 
> sage-3621-part7.patch
> 
> 
> sage-3621-part8.patch
> 
> 
> sage-3621-part9.patch
> 
> 
> sage-3621-part10.patch

Thanks.

> Shall I set it back to [with patch, needs review]?

I am talking with William about this, but it seems unclear to me who gave a review to what. For example: Chris posted sage-3621-part10.patch and also gave that patch a positive review. It seems like a minor patch, but we should follow procedure here.

Cheers,

Michael



---

archive/issue_comments_020606.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [mabshoff](#comment%3A18):\n> > Shall I set it back to [with patch, needs review]?\n\n> \n> I am talking with William about this, but it seems unclear to me who gave a review to what. For example: Chris posted sage-3621-part10.patch and also gave that patch a positive review. It seems like a minor patch, but we should follow procedure here.\n\nTo make the situation a bit clearer, Brett asked if I could review his patches. (part6.patch - part9.patch) I found a minor bug and added my own patch at the very end. (part10.patch) My patch was just a small change to a doctest, which I tested thoroughly. I realize just now that it was kinda silly to review this ticket myself since all of the code throughout these patches was done by both of us, equally. Anyway, I'm fine with setting it back to \"needs review\" and waiting for someone to take a look at it. It's your call. :)\n\n--\nChris",
    "created_at": "2008-08-06T17:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20606",
    "user": "https://github.com/cswiercz"
}
```

<a id='comment:19'></a>
Replying to [mabshoff](#comment%3A18):
> > Shall I set it back to [with patch, needs review]?

> 
> I am talking with William about this, but it seems unclear to me who gave a review to what. For example: Chris posted sage-3621-part10.patch and also gave that patch a positive review. It seems like a minor patch, but we should follow procedure here.

To make the situation a bit clearer, Brett asked if I could review his patches. (part6.patch - part9.patch) I found a minor bug and added my own patch at the very end. (part10.patch) My patch was just a small change to a doctest, which I tested thoroughly. I realize just now that it was kinda silly to review this ticket myself since all of the code throughout these patches was done by both of us, equally. Anyway, I'm fine with setting it back to "needs review" and waiting for someone to take a look at it. It's your call. :)

--
Chris



---

archive/issue_events_032275.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-08-07T22:12:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32275"
}
```



---

archive/issue_events_032276.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-08-07T22:12:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32276"
}
```



---

archive/issue_comments_020607.json:
```json
{
    "body": "<a id='comment:20'></a>\nAlas, several issues need to be resolved and some features need to be added:\n\n* Yahoo doesn't like explicit exchange declarations. (i.e. `finance.Stock(\"NASDAQ:GOOG\")` returns zero.) Parse the input and store the exchange and symbol separately.\n\n* Yahoo should be implemented as a backup to Google Finance historical queries if Google Finance happens to return zero.\n\n* Fix some issues regarding explicit exchange declarations in general. (i.e. `finance.Stock(\"HKG:0700\").historical()` returns zero.) Improve the way queries handle exchange / symbol relationships. For example, only default to `\"NASDAQ\"` if no exchange is given.\n\n* Rename `Stock.google()` back to `Stock.historical()`\n\n* Consolidate the ten+ patches above.\n\nI'm taking care of this right now! :)\n\n--\n\nChris",
    "created_at": "2008-08-07T22:12:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20607",
    "user": "https://github.com/cswiercz"
}
```

<a id='comment:20'></a>
Alas, several issues need to be resolved and some features need to be added:

* Yahoo doesn't like explicit exchange declarations. (i.e. `finance.Stock("NASDAQ:GOOG")` returns zero.) Parse the input and store the exchange and symbol separately.

* Yahoo should be implemented as a backup to Google Finance historical queries if Google Finance happens to return zero.

* Fix some issues regarding explicit exchange declarations in general. (i.e. `finance.Stock("HKG:0700").historical()` returns zero.) Improve the way queries handle exchange / symbol relationships. For example, only default to `"NASDAQ"` if no exchange is given.

* Rename `Stock.google()` back to `Stock.historical()`

* Consolidate the ten+ patches above.

I'm taking care of this right now! :)

--

Chris



---

archive/issue_comments_020608.json:
```json
{
    "body": "**Attachment:** [sage-3621-combined.patch.gz](https://github.com/sagemath/sage/files/ticket3621/sage-3621-combined.patch.gz)\n\nReplacement patch for all patches listed above. Combines all changes.",
    "created_at": "2008-08-07T23:06:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20608",
    "user": "https://github.com/cswiercz"
}
```

**Attachment:** [sage-3621-combined.patch.gz](https://github.com/sagemath/sage/files/ticket3621/sage-3621-combined.patch.gz)

Replacement patch for all patches listed above. Combines all changes.



---

archive/issue_comments_020609.json:
```json
{
    "body": "<a id='comment:21'></a>\nsage-3621-combined.patch is joined work by William, Chris and Brett.\n\nCheers,\n\nMichael",
    "created_at": "2008-08-08T22:36:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20609",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:21'></a>
sage-3621-combined.patch is joined work by William, Chris and Brett.

Cheers,

Michael



---

archive/issue_comments_020610.json:
```json
{
    "body": "**Attachment:** [sage-3621-extrapart1.patch.gz](https://github.com/sagemath/sage/files/ticket3621/sage-3621-extrapart1.patch.gz)\n\nAdded Yahoo Finance as a backup to Google Finance historical requests. Additional refinements.",
    "created_at": "2008-08-13T00:51:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20610",
    "user": "https://github.com/cswiercz"
}
```

**Attachment:** [sage-3621-extrapart1.patch.gz](https://github.com/sagemath/sage/files/ticket3621/sage-3621-extrapart1.patch.gz)

Added Yahoo Finance as a backup to Google Finance historical requests. Additional refinements.



---

archive/issue_events_032277.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-08-13T00:59:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32277"
}
```



---

archive/issue_events_032278.json:
```json
{
    "actor": "https://github.com/cswiercz",
    "created_at": "2008-08-13T00:59:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32278"
}
```



---

archive/issue_comments_020611.json:
```json
{
    "body": "<a id='comment:23'></a>\nJosh, \n\ncan you review those two patches?\n\nCheers,\n\nMichael",
    "created_at": "2008-08-25T06:25:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20611",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:23'></a>
Josh, 

can you review those two patches?

Cheers,

Michael



---

archive/issue_comments_020612.json:
```json
{
    "body": "<a id='comment:24'></a>\nSomething's up with the first patch -- the file **SAGE_ROOT/examples/finance/AAPL-minutely.csv** is located at **SAGE_ROOT/finance/AAPL-minutely.csv** when I apply the patch to a fresh 3.1.2.rc1.\n\n```\nboothby@eight:~/sage-3.1.2.rc1$ ./sage -t devel/sage/sage/finance/stock.py\nsage -t  devel/sage/sage/finance/stock.py                   **********************************************************************\nFile \"/home/boothby/sage-3.1.2.rc1/tmp/stock.py\", line 417:\n    sage: finance.Stock('aapl').load_from_file(SAGE_ROOT + '/examples/finance/AAPL-minutely.csv')\nExpected:\n    [\n    2008-06-02T05:01:00 188.00 188.00 188.00 188.00        687,\n    2008-06-02T05:00:00 188.00 188.11 188.00 188.00       2877,\n    2008-06-02T04:55:00 188.00 188.00 188.00 188.00       1000,\n    2008-06-02T04:54:00 187.75 188.00 187.75 188.00       2000,\n    2008-06-02T04:23:00 187.80 187.80 187.80 187.80        100\n    ]\nGot:\n    Bad path or file name\n**********************************************************************\nFile \"/home/boothby/sage-3.1.2.rc1/tmp/stock.py\", line 431:\n    sage: finance.Stock('goog').load_from_file(SAGE_ROOT + '/examples/finance/AAPL-minutely.csv')\nExpected:\n    [\n    2008-06-02T05:01:00 188.00 188.00 188.00 188.00        687,\n    2008-06-02T05:00:00 188.00 188.11 188.00 188.00       2877,\n    2008-06-02T04:55:00 188.00 188.00 188.00 188.00       1000,\n    2008-06-02T04:54:00 187.75 188.00 187.75 188.00       2000,\n    2008-06-02T04:23:00 187.80 187.80 187.80 187.80        100\n    ]\nGot:\n    Bad path or file name\n**********************************************************************\n1 items had failures:\n   2 of   5 in __main__.example_12\n***Test Failed*** 2 failures.\nFor whitespace errors, see the file /home/boothby/sage-3.1.2.rc1/tmp/.doctest_stock.py\n\t [1.2 s]\nexit code: 1024\n \n----------------------------------------------------------------------\nThe following tests failed:\n\n\n\tsage -t  devel/sage/sage/finance/stock.py\nTotal time for all tests: 1.2 seconds\n```",
    "created_at": "2008-09-11T21:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20612",
    "user": "https://github.com/sagetrac-boothby"
}
```

<a id='comment:24'></a>
Something's up with the first patch -- the file **SAGE_ROOT/examples/finance/AAPL-minutely.csv** is located at **SAGE_ROOT/finance/AAPL-minutely.csv** when I apply the patch to a fresh 3.1.2.rc1.

```
boothby@eight:~/sage-3.1.2.rc1$ ./sage -t devel/sage/sage/finance/stock.py
sage -t  devel/sage/sage/finance/stock.py                   **********************************************************************
File "/home/boothby/sage-3.1.2.rc1/tmp/stock.py", line 417:
    sage: finance.Stock('aapl').load_from_file(SAGE_ROOT + '/examples/finance/AAPL-minutely.csv')
Expected:
    [
    2008-06-02T05:01:00 188.00 188.00 188.00 188.00        687,
    2008-06-02T05:00:00 188.00 188.11 188.00 188.00       2877,
    2008-06-02T04:55:00 188.00 188.00 188.00 188.00       1000,
    2008-06-02T04:54:00 187.75 188.00 187.75 188.00       2000,
    2008-06-02T04:23:00 187.80 187.80 187.80 187.80        100
    ]
Got:
    Bad path or file name
**********************************************************************
File "/home/boothby/sage-3.1.2.rc1/tmp/stock.py", line 431:
    sage: finance.Stock('goog').load_from_file(SAGE_ROOT + '/examples/finance/AAPL-minutely.csv')
Expected:
    [
    2008-06-02T05:01:00 188.00 188.00 188.00 188.00        687,
    2008-06-02T05:00:00 188.00 188.11 188.00 188.00       2877,
    2008-06-02T04:55:00 188.00 188.00 188.00 188.00       1000,
    2008-06-02T04:54:00 187.75 188.00 187.75 188.00       2000,
    2008-06-02T04:23:00 187.80 187.80 187.80 187.80        100
    ]
Got:
    Bad path or file name
**********************************************************************
1 items had failures:
   2 of   5 in __main__.example_12
***Test Failed*** 2 failures.
For whitespace errors, see the file /home/boothby/sage-3.1.2.rc1/tmp/.doctest_stock.py
	 [1.2 s]
exit code: 1024
 
----------------------------------------------------------------------
The following tests failed:


	sage -t  devel/sage/sage/finance/stock.py
Total time for all tests: 1.2 seconds
```



---

archive/issue_comments_020613.json:
```json
{
    "body": "<a id='comment:25'></a>\nOops, my bad -- William already commented on that.",
    "created_at": "2008-09-11T22:13:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20613",
    "user": "https://github.com/sagetrac-boothby"
}
```

<a id='comment:25'></a>
Oops, my bad -- William already commented on that.



---

archive/issue_comments_020614.json:
```json
{
    "body": "apply to repository in SAGE_ROOT/examples",
    "created_at": "2008-09-11T22:14:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20614",
    "user": "https://github.com/sagetrac-boothby"
}
```

apply to repository in SAGE_ROOT/examples



---

archive/issue_comments_020615.json:
```json
{
    "body": "**Attachment:** [3621\u2013example.patch.gz](https://github.com/sagemath/sage/files/ticket3621/e4a0248e3a4ac214abefc7948846a4c0.gz)\n\nremoves creation of example file from original",
    "created_at": "2008-09-11T22:19:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20615",
    "user": "https://github.com/sagetrac-boothby"
}
```

**Attachment:** [3621example.patch.gz](https://github.com/sagemath/sage/files/ticket3621/e4a0248e3a4ac214abefc7948846a4c0.gz)

removes creation of example file from original



---

archive/issue_comments_020616.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Attachment:** [3621-combined.patch.gz](https://github.com/sagemath/sage/files/ticket3621/3621-combined.patch.gz)\n\nAll (including optional) tests pass!",
    "created_at": "2008-09-11T22:41:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20616",
    "user": "https://github.com/sagetrac-boothby"
}
```

<a id='comment:26'></a>
**Attachment:** [3621-combined.patch.gz](https://github.com/sagemath/sage/files/ticket3621/3621-combined.patch.gz)

All (including optional) tests pass!



---

archive/issue_comments_020617.json:
```json
{
    "body": "**Attachment:** [sage-3621-trivial_referee_followup.patch.gz](https://github.com/sagemath/sage/files/ticket3621/sage-3621-trivial_referee_followup.patch.gz)",
    "created_at": "2008-11-28T03:33:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20617",
    "user": "https://github.com/williamstein"
}
```

**Attachment:** [sage-3621-trivial_referee_followup.patch.gz](https://github.com/sagemath/sage/files/ticket3621/sage-3621-trivial_referee_followup.patch.gz)



---

archive/issue_events_032279.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-11-28T03:35:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32279"
}
```



---

archive/issue_events_032280.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-11-28T03:35:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32280"
}
```



---

archive/issue_comments_020618.json:
```json
{
    "body": "<a id='comment:27'></a>\nREFEREE REPORT:\n\nPositive Review.   This is superb code.\n\nI had to make a few minor changes since for some reason google changed their database.  I also updated some of the # optional tags for the new system. \n\nMichael, to apply this you must:\n1. Apply 3621-combined.patch and sage-3621-trivial_referee_followup.patch to the Sage library.\n\n2. Apply 3621\u2013example.patch to the repo in SAGE_ROOT/examples/.\n\nThat's it.\n\n -- William",
    "created_at": "2008-11-28T03:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20618",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:27'></a>
REFEREE REPORT:

Positive Review.   This is superb code.

I had to make a few minor changes since for some reason google changed their database.  I also updated some of the # optional tags for the new system. 

Michael, to apply this you must:
1. Apply 3621-combined.patch and sage-3621-trivial_referee_followup.patch to the Sage library.

2. Apply 3621example.patch to the repo in SAGE_ROOT/examples/.

That's it.

 -- William



---

archive/issue_comments_020619.json:
```json
{
    "body": "<a id='comment:28'></a>\nMerged the patches William mentioned above in 3.2.1.rc0.\n\nThe credit situation: \n\n* authors: Chris Swierczewski, Brett Nakashima, William Stein\n* reviewers: William Stein, Tom Boothby\n\nPlease let me know if I got anything wrong\n\nCheers,\n\nMichael",
    "created_at": "2008-11-28T08:35:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3621#issuecomment-20619",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:28'></a>
Merged the patches William mentioned above in 3.2.1.rc0.

The credit situation: 

* authors: Chris Swierczewski, Brett Nakashima, William Stein
* reviewers: William Stein, Tom Boothby

Please let me know if I got anything wrong

Cheers,

Michael



---

archive/issue_events_032281.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-28T08:35:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32281"
}
```



---

archive/issue_events_032282.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-11-28T08:35:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3621",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3621#event-32282"
}
```
