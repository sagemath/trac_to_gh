# Issue 3314: [Positive review] dsage.setup() add_default_client broken

archive/issues_003314.json:
```json
{
    "body": "twisted changed it's conch interface and I forgot to toString the pubkey object in some instances. \n\n**Assignee:** @yqiang\n\n**Keywords:** editor_gfurnish\n\nIssue created by migration from https://trac.sagemath.org/ticket/3314\n\n",
    "closed_at": "2008-06-18T04:39:31Z",
    "created_at": "2008-05-27T05:43:21Z",
    "labels": [
        "component: dsage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.0.3",
    "title": "[Positive review] dsage.setup() add_default_client broken",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/3314",
    "user": "https://github.com/yqiang"
}
```
twisted changed it's conch interface and I forgot to toString the pubkey object in some instances. 

**Assignee:** @yqiang

**Keywords:** editor_gfurnish

Issue created by migration from https://trac.sagemath.org/ticket/3314





---

archive/attachments_003239.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "3314_default_users.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket3314/3314_default_users.patch",
    "created_at": "2008-05-27T06:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://github.com/yqiang"
}
```



---

archive/issue_comments_018726.json:
```json
{
    "body": "",
    "created_at": "2008-05-27T06:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18726",
    "user": "https://github.com/yqiang"
}
```





---

archive/issue_events_018179.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T06:05:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18179"
}
```



---

archive/issue_events_018180.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-05-28T12:04:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "milestone": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18180"
}
```



---

archive/issue_events_018181.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-05-28T12:04:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "label": "component: porting: cygwin",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18181"
}
```



---

archive/issue_events_018182.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-05-28T12:04:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "label": "component: dsage",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18182"
}
```



---

archive/issue_comments_018727.json:
```json
{
    "body": "**Changing assignee** from mabshoff to @yqiang.",
    "created_at": "2008-05-28T12:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18727",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing assignee** from mabshoff to @yqiang.



---

archive/issue_comments_018728.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"editor_gfurnish\".",
    "created_at": "2008-06-15T21:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18728",
    "user": "https://github.com/craigcitro"
}
```

**Changing keywords** from "" to "editor_gfurnish".



---

archive/issue_events_018183.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T20:31:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "rename": {
        "from": "dsage.setup() add_default_client broken",
        "to": "[Negative review] dsage.setup() add_default_client broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18183"
}
```



---

archive/issue_comments_018729.json:
```json
{
    "body": "<a id='comment:5'></a>\nDSage is completely broken in 3.0.2 and 3.0.3!!!!!  Make me some patches so that I can actually run dsage.",
    "created_at": "2008-06-16T20:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18729",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:5'></a>
DSage is completely broken in 3.0.2 and 3.0.3!!!!!  Make me some patches so that I can actually run dsage.



---

archive/issue_comments_018730.json:
```json
{
    "body": "<a id='comment:6'></a>\nDSage is not completely broken in Sage 3.0.2 with the patch applied and in 3.3.0.rc0. If you make claims like that you should back them up with details.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-16T21:50:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18730",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:6'></a>
DSage is not completely broken in Sage 3.0.2 with the patch applied and in 3.3.0.rc0. If you make claims like that you should back them up with details.

Cheers,

Michael



---

archive/issue_comments_018731.json:
```json
{
    "body": "<a id='comment:7'></a>\nIf you do not have an existing known good .sage directory with existing dsage materials from some previous version (unknown), dsage is completely broken.",
    "created_at": "2008-06-16T22:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18731",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:7'></a>
If you do not have an existing known good .sage directory with existing dsage materials from some previous version (unknown), dsage is completely broken.



---

archive/issue_comments_018732.json:
```json
{
    "body": "<a id='comment:8'></a>\nOk, the bug is the following *after* deleting the dsage directory in DOT_SAGE:\n\n```\nmabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.0.3.rc0$ ./sage\n----------------------------------------------------------------------\n| SAGE Version 3.0.3.rc0, Release Date: 2008-06-16                   |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n\nsage: dsage.setup()\n==================================================\nGenerating public/private key pair for authentication...\nYour key will be stored in /home/mabshoff/.sage/dsage/dsage_key\nJust hit enter when prompted for a passphrase\n==================================================\n<SNIP>\nsage: dsage.start_all()\nSpawned twistd -d /home/mabshoff/.sage/dsage --pidfile=server.pid --logfile=/home/mabshoff/.sage/dsage/server.log -y dsage_server.tac (pid = 26784)\n\nSpawned python /scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/dsage_worker.py -s localhost -p 8087 -u mabshoff -w 2 --poll 1.0 -l 0 -f /home/mabshoff/.sage/dsage/worker.log --privkey=/home/mabshoff/.sage/dsage/dsage_key --pubkey=/home/mabshoff/.sage/dsage/dsage_key.pub --priority=20 --ssl --noblock (pid = 26801)\n\nNot connected.\nsage: \n```\n\nThe DSage server log says:\n\n```\n2008-06-16 17:08:52-0700 [-] Log opened.\n2008-06-16 17:08:52-0700 [-] twistd 8.0.1 (/scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/python 2.5.2) starting up\n2008-06-16 17:08:52-0700 [-] reactor class: <class 'twisted.internet.selectreactor.SelectReactor'>\n2008-06-16 17:08:52-0700 [-] twisted.spread.pb.PBServerFactory starting on 8087\n2008-06-16 17:08:52-0700 [-] Starting factory <twisted.spread.pb.PBServerFactory instance at 0x2b54f6e88998>\n2008-06-16 17:08:52-0700 [-] twisted.web2.channel.http.HTTPFactory starting on 8088\n2008-06-16 17:08:52-0700 [-] Starting factory <twisted.web2.channel.http.HTTPFactory instance at 0x2b54f6e88e60>\n2008-06-16 17:08:52-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> connected\n2008-06-16 17:08:53-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> connected\n2008-06-16 17:12:03-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> disconnected\n2008-06-16 17:12:03-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> disconnected\n```\n\n\nCheers,\n\nMichael",
    "created_at": "2008-06-17T00:15:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18732",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:8'></a>
Ok, the bug is the following *after* deleting the dsage directory in DOT_SAGE:

```
mabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.0.3.rc0$ ./sage
----------------------------------------------------------------------
| SAGE Version 3.0.3.rc0, Release Date: 2008-06-16                   |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------

sage: dsage.setup()
==================================================
Generating public/private key pair for authentication...
Your key will be stored in /home/mabshoff/.sage/dsage/dsage_key
Just hit enter when prompted for a passphrase
==================================================
<SNIP>
sage: dsage.start_all()
Spawned twistd -d /home/mabshoff/.sage/dsage --pidfile=server.pid --logfile=/home/mabshoff/.sage/dsage/server.log -y dsage_server.tac (pid = 26784)

Spawned python /scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/dsage_worker.py -s localhost -p 8087 -u mabshoff -w 2 --poll 1.0 -l 0 -f /home/mabshoff/.sage/dsage/worker.log --privkey=/home/mabshoff/.sage/dsage/dsage_key --pubkey=/home/mabshoff/.sage/dsage/dsage_key.pub --priority=20 --ssl --noblock (pid = 26801)

Not connected.
sage: 
```

The DSage server log says:

```
2008-06-16 17:08:52-0700 [-] Log opened.
2008-06-16 17:08:52-0700 [-] twistd 8.0.1 (/scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/python 2.5.2) starting up
2008-06-16 17:08:52-0700 [-] reactor class: <class 'twisted.internet.selectreactor.SelectReactor'>
2008-06-16 17:08:52-0700 [-] twisted.spread.pb.PBServerFactory starting on 8087
2008-06-16 17:08:52-0700 [-] Starting factory <twisted.spread.pb.PBServerFactory instance at 0x2b54f6e88998>
2008-06-16 17:08:52-0700 [-] twisted.web2.channel.http.HTTPFactory starting on 8088
2008-06-16 17:08:52-0700 [-] Starting factory <twisted.web2.channel.http.HTTPFactory instance at 0x2b54f6e88e60>
2008-06-16 17:08:52-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> connected
2008-06-16 17:08:53-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> connected
2008-06-16 17:12:03-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> disconnected
2008-06-16 17:12:03-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> disconnected
```


Cheers,

Michael



---

archive/issue_comments_018733.json:
```json
{
    "body": "<a id='comment:9'></a>\nMichael, Gary, did you test this after applying the patch I posted?",
    "created_at": "2008-06-17T22:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18733",
    "user": "https://github.com/yqiang"
}
```

<a id='comment:9'></a>
Michael, Gary, did you test this after applying the patch I posted?



---

archive/issue_comments_018734.json:
```json
{
    "body": "<a id='comment:10'></a>\nOk. I tried this with 3.0.3rc0 after applying both #3312 and #3314 and can't repro this.",
    "created_at": "2008-06-17T23:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18734",
    "user": "https://github.com/yqiang"
}
```

<a id='comment:10'></a>
Ok. I tried this with 3.0.3rc0 after applying both #3312 and #3314 and can't repro this.



---

archive/issue_events_018184.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-18T01:01:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "rename": {
        "from": "[Negative review] dsage.setup() add_default_client broken",
        "to": "[Positive review] dsage.setup() add_default_client broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18184"
}
```



---

archive/issue_events_018185.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-18T04:39:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18185"
}
```



---

archive/issue_events_018186.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-18T04:39:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18186"
}
```



---

archive/issue_events_018187.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-06-18T23:18:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "milestone": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18187"
}
```



---

archive/issue_events_018188.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-06-18T23:18:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "milestone": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/3314#event-18188"
}
```



---

archive/issue_comments_018735.json:
```json
{
    "body": "<a id='comment:13'></a>\nMerged in Sage 3.0.3.final",
    "created_at": "2008-06-18T23:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/3314#issuecomment-18735",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:13'></a>
Merged in Sage 3.0.3.final
