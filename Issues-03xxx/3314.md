# Issue 3314: [Positive review] dsage.setup() add_default_client broken

archive/issues_003314.json:
```json
{
    "assignees": [
        "https://github.com/yqiang"
    ],
    "body": "twisted changed it's conch interface and I forgot to toString the pubkey object in some instances. \n\nKeywords: **editor_gfurnish**\n\nComponent: **dsage**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/3314_\n\n",
    "closed_at": "2008-06-18T04:39:31Z",
    "created_at": "2008-05-27T05:43:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20dsage",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.0.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "[Positive review] dsage.setup() add_default_client broken",
    "type": "issue",
    "updated_at": "2008-06-18T23:18:43Z",
    "url": "https://github.com/sagemath/sage/issues/3314",
    "user": "https://github.com/yqiang"
}
```
twisted changed it's conch interface and I forgot to toString the pubkey object in some instances. 

Keywords: **editor_gfurnish**

Component: **dsage**

_Issue created by migration from https://trac.sagemath.org/ticket/3314_





---

archive/issue_events_035791.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T05:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "000080",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35791"
}
```



---

archive/issue_events_035792.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T05:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35792"
}
```



---

archive/issue_events_035793.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T05:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35793"
}
```



---

archive/issue_events_035794.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-27T05:43:21Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "subject": "https://github.com/yqiang",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35794"
}
```



---

archive/issue_comments_017527.json:
```json
{
    "body": "Attachment: **[3314_default_users.patch.gz](https://github.com/sagemath/sage/files/ticket3314/3314_default_users.patch.gz)**",
    "created_at": "2008-05-27T06:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17527",
    "user": "https://github.com/yqiang"
}
```

Attachment: **[3314_default_users.patch.gz](https://github.com/sagemath/sage/files/ticket3314/3314_default_users.patch.gz)**



---

archive/issue_events_035795.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T06:05:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35795"
}
```



---

archive/issue_events_035796.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-28T12:04:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35796"
}
```



---

archive/issue_events_035797.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-28T12:04:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting%3A%20cygwin",
    "label_color": "000080",
    "label_name": "c: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35797"
}
```



---

archive/issue_events_035798.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-28T12:04:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20dsage",
    "label_color": "0000ff",
    "label_name": "c: dsage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35798"
}
```



---

archive/issue_events_035799.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-28T12:04:13Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "subject": "https://github.com/sagetrac-mabshoff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35799"
}
```



---

archive/issue_events_035800.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-28T12:04:13Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "subject": "https://github.com/sagetrac-mabshoff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35800"
}
```



---

archive/issue_comments_017528.json:
```json
{
    "body": "Changed keywords from none to **editor_gfurnish**",
    "created_at": "2008-06-15T21:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17528",
    "user": "https://github.com/craigcitro"
}
```

Changed keywords from none to **editor_gfurnish**



---

archive/issue_events_035801.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T20:31:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "title_is": "[Negative review] dsage.setup() add_default_client broken",
    "title_was": "dsage.setup() add_default_client broken",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35801"
}
```



---

archive/issue_comments_017529.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nDSage is completely broken in 3.0.2 and 3.0.3!!!!!  Make me some patches so that I can actually run dsage.",
    "created_at": "2008-06-16T20:31:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17529",
    "user": "https://github.com/garyfurnish"
}
```

<div id="comment:5" align="right">comment:5</div>

DSage is completely broken in 3.0.2 and 3.0.3!!!!!  Make me some patches so that I can actually run dsage.



---

archive/issue_comments_017530.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nDSage is not completely broken in Sage 3.0.2 with the patch applied and in 3.3.0.rc0. If you make claims like that you should back them up with details.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-16T21:50:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17530",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:6" align="right">comment:6</div>

DSage is not completely broken in Sage 3.0.2 with the patch applied and in 3.3.0.rc0. If you make claims like that you should back them up with details.

Cheers,

Michael



---

archive/issue_comments_017531.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nIf you do not have an existing known good .sage directory with existing dsage materials from some previous version (unknown), dsage is completely broken.",
    "created_at": "2008-06-16T22:15:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17531",
    "user": "https://github.com/garyfurnish"
}
```

<div id="comment:7" align="right">comment:7</div>

If you do not have an existing known good .sage directory with existing dsage materials from some previous version (unknown), dsage is completely broken.



---

archive/issue_comments_017532.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOk, the bug is the following *after* deleting the dsage directory in DOT_SAGE:\n\n```\nmabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.0.3.rc0$ ./sage\n----------------------------------------------------------------------\n| SAGE Version 3.0.3.rc0, Release Date: 2008-06-16                   |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n\nsage: dsage.setup()\n==================================================\nGenerating public/private key pair for authentication...\nYour key will be stored in /home/mabshoff/.sage/dsage/dsage_key\nJust hit enter when prompted for a passphrase\n==================================================\n<SNIP>\nsage: dsage.start_all()\nSpawned twistd -d /home/mabshoff/.sage/dsage --pidfile=server.pid --logfile=/home/mabshoff/.sage/dsage/server.log -y dsage_server.tac (pid = 26784)\n\nSpawned python /scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/dsage_worker.py -s localhost -p 8087 -u mabshoff -w 2 --poll 1.0 -l 0 -f /home/mabshoff/.sage/dsage/worker.log --privkey=/home/mabshoff/.sage/dsage/dsage_key --pubkey=/home/mabshoff/.sage/dsage/dsage_key.pub --priority=20 --ssl --noblock (pid = 26801)\n\nNot connected.\nsage: \n```\n\nThe DSage server log says:\n\n```\n2008-06-16 17:08:52-0700 [-] Log opened.\n2008-06-16 17:08:52-0700 [-] twistd 8.0.1 (/scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/python 2.5.2) starting up\n2008-06-16 17:08:52-0700 [-] reactor class: <class 'twisted.internet.selectreactor.SelectReactor'>\n2008-06-16 17:08:52-0700 [-] twisted.spread.pb.PBServerFactory starting on 8087\n2008-06-16 17:08:52-0700 [-] Starting factory <twisted.spread.pb.PBServerFactory instance at 0x2b54f6e88998>\n2008-06-16 17:08:52-0700 [-] twisted.web2.channel.http.HTTPFactory starting on 8088\n2008-06-16 17:08:52-0700 [-] Starting factory <twisted.web2.channel.http.HTTPFactory instance at 0x2b54f6e88e60>\n2008-06-16 17:08:52-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> connected\n2008-06-16 17:08:53-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> connected\n2008-06-16 17:12:03-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> disconnected\n2008-06-16 17:12:03-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> disconnected\n```\n\n\nCheers,\n\nMichael",
    "created_at": "2008-06-17T00:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17532",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:8" align="right">comment:8</div>

Ok, the bug is the following *after* deleting the dsage directory in DOT_SAGE:

```
mabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.0.3.rc0$ ./sage
----------------------------------------------------------------------
| SAGE Version 3.0.3.rc0, Release Date: 2008-06-16                   |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------

sage: dsage.setup()
==================================================
Generating public/private key pair for authentication...
Your key will be stored in /home/mabshoff/.sage/dsage/dsage_key
Just hit enter when prompted for a passphrase
==================================================
<SNIP>
sage: dsage.start_all()
Spawned twistd -d /home/mabshoff/.sage/dsage --pidfile=server.pid --logfile=/home/mabshoff/.sage/dsage/server.log -y dsage_server.tac (pid = 26784)

Spawned python /scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/dsage_worker.py -s localhost -p 8087 -u mabshoff -w 2 --poll 1.0 -l 0 -f /home/mabshoff/.sage/dsage/worker.log --privkey=/home/mabshoff/.sage/dsage/dsage_key --pubkey=/home/mabshoff/.sage/dsage/dsage_key.pub --priority=20 --ssl --noblock (pid = 26801)

Not connected.
sage: 
```

The DSage server log says:

```
2008-06-16 17:08:52-0700 [-] Log opened.
2008-06-16 17:08:52-0700 [-] twistd 8.0.1 (/scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/python 2.5.2) starting up
2008-06-16 17:08:52-0700 [-] reactor class: <class 'twisted.internet.selectreactor.SelectReactor'>
2008-06-16 17:08:52-0700 [-] twisted.spread.pb.PBServerFactory starting on 8087
2008-06-16 17:08:52-0700 [-] Starting factory <twisted.spread.pb.PBServerFactory instance at 0x2b54f6e88998>
2008-06-16 17:08:52-0700 [-] twisted.web2.channel.http.HTTPFactory starting on 8088
2008-06-16 17:08:52-0700 [-] Starting factory <twisted.web2.channel.http.HTTPFactory instance at 0x2b54f6e88e60>
2008-06-16 17:08:52-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> connected
2008-06-16 17:08:53-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> connected
2008-06-16 17:12:03-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> disconnected
2008-06-16 17:12:03-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> disconnected
```


Cheers,

Michael



---

archive/issue_comments_017533.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nMichael, Gary, did you test this after applying the patch I posted?",
    "created_at": "2008-06-17T22:04:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17533",
    "user": "https://github.com/yqiang"
}
```

<div id="comment:9" align="right">comment:9</div>

Michael, Gary, did you test this after applying the patch I posted?



---

archive/issue_comments_017534.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOk. I tried this with 3.0.3rc0 after applying both #3312 and #3314 and can't repro this.",
    "created_at": "2008-06-17T23:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17534",
    "user": "https://github.com/yqiang"
}
```

<div id="comment:10" align="right">comment:10</div>

Ok. I tried this with 3.0.3rc0 after applying both #3312 and #3314 and can't repro this.



---

archive/issue_events_035802.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-18T01:01:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "title_is": "[Positive review] dsage.setup() add_default_client broken",
    "title_was": "[Negative review] dsage.setup() add_default_client broken",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35802"
}
```



---

archive/issue_events_035803.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-18T04:39:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35803"
}
```



---

archive/issue_events_035804.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-18T04:39:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35804"
}
```



---

archive/issue_events_035805.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-18T23:18:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "milestone_number": null,
    "milestone_title": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35805"
}
```



---

archive/issue_events_035806.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-18T23:18:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-35806"
}
```



---

archive/issue_comments_017535.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nMerged in Sage 3.0.3.final",
    "created_at": "2008-06-18T23:18:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-17535",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:13" align="right">comment:13</div>

Merged in Sage 3.0.3.final
