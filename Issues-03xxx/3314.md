# Issue 3314: [Positive review] dsage.setup() add_default_client broken

archive/issues_003314.json:
```json
{
    "assignees": [],
    "body": "twisted changed it's conch interface and I forgot to toString the pubkey object in some instances. \n\n**Assignee:** @yqiang\n\n**Keywords:** editor_gfurnish\n\nIssue created by migration from https://trac.sagemath.org/ticket/3314\n\n",
    "closed_at": "2008-06-18T04:39:31Z",
    "created_at": "2008-05-27T05:43:21Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20dsage",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-3.0.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "[Positive review] dsage.setup() add_default_client broken",
    "type": "issue",
    "updated_at": "2008-06-18T23:18:43Z",
    "url": "https://github.com/sagemath/sage/issues/3314",
    "user": "https://github.com/yqiang"
}
```
twisted changed it's conch interface and I forgot to toString the pubkey object in some instances. 

**Assignee:** @yqiang

**Keywords:** editor_gfurnish

Issue created by migration from https://trac.sagemath.org/ticket/3314





---

archive/issue_events_028780.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T05:43:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28780"
}
```



---

archive/issue_events_028781.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T05:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting%3A%20cygwin",
    "label_color": "08517b",
    "label_name": "component: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28781"
}
```



---

archive/issue_events_028782.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T05:43:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28782"
}
```



---

archive/issue_comments_018362.json:
```json
{
    "body": "**Attachment:** [3314_default_users.patch.gz](https://github.com/sagemath/sage/files/ticket3314/3314_default_users.patch.gz)",
    "created_at": "2008-05-27T06:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18362",
    "user": "https://github.com/yqiang"
}
```

**Attachment:** [3314_default_users.patch.gz](https://github.com/sagemath/sage/files/ticket3314/3314_default_users.patch.gz)



---

archive/issue_events_028783.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2008-05-27T06:05:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28783"
}
```



---

archive/issue_events_028784.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-28T12:04:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28784"
}
```



---

archive/issue_events_028785.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-28T12:04:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20porting%3A%20cygwin",
    "label_color": "08517b",
    "label_name": "component: porting: cygwin",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28785"
}
```



---

archive/issue_events_028786.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-05-28T12:04:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20dsage",
    "label_color": "08517b",
    "label_name": "component: dsage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28786"
}
```



---

archive/issue_comments_018363.json:
```json
{
    "body": "**Changing assignee** from mabshoff to @yqiang.",
    "created_at": "2008-05-28T12:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18363",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

**Changing assignee** from mabshoff to @yqiang.



---

archive/issue_comments_018364.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"editor_gfurnish\".",
    "created_at": "2008-06-15T21:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18364",
    "user": "https://github.com/craigcitro"
}
```

**Changing keywords** from "" to "editor_gfurnish".



---

archive/issue_events_028787.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-16T20:31:26Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "rename": {
        "from": "dsage.setup() add_default_client broken",
        "to": "[Negative review] dsage.setup() add_default_client broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28787"
}
```



---

archive/issue_comments_018365.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nDSage is completely broken in 3.0.2 and 3.0.3!!!!!  Make me some patches so that I can actually run dsage.",
    "created_at": "2008-06-16T20:31:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18365",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:5'>**Comment 5:**</a>
DSage is completely broken in 3.0.2 and 3.0.3!!!!!  Make me some patches so that I can actually run dsage.



---

archive/issue_comments_018366.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nDSage is not completely broken in Sage 3.0.2 with the patch applied and in 3.3.0.rc0. If you make claims like that you should back them up with details.\n\nCheers,\n\nMichael",
    "created_at": "2008-06-16T21:50:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18366",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:6'>**Comment 6:**</a>
DSage is not completely broken in Sage 3.0.2 with the patch applied and in 3.3.0.rc0. If you make claims like that you should back them up with details.

Cheers,

Michael



---

archive/issue_comments_018367.json:
```json
{
    "body": "<a id='comment:7'>**Comment 7:**</a>\nIf you do not have an existing known good .sage directory with existing dsage materials from some previous version (unknown), dsage is completely broken.",
    "created_at": "2008-06-16T22:15:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18367",
    "user": "https://github.com/garyfurnish"
}
```

<a id='comment:7'>**Comment 7:**</a>
If you do not have an existing known good .sage directory with existing dsage materials from some previous version (unknown), dsage is completely broken.



---

archive/issue_comments_018368.json:
```json
{
    "body": "<a id='comment:8'>**Comment 8:**</a>\nOk, the bug is the following *after* deleting the dsage directory in DOT_SAGE:\n\n```\nmabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.0.3.rc0$ ./sage\n----------------------------------------------------------------------\n| SAGE Version 3.0.3.rc0, Release Date: 2008-06-16                   |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n\nsage: dsage.setup()\n==================================================\nGenerating public/private key pair for authentication...\nYour key will be stored in /home/mabshoff/.sage/dsage/dsage_key\nJust hit enter when prompted for a passphrase\n==================================================\n<SNIP>\nsage: dsage.start_all()\nSpawned twistd -d /home/mabshoff/.sage/dsage --pidfile=server.pid --logfile=/home/mabshoff/.sage/dsage/server.log -y dsage_server.tac (pid = 26784)\n\nSpawned python /scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/dsage_worker.py -s localhost -p 8087 -u mabshoff -w 2 --poll 1.0 -l 0 -f /home/mabshoff/.sage/dsage/worker.log --privkey=/home/mabshoff/.sage/dsage/dsage_key --pubkey=/home/mabshoff/.sage/dsage/dsage_key.pub --priority=20 --ssl --noblock (pid = 26801)\n\nNot connected.\nsage: \n```\n\nThe DSage server log says:\n\n```\n2008-06-16 17:08:52-0700 [-] Log opened.\n2008-06-16 17:08:52-0700 [-] twistd 8.0.1 (/scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/python 2.5.2) starting up\n2008-06-16 17:08:52-0700 [-] reactor class: <class 'twisted.internet.selectreactor.SelectReactor'>\n2008-06-16 17:08:52-0700 [-] twisted.spread.pb.PBServerFactory starting on 8087\n2008-06-16 17:08:52-0700 [-] Starting factory <twisted.spread.pb.PBServerFactory instance at 0x2b54f6e88998>\n2008-06-16 17:08:52-0700 [-] twisted.web2.channel.http.HTTPFactory starting on 8088\n2008-06-16 17:08:52-0700 [-] Starting factory <twisted.web2.channel.http.HTTPFactory instance at 0x2b54f6e88e60>\n2008-06-16 17:08:52-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> connected\n2008-06-16 17:08:53-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> connected\n2008-06-16 17:12:03-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> disconnected\n2008-06-16 17:12:03-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> disconnected\n```\n\n\nCheers,\n\nMichael",
    "created_at": "2008-06-17T00:15:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18368",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:8'>**Comment 8:**</a>
Ok, the bug is the following *after* deleting the dsage directory in DOT_SAGE:

```
mabshoff@sage:/scratch/mabshoff/release-cycle/sage-3.0.3.rc0$ ./sage
----------------------------------------------------------------------
| SAGE Version 3.0.3.rc0, Release Date: 2008-06-16                   |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------

sage: dsage.setup()
==================================================
Generating public/private key pair for authentication...
Your key will be stored in /home/mabshoff/.sage/dsage/dsage_key
Just hit enter when prompted for a passphrase
==================================================
<SNIP>
sage: dsage.start_all()
Spawned twistd -d /home/mabshoff/.sage/dsage --pidfile=server.pid --logfile=/home/mabshoff/.sage/dsage/server.log -y dsage_server.tac (pid = 26784)

Spawned python /scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/dsage_worker.py -s localhost -p 8087 -u mabshoff -w 2 --poll 1.0 -l 0 -f /home/mabshoff/.sage/dsage/worker.log --privkey=/home/mabshoff/.sage/dsage/dsage_key --pubkey=/home/mabshoff/.sage/dsage/dsage_key.pub --priority=20 --ssl --noblock (pid = 26801)

Not connected.
sage: 
```

The DSage server log says:

```
2008-06-16 17:08:52-0700 [-] Log opened.
2008-06-16 17:08:52-0700 [-] twistd 8.0.1 (/scratch/mabshoff/release-cycle/sage-3.0.3.rc0/local/bin/python 2.5.2) starting up
2008-06-16 17:08:52-0700 [-] reactor class: <class 'twisted.internet.selectreactor.SelectReactor'>
2008-06-16 17:08:52-0700 [-] twisted.spread.pb.PBServerFactory starting on 8087
2008-06-16 17:08:52-0700 [-] Starting factory <twisted.spread.pb.PBServerFactory instance at 0x2b54f6e88998>
2008-06-16 17:08:52-0700 [-] twisted.web2.channel.http.HTTPFactory starting on 8088
2008-06-16 17:08:52-0700 [-] Starting factory <twisted.web2.channel.http.HTTPFactory instance at 0x2b54f6e88e60>
2008-06-16 17:08:52-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> connected
2008-06-16 17:08:53-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> connected
2008-06-16 17:12:03-0700 [Broker,1,127.0.0.1] <client:'mabshoff'> disconnected
2008-06-16 17:12:03-0700 [Broker,2,127.0.0.1] <unauthenticated_worker:'Anonymous'> disconnected
```


Cheers,

Michael



---

archive/issue_comments_018369.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\nMichael, Gary, did you test this after applying the patch I posted?",
    "created_at": "2008-06-17T22:04:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18369",
    "user": "https://github.com/yqiang"
}
```

<a id='comment:9'>**Comment 9:**</a>
Michael, Gary, did you test this after applying the patch I posted?



---

archive/issue_comments_018370.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nOk. I tried this with 3.0.3rc0 after applying both #3312 and #3314 and can't repro this.",
    "created_at": "2008-06-17T23:00:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18370",
    "user": "https://github.com/yqiang"
}
```

<a id='comment:10'>**Comment 10:**</a>
Ok. I tried this with 3.0.3rc0 after applying both #3312 and #3314 and can't repro this.



---

archive/issue_events_028788.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-06-18T01:01:30Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "rename": {
        "from": "[Negative review] dsage.setup() add_default_client broken",
        "to": "[Positive review] dsage.setup() add_default_client broken"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28788"
}
```



---

archive/issue_events_028789.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-18T04:39:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28789"
}
```



---

archive/issue_events_028790.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-06-18T04:39:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28790"
}
```



---

archive/issue_events_028791.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-18T23:18:43Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "milestone_number": null,
    "milestone_title": "sage-3.0.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28791"
}
```



---

archive/issue_events_028792.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-06-18T23:18:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "milestone_number": null,
    "milestone_title": "sage-3.0.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/3314#event-28792"
}
```



---

archive/issue_comments_018371.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nMerged in Sage 3.0.3.final",
    "created_at": "2008-06-18T23:18:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/3314",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/3314#issuecomment-18371",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<a id='comment:13'>**Comment 13:**</a>
Merged in Sage 3.0.3.final
