# Issue 31657: Refine categories of Chart objects, add method codomain

archive/issues_031657.json:
```json
{
    "body": "CC:  egourgoulhon tscrim @mjungmath\n\n\n```\nsage: M = Manifold(2, 'R^2', structure='topological')\nsage: c_cart.<x,y> = M.chart() # Cartesian coordinates on R^2\nsage: c_cart.category()\nCategory of objects\n```\n\nA `Chart` instance is a continuous map from its domain to `R^n`. This should be reflected in the category\n\nIssue created by migration from https://trac.sagemath.org/ticket/31894\n\n",
    "created_at": "2021-06-02T02:05:04Z",
    "labels": [
        "manifolds",
        "major",
        "enhancement"
    ],
    "title": "Refine categories of Chart objects, add method codomain",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31657",
    "user": "mkoeppe"
}
```
CC:  egourgoulhon tscrim @mjungmath


```
sage: M = Manifold(2, 'R^2', structure='topological')
sage: c_cart.<x,y> = M.chart() # Cartesian coordinates on R^2
sage: c_cart.category()
Category of objects
```

A `Chart` instance is a continuous map from its domain to `R^n`. This should be reflected in the category

Issue created by migration from https://trac.sagemath.org/ticket/31894





---

archive/issue_comments_452078.json:
```json
{
    "body": "Here is an attempt; but there is a metaclass conflict between `Map` and `UniqueRepresentation` that I don't know how to resolve\n----\nNew commits:",
    "created_at": "2021-06-03T21:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452078",
    "user": "mkoeppe"
}
```

Here is an attempt; but there is a metaclass conflict between `Map` and `UniqueRepresentation` that I don't know how to resolve
----
New commits:



---

archive/issue_comments_452079.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-06-20T03:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452079",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_452080.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-24T18:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452080",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452081.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2021-07-12T21:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452081",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_452082.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-12T23:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452082",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452083.json:
```json
{
    "body": "This is almost ready, except that a `Chart` does not have the correct element class of the Homset, so some `_test_category` tests are failing. Help with this would be very welcome.",
    "created_at": "2021-07-12T23:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452083",
    "user": "mkoeppe"
}
```

This is almost ready, except that a `Chart` does not have the correct element class of the Homset, so some `_test_category` tests are failing. Help with this would be very welcome.



---

archive/issue_comments_452084.json:
```json
{
    "body": "We generally skip `_test_category` for `Homset` subclasses IIRC. They can often have multiple classes that are all elements because we need different implementations based on input types. We currently don't have a good system for dealing with parents with multiple element classes. `:/`",
    "created_at": "2021-07-12T23:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452084",
    "user": "tscrim"
}
```

We generally skip `_test_category` for `Homset` subclasses IIRC. They can often have multiple classes that are all elements because we need different implementations based on input types. We currently don't have a good system for dealing with parents with multiple element classes. `:/`



---

archive/issue_comments_452085.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T01:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452085",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452086.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T01:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452086",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452087.json:
```json
{
    "body": "Replying to [comment:17 tscrim]:\n> We generally skip `_test_category` for `Homset` subclasses IIRC. They can often have multiple classes that are all elements because we need different implementations based on input types.\n\nThanks, that's a simple solution. Ready for review then",
    "created_at": "2021-07-13T01:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452087",
    "user": "mkoeppe"
}
```

Replying to [comment:17 tscrim]:
> We generally skip `_test_category` for `Homset` subclasses IIRC. They can often have multiple classes that are all elements because we need different implementations based on input types.

Thanks, that's a simple solution. Ready for review then



---

archive/issue_comments_452088.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-13T01:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452088",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_452089.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T04:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452089",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452090.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-13T06:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452090",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_452091.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T07:39:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452091",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452092.json:
```json
{
    "body": "Why is a periodic chart considered non-surjective but injective? Isn't it exactly the opposite?\n\nBesides, Travis suggested that periodic charts could be considered being proper charts but glued together [#31324`@`comment:25](https://trac.sagemath.org/ticket/31324#comment:25). Maybe we can somehow incorporate this here?",
    "created_at": "2021-07-13T10:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452092",
    "user": "@mjungmath"
}
```

Why is a periodic chart considered non-surjective but injective? Isn't it exactly the opposite?

Besides, Travis suggested that periodic charts could be considered being proper charts but glued together [#31324`@`comment:25](https://trac.sagemath.org/ticket/31324#comment:25). Maybe we can somehow incorporate this here?



---

archive/issue_comments_452093.json:
```json
{
    "body": "I have two possible variants:\n\n- as of [acdb6a7](https://git.sagemath.org/sage.git/commit/?id=acdb6a72596070154f7a724ede91758c1fd11159), the codomain of the `Chart` is a fundamental cell of the periodic coordinate space. Presumably the user declares the periodic coordinates in a way that the computed coordinates always lie in the fundamental domain. Corestricted like this, the chart is bijective, with a bijective `ChartInverse` as its inverse. But it does not capture the fact that one is also allowed to use coordinates outside of the fundamental domain to construct a point.\n\n- with [243fcfd](https://git.sagemath.org/sage.git/commit/?id=243fcfda7112c8372e2cbfab058aba5335b0aff5) + work in progress (not on the branch yet), the `ChartInverse` is a surjection from the full coordinate space to the chart's domain, and `Chart` is a section map of the `ChartInverse`.\n\nI don't know which of the two you would find preferable and also cannot speak to Travis' suggestion regarding possible changes to the design.",
    "created_at": "2021-07-13T16:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452093",
    "user": "mkoeppe"
}
```

I have two possible variants:

- as of [acdb6a7](https://git.sagemath.org/sage.git/commit/?id=acdb6a72596070154f7a724ede91758c1fd11159), the codomain of the `Chart` is a fundamental cell of the periodic coordinate space. Presumably the user declares the periodic coordinates in a way that the computed coordinates always lie in the fundamental domain. Corestricted like this, the chart is bijective, with a bijective `ChartInverse` as its inverse. But it does not capture the fact that one is also allowed to use coordinates outside of the fundamental domain to construct a point.

- with [243fcfd](https://git.sagemath.org/sage.git/commit/?id=243fcfda7112c8372e2cbfab058aba5335b0aff5) + work in progress (not on the branch yet), the `ChartInverse` is a surjection from the full coordinate space to the chart's domain, and `Chart` is a section map of the `ChartInverse`.

I don't know which of the two you would find preferable and also cannot speak to Travis' suggestion regarding possible changes to the design.



---

archive/issue_comments_452094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-13T17:37:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452094",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452095.json:
```json
{
    "body": "Here's a more complete version of the second variant.",
    "created_at": "2021-07-13T17:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452095",
    "user": "mkoeppe"
}
```

Here's a more complete version of the second variant.



---

archive/issue_comments_452096.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2021-07-13T17:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452096",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_452097.json:
```json
{
    "body": "I like the second variant. It better reflects the situation and what periodic charts actually are.\n\nThen it also makes sense that periodic charts (as maps from a manifold subset into a subset of R^n) are injective but non-surjective.",
    "created_at": "2021-07-13T20:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452097",
    "user": "@mjungmath"
}
```

I like the second variant. It better reflects the situation and what periodic charts actually are.

Then it also makes sense that periodic charts (as maps from a manifold subset into a subset of R^n) are injective but non-surjective.



---

archive/issue_comments_452098.json:
```json
{
    "body": "But then we have to make a choice, right? The current situation is as follows (for example):\n\n\n```\nsage: S1 = manifolds.Sphere(1)\nsage: spher = S1.spherical_coordinates()\nsage: p = S1.point((pi,))\nsage: q = S1.point((-pi,))\nsage: spher(p)\n(pi,)\nsage: spher(q)\n(-pi,)\n```\n\n\nAt current stage, this is not a well-defined map.",
    "created_at": "2021-07-13T20:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452098",
    "user": "@mjungmath"
}
```

But then we have to make a choice, right? The current situation is as follows (for example):


```
sage: S1 = manifolds.Sphere(1)
sage: spher = S1.spherical_coordinates()
sage: p = S1.point((pi,))
sage: q = S1.point((-pi,))
sage: spher(p)
(pi,)
sage: spher(q)
(-pi,)
```


At current stage, this is not a well-defined map.



---

archive/issue_comments_452099.json:
```json
{
    "body": "That's right, there's currently no code to normalize the coordinates",
    "created_at": "2021-07-13T20:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452099",
    "user": "mkoeppe"
}
```

That's right, there's currently no code to normalize the coordinates



---

archive/issue_comments_452100.json:
```json
{
    "body": "It would all be easier if we had an implementation of `RR/ZZ` in Sage...",
    "created_at": "2021-07-13T20:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452100",
    "user": "mkoeppe"
}
```

It would all be easier if we had an implementation of `RR/ZZ` in Sage...



---

archive/issue_comments_452101.json:
```json
{
    "body": "Replying to [comment:32 mkoeppe]:\n> It would all be easier if we had an implementation of `RR/ZZ` in Sage...\n...or even better topological quotient spaces.",
    "created_at": "2021-07-13T20:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452101",
    "user": "@mjungmath"
}
```

Replying to [comment:32 mkoeppe]:
> It would all be easier if we had an implementation of `RR/ZZ` in Sage...
...or even better topological quotient spaces.



---

archive/issue_comments_452102.json:
```json
{
    "body": "OK, `QQ/ZZ` exists (`sage.groups.additive_abelian.qmodnz`), and we also have at least two incompatible implementations of lattices and their quotients in `sage.geometry.toric_lattice` and `sage.modules.free_module_integer`.  Perhaps also something in `sage.schemes` somewhere",
    "created_at": "2021-07-13T21:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452102",
    "user": "mkoeppe"
}
```

OK, `QQ/ZZ` exists (`sage.groups.additive_abelian.qmodnz`), and we also have at least two incompatible implementations of lattices and their quotients in `sage.geometry.toric_lattice` and `sage.modules.free_module_integer`.  Perhaps also something in `sage.schemes` somewhere



---

archive/issue_comments_452103.json:
```json
{
    "body": "What about abstract quotients in the spirit of #31644 and/or #31691?",
    "created_at": "2021-07-14T12:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452103",
    "user": "@mjungmath"
}
```

What about abstract quotients in the spirit of #31644 and/or #31691?



---

archive/issue_comments_452104.json:
```json
{
    "body": "Well, I have #32012 (Quotient of polyhedron or convex set by a lattice) but one has to be careful that things remain concrete enough to be useful, as the main point of the ticket is to make things more \"composable\".",
    "created_at": "2021-07-14T16:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452104",
    "user": "mkoeppe"
}
```

Well, I have #32012 (Quotient of polyhedron or convex set by a lattice) but one has to be careful that things remain concrete enough to be useful, as the main point of the ticket is to make things more "composable".



---

archive/issue_comments_452105.json:
```json
{
    "body": "Periodic charts are always defined via (connected) intervals, aren't they? W.l.o.g. we can always choose the minimum/maximum the chart maps to? Alternatively, we can make a chart a bijection onto (cross products of) half-open intervals? Please correct me if I'm wrong.",
    "created_at": "2021-07-15T17:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452105",
    "user": "@mjungmath"
}
```

Periodic charts are always defined via (connected) intervals, aren't they? W.l.o.g. we can always choose the minimum/maximum the chart maps to? Alternatively, we can make a chart a bijection onto (cross products of) half-open intervals? Please correct me if I'm wrong.



---

archive/issue_comments_452106.json:
```json
{
    "body": "Replying to [comment:29 gh-mjungmath]:\n> I like the second variant. It better reflects the situation and what periodic charts actually are.\n+1",
    "created_at": "2021-07-18T17:09:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452106",
    "user": "egourgoulhon"
}
```

Replying to [comment:29 gh-mjungmath]:
> I like the second variant. It better reflects the situation and what periodic charts actually are.
+1



---

archive/issue_comments_452107.json:
```json
{
    "body": "Replying to [comment:37 gh-mjungmath]:\n> Periodic charts are always defined via (connected) intervals, aren't they?\n\nYes I think so.\n\n> W.l.o.g. we can always choose the minimum/maximum the chart maps to? \n\nWhat do you mean?",
    "created_at": "2021-07-18T17:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452107",
    "user": "egourgoulhon"
}
```

Replying to [comment:37 gh-mjungmath]:
> Periodic charts are always defined via (connected) intervals, aren't they?

Yes I think so.

> W.l.o.g. we can always choose the minimum/maximum the chart maps to? 

What do you mean?



---

archive/issue_comments_452108.json:
```json
{
    "body": "Just a word of context about periodic charts: they have been introduced because they are useful when computing a geodesic with some [numerical integrator](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html). Typically, when the geodesic is an orbit around some center, the azimuthal coordinate returned by the integrator increases without any bound, instead of being confined to [0, 2\\pi). Here are some [examples in Kerr spacetime](https://nbviewer.jupyter.org/github/egourgoulhon/BHLectures/blob/master/sage/Kerr_geod_plots.ipynb).",
    "created_at": "2021-07-18T17:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452108",
    "user": "egourgoulhon"
}
```

Just a word of context about periodic charts: they have been introduced because they are useful when computing a geodesic with some [numerical integrator](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html). Typically, when the geodesic is an orbit around some center, the azimuthal coordinate returned by the integrator increases without any bound, instead of being confined to [0, 2\pi). Here are some [examples in Kerr spacetime](https://nbviewer.jupyter.org/github/egourgoulhon/BHLectures/blob/master/sage/Kerr_geod_plots.ipynb).



---

archive/issue_comments_452109.json:
```json
{
    "body": "Replying to [comment:38 egourgoulhon]:\n> Replying to [comment:29 gh-mjungmath]:\n> > I like the second variant. It better reflects the situation and what periodic charts actually are.\n> +1\n\nOK, then it just remains to make it well-defined (comment:30, comment:31)",
    "created_at": "2021-07-18T17:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452109",
    "user": "mkoeppe"
}
```

Replying to [comment:38 egourgoulhon]:
> Replying to [comment:29 gh-mjungmath]:
> > I like the second variant. It better reflects the situation and what periodic charts actually are.
> +1

OK, then it just remains to make it well-defined (comment:30, comment:31)



---

archive/issue_comments_452110.json:
```json
{
    "body": "Should `ManifoldPoint.add_coordinates` canonicalize the coordinates?\nOr should `ManifoldPoint.coordinates` do this?",
    "created_at": "2021-07-18T19:07:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452110",
    "user": "mkoeppe"
}
```

Should `ManifoldPoint.add_coordinates` canonicalize the coordinates?
Or should `ManifoldPoint.coordinates` do this?



---

archive/issue_comments_452111.json:
```json
{
    "body": "Replying to [comment:40 egourgoulhon]:\n> Just a word of context about periodic charts: they have been introduced because they are useful when computing a geodesic with some [numerical integrator](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html). Typically, when the geodesic is an orbit around some center, the azimuthal coordinate returned by the integrator increases without any bound, instead of being confined to [0, 2\\pi). Here are some [examples in Kerr spacetime](https://nbviewer.jupyter.org/github/egourgoulhon/BHLectures/blob/master/sage/Kerr_geod_plots.ipynb).\n\nI'm sorry. What is the punchline here?",
    "created_at": "2021-07-18T19:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452111",
    "user": "@mjungmath"
}
```

Replying to [comment:40 egourgoulhon]:
> Just a word of context about periodic charts: they have been introduced because they are useful when computing a geodesic with some [numerical integrator](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html). Typically, when the geodesic is an orbit around some center, the azimuthal coordinate returned by the integrator increases without any bound, instead of being confined to [0, 2\pi). Here are some [examples in Kerr spacetime](https://nbviewer.jupyter.org/github/egourgoulhon/BHLectures/blob/master/sage/Kerr_geod_plots.ipynb).

I'm sorry. What is the punchline here?



---

archive/issue_comments_452112.json:
```json
{
    "body": "Just forget what I just said. It didn't make sense. Sorry.",
    "created_at": "2021-07-18T19:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452112",
    "user": "@mjungmath"
}
```

Just forget what I just said. It didn't make sense. Sorry.



---

archive/issue_comments_452113.json:
```json
{
    "body": "Replying to [comment:39 egourgoulhon]:\n> > W.l.o.g. we can always choose the minimum/maximum the chart maps to? \n> \n> What do you mean? \n\nWhat we can do is that the user has to state the fundamental domain (which currently happens up to boundary only). Or *we* provide which boundary component belongs to the fundamental domain (I opt for the lower bound). Then it is clear which points the section map has to map to.\n\nFor the 1-sphere this could be for example the clopen interval `[-pi,pi)`. Then it becomes clear that the point on the 1-sphere determined by `pi` is mapped to `-pi` via the (section) chart. Similarly then for any other point.\n\nThe only obstruction I see right now is that the symbolic ring doesn't provide any modulo operation in the spirit of `x - y*floor(x/y)`. Or does it?",
    "created_at": "2021-07-18T19:45:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452113",
    "user": "@mjungmath"
}
```

Replying to [comment:39 egourgoulhon]:
> > W.l.o.g. we can always choose the minimum/maximum the chart maps to? 
> 
> What do you mean? 

What we can do is that the user has to state the fundamental domain (which currently happens up to boundary only). Or *we* provide which boundary component belongs to the fundamental domain (I opt for the lower bound). Then it is clear which points the section map has to map to.

For the 1-sphere this could be for example the clopen interval `[-pi,pi)`. Then it becomes clear that the point on the 1-sphere determined by `pi` is mapped to `-pi` via the (section) chart. Similarly then for any other point.

The only obstruction I see right now is that the symbolic ring doesn't provide any modulo operation in the spirit of `x - y*floor(x/y)`. Or does it?



---

archive/issue_comments_452114.json:
```json
{
    "body": "Replying to [comment:47 gh-mjungmath]:\n> the symbolic ring doesn't provide any modulo operation in the spirit of `x - y*floor(x/y)`.\n\nThat's right - this is #25644",
    "created_at": "2021-07-18T23:35:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452114",
    "user": "mkoeppe"
}
```

Replying to [comment:47 gh-mjungmath]:
> the symbolic ring doesn't provide any modulo operation in the spirit of `x - y*floor(x/y)`.

That's right - this is #25644



---

archive/issue_comments_452115.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452115",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_452116.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-19T02:15:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452116",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452117.json:
```json
{
    "body": "Replying to [comment:45 gh-mjungmath]:\n> Replying to [comment:40 egourgoulhon]:\n> > Just a word of context about periodic charts: they have been introduced because they are useful when computing a geodesic with some [numerical integrator](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html). Typically, when the geodesic is an orbit around some center, the azimuthal coordinate returned by the integrator increases without any bound, instead of being confined to [0, 2\\pi). Here are some [examples in Kerr spacetime](https://nbviewer.jupyter.org/github/egourgoulhon/BHLectures/blob/master/sage/Kerr_geod_plots.ipynb).\n> \n> I'm sorry. What is the punchline here?\n\nPeriodic charts are useful in practice. Otherwise, we could have lived without them, sticking to the standard definition of a chart on a manifold.",
    "created_at": "2021-07-19T07:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452117",
    "user": "egourgoulhon"
}
```

Replying to [comment:45 gh-mjungmath]:
> Replying to [comment:40 egourgoulhon]:
> > Just a word of context about periodic charts: they have been introduced because they are useful when computing a geodesic with some [numerical integrator](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html). Typically, when the geodesic is an orbit around some center, the azimuthal coordinate returned by the integrator increases without any bound, instead of being confined to [0, 2\pi). Here are some [examples in Kerr spacetime](https://nbviewer.jupyter.org/github/egourgoulhon/BHLectures/blob/master/sage/Kerr_geod_plots.ipynb).
> 
> I'm sorry. What is the punchline here?

Periodic charts are useful in practice. Otherwise, we could have lived without them, sticking to the standard definition of a chart on a manifold.



---

archive/issue_comments_452118.json:
```json
{
    "body": "I guess then, this ticket depends on #25644...",
    "created_at": "2021-07-19T09:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452118",
    "user": "@mjungmath"
}
```

I guess then, this ticket depends on #25644...



---

archive/issue_comments_452119.json:
```json
{
    "body": "Replying to [comment:51 egourgoulhon]:\n> > I'm sorry. What is the punchline here?\n> \n> Periodic charts are useful in practice. Otherwise, we could have lived without them, sticking to the standard definition of a chart on a manifold. \n\nThank you. It's clear now. It was my fault yesterday...",
    "created_at": "2021-07-19T09:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31657",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31657#issuecomment-452119",
    "user": "@mjungmath"
}
```

Replying to [comment:51 egourgoulhon]:
> > I'm sorry. What is the punchline here?
> 
> Periodic charts are useful in practice. Otherwise, we could have lived without them, sticking to the standard definition of a chart on a manifold. 

Thank you. It's clear now. It was my fault yesterday...
