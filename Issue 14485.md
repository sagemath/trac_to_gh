# Issue 14485: Atlas in sage 5.10.rc0 doesn't build if 'fast' doesn't work

Issue created by migration from https://trac.sagemath.org/ticket/14689

Original creator: Snark

Original creation time: 2013-06-05 08:16:02

Assignee: tbd

CC:  jpflori

I was trying to build sage 5.10.rc0 on a brand new box, and failed to build because the atlas spkg doesn't fall back to anything if 'fast' doesn't work.


---

Attachment

Log of the failing build


---

Comment by Snark created at 2013-06-05 08:28:36

Changing component from PLEASE CHANGE to build.


---

Comment by Snark created at 2013-06-05 08:28:36

Changing assignee from tbd to GeorgSWeber.


---

Attachment

cpuinfo of the box


---

Comment by Snark created at 2013-06-05 09:11:14

According to a discussion on #ubuntu-arm, -mfloat-abi=soft must have been forced down gcc's throat to make it want to #include stubs-soft.h, because it isn't correct for this platform.


---

Comment by Snark created at 2013-06-07 06:13:48

The box has gcc 4.7.3-1ubuntu1 and libc6 2.17-0ubuntu5.


---

Comment by Snark created at 2013-06-07 16:40:03

Ok, I tried to know a little more about it and found: [this erratum](http://math-atlas.sourceforge.net/errata.html#armhardfp). I'll try to see what can be done about it with upstream.


---

Comment by Snark created at 2013-06-08 18:17:10

Ok, I have tried to use the erratum to get around the issue and go further ; indeed I manage to compile quite a few things afterwards, but matplotlib fails because numpy doesn't work:

```
ImportError: /home/jpuydt/sage-5.10.rc1/local/lib/python2.7/site-packages/numpy/linalg/lapack_lite.so: undefined symbol: dpotrf_
```

and the reason it doesn't work can only be found in numpy's log:

```
    Lapack library (from ATLAS) is probably incomplete:
      size of /home/jpuydt/sage-5.10.rc1/local/lib/liblapack.so is 215k (expected >4000k)
```

I'll try to find out if the problem comes from:
1. the upstream workaround not being complete ;
2. my own repackaging of said workaround


---

Comment by Snark created at 2013-06-08 18:25:56

And the answer is: the upstream workaround is not complete.


---

Comment by jpflori created at 2013-06-11 22:02:58

I had issues with ATLAS not building LAPACK on Solaris because it used the non POSIX -r option, but we patch that, so the reason is elsewhere...

I'll give it a shot on an ARM devboard, but I fear it will be in two weeks from now...

I could try on a Raspberry Pi inbetween but that will surely take as long to fail :)


---

Comment by jpflori created at 2013-06-11 22:07:58

Could you post ATLAS log obtained after using the upstream workaround.

From your posts I understand the spkg built successfully (or said so at least).


---

Comment by jdemeyer created at 2014-12-14 17:28:16

Obsolete...


---

Comment by jdemeyer created at 2014-12-14 17:28:16

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-12-14 17:28:22

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-18 07:39:25

Resolution: invalid
