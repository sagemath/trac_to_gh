# Issue 27584: convering_design.py : Fix AttributeError

archive/issues_027584.json:
```json
{
    "body": "CC:  @seblabbe @slel\n\nFix the following bug.\n\n```\nsage: C = designs.best_known_covering_design_from_LJCR(7, 3, 2)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-a3d9f9e592f1> in <module>()\n----> 1 C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))\n\n/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.pyc in best_known_covering_design_www(v, k, t, verbose)\n    525     if verbose:\n    526         print(\"Looking up the bounds at %s\" % url)\n--> 527     with urlopen(url) as f:\n    528         s = bytes_to_str(f.read())\n    529     if 'covering not in database' in s:  # not found\n\nAttributeError: addinfourl instance has no attribute '__exit__'\n```\n\nFound by Sebastien Labb\u00e9 see #26592\n\nIssue created by migration from https://trac.sagemath.org/ticket/27821\n\n",
    "created_at": "2019-05-13T14:08:46Z",
    "labels": [
        "combinatorial designs",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "convering_design.py : Fix AttributeError",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27584",
    "user": "@vinklein"
}
```
CC:  @seblabbe @slel

Fix the following bug.

```
sage: C = designs.best_known_covering_design_from_LJCR(7, 3, 2)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-a3d9f9e592f1> in <module>()
----> 1 C = designs.best_known_covering_design_from_LJCR(Integer(7), Integer(3), Integer(2))

/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/combinat/designs/covering_design.pyc in best_known_covering_design_www(v, k, t, verbose)
    525     if verbose:
    526         print("Looking up the bounds at %s" % url)
--> 527     with urlopen(url) as f:
    528         s = bytes_to_str(f.read())
    529     if 'covering not in database' in s:  # not found

AttributeError: addinfourl instance has no attribute '__exit__'
```

Found by Sebastien LabbÃ© see #26592

Issue created by migration from https://trac.sagemath.org/ticket/27821





---

archive/issue_comments_389078.json:
```json
{
    "body": "Is this a solution:\n\n```\nfrom six.moves.urllib.request import urlopen\n```\n\n? This is what I used in #25535.",
    "created_at": "2019-05-13T14:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389078",
    "user": "@seblabbe"
}
```

Is this a solution:

```
from six.moves.urllib.request import urlopen
```

? This is what I used in #25535.



---

archive/issue_comments_389079.json:
```json
{
    "body": "Replying to [comment:4 slabbe]:\n> Is this a solution:\n> {{{\n> from six.moves.urllib.request import urlopen\n> }}}\n> ? This is what I used in #25535.\n\nNo because it is already used in `covering_design.py`.\nIn #25535 you use `with ... as` with a file objet, this works nicely.\n----\nNew commits:",
    "created_at": "2019-05-13T14:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389079",
    "user": "@vinklein"
}
```

Replying to [comment:4 slabbe]:
> Is this a solution:
> {{{
> from six.moves.urllib.request import urlopen
> }}}
> ? This is what I used in #25535.

No because it is already used in `covering_design.py`.
In #25535 you use `with ... as` with a file objet, this works nicely.
----
New commits:



---

archive/issue_comments_389080.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-13T14:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389080",
    "user": "@vinklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_389081.json:
```json
{
    "body": "As mentionned [here](https://groups.google.com/d/msg/sage-release/boCyh_RM9WU/Y8EyeFWLAgAJ), two files were having the same issue. We are almost there.\n\nThere is still one small issue:\n\n\n```\n$ sage -tp --long --optional=sage,optional,external src/sage/combinat/designs/covering_design.py  src/sage/combinat/designs/design_catalog.py\n```\n\ngives\n\n```\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2019-05-13-17-17-32-23591643.\nGit branch: 27821\nUsing --optional=4ti2,bliss,cbc,ccache,cmake,cryptominisat,dot2tex,e_antic,external,glucose,latte_int,lidia,lrslib,memlimit,mpir,ninja_build,normaliz,notedown,pandoc_attributes,pycosat,pynormaliz,python2,qhull,rst2ipynb,sage,topcom\nExternal software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\nDoctesting 2 files using 8 threads.\nsage -t --long src/sage/combinat/designs/design_catalog.py\n**********************************************************************\nFile \"src/sage/combinat/designs/design_catalog.py\", line 23, in sage.combinat.designs.design_catalog\nFailed example:\n    C                            # optional - internet\nExpected:\n    (7,3,2)-covering design of size 7\n    Lower bound: 7\n    Method: lex covering\n    Submitted on: 1996-12-01 00:00:00\nGot:\n    (7, 3, 2)-covering design of size 7\n    Lower bound: 7\n    Method: lex covering\n    Submitted on: 1996-12-01 00:00:00\n**********************************************************************\n1 item had failures:\n   1 of   5 in sage.combinat.designs.design_catalog\n    [4 tests, 1 failure, 0.73 s]\nsage -t --long src/sage/combinat/designs/covering_design.py\n    [49 tests, 0.73 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/combinat/designs/design_catalog.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.8 seconds\n    cpu time: 0.1 seconds\n    cumulative wall time: 1.5 seconds\nExternal software detected for doctesting: internet\n```\n",
    "created_at": "2019-05-13T15:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389081",
    "user": "@seblabbe"
}
```

As mentionned [here](https://groups.google.com/d/msg/sage-release/boCyh_RM9WU/Y8EyeFWLAgAJ), two files were having the same issue. We are almost there.

There is still one small issue:


```
$ sage -tp --long --optional=sage,optional,external src/sage/combinat/designs/covering_design.py  src/sage/combinat/designs/design_catalog.py
```

gives

```
too many failed tests, not using stored timings
Running doctests with ID 2019-05-13-17-17-32-23591643.
Git branch: 27821
Using --optional=4ti2,bliss,cbc,ccache,cmake,cryptominisat,dot2tex,e_antic,external,glucose,latte_int,lidia,lrslib,memlimit,mpir,ninja_build,normaliz,notedown,pandoc_attributes,pycosat,pynormaliz,python2,qhull,rst2ipynb,sage,topcom
External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
Doctesting 2 files using 8 threads.
sage -t --long src/sage/combinat/designs/design_catalog.py
**********************************************************************
File "src/sage/combinat/designs/design_catalog.py", line 23, in sage.combinat.designs.design_catalog
Failed example:
    C                            # optional - internet
Expected:
    (7,3,2)-covering design of size 7
    Lower bound: 7
    Method: lex covering
    Submitted on: 1996-12-01 00:00:00
Got:
    (7, 3, 2)-covering design of size 7
    Lower bound: 7
    Method: lex covering
    Submitted on: 1996-12-01 00:00:00
**********************************************************************
1 item had failures:
   1 of   5 in sage.combinat.designs.design_catalog
    [4 tests, 1 failure, 0.73 s]
sage -t --long src/sage/combinat/designs/covering_design.py
    [49 tests, 0.73 s]
----------------------------------------------------------------------
sage -t --long src/sage/combinat/designs/design_catalog.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 0.8 seconds
    cpu time: 0.1 seconds
    cumulative wall time: 1.5 seconds
External software detected for doctesting: internet
```




---

archive/issue_comments_389082.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-05-13T15:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389082",
    "user": "@seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_389083.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-13T16:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389083",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_389084.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-13T16:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389084",
    "user": "@vinklein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_389085.json:
```json
{
    "body": "The other doctest bug of design_catalog.py has been fixed.",
    "created_at": "2019-05-13T16:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389085",
    "user": "@vinklein"
}
```

The other doctest bug of design_catalog.py has been fixed.



---

archive/issue_comments_389086.json:
```json
{
    "body": "It works! Thank you.",
    "created_at": "2019-05-14T16:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389086",
    "user": "@seblabbe"
}
```

It works! Thank you.



---

archive/issue_comments_389087.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2019-05-14T16:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389087",
    "user": "@seblabbe"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_389088.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-14T16:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389088",
    "user": "@seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_389089.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-21T12:15:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27584",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27584#issuecomment-389089",
    "user": "@vbraun"
}
```

Resolution: fixed
