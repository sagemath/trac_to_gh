# Issue 28167: Sign of hypergeometric motives is sometimes wrong

Issue created by migration from https://trac.sagemath.org/ticket/28404

Original creator: kedlaya

Original creation time: 2019-08-26 04:57:52

Keywords: hypergeometric motives

The `sign` method of `HypergeometricData` sometimes returns answers that do not agree with Magma:

```
sage: from sage.modular.hypergeometric_motive import HypergeometricData as Hyp
sage: H = Hyp(cyclotomic=([6,2],[1,1,1]))
sage: [H.sign(1/4,p) for p in [5,7,11,13,17,19]] #correct
[1, 1, -1, -1, 1, 1]
sage: H = Hyp(cyclotomic=([1,1,1],[6,2]))
sage: [H.sign(4,p) for p in [5,7,11,13,17,19]] #should agree but doesn't
[-1, -1, -1, -1, -1, -1]
```

I believe this is because Magma's formula is not valid when `0 in alpha`. Note that this does not affect the `padic_H_value` or `euler_factor` methods because these do an alpha-beta swap to avoid this case (just as in Magma).

I have a fix for this coded up locally. Will post a patch shortly.



---

Comment by chapoton created at 2019-08-26 09:24:37

Maybe we should instead always switch when creating the object (in the `__init__`) when `0 in alpha` ?
----
New commits:
|                                                                                                                                          |                                    |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[61f3c25](https://git.sagemath.org/sage.git/commit?id=61f3c255338ac65d0a6fdaff4febd448ab5fee18)|`Fix sign of hypergeometric motives`|
|[8bbce1f](https://git.sagemath.org/sage.git/commit?id=8bbce1f713dfec2971a14433d3e629195bbeb1dd)|`Docstring edit`|
EDIT:

But maybe this is not a good idea, because the user will not get what he wants..


---

Comment by kedlaya created at 2019-08-26 17:16:13

Right, it is probably a bad idea to not return what is asked for. I understand that Magma originally did this and it caused all sorts of headaches.

A better idea might be, at creation time, if `0 in alpha`, instantiate the swapped data and save it in `H._swap`. Then one can access this attribute when `sign` is called (or for that matter `padic_H_value` or `H_value` or `euler_factor`).


---

Comment by git created at 2019-08-26 17:52:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kedlaya created at 2019-08-26 17:56:57

While implementing this last suggestion, I discovered I was getting strange irreproducible errors if I didn't perform

```
t = QQ(t)
```

before doing the swap (the value of t was sometimes getting cast to 0).


---

Comment by kedlaya created at 2019-08-26 17:56:57

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-08-26 18:27:19

I have changed a few details. I am setting to positive.
----
New commits:


---

Comment by chapoton created at 2019-08-26 18:27:19

Changing status from needs_review to positive_review.


---

Comment by kedlaya created at 2019-08-26 18:32:17

Looks good, thanks.


---

Comment by vbraun created at 2019-08-28 19:54:46

Resolution: fixed
