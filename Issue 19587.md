# Issue 19587: Faster comparison code in (real embedded) number fields

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2016-01-02 17:25:22

Using #19822 we provide a faster comparison code for number field elements when real embedding is defined (see #17830). We obtain `x10` speed up. The new code is also `x50` faster than comparisons in `QQbar` (with a fixed number field element!!). For the benchmarks, we used the following comparison function

```
def test(a,n):
    cf = continued_fraction(a)
    cv1 = a.parent()(cf.convergent(2*n+1))
    cv2 = a.parent()(cf.convergent(2*n+2))
    for _ in range(200):
        assert cv1 > a > cv2
```

Before

```
sage: x = polygen(ZZ)
sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)
sage: sage: %timeit test(a,10)
10 loops, best of 3: 51.1 ms per loop
sage: sage: %timeit test(a,20)
10 loops, best of 3: 67 ms per loop
sage: sage: %timeit test(a,100)
10 loops, best of 3: 108 ms per loop
sage: sage: %timeit test(a,200)
1 loops, best of 3: 154 ms per loop
```

after

```
sage: x = polygen(ZZ)
sage: K.<a> = NumberField(x^3 - 2, embedding=1.26)
sage: sage: sage: %timeit test(a,10)
100 loops, best of 3: 5.84 ms per loop
sage: sage: sage: %timeit test(a,20)
100 loops, best of 3: 10.2 ms per loop
sage: sage: sage: %timeit test(a,100)
10 loops, best of 3: 33.5 ms per loop
sage: sage: sage: %timeit test(a,200)
10 loops, best of 3: 64.8 ms per loop
```

To be compared with

```
sage: a = AA(2)**(1/3)
sage: a.exactify()
sage: sage: %timeit test(a,10)
10 loops, best of 3: 97.7 ms per loop
sage: sage: %timeit test(a,20)
10 loops, best of 3: 133 ms per loop
sage: sage: %timeit test(a,100)
1 loops, best of 3: 224 ms per loop
sage: sage: %timeit test(a,200)
1 loops, best of 3: 305 ms per loop
```



---

Comment by vdelecroix created at 2016-01-02 17:49:43

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2016-01-02 17:49:43

New commits:


---

Comment by git created at 2016-01-06 20:59:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2016-01-24 13:50:19

Changing type from PLEASE CHANGE to enhancement.


---

Comment by mmezzarobba created at 2016-03-25 10:26:58

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-03-27 07:44:28

Resolution: fixed
