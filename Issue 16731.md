# Issue 16731: Random failure in gaussian sampler

archive/issues_016731.json:
```json
{
    "body": "CC:  malb saraedum\n\nReported on sage-devel with sage-6.4.beta3:\n\n```\nsage -t --long src/sage/stats/distributions/discrete_gaussian_integer.pyx \n********************************************************************** \nFile \"src/sage/stats/distributions/discrete_gaussian_integer.pyx\", \nline 262, in sage.stats.distributions.discrete_gaussian_integer.DiscreteGaussianDistributionIntegerSampler.__init__ \nFailed example: \n    min(l), max(l), abs(mean(l)-2.5) < 0.01 \nExpected: \n    (-2, 7, True) \nGot: \n    (-2, 6, True) \n```\n\nThis happened also at http://trac.sagemath.org/ticket/15915#comment:54\n\nIssue created by migration from https://trac.sagemath.org/ticket/16968\n\n",
    "created_at": "2014-09-11T15:23:42Z",
    "labels": [
        "statistics",
        "major",
        "bug"
    ],
    "title": "Random failure in gaussian sampler",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16731",
    "user": "vbraun"
}
```
CC:  malb saraedum

Reported on sage-devel with sage-6.4.beta3:

```
sage -t --long src/sage/stats/distributions/discrete_gaussian_integer.pyx 
********************************************************************** 
File "src/sage/stats/distributions/discrete_gaussian_integer.pyx", 
line 262, in sage.stats.distributions.discrete_gaussian_integer.DiscreteGaussianDistributionIntegerSampler.__init__ 
Failed example: 
    min(l), max(l), abs(mean(l)-2.5) < 0.01 
Expected: 
    (-2, 7, True) 
Got: 
    (-2, 6, True) 
```

This happened also at http://trac.sagemath.org/ticket/15915#comment:54

Issue created by migration from https://trac.sagemath.org/ticket/16968





---

archive/issue_comments_221180.json:
```json
{
    "body": "Changing keywords from \"\" to \"random_fail\".",
    "created_at": "2014-09-11T15:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221180",
    "user": "vbraun"
}
```

Changing keywords from "" to "random_fail".



---

archive/issue_comments_221181.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-11T21:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221181",
    "user": "malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_221182.json:
```json
{
    "body": "The doctest is too strict (given the non-deterministic behaviour), so I made it more lenient.\n----\nNew commits:",
    "created_at": "2014-09-11T21:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221182",
    "user": "malb"
}
```

The doctest is too strict (given the non-deterministic behaviour), so I made it more lenient.
----
New commits:



---

archive/issue_comments_221183.json:
```json
{
    "body": "I guess the failure probability is a reasonably easy computation? Did you do it?",
    "created_at": "2014-09-11T23:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221183",
    "user": "vbraun"
}
```

I guess the failure probability is a reasonably easy computation? Did you do it?



---

archive/issue_comments_221184.json:
```json
{
    "body": "While we are at follow up from that ticket. SAGE_ROOT doesn't belong to module_list.py anymore. If you need it you are doing something wrong.\n\n```\n--- module_list.py.orig\t2014-09-12 15:03:19.370250091 +1200\n+++ module_list.py\t2014-09-12 15:02:13.930114901 +1200\n@@ -1998,10 +1998,9 @@\n \n     Extension('sage.stats.distributions.discrete_gaussian_integer',\n               sources = ['sage/stats/distributions/discrete_gaussian_integer.pyx', 'sage/stats/distributions/dgs_gauss_mp.c', 'sage/stats/distributions/dgs_gauss_dp.c', 'sage/stats/distributions/dgs_bern.c'],\n-              depends = ['sage/stats/distributions/dgs_gauss.h', 'sage/stats/distributions/dgs_bern.h'],\n+              depends = ['sage/stats/distributions/dgs_misc.h', 'sage/stats/distributions/dgs_gauss.h', 'sage/stats/distributions/dgs_bern.h'],\n               libraries = ['gmp', 'mpfr'],\n               extra_compile_args=[\"-std=c99\", \"-D_XOPEN_SOURCE=600\"],\n-              include_dirs = [SAGE_ROOT +\"/src/sage/stats/distributions\"],\n           ),\n \n     ################################\n```\n\nI can get a different ticket, I am just venting my frustration a bit at spending my time removing them.",
    "created_at": "2014-09-12T03:14:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221184",
    "user": "fbissey"
}
```

While we are at follow up from that ticket. SAGE_ROOT doesn't belong to module_list.py anymore. If you need it you are doing something wrong.

```
--- module_list.py.orig	2014-09-12 15:03:19.370250091 +1200
+++ module_list.py	2014-09-12 15:02:13.930114901 +1200
@@ -1998,10 +1998,9 @@
 
     Extension('sage.stats.distributions.discrete_gaussian_integer',
               sources = ['sage/stats/distributions/discrete_gaussian_integer.pyx', 'sage/stats/distributions/dgs_gauss_mp.c', 'sage/stats/distributions/dgs_gauss_dp.c', 'sage/stats/distributions/dgs_bern.c'],
-              depends = ['sage/stats/distributions/dgs_gauss.h', 'sage/stats/distributions/dgs_bern.h'],
+              depends = ['sage/stats/distributions/dgs_misc.h', 'sage/stats/distributions/dgs_gauss.h', 'sage/stats/distributions/dgs_bern.h'],
               libraries = ['gmp', 'mpfr'],
               extra_compile_args=["-std=c99", "-D_XOPEN_SOURCE=600"],
-              include_dirs = [SAGE_ROOT +"/src/sage/stats/distributions"],
           ),
 
     ################################
```

I can get a different ticket, I am just venting my frustration a bit at spending my time removing them.



---

archive/issue_comments_221185.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-12T09:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221185",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221186.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> While we are at follow up from that ticket. SAGE_ROOT doesn't belong to module_list.py anymore. If you need it you are doing something wrong.\n> {{{\n> --- module_list.py.orig\t2014-09-12 15:03:19.370250091 +1200\n> +++ module_list.py\t2014-09-12 15:02:13.930114901 +1200\n> `@``@` -1998,10 +1998,9 `@``@`\n>  \n>      Extension('sage.stats.distributions.discrete_gaussian_integer',\n>                sources = ['sage/stats/distributions/discrete_gaussian_integer.pyx', 'sage/stats/distributions/dgs_gauss_mp.c', 'sage/stats/distributions/dgs_gauss_dp.c', 'sage/stats/distributions/dgs_bern.c'],\n> -              depends = ['sage/stats/distributions/dgs_gauss.h', 'sage/stats/distributions/dgs_bern.h'],\n> +              depends = ['sage/stats/distributions/dgs_misc.h', 'sage/stats/distributions/dgs_gauss.h', 'sage/stats/distributions/dgs_bern.h'],\n>                libraries = ['gmp', 'mpfr'],\n>                extra_compile_args=[\"-std=c99\", \"-D_XOPEN_SOURCE=600\"],\n> -              include_dirs = [SAGE_ROOT +\"/src/sage/stats/distributions\"],\n>            ),\n>  \n>      ################################\n> }}}\n> I can get a different ticket, I am just venting my frustration a bit at spending my time removing them.\n\nUnderstood. This is now #16975",
    "created_at": "2014-09-12T09:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221186",
    "user": "malb"
}
```

Replying to [comment:5 fbissey]:
> While we are at follow up from that ticket. SAGE_ROOT doesn't belong to module_list.py anymore. If you need it you are doing something wrong.
> {{{
> --- module_list.py.orig	2014-09-12 15:03:19.370250091 +1200
> +++ module_list.py	2014-09-12 15:02:13.930114901 +1200
> `@``@` -1998,10 +1998,9 `@``@`
>  
>      Extension('sage.stats.distributions.discrete_gaussian_integer',
>                sources = ['sage/stats/distributions/discrete_gaussian_integer.pyx', 'sage/stats/distributions/dgs_gauss_mp.c', 'sage/stats/distributions/dgs_gauss_dp.c', 'sage/stats/distributions/dgs_bern.c'],
> -              depends = ['sage/stats/distributions/dgs_gauss.h', 'sage/stats/distributions/dgs_bern.h'],
> +              depends = ['sage/stats/distributions/dgs_misc.h', 'sage/stats/distributions/dgs_gauss.h', 'sage/stats/distributions/dgs_bern.h'],
>                libraries = ['gmp', 'mpfr'],
>                extra_compile_args=["-std=c99", "-D_XOPEN_SOURCE=600"],
> -              include_dirs = [SAGE_ROOT +"/src/sage/stats/distributions"],
>            ),
>  
>      ################################
> }}}
> I can get a different ticket, I am just venting my frustration a bit at spending my time removing them.

Understood. This is now #16975



---

archive/issue_comments_221187.json:
```json
{
    "body": "I also got the following from the buildbot right now:\n\n```\nsage -t --long src/sage/stats/distributions/discrete_gaussian_integer.pyx\n**********************************************************************\nFile \"src/sage/stats/distributions/discrete_gaussian_integer.pyx\", line 262, in sage.stats.distributions.discrete_gaussian_integer.DiscreteGaussianDistributionIntegerSampler.__init__\nFailed example:\n    min(l), max(l), abs(mean(l)-2.5) < 0.01\nExpected:\n    (-2, 7, True)\nGot:\n    (-1, 7, True)\n*********************************************************************\n```\n\nThis is covered by the current branch, just putting it out for the record.",
    "created_at": "2014-09-12T10:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221187",
    "user": "vbraun"
}
```

I also got the following from the buildbot right now:

```
sage -t --long src/sage/stats/distributions/discrete_gaussian_integer.pyx
**********************************************************************
File "src/sage/stats/distributions/discrete_gaussian_integer.pyx", line 262, in sage.stats.distributions.discrete_gaussian_integer.DiscreteGaussianDistributionIntegerSampler.__init__
Failed example:
    min(l), max(l), abs(mean(l)-2.5) < 0.01
Expected:
    (-2, 7, True)
Got:
    (-1, 7, True)
*********************************************************************
```

This is covered by the current branch, just putting it out for the record.



---

archive/issue_comments_221188.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-19T17:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221188",
    "user": "vbraun"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221189.json:
```json
{
    "body": "I got a new one:\n\n```\nsage -t --long --warn-long 61.7 src/sage/stats/distributions/discrete_gaussian_integer.pyx\n**********************************************************************\nFile \"src/sage/stats/distributions/discrete_gaussian_integer.pyx\", line 256, in sage.stats.distributions.discrete_gaussian_integer.DiscreteGaussianDistributionIntegerSampler.__init__\nFailed example:\n    min(l)==2-2*1.0, max(l)==2+2*1.0, mean(l).n()\nExpected:\n    (True, True, 2.45...)\nGot:\n    (True, True, 2.46120071411133)\n**********************************************************************\n```\n\nThis is not fixed by the current branch...",
    "created_at": "2014-09-19T17:47:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221189",
    "user": "vbraun"
}
```

I got a new one:

```
sage -t --long --warn-long 61.7 src/sage/stats/distributions/discrete_gaussian_integer.pyx
**********************************************************************
File "src/sage/stats/distributions/discrete_gaussian_integer.pyx", line 256, in sage.stats.distributions.discrete_gaussian_integer.DiscreteGaussianDistributionIntegerSampler.__init__
Failed example:
    min(l)==2-2*1.0, max(l)==2+2*1.0, mean(l).n()
Expected:
    (True, True, 2.45...)
Got:
    (True, True, 2.46120071411133)
**********************************************************************
```

This is not fixed by the current branch...



---

archive/issue_comments_221190.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-23T14:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221190",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221191.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-23T14:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221191",
    "user": "malb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_221192.json:
```json
{
    "body": "I committed a fix for this issue.",
    "created_at": "2014-09-23T14:21:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221192",
    "user": "malb"
}
```

I committed a fix for this issue.



---

archive/issue_comments_221193.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-23T14:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221193",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_221194.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-25T12:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16731",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16731#issuecomment-221194",
    "user": "vbraun"
}
```

Resolution: fixed
