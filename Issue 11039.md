# Issue 11039: elliptic curve p-adic L-series claims to default to eclib but doesn't

archive/issues_011039.json:
```json
{
    "body": "Assignee: cremona\n\nCC:  wuthrich\n\nThe code for making an elliptic curve p-adic L-series in schemes/elliptic_curves/padic_lseries.py starts like this:\n\n```\n    def __init__(self, E, p, use_eclib=False, normalize='L_ratio'):\n        r\"\"\"\n        INPUT:\n\n        -  ``E`` - an elliptic curve\n        -  ``p`` - a prime of good reduction\n        -  ``use_eclib`` - bool (default:True); whether or not to use\n           John Cremona's ``eclib`` for the computation of modular\n           symbols\n```\n\n\nNote that claim that use_eclib defaults to True and the fact that it doesn't. \n\nSince eclib is supposed to be correct, and is much faster, it should be the default as claimed in the docstring.  The fix should be a patch that changes the one __init__ line.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11211\n\n",
    "created_at": "2011-04-17T04:35:29Z",
    "labels": [
        "elliptic curves",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "elliptic curve p-adic L-series claims to default to eclib but doesn't",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11039",
    "user": "was"
}
```
Assignee: cremona

CC:  wuthrich

The code for making an elliptic curve p-adic L-series in schemes/elliptic_curves/padic_lseries.py starts like this:

```
    def __init__(self, E, p, use_eclib=False, normalize='L_ratio'):
        r"""
        INPUT:

        -  ``E`` - an elliptic curve
        -  ``p`` - a prime of good reduction
        -  ``use_eclib`` - bool (default:True); whether or not to use
           John Cremona's ``eclib`` for the computation of modular
           symbols
```


Note that claim that use_eclib defaults to True and the fact that it doesn't. 

Since eclib is supposed to be correct, and is much faster, it should be the default as claimed in the docstring.  The fix should be a patch that changes the one __init__ line.

Issue created by migration from https://trac.sagemath.org/ticket/11211





---

archive/issue_comments_120278.json:
```json
{
    "body": "Note: there is also a call to create the L-series in padics.py that has use_eclib=False by default and is documented correctly.  The attached patch changes both cases to default to True.",
    "created_at": "2011-04-17T04:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120278",
    "user": "was"
}
```

Note: there is also a call to create the L-series in padics.py that has use_eclib=False by default and is documented correctly.  The attached patch changes both cases to default to True.



---

archive/issue_comments_120279.json:
```json
{
    "body": "Attachment [trac_11211.patch](tarball://root/attachments/some-uuid/ticket11211/trac_11211.patch) by was created at 2011-04-17 04:41:47",
    "created_at": "2011-04-17T04:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120279",
    "user": "was"
}
```

Attachment [trac_11211.patch](tarball://root/attachments/some-uuid/ticket11211/trac_11211.patch) by was created at 2011-04-17 04:41:47



---

archive/issue_comments_120280.json:
```json
{
    "body": "I have CC'd Chris Wuthrich who I think is responsible for this code and should be able to judge.  It may be that there is some problem with part of eclib's modular symbols so they don't give exactly what is needed for this application.",
    "created_at": "2011-04-17T04:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120280",
    "user": "cremona"
}
```

I have CC'd Chris Wuthrich who I think is responsible for this code and should be able to judge.  It may be that there is some problem with part of eclib's modular symbols so they don't give exactly what is needed for this application.



---

archive/issue_comments_120281.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-04-17T04:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120281",
    "user": "was"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_120282.json:
```json
{
    "body": "I get zillions of errors in padic_lseries.py with this patch.  (31 in fact).\n\nThey all seem to be either\n\n```\nFile \"/home/jec/sage-4.7.alpha4/devel/sage-main/sage/schemes/elliptic_curves/padics.py\", iled example:\n    sig_on_count()\nExpected:\n    0\nGot:\n    1\n```\n\nor\n\n```\n        def __reduce__(self):\n      File \"rational.pyx\", line 484, in sage.rings.rational.Rational.__set_value (sage/rings/rational.c:7320)\n        elif isinstance(x, tuple) and len(x) == 2:\n      File \"/home/jec/sage-current/local/lib/python/site-packages/sage/modular/cusps.py\", line 512, in _rational_\n        raise TypeError, \"cusp %s is not a rational number\"%self\n    TypeError: cusp Infinity is not a rational number\n```\n\n\nAlso in padics.py I get similar sig_on_count errors, and also \n\n```\n\nFile \"/home/jec/sage-4.7.alpha4/devel/sage-main/sage/schemes/elliptic_curves/padics.py\", line 138:\n    sage: P(0)\nExpected:\n    3 + 3^2 + 2*3^4 + 2*3^5 + O(3^6)\nGot:\n    2 + 3 + 3^2 + 2*3^3 + 2*3^5 + 3^6 + O(3^7)\n```\n\nwhich looks not so trivial.\n\nI'll leave this as \"needs review\" and hope that Chris will also take a look.",
    "created_at": "2011-04-17T17:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120282",
    "user": "cremona"
}
```

I get zillions of errors in padic_lseries.py with this patch.  (31 in fact).

They all seem to be either

```
File "/home/jec/sage-4.7.alpha4/devel/sage-main/sage/schemes/elliptic_curves/padics.py", iled example:
    sig_on_count()
Expected:
    0
Got:
    1
```

or

```
        def __reduce__(self):
      File "rational.pyx", line 484, in sage.rings.rational.Rational.__set_value (sage/rings/rational.c:7320)
        elif isinstance(x, tuple) and len(x) == 2:
      File "/home/jec/sage-current/local/lib/python/site-packages/sage/modular/cusps.py", line 512, in _rational_
        raise TypeError, "cusp %s is not a rational number"%self
    TypeError: cusp Infinity is not a rational number
```


Also in padics.py I get similar sig_on_count errors, and also 

```

File "/home/jec/sage-4.7.alpha4/devel/sage-main/sage/schemes/elliptic_curves/padics.py", line 138:
    sage: P(0)
Expected:
    3 + 3^2 + 2*3^4 + 2*3^5 + O(3^6)
Got:
    2 + 3 + 3^2 + 2*3^3 + 2*3^5 + 3^6 + O(3^7)
```

which looks not so trivial.

I'll leave this as "needs review" and hope that Chris will also take a look.



---

archive/issue_comments_120283.json:
```json
{
    "body": "Replying to [comment:6 mderickx]:\nOK, I'm testing again against 4.7.alpha5 which has #10280 merged.",
    "created_at": "2011-04-22T10:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120283",
    "user": "cremona"
}
```

Replying to [comment:6 mderickx]:
OK, I'm testing again against 4.7.alpha5 which has #10280 merged.



---

archive/issue_comments_120284.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-22T11:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120284",
    "user": "cremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120285.json:
```json
{
    "body": "Replying to [comment:7 cremona]:\n> Replying to [comment:6 mderickx]:\n> OK, I'm testing again against 4.7.alpha5 which has #10280 merged.\n\nI still get lots of failures (they look just the same) in the same two files.  I don't know what is going on.",
    "created_at": "2011-04-22T11:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120285",
    "user": "cremona"
}
```

Replying to [comment:7 cremona]:
> Replying to [comment:6 mderickx]:
> OK, I'm testing again against 4.7.alpha5 which has #10280 merged.

I still get lots of failures (they look just the same) in the same two files.  I don't know what is going on.



---

archive/issue_comments_120286.json:
```json
{
    "body": "Hej John,\n\nSorry to make you think that the dependency would fix the issue. I just searched for trac to get a ticket which had the text \"depends on\" so I could test the new dependencies box I just created (look at the diff, it already said it depended on 10280).",
    "created_at": "2011-04-22T11:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120286",
    "user": "mderickx"
}
```

Hej John,

Sorry to make you think that the dependency would fix the issue. I just searched for trac to get a ticket which had the text "depends on" so I could test the new dependencies box I just created (look at the diff, it already said it depended on 10280).



---

archive/issue_comments_120287.json:
```json
{
    "body": "Replying to [comment:9 mderickx]:\n> Hej John,\n> \n> Sorry to make you think that the dependency would fix the issue. I just searched for trac to get a ticket which had the text \"depends on\" so I could test the new dependencies box I just created (look at the diff, it already said it depended on 10280).\n\nNo problem, I was just being optimistic.  I'm sure I can work out what is going on, since the problems arise only when eclib is used!",
    "created_at": "2011-04-22T11:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120287",
    "user": "cremona"
}
```

Replying to [comment:9 mderickx]:
> Hej John,
> 
> Sorry to make you think that the dependency would fix the issue. I just searched for trac to get a ticket which had the text "depends on" so I could test the new dependencies box I just created (look at the diff, it already said it depended on 10280).

No problem, I was just being optimistic.  I'm sure I can work out what is going on, since the problems arise only when eclib is used!



---

archive/issue_comments_120288.json:
```json
{
    "body": "Replaces previous;  applies to 4.7.alpha5",
    "created_at": "2011-04-22T14:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120288",
    "user": "cremona"
}
```

Replaces previous;  applies to 4.7.alpha5



---

archive/issue_comments_120289.json:
```json
{
    "body": "Attachment [trac_11211-modsym.patch](tarball://root/attachments/some-uuid/ticket11211/trac_11211-modsym.patch) by cremona created at 2011-04-22 14:19:42\n\nThe new patch (replaces previous) now works: there was some integer overflow.\n\nNow I cannot be the one to give this a positive review, though it deserves it!  William? Chris?",
    "created_at": "2011-04-22T14:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120289",
    "user": "cremona"
}
```

Attachment [trac_11211-modsym.patch](tarball://root/attachments/some-uuid/ticket11211/trac_11211-modsym.patch) by cremona created at 2011-04-22 14:19:42

The new patch (replaces previous) now works: there was some integer overflow.

Now I cannot be the one to give this a positive review, though it deserves it!  William? Chris?



---

archive/issue_comments_120290.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-22T14:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120290",
    "user": "cremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120291.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-24T03:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120291",
    "user": "was"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120292.json:
```json
{
    "body": "The buildbot discovered some doctest failures on 32-bit systems which I believe to come from this ticket (but I'm not completely sure):\n\n```\nsage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/sha_tate.py\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 483:\n    sage: EllipticCurve('858k2').sha().an_padic(7)   # rank 0, non trivial sha, long time (10s on sage.math, 2011)\nException raised:\n    Traceback (most recent call last):\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_7[5]>\", line 1, in <module>\n        EllipticCurve('858k2').sha().an_padic(Integer(7))   # rank 0, non trivial sha, long time (10s on sage.math, 2011)###line 483:\n    sage: EllipticCurve('858k2').sha().an_padic(7)   # rank 0, non trivial sha, long time (10s on sage.math, 2011)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 565, in an_padic\n        lp = Et.padic_lseries(p)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padics.py\", line 159, in padic_lseries\n        normalize = normalize, use_eclib=use_eclib)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py\", line 199, in __init__\n        self._modular_symbol = E.modular_symbol(sign=+1, use_eclib = use_eclib, normalize=normalize)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 1221, in modular_symbol\n        M = ell_modular_symbols.ModularSymbolECLIB(self, sign, normalize=normalize)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_modular_symbols.py\", line 499, in __init__\n        self._modsym = ECModularSymbol(E)\n      File \"newforms.pyx\", line 70, in sage.libs.cremona.newforms.ECModularSymbol.__init__ (sage/libs/cremona/newforms.cpp:1825)\n    OverflowError: long int too large to convert to int\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 740:\n    sage: e.sha().p_primary_bound(3)  # long time (10s on sage.math, 2011)\nException raised:\n    Traceback (most recent call last):\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_8[13]>\", line 1, in <module>\n        e.sha().p_primary_bound(Integer(3))  # long time (10s on sage.math, 2011)###line 740:\n    sage: e.sha().p_primary_bound(3)  # long time (10s on sage.math, 2011)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 766, in p_primary_bound\n        shan = self.an_padic(p,prec = 0,use_twists=True)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 565, in an_padic\n        lp = Et.padic_lseries(p)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padics.py\", line 159, in padic_lseries\n        normalize = normalize, use_eclib=use_eclib)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py\", line 199, in __init__\n        self._modular_symbol = E.modular_symbol(sign=+1, use_eclib = use_eclib, normalize=normalize)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 1221, in modular_symbol\n        M = ell_modular_symbols.ModularSymbolECLIB(self, sign, normalize=normalize)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_modular_symbols.py\", line 499, in __init__\n        self._modsym = ECModularSymbol(E)\n      File \"newforms.pyx\", line 70, in sage.libs.cremona.newforms.ECModularSymbol.__init__ (sage/libs/cremona/newforms.cpp:1825)\n    OverflowError: long int too large to convert to int\n**********************************************************************\nFile \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py\", line 748:\n    sage: e.sha().an_padic(7)  # long time (depends on \"e.sha().p_primary_bound(3)\" above)\nException raised:\n    Traceback (most recent call last):\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_8[15]>\", line 1, in <module>\n        e.sha().an_padic(Integer(7))  # long time (depends on \"e.sha().p_primary_bound(3)\" above)###line 748:\n    sage: e.sha().an_padic(7)  # long time (depends on \"e.sha().p_primary_bound(3)\" above)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 565, in an_padic\n        lp = Et.padic_lseries(p)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padics.py\", line 159, in padic_lseries\n        normalize = normalize, use_eclib=use_eclib)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py\", line 199, in __init__\n        self._modular_symbol = E.modular_symbol(sign=+1, use_eclib = use_eclib, normalize=normalize)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 1221, in modular_symbol\n        M = ell_modular_symbols.ModularSymbolECLIB(self, sign, normalize=normalize)\n      File \"/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_modular_symbols.py\", line 499, in __init__\n        self._modsym = ECModularSymbol(E)\n      File \"newforms.pyx\", line 70, in sage.libs.cremona.newforms.ECModularSymbol.__init__ (sage/libs/cremona/newforms.cpp:1825)\n    OverflowError: long int too large to convert to int\n**********************************************************************\n```\n",
    "created_at": "2011-05-03T08:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120292",
    "user": "jdemeyer"
}
```

The buildbot discovered some doctest failures on 32-bit systems which I believe to come from this ticket (but I'm not completely sure):

```
sage -t -long  -force_lib devel/sage/sage/schemes/elliptic_curves/sha_tate.py
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 483:
    sage: EllipticCurve('858k2').sha().an_padic(7)   # rank 0, non trivial sha, long time (10s on sage.math, 2011)
Exception raised:
    Traceback (most recent call last):
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_7[5]>", line 1, in <module>
        EllipticCurve('858k2').sha().an_padic(Integer(7))   # rank 0, non trivial sha, long time (10s on sage.math, 2011)###line 483:
    sage: EllipticCurve('858k2').sha().an_padic(7)   # rank 0, non trivial sha, long time (10s on sage.math, 2011)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 565, in an_padic
        lp = Et.padic_lseries(p)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padics.py", line 159, in padic_lseries
        normalize = normalize, use_eclib=use_eclib)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py", line 199, in __init__
        self._modular_symbol = E.modular_symbol(sign=+1, use_eclib = use_eclib, normalize=normalize)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 1221, in modular_symbol
        M = ell_modular_symbols.ModularSymbolECLIB(self, sign, normalize=normalize)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_modular_symbols.py", line 499, in __init__
        self._modsym = ECModularSymbol(E)
      File "newforms.pyx", line 70, in sage.libs.cremona.newforms.ECModularSymbol.__init__ (sage/libs/cremona/newforms.cpp:1825)
    OverflowError: long int too large to convert to int
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 740:
    sage: e.sha().p_primary_bound(3)  # long time (10s on sage.math, 2011)
Exception raised:
    Traceback (most recent call last):
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_8[13]>", line 1, in <module>
        e.sha().p_primary_bound(Integer(3))  # long time (10s on sage.math, 2011)###line 740:
    sage: e.sha().p_primary_bound(3)  # long time (10s on sage.math, 2011)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 766, in p_primary_bound
        shan = self.an_padic(p,prec = 0,use_twists=True)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 565, in an_padic
        lp = Et.padic_lseries(p)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padics.py", line 159, in padic_lseries
        normalize = normalize, use_eclib=use_eclib)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py", line 199, in __init__
        self._modular_symbol = E.modular_symbol(sign=+1, use_eclib = use_eclib, normalize=normalize)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 1221, in modular_symbol
        M = ell_modular_symbols.ModularSymbolECLIB(self, sign, normalize=normalize)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_modular_symbols.py", line 499, in __init__
        self._modsym = ECModularSymbol(E)
      File "newforms.pyx", line 70, in sage.libs.cremona.newforms.ECModularSymbol.__init__ (sage/libs/cremona/newforms.cpp:1825)
    OverflowError: long int too large to convert to int
**********************************************************************
File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/devel/sage-main/sage/schemes/elliptic_curves/sha_tate.py", line 748:
    sage: e.sha().an_padic(7)  # long time (depends on "e.sha().p_primary_bound(3)" above)
Exception raised:
    Traceback (most recent call last):
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_8[15]>", line 1, in <module>
        e.sha().an_padic(Integer(7))  # long time (depends on "e.sha().p_primary_bound(3)" above)###line 748:
    sage: e.sha().an_padic(7)  # long time (depends on "e.sha().p_primary_bound(3)" above)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 565, in an_padic
        lp = Et.padic_lseries(p)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padics.py", line 159, in padic_lseries
        normalize = normalize, use_eclib=use_eclib)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/padic_lseries.py", line 199, in __init__
        self._modular_symbol = E.modular_symbol(sign=+1, use_eclib = use_eclib, normalize=normalize)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 1221, in modular_symbol
        M = ell_modular_symbols.ModularSymbolECLIB(self, sign, normalize=normalize)
      File "/export/home/buildbot/build/sage/hawk-1/hawk_full/build/sage-4.7.1.alpha0/local/lib/python/site-packages/sage/schemes/elliptic_curves/ell_modular_symbols.py", line 499, in __init__
        self._modsym = ECModularSymbol(E)
      File "newforms.pyx", line 70, in sage.libs.cremona.newforms.ECModularSymbol.__init__ (sage/libs/cremona/newforms.cpp:1825)
    OverflowError: long int too large to convert to int
**********************************************************************
```




---

archive/issue_comments_120293.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-05-03T08:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120293",
    "user": "jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_120294.json:
```json
{
    "body": "I confirm the failure on 32-bit computers with Sage 4.7.1, where the patch applies smoothly.\n\nHowever there are already some tests that are known to fail on 32-bit, for example\nin `lib/cremona/newforms.pyx`:\n\n```\n            sage: from sage.libs.cremona.newforms import ECModularSymbol\n            sage: E = EllipticCurve('858k2')\n            sage: ECModularSymbol(E)\n            Traceback (most recent call last):                     # 32-bit\n            ...                                                    # 32-bit\n            OverflowError: long int too large to convert to int    # 32-bit\n```\n\nShould we mark the tests which are failing on 32-bit in the same way?\n\nPaul",
    "created_at": "2011-09-16T08:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120294",
    "user": "zimmerma"
}
```

I confirm the failure on 32-bit computers with Sage 4.7.1, where the patch applies smoothly.

However there are already some tests that are known to fail on 32-bit, for example
in `lib/cremona/newforms.pyx`:

```
            sage: from sage.libs.cremona.newforms import ECModularSymbol
            sage: E = EllipticCurve('858k2')
            sage: ECModularSymbol(E)
            Traceback (most recent call last):                     # 32-bit
            ...                                                    # 32-bit
            OverflowError: long int too large to convert to int    # 32-bit
```

Should we mark the tests which are failing on 32-bit in the same way?

Paul



---

archive/issue_comments_120295.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2011-09-16T08:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120295",
    "user": "zimmerma"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_120296.json:
```json
{
    "body": "I have tried to rebase this ticket, too. It seems to pass all test on my 64-bit. But I have no access to 32-bit and so I would need somone to review this who has. I copied as suggested the # 32-bit into sha_tate at the three occasions listed above. But I have no idea if that is all that is needed for 32 bit. \n\nSorry, if I did something wrong here.\n----\nNew commits:",
    "created_at": "2013-12-27T01:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120296",
    "user": "wuthrich"
}
```

I have tried to rebase this ticket, too. It seems to pass all test on my 64-bit. But I have no access to 32-bit and so I would need somone to review this who has. I copied as suggested the # 32-bit into sha_tate at the three occasions listed above. But I have no idea if that is all that is needed for 32 bit. 

Sorry, if I did something wrong here.
----
New commits:



---

archive/issue_comments_120297.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2013-12-27T01:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120297",
    "user": "wuthrich"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_120298.json:
```json
{
    "body": "I should be able to test this on my 2008 laptop which is 32-bit and on which I built 6.0 yesterday.  If it does, then Chris or Jeroen can give it a positive review?",
    "created_at": "2013-12-31T11:07:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120298",
    "user": "cremona"
}
```

I should be able to test this on my 2008 laptop which is 32-bit and on which I built 6.0 yesterday.  If it does, then Chris or Jeroen can give it a positive review?



---

archive/issue_comments_120299.json:
```json
{
    "body": "OK, so I had to change 3 error messages from\n\n```\nOverflowError: long int too large to convert to int\n```\n\nto\n\n```\nOverflowError: Python int too large to convert to C long\n```\n\nand then tests pass on 32-bit.",
    "created_at": "2013-12-31T15:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120299",
    "user": "cremona"
}
```

OK, so I had to change 3 error messages from

```
OverflowError: long int too large to convert to int
```

to

```
OverflowError: Python int too large to convert to C long
```

and then tests pass on 32-bit.



---

archive/issue_comments_120300.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-12-31T15:40:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120300",
    "user": "cremona"
}
```

New commits:



---

archive/issue_comments_120301.json:
```json
{
    "body": "What the purpose of the comment\n\n```\n# 32-bit (see :trac: `11211`)\n```\n\nthe fact that those tests don't work on 32-bit has nothing to do with this ticket, right?\nI would expect that ticket number to refer to a ticket saying \"make sure these tests pass even on 32-bit systems\".",
    "created_at": "2014-01-01T17:47:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120301",
    "user": "jdemeyer"
}
```

What the purpose of the comment

```
# 32-bit (see :trac: `11211`)
```

the fact that those tests don't work on 32-bit has nothing to do with this ticket, right?
I would expect that ticket number to refer to a ticket saying "make sure these tests pass even on 32-bit systems".



---

archive/issue_comments_120302.json:
```json
{
    "body": "One other small but important comment (possibly for a different ticket, but I felt I should mention it): do not put Python code inside `sig_on()`, espcially not if that Python code can raise exceptions. In particular, the following 3 lines (possibly more) should be outside the `sig_on()` block:\n\n```\nr = Cusp(r) \nd = r.denominator() \nn = r.numerator() \n```\n\n\nThe consequences of this can be severe:\n\n```\nsage: from sage.libs.cremona.newforms import ECModularSymbol\nsage: E = EllipticCurve('11a')\nsage: M = ECModularSymbol(E)\nsage: M(\"garbage\")\n...\nTypeError: unable to convert garbage to a rational\nsage: pari(\"1/0\")\n...\n------------------------------------------------------------------------\nUnhandled SIGSEGV: A segmentation fault occurred in Sage.\nThis probably occurred because a *compiled* component of Sage has a bug\nin it and is not properly wrapped with sig_on(), sig_off().\nSage will now terminate.\n------------------------------------------------------------------------\n```\n\n\nI also recommend that the line `M(\"garbage\")` should become a doctest.",
    "created_at": "2014-01-01T17:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120302",
    "user": "jdemeyer"
}
```

One other small but important comment (possibly for a different ticket, but I felt I should mention it): do not put Python code inside `sig_on()`, espcially not if that Python code can raise exceptions. In particular, the following 3 lines (possibly more) should be outside the `sig_on()` block:

```
r = Cusp(r) 
d = r.denominator() 
n = r.numerator() 
```


The consequences of this can be severe:

```
sage: from sage.libs.cremona.newforms import ECModularSymbol
sage: E = EllipticCurve('11a')
sage: M = ECModularSymbol(E)
sage: M("garbage")
...
TypeError: unable to convert garbage to a rational
sage: pari("1/0")
...
------------------------------------------------------------------------
Unhandled SIGSEGV: A segmentation fault occurred in Sage.
This probably occurred because a *compiled* component of Sage has a bug
in it and is not properly wrapped with sig_on(), sig_off().
Sage will now terminate.
------------------------------------------------------------------------
```


I also recommend that the line `M("garbage")` should become a doctest.



---

archive/issue_comments_120303.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-01-01T19:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120303",
    "user": "cremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_120304.json:
```json
{
    "body": "I will move the sigon() and upload a new commit tomorrow, with some new doctests.",
    "created_at": "2014-01-01T19:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120304",
    "user": "cremona"
}
```

I will move the sigon() and upload a new commit tomorrow, with some new doctests.



---

archive/issue_comments_120305.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-02T11:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120305",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_120306.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-01-02T11:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120306",
    "user": "cremona"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_120307.json:
```json
{
    "body": "If you accept this commit, positive_review to the `sig_on()` stuff (but I hope somebody else can review the rest of the ticket).",
    "created_at": "2014-01-03T20:54:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120307",
    "user": "jdemeyer"
}
```

If you accept this commit, positive_review to the `sig_on()` stuff (but I hope somebody else can review the rest of the ticket).



---

archive/issue_comments_120308.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-03T21:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120308",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_120309.json:
```json
{
    "body": "Chris, can you give this a positive review now?  You are the only reviewer not also an author, I think.",
    "created_at": "2014-01-07T19:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120309",
    "user": "cremona"
}
```

Chris, can you give this a positive review now?  You are the only reviewer not also an author, I think.



---

archive/issue_comments_120310.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-08T21:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120310",
    "user": "wuthrich"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_120311.json:
```json
{
    "body": "The tests pass for me (except a couple which I know is related to relocating the directory and not to this ticket).\nI can only test 64-bit, but I understand that 32-bit now passes all tests too.\n\nThanks for the work.",
    "created_at": "2014-01-08T21:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120311",
    "user": "wuthrich"
}
```

The tests pass for me (except a couple which I know is related to relocating the directory and not to this ticket).
I can only test 64-bit, but I understand that 32-bit now passes all tests too.

Thanks for the work.



---

archive/issue_comments_120312.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-01-10T07:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11039#issuecomment-120312",
    "user": "vbraun"
}
```

Resolution: fixed
