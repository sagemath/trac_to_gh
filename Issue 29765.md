# Issue 29765: force C locale in docbuild

Issue created by migration from https://trac.sagemath.org/ticket/30002

Original creator: dimpase

Original creation time: 2020-06-27 16:00:21

CC:  jhpalmieri heluani

currently WARNINGs are treated as errors, and we filter out harmless ones. Since Sphinx 3.0, docbuilds are localised, and fail if locale is e.g. French, cf. 

https://groups.google.com/d/msg/sage-release/7wBxNRbJaaU/hzptnsQpCQAJ

setting LANG=C provides a workaround.


---

Comment by arojas created at 2020-06-27 16:46:14

I think this is what you're looking for https://github.com/sphinx-doc/sphinx/commit/ae9d786390e62d2e265eddba5cea68485928e442


---

Comment by dimpase created at 2020-06-27 16:47:25

current sphinx has suppress_warnings


---

Comment by charpent created at 2020-06-27 17:00:46

FWIW

`LANG=C.UTF-8 make` succeeds.

With qualification : after this (successful) build of the documentation, `make` in an environment where `LANG` is fr_FR.utf-8 //fails//. `LANG=C.UTF-8 make` succeeds.

In other words, any use of `make` entailing an attempt to make/check the domumentation will fail if LANG amounts to french...


---

Comment by dimpase created at 2020-06-27 17:54:06

we can force locale in the Makefile, but this is a hack. I would like an intelligent suppression of warnings, rather than the current scraping on the output.


---

Comment by dimpase created at 2020-06-28 12:37:09

this should do the job, but we should have also have a long hard look at the mess of favicon and other warnings. Sphinx people [say](https://github.com/sphinx-doc/sphinx/issues/4860) that

```
[reference] WARNING: l'entrée html_static_path '/home/dimpase/sage/src/doc/common/static' n'existe pas
[reference] WARNING: l'entrée html_static_path 'static' n'existe pas
[reference] WARNING: le fichier de favicon 'favicon.ico' n'existe pas
```

is an indication of an incorrect configuraion.

There are also still some apparent leftovers of sagenb, e.g. stuff in `src/sage/ext_data/images/` - all of it added by commit `0f0517c0c90`:

```
commit 0f0517c0c90716340239eb348757449d1e36d194
Author: agc <agc@kubuntu>
Date:   Sun Dec 10 20:39:48 2006 -0800

    Added a dir "images", and put in several static images for the notebook.
```

and never touched ever since.
----
New commits:


---

Comment by dimpase created at 2020-06-28 12:37:09

Changing status from new to needs_review.


---

Comment by git created at 2020-06-28 12:47:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-28 23:21:22

Changing status from needs_review to positive_review.


---

Comment by heluani created at 2020-06-29 13:55:19

Nevermind, I  had not applied it yet. Sorry for the noise. 

In my system this patch results in a lot of warnings: 


```
bash: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)
```


I suppose this is because of 

```
$ locale -a
C
en_US.utf8
POSIX
```



---

Comment by dimpase created at 2020-06-29 14:06:33

does this break anything?

it could be that your locale setup is faulty - what kind of OS is this?


---

Comment by heluani created at 2020-07-02 16:06:20

Replying to [comment:13 dimpase]:
> does this break anything?
> 
> it could be that your locale setup is faulty - what kind of OS is this?
I missed this message, it does not break anything that I can see, it's arch linux, I only generate those locales by default:

```
$ grep -v '^#' /etc/locale.gen
en_US.UTF-8 UTF-8
```



---

Comment by arojas created at 2020-07-03 07:22:29

Replying to [comment:12 heluani]:
> In my system this patch results in a lot of warnings: 
> 
> {{{
> bash: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)
> }}}

Those warnings are unrelated to this ticket, they are caused by #29033


---

Comment by dimpase created at 2020-07-03 08:56:29

ok, I see. Should we fix it here, as #29033 is closed?


---

Comment by arojas created at 2020-07-03 09:46:01

Replying to [comment:17 dimpase]:
> ok, I see. Should we fix it here, as #29033 is closed?

It really has nothing to do with the change here, but the branch already contains another unrelated change so up to you, I guess.


---

Comment by dimpase created at 2020-07-03 12:27:04

Replying to [comment:18 arojas]:
> Replying to [comment:17 dimpase]:
> > ok, I see. Should we fix it here, as #29033 is closed?
> 
> It really has nothing to do with the change here, but the branch already contains another unrelated change so up to you, I guess.

let us do this on #30053


---

Comment by mkoeppe created at 2020-07-08 23:18:12

These have been merged into 9.2.beta4


---

Comment by mkoeppe created at 2020-07-08 23:18:12

Resolution: fixed
