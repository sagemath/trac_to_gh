# Issue 18219: Re-Fix standard_packages(), optional_packages(), and experimental_packages()

archive/issues_018219.json:
```json
{
    "body": "CC:  @nexttime @vbraun @jdemeyer\n\nWhat was fixed in `18407` (one week ago) has been broken since `:-P`\n\nThat's because the website went mostly down. Also, that new version handles both old-style spkg and new-style spkg.\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/18456\n\n",
    "created_at": "2015-05-19T20:54:56Z",
    "labels": [
        "distribution",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Re-Fix standard_packages(), optional_packages(), and experimental_packages()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18219",
    "user": "@nathanncohen"
}
```
CC:  @nexttime @vbraun @jdemeyer

What was fixed in `18407` (one week ago) has been broken since `:-P`

That's because the website went mostly down. Also, that new version handles both old-style spkg and new-style spkg.

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/18456





---

archive/issue_comments_246088.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-19T20:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246088",
    "user": "@nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_246089.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-05-19T20:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246089",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_246090.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-19T21:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246090",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246091.json:
```json
{
    "body": "I insstalled the branch and did \"make\" which rebuilt a very large amount.  Then\n\n```\n./sage -standard\n```\n\ngave\n\n```\nUsing Sage Server http://www.sagemath.org/spkg\nHTTP Error 404: Not Found\n\n\n\n********************************************************************************\n\n\n\nError contacting http://www.sagemath.org/spkg/standard/list. Try using an alternative server.\nFor example, from the bash prompt try typing\n\n   export SAGE_SERVER=http://sage.scipy.org/sage/\n\nthen try again.\n```\n\nwhich also failed.  SO I don't exactly know what it is that I am supposed to be testing!",
    "created_at": "2015-05-28T08:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246091",
    "user": "@JohnCremona"
}
```

I insstalled the branch and did "make" which rebuilt a very large amount.  Then

```
./sage -standard
```

gave

```
Using Sage Server http://www.sagemath.org/spkg
HTTP Error 404: Not Found



********************************************************************************



Error contacting http://www.sagemath.org/spkg/standard/list. Try using an alternative server.
For example, from the bash prompt try typing

   export SAGE_SERVER=http://sage.scipy.org/sage/

then try again.
```

which also failed.  SO I don't exactly know what it is that I am supposed to be testing!



---

archive/issue_comments_246092.json:
```json
{
    "body": "Hello !\n\n> I insstalled the branch and did \"make\" which rebuilt a very large amount.\n\nThis is suspicious. As you can see from the branch's diff, it only touches one file (i.e. sage/misc/package.py) which is not a dependency of anything as far as I know. I just did a checkout on the branch, and no recompilation was triggered at all.\n\n> which also failed.  SO I don't exactly know what it is that I am supposed to be testing!\n\nThis branch fixes the three functions `standard_packages`, `optional_packages`, and `experimental_packages` defined in `sage/misc/package.py`. The script `sage -standard` script does not call them.\n\nIn order to fix `sage -standard`, it makes more sense to make it call a Sage function that does the job. Previously, `standard_packages` ran `sage -standard` and parsed its output: it would be better to have `sage -standard` call `standard_packages` (without any parsing).\n\nThat would require changing the output or `standard_packages`, as currently it only returns the list of packages without including the version numbers.\n\nNathann",
    "created_at": "2015-05-28T08:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246092",
    "user": "@nathanncohen"
}
```

Hello !

> I insstalled the branch and did "make" which rebuilt a very large amount.

This is suspicious. As you can see from the branch's diff, it only touches one file (i.e. sage/misc/package.py) which is not a dependency of anything as far as I know. I just did a checkout on the branch, and no recompilation was triggered at all.

> which also failed.  SO I don't exactly know what it is that I am supposed to be testing!

This branch fixes the three functions `standard_packages`, `optional_packages`, and `experimental_packages` defined in `sage/misc/package.py`. The script `sage -standard` script does not call them.

In order to fix `sage -standard`, it makes more sense to make it call a Sage function that does the job. Previously, `standard_packages` ran `sage -standard` and parsed its output: it would be better to have `sage -standard` call `standard_packages` (without any parsing).

That would require changing the output or `standard_packages`, as currently it only returns the list of packages without including the version numbers.

Nathann



---

archive/issue_comments_246093.json:
```json
{
    "body": "You are right to be suspicious.  I was starting from 6.8.beta0, while I think that the branch branched off from 6.7 -- right?  That would explain the extra rebuilding.",
    "created_at": "2015-05-28T09:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246093",
    "user": "@JohnCremona"
}
```

You are right to be suspicious.  I was starting from 6.8.beta0, while I think that the branch branched off from 6.7 -- right?  That would explain the extra rebuilding.



---

archive/issue_comments_246094.json:
```json
{
    "body": "> You are right to be suspicious.  I was starting from 6.8.beta0, while I think that the branch branched off from 6.7 -- right?  That would explain the extra rebuilding.\n\nYep, totally. If it can be of interest to you, I use a short bash script that downloads a branch for me, and merges it with my current beta. This way, I never go back to an earlier version of sage and I avoid these problems.\n\nAbout `sage -standard`: I added a commit at public/18456v2 that makes it work again, though without the version number.\n\nI can add it to this ticket if you want.\n\nNathann",
    "created_at": "2015-05-28T09:27:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246094",
    "user": "@nathanncohen"
}
```

> You are right to be suspicious.  I was starting from 6.8.beta0, while I think that the branch branched off from 6.7 -- right?  That would explain the extra rebuilding.

Yep, totally. If it can be of interest to you, I use a short bash script that downloads a branch for me, and merges it with my current beta. This way, I never go back to an earlier version of sage and I avoid these problems.

About `sage -standard`: I added a commit at public/18456v2 that makes it work again, though without the version number.

I can add it to this ticket if you want.

Nathann



---

archive/issue_comments_246095.json:
```json
{
    "body": "Replying to [comment:7 ncohen]:\n> > You are right to be suspicious.  I was starting from 6.8.beta0, while I think that the branch branched off from 6.7 -- right?  That would explain the extra rebuilding.\n> \n> Yep, totally. If it can be of interest to you, I use a short bash script that downloads a branch for me, and merges it with my current beta. This way, I never go back to an earlier version of sage and I avoid these problems.\n> \n> About `sage -standard`: I added a commit at public/18456v2 that makes it work again, though without the version number.\n> \n> I can add it to this ticket if you want.\n\nWell, if it doesn't work as is then it cannot get a positive review anyway, so I have changed it to \"needs work\" and can try again after you have added what is needed to make it work!\n\n\n> \n> Nathann",
    "created_at": "2015-05-28T09:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246095",
    "user": "@JohnCremona"
}
```

Replying to [comment:7 ncohen]:
> > You are right to be suspicious.  I was starting from 6.8.beta0, while I think that the branch branched off from 6.7 -- right?  That would explain the extra rebuilding.
> 
> Yep, totally. If it can be of interest to you, I use a short bash script that downloads a branch for me, and merges it with my current beta. This way, I never go back to an earlier version of sage and I avoid these problems.
> 
> About `sage -standard`: I added a commit at public/18456v2 that makes it work again, though without the version number.
> 
> I can add it to this ticket if you want.

Well, if it doesn't work as is then it cannot get a positive review anyway, so I have changed it to "needs work" and can try again after you have added what is needed to make it work!


> 
> Nathann



---

archive/issue_comments_246096.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-05-28T09:47:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246096",
    "user": "@JohnCremona"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_246097.json:
```json
{
    "body": "> Well, if it doesn't work as is then it cannot get a positive review anyway, so I have changed it to \"needs work\" and can try again after you have added what is needed to make it work!\n\nYou got me wrong: it does not work in the latest beta either. None of the two work. And this ticket fixes one of the two.\n\nNathann",
    "created_at": "2015-05-28T09:49:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246097",
    "user": "@nathanncohen"
}
```

> Well, if it doesn't work as is then it cannot get a positive review anyway, so I have changed it to "needs work" and can try again after you have added what is needed to make it work!

You got me wrong: it does not work in the latest beta either. None of the two work. And this ticket fixes one of the two.

Nathann



---

archive/issue_comments_246098.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-28T09:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246098",
    "user": "@nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_246099.json:
```json
{
    "body": "Again: if you want I can add this other commit. It makes 'sage -standard' call the functions I fix in this branch and display the list of packages (though without the version number).\n\nNathann",
    "created_at": "2015-05-28T10:08:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246099",
    "user": "@nathanncohen"
}
```

Again: if you want I can add this other commit. It makes 'sage -standard' call the functions I fix in this branch and display the list of packages (though without the version number).

Nathann



---

archive/issue_comments_246100.json:
```json
{
    "body": "Sorry, I ran out of time on this and have to go to give an exam (and grade 257 scripts) now.  For whoever comes next to the ticket, you will have to explain better why something known not to work is still on \"needs review\" since I don't understand!",
    "created_at": "2015-05-28T12:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246100",
    "user": "@JohnCremona"
}
```

Sorry, I ran out of time on this and have to go to give an exam (and grade 257 scripts) now.  For whoever comes next to the ticket, you will have to explain better why something known not to work is still on "needs review" since I don't understand!



---

archive/issue_comments_246101.json:
```json
{
    "body": "> For whoever comes next to the ticket, you will have to explain better why something known not to work is still on \"needs review\" since I don't understand!\n\nI do not know where you got the idea that this branch breaks anything. If you tell me what, I can surely explain. This branch fixes three functions, as advertised in the ticket's title.\n\nNathann",
    "created_at": "2015-05-28T12:25:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246101",
    "user": "@nathanncohen"
}
```

> For whoever comes next to the ticket, you will have to explain better why something known not to work is still on "needs review" since I don't understand!

I do not know where you got the idea that this branch breaks anything. If you tell me what, I can surely explain. This branch fixes three functions, as advertised in the ticket's title.

Nathann



---

archive/issue_comments_246102.json:
```json
{
    "body": "I believe we should fix `sage -standard` and similar on this ticket. I think what John is confused about is that this currently fixes the interactive Sage functions (i.e., run from within Sage), not those you run on the shell.\n\nI'm okay with the output on `public/18456v2`, but I'd feel more comfortable if someone more experienced with (Sage's) bash scripts (and those who might have an opinion on this) took a look at it before giving this a positive review.",
    "created_at": "2015-05-29T17:48:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246102",
    "user": "@tscrim"
}
```

I believe we should fix `sage -standard` and similar on this ticket. I think what John is confused about is that this currently fixes the interactive Sage functions (i.e., run from within Sage), not those you run on the shell.

I'm okay with the output on `public/18456v2`, but I'd feel more comfortable if someone more experienced with (Sage's) bash scripts (and those who might have an opinion on this) took a look at it before giving this a positive review.



---

archive/issue_comments_246103.json:
```json
{
    "body": "Replying to [comment:5 ncohen]:\n> In order to fix `sage -standard`, it makes more sense to make it call a Sage function that does the job. \n\nI don't agree with this: ideally, `sage --standard`, `sage --optional`, etc., should work without building Sage, or with a partially built Sage.",
    "created_at": "2015-05-29T19:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246103",
    "user": "@jhpalmieri"
}
```

Replying to [comment:5 ncohen]:
> In order to fix `sage -standard`, it makes more sense to make it call a Sage function that does the job. 

I don't agree with this: ideally, `sage --standard`, `sage --optional`, etc., should work without building Sage, or with a partially built Sage.



---

archive/issue_comments_246104.json:
```json
{
    "body": "Hello guys,\n\nI wrote this fix for `sage -standard` because that is what everybody seems attracted to, but really my goal here is only to fix `standard_packages` (and others) so that I can use them in #18408. And then, in turn, update #18405.\n\nRight now, everything is broken. And I personally prefer by far to have the `*_package` functions get ther info directly from the server than parse the output of a command-line tool as it is done at the moment.\n\nNathann",
    "created_at": "2015-05-29T22:40:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246104",
    "user": "@nathanncohen"
}
```

Hello guys,

I wrote this fix for `sage -standard` because that is what everybody seems attracted to, but really my goal here is only to fix `standard_packages` (and others) so that I can use them in #18408. And then, in turn, update #18405.

Right now, everything is broken. And I personally prefer by far to have the `*_package` functions get ther info directly from the server than parse the output of a command-line tool as it is done at the moment.

Nathann



---

archive/issue_comments_246105.json:
```json
{
    "body": "Just to make sure I understand: the original purpose of this ticket was to fix `standard_packages` (etc.), but not `sage --standard`, right? That's fine with me.\n\nFor ease of maintenance (and for cleanliness of code, which isn't quite as important), it would be best to not duplicate the work, so it would be best to have `standard_packages` rely on `sage --standard`, or vice versa. My strong preference is for `sage --standard` to *not* rely on `standard_packages`, since `sage --standard` should work without having built Sage.\n\nThat's my opinion, but I don't feel that strongly about the code duplication, so I personally won't object if this ticket only fixes `standard_packages` (etc.) by having it talk directly to the server. I *will* object if it also fixes `sage --standard` in such a way that it won't work right after unpacking a fresh tarball.\n\n(In my brief tests, by the way, this does fix the Sage functions as intended. But I haven't looked at the actual changes to see if they make sense.)",
    "created_at": "2015-05-29T23:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246105",
    "user": "@jhpalmieri"
}
```

Just to make sure I understand: the original purpose of this ticket was to fix `standard_packages` (etc.), but not `sage --standard`, right? That's fine with me.

For ease of maintenance (and for cleanliness of code, which isn't quite as important), it would be best to not duplicate the work, so it would be best to have `standard_packages` rely on `sage --standard`, or vice versa. My strong preference is for `sage --standard` to *not* rely on `standard_packages`, since `sage --standard` should work without having built Sage.

That's my opinion, but I don't feel that strongly about the code duplication, so I personally won't object if this ticket only fixes `standard_packages` (etc.) by having it talk directly to the server. I *will* object if it also fixes `sage --standard` in such a way that it won't work right after unpacking a fresh tarball.

(In my brief tests, by the way, this does fix the Sage functions as intended. But I haven't looked at the actual changes to see if they make sense.)



---

archive/issue_comments_246106.json:
```json
{
    "body": "Hello !\n\n> For ease of maintenance (and for cleanliness of code, which isn't quite as important), it would be best to not duplicate the work, so it would be best to have `standard_packages` rely on `sage --standard`, or vice versa.\n\n+1\n\n> My strong preference is for `sage --standard` to *not* rely on `standard_packages`, since `sage --standard` should work without having built Sage.\n\nThat's what I tried first, i.e. fix `sage --standard`. But then you have some problems, like undefined environment variables, and you must re-parse everything in `standard_packages` again.\n\nI thought a bit about making this script dependent on sage, and I actually ended up wondering whether .... we need those `sage -standard` scripts. Right now they are totally broken, and... Well, if we do not need them then perhaps we should stop maintaining them. They returned outdated information long before they broke.\n\n> (In my brief tests, by the way, this does fix the Sage functions as intended. But I haven't looked at the actual changes to see if they make sense.)\n\nI hope that they do `;-)`\n\nNathann",
    "created_at": "2015-05-30T06:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246106",
    "user": "@nathanncohen"
}
```

Hello !

> For ease of maintenance (and for cleanliness of code, which isn't quite as important), it would be best to not duplicate the work, so it would be best to have `standard_packages` rely on `sage --standard`, or vice versa.

+1

> My strong preference is for `sage --standard` to *not* rely on `standard_packages`, since `sage --standard` should work without having built Sage.

That's what I tried first, i.e. fix `sage --standard`. But then you have some problems, like undefined environment variables, and you must re-parse everything in `standard_packages` again.

I thought a bit about making this script dependent on sage, and I actually ended up wondering whether .... we need those `sage -standard` scripts. Right now they are totally broken, and... Well, if we do not need them then perhaps we should stop maintaining them. They returned outdated information long before they broke.

> (In my brief tests, by the way, this does fix the Sage functions as intended. But I haven't looked at the actual changes to see if they make sense.)

I hope that they do `;-)`

Nathann



---

archive/issue_comments_246107.json:
```json
{
    "body": "Okay. Third fix.\n\nThis one fixes the three functions AND the `sage -standard` commands (which do not need Sage to be compiled). The executable now has a 'dump' options so that there is not much parsing left to do on Sage's side when running that script to get some info.\n\nWhen it will be reviewed, I will be able to add a cool feature: automatic test of (installed) optional packages.\n\nNeeds review again,\n\nNathann",
    "created_at": "2015-05-31T07:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246107",
    "user": "@nathanncohen"
}
```

Okay. Third fix.

This one fixes the three functions AND the `sage -standard` commands (which do not need Sage to be compiled). The executable now has a 'dump' options so that there is not much parsing left to do on Sage's side when running that script to get some info.

When it will be reviewed, I will be able to add a cool feature: automatic test of (installed) optional packages.

Needs review again,

Nathann



---

archive/issue_comments_246108.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-05-31T07:58:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246108",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246109.json:
```json
{
    "body": "> add a cool feature: automatic test of (installed) optional packages.\nDone at #18558\n\nNathann",
    "created_at": "2015-05-31T08:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246109",
    "user": "@nathanncohen"
}
```

> add a cool feature: automatic test of (installed) optional packages.
Done at #18558

Nathann



---

archive/issue_comments_246110.json:
```json
{
    "body": "What do you think about either of these changes?\n\n```diff\ndiff --git a/src/bin/sage-list-packages b/src/bin/sage-list-packages\nindex 5b17272..e1b0889 100755\n--- a/src/bin/sage-list-packages\n+++ b/src/bin/sage-list-packages\n@@ -16,7 +16,12 @@ SAGE_ROOT = os.environ[\"SAGE_ROOT\"]\n # Input parsing #\n #################\n \n-parser = argparse.ArgumentParser(description=\"List Sage's packages\")\n+parser = argparse.ArgumentParser(formatter_class=argparse.RawDescriptionHelpFormatter,\n+                                 description=\"\"\"List Sage's packages, by default in the format\n+\n+  {:.<30} {}\n+\n+\"\"\".format(\"package\", \"version on-line (version installed)\"))\n parser.add_argument('category', choices=['standard','optional','experimental', 'installed'], metavar=\"category\",\n                     help=\"The type of packages. Can be 'standard','optional','experimental' or 'installed'.\")\n parser.add_argument('--dump', dest='dump', default=False, action='store_true',\n@@ -76,6 +81,10 @@ if args['remote'] and args['category']!='installed':\n # OUTPUT #\n ##########\n \n+if not args['dump']:\n+    print(\"{:.<40} {}\".format(\"PACKAGE\", \"version on-line (version installed)\"))\n+    print(\"-\"*76)\n+\n # installed\n if args['category'] == 'installed':\n     if args['version']:\n```\n\nI ask because when I ran `sage --standard`, I wasn't sure what a line like\n\n```\nzeromq.................................. not found (4.0.5)\n```\n\nin the output meant.",
    "created_at": "2015-06-01T19:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246110",
    "user": "@jhpalmieri"
}
```

What do you think about either of these changes?

```diff
diff --git a/src/bin/sage-list-packages b/src/bin/sage-list-packages
index 5b17272..e1b0889 100755
--- a/src/bin/sage-list-packages
+++ b/src/bin/sage-list-packages
@@ -16,7 +16,12 @@ SAGE_ROOT = os.environ["SAGE_ROOT"]
 # Input parsing #
 #################
 
-parser = argparse.ArgumentParser(description="List Sage's packages")
+parser = argparse.ArgumentParser(formatter_class=argparse.RawDescriptionHelpFormatter,
+                                 description="""List Sage's packages, by default in the format
+
+  {:.<30} {}
+
+""".format("package", "version on-line (version installed)"))
 parser.add_argument('category', choices=['standard','optional','experimental', 'installed'], metavar="category",
                     help="The type of packages. Can be 'standard','optional','experimental' or 'installed'.")
 parser.add_argument('--dump', dest='dump', default=False, action='store_true',
@@ -76,6 +81,10 @@ if args['remote'] and args['category']!='installed':
 # OUTPUT #
 ##########
 
+if not args['dump']:
+    print("{:.<40} {}".format("PACKAGE", "version on-line (version installed)"))
+    print("-"*76)
+
 # installed
 if args['category'] == 'installed':
     if args['version']:
```

I ask because when I ran `sage --standard`, I wasn't sure what a line like

```
zeromq.................................. not found (4.0.5)
```

in the output meant.



---

archive/issue_comments_246111.json:
```json
{
    "body": "This change is more important.\n\n```diff\ndiff --git a/src/bin/sage-list-packages b/src/bin/sage-list-packages\nindex 5b17272..88cbaab 100755\n--- a/src/bin/sage-list-packages\n+++ b/src/bin/sage-list-packages\n@@ -46,12 +51,12 @@ installed = dict(pkgname_split(pkgname)\n                  for pkgname in os.listdir(SAGE_SPKG_INST))\n \n # new-style packages\n-local_non_filtered = os.listdir(SAGE_ROOT+\"/build/pkgs/\")\n+local_non_filtered = os.listdir(os.path.join(SAGE_ROOT, \"build\", \"pkgs\"))\n local = {}\n for p in local_non_filtered:\n-    with open(SAGE_ROOT+\"/build/pkgs/\"+p+\"/package-version.txt\") as f:\n+    with open(os.path.join(SAGE_ROOT, \"build\", \"pkgs\", p, \"package-version.txt\")) as f:\n         version = f.read().strip()\n-    with open(SAGE_ROOT+\"/build/pkgs/\"+p+\"/type\") as f:\n+    with open(os.path.join(SAGE_ROOT, \"build\", \"pkgs\", p, \"type\")) as f:\n         if f.read().strip() == args['category']:\n             local[p] = version\n \n```\n\nI can create a new branch with this change and either of the earlier ones if you want. Or you can do it.",
    "created_at": "2015-06-01T19:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246111",
    "user": "@jhpalmieri"
}
```

This change is more important.

```diff
diff --git a/src/bin/sage-list-packages b/src/bin/sage-list-packages
index 5b17272..88cbaab 100755
--- a/src/bin/sage-list-packages
+++ b/src/bin/sage-list-packages
@@ -46,12 +51,12 @@ installed = dict(pkgname_split(pkgname)
                  for pkgname in os.listdir(SAGE_SPKG_INST))
 
 # new-style packages
-local_non_filtered = os.listdir(SAGE_ROOT+"/build/pkgs/")
+local_non_filtered = os.listdir(os.path.join(SAGE_ROOT, "build", "pkgs"))
 local = {}
 for p in local_non_filtered:
-    with open(SAGE_ROOT+"/build/pkgs/"+p+"/package-version.txt") as f:
+    with open(os.path.join(SAGE_ROOT, "build", "pkgs", p, "package-version.txt")) as f:
         version = f.read().strip()
-    with open(SAGE_ROOT+"/build/pkgs/"+p+"/type") as f:
+    with open(os.path.join(SAGE_ROOT, "build", "pkgs", p, "type")) as f:
         if f.read().strip() == args['category']:
             local[p] = version
 
```

I can create a new branch with this change and either of the earlier ones if you want. Or you can do it.



---

archive/issue_comments_246112.json:
```json
{
    "body": "There are no doctests for `_package_lists_from_sage_output(..., version=True)`, nor does the `OUTPUT` block explain the output in that case.\n\nFor `version=True`, I would actually propose to change the output format to a list of triples `(package_name, installed_version, latest_version)`, where `installed_version` is `None` if the package is not installed and `latest_version` is the newest available version. If, for example, `arb-2.5.0` is installed but `arb-2.6.0` is availble, then one such triple would be\n\n```\n('arb', '2.5.0', '2.6.0')\n```\n\nIf `arb` is not installed:\n\n```\n('arb', None, '2.6.0')\n```\n\n\nSince this function would be quite different from `_package_lists_from_sage_output`, perhaps there should be two functions: `_package_lists_from_sage_output` and `_package_versions_from_sage_output` or something...",
    "created_at": "2015-06-02T07:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246112",
    "user": "@jdemeyer"
}
```

There are no doctests for `_package_lists_from_sage_output(..., version=True)`, nor does the `OUTPUT` block explain the output in that case.

For `version=True`, I would actually propose to change the output format to a list of triples `(package_name, installed_version, latest_version)`, where `installed_version` is `None` if the package is not installed and `latest_version` is the newest available version. If, for example, `arb-2.5.0` is installed but `arb-2.6.0` is availble, then one such triple would be

```
('arb', '2.5.0', '2.6.0')
```

If `arb` is not installed:

```
('arb', None, '2.6.0')
```


Since this function would be quite different from `_package_lists_from_sage_output`, perhaps there should be two functions: `_package_lists_from_sage_output` and `_package_versions_from_sage_output` or something...



---

archive/issue_comments_246113.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-02T07:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246113",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_246114.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-02T09:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246114",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246115.json:
```json
{
    "body": "> What do you think about either of these changes?\n> ...\n> I ask because when I ran `sage --standard`, I wasn't sure what a line like\n> {{{\n> zeromq.................................. not found (4.0.5)\n> }}}\n> in the output meant.\n\nI added a commit that displays column names when '--dump' is not used. The columns change a lot depending on which flags are used, and so this code is not exactly the one you proposed.\n\nNathann",
    "created_at": "2015-06-02T09:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246115",
    "user": "@nathanncohen"
}
```

> What do you think about either of these changes?
> ...
> I ask because when I ran `sage --standard`, I wasn't sure what a line like
> {{{
> zeromq.................................. not found (4.0.5)
> }}}
> in the output meant.

I added a commit that displays column names when '--dump' is not used. The columns change a lot depending on which flags are used, and so this code is not exactly the one you proposed.

Nathann



---

archive/issue_comments_246116.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-02T09:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246116",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246117.json:
```json
{
    "body": "> This change is more important.\n\nRight. Done.\n\nNathann",
    "created_at": "2015-06-02T09:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246117",
    "user": "@nathanncohen"
}
```

> This change is more important.

Right. Done.

Nathann



---

archive/issue_comments_246118.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-02T09:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246118",
    "user": "@nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_246119.json:
```json
{
    "body": "> There are no doctests for `_package_lists_from_sage_output(..., version=True)`, nor does the `OUTPUT` block explain the output in that case.\n\nFixed.\n\n> For `version=True`, I would actually propose to change the output format to a list of triples `(package_name, installed_version, latest_version)`, where `installed_version` is `None` if the package is not installed and `latest_version` is the newest available version.\n\nI do not mind, you can open a ticket if you need this feature.\n\n> Since this function would be quite different from `_package_lists_from_sage_output`, perhaps there should be two functions: `_package_lists_from_sage_output` and `_package_versions_from_sage_output` or something...\n\nTwo private functions that do almost the same job? Let's keep things simple, one is enough.\n\nNathann",
    "created_at": "2015-06-02T09:31:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246119",
    "user": "@nathanncohen"
}
```

> There are no doctests for `_package_lists_from_sage_output(..., version=True)`, nor does the `OUTPUT` block explain the output in that case.

Fixed.

> For `version=True`, I would actually propose to change the output format to a list of triples `(package_name, installed_version, latest_version)`, where `installed_version` is `None` if the package is not installed and `latest_version` is the newest available version.

I do not mind, you can open a ticket if you need this feature.

> Since this function would be quite different from `_package_lists_from_sage_output`, perhaps there should be two functions: `_package_lists_from_sage_output` and `_package_versions_from_sage_output` or something...

Two private functions that do almost the same job? Let's keep things simple, one is enough.

Nathann



---

archive/issue_comments_246120.json:
```json
{
    "body": "Replying to [comment:29 ncohen]:\n> I do not mind, you can open a ticket if you need this feature.\n\nDone: #18581",
    "created_at": "2015-06-02T09:36:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246120",
    "user": "@jdemeyer"
}
```

Replying to [comment:29 ncohen]:
> I do not mind, you can open a ticket if you need this feature.

Done: #18581



---

archive/issue_comments_246121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-02T10:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246121",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246122.json:
```json
{
    "body": "I get an error with the new doctest:\n\n```\nsage -t --long src/sage/misc/package.py\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 244, in sage.misc.package._package_lists_from_sage_output\nFailed example:\n    type(x[1]) == str and '4.55' <= x[1]\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 496, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 858, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package._package_lists_from_sage_output[8]>\", line 1, in <module>\n        type(x[Integer(1)]) == str and '4.55' <= x[Integer(1)]\n    TypeError: 'sage.symbolic.expression.Expression' object does not support indexing\n**********************************************************************\n```\n\nThe problem is that `x` does not get set by the expression `any(x[0] ...)`. You could maybe use this instead:\n\n```diff\ndiff --git a/src/sage/misc/package.py b/src/sage/misc/package.py\nindex 12b556d..91ab594 100644\n--- a/src/sage/misc/package.py\n+++ b/src/sage/misc/package.py\n@@ -239,9 +239,7 @@ def _package_lists_from_sage_output(package_type,version=False,local=False):\n         sage: installed, not_installed = _package_lists_from_sage_output('standard',local=True,version=True)\n         sage: bool(not_installed)\n         False\n-        sage: any(x[0] == 'glpk' for x in installed)\n-        True\n-        sage: type(x[1]) == str and '4.55' <= x[1]\n+        sage: any(x[0] == 'glpk' and type(x[1]) == str and '4.55' <= x[1] for x in installed)\n         True\n     \"\"\"\n     if package_type not in ['standard','optional','experimental']:\n```\n",
    "created_at": "2015-06-02T20:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246122",
    "user": "@jhpalmieri"
}
```

I get an error with the new doctest:

```
sage -t --long src/sage/misc/package.py
**********************************************************************
File "src/sage/misc/package.py", line 244, in sage.misc.package._package_lists_from_sage_output
Failed example:
    type(x[1]) == str and '4.55' <= x[1]
Exception raised:
    Traceback (most recent call last):
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/jpalmier/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package._package_lists_from_sage_output[8]>", line 1, in <module>
        type(x[Integer(1)]) == str and '4.55' <= x[Integer(1)]
    TypeError: 'sage.symbolic.expression.Expression' object does not support indexing
**********************************************************************
```

The problem is that `x` does not get set by the expression `any(x[0] ...)`. You could maybe use this instead:

```diff
diff --git a/src/sage/misc/package.py b/src/sage/misc/package.py
index 12b556d..91ab594 100644
--- a/src/sage/misc/package.py
+++ b/src/sage/misc/package.py
@@ -239,9 +239,7 @@ def _package_lists_from_sage_output(package_type,version=False,local=False):
         sage: installed, not_installed = _package_lists_from_sage_output('standard',local=True,version=True)
         sage: bool(not_installed)
         False
-        sage: any(x[0] == 'glpk' for x in installed)
-        True
-        sage: type(x[1]) == str and '4.55' <= x[1]
+        sage: any(x[0] == 'glpk' and type(x[1]) == str and '4.55' <= x[1] for x in installed)
         True
     """
     if package_type not in ['standard','optional','experimental']:
```




---

archive/issue_comments_246123.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-06-02T20:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246123",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_246124.json:
```json
{
    "body": "> I get an error with the new doctest:\n\nRightrightright, thanks! I updated the latest commit.\n\nNathann",
    "created_at": "2015-06-02T20:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246124",
    "user": "@nathanncohen"
}
```

> I get an error with the new doctest:

Rightrightright, thanks! I updated the latest commit.

Nathann



---

archive/issue_comments_246125.json:
```json
{
    "body": "This looks good to me. Anyone else have any issues, or can we set it to positive review?",
    "created_at": "2015-06-03T18:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246125",
    "user": "@jhpalmieri"
}
```

This looks good to me. Anyone else have any issues, or can we set it to positive review?



---

archive/issue_comments_246126.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-03T18:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246126",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_246127.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-03T23:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18219",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18219#issuecomment-246127",
    "user": "@vbraun"
}
```

Resolution: fixed
