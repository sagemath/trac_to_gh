# Issue 19534: Coefficient coercion for Steenrod algebra coproducts

Issue created by migration from Trac.

Original creator: darij

Original creation time: 2015-12-23 16:14:15

CC:  nthiery tscrim sage-combinat

Keywords: coercion, free modules, steenrod algebra, noncommutative symmetric functions

This ticket fixes two small issues noticed in #18264, without having to wait for #18264:

- The comultiplication in the Steenrod algebra would result in maltyped output (the output had coefficients in the integers rather than in the base ring).

- The doc of NSym had some doctests that relied on the free-module framework being cavalier about coefficient types.


---

Comment by darij created at 2015-12-23 16:14:41

New commits:


---

Comment by darij created at 2015-12-23 16:14:41

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2015-12-23 21:21:43

The Steenrod algebra change looks good, but I get doctest failures in `ncsf.py`.

```
sage -t --warn-long 53.1 src/sage/combinat/ncsf_qsym/ncsf.py
**********************************************************************
File "src/sage/combinat/ncsf_qsym/ncsf.py", line 4221, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung
Failed example:
    test_phi(4, 2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[18]>", line 1, in <module>
        test_phi(Integer(4), Integer(2))
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>", line 3, in test_phi
        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):
      File "sage/structure/parent.pyx", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)
        raise
      File "sage/structure/coerce_maps.pyx", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)
        return C._element_constructor(x)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py", line 1325, in _element_constructor_
        raise TypeError("do not know how to make x (= %s) an element of self (=%s)"%(x,self))
    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)
**********************************************************************
File "src/sage/combinat/ncsf_qsym/ncsf.py", line 4223, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung
Failed example:
    test_phi(6, 2)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[19]>", line 1, in <module>
        test_phi(Integer(6), Integer(2))
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>", line 3, in test_phi
        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):
      File "sage/structure/parent.pyx", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)
        raise
      File "sage/structure/coerce_maps.pyx", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)
        return C._element_constructor(x)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py", line 1325, in _element_constructor_
        raise TypeError("do not know how to make x (= %s) an element of self (=%s)"%(x,self))
    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)
**********************************************************************
File "src/sage/combinat/ncsf_qsym/ncsf.py", line 4225, in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung
Failed example:
    test_phi(6, 3)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[20]>", line 1, in <module>
        test_phi(Integer(6), Integer(3))
      File "<doctest sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung[17]>", line 3, in test_phi
        if S(Phi[I].verschiebung(n)) != S(Phi[I]).verschiebung(n):
      File "sage/structure/parent.pyx", line 1111, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9821)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 109, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4542)
        raise
      File "sage/structure/coerce_maps.pyx", line 104, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4435)
        return C._element_constructor(x)
      File "/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sage/combinat/free_module.py", line 1325, in _element_constructor_
        raise TypeError("do not know how to make x (= %s) an element of self (=%s)"%(x,self))
    TypeError: do not know how to make x (= 0) an element of self (=Non-Commutative Symmetric Functions over the Rational Field in the Complete basis)
**********************************************************************
1 item had failures:
   3 of  22 in sage.combinat.ncsf_qsym.ncsf.NonCommutativeSymmetricFunctions.Phi.Element.verschiebung
    [768 tests, 3 failures, 8.17 s]
----------------------------------------------------------------------
sage -t --warn-long 53.1 src/sage/combinat/ncsf_qsym/ncsf.py  # 3 doctests failed
----------------------------------------------------------------------
```



---

Comment by jhpalmieri created at 2015-12-23 21:21:54

Changing status from needs_review to needs_work.


---

Comment by darij created at 2015-12-24 09:38:49

Oops, this was me being stupid. Fixed, and thanks!


---

Comment by darij created at 2015-12-24 09:38:49

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-12-24 09:38:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-12-24 19:19:27

Looks good.


---

Comment by jhpalmieri created at 2015-12-24 19:19:27

Changing status from needs_review to positive_review.


---

Comment by darij created at 2015-12-24 19:20:05

Thank you! (And have some nice holidays.)


---

Comment by vbraun created at 2015-12-25 16:16:39

Resolution: fixed
