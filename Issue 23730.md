# Issue 23730: Coercion pushout for FGP_modules

Issue created by migration from Trac.

Original creator: sbrandhorst

Original creation time: 2017-10-05 08:37:33

The following should be possible:

```
sage: A = ZZ^2sage: S1 = B.submodule(B.gens()[:1])
sage: S1 = B.submodule(B.gens()[:1])
sage: S2 = B.submodule(B.gens()[1:])
sage: s1 = S1.gens()[0]; s2 = S2.gens()[0]
sage: s1+s2
Traceback (most recent call last)
...
TypeError: unsupported operand parent(s) for +: 'Finitely generated module V/W over Integer Ring with invariants (2)' and 'Finitely generated module V/W over Integer Ring with invariants (2)'
```


Let V1,V2,W1,W2 be modules in the same ambient space with V1 containing W1 and V2 containing W2

Let a in V1/W1 and b in V2/W2. Their sum a + b
is well defined as an element of
(V1+V2)/(W1+W2)


---

Comment by git created at 2017-10-10 07:03:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-10-10 07:51:01

Changing status from new to needs_review.


---

Comment by dkrenn created at 2017-10-10 13:38:26

I think using `_pushout_` here is kind of a hack. The correct way to implement it (so that it also works in more general situations) is to derive a class from `ConstructionFunctor`, implement the functionality of `merge` (similar to what is done now in `_pushout_` and return this construction functor when calling `.construction()`.


---

Comment by dkrenn created at 2017-10-10 13:38:26

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2017-10-10 15:22:18

I would not call it a hack, but it is not the typical way done in Sage as it gives less information (nor is it as flexible I believe). So I'm +1 on using `ConstructionFunctor`.


---

Comment by sbrandhorst created at 2017-10-11 01:08:51

O.K. but then you have to review it ;).


---

Comment by tscrim created at 2017-10-11 01:19:28

I don't mind reviewing it. I just did so twice on two other (combinatorial-based) algebras.


---

Comment by git created at 2017-10-11 01:23:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-10-11 01:24:48

Have fun and thank you. I am going to bed now. Some doctests are missing etc. and I do not know what rank = ?
----
New commits:


---

Comment by git created at 2017-10-11 07:54:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-11 08:10:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-10-11 08:11:06

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-10-12 01:22:05

I did a fairly significant rewrite to make the implementation closer to `QuotientFunctor`. Specifically, the quotients are determined by the relations module `W`, so that is all that should be used to define the functor. I also moved the functor out of the (IMO) overcrowded `categories/pushout.py` for better code localization.

If my changes are good, then positive review after you set your name in both the authors and reviewers section.
----
New commits:


---

Comment by dkrenn created at 2017-10-12 06:41:19

LGTM, except that I personally prefer to replace `self` by something more descriptive, e.g. in

```
The construction functor and ambient module for ``self``.
```

replace `self` by `finitely generated module over a PID`.

There are two successful patchbot results at the top at the moment, however previously some (more than one patchbot) failed in `src/sage/interfaces/qepcad.py`. Any ideas why?


---

Comment by sbrandhorst created at 2017-10-12 06:50:33

I have tried to make it behave like a subspace functor.
In future module constructions can be more complicated like
`VectorFunctor`, direct, sum, base extension, some quotient, and a tensor product.
So the functor might have to deal with all kinds of other functors.

Why do you fix the `base_ring`? The vector functor and subspace functor do not. 
And also the quotient functor does not fix a ring.

With your method, construction of `QQ / ZZ` is fine. 
base extensions when more general pids than `ZZ` are finally allowed do not work well with the functor. We could extract the basering as basering of the input. Or/and make it an optional argument of the call?


---

Comment by sbrandhorst created at 2017-10-12 07:02:28

-1 for moving it into fgp modules. 
The functor should not assume that the input is a pid. Quotients of modules make perfect sense over general rings not just PIDS the functor should not care about the implementation. 
But you are right that pushout is somewhat overcrowded. One could create a file in the module folder and put all module functors there?


---

Comment by tscrim created at 2017-10-12 07:03:40

Replying to [comment:14 dkrenn]:
> LGTM, except that I personally prefer to replace `self` by something more descriptive, e.g. in
> {{{
> The construction functor and ambient module for ``self``.
> }}}
> replace `self` by `finitely generated module over a PID`.

I am very strongly in support of `self` in docstrings as the rest is too verbose and does not behave well with subclasses.

> There are two successful patchbot results at the top at the moment, however previously some (more than one patchbot) failed in `src/sage/interfaces/qepcad.py`. Any ideas why?

This is unrelated.


---

Comment by dkrenn created at 2017-10-12 07:13:06

Replying to [comment:17 tscrim]:
> Replying to [comment:14 dkrenn]:
> > LGTM, except that I personally prefer to replace `self` by something more descriptive, e.g. in
> > {{{
> > The construction functor and ambient module for ``self``.
> > }}}
> > replace `self` by `finitely generated module over a PID`.
> 
> I am very strongly in support of `self` in docstrings as the rest is too verbose and does not behave well with subclasses.

Ok.


---

Comment by tscrim created at 2017-10-12 07:14:22

Replying to [comment:15 sbrandhorst]:
> I have tried to make it behave like a subspace functor.
> In future module constructions can be more complicated like
> `VectorFunctor`, direct, sum, base extension, some quotient, and a tensor product.
> So the functor might have to deal with all kinds of other functors.

That has no bearing on this functor's implementation.

> Why do you fix the `base_ring`? The vector functor and subspace functor do not. 
> And also the quotient functor does not fix a ring.

`QuotientFunctor` is `Rings` to `Rings`, so there is no base rings involved with the categories. In this case, we are doing a quotient by a module that has a specific base ring `R`. So it makes sense to be a functor from `R`-mod to `R`-mod. For `VectorFunctor`, there is not a specific way to specify the base ring. However, if you feel strongly that we should have larger categories for the domain and codomain, then we can change it.

> With your method, construction of `QQ / ZZ` is fine. 
> base extensions when more general pids than `ZZ` are finally allowed do not work well with the functor. We could extract the basering as basering of the input. Or/and make it an optional argument of the call?

I'm not sure I understand what you're proposing. I do not agree that extension of scalars is a part of this functor. I feel that should be an entirely different functor.


---

Comment by tscrim created at 2017-10-12 07:19:16

Replying to [comment:16 sbrandhorst]:
> -1 for moving it into fgp modules. 
> The functor should not assume that the input is a pid. Quotients of modules make perfect sense over general rings not just PIDS the functor should not care about the implementation.

I agree that it could be used more generally. However, where else is it (planned to be) used? It is easy to move it later if the functor is to be used elsewhere, but good code locality (both within files and folders) makes it easier to maintain.

> But you are right that pushout is somewhat overcrowded. One could create a file in the module folder and put all module functors there?

I would not oppose this.


---

Comment by tscrim created at 2017-10-12 07:22:12

Replying to [comment:18 dkrenn]:
> Replying to [comment:17 tscrim]:
> > Replying to [comment:14 dkrenn]:
> > > LGTM, except that I personally prefer to replace `self` by something more descriptive, e.g. in
> > > {{{
> > > The construction functor and ambient module for ``self``.
> > > }}}
> > > replace `self` by `finitely generated module over a PID`.
> > 
> > I am very strongly in support of `self` in docstrings as the rest is too verbose and does not behave well with subclasses.
> 
> Ok.

However, there has been a discussion(s?) on sage-devel about this and I am in the minority. So if you want to change them, you can and I will not object. However, on my doc changes on files where there is a mix (and nobody has objected), I will be doing the above.


---

Comment by dkrenn created at 2017-10-12 07:28:06

Replying to [comment:21 tscrim]:
> Replying to [comment:18 dkrenn]:
> > > I am very strongly in support of `self` in docstrings as the rest is too verbose and does not behave well with subclasses.
> > 
> > Ok.
> 
> However, there has been a discussion(s?) on sage-devel about this and I am in the minority. So if you want to change them, you can and I will not object. However, on my doc changes on files where there is a mix (and nobody has objected), I will be doing the above.

Let's keep it (as both versions are ok; thus the author should have preference).


---

Comment by git created at 2017-10-12 07:58:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-12 08:10:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by sbrandhorst created at 2017-10-12 08:11:26

O.K. tests pass now. If you are happy with the changes, you can set it to positive review after the patchbot is O.K. as well.


---

Comment by git created at 2017-10-12 15:28:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-10-12 15:31:00

I made a few essentially trivial changes. I added one extra test of `merge`, and everything (still) passes:

```
sage -t src/sage/modules/module_functors.py
    [57 tests, 0.44 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```

So please set to a positive review if this also passes for you.


---

Comment by sbrandhorst created at 2017-10-12 15:55:55

Changing status from needs_review to positive_review.


---

Comment by sbrandhorst created at 2017-10-12 15:55:55


```
sage -t --long --warn-long 48.3 src/sage/modules/module_functors.py
    [57 tests, 0.72 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------


sage -t --long --warn-long 48.3 src/sage/modules/fg_pid/fgp_module.py
    [349 tests, 3.43 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
```

Positive review.


---

Comment by vbraun created at 2017-10-18 21:07:31

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-10-18 21:07:31

merge conflict


---

Comment by sbrandhorst created at 2017-10-19 07:26:07

merge conflict with what. How do I find it?


---

Comment by git created at 2017-10-19 07:27:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-10-19 14:08:59

I believe it is with the next upcoming beta version.


---

Comment by sbrandhorst created at 2017-10-19 14:25:39

Yep. It would be nice to know the ticket :)


---

Comment by git created at 2017-10-26 00:48:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-10-26 00:48:34

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2017-10-26 00:48:34

I didn't get a merge conflict with `8.1.beta9`, but I pushed the branch just to be sure.


---

Comment by vbraun created at 2017-10-29 10:31:53

Resolution: fixed
