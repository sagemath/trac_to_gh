# Issue 14658: Compositions accept any input

archive/issues_014658.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  chrisjamesberg andrew.mathas vivianepons tscrim aschilling\n\nKeywords: composition, FindStat\n\n\n```\nsage: sage: Composition([1,0,-1])\n[1, 0, -1]\nsage: sage: Composition('ASDF')\n['A', 'S', 'D', 'F']\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14862\n\n",
    "created_at": "2013-07-06T15:37:28Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "title": "Compositions accept any input",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14658",
    "user": "stumpc5"
}
```
Assignee: sage-combinat

CC:  chrisjamesberg andrew.mathas vivianepons tscrim aschilling

Keywords: composition, FindStat


```
sage: sage: Composition([1,0,-1])
[1, 0, -1]
sage: sage: Composition('ASDF')
['A', 'S', 'D', 'F']
```


Issue created by migration from https://trac.sagemath.org/ticket/14862





---

archive/issue_comments_186607.json:
```json
{
    "body": "This is no longer the case in 5.12.beta5.\n\nCan we close this as invalid ?",
    "created_at": "2013-09-20T11:52:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186607",
    "user": "chapoton"
}
```

This is no longer the case in 5.12.beta5.

Can we close this as invalid ?



---

archive/issue_comments_186608.json:
```json
{
    "body": "Replying to [comment:1 chapoton]:\n> Can we close this as invalid ?\n\nI don't have any recent version of Sage installed -- do compositions now only accept valid input? In that case, this ticket is obsolete.\n\nThanks, Christian",
    "created_at": "2013-09-20T12:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186608",
    "user": "stumpc5"
}
```

Replying to [comment:1 chapoton]:
> Can we close this as invalid ?

I don't have any recent version of Sage installed -- do compositions now only accept valid input? In that case, this ticket is obsolete.

Thanks, Christian



---

archive/issue_comments_186609.json:
```json
{
    "body": "I was wrong, too bad.\n\nThe problem is still there in 5.12.beta5. It was only the ascii-art that was not able to draw these bad \"compositions\" !\n\nSo the ticket is open !",
    "created_at": "2013-09-20T12:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186609",
    "user": "chapoton"
}
```

I was wrong, too bad.

The problem is still there in 5.12.beta5. It was only the ascii-art that was not able to draw these bad "compositions" !

So the ticket is open !



---

archive/issue_comments_186610.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-10-19T17:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186610",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_186611.json:
```json
{
    "body": "Here is a patch, needs review.",
    "created_at": "2013-10-19T17:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186611",
    "user": "chapoton"
}
```

Here is a patch, needs review.



---

archive/issue_comments_186612.json:
```json
{
    "body": "The thing that mainly surprises me is that\n\n```\nsage: a=Hom(ZZ,ZZ)(1)\nsage: b=Hom(ZZ,ZZ)(1)\nsage: Composition(a,b)\n```\n\nfails. Composition is such an overused term in mathematics that I think it's ill-advised to expose some specialist combinatorial notion of the term in the global scope.",
    "created_at": "2013-10-19T17:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186612",
    "user": "nbruin"
}
```

The thing that mainly surprises me is that

```
sage: a=Hom(ZZ,ZZ)(1)
sage: b=Hom(ZZ,ZZ)(1)
sage: Composition(a,b)
```

fails. Composition is such an overused term in mathematics that I think it's ill-advised to expose some specialist combinatorial notion of the term in the global scope.



---

archive/issue_comments_186613.json:
```json
{
    "body": "Replying to [comment:5 nbruin]:\n> Composition is such an overused term in mathematics that I think it's ill-advised to expose some specialist combinatorial notion of the term in the global scope.\n\nYou are certainly right in criticizing the current use of this term. Since not many people read this ticket, and its aim is only to fix a little bug in this method: could you cross-post your comment to Sage-Combinat?",
    "created_at": "2013-10-19T21:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186613",
    "user": "stumpc5"
}
```

Replying to [comment:5 nbruin]:
> Composition is such an overused term in mathematics that I think it's ill-advised to expose some specialist combinatorial notion of the term in the global scope.

You are certainly right in criticizing the current use of this term. Since not many people read this ticket, and its aim is only to fix a little bug in this method: could you cross-post your comment to Sage-Combinat?



---

archive/issue_comments_186614.json:
```json
{
    "body": "Replying to [comment:6 stumpc5]:\n> You are certainly right in criticizing the current use of this term. Since not many people read this ticket, and its aim is only to fix a little bug in this method: could you cross-post your comment to Sage-Combinat?\nI'm not a member of that list, so I don't think I can crosspost there.",
    "created_at": "2013-10-20T17:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186614",
    "user": "nbruin"
}
```

Replying to [comment:6 stumpc5]:
> You are certainly right in criticizing the current use of this term. Since not many people read this ticket, and its aim is only to fix a little bug in this method: could you cross-post your comment to Sage-Combinat?
I'm not a member of that list, so I don't think I can crosspost there.



---

archive/issue_comments_186615.json:
```json
{
    "body": "Can't we use `Compose` for the composition of maps? Unfortunately I don't know how to rename the combinatorial notion of compositions (`IntegerComposition` feels like the entries don't have to be positive), and just hiding it would create a lot of confusion.",
    "created_at": "2013-10-20T17:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186615",
    "user": "darij"
}
```

Can't we use `Compose` for the composition of maps? Unfortunately I don't know how to rename the combinatorial notion of compositions (`IntegerComposition` feels like the entries don't have to be positive), and just hiding it would create a lot of confusion.



---

archive/issue_comments_186616.json:
```json
{
    "body": "Replying to [comment:8 darij]:\n> Can't we use `Compose` for the composition of maps? Unfortunately I don't know how to rename the combinatorial notion of compositions (`IntegerComposition` feels like the entries don't have to be positive), and just hiding it would create a lot of confusion.\n\nWe use `Partition` for `IntegerPartition`, though it could as well refer to `SetPartition` or whatever else. For me `IntegerPartition` is a partition of a positive integer. I would be totally fine with using `IntegerPartition` and `IntegerComposition`.",
    "created_at": "2013-10-20T17:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186616",
    "user": "stumpc5"
}
```

Replying to [comment:8 darij]:
> Can't we use `Compose` for the composition of maps? Unfortunately I don't know how to rename the combinatorial notion of compositions (`IntegerComposition` feels like the entries don't have to be positive), and just hiding it would create a lot of confusion.

We use `Partition` for `IntegerPartition`, though it could as well refer to `SetPartition` or whatever else. For me `IntegerPartition` is a partition of a positive integer. I would be totally fine with using `IntegerPartition` and `IntegerComposition`.



---

archive/issue_comments_186617.json:
```json
{
    "body": "Replying to [comment:9 stumpc5]:\n> We use `Partition` for `IntegerPartition`, though it could as well refer to `SetPartition` or whatever else. For me `IntegerPartition` is a partition of a positive integer. I would be totally fine with using `IntegerPartition` and `IntegerComposition`.\n\nI am against changing the name of the `Partition` class to `IntegerPartition`. This would create a major patch bomb as `Partition` is used in many places -- a quick and dirty count with grep gives me 114 different python files. \n\nMore importantly, even though the name `IntegerPartition` is not bad, I do not think it is what most people would guess when looking for partitions so this change would, in effect, make `sage ` harder to use. Of the files using `Partition`, 29 of them are outside of the `combinat` directory so presumably the usage of this class is wider than just algebraic combinatorics). \n\nAs far as I am aware there is no name conflict with the name `Partition` (btw, there already is a separate `SetPartition` class). The only justification for changing this name given so far is in order to maintain name consistency with a potential name change for `Composition`. I do not think that this is a good argument.\n\nWith regard to `Composition`, I do not have any strong feelings. I do not see anything wrong with having both `IntegerComposition` and `Partition` in the name-space. On the other hand, since no one has noticed a problem with `Composition` before I don't really understand why there is suddenly a problem now, especially as a much superior notation is already available for the composition of two maps:\n\n```\nsage: a=Hom(ZZ,ZZ)(1)\nsage: b=Hom(ZZ,ZZ)(1)\nsage: a*b\nRing endomorphism of Integer Ring\n  Defn: 1 |--> 1\n```\n\nAs there already is a really good way to compose maps in sage I don't find the argument for changing the meaning of `Composition` very compelling.",
    "created_at": "2013-10-20T19:14:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186617",
    "user": "andrew.mathas"
}
```

Replying to [comment:9 stumpc5]:
> We use `Partition` for `IntegerPartition`, though it could as well refer to `SetPartition` or whatever else. For me `IntegerPartition` is a partition of a positive integer. I would be totally fine with using `IntegerPartition` and `IntegerComposition`.

I am against changing the name of the `Partition` class to `IntegerPartition`. This would create a major patch bomb as `Partition` is used in many places -- a quick and dirty count with grep gives me 114 different python files. 

More importantly, even though the name `IntegerPartition` is not bad, I do not think it is what most people would guess when looking for partitions so this change would, in effect, make `sage ` harder to use. Of the files using `Partition`, 29 of them are outside of the `combinat` directory so presumably the usage of this class is wider than just algebraic combinatorics). 

As far as I am aware there is no name conflict with the name `Partition` (btw, there already is a separate `SetPartition` class). The only justification for changing this name given so far is in order to maintain name consistency with a potential name change for `Composition`. I do not think that this is a good argument.

With regard to `Composition`, I do not have any strong feelings. I do not see anything wrong with having both `IntegerComposition` and `Partition` in the name-space. On the other hand, since no one has noticed a problem with `Composition` before I don't really understand why there is suddenly a problem now, especially as a much superior notation is already available for the composition of two maps:

```
sage: a=Hom(ZZ,ZZ)(1)
sage: b=Hom(ZZ,ZZ)(1)
sage: a*b
Ring endomorphism of Integer Ring
  Defn: 1 |--> 1
```

As there already is a really good way to compose maps in sage I don't find the argument for changing the meaning of `Composition` very compelling.



---

archive/issue_comments_186618.json:
```json
{
    "body": "Why do we need a class for compositions of maps, by the way? Isn't that the same as just... maps?",
    "created_at": "2013-10-20T19:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186618",
    "user": "darij"
}
```

Why do we need a class for compositions of maps, by the way? Isn't that the same as just... maps?



---

archive/issue_comments_186619.json:
```json
{
    "body": "Replying to [comment:11 darij]:\n> Why do we need a class for compositions of maps, by the way? Isn't that the same as just... maps?\n\nWe don't, and the composition of maps can be obtained using `phi*psi` (which will have its own clashes if you want pointwise products for maps into a multiplicative group). However, the fact that the slot in the global namespace is in principle available doesn't imply it should be used for a special notion.\n\nThe title of the ticket already shows the confusion that can arise: The ticket complains that `Composition` is too lax with its argument checking and at the same time it seems `Composition` doesn't accept inputs that are perfectly valid for a mathematically widely accepted meaning of the word. \n\nNote that the full name is fine:\n\n```\nsage.combinat.composition.Composition\n```\n\n[Note that it is a function, not a class, by the way]. I just think it's inappropriate to import it into the global namespace under such a generic name. If you make that\n\n```\nfrom sage.combinat.composition import Composition as IntegerComposition\n```\n\nyou should be fine and a lot less ambiguous already. With a system that is the scope of sage we really have to be careful with the global namespace. It is a very scarce resource.\n\nI like `IntegerComposition`, by the way, and I don't think `Partition` is that problematic. If that becomes problematic, we can probably write a generic Partition routine to be imported in the global namespace that dispatches to the appropriate routine (IntegerPartition or SetPartition or whatever) based on type of the input parameters.",
    "created_at": "2013-10-20T19:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186619",
    "user": "nbruin"
}
```

Replying to [comment:11 darij]:
> Why do we need a class for compositions of maps, by the way? Isn't that the same as just... maps?

We don't, and the composition of maps can be obtained using `phi*psi` (which will have its own clashes if you want pointwise products for maps into a multiplicative group). However, the fact that the slot in the global namespace is in principle available doesn't imply it should be used for a special notion.

The title of the ticket already shows the confusion that can arise: The ticket complains that `Composition` is too lax with its argument checking and at the same time it seems `Composition` doesn't accept inputs that are perfectly valid for a mathematically widely accepted meaning of the word. 

Note that the full name is fine:

```
sage.combinat.composition.Composition
```

[Note that it is a function, not a class, by the way]. I just think it's inappropriate to import it into the global namespace under such a generic name. If you make that

```
from sage.combinat.composition import Composition as IntegerComposition
```

you should be fine and a lot less ambiguous already. With a system that is the scope of sage we really have to be careful with the global namespace. It is a very scarce resource.

I like `IntegerComposition`, by the way, and I don't think `Partition` is that problematic. If that becomes problematic, we can probably write a generic Partition routine to be imported in the global namespace that dispatches to the appropriate routine (IntegerPartition or SetPartition or whatever) based on type of the input parameters.



---

archive/issue_comments_186620.json:
```json
{
    "body": "It is a class:\n\n```\nclass Composition(CombinatorialObject, Element):\n```\n\n\nShouldn't a function \"composition\" be written in lowercase?",
    "created_at": "2013-10-20T19:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186620",
    "user": "darij"
}
```

It is a class:

```
class Composition(CombinatorialObject, Element):
```


Shouldn't a function "composition" be written in lowercase?



---

archive/issue_comments_186621.json:
```json
{
    "body": "Replying to [comment:10 andrew.mathas]:\n> I am against changing the name of the `Partition` class to `IntegerPartition`. This would create a major patch bomb as `Partition` is used in many places -- a quick and dirty count with grep gives me 114 different python files. \n\nSuch a change wouldn't have to be that invasive. The function `sage.combinat.partition.Partition` could retain its name and all library code would be importing that anyway, so no changes are necessary outside the obviously affected files and the odd doctest. One would just do\n\n```\nfrom sage.combinat.partition import Partition as IntegerPartition\n```\n\nto get the right routine in the global namespace. And perhaps provide a routine `Partition` to dispatch over different `Partition` types. (I don't think !Partition is particularly problematic, though).",
    "created_at": "2013-10-20T20:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186621",
    "user": "nbruin"
}
```

Replying to [comment:10 andrew.mathas]:
> I am against changing the name of the `Partition` class to `IntegerPartition`. This would create a major patch bomb as `Partition` is used in many places -- a quick and dirty count with grep gives me 114 different python files. 

Such a change wouldn't have to be that invasive. The function `sage.combinat.partition.Partition` could retain its name and all library code would be importing that anyway, so no changes are necessary outside the obviously affected files and the odd doctest. One would just do

```
from sage.combinat.partition import Partition as IntegerPartition
```

to get the right routine in the global namespace. And perhaps provide a routine `Partition` to dispatch over different `Partition` types. (I don't think !Partition is particularly problematic, though).



---

archive/issue_comments_186622.json:
```json
{
    "body": "It would slow things down, though... unless we change all calls to `Partition` via patchbombing.",
    "created_at": "2013-10-20T20:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186622",
    "user": "darij"
}
```

It would slow things down, though... unless we change all calls to `Partition` via patchbombing.



---

archive/issue_comments_186623.json:
```json
{
    "body": "Replying to [comment:13 darij]:\n> It is a class:\n> {{{\n> class Composition(CombinatorialObject, Element):\n> }}}\nAh you're right. It wasn't in Sage 5.7. \n> Shouldn't a function \"composition\" be written in lowercase?\nThat depends. If it's a \"factory function\" it's really meant to be a class constructor, but some implementation details prevented it from being written that way. So then the capitalization could still make sense. With that in mind it's more a judgement call whether to capitalize something.\n\n> It would slow things down, though... unless we change all calls to `Partition` via patchbombing. \nDo you have timings to back that up? It shouldn't (depending on what \"It\" is).\n\nIf you mean using a `from ... import ... as ...` construction: that should lead to exactly the same performance. It just means the link in the relevant namespace dict is stored under a different key than would be chosen by default. There is no extra link step to follow.\n\nIf you mean the extra redirection in a global namespace generic dispatch routine: yes, that would have a bit of overhead. But that's always the case: it's much better to use specific routines, that are likely not available directly from the global namespace.",
    "created_at": "2013-10-20T20:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186623",
    "user": "nbruin"
}
```

Replying to [comment:13 darij]:
> It is a class:
> {{{
> class Composition(CombinatorialObject, Element):
> }}}
Ah you're right. It wasn't in Sage 5.7. 
> Shouldn't a function "composition" be written in lowercase?
That depends. If it's a "factory function" it's really meant to be a class constructor, but some implementation details prevented it from being written that way. So then the capitalization could still make sense. With that in mind it's more a judgement call whether to capitalize something.

> It would slow things down, though... unless we change all calls to `Partition` via patchbombing. 
Do you have timings to back that up? It shouldn't (depending on what "It" is).

If you mean using a `from ... import ... as ...` construction: that should lead to exactly the same performance. It just means the link in the relevant namespace dict is stored under a different key than would be chosen by default. There is no extra link step to follow.

If you mean the extra redirection in a global namespace generic dispatch routine: yes, that would have a bit of overhead. But that's always the case: it's much better to use specific routines, that are likely not available directly from the global namespace.



---

archive/issue_comments_186624.json:
```json
{
    "body": "\"If you mean the extra redirection in a global namespace generic dispatch routine: yes, that would have a bit of overhead. But that's always the case: it's much better to use specific routines, that are likely not available directly from the global namespace.\"\n\nOops, when I said that \"it\" would slow things down, I meant the generic dispatch routine (as factory or function or whatever). And I know that this can be fixed by calling specific routines; I'm just saying it'll probably require a patchbomb this way or another, because at the moment I think most code that builds compositions calls `Composition`.",
    "created_at": "2013-10-21T03:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186624",
    "user": "darij"
}
```

"If you mean the extra redirection in a global namespace generic dispatch routine: yes, that would have a bit of overhead. But that's always the case: it's much better to use specific routines, that are likely not available directly from the global namespace."

Oops, when I said that "it" would slow things down, I meant the generic dispatch routine (as factory or function or whatever). And I know that this can be fixed by calling specific routines; I'm just saying it'll probably require a patchbomb this way or another, because at the moment I think most code that builds compositions calls `Composition`.



---

archive/issue_comments_186625.json:
```json
{
    "body": "Replying to [comment:17 darij]:\n\n> Oops, when I said that \"it\" would slow things down, I meant the generic dispatch routine (as factory or function or whatever). And I know that this can be fixed by calling specific routines; I'm just saying it'll probably require a patchbomb this way or another, because at the moment I think most code that builds compositions calls `Composition`.\n\nThey won't be importing it from the global scope (they wouldn't even have a convenient way of accessing it). The files that use `Composition` would have a line `from sage.combinat.composition import Composition` and that wouldn't be affected in any way. No need to patch that.",
    "created_at": "2013-10-21T04:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186625",
    "user": "nbruin"
}
```

Replying to [comment:17 darij]:

> Oops, when I said that "it" would slow things down, I meant the generic dispatch routine (as factory or function or whatever). And I know that this can be fixed by calling specific routines; I'm just saying it'll probably require a patchbomb this way or another, because at the moment I think most code that builds compositions calls `Composition`.

They won't be importing it from the global scope (they wouldn't even have a convenient way of accessing it). The files that use `Composition` would have a line `from sage.combinat.composition import Composition` and that wouldn't be affected in any way. No need to patch that.



---

archive/issue_comments_186626.json:
```json
{
    "body": "I wouldn't have expected this at first blush, but after reading `Composition.__classcall_private__` it's pretty obvious why\nin terms of performance, `Composition` should not be called directly:\n\n```\nsage: timeit(\"Composition([1,2,3,4])\",number=100000)\n100000 loops, best of 3: 8.01 \u00b5s per loop\nsage: timeit(\"Compositions()([1,2,3,4])\",number=100000)\n100000 loops, best of 3: 6.8 \u00b5s per loop\nsage: C=Compositions()\nsage: timeit(\"C([1,2,3,4])\",number=100000)\n100000 loops, best of 3: 4.64 \u00b5s per loop\n```\n\nso perhaps the best solution is indeed to deprecate `Composition` as an entry in the global namespace?\n\nNote that the reported behaviour in the ticket still needs fixing. The currently attached patch doesn't solve the problem below. I expect that the fix has to go into the `__init__` rather than into the `classcall_private`.\n\n```\nsage: Compositions()('ASDF')\n['A', 'S', 'D', 'F']\nsage: Compositions()('ASDF').parent()\nCompositions of non-negative integers\n```\n",
    "created_at": "2013-10-22T00:54:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186626",
    "user": "nbruin"
}
```

I wouldn't have expected this at first blush, but after reading `Composition.__classcall_private__` it's pretty obvious why
in terms of performance, `Composition` should not be called directly:

```
sage: timeit("Composition([1,2,3,4])",number=100000)
100000 loops, best of 3: 8.01 µs per loop
sage: timeit("Compositions()([1,2,3,4])",number=100000)
100000 loops, best of 3: 6.8 µs per loop
sage: C=Compositions()
sage: timeit("C([1,2,3,4])",number=100000)
100000 loops, best of 3: 4.64 µs per loop
```

so perhaps the best solution is indeed to deprecate `Composition` as an entry in the global namespace?

Note that the reported behaviour in the ticket still needs fixing. The currently attached patch doesn't solve the problem below. I expect that the fix has to go into the `__init__` rather than into the `classcall_private`.

```
sage: Compositions()('ASDF')
['A', 'S', 'D', 'F']
sage: Compositions()('ASDF').parent()
Compositions of non-negative integers
```




---

archive/issue_comments_186627.json:
```json
{
    "body": "Replying to [comment:19 nbruin]:\n> {{{\n> sage: timeit(\"Composition([1,2,3,4])\",number=100000)\n> 100000 loops, best of 3: 8.01 \u00b5s per loop\n> sage: timeit(\"Compositions()([1,2,3,4])\",number=100000)\n> 100000 loops, best of 3: 6.8 \u00b5s per loop\n> sage: C=Compositions()\n> sage: timeit(\"C([1,2,3,4])\",number=100000)\n> 100000 loops, best of 3: 4.64 \u00b5s per loop\n> }}}\n\nConvincing. Thank you!!",
    "created_at": "2013-10-22T03:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186627",
    "user": "darij"
}
```

Replying to [comment:19 nbruin]:
> {{{
> sage: timeit("Composition([1,2,3,4])",number=100000)
> 100000 loops, best of 3: 8.01 µs per loop
> sage: timeit("Compositions()([1,2,3,4])",number=100000)
> 100000 loops, best of 3: 6.8 µs per loop
> sage: C=Compositions()
> sage: timeit("C([1,2,3,4])",number=100000)
> 100000 loops, best of 3: 4.64 µs per loop
> }}}

Convincing. Thank you!!



---

archive/issue_comments_186628.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-22T08:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186628",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_186629.json:
```json
{
    "body": "OMG ! So many failing doctests ! It seems that we should allow 0 in the compositions..",
    "created_at": "2013-10-22T08:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186629",
    "user": "chapoton"
}
```

OMG ! So many failing doctests ! It seems that we should allow 0 in the compositions..



---

archive/issue_comments_186630.json:
```json
{
    "body": "Attachment [trac_14862.patch](tarball://root/attachments/some-uuid/ticket14862/trac_14862.patch) by chapoton created at 2013-11-04 20:58:41\n\nnew version of the patch, allowing nonnegative (>=0) integers as inputs",
    "created_at": "2013-11-04T20:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186630",
    "user": "chapoton"
}
```

Attachment [trac_14862.patch](tarball://root/attachments/some-uuid/ticket14862/trac_14862.patch) by chapoton created at 2013-11-04 20:58:41

new version of the patch, allowing nonnegative (>=0) integers as inputs



---

archive/issue_comments_186631.json:
```json
{
    "body": "Hmm; what exactly fails if you disallow 0? It looks like just requiring >= 0 kicks the can down the road, and that with a speed penalty that is noticeable when the composition is large and might become problematic in NSym/QSym-related code:\n\n\n```\n%timeit Composition([3,2,1])\n%timeit a = Composition([2,1,6,2,2,6,1,3,2,2,3,5,2])\n%timeit Composition([])\n\nbefore\n\nsage: %timeit Composition([3,2,1])\n100000 loops, best of 3: 13.9 us per loop\nsage: %timeit a = Composition([2,1,6,2,2,6,1,3,2,2,3,5,2])\n100000 loops, best of 3: 15.8 us per loop\nsage: %timeit Composition([])\n100000 loops, best of 3: 12.1 us per loop\n\nafter\n\nsage: %timeit Composition([3,2,1])\n100000 loops, best of 3: 16 us per loop\nsage: %timeit a = Composition([2,1,6,2,2,6,1,3,2,2,3,5,2])\n10000 loops, best of 3: 21.4 us per loop\nsage: %timeit Composition([])\n100000 loops, best of 3: 12.8 us per loop\n```\n",
    "created_at": "2013-11-04T23:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186631",
    "user": "darij"
}
```

Hmm; what exactly fails if you disallow 0? It looks like just requiring >= 0 kicks the can down the road, and that with a speed penalty that is noticeable when the composition is large and might become problematic in NSym/QSym-related code:


```
%timeit Composition([3,2,1])
%timeit a = Composition([2,1,6,2,2,6,1,3,2,2,3,5,2])
%timeit Composition([])

before

sage: %timeit Composition([3,2,1])
100000 loops, best of 3: 13.9 us per loop
sage: %timeit a = Composition([2,1,6,2,2,6,1,3,2,2,3,5,2])
100000 loops, best of 3: 15.8 us per loop
sage: %timeit Composition([])
100000 loops, best of 3: 12.1 us per loop

after

sage: %timeit Composition([3,2,1])
100000 loops, best of 3: 16 us per loop
sage: %timeit a = Composition([2,1,6,2,2,6,1,3,2,2,3,5,2])
10000 loops, best of 3: 21.4 us per loop
sage: %timeit Composition([])
100000 loops, best of 3: 12.8 us per loop
```




---

archive/issue_comments_186632.json:
```json
{
    "body": "Well, have a look at the patchbot report here, for the version forbidding the zeroes:\n\nhttp://patchbot.sagemath.org/log/14862/Fedora/19/x86_64/3.11.2-201.fc19.x86_64/desktop/2013-10-22%2008:49:29%20+0100?short\n\nIt involves **many** different failures, apparently.",
    "created_at": "2013-11-05T08:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186632",
    "user": "chapoton"
}
```

Well, have a look at the patchbot report here, for the version forbidding the zeroes:

http://patchbot.sagemath.org/log/14862/Fedora/19/x86_64/3.11.2-201.fc19.x86_64/desktop/2013-10-22%2008:49:29%20+0100?short

It involves **many** different failures, apparently.



---

archive/issue_comments_186633.json:
```json
{
    "body": "Ouch! Thanks for finding these things. The very idea that weights of tableaux should be compositions isn't particularly literate (and it seems to account for most of the failures). I see two ways to fix this:\n\n* Add a `WeakCompositions` class that checks for nonnegativity (rather than positivity) and only removes trailing zeroes on uniformization. (A weak composition is a finitely supported infinite sequence of nonnegative integers.)\n\n* Let the weight just be an iterable, with checks being done in `__classcall__`\n\nI'd much prefer to have this decided before the tableau rewrite...",
    "created_at": "2013-11-05T16:37:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186633",
    "user": "darij"
}
```

Ouch! Thanks for finding these things. The very idea that weights of tableaux should be compositions isn't particularly literate (and it seems to account for most of the failures). I see two ways to fix this:

* Add a `WeakCompositions` class that checks for nonnegativity (rather than positivity) and only removes trailing zeroes on uniformization. (A weak composition is a finitely supported infinite sequence of nonnegative integers.)

* Let the weight just be an iterable, with checks being done in `__classcall__`

I'd much prefer to have this decided before the tableau rewrite...



---

archive/issue_comments_186634.json:
```json
{
    "body": "The weak compositions are suppose to be `IntegerVectors`, but as I recall, there is abuse of `Composition` as I believe those failing doctests imply.\n\nAlso I'm not against adding checks to `Composition`, but I do not want to change the name (including `Partition`).",
    "created_at": "2013-11-05T23:39:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186634",
    "user": "tscrim"
}
```

The weak compositions are suppose to be `IntegerVectors`, but as I recall, there is abuse of `Composition` as I believe those failing doctests imply.

Also I'm not against adding checks to `Composition`, but I do not want to change the name (including `Partition`).



---

archive/issue_comments_186635.json:
```json
{
    "body": "Replying to [comment:25 darij]:\n> Ouch! Thanks for finding these things. The very idea that weights of tableaux should be compositions isn't particularly literate (and it seems to account for most of the failures). I see two ways to fix this:\n> \n> * Add a `WeakCompositions` class that checks for nonnegativity (rather than positivity) and only removes trailing zeroes on uniformization. (A weak composition is a finitely supported infinite sequence of nonnegative integers.)\n> \n> * Let the weight just be an iterable, with checks being done in `__classcall__`\n> \n> I'd much prefer to have this decided before the tableau rewrite...\n\nI'm not sure what is slated for the tableaux rewrite (is this just the plan to move over to ClonableIntArray?), but from a representation theoretic perspective we should definitely allow the parts of compositions to be zero.",
    "created_at": "2013-11-06T07:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186635",
    "user": "andrew.mathas"
}
```

Replying to [comment:25 darij]:
> Ouch! Thanks for finding these things. The very idea that weights of tableaux should be compositions isn't particularly literate (and it seems to account for most of the failures). I see two ways to fix this:
> 
> * Add a `WeakCompositions` class that checks for nonnegativity (rather than positivity) and only removes trailing zeroes on uniformization. (A weak composition is a finitely supported infinite sequence of nonnegative integers.)
> 
> * Let the weight just be an iterable, with checks being done in `__classcall__`
> 
> I'd much prefer to have this decided before the tableau rewrite...

I'm not sure what is slated for the tableaux rewrite (is this just the plan to move over to ClonableIntArray?), but from a representation theoretic perspective we should definitely allow the parts of compositions to be zero.



---

archive/issue_comments_186636.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-01-09T19:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186636",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_186637.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-02T19:59:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186637",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_186638.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-23T09:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186638",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_186639.json:
```json
{
    "body": "Shouldn't we have a \"check=True\" flag on the constructor? I'd be happier if the checking could be avoided.",
    "created_at": "2015-05-26T09:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14658#issuecomment-186639",
    "user": "darij"
}
```

Shouldn't we have a "check=True" flag on the constructor? I'd be happier if the checking could be avoided.
