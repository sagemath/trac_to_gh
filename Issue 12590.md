# Issue 12590: LinBox (1.1.6) fails to build with GCC 4.7.0

archive/issues_012590.json:
```json
{
    "body": "Assignee: @nexttime\n\nCC:  @ClementPernet @williamstein mariah\n\nKeywords: C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg\n\nThis is due to stricter (C++11) name look-up rules in GCC 4.7.x.\n\nI haven't yet created a fixed spkg; it does build with `-fpermissive` in `CXXFLAGS`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12762\n\n",
    "created_at": "2012-03-27T18:23:13Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0.1",
    "title": "LinBox (1.1.6) fails to build with GCC 4.7.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12590",
    "user": "@nexttime"
}
```
Assignee: @nexttime

CC:  @ClementPernet @williamstein mariah

Keywords: C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg

This is due to stricter (C++11) name look-up rules in GCC 4.7.x.

I haven't yet created a fixed spkg; it does build with `-fpermissive` in `CXXFLAGS`.

Issue created by migration from https://trac.sagemath.org/ticket/12762





---

archive/issue_comments_149722.json:
```json
{
    "body": "P.S.: Probably upstream has already fixed this; haven't checked.\n\nAlso *this* package has last been upgraded in June 2008; Cl\u00e9ment Pernet is listed as an spkg maintainer as well as the upstream contact.",
    "created_at": "2012-03-28T16:52:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149722",
    "user": "@nexttime"
}
```

P.S.: Probably upstream has already fixed this; haven't checked.

Also *this* package has last been upgraded in June 2008; Clément Pernet is listed as an spkg maintainer as well as the upstream contact.



---

archive/issue_comments_149723.json:
```json
{
    "body": "Diff between the previous spkg in Sage and my new p8 spkg.  For reference / review only.",
    "created_at": "2012-04-07T20:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149723",
    "user": "@nexttime"
}
```

Diff between the previous spkg in Sage and my new p8 spkg.  For reference / review only.



---

archive/issue_comments_149724.json:
```json
{
    "body": "Changing keywords from \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg\" to \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check\".",
    "created_at": "2012-04-07T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149724",
    "user": "@nexttime"
}
```

Changing keywords from "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg" to "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check".



---

archive/issue_comments_149725.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-07T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149725",
    "user": "@nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_149726.json:
```json
{
    "body": "Attachment [linbox-1.1.6.p7-p8.diff](tarball://root/attachments/some-uuid/ticket12762/linbox-1.1.6.p7-p8.diff) by @nexttime created at 2012-04-07 20:25:52\n\nOk, changed and added a couple of things in addition, among these an `spkg-check` file, and changes to upstream code and the \"disable commentator\" patch to make the test suite build (see changelog entry in the ticket's description and the attached diff for details).\n\nNew spkg, same place, changes now committed, ready to test & review... :P",
    "created_at": "2012-04-07T20:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149726",
    "user": "@nexttime"
}
```

Attachment [linbox-1.1.6.p7-p8.diff](tarball://root/attachments/some-uuid/ticket12762/linbox-1.1.6.p7-p8.diff) by @nexttime created at 2012-04-07 20:25:52

Ok, changed and added a couple of things in addition, among these an `spkg-check` file, and changes to upstream code and the "disable commentator" patch to make the test suite build (see changelog entry in the ticket's description and the attached diff for details).

New spkg, same place, changes now committed, ready to test & review... :P



---

archive/issue_comments_149727.json:
```json
{
    "body": "P.S.:\n\nThere's a not that recent \"stable\" LinBox version 1.1.7, as well as IIRC more recent \"instable\" 1.2.x development versions.  (Unfortunately there's [no changelog entry for the 1.1.7 version](http://linalg.org/NEWS-1.1.html), at least not online.)\n\nHaven't yet tried any of these, but upgrading -- if worthwhile -- should IMHO be done on another ticket; making the spkg build with GCC 4.7.x, adding an `spkg-check` file and making the test suite build seems more important (or urgent) to me.",
    "created_at": "2012-04-07T20:55:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149727",
    "user": "@nexttime"
}
```

P.S.:

There's a not that recent "stable" LinBox version 1.1.7, as well as IIRC more recent "instable" 1.2.x development versions.  (Unfortunately there's [no changelog entry for the 1.1.7 version](http://linalg.org/NEWS-1.1.html), at least not online.)

Haven't yet tried any of these, but upgrading -- if worthwhile -- should IMHO be done on another ticket; making the spkg build with GCC 4.7.x, adding an `spkg-check` file and making the test suite build seems more important (or urgent) to me.



---

archive/issue_comments_149728.json:
```json
{
    "body": "Fedora has this patch for linbox 1.2.2 http://pkgs.fedoraproject.org/gitweb/?p=linbox.git;a=blob;f=linbox-gcc47.patch",
    "created_at": "2012-04-26T18:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149728",
    "user": "pcpa"
}
```

Fedora has this patch for linbox 1.2.2 http://pkgs.fedoraproject.org/gitweb/?p=linbox.git;a=blob;f=linbox-gcc47.patch



---

archive/issue_comments_149729.json:
```json
{
    "body": "I tried this spkg this morning and it failed ; the compile lines lack the -fpermissive, even though I see the code in spkg-install which is supposed to add it...\n\nNotice that it was with a fairly extensively modified sage-5.0.rc1, so maybe the failure isn't that conclusive, but I still thought it was worth reporting.",
    "created_at": "2012-05-13T09:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149729",
    "user": "Snark"
}
```

I tried this spkg this morning and it failed ; the compile lines lack the -fpermissive, even though I see the code in spkg-install which is supposed to add it...

Notice that it was with a fairly extensively modified sage-5.0.rc1, so maybe the failure isn't that conclusive, but I still thought it was worth reporting.



---

archive/issue_comments_149730.json:
```json
{
    "body": "I retried with a bare sage-5.0.rc1, and linbox failed.\n\nI retried with the spkg with md5sum b7a35a9927d5fc5c51f88ad3ada3df6c, and it failed.",
    "created_at": "2012-05-13T20:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149730",
    "user": "Snark"
}
```

I retried with a bare sage-5.0.rc1, and linbox failed.

I retried with the spkg with md5sum b7a35a9927d5fc5c51f88ad3ada3df6c, and it failed.



---

archive/issue_comments_149731.json:
```json
{
    "body": "I noticed two things :\n1. the only directory where the current patch doesn't work is interfaces/sage/ : the rest builds ok!\n2. if there is nothing in patches/, then spkg-install errors out.\n\nI settled to fix the matter, but must admit my failure : even if I manage to get the -fpermissive through (adding directly to interfaces/sage/Makefile.am... not clean at all), the build still fails with this error :\nlinbox-sage.C:463:13: error: \u2018NTL_ZZ\u2019 was not declared in this scope",
    "created_at": "2012-05-14T13:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149731",
    "user": "Snark"
}
```

I noticed two things :
1. the only directory where the current patch doesn't work is interfaces/sage/ : the rest builds ok!
2. if there is nothing in patches/, then spkg-install errors out.

I settled to fix the matter, but must admit my failure : even if I manage to get the -fpermissive through (adding directly to interfaces/sage/Makefile.am... not clean at all), the build still fails with this error :
linbox-sage.C:463:13: error: ‘NTL_ZZ’ was not declared in this scope



---

archive/issue_comments_149732.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-05-25T18:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149732",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_149733.json:
```json
{
    "body": "In\n\n```\ncase \"`$CXX -dumpversion 2>/dev/null`\" in\n    4.7.*)\n```\n\nYou should check for GCC first.",
    "created_at": "2012-05-25T18:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149733",
    "user": "@jdemeyer"
}
```

In

```
case "`$CXX -dumpversion 2>/dev/null`" in
    4.7.*)
```

You should check for GCC first.



---

archive/issue_comments_149734.json:
```json
{
    "body": "I have another idea : get in touch with upstream so the code is fixed, and update the version in sage... no more ugly workaround!",
    "created_at": "2012-05-25T18:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149734",
    "user": "Snark"
}
```

I have another idea : get in touch with upstream so the code is fixed, and update the version in sage... no more ugly workaround!



---

archive/issue_comments_149735.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-05-26T00:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149735",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_149736.json:
```json
{
    "body": "Diff between leif's p9 (a rebased p8) and my p10 spkgs. For reference / review only.",
    "created_at": "2012-05-26T00:28:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149736",
    "user": "@jdemeyer"
}
```

Diff between leif's p9 (a rebased p8) and my p10 spkgs. For reference / review only.



---

archive/issue_comments_149737.json:
```json
{
    "body": "Attachment [linbox-1.1.6.p10.diff](tarball://root/attachments/some-uuid/ticket12762/linbox-1.1.6.p10.diff) by @jdemeyer created at 2012-05-26 00:28:54\n\nRebased leif's patch to #10281, then made some further changes.\n\nNew spkg needs review.",
    "created_at": "2012-05-26T00:28:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149737",
    "user": "@jdemeyer"
}
```

Attachment [linbox-1.1.6.p10.diff](tarball://root/attachments/some-uuid/ticket12762/linbox-1.1.6.p10.diff) by @jdemeyer created at 2012-05-26 00:28:54

Rebased leif's patch to #10281, then made some further changes.

New spkg needs review.



---

archive/issue_comments_149738.json:
```json
{
    "body": "Changing keywords from \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check\" to \"C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check sd40.5\".",
    "created_at": "2012-05-26T01:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149738",
    "user": "@jdemeyer"
}
```

Changing keywords from "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check" to "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check sd40.5".



---

archive/issue_comments_149739.json:
```json
{
    "body": "This installs correctly with 4.7.0 on sage.math, and then *after* using `SAGE_UPGRADING` and everything building, then *again* force installing this package and doing `sage -b` does build the correct extension modules.  Spkg is properly constructed etc., patches are applying without exiting with non-zero, etc.  Running long doctests, but I don't expect anything unusual.",
    "created_at": "2012-05-26T03:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149739",
    "user": "@kcrisman"
}
```

This installs correctly with 4.7.0 on sage.math, and then *after* using `SAGE_UPGRADING` and everything building, then *again* force installing this package and doing `sage -b` does build the correct extension modules.  Spkg is properly constructed etc., patches are applying without exiting with non-zero, etc.  Running long doctests, but I don't expect anything unusual.



---

archive/issue_comments_149740.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-05-26T03:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149740",
    "user": "@kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_149741.json:
```json
{
    "body": "Good to go.  Also passes tests on Mac OS X built with GCC 4.6.3, so should be ok.",
    "created_at": "2012-05-26T03:42:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149741",
    "user": "@kcrisman"
}
```

Good to go.  Also passes tests on Mac OS X built with GCC 4.6.3, so should be ok.



---

archive/issue_comments_149742.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-06-02T13:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12590",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12590#issuecomment-149742",
    "user": "@jdemeyer"
}
```

Resolution: fixed
