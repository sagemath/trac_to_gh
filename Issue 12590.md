# Issue 12590: LinBox (1.1.6) fails to build with GCC 4.7.0

Issue created by migration from https://trac.sagemath.org/ticket/12762

Original creator: leif

Original creation time: 2012-03-27 18:23:13

Assignee: leif

CC:  cpernet was mariah

Keywords: C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg

This is due to stricter (C++11) name look-up rules in GCC 4.7.x.

I haven't yet created a fixed spkg; it does build with `-fpermissive` in `CXXFLAGS`.


---

Comment by leif created at 2012-03-28 16:52:37

P.S.: Probably upstream has already fixed this; haven't checked.

Also _this_ package has last been upgraded in June 2008; Clément Pernet is listed as an spkg maintainer as well as the upstream contact.


---

Comment by leif created at 2012-04-07 20:09:34

Diff between the previous spkg in Sage and my new p8 spkg.  For reference / review only.


---

Comment by leif created at 2012-04-07 20:25:52

Changing keywords from "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg" to "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check".


---

Comment by leif created at 2012-04-07 20:25:52

Changing status from new to needs_review.


---

Attachment

Ok, changed and added a couple of things in addition, among these an `spkg-check` file, and changes to upstream code and the "disable commentator" patch to make the test suite build (see changelog entry in the ticket's description and the attached diff for details).

New spkg, same place, changes now committed, ready to test & review... :P


---

Comment by leif created at 2012-04-07 20:55:53

P.S.:

There's a not that recent "stable" LinBox version 1.1.7, as well as IIRC more recent "instable" 1.2.x development versions.  (Unfortunately there's [no changelog entry for the 1.1.7 version](http://linalg.org/NEWS-1.1.html), at least not online.)

Haven't yet tried any of these, but upgrading -- if worthwhile -- should IMHO be done on another ticket; making the spkg build with GCC 4.7.x, adding an `spkg-check` file and making the test suite build seems more important (or urgent) to me.


---

Comment by pcpa created at 2012-04-26 18:39:59

Fedora has this patch for linbox 1.2.2 http://pkgs.fedoraproject.org/gitweb/?p=linbox.git;a=blob;f=linbox-gcc47.patch


---

Comment by Snark created at 2012-05-13 09:01:38

I tried this spkg this morning and it failed ; the compile lines lack the -fpermissive, even though I see the code in spkg-install which is supposed to add it...

Notice that it was with a fairly extensively modified sage-5.0.rc1, so maybe the failure isn't that conclusive, but I still thought it was worth reporting.


---

Comment by Snark created at 2012-05-13 20:36:49

I retried with a bare sage-5.0.rc1, and linbox failed.

I retried with the spkg with md5sum b7a35a9927d5fc5c51f88ad3ada3df6c, and it failed.


---

Comment by Snark created at 2012-05-14 13:25:11

I noticed two things :
1. the only directory where the current patch doesn't work is interfaces/sage/ : the rest builds ok!
2. if there is nothing in patches/, then spkg-install errors out.

I settled to fix the matter, but must admit my failure : even if I manage to get the -fpermissive through (adding directly to interfaces/sage/Makefile.am... not clean at all), the build still fails with this error :
linbox-sage.C:463:13: error: ‘NTL_ZZ’ was not declared in this scope


---

Comment by jdemeyer created at 2012-05-25 18:07:03

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-05-25 18:07:03

In

```
case "`$CXX -dumpversion 2>/dev/null`" in
    4.7.*)
```

You should check for GCC first.


---

Comment by Snark created at 2012-05-25 18:38:41

I have another idea : get in touch with upstream so the code is fixed, and update the version in sage... no more ugly workaround!


---

Comment by jdemeyer created at 2012-05-26 00:27:36

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2012-05-26 00:28:19

Diff between leif's p9 (a rebased p8) and my p10 spkgs. For reference / review only.


---

Attachment

Rebased leif's patch to #10281, then made some further changes.

New spkg needs review.


---

Comment by jdemeyer created at 2012-05-26 01:04:28

Changing keywords from "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check" to "C++11 GCC 4.7.0 CXXFLAGS -fpermissive spkg spkg-check sd40.5".


---

Comment by kcrisman created at 2012-05-26 03:13:00

This installs correctly with 4.7.0 on sage.math, and then _after_ using `SAGE_UPGRADING` and everything building, then _again_ force installing this package and doing `sage -b` does build the correct extension modules.  Spkg is properly constructed etc., patches are applying without exiting with non-zero, etc.  Running long doctests, but I don't expect anything unusual.


---

Comment by kcrisman created at 2012-05-26 03:42:44

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2012-05-26 03:42:44

Good to go.  Also passes tests on Mac OS X built with GCC 4.6.3, so should be ok.


---

Comment by jdemeyer created at 2012-06-02 13:42:25

Resolution: fixed
