# Issue 23902: Allow baseline to be given as part of ascii_art and unicode_art

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2017-11-01 13:02:56

CC:  chapoton

Keywords: ascii unicode art

Currently they are too restrictive on the keywords, in particular they do not allow passing `baseline` to the created object. This means to set the baseline, we have to do

```
sage: a = ascii_art('2\n1\n0')
sage: a._baseline = 1
sage: a + ascii_art('<-')
2
1<-
0
```

This makes them quite cumbersome to deal with.


---

Comment by tscrim created at 2017-11-01 13:12:25

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-11-01 13:12:25

Something for a followup ticket: It would be really handy to have `ascii_art('2') + '3'` work and same for `*`.
----
New commits:


---

Comment by git created at 2017-11-03 11:42:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by soehms created at 2018-01-20 20:40:32

**The improvements to the ascii_art and unicode_art classes work well**. But I noticed two cases where my intuition about the usage of the keywords failed. The first one does also concern the preliminary version and has nothing to do with the changes:

1) 'sep'-keyword is ignored if a list is passed (since it is considered as one object)



```
sage: ascii_art(list(Partitions(6)), sep=' | ')

[                                                       * ]
[                                                   **  * ]
[                                      ***      **  *   * ]
[                      ****       ***  *    **  **  *   * ]
[         *****  ****  *     ***  **   *    **  *   *   * ]
[ ******, *    , **  , *   , ***, *  , *  , **, * , * , * ]

```


To have the separator in the list you must do



```
sage: p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11 = list(Partitions(6))
sage: ascii_art(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, sep=' | ')
                                                                *
                                                           **   *
                                           ***        **   *    *
                        ****         ***   *     **   **   *    *
         *****   ****   *      ***   **    *     **   *    *    *
****** | *     | **   | *    | *** | *   | *   | ** | *  | *  | *

```




2) the 'sep_baseline' keyword is ignored when the separators are not strings but AsciiArt objects themselves



```
sage: sep_line = AsciiArt(lines = [' | ' for _ in range(6)])
sage: part6_up = [ascii_art(part, baseline=len(part)) for part in Partitions(6)]
sage: p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11 = part6_up
sage: ascii_art(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, sep=sep_line, sep_baseline=6)
       |       |      |      |     |     |     |    |    |    |
       |       |      |      |     |     |     |    |    |    |
       |       |      |      |     |     |     |    |    |    |
       |       |      |      |     |     |     |    |    |    |
       |       |      |      |     |     |     |    |    |    |
       |       |      |      |     |     |     |    |    |    |
******   *****   ****   ****   ***   ***   ***   **   **   **   *
         *       **     *      ***   **    *     **   **   *    *
                        *            *     *     **   *    *    *
                                           *          *    *    *
                                                           *    *
                                                                *

```


Since the intension of the ticket is to make the usage more comfortable you should think about the following extension which I have tried and which I display in the case of unicode:






```
diff --git a/src/sage/typeset/unicode_art.py b/src/sage/typeset/unicode_art.py
index dbdd028..c1bc878 100644
--- a/src/sage/typeset/unicode_art.py
+++ b/src/sage/typeset/unicode_art.py
`@``@` -122,9 +122,18 `@``@` def unicode_art(*obj, **kwds):
     if kwds:
         raise ValueError('unknown keyword arguments: {0}'.format(list(kwds)))
     if len(obj) == 1:
-        return _unicode_art_factory.build(obj[0], baseline=baseline)
+        if type(obj[0]) ==  list and len(separator) > 0:
+            # soehms JAN 2017 (trac #24139): allow to apply separators to lists (instead of ",")
+            obj = obj[0]
+        else:
+            return _unicode_art_factory.build(obj[0], baseline=baseline)
     if not isinstance(separator, UnicodeArt):
         separator = _unicode_art_factory.build(separator, baseline=sep_baseline)
+    elif sep_baseline != None:
+        # soehms JAN 2017 (trac #24139): allow to apply sep_baseline to a given separator
+        from copy import copy
+        separator = copy(separator)
+        separator._baseline = sep_baseline
     obj = map(_unicode_art_factory.build, obj)
     return _unicode_art_factory.concatenate(obj, separator, empty_unicode_art,
                                             baseline=baseline)
```



Repeating the above tests with these changes gives:



```
sage: ascii_art(list(Partitions(6)), sep=' | ')

                                                                *
                                                           **   *
                                           ***        **   *    *
                        ****         ***   *     **   **   *    *
         *****   ****   *      ***   **    *     **   *    *    *
****** | *     | **   | *    | *** | *   | *   | ** | *  | *  | *




sage: ascii_art(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, sep=sep_line, sep_baseline=6)
****** | ***** | **** | **** | *** | *** | *** | ** | ** | ** | *
       | *     | **   | *    | *** | **  | *   | ** | ** | *  | *
       |       |      | *    |     | *   | *   | ** | *  | *  | *
       |       |      |      |     |     | *   |    | *  | *  | *
       |       |      |      |     |     |     |    |    | *  | *
       |       |      |      |     |     |     |    |    |    | *

```


**I leave it up top you, if you follow my suggestions or not.**
Please tell me if I should push my suggestions to the trac server (and how to do it the best way).


---

Comment by git created at 2018-01-22 01:13:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-01-22 01:14:54

Replying to [comment:4 soehms]:
> **The improvements to the ascii_art and unicode_art classes work well**. But I noticed two cases where my intuition about the usage of the keywords failed. The first one does also concern the preliminary version and has nothing to do with the changes:

Thank you for looking at this. You will need to put your real name in the reviewer slot.

> 1) 'sep'-keyword is ignored if a list is passed (since it is considered as one object)
> {{{
> sage: ascii_art(list(Partitions(6)), sep=' | ')
> [                                                       * ]
> [                                                   **  * ]
> [                                      ***      **  *   * ]
> [                      ****       ***  *    **  **  *   * ]
> [         *****  ****  *     ***  **   *    **  *   *   * ]
> [ ******, *    , **  , *   , ***, *  , *  , **, * , * , * ]
> }}}
> To have the separator in the list you must do
> {{{
> sage: p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11 = list(Partitions(6))
> sage: ascii_art(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, sep=' | ')
>                                                                 *
>                                                            **   *
>                                            ***        **   *    *
>                         ****         ***   *     **   **   *    *
>          *****   ****   *      ***   **    *     **   *    *    *
> ****** | *     | **   | *    | *** | *   | *   | ** | *  | *  | *
> }}}

I actually agree with the behavior as is as otherwise you could not (naturally) create the ascii art of a list. Python has a way to expand the list by using `ascii_art(*Partitions(6), sep='|')`.

> 2) the 'sep_baseline' keyword is ignored when the separators are not strings but AsciiArt objects themselves
> {{{
> sage: sep_line = AsciiArt(lines = [' | ' for _ in range(6)])
> sage: part6_up = [ascii_art(part, baseline=len(part)) for part in Partitions(6)]
> sage: p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11 = part6_up
> sage: ascii_art(p1, p2, p3, p4, p5, p6, p7, p8, p9, p10, p11, sep=sep_line, sep_baseline=6)
>        |       |      |      |     |     |     |    |    |    |
>        |       |      |      |     |     |     |    |    |    |
>        |       |      |      |     |     |     |    |    |    |
>        |       |      |      |     |     |     |    |    |    |
>        |       |      |      |     |     |     |    |    |    |
>        |       |      |      |     |     |     |    |    |    |
> ******   *****   ****   ****   ***   ***   ***   **   **   **   *
>          *       **     *      ***   **    *     **   **   *    *
>                         *            *     *     **   *    *    *
>                                            *          *    *    *
>                                                            *    *
>                                                                 *
> 
> }}}

I agree, that should set the baseline for the separator. Fixed.


---

Comment by soehms created at 2018-01-24 22:38:49

Ad 1) Although the user must not necessarily be an advanced python developer, I agree with you. My suggestion would be a kind of "auto correction" feature. Actually, I don't like them, too. 

Ad 2) I don't understand your reply. You say: agreed and fixed. But it looks as if you just changed the doc-string and not the code (and just for ascii_art.py and not for unicode_art.py).


---

Comment by git created at 2018-01-25 16:09:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-01-25 16:12:31

Replying to [comment:7 soehms]:
> Ad 1) Although the user must not necessarily be an advanced python developer, I agree with you. My suggestion would be a kind of "auto correction" feature. Actually, I don't like them, too. 

However it would be a large behavioral change and, IMO, be very unnatural to create the ascii/unicode art of a list.

> Ad 2) I don't understand your reply. You say: agreed and fixed. But it looks as if you just changed the doc-string and not the code (and just for ascii_art.py and not for unicode_art.py).

I thought I had added those changes as part of my commit, but IDK what happened to them. I might not have saved the file. Anyways, I have pushed them for sure this time. :)


---

Comment by git created at 2018-01-28 09:43:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by soehms created at 2018-01-28 09:47:18

Changing status from needs_review to positive_review.


---

Comment by soehms created at 2018-01-28 09:47:18

Now, everything seems to be o.K. (except a formatting mistake with missing blanks in the doc-string of unicode_art.py). I am pushing the correction in order to learn this work-flow.

Concerning my first issue, I think we had a misunderstanding, because I focused to much on the non expanded list as argument. But my criticism was against the given "sep"-keyword to be ignored without any reaction (not even a warning).But I completely understand, that you don't want to change the default behavior.


---

Comment by vbraun created at 2018-02-01 19:13:14

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-02-01 19:13:14

PDF docs fail

```
[docpdf] 
[docpdf] ! Package inputenc Error: Unicode char ┤ (U+2524)
[docpdf] (inputenc)                not set up for use with LaTeX.
[docpdf] 
[docpdf] See the inputenc package documentation for explanation.
[docpdf] Type  H <return>  for immediate help.
[docpdf]  ...                                              
[docpdf]                                                   
[docpdf] l.20426 ...      ⎟     ⎟ ┌┬┐ ⎟ ├┤}
[docpdf]                                                   
```



---

Comment by git created at 2018-02-02 02:23:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-02-02 02:25:59

Here I was thinking there wouldn't be any problems with the pdf because these examples already were in `partition.py`. However, they are not actually included in the documentation. So instead, I am sweeping the issue under the rug by instead using alternating sign matrices, but those were missing a unicode art method. This fixes the pdf docbuild issue.


---

Comment by tscrim created at 2018-02-02 02:25:59

Changing status from needs_work to needs_review.


---

Comment by soehms created at 2018-02-03 09:36:45

Maybe, I have some beginners irritations, right now. But, as the PDF-compiliation error was not detected by "sage -t" I now get this:



```
sage -t src/sage/typeset/unicode_art.py
**********************************************************************
File "src/sage/typeset/unicode_art.py", line 109, in sage.typeset.unicode_art.unicode_art
Failed example:
    unicode_art(*AlternatingSignMatrices(3),
                separator=sep_line, sep_baseline=1)
Expected:
            ⎟         ⎟         ⎟            ⎟         ⎟         ⎟
    ⎛1 0 0⎞ ⎟ ⎛0 1 0⎞ ⎟ ⎛1 0 0⎞ ⎟ ⎛ 0  1  0⎞ ⎟ ⎛0 0 1⎞ ⎟ ⎛0 1 0⎞ ⎟ ⎛0 0 1⎞
    ⎜0 1 0⎟ ⎟ ⎜1 0 0⎟ ⎟ ⎜0 0 1⎟ ⎟ ⎜ 1 -1  1⎟ ⎟ ⎜1 0 0⎟ ⎟ ⎜0 0 1⎟ ⎟ ⎜0 1 0⎟
    ⎝0 0 1⎠ ⎟ ⎝0 0 1⎠ ⎟ ⎝0 1 0⎠ ⎟ ⎝ 0  1  0⎠ ⎟ ⎝0 1 0⎠ ⎟ ⎝1 0 0⎠ ⎟ ⎝1 0 0⎠
            ⎟         ⎟         ⎟            ⎟         ⎟         ⎟
Got:
            ⎟         ⎟         ⎟            ⎟         ⎟         ⎟
    [1 0 0] ⎟ [0 1 0] ⎟ [1 0 0] ⎟ [ 0  1  0] ⎟ [0 0 1] ⎟ [0 1 0] ⎟ [0 0 1]
    [0 1 0] ⎟ [1 0 0] ⎟ [0 0 1] ⎟ [ 1 -1  1] ⎟ [1 0 0] ⎟ [0 0 1] ⎟ [0 1 0]
    [0 0 1] ⎟ [0 0 1] ⎟ [0 1 0] ⎟ [ 0  1  0] ⎟ [0 1 0] ⎟ [1 0 0] ⎟ [1 0 0]
            ⎟         ⎟         ⎟            ⎟         ⎟         ⎟


```


I did it with: [SageMath](SageMath) version 8.2.beta4, Release Date: 2018-01-27


---

Comment by tscrim created at 2018-02-03 11:02:38

Did you rebuild Sage `sage -b`? (Protip: You can combine them as `sage -bt path/to/file` as well as build-run `sage -br`.) Also the pdf docbuild is something you have to run separately `sage -docbuild all pdf` IIRC.


---

Comment by soehms created at 2018-02-04 20:56:04

Changing status from needs_review to positive_review.


---

Comment by soehms created at 2018-02-04 20:56:04

Sorry, of course you are right, I must have forgotten `sage -b`. 

Thanks for the hint with respect to the docbuild. Unfortunately the pdf docbuild does not run through successfully on my system.
I guess I have some incompatible latex babel settings, since the building process stops to continue (but does not break) at `a_tour_of_sage` in other languages than English (hu is the first one, if you have a hint to this issue this would be great).

But of course, this has nothing to do with the unicode_art.


---

Comment by tscrim created at 2018-02-04 21:19:23

I don't think I've ever tried to build the pdf docs in other languages besides English... *shurgs*

Thank you for the review!


---

Comment by vbraun created at 2018-02-09 08:04:04

Resolution: fixed
