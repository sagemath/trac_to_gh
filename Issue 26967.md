# Issue 26967: Fix linking with --as-needed

archive/issues_026967.json:
```json
{
    "body": "CC:  fbissey\n\nLinking with `LDFLAGS = -Wl,--as-needed` fails due to wrong ordering of arguments. This option is the default in Ubuntu and it was reported in https://bugs.debian.org/919573 . According to the report the libraries should be placed after the object files for this to work, which is not always the case.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27204\n\n",
    "created_at": "2019-02-02T13:20:16Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "Fix linking with --as-needed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26967",
    "user": "thansen"
}
```
CC:  fbissey

Linking with `LDFLAGS = -Wl,--as-needed` fails due to wrong ordering of arguments. This option is the default in Ubuntu and it was reported in https://bugs.debian.org/919573 . According to the report the libraries should be placed after the object files for this to work, which is not always the case.

Issue created by migration from https://trac.sagemath.org/ticket/27204





---

archive/issue_comments_379471.json:
```json
{
    "body": "Replying to [ticket:27204 thansen]:\n> According to the report the libraries should be placed after the object files for this to work\n\nIt would be good if somebody could confirm that this is indeed the problem.\n\nFran\u00e7ois, aren't you using `--as-needed` on Gentoo?",
    "created_at": "2019-02-03T11:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26967#issuecomment-379471",
    "user": "jdemeyer"
}
```

Replying to [ticket:27204 thansen]:
> According to the report the libraries should be placed after the object files for this to work

It would be good if somebody could confirm that this is indeed the problem.

Fran√ßois, aren't you using `--as-needed` on Gentoo?



---

archive/issue_comments_379472.json:
```json
{
    "body": "Now that I'm looking again at the Debian bug report, in the example there the libraries do come after the object file. Let me test myself if the Debian package builds with --as-needed.\n\nImportance of linking order is also mentioned here: https://wiki.gentoo.org/wiki/Project:Quality_Assurance/As-needed#Importance_of_linking_order",
    "created_at": "2019-02-03T12:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26967#issuecomment-379472",
    "user": "thansen"
}
```

Now that I'm looking again at the Debian bug report, in the example there the libraries do come after the object file. Let me test myself if the Debian package builds with --as-needed.

Importance of linking order is also mentioned here: https://wiki.gentoo.org/wiki/Project:Quality_Assurance/As-needed#Importance_of_linking_order



---

archive/issue_comments_379473.json:
```json
{
    "body": "It is the default on Gentoo and its been some time since I have seen an issue like that in sage itself. I'll have to inspect my build logs to see if I have the order correct.",
    "created_at": "2019-02-03T18:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26967#issuecomment-379473",
    "user": "fbissey"
}
```

It is the default on Gentoo and its been some time since I have seen an issue like that in sage itself. I'll have to inspect my build logs to see if I have the order correct.



---

archive/issue_comments_379474.json:
```json
{
    "body": "I didn't have a problem building with `--as-needed`, so I suspect the reporter of the Debian bug just encountered an issue caused by #27205 and confused the object (*.o) with the output (*.so) file (which comes after the libraries). Let's see what they answer.",
    "created_at": "2019-02-03T19:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26967#issuecomment-379474",
    "user": "thansen"
}
```

I didn't have a problem building with `--as-needed`, so I suspect the reporter of the Debian bug just encountered an issue caused by #27205 and confused the object (*.o) with the output (*.so) file (which comes after the libraries). Let's see what they answer.



---

archive/issue_comments_379475.json:
```json
{
    "body": "After fixing #27205, sagemath builds again on Ubuntu, so there was never a problem with --as-needed.",
    "created_at": "2019-02-20T13:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26967#issuecomment-379475",
    "user": "thansen"
}
```

After fixing #27205, sagemath builds again on Ubuntu, so there was never a problem with --as-needed.



---

archive/issue_comments_379476.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2019-02-20T13:56:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26967",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26967#issuecomment-379476",
    "user": "jdemeyer"
}
```

Resolution: worksforme
