# Issue 26967: Fix linking with --as-needed

Issue created by migration from https://trac.sagemath.org/ticket/27204

Original creator: thansen

Original creation time: 2019-02-02 13:20:16

CC:  fbissey

Linking with `LDFLAGS = -Wl,--as-needed` fails due to wrong ordering of arguments. This option is the default in Ubuntu and it was reported in https://bugs.debian.org/919573 . According to the report the libraries should be placed after the object files for this to work, which is not always the case.


---

Comment by jdemeyer created at 2019-02-03 11:47:13

Replying to [ticket:27204 thansen]:
> According to the report the libraries should be placed after the object files for this to work

It would be good if somebody could confirm that this is indeed the problem.

Fran√ßois, aren't you using `--as-needed` on Gentoo?


---

Comment by thansen created at 2019-02-03 12:30:58

Now that I'm looking again at the Debian bug report, in the example there the libraries do come after the object file. Let me test myself if the Debian package builds with --as-needed.

Importance of linking order is also mentioned here: https://wiki.gentoo.org/wiki/Project:Quality_Assurance/As-needed#Importance_of_linking_order


---

Comment by fbissey created at 2019-02-03 18:55:40

It is the default on Gentoo and its been some time since I have seen an issue like that in sage itself. I'll have to inspect my build logs to see if I have the order correct.


---

Comment by thansen created at 2019-02-03 19:08:05

I didn't have a problem building with `--as-needed`, so I suspect the reporter of the Debian bug just encountered an issue caused by #27205 and confused the object (*.o) with the output (*.so) file (which comes after the libraries). Let's see what they answer.


---

Comment by thansen created at 2019-02-20 13:55:54

After fixing #27205, sagemath builds again on Ubuntu, so there was never a problem with --as-needed.


---

Comment by jdemeyer created at 2019-02-20 13:56:16

Resolution: worksforme
