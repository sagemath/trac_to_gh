# Issue 28877: Only ./bootstrap should glob build/pkgs

Issue created by migration from https://trac.sagemath.org/ticket/29114

Original creator: mkoeppe

Original creation time: 2020-01-30 20:33:01

CC:  dimpase embray mjo jhpalmieri

Right now both `./bootstrap` and `./configure` (via `m4/sage_spkg_collect.m4`) glob.
This should be streamlined.


---

Comment by vbraun created at 2020-01-31 00:24:56

Changing priority from major to blocker.


---

Comment by mkoeppe created at 2020-01-31 01:13:19

Branch is on top of #28095.
----
New commits:


---

Comment by mkoeppe created at 2020-01-31 01:13:19

Changing status from new to needs_review.


---

Comment by git created at 2020-01-31 01:22:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-01-31 02:16:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2020-01-31 09:33:42

Could you explain what "glob" means here?


---

Comment by dimpase created at 2020-01-31 09:48:46

This reminds me of #27373 - which becomes obsolete as soon as this ticket and #29113 is done.


---

Comment by embray created at 2020-01-31 11:24:18

It seems this is adding a bunch of previously unnecessary complication only because #29038, which I strongly objected to, was merged.  I didn't step in then because I was busy with other things.  Can we please roll back #29038 instead?  I'm absolute convinced there's no need for it.


---

Comment by embray created at 2020-01-31 11:26:48

Changing status from needs_review to needs_info.


---

Comment by embray created at 2020-01-31 11:35:54

See #29118 for an alternative proposal.


---

Comment by dimpase created at 2020-01-31 11:39:30

Changing status from needs_info to needs_review.


---

Comment by dimpase created at 2020-01-31 11:39:30

I think we should progress, even if the route is not optimal, and Matthias has a lot of time for working on the build system now. 

I hate to see ./configure running many times as I launch make, it really slows working on build system down, and I hope #29113 will happen soon.


---

Comment by embray created at 2020-01-31 11:56:03

I should add, some of the changes in this ticket look reasonable.  But it's mixed up with a bunch of other stuff (the way this is built on top of #28095 in particular is confusing).  I'd like to start with #29118 and then see some fixes to individual bugs that predate #29038 .


---

Comment by embray created at 2020-01-31 11:59:18

Replying to [comment:14 dimpase]:
> I think we should progress, even if the route is not optimal, and Matthias has a lot of time for working on the build system now. 

Progress on what though?  I don't think you can "progress" on unsolid footing.  I should note that part of the motivation behind #29038 is to enable the approach in #27824 which I also think is overcomplicated.

I don't think we should be making complicated changes on top of complicated changes to enable even more complicated changes.  I hate to sound like Jeroen here because I've been on the other side of disagreements like this with him.  But he'd probably be saying the same if he were here and I'd agree this time.

I would like to know what the bigger picture is to all this before making changes that don't seem well-motivated.  Don't commit a sunk cost fallacy especially when it's relatively early...


---

Comment by dimpase created at 2020-01-31 12:09:22

If you want to talk about simplification, why don't we just drop `sage -i/-f` instead of trying to keep this awful hack - something I proposed a year ago, and Jeroen objected...


---

Comment by git created at 2020-01-31 14:43:26

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2020-01-31 14:45:38

I've rebased on top of #29120, which has the "hot fix", which may be easier to review and should go into the next beta.

The present ticket, #29114, is not so urgent.


---

Comment by mkoeppe created at 2020-01-31 15:36:34

Changing priority from blocker to major.


---

Comment by mkoeppe created at 2020-03-16 01:53:22

Changing status from needs_review to needs_work.


---

Comment by mjo created at 2020-03-16 15:00:11

Since this list changes maybe once a year, we could just write it into configure.ac and avoid that part of the bootstrap process.


---

Comment by mkoeppe created at 2020-03-16 15:43:55

I think that may be too radical a change (although I am personally in favor of it - agreeing with the autotools policies) - Sage has traditionally used source discovery instead of listing files explicitly.  That's why in this ticket I just want to put the source discovery for build/pkgs into 1 script


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by git created at 2022-02-17 21:39:59

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-02-17 22:29:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-17 22:35:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-02-17 23:23:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-17 23:39:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-18 00:42:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-18 01:22:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-18 02:04:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-02-18 02:19:12

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-02-18 02:57:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-02-18 04:51:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2022-02-18 06:13:37

`./configure -q` is a useful command. I see this output:

```
Traceback (most recent call last):
  File "<string>", line 1, in <module>
ImportError: No module named lzma
./configure: line 39392: ,: command not found
```

The first is probably coming from the line `if "$SAGE_BOOTSTRAP_PYTHON" -c "import lzma"; then :`, no big deal. The other error is from a comma all by itself on line 39392 (that's with `develop`; it's line 42361 with this branch). Maybe an extra comma in `build/pkgs/qhull/spkg-configure.m4`?


---

Comment by mkoeppe created at 2022-02-18 06:14:57

This is unrelated to the ticket and fixed in #33247


---

Comment by jhpalmieri created at 2022-02-24 23:31:24

In principle this looks good to me, and Sage builds. It would be great if someone more familiar with `.m4` code could check the details.


---

Comment by mjo created at 2022-02-28 16:12:18

I looked through it all and don't see anything too scary. My one question is about the `grep -v ^=` that was added to bootstrap. It looks like that only affects the sagemath_categories, sagemath_objects, and sage_docbuild packages. Why do those have `======...` headers in their SPKG.rst to begin with?


---

Comment by mkoeppe created at 2022-02-28 18:26:26

Replying to [comment:50 mjo]:
> It looks like that only affects the sagemath_categories, sagemath_objects, and sage_docbuild packages. Why do those have `======...` headers in their SPKG.rst to begin with?

These files double as README.rst for these distributions, so this affects how it displays on PyPI.


---

Comment by mjo created at 2022-02-28 18:51:36

Ok, I don't believe in parsing `SPKG.rst` for package information anyway, so I don't mind the hack. (In the futue, I would rather we quit parsing that file than try to make them all nice and consistent.)

Everything else looks reasonable. Nothing broke in my sage build and there aren't any new subtle `./configure` errors logged to the console.

John, don't forget to add yourself as a reviewer if you want to.


---

Comment by mjo created at 2022-02-28 18:51:36

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-02-28 18:54:09

Thanks.


---

Comment by vbraun created at 2022-03-01 21:31:38

Resolution: fixed
