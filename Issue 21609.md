# Issue 21609: get rid of cmp in the pyx files of geometry folder

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2016-11-08 20:29:48

CC:  jdemeyer jmantysalo embray tscrim

as another micro-step towards py3


---

Comment by chapoton created at 2016-11-08 20:32:09

New commits:


---

Comment by git created at 2016-11-11 09:25:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-11-11 16:24:22

bot is essentially green, please review


---

Comment by chapoton created at 2016-11-11 16:24:22

Changing status from new to needs_review.


---

Comment by tscrim created at 2016-11-11 16:28:45

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-11-11 16:30:07

Instead of doing this:

```
        if not isinstance(right, PointCollection):
            return NotImplemented
        cdef PointCollection left_pc = self
        cdef PointCollection right_pc = right
```

I would prefer

```
        try:
            cdef PointCollection left_pc = <PointCollection?>self
            cdef PointCollection right_pc = <PointCollection?>right
        except TypeError:
            return NotImplemented
```

which is safer and more Pythonic.

I'm not saying that the ticket should be set back to needs_work for this, but it's something to keep in mind for the next time...


---

Comment by tscrim created at 2016-11-11 16:30:38

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-11-11 16:37:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-11-11 16:38:04

done, please review


---

Comment by chapoton created at 2016-11-11 16:38:04

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-11-11 16:46:43

Does it build? It just occurred to me that Cython might not accept `cdef` statements inside a `try`.


---

Comment by chapoton created at 2016-11-11 16:54:51

does not build, see patchbot report


---

Comment by git created at 2016-11-11 16:56:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2016-11-11 16:56:52

back to previous version, please review


---

Comment by jdemeyer created at 2016-11-11 17:15:58

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-11-11 17:15:58

Just put the `cdef` outside the `try`:

```
        cdef PointCollection left_pc, right_pc
        try:
            left_pc = <PointCollection?>self
            right_pc = <PointCollection?>right
        except TypeError:
            return NotImplemented
```



---

Comment by git created at 2016-11-11 18:38:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-11-11 18:38:39

done, thanks


---

Comment by chapoton created at 2016-11-11 18:38:39

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-11-11 19:35:13

positive_review if this works on the patchbot.


---

Comment by chapoton created at 2016-11-11 21:22:46

ok, works (unrelated failure) so set to positive. thanks for the review


---

Comment by chapoton created at 2016-11-11 21:22:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-11-15 23:25:02

Resolution: fixed
