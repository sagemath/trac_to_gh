# Issue 17455: The default __invert__ method of an element should avoid coercion

archive/issues_017455.json:
```json
{
    "body": "CC:  vdelecroix tscrim\n\nCurrently, the __invert__ methods in element.pyx do\n\n```\n    return 1/self\n```\n\n\nThis results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do\n\n```\n    return self.parent().one_element() / self\n```\n\n\nAdditionally, the __invert__ method in MultiplicativeGroupElement relies on a method is_one() that is not provided by the class itself.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17692\n\n",
    "created_at": "2015-01-29T21:17:18Z",
    "labels": [
        "basic arithmetic",
        "trivial",
        "enhancement"
    ],
    "title": "The default __invert__ method of an element should avoid coercion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17455",
    "user": "Stefan"
}
```
CC:  vdelecroix tscrim

Currently, the __invert__ methods in element.pyx do

```
    return 1/self
```


This results in a coercion of the integer 1 into the appropriate parent structure. Better would be to do

```
    return self.parent().one_element() / self
```


Additionally, the __invert__ method in MultiplicativeGroupElement relies on a method is_one() that is not provided by the class itself.

Issue created by migration from https://trac.sagemath.org/ticket/17692





---

archive/issue_comments_233189.json:
```json
{
    "body": "cc'ing me (+ formatting in the description)",
    "created_at": "2015-01-30T07:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233189",
    "user": "vdelecroix"
}
```

cc'ing me (+ formatting in the description)



---

archive/issue_comments_233190.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-01-31T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233190",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_233191.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-01-31T14:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233191",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_233192.json:
```json
{
    "body": "Why do you add\n\n```\nif self.is_zero():\n    raise ZeroDivisionError(\"division by zero in a ring\")\n```\n\n\nI would say it's the division code which should raise this error, not `__invert__`.",
    "created_at": "2015-02-03T15:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233192",
    "user": "jdemeyer"
}
```

Why do you add

```
if self.is_zero():
    raise ZeroDivisionError("division by zero in a ring")
```


I would say it's the division code which should raise this error, not `__invert__`.



---

archive/issue_comments_233193.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-04T13:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233193",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233194.json:
```json
{
    "body": "Replying to [comment:4 jdemeyer]:\n> Why do you add\n>  ...\n> I would say it's the division code which should raise this error, not `__invert__`.\n\nRight. Removed in the last commit.",
    "created_at": "2015-02-04T13:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233194",
    "user": "vdelecroix"
}
```

Replying to [comment:4 jdemeyer]:
> Why do you add
>  ...
> I would say it's the division code which should raise this error, not `__invert__`.

Right. Removed in the last commit.



---

archive/issue_comments_233195.json:
```json
{
    "body": "\n```\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 463, in sage.structure.coerce.CoercionModel_cache_maps.explain\nFailed example:\n    cm.explain(ZZ['x'], QQ['x'], operator.div)\nExpected:\n    Coercion on left operand via\n        Ring morphism:\n          From: Univariate Polynomial Ring in x over Integer Ring\n          To:   Univariate Polynomial Ring in x over Rational Field\n          Defn: Induced from base ring by\n                Natural morphism:\n                  From: Integer Ring\n                  To:   Rational Field\n    Arithmetic performed after coercions.\n    Result lives in Fraction Field of Univariate Polynomial Ring in x over Rational Field\n    Fraction Field of Univariate Polynomial Ring in x over Rational Field\nGot:\n    Coercion on left operand via\n        Ring morphism:\n          From: Univariate Polynomial Ring in x over Integer Ring\n          To:   Univariate Polynomial Ring in x over Rational Field\n          Defn: Induced from base ring by\n                Natural morphism:\n                  From: Integer Ring\n                  To:   Rational Field\n    Arithmetic performed after coercions.\n    Result lives in Univariate Polynomial Ring in x over Rational Field\n    Univariate Polynomial Ring in x over Rational Field\n**********************************************************************\nFile \"src/sage/structure/coerce.pyx\", line 684, in sage.structure.coerce.CoercionModel_cache_maps.division_parent\nFailed example:\n    cm.division_parent(ZZ['x'])\nExpected:\n    Fraction Field of Univariate Polynomial Ring in x over Integer Ring\nGot:\n    Univariate Polynomial Ring in x over Integer Ring\n**********************************************************************\n```\n\n\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/maxima_abstract.py\", line 2299, in sage.interfaces.maxima_abstract.MaximaAbstractElementFunction.__inv__\nFailed example:\n    ~f\nExpected:\n    1/sin(x)\nGot:\n    one()/sin(x)\n**********************************************************************\n```\n\n\n\n```\n**********************************************************************\nFile \"src/sage/interfaces/r.py\", line 22, in sage.interfaces.r\nFailed example:\n    ~x\nExpected:\n    [1] 0.09615385 0.17857143 0.32258065 0.15625000 0.04608295\nGot:\n    [1] 0 0 0 0 0\n**********************************************************************\n```\n",
    "created_at": "2015-02-05T08:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233195",
    "user": "mmezzarobba"
}
```


```
**********************************************************************
File "src/sage/structure/coerce.pyx", line 463, in sage.structure.coerce.CoercionModel_cache_maps.explain
Failed example:
    cm.explain(ZZ['x'], QQ['x'], operator.div)
Expected:
    Coercion on left operand via
        Ring morphism:
          From: Univariate Polynomial Ring in x over Integer Ring
          To:   Univariate Polynomial Ring in x over Rational Field
          Defn: Induced from base ring by
                Natural morphism:
                  From: Integer Ring
                  To:   Rational Field
    Arithmetic performed after coercions.
    Result lives in Fraction Field of Univariate Polynomial Ring in x over Rational Field
    Fraction Field of Univariate Polynomial Ring in x over Rational Field
Got:
    Coercion on left operand via
        Ring morphism:
          From: Univariate Polynomial Ring in x over Integer Ring
          To:   Univariate Polynomial Ring in x over Rational Field
          Defn: Induced from base ring by
                Natural morphism:
                  From: Integer Ring
                  To:   Rational Field
    Arithmetic performed after coercions.
    Result lives in Univariate Polynomial Ring in x over Rational Field
    Univariate Polynomial Ring in x over Rational Field
**********************************************************************
File "src/sage/structure/coerce.pyx", line 684, in sage.structure.coerce.CoercionModel_cache_maps.division_parent
Failed example:
    cm.division_parent(ZZ['x'])
Expected:
    Fraction Field of Univariate Polynomial Ring in x over Integer Ring
Got:
    Univariate Polynomial Ring in x over Integer Ring
**********************************************************************
```



```
**********************************************************************
File "src/sage/interfaces/maxima_abstract.py", line 2299, in sage.interfaces.maxima_abstract.MaximaAbstractElementFunction.__inv__
Failed example:
    ~f
Expected:
    1/sin(x)
Got:
    one()/sin(x)
**********************************************************************
```



```
**********************************************************************
File "src/sage/interfaces/r.py", line 22, in sage.interfaces.r
Failed example:
    ~x
Expected:
    [1] 0.09615385 0.17857143 0.32258065 0.15625000 0.04608295
Got:
    [1] 0 0 0 0 0
**********************************************************************
```




---

archive/issue_comments_233196.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-05T08:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233196",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_233197.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-05T13:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233197",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233198.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-05T13:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233198",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_233199.json:
```json
{
    "body": "Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?",
    "created_at": "2015-02-05T13:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233199",
    "user": "jdemeyer"
}
```

Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?



---

archive/issue_comments_233200.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-05T13:22:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233200",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_233201.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?\n\nTrue. Will do.",
    "created_at": "2015-02-05T13:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233201",
    "user": "vdelecroix"
}
```

Replying to [comment:10 jdemeyer]:
> Wouldn't it be better to add the `zero()`/`one()` functions in the base class `src/sage/interfaces/interface.py`?

True. Will do.



---

archive/issue_comments_233202.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-05T13:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233202",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_233203.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-02-05T13:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233203",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_233204.json:
```json
{
    "body": "More doctest failures.\n\n\n```\n**********************************************************************\nFile \"src/sage/rings/infinity.py\", line 93, in sage.rings.infinity\nFailed example:\n    unsigned_oo/0\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: unsigned oo times smaller number not defined\nGot:\n      ...\n      File \"sage/structure/coerce.pyx\", line 798, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7153)\n        return PyObject_CallObject(op, xy)\n      File \"sage/structure/element.pyx\", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)\n        return (<RingElement>self)._div_(<RingElement>right)\n      File \"sage/structure/element.pyx\", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)\n        cpdef RingElement _div_(self, RingElement right):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py\", line 458, in _div_\n        return self * ~other\n      File \"sage/structure/element.pyx\", line 2073, in sage.structure.element.RingElement.__invert__ (build/cythonized/sage/structure/element.c:19009)\n        return self._parent.one() / self\n      File \"sage/structure/element.pyx\", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)\n        return (<RingElement>self)._div_(<RingElement>right)\n      File \"sage/structure/element.pyx\", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)\n        cpdef RingElement _div_(self, RingElement right):\n      File \"/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py\", line 814, in _div_\n        raise ValueError(\"quotient of number < oo by number < oo not defined\")\n    ValueError: quotient of number < oo by number < oo not defined\n**********************************************************************\n```\n\n\n\n```\nsage -t --warn-long 30.1 src/sage/schemes/elliptic_curves/formal_group.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/formal_group.py\", line 431, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.inverse\nFailed example:\n    F = E.formal_group().group_law(6)\nException raised:\n    ...\n    TypeError: unsupported operand parent(s) for '*': 'Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Rational Field' and 'Multivariate Polynomial Ring in t1, t2 over Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Integer Ring'\n**********************************************************************\n```\n\n\n\n```\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/formal_group.py\", line 523, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.group_law\nFailed example:\n    F(t1, 0)\nExpected:\n    t1 + O(t1, t2)^5\nGot:\n    t1 + O(t1, t2)^7\n**********************************************************************\n```\n",
    "created_at": "2015-02-05T16:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233204",
    "user": "mmezzarobba"
}
```

More doctest failures.


```
**********************************************************************
File "src/sage/rings/infinity.py", line 93, in sage.rings.infinity
Failed example:
    unsigned_oo/0
Expected:
    Traceback (most recent call last):
    ...
    ValueError: unsigned oo times smaller number not defined
Got:
      ...
      File "sage/structure/coerce.pyx", line 798, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (build/cythonized/sage/structure/coerce.c:7153)
        return PyObject_CallObject(op, xy)
      File "sage/structure/element.pyx", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)
        return (<RingElement>self)._div_(<RingElement>right)
      File "sage/structure/element.pyx", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)
        cpdef RingElement _div_(self, RingElement right):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py", line 458, in _div_
        return self * ~other
      File "sage/structure/element.pyx", line 2073, in sage.structure.element.RingElement.__invert__ (build/cythonized/sage/structure/element.c:19009)
        return self._parent.one() / self
      File "sage/structure/element.pyx", line 2013, in sage.structure.element.RingElement.__div__ (build/cythonized/sage/structure/element.c:18317)
        return (<RingElement>self)._div_(<RingElement>right)
      File "sage/structure/element.pyx", line 2017, in sage.structure.element.RingElement._div_ (build/cythonized/sage/structure/element.c:18420)
        cpdef RingElement _div_(self, RingElement right):
      File "/home/marc/co/sage/local/lib/python2.7/site-packages/sage/rings/infinity.py", line 814, in _div_
        raise ValueError("quotient of number < oo by number < oo not defined")
    ValueError: quotient of number < oo by number < oo not defined
**********************************************************************
```



```
sage -t --warn-long 30.1 src/sage/schemes/elliptic_curves/formal_group.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/formal_group.py", line 431, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.inverse
Failed example:
    F = E.formal_group().group_law(6)
Exception raised:
    ...
    TypeError: unsupported operand parent(s) for '*': 'Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Rational Field' and 'Multivariate Polynomial Ring in t1, t2 over Multivariate Polynomial Ring in a1, a2, a3, a4, a6 over Integer Ring'
**********************************************************************
```



```
**********************************************************************
File "src/sage/schemes/elliptic_curves/formal_group.py", line 523, in sage.schemes.elliptic_curves.formal_group.EllipticCurveFormalGroup.group_law
Failed example:
    F(t1, 0)
Expected:
    t1 + O(t1, t2)^5
Got:
    t1 + O(t1, t2)^7
**********************************************************************
```




---

archive/issue_comments_233205.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-02-05T16:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233205",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_233206.json:
```json
{
    "body": "Hello,\n\nIndeed! The coercion with polynomial is to blame here... see [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/3wduVqhoLWg). Several people fixed some issue locally (e.g. #7711). In order to go further, I need the coercion to be fixed. I will open a subsequent ticket if it is not yet here.\n\nVincent",
    "created_at": "2015-02-05T18:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233206",
    "user": "vdelecroix"
}
```

Hello,

Indeed! The coercion with polynomial is to blame here... see [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/3wduVqhoLWg). Several people fixed some issue locally (e.g. #7711). In order to go further, I need the coercion to be fixed. I will open a subsequent ticket if it is not yet here.

Vincent



---

archive/issue_comments_233207.json:
```json
{
    "body": "I actually propose to close this as \"wontfix\" since we need to get rid of `__invert__` anyway.",
    "created_at": "2016-06-05T08:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233207",
    "user": "jdemeyer"
}
```

I actually propose to close this as "wontfix" since we need to get rid of `__invert__` anyway.



---

archive/issue_comments_233208.json:
```json
{
    "body": "Why? Where?",
    "created_at": "2016-06-05T08:57:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233208",
    "user": "vdelecroix"
}
```

Why? Where?



---

archive/issue_comments_233209.json:
```json
{
    "body": "Well, everywhere really because `__invert__` is supposed to return the bitwise inverse, not the mathematical inverse. It's the whole reason why I came up with the idea of a unary division.",
    "created_at": "2016-06-05T12:28:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233209",
    "user": "jdemeyer"
}
```

Well, everywhere really because `__invert__` is supposed to return the bitwise inverse, not the mathematical inverse. It's the whole reason why I came up with the idea of a unary division.



---

archive/issue_comments_233210.json:
```json
{
    "body": "Closing suggested in #17965#comment:57",
    "created_at": "2022-09-18T02:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233210",
    "user": "mkoeppe"
}
```

Closing suggested in #17965#comment:57



---

archive/issue_comments_233211.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-09-18T02:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233211",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_233212.json:
```json
{
    "body": "Indeed, this seems to have already been done elsewhere.\n\nThere are still a few instances where it does use coercion, but they are all look specific:\n\n```\ntravis@apricot:~/sage-build/src/sage/rings$ grep -R --include \\*.p\\* \"1 */ *self\" ../*\n../manifolds/chart_func.py:            # NB: self._express.__invert__() would return 1/self._express\n../manifolds/chart_func.py:                          expression=self._simplify(1 / self.expr()),\n../modular/overconvergent/weightspace.py:            return 1 / self.Lvalue()\n../modular/local_comp/smoothchar.py:        return self.character(0, [1/self.ideal(1).residue_field().cardinality()])\n../modular/btquotients/pautomorphicform.py:            A = data.parent()._Sigma0(Matrix(QQ,2,2,[0,1/self.prime(),1,0]),check=False)\n../modular/modform_hecketriangle/abstract_ring.py:                d = 1 / self.base_ring()(1/d)\n../modular/modform_hecketriangle/abstract_ring.py:            return   1/self._group.n() * (X*Z-Y) * dX\\\n../modular/modform_hecketriangle/abstract_ring.py:            return - 1/self._group.n() * Y*dX\\\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.x = 1/self.eval_scale.x\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.y = 1/self.eval_scale.y\n../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.z = 1/self.eval_scale.z\n../rings/qqbar.py:        1/self.\n../rings/qqbar.py:        1/self.\n../rings/qqbar.py:        1/self.\n../rings/function_field/order.py:        return 1/self.function_field().gen()\n../rings/function_field/order.py:        return self.ideal( 1/self.function_field().gen() )\n../rings/real_double_element_gsl.pyx:        return 1/self.cosh()\n../rings/real_double_element_gsl.pyx:        return 1/self.sinh()\n../rings/rational_field.py:        yield 1/self.an_element()\n../rings/rational_field.py:        yield -1/self.an_element()\n../rings/puiseux_series_ring_element.pyx:        # use x.nth_root since x**(1/self._e) returns oo when x = 0\nBinary file ../rings/__pycache__/qqbar.cpython-310.pyc matches\n../rings/padics/padic_lattice_element.py:        # dx = -(1/self^2)*dself\n../rings/padics/padic_extension_generic.py:    #    u = 1 / self(1 - q, prec)\n../schemes/riemann_surfaces/riemann_surface.py:                M_tilde = 2*max((m[i].abs())**(1/self._RR(l-i))\n../schemes/cyclic_covers/cycliccover_finite_field.py:        iD = 1 / self._Zq0(D.lift() / self._p)\n../schemes/cyclic_covers/cycliccover_finite_field.py:                    iD = 1 / self._Zq(D.lift() / self._p)\n../schemes/elliptic_curves/padic_lseries.py:                L *= (1-1/self.alpha())**2\n../schemes/elliptic_curves/ell_tate_curve.py:        qE = q_in_terms_of_jinv(R(1 / self._E.j_invariant()))\n../schemes/projective/projective_point.py:        self.scale_by(1/self[index])\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center())\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center(), RR(radius / (self._custom_abs(self.center())**2)))\n../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i]\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0])\n../schemes/berkovich/berkovich_cp_element.py:                return self.parent()(ZZ(0), 1 / self.radius())\n../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0], self.radius() / (self._custom_abs(self.center()[0])**2))\n../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i][0]\n../symbolic/expression.pyx:        return 1/self\n```\n",
    "created_at": "2022-09-18T02:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233212",
    "user": "tscrim"
}
```

Indeed, this seems to have already been done elsewhere.

There are still a few instances where it does use coercion, but they are all look specific:

```
travis@apricot:~/sage-build/src/sage/rings$ grep -R --include \*.p\* "1 */ *self" ../*
../manifolds/chart_func.py:            # NB: self._express.__invert__() would return 1/self._express
../manifolds/chart_func.py:                          expression=self._simplify(1 / self.expr()),
../modular/overconvergent/weightspace.py:            return 1 / self.Lvalue()
../modular/local_comp/smoothchar.py:        return self.character(0, [1/self.ideal(1).residue_field().cardinality()])
../modular/btquotients/pautomorphicform.py:            A = data.parent()._Sigma0(Matrix(QQ,2,2,[0,1/self.prime(),1,0]),check=False)
../modular/modform_hecketriangle/abstract_ring.py:                d = 1 / self.base_ring()(1/d)
../modular/modform_hecketriangle/abstract_ring.py:            return   1/self._group.n() * (X*Z-Y) * dX\
../modular/modform_hecketriangle/abstract_ring.py:            return - 1/self._group.n() * Y*dX\
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.x = 1/self.eval_scale.x
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.y = 1/self.eval_scale.y
../plot/plot3d/implicit_surface.pyx:        self.eval_scale_inv.z = 1/self.eval_scale.z
../rings/qqbar.py:        1/self.
../rings/qqbar.py:        1/self.
../rings/qqbar.py:        1/self.
../rings/function_field/order.py:        return 1/self.function_field().gen()
../rings/function_field/order.py:        return self.ideal( 1/self.function_field().gen() )
../rings/real_double_element_gsl.pyx:        return 1/self.cosh()
../rings/real_double_element_gsl.pyx:        return 1/self.sinh()
../rings/rational_field.py:        yield 1/self.an_element()
../rings/rational_field.py:        yield -1/self.an_element()
../rings/puiseux_series_ring_element.pyx:        # use x.nth_root since x**(1/self._e) returns oo when x = 0
Binary file ../rings/__pycache__/qqbar.cpython-310.pyc matches
../rings/padics/padic_lattice_element.py:        # dx = -(1/self^2)*dself
../rings/padics/padic_extension_generic.py:    #    u = 1 / self(1 - q, prec)
../schemes/riemann_surfaces/riemann_surface.py:                M_tilde = 2*max((m[i].abs())**(1/self._RR(l-i))
../schemes/cyclic_covers/cycliccover_finite_field.py:        iD = 1 / self._Zq0(D.lift() / self._p)
../schemes/cyclic_covers/cycliccover_finite_field.py:                    iD = 1 / self._Zq(D.lift() / self._p)
../schemes/elliptic_curves/padic_lseries.py:                L *= (1-1/self.alpha())**2
../schemes/elliptic_curves/ell_tate_curve.py:        qE = q_in_terms_of_jinv(R(1 / self._E.j_invariant()))
../schemes/projective/projective_point.py:        self.scale_by(1/self[index])
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center())
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center(), RR(radius / (self._custom_abs(self.center())**2)))
../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i]
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0])
../schemes/berkovich/berkovich_cp_element.py:                return self.parent()(ZZ(0), 1 / self.radius())
../schemes/berkovich/berkovich_cp_element.py:            return self.parent()(1 / self.center()[0], self.radius() / (self._custom_abs(self.center()[0])**2))
../schemes/berkovich/berkovich_cp_element.py:                new_center = 1 / self.center()[i][0]
../symbolic/expression.pyx:        return 1/self
```




---

archive/issue_comments_233213.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-18T02:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233213",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_233214.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-11-14T19:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17455",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17455#issuecomment-233214",
    "user": "mkoeppe"
}
```

Resolution: invalid
