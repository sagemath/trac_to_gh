# Issue 13995: Docbuilder changes sagetex.rst

archive/issues_013995.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  @jhpalmieri\n\nInstall sage-5.8.beta2 and build the documentation. Now\n\n```\n$ touch devel/sage/doc/en/reference/misc/sagetex.rst\n$ make doc\n```\nand you will see the following change appear:\n\n```diff\ndiff --git a/doc/en/reference/misc/sagetex.rst b/doc/en/reference/misc/sagetex.rst\n--- a/doc/en/reference/misc/sagetex.rst\n+++ b/doc/en/reference/misc/sagetex.rst\n@@ -1,11 +1,16 @@\n-Installing and using SageTeX\n-============================\n+.. nodoctest\n\n-SageTeX is a system for embedding computations and plots from Sage into\n-LaTeX documents. It is included by default with Sage, so if you have\n-installed Sage, you already have SageTeX. However, to get it to work,\n-you need to make TeX aware of SageTeX. Instructions for that are in the\n-\"Make SageTeX known to TeX\" section of the `Sage installation guide\n-<http://sagemath.org/doc/installation/index.html>`_ (`this link\n-<../../installation/index.html>`_ should take you to a local copy of the\n-installation guide).\n+.. _sagetex:\n+\n+MISSING TITLE\n+=============\n+\n+.. This file has been autogenerated.\n+\n+\n+.. automodule:: sagetex\n+   :members:\n+   :undoc-members:\n+   :show-inheritance:\n+\n+\n```\nIf this an autogenerated file, it should not be tracked by Mercurial. And why did all content get removed?\n\nMaking the file `sagetex.rst` unwritable shows where the file is written:\n\n```\nTraceback (most recent call last):\n  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 45, in build_ref_doc\n    getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)\n  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 662, in _wrapper\n    self.write_auto_rest_file(module_name.replace(os.path.sep, '.'))\n  File \"/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py\", line 924, in write_auto_rest_file\n    outfile = open(filename, 'w')\nIOError: [Errno 13] Permission denied: '/Users/buildbot/sage-5.8.beta2/devel/sage/doc/en/reference/misc/sagetex.rst'\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/14199\n\n",
    "closed_at": "2013-03-07T18:54:00Z",
    "created_at": "2013-02-27T20:22:55Z",
    "labels": [
        "component: documentation",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.8",
    "title": "Docbuilder changes sagetex.rst",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13995",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: mvngu

CC:  @jhpalmieri

Install sage-5.8.beta2 and build the documentation. Now

```
$ touch devel/sage/doc/en/reference/misc/sagetex.rst
$ make doc
```
and you will see the following change appear:

```diff
diff --git a/doc/en/reference/misc/sagetex.rst b/doc/en/reference/misc/sagetex.rst
--- a/doc/en/reference/misc/sagetex.rst
+++ b/doc/en/reference/misc/sagetex.rst
@@ -1,11 +1,16 @@
-Installing and using SageTeX
-============================
+.. nodoctest

-SageTeX is a system for embedding computations and plots from Sage into
-LaTeX documents. It is included by default with Sage, so if you have
-installed Sage, you already have SageTeX. However, to get it to work,
-you need to make TeX aware of SageTeX. Instructions for that are in the
-"Make SageTeX known to TeX" section of the `Sage installation guide
-<http://sagemath.org/doc/installation/index.html>`_ (`this link
-<../../installation/index.html>`_ should take you to a local copy of the
-installation guide).
+.. _sagetex:
+
+MISSING TITLE
+=============
+
+.. This file has been autogenerated.
+
+
+.. automodule:: sagetex
+   :members:
+   :undoc-members:
+   :show-inheritance:
+
+
```
If this an autogenerated file, it should not be tracked by Mercurial. And why did all content get removed?

Making the file `sagetex.rst` unwritable shows where the file is written:

```
Traceback (most recent call last):
  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 45, in build_ref_doc
    getattr(ReferenceSubBuilder(doc, lang), format)(*args, **kwds)
  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 662, in _wrapper
    self.write_auto_rest_file(module_name.replace(os.path.sep, '.'))
  File "/Users/buildbot/sage-5.8.beta2/devel/sage/doc/common/builder.py", line 924, in write_auto_rest_file
    outfile = open(filename, 'w')
IOError: [Errno 13] Permission denied: '/Users/buildbot/sage-5.8.beta2/devel/sage/doc/en/reference/misc/sagetex.rst'
```

Issue created by migration from https://trac.sagemath.org/ticket/14199





---

archive/issue_comments_174473.json:
```json
{
    "body": "I think I may have seen something like this a long time ago, in the early stages of testing #6495, but then I thought it had to do with maybe not deleting the old doc output or something like that. Was this a build from scratch or an upgrade?\n\nI think that the only OS X 10.6 system that I have access to is bsd.math.washington.edu, and I can't reproduce this there, at least after building the docs a few times with a freshly built Sage 5.8.beta2.",
    "created_at": "2013-03-01T04:21:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13995#issuecomment-174473",
    "user": "https://github.com/jhpalmieri"
}
```

I think I may have seen something like this a long time ago, in the early stages of testing #6495, but then I thought it had to do with maybe not deleting the old doc output or something like that. Was this a build from scratch or an upgrade?

I think that the only OS X 10.6 system that I have access to is bsd.math.washington.edu, and I can't reproduce this there, at least after building the docs a few times with a freshly built Sage 5.8.beta2.



---

archive/issue_comments_174474.json:
```json
{
    "body": "Replying to [comment:5 jhpalmieri]:\n> Was this a build from scratch or an upgrade?\n\nI don't remember, it was on a buildbot machine (`bsd.math`), but I guess it was a build from scratch. On `bsd.math` look for `/Users/buildbot/sage-5.8.beta2-14199.tar.bz2` which is a build with this problem.",
    "created_at": "2013-03-01T07:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13995#issuecomment-174474",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 jhpalmieri]:
> Was this a build from scratch or an upgrade?

I don't remember, it was on a buildbot machine (`bsd.math`), but I guess it was a build from scratch. On `bsd.math` look for `/Users/buildbot/sage-5.8.beta2-14199.tar.bz2` which is a build with this problem.



---

archive/issue_comments_174475.json:
```json
{
    "body": "Okay, I think I've figured it out: the problem is that \"sagetex.rst\" starts with \"sage\". See the attached patch.",
    "created_at": "2013-03-06T18:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13995#issuecomment-174475",
    "user": "https://github.com/jhpalmieri"
}
```

Okay, I think I've figured it out: the problem is that "sagetex.rst" starts with "sage". See the attached patch.



---

archive/issue_comments_174476.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-06T18:38:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13995#issuecomment-174476",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_174477.json:
```json
{
    "body": "Maybe you should document better what's the purpose of the condition\n\n```\nif name.startswith('sage' + os.sep):\n```",
    "created_at": "2013-03-06T20:56:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13995#issuecomment-174477",
    "user": "https://github.com/jdemeyer"
}
```

Maybe you should document better what's the purpose of the condition

```
if name.startswith('sage' + os.sep):
```



---

archive/issue_comments_174478.json:
```json
{
    "body": "Attachment [trac_14199.patch](tarball://root/attachments/some-uuid/ticket14199/trac_14199.patch) by @jhpalmieri created at 2013-03-06 23:19:43\n\nI added a comment to try to address your suggestion.",
    "created_at": "2013-03-06T23:19:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13995#issuecomment-174478",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment [trac_14199.patch](tarball://root/attachments/some-uuid/ticket14199/trac_14199.patch) by @jhpalmieri created at 2013-03-06 23:19:43

I added a comment to try to address your suggestion.



---

archive/issue_comments_174479.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-03-07T18:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13995#issuecomment-174479",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed



---

archive/issue_events_040076.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-03-07T18:54:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/13995",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/13995#event-40076"
}
```
