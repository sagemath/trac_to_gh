# Issue 22328: Make "sage_input" for polyhedron objects output the backend used

archive/issues_022328.json:
```json
{
    "body": "CC:  moritz mkoeppe vdelecroix tmonteil chapoton\n\nKeywords: days84, geometry\n\nCurrently, the ` sage_input` function of a Polyhedron object does not provide the backend used.\n\n\n```\n\nsage: P1 = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='normaliz')\nsage: sage_input(P1)\nPolyhedron(base_ring=ZZ, rays=[(1, 1)], vertices=[(0, 1), (1, 0)])\nsage: P2 = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='ppl')\nsage: sage_input(P2)\nPolyhedron(base_ring=ZZ, rays=[(1, 1)], vertices=[(0, 1), (1, 0)])\n\n```\n\n\nIt should be able to give it.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22565\n\n",
    "created_at": "2017-03-10T09:56:45Z",
    "labels": [
        "geometry",
        "major",
        "bug"
    ],
    "title": "Make \"sage_input\" for polyhedron objects output the backend used",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22328",
    "user": "jipilab"
}
```
CC:  moritz mkoeppe vdelecroix tmonteil chapoton

Keywords: days84, geometry

Currently, the ` sage_input` function of a Polyhedron object does not provide the backend used.


```

sage: P1 = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='normaliz')
sage: sage_input(P1)
Polyhedron(base_ring=ZZ, rays=[(1, 1)], vertices=[(0, 1), (1, 0)])
sage: P2 = Polyhedron(vertices = [[1, 0], [0, 1]], rays = [[1, 1]], backend='ppl')
sage: sage_input(P2)
Polyhedron(base_ring=ZZ, rays=[(1, 1)], vertices=[(0, 1), (1, 0)])

```


It should be able to give it.

Issue created by migration from https://trac.sagemath.org/ticket/22565





---

archive/issue_comments_310383.json:
```json
{
    "body": "I agree that we need to have this feature! Perhaps it would make sense to implement a function `get_backend` (like we have in `MixedIntegerLinearProgram`), that returns the `backend` first? (Or perhaps simply call this function `backend`?\n \n\nSo I guess it would be cleanest to store the backend information somehow in `P1._backend`. Should this be done directly in the init of `class Polyhedra_base` in `parent.py`, similar to `P1._ambient_dim`? Or should this rather be done inside each backend class? Or yet elsewhere?\n\nWhat do you think?",
    "created_at": "2017-05-08T20:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310383",
    "user": "moritz"
}
```

I agree that we need to have this feature! Perhaps it would make sense to implement a function `get_backend` (like we have in `MixedIntegerLinearProgram`), that returns the `backend` first? (Or perhaps simply call this function `backend`?
 

So I guess it would be cleanest to store the backend information somehow in `P1._backend`. Should this be done directly in the init of `class Polyhedra_base` in `parent.py`, similar to `P1._ambient_dim`? Or should this rather be done inside each backend class? Or yet elsewhere?

What do you think?



---

archive/issue_comments_310384.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2017-07-07T14:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310384",
    "user": "moritz"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_310385.json:
```json
{
    "body": "Replying to [comment:1 moritz]:\n> I agree that we need to have this feature! Perhaps it would make sense to implement a function `get_backend` (like we have in `MixedIntegerLinearProgram`), that returns the `backend` first? (Or perhaps simply call this function `backend`?\n\n+1 for getting a function `backend`. (I would choose `backend` to make it similar to `base_ring` and further starting with `get_` is annoying when using tab completion. Just to be sure I would look at the naming conventions of Sage, I guess `backend` is better.)  \n>  \n> \n> So I guess it would be cleanest to store the backend information somehow in `P1._backend`. Should this be done directly in the init of `class Polyhedra_base` in `parent.py`, similar to `P1._ambient_dim`? Or should this rather be done inside each backend class? Or yet elsewhere?\n\nOne way to go, since each (backend/base_ring) combination creates a different parent in parent.py would be to create an init function for each of these parents that executes the init of the `Polyhedra_base` and adds an attribute `_backend` on top.\n\nBecause doing it in Polyhedra_base seems to be messy (how to know the backend information at this stage?).",
    "created_at": "2017-07-12T09:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310385",
    "user": "jipilab"
}
```

Replying to [comment:1 moritz]:
> I agree that we need to have this feature! Perhaps it would make sense to implement a function `get_backend` (like we have in `MixedIntegerLinearProgram`), that returns the `backend` first? (Or perhaps simply call this function `backend`?

+1 for getting a function `backend`. (I would choose `backend` to make it similar to `base_ring` and further starting with `get_` is annoying when using tab completion. Just to be sure I would look at the naming conventions of Sage, I guess `backend` is better.)  
>  
> 
> So I guess it would be cleanest to store the backend information somehow in `P1._backend`. Should this be done directly in the init of `class Polyhedra_base` in `parent.py`, similar to `P1._ambient_dim`? Or should this rather be done inside each backend class? Or yet elsewhere?

One way to go, since each (backend/base_ring) combination creates a different parent in parent.py would be to create an init function for each of these parents that executes the init of the `Polyhedra_base` and adds an attribute `_backend` on top.

Because doing it in Polyhedra_base seems to be messy (how to know the backend information at this stage?).



---

archive/issue_comments_310386.json:
```json
{
    "body": "I looked at it again and now think its best to put it in `parent.py.` There a treatment that is analogous to `ambient_dim` and `base_ring` is possible. Please have a look at the patch!\n\nOnce the `backend`-function is approved it will be easy to enhance the `sage_input`-function as requested in the description of the ticket.\n----\nNew commits:",
    "created_at": "2017-07-18T12:08:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310386",
    "user": "moritz"
}
```

I looked at it again and now think its best to put it in `parent.py.` There a treatment that is analogous to `ambient_dim` and `base_ring` is possible. Please have a look at the patch!

Once the `backend`-function is approved it will be easy to enhance the `sage_input`-function as requested in the description of the ticket.
----
New commits:



---

archive/issue_comments_310387.json:
```json
{
    "body": "The backend method looks good. I guess you can proceed with the sage_input part.\n\nThanks!",
    "created_at": "2017-08-22T17:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310387",
    "user": "jipilab"
}
```

The backend method looks good. I guess you can proceed with the sage_input part.

Thanks!



---

archive/issue_comments_310388.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2017-08-22T17:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310388",
    "user": "jipilab"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_310389.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-08-22T20:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310389",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_310390.json:
```json
{
    "body": "I have not (yet) added doctests polymake and (py)normaliz; do you think this is needed?",
    "created_at": "2017-08-22T20:31:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310390",
    "user": "moritz"
}
```

I have not (yet) added doctests polymake and (py)normaliz; do you think this is needed?



---

archive/issue_comments_310391.json:
```json
{
    "body": "Replying to [comment:8 moritz]:\n> I have not (yet) added doctests polymake and (py)normaliz; do you think this is needed?\n\nYes, that would be nice! Especially since they are backends and it's about backends...",
    "created_at": "2017-08-22T21:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310391",
    "user": "jipilab"
}
```

Replying to [comment:8 moritz]:
> I have not (yet) added doctests polymake and (py)normaliz; do you think this is needed?

Yes, that would be nice! Especially since they are backends and it's about backends...



---

archive/issue_comments_310392.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-23T07:32:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310392",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_310393.json:
```json
{
    "body": "I have not tested the polymake doctest, since I don't have polymake installed at the moment. Let's see what the bot says..",
    "created_at": "2017-08-23T07:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310393",
    "user": "moritz"
}
```

I have not tested the polymake doctest, since I don't have polymake installed at the moment. Let's see what the bot says..



---

archive/issue_comments_310394.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-23T07:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310394",
    "user": "moritz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_310395.json:
```json
{
    "body": "> I have not tested the polymake doctest, since I don't have polymake installed at the moment. Let's see what the bot says..\n\nAll right, I'll have a look!",
    "created_at": "2017-08-23T16:00:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310395",
    "user": "jipilab"
}
```

> I have not tested the polymake doctest, since I don't have polymake installed at the moment. Let's see what the bot says..

All right, I'll have a look!



---

archive/issue_comments_310396.json:
```json
{
    "body": "For now, I get:\n\n\n```\nsage -t base.py\n**********************************************************************\nFile \"base.py\", line 171, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_\nFailed example:\n    sage_input(P)                                                                    # optional - polymake\nExpected:\n    Polyhedron(backend='polymake', base_ring=ZZ, rays=[(1, 1)], vertices=[(0, 1), (1, 0)])\nGot:\n    Polyhedron(backend='polymake', base_ring=QQ, rays=[(QQ(1), QQ(1))], vertices=[(QQ(1), QQ(0)), (QQ(0), QQ(1))])\n**********************************************************************\n```\n\n\nIf you don't want to see the `QQ(.)`, there's the option `preparse=False` in `sage_input`.",
    "created_at": "2017-08-23T21:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310396",
    "user": "jipilab"
}
```

For now, I get:


```
sage -t base.py
**********************************************************************
File "base.py", line 171, in sage.geometry.polyhedron.base.Polyhedron_base._sage_input_
Failed example:
    sage_input(P)                                                                    # optional - polymake
Expected:
    Polyhedron(backend='polymake', base_ring=ZZ, rays=[(1, 1)], vertices=[(0, 1), (1, 0)])
Got:
    Polyhedron(backend='polymake', base_ring=QQ, rays=[(QQ(1), QQ(1))], vertices=[(QQ(1), QQ(0)), (QQ(0), QQ(1))])
**********************************************************************
```


If you don't want to see the `QQ(.)`, there's the option `preparse=False` in `sage_input`.



---

archive/issue_comments_310397.json:
```json
{
    "body": "Hi Moritz,\n\nAll tests pass on beta3. It seems to fix the issue with the backend. I put a TODO in the doctest to add handling of the `preparse` option of `sage_input` eventually to get rid of the `QQ` in the output.\n\nLook at the change and if you are happy, you can set it as positive review.\n----\nNew commits:",
    "created_at": "2017-08-23T22:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310397",
    "user": "jipilab"
}
```

Hi Moritz,

All tests pass on beta3. It seems to fix the issue with the backend. I put a TODO in the doctest to add handling of the `preparse` option of `sage_input` eventually to get rid of the `QQ` in the output.

Look at the change and if you are happy, you can set it as positive review.
----
New commits:



---

archive/issue_comments_310398.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-24T08:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310398",
    "user": "moritz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_310399.json:
```json
{
    "body": "thanks for the review, JP!",
    "created_at": "2017-08-24T08:39:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310399",
    "user": "moritz"
}
```

thanks for the review, JP!



---

archive/issue_comments_310400.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-08-27T22:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310400",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_310401.json:
```json
{
    "body": "See the patchbot result",
    "created_at": "2017-08-27T22:24:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310401",
    "user": "vbraun"
}
```

See the patchbot result



---

archive/issue_comments_310402.json:
```json
{
    "body": "It seems that the creation of the associahedron is broken by this code (!?)",
    "created_at": "2017-08-29T12:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310402",
    "user": "jipilab"
}
```

It seems that the creation of the associahedron is broken by this code (!?)



---

archive/issue_comments_310403.json:
```json
{
    "body": "Maybe the backend must be specified in \n\n```\n        associahedron = super(Associahedra, self)._element_constructor_(None, [inequalities, []])\n```\n\nnear the end of src/sage/combinat/root_system/associahedron.py",
    "created_at": "2017-08-29T12:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310403",
    "user": "chapoton"
}
```

Maybe the backend must be specified in 

```
        associahedron = super(Associahedra, self)._element_constructor_(None, [inequalities, []])
```

near the end of src/sage/combinat/root_system/associahedron.py



---

archive/issue_comments_310404.json:
```json
{
    "body": "> Maybe the backend must be specified in \n> {{{\n>         associahedron = super(Associahedra, self)._element_constructor_(None, [inequalities, []])\n> }}}\n> near the end of src/sage/combinat/root_system/associahedron.py\n\nThat does not seem to be enough. I'm puzzled by how to fix this. Now the `__init__` of the polyhedron base class requires 4 arguments. But how to pass this new argument when having a subparent class `Associahedra`.\n\nI changed also line 33 like this:\n\n```\n33     parent = Associahedra(QQ, cartan_type.rank(),'ppl')\n```\n\n\nto get the correct backend. But I still get similar errors. Any cues?",
    "created_at": "2017-08-30T13:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310404",
    "user": "jipilab"
}
```

> Maybe the backend must be specified in 
> {{{
>         associahedron = super(Associahedra, self)._element_constructor_(None, [inequalities, []])
> }}}
> near the end of src/sage/combinat/root_system/associahedron.py

That does not seem to be enough. I'm puzzled by how to fix this. Now the `__init__` of the polyhedron base class requires 4 arguments. But how to pass this new argument when having a subparent class `Associahedra`.

I changed also line 33 like this:

```
33     parent = Associahedra(QQ, cartan_type.rank(),'ppl')
```


to get the correct backend. But I still get similar errors. Any cues?



---

archive/issue_comments_310405.json:
```json
{
    "body": "Here is a tentative that works.. Maybe Travis would find a better way ?\n----\nNew commits:",
    "created_at": "2017-08-30T14:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310405",
    "user": "chapoton"
}
```

Here is a tentative that works.. Maybe Travis would find a better way ?
----
New commits:



---

archive/issue_comments_310406.json:
```json
{
    "body": "Oh, I see! But isn't this a bit weird considering the fact that the class `Associahedra` inherits from `Polyhedra_QQ_ppl`?",
    "created_at": "2017-08-30T14:53:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310406",
    "user": "jipilab"
}
```

Oh, I see! But isn't this a bit weird considering the fact that the class `Associahedra` inherits from `Polyhedra_QQ_ppl`?



---

archive/issue_comments_310407.json:
```json
{
    "body": "I think it is a bad idea in the first place to have a class such as `Associahedron_class` inherit from a particular polyhedron backend class.",
    "created_at": "2017-08-30T16:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310407",
    "user": "mkoeppe"
}
```

I think it is a bad idea in the first place to have a class such as `Associahedron_class` inherit from a particular polyhedron backend class.



---

archive/issue_comments_310408.json:
```json
{
    "body": "The bot seems to like the hack.\n\nPerhaps as a follow-up, it would be good to change the inheritance of the `Associahedron_class` to `Polyhedra` ? What do you think?\n\nOtherwise, as of now, I would put this ticket as positive review.",
    "created_at": "2017-09-01T10:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310408",
    "user": "jipilab"
}
```

The bot seems to like the hack.

Perhaps as a follow-up, it would be good to change the inheritance of the `Associahedron_class` to `Polyhedra` ? What do you think?

Otherwise, as of now, I would put this ticket as positive review.



---

archive/issue_comments_310409.json:
```json
{
    "body": "`TODO::`\nshould be\n`.. TODO::`\nOtherwise, looks good to me",
    "created_at": "2017-09-02T06:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310409",
    "user": "chapoton"
}
```

`TODO::`
should be
`.. TODO::`
Otherwise, looks good to me



---

archive/issue_comments_310410.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-09-11T10:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310410",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_310411.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-11T10:07:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310411",
    "user": "moritz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_310412.json:
```json
{
    "body": "This looks good to go. The last bot gave a green light.",
    "created_at": "2017-09-19T15:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310412",
    "user": "jipilab"
}
```

This looks good to go. The last bot gave a green light.



---

archive/issue_comments_310413.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-19T15:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310413",
    "user": "jipilab"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_310414.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-20T22:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22328#issuecomment-310414",
    "user": "vbraun"
}
```

Resolution: fixed
