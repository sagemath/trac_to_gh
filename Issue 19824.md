# Issue 19824: Add method for finding all perfect matchings to Graph

archive/issues_019824.json:
```json
{
    "body": "CC:  tscrim ncohen\n\nKeywords: perfect matching, graph\n\nAdd a method for finding all perfect matchings to `Graph` using the following algorithm:\nChoose a vertex v, then recurse through all edges incident to v, removing one edge at a time whenever an edge is added to a matching.\n \ncode in progress\n\nIssue created by migration from https://trac.sagemath.org/ticket/20061\n\n",
    "created_at": "2016-02-16T05:39:37Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "enhancement"
    ],
    "title": "Add method for finding all perfect matchings to Graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19824",
    "user": "egunawan"
}
```
CC:  tscrim ncohen

Keywords: perfect matching, graph

Add a method for finding all perfect matchings to `Graph` using the following algorithm:
Choose a vertex v, then recurse through all edges incident to v, removing one edge at a time whenever an edge is added to a matching.
 
code in progress

Issue created by migration from https://trac.sagemath.org/ticket/20061





---

archive/issue_comments_272462.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2016-02-16T15:44:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272462",
    "user": "tscrim"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_272463.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-02-17T22:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272463",
    "user": "egunawan"
}
```

New commits:



---

archive/issue_comments_272464.json:
```json
{
    "body": "Hello,\n\nSome remarks:\n\n- You will notice that all methods in graph.py are decorated with `doc_index`, which makes them appear in the index of functions of that file. As it is missing in your branch, I expect that your function appears in the 'uncategorized' section of this table.\n\n- The function will appear in this index of function, and the style of its description is a bit at odds with others: we usually have something like 'returns an interator over the perfect matchings of the graph'. Note that in the context of this table, 'self' does not appear anywhere.\n\n- In order to test whether a graph is empty, you can do `if G`. What you do is build the list of vertices and throw it away at every call of the function, uselessly.\n\n- You build the list a second time to pick `v`, to throw everything away except its first element. You would achieve the same with `v = next(self.vertex_iterator())`.\n\nNathann",
    "created_at": "2016-02-17T22:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272464",
    "user": "ncohen"
}
```

Hello,

Some remarks:

- You will notice that all methods in graph.py are decorated with `doc_index`, which makes them appear in the index of functions of that file. As it is missing in your branch, I expect that your function appears in the 'uncategorized' section of this table.

- The function will appear in this index of function, and the style of its description is a bit at odds with others: we usually have something like 'returns an interator over the perfect matchings of the graph'. Note that in the context of this table, 'self' does not appear anywhere.

- In order to test whether a graph is empty, you can do `if G`. What you do is build the list of vertices and throw it away at every call of the function, uselessly.

- You build the list a second time to pick `v`, to throw everything away except its first element. You would achieve the same with `v = next(self.vertex_iterator())`.

Nathann



---

archive/issue_comments_272465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-18T04:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272465",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272466.json:
```json
{
    "body": "Hello again,\n\n- You chose 'basic methods' for your new method but counting matchings is not basic at all. The `.matching` method, in particular, is in the 'leftovers' section.\n\n- You can write a check of your method using the `matching_polynomial` methods which counts the number of matchings. It will also give you the number of perfect matchings.\n\n- Your method probably fails on a graph like `graphs.PetersenGraph().copy(immutable=True)`.\n\n- I discussed with Travis the advantages of checking (with `.matching()`) that the graph actually contains a perfect matching before recursing. Is there a reason why you decided against it ?\n\n- If you want to, you can optionally add SEEALSO sections to/from the other matching-related methods:\n  http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings\n\n- Please set your ticket to `needs_review` when you are done with your changes and want somebody to look at your code.\n\nNathann",
    "created_at": "2016-02-18T09:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272466",
    "user": "ncohen"
}
```

Hello again,

- You chose 'basic methods' for your new method but counting matchings is not basic at all. The `.matching` method, in particular, is in the 'leftovers' section.

- You can write a check of your method using the `matching_polynomial` methods which counts the number of matchings. It will also give you the number of perfect matchings.

- Your method probably fails on a graph like `graphs.PetersenGraph().copy(immutable=True)`.

- I discussed with Travis the advantages of checking (with `.matching()`) that the graph actually contains a perfect matching before recursing. Is there a reason why you decided against it ?

- If you want to, you can optionally add SEEALSO sections to/from the other matching-related methods:
  http://doc.sagemath.org/html/en/developer/coding_basics.html#documentation-strings

- Please set your ticket to `needs_review` when you are done with your changes and want somebody to look at your code.

Nathann



---

archive/issue_comments_272467.json:
```json
{
    "body": "Oh, and another 'optional' thing: many functions which return edges or list of edges have a `labels=True/False` optional argument to tell whether you want the edges to be pairs or triples (containing the label). This could be done here too if you want.\n\n\n```\nsage: g = graphs.PetersenGraph()\nsage: g.edges_incident(0,labels=False)\n[(0, 1), (0, 4), (0, 5)]\nsage: g.edges_incident(0,labels=True)\n[(0, 1, None), (0, 4, None), (0, 5, None)]\n```\n\n\nNathann",
    "created_at": "2016-02-18T09:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272467",
    "user": "ncohen"
}
```

Oh, and another 'optional' thing: many functions which return edges or list of edges have a `labels=True/False` optional argument to tell whether you want the edges to be pairs or triples (containing the label). This could be done here too if you want.


```
sage: g = graphs.PetersenGraph()
sage: g.edges_incident(0,labels=False)
[(0, 1), (0, 4), (0, 5)]
sage: g.edges_incident(0,labels=True)
[(0, 1, None), (0, 4, None), (0, 5, None)]
```


Nathann



---

archive/issue_comments_272468.json:
```json
{
    "body": "Replying to [comment:6 ncohen]:\n> - Your method probably fails on a graph like `graphs.PetersenGraph().copy(immutable=True)`.\n\nAh, right; copying an immutable graph does nothing. Emily, you need `Gp = self.copy(immutable=False)`. Could you also add a test against immutable graphs?\n\n> - I discussed with Travis the advantages of checking (with `.matching()`) that the graph actually contains a perfect matching before recursing. Is there a reason why you decided against it ?\n\nThis is my fault; I had forgotten to mention this to her. How rare would you say it is that a graph does not have a perfect matching but each connected component has an even number of vertices?",
    "created_at": "2016-02-18T14:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272468",
    "user": "tscrim"
}
```

Replying to [comment:6 ncohen]:
> - Your method probably fails on a graph like `graphs.PetersenGraph().copy(immutable=True)`.

Ah, right; copying an immutable graph does nothing. Emily, you need `Gp = self.copy(immutable=False)`. Could you also add a test against immutable graphs?

> - I discussed with Travis the advantages of checking (with `.matching()`) that the graph actually contains a perfect matching before recursing. Is there a reason why you decided against it ?

This is my fault; I had forgotten to mention this to her. How rare would you say it is that a graph does not have a perfect matching but each connected component has an even number of vertices?



---

archive/issue_comments_272469.json:
```json
{
    "body": "Yo,\n\n> Ah, right; copying an immutable graph does nothing. Emily, you need `Gp = self.copy(immutable=False)`. Could you also add a test against immutable graphs?\n\n`copy(a_graph)` does what you want, though it is less explicit. Volker insisted that `copy(something)` should always be mutable, while I insisted that `copy(a_graph)` should not take 3Gig in memory if `a_graph` only takes 100Mo.\n\nLife.\n\n> This is my fault; I had forgotten to mention this to her. How rare would you say it is that a graph does not have a perfect matching but each connected component has an even number of vertices?\n\n\"Depends on the graphs\", but truth is that I don't know. Give it a try, see how bad it is, and if you really don't know this can become another optional test. Well, do the smart/responsible thing, as always.\n\nNathann",
    "created_at": "2016-02-18T14:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272469",
    "user": "ncohen"
}
```

Yo,

> Ah, right; copying an immutable graph does nothing. Emily, you need `Gp = self.copy(immutable=False)`. Could you also add a test against immutable graphs?

`copy(a_graph)` does what you want, though it is less explicit. Volker insisted that `copy(something)` should always be mutable, while I insisted that `copy(a_graph)` should not take 3Gig in memory if `a_graph` only takes 100Mo.

Life.

> This is my fault; I had forgotten to mention this to her. How rare would you say it is that a graph does not have a perfect matching but each connected component has an even number of vertices?

"Depends on the graphs", but truth is that I don't know. Give it a try, see how bad it is, and if you really don't know this can become another optional test. Well, do the smart/responsible thing, as always.

Nathann



---

archive/issue_comments_272470.json:
```json
{
    "body": "In regards to `.matching()`, it seems like the method returns a maximum matching that is not necessary a perfect matching. For example,\n\n```\nsage: Graph([[1,2],[2,3]]).matching()\n[(2, 3, None)]\n```\n",
    "created_at": "2016-02-21T06:33:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272470",
    "user": "egunawan"
}
```

In regards to `.matching()`, it seems like the method returns a maximum matching that is not necessary a perfect matching. For example,

```
sage: Graph([[1,2],[2,3]]).matching()
[(2, 3, None)]
```




---

archive/issue_comments_272471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-21T18:01:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272471",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-21T21:30:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272472",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272473.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-21T21:31:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272473",
    "user": "egunawan"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_272474.json:
```json
{
    "body": "Hello again,\n\nSeveral comments:\n\n- You *can* (if you prefer) exchange a '\\' character at the end of the line against parentheses, e.g.\n\n```\nsage: (1+\n....: 1)\n2\n```\n\n\n- Instead of `if labels` you can simplify your code by doing this:\n\n```diff\n-for e in self.edges_incident(v):\n+for e in self.edges_incident(v,labels=labels):\n```\n\n\n- Did you reach a decision about the subcall to `.matching()`?\n\nNathann",
    "created_at": "2016-02-22T10:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272474",
    "user": "ncohen"
}
```

Hello again,

Several comments:

- You *can* (if you prefer) exchange a '\' character at the end of the line against parentheses, e.g.

```
sage: (1+
....: 1)
2
```


- Instead of `if labels` you can simplify your code by doing this:

```diff
-for e in self.edges_incident(v):
+for e in self.edges_incident(v,labels=labels):
```


- Did you reach a decision about the subcall to `.matching()`?

Nathann



---

archive/issue_comments_272475.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-02-22T10:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272475",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_272476.json:
```json
{
    "body": "I will make changes in regards to the first two bullet points above.\n\nIn regards to `.matching()`, it seems like the method returns a maximum matching that is not necessarily a perfect matching. For example,\n\n```\nsage: Graph([[1,2],[2,3]]).matching()\n[(2, 3, None)]\n```\n\nCould you comment on this?",
    "created_at": "2016-02-22T21:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272476",
    "user": "egunawan"
}
```

I will make changes in regards to the first two bullet points above.

In regards to `.matching()`, it seems like the method returns a maximum matching that is not necessarily a perfect matching. For example,

```
sage: Graph([[1,2],[2,3]]).matching()
[(2, 3, None)]
```

Could you comment on this?



---

archive/issue_comments_272477.json:
```json
{
    "body": "Hello,\n\n> In regards to `.matching()`, it seems like the method returns a maximum matching that is not necessarily a perfect matching. For example,\n> {{{\n> sage: Graph([[1,2],[2,3]]).matching()\n> [(2, 3, None)]\n> }}}\n> Could you comment on this?\n\nThe `.matching()` function returns a largest matching, not necessarily perfect matching. Just test the size of the matching it returns.\n\nUnfortunately, I decided to stop contributing to Sage a couple of hours ago. I wish you good luck.\n\nRegards,\n\nNathann",
    "created_at": "2016-02-22T21:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272477",
    "user": "ncohen"
}
```

Hello,

> In regards to `.matching()`, it seems like the method returns a maximum matching that is not necessarily a perfect matching. For example,
> {{{
> sage: Graph([[1,2],[2,3]]).matching()
> [(2, 3, None)]
> }}}
> Could you comment on this?

The `.matching()` function returns a largest matching, not necessarily perfect matching. Just test the size of the matching it returns.

Unfortunately, I decided to stop contributing to Sage a couple of hours ago. I wish you good luck.

Regards,

Nathann



---

archive/issue_comments_272478.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-28T22:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272478",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_272479.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-02-28T23:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272479",
    "user": "egunawan"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_272480.json:
```json
{
    "body": "I made a few changes and tweaks. If you're happy when them, go ahead and set a positive review. (Don't forget to add your name to the authors field.)\n----\nNew commits:",
    "created_at": "2016-02-28T23:56:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272480",
    "user": "tscrim"
}
```

I made a few changes and tweaks. If you're happy when them, go ahead and set a positive review. (Don't forget to add your name to the authors field.)
----
New commits:



---

archive/issue_comments_272481.json:
```json
{
    "body": "Thank you!\nWhat is the benefit of adding `return` here?\n\n```\nif not self:\n    yield []\n    return\n```\n",
    "created_at": "2016-02-29T06:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272481",
    "user": "egunawan"
}
```

Thank you!
What is the benefit of adding `return` here?

```
if not self:
    yield []
    return
```




---

archive/issue_comments_272482.json:
```json
{
    "body": "The `return` is there to signify that this should result in no more iterations. I changed it from the if/else flow you had because I think this is easier to understand code (but that is more stylistic and debatable).",
    "created_at": "2016-02-29T06:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272482",
    "user": "tscrim"
}
```

The `return` is there to signify that this should result in no more iterations. I changed it from the if/else flow you had because I think this is easier to understand code (but that is more stylistic and debatable).



---

archive/issue_comments_272483.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-29T06:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272483",
    "user": "egunawan"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_272484.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-03-01T00:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19824",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19824#issuecomment-272484",
    "user": "vbraun"
}
```

Resolution: fixed
