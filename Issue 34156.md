# Issue 34156: add method "components" to tensor products

archive/issues_034156.json:
```json
{
    "body": "CC:  @tscrim\n\nso that one can easily access them\n\nIssue created by migration from https://trac.sagemath.org/ticket/34393\n\n",
    "created_at": "2022-08-20T10:05:47Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "add method \"components\" to tensor products",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34156",
    "user": "https://github.com/fchapoton"
}
```
CC:  @tscrim

so that one can easily access them

Issue created by migration from https://trac.sagemath.org/ticket/34393





---

archive/issue_comments_484124.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-20T10:06:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484124",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_484125.json:
```json
{
    "body": "meeting an unexpected issue with Schur algebras.. to be investigated",
    "created_at": "2022-08-20T15:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484125",
    "user": "https://github.com/fchapoton"
}
```

meeting an unexpected issue with Schur algebras.. to be investigated



---

archive/issue_comments_484126.json:
```json
{
    "body": "\n```\n+            def construction(self):\n...\n+                return [tensor, *self._reduction[1]]\n```\n\n\nThis can't possibly be correct code to be included in the category. `_reduction` is set by `UniqueRepresentation`, so it's under control of implementation classes, not the category",
    "created_at": "2022-08-20T15:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484126",
    "user": "https://github.com/mkoeppe"
}
```


```
+            def construction(self):
...
+                return [tensor, *self._reduction[1]]
```


This can't possibly be correct code to be included in the category. `_reduction` is set by `UniqueRepresentation`, so it's under control of implementation classes, not the category



---

archive/issue_comments_484127.json:
```json
{
    "body": "Replying to [comment:3 mkoeppe]:\n> {{{\n> +            def construction(self):\n> ...\n> +                return [tensor, *self._reduction[1]]\n> }}}\n> \n> This can't possibly be correct code to be included in the category. `_reduction` is set by `UniqueRepresentation`, so it's under control of implementation classes, not the category\n\nok, right. Any better idea ? My final aim would be to have tensor products of morphisms..",
    "created_at": "2022-08-21T07:04:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484127",
    "user": "https://github.com/fchapoton"
}
```

Replying to [comment:3 mkoeppe]:
> {{{
> +            def construction(self):
> ...
> +                return [tensor, *self._reduction[1]]
> }}}
> 
> This can't possibly be correct code to be included in the category. `_reduction` is set by `UniqueRepresentation`, so it's under control of implementation classes, not the category

ok, right. Any better idea ? My final aim would be to have tensor products of morphisms..



---

archive/issue_comments_484128.json:
```json
{
    "body": "No better idea than having `CombinatorialFreeModule_Tensor.__init__` (or other implementation classes) save the info that you need",
    "created_at": "2022-08-21T07:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484128",
    "user": "https://github.com/mkoeppe"
}
```

No better idea than having `CombinatorialFreeModule_Tensor.__init__` (or other implementation classes) save the info that you need



---

archive/issue_comments_484129.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-21T15:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484130.json:
```json
{
    "body": "The information seems to be stored in `_sets`. Let us try.",
    "created_at": "2022-08-21T15:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484130",
    "user": "https://github.com/fchapoton"
}
```

The information seems to be stored in `_sets`. Let us try.



---

archive/issue_comments_484131.json:
```json
{
    "body": "That's an implementation detail, so I think the method `components` should be ``@`abstract_method(optional=True)` in the category, and the implementation should go to `CombinatorialFreeModule_Tensor`",
    "created_at": "2022-08-21T16:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484131",
    "user": "https://github.com/mkoeppe"
}
```

That's an implementation detail, so I think the method `components` should be ``@`abstract_method(optional=True)` in the category, and the implementation should go to `CombinatorialFreeModule_Tensor`



---

archive/issue_comments_484132.json:
```json
{
    "body": "Also the method name is not specific enough. How about `tensor_factors` (this mirrors `cartesian_factors`, which is already in use?",
    "created_at": "2022-08-21T16:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484132",
    "user": "https://github.com/mkoeppe"
}
```

Also the method name is not specific enough. How about `tensor_factors` (this mirrors `cartesian_factors`, which is already in use?



---

archive/issue_comments_484133.json:
```json
{
    "body": "And this can be moved to a larger category - at least to `FreeModules`, where it would apply to `sage.tensor.modules.tensor_free_module.TensorFreeModule`",
    "created_at": "2022-08-21T16:18:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484133",
    "user": "https://github.com/mkoeppe"
}
```

And this can be moved to a larger category - at least to `FreeModules`, where it would apply to `sage.tensor.modules.tensor_free_module.TensorFreeModule`



---

archive/issue_comments_484134.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-21T16:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484134",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484135.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> And this can be moved to a larger category - at least to `FreeModules`, where it would apply to `sage.tensor.modules.tensor_free_module.TensorFreeModule`\n\nMake that `Modules`. (The category `FreeModules` only exists on my wishlist - #30164 - not in code.)",
    "created_at": "2022-08-21T17:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484135",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 mkoeppe]:
> And this can be moved to a larger category - at least to `FreeModules`, where it would apply to `sage.tensor.modules.tensor_free_module.TensorFreeModule`

Make that `Modules`. (The category `FreeModules` only exists on my wishlist - #30164 - not in code.)



---

archive/issue_comments_484136.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-21T17:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484136",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_484137.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-21T18:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_484138.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> That's an implementation detail, so I think the method `components` should be ``@`abstract_method(optional=True)` in the category, and the implementation should go to `CombinatorialFreeModule_Tensor`\n\nI would actually go one step further and make it explicitly an ``@`abstract_method` like `Sets().CartesianProducts()` does with `cartesian_factors()`. Then you could implement\n\n```python\ndef construction(self):\n   return (TensorProductFunctor(self.category()), self.tensor_factors())\n```\n\nagain following `Sets().CartesianProducts()`.",
    "created_at": "2022-08-22T00:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484138",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:8 mkoeppe]:
> That's an implementation detail, so I think the method `components` should be ``@`abstract_method(optional=True)` in the category, and the implementation should go to `CombinatorialFreeModule_Tensor`

I would actually go one step further and make it explicitly an ``@`abstract_method` like `Sets().CartesianProducts()` does with `cartesian_factors()`. Then you could implement

```python
def construction(self):
   return (TensorProductFunctor(self.category()), self.tensor_factors())
```

again following `Sets().CartesianProducts()`.



---

archive/issue_comments_484139.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-22T06:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484140.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-22T11:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484141.json:
```json
{
    "body": "\n```\n+                sage: F = CombinatorialFreeModule(ZZ, [1,2])\n+                sage: F.__custom_name = \"F\"\n+                sage: G = CombinatorialFreeModule(ZZ, [3,4])\n+                sage: G.__custom_name = \"G\"\n```\n\nIs there a reason why you don't use `F.rename(\"F\")` here?",
    "created_at": "2022-08-22T16:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484141",
    "user": "https://github.com/mkoeppe"
}
```


```
+                sage: F = CombinatorialFreeModule(ZZ, [1,2])
+                sage: F.__custom_name = "F"
+                sage: G = CombinatorialFreeModule(ZZ, [3,4])
+                sage: G.__custom_name = "G"
```

Is there a reason why you don't use `F.rename("F")` here?



---

archive/issue_comments_484142.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-22T16:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484142",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484143.json:
```json
{
    "body": "Replying to [comment:16 tscrim]:\n> I would actually go one step further and make it explicitly an ``@`abstract_method`\n\nDoes adding a required method to the category not have the potential of breaking user code?",
    "created_at": "2022-08-22T22:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484143",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:16 tscrim]:
> I would actually go one step further and make it explicitly an ``@`abstract_method`

Does adding a required method to the category not have the potential of breaking user code?



---

archive/issue_comments_484144.json:
```json
{
    "body": "I would suggest some `try... except NotImplementError: deprecation(...)`",
    "created_at": "2022-08-22T22:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484144",
    "user": "https://github.com/mkoeppe"
}
```

I would suggest some `try... except NotImplementError: deprecation(...)`



---

archive/issue_comments_484145.json:
```json
{
    "body": "Replying to [comment:21 mkoeppe]:\n> Replying to [comment:16 tscrim]:\n> > I would actually go one step further and make it explicitly an ``@`abstract_method`\n> \n> Does adding a required method to the category not have the potential of breaking user code?\n\nIt won't break any user code. Only one of the `TestSuite` tests will fail.",
    "created_at": "2022-08-23T01:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484145",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:21 mkoeppe]:
> Replying to [comment:16 tscrim]:
> > I would actually go one step further and make it explicitly an ``@`abstract_method`
> 
> Does adding a required method to the category not have the potential of breaking user code?

It won't break any user code. Only one of the `TestSuite` tests will fail.



---

archive/issue_comments_484146.json:
```json
{
    "body": "Care to explain why errors raised by `construction` would not matter?",
    "created_at": "2022-08-23T01:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484146",
    "user": "https://github.com/mkoeppe"
}
```

Care to explain why errors raised by `construction` would not matter?



---

archive/issue_comments_484147.json:
```json
{
    "body": "Replying to [comment:24 mkoeppe]:\n> Care to explain why errors raised by `construction` would not matter?\n\nIt was just using the default previously, so it was a no-op. However, you should still get failures where you had failures before (such as trying to do a coercion via a pushout) unless someone was explicitly calling `construction()` and checking against `None`. It is possible someone is doing this with a custom class in the tensor product category, so they will have to fix their code. However, the error message will be clear about what needs to be done to fix it. Their could would break in a different way when using Sage's classes (e.g., `CFM_tensor`).\n\nAdditionally, you would still get errors whether or not it was `optional=True` or not.\n\nI think by putting a `try`-`except` block around it with a deprecation message (which nothing is being deprecated), you are increasing Sage's technical debt for people who are doing something fairly advanced and likely should know better than to do this.",
    "created_at": "2022-08-23T01:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484147",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:24 mkoeppe]:
> Care to explain why errors raised by `construction` would not matter?

It was just using the default previously, so it was a no-op. However, you should still get failures where you had failures before (such as trying to do a coercion via a pushout) unless someone was explicitly calling `construction()` and checking against `None`. It is possible someone is doing this with a custom class in the tensor product category, so they will have to fix their code. However, the error message will be clear about what needs to be done to fix it. Their could would break in a different way when using Sage's classes (e.g., `CFM_tensor`).

Additionally, you would still get errors whether or not it was `optional=True` or not.

I think by putting a `try`-`except` block around it with a deprecation message (which nothing is being deprecated), you are increasing Sage's technical debt for people who are doing something fairly advanced and likely should know better than to do this.



---

archive/issue_comments_484148.json:
```json
{
    "body": "Of course something is getting deprecated, namely implementation classes in this category that do not define the `tensor_factors` method.",
    "created_at": "2022-08-23T01:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484148",
    "user": "https://github.com/mkoeppe"
}
```

Of course something is getting deprecated, namely implementation classes in this category that do not define the `tensor_factors` method.



---

archive/issue_comments_484149.json:
```json
{
    "body": "Replying to [comment:25 tscrim]:\n> Additionally, you would still get errors whether or not it was `optional=True` or not.\n\ncomment:22 has a solution",
    "created_at": "2022-08-23T01:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484149",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:25 tscrim]:
> Additionally, you would still get errors whether or not it was `optional=True` or not.

comment:22 has a solution



---

archive/issue_comments_484150.json:
```json
{
    "body": "Replying to [comment:26 mkoeppe]:\n> Of course something is getting deprecated, namely implementation classes in this category that do not define the `tensor_factors` method.\n\nNo, they are not, as a deprecation (in software) means something that is going to be removed. They simply need to be patched.",
    "created_at": "2022-08-23T02:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484150",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:26 mkoeppe]:
> Of course something is getting deprecated, namely implementation classes in this category that do not define the `tensor_factors` method.

No, they are not, as a deprecation (in software) means something that is going to be removed. They simply need to be patched.



---

archive/issue_comments_484151.json:
```json
{
    "body": "Yes, and that \"something\" is the support for such user-defined implementation classes.",
    "created_at": "2022-08-23T02:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484151",
    "user": "https://github.com/mkoeppe"
}
```

Yes, and that "something" is the support for such user-defined implementation classes.



---

archive/issue_comments_484152.json:
```json
{
    "body": "Fine. The nomenclature isn't a hill I am willing to die on.\n\nHowever, I still am not completely convinced not breaking backwards compatibility is worth the technical debt in this case. (I originally wanted to use the pun \"we should bend over backwards for backwards compatibility\" but that is just a bit too dramatic.) Since the solution here is relatively simple, I can let it pass. (If I wanted to be really nit-picky, I would also insist on consistency/equality and require letting people know about the behavior change for `CFM_tensor` as that could break people's code is much more subtle ways. Both things are basically [spacebars](https://xkcd.com/1172/) to me.)\n\nSide note: comment:22 is not a solution for ``@`abstract_method(optional=True)` simply becomes a `NotImplemented`:\n\n```\nsage: class Foo():\n....:     @abstract_method(optional=True)\n....:     def bar(self):\n....:         \"\"\"\n....:         doc\n....:         \"\"\"\n....:         \nsage: F = Foo()\nsage: F.bar\nNotImplemented\n```\n",
    "created_at": "2022-08-23T02:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484152",
    "user": "https://github.com/tscrim"
}
```

Fine. The nomenclature isn't a hill I am willing to die on.

However, I still am not completely convinced not breaking backwards compatibility is worth the technical debt in this case. (I originally wanted to use the pun "we should bend over backwards for backwards compatibility" but that is just a bit too dramatic.) Since the solution here is relatively simple, I can let it pass. (If I wanted to be really nit-picky, I would also insist on consistency/equality and require letting people know about the behavior change for `CFM_tensor` as that could break people's code is much more subtle ways. Both things are basically [spacebars](https://xkcd.com/1172/) to me.)

Side note: comment:22 is not a solution for ``@`abstract_method(optional=True)` simply becomes a `NotImplemented`:

```
sage: class Foo():
....:     @abstract_method(optional=True)
....:     def bar(self):
....:         """
....:         doc
....:         """
....:         
sage: F = Foo()
sage: F.bar
NotImplemented
```




---

archive/issue_comments_484153.json:
```json
{
    "body": "(untested)\n----\nNew commits:",
    "created_at": "2022-08-23T02:54:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484153",
    "user": "https://github.com/mkoeppe"
}
```

(untested)
----
New commits:



---

archive/issue_comments_484154.json:
```json
{
    "body": "Replying to [comment:25 tscrim]:\n> I think by putting a `try`-`except` block around it with a deprecation message (which nothing is being deprecated), you are increasing Sage's technical debt [...]\n\n\"Technical debt\" is a big scary word. But no, doing proper deprecation does not add to the debt.",
    "created_at": "2022-08-23T03:00:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484154",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:25 tscrim]:
> I think by putting a `try`-`except` block around it with a deprecation message (which nothing is being deprecated), you are increasing Sage's technical debt [...]

"Technical debt" is a big scary word. But no, doing proper deprecation does not add to the debt.



---

archive/issue_comments_484155.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-08-23T03:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_484156.json:
```json
{
    "body": "Am I missing something or should this go to `Modules.TensorProducts`, not `Modules.FiniteDimensional.TensorProducts`?",
    "created_at": "2022-08-23T03:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484156",
    "user": "https://github.com/mkoeppe"
}
```

Am I missing something or should this go to `Modules.TensorProducts`, not `Modules.FiniteDimensional.TensorProducts`?



---

archive/issue_comments_484157.json:
```json
{
    "body": "Also, maybe instead of just requiring the method `tensor_factors`, how about specifying a method just like `CombinatorialFreeModule.tensor_constructor`?\n\nFrom its domain, the tensor factors can be read off.",
    "created_at": "2022-08-23T07:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484157",
    "user": "https://github.com/mkoeppe"
}
```

Also, maybe instead of just requiring the method `tensor_factors`, how about specifying a method just like `CombinatorialFreeModule.tensor_constructor`?

From its domain, the tensor factors can be read off.



---

archive/issue_comments_484158.json:
```json
{
    "body": "trying to move code around to Modules.TensorProducts\n----\nNew commits:",
    "created_at": "2022-08-23T09:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484158",
    "user": "https://github.com/fchapoton"
}
```

trying to move code around to Modules.TensorProducts
----
New commits:



---

archive/issue_comments_484159.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-23T13:50:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484159",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484160.json:
```json
{
    "body": "there remains an issue in `sage.algebras.schur_algebra.SchurTensorModule`\n\nEDIT:\n\nwhich is strangely inheriting directly\n\n```\nclass SchurTensorModule(CombinatorialFreeModule_Tensor):\n```\n\nand is the unique such place in sage code\n\nmaybe it should rather inherit just from `CombinatorialFreeModule` ?",
    "created_at": "2022-08-23T13:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484160",
    "user": "https://github.com/fchapoton"
}
```

there remains an issue in `sage.algebras.schur_algebra.SchurTensorModule`

EDIT:

which is strangely inheriting directly

```
class SchurTensorModule(CombinatorialFreeModule_Tensor):
```

and is the unique such place in sage code

maybe it should rather inherit just from `CombinatorialFreeModule` ?



---

archive/issue_comments_484161.json:
```json
{
    "body": "Replying to [comment:39 chapoton]:\n> there remains an issue in `sage.algebras.schur_algebra.SchurTensorModule`\n> \n> EDIT:\n> \n> which is strangely inheriting directly\n> {{{\n> class SchurTensorModule(CombinatorialFreeModule_Tensor):\n> }}}\n> and is the unique such place in sage code\n> \n> maybe it should rather inherit just from `CombinatorialFreeModule` ?\n\nNo, we shouldn't, at least without also removing `TensorProducts()` from its category (thereby completely stripping the fact it knows and carries a tensor product of `R`-modules structure).\n\nThe problem is exactly what the test is failing for: The construction is not giving the parent back. The underlying issue is that we do not have a Schur algebra representation on the individual factors. So it needs its own `construction()` method. The simple fix is just to have it return `None` to match the previous behavior. The more complicated one is to implement a `ConstructorFunctor` for it, but I don't think that will be useful here.",
    "created_at": "2022-08-25T00:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484161",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:39 chapoton]:
> there remains an issue in `sage.algebras.schur_algebra.SchurTensorModule`
> 
> EDIT:
> 
> which is strangely inheriting directly
> {{{
> class SchurTensorModule(CombinatorialFreeModule_Tensor):
> }}}
> and is the unique such place in sage code
> 
> maybe it should rather inherit just from `CombinatorialFreeModule` ?

No, we shouldn't, at least without also removing `TensorProducts()` from its category (thereby completely stripping the fact it knows and carries a tensor product of `R`-modules structure).

The problem is exactly what the test is failing for: The construction is not giving the parent back. The underlying issue is that we do not have a Schur algebra representation on the individual factors. So it needs its own `construction()` method. The simple fix is just to have it return `None` to match the previous behavior. The more complicated one is to implement a `ConstructorFunctor` for it, but I don't think that will be useful here.



---

archive/issue_comments_484162.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-25T06:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484162",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484163.json:
```json
{
    "body": "all green lights. Ready to go ?",
    "created_at": "2022-08-25T10:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484163",
    "user": "https://github.com/fchapoton"
}
```

all green lights. Ready to go ?



---

archive/issue_comments_484164.json:
```json
{
    "body": "any thoughts on comment:36?",
    "created_at": "2022-08-25T11:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484164",
    "user": "https://github.com/mkoeppe"
}
```

any thoughts on comment:36?



---

archive/issue_comments_484165.json:
```json
{
    "body": "using tensor_factors seems to be consistent with cartesian_factors",
    "created_at": "2022-08-25T11:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484165",
    "user": "https://github.com/fchapoton"
}
```

using tensor_factors seems to be consistent with cartesian_factors



---

archive/issue_comments_484166.json:
```json
{
    "body": "Yes... this is why I suggested this name in comment:9.\n\nBut Cartesian products also have a method `cartesian_projection` that provides the morphisms that connect the product to the factors.",
    "created_at": "2022-08-25T15:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484166",
    "user": "https://github.com/mkoeppe"
}
```

Yes... this is why I suggested this name in comment:9.

But Cartesian products also have a method `cartesian_projection` that provides the morphisms that connect the product to the factors.



---

archive/issue_comments_484167.json:
```json
{
    "body": "but there are no canonical morphisms from a tensor product to its factors",
    "created_at": "2022-08-25T17:12:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484167",
    "user": "https://github.com/fchapoton"
}
```

but there are no canonical morphisms from a tensor product to its factors



---

archive/issue_comments_484168.json:
```json
{
    "body": "I suggested a different morphism in comment:36",
    "created_at": "2022-08-25T17:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484168",
    "user": "https://github.com/mkoeppe"
}
```

I suggested a different morphism in comment:36



---

archive/issue_comments_484169.json:
```json
{
    "body": "please let us keep that possibility for another ticket",
    "created_at": "2022-08-25T17:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484169",
    "user": "https://github.com/fchapoton"
}
```

please let us keep that possibility for another ticket



---

archive/issue_comments_484170.json:
```json
{
    "body": "I agree that we should have another ticket for possible generic morphisms as that is likely fraught with cases that could appear in general (like we had with `construction()` and Schur algebra modules).",
    "created_at": "2022-08-26T02:34:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484170",
    "user": "https://github.com/tscrim"
}
```

I agree that we should have another ticket for possible generic morphisms as that is likely fraught with cases that could appear in general (like we had with `construction()` and Schur algebra modules).



---

archive/issue_comments_484171.json:
```json
{
    "body": "so, good to go ?",
    "created_at": "2022-08-26T15:05:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484171",
    "user": "https://github.com/fchapoton"
}
```

so, good to go ?



---

archive/issue_comments_484172.json:
```json
{
    "body": "No objections here",
    "created_at": "2022-08-26T19:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484172",
    "user": "https://github.com/mkoeppe"
}
```

No objections here



---

archive/issue_comments_484173.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-27T01:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484173",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_484174.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 49.3 --random-seed=123 src/sage/categories/modules.py\n**********************************************************************\nFile \"src/sage/categories/modules.py\", line 942, in sage.categories.modules.Modules.TensorProducts.ParentMethods.t\nensor_factors\nFailed example:\n    M.construction()\nExpected:\n    doctest:warning...\n    DeprecationWarning: implementations of Modules().TensorProducts() now must define the method tensor_factors\n    See https://trac.sagemath.org/34393 for details.\nGot:\n    doctest:warning\n      File \"/home/release/Sage/src/bin/sage-runtests\", line 154, in <module>\n        err = DC.run()\n      File \"/home/release/Sage/src/sage/doctest/control.py\", line 1384, in run\n        self.run_doctests()\n      File \"/home/release/Sage/src/sage/doctest/control.py\", line 1059, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 2021, in dispatch\n        self.parallel_dispatch()\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 1916, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 2190, in start\n        super().start()\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/process.py\", li\nne 121, in start\n        self._popen = self._Popen(self)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/context.py\", li\nne 224, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/context.py\", li\nne 277, in _Popen\n        return Popen(process_obj)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/popen_fork.py\",\n line 19, in __init__\n        self._launch(process_obj)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/popen_fork.py\",\n line 71, in _launch\n        code = process_obj._bootstrap(parent_sentinel=child_r)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/process.py\", line 315, in _bootstrap\n        self.run()\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 2162, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 2492, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 2544, in _run\n        result = runner.run(test)\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 866, in run\n        return self._run(test, compileflags, out)\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 695, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/src/sage/doctest/forker.py\", line 1093, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.categories.modules.Modules.TensorProducts.ParentMethods.tensor_factors[7]>\", line 1, in <module>\n        M.construction()\n      File \"/home/release/Sage/src/sage/combinat/free_module.py\", line 475, in construction\n        c = super().construction()\n      File \"/home/release/Sage/src/sage/categories/modules.py\", line 917, in construction\n        deprecation(34393, \"implementations of Modules().TensorProducts() now must define the method tensor_factors\")\n      File \"/home/release/Sage/src/sage/misc/superseded.py\", line 99, in deprecation\n        warning(trac_number, message, DeprecationWarning, stacklevel)\n      File \"/home/release/Sage/src/sage/misc/superseded.py\", line 180, in warning\n        warn(message, warning_class, stacklevel)\n      File \"/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/warnings.py\", line 109, in _showwarnmsg\n        sw(msg.message, msg.category, msg.filename, msg.lineno,\n    :\n    DeprecationWarning: implementations of Modules().TensorProducts() now must define the method tensor_factors\n    See https://trac.sagemath.org/34393 for details.\n    (VectorFunctor, Integer Ring)\n**********************************************************************\n```\n",
    "created_at": "2022-08-30T19:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484174",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long --warn-long 49.3 --random-seed=123 src/sage/categories/modules.py
**********************************************************************
File "src/sage/categories/modules.py", line 942, in sage.categories.modules.Modules.TensorProducts.ParentMethods.t
ensor_factors
Failed example:
    M.construction()
Expected:
    doctest:warning...
    DeprecationWarning: implementations of Modules().TensorProducts() now must define the method tensor_factors
    See https://trac.sagemath.org/34393 for details.
Got:
    doctest:warning
      File "/home/release/Sage/src/bin/sage-runtests", line 154, in <module>
        err = DC.run()
      File "/home/release/Sage/src/sage/doctest/control.py", line 1384, in run
        self.run_doctests()
      File "/home/release/Sage/src/sage/doctest/control.py", line 1059, in run_doctests
        self.dispatcher.dispatch()
      File "/home/release/Sage/src/sage/doctest/forker.py", line 2021, in dispatch
        self.parallel_dispatch()
      File "/home/release/Sage/src/sage/doctest/forker.py", line 1916, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/release/Sage/src/sage/doctest/forker.py", line 2190, in start
        super().start()
      File "/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/process.py", li
ne 121, in start
        self._popen = self._Popen(self)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/context.py", li
ne 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/context.py", li
ne 277, in _Popen
        return Popen(process_obj)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/popen_fork.py",
 line 19, in __init__
        self._launch(process_obj)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/popen_fork.py",
 line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/home/release/Sage/src/sage/doctest/forker.py", line 2162, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/release/Sage/src/sage/doctest/forker.py", line 2492, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/home/release/Sage/src/sage/doctest/forker.py", line 2544, in _run
        result = runner.run(test)
      File "/home/release/Sage/src/sage/doctest/forker.py", line 866, in run
        return self._run(test, compileflags, out)
      File "/home/release/Sage/src/sage/doctest/forker.py", line 695, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/src/sage/doctest/forker.py", line 1093, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.modules.Modules.TensorProducts.ParentMethods.tensor_factors[7]>", line 1, in <module>
        M.construction()
      File "/home/release/Sage/src/sage/combinat/free_module.py", line 475, in construction
        c = super().construction()
      File "/home/release/Sage/src/sage/categories/modules.py", line 917, in construction
        deprecation(34393, "implementations of Modules().TensorProducts() now must define the method tensor_factors")
      File "/home/release/Sage/src/sage/misc/superseded.py", line 99, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/home/release/Sage/src/sage/misc/superseded.py", line 180, in warning
        warn(message, warning_class, stacklevel)
      File "/home/release/Sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    DeprecationWarning: implementations of Modules().TensorProducts() now must define the method tensor_factors
    See https://trac.sagemath.org/34393 for details.
    (VectorFunctor, Integer Ring)
**********************************************************************
```




---

archive/issue_comments_484175.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-08-30T19:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484175",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_484176.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-31T18:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484177.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-31T18:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484177",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_484178.json:
```json
{
    "body": "doctest fixed, back to needs review",
    "created_at": "2022-08-31T18:54:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484178",
    "user": "https://github.com/fchapoton"
}
```

doctest fixed, back to needs review



---

archive/issue_comments_484179.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-31T23:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484179",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_484180.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-22T22:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484180",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_484181.json:
```json
{
    "body": "Replying to [comment:36 Matthias K\u00f6ppe]:\n> Also, maybe instead of just requiring the method `tensor_factors`, how about specifying a method just like `CombinatorialFreeModule.tensor_constructor`?\n> \n> From its domain, the tensor factors can be read off.\n\nI've opened #34628 for this",
    "created_at": "2022-10-02T19:08:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34156",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34156#issuecomment-484181",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:36 Matthias KÃ¶ppe]:
> Also, maybe instead of just requiring the method `tensor_factors`, how about specifying a method just like `CombinatorialFreeModule.tensor_constructor`?
> 
> From its domain, the tensor factors can be read off.

I've opened #34628 for this
