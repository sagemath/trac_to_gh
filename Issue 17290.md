# Issue 17290: Echelon form of a matrix is sometimes pickled incorrectly

Issue created by migration from https://trac.sagemath.org/ticket/17527

Original creator: pbruin

Original creation time: 2014-12-19 10:04:49

Keywords: matrix echelon pickle

The following bug seems to be somewhat subtle; for example, the wrong result does not arise when using the polynomial ring instead of its fraction field, or when changing the ordering of the pair `t`.

```
sage: K.<x> = FractionField(QQ['x'])
sage: m = Matrix([[1], [x]])
sage: t = (m, m.echelon_form())
sage: s = dumps(t)
sage: t
(
[1]  [1]
[x], [0]
)
sage: loads(s)  # wrong, should be the same as above
(
[1]
[x], [1, x]
)
```

This is a dependency of #10513.


---

Comment by pbruin created at 2017-01-03 15:49:10

This bug is still present in 7.5.beta3 but appears to be gone in 7.5.rc1.


---

Comment by tscrim created at 2017-01-03 22:52:29

Hmmm...I don't see anything in the closed ticket descriptions that would have fixing this as a potential side-effect. Perhaps we should just add a doctest?


---

Comment by pbruin created at 2017-01-04 08:34:55

Replying to [comment:3 tscrim]:
> Hmmm...I don't see anything in the closed ticket descriptions that would have fixing this as a potential side-effect. Perhaps we should just add a doctest?
I suspect it was fixed by the upgrade to Python 2.7.12 in Sage 7.5.rc0, more specifically [Python issue 892902](https://bugs.python.org/issue892902).


---

Comment by pbruin created at 2017-01-04 09:15:50

Confirmed by `git bisect` (of course "bad" here means "good"):

```
c35ea3cbcef6c1ae9f6a939af853ac339fcd691c is the first bad commit
commit c35ea3cbcef6c1ae9f6a939af853ac339fcd691c
Author: Fran√ßois Bissey <francois.bissey@canterbury.ac.nz>
Date:   Thu Dec 8 14:40:38 2016 +1300

    Upgrade python2 to 2.7.12 and update tinfo and uuid patches

```

I will add a doctest.


---

Comment by pbruin created at 2017-01-04 09:36:35

Changing type from defect to task.


---

Comment by pbruin created at 2017-01-04 09:36:35

Changing priority from minor to trivial.


---

Comment by pbruin created at 2017-01-04 09:36:35

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-01-04 12:19:01

Thanks.


---

Comment by tscrim created at 2017-01-04 12:19:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-28 17:03:20

Resolution: fixed
