# Issue 25342: py3: towards docbuild

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2018-06-14 16:00:26

CC:  jdemeyer embray tscrim

make more tests pass in plot/plot/py

some issue are just missing r before strings

some other are more mysterious

some reduce to

```
sage: f=x^(1/3)
sage: float(f(x=-0.565665))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:11794)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:11592)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._eval_self (build/cythonized/sage/symbolic/expression.cpp:10572)()

TypeError: can't convert complex to float

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-12-acdb76afbafc> in <module>()
----> 1 float(f(x=-RealNumber('0.565665')))

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__float__ (build/cythonized/sage/symbolic/expression.cpp:11842)()

TypeError: unable to simplify to float approximation
```



---

Comment by jdemeyer created at 2018-06-15 12:40:17

This is a good example of something that is much harder to debug because of #24681.


---

Comment by chapoton created at 2018-06-16 06:40:00

Useful information maybe:

```
> python3 -m pyflakes src/sage/plot/ | grep 'msg'
src/sage/plot/plot.py:3879: local variable 'msg' is assigned to but never used
src/sage/plot/plot.py:3894: local variable 'msg' is assigned to but never used
```



---

Comment by chapoton created at 2018-06-19 14:15:23

New commits:


---

Comment by chapoton created at 2018-06-28 14:01:30

Well, it seems that plot does no longer known how to handle unexpected complex values:

```
sage: plot(x^(1/3), (x,0,1))
Launched png viewer for Graphics object consisting of 1 graphics primitive
```

works but

```
sage: plot(x^(1/3), (x,-1,1))
verbose 0 (3766: plot.py, generate_plot_points) WARNING: When plotting, failed to evaluate function at 100 points.
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)
<ipython-input-8-f64509ea4fcd> in <module>()
----> 1 plot(x**(Integer(1)/Integer(3)), (x,-Integer(1),Integer(1)))

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/misc/decorators.py in wrapper(*args, **kwds)
    565                 options['__original_opts'] = kwds
    566             options.update(kwds)
--> 567             return func(*args, **options)
    568 
    569         #Add the options specified by `@`options to the signature of the wrapped

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/plot/plot.py in plot(funcs, *args, **kwds)
   1940 
   1941     if hasattr(funcs, 'plot'):
-> 1942         G = funcs.plot(*args, **original_opts)
   1943 
   1944         # If we have extra keywords already set, then update them

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.plot (build/cythonized/sage/symbolic/expression.cpp:68743)()
  12011             except NotImplementedError:
  12012                 return self.function(param)
> 12013         return plot(f, *args, **kwds)
  12014 
  12015     def _plot_fast_callable(self, *vars):

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/misc/decorators.py in wrapper(*args, **kwds)
    565                 options['__original_opts'] = kwds
    566             options.update(kwds)
--> 567             return func(*args, **options)
    568 
    569         #Add the options specified by `@`options to the signature of the wrapped

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/plot/plot.py in plot(funcs, *args, **kwds)
   1959         # if there is one extra arg, then it had better be a tuple
   1960         elif n == 1:
-> 1961             G = _plot(funcs, *args, **kwds)
   1962         elif n == 2:
   1963         # if there are two extra args, then pull them out and pass them as a tuple

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/plot/plot.py in _plot(funcs, xrange, parametric, polar, fill, label, randomize, **options)
   2265         data = generate_plot_points(f, xrange, plot_points,
   2266                                     adaptive_tolerance, adaptive_recursion,
-> 2267                                     randomize)
   2268 
   2269 

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/plot/plot.py in generate_plot_points(f, xrange, plot_points, adaptive_tolerance, adaptive_recursion, randomize, initial_points)
   3925     if (len(data) == 0 and exceptions > 0) or exceptions > 10:
   3926         sage.misc.misc.verbose("WARNING: When plotting, failed to evaluate function at %s points." % exceptions, level=0)
-> 3927         sage.misc.misc.verbose("Last error message: '%s'"%msg, level=0)
   3928 
   3929     return data

UnboundLocalError: local variable 'msg' referenced before assignment
```



---

Comment by git created at 2018-07-04 08:55:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-07-04 08:56:24

Changing type from task to enhancement.


---

Comment by chapoton created at 2018-07-04 08:56:24

ok, this is good to go, I think. Please review !!


---

Comment by chapoton created at 2018-07-04 08:56:24

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-07-04 11:42:03

green bot, morally


---

Comment by tscrim created at 2018-07-06 15:26:48

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-07-06 15:26:48

LGTM.


---

Comment by vbraun created at 2018-07-08 13:05:13

Resolution: fixed
