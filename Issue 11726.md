# Issue 11726: Testing sage/misc/hg.py verbosely starts "less"

archive/issues_011726.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  @jhpalmieri @kini @kcrisman\n\nWith sage-4.7.2.alpha3, executing the command\n\n```\n./sage -t -verbose \"devel/sage/sage/misc/hg.py\"\n```\n\nmakes the doctest process start up `less`.\n\nProbably caused by #11142 but see also #11121 and #10594.\n\nIssue created by migration from https://trac.sagemath.org/ticket/11898\n\n",
    "created_at": "2011-10-05T08:21:51Z",
    "labels": [
        "doctest coverage",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7.2",
    "title": "Testing sage/misc/hg.py verbosely starts \"less\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11726",
    "user": "@jdemeyer"
}
```
Assignee: mvngu

CC:  @jhpalmieri @kini @kcrisman

With sage-4.7.2.alpha3, executing the command

```
./sage -t -verbose "devel/sage/sage/misc/hg.py"
```

makes the doctest process start up `less`.

Probably caused by #11142 but see also #11121 and #10594.

Issue created by migration from https://trac.sagemath.org/ticket/11898





---

archive/issue_comments_133012.json:
```json
{
    "body": "Changing keywords from \"\" to \"mercurial hg pager\".",
    "created_at": "2011-10-05T08:23:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11726#issuecomment-133012",
    "user": "@jdemeyer"
}
```

Changing keywords from "" to "mercurial hg pager".



---

archive/issue_comments_133013.json:
```json
{
    "body": "That's strange.  I don't know the differences between verbose testing and regular that would cause this.\n\nThe attached patch fixes the problem for me, but it would also be nice to actually understand what's going on.",
    "created_at": "2011-10-06T00:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11726#issuecomment-133013",
    "user": "@jhpalmieri"
}
```

That's strange.  I don't know the differences between verbose testing and regular that would cause this.

The attached patch fixes the problem for me, but it would also be nice to actually understand what's going on.



---

archive/issue_comments_133014.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-10-06T00:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11726#issuecomment-133014",
    "user": "@jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_133015.json:
```json
{
    "body": "Sage library",
    "created_at": "2011-10-06T00:18:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11726#issuecomment-133015",
    "user": "@jhpalmieri"
}
```

Sage library



---

archive/issue_comments_133016.json:
```json
{
    "body": "Attachment [trac_11898-hg.patch](tarball://root/attachments/some-uuid/ticket11898/trac_11898-hg.patch) by @jhpalmieri created at 2011-10-06 00:22:20\n\nAnother option would be a patch like this (in the `pager` function):\n\n```diff\ndiff --git a/sage/misc/hg.py b/sage/misc/hg.py\n--- a/sage/misc/hg.py\n+++ b/sage/misc/hg.py\n@@ -112,7 +112,8 @@ def pager():\n         '--config pager.pager=cat'\n         sage: sage.server.support.EMBEDDED_MODE=False\n     \"\"\"\n-    if embedded():\n+    from sage.plot.plot import DOCTEST_MODE\n+    if embedded() or DOCTEST_MODE:\n         return '--config pager.pager=cat'\n     else:\n         return '--config pager.pager=\"LESS=\\'R\\' less\"'\n```\n\nThis would require changing the doctests for the `pager` function, and those doctests wouldn't be as helpful.",
    "created_at": "2011-10-06T00:22:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11726#issuecomment-133016",
    "user": "@jhpalmieri"
}
```

Attachment [trac_11898-hg.patch](tarball://root/attachments/some-uuid/ticket11898/trac_11898-hg.patch) by @jhpalmieri created at 2011-10-06 00:22:20

Another option would be a patch like this (in the `pager` function):

```diff
diff --git a/sage/misc/hg.py b/sage/misc/hg.py
--- a/sage/misc/hg.py
+++ b/sage/misc/hg.py
@@ -112,7 +112,8 @@ def pager():
         '--config pager.pager=cat'
         sage: sage.server.support.EMBEDDED_MODE=False
     """
-    if embedded():
+    from sage.plot.plot import DOCTEST_MODE
+    if embedded() or DOCTEST_MODE:
         return '--config pager.pager=cat'
     else:
         return '--config pager.pager="LESS=\'R\' less"'
```

This would require changing the doctests for the `pager` function, and those doctests wouldn't be as helpful.



---

archive/issue_comments_133017.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-10-06T07:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11726#issuecomment-133017",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_133018.json:
```json
{
    "body": "I like your \"not tested\" patch.  Easy and does the job.",
    "created_at": "2011-10-06T07:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11726#issuecomment-133018",
    "user": "@jdemeyer"
}
```

I like your "not tested" patch.  Easy and does the job.



---

archive/issue_comments_133019.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-10-06T11:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11726",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11726#issuecomment-133019",
    "user": "@jdemeyer"
}
```

Resolution: fixed
