# Issue 11726: Testing sage/misc/hg.py verbosely starts "less"

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2011-10-05 08:21:51

Assignee: mvngu

CC:  jhpalmieri kini kcrisman

With sage-4.7.2.alpha3, executing the command

```
./sage -t -verbose "devel/sage/sage/misc/hg.py"
```

makes the doctest process start up `less`.

Probably caused by #11142 but see also #11121 and #10594.


---

Comment by jdemeyer created at 2011-10-05 08:23:09

Changing keywords from "" to "mercurial hg pager".


---

Comment by jhpalmieri created at 2011-10-06 00:18:31

That's strange.  I don't know the differences between verbose testing and regular that would cause this.

The attached patch fixes the problem for me, but it would also be nice to actually understand what's going on.


---

Comment by jhpalmieri created at 2011-10-06 00:18:31

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2011-10-06 00:18:53

Sage library


---

Attachment

Another option would be a patch like this (in the `pager` function):

```diff
diff --git a/sage/misc/hg.py b/sage/misc/hg.py
--- a/sage/misc/hg.py
+++ b/sage/misc/hg.py
`@``@` -112,7 +112,8 `@``@` def pager():
         '--config pager.pager=cat'
         sage: sage.server.support.EMBEDDED_MODE=False
     """
-    if embedded():
+    from sage.plot.plot import DOCTEST_MODE
+    if embedded() or DOCTEST_MODE:
         return '--config pager.pager=cat'
     else:
         return '--config pager.pager="LESS=\'R\' less"'
```

This would require changing the doctests for the `pager` function, and those doctests wouldn't be as helpful.


---

Comment by jdemeyer created at 2011-10-06 07:08:09

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-10-06 07:08:09

I like your "not tested" patch.  Easy and does the job.


---

Comment by jdemeyer created at 2011-10-06 11:40:39

Resolution: fixed
