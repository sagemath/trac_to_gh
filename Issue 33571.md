# Issue 33571: Another sage/singular mismatch for hilbert polynomials

archive/issues_033571.json:
```json
{
    "body": "See also: #33597 and #33178.\n\n\n```\nsage: R = PolynomialRing(QQ, \"x\", 10)\nsage: x0, x1, x2, x3, x4, x5, x6, x7, x8, x9 = R.gens()\nsage: I = R.ideal([0, 1, x3^2*x6^2*x7, x3^2*x6^2*x9^3, x3^2*x7*x9^3, x3^2*x6^2*x7*x9^3, x7*x9^3, x3^2*x9^3, x3^2, x6^2*x9^3, x6^2, x9^3, x6^2*x7*x9^3, x7, x3^2*x7, x6^2*x7,\n....: x3^2*x6^2])\nsage: I.hilbert_polynomial()\n   skipping text from `parameter`\n0\nsage: I.hilbert_polynomial(algorithm='singular')\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\nRuntimeError: Error raised calling singular function\nException ignored in: 'sage.libs.singular.function.LibraryCallHandler.handle_call'\nTraceback (most recent call last):\n  File \"/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py\", line 2712, in hilbert_polynomial\n    hp = hilbPoly(self)\nRuntimeError: Error raised calling singular function\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-137-4079e1ad73a6> in <module>\n----> 1 I.hilbert_polynomial(algorithm='singular')\n\n~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py in __call__(self, *args, **kwds)\n    295         if not R.base_ring().is_field():\n    296             raise ValueError(\"Coefficient ring must be a field for function '%s'.\"%(self.f.__name__))\n--> 297         return self.f(self._instance, *args, **kwds)\n    298 \n    299 require_field = RequireField\n\n~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/qqbar_decorators.py in wrapper(*args, **kwds)\n     94                    or is_PolynomialSequence(a)\n     95                    and isinstance(a.ring().base_ring(), AlgebraicField_common) for a in args):\n---> 96             return func(*args, **kwds)\n     97 \n     98         polynomials = []\n\n~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py in hilbert_polynomial(self, algorithm)\n   2710             hilbPoly = ff.polylib__lib.hilbPoly\n   2711 \n-> 2712             hp = hilbPoly(self)\n   2713             t = ZZ['t'].gen()\n   2714             fp = ZZ(len(hp)-1).factorial()\n\n~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/libs/singular/function.pyx in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:15293)()\n   1332         if not (isinstance(ring, MPolynomialRing_libsingular) or isinstance(ring, NCPolynomialRing_plural)):\n   1333             raise TypeError(\"Cannot call Singular function '%s' with ring parameter of type '%s'\"%(self._name,type(ring)))\n-> 1334         return call_function(self, args, ring, interruptible, attributes)\n   1335 \n   1336     def _instancedoc_(self):\n\n~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/libs/singular/function.pyx in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:17295)()\n   1530     if errorreported:\n   1531         errorreported = 0\n-> 1532         raise RuntimeError(\"error in Singular function call %r:\\n%s\" %\n   1533             (self._name, \"\\n\".join(error_messages)))\n   1534 \n\nRuntimeError: error in Singular function call 'hilbPoly':\nindex[-1] must be positive\nerror occurred in or before polylib.lib::hilbPoly line 73: `   hp[s]=int(leadcoef(p));`\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33808\n\n",
    "created_at": "2022-05-05T12:19:18Z",
    "labels": [
        "algebraic geometry",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Another sage/singular mismatch for hilbert polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33571",
    "user": "mjo"
}
```
See also: #33597 and #33178.


```
sage: R = PolynomialRing(QQ, "x", 10)
sage: x0, x1, x2, x3, x4, x5, x6, x7, x8, x9 = R.gens()
sage: I = R.ideal([0, 1, x3^2*x6^2*x7, x3^2*x6^2*x9^3, x3^2*x7*x9^3, x3^2*x6^2*x7*x9^3, x7*x9^3, x3^2*x9^3, x3^2, x6^2*x9^3, x6^2, x9^3, x6^2*x7*x9^3, x7, x3^2*x7, x6^2*x7,
....: x3^2*x6^2])
sage: I.hilbert_polynomial()
   skipping text from `parameter`
0
sage: I.hilbert_polynomial(algorithm='singular')
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
RuntimeError: Error raised calling singular function
Exception ignored in: 'sage.libs.singular.function.LibraryCallHandler.handle_call'
Traceback (most recent call last):
  File "/home/mjo/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py", line 2712, in hilbert_polynomial
    hp = hilbPoly(self)
RuntimeError: Error raised calling singular function
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-137-4079e1ad73a6> in <module>
----> 1 I.hilbert_polynomial(algorithm='singular')

~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py in __call__(self, *args, **kwds)
    295         if not R.base_ring().is_field():
    296             raise ValueError("Coefficient ring must be a field for function '%s'."%(self.f.__name__))
--> 297         return self.f(self._instance, *args, **kwds)
    298 
    299 require_field = RequireField

~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/qqbar_decorators.py in wrapper(*args, **kwds)
     94                    or is_PolynomialSequence(a)
     95                    and isinstance(a.ring().base_ring(), AlgebraicField_common) for a in args):
---> 96             return func(*args, **kwds)
     97 
     98         polynomials = []

~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py in hilbert_polynomial(self, algorithm)
   2710             hilbPoly = ff.polylib__lib.hilbPoly
   2711 
-> 2712             hp = hilbPoly(self)
   2713             t = ZZ['t'].gen()
   2714             fp = ZZ(len(hp)-1).factorial()

~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/libs/singular/function.pyx in sage.libs.singular.function.SingularFunction.__call__ (build/cythonized/sage/libs/singular/function.cpp:15293)()
   1332         if not (isinstance(ring, MPolynomialRing_libsingular) or isinstance(ring, NCPolynomialRing_plural)):
   1333             raise TypeError("Cannot call Singular function '%s' with ring parameter of type '%s'"%(self._name,type(ring)))
-> 1334         return call_function(self, args, ring, interruptible, attributes)
   1335 
   1336     def _instancedoc_(self):

~/src/sage.git/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/libs/singular/function.pyx in sage.libs.singular.function.call_function (build/cythonized/sage/libs/singular/function.cpp:17295)()
   1530     if errorreported:
   1531         errorreported = 0
-> 1532         raise RuntimeError("error in Singular function call %r:\n%s" %
   1533             (self._name, "\n".join(error_messages)))
   1534 

RuntimeError: error in Singular function call 'hilbPoly':
index[-1] must be positive
error occurred in or before polylib.lib::hilbPoly line 73: `   hp[s]=int(leadcoef(p));`
```


Issue created by migration from https://trac.sagemath.org/ticket/33808





---

archive/issue_comments_477777.json:
```json
{
    "body": "The two also genuinely disagree for a smaller example (lifted from Eisenbud 1.18)\n\n\n```\nsage: R.<x,y,z,w> = PolynomialRing(QQ)\nsage: I = R.ideal(x,y)\nsage: J = R.ideal(z,w)\nsage: K = I.intersection(J)\nsage: K\nIdeal (y*w, x*w, y*z, x*z) of Multivariate Polynomial Ring in x, y, z, w over Rational Field\nsage: K.hilbert_polynomial()\n-2*t - 2\nsage: K.hilbert_polynomial(algorithm='singular')\n2*t + 2\n```\n",
    "created_at": "2022-06-20T13:21:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33571",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33571#issuecomment-477777",
    "user": "tkarn"
}
```

The two also genuinely disagree for a smaller example (lifted from Eisenbud 1.18)


```
sage: R.<x,y,z,w> = PolynomialRing(QQ)
sage: I = R.ideal(x,y)
sage: J = R.ideal(z,w)
sage: K = I.intersection(J)
sage: K
Ideal (y*w, x*w, y*z, x*z) of Multivariate Polynomial Ring in x, y, z, w over Rational Field
sage: K.hilbert_polynomial()
-2*t - 2
sage: K.hilbert_polynomial(algorithm='singular')
2*t + 2
```

