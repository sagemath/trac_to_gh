# Issue 22870: py3: fix everything in src/sage/matrix/*

archive/issues_022870.json:
```json
{
    "body": "CC:  @fchapoton\n\nPart of #16081\n\nThis set of changes takes care of all the problems reported by `sage -t --long src/sage/matrix/*`. With probability 1 there are other functions that would need to be changed as well but that are not tested enough to raise errors at the moment.\n\nIt is my first ticket concerning pythn3 so please be extra careful when reviewing it. \n\nThis marginally changed also `src/sage/graphs/generic_graph.py`.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23107\n\n",
    "created_at": "2017-05-31T03:50:19Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "py3: fix everything in src/sage/matrix/*",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22870",
    "user": "https://github.com/etn40ff"
}
```
CC:  @fchapoton

Part of #16081

This set of changes takes care of all the problems reported by `sage -t --long src/sage/matrix/*`. With probability 1 there are other functions that would need to be changed as well but that are not tested enough to raise errors at the moment.

It is my first ticket concerning pythn3 so please be extra careful when reviewing it. 

This marginally changed also `src/sage/graphs/generic_graph.py`.


Issue created by migration from https://trac.sagemath.org/ticket/23107





---

archive/issue_comments_319419.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2017-05-31T03:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319419",
    "user": "https://github.com/etn40ff"
}
```

Last 10 new commits:



---

archive/issue_comments_319420.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-05-31T03:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319420",
    "user": "https://github.com/etn40ff"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_319421.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-05-31T03:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319421",
    "user": "https://github.com/etn40ff"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_319422.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2017-05-31T04:01:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319422",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_319423.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-05-31T09:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319423",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319424.json:
```json
{
    "body": "1. I would replace\n\n```\n            from collections import Iterator, Sequence\n            if isinstance(columns, (Iterator, Sequence)):\n                columns = list(columns)\n            else:\n                raise TypeError(\"columns (=%s) must be a list of integers\" % columns)\n```\n\nby\n\n```\n            columns = list(columns)\n```\n\n\n2. Don't break doctests! You should keep the test `A(range(4))`, just change it to\n\n```\nsage: from six.moves import range\nsage: A(range(4))\n```\n\nif you want to do the same thing in Python 2 and 3.",
    "created_at": "2017-05-31T09:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319424",
    "user": "https://github.com/jdemeyer"
}
```

1. I would replace

```
            from collections import Iterator, Sequence
            if isinstance(columns, (Iterator, Sequence)):
                columns = list(columns)
            else:
                raise TypeError("columns (=%s) must be a list of integers" % columns)
```

by

```
            columns = list(columns)
```


2. Don't break doctests! You should keep the test `A(range(4))`, just change it to

```
sage: from six.moves import range
sage: A(range(4))
```

if you want to do the same thing in Python 2 and 3.



---

archive/issue_comments_319425.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-05-31T12:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319425",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319426.json:
```json
{
    "body": "Hi Jeroen, thanks for the fast reply.\n\n2. I bowed to your knowledge here and just reintroduced the test.\n\n1. The rationale behind the conditional clause you mention (and the many other similar occurrences I added in this partch) is that, most likely, `columns` is already going to be a list. I figured it was more efficient to add two checks rather than recreating a new list blindly. In this specific case you mention it will probably not matter because these lists will have short lengths anyway. The cases in which this is more relevant are probably in `src/sage/matrix/matrix_integer_sparse.pyx` where, in principle, one could be building a very big matrix. Should I remove these tests?\n\nOne other thing: before settling on this form I was just checking for `hasattr(columns, \"__iter__\")` but then I realized that also dictionaries will satisfy this.\n\n----\nNew commits:",
    "created_at": "2017-05-31T12:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319426",
    "user": "https://github.com/etn40ff"
}
```

Hi Jeroen, thanks for the fast reply.

2. I bowed to your knowledge here and just reintroduced the test.

1. The rationale behind the conditional clause you mention (and the many other similar occurrences I added in this partch) is that, most likely, `columns` is already going to be a list. I figured it was more efficient to add two checks rather than recreating a new list blindly. In this specific case you mention it will probably not matter because these lists will have short lengths anyway. The cases in which this is more relevant are probably in `src/sage/matrix/matrix_integer_sparse.pyx` where, in principle, one could be building a very big matrix. Should I remove these tests?

One other thing: before settling on this form I was just checking for `hasattr(columns, "__iter__")` but then I realized that also dictionaries will satisfy this.

----
New commits:



---

archive/issue_comments_319427.json:
```json
{
    "body": "Replying to [comment:7 etn40ff]:\n> 1. The rationale behind the conditional clause you mention (and the many other similar occurrences I added in this partch) is that, most likely, `columns` is already going to be a list.\n\nThis reply seems unrelated to the comment I made. It's not about calling `list()` when the input is not a list, it's about rejecting things which are not a `Sequence` or `Iterator`.\n\nI'm perfectly fine with code like\n\n```\nif not isinstance(foo, list):\n    foo = list(foo)\n```\n\nAs you say, this is more efficient if the input is already a `list`.",
    "created_at": "2017-05-31T14:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319427",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 etn40ff]:
> 1. The rationale behind the conditional clause you mention (and the many other similar occurrences I added in this partch) is that, most likely, `columns` is already going to be a list.

This reply seems unrelated to the comment I made. It's not about calling `list()` when the input is not a list, it's about rejecting things which are not a `Sequence` or `Iterator`.

I'm perfectly fine with code like

```
if not isinstance(foo, list):
    foo = list(foo)
```

As you say, this is more efficient if the input is already a `list`.



---

archive/issue_comments_319428.json:
```json
{
    "body": "Also note that `isinstance(foo, list)` is extremely fast in Cython since there is a particular optimizating in CPython for checking lists.",
    "created_at": "2017-05-31T14:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319428",
    "user": "https://github.com/jdemeyer"
}
```

Also note that `isinstance(foo, list)` is extremely fast in Cython since there is a particular optimizating in CPython for checking lists.



---

archive/issue_comments_319429.json:
```json
{
    "body": "I agree with Jeroen, you want to construct a list and let Python fail when `list(foo)` doesn't work. We shouldn't force it to be either an `Iterator` or `Sequence`, and fail otherwise. This would allow things like the Python3 `range` to be valid input. Plus it could get rid of the (relatively) expensive `from collections import Iterator, Sequence`.",
    "created_at": "2017-05-31T15:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319429",
    "user": "https://github.com/tscrim"
}
```

I agree with Jeroen, you want to construct a list and let Python fail when `list(foo)` doesn't work. We shouldn't force it to be either an `Iterator` or `Sequence`, and fail otherwise. This would allow things like the Python3 `range` to be valid input. Plus it could get rid of the (relatively) expensive `from collections import Iterator, Sequence`.



---

archive/issue_comments_319430.json:
```json
{
    "body": "I am confused. I assumed we do not want to allow this to work if `foo` is a dictionary, do we?",
    "created_at": "2017-05-31T15:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319430",
    "user": "https://github.com/etn40ff"
}
```

I am confused. I assumed we do not want to allow this to work if `foo` is a dictionary, do we?



---

archive/issue_comments_319431.json:
```json
{
    "body": "Then we can explicitly forbid that, but I think this would break Python's ducktyping principle. Since it is suppose to take any iterable, and a `dict` is an iterable, it should work. A user passing a `dict` is likely an error on the user's part, but there could be a use case for it.",
    "created_at": "2017-05-31T15:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319431",
    "user": "https://github.com/tscrim"
}
```

Then we can explicitly forbid that, but I think this would break Python's ducktyping principle. Since it is suppose to take any iterable, and a `dict` is an iterable, it should work. A user passing a `dict` is likely an error on the user's part, but there could be a use case for it.



---

archive/issue_comments_319432.json:
```json
{
    "body": "OK, I consider myself voted down and I will remove these checks.\n\nI would only like to point out that we are changing the behaviour from the one before this patch.\n\nThe current patch:\n\n```\n-        if isinstance(columns, xrange):\n-            columns = list(columns)\n-        elif not isinstance(columns, (list, tuple)):\n-            raise TypeError(\"columns (=%s) must be a list of integers\" % columns)\n+        if not isinstance(columns, (list, tuple)):\n+            from collections import Iterator, Sequence\n+            if isinstance(columns, (Iterator, Sequence)):\n+                columns = list(columns)\n+            else:\n+                raise TypeError(\"columns (=%s) must be a list of integers\" % columns)\n```\n\n\nThe proposed version:\n\n```\n-        if isinstance(columns, xrange):\n-            columns = list(columns)\n-        elif not isinstance(columns, (list, tuple)):\n-            raise TypeError(\"columns (=%s) must be a list of integers\" % columns)\n+        if not isinstance(columns, (list, tuple)):\n+             columns = list(columns)\n```\n",
    "created_at": "2017-05-31T15:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319432",
    "user": "https://github.com/etn40ff"
}
```

OK, I consider myself voted down and I will remove these checks.

I would only like to point out that we are changing the behaviour from the one before this patch.

The current patch:

```
-        if isinstance(columns, xrange):
-            columns = list(columns)
-        elif not isinstance(columns, (list, tuple)):
-            raise TypeError("columns (=%s) must be a list of integers" % columns)
+        if not isinstance(columns, (list, tuple)):
+            from collections import Iterator, Sequence
+            if isinstance(columns, (Iterator, Sequence)):
+                columns = list(columns)
+            else:
+                raise TypeError("columns (=%s) must be a list of integers" % columns)
```


The proposed version:

```
-        if isinstance(columns, xrange):
-            columns = list(columns)
-        elif not isinstance(columns, (list, tuple)):
-            raise TypeError("columns (=%s) must be a list of integers" % columns)
+        if not isinstance(columns, (list, tuple)):
+             columns = list(columns)
```




---

archive/issue_comments_319433.json:
```json
{
    "body": "Replying to [comment:11 etn40ff]:\n> I assumed we do not want to allow this to work if `foo` is a dictionary, do we?\n\nWhy should we explicitly *disallow* a `dict`?",
    "created_at": "2017-05-31T17:17:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319433",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 etn40ff]:
> I assumed we do not want to allow this to work if `foo` is a dictionary, do we?

Why should we explicitly *disallow* a `dict`?



---

archive/issue_comments_319434.json:
```json
{
    "body": "Let me rephrase:\n\n1. With the code in sage before this ticket was opened the function in the comment 13 fails if you pass a dictionary to it (or any other iterable that is not xrange list or tuple).\n\n2. With the change I made it preserves this behaviour.\n\n3. With the change you suggest it works also if `coulmns` is a dictionary (using the its keys as elements).\n\nI am not saying that 3 is bad (I actually prefer it), it is just different from 1.",
    "created_at": "2017-05-31T17:24:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319434",
    "user": "https://github.com/etn40ff"
}
```

Let me rephrase:

1. With the code in sage before this ticket was opened the function in the comment 13 fails if you pass a dictionary to it (or any other iterable that is not xrange list or tuple).

2. With the change I made it preserves this behaviour.

3. With the change you suggest it works also if `coulmns` is a dictionary (using the its keys as elements).

I am not saying that 3 is bad (I actually prefer it), it is just different from 1.



---

archive/issue_comments_319435.json:
```json
{
    "body": "Replying to [comment:15 etn40ff]:\n> I am not saying that 3 is bad (I actually prefer it), it is just different from 1.\n\nWell, you are already changing the behaviour of the function in other ways too.\n\nIf allowing dicts was the *only* change that you did, I would agree with you: that would be dubious. But if you change behaviour anyway, then the argument \"it behaves different from the old code\" makes little sense.",
    "created_at": "2017-05-31T20:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319435",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:15 etn40ff]:
> I am not saying that 3 is bad (I actually prefer it), it is just different from 1.

Well, you are already changing the behaviour of the function in other ways too.

If allowing dicts was the *only* change that you did, I would agree with you: that would be dubious. But if you change behaviour anyway, then the argument "it behaves different from the old code" makes little sense.



---

archive/issue_comments_319436.json:
```json
{
    "body": "Something that is a problem with your current version is that it no longer would support `xrange`:\n\n```\nsage: from six.moves import range\nsage: isinstance(range, Iterator)\nFalse\nsage: isinstance(range, Sequence)\nFalse\n```\n",
    "created_at": "2017-05-31T23:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319436",
    "user": "https://github.com/tscrim"
}
```

Something that is a problem with your current version is that it no longer would support `xrange`:

```
sage: from six.moves import range
sage: isinstance(range, Iterator)
False
sage: isinstance(range, Sequence)
False
```




---

archive/issue_comments_319437.json:
```json
{
    "body": "Replying to [comment:17 tscrim]:\n> Something that is a problem with your current version is that it no longer would support `xrange`:\n> {{{\n> sage: from six.moves import range\n> sage: isinstance(range, Iterator)\n> False\n> sage: isinstance(range, Sequence)\n> False\n> }}}\n\nThat is not surprising: you forgot to call it.\n\n```\nsage: from six.moves import range\nsage: isinstance(range(10), Iterator)\nFalse\nsage: isinstance(range(10), Sequence)\nTrue\n```\n\n\nAnyway this is a moot point now since we decided that I should remove these conditional statements.",
    "created_at": "2017-06-01T01:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319437",
    "user": "https://github.com/etn40ff"
}
```

Replying to [comment:17 tscrim]:
> Something that is a problem with your current version is that it no longer would support `xrange`:
> {{{
> sage: from six.moves import range
> sage: isinstance(range, Iterator)
> False
> sage: isinstance(range, Sequence)
> False
> }}}

That is not surprising: you forgot to call it.

```
sage: from six.moves import range
sage: isinstance(range(10), Iterator)
False
sage: isinstance(range(10), Sequence)
True
```


Anyway this is a moot point now since we decided that I should remove these conditional statements.



---

archive/issue_comments_319438.json:
```json
{
    "body": "*facepalm*",
    "created_at": "2017-06-01T02:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319438",
    "user": "https://github.com/tscrim"
}
```

*facepalm*



---

archive/issue_comments_319439.json:
```json
{
    "body": "Can you revert some (all?) of the changes from `range` to explicit lists and be Python3 compatible? I think we should have coverage for (at least most) those as features. Once that is done, I think that takes care of all of the issues and we can set this to a positive review.\n\nAlso, author name.",
    "created_at": "2017-06-04T00:37:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319439",
    "user": "https://github.com/tscrim"
}
```

Can you revert some (all?) of the changes from `range` to explicit lists and be Python3 compatible? I think we should have coverage for (at least most) those as features. Once that is done, I think that takes care of all of the issues and we can set this to a positive review.

Also, author name.



---

archive/issue_comments_319440.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-07T03:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319440",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319441.json:
```json
{
    "body": "Dear All, sorry for the late reply.\n\nI made few changes to the code:\n\n1. All instances of `[0,1]` I introduced in the doctest are now `list(range(2))`. Same for `[0,1,2,3]`. I do not understand why you wanted this change (they produce the same output both in python2 and python3 and the fisrt syntax is shorter and more legible IMHO) but it is not worth spending time discussing this.\n\n2. I removed all the tests `isinstance(foo, (Iterator, Sequence))` that where easily removeable. There are few more around, I think only in the following files\n\n```\nsrc/sage/matrix/matrix_double_dense.pyx\nsrc/sage/matrix/matrix_integer_sparse.pyx\nsrc/sage/matrix/matrix_mod2_dense.pyx\nsrc/sage/matrix/matrix_modn_sparse.pyx\nsrc/sage/matrix/matrix_rational_sparse.pyx\nsrc/sage/matrix/matrix_space.py\n```\n \n    The reason is that the function in there already accept a variety of inputs, some of which are not iterable, and to remove the tests these function would have to be significantly reworked. There are two solutions to this:\n \n    (cheap and messy) remove the test and fail if they are fed an iterator. This probably will require to fix doctests in other files. Plus I do not see why they should not work with iterators just because the implementation is not clean enough.\n\n    (more time consuming) rewrite the functions so that they default to evaluate `foo = list(foo)`\n\n    At the moment I do not have time to do so. If you are not satisfied feel free to take over this patch and fix it to your likings.\n\n`@`Travis: I do not understand what you mean by \"and be Python3 compatible\". It looks to me that the changes this patch produces work in both version of python. This is the whole point, no?\n\n\n----\nNew commits:\n----\nNew commits:",
    "created_at": "2017-06-07T03:24:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319441",
    "user": "https://github.com/etn40ff"
}
```

Dear All, sorry for the late reply.

I made few changes to the code:

1. All instances of `[0,1]` I introduced in the doctest are now `list(range(2))`. Same for `[0,1,2,3]`. I do not understand why you wanted this change (they produce the same output both in python2 and python3 and the fisrt syntax is shorter and more legible IMHO) but it is not worth spending time discussing this.

2. I removed all the tests `isinstance(foo, (Iterator, Sequence))` that where easily removeable. There are few more around, I think only in the following files

```
src/sage/matrix/matrix_double_dense.pyx
src/sage/matrix/matrix_integer_sparse.pyx
src/sage/matrix/matrix_mod2_dense.pyx
src/sage/matrix/matrix_modn_sparse.pyx
src/sage/matrix/matrix_rational_sparse.pyx
src/sage/matrix/matrix_space.py
```
 
    The reason is that the function in there already accept a variety of inputs, some of which are not iterable, and to remove the tests these function would have to be significantly reworked. There are two solutions to this:
 
    (cheap and messy) remove the test and fail if they are fed an iterator. This probably will require to fix doctests in other files. Plus I do not see why they should not work with iterators just because the implementation is not clean enough.

    (more time consuming) rewrite the functions so that they default to evaluate `foo = list(foo)`

    At the moment I do not have time to do so. If you are not satisfied feel free to take over this patch and fix it to your likings.

`@`Travis: I do not understand what you mean by "and be Python3 compatible". It looks to me that the changes this patch produces work in both version of python. This is the whole point, no?


----
New commits:
----
New commits:



---

archive/issue_comments_319442.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-07T03:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319442",
    "user": "https://github.com/etn40ff"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_319443.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-07T05:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319443",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319444.json:
```json
{
    "body": "There is still a lot of `list(range(...))` in the doctests.",
    "created_at": "2017-06-07T05:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319444",
    "user": "https://github.com/jdemeyer"
}
```

There is still a lot of `list(range(...))` in the doctests.



---

archive/issue_comments_319445.json:
```json
{
    "body": "I am totally confused here. The code contained many instances of things like `M[range(2):]` and I changed that to `M[[0,1],:]`. Travis complained in comment 20 and I reverted them to `M[list(range(2)):]` which is the way things have been done in other tickets (c.f. #22972 https://git.sagemath.org/sage.git/commitid=5c740530b0224aab62eaa8e4e49d0dfd9a19ec08 ). Now you complain for the exact opposite reason. Can we please reach an agreement on what should be done?",
    "created_at": "2017-06-07T11:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319445",
    "user": "https://github.com/etn40ff"
}
```

I am totally confused here. The code contained many instances of things like `M[range(2):]` and I changed that to `M[[0,1],:]`. Travis complained in comment 20 and I reverted them to `M[list(range(2)):]` which is the way things have been done in other tickets (c.f. #22972 https://git.sagemath.org/sage.git/commitid=5c740530b0224aab62eaa8e4e49d0dfd9a19ec08 ). Now you complain for the exact opposite reason. Can we please reach an agreement on what should be done?



---

archive/issue_comments_319446.json:
```json
{
    "body": "The solution is easy: if the original was A, Travis complains about B and I complain about C, just keep A.",
    "created_at": "2017-06-07T12:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319446",
    "user": "https://github.com/jdemeyer"
}
```

The solution is easy: if the original was A, Travis complains about B and I complain about C, just keep A.



---

archive/issue_comments_319447.json:
```json
{
    "body": "Replying to [comment:25 etn40ff]:\n> #22972\n\nWow, that's bad indeed. I would never have agreed with that.",
    "created_at": "2017-06-07T12:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319447",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 etn40ff]:
> #22972

Wow, that's bad indeed. I would never have agreed with that.



---

archive/issue_comments_319448.json:
```json
{
    "body": "A is not an option: slicing does not work with iterators and I am not adderssing this issue in this ticket.",
    "created_at": "2017-06-07T12:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319448",
    "user": "https://github.com/etn40ff"
}
```

A is not an option: slicing does not work with iterators and I am not adderssing this issue in this ticket.



---

archive/issue_comments_319449.json:
```json
{
    "body": "What has happened is you have increased support with changes like this:\n\n```diff\ndiff --git a/src/sage/matrix/matrix1.pyx b/src/sage/matrix/matrix1.pyx\nindex b9c35be..dfe74a9 100644\n--- a/src/sage/matrix/matrix1.pyx\n+++ b/src/sage/matrix/matrix1.pyx\n@@ -1697,10 +1697,9 @@ cdef class Matrix(matrix0.Matrix):\n             [5 4]\n             [0 7]\n         \"\"\"\n-        if isinstance(columns, xrange):\n+        if not isinstance(columns, (list, tuple)):\n             columns = list(columns)\n-        elif not isinstance(columns, (list, tuple)):\n-            raise TypeError(\"columns (=%s) must be a list of integers\" % columns)\n+\n         cdef Matrix A\n         cdef Py_ssize_t ncols,k,r\n \n```\n\nand you do not need to explicitly specify it as a list. By allowing an `xrange` (which is Cython-speak for Python3 range) input, you are Python3 compatible. So I don't fundamentally see my and Jeroen's objections as being different (actually, mine was more meant as a question at the time).\n\nEdit: Misread the code, it is not a regression but an expansion of support.",
    "created_at": "2017-06-07T12:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319449",
    "user": "https://github.com/tscrim"
}
```

What has happened is you have increased support with changes like this:

```diff
diff --git a/src/sage/matrix/matrix1.pyx b/src/sage/matrix/matrix1.pyx
index b9c35be..dfe74a9 100644
--- a/src/sage/matrix/matrix1.pyx
+++ b/src/sage/matrix/matrix1.pyx
@@ -1697,10 +1697,9 @@ cdef class Matrix(matrix0.Matrix):
             [5 4]
             [0 7]
         """
-        if isinstance(columns, xrange):
+        if not isinstance(columns, (list, tuple)):
             columns = list(columns)
-        elif not isinstance(columns, (list, tuple)):
-            raise TypeError("columns (=%s) must be a list of integers" % columns)
+
         cdef Matrix A
         cdef Py_ssize_t ncols,k,r
 
```

and you do not need to explicitly specify it as a list. By allowing an `xrange` (which is Cython-speak for Python3 range) input, you are Python3 compatible. So I don't fundamentally see my and Jeroen's objections as being different (actually, mine was more meant as a question at the time).

Edit: Misread the code, it is not a regression but an expansion of support.



---

archive/issue_comments_319450.json:
```json
{
    "body": "Replying to [comment:28 etn40ff]:\n> A is not an option: slicing does not work with iterators and I am not adderssing this issue in this ticket.\n\nSorry, I don't understand what you mean. Why cannot you just keep the doctests as they are?",
    "created_at": "2017-06-07T12:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319450",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:28 etn40ff]:
> A is not an option: slicing does not work with iterators and I am not adderssing this issue in this ticket.

Sorry, I don't understand what you mean. Why cannot you just keep the doctests as they are?



---

archive/issue_comments_319451.json:
```json
{
    "body": "There is more general idea here: **do not break doctests**. If you make changes to the code which break a doctest, that's bad: you should fix your code such that the doctest remains to work.\n\nThere are always exceptions to this rule, but you need good reasons.",
    "created_at": "2017-06-07T12:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319451",
    "user": "https://github.com/jdemeyer"
}
```

There is more general idea here: **do not break doctests**. If you make changes to the code which break a doctest, that's bad: you should fix your code such that the doctest remains to work.

There are always exceptions to this rule, but you need good reasons.



---

archive/issue_comments_319452.json:
```json
{
    "body": "Replying to [comment:30 jdemeyer]:\n> Replying to [comment:28 etn40ff]:\n> > A is not an option: slicing does not work with iterators and I am not adderssing this issue in this ticket.\n> \n> Sorry, I don't understand what you mean. Why cannot you just keep the doctests as they are?\n\nBecause of this:\n\n```\nsage: M = Matrix(5); M[iter(range(3)):]\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-ca1bbd50e7c9> in <module>()\n----> 1 M = Matrix(Integer(5)); M[iter(range(Integer(3))):]\n\n/opt/sage/src/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__getitem__ (build/cythonized/sage/matrix/matrix0.c:7659)()\n    984             r = self.matrix_from_rows(row_list)\n    985         elif isinstance(row_index, slice):\n--> 986             row_list = list(xrange(*row_index.indices(nrows)))\n    987             r = self.matrix_from_rows(row_list)\n    988         else:\n\nTypeError: slice indices must be integers or None or have an __index__ method\n```\n",
    "created_at": "2017-06-07T12:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319452",
    "user": "https://github.com/etn40ff"
}
```

Replying to [comment:30 jdemeyer]:
> Replying to [comment:28 etn40ff]:
> > A is not an option: slicing does not work with iterators and I am not adderssing this issue in this ticket.
> 
> Sorry, I don't understand what you mean. Why cannot you just keep the doctests as they are?

Because of this:

```
sage: M = Matrix(5); M[iter(range(3)):]
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-ca1bbd50e7c9> in <module>()
----> 1 M = Matrix(Integer(5)); M[iter(range(Integer(3))):]

/opt/sage/src/sage/matrix/matrix0.pyx in sage.matrix.matrix0.Matrix.__getitem__ (build/cythonized/sage/matrix/matrix0.c:7659)()
    984             r = self.matrix_from_rows(row_list)
    985         elif isinstance(row_index, slice):
--> 986             row_list = list(xrange(*row_index.indices(nrows)))
    987             r = self.matrix_from_rows(row_list)
    988         else:

TypeError: slice indices must be integers or None or have an __index__ method
```




---

archive/issue_comments_319453.json:
```json
{
    "body": "Replying to [comment:31 jdemeyer]:\n> There is more general idea here: **do not break doctests**. If you make changes to the code which break a doctest, that's bad: you should fix your code such that the doctest remains to work.\n> \n> There are always exceptions to this rule, but you need good reasons.\n\nI *did not* break a doctest. I have been applying the same procedure taht all the other python3 tickets did i.e. adapt the doctest to accept both python2 and python3. I agree that `list(range(` is fugly but that is what has been done all over the place.",
    "created_at": "2017-06-07T12:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319453",
    "user": "https://github.com/etn40ff"
}
```

Replying to [comment:31 jdemeyer]:
> There is more general idea here: **do not break doctests**. If you make changes to the code which break a doctest, that's bad: you should fix your code such that the doctest remains to work.
> 
> There are always exceptions to this rule, but you need good reasons.

I *did not* break a doctest. I have been applying the same procedure taht all the other python3 tickets did i.e. adapt the doctest to accept both python2 and python3. I agree that `list(range(` is fugly but that is what has been done all over the place.



---

archive/issue_comments_319454.json:
```json
{
    "body": "Replying to [comment:33 etn40ff]:\n> i.e. adapt the doctest to accept both python2 and python3\n\nAdapting doctests is not a solution. The change from Python 2 to Python 3 should be as transparent as possible to the user. You cannot require the user to change all `range(n)` into `list(range(n))`.\n\n(edit: as usual, there are exceptions. Some things cannot work in Python 3 for fundamental reasons. But I see no reason to make an exception for this ticket)",
    "created_at": "2017-06-07T12:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319454",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:33 etn40ff]:
> i.e. adapt the doctest to accept both python2 and python3

Adapting doctests is not a solution. The change from Python 2 to Python 3 should be as transparent as possible to the user. You cannot require the user to change all `range(n)` into `list(range(n))`.

(edit: as usual, there are exceptions. Some things cannot work in Python 3 for fundamental reasons. But I see no reason to make an exception for this ticket)



---

archive/issue_comments_319455.json:
```json
{
    "body": "There is a difference between code that is designed to work with both types of `range` and those that currently need `list(range(`. Although perhaps on earlier Python3 tickets, Fr\u00e9d\u00e9ric and I didn't quite know what the best way forward would be (such as Cython's support for `xrange`).",
    "created_at": "2017-06-07T13:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319455",
    "user": "https://github.com/tscrim"
}
```

There is a difference between code that is designed to work with both types of `range` and those that currently need `list(range(`. Although perhaps on earlier Python3 tickets, Frédéric and I didn't quite know what the best way forward would be (such as Cython's support for `xrange`).



---

archive/issue_comments_319456.json:
```json
{
    "body": "Replying to [comment:35 tscrim]:\n> There is a difference between code that is designed to work with both types of `range` and those that currently need `list(range(`.\n\nAs I explained in [comment:34], the solution is to change the code to accept `range(n)` in Python 3. Changing doctests is not a solution.",
    "created_at": "2017-06-07T13:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319456",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:35 tscrim]:
> There is a difference between code that is designed to work with both types of `range` and those that currently need `list(range(`.

As I explained in [comment:34], the solution is to change the code to accept `range(n)` in Python 3. Changing doctests is not a solution.



---

archive/issue_comments_319457.json:
```json
{
    "body": "Replying to [comment:36 jdemeyer]:\n> Replying to [comment:35 tscrim]:\n> > There is a difference between code that is designed to work with both types of `range` and those that currently need `list(range(`.\n> \n> As I explained in [comment:34], the solution is to change the code to accept `range(n)` in Python 3. Changing doctests is not a solution.\n\nThis patch does not address the issue of slicing; are you saying that it should leave alone the doctests failing because of this? \n\nIn any case, it looks to me that there is no consensus on what to do. Moreover we are not being consistent with other py3 tickets so far. Do we have to revisit all the work that has already been done? Fr\u00e9d\u00e9ric should probably be part of the conversation as well so I just cced him.\n\nI guess that me trying to simultaneously satisfy contrasting guidelines is pointless so I will step back and let you figure out a list of desiderata first. I do not think I will have much time to work on this in the foreseeable future (I am moving to another country for my next job) so please feel free to claim ownership of this ticket and continue without me.",
    "created_at": "2017-06-07T18:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319457",
    "user": "https://github.com/etn40ff"
}
```

Replying to [comment:36 jdemeyer]:
> Replying to [comment:35 tscrim]:
> > There is a difference between code that is designed to work with both types of `range` and those that currently need `list(range(`.
> 
> As I explained in [comment:34], the solution is to change the code to accept `range(n)` in Python 3. Changing doctests is not a solution.

This patch does not address the issue of slicing; are you saying that it should leave alone the doctests failing because of this? 

In any case, it looks to me that there is no consensus on what to do. Moreover we are not being consistent with other py3 tickets so far. Do we have to revisit all the work that has already been done? Frédéric should probably be part of the conversation as well so I just cced him.

I guess that me trying to simultaneously satisfy contrasting guidelines is pointless so I will step back and let you figure out a list of desiderata first. I do not think I will have much time to work on this in the foreseeable future (I am moving to another country for my next job) so please feel free to claim ownership of this ticket and continue without me.



---

archive/issue_comments_319458.json:
```json
{
    "body": "Replying to [comment:37 etn40ff]:\n> are you saying that it should leave alone the doctests failing because of this? \n\nExactly (to be clear, I assume that by \"failing\" you mean \"failing on Python 3 but succeeding on Python 2\").\n\n> Moreover we are not being consistent with other py3 tickets so far.\n\nThat's a pity indeed. Note that *most* of the Python 3 tickets do not change doctests that way. #22972 is the only one that I am aware of (and to repeat, I disagree with what was done there).\n\n> Do we have to revisit all the work that has already been done?\n\nWell, in any case that's not really urgent. But at least let's not make things worse.",
    "created_at": "2017-06-07T19:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319458",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:37 etn40ff]:
> are you saying that it should leave alone the doctests failing because of this? 

Exactly (to be clear, I assume that by "failing" you mean "failing on Python 3 but succeeding on Python 2").

> Moreover we are not being consistent with other py3 tickets so far.

That's a pity indeed. Note that *most* of the Python 3 tickets do not change doctests that way. #22972 is the only one that I am aware of (and to repeat, I disagree with what was done there).

> Do we have to revisit all the work that has already been done?

Well, in any case that's not really urgent. But at least let's not make things worse.



---

archive/issue_comments_319459.json:
```json
{
    "body": "here is a modified branch..\n----\nNew commits:",
    "created_at": "2017-06-19T19:39:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319459",
    "user": "https://github.com/fchapoton"
}
```

here is a modified branch..
----
New commits:



---

archive/issue_comments_319460.json:
```json
{
    "body": "Just to remind that this is still needs_work.",
    "created_at": "2017-06-20T15:06:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319460",
    "user": "https://github.com/jdemeyer"
}
```

Just to remind that this is still needs_work.



---

archive/issue_comments_319461.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-20T15:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319461",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_319462.json:
```json
{
    "body": "Thanks. I think Salvatore has dropped the case. I would have liked to see this resolved without me doing anything, but alas..\n\nI am not totally convinced by the use of Iterator, Sequence.",
    "created_at": "2017-06-20T15:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319462",
    "user": "https://github.com/fchapoton"
}
```

Thanks. I think Salvatore has dropped the case. I would have liked to see this resolved without me doing anything, but alas..

I am not totally convinced by the use of Iterator, Sequence.



---

archive/issue_comments_319463.json:
```json
{
    "body": "Dear all,\nI just wanted to say that I did not drop the cause yet. I recently moved to my new job and I am still on a crazy rollercoaster trying to sort things out. If you are not in a hurry I can be back on this in a month time at the latest. On the other hand, if you are in a hurry feel free to push through without my input. There are going to be plenty of other py3 tickets I can contribute to once I am back.\n\nSorry for not being more helpful right now.",
    "created_at": "2017-06-20T15:36:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319463",
    "user": "https://github.com/etn40ff"
}
```

Dear all,
I just wanted to say that I did not drop the cause yet. I recently moved to my new job and I am still on a crazy rollercoaster trying to sort things out. If you are not in a hurry I can be back on this in a month time at the latest. On the other hand, if you are in a hurry feel free to push through without my input. There are going to be plenty of other py3 tickets I can contribute to once I am back.

Sorry for not being more helpful right now.



---

archive/issue_comments_319464.json:
```json
{
    "body": "PS: how is it possible that I am listed as the one making the latest commit on the current branch when I did not?",
    "created_at": "2017-06-20T15:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319464",
    "user": "https://github.com/etn40ff"
}
```

PS: how is it possible that I am listed as the one making the latest commit on the current branch when I did not?



---

archive/issue_comments_319465.json:
```json
{
    "body": "Hello Salvatore,\n\nin fact, there is no hurry (py3 is still a long way ahead, sadly), but I was afraid that you were (besides being very busy with installation at your new job, which is very understandable) somewhat horrified by the complexity of the matter, and the various contradictory requirements.\n\nConcerning your name on the commit, I did a rebase, keeping only your first commit and squashing the others into this one, then changing its commit message. Then I worked a little bit and rebased again. So I guess this is considered to some kind of \"transformation\" of your initial commit.",
    "created_at": "2017-06-20T16:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319465",
    "user": "https://github.com/fchapoton"
}
```

Hello Salvatore,

in fact, there is no hurry (py3 is still a long way ahead, sadly), but I was afraid that you were (besides being very busy with installation at your new job, which is very understandable) somewhat horrified by the complexity of the matter, and the various contradictory requirements.

Concerning your name on the commit, I did a rebase, keeping only your first commit and squashing the others into this one, then changing its commit message. Then I worked a little bit and rebased again. So I guess this is considered to some kind of "transformation" of your initial commit.



---

archive/issue_comments_319466.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-23T14:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319466",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319467.json:
```json
{
    "body": "1. Why was this doctest removed:\n\n```\nsage: A.delete_columns('junk')\n```\n\n\n2. This might be partially a style issue, but I hate code of the form\n\n```\ntry:\n    something()\nexcept TypeError:\n    raise TypeError(...)\n```\n\nbecause usually, the exception that is caught and thrown away contains more useful information that the newly raised exception. So I would replace this by\n\n```\nsomething()\n```\n",
    "created_at": "2017-06-23T14:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319467",
    "user": "https://github.com/jdemeyer"
}
```

1. Why was this doctest removed:

```
sage: A.delete_columns('junk')
```


2. This might be partially a style issue, but I hate code of the form

```
try:
    something()
except TypeError:
    raise TypeError(...)
```

because usually, the exception that is caught and thrown away contains more useful information that the newly raised exception. So I would replace this by

```
something()
```




---

archive/issue_comments_319468.json:
```json
{
    "body": "3. For efficiency, it is better to reverse these conditions (replace `A and B` by `B and A`):\n\n```\n        if (isinstance(x, (Iterator, Sequence)) and\n            not isinstance(x, (list, tuple))):\n```\n\nFirst of all, it's much cheaper to check if something is a `list` or `tuple` rather than some ABC type. Second, in many cases, the input will be a `list` or `tuple`, so then you don't even need the `(Iterator, Sequence)` check.\n\n4. Again for efficiency, move all imports of `Iterator, Sequence` to the top level, not inside the function. Since these are standard Python types, there should be no harm.",
    "created_at": "2017-06-23T14:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319468",
    "user": "https://github.com/jdemeyer"
}
```

3. For efficiency, it is better to reverse these conditions (replace `A and B` by `B and A`):

```
        if (isinstance(x, (Iterator, Sequence)) and
            not isinstance(x, (list, tuple))):
```

First of all, it's much cheaper to check if something is a `list` or `tuple` rather than some ABC type. Second, in many cases, the input will be a `list` or `tuple`, so then you don't even need the `(Iterator, Sequence)` check.

4. Again for efficiency, move all imports of `Iterator, Sequence` to the top level, not inside the function. Since these are standard Python types, there should be no harm.



---

archive/issue_comments_319469.json:
```json
{
    "body": "5. There is still a `list(range(3))` in `src/sage/matrix/matrix_modn_dense_template.pxi`",
    "created_at": "2017-06-23T14:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319469",
    "user": "https://github.com/jdemeyer"
}
```

5. There is still a `list(range(3))` in `src/sage/matrix/matrix_modn_dense_template.pxi`



---

archive/issue_comments_319470.json:
```json
{
    "body": "6. In `src/sage/matrix/matrix_modn_sparse.pyx`, there is no reason to raise an error for input which is not `Iterator, Sequence`. Just convert to `list` as you do in some other places.",
    "created_at": "2017-06-23T14:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319470",
    "user": "https://github.com/jdemeyer"
}
```

6. In `src/sage/matrix/matrix_modn_sparse.pyx`, there is no reason to raise an error for input which is not `Iterator, Sequence`. Just convert to `list` as you do in some other places.



---

archive/issue_comments_319471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-24T08:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319471",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-24T12:50:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319473.json:
```json
{
    "body": "I think I have taken all of your comments into account. Back to needs review.",
    "created_at": "2017-06-24T12:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319473",
    "user": "https://github.com/fchapoton"
}
```

I think I have taken all of your comments into account. Back to needs review.



---

archive/issue_comments_319474.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-06-24T12:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319474",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_319475.json:
```json
{
    "body": "In `parent_old.pyx`, better give up on trying to list all possible exceptions. If you replace that by `except Exception`, you can set this to positive review.",
    "created_at": "2017-06-26T08:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319475",
    "user": "https://github.com/jdemeyer"
}
```

In `parent_old.pyx`, better give up on trying to list all possible exceptions. If you replace that by `except Exception`, you can set this to positive review.



---

archive/issue_comments_319476.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-06-26T08:22:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319476",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_319477.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-26T11:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319477",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_319478.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-06-26T12:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319478",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_319479.json:
```json
{
    "body": "I took care of it.",
    "created_at": "2017-06-26T12:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319479",
    "user": "https://github.com/tscrim"
}
```

I took care of it.



---

archive/issue_comments_319480.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-06-29T06:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22870",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22870#issuecomment-319480",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
