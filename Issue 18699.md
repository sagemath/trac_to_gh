# Issue 18699: Poset plot won't accept heights argument if poset is ranked

Issue created by migration from https://trac.sagemath.org/ticket/18936

Original creator: robharron

Original creation time: 2015-07-22 01:01:12

CC:  jmantysalo

Keywords: Poset, plot

The current code for plotting a ranked poset doesn't check if the argument heights is None before creating its own heights dictionary. It then passes this dictionary to the Graph plotting function, which throws "TypeError: plot() got multiple values for keyword argument 'heights'".


---

Comment by jmantysalo created at 2015-07-22 03:04:07

I don't see how this relates to poset being ranked or not. `Posets.PentagonPoset().show(heights="junk")` gives same error.


---

Comment by robharron created at 2015-07-22 03:34:14

Replying to [comment:1 jmantysalo]:
> I don't see how this relates to poset being ranked or not. `Posets.PentagonPoset().show(heights="junk")` gives same error.

Quite right, I hadn't realized. But yeah the problem is that the heights keyword isn't popped off of kwds. I've been working on a fix and the first thing it does is pop heights off.


---

Comment by jmantysalo created at 2015-07-22 03:46:16

What you actually want to do? Maybe something like


```
g = Posets.PentagonPoset()._hasse_diagram
g.plot(save_pos=True, layout='acyclic')
g.set_pos({0: [62, 18], 1: [27, (162+90)/2], 2: [94, 90], 3: [99, 162], 4: [63, 234]})
g
```



---

Comment by jmantysalo created at 2015-07-22 05:38:28

About plotting in general: There is `element_labels` but `vertex_size`. Plotting poset is not fully "poset-aware". There are options that don't make sense, something like `xaxis`.

About not ranked posets, an idea: Let us define `grank` for connected poset. First find (some) longest chain of poset and let it's elements have granks 0, 1, 2.... Now define grank of other elements so that they are average of distances to elements of the longest chain. If for example there is "side-chain" of element a and b from longesth paht grank element 2 to longest path grank element 6, then a will have grank ((2+1)+(6-2))/2 and b will have grank ((2+2)+(6-1))/2. And now set vertical position of elements according to grank.


---

Comment by robharron created at 2015-07-22 05:52:06

What I originally set out to do was plot the subgroup lattice of a group so that subgroups of the same order are at the same height. So, I created the subgroup poset and tried passing the appropriate height dictionary and came across the error this ticket is about.

Of course, having fixed this problem, things still don't turn out so nicely since, for instance,


```
P = Poset([[1,2,3,4],[5],[5],[5],[5],[]])
heights = {1:[0], 2:[1,2,3], 3:[4], 4:[5]}
P.plot(heights=heights)
```


gives a plot where the arrow from 0 to 4 goes through 2 and the arrow from 2 to 5 goes through 4, so it looks like 0<2<4<5. Is there a way to get it to plot this better?


---

Comment by jmantysalo created at 2015-07-22 06:40:42

Replying to [comment:5 robharron]:

> gives a plot where the arrow from 0 to 4 goes through 2 and the arrow from 2 to 5 goes through 4, so it looks like 0<2<4<5. Is there a way to get it to plot this better?

AFAIK there is no good solution. There is some paper about drawing lattices, but Sage draws them just like all posets. And I have seen same problem, at least on https://groups.google.com/forum/#!search/Poset.show%28%29$20and$20symmetry/sage-support/-FGCEL0MJag/WZLONmtbBt0J I asked about something similar.

I think that in general this is a hard problem. However, it should not be that hard to at least try arranging elements on same level to minimize this problem.


---

Comment by jmantysalo created at 2015-07-22 09:33:30

Try `Poset({3:[4]}).plot(heights={1:['junk']})`. It shows that `heights`-argument is not checked and produces a ghost element.


---

Comment by robharron created at 2015-07-22 23:07:53

Replying to [comment:9 jmantysalo]:
> Try `Poset({3:[4]}).plot(heights={1:['junk']})`. It shows that `heights`-argument is not checked and produces a ghost element.

Yeah, that's somewhat orthogonal to this ticket, though. The ticket here is about a fairly simple bug and I think the code I pushed fixes it, though I'm waiting for patchbot to do a full doctest. The example you mention is a problem with the plotting function of graphs, the only thing the poset plotting function does to heights is create a heights parameter from the poset rank function, if it exists.


---

Comment by jmantysalo created at 2015-08-17 16:00:49

I think that this patch can go. You left it as new, not needs_review - are you planning some other changes?

The whole plot and (re)labeling is a mess. For example with this patch


```
P = Poset({0: [1,2], 1:[3]})
P = P.relabel(lambda x: chr(ord('a')+x))
heights = {1 : [0], 2 : [1], 3 : [2, 3]}
P.plot(heights=heights)
```


gives `KeyError: 'a'`.


---

Comment by robharron created at 2015-08-17 19:52:42

Replying to [comment:12 jmantysalo]:

I left it as new as I hadn't run a full doctest on it, assuming PatchBot was still doing that on here anyway. Should I just set it to needs_review? Will PatchBot check it then?


---

Comment by jmantysalo created at 2015-08-17 20:49:53

Replying to [comment:13 robharron]:

> I left it as new as I hadn't run a full doctest on it, assuming PatchBot was still doing that on here anyway. Should I just set it to needs_review? Will PatchBot check it then?

I don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.


---

Comment by robharron created at 2015-08-17 20:54:34

Replying to [comment:14 jmantysalo]:

> I don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.

Okay great! I made this patch on the sage cloud (I've stopped putting new versions of sage on my laptop) and I don't know what the etiquette is about using up cloud resources for a long doctest of the entire sage library. Do you?


---

Comment by jmantysalo created at 2015-08-18 05:56:10

Replying to [comment:15 robharron]:
> Replying to [comment:14 jmantysalo]:
> 
> > I don't know. But at least I can run `-t --long` in Sage with dot2tex installed on Linux tomorrow.
> 
> Okay great! I made this patch on the sage cloud (I've stopped putting new versions of sage on my laptop) and I don't know what the etiquette is about using up cloud resources for a long doctest of the entire sage library. Do you?

I don't know about that.

Contrary to what I said I am now running tests _without_ `dot2tex`. After this is done I should have time to installa `dot2tex` and run long tests on `posets/*` and all short tests. To me it is enought testing.

I think that you can put this to needs_review. Then I'll mark this as positive_review, assuming the tests succeeded.


---

Comment by jmantysalo created at 2015-08-18 07:45:00

Tests passed. However, after installing `dot2tex` it does no difference to say `P.show(heights=heights)` or `P.show()`. I guess if suffices to document this -- in any case, Sage with this patch is better than Sage without this.


---

Comment by jmantysalo created at 2015-09-18 09:23:10

Just pinging... If you change this to needs_review, I will change it to positive_review.

You can make a new ticket for `dot2tex` thing.


---

Comment by robharron created at 2015-11-18 23:47:26

Changing status from new to needs_review.


---

Comment by jmantysalo created at 2015-11-19 11:27:19

Changing status from needs_review to positive_review.


---

Comment by jmantysalo created at 2015-11-19 11:27:19

Still passed tests.


---

Comment by vbraun created at 2015-11-19 16:52:46

merge conflict, try with next beta


---

Comment by vbraun created at 2015-11-19 16:52:46

Changing status from positive_review to needs_work.


---

Comment by jmantysalo created at 2015-11-23 13:40:33

`robharron`, please check. I resolved the conflict.
----
New commits:


---

Comment by jmantysalo created at 2015-11-23 13:40:33

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2015-12-27 16:55:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-12-28 11:08:05

Resolution: fixed
