# Issue 17580: Error when taking resultant of polynomials over complicated base ring

archive/issues_017580.json:
```json
{
    "body": "CC:  @miguelmarco\n\nKeywords: polynomial resultant\n\nThe following apparently tries to convert `p` and `q` into a wrong common ring (even though they already both have parent `S`):\n\n```\nA.<a,b,c> = Frac(PolynomialRing(QQ,'a,b,c'))\nB.<d,e,f> = PolynomialRing(A,'d,e,f')\nR.<x>= PolynomialRing(B,'x')\nS.<y> = PolynomialRing(R,'y')\np = ((1/b^2*d^2+1/a)*x*y^2+a*b/c*y+e+x^2)\nq = -4*c^2*y^3+1\nprint(p.resultant(q))\nTraceback (most recent call last):\n...\nTypeError: not a constant polynomial\n```\n\nAnother (related?) bug:\n\n```\n(a*d*x^2+a+e+1).resultant(-4*c^2*x+1)\nTraceback (most recent call last):\n...\nRuntimeError: maximum recursion depth exceeded in cmp\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/17817\n\n",
    "created_at": "2015-02-20T17:10:03Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Error when taking resultant of polynomials over complicated base ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17580",
    "user": "https://github.com/pjbruin"
}
```
CC:  @miguelmarco

Keywords: polynomial resultant

The following apparently tries to convert `p` and `q` into a wrong common ring (even though they already both have parent `S`):

```
A.<a,b,c> = Frac(PolynomialRing(QQ,'a,b,c'))
B.<d,e,f> = PolynomialRing(A,'d,e,f')
R.<x>= PolynomialRing(B,'x')
S.<y> = PolynomialRing(R,'y')
p = ((1/b^2*d^2+1/a)*x*y^2+a*b/c*y+e+x^2)
q = -4*c^2*y^3+1
print(p.resultant(q))
Traceback (most recent call last):
...
TypeError: not a constant polynomial
```

Another (related?) bug:

```
(a*d*x^2+a+e+1).resultant(-4*c^2*x+1)
Traceback (most recent call last):
...
RuntimeError: maximum recursion depth exceeded in cmp
```


Issue created by migration from https://trac.sagemath.org/ticket/17817





---

archive/issue_comments_234382.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-17T09:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17580",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17580#issuecomment-234382",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_234383.json:
```json
{
    "body": "So some resultants that used to be computed using Singular will now go through `sylvester_matrix`\u2014is that correct? Do you know if it makes a significant difference in terms of speed?",
    "created_at": "2015-04-12T19:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17580",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17580#issuecomment-234383",
    "user": "https://github.com/mezzarobba"
}
```

So some resultants that used to be computed using Singular will now go through `sylvester_matrix`—is that correct? Do you know if it makes a significant difference in terms of speed?



---

archive/issue_comments_234384.json:
```json
{
    "body": "We would need to run benchmarks to make sure, but it is certainly possible that the sylvester matrix method would be faster than singular, at least in some cases.",
    "created_at": "2015-04-12T20:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17580",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17580#issuecomment-234384",
    "user": "https://github.com/miguelmarco"
}
```

We would need to run benchmarks to make sure, but it is certainly possible that the sylvester matrix method would be faster than singular, at least in some cases.



---

archive/issue_comments_234385.json:
```json
{
    "body": "Replying to [comment:2 mmezzarobba]:\n> So some resultants that used to be computed using Singular will now go through `sylvester_matrix`\u2014is that correct?\nPossibly, but this is only relevant when the polynomials are univariate polynomials over a multivariate polynomial ring.  The Sylvester matrix is only used if the coefficients cannot be converted to PARI; what probably happens in most cases is that the resultant is computed through PARI rather than Singular.  For genuine multivariate polynomials, Singular is still used via `MPolynomial_libsingular.resultant()`.\n> Do you know if it makes a significant difference in terms of speed?\nI don't know.  How about adding an `algorithm` keyword (which could be `pari`, `singular` or `sylvester` for now) so that the user can easily choose an implementation and we can compare the speed of the implementations?",
    "created_at": "2015-04-13T07:29:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17580",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17580#issuecomment-234385",
    "user": "https://github.com/pjbruin"
}
```

Replying to [comment:2 mmezzarobba]:
> So some resultants that used to be computed using Singular will now go through `sylvester_matrix`—is that correct?
Possibly, but this is only relevant when the polynomials are univariate polynomials over a multivariate polynomial ring.  The Sylvester matrix is only used if the coefficients cannot be converted to PARI; what probably happens in most cases is that the resultant is computed through PARI rather than Singular.  For genuine multivariate polynomials, Singular is still used via `MPolynomial_libsingular.resultant()`.
> Do you know if it makes a significant difference in terms of speed?
I don't know.  How about adding an `algorithm` keyword (which could be `pari`, `singular` or `sylvester` for now) so that the user can easily choose an implementation and we can compare the speed of the implementations?



---

archive/issue_comments_234386.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-13T19:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17580",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17580#issuecomment-234386",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_234387.json:
```json
{
    "body": "Replying to [comment:4 pbruin]:\n> I don't know.  How about adding an `algorithm` keyword (which could be `pari`, `singular` or `sylvester` for now) so that the user can easily choose an implementation and we can compare the speed of the implementations?\n\nOk, but then let's not block this ticket in the meantime if there is no significant regression to be expected.",
    "created_at": "2015-04-13T19:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17580",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17580#issuecomment-234387",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [comment:4 pbruin]:
> I don't know.  How about adding an `algorithm` keyword (which could be `pari`, `singular` or `sylvester` for now) so that the user can easily choose an implementation and we can compare the speed of the implementations?

Ok, but then let's not block this ticket in the meantime if there is no significant regression to be expected.



---

archive/issue_comments_234388.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T23:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17580",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17580#issuecomment-234388",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_016934.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-04-14T23:01:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17580",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17580#event-16934"
}
```
