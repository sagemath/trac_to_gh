# Issue 28770: faster permutation conversions between GAP and Sage

archive/issues_028770.json:
```json
{
    "body": "CC:  @fchapoton @tscrim @simonbrandhorst\n\n`PermutationGroupElement` conversions in C to and from GAP.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29007\n\n",
    "created_at": "2020-01-14T06:50:44Z",
    "labels": [
        "component: group theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "faster permutation conversions between GAP and Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28770",
    "user": "https://github.com/videlec"
}
```
CC:  @fchapoton @tscrim @simonbrandhorst

`PermutationGroupElement` conversions in C to and from GAP.

Issue created by migration from https://trac.sagemath.org/ticket/29007





---

archive/issue_comments_405894.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-14T06:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405894",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_405895.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-01-14T06:51:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405895",
    "user": "https://github.com/videlec"
}
```

New commits:



---

archive/issue_comments_405896.json:
```json
{
    "body": "Is there a reason why one would call `_set_libgap` outside of the element constructor? I really don't see why that should not be `cdef`. Then you could remove the second type check and the `raise TypeError` case.\n\nAlso, `cdef UInt2 * p2` looks weird to me, like it should be multiplication. Instead, I would follow \"correct\" C format `cdef UInt2* p2` since it is a `UInt2` pointer or the less optimal (but also common) `cdef UInt2 *p2`.",
    "created_at": "2020-01-14T07:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405896",
    "user": "https://github.com/tscrim"
}
```

Is there a reason why one would call `_set_libgap` outside of the element constructor? I really don't see why that should not be `cdef`. Then you could remove the second type check and the `raise TypeError` case.

Also, `cdef UInt2 * p2` looks weird to me, like it should be multiplication. Instead, I would follow "correct" C format `cdef UInt2* p2` since it is a `UInt2` pointer or the less optimal (but also common) `cdef UInt2 *p2`.



---

archive/issue_comments_405897.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-15T12:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405897",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405898.json:
```json
{
    "body": "Replying to [comment:2 tscrim]:\n> Is there a reason why one would call `_set_libgap` outside of the element constructor? I really don't see why that should not be `cdef`. Then you could remove the second type check and the `raise TypeError` case.\n\nSee #28652#comment:30\n\n> Also, `cdef UInt2 * p2` looks weird to me, like it should be multiplication. Instead, I would follow \"correct\" C format `cdef UInt2* p2` since it is a `UInt2` pointer or the less optimal (but also common) `cdef UInt2 *p2`.\n\nDone. I found `int* p` is very bad when multiple declarations comes in such as `int* p, q`.",
    "created_at": "2020-01-15T12:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405898",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:2 tscrim]:
> Is there a reason why one would call `_set_libgap` outside of the element constructor? I really don't see why that should not be `cdef`. Then you could remove the second type check and the `raise TypeError` case.

See #28652#comment:30

> Also, `cdef UInt2 * p2` looks weird to me, like it should be multiplication. Instead, I would follow "correct" C format `cdef UInt2* p2` since it is a `UInt2` pointer or the less optimal (but also common) `cdef UInt2 *p2`.

Done. I found `int* p` is very bad when multiple declarations comes in such as `int* p, q`.



---

archive/issue_comments_405899.json:
```json
{
    "body": "Replying to [comment:4 vdelecroix]:\n> Replying to [comment:2 tscrim]:\n> > Is there a reason why one would call `_set_libgap` outside of the element constructor? I really don't see why that should not be `cdef`. Then you could remove the second type check and the `raise TypeError` case.\n> \n> See #28652#comment:30\n\nI still do not see the point, but this is an improvement so I am not going to argue about it.\n\n> > Also, `cdef UInt2 * p2` looks weird to me, like it should be multiplication. Instead, I would follow \"correct\" C format `cdef UInt2* p2` since it is a `UInt2` pointer or the less optimal (but also common) `cdef UInt2 *p2`.\n> \n> Done.\n\nThere are others that need to be changed.\n\n> I found `int* p` is very bad when multiple declarations comes in such as `int* p, q`.\n\nIn this case, how I was told you should interpret `int*` is as the type \"an int pointer.\" So it once you see it a bit and get used to it, I don't look bad IMO.",
    "created_at": "2020-01-15T16:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405899",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:4 vdelecroix]:
> Replying to [comment:2 tscrim]:
> > Is there a reason why one would call `_set_libgap` outside of the element constructor? I really don't see why that should not be `cdef`. Then you could remove the second type check and the `raise TypeError` case.
> 
> See #28652#comment:30

I still do not see the point, but this is an improvement so I am not going to argue about it.

> > Also, `cdef UInt2 * p2` looks weird to me, like it should be multiplication. Instead, I would follow "correct" C format `cdef UInt2* p2` since it is a `UInt2` pointer or the less optimal (but also common) `cdef UInt2 *p2`.
> 
> Done.

There are others that need to be changed.

> I found `int* p` is very bad when multiple declarations comes in such as `int* p, q`.

In this case, how I was told you should interpret `int*` is as the type "an int pointer." So it once you see it a bit and get used to it, I don't look bad IMO.



---

archive/issue_comments_405900.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> Replying to [comment:4 vdelecroix]:\n> > Replying to [comment:2 tscrim]:\n> > I found `int* p` is very bad when multiple declarations comes in such as `int* p, q`.\n> \n> In this case, how I was told you should interpret `int*` is as the type \"an int pointer.\" So it once you see it a bit and get used to it, I don't look bad IMO.\n\nWhich is a wrong interpretation as `int* p, q` does not declare `q` as a pointer.",
    "created_at": "2020-01-15T16:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405900",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:5 tscrim]:
> Replying to [comment:4 vdelecroix]:
> > Replying to [comment:2 tscrim]:
> > I found `int* p` is very bad when multiple declarations comes in such as `int* p, q`.
> 
> In this case, how I was told you should interpret `int*` is as the type "an int pointer." So it once you see it a bit and get used to it, I don't look bad IMO.

Which is a wrong interpretation as `int* p, q` does not declare `q` as a pointer.



---

archive/issue_comments_405901.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-01-15T16:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_405902.json:
```json
{
    "body": "Replying to [comment:6 vdelecroix]:\n> Replying to [comment:5 tscrim]:\n> > Replying to [comment:4 vdelecroix]:\n> > > Replying to [comment:2 tscrim]:\n> > > I found `int* p` is very bad when multiple declarations comes in such as `int* p, q`.\n> > \n> > In this case, how I was told you should interpret `int*` is as the type \"an int pointer.\" So it once you see it a bit and get used to it, I don't look bad IMO.\n> \n> Which is a wrong interpretation as `int* p, q` does not declare `q` as a pointer.\n\nHmm...so then what I saw then was wrong (well, suppose to be limited to a single variable declaration). I also did a bit more digging, and where the `*` goes depends on more on whether they are trained as a C or C++ programmer. Now that makes me think the `*` should go with the variable. Anyways, we can just leave it as is if you don't want to make the change. Either way you decide to do it, you can set a positive review.",
    "created_at": "2020-01-15T17:15:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405902",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:6 vdelecroix]:
> Replying to [comment:5 tscrim]:
> > Replying to [comment:4 vdelecroix]:
> > > Replying to [comment:2 tscrim]:
> > > I found `int* p` is very bad when multiple declarations comes in such as `int* p, q`.
> > 
> > In this case, how I was told you should interpret `int*` is as the type "an int pointer." So it once you see it a bit and get used to it, I don't look bad IMO.
> 
> Which is a wrong interpretation as `int* p, q` does not declare `q` as a pointer.

Hmm...so then what I saw then was wrong (well, suppose to be limited to a single variable declaration). I also did a bit more digging, and where the `*` goes depends on more on whether they are trained as a C or C++ programmer. Now that makes me think the `*` should go with the variable. Anyways, we can just leave it as is if you don't want to make the change. Either way you decide to do it, you can set a positive review.



---

archive/issue_comments_405903.json:
```json
{
    "body": "My patchbot petitbonum reports (twice) an error (segmentation fault) in\n\n```\nsage -t --long src/sage/groups/perm_gps/cubegroup.py\n```\n\nthat seems to really come from this ticket, as the patchbot itself works fine on pristine sage 9.1.b0.",
    "created_at": "2020-01-15T18:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405903",
    "user": "https://github.com/fchapoton"
}
```

My patchbot petitbonum reports (twice) an error (segmentation fault) in

```
sage -t --long src/sage/groups/perm_gps/cubegroup.py
```

that seems to really come from this ticket, as the patchbot itself works fine on pristine sage 9.1.b0.



---

archive/issue_comments_405904.json:
```json
{
    "body": "Indeed. I can reproduce that!",
    "created_at": "2020-01-15T22:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405904",
    "user": "https://github.com/videlec"
}
```

Indeed. I can reproduce that!



---

archive/issue_comments_405905.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-15T22:40:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405906.json:
```json
{
    "body": "The problem that I was using some GAP internal functions without it being initialized properly. It should be fine now (at least tests pass on my computer).",
    "created_at": "2020-01-15T22:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405906",
    "user": "https://github.com/videlec"
}
```

The problem that I was using some GAP internal functions without it being initialized properly. It should be fine now (at least tests pass on my computer).



---

archive/issue_comments_405907.json:
```json
{
    "body": "Typo `_libap_` -> `_libgap_`.",
    "created_at": "2020-01-16T03:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405907",
    "user": "https://github.com/tscrim"
}
```

Typo `_libap_` -> `_libgap_`.



---

archive/issue_comments_405908.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-16T09:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405908",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405909.json:
```json
{
    "body": "oups. fixed.",
    "created_at": "2020-01-16T09:46:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405909",
    "user": "https://github.com/videlec"
}
```

oups. fixed.



---

archive/issue_comments_405910.json:
```json
{
    "body": "green bot, and looks good to me. Travis, do you approve ?",
    "created_at": "2020-01-16T12:39:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405910",
    "user": "https://github.com/fchapoton"
}
```

green bot, and looks good to me. Travis, do you approve ?



---

archive/issue_comments_405911.json:
```json
{
    "body": "Indeed. LGTM.",
    "created_at": "2020-01-16T15:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405911",
    "user": "https://github.com/tscrim"
}
```

Indeed. LGTM.



---

archive/issue_comments_405912.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-16T15:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405912",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_405913.json:
```json
{
    "body": "merci!",
    "created_at": "2020-01-16T16:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405913",
    "user": "https://github.com/videlec"
}
```

merci!



---

archive/issue_comments_405914.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-01-22T20:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405914",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_405915.json:
```json
{
    "body": "On Py2:\n\n```\n**********************************************************************\nFile \"src/sage/libs/gap/element.pyx\", line 671, in sage.libs.gap.element.GapElement._type_number\nFailed example:\n    x._type_number()\nExpected:\n    (0L, 'T_INT (integer)')\nGot:\n    (0, 'T_INT (integer)')\n**********************************************************************\n1 item had failures:\n   1 of   3 in sage.libs.gap.element.GapElement._type_number\n    [503 tests, 1 failure, 1.90 s]\n**********************************************************************\n```\n",
    "created_at": "2020-01-22T20:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405915",
    "user": "https://github.com/vbraun"
}
```

On Py2:

```
**********************************************************************
File "src/sage/libs/gap/element.pyx", line 671, in sage.libs.gap.element.GapElement._type_number
Failed example:
    x._type_number()
Expected:
    (0L, 'T_INT (integer)')
Got:
    (0, 'T_INT (integer)')
**********************************************************************
1 item had failures:
   1 of   3 in sage.libs.gap.element.GapElement._type_number
    [503 tests, 1 failure, 1.90 s]
**********************************************************************
```




---

archive/issue_comments_405916.json:
```json
{
    "body": "ok, this kind of annoying thing will be fixed later (similar to the problem fixed in #29049) but for the moment just use `...`\n\nEDIT: not sure if the sentence above makes any sense, but too tired to think right",
    "created_at": "2020-01-22T20:59:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405916",
    "user": "https://github.com/fchapoton"
}
```

ok, this kind of annoying thing will be fixed later (similar to the problem fixed in #29049) but for the moment just use `...`

EDIT: not sure if the sentence above makes any sense, but too tired to think right



---

archive/issue_comments_405917.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-01-23T08:01:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405917",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_405918.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-01-23T08:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405918",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_405919.json:
```json
{
    "body": "But then the doctest doesn't pass on Py3, right? I think Fr\u00e9d\u00e9ric was put `0...,` instead of `0,` or `0L,`.",
    "created_at": "2020-01-23T12:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405919",
    "user": "https://github.com/tscrim"
}
```

But then the doctest doesn't pass on Py3, right? I think Frédéric was put `0...,` instead of `0,` or `0L,`.



---

archive/issue_comments_405920.json:
```json
{
    "body": "It does pass on the patchbot.",
    "created_at": "2020-01-23T13:35:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405920",
    "user": "https://github.com/videlec"
}
```

It does pass on the patchbot.



---

archive/issue_comments_405921.json:
```json
{
    "body": "Ah, probably because of the other thing Fr\u00e9d\u00e9ric mentioned. Well, this will work for now.",
    "created_at": "2020-01-23T14:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405921",
    "user": "https://github.com/tscrim"
}
```

Ah, probably because of the other thing Frédéric mentioned. Well, this will work for now.



---

archive/issue_comments_405922.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-01-23T14:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405922",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_073472.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-01-25T17:27:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28770#event-73472"
}
```



---

archive/issue_comments_405923.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-01-25T17:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28770",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28770#issuecomment-405923",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
