# Issue 13749: (non)archimedian_local_height of a torsion points always gives 0

Issue created by migration from Trac.

Original creator: pbruin

Original creation time: 2013-01-14 17:53:49

Assignee: cremona

Keywords: local heights

For torsion points of elliptic curves over number fields, nonarchimedian_local_height incorrectly returns 0, and archimedian_local_height raises an error:

```
sage: K.<i> = QuadraticField(-1)
sage: E = EllipticCurve([0, 0, 0, K(1), 0])
sage: P = E(i, 0)
sage: P.nonarchimedian_local_height()
0
sage: P.archimedian_local_height()
NameError: global name 'QQ' is not defined
```


The correct behaviour (for the normalisation used in Sage) is

```
sage: P.nonarchimedian_local_height()
-1/2*log(2)
sage: P.archimedian_local_height()
0.346573590279973
```


Note: the same would happen for rational points on elliptic curves over Q, but computing local heights over Q is broken (see #13951).


---

Comment by pbruin created at 2013-01-14 18:12:42

Changing status from new to needs_review.


---

Comment by cremona created at 2013-01-14 20:37:26

2 quick questions: (1) is this patch based on #12509? (2) is your fix just to remove the wrong quick exit for torsion points (as appears)?


---

Comment by pbruin created at 2013-01-14 20:50:08

Replying to [comment:2 cremona]:
> (1) is this patch based on #12509?

No, but I have another branch where I made the same patch based on #12509; would it be better to upload that one?

> (2) is your fix just to remove the wrong quick exit for torsion points (as appears)?

Yes, the rest of the patch just adds a doctest.


---

Comment by cremona created at 2013-01-14 22:38:36

Replying to [comment:3 pbruin]:
> Replying to [comment:2 cremona]:
> > (1) is this patch based on #12509?
> 
> No, but I have another branch where I made the same patch based on #12509; would it be better to upload that one?

I think it would: you can add that ticket as a dependency of this one.  Then they should get merged together.


---

Comment by wuthrich created at 2013-05-04 19:24:18

Changing status from needs_review to positive_review.


---

Comment by wuthrich created at 2013-05-04 19:24:18

The patch applies cleanly to 5.9 after #12509. The tests pass and it does what it should do.


---

Comment by wuthrich created at 2013-05-14 09:37:41

Changing status from positive_review to needs_work.


---

Attachment

based on 5.9 + three patches of #12509


---

Comment by pbruin created at 2013-05-14 10:31:00

Changing status from needs_work to needs_review.


---

Comment by wuthrich created at 2013-05-14 16:29:02

Thanks for rebasing it. (Sorry for not commenting, the browser in my office decided to log me out permanently so I could not post a comment on what needs to be done).

I tested it again and it is again all fine.


---

Comment by wuthrich created at 2013-05-14 16:29:02

Changing status from needs_review to positive_review.


---

Comment by pbruin created at 2013-05-15 13:40:40

Thanks!  And no problem, it was clear what had to be done.


---

Comment by jdemeyer created at 2013-05-17 06:32:41

Resolution: fixed
