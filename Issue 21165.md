# Issue 21165: Doctest failure from #21165

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2016-09-02 15:56:52

CC:  dlucas jsm

The deprecation warnings introduced in #21165 causes failures when the optional package `gap_packages` is installed

```
**********************************************************************
File "src/sage/coding/linear_code.py", line 3059, in sage.coding.linear_code.AbstractLinearCode.weight_distribution
Failed example:
    C.weight_distribution(algorithm="leon")   # optional - gap_packages (Guava package)
Expected:
    [1, 0, 0, 7, 7, 0, 0, 1]
Got:
    doctest:warning
    ...
    DeprecationWarning: code2leon is deprecated. Please use sage.coding.linear_code._dump_code_in_leon_format instead.
    See http://trac.sagemath.org/21165 for details.
    [1, 0, 0, 7, 7, 0, 0, 1]
**********************************************************************
File "src/sage/coding/linear_code.py", line 3365, in sage.coding.linear_code.AbstractLinearCode.zeta_polynomial
Failed example:
    C = best_known_linear_code(6,3,GF(2))  # optional - gap_packages (Guava package)
Expected nothing
Got:
    doctest:warning
    ...
    DeprecationWarning: best_known_linear_code has moved to sage.coding.databases.best_linear_code_in_guava
    See http://trac.sagemath.org/21165 for details.
**********************************************************************
File "src/sage/coding/databases.py", line 32, in sage.coding.databases.best_linear_code_in_guava
Failed example:
    codes.databases.best_linear_code_in_guava(10,5,GF(2))    # long time; optional - gap_packages (Guava package)
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: Gap produced error output
    Error, Variable: 'BestKnownLinearCode' must have a value

       executing \$sage1:=BestKnownLinearCode(10,5,GF(2));;
**********************************************************************
File "src/sage/coding/databases.py", line 34, in sage.coding.databases.best_linear_code_in_guava
Failed example:
    gap.eval("C:=BestKnownLinearCode(10,5,GF(2))")           # long time; optional - gap_packages (Guava package)
Exception raised:
    Traceback (most recent call last):
    ...
    RuntimeError: Gap produced error output
    Error, Variable: 'BestKnownLinearCode' must have a value

       executing C:=BestKnownLinearCode(10,5,GF(2));
**********************************************************************
File "src/sage/coding/databases.py", line 82, in sage.coding.databases.bounds_on_minimum_distance_in_guava
Failed example:
    gap_rec = codes.databases.bounds_on_minimum_distance_in_guava(10,5,GF(2))  # optional - gap_packages (Guava package)
Exception raised:
    Traceback (most recent call last):
    ...
    RuntimeError: Gap produced error output
    Error, Variable: 'BoundsMinimumDistance' must have a value

       executing data := BoundsMinimumDistance(10,5,GF(2));
```



---

Comment by jdemeyer created at 2016-09-02 15:58:58

Changing priority from major to blocker.


---

Comment by jsrn created at 2016-09-04 16:08:52

Changing status from new to needs_review.


---

Comment by jsrn created at 2016-09-04 16:08:52

Fixed. Two failures were simply calling functions deprecated in #21165. Two failures were due to no loading of optional Gap package Guava, which wasn't a problem before #21165 because that package seemingly was imported earlier in the testing of `linear_code.py`.
----
New commits:


---

Comment by vbraun created at 2016-09-04 16:21:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-09-08 19:46:16

Resolution: fixed
