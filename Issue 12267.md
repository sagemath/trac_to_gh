# Issue 12267: symmetrica fails to compile with clang

archive/issues_012267.json:
```json
{
    "body": "Assignee: GeorgSWeber\n\nCC:  tscrim fbissey\n\nThere are a few functions that have return statements for void returns. Clang doesn't like this. The easiest solution is to add the cflag -Wreturn-type.\n\nI've posted an spkg at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/symmetrica-2.0.p8.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/symmetrica-2.0.p8.spkg).\n\nIssue created by migration from https://trac.sagemath.org/ticket/12439\n\n",
    "created_at": "2012-02-04T19:11:27Z",
    "labels": [
        "build",
        "major",
        "bug"
    ],
    "title": "symmetrica fails to compile with clang",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12267",
    "user": "ohanar"
}
```
Assignee: GeorgSWeber

CC:  tscrim fbissey

There are a few functions that have return statements for void returns. Clang doesn't like this. The easiest solution is to add the cflag -Wreturn-type.

I've posted an spkg at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/symmetrica-2.0.p8.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/symmetrica-2.0.p8.spkg).

Issue created by migration from https://trac.sagemath.org/ticket/12439





---

archive/issue_comments_144076.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-04T19:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144076",
    "user": "ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_144077.json:
```json
{
    "body": "Please fill in your real name as Author.",
    "created_at": "2012-07-27T20:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144077",
    "user": "jdemeyer"
}
```

Please fill in your real name as Author.



---

archive/issue_comments_144078.json:
```json
{
    "body": "Changing component from build to packages.",
    "created_at": "2012-08-13T12:33:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144078",
    "user": "jdemeyer"
}
```

Changing component from build to packages.



---

archive/issue_comments_144079.json:
```json
{
    "body": "Attachment [symmetrica-2.0.p8.diff](tarball://root/attachments/some-uuid/ticket12439/symmetrica-2.0.p8.diff) by jdemeyer created at 2013-06-03 15:22:14",
    "created_at": "2013-06-03T15:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144079",
    "user": "jdemeyer"
}
```

Attachment [symmetrica-2.0.p8.diff](tarball://root/attachments/some-uuid/ticket12439/symmetrica-2.0.p8.diff) by jdemeyer created at 2013-06-03 15:22:14



---

archive/issue_comments_144080.json:
```json
{
    "body": "Changed `Wreturn-type` to `Wno-return-type` :-) It now builds with Clang 3.2.",
    "created_at": "2013-06-03T15:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144080",
    "user": "jdemeyer"
}
```

Changed `Wreturn-type` to `Wno-return-type` :-) It now builds with Clang 3.2.



---

archive/issue_comments_144081.json:
```json
{
    "body": "Andrew, do you feel like reviewing this?",
    "created_at": "2013-06-07T14:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144081",
    "user": "jdemeyer"
}
```

Andrew, do you feel like reviewing this?



---

archive/issue_comments_144082.json:
```json
{
    "body": "This needs to rebased to the latest Symmetrica spkg. Since nobody seems to care, I'm not going to do that.",
    "created_at": "2013-10-28T14:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144082",
    "user": "jdemeyer"
}
```

This needs to rebased to the latest Symmetrica spkg. Since nobody seems to care, I'm not going to do that.



---

archive/issue_comments_144083.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-10-28T14:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144083",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144084.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-02T23:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144084",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144085.json:
```json
{
    "body": "Give this a try. The function that was marked with an `int` return type really should have been a `void`. I've added the compiler flag to the branch as well.\n----\nNew commits:",
    "created_at": "2016-10-02T23:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144085",
    "user": "tscrim"
}
```

Give this a try. The function that was marked with an `int` return type really should have been a `void`. I've added the compiler flag to the branch as well.
----
New commits:



---

archive/issue_comments_144086.json:
```json
{
    "body": "I am afraid I cannot accept that. You are mistaken in thinking the function should have been `void`\n\n```\nstatic int rec01(INT ni, OP vec)\n/* to compute number of partitions */\n{\n    INT erg = OK;\n    if (ni<0) return;\n    if (not EMPTYP(S_V_I(vec,ni))) return;\n    else if (ni<=1) M_I_I(1,S_V_I(vec,ni));\n    else {\n\n        INT m,og;\n        og = ni/3+3;\n        m_i_i(0,S_V_I(vec,ni));\n\n        for (m=1;m<og;m++)\n        {\n            INT j;\n            j = ni-m*(3*m-1)/2;\n            if (j<0) break;\n            if (m%2==0) { ADDINVERS_APPLY(S_V_I(vec,j));\n                          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));\n                          ADDINVERS_APPLY(S_V_I(vec,j));\n                        }\n            else          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));\n            j = ni-m*(3*m+1)/2;\n            if (j<0) break;\n            if (m%2==0) { ADDINVERS_APPLY(S_V_I(vec,j));\n                          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));\n                          ADDINVERS_APPLY(S_V_I(vec,j));\n                        }\n            else          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));\n            }\n        }\n    ENDR(\"internal:rec01\");\n}\n```\n\nThe error here is in thinking that there is only a couple of instances of `return;` in the function and that you reach the end of it without a `return`. But `ENDR` is a macro defined in `macro.h`\n\n```\n#define ENDR(a) endr_ende: if (erg != OK) EDC(a); return erg;\n```\n\nSo you have a final `return` of an integer value. It is just hidden. By default `gcc` converts the `return;` statements to `return 0;` in that case and that's what we should do.\n\nAnd we don't want to add that flag to `spkg-install`.",
    "created_at": "2016-10-03T00:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144086",
    "user": "fbissey"
}
```

I am afraid I cannot accept that. You are mistaken in thinking the function should have been `void`

```
static int rec01(INT ni, OP vec)
/* to compute number of partitions */
{
    INT erg = OK;
    if (ni<0) return;
    if (not EMPTYP(S_V_I(vec,ni))) return;
    else if (ni<=1) M_I_I(1,S_V_I(vec,ni));
    else {

        INT m,og;
        og = ni/3+3;
        m_i_i(0,S_V_I(vec,ni));

        for (m=1;m<og;m++)
        {
            INT j;
            j = ni-m*(3*m-1)/2;
            if (j<0) break;
            if (m%2==0) { ADDINVERS_APPLY(S_V_I(vec,j));
                          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));
                          ADDINVERS_APPLY(S_V_I(vec,j));
                        }
            else          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));
            j = ni-m*(3*m+1)/2;
            if (j<0) break;
            if (m%2==0) { ADDINVERS_APPLY(S_V_I(vec,j));
                          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));
                          ADDINVERS_APPLY(S_V_I(vec,j));
                        }
            else          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));
            }
        }
    ENDR("internal:rec01");
}
```

The error here is in thinking that there is only a couple of instances of `return;` in the function and that you reach the end of it without a `return`. But `ENDR` is a macro defined in `macro.h`

```
#define ENDR(a) endr_ende: if (erg != OK) EDC(a); return erg;
```

So you have a final `return` of an integer value. It is just hidden. By default `gcc` converts the `return;` statements to `return 0;` in that case and that's what we should do.

And we don't want to add that flag to `spkg-install`.



---

archive/issue_comments_144087.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-03T00:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144087",
    "user": "fbissey"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144088.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-10-03T01:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144088",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_144089.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-03T01:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144089",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144090.json:
```json
{
    "body": "My fault, I should have read deeper into the code. Fixed.",
    "created_at": "2016-10-03T01:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144090",
    "user": "tscrim"
}
```

My fault, I should have read deeper into the code. Fixed.



---

archive/issue_comments_144091.json:
```json
{
    "body": "All forgiven :) I am doing a new run of compiling with clang (3.8.0 I have upgraded to sierra and xcode 8.0) on my mac. I'll put that in, that should be the proverbial proof of the pudding.",
    "created_at": "2016-10-03T01:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144091",
    "user": "fbissey"
}
```

All forgiven :) I am doing a new run of compiling with clang (3.8.0 I have upgraded to sierra and xcode 8.0) on my mac. I'll put that in, that should be the proverbial proof of the pudding.



---

archive/issue_comments_144092.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-03T02:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144092",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_144093.json:
```json
{
    "body": "Good to go.",
    "created_at": "2016-10-03T02:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144093",
    "user": "fbissey"
}
```

Good to go.



---

archive/issue_comments_144094.json:
```json
{
    "body": "Thank you.",
    "created_at": "2016-10-03T03:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144094",
    "user": "tscrim"
}
```

Thank you.



---

archive/issue_comments_144095.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-03T17:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12267",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12267#issuecomment-144095",
    "user": "vbraun"
}
```

Resolution: fixed
