# Issue 12267: symmetrica fails to compile with clang

Issue created by migration from Trac.

Original creator: ohanar

Original creation time: 2012-02-04 19:11:27

Assignee: GeorgSWeber

CC:  tscrim fbissey

There are a few functions that have return statements for void returns. Clang doesn't like this. The easiest solution is to add the cflag -Wreturn-type.

I've posted an spkg at [http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/symmetrica-2.0.p8.spkg](http://wstein.org/home/ohanar/clang-port/sage-5.0.beta1-src/spkg/standard/symmetrica-2.0.p8.spkg).


---

Comment by ohanar created at 2012-02-04 19:11:57

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2012-07-27 20:41:18

Please fill in your real name as Author.


---

Comment by jdemeyer created at 2012-08-13 12:33:47

Changing component from build to packages.


---

Attachment


---

Comment by jdemeyer created at 2013-06-03 15:32:40

Changed `Wreturn-type` to `Wno-return-type` :-) It now builds with Clang 3.2.


---

Comment by jdemeyer created at 2013-06-07 14:35:56

Andrew, do you feel like reviewing this?


---

Comment by jdemeyer created at 2013-10-28 14:04:34

This needs to rebased to the latest Symmetrica spkg. Since nobody seems to care, I'm not going to do that.


---

Comment by jdemeyer created at 2013-10-28 14:04:34

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2016-10-02 23:51:32

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-10-02 23:51:32

Give this a try. The function that was marked with an `int` return type really should have been a `void`. I've added the compiler flag to the branch as well.
----
New commits:


---

Comment by fbissey created at 2016-10-03 00:31:51

I am afraid I cannot accept that. You are mistaken in thinking the function should have been `void`

```
static int rec01(INT ni, OP vec)
/* to compute number of partitions */
{
    INT erg = OK;
    if (ni<0) return;
    if (not EMPTYP(S_V_I(vec,ni))) return;
    else if (ni<=1) M_I_I(1,S_V_I(vec,ni));
    else {

        INT m,og;
        og = ni/3+3;
        m_i_i(0,S_V_I(vec,ni));

        for (m=1;m<og;m++)
        {
            INT j;
            j = ni-m*(3*m-1)/2;
            if (j<0) break;
            if (m%2==0) { ADDINVERS_APPLY(S_V_I(vec,j));
                          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));
                          ADDINVERS_APPLY(S_V_I(vec,j));
                        }
            else          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));
            j = ni-m*(3*m+1)/2;
            if (j<0) break;
            if (m%2==0) { ADDINVERS_APPLY(S_V_I(vec,j));
                          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));
                          ADDINVERS_APPLY(S_V_I(vec,j));
                        }
            else          ADD_APPLY(S_V_I(vec,j),S_V_I(vec,ni));
            }
        }
    ENDR("internal:rec01");
}
```

The error here is in thinking that there is only a couple of instances of `return;` in the function and that you reach the end of it without a `return`. But `ENDR` is a macro defined in `macro.h`

```
#define ENDR(a) endr_ende: if (erg != OK) EDC(a); return erg;
```

So you have a final `return` of an integer value. It is just hidden. By default `gcc` converts the `return;` statements to `return 0;` in that case and that's what we should do.

And we don't want to add that flag to `spkg-install`.


---

Comment by fbissey created at 2016-10-03 00:31:51

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-10-03 01:31:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2016-10-03 01:36:42

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2016-10-03 01:36:42

My fault, I should have read deeper into the code. Fixed.


---

Comment by fbissey created at 2016-10-03 01:42:36

All forgiven :) I am doing a new run of compiling with clang (3.8.0 I have upgraded to sierra and xcode 8.0) on my mac. I'll put that in, that should be the proverbial proof of the pudding.


---

Comment by fbissey created at 2016-10-03 02:51:59

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2016-10-03 02:51:59

Good to go.


---

Comment by tscrim created at 2016-10-03 03:56:44

Thank you.


---

Comment by vbraun created at 2016-10-03 17:41:41

Resolution: fixed
