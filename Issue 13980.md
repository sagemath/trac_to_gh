# Issue 13980: Fix # optional tags

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2013-02-26 09:12:17

Assignee: mvngu

CC:  jpflori dimpase




---

Comment by kcrisman created at 2013-02-26 16:59:20

Isn't this exactly the kind of huge intrusive patch we've been trying to avoid?  ;-)  That said, it would be really nice to have standardization for people to look at, so I'm not opposed to this.

Stuff to fix and/or think about doing as long as this ticket is opened.

 * The sage/coding/guava.py should have the same message as the ones in sage/coding/code_bounds.py and sage/coding/linear_code.py 
 * `# long time; optional - internet ` and in another place, reversed - I assume that won't matter, but just asking in case
 * `# optional - database_hohel` - I don't know of a Hohel in Sage development, but I bet [the database_kohel spkg](http://sagemath.org/packages/optional/database_kohel-20060803.spkg) is what is meant :-)
 * Did we change the `convert` ones to `ImageMagick`, or vice versa?  Anyway, that should be standardized if it wasn't already elsewhere (this feels familiar)
 * I'm not sure why something can depend on dot2tex but not graphviz, and even more weirdly, graphviz is experimental, but not dot2tex ?!?!?  Though I guess it is okay...
 * sometimes `octave`, sometimes `Octave` - does capitalization matter?  Same with `Axiom`.
 * `somewhat random` - is that an official designation?
 * `< 1/100th of a second ` - well, I guess it might be!  I guess we can leave that.
 * What is the `time` command?  The one that we always have?  I'm confused here.

```
sage: q = qsieve(n, block=False, time=True)           # optional - time 
```

 * The `sage/lfunctions/sympow.py` test seems ... odd.  Should it instead be long test?  Note that the previous command just says optional, with no indication of why.
 * `# optional - FES, random` - does it matter if random is before or after?  I would think this is going to look for the `random` spkg.  Same with `# optional; randomly growing. `

Otherwise looks good - I did look at all of them by hand, not the script.  Though obviously I am not going to try to test all of these optional tests by hand.


---

Comment by jdemeyer created at 2013-02-26 20:58:45

Replying to [comment:7 kcrisman]:
> Isn't this exactly the kind of huge intrusive patch we've been trying to avoid?  ;-)
Not really. Huge intrusive patches are okay as long as they serve a purpose. Removing whitespace all over the place doesn't serve a purpose, this patch certainly does.

This patch is mainly motivated by #12415, which has different (more strict) parsing for `# optional`, leading to less false positives (but also less true positives, hence this patch).

>  * The sage/coding/guava.py should have the same message as the ones in sage/coding/code_bounds.py and sage/coding/linear_code.py
OK, I'll have a look.

>  * `# long time; optional - internet ` and in another place, reversed - I assume that won't matter, but just asking in case
Doesn't matter.

>  * `# optional - database_hohel` - I don't know of a Hohel in Sage development, but I bet [the database_kohel spkg](http://sagemath.org/packages/optional/database_kohel-20060803.spkg) is what is meant :-)
OK, so that's a typo.

>  * Did we change the `convert` ones to `ImageMagick`, or vice versa?  Anyway, that should be standardized if it wasn't already elsewhere (this feels familiar)
I have no idea.

>  * I'm not sure why something can depend on dot2tex but not graphviz, and even more weirdly, graphviz is experimental, but not dot2tex ?!?!?  Though I guess it is okay...
I have no idea what these packages are.

>  * sometimes `octave`, sometimes `Octave` - does capitalization matter?  Same with `Axiom`.
OK, changing to all lowercase.

>  * `somewhat random` - is that an official designation?
The doctester looks for "random", so it will be recognized. I think it's fine.

>  * `< 1/100th of a second ` - well, I guess it might be!  I guess we can leave that.
This can be seen as "just a comment" without further meaning.

>  * What is the `time` command?  The one that we always have?  I'm confused here.
I have no idea.

>  * The `sage/lfunctions/sympow.py` test seems ... odd.  Should it instead be long test?  Note that the previous command just says optional, with no indication of why.
True, it's odd. I think it means that you need to run `sympow` first to create some tables, but I don't know more.

>  * `# optional - FES, random` - does it matter if random is before or after?  I would think this is going to look for the `random` spkg.  Same with `# optional; randomly growing. `
At least with the _new_ doctester (which is what we're aiming for), `optional - FES, random` will only require `FES`.

> Though obviously I am not going to try to test all of these optional tests by hand.
That is also most certainly not the point of this ticket.


---

Comment by jdemeyer created at 2013-02-26 21:51:41

Changing status from new to needs_review.


---

Comment by kcrisman created at 2013-02-27 03:32:20

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2013-02-27 03:32:20

> This patch is mainly motivated by #12415, which has different (more strict) parsing for `# optional`, leading to less false positives (but also less true positives, hence this patch).
I figured :)
> >  * Did we change the `convert` ones to `ImageMagick`, or vice versa?  Anyway, that should be standardized if it wasn't already elsewhere (this feels familiar)
> I have no idea.
I was right - we did change it to the program needed.  `search_src('ImageMagick')` gets me a lot of hits, particularly in plot/animate.py

```
plot/animate.py:430:            sage: a.show()       # optional -- ImageMagick
plot/animate.py:435:            sage: a.show(iterations=3)    # optional -- ImageMagick
plot/animate.py:439:            sage: a.show(delay=50)        # optional -- ImageMagick
```

I think this needs to be uniformized.  See #11170, where this was done, except apparently to the guys here (see also #10655 and #7981 for background).  By the way, is the `--` versus `-` important?
> >  * I'm not sure why something can depend on dot2tex but not graphviz, and even more weirdly, graphviz is experimental, but not dot2tex ?!?!?  Though I guess it is okay...
> I have no idea what these packages are.
It's ok, I think this is okay after looking at the various package lists.
> >  * `somewhat random` - is that an official designation?
> The doctester looks for "random", so it will be recognized. I think it's fine.
Ok
> >  * `< 1/100th of a second ` - well, I guess it might be!  I guess we can leave that.
> This can be seen as "just a comment" without further meaning.
Just wanted to make sure that additional comments were okay in doctest lines.
> >  * What is the `time` command?  The one that we always have?  I'm confused here.
> I have no idea.
Got it - see the line above them (which your script didn't catch)?

```
sage: v, t = qsieve(n, time=True)   # uses the sieve    (optional: time doesn't work on cygwin) 
```

This line should be changed to "look nice", and now we know why this was marked optional.  It hardly seems fair to make something optional that only doesn't work on a not-yet-supported platform... maybe we should remove these as optional?  I'll leave that to you.
> >  * The `sage/lfunctions/sympow.py` test seems ... odd.  Should it instead be long test?  Note that the previous command just says optional, with no indication of why.
> True, it's odd. I think it means that you need to run `sympow` first to create some tables, but I don't know more.
I believe you are right.  But the doctest makes no sense as an automatic doctest in that case.  See [the relevant note](http://hg.sagemath.org/sage-main/file/5714ed3eab6a/sage/lfunctions/sympow.py#l116).  In fact, I get the bizarre (newlines not rendered)

```
sage: a = sympow.L(EllipticCurve('11a'), 2, 16); a 
"Inertia Group is  C1 MULTIPLICATIVE REDUCTION\nConductor is 11\n**ERROR** P02L not found in param_data file\nIt can be added with './sympow -new_data 2'"
```

So I believe that both of them should probably be made `optional - precomputations`, or perhaps even better to add 

```
sage: sympow('-new_data 2') # not tested
```

to the doctest and make them all not tested, since by definition someone would have to do something "by hand" to make them testable.  Or do you have another creative solution?  I can think of a couple, but they are annoying and probably pointless.   

There should also be better error catching there, but I figure anyone using sympow knows what they are doing enough to read the documentation - or is that worth a ticket as well?


---

Comment by jdemeyer created at 2013-02-27 09:28:26

Replying to [comment:11 kcrisman]:
> I was right - we did change it to the program needed.  `search_src('ImageMagick')` gets me a lot of hits, particularly in plot/animate.py
> {{{
> plot/animate.py:430:            sage: a.show()       # optional -- ImageMagick
> plot/animate.py:435:            sage: a.show(iterations=3)    # optional -- ImageMagick
> plot/animate.py:439:            sage: a.show(delay=50)        # optional -- ImageMagick
> }}}
> I think this needs to be uniformized.
Done, changed all to `optional -- ImageMagick`.

> By the way, is the `--` versus `-` important?
No, I used a double dash for consistency here.

> {{{
> sage: v, t = qsieve(n, time=True)   # uses the sieve    (optional: time doesn't work on cygwin) 
> }}}
> This line should be changed to "look nice", and now we know why this was marked optional.
Fixed.

> I believe you are right.  But the doctest makes no sense as an automatic doctest in that case.  See [the relevant note](http://hg.sagemath.org/sage-main/file/5714ed3eab6a/sage/lfunctions/sympow.py#l116).  In fact, I get the bizarre (newlines not rendered)
> {{{
> sage: a = sympow.L(EllipticCurve('11a'), 2, 16); a 
> "Inertia Group is  C1 MULTIPLICATIVE REDUCTION\nConductor is 11\n**ERROR** P02L not found in param_data file\nIt can be added with './sympow -new_data 2'"
> }}}
> So I believe that both of them should probably be made `optional - precomputations`, or perhaps even better to add 
> {{{
> sage: sympow('-new_data 2') # not tested
> }}}
> to the doctest and make them all not tested, since by definition someone would have to do something "by hand" to make them testable.
Done.

> There should also be better error catching there, but I figure anyone using sympow knows what they are doing enough to read the documentation - or is that worth a ticket as well?
Technically, it's worth a ticket but I have no plans to work on it.


---

Comment by jdemeyer created at 2013-02-27 10:49:26

Changing status from needs_work to needs_review.


---

Attachment


---

Comment by kcrisman created at 2013-02-27 16:33:45

> > So I believe that both of them should probably be made `optional - precomputations`, or perhaps even better to add 
> > {{{
> > sage: sympow('-new_data 2') # not tested
> > }}}
> > to the doctest and make them all not tested, since by definition someone would have to do something "by hand" to make them testable.
> Done.
Note that technically ```sympow -new_data 2``` isn't needed; `sage: sympow('-new_data 2') ` is just as good, and has the advantage of being able to be included in the doctests (`# not tested`, of course).  May I ask for that very slight change in the "manual" patch - just so people don't think they _have_ to go to the shell?
> > There should also be better error catching there, but I figure anyone using sympow knows what they are doing enough to read the documentation - or is that worth a ticket as well?
> Technically, it's worth a ticket but I have no plans to work on it.
Nor do I.


---

Comment by jdemeyer created at 2013-02-27 19:45:03

Judging from sage-devel, it seems that `time` does work on Cygwin now (probably it didn't in some earlier version), so I removed `optional - time`. I also clarified the SYMPOW precomputations as you suggested.


---

Comment by kcrisman created at 2013-02-27 22:06:25

Replying to [comment:16 jdemeyer]:
> Judging from sage-devel, it seems that `time` does work on Cygwin now (probably it didn't in some earlier version), so I removed `optional - time`. I also clarified the SYMPOW precomputations as you suggested.
See [this comment on Trac 9164](http://trac.sagemath.org/sage_trac/ticket/9164#comment:3).  What do you think we should do?  I'm almost wondering whether it's worth keeping your current patch and then opening a ticket acknowledging that this doesn't work on Cygwin...


---

Comment by kcrisman created at 2013-02-27 22:06:33

But otherwise positive review.


---

Comment by jpflori created at 2013-02-27 22:09:27

I'd say leave this ticket as is and modify the code to try using time on Cygwin and suggesting installing the time package if it fails (or not using time=True) in another ticket.


---

Comment by kcrisman created at 2013-02-27 22:11:19

Replying to [comment:19 jpflori]:
> I'd say leave this ticket as is and modify the code to try using time on Cygwin and suggesting installing the time package if it fails (or not using time=True) in another ticket.
So in other words, _not_ re-enabling optional, with the realization that we'll have a purposely failing doctest on Cygwin.  I don't really have a problem with this.


---

Comment by kcrisman created at 2013-02-27 22:11:19

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2013-02-27 22:19:00

Exactly, but opening a follow up ticket.
It's now #14202


---

Comment by jdemeyer created at 2013-02-28 07:44:37

Since the "time" problem has nothing to do with Cygwin, I will keep the

```
# optional - time
```

tags.


---

Comment by jdemeyer created at 2013-02-28 07:44:47

Changing status from positive_review to needs_work.


---

Attachment

New version of [attachment:14184_manual.patch] needs review.


---

Comment by jdemeyer created at 2013-02-28 09:35:14

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2013-02-28 14:49:22

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2013-02-28 14:49:22

Patchbot is confused... apply 14184_optional.patch and 14184_manual.patch


---

Comment by jdemeyer created at 2013-03-02 12:49:44

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-03-02 12:50:18

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2013-03-02 12:50:18

I found some more which I missed initially.


---

Attachment


---

Comment by kcrisman created at 2013-03-02 14:52:58

I'm sure there will always be more...


---

Comment by kcrisman created at 2013-03-02 14:52:58

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-03-04 07:38:41

Resolution: fixed
