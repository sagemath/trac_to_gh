# Issue 29501: perhaps symbolic expressions should not have a length

Issue created by migration from https://trac.sagemath.org/ticket/29738

Original creator: @DaveWitteMorris

Original creation time: 2020-05-27 00:39:30

CC:  behackl slelievre dkrenn saliola mjo

Keywords: length

This ticket was opened to ensure that an issue raised in the comments of #10980 is not lost when that ticket is closed.

From a mathematical viewpoint, it makes sense to talk about the length of a symbolic expression:

```
sage: len(2*x^2 + 3+x - 5)
3
```

However, this is does not seem pythonic, because only container-type objects should have a `len`. Therefore, it was suggested in the comments of #10980 that it might be a good idea to take away the `len` from symbolic expressions (and this could be discussed on sage-devel).

Related ticket: #28053 (adding length of a propositional formula function in the Logic Module)


---

Comment by slabbe created at 2020-05-27 08:41:08

Since `'sage.symbolic.expression.Expression' object is not iterable`, I agree it should have no length:

```
sage: 2*x^2 + 3*x - 5
2*x^2 + 3*x - 5
sage: list(_)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-1a5b60e28d67> in <module>()
----> 1 list(_)

TypeError: 'sage.symbolic.expression.Expression' object is not iterable
```



---

Comment by mkoeppe created at 2021-07-05 23:17:10

I also agree. Let's deprecate it.


---

Comment by mkoeppe created at 2021-07-06 00:33:03


```
sage -t --random-seed=0 src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 5877, in sage.symbolic.expression.Expression.__len__
Failed example:
    len(a)
Expected:
    0
Got:
    doctest:warning
sage -t --random-seed=0 src/sage/geometry/riemannian_manifolds/parametrized_surface3d.py
**********************************************************************
File "src/sage/geometry/riemannian_manifolds/parametrized_surface3d.py", line 88, in sage.geometry.riemannian_manifolds.parametrized_surface3d.ParametrizedSurface3D
Failed example:
    eparaboloid = ParametrizedSurface3D((u, v, u^2 + v^2), (u, v),'elliptic paraboloid'); eparaboloid
Expected:
    Parametrized surface ('elliptic paraboloid') with equation (u, v, u^2 + v^2)
Got:
    doctest:warning
...
    [298 tests, 42 failures, 37.94 s]
sage -t --random-seed=0 src/sage/calculus/desolvers.py
**********************************************************************
File "src/sage/calculus/desolvers.py", line 1634, in sage.calculus.desolvers.?
Failed example:
    sol=desolve_odeint(f,ic,t,y,rtol=1e-9,atol=1e-10,compute_jac=True)
Expected nothing
Got:
    doctest:warning
sage -t --random-seed=0 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4033, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.diff_op
Failed example:
    len(DD[(0, 1, 2)])
Expected:
    246
Got:
    doctest:warning
```

Only used in 3 files.
----
New commits:


---

Comment by git created at 2021-07-06 01:51:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-06 02:32:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-06 02:34:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-07-06 02:35:53

Changing status from new to needs_review.


---

Comment by slelievre created at 2021-07-06 09:49:59

I opened #32144 to provide another measure
of an expression's complexity.


---

Comment by git created at 2021-07-17 21:49:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-07-17 21:49:33

Merged updated #32139


---

Comment by dkrenn created at 2021-07-19 09:02:44

Replying to [comment:8 mkoeppe]:
> {{{
> sage -t --random-seed=0 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py
> **********************************************************************
> File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4033, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.diff_op
> Failed example:
>     len(DD[(0, 1, 2)])
> Expected:
>     246
> Got:
>     doctest:warning
> }}}

Solved this one.
----
New commits:


---

Comment by dkrenn created at 2021-07-19 09:11:33

Code/changes here on this ticket LGTM. I have the following minor comments:

1. Failing doctests (deprecation warning shown) which need to be updated (remove use of `len`)

2. FWIW `all_vars = set([])` could simply be `all_vars = set()` (but I know this comes from the original code

3. When fixing 2, we could directly replace

```
+        all_vars = set([])
+        all_vars.update(*[de.variables() for de in des])
```

  by

```
+        all_vars = set().union(*[de.variables() for de in des])
```


4. The change

```
-        if len(variables[0]):
+        if isinstance(variables[0], (list, tuple)):
```

seems to change its functionality. In the line after this, `variables[0][0]` is used which will fail if there is nothing in `variables[0]`. (The `variables[0][1:3]` will simply give an empty list, which seems to be intended, so no peoblem here.)


---

Comment by dkrenn created at 2021-07-19 09:11:33

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2021-07-19 11:43:03

ad 4 - this `if` is only dispatching between the two fixed formats described in the docstring
----
New commits:


---

Comment by dkrenn created at 2021-07-19 12:08:20

Replying to [comment:21 mkoeppe]:
> ad 4 - this `if` is only dispatching between the two fixed formats described in the docstring

Ok, I see now.


---

Comment by mkoeppe created at 2021-07-19 12:15:19

Changing status from needs_work to needs_review.


---

Comment by git created at 2021-07-21 01:49:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2021-07-22 13:35:15

LGTM. No one would ever guess what `len(expr)` does without looking it up, and `expr.number_of_operands()` is much clearer.


---

Comment by mjo created at 2021-07-22 13:35:15

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-07-22 14:42:22

Thanks!


---

Comment by vbraun created at 2021-07-25 13:25:57

Resolution: fixed
