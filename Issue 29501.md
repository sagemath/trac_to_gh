# Issue 29501: perhaps symbolic expressions should not have a length

archive/issues_029501.json:
```json
{
    "body": "CC:  behackl slelievre dkrenn saliola mjo\n\nKeywords: length\n\nThis ticket was opened to ensure that an issue raised in the comments of #10980 is not lost when that ticket is closed.\n\nFrom a mathematical viewpoint, it makes sense to talk about the length of a symbolic expression:\n\n```\nsage: len(2*x^2 + 3+x - 5)\n3\n```\n\nHowever, this is does not seem pythonic, because only container-type objects should have a `len`. Therefore, it was suggested in the comments of #10980 that it might be a good idea to take away the `len` from symbolic expressions (and this could be discussed on sage-devel).\n\nRelated ticket: #28053 (adding length of a propositional formula function in the Logic Module)\n\nIssue created by migration from https://trac.sagemath.org/ticket/29738\n\n",
    "created_at": "2020-05-27T00:39:30Z",
    "labels": [
        "symbolics",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "perhaps symbolic expressions should not have a length",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29501",
    "user": "@DaveWitteMorris"
}
```
CC:  behackl slelievre dkrenn saliola mjo

Keywords: length

This ticket was opened to ensure that an issue raised in the comments of #10980 is not lost when that ticket is closed.

From a mathematical viewpoint, it makes sense to talk about the length of a symbolic expression:

```
sage: len(2*x^2 + 3+x - 5)
3
```

However, this is does not seem pythonic, because only container-type objects should have a `len`. Therefore, it was suggested in the comments of #10980 that it might be a good idea to take away the `len` from symbolic expressions (and this could be discussed on sage-devel).

Related ticket: #28053 (adding length of a propositional formula function in the Logic Module)

Issue created by migration from https://trac.sagemath.org/ticket/29738





---

archive/issue_comments_418834.json:
```json
{
    "body": "Since `'sage.symbolic.expression.Expression' object is not iterable`, I agree it should have no length:\n\n```\nsage: 2*x^2 + 3*x - 5\n2*x^2 + 3*x - 5\nsage: list(_)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-1a5b60e28d67> in <module>()\n----> 1 list(_)\n\nTypeError: 'sage.symbolic.expression.Expression' object is not iterable\n```\n",
    "created_at": "2020-05-27T08:41:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418834",
    "user": "slabbe"
}
```

Since `'sage.symbolic.expression.Expression' object is not iterable`, I agree it should have no length:

```
sage: 2*x^2 + 3*x - 5
2*x^2 + 3*x - 5
sage: list(_)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-1a5b60e28d67> in <module>()
----> 1 list(_)

TypeError: 'sage.symbolic.expression.Expression' object is not iterable
```




---

archive/issue_comments_418835.json:
```json
{
    "body": "I also agree. Let's deprecate it.",
    "created_at": "2021-07-05T23:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418835",
    "user": "mkoeppe"
}
```

I also agree. Let's deprecate it.



---

archive/issue_comments_418836.json:
```json
{
    "body": "\n```\nsage -t --random-seed=0 src/sage/symbolic/expression.pyx\n**********************************************************************\nFile \"src/sage/symbolic/expression.pyx\", line 5877, in sage.symbolic.expression.Expression.__len__\nFailed example:\n    len(a)\nExpected:\n    0\nGot:\n    doctest:warning\nsage -t --random-seed=0 src/sage/geometry/riemannian_manifolds/parametrized_surface3d.py\n**********************************************************************\nFile \"src/sage/geometry/riemannian_manifolds/parametrized_surface3d.py\", line 88, in sage.geometry.riemannian_manifolds.parametrized_surface3d.ParametrizedSurface3D\nFailed example:\n    eparaboloid = ParametrizedSurface3D((u, v, u^2 + v^2), (u, v),'elliptic paraboloid'); eparaboloid\nExpected:\n    Parametrized surface ('elliptic paraboloid') with equation (u, v, u^2 + v^2)\nGot:\n    doctest:warning\n...\n    [298 tests, 42 failures, 37.94 s]\nsage -t --random-seed=0 src/sage/calculus/desolvers.py\n**********************************************************************\nFile \"src/sage/calculus/desolvers.py\", line 1634, in sage.calculus.desolvers.?\nFailed example:\n    sol=desolve_odeint(f,ic,t,y,rtol=1e-9,atol=1e-10,compute_jac=True)\nExpected nothing\nGot:\n    doctest:warning\nsage -t --random-seed=0 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\n**********************************************************************\nFile \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 4033, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.diff_op\nFailed example:\n    len(DD[(0, 1, 2)])\nExpected:\n    246\nGot:\n    doctest:warning\n```\n\nOnly used in 3 files.\n----\nNew commits:",
    "created_at": "2021-07-06T00:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418836",
    "user": "mkoeppe"
}
```


```
sage -t --random-seed=0 src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 5877, in sage.symbolic.expression.Expression.__len__
Failed example:
    len(a)
Expected:
    0
Got:
    doctest:warning
sage -t --random-seed=0 src/sage/geometry/riemannian_manifolds/parametrized_surface3d.py
**********************************************************************
File "src/sage/geometry/riemannian_manifolds/parametrized_surface3d.py", line 88, in sage.geometry.riemannian_manifolds.parametrized_surface3d.ParametrizedSurface3D
Failed example:
    eparaboloid = ParametrizedSurface3D((u, v, u^2 + v^2), (u, v),'elliptic paraboloid'); eparaboloid
Expected:
    Parametrized surface ('elliptic paraboloid') with equation (u, v, u^2 + v^2)
Got:
    doctest:warning
...
    [298 tests, 42 failures, 37.94 s]
sage -t --random-seed=0 src/sage/calculus/desolvers.py
**********************************************************************
File "src/sage/calculus/desolvers.py", line 1634, in sage.calculus.desolvers.?
Failed example:
    sol=desolve_odeint(f,ic,t,y,rtol=1e-9,atol=1e-10,compute_jac=True)
Expected nothing
Got:
    doctest:warning
sage -t --random-seed=0 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py
**********************************************************************
File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4033, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.diff_op
Failed example:
    len(DD[(0, 1, 2)])
Expected:
    246
Got:
    doctest:warning
```

Only used in 3 files.
----
New commits:



---

archive/issue_comments_418837.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T01:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418837",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418838.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T02:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418838",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418839.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-07-06T02:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418839",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_418840.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-06T02:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418840",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_418841.json:
```json
{
    "body": "I opened #32144 to provide another measure\nof an expression's complexity.",
    "created_at": "2021-07-06T09:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418841",
    "user": "slelievre"
}
```

I opened #32144 to provide another measure
of an expression's complexity.



---

archive/issue_comments_418842.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-17T21:49:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418842",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418843.json:
```json
{
    "body": "Merged updated #32139",
    "created_at": "2021-07-17T21:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418843",
    "user": "mkoeppe"
}
```

Merged updated #32139



---

archive/issue_comments_418844.json:
```json
{
    "body": "Replying to [comment:8 mkoeppe]:\n> {{{\n> sage -t --random-seed=0 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\n> **********************************************************************\n> File \"src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py\", line 4033, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.diff_op\n> Failed example:\n>     len(DD[(0, 1, 2)])\n> Expected:\n>     246\n> Got:\n>     doctest:warning\n> }}}\n\nSolved this one.\n----\nNew commits:",
    "created_at": "2021-07-19T09:02:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418844",
    "user": "dkrenn"
}
```

Replying to [comment:8 mkoeppe]:
> {{{
> sage -t --random-seed=0 src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py
> **********************************************************************
> File "src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py", line 4033, in sage.rings.asymptotic.asymptotics_multivariate_generating_functions.diff_op
> Failed example:
>     len(DD[(0, 1, 2)])
> Expected:
>     246
> Got:
>     doctest:warning
> }}}

Solved this one.
----
New commits:



---

archive/issue_comments_418845.json:
```json
{
    "body": "Code/changes here on this ticket LGTM. I have the following minor comments:\n\n1. Failing doctests (deprecation warning shown) which need to be updated (remove use of `len`)\n\n2. FWIW `all_vars = set([])` could simply be `all_vars = set()` (but I know this comes from the original code\n\n3. When fixing 2, we could directly replace\n\n```\n+        all_vars = set([])\n+        all_vars.update(*[de.variables() for de in des])\n```\n\n  by\n\n```\n+        all_vars = set().union(*[de.variables() for de in des])\n```\n\n\n4. The change\n\n```\n-        if len(variables[0]):\n+        if isinstance(variables[0], (list, tuple)):\n```\n\nseems to change its functionality. In the line after this, `variables[0][0]` is used which will fail if there is nothing in `variables[0]`. (The `variables[0][1:3]` will simply give an empty list, which seems to be intended, so no peoblem here.)",
    "created_at": "2021-07-19T09:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418845",
    "user": "dkrenn"
}
```

Code/changes here on this ticket LGTM. I have the following minor comments:

1. Failing doctests (deprecation warning shown) which need to be updated (remove use of `len`)

2. FWIW `all_vars = set([])` could simply be `all_vars = set()` (but I know this comes from the original code

3. When fixing 2, we could directly replace

```
+        all_vars = set([])
+        all_vars.update(*[de.variables() for de in des])
```

  by

```
+        all_vars = set().union(*[de.variables() for de in des])
```


4. The change

```
-        if len(variables[0]):
+        if isinstance(variables[0], (list, tuple)):
```

seems to change its functionality. In the line after this, `variables[0][0]` is used which will fail if there is nothing in `variables[0]`. (The `variables[0][1:3]` will simply give an empty list, which seems to be intended, so no peoblem here.)



---

archive/issue_comments_418846.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-07-19T09:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418846",
    "user": "dkrenn"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_418847.json:
```json
{
    "body": "ad 4 - this `if` is only dispatching between the two fixed formats described in the docstring\n----\nNew commits:",
    "created_at": "2021-07-19T11:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418847",
    "user": "mkoeppe"
}
```

ad 4 - this `if` is only dispatching between the two fixed formats described in the docstring
----
New commits:



---

archive/issue_comments_418848.json:
```json
{
    "body": "Replying to [comment:21 mkoeppe]:\n> ad 4 - this `if` is only dispatching between the two fixed formats described in the docstring\n\nOk, I see now.",
    "created_at": "2021-07-19T12:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418848",
    "user": "dkrenn"
}
```

Replying to [comment:21 mkoeppe]:
> ad 4 - this `if` is only dispatching between the two fixed formats described in the docstring

Ok, I see now.



---

archive/issue_comments_418849.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-19T12:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418849",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_418850.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-21T01:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418850",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_418851.json:
```json
{
    "body": "LGTM. No one would ever guess what `len(expr)` does without looking it up, and `expr.number_of_operands()` is much clearer.",
    "created_at": "2021-07-22T13:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418851",
    "user": "mjo"
}
```

LGTM. No one would ever guess what `len(expr)` does without looking it up, and `expr.number_of_operands()` is much clearer.



---

archive/issue_comments_418852.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-22T13:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418852",
    "user": "mjo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_418853.json:
```json
{
    "body": "Thanks!",
    "created_at": "2021-07-22T14:42:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418853",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_418854.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-07-25T13:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29501#issuecomment-418854",
    "user": "vbraun"
}
```

Resolution: fixed
