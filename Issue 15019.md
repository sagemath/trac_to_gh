# Issue 15019: incorrect behavior when algorithm='sympy' fails to find an integral

Issue created by migration from https://trac.sagemath.org/ticket/15256

Original creator: was

Original creation time: 2013-10-05 19:11:11

What happens:

```
sage: a = integrate(sin(x)*tan(x), x, algorithm='sympy') 
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-27db75e497e4> in <module>()
----> 1 a = integrate(sin(x)*tan(x), x, algorithm='sympy')
 
/usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/misc/functional.pyc in integral(x, *args, **kwds)
    745     """
    746     if hasattr(x, 'integral'):
--> 747         return x.integral(*args, **kwds)
    748     else:
    749         from sage.symbolic.ring import SR
 
/usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression.integral (sage/symbolic/expression.cpp:40833)()
 
/usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/integral.pyc in integrate(expression, v, a, b, algorithm)
    681         if not integrator:
    682             raise ValueError, "Unknown algorithm: %s" % algorithm
--> 683         return integrator(expression, v, a, b)
    684     if a is None:
    685         return indefinite_integral(expression, v)
 
/usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.pyc in sympy_integrator(expression, v, a, b)
     37     else:
     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))
---> 39     return result._sage_()
     40
     41 def mma_free_integrator(expression, v, a=None, b=None):
 
AttributeError: 'Integral' object has no attribute '_sage_'
sage: 
sage: 
sage: %debug
> /usr/local/sage/sage-5.11/local/lib/python2.7/site-packages/sage/symbolic/integration/external.py(39)sympy_integrator()
     38         result = sympy.integrate(ex, (v, a._sympy_(), b._sympy_()))
---> 39     return result._sage_()
     40 
 
ipdb> print result
Integral(sin(x)*tan(x), x)
```


What should happen:

```
sage: a = integrate(sin(x)*tan(x), x, algorithm='sympy') 
sage: a
<get back a formal integral>
```



---

Comment by kcrisman created at 2013-10-06 01:52:33

Tangentially related: #14915.


---

Comment by ppurka created at 2013-10-12 08:01:16

This needs to be fixed upstream in sympy.

_Edit_: In fact, it seems sympy is unable to integrate it. This is why it gets into this weird problem.


---

Comment by kcrisman created at 2014-06-17 12:34:40

This is a dup of #14723.  Not sure which one should be closed.


---

Comment by ppurka created at 2014-06-17 12:40:03

Replying to [comment:5 kcrisman]:
> This is a dup of #14273.  Not sure which one should be closed.
How is this related to the notebook? Am I missing something obvious?


---

Comment by kcrisman created at 2014-06-17 12:45:32

> > This is a dup of #14273.  Not sure which one should be closed.
> How is this related to the notebook? Am I missing something obvious?
Sorry, #14723.  I'll fix it above as well.


---

Comment by ppurka created at 2014-06-17 12:59:08

I think this one should be closed because i) the other one was opened earlier, and ii) there was an attempt at a patch.


---

Comment by kcrisman created at 2014-06-17 13:34:03

Okay, sounds good.


---

Comment by kcrisman created at 2014-06-17 13:34:03

Changing status from new to needs_review.


---

Comment by kcrisman created at 2014-06-17 13:34:09

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-06-17 19:08:52

Resolution: duplicate
