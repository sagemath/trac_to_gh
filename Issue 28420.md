# Issue 28420: Build Sage without "python"

archive/issues_028420.json:
```json
{
    "body": "CC:  @isuruf @kiwifb @timokau @antonio-rojas\n\nSome new linux releases don't seem to include a `python` executable. They have `python3` but no `python` or `python2`. Sage should build on such systems.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28657\n\n",
    "created_at": "2019-10-25T21:08:44Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Build Sage without \"python\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28420",
    "user": "https://github.com/jhpalmieri"
}
```
CC:  @isuruf @kiwifb @timokau @antonio-rojas

Some new linux releases don't seem to include a `python` executable. They have `python3` but no `python` or `python2`. Sage should build on such systems.


Issue created by migration from https://trac.sagemath.org/ticket/28657





---

archive/issue_comments_401003.json:
```json
{
    "body": "Here is an attempt. It probably needs work, but please test it.\n----\nNew commits:",
    "created_at": "2019-10-25T21:09:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401003",
    "user": "https://github.com/jhpalmieri"
}
```

Here is an attempt. It probably needs work, but please test it.
----
New commits:



---

archive/issue_comments_401004.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-25T21:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401004",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_401005.json:
```json
{
    "body": "See https://wiki.ubuntu.com/BionicBeaver/ReleaseNotes, for example: \"Python 2 is no longer installed by default.\"",
    "created_at": "2019-10-25T21:10:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401005",
    "user": "https://github.com/jhpalmieri"
}
```

See https://wiki.ubuntu.com/BionicBeaver/ReleaseNotes, for example: "Python 2 is no longer installed by default."



---

archive/issue_comments_401006.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2019-10-26T23:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401006",
    "user": "https://github.com/vbraun"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_401007.json:
```json
{
    "body": "Are you sure there really are Linuxes without `python` (but with `python3`) ? E.g. in Gentoo `python` equals `python3` since few years...",
    "created_at": "2019-10-28T17:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401007",
    "user": "https://github.com/dimpase"
}
```

Are you sure there really are Linuxes without `python` (but with `python3`) ? E.g. in Gentoo `python` equals `python3` since few years...



---

archive/issue_comments_401008.json:
```json
{
    "body": "I just installed an Ubuntu 19.10 virtual machine. I opened a terminal, typed \"pyt\" and hit the TAB key: it completed to \"python3\". There is no command \"python\".",
    "created_at": "2019-10-28T18:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401008",
    "user": "https://github.com/jhpalmieri"
}
```

I just installed an Ubuntu 19.10 virtual machine. I opened a terminal, typed "pyt" and hit the TAB key: it completed to "python3". There is no command "python".



---

archive/issue_comments_401009.json:
```json
{
    "body": "does \n\n```\napt install python \n```\n\nprovide Python(3) ?",
    "created_at": "2019-10-28T19:08:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401009",
    "user": "https://github.com/dimpase"
}
```

does 

```
apt install python 
```

provide Python(3) ?



---

archive/issue_comments_401010.json:
```json
{
    "body": "It provides `python2`. (Edit: and `python`, symlinked to `python2`.)",
    "created_at": "2019-10-28T20:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401010",
    "user": "https://github.com/jhpalmieri"
}
```

It provides `python2`. (Edit: and `python`, symlinked to `python2`.)



---

archive/issue_comments_401011.json:
```json
{
    "body": "hmm, but that's insane that all the scripts needing just python need to be changed, no? \n\nI would just install a symbolic link to python3 somewhere...",
    "created_at": "2019-10-28T20:32:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401011",
    "user": "https://github.com/dimpase"
}
```

hmm, but that's insane that all the scripts needing just python need to be changed, no? 

I would just install a symbolic link to python3 somewhere...



---

archive/issue_comments_401012.json:
```json
{
    "body": "I am not an Ubuntu expert, but I think that they were worried that old Python scripts might not be compatible with Python 3, so better not to make a symbolic link: just let people install Python 2 if they need it.",
    "created_at": "2019-10-28T21:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401012",
    "user": "https://github.com/jhpalmieri"
}
```

I am not an Ubuntu expert, but I think that they were worried that old Python scripts might not be compatible with Python 3, so better not to make a symbolic link: just let people install Python 2 if they need it.



---

archive/issue_comments_401013.json:
```json
{
    "body": "Why not just create a link to python3 at `build/bin/python` ?\n\nThis patch is very invasive for no good reason I can see, and would make future use of Sage with system Python harder.",
    "created_at": "2019-10-30T08:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401013",
    "user": "https://github.com/dimpase"
}
```

Why not just create a link to python3 at `build/bin/python` ?

This patch is very invasive for no good reason I can see, and would make future use of Sage with system Python harder.



---

archive/issue_comments_401014.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-10-30T17:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_401015.json:
```json
{
    "body": "Removed changes to `ipython/spkg-install` which would have conflicted with #28673.\n\nReplying to [comment:12 dimpase]:\n> Why not just create a link to python3 at `build/bin/python` ?\n\nThat's basically what `sage-system-python` is already.\n \n> This patch is very invasive for no good reason I can see, and would make future use of Sage with system Python harder.\n\nWhen installing a package, should we be using Sage's Python or the system Python? There are three established choices: during Sage's build use `sage-system-python` or `sage-python23` (which means the Python that Sage builds: it uses either `python2` or `python3` from `$SAGE_LOCAL/bin/`). During runtime, There is also the script `sage-python`, which just runs `python2` or `python3`. We should probably use that one more and `sage-python23` less.",
    "created_at": "2019-10-30T17:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401015",
    "user": "https://github.com/jhpalmieri"
}
```

Removed changes to `ipython/spkg-install` which would have conflicted with #28673.

Replying to [comment:12 dimpase]:
> Why not just create a link to python3 at `build/bin/python` ?

That's basically what `sage-system-python` is already.
 
> This patch is very invasive for no good reason I can see, and would make future use of Sage with system Python harder.

When installing a package, should we be using Sage's Python or the system Python? There are three established choices: during Sage's build use `sage-system-python` or `sage-python23` (which means the Python that Sage builds: it uses either `python2` or `python3` from `$SAGE_LOCAL/bin/`). During runtime, There is also the script `sage-python`, which just runs `python2` or `python3`. We should probably use that one more and `sage-python23` less.



---

archive/issue_comments_401016.json:
```json
{
    "body": "I'm testing a branch which uses `sage-python` more and `sage-python23` less. If it works, I'll push it.",
    "created_at": "2019-10-30T17:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401016",
    "user": "https://github.com/jhpalmieri"
}
```

I'm testing a branch which uses `sage-python` more and `sage-python23` less. If it works, I'll push it.



---

archive/issue_comments_401017.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-10-30T18:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401017",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_401018.json:
```json
{
    "body": "CC'ing some of the packaging people to see what they think.",
    "created_at": "2019-10-30T18:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401018",
    "user": "https://github.com/jhpalmieri"
}
```

CC'ing some of the packaging people to see what they think.



---

archive/issue_comments_401019.json:
```json
{
    "body": "IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n\nNow, think of a situation where Sage's Python and system Python are the same thing.\nIt is actually not too far-fetched; since PEP 370 it's prefectly possible to install Python modules (for a system-wide Python) into ~/.\nAnd long-term it is probably the only viable option for Sage.\n\nSo, the fewer different Pythons we have around, the better...",
    "created_at": "2019-10-30T18:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401019",
    "user": "https://github.com/dimpase"
}
```

IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.

Now, think of a situation where Sage's Python and system Python are the same thing.
It is actually not too far-fetched; since PEP 370 it's prefectly possible to install Python modules (for a system-wide Python) into ~/.
And long-term it is probably the only viable option for Sage.

So, the fewer different Pythons we have around, the better...



---

archive/issue_comments_401020.json:
```json
{
    "body": "Replying to [comment:18 dimpase]:\n> IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n\nI agree, and that's why my changes in `build/pkgs` are almost exclusively to use `sage-system-python`. The one exception is `entrypoints`, which installs a Python module. \n\n> Now, think of a situation where Sage's Python and system Python are the same thing.\n> It is actually not too far-fetched; since PEP 370 it's prefectly possible to install Python modules (for a system-wide Python) into ~/.\n> And long-term it is probably the only viable option for Sage.\n> \n> So, the fewer different Pythons we have around, the better...\n\nRight now we are using four different ones: `python`, `sage-system-python`, `sage-python23`, and `sage-python`. The main point here is to eliminate the use of `python`. I also wonder if we should avoid `sage-python23`, since it explicitly calls `SAGE_LOCAL/bin/python[2 or 3]`, and instead use `sage-python`, which runs `exec python2` or `exec python3`, letting the PATH determine where to find the program. I've done a little in that direction (changing `sage-python23` to `sage-python`), but more could be done. It doesn't need to be done on this ticket.",
    "created_at": "2019-10-30T18:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401020",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:18 dimpase]:
> IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.

I agree, and that's why my changes in `build/pkgs` are almost exclusively to use `sage-system-python`. The one exception is `entrypoints`, which installs a Python module. 

> Now, think of a situation where Sage's Python and system Python are the same thing.
> It is actually not too far-fetched; since PEP 370 it's prefectly possible to install Python modules (for a system-wide Python) into ~/.
> And long-term it is probably the only viable option for Sage.
> 
> So, the fewer different Pythons we have around, the better...

Right now we are using four different ones: `python`, `sage-system-python`, `sage-python23`, and `sage-python`. The main point here is to eliminate the use of `python`. I also wonder if we should avoid `sage-python23`, since it explicitly calls `SAGE_LOCAL/bin/python[2 or 3]`, and instead use `sage-python`, which runs `exec python2` or `exec python3`, letting the PATH determine where to find the program. I've done a little in that direction (changing `sage-python23` to `sage-python`), but more could be done. It doesn't need to be done on this ticket.



---

archive/issue_comments_401021.json:
```json
{
    "body": "Replying to [comment:10 dimpase]:\n> hmm, but that's insane that all the scripts needing just python need to be changed, no? \n> \n> I would just install a symbolic link to python3 somewhere...\n\nThis was because `python` -> `python3` link was explicitly recommended against in PEP-0394. In April 2018, this was changed to make it okay for virtual envs and in June 2019, it was okay for the distributor to decide.",
    "created_at": "2019-10-30T18:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401021",
    "user": "https://github.com/isuruf"
}
```

Replying to [comment:10 dimpase]:
> hmm, but that's insane that all the scripts needing just python need to be changed, no? 
> 
> I would just install a symbolic link to python3 somewhere...

This was because `python` -> `python3` link was explicitly recommended against in PEP-0394. In April 2018, this was changed to make it okay for virtual envs and in June 2019, it was okay for the distributor to decide.



---

archive/issue_comments_401022.json:
```json
{
    "body": "Replying to [comment:18 dimpase]:\n> IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n\nRight, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.",
    "created_at": "2019-10-30T19:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401022",
    "user": "https://github.com/timokau"
}
```

Replying to [comment:18 dimpase]:
> IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.

Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.



---

archive/issue_comments_401023.json:
```json
{
    "body": "Replying to [comment:21 gh-timokau]:\n> Replying to [comment:18 dimpase]:\n> > IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n> \n> Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.\n\nHow are you handling systems which have no `python` executable, like the most recent Ubuntu distributions? Or has that issue not come up yet?",
    "created_at": "2019-10-30T19:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401023",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:21 gh-timokau]:
> Replying to [comment:18 dimpase]:
> > IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.
> 
> Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.

How are you handling systems which have no `python` executable, like the most recent Ubuntu distributions? Or has that issue not come up yet?



---

archive/issue_comments_401024.json:
```json
{
    "body": "Replying to [comment:22 jhpalmieri]:\n> Replying to [comment:21 gh-timokau]:\n> > Replying to [comment:18 dimpase]:\n> > > IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.\n> > \n> > Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.\n> \n> How are you handling systems which have no `python` executable, like the most recent Ubuntu distributions? Or has that issue not come up yet?\n\nThe distro *is* the \"system\", so I can just add python to the dependency list and the package manager will make sure it's available. `python` is not installed by default on ubuntu, but if  the sage package depends on it it will still be installed for sage users.",
    "created_at": "2019-10-30T21:43:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401024",
    "user": "https://github.com/timokau"
}
```

Replying to [comment:22 jhpalmieri]:
> Replying to [comment:21 gh-timokau]:
> > Replying to [comment:18 dimpase]:
> > > IMHO there is no reason to use Sage's python during installation of a package, unless we are installing a Python/Cython module for Sage's Python.
> > 
> > Right, on distro all the python versions resolve to the system python anyway. So this change is close to a no-op from a distro perspective.
> 
> How are you handling systems which have no `python` executable, like the most recent Ubuntu distributions? Or has that issue not come up yet?

The distro *is* the "system", so I can just add python to the dependency list and the package manager will make sure it's available. `python` is not installed by default on ubuntu, but if  the sage package depends on it it will still be installed for sage users.



---

archive/issue_comments_401025.json:
```json
{
    "body": "Replying to [comment:23 gh-timokau]:\n> The distro *is* the \"system\", so I can just add python to the dependency list and the package manager will make sure it's available. `python` is not installed by default on ubuntu, but if  the sage package depends on it it will still be installed for sage users.\n\nThen you can interpret this ticket as being an effort to allow the use of either `python` or `python3` as dependencies, rather than insisting on `python`. Or just change the dependency to `python3`.",
    "created_at": "2019-10-30T21:54:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401025",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:23 gh-timokau]:
> The distro *is* the "system", so I can just add python to the dependency list and the package manager will make sure it's available. `python` is not installed by default on ubuntu, but if  the sage package depends on it it will still be installed for sage users.

Then you can interpret this ticket as being an effort to allow the use of either `python` or `python3` as dependencies, rather than insisting on `python`. Or just change the dependency to `python3`.



---

archive/issue_comments_401026.json:
```json
{
    "body": "Are we good here? It seems like its a step in the right direction, even if it may not solve all problems for all time.",
    "created_at": "2019-11-07T23:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401026",
    "user": "https://github.com/vbraun"
}
```

Are we good here? It seems like its a step in the right direction, even if it may not solve all problems for all time.



---

archive/issue_comments_401027.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-11-07T23:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401027",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_401028.json:
```json
{
    "body": "Replying to [comment:25 vbraun]:\n> Are we good here? It seems like its a step in the right direction, even if it may not solve all problems for all time.\n\nWell, I was trying to solve all problems for all time, but I'll take what I can get.",
    "created_at": "2019-11-07T23:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401028",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:25 vbraun]:
> Are we good here? It seems like its a step in the right direction, even if it may not solve all problems for all time.

Well, I was trying to solve all problems for all time, but I'll take what I can get.



---

archive/issue_comments_401029.json:
```json
{
    "body": "Should have looked at this more closely earlier. This is 0 improvement for sage-on-distro that don't want to install `sage-system-python` or `sage-python` or `sage-python23`. Possibly it requires more patching. I only see this as a transition period hopefully.",
    "created_at": "2019-11-07T23:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401029",
    "user": "https://github.com/kiwifb"
}
```

Should have looked at this more closely earlier. This is 0 improvement for sage-on-distro that don't want to install `sage-system-python` or `sage-python` or `sage-python23`. Possibly it requires more patching. I only see this as a transition period hopefully.



---

archive/issue_comments_401030.json:
```json
{
    "body": "It doesn't make anything worse for distros, I hope, and it should allow you to set the dependency to `python3` instead of `python`, for systems where those are different.",
    "created_at": "2019-11-07T23:55:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401030",
    "user": "https://github.com/jhpalmieri"
}
```

It doesn't make anything worse for distros, I hope, and it should allow you to set the dependency to `python3` instead of `python`, for systems where those are different.



---

archive/issue_comments_401031.json:
```json
{
    "body": "I don't know about other distros but Gentoo has its own mechanism to switch between python versions. Without having to worry about `python` being `python2` or `python3`, this is switched at a more fundamental level and there are ways to maintain \"exceptions\". So stuff like replacing `python` by `sage-python` in `src/sage/doctest/control.py` is actually harmful. I install sage for python2.7, python3.6 and python3.7 simultaneously and I don't need to patch anything for it know which `python` it is currently running.",
    "created_at": "2019-11-08T00:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401031",
    "user": "https://github.com/kiwifb"
}
```

I don't know about other distros but Gentoo has its own mechanism to switch between python versions. Without having to worry about `python` being `python2` or `python3`, this is switched at a more fundamental level and there are ways to maintain "exceptions". So stuff like replacing `python` by `sage-python` in `src/sage/doctest/control.py` is actually harmful. I install sage for python2.7, python3.6 and python3.7 simultaneously and I don't need to patch anything for it know which `python` it is currently running.



---

archive/issue_comments_401032.json:
```json
{
    "body": "What do you do with all of the scripts in `src/bin` or `local/bin` which call `sage-python23`?",
    "created_at": "2019-11-08T00:07:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401032",
    "user": "https://github.com/jhpalmieri"
}
```

What do you do with all of the scripts in `src/bin` or `local/bin` which call `sage-python23`?



---

archive/issue_comments_401033.json:
```json
{
    "body": "Replying to [comment:31 jhpalmieri]:\n> What do you do with all of the scripts in `src/bin` or `local/bin` which call `sage-python23`? \n\nhttps://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage/sage-9999.ebuild#L178\n\nand thanks to your work I have now noticed there is one file in `src/ext` with the stuff.\n\nThe link above is only part of the solution anyway. Gentoo has an install helper called `python_doscript` that will wrap python scripts so multiple python versions are not a problem. So yes, I'll admit it, I don't have to have a sage-python thingy because I already have a better solution and you don't have one.",
    "created_at": "2019-11-08T00:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401033",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:31 jhpalmieri]:
> What do you do with all of the scripts in `src/bin` or `local/bin` which call `sage-python23`? 

https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage/sage-9999.ebuild#L178

and thanks to your work I have now noticed there is one file in `src/ext` with the stuff.

The link above is only part of the solution anyway. Gentoo has an install helper called `python_doscript` that will wrap python scripts so multiple python versions are not a problem. So yes, I'll admit it, I don't have to have a sage-python thingy because I already have a better solution and you don't have one.



---

archive/issue_comments_401034.json:
```json
{
    "body": "If you have a suggestion for what else to do with `doctest/control.py`, we can open a follow-up ticket.",
    "created_at": "2019-11-08T00:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401034",
    "user": "https://github.com/jhpalmieri"
}
```

If you have a suggestion for what else to do with `doctest/control.py`, we can open a follow-up ticket.



---

archive/issue_comments_401035.json:
```json
{
    "body": "To be honest I think we should wait for the dust about python2/3 to clear out. Once python2 is out of support the incentive to keep it will be reduced drastically.",
    "created_at": "2019-11-08T00:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401035",
    "user": "https://github.com/kiwifb"
}
```

To be honest I think we should wait for the dust about python2/3 to clear out. Once python2 is out of support the incentive to keep it will be reduced drastically.



---

archive/issue_comments_401036.json:
```json
{
    "body": "Replying to [comment:33 jhpalmieri]:\n> If you have a suggestion for what else to do with `doctest/control.py`, we can open a follow-up ticket.\n\nActually in the end I may have some :)\n* line 643: use `sys.executable` so it is always the python you are currently using.\n* line 1034 and associated doctests. Again `sys.executable` could be used and `...` be put in doctest since we don't know what that particular result is. But there is a first simplification `sage-runtests` is executable and already starts with `#!/usr/bin/env sage-python` in your case why do you need to override the `#!` here? In fact why do you even need the full path? It is already in your `$PATH` at this stage.",
    "created_at": "2019-11-08T04:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401036",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:33 jhpalmieri]:
> If you have a suggestion for what else to do with `doctest/control.py`, we can open a follow-up ticket.

Actually in the end I may have some :)
* line 643: use `sys.executable` so it is always the python you are currently using.
* line 1034 and associated doctests. Again `sys.executable` could be used and `...` be put in doctest since we don't know what that particular result is. But there is a first simplification `sage-runtests` is executable and already starts with `#!/usr/bin/env sage-python` in your case why do you need to override the `#!` here? In fact why do you even need the full path? It is already in your `$PATH` at this stage.



---

archive/issue_comments_401037.json:
```json
{
    "body": "See #28709 for a followup incorporating these ideas.",
    "created_at": "2019-11-08T18:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401037",
    "user": "https://github.com/jhpalmieri"
}
```

See #28709 for a followup incorporating these ideas.



---

archive/issue_events_072184.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-11-08T20:31:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28420#event-72184"
}
```



---

archive/issue_comments_401038.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-11-08T20:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401038",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_401039.json:
```json
{
    "body": "It seems that this broke the docker images, see #28738.\n\nIs it intentional that we now need a system Python to be installed to run Sage? Or is the situation in the docker image somehow special and other users won't be affected by this?\n\nWhat confuses me is the following in `sage`:\n\n```\n# Check to see if the whole Sage install tree has moved.  If so,\n# change various hardcoded paths.  Skip this if we don't have write\n# access to $SAGE_LOCAL (e.g. when running as a different user) or\n# if Python and sage-location haven't been installed yet.\nmaybe_sage_location()\n{\n    if [ -w \"$SAGE_LOCAL\" ]; then\n        if [ -x \"$SAGE_LOCAL/bin/python\" ] && [ -x \"$SAGE_LOCAL/bin/sage-location\" ]; then\n            sage-location || exit $?\n        fi\n    fi\n}\n```\n\n\nBut `sage-location` uses the system Python, so the check for `$SAGE_LOCAL/bin/python` seems to be wrong.",
    "created_at": "2019-11-17T21:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401039",
    "user": "https://github.com/saraedum"
}
```

It seems that this broke the docker images, see #28738.

Is it intentional that we now need a system Python to be installed to run Sage? Or is the situation in the docker image somehow special and other users won't be affected by this?

What confuses me is the following in `sage`:

```
# Check to see if the whole Sage install tree has moved.  If so,
# change various hardcoded paths.  Skip this if we don't have write
# access to $SAGE_LOCAL (e.g. when running as a different user) or
# if Python and sage-location haven't been installed yet.
maybe_sage_location()
{
    if [ -w "$SAGE_LOCAL" ]; then
        if [ -x "$SAGE_LOCAL/bin/python" ] && [ -x "$SAGE_LOCAL/bin/sage-location" ]; then
            sage-location || exit $?
        fi
    fi
}
```


But `sage-location` uses the system Python, so the check for `$SAGE_LOCAL/bin/python` seems to be wrong.



---

archive/issue_comments_401040.json:
```json
{
    "body": "It's explained in the comment, at least somewhat: I think the point is, don't bother to do this check if `local/bin/python` doesn't exist, because the Sage install tree is incomplete. \n\nIn any case, it would be better to check for the existence of `local/bin/python` or `local/bin/python3`.",
    "created_at": "2019-11-18T01:05:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401040",
    "user": "https://github.com/jhpalmieri"
}
```

It's explained in the comment, at least somewhat: I think the point is, don't bother to do this check if `local/bin/python` doesn't exist, because the Sage install tree is incomplete. 

In any case, it would be better to check for the existence of `local/bin/python` or `local/bin/python3`.



---

archive/issue_comments_401041.json:
```json
{
    "body": "Isn't moving the sage tree after build long deprecated?",
    "created_at": "2019-11-18T10:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401041",
    "user": "https://github.com/timokau"
}
```

Isn't moving the sage tree after build long deprecated?



---

archive/issue_comments_401042.json:
```json
{
    "body": "You can move the Sage tree at most once. This is how (for example) OS X binary distributions work: they are built with a placeholder for SAGE_ROOT, and then the first time it runs, the placeholder gets replaced with the permanent home. The script `sage-location` should print an error most of the time if you try to move the Sage tree.",
    "created_at": "2019-11-18T19:41:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401042",
    "user": "https://github.com/jhpalmieri"
}
```

You can move the Sage tree at most once. This is how (for example) OS X binary distributions work: they are built with a placeholder for SAGE_ROOT, and then the first time it runs, the placeholder gets replaced with the permanent home. The script `sage-location` should print an error most of the time if you try to move the Sage tree.



---

archive/issue_comments_401043.json:
```json
{
    "body": "I don't think you can move a \"normal\" Sage tree at all. It needs to be specially prepared to be movable, and such a prepared tree does not work without first being moved.",
    "created_at": "2019-11-18T19:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28420",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28420#issuecomment-401043",
    "user": "https://github.com/dimpase"
}
```

I don't think you can move a "normal" Sage tree at all. It needs to be specially prepared to be movable, and such a prepared tree does not work without first being moved.
