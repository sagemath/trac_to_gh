# Issue 18375: Y-axis labels on matrix_plot are reversed.

archive/issues_018375.json:
```json
{
    "body": "CC:  kcrisman strogdon was\n\nThis is a regression caused by the partial fix in #18463.\n\nmatrix_plot(identity_matrix(5))\n\nhas the y-axis labels ascending, while they should be descending.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18612\n\n",
    "created_at": "2015-06-04T21:22:37Z",
    "labels": [
        "graphics",
        "major",
        "bug"
    ],
    "title": "Y-axis labels on matrix_plot are reversed.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18375",
    "user": "deinst"
}
```
CC:  kcrisman strogdon was

This is a regression caused by the partial fix in #18463.

matrix_plot(identity_matrix(5))

has the y-axis labels ascending, while they should be descending.


Issue created by migration from https://trac.sagemath.org/ticket/18612





---

archive/issue_comments_249437.json:
```json
{
    "body": "Incorrect image",
    "created_at": "2015-06-04T21:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249437",
    "user": "deinst"
}
```

Incorrect image



---

archive/issue_comments_249438.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-06-05T01:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249438",
    "user": "kcrisman"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_249439.json:
```json
{
    "body": "Attachment [tmp_ST550r.png](tarball://root/attachments/some-uuid/ticket18612/tmp_ST550r.png) by kcrisman created at 2015-06-05 01:18:52",
    "created_at": "2015-06-05T01:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249439",
    "user": "kcrisman"
}
```

Attachment [tmp_ST550r.png](tarball://root/attachments/some-uuid/ticket18612/tmp_ST550r.png) by kcrisman created at 2015-06-05 01:18:52



---

archive/issue_comments_249440.json:
```json
{
    "body": "\n```\nsage: p = 13; matrix_plot(matrix(p-1,[mod(a,p)^b for a in range(1,p) for b in srange(p)]),cmap='jet')\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\n```\n\nLooks great, but y-axis labels reversed (known bug from #18463).\n\n```\nsage: p = 13; matrix_plot(matrix(p-1,[mod(a,p)^b for a in range(1,p) for b in srange(p)]),cmap='jet', origin='lower')\nLaunched png viewer for Graphics object consisting of 1 graphics primitive\n```\n\nLabels correct, but image upside-down.\n\n----\n\nCould we just (\"just\") use [pyplot.yticks](http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.yticks) to get the vertical ticks and then immediately reverse their order?  Or something like\n\n\n```\nsage: m.gca().get_yticks()\narray([ -2.,   0.,   2.,   4.,   6.,   8.,  10.,  12.])\nsage: m.gca().set_yticks(m.gca().get_yticks()[::-1])\n```\n\nI can't get this to quite work because I don't have the tkagg enabled for my Sage matplotlib, but inside of Sage something doing this should (hopefully) work.\n\nhttp://stackoverflow.com/questions/9382664/python-matplotlib-imshow-custom-tickmarks\n\nhttp://matplotlib.org/api/axes_api.html#matplotlib.axes.Axes.get_yticks",
    "created_at": "2015-06-22T21:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249440",
    "user": "kcrisman"
}
```


```
sage: p = 13; matrix_plot(matrix(p-1,[mod(a,p)^b for a in range(1,p) for b in srange(p)]),cmap='jet')
Launched png viewer for Graphics object consisting of 1 graphics primitive
```

Looks great, but y-axis labels reversed (known bug from #18463).

```
sage: p = 13; matrix_plot(matrix(p-1,[mod(a,p)^b for a in range(1,p) for b in srange(p)]),cmap='jet', origin='lower')
Launched png viewer for Graphics object consisting of 1 graphics primitive
```

Labels correct, but image upside-down.

----

Could we just ("just") use [pyplot.yticks](http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.yticks) to get the vertical ticks and then immediately reverse their order?  Or something like


```
sage: m.gca().get_yticks()
array([ -2.,   0.,   2.,   4.,   6.,   8.,  10.,  12.])
sage: m.gca().set_yticks(m.gca().get_yticks()[::-1])
```

I can't get this to quite work because I don't have the tkagg enabled for my Sage matplotlib, but inside of Sage something doing this should (hopefully) work.

http://stackoverflow.com/questions/9382664/python-matplotlib-imshow-custom-tickmarks

http://matplotlib.org/api/axes_api.html#matplotlib.axes.Axes.get_yticks



---

archive/issue_comments_249441.json:
```json
{
    "body": "I think that it is more complicated than that.\n\nI know next to nothing about the Sage graphics system, please feel free to clarify any blatant falsehoods.\n\nThe MatrixPlot object is a GraphicsPrimitive and is responsible for drawing the image.  The axes are drawn by the containing Graphics object which contains the MatrixPlot.  There may be a member of Graphics that allows us to relabel the axes that we could call in `matrix_plot`, but I do not know what it would be.\n\nThe more I look at this, I think that the best short term solution would be to back out #18463 and put an `abs` in `_limit_output_aspect_ratio`.  This is possibly wrong in terms of composed plots, but things would work correctly for the use cases that we have now.  It would not be incorrect in the case that ymax>ymin, just somewhat wasteful.\n\nDoes there exist high level documentation of the Graphics subsytem somewhere?  Something which describes how sums of plots are supposed to work, how to draw different axes for different plots in a single Graphics object would be nice.",
    "created_at": "2015-06-24T17:21:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249441",
    "user": "deinst"
}
```

I think that it is more complicated than that.

I know next to nothing about the Sage graphics system, please feel free to clarify any blatant falsehoods.

The MatrixPlot object is a GraphicsPrimitive and is responsible for drawing the image.  The axes are drawn by the containing Graphics object which contains the MatrixPlot.  There may be a member of Graphics that allows us to relabel the axes that we could call in `matrix_plot`, but I do not know what it would be.

The more I look at this, I think that the best short term solution would be to back out #18463 and put an `abs` in `_limit_output_aspect_ratio`.  This is possibly wrong in terms of composed plots, but things would work correctly for the use cases that we have now.  It would not be incorrect in the case that ymax>ymin, just somewhat wasteful.

Does there exist high level documentation of the Graphics subsytem somewhere?  Something which describes how sums of plots are supposed to work, how to draw different axes for different plots in a single Graphics object would be nice.



---

archive/issue_comments_249442.json:
```json
{
    "body": "Hmm, you may be right.  Yes, composed plots will probably nearly always be wrong, but I'm not sure anyone anticipated combining \"regular\" plots with matrix plots or indeed even combining two matrix plots.\n\nGiven the many reports, we need a fix for #18463, and I would strongly prefer one that is less elegant but preserves current functionality.  As Volker says elsewhere, the graphics code is convoluted enough, so this will not do much damage there.",
    "created_at": "2015-06-25T03:32:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249442",
    "user": "kcrisman"
}
```

Hmm, you may be right.  Yes, composed plots will probably nearly always be wrong, but I'm not sure anyone anticipated combining "regular" plots with matrix plots or indeed even combining two matrix plots.

Given the many reports, we need a fix for #18463, and I would strongly prefer one that is less elegant but preserves current functionality.  As Volker says elsewhere, the graphics code is convoluted enough, so this will not do much damage there.



---

archive/issue_comments_249443.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-25T12:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249443",
    "user": "deinst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_249444.json:
```json
{
    "body": "Ok, I am at Juliacon and don't have a bunch of time (not enough to run the long tests).  This is the proposed fix.  It appears to work, but is at least philosophically ugly.",
    "created_at": "2015-06-25T12:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249444",
    "user": "deinst"
}
```

Ok, I am at Juliacon and don't have a bunch of time (not enough to run the long tests).  This is the proposed fix.  It appears to work, but is at least philosophically ugly.



---

archive/issue_comments_249445.json:
```json
{
    "body": "I think you may have put the wrong branch?  It says \"already merged\".  Thanks very much though, I will check it out today or tomorrow.",
    "created_at": "2015-06-25T13:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249445",
    "user": "kcrisman"
}
```

I think you may have put the wrong branch?  It says "already merged".  Thanks very much though, I will check it out today or tomorrow.



---

archive/issue_comments_249446.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-25T13:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249446",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249447.json:
```json
{
    "body": "Doh!  Sorry, I forgot to commit the change before pushing.",
    "created_at": "2015-06-25T13:23:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249447",
    "user": "deinst"
}
```

Doh!  Sorry, I forgot to commit the change before pushing.



---

archive/issue_comments_249448.json:
```json
{
    "body": "William, if you see this - would this solution suffice for SMC purposes as well?\n\nRegarding ugly, comment:4:ticket:18463 already points out that problem.   I just think that we haven't really ever talked about adding matrix plots to each other or anything else in documentation, and it's best to fix that elsewhere - hopefully in a way that also fixes this problem 'correctly'.\n\nAlso, for my or other testing reference, do\n\n```\nsage: i = identity_matrix(10,sparse=True)\nsage: matrix_plot(i)\nsage: matrix_plot(i, aspect_ratio='automatic')\n```\n\nas an example that David mentioned in the previous ticket.",
    "created_at": "2015-06-25T14:01:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249448",
    "user": "kcrisman"
}
```

William, if you see this - would this solution suffice for SMC purposes as well?

Regarding ugly, comment:4:ticket:18463 already points out that problem.   I just think that we haven't really ever talked about adding matrix plots to each other or anything else in documentation, and it's best to fix that elsewhere - hopefully in a way that also fixes this problem 'correctly'.

Also, for my or other testing reference, do

```
sage: i = identity_matrix(10,sparse=True)
sage: matrix_plot(i)
sage: matrix_plot(i, aspect_ratio='automatic')
```

as an example that David mentioned in the previous ticket.



---

archive/issue_comments_249449.json:
```json
{
    "body": "> {{{\n> sage: i = identity_matrix(10,sparse=True)\n> sage: matrix_plot(i)\n> }}}\n\nOh, I remember now - that is just a difference in how we plotted sparse matrices, not related to all this stuff.",
    "created_at": "2015-06-26T17:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249449",
    "user": "kcrisman"
}
```

> {{{
> sage: i = identity_matrix(10,sparse=True)
> sage: matrix_plot(i)
> }}}

Oh, I remember now - that is just a difference in how we plotted sparse matrices, not related to all this stuff.



---

archive/issue_comments_249450.json:
```json
{
    "body": "I'm happy with this, ugly or not.\n\nCan you think of ANY way for us to doctest the graphic itself (perhaps the bounding box or other attribute) to ensure this doesn't happen again?",
    "created_at": "2015-06-26T17:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249450",
    "user": "kcrisman"
}
```

I'm happy with this, ugly or not.

Can you think of ANY way for us to doctest the graphic itself (perhaps the bounding box or other attribute) to ensure this doesn't happen again?



---

archive/issue_comments_249451.json:
```json
{
    "body": "Oh wait, I forgot to make sure that this still makes things work in general, since it actually changes all graphics, not just matrix plot.  But I'm happy on the matrix plot side; if anyone checks that this works for normal graphics (including ones with `ymin>ymax` etc.) then we are good to go.\n\nUpdate: they seem to in spot checks.  Running doctests.",
    "created_at": "2015-06-26T19:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249451",
    "user": "kcrisman"
}
```

Oh wait, I forgot to make sure that this still makes things work in general, since it actually changes all graphics, not just matrix plot.  But I'm happy on the matrix plot side; if anyone checks that this works for normal graphics (including ones with `ymin>ymax` etc.) then we are good to go.

Update: they seem to in spot checks.  Running doctests.



---

archive/issue_comments_249452.json:
```json
{
    "body": "Tests pass.",
    "created_at": "2015-06-27T00:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249452",
    "user": "kcrisman"
}
```

Tests pass.



---

archive/issue_comments_249453.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-29T19:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249453",
    "user": "kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_249454.json:
```json
{
    "body": "Okay, I can't find any problems here in spot checking other graphics types and using those keywords, as expected.",
    "created_at": "2015-06-29T19:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249454",
    "user": "kcrisman"
}
```

Okay, I can't find any problems here in spot checking other graphics types and using those keywords, as expected.



---

archive/issue_comments_249455.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-30T12:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18375#issuecomment-249455",
    "user": "vbraun"
}
```

Resolution: fixed
