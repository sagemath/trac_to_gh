# Issue 18375: Y-axis labels on matrix_plot are reversed.

Issue created by migration from https://trac.sagemath.org/ticket/18612

Original creator: deinst

Original creation time: 2015-06-04 21:22:37

CC:  kcrisman strogdon was

This is a regression caused by the partial fix in #18463.

matrix_plot(identity_matrix(5))

has the y-axis labels ascending, while they should be descending.



---

Comment by deinst created at 2015-06-04 21:23:07

Incorrect image


---

Comment by kcrisman created at 2015-06-05 01:18:52

Changing priority from major to blocker.


---

Attachment


---

Comment by kcrisman created at 2015-06-22 21:18:47


```
sage: p = 13; matrix_plot(matrix(p-1,[mod(a,p)^b for a in range(1,p) for b in srange(p)]),cmap='jet')
Launched png viewer for Graphics object consisting of 1 graphics primitive
```

Looks great, but y-axis labels reversed (known bug from #18463).

```
sage: p = 13; matrix_plot(matrix(p-1,[mod(a,p)^b for a in range(1,p) for b in srange(p)]),cmap='jet', origin='lower')
Launched png viewer for Graphics object consisting of 1 graphics primitive
```

Labels correct, but image upside-down.

----

Could we just ("just") use [pyplot.yticks](http://matplotlib.org/api/pyplot_api.html#matplotlib.pyplot.yticks) to get the vertical ticks and then immediately reverse their order?  Or something like


```
sage: m.gca().get_yticks()
array([ -2.,   0.,   2.,   4.,   6.,   8.,  10.,  12.])
sage: m.gca().set_yticks(m.gca().get_yticks()[::-1])
```

I can't get this to quite work because I don't have the tkagg enabled for my Sage matplotlib, but inside of Sage something doing this should (hopefully) work.

http://stackoverflow.com/questions/9382664/python-matplotlib-imshow-custom-tickmarks

http://matplotlib.org/api/axes_api.html#matplotlib.axes.Axes.get_yticks


---

Comment by deinst created at 2015-06-24 17:21:40

I think that it is more complicated than that.

I know next to nothing about the Sage graphics system, please feel free to clarify any blatant falsehoods.

The MatrixPlot object is a GraphicsPrimitive and is responsible for drawing the image.  The axes are drawn by the containing Graphics object which contains the MatrixPlot.  There may be a member of Graphics that allows us to relabel the axes that we could call in `matrix_plot`, but I do not know what it would be.

The more I look at this, I think that the best short term solution would be to back out #18463 and put an `abs` in `_limit_output_aspect_ratio`.  This is possibly wrong in terms of composed plots, but things would work correctly for the use cases that we have now.  It would not be incorrect in the case that ymax>ymin, just somewhat wasteful.

Does there exist high level documentation of the Graphics subsytem somewhere?  Something which describes how sums of plots are supposed to work, how to draw different axes for different plots in a single Graphics object would be nice.


---

Comment by kcrisman created at 2015-06-25 03:32:09

Hmm, you may be right.  Yes, composed plots will probably nearly always be wrong, but I'm not sure anyone anticipated combining "regular" plots with matrix plots or indeed even combining two matrix plots.

Given the many reports, we need a fix for #18463, and I would strongly prefer one that is less elegant but preserves current functionality.  As Volker says elsewhere, the graphics code is convoluted enough, so this will not do much damage there.


---

Comment by deinst created at 2015-06-25 12:24:17

Changing status from new to needs_review.


---

Comment by deinst created at 2015-06-25 12:24:17

Ok, I am at Juliacon and don't have a bunch of time (not enough to run the long tests).  This is the proposed fix.  It appears to work, but is at least philosophically ugly.


---

Comment by kcrisman created at 2015-06-25 13:05:53

I think you may have put the wrong branch?  It says "already merged".  Thanks very much though, I will check it out today or tomorrow.


---

Comment by git created at 2015-06-25 13:20:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by deinst created at 2015-06-25 13:23:39

Doh!  Sorry, I forgot to commit the change before pushing.


---

Comment by kcrisman created at 2015-06-25 14:01:48

William, if you see this - would this solution suffice for SMC purposes as well?

Regarding ugly, comment:4:ticket:18463 already points out that problem.   I just think that we haven't really ever talked about adding matrix plots to each other or anything else in documentation, and it's best to fix that elsewhere - hopefully in a way that also fixes this problem 'correctly'.

Also, for my or other testing reference, do

```
sage: i = identity_matrix(10,sparse=True)
sage: matrix_plot(i)
sage: matrix_plot(i, aspect_ratio='automatic')
```

as an example that David mentioned in the previous ticket.


---

Comment by kcrisman created at 2015-06-26 17:32:52

> {{{
> sage: i = identity_matrix(10,sparse=True)
> sage: matrix_plot(i)
> }}}

Oh, I remember now - that is just a difference in how we plotted sparse matrices, not related to all this stuff.


---

Comment by kcrisman created at 2015-06-26 17:40:27

I'm happy with this, ugly or not.

Can you think of ANY way for us to doctest the graphic itself (perhaps the bounding box or other attribute) to ensure this doesn't happen again?


---

Comment by kcrisman created at 2015-06-26 19:28:15

Oh wait, I forgot to make sure that this still makes things work in general, since it actually changes all graphics, not just matrix plot.  But I'm happy on the matrix plot side; if anyone checks that this works for normal graphics (including ones with `ymin>ymax` etc.) then we are good to go.

Update: they seem to in spot checks.  Running doctests.


---

Comment by kcrisman created at 2015-06-27 00:50:58

Tests pass.


---

Comment by kcrisman created at 2015-06-29 19:46:40

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2015-06-29 19:46:40

Okay, I can't find any problems here in spot checking other graphics types and using those keywords, as expected.


---

Comment by vbraun created at 2015-06-30 12:57:57

Resolution: fixed
