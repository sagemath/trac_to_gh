# Issue 10426: Nef-partitions rewrite

Issue created by migration from https://trac.sagemath.org/ticket/10479

Original creator: novoselt

Original creation time: 2010-12-15 20:35:51

Assignee: mhampton

CC:  vbraun

The current support of nef-partitions in Sage is very limited and not very well designed.

The patch provides a new implementation with convenient access to all associated polytopes. It breaks backward compatibility for nef-partitions, but it is very unlikely that anyone could seriously use the present version.

See also http://groups.google.com/group/sage-devel/browse_thread/thread/76ede735be799d1d


---

Comment by novoselt created at 2010-12-16 04:49:30

In principle, it is ready, but there are some issues building documentation, I'll resolve them shortly.

The patch looks big, but half of it is documentation and the other half doctests adjustments ;-)


---

Comment by novoselt created at 2010-12-16 04:49:30

Changing status from new to needs_work.


---

Comment by novoselt created at 2010-12-16 16:50:50

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2010-12-16 16:50:50

OK, the documentation builds and look fine.

Interactive help for `NefPartition?` in the notebook is not so great: the second $i$ in the input description is not recognized for some reason and the pretty aligned block of polytopes shows

```
Unknown control sequence '\['
```

This is due to `\\[1ex]`, removing `[1ex]` would display all four equations on the same line. Everything looks great if I replace `\\` with `\\\`, but then the HTML documentation does not build and it is wrong from LaTeX/Sphinx point of view anyway. Instead of figuring out workarounds, I propose merging this patch in its current version and opening documentation-related tickets to fix these general issues.

On the command line `NefPartition?` also has the problem with $i$ and the displayed block is rendered completely ununderstandable with some inequalities creeping in. Again, I claim that this is a general documentation problem that should be solved elsewhere. Meanwhile all definitions are given in the text anyway in a readable form, it just would be nice to have the displayed block in addition.


---

Comment by vbraun created at 2010-12-31 20:39:16

In principle I'm happy with the implementation. Just two minor details:

About the four equations, I think it would be better to avoid explicit spacing. Whats 1ex in a web browser, in a terminal??. You can just split it into two equations and say something like nef partition blah (equation) is dual to the nef partition (equation). 

My other suggestion would be to explain the INPUT section of the `nef_partition()` method in more detail. I realize that you are just refactoring that part, but it would be very helpful if you would spell out what the options do. Whats a symmetric partition?


---

Comment by vbraun created at 2010-12-31 20:39:16

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2011-01-12 01:41:27

Replying to [comment:3 vbraun]:
> About the four equations, I think it would be better to avoid explicit spacing. Whats 1ex in a web browser, in a terminal??. You can just split it into two equations and say something like nef partition blah (equation) is dual to the nef partition (equation). 

Well, in the terminal these equations are hard to comprehend anyway and a reasonable choice for 1ex spacing would be a blank line perhaps. In a browser the whole block is rendered as a LaTeX expression using some font, so 1ex means what it should mean in LaTeX. So I would prefer to keep it as is, since it pleases my eyes when rendered properly ;-) But if you really want I'll break it into two blocks.

> My other suggestion would be to explain the INPUT section of the `nef_partition()` method in more detail. I realize that you are just refactoring that part, but it would be very helpful if you would spell out what the options do. Whats a symmetric partition? 

I'll try to make it more clear. The most accurate explanation is that a certain option is passed to nef.x. As far as I understand, two partitions are symmetric if one is the image of another under a lattice symmetry of the polytope.


---

Attachment

I tried to clarify options of `nef_partitions`.

I also replaced `\\[1ex]` with `\\ & \\` to make "just a blank line" but keep four equations aligned together. This works fine for the compiled HTML documentation and the interactive help in the notebook does not produce an error. It does not look as it should however, because the documentation parser incorrectly processes slashes. Command line help also does not look good, but no surprise here. My opinion is that I am using correct and appropriate formatting, so it is not my bug if the result does not look as expected.

Playing with

```
def g():
    r"""
    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2
    
    plain text
    
    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2

    ``code``
        
    1 \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ 2        
    """
    pass
g?
```

in the notebook shows that slashes are fine as long as there is no code or math insertions, but ones there is one - the original number of slashes somehow decreases despite of "r" in the beginning of the string.


---

Comment by novoselt created at 2011-01-13 05:19:50

Changing status from needs_work to needs_review.


---

Comment by vbraun created at 2011-01-13 08:51:45

I still don't get why we can't break up the huge equation if _none_ of the backends renders it correctly. Saying that its not your problem is a cop out, jsmath will never be 100% compatible with LaTeX. 

In any case, functionally its fine and I'll give it a positive review. If Andrey changes his mind and wants a readable documentation then he's welcome to update it.


---

Comment by vbraun created at 2011-01-13 08:51:45

Changing status from needs_review to positive_review.


---

Comment by novoselt created at 2011-01-13 16:54:45

Replying to [comment:6 vbraun]:
> I still don't get why we can't break up the huge equation if _none_ of the backends renders it correctly. Saying that its not your problem is a cop out, jsmath will never be 100% compatible with LaTeX. 

Why _none_?
 * HTML from Sphynx looks great!
 * In the notebook all equations now also appear in a clear way but on one line and with a little bit weird spacing. As far as I understand this is not jsmath problem - if I replace `\\` with `\\\` for the line breaks, then they get placed on separate lines and are aligned as they should, so the problem is that slashes mysteriously disappear before they are processed by jsmath. I will open a ticket for this.
 * As for the command line - each line of the block is probably harder to understand by humans than the preceding plain text explanation that still has all detail, so whether these lines are together or not does not make much difference.
 
> In any case, functionally its fine and I'll give it a positive review. If Andrey changes his mind and wants a readable documentation then he's welcome to update it.

Thank you ;-)


---

Comment by novoselt created at 2011-01-13 17:16:02

#10624 reports the documentation problem.


---

Comment by vbraun created at 2011-01-13 17:29:36

In the notebook all 4 equations end up on one very long line. At least on Chrome the text is then as wide as the equation line, which is a good deal wider than my screen. I can zoom out until the equation fits, but then the text is tiny.


---

Comment by novoselt created at 2011-01-13 17:52:57

This is exactly why I try to fight long lines in examples and their output...

I opened
http://groups.google.com/group/sage-devel/browse_thread/thread/5af60a53b2618833#
and if there will be no solution I'll think again about breaking the block into pieces.


---

Comment by jdemeyer created at 2011-01-19 22:24:39

Resolution: fixed
