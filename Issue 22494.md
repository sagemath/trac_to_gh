# Issue 22494: Allow installation of sage scripts to an arbotrary location by using SAGE_SCRIPTS_DIR.

archive/issues_022494.json:
```json
{
    "body": "CC:  mkoeppe jhpalmieri mjo @tobiasdiez isuruf arojas @mwageringel\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22731\n\n",
    "created_at": "2017-03-31T20:38:14Z",
    "labels": [
        "PLEASE CHANGE",
        "major",
        "PLEASE CHANGE"
    ],
    "title": "Allow installation of sage scripts to an arbotrary location by using SAGE_SCRIPTS_DIR.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22494",
    "user": "thansen"
}
```
CC:  mkoeppe jhpalmieri mjo @tobiasdiez isuruf arojas @mwageringel



Issue created by migration from https://trac.sagemath.org/ticket/22731





---

archive/issue_comments_313368.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2017-03-31T20:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313368",
    "user": "thansen"
}
```

Changing priority from major to minor.



---

archive/issue_comments_313369.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-03-31T20:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313369",
    "user": "thansen"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_313370.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-31T20:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313370",
    "user": "thansen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_313371.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-03-31T20:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313371",
    "user": "thansen"
}
```

New commits:



---

archive/issue_comments_313372.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to scripts.",
    "created_at": "2017-03-31T20:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313372",
    "user": "thansen"
}
```

Changing component from PLEASE CHANGE to scripts.



---

archive/issue_comments_313373.json:
```json
{
    "body": "The name `SAGE_SCRIPTS_DIR` refers to the scripts of Sage itself. It is only meant to find `sage-env` and friends, nothing more.\n\nNow, if you want a invent a *new* variable with the purpose of defining the bindir (to replace `SAGE_LOCAL/bin`), that's fine. Just don't call it `SAGE_SCRIPTS_DIR`.",
    "created_at": "2017-04-01T10:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313373",
    "user": "jdemeyer"
}
```

The name `SAGE_SCRIPTS_DIR` refers to the scripts of Sage itself. It is only meant to find `sage-env` and friends, nothing more.

Now, if you want a invent a *new* variable with the purpose of defining the bindir (to replace `SAGE_LOCAL/bin`), that's fine. Just don't call it `SAGE_SCRIPTS_DIR`.



---

archive/issue_comments_313374.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-01T10:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313374",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_313375.json:
```json
{
    "body": "Changing component from scripts to porting.",
    "created_at": "2017-04-01T10:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313375",
    "user": "jdemeyer"
}
```

Changing component from scripts to porting.



---

archive/issue_comments_313376.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-01T21:19:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313376",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313377.json:
```json
{
    "body": "I have not had a chance to try this out locally (as my Sage is rebuilding.) Is this more or less what you had in mind jdemeyer?",
    "created_at": "2018-04-01T21:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313377",
    "user": "saraedum"
}
```

I have not had a chance to try this out locally (as my Sage is rebuilding.) Is this more or less what you had in mind jdemeyer?



---

archive/issue_comments_313378.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-01T21:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313378",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_313379.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-02T08:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313379",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313380.json:
```json
{
    "body": "It makes no sense to add both `$SAGE_LOCAL/bin` and `$SAGE_BIN` to the `PATH`. The whole point should be to replace `$SAGE_LOCAL/bin` by `$SAGE_BIN`.",
    "created_at": "2018-04-02T08:20:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313380",
    "user": "jdemeyer"
}
```

It makes no sense to add both `$SAGE_LOCAL/bin` and `$SAGE_BIN` to the `PATH`. The whole point should be to replace `$SAGE_LOCAL/bin` by `$SAGE_BIN`.



---

archive/issue_comments_313381.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-02T08:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313381",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313382.json:
```json
{
    "body": "1. You need to define `SAGE_BIN` somewhere in `sage-env`\n\n2. This conflicts with #25056",
    "created_at": "2018-04-02T08:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313382",
    "user": "jdemeyer"
}
```

1. You need to define `SAGE_BIN` somewhere in `sage-env`

2. This conflicts with #25056



---

archive/issue_comments_313383.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-02T08:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313383",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_313384.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-03T13:01:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313384",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313385.json:
```json
{
    "body": "Thanks for the feedback. I do not really understand how these scripts interact. Did you mean something like this?\n\nWhat is your point when it comes to the conflict with #25056. I guess whoever gets merged last needs to fix conflicts? Or is there something more substantial that needs to be taken into account?",
    "created_at": "2018-04-03T13:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313385",
    "user": "saraedum"
}
```

Thanks for the feedback. I do not really understand how these scripts interact. Did you mean something like this?

What is your point when it comes to the conflict with #25056. I guess whoever gets merged last needs to fix conflicts? Or is there something more substantial that needs to be taken into account?



---

archive/issue_comments_313386.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-03T13:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313386",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_313387.json:
```json
{
    "body": "[my Sage is rebuilding as always, so I could not test this yet.]",
    "created_at": "2018-04-03T13:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313387",
    "user": "saraedum"
}
```

[my Sage is rebuilding as always, so I could not test this yet.]



---

archive/issue_comments_313388.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-05T09:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313388",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_313389.json:
```json
{
    "body": "Replying to [comment:13 saraedum]:\n> What is your point when it comes to the conflict with #25056. I guess whoever gets merged last needs to fix conflicts? Or is there something more substantial that needs to be taken into account?\n\nIn this case, #25056 is a blocker so it will certainly take priority over this ticket. So it might be a good idea to rebase on top of #25056.",
    "created_at": "2018-04-05T09:02:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313389",
    "user": "jdemeyer"
}
```

Replying to [comment:13 saraedum]:
> What is your point when it comes to the conflict with #25056. I guess whoever gets merged last needs to fix conflicts? Or is there something more substantial that needs to be taken into account?

In this case, #25056 is a blocker so it will certainly take priority over this ticket. So it might be a good idea to rebase on top of #25056.



---

archive/issue_comments_313390.json:
```json
{
    "body": "1. `SAGE_BIN` should be set to the `--bindir` determined by `./configure`. Use `src/bin/sage-env-config.in` to implement this.\n\n2. I don't think that it should be allowed to override `SAGE_BIN` at runtime, it should be set unconditionally to the value determined by `./configure`. This would be analogous to `SAGE_LOCAL`.",
    "created_at": "2018-04-05T09:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313390",
    "user": "jdemeyer"
}
```

1. `SAGE_BIN` should be set to the `--bindir` determined by `./configure`. Use `src/bin/sage-env-config.in` to implement this.

2. I don't think that it should be allowed to override `SAGE_BIN` at runtime, it should be set unconditionally to the value determined by `./configure`. This would be analogous to `SAGE_LOCAL`.



---

archive/issue_comments_313391.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-05T14:28:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313391",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313392.json:
```json
{
    "body": "Darn I had filled the wrong field when I wanted to \"subscribe\" to this ticket. \n\nI am not hot to create a new variable especially for calling stuff that should by and large be in the `PATH`. In my opinion, for sage-on-distro, it is even better if there is nothing in front of the name of the executables. It should just work unless you mess your environment and I am not sure we should protect the end users to that level.",
    "created_at": "2018-04-06T10:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313392",
    "user": "fbissey"
}
```

Darn I had filled the wrong field when I wanted to "subscribe" to this ticket. 

I am not hot to create a new variable especially for calling stuff that should by and large be in the `PATH`. In my opinion, for sage-on-distro, it is even better if there is nothing in front of the name of the executables. It should just work unless you mess your environment and I am not sure we should protect the end users to that level.



---

archive/issue_comments_313393.json:
```json
{
    "body": "fbissey: So you are saying that you want to have all the `sage-*` scripts in the PATH? I think it's reasonable for some distros that they want to hide these. I can imagine that one reason to get them off the path is that some distros want MAN pages for everything that's on the PATH. Also not all of these scripts have a nice `--help`/`-h` implemented.",
    "created_at": "2018-04-06T11:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313393",
    "user": "saraedum"
}
```

fbissey: So you are saying that you want to have all the `sage-*` scripts in the PATH? I think it's reasonable for some distros that they want to hide these. I can imagine that one reason to get them off the path is that some distros want MAN pages for everything that's on the PATH. Also not all of these scripts have a nice `--help`/`-h` implemented.



---

archive/issue_comments_313394.json:
```json
{
    "body": "I see. But it feels like it is more than just the sage-* scripts that are touched here. In `src/sage/graphs/lovasz_theta.py` this is not the path to a sage script but to an executable from an optional package for example. So you end up having to separate the scripts from the normal commands that are installed in `SAGE_LOCAL/bin`. I don't see this ticket currently doing that.",
    "created_at": "2018-04-06T11:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313394",
    "user": "fbissey"
}
```

I see. But it feels like it is more than just the sage-* scripts that are touched here. In `src/sage/graphs/lovasz_theta.py` this is not the path to a sage script but to an executable from an optional package for example. So you end up having to separate the scripts from the normal commands that are installed in `SAGE_LOCAL/bin`. I don't see this ticket currently doing that.



---

archive/issue_comments_313395.json:
```json
{
    "body": "You're right. I'll try to change the scope of `SAGE_BIN`.",
    "created_at": "2018-04-06T11:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313395",
    "user": "saraedum"
}
```

You're right. I'll try to change the scope of `SAGE_BIN`.



---

archive/issue_comments_313396.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-11T23:47:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313396",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313397.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2018-04-12T00:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313397",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_313398.json:
```json
{
    "body": "I wonder whether we should do the following:\n\n* Introduce `$SAGE_BIN` as the place where `sage` and the binaries of all the SPKGs get installed to. Configurable through `./configure --bindir`, default `$SAGE_LOCAL/bin/`.\n* Make `$SAGE_SCRIPTS_DIR` available like any other `$SAGE_` variable everywhere and use it as the directory where all the `sage-*` scripts are installed to. The default should be `$SAGE_LOCAL/bin/`, however, it's configurable as `./configure --scriptsdir`.\n* The explicit calls such as `$SAGE_LOCAL/bin/theta` should go away with #20382. We should always call what's on the PATH when calling a non-Sage binary (possibly after we checked that it's sane with a Feature check.)\n\nAlternatively the second point could be replaced by the following two:\n\n* Introduce `$SAGE_LIBEXEC`. Configurable through `./configure --libexecdir`, default `$SAGE_LOCAL/libexec/`. (See https://www.gnu.org/prep/standards/html_node/Directory-Variables.html.)\n* Make `$SAGE_SCRIPTS_DIR` available like any other `$SAGE_` variable everywhere and use it as the directory where all the `sage-*` scripts are installed to. The default should be `$SAGE_LIBEXEC/sage/`. To keep backwards compatibility, we need the default to be `$SAGE_LOCAL/bin` if `$SAGE_LOCAL/bin/sage-env` exists.\n\nThe `$SAGE_SCRIPTS_DIR` fallback is ugly of course. It means that Sage installs vary depending on whether they are clean installs (after this proposal) or upgrades from before. That's unfortunate but we have that already because SPKGs do not uninstall completely. (Or do they by now?) Anyway, I think it makes sense to install things into standard places and I guess it could make the life of packagers easier.\n\nWhat do you think?",
    "created_at": "2018-04-12T00:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313398",
    "user": "saraedum"
}
```

I wonder whether we should do the following:

* Introduce `$SAGE_BIN` as the place where `sage` and the binaries of all the SPKGs get installed to. Configurable through `./configure --bindir`, default `$SAGE_LOCAL/bin/`.
* Make `$SAGE_SCRIPTS_DIR` available like any other `$SAGE_` variable everywhere and use it as the directory where all the `sage-*` scripts are installed to. The default should be `$SAGE_LOCAL/bin/`, however, it's configurable as `./configure --scriptsdir`.
* The explicit calls such as `$SAGE_LOCAL/bin/theta` should go away with #20382. We should always call what's on the PATH when calling a non-Sage binary (possibly after we checked that it's sane with a Feature check.)

Alternatively the second point could be replaced by the following two:

* Introduce `$SAGE_LIBEXEC`. Configurable through `./configure --libexecdir`, default `$SAGE_LOCAL/libexec/`. (See https://www.gnu.org/prep/standards/html_node/Directory-Variables.html.)
* Make `$SAGE_SCRIPTS_DIR` available like any other `$SAGE_` variable everywhere and use it as the directory where all the `sage-*` scripts are installed to. The default should be `$SAGE_LIBEXEC/sage/`. To keep backwards compatibility, we need the default to be `$SAGE_LOCAL/bin` if `$SAGE_LOCAL/bin/sage-env` exists.

The `$SAGE_SCRIPTS_DIR` fallback is ugly of course. It means that Sage installs vary depending on whether they are clean installs (after this proposal) or upgrades from before. That's unfortunate but we have that already because SPKGs do not uninstall completely. (Or do they by now?) Anyway, I think it makes sense to install things into standard places and I guess it could make the life of packagers easier.

What do you think?



---

archive/issue_comments_313399.json:
```json
{
    "body": "Well, I don't use the `configure` script but that sound relatively reasonable. I personally ship stuff like `sage-env` in `/etc` where I feel it belongs but that may be hard at this stage.\n\nUninstall is still being worked on by Erik, but it cannot be helped that there may be a hard block upgrading from a certain version of sage once those things are in place.",
    "created_at": "2018-04-12T01:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313399",
    "user": "fbissey"
}
```

Well, I don't use the `configure` script but that sound relatively reasonable. I personally ship stuff like `sage-env` in `/etc` where I feel it belongs but that may be hard at this stage.

Uninstall is still being worked on by Erik, but it cannot be helped that there may be a hard block upgrading from a certain version of sage once those things are in place.



---

archive/issue_comments_313400.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2018-04-29T17:58:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313400",
    "user": "saraedum"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_313401.json:
```json
{
    "body": "Thanks for the feedback. I think I prefer the non-breaking change at the moment.",
    "created_at": "2018-04-29T17:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313401",
    "user": "saraedum"
}
```

Thanks for the feedback. I think I prefer the non-breaking change at the moment.



---

archive/issue_comments_313402.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-29T18:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313402",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_313403.json:
```json
{
    "body": "I think I want to the binaries differently if they are non-optional dependencies. So I think this should not be part of this ticket.",
    "created_at": "2018-04-29T18:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313403",
    "user": "saraedum"
}
```

I think I want to the binaries differently if they are non-optional dependencies. So I think this should not be part of this ticket.



---

archive/issue_comments_313404.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-29T19:00:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313404",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313405.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-29T19:00:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313405",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_313406.json:
```json
{
    "body": "This still needs quite some testing. I just want to see what the patchbot thinks about this.",
    "created_at": "2018-04-29T19:00:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313406",
    "user": "saraedum"
}
```

This still needs quite some testing. I just want to see what the patchbot thinks about this.



---

archive/issue_comments_313407.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-05-01T16:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313407",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_313408.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-01T16:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313408",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_313409.json:
```json
{
    "body": "Ok, the patchbot does probably not help much here as it does not rebuild if something that fundamental changes. Let's see what CI thinks about it.",
    "created_at": "2018-05-01T16:17:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313409",
    "user": "saraedum"
}
```

Ok, the patchbot does probably not help much here as it does not rebuild if something that fundamental changes. Let's see what CI thinks about it.



---

archive/issue_comments_313410.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-03T18:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313410",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-11T14:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313411",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313412.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-15T09:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313412",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-05-20T22:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313413",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_313414.json:
```json
{
    "body": "Would people on this thread have an idea on what can be done to make `$SAGE_LOCAL/bin/sage` work when `$SAGE_ROOT` is not yet set and/or how one can figure out if `$SAGE_ROOT/sage` (a script that has more logic to figure out a value for `$SAGE_ROOT`) is an acceptable executable to use?\n\nIt comes up in producing a jupyter kernelspec for sage that is suitable for use by an external jupyter. See: \n[sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/yEUJOW2fnJI)\n\nIf we can make it very easy to install sage's kernelspec in arbitrary jupyter configurations, it becomes significantly easier to integrate sage in computational environments (for instance, should the nteract desktop jupyter client ever become popular, we could just provide easy interfacing with a system install of it rather than packaging it with sage).",
    "created_at": "2018-05-20T23:42:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313414",
    "user": "nbruin"
}
```

Would people on this thread have an idea on what can be done to make `$SAGE_LOCAL/bin/sage` work when `$SAGE_ROOT` is not yet set and/or how one can figure out if `$SAGE_ROOT/sage` (a script that has more logic to figure out a value for `$SAGE_ROOT`) is an acceptable executable to use?

It comes up in producing a jupyter kernelspec for sage that is suitable for use by an external jupyter. See: 
[sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/yEUJOW2fnJI)

If we can make it very easy to install sage's kernelspec in arbitrary jupyter configurations, it becomes significantly easier to integrate sage in computational environments (for instance, should the nteract desktop jupyter client ever become popular, we could just provide easy interfacing with a system install of it rather than packaging it with sage).



---

archive/issue_comments_313415.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-21T14:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313415",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313416.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-22T21:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313416",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313417.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-26T13:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313417",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_313418.json:
```json
{
    "body": "The CI tests were successful (the failed tests are due to #25431)",
    "created_at": "2018-05-26T13:10:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313418",
    "user": "saraedum"
}
```

The CI tests were successful (the failed tests are due to #25431)



---

archive/issue_comments_313419.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-26T13:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313419",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313420.json:
```json
{
    "body": "Replying to [comment:28 saraedum]:\n> Alternatively the second point could be replaced by the following two:\n> \n> * Introduce `$SAGE_LIBEXEC`. Configurable through `./configure --libexecdir`, default `$SAGE_LOCAL/libexec/`. (See https://www.gnu.org/prep/standards/html_node/Directory-Variables.html.)\n\n+1 for using libexec for all auxiliary scripts that are not useful for the user from the command line.",
    "created_at": "2018-05-31T17:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313420",
    "user": "mkoeppe"
}
```

Replying to [comment:28 saraedum]:
> Alternatively the second point could be replaced by the following two:
> 
> * Introduce `$SAGE_LIBEXEC`. Configurable through `./configure --libexecdir`, default `$SAGE_LOCAL/libexec/`. (See https://www.gnu.org/prep/standards/html_node/Directory-Variables.html.)

+1 for using libexec for all auxiliary scripts that are not useful for the user from the command line.



---

archive/issue_comments_313421.json:
```json
{
    "body": "It's hard to see the changes on this branch, by the way, since this is on top of some circleci branch; also needs rebasing.",
    "created_at": "2018-05-31T17:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313421",
    "user": "mkoeppe"
}
```

It's hard to see the changes on this branch, by the way, since this is on top of some circleci branch; also needs rebasing.



---

archive/issue_comments_313422.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-01T00:40:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313422",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313423.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-01T00:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313423",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313424.json:
```json
{
    "body": "See also #21559, #21569, #21570.",
    "created_at": "2018-06-02T04:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313424",
    "user": "mkoeppe"
}
```

See also #21559, #21569, #21570.



---

archive/issue_comments_313425.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-06-21T10:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313425",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_313426.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-07-11T10:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313426",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_313427.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-12T09:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313427",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313428.json:
```json
{
    "body": "1. There is a merge conflicts.\n\n2. As I mentioned in [comment:4], don't use `SAGE_SCRIPTS_DIR`.",
    "created_at": "2019-03-21T13:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313428",
    "user": "jdemeyer"
}
```

1. There is a merge conflicts.

2. As I mentioned in [comment:4], don't use `SAGE_SCRIPTS_DIR`.



---

archive/issue_comments_313429.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-21T13:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313429",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_313430.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2020-08-24T17:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313430",
    "user": "mkoeppe"
}
```

Changing priority from minor to major.



---

archive/issue_comments_313431.json:
```json
{
    "body": "Rebased away from #24854\n----\nNew commits:",
    "created_at": "2020-09-11T19:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313431",
    "user": "mkoeppe"
}
```

Rebased away from #24854
----
New commits:



---

archive/issue_comments_313432.json:
```json
{
    "body": "Hoping that we can move this ticket forward next, to reduce the amount of necessary patching in distribution packaging.",
    "created_at": "2020-09-16T01:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313432",
    "user": "mkoeppe"
}
```

Hoping that we can move this ticket forward next, to reduce the amount of necessary patching in distribution packaging.



---

archive/issue_comments_313433.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-11-10T23:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313433",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_313434.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-11T01:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313434",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313435.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-11T01:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313435",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_313436.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-11T02:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313436",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313437.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-11T19:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313437",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_313438.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-12T18:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313438",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_313439.json:
```json
{
    "body": "Picked some changes from #29850, rebased away from it.",
    "created_at": "2020-11-12T18:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313439",
    "user": "mkoeppe"
}
```

Picked some changes from #29850, rebased away from it.



---

archive/issue_comments_313440.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-12T18:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313440",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313441.json:
```json
{
    "body": "Although the ticket description is long, the actual changes on top of #29951 are very small. Essentially, the `sage` script now relies on the `PATH` set by `sage-env` instead of hardcoding the directory where `python3` etc. is located. `$SAGE_VENV/bin` is used explicitly only in a few places that need an absolute filename.\n\nReady for review",
    "created_at": "2020-11-12T18:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313441",
    "user": "mkoeppe"
}
```

Although the ticket description is long, the actual changes on top of #29951 are very small. Essentially, the `sage` script now relies on the `PATH` set by `sage-env` instead of hardcoding the directory where `python3` etc. is located. `$SAGE_VENV/bin` is used explicitly only in a few places that need an absolute filename.

Ready for review



---

archive/issue_comments_313442.json:
```json
{
    "body": "Codewise this looks good to me, but may I ask that you add a shortened version of the ticket description as comments in the `env.py` file as documentation for the `SAGE_VENV` and `SAGE_LOCAL` variable as it's not clear from the context when to use which.\n\nMoreover, I was wondering if it makes sense to provide only a variable `SAGE_VENV_BIN` pointing to the binary folder in the venv (since at least from your ticket description and code changes would be sufficient and parallels the upcoming `SAGE_BIN`).\n\nNeeds another review as I'm not yet that familiar with sages inner workings.",
    "created_at": "2020-11-12T21:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313442",
    "user": "@tobiasdiez"
}
```

Codewise this looks good to me, but may I ask that you add a shortened version of the ticket description as comments in the `env.py` file as documentation for the `SAGE_VENV` and `SAGE_LOCAL` variable as it's not clear from the context when to use which.

Moreover, I was wondering if it makes sense to provide only a variable `SAGE_VENV_BIN` pointing to the binary folder in the venv (since at least from your ticket description and code changes would be sufficient and parallels the upcoming `SAGE_BIN`).

Needs another review as I'm not yet that familiar with sages inner workings.



---

archive/issue_comments_313443.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-13T01:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313443",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313444.json:
```json
{
    "body": "Replying to [comment:99 gh-tobiasdiez]:\n> ... may I ask that you add a shortened version of the ticket description as comments in the `env.py` file as documentation for the `SAGE_VENV` and `SAGE_LOCAL` variable \n\nDone, please take a look",
    "created_at": "2020-11-13T01:27:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313444",
    "user": "mkoeppe"
}
```

Replying to [comment:99 gh-tobiasdiez]:
> ... may I ask that you add a shortened version of the ticket description as comments in the `env.py` file as documentation for the `SAGE_VENV` and `SAGE_LOCAL` variable 

Done, please take a look



---

archive/issue_comments_313445.json:
```json
{
    "body": "Replying to [comment:99 gh-tobiasdiez]:\n> I was wondering if it makes sense to provide only a variable `SAGE_VENV_BIN` pointing to the binary folder in the venv (since at least from your ticket description and code changes would be sufficient and parallels the upcoming `SAGE_BIN`).\nSure, that will make sense to do in the follow-up ticket regarding `SAGE_BIN` (if the downstream packagers still need that...)",
    "created_at": "2020-11-13T01:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313445",
    "user": "mkoeppe"
}
```

Replying to [comment:99 gh-tobiasdiez]:
> I was wondering if it makes sense to provide only a variable `SAGE_VENV_BIN` pointing to the binary folder in the venv (since at least from your ticket description and code changes would be sufficient and parallels the upcoming `SAGE_BIN`).
Sure, that will make sense to do in the follow-up ticket regarding `SAGE_BIN` (if the downstream packagers still need that...)



---

archive/issue_comments_313446.json:
```json
{
    "body": "Replying to [comment:101 mkoeppe]:\n> Replying to [comment:99 gh-tobiasdiez]:\n> > ... may I ask that you add a shortened version of the ticket description as comments in the `env.py` file as documentation for the `SAGE_VENV` and `SAGE_LOCAL` variable \n> \n> Done, please take a look\n\nThanks! Looks good.",
    "created_at": "2020-11-13T09:00:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313446",
    "user": "@tobiasdiez"
}
```

Replying to [comment:101 mkoeppe]:
> Replying to [comment:99 gh-tobiasdiez]:
> > ... may I ask that you add a shortened version of the ticket description as comments in the `env.py` file as documentation for the `SAGE_VENV` and `SAGE_LOCAL` variable 
> 
> Done, please take a look

Thanks! Looks good.



---

archive/issue_comments_313447.json:
```json
{
    "body": "running\n\n```\n$ grep SAGE_LOCAL/bin build/ -R\n```\n\nreturns quite a few hits, mostly in  build/pkgs/\n\nShouldn't most of these be replaced with `SAGE_BIN` ?",
    "created_at": "2020-11-18T12:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313447",
    "user": "dimpase"
}
```

running

```
$ grep SAGE_LOCAL/bin build/ -R
```

returns quite a few hits, mostly in  build/pkgs/

Shouldn't most of these be replaced with `SAGE_BIN` ?



---

archive/issue_comments_313448.json:
```json
{
    "body": "See ticket description - \"In this ticket, ...\"",
    "created_at": "2020-11-18T19:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313448",
    "user": "mkoeppe"
}
```

See ticket description - "In this ticket, ..."



---

archive/issue_comments_313449.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-19T13:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313449",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_313450.json:
```json
{
    "body": "OK, fine",
    "created_at": "2020-11-19T13:13:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313450",
    "user": "dimpase"
}
```

OK, fine



---

archive/issue_comments_313451.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-11-19T17:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313451",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_313452.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-22T15:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313452",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_313453.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2020-11-22T16:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313453",
    "user": "vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_313454.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-11-22T16:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313454",
    "user": "vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_313455.json:
```json
{
    "body": "\n```\n$ git clean -f -d -x .\n$ ./bootstrap -d\nrm -rf config configure build/make/Makefile-auto.in\nrm -f src/doc/en/installation/*.txt\nrm -rf src/doc/en/reference/spkg/*.rst\nrm -f src/doc/en/reference/repl/*.txt\nsrc/doc/bootstrap:60: installing src/doc/en/installation/arch*.txt\nsrc/doc/bootstrap:60: installing src/doc/en/installation/debian*.txt\nsrc/doc/bootstrap:60: installing src/doc/en/installation/fedora*.txt\nsrc/doc/bootstrap:60: installing src/doc/en/installation/cygwin*.txt\nsrc/doc/bootstrap:60: installing src/doc/en/installation/homebrew*.txt\nsrc/doc/bootstrap:70: installing src/doc/en/reference/spkg/*.rst\nsrc/doc/bootstrap:102: installing src/doc/en/reference/repl/options.txt\nError: You must set either the SAGE_LOCAL or SAGE_SCRIPTS_DIR environment variable to run this\nError setting environment variables by sourcing '/Users/vbraun/Sage/src/bin/sage-env';\npossibly contact sage-devel (see http://groups.google.com/group/sage-devel).\n```\n",
    "created_at": "2020-11-22T16:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313455",
    "user": "vbraun"
}
```


```
$ git clean -f -d -x .
$ ./bootstrap -d
rm -rf config configure build/make/Makefile-auto.in
rm -f src/doc/en/installation/*.txt
rm -rf src/doc/en/reference/spkg/*.rst
rm -f src/doc/en/reference/repl/*.txt
src/doc/bootstrap:60: installing src/doc/en/installation/arch*.txt
src/doc/bootstrap:60: installing src/doc/en/installation/debian*.txt
src/doc/bootstrap:60: installing src/doc/en/installation/fedora*.txt
src/doc/bootstrap:60: installing src/doc/en/installation/cygwin*.txt
src/doc/bootstrap:60: installing src/doc/en/installation/homebrew*.txt
src/doc/bootstrap:70: installing src/doc/en/reference/spkg/*.rst
src/doc/bootstrap:102: installing src/doc/en/reference/repl/options.txt
Error: You must set either the SAGE_LOCAL or SAGE_SCRIPTS_DIR environment variable to run this
Error setting environment variables by sourcing '/Users/vbraun/Sage/src/bin/sage-env';
possibly contact sage-devel (see http://groups.google.com/group/sage-devel).
```




---

archive/issue_comments_313456.json:
```json
{
    "body": "I noticed it as well in sage-on-gentoo. I was trying to minimize the patch to `bin/sage` but that got me. This is ultimately caused by the last line of `src/doc/bootstrap`\n\n```\n./sage -advanced > \"$OUTPUT\"\n```\n\nWhy is this line needed, I am wondering?",
    "created_at": "2020-11-22T20:59:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313456",
    "user": "fbissey"
}
```

I noticed it as well in sage-on-gentoo. I was trying to minimize the patch to `bin/sage` but that got me. This is ultimately caused by the last line of `src/doc/bootstrap`

```
./sage -advanced > "$OUTPUT"
```

Why is this line needed, I am wondering?



---

archive/issue_comments_313457.json:
```json
{
    "body": "Replying to [comment:114 fbissey]:\n> This is ultimately caused by the last line of `src/doc/bootstrap`\n> {{{\n> ./sage -advanced > \"$OUTPUT\"\n> }}}\n> Why is this line needed, I am wondering?\n\nIt generates part of the documentation.",
    "created_at": "2020-11-22T21:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313457",
    "user": "mkoeppe"
}
```

Replying to [comment:114 fbissey]:
> This is ultimately caused by the last line of `src/doc/bootstrap`
> {{{
> ./sage -advanced > "$OUTPUT"
> }}}
> Why is this line needed, I am wondering?

It generates part of the documentation.



---

archive/issue_comments_313458.json:
```json
{
    "body": "Is at the error point the value of `SAGE_SCRIPTS_DIR` already known?",
    "created_at": "2020-11-22T22:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313458",
    "user": "dimpase"
}
```

Is at the error point the value of `SAGE_SCRIPTS_DIR` already known?



---

archive/issue_comments_313459.json:
```json
{
    "body": "I see how it is used now. And no, `SAGE_SCRIPTS_DIR` or anything like that is not known, we are bootstrapping the documentation, which you should be able to do before running configure.\n\nSome dummy values could be set in the bootstrap script on the assumption you do that on a clean tree.",
    "created_at": "2020-11-22T22:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313459",
    "user": "fbissey"
}
```

I see how it is used now. And no, `SAGE_SCRIPTS_DIR` or anything like that is not known, we are bootstrapping the documentation, which you should be able to do before running configure.

Some dummy values could be set in the bootstrap script on the assumption you do that on a clean tree.



---

archive/issue_comments_313460.json:
```json
{
    "body": "The problem is solved in #30013, so I need to move some of the changes to this ticket.",
    "created_at": "2020-11-22T22:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313460",
    "user": "mkoeppe"
}
```

The problem is solved in #30013, so I need to move some of the changes to this ticket.



---

archive/issue_comments_313461.json:
```json
{
    "body": "Replying to [comment:118 mkoeppe]:\n> The problem is solved in #30013, so I need to move some of the changes to this ticket.\n\nYes, it looks like it would help.",
    "created_at": "2020-11-22T22:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313461",
    "user": "fbissey"
}
```

Replying to [comment:118 mkoeppe]:
> The problem is solved in #30013, so I need to move some of the changes to this ticket.

Yes, it looks like it would help.



---

archive/issue_comments_313462.json:
```json
{
    "body": "I will work on this after the next beta comes out.",
    "created_at": "2020-11-22T22:40:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313462",
    "user": "mkoeppe"
}
```

I will work on this after the next beta comes out.



---

archive/issue_comments_313463.json:
```json
{
    "body": "Anyhow, just in case, here one could do\n\n```diff\n--- a/bootstrap\n+++ b/bootstrap\n@@ -113,6 +113,8 @@ SAGE_SPKG_CONFIGURE_$(echo ${pkgname} | tr '[a-z]' '[A-Z]')\"\n     # ONLY stderr, and to re-output the results back to stderr leaving\n     # stdout alone. Basically we swap the two descriptors using a\n     # third, filter, and then swap them back.\n+    touch src/bin/sage-env-config\n+    SAGE_SCRIPTS_DIR=./src/bin\n     BOOTSTRAP_QUIET=\"${BOOTSTRAP_QUIET}\" \\\n     SAGE_ROOT=\"$SAGE_ROOT\" \\\n     src/doc/bootstrap && \\\n```\n\nand it all goes through.",
    "created_at": "2020-11-22T22:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313463",
    "user": "dimpase"
}
```

Anyhow, just in case, here one could do

```diff
--- a/bootstrap
+++ b/bootstrap
@@ -113,6 +113,8 @@ SAGE_SPKG_CONFIGURE_$(echo ${pkgname} | tr '[a-z]' '[A-Z]')"
     # ONLY stderr, and to re-output the results back to stderr leaving
     # stdout alone. Basically we swap the two descriptors using a
     # third, filter, and then swap them back.
+    touch src/bin/sage-env-config
+    SAGE_SCRIPTS_DIR=./src/bin
     BOOTSTRAP_QUIET="${BOOTSTRAP_QUIET}" \
     SAGE_ROOT="$SAGE_ROOT" \
     src/doc/bootstrap && \
```

and it all goes through.



---

archive/issue_comments_313464.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-23T02:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313464",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313465.json:
```json
{
    "body": "Cherry-picked a commit from the original branch of #30888, where it was observed that\n`SAGE_SCRIPTS_DIR` is currently unused because the feature introduced in #25486 (\"Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables\") was killed by #30128.\n(#30888 will re-introduce this feature using a different mechanism.)",
    "created_at": "2020-11-23T02:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313465",
    "user": "mkoeppe"
}
```

Cherry-picked a commit from the original branch of #30888, where it was observed that
`SAGE_SCRIPTS_DIR` is currently unused because the feature introduced in #25486 ("Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables") was killed by #30128.
(#30888 will re-introduce this feature using a different mechanism.)



---

archive/issue_comments_313466.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-23T02:09:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313466",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_313467.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-25T00:53:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313467",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_313468.json:
```json
{
    "body": "Merged the latest beta. Ready for another round of review.",
    "created_at": "2020-11-25T00:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313468",
    "user": "mkoeppe"
}
```

Merged the latest beta. Ready for another round of review.



---

archive/issue_comments_313469.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-25T19:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313469",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_313470.json:
```json
{
    "body": "this works, after \"git clean\" as above, too.",
    "created_at": "2020-11-25T19:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313470",
    "user": "dimpase"
}
```

this works, after "git clean" as above, too.



---

archive/issue_comments_313471.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-11-25T19:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313471",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_313472.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-05T22:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22494#issuecomment-313472",
    "user": "vbraun"
}
```

Resolution: fixed
