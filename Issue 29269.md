# Issue 29269: Backend for Hyperplane Arrangements

Issue created by migration from https://trac.sagemath.org/ticket/29506

Original creator: jipilab

Original creation time: 2020-04-14 12:14:11

CC:  aram.dermenjian @kliem @laisrast selia nailuj tscrim

Keywords: backend, normaliz, hyperplane, regions

Currently, Hyperplane arrangements only use the default backends for related polyhedral objects.

We should make it possible to use backends. For example:


```
sage: K.<q> = CyclotomicField(9)
sage: L.<r9> = NumberField((q+q^(-1)).minpoly(),embedding = AA(q+q^-1))
sage: norms = [[1,1/3*(-2*r9^2-r9+1),0],[1,-r9^2-r9,0],
               [1,-r9^2+1,0],[1,-r9^2,0],[1,r9^2-4,-r9^2+3]]
sage: H.<x,y,z> = HyperplaneArrangements(L)
sage: A = H()
sage: for v in norms:
....:      a,b,c = v
....:     A = A.add_hyperplane(a*x + b*y + c*z)
sage: R = A.regions(backend='normaliz')               # optional - pynormaliz
sage: R[0].backend()
'normaliz'
```



---

Comment by git created at 2020-04-14 12:14:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-04-14 12:16:54

This is just a first version to make it work with regions.

Probably, one should think about whether it is desirable to have an underlying backend when one deals with an hyperplane arrangement... Because it is annoying to add it as an option in each method...


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by tscrim created at 2020-04-14 23:16:10

Not everything you would do with a hyperplane arrangement requires the polyhedron code. So I am a little more inclined to keep it being an option to each method than something passed to the consturction. The other option I think could be good is implement a global option to hyperplane arrangements for a default polyhedron backend.


---

Comment by jipilab created at 2020-07-15 07:21:29

Replying to [comment:5 tscrim]:
> Not everything you would do with a hyperplane arrangement requires the polyhedron code. So I am a little more inclined to keep it being an option to each method than something passed to the consturction. 

I agree. One issue discussed with gh-kliem is the case that one has two methods that use stored polyhedra, but then the desired backend is not the one of the precomputed data. I don't want to start dealing with this inside of hyperplane arrangement, exactly for the reason you mentioned: this should be dealt with by polyhedra somehow...

> The other option I think could be good is implement a global option to hyperplane arrangements for a default polyhedron backend.

Yes, this sounds reasonable, simply have an option that specifies the wished backend to do the polyhedral computation. This makes sense to me. I'm starting to make these changes.


---

Comment by jipilab created at 2020-07-15 10:03:18

New commits:


---

Comment by git created at 2020-07-15 13:36:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-07-15 13:38:57

Changing status from new to needs_review.


---

Comment by jipilab created at 2020-07-15 13:38:57

Here's a second version. Let me know what you think.


---

Comment by tscrim created at 2020-07-19 23:06:38

Thank you. A few little things:

```diff
-            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \
-                           [1,-r9**2-r9,0], \
-                           [1,-r9**2+1,0], \
-                           [1,-r9**2,0], \
-                           [1,r9**2-4,-r9**2+3]]
+            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],
+            ....:          [1,-r9**2-r9,0],
+            ....:          [1,-r9**2+1,0],
+            ....:          [1,-r9**2,0],
+            ....:          [1,r9**2-4,-r9**2+3]]
```


```diff
         - ``backend`` -- string (optional; default: ``None``); the backend to
-          use for the related polyhedral objects.
+          use for the related polyhedral objects
```


```diff
         OUTPUT:
 
-        A string giving the backend or None (default)
+        A string giving the backend or ``None`` if none is specified.
```


Less important, but because I saw it when you changed the line: There is also a global instance of `Fields()` nailed in memory under the name `_Fields` (see `rings/ring.pyx`; although this seems to be done in multiple places...), so I would import that and do

```diff
-        if base_ring not in Fields:
+        if base_ring not in _Fields:
```

because it is a faster check.


---

Comment by git created at 2020-07-20 09:37:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-07-20 09:38:45

Replying to [comment:11 tscrim]:
> Thank you. A few little things:
> {{{#!diff
> -            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \
> -                           [1,-r9**2-r9,0], \
> -                           [1,-r9**2+1,0], \
> -                           [1,-r9**2,0], \
> -                           [1,r9**2-4,-r9**2+3]]
> +            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],
> +            ....:          [1,-r9**2-r9,0],
> +            ....:          [1,-r9**2+1,0],
> +            ....:          [1,-r9**2,0],
> +            ....:          [1,r9**2-4,-r9**2+3]]
> }}}

Removing the backslashes, I get a SyntaxError, EOF reached... I get get my head around it. I removed them, let's see if the bots react differently.

> {{{#!diff
>          - ``backend`` -- string (optional; default: ``None``); the backend to
> -          use for the related polyhedral objects.
> +          use for the related polyhedral objects
> }}}
> {{{#!diff
>          OUTPUT:
>  
> -        A string giving the backend or None (default)
> +        A string giving the backend or ``None`` if none is specified.
> }}}
> 
> Less important, but because I saw it when you changed the line: There is also a global instance of `Fields()` nailed in memory under the name `_Fields` (see `rings/ring.pyx`; although this seems to be done in multiple places...), so I would import that and do
> {{{#!diff
> -        if base_ring not in Fields:
> +        if base_ring not in _Fields:
> }}}
> because it is a faster check.

Done.


---

Comment by tscrim created at 2020-07-20 09:59:43

Replying to [comment:13 jipilab]:
> Replying to [comment:11 tscrim]:
> > Thank you. A few little things:
> > {{{#!diff
> > -            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \
> > -                           [1,-r9**2-r9,0], \
> > -                           [1,-r9**2+1,0], \
> > -                           [1,-r9**2,0], \
> > -                           [1,r9**2-4,-r9**2+3]]
> > +            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],
> > +            ....:          [1,-r9**2-r9,0],
> > +            ....:          [1,-r9**2+1,0],
> > +            ....:          [1,-r9**2,0],
> > +            ....:          [1,r9**2-4,-r9**2+3]]
> > }}}
> 
> Removing the backslashes, I get a SyntaxError, EOF reached... I get get my head around it. I removed them, let's see if the bots react differently.

Note the added `....:`.

BTW - How have you been doing?


---

Comment by git created at 2020-07-20 14:30:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jipilab created at 2020-07-20 14:32:30

Replying to [comment:15 tscrim]:
> Note the added `....:`.

(facepalm)!

> 
> BTW - How have you been doing?

I've been finishing up my Habilitation in the spring (finished a month ago!), then took some vacation. Now slowly back to business! Things are good! How are things for you?


---

Comment by tscrim created at 2020-07-21 01:00:01

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-07-21 01:00:01

Replying to [comment:17 jipilab]:
> Replying to [comment:15 tscrim]:
> > Note the added `....:`.
> 
> (facepalm)!

Thanks. LGTM.

> > 
> > BTW - How have you been doing?
> 
> I've been finishing up my Habilitation in the spring (finished a month ago!), then took some vacation. Now slowly back to business! Things are good! How are things for you?

Congratulations! Hopefully COVID didn't prohibit you from having a good vacation. I am doing well; still at UQ. I just finished teaching last Friday, and now to do a bit of a research and Sage push.


---

Comment by vbraun created at 2020-07-28 22:31:42

Resolution: fixed
