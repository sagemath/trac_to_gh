# Issue 29269: Backend for Hyperplane Arrangements

archive/issues_029269.json:
```json
{
    "body": "CC:  @thecaligarmo @kliem @laisrast @sophiasage nailuj @tscrim\n\nKeywords: backend, normaliz, hyperplane, regions\n\nCurrently, Hyperplane arrangements only use the default backends for related polyhedral objects.\n\nWe should make it possible to use backends. For example:\n\n\n```\nsage: K.<q> = CyclotomicField(9)\nsage: L.<r9> = NumberField((q+q^(-1)).minpoly(),embedding = AA(q+q^-1))\nsage: norms = [[1,1/3*(-2*r9^2-r9+1),0],[1,-r9^2-r9,0],\n               [1,-r9^2+1,0],[1,-r9^2,0],[1,r9^2-4,-r9^2+3]]\nsage: H.<x,y,z> = HyperplaneArrangements(L)\nsage: A = H()\nsage: for v in norms:\n....:      a,b,c = v\n....:     A = A.add_hyperplane(a*x + b*y + c*z)\nsage: R = A.regions(backend='normaliz')               # optional - pynormaliz\nsage: R[0].backend()\n'normaliz'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29506\n\n",
    "created_at": "2020-04-14T12:14:11Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Backend for Hyperplane Arrangements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29269",
    "user": "https://github.com/jplab"
}
```
CC:  @thecaligarmo @kliem @laisrast @sophiasage nailuj @tscrim

Keywords: backend, normaliz, hyperplane, regions

Currently, Hyperplane arrangements only use the default backends for related polyhedral objects.

We should make it possible to use backends. For example:


```
sage: K.<q> = CyclotomicField(9)
sage: L.<r9> = NumberField((q+q^(-1)).minpoly(),embedding = AA(q+q^-1))
sage: norms = [[1,1/3*(-2*r9^2-r9+1),0],[1,-r9^2-r9,0],
               [1,-r9^2+1,0],[1,-r9^2,0],[1,r9^2-4,-r9^2+3]]
sage: H.<x,y,z> = HyperplaneArrangements(L)
sage: A = H()
sage: for v in norms:
....:      a,b,c = v
....:     A = A.add_hyperplane(a*x + b*y + c*z)
sage: R = A.regions(backend='normaliz')               # optional - pynormaliz
sage: R[0].backend()
'normaliz'
```


Issue created by migration from https://trac.sagemath.org/ticket/29506





---

archive/issue_comments_414472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-14T12:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414473.json:
```json
{
    "body": "This is just a first version to make it work with regions.\n\nProbably, one should think about whether it is desirable to have an underlying backend when one deals with an hyperplane arrangement... Because it is annoying to add it as an option in each method...",
    "created_at": "2020-04-14T12:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414473",
    "user": "https://github.com/jplab"
}
```

This is just a first version to make it work with regions.

Probably, one should think about whether it is desirable to have an underlying backend when one deals with an hyperplane arrangement... Because it is annoying to add it as an option in each method...



---

archive/issue_comments_414474.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414474",
    "user": "https://github.com/mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_414475.json:
```json
{
    "body": "Not everything you would do with a hyperplane arrangement requires the polyhedron code. So I am a little more inclined to keep it being an option to each method than something passed to the consturction. The other option I think could be good is implement a global option to hyperplane arrangements for a default polyhedron backend.",
    "created_at": "2020-04-14T23:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414475",
    "user": "https://github.com/tscrim"
}
```

Not everything you would do with a hyperplane arrangement requires the polyhedron code. So I am a little more inclined to keep it being an option to each method than something passed to the consturction. The other option I think could be good is implement a global option to hyperplane arrangements for a default polyhedron backend.



---

archive/issue_comments_414476.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> Not everything you would do with a hyperplane arrangement requires the polyhedron code. So I am a little more inclined to keep it being an option to each method than something passed to the consturction. \n\nI agree. One issue discussed with gh-kliem is the case that one has two methods that use stored polyhedra, but then the desired backend is not the one of the precomputed data. I don't want to start dealing with this inside of hyperplane arrangement, exactly for the reason you mentioned: this should be dealt with by polyhedra somehow...\n\n> The other option I think could be good is implement a global option to hyperplane arrangements for a default polyhedron backend.\n\nYes, this sounds reasonable, simply have an option that specifies the wished backend to do the polyhedral computation. This makes sense to me. I'm starting to make these changes.",
    "created_at": "2020-07-15T07:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414476",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:5 tscrim]:
> Not everything you would do with a hyperplane arrangement requires the polyhedron code. So I am a little more inclined to keep it being an option to each method than something passed to the consturction. 

I agree. One issue discussed with gh-kliem is the case that one has two methods that use stored polyhedra, but then the desired backend is not the one of the precomputed data. I don't want to start dealing with this inside of hyperplane arrangement, exactly for the reason you mentioned: this should be dealt with by polyhedra somehow...

> The other option I think could be good is implement a global option to hyperplane arrangements for a default polyhedron backend.

Yes, this sounds reasonable, simply have an option that specifies the wished backend to do the polyhedral computation. This makes sense to me. I'm starting to make these changes.



---

archive/issue_comments_414477.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-07-15T10:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414477",
    "user": "https://github.com/jplab"
}
```

New commits:



---

archive/issue_comments_414478.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-15T13:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414478",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414479.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-15T13:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414479",
    "user": "https://github.com/jplab"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_414480.json:
```json
{
    "body": "Here's a second version. Let me know what you think.",
    "created_at": "2020-07-15T13:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414480",
    "user": "https://github.com/jplab"
}
```

Here's a second version. Let me know what you think.



---

archive/issue_comments_414481.json:
```json
{
    "body": "Thank you. A few little things:\n\n```diff\n-            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \\\n-                           [1,-r9**2-r9,0], \\\n-                           [1,-r9**2+1,0], \\\n-                           [1,-r9**2,0], \\\n-                           [1,r9**2-4,-r9**2+3]]\n+            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],\n+            ....:          [1,-r9**2-r9,0],\n+            ....:          [1,-r9**2+1,0],\n+            ....:          [1,-r9**2,0],\n+            ....:          [1,r9**2-4,-r9**2+3]]\n```\n\n\n```diff\n         - ``backend`` -- string (optional; default: ``None``); the backend to\n-          use for the related polyhedral objects.\n+          use for the related polyhedral objects\n```\n\n\n```diff\n         OUTPUT:\n \n-        A string giving the backend or None (default)\n+        A string giving the backend or ``None`` if none is specified.\n```\n\n\nLess important, but because I saw it when you changed the line: There is also a global instance of `Fields()` nailed in memory under the name `_Fields` (see `rings/ring.pyx`; although this seems to be done in multiple places...), so I would import that and do\n\n```diff\n-        if base_ring not in Fields:\n+        if base_ring not in _Fields:\n```\n\nbecause it is a faster check.",
    "created_at": "2020-07-19T23:06:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414481",
    "user": "https://github.com/tscrim"
}
```

Thank you. A few little things:

```diff
-            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \
-                           [1,-r9**2-r9,0], \
-                           [1,-r9**2+1,0], \
-                           [1,-r9**2,0], \
-                           [1,r9**2-4,-r9**2+3]]
+            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],
+            ....:          [1,-r9**2-r9,0],
+            ....:          [1,-r9**2+1,0],
+            ....:          [1,-r9**2,0],
+            ....:          [1,r9**2-4,-r9**2+3]]
```


```diff
         - ``backend`` -- string (optional; default: ``None``); the backend to
-          use for the related polyhedral objects.
+          use for the related polyhedral objects
```


```diff
         OUTPUT:
 
-        A string giving the backend or None (default)
+        A string giving the backend or ``None`` if none is specified.
```


Less important, but because I saw it when you changed the line: There is also a global instance of `Fields()` nailed in memory under the name `_Fields` (see `rings/ring.pyx`; although this seems to be done in multiple places...), so I would import that and do

```diff
-        if base_ring not in Fields:
+        if base_ring not in _Fields:
```

because it is a faster check.



---

archive/issue_comments_414482.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-20T09:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414482",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414483.json:
```json
{
    "body": "Replying to [comment:11 tscrim]:\n> Thank you. A few little things:\n> {{{#!diff\n> -            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \\\n> -                           [1,-r9**2-r9,0], \\\n> -                           [1,-r9**2+1,0], \\\n> -                           [1,-r9**2,0], \\\n> -                           [1,r9**2-4,-r9**2+3]]\n> +            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],\n> +            ....:          [1,-r9**2-r9,0],\n> +            ....:          [1,-r9**2+1,0],\n> +            ....:          [1,-r9**2,0],\n> +            ....:          [1,r9**2-4,-r9**2+3]]\n> }}}\n\nRemoving the backslashes, I get a SyntaxError, EOF reached... I get get my head around it. I removed them, let's see if the bots react differently.\n\n> {{{#!diff\n>          - ``backend`` -- string (optional; default: ``None``); the backend to\n> -          use for the related polyhedral objects.\n> +          use for the related polyhedral objects\n> }}}\n> {{{#!diff\n>          OUTPUT:\n>  \n> -        A string giving the backend or None (default)\n> +        A string giving the backend or ``None`` if none is specified.\n> }}}\n> \n> Less important, but because I saw it when you changed the line: There is also a global instance of `Fields()` nailed in memory under the name `_Fields` (see `rings/ring.pyx`; although this seems to be done in multiple places...), so I would import that and do\n> {{{#!diff\n> -        if base_ring not in Fields:\n> +        if base_ring not in _Fields:\n> }}}\n> because it is a faster check.\n\nDone.",
    "created_at": "2020-07-20T09:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414483",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:11 tscrim]:
> Thank you. A few little things:
> {{{#!diff
> -            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \
> -                           [1,-r9**2-r9,0], \
> -                           [1,-r9**2+1,0], \
> -                           [1,-r9**2,0], \
> -                           [1,r9**2-4,-r9**2+3]]
> +            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],
> +            ....:          [1,-r9**2-r9,0],
> +            ....:          [1,-r9**2+1,0],
> +            ....:          [1,-r9**2,0],
> +            ....:          [1,r9**2-4,-r9**2+3]]
> }}}

Removing the backslashes, I get a SyntaxError, EOF reached... I get get my head around it. I removed them, let's see if the bots react differently.

> {{{#!diff
>          - ``backend`` -- string (optional; default: ``None``); the backend to
> -          use for the related polyhedral objects.
> +          use for the related polyhedral objects
> }}}
> {{{#!diff
>          OUTPUT:
>  
> -        A string giving the backend or None (default)
> +        A string giving the backend or ``None`` if none is specified.
> }}}
> 
> Less important, but because I saw it when you changed the line: There is also a global instance of `Fields()` nailed in memory under the name `_Fields` (see `rings/ring.pyx`; although this seems to be done in multiple places...), so I would import that and do
> {{{#!diff
> -        if base_ring not in Fields:
> +        if base_ring not in _Fields:
> }}}
> because it is a faster check.

Done.



---

archive/issue_comments_414484.json:
```json
{
    "body": "Replying to [comment:13 jipilab]:\n> Replying to [comment:11 tscrim]:\n> > Thank you. A few little things:\n> > {{{#!diff\n> > -            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \\\n> > -                           [1,-r9**2-r9,0], \\\n> > -                           [1,-r9**2+1,0], \\\n> > -                           [1,-r9**2,0], \\\n> > -                           [1,r9**2-4,-r9**2+3]]\n> > +            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],\n> > +            ....:          [1,-r9**2-r9,0],\n> > +            ....:          [1,-r9**2+1,0],\n> > +            ....:          [1,-r9**2,0],\n> > +            ....:          [1,r9**2-4,-r9**2+3]]\n> > }}}\n> \n> Removing the backslashes, I get a SyntaxError, EOF reached... I get get my head around it. I removed them, let's see if the bots react differently.\n\nNote the added `....:`.\n\nBTW - How have you been doing?",
    "created_at": "2020-07-20T09:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414484",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:13 jipilab]:
> Replying to [comment:11 tscrim]:
> > Thank you. A few little things:
> > {{{#!diff
> > -            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0], \
> > -                           [1,-r9**2-r9,0], \
> > -                           [1,-r9**2+1,0], \
> > -                           [1,-r9**2,0], \
> > -                           [1,r9**2-4,-r9**2+3]]
> > +            sage: norms = [[1,1/3*(-2*r9**2-r9+1),0],
> > +            ....:          [1,-r9**2-r9,0],
> > +            ....:          [1,-r9**2+1,0],
> > +            ....:          [1,-r9**2,0],
> > +            ....:          [1,r9**2-4,-r9**2+3]]
> > }}}
> 
> Removing the backslashes, I get a SyntaxError, EOF reached... I get get my head around it. I removed them, let's see if the bots react differently.

Note the added `....:`.

BTW - How have you been doing?



---

archive/issue_comments_414485.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-20T14:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414485",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414486.json:
```json
{
    "body": "Replying to [comment:15 tscrim]:\n> Note the added `....:`.\n\n(facepalm)!\n\n> \n> BTW - How have you been doing?\n\nI've been finishing up my Habilitation in the spring (finished a month ago!), then took some vacation. Now slowly back to business! Things are good! How are things for you?",
    "created_at": "2020-07-20T14:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414486",
    "user": "https://github.com/jplab"
}
```

Replying to [comment:15 tscrim]:
> Note the added `....:`.

(facepalm)!

> 
> BTW - How have you been doing?

I've been finishing up my Habilitation in the spring (finished a month ago!), then took some vacation. Now slowly back to business! Things are good! How are things for you?



---

archive/issue_comments_414487.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-21T01:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414487",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414488.json:
```json
{
    "body": "Replying to [comment:17 jipilab]:\n> Replying to [comment:15 tscrim]:\n> > Note the added `....:`.\n> \n> (facepalm)!\n\nThanks. LGTM.\n\n> > \n> > BTW - How have you been doing?\n> \n> I've been finishing up my Habilitation in the spring (finished a month ago!), then took some vacation. Now slowly back to business! Things are good! How are things for you?\n\nCongratulations! Hopefully COVID didn't prohibit you from having a good vacation. I am doing well; still at UQ. I just finished teaching last Friday, and now to do a bit of a research and Sage push.",
    "created_at": "2020-07-21T01:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414488",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:17 jipilab]:
> Replying to [comment:15 tscrim]:
> > Note the added `....:`.
> 
> (facepalm)!

Thanks. LGTM.

> > 
> > BTW - How have you been doing?
> 
> I've been finishing up my Habilitation in the spring (finished a month ago!), then took some vacation. Now slowly back to business! Things are good! How are things for you?

Congratulations! Hopefully COVID didn't prohibit you from having a good vacation. I am doing well; still at UQ. I just finished teaching last Friday, and now to do a bit of a research and Sage push.



---

archive/issue_comments_414489.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-28T22:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29269#issuecomment-414489",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_027045.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2020-07-28T22:31:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29269",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29269#event-27045"
}
```
