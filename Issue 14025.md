# Issue 14025: Remove vacuous solutions from solve

archive/issues_014025.json:
```json
{
    "body": "Assignee: @burcin\n\nCC:  @kcrisman @jondo\n\nSometimes solve and its variants tend to report vacuous solutions. A recent one from [ask.sagemath](http://ask.sagemath.org/question/2324/how-to-print-out-maxima-commands-being-used-by) is the following:\n\n```\nsage: x,y = var('x,y')\nsage: solve([x^2*y^2 <= x^2*y, x^2*y^2 > x^2*y],[x,y])\n[[x == 0, 1 < y, 0 != 0], [x == 0, y < 0, 0 != 0]]\n```\n\n\nShouldn't we remove these meaningless solutions?\n\nIssue created by migration from https://trac.sagemath.org/ticket/14229\n\n",
    "created_at": "2013-03-05T13:09:20Z",
    "labels": [
        "symbolics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Remove vacuous solutions from solve",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14025",
    "user": "@ppurka"
}
```
Assignee: @burcin

CC:  @kcrisman @jondo

Sometimes solve and its variants tend to report vacuous solutions. A recent one from [ask.sagemath](http://ask.sagemath.org/question/2324/how-to-print-out-maxima-commands-being-used-by) is the following:

```
sage: x,y = var('x,y')
sage: solve([x^2*y^2 <= x^2*y, x^2*y^2 > x^2*y],[x,y])
[[x == 0, 1 < y, 0 != 0], [x == 0, y < 0, 0 != 0]]
```


Shouldn't we remove these meaningless solutions?

Issue created by migration from https://trac.sagemath.org/ticket/14229





---

archive/issue_comments_175256.json:
```json
{
    "body": "Apply to devel/sage",
    "created_at": "2013-03-05T13:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175256",
    "user": "@ppurka"
}
```

Apply to devel/sage



---

archive/issue_comments_175257.json:
```json
{
    "body": "Attachment [trac_14229-remove_vacuous_solutions.patch](tarball://root/attachments/some-uuid/ticket14229/trac_14229-remove_vacuous_solutions.patch) by @ppurka created at 2013-03-05 13:11:55",
    "created_at": "2013-03-05T13:11:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175257",
    "user": "@ppurka"
}
```

Attachment [trac_14229-remove_vacuous_solutions.patch](tarball://root/attachments/some-uuid/ticket14229/trac_14229-remove_vacuous_solutions.patch) by @ppurka created at 2013-03-05 13:11:55



---

archive/issue_comments_175258.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-05-26T12:20:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175258",
    "user": "@ppurka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_175259.json:
```json
{
    "body": "This kind of change should really be made to maxima, not to sage's postprocessing of what maxima returns.",
    "created_at": "2013-05-26T13:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175259",
    "user": "@nbruin"
}
```

This kind of change should really be made to maxima, not to sage's postprocessing of what maxima returns.



---

archive/issue_comments_175260.json:
```json
{
    "body": "If someone knows how to translate this to maxima, please feel free to put this upstream. Thanks! [ I can not spend time in learning maxima right now. :( ]",
    "created_at": "2013-05-26T15:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175260",
    "user": "@ppurka"
}
```

If someone knows how to translate this to maxima, please feel free to put this upstream. Thanks! [ I can not spend time in learning maxima right now. :( ]



---

archive/issue_comments_175261.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-05-26T15:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175261",
    "user": "@ppurka"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_175262.json:
```json
{
    "body": "Helloooooooo !!\n\nYou remove equations that do not contain a variable, but couldn't `0=0` appear from time to time ? Secondly, can't the expression \"bool(solution_list)\" be costly from time to time ?\n\nYou could also write, later in the patch\n\n```\nsol_list = filter(_test_solution, string_to_list_of_solutions(repr(s)))\n```\n\n\nNathann",
    "created_at": "2013-05-27T13:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175262",
    "user": "@nathanncohen"
}
```

Helloooooooo !!

You remove equations that do not contain a variable, but couldn't `0=0` appear from time to time ? Secondly, can't the expression "bool(solution_list)" be costly from time to time ?

You could also write, later in the patch

```
sol_list = filter(_test_solution, string_to_list_of_solutions(repr(s)))
```


Nathann



---

archive/issue_comments_175263.json:
```json
{
    "body": "`0==0` can appear, but `bool(0==0)` should evaluate to True. Which is fine by me. The point is to remove solutions which are clearly false. Anyway, this patch is going nowhere since nbruin suggests putting this upstream (I can not do that now).\n\n*EDIT*: `bool(solution_list)` is done only when a symbolic expression (i.e., not a list of symbolic expressions) is input and there are no variables in the symbolic expression. This shouldn't introduce a significant slowdown. The solve function itself will probably take way more time than what these boolean checks will take.",
    "created_at": "2013-05-27T13:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175263",
    "user": "@ppurka"
}
```

`0==0` can appear, but `bool(0==0)` should evaluate to True. Which is fine by me. The point is to remove solutions which are clearly false. Anyway, this patch is going nowhere since nbruin suggests putting this upstream (I can not do that now).

*EDIT*: `bool(solution_list)` is done only when a symbolic expression (i.e., not a list of symbolic expressions) is input and there are no variables in the symbolic expression. This shouldn't introduce a significant slowdown. The solve function itself will probably take way more time than what these boolean checks will take.



---

archive/issue_comments_175264.json:
```json
{
    "body": "These vacuous solutions seem to arise from the fact that solving inequalities with `domain: complex` gives some problems, which is to be expected. So rather than trying to clean up the mess afterwards, we should find a way of setting `domain: real` in maxima before solving inequalities:\n\n```\nsage: sage: x,y = var('x,y')\nsage: maxima_calculus(\"domain: real\")\nreal\nsage: sage: solve([x^2*y^2 <= x^2*y, x^2*y^2 > x^2*y],[x,y])\n[]\n```\n\nSee [sage-devel](https://groups.google.com/d/msg/sage-devel/QLEFLgkuXRg/MzEqI2na8xwJ) too.",
    "created_at": "2014-07-18T01:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175264",
    "user": "@nbruin"
}
```

These vacuous solutions seem to arise from the fact that solving inequalities with `domain: complex` gives some problems, which is to be expected. So rather than trying to clean up the mess afterwards, we should find a way of setting `domain: real` in maxima before solving inequalities:

```
sage: sage: x,y = var('x,y')
sage: maxima_calculus("domain: real")
real
sage: sage: solve([x^2*y^2 <= x^2*y, x^2*y^2 > x^2*y],[x,y])
[]
```

See [sage-devel](https://groups.google.com/d/msg/sage-devel/QLEFLgkuXRg/MzEqI2na8xwJ) too.



---

archive/issue_comments_175265.json:
```json
{
    "body": "One may be concerned with performance when we have to set these flags all the time. On the expect interface that's probably silly anyway, and on the library interface we can reach a little deeper and save some time:\n\n```\nsage: maxima_calculus(1) # make sure maxima_lib is initialized\nsage: from sage.libs.ecl import EclObject,ecl_eval\nsage: set_complex=ecl_eval(\"(defun sc () (setf $DOMAIN '$COMPLEX))\")\nsage: set_real=ecl_eval(\"(defun sc () (setf $DOMAIN '$REAL))\")\nsage: %timeit set_complex()\n100000 loops, best of 3: 2.14 \u00b5s per loop\nsage: %timeit maxima_calculus(\"domain: complex\")\n10000 loops, best of 3: 146 \u00b5s per loop\n```\n\nFor comparison:\n\n```\nsage: %timeit solve([x<y],[x,y])\n100 loops, best of 3: 4.6 ms per loop\n```\n\nso I think we can afford a little `set_real.eval(); ...solve iquality; set_complex.eval();`. We could keep a flag on what we set last and be lazy with flipping, but I expect that solving inequalities is relatively rare, and always slow, so we shouldn't slow down other operations with testing for a flag. To give you an idea, the following does call into maxima:\n\n```\nsage: %timeit integrate(x,x)\n1000 loops, best of 3: 693 us per loop\n```\n",
    "created_at": "2014-07-18T16:55:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175265",
    "user": "@nbruin"
}
```

One may be concerned with performance when we have to set these flags all the time. On the expect interface that's probably silly anyway, and on the library interface we can reach a little deeper and save some time:

```
sage: maxima_calculus(1) # make sure maxima_lib is initialized
sage: from sage.libs.ecl import EclObject,ecl_eval
sage: set_complex=ecl_eval("(defun sc () (setf $DOMAIN '$COMPLEX))")
sage: set_real=ecl_eval("(defun sc () (setf $DOMAIN '$REAL))")
sage: %timeit set_complex()
100000 loops, best of 3: 2.14 µs per loop
sage: %timeit maxima_calculus("domain: complex")
10000 loops, best of 3: 146 µs per loop
```

For comparison:

```
sage: %timeit solve([x<y],[x,y])
100 loops, best of 3: 4.6 ms per loop
```

so I think we can afford a little `set_real.eval(); ...solve iquality; set_complex.eval();`. We could keep a flag on what we set last and be lazy with flipping, but I expect that solving inequalities is relatively rare, and always slow, so we shouldn't slow down other operations with testing for a flag. To give you an idea, the following does call into maxima:

```
sage: %timeit integrate(x,x)
1000 loops, best of 3: 693 us per loop
```




---

archive/issue_comments_175266.json:
```json
{
    "body": "Replying to [comment:14 nbruin]:\n> so I think we can afford a little `set_real.eval(); ...solve iquality; set_complex.eval();`.\n\nSo do you think this should be done in the Sage `solve` function when it detects inequalities?",
    "created_at": "2015-02-12T11:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14025",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14025#issuecomment-175266",
    "user": "@jondo"
}
```

Replying to [comment:14 nbruin]:
> so I think we can afford a little `set_real.eval(); ...solve iquality; set_complex.eval();`.

So do you think this should be done in the Sage `solve` function when it detects inequalities?
