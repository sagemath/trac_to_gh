# Issue 14025: Remove vacuous solutions from solve

Issue created by migration from Trac.

Original creator: ppurka

Original creation time: 2013-03-05 13:09:20

Assignee: burcin

CC:  kcrisman jondo

Sometimes solve and its variants tend to report vacuous solutions. A recent one from [ask.sagemath](http://ask.sagemath.org/question/2324/how-to-print-out-maxima-commands-being-used-by) is the following:

```
sage: x,y = var('x,y')
sage: solve([x^2*y^2 <= x^2*y, x^2*y^2 > x^2*y],[x,y])
[[x == 0, 1 < y, 0 != 0], [x == 0, y < 0, 0 != 0]]
```


Shouldn't we remove these meaningless solutions?


---

Comment by ppurka created at 2013-03-05 13:11:01

Apply to devel/sage


---

Attachment


---

Comment by ppurka created at 2013-05-26 12:20:52

Changing status from new to needs_review.


---

Comment by nbruin created at 2013-05-26 13:01:02

This kind of change should really be made to maxima, not to sage's postprocessing of what maxima returns.


---

Comment by ppurka created at 2013-05-26 15:14:01

If someone knows how to translate this to maxima, please feel free to put this upstream. Thanks! [ I can not spend time in learning maxima right now. :( ]


---

Comment by ppurka created at 2013-05-26 15:14:01

Changing status from needs_review to needs_work.


---

Comment by ncohen created at 2013-05-27 13:42:37

Helloooooooo !!

You remove equations that do not contain a variable, but couldn't `0=0` appear from time to time ? Secondly, can't the expression "bool(solution_list)" be costly from time to time ?

You could also write, later in the patch

```
sol_list = filter(_test_solution, string_to_list_of_solutions(repr(s)))
```


Nathann


---

Comment by ppurka created at 2013-05-27 13:47:35

`0==0` can appear, but `bool(0==0)` should evaluate to True. Which is fine by me. The point is to remove solutions which are clearly false. Anyway, this patch is going nowhere since nbruin suggests putting this upstream (I can not do that now).

_EDIT_: `bool(solution_list)` is done only when a symbolic expression (i.e., not a list of symbolic expressions) is input and there are no variables in the symbolic expression. This shouldn't introduce a significant slowdown. The solve function itself will probably take way more time than what these boolean checks will take.


---

Comment by nbruin created at 2014-07-18 01:29:46

These vacuous solutions seem to arise from the fact that solving inequalities with `domain: complex` gives some problems, which is to be expected. So rather than trying to clean up the mess afterwards, we should find a way of setting `domain: real` in maxima before solving inequalities:

```
sage: sage: x,y = var('x,y')
sage: maxima_calculus("domain: real")
real
sage: sage: solve([x^2*y^2 <= x^2*y, x^2*y^2 > x^2*y],[x,y])
[]
```

See [sage-devel](https://groups.google.com/d/msg/sage-devel/QLEFLgkuXRg/MzEqI2na8xwJ) too.


---

Comment by nbruin created at 2014-07-18 16:55:08

One may be concerned with performance when we have to set these flags all the time. On the expect interface that's probably silly anyway, and on the library interface we can reach a little deeper and save some time:

```
sage: maxima_calculus(1) # make sure maxima_lib is initialized
sage: from sage.libs.ecl import EclObject,ecl_eval
sage: set_complex=ecl_eval("(defun sc () (setf $DOMAIN '$COMPLEX))")
sage: set_real=ecl_eval("(defun sc () (setf $DOMAIN '$REAL))")
sage: %timeit set_complex()
100000 loops, best of 3: 2.14 µs per loop
sage: %timeit maxima_calculus("domain: complex")
10000 loops, best of 3: 146 µs per loop
```

For comparison:

```
sage: %timeit solve([x<y],[x,y])
100 loops, best of 3: 4.6 ms per loop
```

so I think we can afford a little `set_real.eval(); ...solve iquality; set_complex.eval();`. We could keep a flag on what we set last and be lazy with flipping, but I expect that solving inequalities is relatively rare, and always slow, so we shouldn't slow down other operations with testing for a flag. To give you an idea, the following does call into maxima:

```
sage: %timeit integrate(x,x)
1000 loops, best of 3: 693 us per loop
```



---

Comment by jondo created at 2015-02-12 11:33:40

Replying to [comment:14 nbruin]:
> so I think we can afford a little `set_real.eval(); ...solve iquality; set_complex.eval();`.

So do you think this should be done in the Sage `solve` function when it detects inequalities?
