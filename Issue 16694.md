# Issue 16694: Elliptic curve point counting over F_q using new PARI

archive/issues_016694.json:
```json
{
    "body": "CC:  @pjbruin @JohnCremona @kedlaya jpflori @defeo\n\nThe new version of PARI (#15767) supports point counting over `F_q` instead of `F_p`. We should use this new functionality in Sage!\n\nIssue created by migration from https://trac.sagemath.org/ticket/16931\n\n",
    "created_at": "2014-09-04T12:54:32Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Elliptic curve point counting over F_q using new PARI",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16694",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @pjbruin @JohnCremona @kedlaya jpflori @defeo

The new version of PARI (#15767) supports point counting over `F_q` instead of `F_p`. We should use this new functionality in Sage!

Issue created by migration from https://trac.sagemath.org/ticket/16931





---

archive/issue_comments_220236.json:
```json
{
    "body": "Never mind the timings, PARI does its own caching now...",
    "created_at": "2014-09-04T14:05:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220236",
    "user": "https://github.com/jdemeyer"
}
```

Never mind the timings, PARI does its own caching now...



---

archive/issue_comments_220237.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-08T14:18:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220237",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_220238.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-08T21:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220239.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-08T22:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220239",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220240.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-09T12:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220240",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220241.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-09T13:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-11T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220243.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-12-11T15:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220243",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220244.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-12-11T15:33:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220244",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_220245.json:
```json
{
    "body": "Thanks for your work on this.  First two few small points:\n\n1. In the documentation for ellcard(), we need to say that when self is defined over Q and p is a prime of bad reduction then the number returned is the size of the group of nonsingular points on the reduction (i.e. p-1, p+1 or p depending).  I wondered about this, did some experiments, and then verified with the pari documentation.\n\n2. Why is ellorder() removed?\n\nI think someone other than me should review this.  There is a vast amount of code written by me being removed here, which is hard.  Without going into the details of the pari implementation I would not want to agree to removing the special code for j=0 and j=1728 in characteristics 2 and 3.  We had to do quite a lot of mathematics to get this right, which was not in the literature, and even the examples here are quite instructive.\n\nSecondly, the old code was careful to only ever do counting over the field generated over the prime field by the j-invariant.  From there is is quite easy to get the cardinality of any twist over any extension.  Do you know that pari does that too?  Try taking a curve over a small field, base-changing to an extension, applying  a random twist, and then asking for the cardinality.  With my code it swould take no longer than on the original.  Is that still true?\n\nI thought we had a convention for situations like this, that a Sage-only implementation could be kept and used if some parameter 'algorithm' was set?  The parameter could be 'pari' by default.",
    "created_at": "2015-12-11T15:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220245",
    "user": "https://github.com/JohnCremona"
}
```

Thanks for your work on this.  First two few small points:

1. In the documentation for ellcard(), we need to say that when self is defined over Q and p is a prime of bad reduction then the number returned is the size of the group of nonsingular points on the reduction (i.e. p-1, p+1 or p depending).  I wondered about this, did some experiments, and then verified with the pari documentation.

2. Why is ellorder() removed?

I think someone other than me should review this.  There is a vast amount of code written by me being removed here, which is hard.  Without going into the details of the pari implementation I would not want to agree to removing the special code for j=0 and j=1728 in characteristics 2 and 3.  We had to do quite a lot of mathematics to get this right, which was not in the literature, and even the examples here are quite instructive.

Secondly, the old code was careful to only ever do counting over the field generated over the prime field by the j-invariant.  From there is is quite easy to get the cardinality of any twist over any extension.  Do you know that pari does that too?  Try taking a curve over a small field, base-changing to an extension, applying  a random twist, and then asking for the cardinality.  With my code it swould take no longer than on the original.  Is that still true?

I thought we had a convention for situations like this, that a Sage-only implementation could be kept and used if some parameter 'algorithm' was set?  The parameter could be 'pari' by default.



---

archive/issue_comments_220246.json:
```json
{
    "body": "> There is a vast amount of code written by me being removed here, which is hard.\n\nFor the record, I totally understand that. I had the same feeling when the PARI people implemented splitting field for polynomials over QQ which completely outperformed my implementation.\n\nHowever, I consider it a \"fact of life\" that old code has to make place for new and better code.\n\n> I thought we had a convention for situations like this, that a Sage-only implementation could be kept and used if some parameter 'algorithm' was set? The parameter could be 'pari' by default.\n\nI'm not really sure if that's a convention. Honestly, I don't really see the point of keeping the old code. I did keep all old doctests, which I think is important.",
    "created_at": "2015-12-11T16:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220246",
    "user": "https://github.com/jdemeyer"
}
```

> There is a vast amount of code written by me being removed here, which is hard.

For the record, I totally understand that. I had the same feeling when the PARI people implemented splitting field for polynomials over QQ which completely outperformed my implementation.

However, I consider it a "fact of life" that old code has to make place for new and better code.

> I thought we had a convention for situations like this, that a Sage-only implementation could be kept and used if some parameter 'algorithm' was set? The parameter could be 'pari' by default.

I'm not really sure if that's a convention. Honestly, I don't really see the point of keeping the old code. I did keep all old doctests, which I think is important.



---

archive/issue_comments_220247.json:
```json
{
    "body": "Replying to [comment:24 jdemeyer]:\n> > There is a vast amount of code written by me being removed here, which is hard.\n> \n> For the record, I totally understand that. I had the same feeling when the PARI people implemented splitting field for polynomials over QQ which completely outperformed my implementation.\n\nI'm glad you know how this feels.  Does Sage use the pari splitting field implementation now?\n\n> \n> However, I consider it a \"fact of life\" that old code has to make place for new and better code.\n\nOf course!   There may be some benefit in keeping an independent implementation though, in case of bugs being found later.\n\n> \n> > I thought we had a convention for situations like this, that a Sage-only implementation could be kept and used if some parameter 'algorithm' was set? The parameter could be 'pari' by default.\n> \n> I'm not really sure if that's a convention. Honestly, I don't really see the point of keeping the old code. I did keep all old doctests, which I think is important.\n\nAgreed -- and looking more closely I see that you did move the tests for the special cases j=0, 1728 and not *re*move them.  Thanks.\n\nI will ask the pari-devs about the other points.",
    "created_at": "2015-12-11T16:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220247",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:24 jdemeyer]:
> > There is a vast amount of code written by me being removed here, which is hard.
> 
> For the record, I totally understand that. I had the same feeling when the PARI people implemented splitting field for polynomials over QQ which completely outperformed my implementation.

I'm glad you know how this feels.  Does Sage use the pari splitting field implementation now?

> 
> However, I consider it a "fact of life" that old code has to make place for new and better code.

Of course!   There may be some benefit in keeping an independent implementation though, in case of bugs being found later.

> 
> > I thought we had a convention for situations like this, that a Sage-only implementation could be kept and used if some parameter 'algorithm' was set? The parameter could be 'pari' by default.
> 
> I'm not really sure if that's a convention. Honestly, I don't really see the point of keeping the old code. I did keep all old doctests, which I think is important.

Agreed -- and looking more closely I see that you did move the tests for the special cases j=0, 1728 and not *re*move them.  Thanks.

I will ask the pari-devs about the other points.



---

archive/issue_comments_220248.json:
```json
{
    "body": "Replying to [comment:25 cremona]:\n> I'm glad you know how this feels.  Does Sage use the pari splitting field implementation now?\nNo, it doesn't. PARI only works with irreducible polynomials and I'm not sure if PARI works in the relative case (where the base field is a number field). My implementation is more general.",
    "created_at": "2015-12-11T19:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220248",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 cremona]:
> I'm glad you know how this feels.  Does Sage use the pari splitting field implementation now?
No, it doesn't. PARI only works with irreducible polynomials and I'm not sure if PARI works in the relative case (where the base field is a number field). My implementation is more general.



---

archive/issue_comments_220249.json:
```json
{
    "body": "Replying to [comment:25 cremona]:\n> looking more closely\n\n`git` tip: do you know about the `--patience` option?\n\nThe default diff algorithm in `git` tries to minimize the number of changes. But this isn't really what you want, since it might match a random empty line from the old code with an unrelated empty line from the new code. With the `--patience` option, `git` uses a different algorithm which doesn't suffer from this: even though the `diff` will be larger, logical blocks will be kept together.",
    "created_at": "2015-12-11T19:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220249",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 cremona]:
> looking more closely

`git` tip: do you know about the `--patience` option?

The default diff algorithm in `git` tries to minimize the number of changes. But this isn't really what you want, since it might match a random empty line from the old code with an unrelated empty line from the new code. With the `--patience` option, `git` uses a different algorithm which doesn't suffer from this: even though the `diff` will be larger, logical blocks will be kept together.



---

archive/issue_comments_220250.json:
```json
{
    "body": "Merged with current develop branch (7.4beta0). \n----\nNew commits:",
    "created_at": "2016-08-18T01:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220250",
    "user": "https://github.com/kedlaya"
}
```

Merged with current develop branch (7.4beta0). 
----
New commits:



---

archive/issue_comments_220251.json:
```json
{
    "body": "I'm not sure I did this merge correctly. If not, we can switch back to jdemeyer's branch.",
    "created_at": "2016-08-18T03:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220251",
    "user": "https://github.com/kedlaya"
}
```

I'm not sure I did this merge correctly. If not, we can switch back to jdemeyer's branch.



---

archive/issue_comments_220252.json:
```json
{
    "body": "I think it's better to look at #16949 first anyway.",
    "created_at": "2016-08-18T08:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220252",
    "user": "https://github.com/jdemeyer"
}
```

I think it's better to look at #16949 first anyway.



---

archive/issue_comments_220253.json:
```json
{
    "body": "And in any case, adding 4499 lines to `src/sage/libs/pari/gen.pyx` cannot be right...",
    "created_at": "2016-08-18T09:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220253",
    "user": "https://github.com/jdemeyer"
}
```

And in any case, adding 4499 lines to `src/sage/libs/pari/gen.pyx` cannot be right...



---

archive/issue_comments_220254.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-18T09:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220254",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_220255.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-18T14:28:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220256.json:
```json
{
    "body": "Replying to [comment:23 cremona]:\n> Secondly, the old code was careful to only ever do counting over the field generated over the prime field by the j-invariant.  From there is is quite easy to get the cardinality of any twist over any extension.  Do you know that pari does that too?  Try taking a curve over a small field, base-changing to an extension, applying  a random twist, and then asking for the cardinality.  With my code it swould take no longer than on the original.  Is that still true?\n\nThis still has to be checked.",
    "created_at": "2016-08-18T14:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220256",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:23 cremona]:
> Secondly, the old code was careful to only ever do counting over the field generated over the prime field by the j-invariant.  From there is is quite easy to get the cardinality of any twist over any extension.  Do you know that pari does that too?  Try taking a curve over a small field, base-changing to an extension, applying  a random twist, and then asking for the cardinality.  With my code it swould take no longer than on the original.  Is that still true?

This still has to be checked.



---

archive/issue_comments_220257.json:
```json
{
    "body": "Replying to [comment:25 cremona]:\n> I will ask the pari-devs about the other points.\n\nJohn, did you do this? I don't find anything on the PARI mailing lists.",
    "created_at": "2016-08-18T14:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220257",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:25 cremona]:
> I will ask the pari-devs about the other points.

John, did you do this? I don't find anything on the PARI mailing lists.



---

archive/issue_comments_220258.json:
```json
{
    "body": "Replying to [comment:37 jdemeyer]:\n> Replying to [comment:25 cremona]:\n> > I will ask the pari-devs about the other points.\n> \n> John, did you do this? I don't find anything on the PARI mailing lists.\n\nI emailed Bill and Karim, CC-ing you, and this was their reply (last December):\n\nOn Fri, Dec 11, 2015 at 04:58:38PM +0000, John Cremona wrote:\n> Dear Karim and Bill,\n>\n> 1.  I put a lot of effort into the cases j=0 and j=1728, which in\n> characteristics 2 and 3 (when they are the same case!) required\n> considerable care.  For example, for p=2 the number of isomorphism\n> classes is either 3 or 7 depending on the parity of the degree over\n> F_2, i.e. that is the number of twists, so the idea is to determine\n> which of the 3 or 7 cases you are in and apply the appropriate\n> formula.  What does pari do in these cases?\n\nFor p=3, this is the function F3xq_ellcardj().\nThe curve and its twists become identical in some degree-6 extension\nof the base field so we can identify the twist by using Kummer theory.\nThe formula is not straightforward, but optimal for efficiency.\n\nFor p=2, I never finished to compute the equivalent formula\n(I think one need a degree 24 extension).\nSo instead we use random points to discriminate between the possible\ncandidates given by Deuring. This is done in F2xq_ellcard().\n\nI wrote about one-sixth of the formula. If you know about the complete\nformula in this case, please tell me!\n\n> 2. If the j-invariant is defined over a much smaller field than the\n> field of definition of the curve, then what I do (or Sage does) is to\n> point-count on some curve with that j, over the field generated over\n> the prime field by j;  use the standard formula to get the point-count\n> of that curve over the original field of definition; and then decide\n> on whether a final quadratic twist is needed.  Does your code do that?\n\nWe do not always do it, because computing minimal polynomial was\nquite slow. Quite recently we have added faster methods to compute the\nminimal polynomial so we can revisit this point.\n\nPractical example with this would be welcome.\n\nCheers,\nBill.",
    "created_at": "2016-08-18T19:34:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220258",
    "user": "https://github.com/JohnCremona"
}
```

Replying to [comment:37 jdemeyer]:
> Replying to [comment:25 cremona]:
> > I will ask the pari-devs about the other points.
> 
> John, did you do this? I don't find anything on the PARI mailing lists.

I emailed Bill and Karim, CC-ing you, and this was their reply (last December):

On Fri, Dec 11, 2015 at 04:58:38PM +0000, John Cremona wrote:
> Dear Karim and Bill,
>
> 1.  I put a lot of effort into the cases j=0 and j=1728, which in
> characteristics 2 and 3 (when they are the same case!) required
> considerable care.  For example, for p=2 the number of isomorphism
> classes is either 3 or 7 depending on the parity of the degree over
> F_2, i.e. that is the number of twists, so the idea is to determine
> which of the 3 or 7 cases you are in and apply the appropriate
> formula.  What does pari do in these cases?

For p=3, this is the function F3xq_ellcardj().
The curve and its twists become identical in some degree-6 extension
of the base field so we can identify the twist by using Kummer theory.
The formula is not straightforward, but optimal for efficiency.

For p=2, I never finished to compute the equivalent formula
(I think one need a degree 24 extension).
So instead we use random points to discriminate between the possible
candidates given by Deuring. This is done in F2xq_ellcard().

I wrote about one-sixth of the formula. If you know about the complete
formula in this case, please tell me!

> 2. If the j-invariant is defined over a much smaller field than the
> field of definition of the curve, then what I do (or Sage does) is to
> point-count on some curve with that j, over the field generated over
> the prime field by j;  use the standard formula to get the point-count
> of that curve over the original field of definition; and then decide
> on whether a final quadratic twist is needed.  Does your code do that?

We do not always do it, because computing minimal polynomial was
quite slow. Quite recently we have added faster methods to compute the
minimal polynomial so we can revisit this point.

Practical example with this would be welcome.

Cheers,
Bill.



---

archive/issue_comments_220259.json:
```json
{
    "body": "I also sort of feel it might be useful to keep the old Sage point counting code (exhaustive/bsgs/special j's), modify the _pari version and keep the wrapper dealing with field of definition and special j's.\n\nWith this sort of code it is always better to be able to double check results btw two independent implementations.",
    "created_at": "2016-11-17T15:18:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220259",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I also sort of feel it might be useful to keep the old Sage point counting code (exhaustive/bsgs/special j's), modify the _pari version and keep the wrapper dealing with field of definition and special j's.

With this sort of code it is always better to be able to double check results btw two independent implementations.



---

archive/issue_comments_220260.json:
```json
{
    "body": "Thanks for saying that, as it sounds better not coming from me.  I put a lot of work into that, knowing quite well that it was no good for cryptographically large cases.",
    "created_at": "2016-11-17T15:47:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220260",
    "user": "https://github.com/JohnCremona"
}
```

Thanks for saying that, as it sounds better not coming from me.  I put a lot of work into that, knowing quite well that it was no good for cryptographically large cases.



---

archive/issue_comments_220261.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd87\".",
    "created_at": "2017-07-17T17:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220261",
    "user": "https://github.com/roed314"
}
```

Changing keywords from "" to "sd87".



---

archive/issue_comments_220262.json:
```json
{
    "body": "From what I see in PARI/GP code, all special cases are now specially treated:\n* p=2: http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/basemath/F2xqE.c;h=ea2ad6eb00c5d1f7c03046c454a2fb67aa61eb9e;hb=HEAD#l805 and commit http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blobdiff;f=src/basemath/F2xqE.c;h=3c183ebcd1bec9545fa489fb2f0303961b2d99b2;hp=a057f8c51201c23f7a7c54390c8f9e6c66c1387c;hb=b2648cdaec00f184010132847748c4dbfa90dfba;hpb=0135506024b4d42f388f68d7b74f41217dd93719\n* p=3: http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/basemath/FlxqE.c;h=e91d28ccb66f4c24ffc165f84e667d2f76598741;hb=HEAD#l1576 and commit http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=commit;h=3f93b26f2bdc7188bc59e11b033e2d067274ba14\n* p>3: http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/basemath/FlxqE.c;h=e91d28ccb66f4c24ffc165f84e667d2f76598741;hb=HEAD#l1605 and http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/basemath/FpE.c;h=d1574d410a08b9ede9e68b8275afc00d1a18873e;hb=HEAD#l1946",
    "created_at": "2017-07-17T19:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220262",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

From what I see in PARI/GP code, all special cases are now specially treated:
* p=2: http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/basemath/F2xqE.c;h=ea2ad6eb00c5d1f7c03046c454a2fb67aa61eb9e;hb=HEAD#l805 and commit http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blobdiff;f=src/basemath/F2xqE.c;h=3c183ebcd1bec9545fa489fb2f0303961b2d99b2;hp=a057f8c51201c23f7a7c54390c8f9e6c66c1387c;hb=b2648cdaec00f184010132847748c4dbfa90dfba;hpb=0135506024b4d42f388f68d7b74f41217dd93719
* p=3: http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/basemath/FlxqE.c;h=e91d28ccb66f4c24ffc165f84e667d2f76598741;hb=HEAD#l1576 and commit http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=commit;h=3f93b26f2bdc7188bc59e11b033e2d067274ba14
* p>3: http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/basemath/FlxqE.c;h=e91d28ccb66f4c24ffc165f84e667d2f76598741;hb=HEAD#l1605 and http://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=src/basemath/FpE.c;h=d1574d410a08b9ede9e68b8275afc00d1a18873e;hb=HEAD#l1946



---

archive/issue_comments_220263.json:
```json
{
    "body": "I would still suggest we keep John's code even though it's not used by default.\nIt could still be used to double check PARI/GP results in doctests.",
    "created_at": "2017-07-17T19:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220263",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

I would still suggest we keep John's code even though it's not used by default.
It could still be used to double check PARI/GP results in doctests.



---

archive/issue_comments_220264.json:
```json
{
    "body": "Same about Sage's naive and BSGS code.",
    "created_at": "2017-07-17T19:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220264",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

Same about Sage's naive and BSGS code.



---

archive/issue_comments_220265.json:
```json
{
    "body": "And PARI/GP does not use the \"minpoly/field of definition\" trick as far as I know.",
    "created_at": "2017-07-17T19:45:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220265",
    "user": "https://trac.sagemath.org/admin/accounts/users/jpflori"
}
```

And PARI/GP does not use the "minpoly/field of definition" trick as far as I know.



---

archive/issue_comments_220266.json:
```json
{
    "body": "Can this ticket be finished off?",
    "created_at": "2018-04-13T08:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220266",
    "user": "https://github.com/JohnCremona"
}
```

Can this ticket be finished off?



---

archive/issue_comments_220267.json:
```json
{
    "body": "The only remaining questions are:\n\n1. What to do with the old code (mostly written by John Cremona I think).\n\n2. Do we need to implement the \"smaller field of definition of the `j`-invariant\" trick? As far as I can tell, this is the only optimization which is in the Sage code but not in PARI/GP.",
    "created_at": "2018-04-14T09:01:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220267",
    "user": "https://github.com/jdemeyer"
}
```

The only remaining questions are:

1. What to do with the old code (mostly written by John Cremona I think).

2. Do we need to implement the "smaller field of definition of the `j`-invariant" trick? As far as I can tell, this is the only optimization which is in the Sage code but not in PARI/GP.



---

archive/issue_comments_220268.json:
```json
{
    "body": "Replying to [comment:48 jdemeyer]:\n> The only remaining questions are:\n> \n> 1. What to do with the old code (mostly written by John Cremona I think).\n> \n> 2. Do we need to implement the \"smaller field of definition of the `j`-invariant\" trick? As far as I can tell, this is the only optimization which is in the Sage code but not in PARI/GP.\n\nI agree with jpflori that keeping the old code as something to compare with if bugs arise is a good idea.  This also means that we can check to see if the j-invariant is in a subfield of the base field when selecting the algorithm.",
    "created_at": "2018-04-14T17:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220268",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:48 jdemeyer]:
> The only remaining questions are:
> 
> 1. What to do with the old code (mostly written by John Cremona I think).
> 
> 2. Do we need to implement the "smaller field of definition of the `j`-invariant" trick? As far as I can tell, this is the only optimization which is in the Sage code but not in PARI/GP.

I agree with jpflori that keeping the old code as something to compare with if bugs arise is a good idea.  This also means that we can check to see if the j-invariant is in a subfield of the base field when selecting the algorithm.



---

archive/issue_comments_220269.json:
```json
{
    "body": "I'm inclined to move all the old code to a new file, say `src/sage/schemes/elliptic_curves/ell_finite_field_cardinality.py` because then it becomes easier to differentiate between the old and the new code.",
    "created_at": "2018-04-18T10:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220269",
    "user": "https://github.com/jdemeyer"
}
```

I'm inclined to move all the old code to a new file, say `src/sage/schemes/elliptic_curves/ell_finite_field_cardinality.py` because then it becomes easier to differentiate between the old and the new code.



---

archive/issue_comments_220270.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-18T12:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220270",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220271.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-19T15:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220271",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220272.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-19T16:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220273.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-19T16:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220273",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_220274.json:
```json
{
    "body": "update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220274",
    "user": "https://github.com/videlec"
}
```

update milestone 8.3 -> 8.4



---

archive/issue_comments_220275.json:
```json
{
    "body": "If anybody cares about this ticket, let me know. Then I'll rebase this.",
    "created_at": "2018-08-07T14:23:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220275",
    "user": "https://github.com/jdemeyer"
}
```

If anybody cares about this ticket, let me know. Then I'll rebase this.



---

archive/issue_comments_220276.json:
```json
{
    "body": "I care -- and will review.",
    "created_at": "2018-08-07T14:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220276",
    "user": "https://github.com/JohnCremona"
}
```

I care -- and will review.



---

archive/issue_comments_220277.json:
```json
{
    "body": "Even if not strictly required, it might be safest to base this on PARI 2.11 (#25567).",
    "created_at": "2018-08-07T14:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220277",
    "user": "https://github.com/jdemeyer"
}
```

Even if not strictly required, it might be safest to base this on PARI 2.11 (#25567).



---

archive/issue_comments_220278.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-07T14:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220278",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_220279.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-11-13T13:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220279",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_220280.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-11-13T13:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220280",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_220281.json:
```json
{
    "body": "Looks good to me!",
    "created_at": "2018-11-14T06:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220281",
    "user": "https://github.com/roed314"
}
```

Looks good to me!



---

archive/issue_comments_220282.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-11-14T06:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220282",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_220283.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-15T22:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16694",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16694#issuecomment-220283",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
