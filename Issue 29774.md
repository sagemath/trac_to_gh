# Issue 29774: sage_setup: Remove use of six

archive/issues_029774.json:
```json
{
    "body": "CC:  chapoton jhpalmieri\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30011\n\n",
    "created_at": "2020-06-28T16:20:54Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "title": "sage_setup: Remove use of six",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29774",
    "user": "mkoeppe"
}
```
CC:  chapoton jhpalmieri



Issue created by migration from https://trac.sagemath.org/ticket/30011





---

archive/issue_comments_422981.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-03T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422981",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_422982.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2020-07-03T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422982",
    "user": "mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_422983.json:
```json
{
    "body": "Just 1 commit on top of #29702",
    "created_at": "2020-07-03T07:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422983",
    "user": "mkoeppe"
}
```

Just 1 commit on top of #29702



---

archive/issue_comments_422984.json:
```json
{
    "body": "A few questions: \n\n- can we accomplish the same thing by installing `twisted` (after having removed it in #29754), and then importing `twisted.persisted.styles`? That is, can we delete `fpickle_setup.py`?\n- if not, then should we update that file with the latest version from `twisted`, for py3 compatibility?\n\nTo be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.",
    "created_at": "2020-07-07T20:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422984",
    "user": "jhpalmieri"
}
```

A few questions: 

- can we accomplish the same thing by installing `twisted` (after having removed it in #29754), and then importing `twisted.persisted.styles`? That is, can we delete `fpickle_setup.py`?
- if not, then should we update that file with the latest version from `twisted`, for py3 compatibility?

To be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.



---

archive/issue_comments_422985.json:
```json
{
    "body": "Maybe it's not worth it to install the most recent `twisted`, since it depends on a lot of other packages, most of which we don't install right now:\n\n```\nzope.interface>=4.4.2\nconstantly>=15.1\nincremental>=16.10.1\nAutomat>=0.3.0\nhyperlink>=17.1.1\nPyHamcrest!=1.10.0,>=1.9.0\nattrs>=19.2.0\n\n[all_non_platform]\npyopenssl>=16.0.0\nservice_identity>=18.1.0\nidna!=2.3,>=0.6\npyasn1\ncryptography>=2.5\nappdirs>=1.4.0\nbcrypt>=3.0.0\nsoappy\npyserial>=3.0\nh2<4.0,>=3.0\npriority<2.0,>=1.1.0\n```\n",
    "created_at": "2020-07-07T21:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422985",
    "user": "jhpalmieri"
}
```

Maybe it's not worth it to install the most recent `twisted`, since it depends on a lot of other packages, most of which we don't install right now:

```
zope.interface>=4.4.2
constantly>=15.1
incremental>=16.10.1
Automat>=0.3.0
hyperlink>=17.1.1
PyHamcrest!=1.10.0,>=1.9.0
attrs>=19.2.0

[all_non_platform]
pyopenssl>=16.0.0
service_identity>=18.1.0
idna!=2.3,>=0.6
pyasn1
cryptography>=2.5
appdirs>=1.4.0
bcrypt>=3.0.0
soappy
pyserial>=3.0
h2<4.0,>=3.0
priority<2.0,>=1.1.0
```




---

archive/issue_comments_422986.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> To be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.\n\nNeither do I.",
    "created_at": "2020-07-07T22:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422986",
    "user": "mkoeppe"
}
```

Replying to [comment:7 jhpalmieri]:
> To be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.

Neither do I.



---

archive/issue_comments_422987.json:
```json
{
    "body": "I'm testing out an updated version of `fpickle_setup` from version 20.3.0 of twisted. If it passes tests, I'll push the branch here.",
    "created_at": "2020-07-07T22:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422987",
    "user": "jhpalmieri"
}
```

I'm testing out an updated version of `fpickle_setup` from version 20.3.0 of twisted. If it passes tests, I'll push the branch here.



---

archive/issue_comments_422988.json:
```json
{
    "body": "It worked with an updated version, but `make ptestlong` also passed with this change instead:\n\n```diff\ndiff --git a/src/setup.py b/src/setup.py\nindex 72c59ace71..9a41ce1535 100755\n--- a/src/setup.py\n+++ b/src/setup.py\n@@ -20,7 +20,7 @@ from sage_setup import excepthook\n sys.excepthook = excepthook\n \n # This import allows instancemethods to be pickable\n-import sage_setup.fpickle_setup\n+# import sage_setup.fpickle_setup\n \n #########################################################\n ### List of Extensions\n```\n\nSee #11874 for some information. I certainly don't see the failure there: comment:46, \"PicklingError: Can't pickle <type 'instancemethod'>: attribute lookup __builtin__.instancemethod failed\".\n\nShould we just get rid of `fpickle_setup.py` instead?",
    "created_at": "2020-07-08T01:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422988",
    "user": "jhpalmieri"
}
```

It worked with an updated version, but `make ptestlong` also passed with this change instead:

```diff
diff --git a/src/setup.py b/src/setup.py
index 72c59ace71..9a41ce1535 100755
--- a/src/setup.py
+++ b/src/setup.py
@@ -20,7 +20,7 @@ from sage_setup import excepthook
 sys.excepthook = excepthook
 
 # This import allows instancemethods to be pickable
-import sage_setup.fpickle_setup
+# import sage_setup.fpickle_setup
 
 #########################################################
 ### List of Extensions
```

See #11874 for some information. I certainly don't see the failure there: comment:46, "PicklingError: Can't pickle <type 'instancemethod'>: attribute lookup __builtin__.instancemethod failed".

Should we just get rid of `fpickle_setup.py` instead?



---

archive/issue_comments_422989.json:
```json
{
    "body": "Replying to [comment:11 jhpalmieri]:\n> Should we just get rid of `fpickle_setup.py` instead?\n\nSounds good.",
    "created_at": "2020-07-08T01:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422989",
    "user": "mkoeppe"
}
```

Replying to [comment:11 jhpalmieri]:
> Should we just get rid of `fpickle_setup.py` instead?

Sounds good.



---

archive/issue_comments_422990.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-07-08T02:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422990",
    "user": "jhpalmieri"
}
```

New commits:



---

archive/issue_comments_422991.json:
```json
{
    "body": "I am testing this with `fedora-28-standard`, which uses system python 3.6.5",
    "created_at": "2020-07-08T02:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422991",
    "user": "mkoeppe"
}
```

I am testing this with `fedora-28-standard`, which uses system python 3.6.5



---

archive/issue_comments_422992.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-08T05:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422992",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_422993.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-10T19:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29774",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29774#issuecomment-422993",
    "user": "vbraun"
}
```

Resolution: fixed
