# Issue 29774: sage_setup: Remove use of six

Issue created by migration from https://trac.sagemath.org/ticket/30011

Original creator: mkoeppe

Original creation time: 2020-06-28 16:20:54

CC:  chapoton jhpalmieri




---

Comment by mkoeppe created at 2020-07-03 07:03:57

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2020-07-03 07:03:57

Last 10 new commits:


---

Comment by mkoeppe created at 2020-07-03 07:04:12

Just 1 commit on top of #29702


---

Comment by jhpalmieri created at 2020-07-07 20:20:56

A few questions: 

- can we accomplish the same thing by installing `twisted` (after having removed it in #29754), and then importing `twisted.persisted.styles`? That is, can we delete `fpickle_setup.py`?
- if not, then should we update that file with the latest version from `twisted`, for py3 compatibility?

To be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.


---

Comment by jhpalmieri created at 2020-07-07 21:17:43

Maybe it's not worth it to install the most recent `twisted`, since it depends on a lot of other packages, most of which we don't install right now:

```
zope.interface>=4.4.2
constantly>=15.1
incremental>=16.10.1
Automat>=0.3.0
hyperlink>=17.1.1
PyHamcrest!=1.10.0,>=1.9.0
attrs>=19.2.0

[all_non_platform]
pyopenssl>=16.0.0
service_identity>=18.1.0
idna!=2.3,>=0.6
pyasn1
cryptography>=2.5
appdirs>=1.4.0
bcrypt>=3.0.0
soappy
pyserial>=3.0
h2<4.0,>=3.0
priority<2.0,>=1.1.0
```



---

Comment by mkoeppe created at 2020-07-07 22:10:34

Replying to [comment:7 jhpalmieri]:
> To be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.

Neither do I.


---

Comment by jhpalmieri created at 2020-07-07 22:25:03

I'm testing out an updated version of `fpickle_setup` from version 20.3.0 of twisted. If it passes tests, I'll push the branch here.


---

Comment by jhpalmieri created at 2020-07-08 01:10:38

It worked with an updated version, but `make ptestlong` also passed with this change instead:

```diff
diff --git a/src/setup.py b/src/setup.py
index 72c59ace71..9a41ce1535 100755
--- a/src/setup.py
+++ b/src/setup.py
@@ -20,7 +20,7 @@ from sage_setup import excepthook
 sys.excepthook = excepthook
 
 # This import allows instancemethods to be pickable
-import sage_setup.fpickle_setup
+# import sage_setup.fpickle_setup
 
 #########################################################
 ### List of Extensions
```

See #11874 for some information. I certainly don't see the failure there: comment:46, "PicklingError: Can't pickle <type 'instancemethod'>: attribute lookup __builtin__.instancemethod failed".

Should we just get rid of `fpickle_setup.py` instead?


---

Comment by mkoeppe created at 2020-07-08 01:46:07

Replying to [comment:11 jhpalmieri]:
> Should we just get rid of `fpickle_setup.py` instead?

Sounds good.


---

Comment by jhpalmieri created at 2020-07-08 02:06:19

New commits:


---

Comment by mkoeppe created at 2020-07-08 02:16:35

I am testing this with `fedora-28-standard`, which uses system python 3.6.5


---

Comment by mkoeppe created at 2020-07-08 05:13:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-07-10 19:33:40

Resolution: fixed
