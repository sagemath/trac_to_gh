# Issue 33550: Installation manual: Update section "system-wide install"

Issue created by migration from https://trac.sagemath.org/ticket/33787

Original creator: mkoeppe

Original creation time: 2022-05-02 16:56:40

CC:  dimpase jhpalmieri slelievre

(split out from #30207)

https://doc.sagemath.org/html/en/installation/source.html#installation-in-a-multiuser-environment should be updated:

- Don't edit the script
- Just symlink to the `sage` script in venv


---

Comment by mkoeppe created at 2022-05-02 18:16:49

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-05-02 18:16:49

New commits:


---

Comment by git created at 2022-05-02 20:56:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2022-05-11 18:41:05

The suggestion to use

```sh
$ sudo ln -s $(sage -sh -c 'ls $SAGE_ROOT/venv/bin/sage') /usr/local/bin
```

is not consistent with the top-level `sage` script, which has

```sh
if [ -x "$SAGE_ROOT/src/bin/sage" ]; then
    exec "$SAGE_ROOT/src/bin/sage" "$@"
elif [ -x "$SAGE_ROOT/local/bin/sage" ]; then # if in a stripped binary
    # Note in this case we assume that SAGE_LOCAL is the "local" subdirectory
    exec "$SAGE_ROOT/local/bin/sage" "$@"
else
    echo >&2 "$0: no Sage installation found in \$SAGE_ROOT=$SAGE_ROOT"
    exit 1
fi
```

(a) Should the Sage script look in `venv/bin` rather than `local/bin`? (b) Should the suggestion be to make a symlink to `SAGE_ROOT/src/bin/sage`?


---

Comment by mkoeppe created at 2022-05-11 18:55:54

The `local/bin/sage` could be changed to `venv/bin/sage`, yes. But this distinction only matters when `configure --prefix` is not in use because `--prefix` implies `--without-sage-venv`. (In Volker's binary build, `--prefix` is used.)

The "elif" branch is only relevant in binary builds that don't ship `src`. Do Volker's binary builds (which we no longer advertise) have `src`?


---

Comment by mkoeppe created at 2022-05-11 19:03:38

> Do Volker's binary builds (which we no longer advertise) have `src`?

Actually, this turns out to be irrelevant - it looks like Volker stopped making these binaries altogether, the last one is 9.4 -http://files.sagemath.org/linux/64bit/index.html


---

Comment by mkoeppe created at 2022-05-11 19:13:34

But for the record, http://files.sagemath.org/linux/64bit/sage-9.4-Ubuntu_20.04-x86_64.tar.bz2 does have `src`, but it does not have the symbolic link `venv` (that was [introduced in 9.5](https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages))


---

Comment by mkoeppe created at 2022-05-11 19:18:13

"stripped binary" might refer to what `make micro_release` creates. I have never used, but I think it is in use in the user-facing Docker containers somehow. It deletes a lot of stuff, but it does leave `src/bin` around.


---

Comment by git created at 2022-05-11 19:20:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-11 19:20:41

So here's a simplification.


---

Comment by mkoeppe created at 2022-05-11 19:29:09

Replying to [comment:6 jhpalmieri]:
> (b) Should the suggestion be to make a symlink to `SAGE_ROOT/src/bin/sage`?

No. `SAGE_ROOT/sage` uses `src/bin/sage` to allow for uses in unconfigured source trees.

After a build of Sage, using the installed version is more canonical.


---

Comment by mkoeppe created at 2022-05-11 19:36:33

Follow-up = #33841


---

Comment by jhpalmieri created at 2022-05-12 03:56:04

How can you run

```
sudo ln -s $(sage -sh -c 'ls $SAGE_ROOT/venv/bin/sage') /usr/local/bin
```

is `sage` isn't already in your path?


---

Comment by mkoeppe created at 2022-05-12 04:23:23

Thanks for catching this


---

Comment by git created at 2022-05-12 04:24:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-05-12 04:26:46

(I had copied this from similar invocations shown in `src/doc/en/installation/launching.rst`, which however start with "Assuming that [SageMath](SageMath) can be invoked by typing `sage`"


---

Comment by jhpalmieri created at 2022-05-12 23:55:49

Looks good to me.


---

Comment by jhpalmieri created at 2022-05-12 23:55:49

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-05-13 00:08:03

Thanks!


---

Comment by vbraun created at 2022-05-22 16:32:04

Resolution: fixed
