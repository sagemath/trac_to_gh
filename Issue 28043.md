# Issue 28043: CombinatorialPolyhedron: replace attributes by methods

Issue created by migration from https://trac.sagemath.org/ticket/28280

Original creator: @kliem

Original creation time: 2019-07-29 19:59:29

CC:  jipilab tscrim vdelecroix @laisrast chapoton

Replace attributes in `CombinatorialPolyhedron` by methods, such that they can potentially be lazy evaluated.

This is motivated by #10777.


---

Comment by @kliem created at 2019-07-29 20:01:14

Some attributes like `bitrep_vertices` might have been an unfortunate choice:

As they are accessed by other classes, I'm forced to compute e.g. `bitrep_vertices` on initialization. If `CombinatorialPolyhedron` was ever to be a parent of `Polyhedron_base` (see #10777), this would force a polyhedron to compute the incidence matrix right away.

From my understanding, the decorator ``@`lazy_attribute` is not available for extension types directly. I'm thinking of changing those attributes to methods, such that there is a method `bitrep_facets` and an attribute `_bitrep_facets`. This way one can later change this to be lazily evaluated.

Any thoughts?


---

Comment by @kliem created at 2019-07-29 20:03:00

Changing type from enhancement to defect.


---

Comment by @kliem created at 2019-07-29 21:37:02

New commits:


---

Comment by @kliem created at 2019-07-29 21:38:45

Changing status from new to needs_review.


---

Comment by git created at 2019-08-06 21:06:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2019-08-07 06:24:18

If a ``@`lazy_attribute` doesn't work, then just make it a ``@`cached_method` (with no arguments).


---

Comment by @kliem created at 2019-08-12 11:18:20

Replying to [comment:7 tscrim]:
> If a ``@`lazy_attribute` doesn't work, then just make it a ``@`cached_method` (with no arguments).

Does either one work with `cdef`?

Here, I want to give a small example of what I want to do:


```
sage: cython('''
....: cdef class BaseClass:
....:     cdef public int number
....: 
....:     def __init__(self):
....:         self.number = 2
....: ''')
sage: class NewClass(BaseClass):
....:     def __init__(self):
....:         pass
....:     
sage: example = NewClass()
sage: example.number
0
```


I'm trying to somehow make `number` be a lazy attribute. The only solution I came up with, is to replace it by a method. Is there another way?


The background is that `CombinatorialPolyhedron` does require `Polyhedron` to compute the incidence matrix for correct initialization. If `CombinatorialPolyhedron` is to be a base class of `Polyhedron_base` at some point (#10777), it needs to be lazily initialized.


---

Comment by @kliem created at 2019-08-26 13:10:21

Changing type from defect to enhancement.


---

Comment by @kliem created at 2019-08-26 13:10:21

Is this the right approach, am I missing something? Is it acceptable to do those name changes? (`CombinatorialPolyhedron` still was not part of a stable release)

If so, I think the review is rather trivial and I can try to find someone else to do it.


---

Comment by jipilab created at 2019-09-09 14:04:15

Some comments:

Since these methods will then occur in the namespace, perhaps it would make sense to make it consistent with the names of the methods for `Polyhedron`. For example, `unbounded` -> `is_(un)bounded`. Probably it would make more sense to store `is_bounded` rather than `unbounded`....

Similar for `V` and `H`, having a method with only one letter is not so revealing...

I guess it is important to be careful with the naming at this precise moment as after, changing the name of methods will force the usage of deprecation warnings and that's annoying. (I believe that some methods should be changed to be consistent with `Polyhedron`...).


---

Comment by @kliem created at 2019-09-10 11:28:05

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-09-10 19:01:32

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by git created at 2019-09-10 19:19:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-10 20:12:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-09-10 20:16:00

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2019-09-10 20:16:00

Ok, I think naming is consistent with `Polyhedron_base` now.

It would be great to have this in sage 8.9, so that we can avoid any deprecation warning.


---

Comment by jipilab created at 2019-09-12 06:55:17

Well... 8.9.rc0 is already out... so time is running out... :-(

On which version of Sage is this based? Could you rebase on 8.9.rc0 so that we have a clear view of what is done in this ticket. Or is it actually already only stuff from this ticket?

 - I would vote for `Vrep->Vrepresentation` same for `H`. This is what I meant originally with be consistent with `Polyhedron`, I should have specified it, my bad.

 - You should also mention in the description of this ticket that you remove an empty folder. This is done in one of the commits. (This is a good habit to take for such small changes, otherwise, the penalty is: "please open a ticket just for that"...).


---

Comment by jipilab created at 2019-09-12 06:55:17

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2019-09-12 07:45:46

Replying to [comment:16 jipilab]:
> Well... 8.9.rc0 is already out... so time is running out... :-(
> 
> On which version of Sage is this based? Could you rebase on 8.9.rc0 so that we have a clear view of what is done in this ticket. Or is it actually already only stuff from this ticket?
This ticket is huge, but almost all changes are trivial. Sorry, but that's what happens, when you change some names.
> 
>  - I would vote for `Vrep->Vrepresentation` same for `H`. This is what I meant originally with be consistent with `Polyhedron`, I should have specified it, my bad.
In `Polyhedron` there is `Vrepresentation` and `Vrep-generator`. So in a way, both things are used.

Now for `CombinatorialPolyhedron` there is only `Vrepresentation` in the namespace. `_Vrep` is an internal cython variable, while `Vrep` is the cython method that accesses `_Vrep`. I tried to use `cpdef` for both of them, but that didn't work (`closures inside cpdef functions not yet supported`, seems to be connected with `smallInteger`). So as long as it is that way, I would propse leaving the python method named `Vrepresentation` and the cython method `Vrepr`. But I'm open for different suggestions.

Now with `CombinatorialFace` things are a bit different. At the moment there is `Vrep`, `Hrep`, `n_Vrepresentation` and `n_Hrepresentation` (not consistent, I just noticed). `Vrep` allows giving both the indices and the names of the Vrepresentation. So in a way it combines `ambient_Vrepresentation` and `ambient_V_indices` of `PolyhedronFace`. What do you suggest?

One option would be the following for `CombinatorialFace`:
- `Vrep` -> `ambient_Vrep`
- make `ambient_Vrepresentation` an alias for `ambient_Vrep(names=True)`
- make `ambient_V_indices` an alias for `ambient_V_indices(names=False)`
- `n_Vrepresentation` -> `n_ambient_Vreprentation`
- same for `Hrep`
Unfortunatly, those changes are going to make the ticket even larger.

What do you think? If I have a clear idea what to do, I think I can make the remaining changes tonight.

> 
>  - You should also mention in the description of this ticket that you remove an empty folder. This is done in one of the commits. (This is a good habit to take for such small changes, otherwise, the penalty is: "please open a ticket just for that"...).
>


---

Comment by jipilab created at 2019-09-12 08:02:02

Replying to [comment:17 gh-kliem]:
> Replying to [comment:16 jipilab]:
> > Well... 8.9.rc0 is already out... so time is running out... :-(
> > 
> > On which version of Sage is this based? Could you rebase on 8.9.rc0 so that we have a clear view of what is done in this ticket. Or is it actually already only stuff from this ticket?
> This ticket is huge, but almost all changes are trivial. Sorry, but that's what happens, when you change some names.

I was just making sure. Let's try to make it happen.

> > 
> >  - I would vote for `Vrep->Vrepresentation` same for `H`. This is what I meant originally with be consistent with `Polyhedron`, I should have specified it, my bad.
> In `Polyhedron` there is `Vrepresentation` and `Vrep-generator`. So in a way, both things are used.

`V_rep` is shortened because `_generator` appears after. So I would vote for completing the name to `Vrepresentation`.
 
> Now for `CombinatorialPolyhedron` there is only `Vrepresentation` in the namespace. `_Vrep` is an internal cython variable, while `Vrep` is the cython method that accesses `_Vrep`. I tried to use `cpdef` for both of them, but that didn't work (`closures inside cpdef functions not yet supported`, seems to be connected with `smallInteger`). So as long as it is that way, I would propse leaving the python method named `Vrepresentation` and the cython method `Vrepr`. But I'm open for different suggestions.

Got it! Looks good.
> 
> Now with `CombinatorialFace` things are a bit different. At the moment there is `Vrep`, `Hrep`, `n_Vrepresentation` and `n_Hrepresentation` (not consistent, I just noticed). `Vrep` allows giving both the indices and the names of the Vrepresentation. So in a way it combines `ambient_Vrepresentation` and `ambient_V_indices` of `PolyhedronFace`. What do you suggest?
> 

Ok. I see. I would do `Vrep` to `Vrepresentation`. Then, if `CombinatorialFace` has a different behavior than the `PolyhedronFace` I believe it is fine.

> One option would be the following for `CombinatorialFace`:
> - `Vrep` -> `ambient_Vrep`
> - make `ambient_Vrepresentation` an alias for `ambient_Vrep(names=True)`
> - make `ambient_V_indices` an alias for `ambient_V_indices(names=False)`
> - `n_Vrepresentation` -> `n_ambient_Vreprentation`
> - same for `Hrep`


It seems like making the current `Vrep` private and have `ambient_Vrepresentation` (with the whole word) call this private function `Vrep(names=True)` and likewise for `ambient_V_indices` be more reasonable.

Why have 3 functions when we can have 2? Especially, the 2 functions behave as they do in `PolyhedronFace`... so I do not see the need to provide `Vrep` in the namespace.


> > 
> >  - You should also mention in the description of this ticket that you remove an empty folder. This is done in one of the commits. (This is a good habit to take for such small changes, otherwise, the penalty is: "please open a ticket just for that"...).
> > 

Please apply this change to the description.


---

Comment by @kliem created at 2019-09-12 09:09:38

Replying to [comment:18 jipilab]:
> Replying to [comment:17 gh-kliem]:
> > Replying to [comment:16 jipilab]:
> > > Well... 8.9.rc0 is already out... so time is running out... :-(
> > > 
> > > On which version of Sage is this based? Could you rebase on 8.9.rc0 so that we have a clear view of what is done in this ticket. Or is it actually already only stuff from this ticket?
> > This ticket is huge, but almost all changes are trivial. Sorry, but that's what happens, when you change some names.
> 
> I was just making sure. Let's try to make it happen.
> 
> > > 
> > >  - I would vote for `Vrep->Vrepresentation` same for `H`. This is what I meant originally with be consistent with `Polyhedron`, I should have specified it, my bad.
> > In `Polyhedron` there is `Vrepresentation` and `Vrep-generator`. So in a way, both things are used.
> 
> `V_rep` is shortened because `_generator` appears after. So I would vote for completing the name to `Vrepresentation`.
>  
> > Now for `CombinatorialPolyhedron` there is only `Vrepresentation` in the namespace. `_Vrep` is an internal cython variable, while `Vrep` is the cython method that accesses `_Vrep`. I tried to use `cpdef` for both of them, but that didn't work (`closures inside cpdef functions not yet supported`, seems to be connected with `smallInteger`). So as long as it is that way, I would propse leaving the python method named `Vrepresentation` and the cython method `Vrepr`. But I'm open for different suggestions.
> 
> Got it! Looks good.
> > 
> > Now with `CombinatorialFace` things are a bit different. At the moment there is `Vrep`, `Hrep`, `n_Vrepresentation` and `n_Hrepresentation` (not consistent, I just noticed). `Vrep` allows giving both the indices and the names of the Vrepresentation. So in a way it combines `ambient_Vrepresentation` and `ambient_V_indices` of `PolyhedronFace`. What do you suggest?
> > 
> 
> Ok. I see. I would do `Vrep` to `Vrepresentation`. Then, if `CombinatorialFace` has a different behavior than the `PolyhedronFace` I believe it is fine.
> 
> > One option would be the following for `CombinatorialFace`:
> > - `Vrep` -> `ambient_Vrep`
> > - make `ambient_Vrepresentation` an alias for `ambient_Vrep(names=True)`
> > - make `ambient_V_indices` an alias for `ambient_V_indices(names=False)`
> > - `n_Vrepresentation` -> `n_ambient_Vreprentation`
> > - same for `Hrep`
> 
> 
> It seems like making the current `Vrep` private and have `ambient_Vrepresentation` (with the whole word) call this private function `Vrep(names=True)` and likewise for `ambient_V_indices` be more reasonable.
> 
> Why have 3 functions when we can have 2? Especially, the 2 functions behave as they do in `PolyhedronFace`... so I do not see the need to provide `Vrep` in the namespace.
> 
> 
> > > 
> > >  - You should also mention in the description of this ticket that you remove an empty folder. This is done in one of the commits. (This is a good habit to take for such small changes, otherwise, the penalty is: "please open a ticket just for that"...).
> > > 
> 
> Please apply this change to the description.

I will. It's just one of those things that where perfectly clear to me, so I do didn't comment.

One more thing: Lots of changes are due to the changes of abbreciations `Vrepr` -> `Vrep` etc. I noticed you seem to at least use both. I could undo this change and this might make the ticket shorter.


---

Comment by git created at 2019-09-12 20:54:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-09-12 21:09:22

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2019-09-30 11:53:41

I guess, we need deprecation warnings now.


---

Comment by @kliem created at 2019-09-30 11:53:41

Changing status from needs_review to needs_work.


---

Comment by @kliem created at 2019-10-16 08:32:41

Changing type from enhancement to task.


---

Comment by @kliem created at 2019-10-16 08:37:43

I'm going to put this on needs review as long as tickets on that list need to be reviewed.

So on #22420 (meta ticket polyhedra) there needs to be only this ticket to collect all the others.


---

Comment by @kliem created at 2019-10-16 08:37:43

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2019-10-18 08:31:51

Changing status from needs_review to needs_work.


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by @kliem created at 2020-04-24 08:14:54

Changing status from needs_work to needs_review.


---

Comment by @kliem created at 2020-04-24 08:14:54

This task is taken care of.


---

Comment by jipilab created at 2020-05-11 13:11:55

Please, close this ticket as it's objectives have been fulfilled! Thanks!


---

Comment by jipilab created at 2020-05-11 13:12:20

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-05-26 06:39:19

Resolution: worksforme
