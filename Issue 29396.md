# Issue 29396: src/doc/bootstrap: Generate list of packages (with links to documentation) for ref manual from build/pkgs

archive/issues_029396.json:
```json
{
    "body": "CC:  @jhpalmieri @kiwifb @fchapoton @dimpase\n\nWe propose to generate a full list of packages that Sage uses (with links to documentation - see #27495)\nfor the reference manual from information in `build/pkgs`.\n\n1. If other sources have better information than what is in `build/pkgs`, update `build/pkgs` accordingly. (See https://wiki.sagemath.org/SageWiki)\n\n   - https://github.com/sagemath/website/blob/master/conf/packages.yaml (which is used for generating http://www.sagemath.org/links-components.html)\n   - https://wiki.sagemath.org/spkg (another incomplete list of packages)\n\n2. Create a script that formats the information as .rst \n\n3. Delete the obsolete other sources.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29633\n\n",
    "created_at": "2020-05-02T02:37:03Z",
    "labels": [
        "documentation",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "src/doc/bootstrap: Generate list of packages (with links to documentation) for ref manual from build/pkgs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29396",
    "user": "@mkoeppe"
}
```
CC:  @jhpalmieri @kiwifb @fchapoton @dimpase

We propose to generate a full list of packages that Sage uses (with links to documentation - see #27495)
for the reference manual from information in `build/pkgs`.

1. If other sources have better information than what is in `build/pkgs`, update `build/pkgs` accordingly. (See https://wiki.sagemath.org/SageWiki)

   - https://github.com/sagemath/website/blob/master/conf/packages.yaml (which is used for generating http://www.sagemath.org/links-components.html)
   - https://wiki.sagemath.org/spkg (another incomplete list of packages)

2. Create a script that formats the information as .rst 

3. Delete the obsolete other sources.

Issue created by migration from https://trac.sagemath.org/ticket/29633





---

archive/issue_comments_417028.json:
```json
{
    "body": "For example, I suppose we could transform the ad-hoc markup in SPKG.txt to rst and then include these files in the manual...",
    "created_at": "2020-05-02T23:21:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417028",
    "user": "@mkoeppe"
}
```

For example, I suppose we could transform the ad-hoc markup in SPKG.txt to rst and then include these files in the manual...



---

archive/issue_comments_417029.json:
```json
{
    "body": "Hmm. is the format of SPKG.txt `mediawiki`? Then we can just convert it using pandoc\n----\nNew commits:",
    "created_at": "2020-05-03T00:02:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417029",
    "user": "@mkoeppe"
}
```

Hmm. is the format of SPKG.txt `mediawiki`? Then we can just convert it using pandoc
----
New commits:



---

archive/issue_comments_417030.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-03T00:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417030",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417031.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n> Hmm. is the format of SPKG.txt `mediawiki`? Then we can just convert it using pandoc\n\n\n```\nfor f in build/pkgs/*/SPKG.txt; do pandoc --from=mediawiki --to=rst $f --output=$(dirname $f)/SPKG.rst; git rm -f $f; git add $(dirname $f)/SPKG.rst; done'\n```\n\n\nworks reasonably well",
    "created_at": "2020-05-03T00:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417031",
    "user": "@mkoeppe"
}
```

Replying to [comment:4 mkoeppe]:
> Hmm. is the format of SPKG.txt `mediawiki`? Then we can just convert it using pandoc


```
for f in build/pkgs/*/SPKG.txt; do pandoc --from=mediawiki --to=rst $f --output=$(dirname $f)/SPKG.rst; git rm -f $f; git add $(dirname $f)/SPKG.rst; done'
```


works reasonably well



---

archive/issue_comments_417032.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-05-03T01:24:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417032",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_417033.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-03T01:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417033",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417034.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-03T04:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417034",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417035.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-05-03T04:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417035",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_417036.json:
```json
{
    "body": "All hail Pandoc!",
    "created_at": "2020-05-03T09:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417036",
    "user": "@dimpase"
}
```

All hail Pandoc!



---

archive/issue_comments_417037.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-05-03T12:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417037",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_417038.json:
```json
{
    "body": "OK, this works, and looks nice in the reference manual, too.",
    "created_at": "2020-05-03T12:47:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417038",
    "user": "@dimpase"
}
```

OK, this works, and looks nice in the reference manual, too.



---

archive/issue_comments_417039.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-05-03T15:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417039",
    "user": "@mkoeppe"
}
```

Thanks!



---

archive/issue_comments_417040.json:
```json
{
    "body": "Fixes so PDF docs build.\n----\nNew commits:",
    "created_at": "2020-05-04T19:50:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417040",
    "user": "@jhpalmieri"
}
```

Fixes so PDF docs build.
----
New commits:



---

archive/issue_comments_417041.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-05-04T19:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417041",
    "user": "@mkoeppe"
}
```

Thank you!



---

archive/issue_comments_417042.json:
```json
{
    "body": "Merged in the new rc to resolve a merge conflict.\n----\nNew commits:",
    "created_at": "2020-05-04T23:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417042",
    "user": "@mkoeppe"
}
```

Merged in the new rc to resolve a merge conflict.
----
New commits:



---

archive/issue_comments_417043.json:
```json
{
    "body": "Updated the ticket description to what is actually in the branch.\n\nFollow-up = #29655.",
    "created_at": "2020-05-06T06:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417043",
    "user": "@mkoeppe"
}
```

Updated the ticket description to what is actually in the branch.

Follow-up = #29655.



---

archive/issue_comments_417044.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-05-25T22:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417044",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_417045.json:
```json
{
    "body": "PDF docs fail",
    "created_at": "2020-05-25T22:23:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417045",
    "user": "@vbraun"
}
```

PDF docs fail



---

archive/issue_comments_417046.json:
```json
{
    "body": "Also this\n\n```\nFile \"src/sage/tests/cmdline.py\", line 217, in sage.tests.cmdline.test_executable\nFailed example:\n    print(out)  # optional - build\nExpected:\n    Found local metadata for sqlite-...\n    = SQLite =\n    ...\n    SQLite is a software library that implements a self-contained,\n    serverless, zero-configuration, transactional SQL database engine.\n    ...\nGot:\n    Found local metadata for sqlite-3290000\n    SQLite\n    ======\n    <BLANKLINE>\n    Description\n    -----------\n    <BLANKLINE>\n    SQLite is a software library that implements a self-contained,\n    serverless, zero-configuration, transactional SQL database engine.\n    <BLANKLINE>\n    License\n```\n",
    "created_at": "2020-05-25T22:27:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417046",
    "user": "@vbraun"
}
```

Also this

```
File "src/sage/tests/cmdline.py", line 217, in sage.tests.cmdline.test_executable
Failed example:
    print(out)  # optional - build
Expected:
    Found local metadata for sqlite-...
    = SQLite =
    ...
    SQLite is a software library that implements a self-contained,
    serverless, zero-configuration, transactional SQL database engine.
    ...
Got:
    Found local metadata for sqlite-3290000
    SQLite
    ======
    <BLANKLINE>
    Description
    -----------
    <BLANKLINE>
    SQLite is a software library that implements a self-contained,
    serverless, zero-configuration, transactional SQL database engine.
    <BLANKLINE>
    License
```




---

archive/issue_comments_417047.json:
```json
{
    "body": "Also unmerging this ticket breaks builds, \"make clean\" apparently doesn't delete the new spkg docs directory",
    "created_at": "2020-05-25T22:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417047",
    "user": "@vbraun"
}
```

Also unmerging this ticket breaks builds, "make clean" apparently doesn't delete the new spkg docs directory



---

archive/issue_comments_417048.json:
```json
{
    "body": "Replying to [comment:24 vbraun]:\n> PDF docs fail\n\nI can't reproduce this. Can you provide more details?",
    "created_at": "2020-05-26T04:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417048",
    "user": "@jhpalmieri"
}
```

Replying to [comment:24 vbraun]:
> PDF docs fail

I can't reproduce this. Can you provide more details?



---

archive/issue_comments_417049.json:
```json
{
    "body": "pdf failure in spkg",
    "created_at": "2020-05-26T05:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417049",
    "user": "@kiwifb"
}
```

pdf failure in spkg



---

archive/issue_comments_417050.json:
```json
{
    "body": "Attachment [spkg.log](tarball://root/attachments/some-uuid/ticket29633/spkg.log) by @kiwifb created at 2020-05-26 05:38:49\n\nI can reproduce the failure in sage-on-gentoo. Find the log in attachment. I also have the full generated `spkg.tex` if necessary, but this is where it fails\n\n```\n\\section{Description}\n\\label{\\detokenize{database_jones_numfield:description}}\nThis is a table of number fields with bounded ramification and degree\n\u22646.\n\n```\n\nit shokes on the symbol before the 6. Probably misinterpreted unicode.",
    "created_at": "2020-05-26T05:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417050",
    "user": "@kiwifb"
}
```

Attachment [spkg.log](tarball://root/attachments/some-uuid/ticket29633/spkg.log) by @kiwifb created at 2020-05-26 05:38:49

I can reproduce the failure in sage-on-gentoo. Find the log in attachment. I also have the full generated `spkg.tex` if necessary, but this is where it fails

```
\section{Description}
\label{\detokenize{database_jones_numfield:description}}
This is a table of number fields with bounded ramification and degree
≤6.

```

it shokes on the symbol before the 6. Probably misinterpreted unicode.



---

archive/issue_comments_417051.json:
```json
{
    "body": "I guess it is `\u2264` somewhere in the text.\n\n\n```\n1005\tChapter 45.\n1006\t! Missing $ inserted.\n1007\t<inserted text> \n1008\t                $\n1009\tl.1955 \u2264\n1010\t          6.\n1011\t?\n1012\t! Emergency stop.\n1013\t<inserted text> \n1014\t                $\n1015\tl.1955 \u2264\n1016\t          6.\n```\n\n\nThis one?\n\n```\n$ grep -R \"\u2264\" src/doc/\nsrc/doc/en/reference/spkg/database_jones_numfield.rst:\u22646.\n```\n\n\nSo one would need to modify this package, don't know how.",
    "created_at": "2020-05-26T07:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417051",
    "user": "@dimpase"
}
```

I guess it is `≤` somewhere in the text.


```
1005	Chapter 45.
1006	! Missing $ inserted.
1007	<inserted text> 
1008	                $
1009	l.1955 ≤
1010	          6.
1011	?
1012	! Emergency stop.
1013	<inserted text> 
1014	                $
1015	l.1955 ≤
1016	          6.
```


This one?

```
$ grep -R "≤" src/doc/
src/doc/en/reference/spkg/database_jones_numfield.rst:≤6.
```


So one would need to modify this package, don't know how.



---

archive/issue_comments_417052.json:
```json
{
    "body": "Yes, that one. Just replace the freaking symbol with a bit of text. \n\n```\nlower or equal to 6.\n```\n\nthere is no imperative for a symbolic short hand there.",
    "created_at": "2020-05-26T07:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417052",
    "user": "@kiwifb"
}
```

Yes, that one. Just replace the freaking symbol with a bit of text. 

```
lower or equal to 6.
```

there is no imperative for a symbolic short hand there.



---

archive/issue_comments_417053.json:
```json
{
    "body": "well, yes, but how does one modify that `jones.sobj` which lives in the package's file, `database_jones_numfield-4.tar.gz`?",
    "created_at": "2020-05-26T08:05:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417053",
    "user": "@dimpase"
}
```

well, yes, but how does one modify that `jones.sobj` which lives in the package's file, `database_jones_numfield-4.tar.gz`?



---

archive/issue_comments_417054.json:
```json
{
    "body": "Ah! I see, you don't understand how this ticket works. You have to edit `build/pkg/database_jones_numfield/SPKG.rst` which contains the original offending character.",
    "created_at": "2020-05-26T08:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417054",
    "user": "@kiwifb"
}
```

Ah! I see, you don't understand how this ticket works. You have to edit `build/pkg/database_jones_numfield/SPKG.rst` which contains the original offending character.



---

archive/issue_comments_417055.json:
```json
{
    "body": "Replying to [comment:32 fbissey]:\n> Ah! I see, you don't understand how this ticket works. You have to edit `build/pkg/database_jones_numfield/SPKG.rst` which contains the original offending character.\n\noops, I see. This is easy to fix indeed. Matthias, can you do this on your branch?",
    "created_at": "2020-05-26T09:24:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417055",
    "user": "@dimpase"
}
```

Replying to [comment:32 fbissey]:
> Ah! I see, you don't understand how this ticket works. You have to edit `build/pkg/database_jones_numfield/SPKG.rst` which contains the original offending character.

oops, I see. This is easy to fix indeed. Matthias, can you do this on your branch?



---

archive/issue_comments_417056.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> Fixes so PDF docs build.\n> ----\n> New commits:\n> ||[8cc4f28](https://git.sagemath.org/sage.git/commit?id=8cc4f28c0a78f32ba80a504683a9c8269782a05c)||`trac 29633: fixes for PDF docbuilding`||\n\nWhat happened to this commit? Please use it to fix the PDF docbuilding.",
    "created_at": "2020-05-26T15:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417056",
    "user": "@jhpalmieri"
}
```

Replying to [comment:17 jhpalmieri]:
> Fixes so PDF docs build.
> ----
> New commits:
> ||[8cc4f28](https://git.sagemath.org/sage.git/commit?id=8cc4f28c0a78f32ba80a504683a9c8269782a05c)||`trac 29633: fixes for PDF docbuilding`||

What happened to this commit? Please use it to fix the PDF docbuilding.



---

archive/issue_comments_417057.json:
```json
{
    "body": "Apparently was lost in some late night merging activity",
    "created_at": "2020-05-27T01:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417057",
    "user": "@mkoeppe"
}
```

Apparently was lost in some late night merging activity



---

archive/issue_comments_417058.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-27T03:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417058",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417059.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-05-27T03:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417059",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_417060.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-05-27T04:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417060",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_417061.json:
```json
{
    "body": "Fixing the doctest in comment:25.\n----\nNew commits:",
    "created_at": "2020-05-27T04:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417061",
    "user": "@jhpalmieri"
}
```

Fixing the doctest in comment:25.
----
New commits:



---

archive/issue_comments_417062.json:
```json
{
    "body": "Ah! Thank you",
    "created_at": "2020-05-27T04:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417062",
    "user": "@mkoeppe"
}
```

Ah! Thank you



---

archive/issue_comments_417063.json:
```json
{
    "body": "See #29745 for a followup. The conversion SPKG.txt -> SPKG.rst introduced some spurious blank lines and other small issues, and I've tried to fix those.",
    "created_at": "2020-05-27T18:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417063",
    "user": "@jhpalmieri"
}
```

See #29745 for a followup. The conversion SPKG.txt -> SPKG.rst introduced some spurious blank lines and other small issues, and I've tried to fix those.



---

archive/issue_comments_417064.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-05-29T21:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29396",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29396#issuecomment-417064",
    "user": "@vbraun"
}
```

Resolution: fixed
