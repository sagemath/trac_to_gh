# Issue 29396: src/doc/bootstrap: Generate list of packages (with links to documentation) for ref manual from build/pkgs

Issue created by migration from https://trac.sagemath.org/ticket/29633

Original creator: mkoeppe

Original creation time: 2020-05-02 02:37:03

CC:  jhpalmieri fbissey chapoton dimpase

We propose to generate a full list of packages that Sage uses (with links to documentation - see #27495)
for the reference manual from information in `build/pkgs`.

1. If other sources have better information than what is in `build/pkgs`, update `build/pkgs` accordingly. (See https://wiki.sagemath.org/SageWiki)

  - https://github.com/sagemath/website/blob/master/conf/packages.yaml (which is used for generating http://www.sagemath.org/links-components.html)
  - https://wiki.sagemath.org/spkg (another incomplete list of packages)

2. Create a script that formats the information as .rst 

3. Delete the obsolete other sources.


---

Comment by mkoeppe created at 2020-05-02 23:21:24

For example, I suppose we could transform the ad-hoc markup in SPKG.txt to rst and then include these files in the manual...


---

Comment by mkoeppe created at 2020-05-03 00:02:35

Hmm. is the format of SPKG.txt `mediawiki`? Then we can just convert it using pandoc
----
New commits:


---

Comment by git created at 2020-05-03 00:18:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-05-03 00:31:25

Replying to [comment:4 mkoeppe]:
> Hmm. is the format of SPKG.txt `mediawiki`? Then we can just convert it using pandoc


```
for f in build/pkgs/*/SPKG.txt; do pandoc --from=mediawiki --to=rst $f --output=$(dirname $f)/SPKG.rst; git rm -f $f; git add $(dirname $f)/SPKG.rst; done'
```


works reasonably well


---

Comment by git created at 2020-05-03 01:24:54

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-05-03 01:43:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-05-03 04:55:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-05-03 04:55:31

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-05-03 09:49:53

All hail Pandoc!


---

Comment by dimpase created at 2020-05-03 12:47:35

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2020-05-03 12:47:35

OK, this works, and looks nice in the reference manual, too.


---

Comment by mkoeppe created at 2020-05-03 15:11:13

Thanks!


---

Comment by jhpalmieri created at 2020-05-04 19:50:22

Fixes so PDF docs build.
----
New commits:


---

Comment by mkoeppe created at 2020-05-04 19:54:08

Thank you!


---

Comment by mkoeppe created at 2020-05-04 23:33:38

Merged in the new rc to resolve a merge conflict.
----
New commits:


---

Comment by mkoeppe created at 2020-05-06 06:09:22

Updated the ticket description to what is actually in the branch.

Follow-up = #29655.


---

Comment by vbraun created at 2020-05-25 22:23:04

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-05-25 22:23:04

PDF docs fail


---

Comment by vbraun created at 2020-05-25 22:27:44

Also this

```
File "src/sage/tests/cmdline.py", line 217, in sage.tests.cmdline.test_executable
Failed example:
    print(out)  # optional - build
Expected:
    Found local metadata for sqlite-...
    = SQLite =
    ...
    SQLite is a software library that implements a self-contained,
    serverless, zero-configuration, transactional SQL database engine.
    ...
Got:
    Found local metadata for sqlite-3290000
    SQLite
    ======
    <BLANKLINE>
    Description
    -----------
    <BLANKLINE>
    SQLite is a software library that implements a self-contained,
    serverless, zero-configuration, transactional SQL database engine.
    <BLANKLINE>
    License
```



---

Comment by vbraun created at 2020-05-25 22:32:33

Also unmerging this ticket breaks builds, "make clean" apparently doesn't delete the new spkg docs directory


---

Comment by jhpalmieri created at 2020-05-26 04:24:34

Replying to [comment:24 vbraun]:
> PDF docs fail

I can't reproduce this. Can you provide more details?


---

Comment by fbissey created at 2020-05-26 05:31:56

pdf failure in spkg


---

Attachment

I can reproduce the failure in sage-on-gentoo. Find the log in attachment. I also have the full generated `spkg.tex` if necessary, but this is where it fails

```
\section{Description}
\label{\detokenize{database_jones_numfield:description}}
This is a table of number fields with bounded ramification and degree
≤6.

```

it shokes on the symbol before the 6. Probably misinterpreted unicode.


---

Comment by dimpase created at 2020-05-26 07:22:31

I guess it is `≤` somewhere in the text.


```
1005	Chapter 45.
1006	! Missing $ inserted.
1007	<inserted text> 
1008	                $
1009	l.1955 ≤
1010	          6.
1011	?
1012	! Emergency stop.
1013	<inserted text> 
1014	                $
1015	l.1955 ≤
1016	          6.
```


This one?

```
$ grep -R "≤" src/doc/
src/doc/en/reference/spkg/database_jones_numfield.rst:≤6.
```


So one would need to modify this package, don't know how.


---

Comment by fbissey created at 2020-05-26 07:45:12

Yes, that one. Just replace the freaking symbol with a bit of text. 

```
lower or equal to 6.
```

there is no imperative for a symbolic short hand there.


---

Comment by dimpase created at 2020-05-26 08:05:34

well, yes, but how does one modify that `jones.sobj` which lives in the package's file, `database_jones_numfield-4.tar.gz`?


---

Comment by fbissey created at 2020-05-26 08:25:00

Ah! I see, you don't understand how this ticket works. You have to edit `build/pkg/database_jones_numfield/SPKG.rst` which contains the original offending character.


---

Comment by dimpase created at 2020-05-26 09:24:57

Replying to [comment:32 fbissey]:
> Ah! I see, you don't understand how this ticket works. You have to edit `build/pkg/database_jones_numfield/SPKG.rst` which contains the original offending character.

oops, I see. This is easy to fix indeed. Matthias, can you do this on your branch?


---

Comment by jhpalmieri created at 2020-05-26 15:30:33

Replying to [comment:17 jhpalmieri]:
> Fixes so PDF docs build.
> ----
> New commits:
> ||[8cc4f28](https://git.sagemath.org/sage.git/commit?id=8cc4f28c0a78f32ba80a504683a9c8269782a05c)||`trac 29633: fixes for PDF docbuilding`||

What happened to this commit? Please use it to fix the PDF docbuilding.


---

Comment by mkoeppe created at 2020-05-27 01:02:37

Apparently was lost in some late night merging activity


---

Comment by git created at 2020-05-27 03:58:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-05-27 03:58:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-05-27 04:00:13

Changing status from needs_work to positive_review.


---

Comment by jhpalmieri created at 2020-05-27 04:34:28

Fixing the doctest in comment:25.
----
New commits:


---

Comment by mkoeppe created at 2020-05-27 04:36:38

Ah! Thank you


---

Comment by jhpalmieri created at 2020-05-27 18:15:03

See #29745 for a followup. The conversion SPKG.txt -> SPKG.rst introduced some spurious blank lines and other small issues, and I've tried to fix those.


---

Comment by vbraun created at 2020-05-29 21:16:32

Resolution: fixed
