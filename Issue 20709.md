# Issue 20709: update giac spkg

Issue created by migration from https://trac.sagemath.org/ticket/20946

Original creator: frederichan

Original creation time: 2016-07-05 19:02:00

Keywords: giac

Update the spkg to upstream 1.2.2-67

The giac tarball built from spkg-src to put in upstream/ is there:

http://webusers.imj-prg.fr/~frederic.han/xcas/sage/giac-1.2.2.67.tar.bz2

Switch to .bz2 as wished in #18826

add --disable-ao in spkg-install to avoid libao dependency.
remove the --disable-gmpxx in spkg-install. The built seems not broken anymore.


---

Comment by leif created at 2016-07-05 20:32:37

You're not (yet?) listed [here](https://trac.sagemath.org/wiki#AccountNamesMappedtoRealNames), so hopefully I've not misspelled your name.


---

Comment by leif created at 2016-07-05 20:32:37

Changing status from new to needs_review.


---

Comment by frederichan created at 2016-07-06 07:31:43

Replying to [comment:1 leif]:
> You're not (yet?) listed [here](https://trac.sagemath.org/wiki#AccountNamesMappedtoRealNames), so hopefully I've not misspelled your name.
its done.

I need to test more. Ex:

```
Failed example:
[giacpy-0.5.6]     f=1/(5+cos(4*x));f.int(x)
[giacpy-0.5.6] Expected:
[giacpy-0.5.6]     1/2/(2*sqrt(6))*(atan(2*tan(4*x/2)/sqrt(6))+pi*floor(4*x/2/pi+1/2))
[giacpy-0.5.6] Got:
[giacpy-0.5.6]     1/2/(2*sqrt(6))*(atan((-sqrt(6)*sin(4*x)+2*sin(4*x))/(sqrt(6)*cos(4*x)+sqrt(6)-2*cos(4*x)+2))+4*x/2)
```



---

Comment by frederichan created at 2016-07-06 07:32:11

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-07-06 10:10:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-06 12:54:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2016-07-07 11:25:14

Comment 2 is not a problem. This change was done on purpose in giac, both answer are correct. giacpy-0.6 doctests can deal with both answers.

I am waiting a bit more because I have found a bug in 1.2.2.67 
http://xcas.e.ujf-grenoble.fr/XCAS/viewtopic.php?f=3&t=1731


---

Comment by git created at 2016-07-07 11:58:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2016-07-07 12:47:13

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2016-07-07 21:56:30

Darn, I have to update my ebuild for Gentoo. Since we have a `spkg-src` already should i fix it to get `lapack` in sage like I did in sage-on-gentoo or should we wait a bit?
I would also prefer if the tarball and the folder in which giacpy_sage unfold were matching the new package name.


---

Comment by git created at 2016-07-08 05:40:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2016-07-08 06:02:18

Replying to [comment:11 fbissey]:
> Darn, I have to update my ebuild for Gentoo. Since we have a `spkg-src` already should i fix it to get `lapack` in sage like I did in sage-on-gentoo or should we wait a bit?
Feel free to modify as you want, I have put it on a public branch for this. I have no news from parisse about a lapack change except the discussion on sage-devel.
> I would also prefer if the tarball and the folder in which giacpy_sage unfold were matching the new package name.
should be done now


---

Comment by fbissey created at 2016-07-08 08:46:17

Replying to [comment:14 frederichan]:
> Replying to [comment:11 fbissey]:
> > Darn, I have to update my ebuild for Gentoo. Since we have a `spkg-src` already should i fix it to get `lapack` in sage like I did in sage-on-gentoo or should we wait a bit?
> Feel free to modify as you want, I have put it on a public branch for this. I have no news from parisse about a lapack change except the discussion on sage-devel.

Yes I can do a simple thing that will work in sage as it works on gentoo since we have .pc files for blas/lapack. Probably won't work for parisse.

> > I would also prefer if the tarball and the folder in which giacpy_sage unfold were matching the new package name.
> should be done now

Thank you.


---

Comment by fbissey created at 2016-07-11 00:55:06

Hum I am unwilling to touch the `spkg-src` while I don't completely understand it. I would regenerate `Makefile.in` and co and probably wreak havoc in the current setup. Better ship it as it is now. If we really want lapack support we'll work it out later. 

Actually the current configuration will work on OS X I think and it is ok not to disable it as the runtime involved comes with the OS.

What is the last bit of `spkg-inst` supposed to do?

```
# create the script_subdirectory for the pexpect giac interface by running a trivial instruction
sage -c "giac(1)"
if [ $? -ne 0 ]; then
    echo >&2 "Error running the pexpect interface of giac"
    exit 1
fi
```

Where is the directory supposed to be created? I cannot see anything new when I run `./sage -p giac` with this branch. I was, possibly, expecting something in `local/share/sage/ext` but found nothing there.
Running `./sage -c "giac(1)"` manually afterwards didn't have an impact either.


---

Comment by frederichan created at 2016-07-11 09:20:42

Replying to [comment:16 fbissey]:
> Hum I am unwilling to touch the `spkg-src` while I don't completely understand it. I would regenerate `Makefile.in` and co and probably wreak havoc in the current setup. Better ship it as it is now. If we really want lapack support we'll work it out later. 
> 
> Actually the current configuration will work on OS X I think and it is ok not to disable it as the runtime involved comes with the OS.
> 
> What is the last bit of `spkg-inst` supposed to do?
> {{{
> # create the script_subdirectory for the pexpect giac interface by running a trivial instruction
> sage -c "giac(1)"
> if [ $? -ne 0 ]; then
>     echo >&2 "Error running the pexpect interface of giac"
>     exit 1
> fi
> }}}
> Where is the directory supposed to be created? I cannot see anything new when I run `./sage -p giac` with this branch. I was, possibly, expecting something in `local/share/sage/ext` but found nothing there.
> Running `./sage -c "giac(1)"` manually afterwards didn't have an impact either.

Indeed It looks obsolete. may by since #17044. Moreover I think that it is the only dependency of SAGE_RUNTIMES cf #19672 comment 6 and jeroen answer. I am trying to remove both.


---

Comment by git created at 2016-07-11 11:33:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-11 12:21:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-09-14 10:02:46

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-09-14 10:02:46

The branch no longer applies.


---

Comment by git created at 2016-09-14 13:55:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-09-22 18:34:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by frederichan created at 2016-09-22 18:45:30

Changing status from needs_work to needs_review.


---

Comment by rws created at 2016-09-29 14:34:21

Passes `make ptestlong` with `optional=atlas,ccache,giac,git_trac,mpir,python2,sage` on a system where the old version was installed. I don't think there is something amiss in the package updates. Anyway it's an optional package and an improvement so I'll set positive.


---

Comment by rws created at 2016-09-29 14:34:21

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-09-30 11:28:56

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2016-09-30 11:28:56

This conflicts with blocker ticket #21441, please rebase on top of that.


---

Comment by git created at 2016-10-01 07:33:01

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by frederichan created at 2016-10-01 22:57:11

So I have rebased on u/jdemeyer/sage-pip-install


---

Comment by frederichan created at 2016-10-01 22:57:11

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-10-19 14:04:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2016-10-20 06:32:05

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2016-10-20 06:32:05

I am not sure why this is not back to positive review. Let's try again.


---

Comment by vbraun created at 2016-10-21 07:03:41

Resolution: fixed
