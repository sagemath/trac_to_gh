# Issue 30096: Strange KeyError when constructing padic extension

Issue created by migration from https://trac.sagemath.org/ticket/30333

Original creator: @oriparzan

Original creation time: 2020-08-11 11:26:59

Keywords: unramified extension, padics

Constructing an unramified extension of a "q-adic field" raises a weird error.


```
sage: F.<a> = Qq(125)
sage: L.<b> = F.ext(x^2-6) # general polynomial - not supported (that's fine)
---------------------------------------------------------------------------
NotImplementedError: Extensions by general polynomials not yet supported.  Please use an unramified or Eisenstein polynomial.

sage: L.<b> = F.ext(x^2-5)  # Eisentein extension, works fine
sage: L.<b> = F.ext(x^2-7)  # Unramified extension - error!
---------------------------------------------------------------------------
KeyError                                  Traceback (most recent call last)
<ipython-input-111-0d44e0a3a3fc> in <module>()
----> 1 L = F.ext(x**Integer(2)-Integer(7), names=('b',)); (b,) = L._first_ngens(1)

/home/parzan/sage/local/lib/python3.7/site-packages/sage/rings/padics/local_generic.py in ext(self, *args, **kwds)
   1050             t + O(t^21)
   1051         """
-> 1052         return self.extension(*args, **kwds)
   1053 
   1054     def _test_add_bigoh(self, **options):

/home/parzan/sage/local/lib/python3.7/site-packages/sage/rings/padics/padic_generic.py in extension(self, modulus, prec, names, print_mode, implementation, **kwds)
    689                     else:
    690                         print_mode[option] = self._printer.dict()[option]
--> 691         return ExtensionFactory(base=self, modulus=modulus, prec=prec, names=names, check = True, implementation=implementation, **print_mode)
    692 
    693     def _is_valid_homomorphism_(self, codomain, im_gens, base_map=None):

/home/parzan/sage/local/lib/python3.7/site-packages/sage/structure/factory.pyx in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2259)()
    367         key, kwds = self.create_key_and_extra_args(*args, **kwds)
    368         version = self.get_version(sage_version)
--> 369         return self.get_object(version, key, kwds)
    370 
    371     cpdef get_object(self, version, key, extra_args):

/home/parzan/sage/local/lib/python3.7/site-packages/sage/structure/factory.pyx in sage.structure.factory.UniqueFactory.get_object (build/cythonized/sage/structure/factory.c:2653)()
    410         except KeyError:
    411             pass
--> 412         obj = self.create_object(version, key, **extra_args)
    413         self._cache[version, cache_key] = obj
    414         try:

/home/parzan/sage/local/lib/python3.7/site-packages/sage/rings/padics/factory.py in create_object(self, version, key, approx_modulus, shift_seed)
   3087         if polytype == 'p':
   3088             raise NotImplementedError("Extensions by general polynomials not yet supported.  Please use an unramified or Eisenstein polynomial.")
-> 3089         T = ext_table[polytype, type(base.ground_ring_of_tower()).__base__]
   3090         return T(exact_modulus, approx_modulus, prec,
   3091                  {'mode': print_mode, 'pos': print_pos, 'sep': print_sep, 'alphabet': print_alphabet,

KeyError: ('ru', <class 'sage.rings.padics.padic_base_leaves.pAdicFieldCappedRelative'>)


```




---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.
