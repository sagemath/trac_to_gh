# Issue 24386: Euclidean spaces and vector calculus

Issue created by migration from Trac.

Original creator: egourgoulhon

Original creation time: 2018-01-31 10:08:34

CC:  tmonteil

Keywords: Euclidean space, vector calculus, gradient, divergence, curl, Laplacian

This ticket implements Euclidean spaces as Riemannian manifolds diffeomorphic to *R*<sup>n</sup> and equipped with a flat metric. Using the operators introduced in #24622, it provides the standard operators of vector calculus: dot product, norm, cross product, gradient, divergence, curl and Laplacian, along with the standard coordinate systems (Cartesian, spherical, cylindrical, etc.).


---

Comment by egourgoulhon created at 2018-02-16 17:02:18

This is a first sketch (not ready yet).
----
Last 10 new commits:


---

Comment by egourgoulhon created at 2018-02-20 15:33:10

#24792 introduces more flexibility in naming the elements of vector frames, for instance using `(e_x, e_y, e_z)` for a coordinate frame instead of `(d/dx, d/dy, d/dz)`. The current ticket will therefore be build on it for a better user interface.


---

Comment by git created at 2018-02-20 16:02:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-02-21 16:43:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2018-02-21 22:01:18

I wonder whether some of this (in terms of the div/grad/curl) could be exposed in the symbolic calculus places, at least with some well-placed and well-formed examples that would be understandable to someone teaching Calc III to engineers (in the US framework) who may not be a differential geometer.


---

Comment by egourgoulhon created at 2018-02-21 23:47:02

Replying to [comment:8 kcrisman]:
> I wonder whether some of this (in terms of the div/grad/curl) could be exposed in the symbolic calculus places, at least with some well-placed and well-formed examples that would be understandable to someone teaching Calc III to engineers (in the US framework) who may not be a differential geometer.

Indeed, the aim here is to provide some interface which does not require any knowledge of differential geometry on manifolds. The class `EuclideanSpaceGeneric` does inherit from `PseudoRiemannianManifold`, but the end user has not to know it if he is not interested by this aspect and prefers to focus on vector calculus. Regarding examples, I plan to prepare some Jupyter notebooks and will expose them here, when the ticket is ready for review. Already, you can have a glimpse of the div/grad/curl capabilities introduced in the dependency #24622 in [this notebook](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/vector_calculus.ipynb).


---

Comment by kcrisman created at 2018-02-22 12:53:52

That's great!  The reason I brought it up is because folders like `sage/calculus` and `sage/symbolic` might benefit from some good examples that are easy to find.

Is there a way to use something like (say) `vector([x<sup>2+y,y</sup>2+z,z^2+x])` as  "vector field" immediately, without much (or any) of the formalism necessary in that notebook?  I think that is how most end users I've talked to about this issue would want it.  See e.g. https://ask.sagemath.org/question/10104/gradient-divergence-curl-and-vector-products/ and ticket:3021 for one version already in Sage - maybe these should be combined somehow, if possible.


---

Comment by egourgoulhon created at 2018-02-22 22:06:33

Replying to [comment:10 kcrisman]:
> 
> Is there a way to use something like (say) `vector([x<sup>2+y,y</sup>2+z,z^2+x])` as  "vector field" immediately, without much (or any) of the formalism necessary in that notebook?  

Yes, this is precisely the aim of the current ticket. The above notebook is still at the level of semi-Riemannian manifolds (i.e. it illustrates only ticket #24622), while the user interface of the current ticket will be much simpler. It should also provide an easy way to change from Cartesian coordinates to e.g. polar or cylindrical ones. 


>See e.g. https://ask.sagemath.org/question/10104/gradient-divergence-curl-and-vector-products/ and ticket:3021 for one version already in Sage - maybe these should be combined somehow, if possible.

Thanks for pointing this version; I was not aware of it.


---

Comment by git created at 2018-02-27 21:09:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-02 17:28:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-03-02 17:43:35

Here is some status update: functionalities regarding the 2-dimensional case are almost complete, as you can see in this [demo worksheet](http://nbviewer.jupyter.org/github/egourgoulhon/SageMathTest/blob/master/Worksheets/Euclidean_plane.ipynb) (any feedback is of course appreciated). The 3-dimensional case is under preparation. The generic n-dimensional case, with n=1 or n>=4 is ready, since only Cartesian coordinates will be introduced (by default) in this case. 

Regarding a question raised in comment:10, it is now possible to construct a vector field on an Euclidean space from a `vector` of symbolic expressions like this:

```
v = E.vector_field(vector([-y,x]))
```

where `E` is the underlying Euclidean space.


---

Comment by git created at 2018-03-06 17:29:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-07 16:24:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-08 17:31:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-09 15:54:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-11 23:10:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-13 15:09:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-13 16:32:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-13 23:39:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-03-14 09:50:06

The documentation has been completed in the above commits and new Jupyter notebook examples have been added. This is now ready for review.


---

Comment by egourgoulhon created at 2018-03-14 09:50:06

Changing status from new to needs_review.


---

Comment by egourgoulhon created at 2018-03-14 10:21:33

Replying to [comment:8 kcrisman]:
> I wonder whether some of this (in terms of the div/grad/curl) could be exposed in the symbolic calculus places, at least with some well-placed and well-formed examples that would be understandable to someone teaching Calc III to engineers (in the US framework) who may not be a differential geometer.

I have added an entry "Vector Calculus" to `src/doc/en/reference/calculus/index.rst`. I have also added some `SEEALSO` sections in the definitions of `curl` and `div` in `src/sage/modules/free_module_element.pyx`, as well as in the definition of `gradient` in `src/sage/symbolic/expression.pyx`.


---

Comment by git created at 2018-04-27 05:13:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-27 05:47:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-04-27 05:51:45

Okay, I have made my way through the code. Overall, it looks good.

I remove the function `EuclideanSpace` and just used the `__classcall_private__` mechanism (provided by `UniqueRepresentation`) to make the class `EuclideanSpace` (formerly `EuclideanSpaceGeneric`) the main entry point.

There is something very subtle happening as _some_ of the doctest output for display names of `arctan2(y, x)` needed to be `arctan(y/x)`. I do not understand why nor could I see what was causing this. It is not a blocker issue, but it is an indication that something might not be working properly.

The rest of my changes were mostly cosmetic.


---

Comment by egourgoulhon created at 2018-04-28 08:58:06

Replying to [comment:31 tscrim]:
> Okay, I have made my way through the code. Overall, it looks good.

Thanks a lot for looking into this.
> 
> I remove the function `EuclideanSpace` and just used the `__classcall_private__` mechanism (provided by `UniqueRepresentation`) to make the class `EuclideanSpace` (formerly `EuclideanSpaceGeneric`) the main entry point.

This is a nice improvement, thanks!
> 
> There is something very subtle happening as _some_ of the doctest output for display names of `arctan2(y, x)` needed to be `arctan(y/x)`. I do not understand why nor could I see what was causing this. It is not a blocker issue, but it is an indication that something might not be working properly.
>

Indeed; I will look into this...
 
> The rest of my changes were mostly cosmetic.

Thanks for all of them.


---

Comment by tscrim created at 2018-04-28 09:35:37

I should also say that if you approve of my changes, then you can set a positive review.

(Unfortunately, a number of the doctests are just slow because of feeding calls off to Maxima and the simplifications. Although I don't think there is anything we can do about that.)


---

Comment by git created at 2018-04-30 16:15:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-04-30 16:36:15

The above commit fixes the `arctan` issue mentioned in comment:31: it was due to the declaration 

```
sage: E3.<x,t,p> = EuclideanSpace(coordinates='spherical')
```

in line 591 of `euclidean.py`, which had the side effect of adding `x>0` to Sage's assumptions. Then subsequent doctests involving `arctan2(y, x)` automatically replaced it by `arctan(y/x)`. I changed the variable `x` to `r` in the declaration of `E3` (which btw fits better with standard notation for spherical coordinates) and everything was OK, i.e. all `arctan2(y, x)` could be restored. 

Moreover, since it is now possible to skip the dimension as first argument of `EuclideanSpace` in constructions of the type `E.<x,y> = EuclideanSpace()` (thank you for this improvement!), I systematically removed the dimension argument and added a sentence in the documentation about this. 

I also took the opportunity of this commit to add a [single-line fix](https://git.sagemath.org/sage.git/diff/src/sage/manifolds/differentiable/vectorfield_module.py?id=220726c07bc00ba69b12a5cc7dc9499d930f1e8c) of a (small) bug in `src/sage/manifolds/differentiable/vectorfield_module.py` revealed after the dependency ticket #24792 was merged. I hope you do not mind.


---

Comment by tscrim created at 2018-04-30 22:54:47

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-04-30 22:54:47

Yep, LGTM. Thank you for tracking that down.


---

Comment by egourgoulhon created at 2018-05-01 10:23:51

Replying to [comment:36 tscrim]:
> Yep, LGTM. Thank you for tracking that down.

Thank you very much for the review, and the associated improvements in the code!


---

Comment by vbraun created at 2018-05-08 17:26:32

Resolution: fixed


---

Comment by slelievre created at 2018-05-12 21:47:25

Merged in Sage 8.3.beta0.
