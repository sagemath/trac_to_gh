# Issue 24714: Use nauty as the default generator for graphs

Issue created by migration from https://trac.sagemath.org/ticket/24951

Original creator: jmantysalo

Original creation time: 2018-03-12 08:25:37

CC:  slelievre

This patch will make plain `graphs(n)` to use nauty. Otherwise, for example if user uses `size` option or similar, old behavior is continued.


---

Comment by jmantysalo created at 2018-03-12 08:34:09

Before the patch it takes about 40 seconds to run `sum(1 for g in graphs(8) if g.is_connected())`. After the patch it is about half of a second.
----
New commits:


---

Comment by jmantysalo created at 2018-03-12 08:34:09

Changing status from new to needs_review.


---

Comment by slelievre created at 2018-03-13 09:36:06

Not committing to a full review of this ticket, but just pointing out
a typo: hamiltionian -> hamiltonian.

Also not sure about the change to the pre-existing doctest


```
Use ``graphs(n)`` to iterate through all non-isomorphic graphs of given size::

    sage: for g in graphs(4):
    ....:     print(g.spectrum())
```


which checked that we get 11 graphs on 4 vertices, and that they are
pairwise non-isomorphic (since their spectra are). The proposed
replacement doctest does not illustrate that.


---

Comment by git created at 2018-03-13 10:15:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2018-03-13 10:21:12

Replying to [comment:3 slelievre]:
> Not committing to a full review of this ticket, but just pointing out
> a typo: hamiltionian -> hamiltonian.

Thanks, corrected.

> Also not sure about the change to the pre-existing doctest
> which checked that we get 11 graphs on 4 vertices, and that they are
> pairwise non-isomorphic (since their spectra are). The proposed
> replacement doctest does not illustrate that.

It's too long for that, a user won't easily see if there are duplicates or not. But better example would be nice.


---

Comment by slelievre created at 2018-03-19 04:37:38

How about something like the following,


```
sage: for g in graphs(4):
....:     print((g.num_edges(), [g.degree(v) for v in g]))
....:     
(0, [0, 0, 0, 0])
(1, [1, 1, 0, 0])
(2, [2, 1, 1, 0])
(3, [2, 2, 2, 0])
(3, [3, 1, 1, 1])
(2, [1, 1, 1, 1])
(3, [2, 1, 2, 1])
(4, [2, 2, 3, 1])
(4, [2, 2, 2, 2])
(5, [2, 3, 3, 2])
(6, [3, 3, 3, 3])
```


inspired by the answers to this math.stackexchange question:
- https://math.stackexchange.com/questions/583870/how-many-four-vertex-graphs-are-there-up-to-isomorphism


---

Comment by git created at 2018-03-19 08:19:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2018-03-19 08:21:02

Replying to [comment:6 slelievre]:
> How about something like the following,
> 
> {{{
> sage: for g in graphs(4):
> ....:     print((g.num_edges(), [g.degree(v) for v in g]))
> }}}

Good idea, I used that but `degree_sequence()` instead of manual degree list.


---

Comment by dcoudert created at 2018-04-11 12:46:00

Why do you need to pass `property=lambda _: True` when calling `graph_gen` ? It's the default value of `property` in `graphs`, right ?


---

Comment by jmantysalo created at 2018-04-12 03:54:45

Replying to [comment:9 dcoudert]:
> Why do you need to pass `property=lambda _: True` when calling `graph_gen` ? It's the default value of `property` in `graphs`, right ?

It is the way to use "old" generator for testing purposes. Otherwise nauty will be used.


---

Comment by dcoudert created at 2018-04-12 05:43:39

Ok, understood.

There are some failing doctests in `src/sage/graphs/graph.py` and other files (see the patchbot).


---

Comment by git created at 2018-04-12 06:12:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-12 07:18:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jmantysalo created at 2018-04-12 07:20:55

Replying to [comment:11 dcoudert]:

> There are some failing doctests in `src/sage/graphs/graph.py` and other files (see the patchbot).

Should work now.

(The same problem again... A vertex has set of neighbors, not a list on neighbors. Sometimes there is no way to make good and clear, but also testable, examples.)


---

Comment by dcoudert created at 2018-04-13 12:00:08

For me this patch is now good to go.


---

Comment by dcoudert created at 2018-04-13 12:00:08

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-04-14 09:40:08

missing reviewer's name


---

Comment by vbraun created at 2018-05-12 11:47:47

Resolution: fixed
