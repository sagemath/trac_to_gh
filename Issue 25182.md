# Issue 25182: py3: remove one __cmp__ in linear functions

Issue created by migration from https://trac.sagemath.org/ticket/25419

Original creator: chapoton

Original creation time: 2018-05-21 18:42:18

CC:  embray jdemeyer tscrim fbissey

part of #16537


---

Comment by chapoton created at 2018-05-21 18:42:55

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-05-21 18:42:55

New commits:


---

Comment by chapoton created at 2018-05-21 18:43:53

Changing keywords from "" to "python3, richcmp".


---

Comment by chapoton created at 2018-05-22 08:51:03

bot is morally green. The timeout doctest failure in padics is seen on every ticket with this patchbot.


---

Comment by jdemeyer created at 2018-05-22 20:44:41

I'm a bit worried because this will break some of the doctests

```
            sage: len(set([f, f]))
            1
            sage: len(set([f, f+0]))
            2
            sage: len(set([f, f+1]))
            2
```

so it's not just a harmless change, it actually changes functionality.

To be honest, I don't know how to fix that. So maybe we should just live with it. In that case, we should at least _document_ it though.


---

Comment by chapoton created at 2018-05-23 09:50:30

Not on holidays, Jeroen ? :)

Well, the way this class uses richcmp makes comparison fundamentally broken.

If you have any idea on how best to deal with that, please take over.


---

Comment by embray created at 2018-05-23 13:32:55

This change doesn't actually appear to break any of those tests.  If nothing else you might keep the tests in a `TESTS:` block somewhere in the class.  But otherwise this `__cmp__` appears to be superfluous.


---

Comment by git created at 2018-05-23 13:49:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2018-05-23 13:50:47

I have added back these doctests.


---

Comment by chapoton created at 2018-06-01 11:55:19

ping ?


---

Comment by embray created at 2018-06-01 22:23:25

There's some patchbot failures, but, it looks more like broken patchbots...


---

Comment by chapoton created at 2018-06-07 06:14:24

ping ? (green bots on 8.3.b4)


---

Comment by chapoton created at 2018-06-11 12:14:00

Jeroen, your opinion please ?


---

Comment by jdemeyer created at 2018-06-11 15:17:18

The reason that the `set()` tests still pass is because hashing is by id. So that's actually a good thing because the bogus `__richcmp__` is then not an obstruction for using linear functions as dict key.

So I agree with this ticket, provided that some docs and comments are updated. I'll do that myself.


---

Comment by jdemeyer created at 2018-06-11 15:17:18

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-06-11 15:25:39

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2018-06-11 15:26:08

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-06-11 15:26:08

Last commit needs review.


---

Comment by chapoton created at 2018-06-11 18:09:46

ok, good for me. Let us wait for the patchbot approval


---

Comment by chapoton created at 2018-06-12 19:01:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-14 07:41:07

Resolution: fixed
