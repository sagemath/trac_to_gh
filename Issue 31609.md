# Issue 31609: Improve pexpect interface to Singular

Issue created by migration from https://trac.sagemath.org/ticket/31846

Original creator: slelievre

Original creation time: 2021-05-22 17:10:14

CC:  chapoton dimpase egourgoulhon embray fbissey mkoeppe slelievre tmonteil tscrim

From #30945.


---

Comment by chapoton created at 2021-07-11 19:21:50

Changing status from new to needs_review.


---

Comment by tscrim created at 2021-07-11 23:19:34

Doctest failure also reported by the patchbot:

```
sage -t --random-seed=0 src/sage/interfaces/expect.py
**********************************************************************
File "src/sage/interfaces/expect.py", line 921, in sage.interfaces.expect.Expect._eval_line
Failed example:
    singular('2+3')
Expected:
    5
Got:
    Singular crashed -- automatically restarting.
    5
**********************************************************************
1 item had failures:
   1 of  16 in sage.interfaces.expect.Expect._eval_line
    [101 tests, 1 failure, 2.92 s]
----------------------------------------------------------------------
sage -t --random-seed=0 src/sage/interfaces/expect.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

Comment by tscrim created at 2021-07-11 23:19:34

Changing status from needs_review to needs_work.


---

Comment by git created at 2021-07-29 08:10:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2021-07-29 08:14:30

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2021-07-29 08:14:30

I have fixed the doctest.


---

Comment by dimpase created at 2021-07-29 15:39:25

lgtm


---

Comment by dimpase created at 2021-07-29 15:39:25

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-08-29 09:36:44

Resolution: fixed


---

Comment by tornaria created at 2022-12-15 15:13:31

What does this improve? Will something break if I revert it?

I ask because:
 - I think this change might be the cause of #33907
 - Also, this change makes singular restart every time `singular.interrupt()` is called. I think that is what the doctest failure in comment:3 above is telling us. I think other interfaces do not restart after `interrupt()`.
 - comments in #30945 seem to give the impression that it was already fixed by the upgrade of cysignals; was this change really needed to fix or improve something?
