# Issue 27432: fixing an error in shortest_path in c_graph

archive/issues_027432.json:
```json
{
    "body": "CC:  @dcoudert\n\nThe algorithm broke many time due to the presence of following bug which is fixed by this ticket.\n\n> {{{#!diff\n> -                        next_current.append(v)\n> +                        next_temporary.append(v)\n>}}}\n\nIssue created by migration from https://trac.sagemath.org/ticket/27669\n\n",
    "created_at": "2019-04-15T13:16:21Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "fixing an error in shortest_path in c_graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27432",
    "user": "@rajat1433"
}
```
CC:  @dcoudert

The algorithm broke many time due to the presence of following bug which is fixed by this ticket.

> {{{#!diff
> -                        next_current.append(v)
> +                        next_temporary.append(v)
>}}}

Issue created by migration from https://trac.sagemath.org/ticket/27669





---

archive/issue_comments_386725.json:
```json
{
    "body": "Set assignee to @rajat1433.",
    "created_at": "2019-04-15T13:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386725",
    "user": "@rajat1433"
}
```

Set assignee to @rajat1433.



---

archive/issue_comments_386726.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-15T13:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386726",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_386727.json:
```json
{
    "body": "can you give an example raising an error ?",
    "created_at": "2019-04-15T13:36:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386727",
    "user": "@dcoudert"
}
```

can you give an example raising an error ?



---

archive/issue_comments_386728.json:
```json
{
    "body": "It will not give wrong results as the next_current list will keep on populating till we reach the target node in bfs but the problem is it will not be the bidirectional bfs as claimed by this method. I used the word broke in ticket description because I was doing some changes and it broke due to this bug. Maybe I will need to modify the ticket description.",
    "created_at": "2019-04-15T13:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386728",
    "user": "@rajat1433"
}
```

It will not give wrong results as the next_current list will keep on populating till we reach the target node in bfs but the problem is it will not be the bidirectional bfs as claimed by this method. I used the word broke in ticket description because I was doing some changes and it broke due to this bug. Maybe I will need to modify the ticket description.



---

archive/issue_comments_386729.json:
```json
{
    "body": "Yes, you must explain what's going on and why is this change needed.",
    "created_at": "2019-04-15T14:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386729",
    "user": "@dcoudert"
}
```

Yes, you must explain what's going on and why is this change needed.



---

archive/issue_comments_386730.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-15T14:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386730",
    "user": "@rajat1433"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_386731.json:
```json
{
    "body": "Another issue is that list `next_current` is modified inside a `for u in next_current:` loop (see copy/paste below). Clearly not good. So I agree with this change.\n\n\n```\n            for u in next_current:\n                if out == 1:\n                    neighbors = self._cg.out_neighbors(u)\n                elif self._cg_rev is not None: # Sparse\n                    neighbors = self._cg_rev.out_neighbors(u)\n                else: # Dense\n                    neighbors = self._cg.in_neighbors(u)\n                for v in neighbors:\n                    # If the neighbor is new, updates the distances and adds\n                    # to the list.\n                    if v not in dist_current:\n                        dist_current[v] = dist_current[u] + 1\n                        if not distance_flag:\n                            pred_current[v] = u\n                        next_current.append(v)\n```\n",
    "created_at": "2019-04-15T14:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386731",
    "user": "@dcoudert"
}
```

Another issue is that list `next_current` is modified inside a `for u in next_current:` loop (see copy/paste below). Clearly not good. So I agree with this change.


```
            for u in next_current:
                if out == 1:
                    neighbors = self._cg.out_neighbors(u)
                elif self._cg_rev is not None: # Sparse
                    neighbors = self._cg_rev.out_neighbors(u)
                else: # Dense
                    neighbors = self._cg.in_neighbors(u)
                for v in neighbors:
                    # If the neighbor is new, updates the distances and adds
                    # to the list.
                    if v not in dist_current:
                        dist_current[v] = dist_current[u] + 1
                        if not distance_flag:
                            pred_current[v] = u
                        next_current.append(v)
```




---

archive/issue_comments_386732.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-15T14:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386732",
    "user": "@dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_386733.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-16T21:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27432#issuecomment-386733",
    "user": "@vbraun"
}
```

Resolution: fixed
