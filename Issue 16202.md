# Issue 16202: Allow inverse trig functions to all take complex input

archive/issues_016202.json:
```json
{
    "body": "CC:  burcin\n\nWhere by complex I mean `complex` Python type.\n\n```\nsage: arccos(1+2*i)\narccos(2*I + 1)\nsage: arccos(CC(1,2))\n1.14371774040242 - 1.52857091948100*I\nsage: arccos(CDF(1,2))\n1.1437177404 - 1.52857091948*I\nsage: arccos(complex(1,2))\n<snip>\nTypeError: Unable to convert x (='(1+2j)') to real number.\n```\n\nPresumably there are others of this type.  Related:\n\n```\n\nsage: arcsec(-0.992725195401)\nNaN\nsage: arcsec(float(-0.992725195401))\n<snip>\n    732         if parent is float:\n    733             return math.acos(1/x)\n--> 734         return (1/x).arccos()\n    735 \n    736     def _eval_numpy_(self, x):\n\nAttributeError: 'complex' object has no attribute 'arccos'\n```\n\nbut this may or may not be dealt with at #13246.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16439\n\n",
    "created_at": "2014-06-04T13:28:05Z",
    "labels": [
        "symbolics",
        "minor",
        "bug"
    ],
    "title": "Allow inverse trig functions to all take complex input",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16202",
    "user": "kcrisman"
}
```
CC:  burcin

Where by complex I mean `complex` Python type.

```
sage: arccos(1+2*i)
arccos(2*I + 1)
sage: arccos(CC(1,2))
1.14371774040242 - 1.52857091948100*I
sage: arccos(CDF(1,2))
1.1437177404 - 1.52857091948*I
sage: arccos(complex(1,2))
<snip>
TypeError: Unable to convert x (='(1+2j)') to real number.
```

Presumably there are others of this type.  Related:

```

sage: arcsec(-0.992725195401)
NaN
sage: arcsec(float(-0.992725195401))
<snip>
    732         if parent is float:
    733             return math.acos(1/x)
--> 734         return (1/x).arccos()
    735 
    736     def _eval_numpy_(self, x):

AttributeError: 'complex' object has no attribute 'arccos'
```

but this may or may not be dealt with at #13246.

Issue created by migration from https://trac.sagemath.org/ticket/16439





---

archive/issue_comments_211539.json:
```json
{
    "body": "Why don't complex numbers have these attributes? This should be possible - for example wolfram alpha [gives a value](http://www.wolframalpha.com/input/?i=acos%281%2F%28-0.9+%2B+i%29%29) for `acos(-0.9+i)`.\n\nI think the computations should be performed using `CDF` and then coerced back to `complex`. Complex output from these functions should be handled by the plot function separately.",
    "created_at": "2014-06-05T03:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211539",
    "user": "ppurka"
}
```

Why don't complex numbers have these attributes? This should be possible - for example wolfram alpha [gives a value](http://www.wolframalpha.com/input/?i=acos%281%2F%28-0.9+%2B+i%29%29) for `acos(-0.9+i)`.

I think the computations should be performed using `CDF` and then coerced back to `complex`. Complex output from these functions should be handled by the plot function separately.



---

archive/issue_comments_211540.json:
```json
{
    "body": "> Why don't complex numbers have these attributes? This should be possible - for example wolfram alpha [gives a value](http://www.wolframalpha.com/input/?i=acos%281%2F%28-0.9+%2B+i%29%29) for `acos(-0.9+i)`.\nComplex number *do* have these attributes, just not the minimalist `complex` Python data type.\n\n```\nsage: a = complex(1,1)\nsage: a.[tab]\na.conjugate  a.imag       a.real       \nsage: a._[tab]\na.__abs__           a.__hash__          a.__rdivmod__\na.__add__           a.__init__          a.__reduce__\na.__class__         a.__int__           a.__reduce_ex__\na.__coerce__        a.__le__            a.__repr__\na.__delattr__       a.__long__          a.__rfloordiv__\na.__div__           a.__lt__            a.__rmod__\na.__divmod__        a.__mod__           a.__rmul__\na.__doc__           a.__mul__           a.__rpow__\na.__eq__            a.__ne__            a.__rsub__\na.__float__         a.__neg__           a.__rtruediv__\na.__floordiv__      a.__new__           a.__setattr__\na.__format__        a.__nonzero__       a.__sizeof__\na.__ge__            a.__pos__           a.__str__\na.__getattribute__  a.__pow__           a.__sub__\na.__getnewargs__    a.__radd__          a.__subclasshook__\na.__gt__            a.__rdiv__          a.__truediv__\n```\n\nAnd the built-in `math` module doesn't do `arcsec`\n\n```\nsage: math.a[tab]\nmath.acos   math.asin   math.atan   math.atanh  \nmath.acosh  math.asinh  math.atan2  \n```\n\nand even then only takes ones with real output\n\n```\nsage: math.acos(1)\n0.0\nsage: math.acos(2)\nValueError: math domain error\nsage: math.acos(a)\nTypeError: can't convert complex to float\n```\n\n> I think the computations should be performed using `CDF` and then coerced back to `complex`. Complex output from these functions should be handled by the plot function separately.\nMaybe.  Is `CDF` basically the same as `complex`?  Is there precedent for this?",
    "created_at": "2014-06-05T12:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211540",
    "user": "kcrisman"
}
```

> Why don't complex numbers have these attributes? This should be possible - for example wolfram alpha [gives a value](http://www.wolframalpha.com/input/?i=acos%281%2F%28-0.9+%2B+i%29%29) for `acos(-0.9+i)`.
Complex number *do* have these attributes, just not the minimalist `complex` Python data type.

```
sage: a = complex(1,1)
sage: a.[tab]
a.conjugate  a.imag       a.real       
sage: a._[tab]
a.__abs__           a.__hash__          a.__rdivmod__
a.__add__           a.__init__          a.__reduce__
a.__class__         a.__int__           a.__reduce_ex__
a.__coerce__        a.__le__            a.__repr__
a.__delattr__       a.__long__          a.__rfloordiv__
a.__div__           a.__lt__            a.__rmod__
a.__divmod__        a.__mod__           a.__rmul__
a.__doc__           a.__mul__           a.__rpow__
a.__eq__            a.__ne__            a.__rsub__
a.__float__         a.__neg__           a.__rtruediv__
a.__floordiv__      a.__new__           a.__setattr__
a.__format__        a.__nonzero__       a.__sizeof__
a.__ge__            a.__pos__           a.__str__
a.__getattribute__  a.__pow__           a.__sub__
a.__getnewargs__    a.__radd__          a.__subclasshook__
a.__gt__            a.__rdiv__          a.__truediv__
```

And the built-in `math` module doesn't do `arcsec`

```
sage: math.a[tab]
math.acos   math.asin   math.atan   math.atanh  
math.acosh  math.asinh  math.atan2  
```

and even then only takes ones with real output

```
sage: math.acos(1)
0.0
sage: math.acos(2)
ValueError: math domain error
sage: math.acos(a)
TypeError: can't convert complex to float
```

> I think the computations should be performed using `CDF` and then coerced back to `complex`. Complex output from these functions should be handled by the plot function separately.
Maybe.  Is `CDF` basically the same as `complex`?  Is there precedent for this?



---

archive/issue_comments_211541.json:
```json
{
    "body": "Replying to [comment:2 kcrisman]:\n> > I think the computations should be performed using `CDF` and then coerced back to `complex`. Complex output from these functions should be handled by the plot function separately.\n> Maybe.  Is `CDF` basically the same as `complex`?  Is there precedent for this?\n\nI do not know a precedent, but we will not be losing anything from doing this. The Python `complex` number comprises of two floating point numbers which are implemented as `double` in C - see [this documentation](https://docs.python.org/2/library/stdtypes.html#numeric-types-int-float-long-complex). The `CDF` in Sage also use double precision floating point numbers.\n\n```\nsage: CDF.precision()\n53\n\n# Following the documentation at\n# https://docs.python.org/2/library/sys.html#sys.float_info\nsage: import sys\nsage: sys.float_info.mant_dig\n53\n```\n",
    "created_at": "2014-06-06T07:19:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211541",
    "user": "ppurka"
}
```

Replying to [comment:2 kcrisman]:
> > I think the computations should be performed using `CDF` and then coerced back to `complex`. Complex output from these functions should be handled by the plot function separately.
> Maybe.  Is `CDF` basically the same as `complex`?  Is there precedent for this?

I do not know a precedent, but we will not be losing anything from doing this. The Python `complex` number comprises of two floating point numbers which are implemented as `double` in C - see [this documentation](https://docs.python.org/2/library/stdtypes.html#numeric-types-int-float-long-complex). The `CDF` in Sage also use double precision floating point numbers.

```
sage: CDF.precision()
53

# Following the documentation at
# https://docs.python.org/2/library/sys.html#sys.float_info
sage: import sys
sage: sys.float_info.mant_dig
53
```




---

archive/issue_comments_211542.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-06T09:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211542",
    "user": "ppurka"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_211543.json:
```json
{
    "body": "The following functions are not fixed: `atan, acos, asin` because I am not very sure how they get evaluated. I have fixed the other functions to take `complex` type as input.\n\nNow, on to the plot ticket to check the output `*phew*`\n----\nNew commits:",
    "created_at": "2014-06-06T09:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211543",
    "user": "ppurka"
}
```

The following functions are not fixed: `atan, acos, asin` because I am not very sure how they get evaluated. I have fixed the other functions to take `complex` type as input.

Now, on to the plot ticket to check the output `*phew*`
----
New commits:



---

archive/issue_comments_211544.json:
```json
{
    "body": "> The following functions are not fixed: `atan, acos, asin` because I am not very sure how they get evaluated. I have fixed the other functions to take `complex` type as input.\nYou'll notice that [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/trig.py#n562)\n\n```\narctan = atan = Function_arctan()\n```\n\nso `atan` is exactly the same as `arctan` - one fix works for both!",
    "created_at": "2014-06-06T13:18:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211544",
    "user": "kcrisman"
}
```

> The following functions are not fixed: `atan, acos, asin` because I am not very sure how they get evaluated. I have fixed the other functions to take `complex` type as input.
You'll notice that [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/functions/trig.py#n562)

```
arctan = atan = Function_arctan()
```

so `atan` is exactly the same as `arctan` - one fix works for both!



---

archive/issue_comments_211545.json:
```json
{
    "body": "> so `atan` is exactly the same as `arctan` - one fix works for both!\n(Though I haven't actually tried the branch.)\n\n----\n\nI understand and approve of the changes for trig.py, pending verification and messing around.  But I don't quite get the changes in function.pyx.  In particular, it seems like there is too much stuff.  If `org_parent is float` then `return org_parent(RDF(res))` does nothing (or at least nothing that wouldn't have happened with `float`, I hope).  Why would that be better than just converting to `float`?  I'd go straight to trying the `CDF` piece.  Is there some specific case I'm not considering that would make me think that?",
    "created_at": "2014-06-06T14:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211545",
    "user": "kcrisman"
}
```

> so `atan` is exactly the same as `arctan` - one fix works for both!
(Though I haven't actually tried the branch.)

----

I understand and approve of the changes for trig.py, pending verification and messing around.  But I don't quite get the changes in function.pyx.  In particular, it seems like there is too much stuff.  If `org_parent is float` then `return org_parent(RDF(res))` does nothing (or at least nothing that wouldn't have happened with `float`, I hope).  Why would that be better than just converting to `float`?  I'd go straight to trying the `CDF` piece.  Is there some specific case I'm not considering that would make me think that?



---

archive/issue_comments_211546.json:
```json
{
    "body": "> > The following functions are not fixed: `atan, acos, asin` because I am not very sure how they get evaluated. I have fixed the other functions to take `complex` type as input.\n\nI see what you mean now, you also mean `arctan`, `arccos`, and `arcsin`.  Sorry for my confusion.   I expect they are evaluated in Ginac.  I will investigate that a bit.  But at least those guys plot fine.",
    "created_at": "2014-06-06T14:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211546",
    "user": "kcrisman"
}
```

> > The following functions are not fixed: `atan, acos, asin` because I am not very sure how they get evaluated. I have fixed the other functions to take `complex` type as input.

I see what you mean now, you also mean `arctan`, `arccos`, and `arcsin`.  Sorry for my confusion.   I expect they are evaluated in Ginac.  I will investigate that a bit.  But at least those guys plot fine.



---

archive/issue_comments_211547.json:
```json
{
    "body": "Got it!\n\nWhen `GinacFunction` goes up to `BuiltinFunction` it first tries doing it in `Function`.  That coerces your complex to SR.  (Incorrectly, perhaps, because \n\n```\nsage: SR(float(1))\n1.0\nsage: SR(complex(1,1))\n(1+1j)\n```\n\nand I'm not sure what's up with the parentheses, but I don't really know much about coercion in Sage.)\n\nAnyway, then it goes to the `arcsin()` *method* in sage.symbolic.expression.Expression (!) because now we have a symbolic expression for the previously `complex` input.  And I'm pretty sure that this is where things go wrong, because [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/symbolic/pynac.pyx#n1596) it looks like it tries to coerce our now-symbolic thing to `RR`, which of course we can't do.\n\nNow you'll notice that in e.g. `py_tan` in the same file it then would go on to try coercing to `CC`, but it doesn't here.  In fact, in a whole bunch of places this happens, and \n\n```\nsage: sinh(complex(1,1))\n<snip>\nTypeError: Unable to convert x (='(1+1j)') to real number.\n```\n\nso I am pretty sure this is where things end.\n\nThe reason your fix for the other arc trig functions works is because they are not defined in Ginac/Pynac.  But these functions don't work with complex input, presumably because [here](http://www.ginac.de/reference/inifcns__trans_8cpp_source.html#l00642) it doesn't handle complex stuff, or maybe because when we replaced Ginac's internal numbers with Sage ones something happened.  \n\nI'm cc:ing Burcin, who will probably have a suggestion as to the best place to fix this.  But my druthers would be to just copycat what happens in sage/symbolic/pynac.pyx for other complex input, like `py_exp` or `py_acosh`.\n\nThough as you say if we can't get it done quickly enough here, we can do this stuff and open a new ticket for it.  But I really don't like that coercion to SR of complexes.",
    "created_at": "2014-06-06T15:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211547",
    "user": "kcrisman"
}
```

Got it!

When `GinacFunction` goes up to `BuiltinFunction` it first tries doing it in `Function`.  That coerces your complex to SR.  (Incorrectly, perhaps, because 

```
sage: SR(float(1))
1.0
sage: SR(complex(1,1))
(1+1j)
```

and I'm not sure what's up with the parentheses, but I don't really know much about coercion in Sage.)

Anyway, then it goes to the `arcsin()` *method* in sage.symbolic.expression.Expression (!) because now we have a symbolic expression for the previously `complex` input.  And I'm pretty sure that this is where things go wrong, because [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/symbolic/pynac.pyx#n1596) it looks like it tries to coerce our now-symbolic thing to `RR`, which of course we can't do.

Now you'll notice that in e.g. `py_tan` in the same file it then would go on to try coercing to `CC`, but it doesn't here.  In fact, in a whole bunch of places this happens, and 

```
sage: sinh(complex(1,1))
<snip>
TypeError: Unable to convert x (='(1+1j)') to real number.
```

so I am pretty sure this is where things end.

The reason your fix for the other arc trig functions works is because they are not defined in Ginac/Pynac.  But these functions don't work with complex input, presumably because [here](http://www.ginac.de/reference/inifcns__trans_8cpp_source.html#l00642) it doesn't handle complex stuff, or maybe because when we replaced Ginac's internal numbers with Sage ones something happened.  

I'm cc:ing Burcin, who will probably have a suggestion as to the best place to fix this.  But my druthers would be to just copycat what happens in sage/symbolic/pynac.pyx for other complex input, like `py_exp` or `py_acosh`.

Though as you say if we can't get it done quickly enough here, we can do this stuff and open a new ticket for it.  But I really don't like that coercion to SR of complexes.



---

archive/issue_comments_211548.json:
```json
{
    "body": "Oops, cc:ing Burcin as promised.\n\nBurcin, if you have a moment, I think there is a very easy question to answer about where to put a fix for something involving Ginac not doing complex input for arc trig functions.  Thanks!",
    "created_at": "2014-06-06T15:38:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211548",
    "user": "kcrisman"
}
```

Oops, cc:ing Burcin as promised.

Burcin, if you have a moment, I think there is a very easy question to answer about where to put a fix for something involving Ginac not doing complex input for arc trig functions.  Thanks!



---

archive/issue_comments_211549.json:
```json
{
    "body": "Replying to [comment:9 kcrisman]:\n> Anyway, then it goes to the `arcsin()` *method* in sage.symbolic.expression.Expression (!) because now we have a symbolic expression for the previously `complex` input.  And I'm pretty sure that this is where things go wrong, because [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/symbolic/pynac.pyx#n1596) it looks like it tries to coerce our now-symbolic thing to `RR`, which of course we can't do.\n\nAh. I didn't figure out this step. I understood that it goes into `Function`, but lost track from there.\n\n> The reason your fix for the other arc trig functions works is because they are not defined in Ginac/Pynac.  But these functions don't work with complex input, presumably because [here](http://www.ginac.de/reference/inifcns__trans_8cpp_source.html#l00642) it doesn't handle complex stuff, or maybe because when we replaced Ginac's internal numbers with Sage ones something happened.  \n\nYes. I know. These functions have their own `_evalf_` method which gets executed finally. What is weird is that there are some other functions like `sec`, `csc`, etc, which also have an `_evalf_` method, but that method probably never gets called! Instead the `_eval_` method gets called. And, somehow that `_eval_` method takes care of `complex` type input.\n\n> Though as you say if we can't get it done quickly enough here, we can do this stuff and open a new ticket for it.  But I really don't like that coercion to SR of complexes.\n\nYes, all this multiple coercion is unclear to me also. `SR` is slow; and we should avoid doing those kinds of coercion. The only time when that should be done is when `hold=True` is passed as a parameter.",
    "created_at": "2014-06-07T04:43:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211549",
    "user": "ppurka"
}
```

Replying to [comment:9 kcrisman]:
> Anyway, then it goes to the `arcsin()` *method* in sage.symbolic.expression.Expression (!) because now we have a symbolic expression for the previously `complex` input.  And I'm pretty sure that this is where things go wrong, because [here](https://github.com/sagemath/sagetrac-mirror/blob/master/src/sage/symbolic/pynac.pyx#n1596) it looks like it tries to coerce our now-symbolic thing to `RR`, which of course we can't do.

Ah. I didn't figure out this step. I understood that it goes into `Function`, but lost track from there.

> The reason your fix for the other arc trig functions works is because they are not defined in Ginac/Pynac.  But these functions don't work with complex input, presumably because [here](http://www.ginac.de/reference/inifcns__trans_8cpp_source.html#l00642) it doesn't handle complex stuff, or maybe because when we replaced Ginac's internal numbers with Sage ones something happened.  

Yes. I know. These functions have their own `_evalf_` method which gets executed finally. What is weird is that there are some other functions like `sec`, `csc`, etc, which also have an `_evalf_` method, but that method probably never gets called! Instead the `_eval_` method gets called. And, somehow that `_eval_` method takes care of `complex` type input.

> Though as you say if we can't get it done quickly enough here, we can do this stuff and open a new ticket for it.  But I really don't like that coercion to SR of complexes.

Yes, all this multiple coercion is unclear to me also. `SR` is slow; and we should avoid doing those kinds of coercion. The only time when that should be done is when `hold=True` is passed as a parameter.



---

archive/issue_comments_211550.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-07T04:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211550",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211551.json:
```json
{
    "body": "Just one point - almost certainly some of those digits are 'extra' from Python.  Compare (after this):\n\n```\nsage: sec(1.+i)\n0.498337030555187 + 0.591083841721045*I\nsage: sec(complex(1,1))\n(0.49833703055518686+0.5910838417210451j)\nsage: sec(CDF(complex(1,1)))\n0.498337030555 + 0.591083841721*I\n```\n\nInteresting.\n\nHere is something else I don't know what to do with.\n\n```\nsage: arccot(1.+i)\narccot(1.00000000000000 + 1.00000000000000*I)  # in SR\nsage: cot(1.+i)\n0.217621561854403 - 0.868014142895925*I\n```\n\nOne would think this should be the same type of output.\n\nThat said, `SR` is useful for some other cases of exact input.\n\nI'm wondering whether we want to try to fix all of this here, though.",
    "created_at": "2014-06-08T01:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211551",
    "user": "kcrisman"
}
```

Just one point - almost certainly some of those digits are 'extra' from Python.  Compare (after this):

```
sage: sec(1.+i)
0.498337030555187 + 0.591083841721045*I
sage: sec(complex(1,1))
(0.49833703055518686+0.5910838417210451j)
sage: sec(CDF(complex(1,1)))
0.498337030555 + 0.591083841721*I
```

Interesting.

Here is something else I don't know what to do with.

```
sage: arccot(1.+i)
arccot(1.00000000000000 + 1.00000000000000*I)  # in SR
sage: cot(1.+i)
0.217621561854403 - 0.868014142895925*I
```

One would think this should be the same type of output.

That said, `SR` is useful for some other cases of exact input.

I'm wondering whether we want to try to fix all of this here, though.



---

archive/issue_comments_211552.json:
```json
{
    "body": "I suggest that we do the minimum here so that the plot ticket can be doctested.\n\nFixing this entirely looks like a lengthy procedure, which someone very familiar with the coercion framework should do. I suspect there should be one big fix that should happen only in `Function` or `BuiltinFunction` such that it fixes all the other trigonometric and other functions.",
    "created_at": "2014-06-08T08:15:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211552",
    "user": "ppurka"
}
```

I suggest that we do the minimum here so that the plot ticket can be doctested.

Fixing this entirely looks like a lengthy procedure, which someone very familiar with the coercion framework should do. I suspect there should be one big fix that should happen only in `Function` or `BuiltinFunction` such that it fixes all the other trigonometric and other functions.



---

archive/issue_comments_211553.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-17T07:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211553",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_211554.json:
```json
{
    "body": "As you say we will not be losing anything from doing this. The fact that it's all a minimal change, and patchbot is happy (ignore the spurious plugin failure) leads me to accept this. I would just ask Karl-Dieter and Burcin to feel free to open a ticket on what came up additionally.",
    "created_at": "2014-06-17T07:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211554",
    "user": "rws"
}
```

As you say we will not be losing anything from doing this. The fact that it's all a minimal change, and patchbot is happy (ignore the spurious plugin failure) leads me to accept this. I would just ask Karl-Dieter and Burcin to feel free to open a ticket on what came up additionally.



---

archive/issue_comments_211555.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-06-18T12:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211555",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_211556.json:
```json
{
    "body": "author name",
    "created_at": "2014-06-18T12:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211556",
    "user": "vbraun"
}
```

author name



---

archive/issue_comments_211557.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-06-18T12:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211557",
    "user": "ppurka"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_211558.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-06-18T16:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211558",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_211559.json:
```json
{
    "body": "Precision issues on multiple platforms\n\n```\nsage -t --long src/sage/functions/trig.py\n**********************************************************************\nFile \"src/sage/functions/trig.py\", line 179, in sage.functions.trig.Function_sec._evalf_\nFailed example:\n    sec(complex(1,1))\nExpected:\n    (0.49833703055518686+0.5910838417210451j)\nGot:\n    (0.4983370305551868+0.591083841721045j)\n**********************************************************************\nFile \"src/sage/functions/trig.py\", line 721, in sage.functions.trig.Function_arccsc._evalf_\nFailed example:\n    arccsc(complex(1,1))\nExpected:\n    (0.45227844715119064-0.5306375309525178j)\nGot:\n    (0.45227844715119064-0.5306375309525179j)\n**********************************************************************\nFile \"src/sage/functions/trig.py\", line 797, in sage.functions.trig.Function_arcsec._evalf_\nFailed example:\n    arcsec(complex(1,1))\nExpected:\n    (1.118517879643706+0.5306375309525178j)\nGot:\n    (1.118517879643706+0.5306375309525179j)\n**********************************************************************\n\n```\n\nUse `# rel tol`.",
    "created_at": "2014-06-18T16:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211559",
    "user": "vbraun"
}
```

Precision issues on multiple platforms

```
sage -t --long src/sage/functions/trig.py
**********************************************************************
File "src/sage/functions/trig.py", line 179, in sage.functions.trig.Function_sec._evalf_
Failed example:
    sec(complex(1,1))
Expected:
    (0.49833703055518686+0.5910838417210451j)
Got:
    (0.4983370305551868+0.591083841721045j)
**********************************************************************
File "src/sage/functions/trig.py", line 721, in sage.functions.trig.Function_arccsc._evalf_
Failed example:
    arccsc(complex(1,1))
Expected:
    (0.45227844715119064-0.5306375309525178j)
Got:
    (0.45227844715119064-0.5306375309525179j)
**********************************************************************
File "src/sage/functions/trig.py", line 797, in sage.functions.trig.Function_arcsec._evalf_
Failed example:
    arcsec(complex(1,1))
Expected:
    (1.118517879643706+0.5306375309525178j)
Got:
    (1.118517879643706+0.5306375309525179j)
**********************************************************************

```

Use `# rel tol`.



---

archive/issue_comments_211560.json:
```json
{
    "body": "Well, at least this justifies my comment about \"extra\" digits...",
    "created_at": "2014-06-18T17:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211560",
    "user": "kcrisman"
}
```

Well, at least this justifies my comment about "extra" digits...



---

archive/issue_comments_211561.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-20T12:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211561",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211562.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-20T13:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211562",
    "user": "ppurka"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_211563.json:
```json
{
    "body": "`@`vbraun: added the `# rel tol`. Need review, because I don't have access to exotic archs :)",
    "created_at": "2014-06-20T13:01:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211563",
    "user": "ppurka"
}
```

`@`vbraun: added the `# rel tol`. Need review, because I don't have access to exotic archs :)



---

archive/issue_comments_211564.json:
```json
{
    "body": "Neither do I, but I do know you need to add something WITH `rel tol` for it to work.  See [the developer guide](http://sagemath.org/doc/developer/coding_basics.html#special-markup-to-influence-tests) (granted, only one example...)",
    "created_at": "2014-06-20T17:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211564",
    "user": "kcrisman"
}
```

Neither do I, but I do know you need to add something WITH `rel tol` for it to work.  See [the developer guide](http://sagemath.org/doc/developer/coding_basics.html#special-markup-to-influence-tests) (granted, only one example...)



---

archive/issue_comments_211565.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-21T00:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211565",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211566.json:
```json
{
    "body": "Replying to [comment:22 kcrisman]:\n> Neither do I, but I do know you need to add something WITH `rel tol` for it to work.  See [the developer guide](http://sagemath.org/doc/developer/coding_basics.html#special-markup-to-influence-tests) (granted, only one example...)\nThanks. I just put in `1e-12` - as I understand it, rel tol gives the maximum magnitude of the error that must be tolerated. The results seem correct up to almost the 15th digit, but I put in a more conservative figure.",
    "created_at": "2014-06-21T00:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211566",
    "user": "ppurka"
}
```

Replying to [comment:22 kcrisman]:
> Neither do I, but I do know you need to add something WITH `rel tol` for it to work.  See [the developer guide](http://sagemath.org/doc/developer/coding_basics.html#special-markup-to-influence-tests) (granted, only one example...)
Thanks. I just put in `1e-12` - as I understand it, rel tol gives the maximum magnitude of the error that must be tolerated. The results seem correct up to almost the 15th digit, but I put in a more conservative figure.



---

archive/issue_comments_211567.json:
```json
{
    "body": "Special functions should always come out to within a few ulp, anything else is a bug IMHO.  If it were really 1e-12 then that would be a bug for sure. I'd suggest 1e-15.",
    "created_at": "2014-06-21T17:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211567",
    "user": "vbraun"
}
```

Special functions should always come out to within a few ulp, anything else is a bug IMHO.  If it were really 1e-12 then that would be a bug for sure. I'd suggest 1e-15.



---

archive/issue_comments_211568.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-06-21T21:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211568",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_211569.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-06-21T22:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211569",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_211570.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-06-21T23:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16202",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16202#issuecomment-211570",
    "user": "vbraun"
}
```

Resolution: fixed
