# Issue 20731: more Hadamard matrices with constant diagonal

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2016-07-07 00:10:56

CC:  vdelecroix

Adding a construction by J.Wallis and A.L.Whiteman (1972).
This gives in particular RSHCD(676,1) and RSHCD(900,1), 
and corresponding strongly regular graphs.


---

Comment by git created at 2016-07-07 13:17:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2016-07-07 13:42:51

Changing status from new to needs_review.


---

Comment by dimpase created at 2016-07-07 14:03:00

I wonder whether that small difference family (by Szekeres) here ought to be moved somewhere else.


---

Comment by vdelecroix created at 2016-07-07 14:28:40

To get the squares in a finite field, there is better than

```
Q = filter(lambda a: a.is_square() and a.is_unit(), F)
```

Since you are using containment test later on I would even do

```
Q = set(a**2 for a in F)
Q.remove(F.zero())
```


For `szekeres_difference_set_pair`, it would be better to have the same variable name in the documentation description and in the function (currently `G` and `Q`).

Could you remove the trailing whitespaces in the whole file?

For the ` szekeres_difference_set_pair` and `typeI_matrix_difference_set`, why not put it somewhere in `sage.combinat.designs.difference_family`?

You should add an example in `regular_symmetric_hadamard_matrix_with_constant_diagonal` where your new construction is actually used.


---

Comment by vdelecroix created at 2016-07-07 14:28:40

Changing status from needs_review to needs_work.


---

Comment by embray created at 2016-07-08 08:55:59

(testing whether an issue with the site is fixed; sorry for the noise)


---

Comment by dimpase created at 2016-07-08 10:23:21

Replying to [comment:4 vdelecroix]:
> To get the squares in a finite field, there is better than
> {{{
> Q = filter(lambda a: a.is_square() and a.is_unit(), F)
> }}}
> Since you are using containment test later on I would even do
> {{{
> Q = set(a**2 for a in F)
> Q.remove(F.zero())
> }}}
> 
> For `szekeres_difference_set_pair`, it would be better to have the same variable name in the documentation description and in the function (currently `G` and `Q`).
> 
> Could you remove the trailing whitespaces in the whole file?

yes, I'll do all of the above. I can do even better, as I know a generator for the multiplicative group of the field, thus I can list the squares explicitly
without repetition...

> 
> For the ` szekeres_difference_set_pair` and `typeI_matrix_difference_set`, why not put it somewhere in `sage.combinat.designs.difference_family`?

`szekeres_difference_set_pair` does not return a group, it merely returns a list of group elements; in this form I don't think it should go there. In fact I do not know how to create, in Sage, a subgroup of the multiplicative group of a field in a natural way. Indeed:

```
sage: F=GF(27)
sage: t=F.multiplicative_generator()
sage: G=GL(1,F)
sage: t in G
True
sage: G.subgroup([t^2])
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-58-d1ce805e8ed8> in <module>()
----> 1 G.subgroup([t**Integer(2)])
...
AttributeError: 'sage.rings.finite_rings.element_givaro.FiniteField_givaroElement' object has no attribute 'gap'
```

The problem here is that matrix groups in Sage are done via (lib)GAP, but 
this is not compatible with the default way of creating GF in Sage. 
I don't see how to overcome this easily - would you mind if I keep it the way it is? 

> 
> You should add an example in `regular_symmetric_hadamard_matrix_with_constant_diagonal` where your new construction is actually used.

right.


---

Comment by git created at 2016-07-08 15:10:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-07-08 15:12:55

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2016-07-08 15:12:55

the changes as you suggested and I proposed in the last comment to do.


---

Comment by vdelecroix created at 2016-07-08 20:24:48

The following

```
A = filter(lambda a: a-F.one() in G, G)
```

is quadratic time in the size of `G` (because `G` is a list). If it was a Python set then it would be linear in `G`.

Note that a way to return a group together with subsets is to actually translate everything to the Abelian group `Z/(2m+1)Z` via the isomorphism `Z/(2m+1)Z -> G` that maps `i` to `x^i` where `x` is your generator. However, I am not sure it is a good idea.


---

Comment by vdelecroix created at 2016-07-08 20:28:19

For all the squaring buisness it is much faster to use the *methods* of Sage integers rather than the generic functions `is_square` and `sqrt`

```
sage: %timeit is_square(n)
1000000 loops, best of 3: 698 ns per loop
sage: %timeit n.is_square()
1000000 loops, best of 3: 139 ns per loop
sage: %timeit sqrt(n)
1000000 loops, best of 3: 860 ns per loop
sage: %timeit n.sqrtrem()
1000000 loops, best of 3: 172 ns per loop
```

(though it does not import much since the time is not spent here anyway)


---

Comment by vdelecroix created at 2016-07-08 20:30:39

Why this

```
try:
    m = srg(n-1,(n-2)/2,(n-6)/4,(n-2)/4)
except ValueError:
    raise
```

and not simply

```
m = srg(n-1,(n-2)/2,(n-6)/4,(n-2)/4)
```



---

Comment by vdelecroix created at 2016-07-08 20:33:32

Note that for generating the squares you have a possible shortcut

```
sage: K = GF(19)
sage: K.cyclotomic_cosets(K.multiplicative_generator()^2, cosets=[K.one()])
[This is the Trac macro *1, 4, 5, 6, 7, 9, 11, 16, 17* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 4, 5, 6, 7, 9, 11, 16, 17-macro)
```

(this function is used _a lot_ in the code for difference families)


---

Comment by dimpase created at 2016-07-08 20:52:28

Replying to [comment:14 vdelecroix]:
> Why this
> {{{
> try:
>     m = srg(n-1,(n-2)/2,(n-6)/4,(n-2)/4)
> except ValueError:
>     raise
> }}}
> and not simply
> {{{
> m = srg(n-1,(n-2)/2,(n-6)/4,(n-2)/4)
> }}}

Actually, it is `return` there, not `raise`. So this makes sense as it is.


---

Comment by chapoton created at 2016-07-09 11:38:49

For python 3 compatibility, please use exact division `//` whenever possible.

```
m = srg(n-1,(n-2)/2,(n-6)/4,(n-2)/4)
```



---

Comment by git created at 2016-07-09 15:39:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-07-09 15:40:30

ready for another round.


---

Comment by vdelecroix created at 2016-07-25 01:42:49

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2016-07-25 01:42:49

typo `coneference` should be `conference`

This is not a sentence `Thus `C` we build ...`

The docstring of `typeI_matrix_difference_set` ends with {"""} without indentation.


---

Comment by git created at 2016-07-26 12:38:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-07-26 12:39:22

OK, thanks, fixed these typos.


---

Comment by dimpase created at 2016-07-26 12:39:22

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2016-07-26 21:48:29

Assuming `is_square(n)` is `True`, checking `sqrt(n) % 4 == 2` is equivalent to `n % 8 in (2,6)`. That makes it a cheaper test (possibly to put _before_ the square test).


---

Comment by vdelecroix created at 2016-07-26 21:50:29

In `szekeres_difference_set_pair` it would be better to actually check that the output is what you want. In other words check that `A` and `B` are difference sets and that there are complementary.


---

Comment by dimpase created at 2016-07-27 00:00:13

Replying to [comment:24 vdelecroix]:
> In `szekeres_difference_set_pair` it would be better to actually check that the output is what you want. In other words check that `A` and `B` are difference sets and that there are complementary.

it is actually even more than that; A has to be skew-symmetric and B has to be 
symmetric (in terms of their  "typeI matrices"). But this, as well as the above, is
tested indirectly, by building the corresponding Hadamard matrix.


---

Comment by dimpase created at 2016-07-27 14:28:03

Replying to [comment:25 dimpase]:
> Replying to [comment:24 vdelecroix]:
> > In `szekeres_difference_set_pair` it would be better to actually check that the output is what you want. In other words check that `A` and `B` are difference sets and that there are complementary.
> 
> it is actually even more than that; A has to be skew-symmetric and B has to be 
> symmetric (in terms of their  "typeI matrices"). But this, as well as the above, is
> tested indirectly, by building the corresponding Hadamard matrix.
> 
These sets are not difference sets in the [classical sense](https://en.wikipedia.org/wiki/Difference_set). Indeed, 

```
sage: szekeres_difference_set_pair(2)
([1, 3, 4, 5, 9], [4, 5], [3, 4])
```

That is you have v=5, k=2, and the standard equation k<sup>2</sup>-k=(v-1)l on the parameters (v,k,l) of a difference set implies l=1/2, which just cannot happen.

What we have here is a difference family, with s=2, so you have s(k<sup>2</sup>-k)=(v-1)l, ie
[the parameters of the family](https://en.wikipedia.org/wiki/Difference_set#Generalisations) are (v,k,l,s)=(2m+1,m,1,2). Note that in `designs.difference_family` the parameter s is not explicit (but can be computed as (v-1)l/(k<sup>2</sup>-k)).


---

Comment by vdelecroix created at 2016-07-27 19:30:14

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2016-07-27 19:30:14

All right. Let it go as it is now!


---

Comment by git created at 2016-07-27 19:32:19

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2016-07-27 19:32:19

Changing status from positive_review to needs_review.


---

Comment by dimpase created at 2016-07-27 19:33:22

oops, I was just at it... Could you have a quick look again?
Thanks!


---

Comment by git created at 2016-07-27 20:22:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-07-30 02:02:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-08-07 20:01:21

Resolution: fixed
