# Issue 21825: sage -t tests/cmdline.py creates junk file logs/pkgs/sqlite.log

Issue created by migration from https://trac.sagemath.org/ticket/22062

Original creator: slabbe

Original creation time: 2016-12-15 13:44:23

CC:  jdemeyer slelievre tornaria mkoeppe

As reported on [sage-release](https://groups.google.com/d/msg/sage-release/HO7UR2sqmTM/KzySa1rWCwAJ):


```
rm -f logs/pkgs/sqlite.log
sage -t src/sage/tests/cmdline.py
ls logs/pkgs/sq*
```


creates file


```
logs/pkgs/sqlite.log
```


... which is not a log file at all.


---

Comment by jhpalmieri created at 2016-12-15 20:56:16

I believe that the log file is created by the line

```
sage: out, err, ret = test_executable(["sage", "-p", "--info", "--info", "sqlite"])
```

Indeed, running `sage --info sqlite` just prints the `SPKG.txt` file to the screen, while `sage -p --info sqlite` also dumps that to a log file. This is because of the way the script `src/bin/sage` is written. We could change that:

```diff
diff --git a/src/bin/sage b/src/bin/sage
index cb3b611..3fb83ac 100755
--- a/src/bin/sage
+++ b/src/bin/sage
@@ -844,14 +844,19 @@ install() {
                 continue;;
         esac
 
-        PKG_NAME=`echo "$PKG" | sed -e "s/\.spkg$//"`
-        PKG_NAME=`basename "$PKG_NAME"`
-
-        sage-logger \
-            "sage-spkg $INSTALL_OPTIONS '$PKG'" "$SAGE_LOGS/$PKG_NAME.log"
-        # Do not try to install further packages if one failed
-        if [ $? -ne 0 ]; then
-            exit 1
+        if [[ $INSTALL_OPTIONS == *"-info"* ]]; then
+            # Just print the info, don't write a log file.
+            sage-spkg --info "$PKG" || exit $?
+        else
+            PKG_NAME=`echo "$PKG" | sed -e "s/\.spkg$//"`
+            PKG_NAME=`basename "$PKG_NAME"`
+
+            sage-logger \
+                "sage-spkg $INSTALL_OPTIONS '$PKG'" "$SAGE_LOGS/$PKG_NAME.log"
+            # Do not try to install further packages if one failed
+            if [ $? -ne 0 ]; then
+                exit 1
+            fi
         fi
     done
     # Display a message if we actually installed something (using this
```



---

Comment by jhpalmieri created at 2021-12-24 19:59:04

This might also be addressed by #30649, although I haven't tested that.


---

Comment by jhpalmieri created at 2022-03-03 22:43:28

This has indeed now been fixed, so I propose closing this.


---

Comment by jhpalmieri created at 2022-03-03 22:43:28

Changing status from new to needs_review.


---

Comment by mjo created at 2022-03-13 10:51:01

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2022-03-27 18:42:45

Resolution: invalid
