# Issue 28558: 32-bit error with Python 3 in IntegerModRing pow

Issue created by migration from https://trac.sagemath.org/ticket/28795

Original creator: vbraun

Original creation time: 2019-11-24 13:47:55

CC:  vdelecroix jhpalmieri chapoton




---

Comment by vbraun created at 2019-11-24 13:58:51

Changing component from PLEASE CHANGE to basic arithmetic.


---

Comment by vbraun created at 2019-11-24 13:58:51

Changing priority from major to blocker.


---

Comment by vbraun created at 2019-11-24 13:58:51

Changing type from PLEASE CHANGE to defect.


---

Comment by git created at 2019-11-24 15:07:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-11-24 15:51:22

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-11-24 16:20:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-11-24 16:29:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-11-24 16:31:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-11-24 16:32:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-11-24 16:37:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-11-24 16:50:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vbraun created at 2019-11-24 17:06:00

Changing status from new to needs_review.


---

Comment by chapoton created at 2019-11-24 20:07:15

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2019-11-24 20:07:15

ok, looks good. I fixed a typo.
----
New commits:


---

Comment by vbraun created at 2019-11-25 00:16:36

Resolution: fixed


---

Comment by jhpalmieri created at 2019-11-27 17:18:17

This is causing a doctest failure for me with a Python 2 build of Sage on OS X:

```
sage -t --long --warn-long 68.1 src/sage/libs/pynac/pynac.pyx
**********************************************************************
File "src/sage/libs/pynac/pynac.pyx", line 295, in sage.libs.pynac.pynac.subs_args_to_PyTuple
Failed example:
    tfunc(x).subs(x=1)   # py2
Expected:
    len(args): 3, types: [<class 'sage.symbolic.substitution_map.SubstitutionMap'>,
      <class 'int'>,        
      <class 'sage.symbolic.expression.Expression'>]
    x
Got:
    len(args): 3, types: [<type 'sage.symbolic.substitution_map.SubstitutionMap'>, <type 'int'>, <type 'sage.symbolic.expression.Expression'>]
    x
**********************************************************************
```



---

Comment by jhpalmieri created at 2019-11-27 20:45:13

Followup: #28812. Easy fix, I think.


---

Comment by @plugwash created at 2019-11-28 12:02:20

-            if isinstance(x0, long):
+            if isinstance(x0, (int, long)):

I'm no sage expert, but this looks wrong to me, python 3 does not define "long", so afaict unless something in safe defines it instead or there is some subtlely of cython that i'm not aware of this will fail with a NameError.


---

Comment by vbraun created at 2019-11-28 22:39:34

Cython just translates 
* `isinstance(x, int)` to `PyInt_Check`
* `isinstance(x, long)` to `PyLong_Check`
Now `PyInt_Check` is indeed gone from the Python 3 C API, but Cython handily emits

```
#if PY_MAJOR_VERSION >= 3
  #define PyInt_Check(op)              PyLong_Check(op)
```

So as long as the Cython code gets translated to C you can still use `long` (and its the same as a Python int when compiling with Python 3). Kind of a weird feature but without it you'd be hard pressed to write any 2&3 compatible Cython code...
