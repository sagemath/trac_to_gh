# Issue 19350: Implement the Chow ring of a matroid

archive/issues_019350.json:
```json
{
    "body": "Assignee: @tscrim\n\nWe implement the Chow ring of a matroid following http://arxiv.org/abs/1511.02888, which in turns follows Feitcher and Yuzvinsky.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19587\n\n",
    "created_at": "2015-11-14T17:51:02Z",
    "labels": [
        "matroid theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "Implement the Chow ring of a matroid",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19350",
    "user": "@tscrim"
}
```
Assignee: @tscrim

We implement the Chow ring of a matroid following http://arxiv.org/abs/1511.02888, which in turns follows Feitcher and Yuzvinsky.

Issue created by migration from https://trac.sagemath.org/ticket/19587





---

archive/issue_comments_265834.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-11-14T17:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19350#issuecomment-265834",
    "user": "@tscrim"
}
```

New commits:



---

archive/issue_comments_265835.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-14T17:58:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19350#issuecomment-265835",
    "user": "@tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_265836.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-11-20T10:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19350#issuecomment-265836",
    "user": "Rudi"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_265837.json:
```json
{
    "body": "Hi Travis,\n\nI reviewed the code. I was worried that I might not have the necessary background to verify if the algebra is correct, but the definition of the chow ring is right on page two of the paper you refer to and is pretty straightforward. Your implementation follows the definition exactly.\n\nThe code also works on my favorite fringe cases, the empty matroid, several other rank-0 matroids, some uniform matroids, and on various other small matroids. \n\nAs far as I can tell the code is correct, looks good, survives doctesting, so positive review! Thank you for keeping sage up to speed with the very latest developments in matroid theory this way.\n\nThe running time of your code does increase steeply with the size/rank of the matroid. \n\n```\nsage: M=matroids.Uniform(3,5)\nsage: M.chow_ring().gens()\n```\n\nis more or less instantaneous, but M=matroids.Uniform(4,5) simply does not finish on my machine, and neither does M=matroids.Uniform(3,6). Also, the computation for P8 gets killed by my linux machine, probably due to excessive resource hogging. \n\nLooking at the definition of chow ring, that makes sense. The full set of flats is simply a very very big set of generators already for small matroids. Just looking at the definition (and blissfully unaware of any further theory),  I wonder if computing the chow ring recursively may be more efficient, e.g. first computing the chow ring of the truncation, then adding the generators and relations involving the hyperplanes. Or perhaps another recursion, where you first compute a deletion or contraction minor.",
    "created_at": "2015-11-20T10:21:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19350#issuecomment-265837",
    "user": "Rudi"
}
```

Hi Travis,

I reviewed the code. I was worried that I might not have the necessary background to verify if the algebra is correct, but the definition of the chow ring is right on page two of the paper you refer to and is pretty straightforward. Your implementation follows the definition exactly.

The code also works on my favorite fringe cases, the empty matroid, several other rank-0 matroids, some uniform matroids, and on various other small matroids. 

As far as I can tell the code is correct, looks good, survives doctesting, so positive review! Thank you for keeping sage up to speed with the very latest developments in matroid theory this way.

The running time of your code does increase steeply with the size/rank of the matroid. 

```
sage: M=matroids.Uniform(3,5)
sage: M.chow_ring().gens()
```

is more or less instantaneous, but M=matroids.Uniform(4,5) simply does not finish on my machine, and neither does M=matroids.Uniform(3,6). Also, the computation for P8 gets killed by my linux machine, probably due to excessive resource hogging. 

Looking at the definition of chow ring, that makes sense. The full set of flats is simply a very very big set of generators already for small matroids. Just looking at the definition (and blissfully unaware of any further theory),  I wonder if computing the chow ring recursively may be more efficient, e.g. first computing the chow ring of the truncation, then adding the generators and relations involving the hyperplanes. Or perhaps another recursion, where you first compute a deletion or contraction minor.



---

archive/issue_comments_265838.json:
```json
{
    "body": "Thinking a bit about efficiency, this seems to insert a quadratic number of relations:\n\n```\nL = [sum(gens[i] for i in flats_containing[x]) - sum(gens[i] for i in flats_containing[y]) \n      for j,x in enumerate(E) for y in E[j+1:]]\n```\n\nwhere a linear set of relations generates the same ideal J_M:\n\n```\nL = [sum(gens[i] for i in flats_containing[E[j]]) - sum(gens[i] for i in flats_containing[E[j+1]]) \n      for j in range(len(E)-1)]\n```\n\nBut this does not affect the running time by much. The real pain seems to be in the relations defining I_M. \n\nI also see now that my plan for recursive calculation through truncation does not make sense. Truncation really changes the relations which define J_M, and does not just remove some of the relations.",
    "created_at": "2015-11-20T12:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19350#issuecomment-265838",
    "user": "Rudi"
}
```

Thinking a bit about efficiency, this seems to insert a quadratic number of relations:

```
L = [sum(gens[i] for i in flats_containing[x]) - sum(gens[i] for i in flats_containing[y]) 
      for j,x in enumerate(E) for y in E[j+1:]]
```

where a linear set of relations generates the same ideal J_M:

```
L = [sum(gens[i] for i in flats_containing[E[j]]) - sum(gens[i] for i in flats_containing[E[j+1]]) 
      for j in range(len(E)-1)]
```

But this does not affect the running time by much. The real pain seems to be in the relations defining I_M. 

I also see now that my plan for recursive calculation through truncation does not make sense. Truncation really changes the relations which define J_M, and does not just remove some of the relations.



---

archive/issue_comments_265839.json:
```json
{
    "body": "Replying to [comment:2 Rudi]:\n> I reviewed the code. I was worried that I might not have the necessary background to verify if the algebra is correct, but the definition of the chow ring is right on page two of the paper you refer to and is pretty straightforward. Your implementation follows the definition exactly.\n> \n> The code also works on my favorite fringe cases, the empty matroid, several other rank-0 matroids, some uniform matroids, and on various other small matroids. \n\nThat's good to hear; I didn't necessarily check on them... <.< >.>\n\n> As far as I can tell the code is correct, looks good, survives doctesting, so positive review! Thank you for keeping sage up to speed with the very latest developments in matroid theory this way.\n\nThank you for doing the review Rudi.\n\n> The running time of your code does increase steeply with the size/rank of the matroid. \n> {{{\n> sage: M=matroids.Uniform(3,5)\n> sage: M.chow_ring().gens()\n> }}}\n> is more or less instantaneous, but M=matroids.Uniform(4,5) simply does not finish on my machine, and neither does M=matroids.Uniform(3,6). Also, the computation for P8 gets killed by my linux machine, probably due to excessive resource hogging. \n\nI'm not too surprised because, as you said, it is roughly quadratic in the number of flats and along with the linear relations, this gives a lot of relations for computing the Gr\u00f6bner basis. If I understand my quick Googling correctly, this grows exponentially in the number of relations.\n\nI can create the Chow rings relatively quickly, but getting the Gr\u00f6bner basis is what really takes the time. Using `U(3,6)` has 45 relations, and a bunch of the linear relations have 10+ terms. However, the `gens()` does work fairly quickly over `GF(2)` (where it has 352 polynomials) and `QQ` (with 407 polynomials). So the only thing we could really add to it at this point is a note saying to try it over other rings/fields (or make Singular go faster over `ZZ`)...",
    "created_at": "2015-11-20T17:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19350#issuecomment-265839",
    "user": "@tscrim"
}
```

Replying to [comment:2 Rudi]:
> I reviewed the code. I was worried that I might not have the necessary background to verify if the algebra is correct, but the definition of the chow ring is right on page two of the paper you refer to and is pretty straightforward. Your implementation follows the definition exactly.
> 
> The code also works on my favorite fringe cases, the empty matroid, several other rank-0 matroids, some uniform matroids, and on various other small matroids. 

That's good to hear; I didn't necessarily check on them... <.< >.>

> As far as I can tell the code is correct, looks good, survives doctesting, so positive review! Thank you for keeping sage up to speed with the very latest developments in matroid theory this way.

Thank you for doing the review Rudi.

> The running time of your code does increase steeply with the size/rank of the matroid. 
> {{{
> sage: M=matroids.Uniform(3,5)
> sage: M.chow_ring().gens()
> }}}
> is more or less instantaneous, but M=matroids.Uniform(4,5) simply does not finish on my machine, and neither does M=matroids.Uniform(3,6). Also, the computation for P8 gets killed by my linux machine, probably due to excessive resource hogging. 

I'm not too surprised because, as you said, it is roughly quadratic in the number of flats and along with the linear relations, this gives a lot of relations for computing the Gröbner basis. If I understand my quick Googling correctly, this grows exponentially in the number of relations.

I can create the Chow rings relatively quickly, but getting the Gröbner basis is what really takes the time. Using `U(3,6)` has 45 relations, and a bunch of the linear relations have 10+ terms. However, the `gens()` does work fairly quickly over `GF(2)` (where it has 352 polynomials) and `QQ` (with 407 polynomials). So the only thing we could really add to it at this point is a note saying to try it over other rings/fields (or make Singular go faster over `ZZ`)...



---

archive/issue_comments_265840.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-11-23T06:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19350",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19350#issuecomment-265840",
    "user": "@vbraun"
}
```

Resolution: fixed
