# Issue 10565: Include David Perkinson's sandpile module in the sage library

archive/issues_010565.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  dperkinson @wdjoyner @dandrake\n\nKeywords: abelian sandpile model\n\nSince David Perkinson's sandpile module (for studying the Abelian Sandpile Model; see for example: [http://en.wikipedia.org/wiki/Bak-Tang-Wiesenfeld_sandpile](http://en.wikipedia.org/wiki/Bak-Tang-Wiesenfeld_sandpile) or [http://people.reed.edu/~davidp/sand/](http://people.reed.edu/~davidp/sand/)) is already written as a properly formatted Sage module it makes sense to include it in the Sage library.\n\nThis module involves a variety of mathematics but it seems to make the most sense in the graphs module.\n\nSome parts of the module require 4ti2, currently an experimental package (but there is no reason it can't be at least an optional package), but this can be explained in the relevant docstrings.\n\nIn case any mathematical justification is needed, this model is of considerable and rising interest.  For example, at the joint math meetings in 2011 there was a talk by Yuval Peres of Microsoft Research surveying it: [http://www.ams.org/amsmtgs/2125_abstracts/1067-a0-38.pdf](http://www.ams.org/amsmtgs/2125_abstracts/1067-a0-38.pdf).\n\nIssue created by migration from https://trac.sagemath.org/ticket/10618\n\n",
    "created_at": "2011-01-13T04:35:42Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.7",
    "title": "Include David Perkinson's sandpile module in the sage library",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10565",
    "user": "mhampton"
}
```
Assignee: jason, ncohen, rlm

CC:  dperkinson @wdjoyner @dandrake

Keywords: abelian sandpile model

Since David Perkinson's sandpile module (for studying the Abelian Sandpile Model; see for example: [http://en.wikipedia.org/wiki/Bak-Tang-Wiesenfeld_sandpile](http://en.wikipedia.org/wiki/Bak-Tang-Wiesenfeld_sandpile) or [http://people.reed.edu/~davidp/sand/](http://people.reed.edu/~davidp/sand/)) is already written as a properly formatted Sage module it makes sense to include it in the Sage library.

This module involves a variety of mathematics but it seems to make the most sense in the graphs module.

Some parts of the module require 4ti2, currently an experimental package (but there is no reason it can't be at least an optional package), but this can be explained in the relevant docstrings.

In case any mathematical justification is needed, this model is of considerable and rising interest.  For example, at the joint math meetings in 2011 there was a talk by Yuval Peres of Microsoft Research surveying it: [http://www.ams.org/amsmtgs/2125_abstracts/1067-a0-38.pdf](http://www.ams.org/amsmtgs/2125_abstracts/1067-a0-38.pdf).

Issue created by migration from https://trac.sagemath.org/ticket/10618





---

archive/issue_comments_110416.json:
```json
{
    "body": "Attachment [sandpile-2.3.patch](tarball://root/attachments/some-uuid/ticket10618/sandpile-2.3.patch) by mhampton created at 2011-01-13 04:36:19\n\nadds module to graphs folder and the all.py in graphs",
    "created_at": "2011-01-13T04:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110416",
    "user": "mhampton"
}
```

Attachment [sandpile-2.3.patch](tarball://root/attachments/some-uuid/ticket10618/sandpile-2.3.patch) by mhampton created at 2011-01-13 04:36:19

adds module to graphs folder and the all.py in graphs



---

archive/issue_comments_110417.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-01-13T04:36:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110417",
    "user": "mhampton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_110418.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-01-14T19:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110418",
    "user": "@wdjoyner"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_110419.json:
```json
{
    "body": "This applies fine to a clone of sage-4.6.1.rc1. However, it fails a ton of doctests. These might pass if the (optional/experimanetal) spkgs were installed. The point is, it should pass if nothing is installed. However, there were also these:\n\n\n```\n\n    sage: D.__dict__\nExpected:\n    {'_sandpile': Digraph on 3 vertices, '_effective_div': [{0: 2, 1: 0, 2: 0}, {0: 0, 1: 1, 2: 1}], '_linear_system': {'inhomog': [[1, 0, 0], [0, -1, -1], [0, 0, 0]], 'num_inhomog': 3, 'num_homog': 2, 'homog': [[-1, -1, -1], [1, 1, 1]]}, '_vertices': [0, 1, 2]}\nGot:\n    {'_sandpile': Digraph on 3 vertices, '_vertices': [0, 1, 2]}\n```\n\nand\n\n```\n\n    sage: D._set_linear_system()\nExpected nothing\nGot:\n    <BLANKLINE>\n                     **********************************\n                     *** This method requires 4ti2. ***\n                     **********************************\n    <BLANKLINE>\n                Read the beginning of sandpile.sage or see the Sage Sandpiles\n                documentation for installation instructions.\n    <BLANKLINE>\n}}\nfor example.\n\nThis occurred on both an ubuntu machine and a 10.6.6 mac.",
    "created_at": "2011-01-14T19:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110419",
    "user": "@wdjoyner"
}
```

This applies fine to a clone of sage-4.6.1.rc1. However, it fails a ton of doctests. These might pass if the (optional/experimanetal) spkgs were installed. The point is, it should pass if nothing is installed. However, there were also these:


```

    sage: D.__dict__
Expected:
    {'_sandpile': Digraph on 3 vertices, '_effective_div': [{0: 2, 1: 0, 2: 0}, {0: 0, 1: 1, 2: 1}], '_linear_system': {'inhomog': [[1, 0, 0], [0, -1, -1], [0, 0, 0]], 'num_inhomog': 3, 'num_homog': 2, 'homog': [[-1, -1, -1], [1, 1, 1]]}, '_vertices': [0, 1, 2]}
Got:
    {'_sandpile': Digraph on 3 vertices, '_vertices': [0, 1, 2]}
```

and

```

    sage: D._set_linear_system()
Expected nothing
Got:
    <BLANKLINE>
                     **********************************
                     *** This method requires 4ti2. ***
                     **********************************
    <BLANKLINE>
                Read the beginning of sandpile.sage or see the Sage Sandpiles
                documentation for installation instructions.
    <BLANKLINE>
}}
for example.

This occurred on both an ubuntu machine and a 10.6.6 mac.



---

archive/issue_comments_110420.json:
```json
{
    "body": "Thanks for taking a look.  I'll try to fix this up.  I think the 4ti2 functions can be flagged \"optional\".",
    "created_at": "2011-01-15T18:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110420",
    "user": "mhampton"
}
```

Thanks for taking a look.  I'll try to fix this up.  I think the 4ti2 functions can be flagged "optional".



---

archive/issue_comments_110421.json:
```json
{
    "body": "OK, all tests pass for me now and the coverage is 100%.\n\nThe only problem that I see now is how to deal with namespace issues.  I think classes like \"Divisor\" have too general a name to get imported into Sage at the top level, which is what this patch currently does.  I see three alternatives at least:\n\n1) Rename functions and classes to be clearly sandpile specific.  E.g., rename the Divisor class to something like SandpileDivisor.  \n\n2) Don't import this module into the namespace at all, so users would have to do: \n\n```\nsage: from sage.sandpiles import * \n```\n\nthemselves.\n\n3) Import the module in its own namespace, so for instance you would have to do:\n\n```\nsage: S = sandpiles.complete_sandpile(4)\n```\n\n\nI would rank these as 1 > 2 > 3, but this is an important decision since it will be a pain to change later.",
    "created_at": "2011-01-16T10:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110421",
    "user": "mhampton"
}
```

OK, all tests pass for me now and the coverage is 100%.

The only problem that I see now is how to deal with namespace issues.  I think classes like "Divisor" have too general a name to get imported into Sage at the top level, which is what this patch currently does.  I see three alternatives at least:

1) Rename functions and classes to be clearly sandpile specific.  E.g., rename the Divisor class to something like SandpileDivisor.  

2) Don't import this module into the namespace at all, so users would have to do: 

```
sage: from sage.sandpiles import * 
```

themselves.

3) Import the module in its own namespace, so for instance you would have to do:

```
sage: S = sandpiles.complete_sandpile(4)
```


I would rank these as 1 > 2 > 3, but this is an important decision since it will be a pain to change later.



---

archive/issue_comments_110422.json:
```json
{
    "body": "Replying to [comment:6 mhampton]:\n> OK, all tests pass for me now and the coverage is 100%.\n> \n\n\nNot for me:\n\n\n```\nsage -t -force_lib \"devel/sage/sage/sandpiles/sandpile.py\"  \n**********************************************************************\nFile \"/Users/wdj/sagefiles/sage-4.6.1.rc1/devel/sage/sage/sandpiles/sandpile.py\", line 5173:\n    sage: for p in P:\n       sum([partition_sandpile(S, i).betti(verbose=False)[-Integer(1)] for i in p])\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/wdj/sagefiles/sage-4.6.1.rc1/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/wdj/sagefiles/sage-4.6.1.rc1/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/wdj/sagefiles/sage-4.6.1.rc1/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_160[3]>\", line 1, in <module>\n        for p in P:###line 5173:\n    sage: for p in P:\n    NameError: name 'P' is not defined\n**********************************************************************\n1 items had failures:\n   1 of   5 in __main__.example_160\n***Test Failed*** 1 failures.\n```\n\nThis sort of failure occurs on both a 10.6.6 imac and an ubuntu machine.\n\n\n> The only problem that I see now is how to deal with namespace issues.  \n> I think classes like \"Divisor\" have too general a name to get imported into \n> Sage at the top level, which is what this patch currently does.  \n> I see three alternatives at least:\n> \n> 1) Rename functions and classes to be clearly sandpile specific.  \n> E.g., rename the Divisor class to something like SandpileDivisor.  \n> \n\n\nI agree. I actually suggested this when David P was asking for suggestions\nyears ago in reply to his post asking for comments on a first version.",
    "created_at": "2011-01-16T17:10:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110422",
    "user": "@wdjoyner"
}
```

Replying to [comment:6 mhampton]:
> OK, all tests pass for me now and the coverage is 100%.
> 


Not for me:


```
sage -t -force_lib "devel/sage/sage/sandpiles/sandpile.py"  
**********************************************************************
File "/Users/wdj/sagefiles/sage-4.6.1.rc1/devel/sage/sage/sandpiles/sandpile.py", line 5173:
    sage: for p in P:
       sum([partition_sandpile(S, i).betti(verbose=False)[-Integer(1)] for i in p])
Exception raised:
    Traceback (most recent call last):
      File "/Users/wdj/sagefiles/sage-4.6.1.rc1/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/wdj/sagefiles/sage-4.6.1.rc1/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/wdj/sagefiles/sage-4.6.1.rc1/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_160[3]>", line 1, in <module>
        for p in P:###line 5173:
    sage: for p in P:
    NameError: name 'P' is not defined
**********************************************************************
1 items had failures:
   1 of   5 in __main__.example_160
***Test Failed*** 1 failures.
```

This sort of failure occurs on both a 10.6.6 imac and an ubuntu machine.


> The only problem that I see now is how to deal with namespace issues.  
> I think classes like "Divisor" have too general a name to get imported into 
> Sage at the top level, which is what this patch currently does.  
> I see three alternatives at least:
> 
> 1) Rename functions and classes to be clearly sandpile specific.  
> E.g., rename the Divisor class to something like SandpileDivisor.  
> 


I agree. I actually suggested this when David P was asking for suggestions
years ago in reply to his post asking for comments on a first version.



---

archive/issue_comments_110423.json:
```json
{
    "body": "Supersedes previous patch.",
    "created_at": "2011-01-16T23:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110423",
    "user": "mhampton"
}
```

Supersedes previous patch.



---

archive/issue_comments_110424.json:
```json
{
    "body": "Attachment [trac_10618_sandpiles.patch](tarball://root/attachments/some-uuid/ticket10618/trac_10618_sandpiles.patch) by mhampton created at 2011-01-16 23:39:28\n\nSorry about that, I'm not sure how I missed that.  I have tried once again, new patch has same name as the last one.",
    "created_at": "2011-01-16T23:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110424",
    "user": "mhampton"
}
```

Attachment [trac_10618_sandpiles.patch](tarball://root/attachments/some-uuid/ticket10618/trac_10618_sandpiles.patch) by mhampton created at 2011-01-16 23:39:28

Sorry about that, I'm not sure how I missed that.  I have tried once again, new patch has same name as the last one.



---

archive/issue_comments_110425.json:
```json
{
    "body": "This installed and pases sage -testall on imac running 10.6.6 and sage-4.6.1.rc1. However, the instll of 4ti2 failed. I'll try it on a linux machine.",
    "created_at": "2011-01-17T14:41:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110425",
    "user": "@wdjoyner"
}
```

This installed and pases sage -testall on imac running 10.6.6 and sage-4.6.1.rc1. However, the instll of 4ti2 failed. I'll try it on a linux machine.



---

archive/issue_comments_110426.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-01-17T17:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110426",
    "user": "@wdjoyner"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110427.json:
```json
{
    "body": "Replying to [comment:9 wdj]:\n> This installed and passes sage -testall on imac running 10.6.6 and \n> sage-4.6.1.rc1. However, the install of 4ti2 failed. I'll try it on a linux machine.\n\nTo be more precise, the instuctions on installing 4ti2 given in the\ndocstrings to this module fail. If you instead use the instructions \ngiven in http://trac.sagemath.org/sage_trac/ticket/8217#comment:5\nthen 4ti2 does install fine.\n\nI'll report back on the results of running sage -testall -optional ASAP.",
    "created_at": "2011-01-17T17:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110427",
    "user": "@wdjoyner"
}
```

Replying to [comment:9 wdj]:
> This installed and passes sage -testall on imac running 10.6.6 and 
> sage-4.6.1.rc1. However, the install of 4ti2 failed. I'll try it on a linux machine.

To be more precise, the instuctions on installing 4ti2 given in the
docstrings to this module fail. If you instead use the instructions 
given in http://trac.sagemath.org/sage_trac/ticket/8217#comment:5
then 4ti2 does install fine.

I'll report back on the results of running sage -testall -optional ASAP.



---

archive/issue_comments_110428.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-01-17T22:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110428",
    "user": "@wdjoyner"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_110429.json:
```json
{
    "body": "This looks good in the sense that the docstrings do not fail after 4ti2 (and glpk) is added.\n\nI am willing to give this a positive review. However, there are still some problems with the docstrings - (a) the naming issue mentioned above, (b) one date in the AUTHOR field has the wrong year, (c) the instructions on installing 4ti2 lead to the old package which does not install. \n\nShould these be fixed in a separate ticket?",
    "created_at": "2011-01-17T22:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110429",
    "user": "@wdjoyner"
}
```

This looks good in the sense that the docstrings do not fail after 4ti2 (and glpk) is added.

I am willing to give this a positive review. However, there are still some problems with the docstrings - (a) the naming issue mentioned above, (b) one date in the AUTHOR field has the wrong year, (c) the instructions on installing 4ti2 lead to the old package which does not install. 

Should these be fixed in a separate ticket?



---

archive/issue_comments_110430.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2011-01-18T02:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110430",
    "user": "mhampton"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_110431.json:
```json
{
    "body": "No, I think we should get this pretty much right before it officially goes in - it would be annoying to change names later since we'd have to formally deprecate everything.  I'll ask David Perkinson directly what he thinks about the namespace issues.",
    "created_at": "2011-01-18T02:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110431",
    "user": "mhampton"
}
```

No, I think we should get this pretty much right before it officially goes in - it would be annoying to change names later since we'd have to formally deprecate everything.  I'll ask David Perkinson directly what he thinks about the namespace issues.



---

archive/issue_comments_110432.json:
```json
{
    "body": "Attachment [trac_10618_sandpiles.2.patch](tarball://root/attachments/some-uuid/ticket10618/trac_10618_sandpiles.2.patch) by mhampton created at 2011-01-27 04:51:32",
    "created_at": "2011-01-27T04:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110432",
    "user": "mhampton"
}
```

Attachment [trac_10618_sandpiles.2.patch](tarball://root/attachments/some-uuid/ticket10618/trac_10618_sandpiles.2.patch) by mhampton created at 2011-01-27 04:51:32



---

archive/issue_comments_110433.json:
```json
{
    "body": "David Perkinson is OK with the idea of renaming some functions and classes to avoid confusion in the top namespace.  The attached patch - trac_10618_sandpiles.2.patch - is a first attempt at resolving this aspect of the module.",
    "created_at": "2011-01-27T04:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110433",
    "user": "mhampton"
}
```

David Perkinson is OK with the idea of renaming some functions and classes to avoid confusion in the top namespace.  The attached patch - trac_10618_sandpiles.2.patch - is a first attempt at resolving this aspect of the module.



---

archive/issue_comments_110434.json:
```json
{
    "body": "Applying only trac_10618_sandpiles.2.patch to 4.6.1.rc0 on an ubuntu machine resulted in all tests passed in sage -testall. This is without 4ti2.\n\nI think you still need\nhttp://sage.math.washington.edu/home/mhampton/4ti2-1.3.2.p1.spkg\nas opposed to the version on the sage webpage.\nI will test this next.\n\nAlso, I think you need to add to the intro of this ticket that only the last patch need be applied.",
    "created_at": "2011-02-01T12:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110434",
    "user": "@wdjoyner"
}
```

Applying only trac_10618_sandpiles.2.patch to 4.6.1.rc0 on an ubuntu machine resulted in all tests passed in sage -testall. This is without 4ti2.

I think you still need
http://sage.math.washington.edu/home/mhampton/4ti2-1.3.2.p1.spkg
as opposed to the version on the sage webpage.
I will test this next.

Also, I think you need to add to the intro of this ticket that only the last patch need be applied.



---

archive/issue_comments_110435.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-02-01T12:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110435",
    "user": "@wdjoyner"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110436.json:
```json
{
    "body": "Replying to [comment:14 wdj]:\n> Applying only trac_10618_sandpiles.2.patch to 4.6.1.rc0 on an ubuntu machine resulted in all tests passed in sage -testall. This is without 4ti2.\n> \n> I think you still need\n> http://sage.math.washington.edu/home/mhampton/4ti2-1.3.2.p1.spkg\n> as opposed to the version on the sage webpage.\n> I will test this next.\n\nAll tests passed! Positive review, though the ticket\nhttp://trac.sagemath.org/sage_trac/ticket/8217 is related...\n\nThanks Marshall!\n\n\n> \n> Also, I think you need to add to the intro of this ticket that only the last patch need be applied.",
    "created_at": "2011-02-02T14:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110436",
    "user": "@wdjoyner"
}
```

Replying to [comment:14 wdj]:
> Applying only trac_10618_sandpiles.2.patch to 4.6.1.rc0 on an ubuntu machine resulted in all tests passed in sage -testall. This is without 4ti2.
> 
> I think you still need
> http://sage.math.washington.edu/home/mhampton/4ti2-1.3.2.p1.spkg
> as opposed to the version on the sage webpage.
> I will test this next.

All tests passed! Positive review, though the ticket
http://trac.sagemath.org/sage_trac/ticket/8217 is related...

Thanks Marshall!


> 
> Also, I think you need to add to the intro of this ticket that only the last patch need be applied.



---

archive/issue_comments_110437.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-02-02T14:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110437",
    "user": "@wdjoyner"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110438.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-02-22T17:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110438",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110439.json:
```json
{
    "body": "The commit message of the patch should contain the ticket number.",
    "created_at": "2011-02-22T17:04:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110439",
    "user": "@jdemeyer"
}
```

The commit message of the patch should contain the ticket number.



---

archive/issue_comments_110440.json:
```json
{
    "body": "I get various doctest failures:\n\n```\nsage -t  -force_lib devel/sage/sage/sandpiles/sandpile.py\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha2/devel/sage-main/sage/sandpiles/sandpile.py\", line 1815:\n    sage: S.unsaturated_ideal().gens()\nExpected:\n    (x1^3 - x4*x3*x0, x2^3 - x5*x3*x0, x3^2 - x5*x2, x4^2 - x3*x1, x5^2 - x3*x2)\nGot:\n    [x1^3 - x4*x3*x0, x2^3 - x5*x3*x0, x3^2 - x5*x2, x4^2 - x3*x1, x5^2 - x3*x2]\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha2/devel/sage-main/sage/sandpiles/sandpile.py\", line 1817:\n    sage: S.ideal().gens()\nExpected:\n    (x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2)\nGot:\n    [x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2]\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha2/devel/sage-main/sage/sandpiles/sandpile.py\", line 1840:\n    sage: S.ideal(True)\nExpected:\n    (x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2)\nGot:\n    [x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2]\n**********************************************************************\nFile \"/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha2/devel/sage-main/sage/sandpiles/sandpile.py\", line 1842:\n    sage: S.ideal().gens()  # another way to get the generators\nExpected:\n    (x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2)\nGot:\n    [x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2]\n**********************************************************************\n```\n",
    "created_at": "2011-03-04T13:27:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110440",
    "user": "@jdemeyer"
}
```

I get various doctest failures:

```
sage -t  -force_lib devel/sage/sage/sandpiles/sandpile.py
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha2/devel/sage-main/sage/sandpiles/sandpile.py", line 1815:
    sage: S.unsaturated_ideal().gens()
Expected:
    (x1^3 - x4*x3*x0, x2^3 - x5*x3*x0, x3^2 - x5*x2, x4^2 - x3*x1, x5^2 - x3*x2)
Got:
    [x1^3 - x4*x3*x0, x2^3 - x5*x3*x0, x3^2 - x5*x2, x4^2 - x3*x1, x5^2 - x3*x2]
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha2/devel/sage-main/sage/sandpiles/sandpile.py", line 1817:
    sage: S.ideal().gens()
Expected:
    (x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2)
Got:
    [x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2]
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha2/devel/sage-main/sage/sandpiles/sandpile.py", line 1840:
    sage: S.ideal(True)
Expected:
    (x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2)
Got:
    [x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2]
**********************************************************************
File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.7.alpha2/devel/sage-main/sage/sandpiles/sandpile.py", line 1842:
    sage: S.ideal().gens()  # another way to get the generators
Expected:
    (x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2)
Got:
    [x2 - x0, x3^2 - x5*x0, x5*x3 - x0^2, x4^2 - x3*x1, x5^2 - x3*x0, x1^3 - x4*x3*x0, x4*x1^2 - x5*x0^2]
**********************************************************************
```




---

archive/issue_comments_110441.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-14T12:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110441",
    "user": "mhampton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110442.json:
```json
{
    "body": "Installs fine to 4.7.a1 and passes sage -testall.",
    "created_at": "2011-03-14T14:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110442",
    "user": "@wdjoyner"
}
```

Installs fine to 4.7.a1 and passes sage -testall.



---

archive/issue_comments_110443.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-14T14:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110443",
    "user": "@wdjoyner"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110444.json:
```json
{
    "body": "Again: you should change the commit message of the patch such that the first line mentions the ticket number.  Use `hg qrefresh -e` for that.",
    "created_at": "2011-03-16T11:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110444",
    "user": "@jdemeyer"
}
```

Again: you should change the commit message of the patch such that the first line mentions the ticket number.  Use `hg qrefresh -e` for that.



---

archive/issue_comments_110445.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-03-16T11:28:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110445",
    "user": "@jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_110446.json:
```json
{
    "body": "On which machine did you check where to write \"# long time\"?  It seems that most of these \"long time\" doctests take less than 1 second on `sage.math.washington.edu`, which means that they should not be marked \"long time\".\n\nFor example, this doctest on line 196::\n\n```\nsage: from sage.sandpiles import *\nsage: g = {0: {},                    \\\n               1: {0: 1, 2: 1, 3: 1},    \\\n               2: {1: 1, 3: 1, 4: 1},    \\\n               3: {1: 1, 2: 1, 4: 1},    \\\n               4: {2: 1, 3: 1}}\nsage: S = Sandpile(g,0)\nsage: S.resolution() # long time (minutes)\n'R^1 <-- R^7 <-- R^15 <-- R^13 <-- R^4'\n```\n\n\nEven though the test claims \"minutes\", in reality it takes about half a second.",
    "created_at": "2011-03-19T17:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110446",
    "user": "@jdemeyer"
}
```

On which machine did you check where to write "# long time"?  It seems that most of these "long time" doctests take less than 1 second on `sage.math.washington.edu`, which means that they should not be marked "long time".

For example, this doctest on line 196::

```
sage: from sage.sandpiles import *
sage: g = {0: {},                    \
               1: {0: 1, 2: 1, 3: 1},    \
               2: {1: 1, 3: 1, 4: 1},    \
               3: {1: 1, 2: 1, 4: 1},    \
               4: {2: 1, 3: 1}}
sage: S = Sandpile(g,0)
sage: S.resolution() # long time (minutes)
'R^1 <-- R^7 <-- R^15 <-- R^13 <-- R^4'
```


Even though the test claims "minutes", in reality it takes about half a second.



---

archive/issue_comments_110447.json:
```json
{
    "body": "Apply only this patch.",
    "created_at": "2011-03-19T19:53:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110447",
    "user": "mhampton"
}
```

Apply only this patch.



---

archive/issue_comments_110448.json:
```json
{
    "body": "Attachment [trac_10618_sandpiles.3.patch](tarball://root/attachments/some-uuid/ticket10618/trac_10618_sandpiles.3.patch) by mhampton created at 2011-03-19 19:55:48\n\nI'm not sure why those used to take so much longer.  Its possible that some changes in the Singular interface since then sped things up.  Anyway, now testing everything without the 4ti2 dependencies takes abour 24 seconds on my laptop, and including the 4ti2 stuff it takes about 30 seconds.  So I removed all the \"long time\" flags.\n\nI also put the ticket number on the commit message.",
    "created_at": "2011-03-19T19:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110448",
    "user": "mhampton"
}
```

Attachment [trac_10618_sandpiles.3.patch](tarball://root/attachments/some-uuid/ticket10618/trac_10618_sandpiles.3.patch) by mhampton created at 2011-03-19 19:55:48

I'm not sure why those used to take so much longer.  Its possible that some changes in the Singular interface since then sped things up.  Anyway, now testing everything without the 4ti2 dependencies takes abour 24 seconds on my laptop, and including the 4ti2 stuff it takes about 30 seconds.  So I removed all the "long time" flags.

I also put the ticket number on the commit message.



---

archive/issue_comments_110449.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-03-19T19:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110449",
    "user": "mhampton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_110450.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-03-19T22:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110450",
    "user": "@wdjoyner"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_110451.json:
```json
{
    "body": "Installs fine to 4.7.a1 and passes sage -testall.\n\nHope this stays as a positive review this time.\n\nThanks again Marshall for creating this.",
    "created_at": "2011-03-19T22:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110451",
    "user": "@wdjoyner"
}
```

Installs fine to 4.7.a1 and passes sage -testall.

Hope this stays as a positive review this time.

Thanks again Marshall for creating this.



---

archive/issue_comments_110452.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-03-21T09:42:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110452",
    "user": "@jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_110453.json:
```json
{
    "body": "It seems that testing this module can give enormously different timings depending on the machine.  Any clue why?\n\nOn `sage.math.washington.edu`:\n\n\n```\n$ ./sage -t \"devel/sage/sage/sandpiles/sandpile.py\"\n[...]\nTotal time for all tests: 23.7 seconds\n```\n\n\nBut on my laptop (Gentoo Linux, Intel Core 2 Duo, gcc 4.4.3):\n\n```\n$ ./sage -t \"devel/sage/sage/sandpiles/sandpile.py\"\nsage -t  \"devel/sage/sage/sandpiles/sandpile.py\"\n*** *** Error: TIMED OUT! PROCESS KILLED! *** ***\n```\n\n(i.e. it takes more than 360 seconds)",
    "created_at": "2011-04-18T16:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110453",
    "user": "@jdemeyer"
}
```

It seems that testing this module can give enormously different timings depending on the machine.  Any clue why?

On `sage.math.washington.edu`:


```
$ ./sage -t "devel/sage/sage/sandpiles/sandpile.py"
[...]
Total time for all tests: 23.7 seconds
```


But on my laptop (Gentoo Linux, Intel Core 2 Duo, gcc 4.4.3):

```
$ ./sage -t "devel/sage/sage/sandpiles/sandpile.py"
sage -t  "devel/sage/sage/sandpiles/sandpile.py"
*** *** Error: TIMED OUT! PROCESS KILLED! *** ***
```

(i.e. it takes more than 360 seconds)



---

archive/issue_comments_110454.json:
```json
{
    "body": "Please check the thread\n[http://groups.google.com/group/sage-devel/browse_thread/thread/5db90b3681e7dbcb](http://groups.google.com/group/sage-devel/browse_thread/thread/5db90b3681e7dbcb)\n\nSomething fishy with the `sandpile.py` timings...",
    "created_at": "2011-04-18T16:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10565#issuecomment-110454",
    "user": "@jdemeyer"
}
```

Please check the thread
[http://groups.google.com/group/sage-devel/browse_thread/thread/5db90b3681e7dbcb](http://groups.google.com/group/sage-devel/browse_thread/thread/5db90b3681e7dbcb)

Something fishy with the `sandpile.py` timings...
