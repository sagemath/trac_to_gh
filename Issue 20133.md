# Issue 20133: generic GCD-free basis

Issue created by migration from https://trac.sagemath.org/ticket/20370

Original creator: mmezzarobba

Original creation time: 2016-04-06 12:12:53




---

Comment by mmezzarobba created at 2016-04-06 12:13:49

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2016-04-06 12:13:49

New commits:


---

Comment by bruno created at 2016-04-18 09:23:14

Salut Marc ! I have doubts concerning the return type of this new function. First, I always wonder one should use Python's `set` or Sage's `Set`. But also I wonder whether these bases should be returned as sets: In all cases I've found (≠ all cases, probably), bases are returned as lists (or `PolynomialSequence_generic` for polynomials) and not sets. Wouldn't it be more consistent to return a list there too?


---

Comment by mmezzarobba created at 2016-04-18 11:10:52

Hi Bruno,

Replying to [comment:2 bruno]:
> Salut Marc ! I have doubts concerning the return type of this new function. First, I always wonder one should use Python's `set` or Sage's `Set`. But also I wonder whether these bases should be returned as sets: In all cases I've found (≠ all cases, probably), bases are returned as lists (or `PolynomialSequence_generic` for polynomials) and not sets. Wouldn't it be more consistent to return a list there too?

Thanks for your comment. I have no opinion on the matter, and I'd be happy to change the return type to whatever you prefer.


---

Comment by bruno created at 2016-04-19 08:52:10

Replying to [comment:3 mmezzarobba]:
> Hi Bruno,
> 
> Replying to [comment:2 bruno]:
> > Salut Marc ! I have doubts concerning the return type of this new function. First, I always wonder one should use Python's `set` or Sage's `Set`. But also I wonder whether these bases should be returned as sets: In all cases I've found (≠ all cases, probably), bases are returned as lists (or `PolynomialSequence_generic` for polynomials) and not sets. Wouldn't it be more consistent to return a list there too?
> 
> Thanks for your comment. I have no opinion on the matter, and I'd be happy to change the return type to whatever you prefer.

I propose you to return a `Sequence` with `universe=self`. 

Another (minor) point: If the elements in the sequence do not belong to `self`, the exception is not very clear. For instance:


```python
sage: R.<x> = QQ[]
sage: QQ.gcd_free_basis([x+1,x+2])
Traceback (most recent call last):
...
TypeError: not a constant polynomial
```


You may catch the exception and raise your own `TypeError: the elements you provided do not belong to QQ` (or something similar). Actually I ran into the exact example I paste above...

Apart from this remarks, this looks good to me!


---

Comment by git created at 2016-05-18 08:59:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2016-05-18 09:05:23

Replying to [comment:4 bruno]:
> I propose you to return a `Sequence` with `universe=self`. 

Done.

> You may catch the exception and raise your own `TypeError: the elements you provided do not belong to QQ` (or something similar). Actually I ran into the exact example I paste above...

I improved `Sequence()` itself instead. Of course, I can move the corresponding commits to another ticket if you don't feel like reviewing them.


---

Comment by bruno created at 2016-05-18 13:13:16

Replying to [comment:6 mmezzarobba]:
> > You may catch the exception and raise your own `TypeError: the elements you provided do not belong to QQ` (or something similar). Actually I ran into the exact example I paste above...
> 
> I improved `Sequence()` itself instead. Of course, I can move the corresponding commits to another ticket if you don't feel like reviewing them.

I would prefer another ticket: As it is, if you remove the commits about `Sequence()`, I am ready to set it to positive review. I am much less confident on the code involving `Sequence` and need more time (or another reviewer...)!

A comment still on the `Sequence()` part: Should'nt the error message explicitly mention that there is a conflict with the universe? Something like 
`unable to convert {} to an element of the universe ({})".format(x[i], universe))`


---

Comment by git created at 2016-05-18 13:42:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by bruno created at 2016-05-18 13:48:43

Changing status from needs_review to positive_review.


---

Comment by bruno created at 2016-05-18 13:48:43

Looks good to me!


---

Comment by mmezzarobba created at 2016-05-18 13:54:01

Thanks for the review!

Replying to [comment:7 bruno]:
> I would prefer another ticket: As it is, if you remove the commits about `Sequence()`, I am ready to set it to positive review. I am much less confident on the code involving `Sequence` and need more time (or another reviewer...)!

Done (#20621).

> A comment still on the `Sequence()` part: Should'nt the error message explicitly mention that there is a conflict with the universe? Something like 
> `unable to convert {} to an element of the universe ({})".format(x[i], universe))` 

I don't think so: when `Sequence()` is used internally by another function (e.g. in the present case), it will be clear that the function needs to somehow convert some elements to a given parent, but it doesn't matter that this parent is the universe of some Sequence (and that may even make the error more confusing to casual users)...


---

Comment by vbraun created at 2016-05-19 22:38:59

Resolution: fixed
