# Issue 17268: implement symbolic product

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-12-15 07:20:23

CC:  charpent

The ticket would have to decide which of (Maxima,SymPy) would be used as default for this. 

```
sage: import sympy
sage: x = sympy.Symbol('x')
sage: n = sympy.Symbol('n')
sage: sympy.product(x, (x, 1, n))
factorial(n)
```


Any Maxima implementation likely depends on #17502.


---

Comment by rws created at 2017-02-22 14:11:18

Note that if #20179 is implemented it has to be adapted when symbolic products are made available.


---

Comment by charpent created at 2017-05-02 06:41:34

Cut'n paste of the description of #22914 (duplicate ticket), at the request of the present ticket's author.

Note : Couldn't we cut'n'paste the recent code for symbolic sums (#21645) ?


---

Comment by rws created at 2017-05-02 07:10:03

Replying to [comment:5 charpent]:
> Note : Couldn't we cut'n'paste the recent code for symbolic sums (#21645) ?

Yes, but as you can see with #22844 it may not work 100%.


---

Comment by mforets created at 2017-05-07 09:15:41

do you mind adding `giac='product'` ? 

since:


```
sage: giac('product(x, x, 1, n)')
n!
sage: _.sage()
factorial(n)
```

----
New commits:


---

Comment by git created at 2017-05-08 08:48:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-05-08 08:55:44

Changing status from new to needs_review.


---

Comment by rws created at 2017-05-08 08:55:44

This doesn't have the `prod` interface (other ticket) and some docs are missing but everything should work. Question: where does SymPy differ from Maxima?


---

Comment by charpent created at 2017-05-08 13:40:25

Changing status from needs_review to needs_work.


---

Comment by charpent created at 2017-05-08 13:40:25

Replying to [comment:11 rws]:
> This doesn't have the `prod` interface (other ticket) and some docs are missing but everything should work. Question: where does SymPy differ from Maxima?

First of all, thank you very much for this addition, which should enhance Sage's usefulness fo high-school/undergrad levels.

However, `ptestlong` gives three failures :

```
----------------------------------------------------------------------
sage -t --long src/sage/calculus/calculus.py  # 5 doctests failed
sage -t --long src/sage/combinat/posets/posets.py  # 1 doctest failed
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```


The second and third ones have been [reported](https://groups.google.com/d/msg/sage-release/UdllnAJFufA/-e8ArqwFBAAJ) for 8.0.beta4 and are seen again in 8.0beta5. Nothing new here, so probably not related.

The third one is new :

```
charpent`@`asus16-ec:/usr/local/sage-8$ sage -t --long src/sage/calculus/calculus.py
too many failed tests, not using stored timings
Running doctests with ID 2017-05-08-14-44-39-93705f01.
Git branch: t/17505/implement_symbolic_product
Using --optional=database_gap,giacpy_sage,git_trac,mpir,python2,sage
Doctesting 1 file.
sage -t --long src/sage/calculus/calculus.py
**********************************************************************
File "src/sage/calculus/calculus.py", line 843, in sage.calculus.calculus.symbolic_prod
Failed example:
    symbolic_prod(x + i*(i+1)/2, i, 1, 4)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.calculus.symbolic_prod[3]>", line 1, in <module>
        symbolic_prod(x + i*(i+Integer(1))/Integer(2), i, Integer(1), Integer(4))
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 860, in symbolic_prod
        raise TypeError("need a multiplication variable")
    TypeError: need a multiplication variable
**********************************************************************
File "src/sage/calculus/calculus.py", line 845, in sage.calculus.calculus.symbolic_prod
Failed example:
    symbolic_prod(i^2, i, 1, 7)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.calculus.symbolic_prod[4]>", line 1, in <module>
        symbolic_prod(i**Integer(2), i, Integer(1), Integer(7))
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 860, in symbolic_prod
        raise TypeError("need a multiplication variable")
    TypeError: need a multiplication variable
**********************************************************************
File "src/sage/calculus/calculus.py", line 848, in sage.calculus.calculus.symbolic_prod
Failed example:
    symbolic_prod(f(i), i, 1, 7)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.calculus.symbolic_prod[6]>", line 1, in <module>
        symbolic_prod(f(i), i, Integer(1), Integer(7))
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 860, in symbolic_prod
        raise TypeError("need a multiplication variable")
    TypeError: need a multiplication variable
**********************************************************************
File "src/sage/calculus/calculus.py", line 850, in sage.calculus.calculus.symbolic_prod
Failed example:
    symbolic_prod(f(i), i, 1, n)
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 509, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 872, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.calculus.calculus.symbolic_prod[7]>", line 1, in <module>
        symbolic_prod(f(i), i, Integer(1), n)
      File "/usr/local/sage-8/local/lib/python2.7/site-packages/sage/calculus/calculus.py", line 860, in symbolic_prod
        raise TypeError("need a multiplication variable")
    TypeError: need a multiplication variable
**********************************************************************
File "src/sage/calculus/calculus.py", line 1489, in sage.calculus.calculus.laplace
Failed example:
    laplace(t^n, t, s, algorithm='giac')
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: Unable to parse Giac output: integrate(t^n*exp(-s*t),t,0,+infinity)
Got:
    integration(t^n*e^(-s*t), t, 0, +Infinity)
**********************************************************************
2 items had failures:
   1 of  39 in sage.calculus.calculus.laplace
   4 of  11 in sage.calculus.calculus.symbolic_prod
    [429 tests, 5 failures, 9.57 s]
----------------------------------------------------------------------
sage -t --long src/sage/calculus/calculus.py  # 5 doctests failed
----------------------------------------------------------------------
Total time for all tests: 9.6 seconds
    cpu time: 9.1 seconds
    cumulative wall time: 9.6 seconds
```


The last one is identical to one already seen in 8.0.beta4 and 8.0.beta5 ; again, nothing new, else probably not related. The four first ones seem identical : aren't they related to an undeclared variable ?

- A couple suggestions, of varying importance :

    1. (major) the interface methods ("symbolic_expression.prod" (or product)) and function(s) ("symbolic_product", parallelling "symbolic_sum") are necessary for easy use of this new functionality.

    2. (minor) for aesthetics and consistency, could we have for sage.functions.other.symbolic_sum (aka Function_sum) (almost) the same _print_latex_ function you defined in sage.functions.other.symbolic_product (aka Function_prod) ?

    3. ((very) minor) consider a "mathematica" method, parallelling tye one in symbolic_sum (necessary for would-be Mathematica users, since mathematica.Sum(X(j), [j,1,p]) give utter nonsense currently).

- A question : can #22937 depend on this ?

- And a possible doctest, demonstrating that this formal mayhem has a mathematical sense :

```
sage: var("j,p", domain="integer")
(j, p)
sage: X=function("X")
sage: sage.functions.other.symbolic_product(X(j),j,1,p).log().log_expand()
sum(log(X(j)), j, 1, p)
```


==>`needs_work`


---

Comment by git created at 2017-05-11 06:57:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-05-11 06:58:24

Changing status from needs_work to needs_review.


---

Comment by rws created at 2017-05-11 06:59:06

Ah sorry just a moment, I'll address your other issues ASAP.


---

Comment by charpent created at 2017-05-11 07:19:54

Replying to [comment:15 rws]:
> Ah sorry just a moment, I'll address your other issues ASAP.

Those were just //suggestions//, not //requests// ;-)

Unless you have other suggestions, I'll implement the "symbolic product of product" case in #22937 ASAP, and depend on the present ticket.


---

Comment by rws created at 2017-05-11 07:38:18

Replying to [comment:12 charpent]:
>     1. (major) the interface methods ("symbolic_expression.prod" (or product))

Yes, but in a different ticket.

> - A question : can #22937 depend on this ?

Yes you can state the dependency in the ticket form, but please wait with merging this branch, as I'll change the branch probably.

Agree to everything else.


---

Comment by charpent created at 2017-05-11 08:14:33

Replying to [comment:17 rws]:
> Replying to [comment:12 charpent]:
> >     1. (major) the interface methods ("symbolic_expression.prod" (or product))
> 
> Yes, but in a different ticket.

Okay. I'll take that in mind when implementing (and doctesting) #22937.

> 
> > - A question : can #22937 depend on this ?
> 
> Yes you can state the dependency in the ticket form, but please wait with merging this branch, as I'll change the branch probably.

Okay also : I'll marl the dependency before starting the implementation of the multiplicative case. Should I wait your say so before reviewing the ticket ? Or should I review it in its current state ?

Suggestion : mark it as `needs_work` before reworkiong it and `needs_review` when satisfied with (a step of) your work.
 
> Agree to everything else.

Thanks !


---

Comment by git created at 2017-05-11 08:16:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-05-11 08:17:00

OK, which doctests are still missing?


---

Comment by rws created at 2017-05-11 08:19:10

Replying to [comment:18 charpent]:
> Should I wait your say so before reviewing the ticket ? Or should I review it in its current state ?

Please review now, there may only be some doctests missing.


---

Comment by charpent created at 2017-05-11 08:35:40

Replying to [comment:21 rws]:
> Replying to [comment:18 charpent]:
> > Should I wait your say so before reviewing the ticket ? Or should I review it in its current state ?
> 
> Please review now, there may only be some doctests missing.

Builds OK on top of my `distribute` branch. `ptestlon` running (needs about 1 hour : stay tuned...).


---

Comment by charpent created at 2017-05-11 10:27:37

Passes `ptestlong` with the same failures already reported for 8.0.beta4 and not yet fixed.

===> `positive review`

Waiting your say-so to merge into #22937...


---

Comment by charpent created at 2017-05-11 10:27:37

Changing status from needs_review to positive_review.


---

Comment by rws created at 2017-05-11 13:16:26

Thanks.

Replying to [comment:23 charpent]:
> Waiting your say-so to merge into #22937...

Please go ahead.


---

Comment by rws created at 2017-05-11 13:17:17

Your real name in the Reviewer field is missing, please add.,


---

Comment by charpent created at 2017-05-11 13:27:51

Wups !

Done...


---

Comment by charpent created at 2017-05-12 07:07:01

Slight issue :

```
sage: var("j,p", domain="integer")
(j, p)
sage: X=function("X")
sage: latex(maxima("product(X(j),j,1,p)").sage()^2)
\prod_{j=1}^{p} X(j)^{2}
```

which prints //wrong// (it should be `{\prod_{j=1}^{p} X(j)}^{2`} in order to position the exponent over the whole sum, not the "productand"). The same is true for `sum`.

Care to fix it here or should I open a new ticket (depending on this one) ?


---

Comment by rws created at 2017-05-12 07:13:45

I'll fix it immediately.


---

Comment by git created at 2017-05-12 07:19:45

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2017-05-12 07:19:45

Changing status from positive_review to needs_review.


---

Comment by rws created at 2017-05-12 07:23:01

Replying to [comment:27 charpent]:
> which prints //wrong// (it should be `{\prod_{j=1}^{p} X(j)}^{2`} in order to position the exponent over the whole sum, not the "productand"). The same is true for `sum`.

However, isn't it the duty of power to make the braces?


---

Comment by charpent created at 2017-05-12 08:52:53

Replying to [comment:30 rws]:
> Replying to [comment:27 charpent]:
> > which prints //wrong// (it should be `{\prod_{j=1}^{p} X(j)}^{2`} in order to position the exponent over the whole sum, not the "productand"). The same is true for `sum`.
> 
> However, isn't it the duty of power to make the braces?

Not necessarily. `\sum_{j=1}^p X(j)^2` is mathematically wrong ; however, `{X_{j}}^2` is correct but ugly, whereas `X_{j}^2` is also ((almost) unambiguously) correct and much more pleasant.

There is still an ambiguity, that does not concern us there : tensors. But that's another whole can of worms.

Your patch looks good. `ptestlong` is running and should terminate in about an hour.


---

Comment by charpent created at 2017-05-12 09:52:42

Changing status from needs_review to needs_work.


---

Comment by charpent created at 2017-05-12 09:52:42

Two new failures :

```
sage -t --long src/sage/functions/other.py
**********************************************************************
File "src/sage/functions/other.py", line 2617, in sage.functions.other.Function_
sum._print_latex_
Failed example:
    latex(ssum(x^2, x, 1, 10))
Expected:
    \sum_{x=1}^{10} x^2
Got:
    {\sum_{x=1}^{10} x^2}
**********************************************************************
File "src/sage/functions/other.py", line 2664, in sage.functions.other.Function_prod._print_latex_
Failed example:
    latex(sprod(x^2, x, 1, 10))
Expected:
    \prod_{x=1}^{10} x^2
Got:
    {\prod_{x=1}^{10} x^2}
**********************************************************************
2 items had failures:
   1 of   3 in sage.functions.other.Function_prod._print_latex_
   1 of   3 in sage.functions.other.Function_sum._print_latex_
    [580 tests, 2 failures, 7.13 s]
```


It seems that you forgot to upate your doctests... ;-)

==> `needs work` (pro forma)


---

Comment by git created at 2017-05-12 12:55:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2017-05-12 12:57:06

Changing status from needs_work to needs_review.


---

Comment by rws created at 2017-05-12 12:57:06

Hopefully my reviewers keep their patience. Thanks.


---

Comment by charpent created at 2017-05-12 13:04:41

Replying to [comment:34 rws]:
> Hopefully my reviewers keep their patience. Thanks.

`sage -t --long src/sage/symbolic/expression.pyx` passes with no error. `ptestlong` underway (again, //pro forma//). Stay tuned.


---

Comment by charpent created at 2017-05-12 14:06:03

Changing status from needs_review to positive_review.


---

Comment by charpent created at 2017-05-12 14:06:03

`ptestlong` passes with the known, supposed unrelated failure ; no whoopee cushions.

==>`positive_review`

Since this was tested on top of #22937, the latter is also ready for re-review. Would you mind ?


---

Comment by tscrim created at 2017-05-12 14:15:51

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2017-05-12 14:15:51

`sr_prod` is missing a doctest.


---

Comment by rws created at 2017-05-13 06:01:49

Changing status from needs_work to positive_review.


---

Comment by rws created at 2017-05-13 06:01:49

The ticket was merged up to a point. I'll close it and put the branch with the remaining issues in another ticket. See #22989.


---

Comment by charpent created at 2017-05-13 06:25:50

Replying to [comment:38 rws]:
> The ticket was merged up to a point.
You mean in #22937, I suppose ?
> I'll close it and put the branch with the remaining issues in another ticket. See #22989.
Hmm... Unles I'm mistaken, there are two consequences :
- #22937 should no longer depend on #17505
- #22989 should depend on #22937
Am I right ?


---

Comment by vbraun created at 2017-05-13 10:34:26

Resolution: fixed


---

Comment by vbraun created at 2017-05-13 10:34:26

Sorry, forgot to close this ticket. Move your new commits to a new ticket.
