# Issue 17799: I should not be symbolic

Issue created by migration from https://trac.sagemath.org/ticket/18036

Original creator: vdelecroix

Original creation time: 2015-03-22 11:15:52

CC:  wuthrich jdemeyer mmezzarobba behackl rws @kliem @mwageringel

As suggested in #17860, `I` (so that `I^2 = -1`) should be defined directly as the generator of `QuadraticField(-1)` and not wrapped into a symbolic expression.

Currently, `I` is defined in `sage/symbolic/pynac.pyx` within the function `init_pynac_I`.


---

Comment by nbruin created at 2015-03-22 18:16:04

I'm not so sure it should. Which quadratic field is the appropriate one? There are many, distinguishable by the name of their generator (that would be 'I') for this one, but also by their specified embeddings, and it's not clear which one to choose.

Is there an argument for doing this? Ticket #17860 referenced in the description makes no mention of it. I'd imagine there might be evaluation reasons that might make it attractive. Perhaps those also give an indication of which quadratic field would be the appropriate one.


---

Comment by vdelecroix created at 2015-03-22 21:07:22

Replying to [comment:1 nbruin]:
> I'm not so sure it should. Which quadratic field is the appropriate one? There are many, distinguishable by the name of their generator (that would be 'I') for this one, but also by their specified embeddings, and it's not clear which one to choose.

I also thought of this in the train... and I do not see much possible choices. I found two rather natural choices for the adoption of `I`:
- the ring of integers `Z[sqrt(-1)]` with its natural embedding in `QQbar`
- `QQbar` itself

> Is there an argument for doing this? Ticket #17860 referenced in the description makes no mention of it. I'd imagine there might be evaluation reasons that might make it attractive. Perhaps those also give an indication of which quadratic field would be the appropriate one.

Some reasons (in favor of the first choice):
- `I + 1.0` and `1.0 * I` should be complex numbers
- `factor((I+3))` should be the factorization over the Gaussian integers (i.e. `(-I) * (I + 1) * (2*I + 1)`)
- `abs(I)` should be the integer `1`

Vincent


---

Comment by jdemeyer created at 2015-03-22 22:17:35

`I` should be an element of `QuadraticField(-1, 'I', embedding=CC.gen(), latex_name='i')`, which is what it currently is (see `src/sage/symbolic/pynac.pyx`).


---

Comment by jdemeyer created at 2015-03-22 22:27:00

Replying to [comment:1 nbruin]:
> Is there an argument for doing this?

In short: the same reason that `1` is not symbolic. When doing basic arithmetic with `I`, there is no need for a symbolic `I`. Whenever something symbolic is needed, coercion will make it symbolic.


---

Comment by pbruin created at 2015-03-24 17:08:05

Replying to [comment:2 vdelecroix]:
> I found two rather natural choices for the adoption of `I`:
> - the ring of integers `Z[sqrt(-1)]` with its natural embedding in `QQbar`
The ring `ZZ[sqrt(-1)]` definitely looks like the most natural choice to me, since admits a canonical homomorphism to any other ring with a distinguished square root of -1.

As for the distinguished embedding, is there a specific reason for choosing `QQbar`?  A more minimal choice would be to fix an embedding into a `UniversalCyclotomicField`; then we would have coercion maps `ZZ[I]` -> `UniversalCyclotomicField(zeta)` -> `QQbar` -> `CC`.  (Maybe this makes finding common parents slightly harder, though.)


---

Comment by kcrisman created at 2015-03-24 18:08:10

Thank you all for working on this - this kind of thing has been on the radar for [comment:5:ticket:7545 years] but after Burcin left day-to-day operations around here there hasn't been the combination of energy and know-how to do this "correctly", whatever that might mean.  Just keep in mind it would be nice for `I in SR` to be true, though I'm sure it will be since `1 in SR` already is `True`.  I do like the idea of `abs(I)` being an `Integer` and not a symbolic expression.


---

Comment by mmezzarobba created at 2015-04-15 14:18:18

Proof of concept to see what would break: `u/mmezzarobba/18036-QQi` (I'm using a number field element for now, not an order element, but switching shouldn't be hard). Still needs quite a bit of work, but all tests should pass (I didn't run them all with the last version of the code). Any comment or improvement welcome!

In particular:
* Are there behavior changes that you think are not acceptable, or not acceptable without a deprecation?
* I'm not happy with the changes to `sage.geometry.hyperbolic_space` (which apparently relied on operations involving `I` triggering coercions to `SR`), but I don't understand the code well enough to do better.

Tangentially related: now may be a good time to deprecate (or remove directly?) the bogus coercion from `SR` to `QQbar`.


---

Comment by mmezzarobba created at 2015-04-15 15:27:47

As it turns out, there are a few failures in `complex_mpc.pyx`. But unless I'm mistaken these failures are solved by #14982. And conversely, the present ticket provides a real fix for a problem I only worked around in #14982.


---

Comment by vdelecroix created at 2015-04-15 16:54:56

Very nice that it worked!

I do not quite understand why you need the creation of a new class of `NumberFieldQQi`... is that only for the special method you need in the element class?

For embedding in QQbar I guess that what should be fixed is embedding of number fields. In the ideal world, you would declare:

```
QQi = NumberField(x**2 + 1, 'I', embedding=QQbar.gen())
```

But then, there might be an infinite loop with the definition of `I` in `QQbar`. I had the same sort of troubles when refining default embedding from lazy field to `AA/QQbar`.

Vincent


---

Comment by mmezzarobba created at 2015-04-15 17:13:37

Replying to [comment:10 vdelecroix]:
> I do not quite understand why you need the creation of a new class of `NumberFieldQQi`... is that only for the special method you need in the element class?

I don't remember, it could be that the reason no longer exists due to later changes.

> For embedding in QQbar I guess that what should be fixed is embedding of number fields. In the ideal world, you would declare:
> {{{
> QQi = NumberField(x**2 + 1, 'I', embedding=QQbar.gen())
> }}}

Yes, the idea is to switch to an embedding into QQbar when other number fields do.


---

Comment by mmezzarobba created at 2015-04-18 11:13:05

Replying to [comment:11 mmezzarobba]:
> Replying to [comment:10 vdelecroix]:
> > I do not quite understand why you need the creation of a new class of `NumberFieldQQi`... is that only for the special method you need in the element class?
> 
> I don't remember, it could be that the reason no longer exists due to later changes.

One reason was that having separate classes makes it easy to test if we are in the special case of QQ[i] using `isinstance`. In the case of the parent class, this is convenient when specifying coercions, for instance.


---

Comment by vdelecroix created at 2015-04-18 11:27:45

Replying to [comment:12 mmezzarobba]:
> Replying to [comment:11 mmezzarobba]:
> > Replying to [comment:10 vdelecroix]:
> > > I do not quite understand why you need the creation of a new class of `NumberFieldQQi`... is that only for the special method you need in the element class?
> > 
> > I don't remember, it could be that the reason no longer exists due to later changes.
> 
> One reason was that having separate classes makes it easy to test if we are in the special case of QQ[i] using `isinstance`. In the case of the parent class, this is convenient when specifying coercions, for instance.

Anyway this will be instantiated at startup so why not keeping one instance `QQi` in `sage.rings.number_field.number_field`? (like we have for `ZZ`, `QQ`, etc). Then you can test identity when testing coercions.


---

Comment by mmezzarobba created at 2015-04-18 16:56:16

Replying to [comment:13 vdelecroix]:
> Anyway this will be instantiated at startup so why not keeping one instance `QQi` in `sage.rings.number_field.number_field`? (like we have for `ZZ`, `QQ`, etc).

If I remember right, currently, just adding `QQi = ...()` in the module currently doesn't work due to import order constraints. For now I just kept the creation of QQ[i] happening at the same time as it used to. But that's certainly something we should try to improve after this first draft.

> Then you can test identity when testing coercions.

Yes. Having a separate class would also be natural if we want `I.parent()` to display something less frightening than “Number Field in `I` with defining polynomial `x^2 + 1`”, and more generally to implement features specific to QQ[i]. But I can't really think of anything that makes sense for this field and not for embedded quadratic number fields in general, so perhaps it is better to encourage people to always implement a more general version?

A related question is whether `QQi is NumberField(x^2+1, 'I', embedding=CC.0)` should be true, or if there should be two separate parents.

What do you think?


---

Comment by vdelecroix created at 2015-04-19 11:17:07

Replying to [comment:14 mmezzarobba]:
> Replying to [comment:13 vdelecroix]:
> > Anyway this will be instantiated at startup so why not keeping one instance `QQi` in `sage.rings.number_field.number_field`? (like we have for `ZZ`, `QQ`, etc).
> 
> If I remember right, currently, just adding `QQi = ...()` in the module currently doesn't work due to import order constraints. For now I just kept the creation of QQ[i] happening at the same time as it used to. But that's certainly something we should try to improve after this first draft.

Here we can probably cheat with

```
_QQi = None
def NumberFieldQQi():
    if _QQi is None:
        # build it once for all
        ...
    return _QQi
```


> > Then you can test identity when testing coercions.
> 
> Yes. Having a separate class would also be natural if we want `I.parent()` to display something less frightening than “Number Field in `I` with defining polynomial `x^2 + 1`”, and more generally to implement features specific to QQ[i]. But I can't really think of anything that makes sense for this field and not for embedded quadratic number fields in general, so perhaps it is better to encourage people to always implement a more general version?

Yes! Having a custom representation should be done in the main class. It is already possible:

```
sage: K = QuadraticField(2)
sage: K.rename('It's me')
sage: K
It's me
sage: K.rename(None)
sage: K
Number Field in a with defining polynomial x^2 - 2
```


> A related question is whether `QQi is NumberField(x^2+1, 'I', embedding=CC.0)` should be true, or if there should be two separate parents.
>
> What do you think?

More generally, do we want unique representation for (absolute) number fields? I would tend to say yes. And the natural keys would be:
 - the polynomial
 - the variable name (not of the polynomial!)
 - the embedding

Vincent


---

Comment by mmezzarobba created at 2015-04-19 12:56:43

Replying to [comment:16 vdelecroix]:
> Yes! Having a custom representation should be done in the main class. It is already possible:

If all we want is a different string representation, yes, perhaps it makes sense to use `rename()`...

> > A related question is whether `QQi is NumberField(x^2+1, 'I', embedding=CC.0)` should be true, or if there should be two separate parents.
> >
> > What do you think?
> 
> More generally, do we want unique representation for (absolute) number fields?

I think everyone agrees that absolute number fields should have unique representation. My question was whether Q[i] should _be_ an absolute number field in this sense, or if it should be a “special” object such that people could work with both Q[i]-as-a-subset-of-complex-numbers and Q[i]-as-a-number field, possibly at the same time. I'd prefer a single object as well, but I am sure I have missed some of the implications, so if anyone has arguments in favor of the other option, I would be interested in hearing them.


---

Comment by vdelecroix created at 2015-04-19 13:14:50

Replying to [comment:17 mmezzarobba]:
> > > A related question is whether `QQi is NumberField(x^2+1, 'I', embedding=CC.0)` should be true, or if there should be two separate parents.
> > >
> > > What do you think?
> > 
> > More generally, do we want unique representation for (absolute) number fields?
> 
> I think everyone agrees that absolute number fields should have unique representation. My question was whether Q[i] should _be_ an absolute number field in this sense, or if it should be a “special” object such that people could work with both Q[i]-as-a-subset-of-complex-numbers and Q[i]-as-a-number field, possibly at the same time. I'd prefer a single object as well, but I am sure I have missed some of the implications, so if anyone has arguments in favor of the other option, I would be interested in hearing them.

I would be interested in working with *any* number field seeing them as a subfield of the real or complex numbers! Not only `QQi` and it makes sense to ask whether we need a dedicated class for that. For both parent and elements.

Note that it is already partly possible to play with element of number fields as real numbers (especially with quadratic fields)

```
sage: K.<sqrt2> = QuadraticField(2)
sage: 1 < sqrt2 < 3/2
True
sage: sqrt2.n()
1.41421356237310
sage: sqrt2 + CC(0,1)
1.41421356237310 + 1.00000000000000*I
sage: sage: cos(sqrt2)
cos(sqrt(2))
sage: sqrt2.continued_fraction()
[1; (2)*]
```


About having methods `.cos()`, `.sin()`, `.exp()`, it is already something which I found dangerous with integers for which the method `.sqrt()` might return an answer with a different parent

```
sage: 4.sqrt()  # answer is a Sage integer
2
sage: 2.sqrt()  # answer is symbolic
sqrt(2)
```

Which is very different from

```
sage: R.<x> = ZZ[]
sage: ((x+1)**2 * (x-2)**4).sqrt()
x^3 - 3*x^2 + 4
sage: R(2).sqrt()
Traceback (most recent call last):
...
TypeError: Polynomial is not a square. You must specify
the name of the square root when using the default extend = True
```


At the time Sage would support embedding of number fields into p-adic fields, I think it might be worse to have that dedicated class! But in the meantime, I have no strong opinion.

Vincent


---

Comment by rws created at 2015-10-17 13:47:50

See also https://groups.google.com/forum/?hl=en#!topic/sage-devel/Oa0kOC-VGds


---

Comment by jdemeyer created at 2016-01-05 12:46:13

Replying to [comment:18 vdelecroix]:
> About having methods `.cos()`, `.sin()`, `.exp()`, it is already something which I found dangerous with integers

Still, if we ever want this new non-symbolic `I` to behave like to old symbolic `I`, we would need to support things like that:

```
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 7901, in sage.symbolic.expression.Expression.log
Failed example:
    I.log()
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/src/sage-git/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.symbolic.expression.Expression.log[11]>", line 1, in <module>
        I.log()
      File "sage/structure/element.pyx", line 420, in sage.structure.element.Element.__getattr__ (build/cythonized/sage/structure/element.c:4676)
        return getattr_from_other_class(self, P._abstract_element_class, name)
      File "sage/structure/misc.pyx", line 259, in sage.structure.misc.getattr_from_other_class (build/cythonized/sage/structure/misc.c:1772)
        raise dummy_attribute_error
    AttributeError: 'sage.rings.number_field.number_field_element_quadratic.NumberFieldElement_quadratic' object has no attribute 'log'
**********************************************************************
```



---

Comment by behackl created at 2016-03-07 09:57:49

New commits:


---

Comment by behackl created at 2016-03-07 12:54:48

Hi! I'd like to revive this discussion a bit because we're getting a doctest failure at https://github.com/pynac/pynac/pull/162 which would probably be fixed along the lines of this ticket.

For starters, I had a look at the current branch and some of the resulting doctest failures; this should roughly resemble the tasks that are still to be done:

* `sage -t --warn-long 54.2 src/sage/symbolic/constants.py  # 3 doctests failed`;
`sage -t --warn-long 54.2 src/sage/symbolic/pynac.pyx  # 3 doctests failed`: 

  duplicate doctests. not sure how to fix (maybe switch to I_symbolic?). and which to remove.

* `sage -t --warn-long 54.2 src/sage/symbolic/relation.py  # 3 doctests failed`:

  Doctests can be fixed directly.

* `sage -t --warn-long 54.2 src/sage/symbolic/expression_conversions.py  # 2 doctests failed`

  probably I_symbolic is needed?

* `sage -t --warn-long 54.2 src/sage/symbolic/expression.pyx  # 14 doctests failed`
  *  arithmetic with `oo` is broken (4 doctests)
  *  `_is_registered_constant_` --> remove doctest? I_symbolic?
  *  `is_numeric`/`is_constant` missing (I_symbolic?)
  *  `imag_part`/`real_part` should be an alias of `imag`/`real` (3 doctests)
  *  `I.log` not implemented (3 doctests)
  * `rectform`: either converse to SR or multiply with I_symbolic.

* `sage -t --warn-long 54.2 src/sage/rings/infinity.py  # 2 doctests failed`

  arithmetic with `oo` is broken.

* `sage -t --warn-long 54.2 src/sage/rings/complex_mpc.pyx  # 8 doctests failed` and `sage -t --warn-long 54.2 src/sage/rings/complex_arb.pyx  # 7 doctests failed`
  * coercion errors: `ValueError: Cannot coerce algebraic number with non-zero imaginary part to algebraic real`
  * precision regressions.

* `sage -t --warn-long 54.2 src/sage/rings/qqbar.py  # 6 doctests failed`
  
  common parent issue: `TypeError: unsupported operand parent(s) for '+': 'Algebraic Field' and 'Number Field in I with defining polynomial x^2 + 1'`

* `sage -t --warn-long 54.2 src/sage/rings/number_field/number_field_element_quadratic.pyx  # 1 doctest failed`

  common parent issue: `TypeError: unsupported operand parent(s) for '*': 'Number Field in I with defining polynomial x^2 + 1' and 'Number Field in sqrt3 with defining polynomial x^2 - 3'`

* `sage -t --warn-long 54.2 src/sage/rings/polynomial/polynomial_rational_flint.pyx  # 1 doctest failed`

  false error is raised

* `sage -t --warn-long 54.2 src/sage/rings/polynomial/cyclotomic.pyx  # 2 doctests failed`

  both can be fixed directly.

* Stuff in `sage/geometry/hyperbolic_space/hyperbolic_*.py` breaks down:
  * `sage -t --warn-long 51.1 src/sage/geometry/hyperbolic_space/hyperbolic_point.py  # 1 doctest failed`
  * `sage -t --warn-long 51.1 src/sage/geometry/hyperbolic_space/hyperbolic_geodesic.py  # 4 doctests failed`
  * `sage -t --warn-long 51.1 src/sage/geometry/hyperbolic_space/hyperbolic_isometry.py  # 1 doctest failed`
  * `sage -t --warn-long 51.1 src/sage/geometry/hyperbolic_space/hyperbolic_model.py  # 2 doctests failed`

  Not sure about these errors, some seem to be coercion related, others are just `TypeError: 'sage.rings.complex_number.ComplexNumber' object is not callable`---maybe that goes away along the way.


These are certainly not all failures, but they should give an idea of what breaks down. The biggest issue seems to be coercion...


---

Comment by jdemeyer created at 2016-03-07 13:00:25

Replying to [comment:24 behackl]:
> The biggest issue seems to be coercion...

And stuff like `I.log()`.


---

Comment by rws created at 2016-03-07 14:46:26

Replying to [comment:24 behackl]:
> * `sage -t --warn-long 54.2 src/sage/rings/infinity.py  # 2 doctests failed`
> 
>   arithmetic with `oo` is broken.

It's just missing coercion of number field elements into the infinity ring. It would give a `SignError` anyway.


---

Comment by kcrisman created at 2016-06-22 20:09:12

Would 

```
A = GaussianIntegers()
A(1+I)
```

work with this branch?


---

Comment by rws created at 2016-06-25 06:32:47

Replying to [comment:27 kcrisman]:

```
sage: A = GaussianIntegers()
sage: A(1+I)
I + 1
sage: type(_)
<type 'sage.rings.number_field.number_field_element_quadratic.OrderElement_quadratic'>
```



---

Comment by kcrisman created at 2016-06-25 11:50:43

Thanks!  That is definitely a motivation for me to review this next week ... any sense on whether the various doctest failures are "real", as opposed to just fixes like comment:26?


---

Comment by jdemeyer created at 2016-06-25 16:29:37

What's a "real" doctest failure? Some features of `SR` simply are not supported for number field elements.


---

Comment by rws created at 2016-06-26 13:02:25

So, we must have two different `I`s.

This interface duplication creates a similar problems to the one with pos.char. elements (either ring elements or symbolic `Mod`). I think what's most understandable to the user would be a switch that prevents mixing and whose value is clearly visible on startup like `symbolic I mode is ON`. I know this goes against the no globals rules but I predict no one will accept having to input `symbolic_I`, and we will get hell for that.


---

Comment by nbruin created at 2016-06-26 14:23:29

Replying to [comment:31 rws]:
> So, we must have two different `I`s.

I've lost track what the exact issues are that lead to that conclusion, but I would definitely prefer if we don't do that. I think we can avoid it for the following reason:

Sage itself needs *many* different I's. For one thing, every `ComplexField(b)` needs its own. We'd like coercion to take care of creating the many different I's. I guess we're now finding it's difficult to find a parent that coerces into sufficiently many complex parents.

If that is the case, perhaps we should solve the problem by just having a `LiteralI`, just as we have `RealLiteral` to avoid the precision coercion problems that arise with floats. The advantage is that its coercion properties can be tailored exactly to what we need (within the bounds of what coercion can handle in the first place)

It doesn't surprise me that I is problematic that way. It is, after all, an object that represents multiple values.


---

Comment by jdemeyer created at 2016-06-26 15:19:36

Replying to [comment:31 rws]:
> So, we must have two different `I`s.

We really should not do that. Ideally, `I` should be some number field element but which allows the appropriate symbolic operations.


---

Comment by rws created at 2016-06-26 15:28:38

Replying to [comment:33 jdemeyer]:
> Ideally, `I` should be some number field element but which allows the appropriate symbolic operations.

Well, if the operation's name is a registered function
, convert to symbolic, apply, convert back?


---

Comment by kcrisman created at 2017-01-20 01:55:45

See also #22208.


---

Comment by git created at 2018-03-04 15:21:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2020-10-19 08:55:47

Time to reboot this ticket! (Still a bit of a work in progress, comments welcome.)


---

Comment by git created at 2020-10-19 08:56:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mmezzarobba created at 2020-10-19 08:57:36

Changing status from new to needs_review.


---

Comment by git created at 2020-10-19 11:40:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by kcrisman created at 2020-10-19 14:47:06

I can't speak to all the small changes that impact number field users, but I really like how atomic your commits are, well explained, and overall you seem to have a good approach.  And if the doctests still pass, that might be a good sign in and of itself (though obviously shouldn't be added to an rc at this late date).  Can anyone think of any other "extra" methods like `real_part` that should be added in `class NumberFieldElement_gaussian`?


---

Comment by git created at 2020-10-20 06:10:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2020-10-20 06:27:48

Replying to [comment:44 kcrisman]:
> I can't speak to all the small changes that impact number field users,

It should not have much impact, except maybe for the conversion to pari which is overridden to return a pari object of the form a+I*b instead of a element of a quotient ring. I don't know pari well enough to be able to tell if that can be an issue.

> but I really like how atomic your commits are, well explained, and overall you seem to have a good approach.

Thank you!

> And if the doctests still pass, that might be a good sign in and of itself (though obviously shouldn't be added to an rc at this late date).

No. Ideally, I would like it to be merged early in the next release cycle, so that we have time to sort out any issues.

> Can anyone think of any other "extra" methods like `real_part` that should be added in `class NumberFieldElement_gaussian`?

There was a discussion above about possibly supporting a significant subset of the methods of symbolic expressions, including elementary and special functions. I am reluctant to do that, because we will never achieve  perfect compatibility, and integers and rationals already  have their own API (so that users already need explicit conversions to SR in many cases if they want to use methods of symbolic expressions). But there may still be other methods  that make sense to add.


---

Comment by git created at 2020-10-20 10:41:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-10-20 13:22:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-10-20 18:12:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-10-21 05:56:54

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-10-21 14:05:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-10-22 08:31:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2020-10-23 06:41:51

Okay, the branch is now stable as far as I am concerned, and all tests to pass. It wouldn't be a bad time to start reviewing it if anyone is interested!


---

Comment by vdelecroix created at 2020-10-23 07:04:45

impressive :)


---

Comment by vdelecroix created at 2020-10-23 07:13:55

I am annoyed that you had to introduce a specific class `NumberFieldElement_gaussian`. In the long run do you intend to put more in it or to remove it? For the sake of this ticket, I would

- implement `_symbolic_`, `real_part`, `imag_part` on `NumberFieldElement_quadratic` (taking care of the embedding). Note that this would be desirable for more general number fields but more complicated (eg which symbolic representation? And number fields are generally not stable under taking real part.)
- explicitely deprecate `log`

So that `NumberFieldElement_gaussian` would just be a transition class.


---

Comment by vdelecroix created at 2020-10-23 07:25:50

Also, the default embedding is not ideal

```
sage: I.parent().coerce_embedding()                                                                                                                                                            
Generic morphism:
  From: Number Field in I with defining polynomial x^2 + 1 with I = 1*I
  To:   Complex Lazy Field
  Defn: I -> 1*I
```

Could we set it to `QQbar`?


---

Comment by mmezzarobba created at 2020-10-23 08:55:32

Replying to [comment:55 vdelecroix]:
> I am annoyed that you had to introduce a specific class `NumberFieldElement_gaussian`. In the long run do you intend to put more in it or to remove it?

To put more in it, probably.

Replying to [comment:56 vdelecroix]:
> Also, the default embedding is not ideal
> {{{
> sage: I.parent().coerce_embedding()                                                                                                                                                            
> Generic morphism:
>   From: Number Field in I with defining polynomial x^2 + 1 with I = 1*I
>   To:   Complex Lazy Field
>   Defn: I -> 1*I
> }}}
> Could we set it to `QQbar`?

I was thinking of doing that later, in #12715. But I will try to see if doing it now just for ℚ[i] breaks anything.


---

Comment by mmezzarobba created at 2020-10-23 09:19:42

Replying to [comment:57 mmezzarobba]:
> > Could we set it to `QQbar`?
> 
> I was thinking of doing that later, in #12715. But I will try to see if doing it now just for ℚ[i] breaks anything.

That creates import loops which may require to change the order of imports in sage.all significantly: the initialization of QQbar in sage.all currently comes very late, but the change would require moving it before that of pynac, which is done much earlier. I don't have the courage to try to untangle that mess at the moment.


---

Comment by git created at 2020-10-25 05:39:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mmezzarobba created at 2020-10-25 05:39:51

(trivial rebase on final 9.2)


---

Comment by vdelecroix created at 2020-10-25 14:22:40

Good! I hope it will get smoothly into the next beta.


---

Comment by vdelecroix created at 2020-10-25 14:22:40

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2020-10-25 15:22:23

Thanks a lot!


---

Comment by vbraun created at 2020-10-31 18:09:48

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2020-10-31 18:09:48

Merge conflict


---

Comment by vdelecroix created at 2020-10-31 18:16:13

Thanks Volker. Could you merge it early in the next beta? It is likely to create merge conflicts because touching a lot of files.


---

Comment by git created at 2020-11-01 15:07:38

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mmezzarobba created at 2020-11-02 12:24:56

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2020-11-02 13:53:16

Rebase was trivial, tests still pass.


---

Comment by mmezzarobba created at 2020-11-02 13:53:16

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-11-07 19:20:27

Merge conflict


---

Comment by vbraun created at 2020-11-07 19:20:27

Changing status from positive_review to needs_work.


---

Comment by vdelecroix created at 2020-11-07 19:24:23

Replying to [comment:68 vbraun]:
> Merge conflict

How many times are we supposed to play this game? :)


---

Comment by git created at 2020-11-08 05:05:21

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mmezzarobba created at 2020-11-08 05:05:49

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2020-11-08 11:29:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-11-17 23:20:53

PDF docs don't build


---

Comment by vbraun created at 2020-11-17 23:20:53

Changing status from positive_review to needs_work.


---

Comment by chapoton created at 2020-11-19 07:16:16

could be because of

```diff
+    An element of ℚ[i].
```



---

Comment by git created at 2020-11-19 07:46:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2020-11-19 07:48:02

Thanks Volker and Frédéric.


---

Comment by mmezzarobba created at 2020-11-19 09:18:24

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2020-11-22 15:06:53

Resolution: fixed
