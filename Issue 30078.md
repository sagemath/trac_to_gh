# Issue 30078: Switch jsmol to jupyter-jsmol, make jmol optional

archive/issues_030078.json:
```json
{
    "body": "CC:  kcrisman novoselt chapoton arojas fbissey slelievre nbruin paulmasson egourgoulhon klee enriqueartal @jcamp0x2a\n\nCurrently, jsmol is installed by the jmol spkg and then symlinked into the jupyter notebook directory. \n\nWe should switch to https://pypi.org/project/jupyter-jsmol/ (https://github.com/fekad/jupyter-jsmol), which can be installed by standard Python tools.\n\nThen we can downgrade `jmol` to `optional`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30315\n\n",
    "created_at": "2020-08-07T18:26:49Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Switch jsmol to jupyter-jsmol, make jmol optional",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30078",
    "user": "mkoeppe"
}
```
CC:  kcrisman novoselt chapoton arojas fbissey slelievre nbruin paulmasson egourgoulhon klee enriqueartal @jcamp0x2a

Currently, jsmol is installed by the jmol spkg and then symlinked into the jupyter notebook directory. 

We should switch to https://pypi.org/project/jupyter-jsmol/ (https://github.com/fekad/jupyter-jsmol), which can be installed by standard Python tools.

Then we can downgrade `jmol` to `optional`.

Issue created by migration from https://trac.sagemath.org/ticket/30315





---

archive/issue_comments_427594.json:
```json
{
    "body": "(deleted)",
    "created_at": "2020-08-08T05:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427594",
    "user": "mkoeppe"
}
```

(deleted)



---

archive/issue_comments_427595.json:
```json
{
    "body": "`./sage -pip install jupyter-jsmol` installs proper nbextensions:\n\n```\n$ jupyter nbextension list\nKnown nbextensions:\n  config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig\n    notebook section\n      jupyter_jsmol/extension  enabled \n      - Validating: OK\n      jupyter-js-widgets/extension  enabled \n      - Validating: OK\n```\n\nThe installed files can be seen in `$SAGE_LOCAL/share/jupyter/nbextensions/jupyter_jsmol/`",
    "created_at": "2020-08-08T05:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427595",
    "user": "mkoeppe"
}
```

`./sage -pip install jupyter-jsmol` installs proper nbextensions:

```
$ jupyter nbextension list
Known nbextensions:
  config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig
    notebook section
      jupyter_jsmol/extension  enabled 
      - Validating: OK
      jupyter-js-widgets/extension  enabled 
      - Validating: OK
```

The installed files can be seen in `$SAGE_LOCAL/share/jupyter/nbextensions/jupyter_jsmol/`



---

archive/issue_comments_427596.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-29T07:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427596",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_427597.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-11-29T07:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427597",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_427598.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-29T07:02:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427598",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_427599.json:
```json
{
    "body": "`sagetex` declares `jmol` as a dependency - what is it used for?",
    "created_at": "2020-11-29T07:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427599",
    "user": "mkoeppe"
}
```

`sagetex` declares `jmol` as a dependency - what is it used for?



---

archive/issue_comments_427600.json:
```json
{
    "body": "> `sagetex` declares `jmol` as a dependency - what is it used for?\n\nI think for generating a 3d image in its documentation, compilation of which is part of its test suite.",
    "created_at": "2020-11-29T21:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427600",
    "user": "kcrisman"
}
```

> `sagetex` declares `jmol` as a dependency - what is it used for?

I think for generating a 3d image in its documentation, compilation of which is part of its test suite.



---

archive/issue_comments_427601.json:
```json
{
    "body": "Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427601",
    "user": "mkoeppe"
}
```

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_427602.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427602",
    "user": "mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_427603.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-07T04:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427603",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_427604.json:
```json
{
    "body": "Replying to [comment:10 kcrisman]:\n> > `sagetex` declares `jmol` as a dependency - what is it used for?\n> \n> I think for generating a 3d image in its documentation, compilation of which is part of its test suite.\n\nThanks! I have adjusted the dependencies in #31020 (now a dependency) so that `jmol` is only treated as a dependency when `SAGE_CHECK` is active.",
    "created_at": "2020-12-07T04:10:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427604",
    "user": "mkoeppe"
}
```

Replying to [comment:10 kcrisman]:
> > `sagetex` declares `jmol` as a dependency - what is it used for?
> 
> I think for generating a 3d image in its documentation, compilation of which is part of its test suite.

Thanks! I have adjusted the dependencies in #31020 (now a dependency) so that `jmol` is only treated as a dependency when `SAGE_CHECK` is active.



---

archive/issue_comments_427605.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-07T04:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427605",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_427606.json:
```json
{
    "body": "That is not a good idea.  Because we want people to be able to build the documentation for SageTeX, which after all isn't \"really\" upstream.  Instead, we should see if jsmol or some other tool suffices to build 3d pictures in SageTeX, which is a very useful use case for it.  Untested = broken, and I don't think that we've ever had a dependency only in `SAGE_CHECK` before.",
    "created_at": "2020-12-07T13:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427606",
    "user": "kcrisman"
}
```

That is not a good idea.  Because we want people to be able to build the documentation for SageTeX, which after all isn't "really" upstream.  Instead, we should see if jsmol or some other tool suffices to build 3d pictures in SageTeX, which is a very useful use case for it.  Untested = broken, and I don't think that we've ever had a dependency only in `SAGE_CHECK` before.



---

archive/issue_comments_427607.json:
```json
{
    "body": "> and I don't think that we've ever had a dependency only in `SAGE_CHECK` before.\nThough my info on the build system is pretty outdated :-)",
    "created_at": "2020-12-07T13:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427607",
    "user": "kcrisman"
}
```

> and I don't think that we've ever had a dependency only in `SAGE_CHECK` before.
Though my info on the build system is pretty outdated :-)



---

archive/issue_comments_427608.json:
```json
{
    "body": "Replying to [comment:19 kcrisman]:\n> > and I don't think that we've ever had a dependency only in `SAGE_CHECK` before.\n> Though my info on the build system is pretty outdated :-)\n\nActually, we've introduced a few of these this year because the complexity of Python test frameworks has escalated and we don't want to ship all of their dependencies.  Currently, `networkx`, `rpy2`, and `sage_sws2rst` all have check-only dependencies.",
    "created_at": "2020-12-07T18:31:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427608",
    "user": "mkoeppe"
}
```

Replying to [comment:19 kcrisman]:
> > and I don't think that we've ever had a dependency only in `SAGE_CHECK` before.
> Though my info on the build system is pretty outdated :-)

Actually, we've introduced a few of these this year because the complexity of Python test frameworks has escalated and we don't want to ship all of their dependencies.  Currently, `networkx`, `rpy2`, and `sage_sws2rst` all have check-only dependencies.



---

archive/issue_comments_427609.json:
```json
{
    "body": "Interesting.  I wonder whether jsmol might be a drop-in replacement for this specific use case though. Or even Tachyon ...",
    "created_at": "2020-12-07T18:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427609",
    "user": "kcrisman"
}
```

Interesting.  I wonder whether jsmol might be a drop-in replacement for this specific use case though. Or even Tachyon ...



---

archive/issue_comments_427610.json:
```json
{
    "body": "Replying to [comment:21 kcrisman]:\n> Interesting.  I wonder whether jsmol might be a drop-in replacement for this specific use case though. Or even Tachyon ... \n\nWhat's the status of generating 3D plots and saving them using threejs? I think for SageTeX it is irrelevant what is producing pictures, just show that it works well. Tachyon is not the best in this regard.",
    "created_at": "2020-12-07T20:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427610",
    "user": "novoselt"
}
```

Replying to [comment:21 kcrisman]:
> Interesting.  I wonder whether jsmol might be a drop-in replacement for this specific use case though. Or even Tachyon ... 

What's the status of generating 3D plots and saving them using threejs? I think for SageTeX it is irrelevant what is producing pictures, just show that it works well. Tachyon is not the best in this regard.



---

archive/issue_comments_427611.json:
```json
{
    "body": "A discussion has unfolded in https://groups.google.com/g/sage-devel/c/qKqTmLzHAbg/m/6YxQ_qWUBQAJ",
    "created_at": "2020-12-07T23:35:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427611",
    "user": "mkoeppe"
}
```

A discussion has unfolded in https://groups.google.com/g/sage-devel/c/qKqTmLzHAbg/m/6YxQ_qWUBQAJ



---

archive/issue_comments_427612.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-08T01:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427612",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_427613.json:
```json
{
    "body": "I have narrowed this ticket to only separating the `jmol` and `jsmol` installation.",
    "created_at": "2020-12-08T01:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427613",
    "user": "mkoeppe"
}
```

I have narrowed this ticket to only separating the `jmol` and `jsmol` installation.



---

archive/issue_comments_427614.json:
```json
{
    "body": "Making jmol optional, and the discussion about new technologies to create images from 3d graphics, is now on #31027.",
    "created_at": "2020-12-08T01:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427614",
    "user": "mkoeppe"
}
```

Making jmol optional, and the discussion about new technologies to create images from 3d graphics, is now on #31027.



---

archive/issue_comments_427615.json:
```json
{
    "body": "I was able to verify that JSmol still works correctly in both Jupyter and JupyterLab. However, I did notice a test failure in `src/sage/repl/ipython_kernel/install.py` due to the new deprecation warning:\n\n\n```\nFile \"src/sage/repl/ipython_kernel/install.py\", line 142, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_jsmol\nFailed example:\n    spec.use_local_jsmol()\nExpected nothing\nGot:\n    doctest:warning\n      File \"/home/joshua/sage/src/bin/sage-runtests\", line 182, in <module>\n        err = DC.run()\n    [...]\n    :\n    DeprecationWarning: Symlinking jsmol is no longer necessary\n    See https://trac.sagemath.org/30315 for details.\n```\n\n\nAlso, after removing the `local/share/jsmol` folder since it is no longer needed (and wouldn't be present on a clean install), I get a couple more test failures in the same file:\n\n\n```\nFile \"src/sage/repl/ipython_kernel/install.py\", line 144, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_jsmol\nFailed example:\n    os.path.isdir(jsmol)\nExpected:\n    True\nGot:\n    False\n```\n\n\nand\n\n\n```\nFile \"src/sage/repl/ipython_kernel/install.py\", line 146, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_jsmol\nFailed example:\n    os.path.isfile(os.path.join(jsmol, \"JSmol.min.js\"))\nExpected:\n    True\nGot:\n    False\n```\n",
    "created_at": "2020-12-08T18:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427615",
    "user": "@jcamp0x2a"
}
```

I was able to verify that JSmol still works correctly in both Jupyter and JupyterLab. However, I did notice a test failure in `src/sage/repl/ipython_kernel/install.py` due to the new deprecation warning:


```
File "src/sage/repl/ipython_kernel/install.py", line 142, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_jsmol
Failed example:
    spec.use_local_jsmol()
Expected nothing
Got:
    doctest:warning
      File "/home/joshua/sage/src/bin/sage-runtests", line 182, in <module>
        err = DC.run()
    [...]
    :
    DeprecationWarning: Symlinking jsmol is no longer necessary
    See https://trac.sagemath.org/30315 for details.
```


Also, after removing the `local/share/jsmol` folder since it is no longer needed (and wouldn't be present on a clean install), I get a couple more test failures in the same file:


```
File "src/sage/repl/ipython_kernel/install.py", line 144, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_jsmol
Failed example:
    os.path.isdir(jsmol)
Expected:
    True
Got:
    False
```


and


```
File "src/sage/repl/ipython_kernel/install.py", line 146, in sage.repl.ipython_kernel.install.SageKernelSpec.use_local_jsmol
Failed example:
    os.path.isfile(os.path.join(jsmol, "JSmol.min.js"))
Expected:
    True
Got:
    False
```




---

archive/issue_comments_427616.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-09T00:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427616",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_427617.json:
```json
{
    "body": "Thanks. This function, after all, does not make sense any more, so there's no point in trying to go through deprecation.  I have now removed it completely (alongside with the variable `JSMOL_DIR`).",
    "created_at": "2020-12-09T00:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427617",
    "user": "mkoeppe"
}
```

Thanks. This function, after all, does not make sense any more, so there's no point in trying to go through deprecation.  I have now removed it completely (alongside with the variable `JSMOL_DIR`).



---

archive/issue_comments_427618.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-09T16:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427618",
    "user": "@jcamp0x2a"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_427619.json:
```json
{
    "body": "Looks good. JSmol still works in Jupyter and JupyterLab.",
    "created_at": "2020-12-09T16:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427619",
    "user": "@jcamp0x2a"
}
```

Looks good. JSmol still works in Jupyter and JupyterLab.



---

archive/issue_comments_427620.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-12-09T19:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427620",
    "user": "mkoeppe"
}
```

Thank you!



---

archive/issue_comments_427621.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-12-10T00:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427621",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_427622.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-12-10T00:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427622",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_427623.json:
```json
{
    "body": "Forgot to actually use #31002 - this change is necessary for correct installation on WSL",
    "created_at": "2020-12-10T00:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427623",
    "user": "mkoeppe"
}
```

Forgot to actually use #31002 - this change is necessary for correct installation on WSL



---

archive/issue_comments_427624.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-12-10T02:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427624",
    "user": "@jcamp0x2a"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_427625.json:
```json
{
    "body": "Replying to [comment:34 mkoeppe]:\n> Forgot to actually use #31002 - this change is necessary for correct installation on WSL\n\nOk. I tested this on Ubuntu WSL earlier without any installation issues. If I understand #31002 correctly, the problem was occurring due to mounting Windows folders, which I'm not doing, so that's probably why I didn't run into it.\n\nI've gone ahead and re-verified that JSmol still works in Jupyter and JupyterLab.",
    "created_at": "2020-12-10T02:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427625",
    "user": "@jcamp0x2a"
}
```

Replying to [comment:34 mkoeppe]:
> Forgot to actually use #31002 - this change is necessary for correct installation on WSL

Ok. I tested this on Ubuntu WSL earlier without any installation issues. If I understand #31002 correctly, the problem was occurring due to mounting Windows folders, which I'm not doing, so that's probably why I didn't run into it.

I've gone ahead and re-verified that JSmol still works in Jupyter and JupyterLab.



---

archive/issue_comments_427626.json:
```json
{
    "body": "Thanks again!",
    "created_at": "2020-12-10T03:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427626",
    "user": "mkoeppe"
}
```

Thanks again!



---

archive/issue_comments_427627.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-13T20:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30078",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30078#issuecomment-427627",
    "user": "vbraun"
}
```

Resolution: fixed
