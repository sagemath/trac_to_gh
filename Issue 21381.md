# Issue 21381: plot in piecewise regression (?)

Issue created by migration from https://trac.sagemath.org/ticket/21618

Original creator: kcrisman

Original creation time: 2016-10-01 02:39:09

CC:  paulmasson


```
P = piecewise([((0,2),x),((2,6),2)])
print P
plot(P)
```

Before this would have plotted the whole thing, now it defaults to the usual plotting only from -1 to 1 (which of course gives an error).


---

Comment by paulmasson created at 2016-10-03 19:31:10

The old `Piecewise` has a custom plot method. This method is omitted in the current `piecewise`.


---

Comment by kcrisman created at 2016-10-04 01:03:30

Correct.  So it would be nice to emulate that so everyone's code doesn't break - I had a not-so-nice time drawing graphs on the fly in class today because of this.  It seems reasonable, since piecewise is an unusual situation.


---

Comment by rws created at 2016-10-05 13:46:29

Changing status from new to needs_review.


---

Comment by rws created at 2016-10-05 13:46:29

Oops I just saw the second complaint. This will not be as easy.
----
New commits:


---

Comment by rws created at 2016-10-05 13:46:42

Changing status from needs_review to needs_work.


---

Comment by rws created at 2016-10-05 15:36:12

Note that your command `plot(P, -1, 5, detect_poles=True)` also does not work on Sage-7.1, i.e., the old piecewise, and `plot(P, detect_poles=True)` also has a gap at `x=0`. So, this particularly is rather an enhancement of `plot`, not a bug in `piecewise`.


---

Comment by rws created at 2016-10-06 07:16:16

New commits:


---

Comment by rws created at 2016-10-06 07:16:16

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2016-10-11 03:30:42

Changing status from needs_review to needs_work.


---

Comment by novoselt created at 2016-10-11 03:30:42

1. Why there is commented code? Reference to some ticket explaining stuff is fine, but not strange imports etc.
2. Why there is extra printing of pieces???
3. If I do specify the domain, then each piece is plotted over this domain!

I'll see if I can resolve all this in the next hour or so.


---

Comment by novoselt created at 2016-10-11 04:12:14

Address 1&2 and simplify a bit to get

```python
        def plot(cls, self, parameters, variable, *args, **kwds):
            from sage.plot.all import plot, Graphics
            g = Graphics()
            for (dom, fun) in self.items():
                g += plot(fun, (variable, dom.inf(), dom.sup()), *args, **kwds)
                # If it's the first piece, pass all arguments. Otherwise,
                # filter out 'legend_label' so that we don't add each
                # piece to the legend separately (trac #12651).
                kwds.pop('legend_label', None)
            return g
```


3 is tricky, however, because of a variety of ways to pass left and right bounds. I think we should factor out the logic of getting these bounds into a separate function which will say always set `xmin/xmax` keywords, then we can call this function in the top level `plot` as well as `plot` methods and have a guaranteed uniform behavior. Thoughts?

There is also
4. No documentation and examples at all!!!


---

Comment by rws created at 2016-10-11 04:35:28

Andrey, please go ahead with your own branch, the plotting code is quite opaque and uninteresting to me, and I'm into other projects right now.
