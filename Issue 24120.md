# Issue 24120: Multiple bugs in NumberField.composite_fields()

Issue created by migration from Trac.

Original creator: mmezzarobba

Original creation time: 2017-12-10 08:59:10


```
sage: A.<a> = NumberField(x^9 - 7)
....: B.<b> = NumberField(x^3-7, embedding=a^3)
....: C.<c> = QuadraticField(-1)
....: B.composite_fields(C)
...
NameError: global name 'CoercionException' is not defined
```



```
sage: y = polygen(QQ, 'y')
sage: A.<a> = NumberField(x^3 - 7, embedding=CC(-0.95+1.65*I))
....: B.<b> = NumberField(y^9 - 7, embedding=CC(-1.16+0.42*I))
....: A.composite_fields(B)
...
PariError: inconsistent variables in polcompositum, x != y
```



---

Comment by mmezzarobba created at 2017-12-10 09:03:08

Changing status from new to needs_review.


---

Comment by mmezzarobba created at 2017-12-10 09:03:08

New commits:


---

Comment by git created at 2017-12-10 09:24:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-12-10 14:52:08

Some comments:

I've been told it's actually  slightly faster to actually import what you need so Python does not have to resolve the extra indirections `sage.structure.coerce_exceptions.CoercionException`.

I think it is better to explicitly label which tests are for which tickets.

In the bikeshedding realm, but I don't like removing `sage: x = polygen(ZZ)` from `TESTS` because I feel like that should be treated like an independent block (it also makes it more clear to the reader [me in this case] what `x` is by having it more local).

Otherwise LGTM.


---

Comment by git created at 2018-01-30 14:30:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2018-01-30 14:33:21

Thanks for the review!

Replying to [comment:3 tscrim]:
> I've been told it's actually  slightly faster to actually import what you need so Python does not have to resolve the extra indirections `sage.structure.coerce_exceptions.CoercionException`.

Not done, this is slow code in any case...

> I think it is better to explicitly label which tests are for which tickets.

Done.

> In the bikeshedding realm, but I don't like removing `sage: x = polygen(ZZ)` from `TESTS` because I feel like that should be treated like an independent block (it also makes it more clear to the reader [me in this case] what `x` is by having it more local).

Ok.


---

Comment by tscrim created at 2018-01-30 17:44:43

Okay. LGTM. Thanks.


---

Comment by tscrim created at 2018-01-30 17:44:43

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-02-02 12:06:02

Resolution: fixed
