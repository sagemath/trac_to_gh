# Issue 22560: inconsistencies between RDF and RR = RealField(53)

archive/issues_022560.json:
```json
{
    "body": "Consider the following:\n\n```\nsage: a=RDF(pi); a\n3.141592653589793\nsage: a.str()\n'3.14159265359'\nsage: RR(a)\n3.14159265358979\nsage: RR(a).str()\n'3.14159265358979'\n```\n\nQuestions:\n\n1) why does `a` not give the same output as `a.str()` (without the quotes)?\n\n2) why does RDF output one more digit than RR (and two less with the `str` method)?\n\nSide question: how can I obtain (in a program) the string `'3.141592653589793'` corresponding to the first output?\n\nIssue created by migration from https://trac.sagemath.org/ticket/22797\n\n",
    "created_at": "2017-04-12T09:33:14Z",
    "labels": [
        "component: basic arithmetic",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "inconsistencies between RDF and RR = RealField(53)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22560",
    "user": "https://github.com/zimmermann6"
}
```
Consider the following:

```
sage: a=RDF(pi); a
3.141592653589793
sage: a.str()
'3.14159265359'
sage: RR(a)
3.14159265358979
sage: RR(a).str()
'3.14159265358979'
```

Questions:

1) why does `a` not give the same output as `a.str()` (without the quotes)?

2) why does RDF output one more digit than RR (and two less with the `str` method)?

Side question: how can I obtain (in a program) the string `'3.141592653589793'` corresponding to the first output?

Issue created by migration from https://trac.sagemath.org/ticket/22797





---

archive/issue_comments_314045.json:
```json
{
    "body": "An answer to my side question:\n\n```\nsage: a=RDF(pi); a\n3.141592653589793\nsage: a.__repr__()\n'3.141592653589793'\n```\n",
    "created_at": "2017-04-12T10:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314045",
    "user": "https://github.com/zimmermann6"
}
```

An answer to my side question:

```
sage: a=RDF(pi); a
3.141592653589793
sage: a.__repr__()
'3.141592653589793'
```




---

archive/issue_comments_314046.json:
```json
{
    "body": "Replying to [ticket:22797 zimmerma]:\n> 2) why does RDF output one more digit than RR (and two less with the `str` method)?\n\nSee #21124.\n\n> Side question: how can I obtain (in a program) the string `'3.141592653589793'` corresponding to the first output?\n`repr(a)`",
    "created_at": "2017-04-12T20:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314046",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:22797 zimmerma]:
> 2) why does RDF output one more digit than RR (and two less with the `str` method)?

See #21124.

> Side question: how can I obtain (in a program) the string `'3.141592653589793'` corresponding to the first output?
`repr(a)`



---

archive/issue_comments_314047.json:
```json
{
    "body": "> 2) why does RDF output one more digit than RR (and two less with the str method)?\n> See #21124.\n\nthis does not answer my question.",
    "created_at": "2017-04-13T06:35:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314047",
    "user": "https://github.com/zimmermann6"
}
```

> 2) why does RDF output one more digit than RR (and two less with the str method)?
> See #21124.

this does not answer my question.



---

archive/issue_comments_314048.json:
```json
{
    "body": "Replying to [comment:3 zimmerma]:\n> this does not answer my question.\n\nSorry, I misread your question. The problem is that there are various things here: `repr(x)` vs. `x.str()` vs. `str(x)` (which you didn't mention but could be relevant) and `RR` vs. `RDF`.\n\nSo your question 2) is about the difference in `repr(x)` between `RR` and `RDF`.\n\nFor `RDF`, we use the `repr` function from Python floats. This returns the shortest decimal expansion which will give the original number back when doing `RDF(\"the string\")`. In particular, 2 different numbers are guaranteed to have diffent string representations.\n\nFor `RR`, we arbitrarily decide to show a little bit less digits to avoid too many questions about rounding issues. You know, things like\n\n```\nsage: 0.1 + 0.2\n0.300000000000000\nsage: RDF(0.1) + RDF(0.2)\n0.30000000000000004\n```\n\n\nThere is a comment in the code\n\n```python\n            # This avoids the confusion a lot of people have with the last\n            # 1-2 binary digits being wrong due to rounding coming from\n            # representing numbers in binary.\n```\n\nand the feature was added in\n\n```\ncommit c9e2428ea87990d7c578dfc34d33df07bfcdeb45\nAuthor: William Stein <wstein@gmail.com>\nDate:   Sat Oct 28 13:28:44 2006 -0500\n\n    Made _assign_names something only do once; new inject_variables system; lots of documenation\n```\n\n(i.e. a commit totally unrelated to decimal representations of real numbers)",
    "created_at": "2017-04-13T07:28:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314048",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 zimmerma]:
> this does not answer my question.

Sorry, I misread your question. The problem is that there are various things here: `repr(x)` vs. `x.str()` vs. `str(x)` (which you didn't mention but could be relevant) and `RR` vs. `RDF`.

So your question 2) is about the difference in `repr(x)` between `RR` and `RDF`.

For `RDF`, we use the `repr` function from Python floats. This returns the shortest decimal expansion which will give the original number back when doing `RDF("the string")`. In particular, 2 different numbers are guaranteed to have diffent string representations.

For `RR`, we arbitrarily decide to show a little bit less digits to avoid too many questions about rounding issues. You know, things like

```
sage: 0.1 + 0.2
0.300000000000000
sage: RDF(0.1) + RDF(0.2)
0.30000000000000004
```


There is a comment in the code

```python
            # This avoids the confusion a lot of people have with the last
            # 1-2 binary digits being wrong due to rounding coming from
            # representing numbers in binary.
```

and the feature was added in

```
commit c9e2428ea87990d7c578dfc34d33df07bfcdeb45
Author: William Stein <wstein@gmail.com>
Date:   Sat Oct 28 13:28:44 2006 -0500

    Made _assign_names something only do once; new inject_variables system; lots of documenation
```

(i.e. a commit totally unrelated to decimal representations of real numbers)



---

archive/issue_comments_314049.json:
```json
{
    "body": "in my opinion, it would be better if RR would also print 16 significant digits, for two\nreasons:\n\n1) consistency with RDF\n\n2) like for RDF, we could write `RR(\"the string\")` to get back the number, and two\n   different numbers would be guaranteed to have different string representations.\n\nBesides, note that the `0.1 + 0.2` issue still happens:\n\n```\nsage: 1.2-1.1\n0.0999999999999999\n```\n\nPaul",
    "created_at": "2017-04-13T07:59:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314049",
    "user": "https://github.com/zimmermann6"
}
```

in my opinion, it would be better if RR would also print 16 significant digits, for two
reasons:

1) consistency with RDF

2) like for RDF, we could write `RR("the string")` to get back the number, and two
   different numbers would be guaranteed to have different string representations.

Besides, note that the `0.1 + 0.2` issue still happens:

```
sage: 1.2-1.1
0.0999999999999999
```

Paul



---

archive/issue_comments_314050.json:
```json
{
    "body": "Replying to [comment:5 zimmerma]:\n> Besides, note that the `0.1 + 0.2` issue still happens:\n> {{{\n> sage: 1.2-1.1\n> 0.0999999999999999\n> }}}\n\nOf course. I only answered the \"why\" question, I didn't say I agreed with it :-)",
    "created_at": "2017-04-13T14:28:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314050",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:5 zimmerma]:
> Besides, note that the `0.1 + 0.2` issue still happens:
> {{{
> sage: 1.2-1.1
> 0.0999999999999999
> }}}

Of course. I only answered the "why" question, I didn't say I agreed with it :-)



---

archive/issue_comments_314051.json:
```json
{
    "body": "> Side question: how can I obtain (in a program) the string `'3.141592653589793'` corresponding to the first output?\n\nUse `repr(foo)` to get the display representation of `foo`.",
    "created_at": "2017-09-06T12:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314051",
    "user": "https://github.com/jdemeyer"
}
```

> Side question: how can I obtain (in a program) the string `'3.141592653589793'` corresponding to the first output?

Use `repr(foo)` to get the display representation of `foo`.



---

archive/issue_comments_314052.json:
```json
{
    "body": "I'm a bit confused here. I can answer all your questions but I don't know whether there remains a bug or not...",
    "created_at": "2017-09-06T12:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314052",
    "user": "https://github.com/jdemeyer"
}
```

I'm a bit confused here. I can answer all your questions but I don't know whether there remains a bug or not...



---

archive/issue_comments_314053.json:
```json
{
    "body": "thank you for answering 3). It remains 1) and 2) which show inconsistent behaviour in my opinion.",
    "created_at": "2017-09-07T14:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22560#issuecomment-314053",
    "user": "https://github.com/zimmermann6"
}
```

thank you for answering 3). It remains 1) and 2) which show inconsistent behaviour in my opinion.
