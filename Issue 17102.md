# Issue 17102: Polyhedron class mistreats empty inputs

archive/issues_017102.json:
```json
{
    "body": "CC:  @vbraun @mkoeppe @tscrim\n\n\n```\nsage: Polyhedron(ambient_dim=0, ieqs=[], eqns=[], base_ring=QQ)\nThe empty polyhedron in QQ^0\n```\n\nThis should be a one-point polyhedron.\n\n\n```\nsage: Polyhedron(ambient_dim=2, ieqs=[], eqns=[], base_ring=QQ)\nThe empty polyhedron in QQ^2\n```\n\nThis should be the whole QQ^2.\n\n\n```\nsage: Polyhedron(ambient_dim=2, vertices=[], rays=[(2,2)], lines=[], base_ring=QQ)\nA 1-dimensional polyhedron in QQ^2 defined as the convex hull of 1 vertex and 1 ray\n```\n\nThis should be the empty polyhedron, since there are no vertices for the ray to emanate from.\n\n\n```\nsage: Polyhedron(ambient_dim=2, vertices=[], rays=[], lines=[], base_ring=QQ)\nThe empty polyhedron in QQ^2\n```\n\nThis is correct, but only because the code misunderstands the empty V-representation as no V-representation given at all.\n\nThe attached branch fixes the H-representation part, but already that comes at the cost of failing doctests. The real deal is fixing the V-representation (which then should fix the doctests as well).\n\nIssue created by migration from https://trac.sagemath.org/ticket/17339\n\n",
    "created_at": "2014-11-13T19:27:29Z",
    "labels": [
        "geometry",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.0",
    "title": "Polyhedron class mistreats empty inputs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17102",
    "user": "@darijgr"
}
```
CC:  @vbraun @mkoeppe @tscrim


```
sage: Polyhedron(ambient_dim=0, ieqs=[], eqns=[], base_ring=QQ)
The empty polyhedron in QQ^0
```

This should be a one-point polyhedron.


```
sage: Polyhedron(ambient_dim=2, ieqs=[], eqns=[], base_ring=QQ)
The empty polyhedron in QQ^2
```

This should be the whole QQ^2.


```
sage: Polyhedron(ambient_dim=2, vertices=[], rays=[(2,2)], lines=[], base_ring=QQ)
A 1-dimensional polyhedron in QQ^2 defined as the convex hull of 1 vertex and 1 ray
```

This should be the empty polyhedron, since there are no vertices for the ray to emanate from.


```
sage: Polyhedron(ambient_dim=2, vertices=[], rays=[], lines=[], base_ring=QQ)
The empty polyhedron in QQ^2
```

This is correct, but only because the code misunderstands the empty V-representation as no V-representation given at all.

The attached branch fixes the H-representation part, but already that comes at the cost of failing doctests. The real deal is fixing the V-representation (which then should fix the doctests as well).

Issue created by migration from https://trac.sagemath.org/ticket/17339





---

archive/issue_comments_227368.json:
```json
{
    "body": "For the case with rays but no vertex we follow cdd in implicitly adding the origin as vertex. This is also spelled out in the docs.",
    "created_at": "2014-11-13T20:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227368",
    "user": "@vbraun"
}
```

For the case with rays but no vertex we follow cdd in implicitly adding the origin as vertex. This is also spelled out in the docs.



---

archive/issue_comments_227369.json:
```json
{
    "body": "There is a difference between `vertices=[]` and `vertices=None`. In the latter case, we should follow the cdd convention. In the former, we should not; this kind of exception conflicts with regular usage and forces writers of methods to special-case empty vertex sets. Currently the constructor loses the difference between `[]` and `None` at one of its first steps (the `_make_listlist` call); this is what I think needs to be fixed.",
    "created_at": "2014-11-13T20:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227369",
    "user": "@darijgr"
}
```

There is a difference between `vertices=[]` and `vertices=None`. In the latter case, we should follow the cdd convention. In the former, we should not; this kind of exception conflicts with regular usage and forces writers of methods to special-case empty vertex sets. Currently the constructor loses the difference between `[]` and `None` at one of its first steps (the `_make_listlist` call); this is what I think needs to be fixed.



---

archive/issue_comments_227370.json:
```json
{
    "body": "I don't really like to make a distinction between `None` and `[]`, Python generally treats them as similar. Both are `not __nonzero__`. Its a bad UI to assign meaning to one over the other.",
    "created_at": "2014-11-13T22:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227370",
    "user": "@vbraun"
}
```

I don't really like to make a distinction between `None` and `[]`, Python generally treats them as similar. Both are `not __nonzero__`. Its a bad UI to assign meaning to one over the other.



---

archive/issue_comments_227371.json:
```json
{
    "body": "What we have right now is way worse. Say I write some code which constructs a ton of polytopes from their Vreps (e.g., I have a polygon and I construct all subpolygons from some of its vertices). A few of them have empty vertices lists. Why should they be understood differently from the rest?",
    "created_at": "2014-11-13T23:29:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227371",
    "user": "@darijgr"
}
```

What we have right now is way worse. Say I write some code which constructs a ton of polytopes from their Vreps (e.g., I have a polygon and I construct all subpolygons from some of its vertices). A few of them have empty vertices lists. Why should they be understood differently from the rest?



---

archive/issue_comments_227372.json:
```json
{
    "body": "The design choice is: nothing specified = empty polyhedron.\n\nThis is fine with your example, empty vertex list = empty polygon. Unless you mean a non-compact 2-d polyhedron.\n\nI agree that there is perhaps too much DWIM but its also very convenient for interactive use. If you just specify a bunch of rays then in 99% of the cases you want a cone, not some rule thumping about missing a vertex.\n\nHow about separate `Polyhedron.from_Vrep(vertices, rays, lines)` and similarly `from_Hrep` with positional arguments and strict rules?",
    "created_at": "2014-11-13T23:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227372",
    "user": "@vbraun"
}
```

The design choice is: nothing specified = empty polyhedron.

This is fine with your example, empty vertex list = empty polygon. Unless you mean a non-compact 2-d polyhedron.

I agree that there is perhaps too much DWIM but its also very convenient for interactive use. If you just specify a bunch of rays then in 99% of the cases you want a cone, not some rule thumping about missing a vertex.

How about separate `Polyhedron.from_Vrep(vertices, rays, lines)` and similarly `from_Hrep` with positional arguments and strict rules?



---

archive/issue_comments_227373.json:
```json
{
    "body": "Very good idea about the `from_Vrep` and `from_Hrep` methods. Should the usual `__init__` then dispatch to them?",
    "created_at": "2014-11-13T23:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227373",
    "user": "@darijgr"
}
```

Very good idea about the `from_Vrep` and `from_Hrep` methods. Should the usual `__init__` then dispatch to them?



---

archive/issue_comments_227374.json:
```json
{
    "body": "Replying to [comment:6 darij]:\n> Should the usual `__init__` then dispatch to them?\n\nHaven't really thought about it, whatever is convenient for the implementation.",
    "created_at": "2014-11-14T11:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227374",
    "user": "@vbraun"
}
```

Replying to [comment:6 darij]:
> Should the usual `__init__` then dispatch to them?

Haven't really thought about it, whatever is convenient for the implementation.



---

archive/issue_comments_227375.json:
```json
{
    "body": "Even if it's not good style to distinguish between `None` and `[]`, I think it is fine to distinguish between a provided keyword argument and a not-provided keyword argument. \n\nSo perhaps we should just change the default value of eqns from `None` to some unique value such as `\"not_given\"`.\n\nThen users who want to explicitly pass an empty list of eqns could either pass `eqns=None` or `eqns=[]`.",
    "created_at": "2016-11-23T05:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227375",
    "user": "@mkoeppe"
}
```

Even if it's not good style to distinguish between `None` and `[]`, I think it is fine to distinguish between a provided keyword argument and a not-provided keyword argument. 

So perhaps we should just change the default value of eqns from `None` to some unique value such as `"not_given"`.

Then users who want to explicitly pass an empty list of eqns could either pass `eqns=None` or `eqns=[]`.



---

archive/issue_comments_227376.json:
```json
{
    "body": "I think Python quite often distinguishes between `[]` and `None`:\n\n```\nsage: list([])\n[]\nsage: list(None)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-f23beda2b661> in <module>()\n----> 1 list(None)\n\nTypeError: 'NoneType' object is not iterable\n\nsage: for x in []:\n....:     print(\"hi\")\nsage: for x in None:\n....:     print(\"hi\")\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-5-b89ce2509dd6> in <module>()\n----> 1 for x in None:\n      2     print(\"hi\")\n\nTypeError: 'NoneType' object is not iterable\n```\n\nThey are completely different objects in Python. Other languages behave in the same way for their list-like objects and equivalent of `NULL`.\n\nI agree that it can be useful to have `[]` and `None` behave the same way, but it is not good practice to say we should not distinguish between the two. `None` is also faster, easier, and safer to work with than some other (essentially equally) generic input.",
    "created_at": "2018-09-21T22:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227376",
    "user": "@tscrim"
}
```

I think Python quite often distinguishes between `[]` and `None`:

```
sage: list([])
[]
sage: list(None)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-1-f23beda2b661> in <module>()
----> 1 list(None)

TypeError: 'NoneType' object is not iterable

sage: for x in []:
....:     print("hi")
sage: for x in None:
....:     print("hi")
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-5-b89ce2509dd6> in <module>()
----> 1 for x in None:
      2     print("hi")

TypeError: 'NoneType' object is not iterable
```

They are completely different objects in Python. Other languages behave in the same way for their list-like objects and equivalent of `NULL`.

I agree that it can be useful to have `[]` and `None` behave the same way, but it is not good practice to say we should not distinguish between the two. `None` is also faster, easier, and safer to work with than some other (essentially equally) generic input.



---

archive/issue_comments_227377.json:
```json
{
    "body": "I took the half-backed fix and did some changes that seem to make it work.\n\nIt seems that fixing this ticket implies a fixing #28654. The verification of the double description for backend `field` relied on mistreatment of empty input (or fixing #28654).\n----\nNew commits:",
    "created_at": "2019-12-11T13:00:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227377",
    "user": "@kliem"
}
```

I took the half-backed fix and did some changes that seem to make it work.

It seems that fixing this ticket implies a fixing #28654. The verification of the double description for backend `field` relied on mistreatment of empty input (or fixing #28654).
----
New commits:



---

archive/issue_comments_227378.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-12-11T13:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227378",
    "user": "@kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_227379.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-12-11T14:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227379",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_227380.json:
```json
{
    "body": "I propose leaving the following as it is:\n\n```\nsage: Polyhedron(ambient_dim=2, vertices=[], rays=[(2,2)], lines=[], base_ring=QQ)\nA 1-dimensional polyhedron in QQ^2 defined as the convex hull of 1 vertex and 1 ray\n```\n",
    "created_at": "2019-12-11T15:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227380",
    "user": "@kliem"
}
```

I propose leaving the following as it is:

```
sage: Polyhedron(ambient_dim=2, vertices=[], rays=[(2,2)], lines=[], base_ring=QQ)
A 1-dimensional polyhedron in QQ^2 defined as the convex hull of 1 vertex and 1 ray
```




---

archive/issue_comments_227381.json:
```json
{
    "body": "Should we consider that as valid input? Given a single ray, I don't think there is enough information to determine a polyhedron. However, since that is the current behavior, I cannot strictly object to it. I am only with accepting the ticket as-is since it does improve things, but perhaps we can take a quick second look at the current corner case behaviors?",
    "created_at": "2019-12-12T05:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227381",
    "user": "@tscrim"
}
```

Should we consider that as valid input? Given a single ray, I don't think there is enough information to determine a polyhedron. However, since that is the current behavior, I cannot strictly object to it. I am only with accepting the ticket as-is since it does improve things, but perhaps we can take a quick second look at the current corner case behaviors?



---

archive/issue_comments_227382.json:
```json
{
    "body": "I think if vertices is `None` then it makes sense to add a vertex.\n\nHowever, if vertices is `[]` and there are Rays or Lines, maybe it makes sense to throw an error. The user specifically stated that there are no vertices, so the input doesn't make any sense.",
    "created_at": "2019-12-12T08:43:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227382",
    "user": "@kliem"
}
```

I think if vertices is `None` then it makes sense to add a vertex.

However, if vertices is `[]` and there are Rays or Lines, maybe it makes sense to throw an error. The user specifically stated that there are no vertices, so the input doesn't make any sense.



---

archive/issue_comments_227383.json:
```json
{
    "body": "But you cannot infer what the vertices should be from a single ray (or even line). This should be true more generally for any non-full-dimensional polyhedron that cannot specify at least one point inside it. However, as I write that, it seems like a (computationally) hard problem to me to verify this information. Although maybe this is already implicit in how the polyhedron is constructed?",
    "created_at": "2019-12-12T12:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227383",
    "user": "@tscrim"
}
```

But you cannot infer what the vertices should be from a single ray (or even line). This should be true more generally for any non-full-dimensional polyhedron that cannot specify at least one point inside it. However, as I write that, it seems like a (computationally) hard problem to me to verify this information. Although maybe this is already implicit in how the polyhedron is constructed?



---

archive/issue_comments_227384.json:
```json
{
    "body": "I guess it is just convention, to add a vertex, when rays and lines are given, but no vertex.\nI don't really care about that convention one way or the other. I just left it the way it is.\n\nI don't understand what part is computationally hard.",
    "created_at": "2019-12-13T12:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227384",
    "user": "@kliem"
}
```

I guess it is just convention, to add a vertex, when rays and lines are given, but no vertex.
I don't really care about that convention one way or the other. I just left it the way it is.

I don't understand what part is computationally hard.



---

archive/issue_comments_227385.json:
```json
{
    "body": "I was thinking given enough rays, but now I realize that no matter how much affine data you have, you need to specify a vertex. However, what about a mixture of lines and rays. Although I guess it is documented that the origin is added if no vertices are specified, so it is enshrined as the behavior. Thus this point is moot.",
    "created_at": "2019-12-13T21:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227385",
    "user": "@tscrim"
}
```

I was thinking given enough rays, but now I realize that no matter how much affine data you have, you need to specify a vertex. However, what about a mixture of lines and rays. Although I guess it is documented that the origin is added if no vertices are specified, so it is enshrined as the behavior. Thus this point is moot.



---

archive/issue_comments_227386.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-12-13T21:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227386",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_227387.json:
```json
{
    "body": "fixed zero width space in the author name",
    "created_at": "2019-12-17T23:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227387",
    "user": "@vbraun"
}
```

fixed zero width space in the author name



---

archive/issue_comments_227388.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-12-20T22:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17102",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17102#issuecomment-227388",
    "user": "@vbraun"
}
```

Resolution: fixed
