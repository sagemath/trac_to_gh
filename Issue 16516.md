# Issue 16516: solve of equation system misses trivial simplifications

archive/issues_016516.json:
```json
{
    "body": "Some trivial substitutions are not done by solve:\n\n```\nsage: x,y=var('x,y')\nsage: solve([y==exp(x),2*y-exp(x)==1],x,y)\n[y == e^x, 2*y - e^x == 1]\n```\nand, as reported in http://ask.sagemath.org/question/23652/solve-equations-with-sinx/\n\n```\nsage: solve([y==sin(x),y+4*sin(x)==5],x,y)\n[y == sin(x), y + 4*sin(x) == 5]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16753\n\n",
    "created_at": "2014-08-04T07:09:19Z",
    "labels": [
        "component: calculus",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "solve of equation system misses trivial simplifications",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16516",
    "user": "https://github.com/rwst"
}
```
Some trivial substitutions are not done by solve:

```
sage: x,y=var('x,y')
sage: solve([y==exp(x),2*y-exp(x)==1],x,y)
[y == e^x, 2*y - e^x == 1]
```
and, as reported in http://ask.sagemath.org/question/23652/solve-equations-with-sinx/

```
sage: solve([y==sin(x),y+4*sin(x)==5],x,y)
[y == sin(x), y + 4*sin(x) == 5]
```


Issue created by migration from https://trac.sagemath.org/ticket/16753





---

archive/issue_comments_217059.json:
```json
{
    "body": "Set to critical because it makes Sage look really stupid.",
    "created_at": "2014-08-04T07:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217059",
    "user": "https://github.com/rwst"
}
```

Set to critical because it makes Sage look really stupid.



---

archive/issue_comments_217060.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2014-08-04T07:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217060",
    "user": "https://github.com/rwst"
}
```

Changing priority from major to critical.



---

archive/issue_events_049067.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16516#event-49067"
}
```



---

archive/issue_comments_217061.json:
```json
{
    "body": "I think it is maxima which is unable to solve the equations and returns\n\n```\n%solve([y = sin(x), y + 4*sin(x) = 5],[x,y])\n```\nin this case. Sage converts this to list of solutions. Can we condition sage to return \"Unable to solve\" instead of returning the equations? while reporting this upstream.",
    "created_at": "2016-03-03T05:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217061",
    "user": "https://trac.sagemath.org/admin/accounts/users/ajagekar.akshay"
}
```

I think it is maxima which is unable to solve the equations and returns

```
%solve([y = sin(x), y + 4*sin(x) = 5],[x,y])
```
in this case. Sage converts this to list of solutions. Can we condition sage to return "Unable to solve" instead of returning the equations? while reporting this upstream.



---

archive/issue_comments_217062.json:
```json
{
    "body": "You mean a general change for unsolved equations/relations? That would be a different ticket which you would have to open. I'm not against a change but I'd rather have solve return a set, and in case of unsolved an empty set.",
    "created_at": "2016-03-03T06:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217062",
    "user": "https://github.com/rwst"
}
```

You mean a general change for unsolved equations/relations? That would be a different ticket which you would have to open. I'm not against a change but I'd rather have solve return a set, and in case of unsolved an empty set.



---

archive/issue_comments_217063.json:
```json
{
    "body": "A test which returned initial function instead of solutions was failing\n\n```\nsolve([sin(x)==x,y^2==x],x,y)\nExpected:\n    [sin(x) == x, y^2 == x]\nGot:\n    []\n```\n I have changed that test. Please have a look.",
    "created_at": "2016-03-03T15:14:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217063",
    "user": "https://trac.sagemath.org/admin/accounts/users/ajagekar.akshay"
}
```

A test which returned initial function instead of solutions was failing

```
solve([sin(x)==x,y^2==x],x,y)
Expected:
    [sin(x) == x, y^2 == x]
Got:
    []
```
 I have changed that test. Please have a look.



---

archive/issue_comments_217064.json:
```json
{
    "body": "Your ticket branch shows MeatAxe changes. Probably you branched not from develop. Use `git trac checkout` to have a proper start.",
    "created_at": "2016-03-03T15:45:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217064",
    "user": "https://github.com/rwst"
}
```

Your ticket branch shows MeatAxe changes. Probably you branched not from develop. Use `git trac checkout` to have a proper start.



---

archive/issue_comments_217065.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-03T16:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217065",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217066.json:
```json
{
    "body": "Sorry for that mistake.",
    "created_at": "2016-03-03T16:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217066",
    "user": "https://trac.sagemath.org/admin/accounts/users/ajagekar.akshay"
}
```

Sorry for that mistake.



---

archive/issue_comments_217067.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-03-04T14:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217067",
    "user": "https://trac.sagemath.org/admin/accounts/users/ajagekar.akshay"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_217068.json:
```json
{
    "body": "This solution doesn't fly. Presently:\n\n```\nsage: solve([x==5],[x])\n[x == 5]\n```\nwith this patch, it would return []. That's bad.\n\nIn general, I think it's bad to silently returning an empty list in a case where we know we failed to \"solve\" the system. An empty list can be interpreted as an inconsistent system of equations.\n\nThe original behaviour, returning the original system, indicates better a failure to solve than an empty solution list does. Therefore, I think that is preferable.\n\nYou could argue that returning the original system would be \"invalid\" output, because usually it means that the LH sides of the equations aren't the to-be-solved-for variables and/or the RH sides won't be free of them.\n\nIn that case, returning an error is a better solution.\n\nI think the parsing that happens for `solution_dict=True` is definitely broken:\n\n```\nsage: solve([y == sin(x), y + 4*sin(x) == 5],[x,y],solution_dict=True)\n[{y: sin(x)}, {y + 4*sin(x): 5}]\n```\nCompared with\n\n```\nsage: solve([x^2==5,y==6],[x,y],solution_dict=True)\n[{y: 6, x: -sqrt(5)}, {y: 6, x: sqrt(5)}]\n```\nit's clearly very misleading output. So for `solution_dict=True` I think we have a good case for an error. Without it, I think the current output is misleading. But so is:\n\n```\nsage: solve(x-1,x)\n[x == 1]\nsage: solve([x-1],[x])\n[x == 1]\nsage: solve([x-1,y-1],[x,y])\n[[x == 1, y == 1]]\nsage: solve([x-1],[x],solution_dict=True)\nTypeError: 'sage.symbolic.expression.Expression' object is not iterable\n```\n(we'd probably be better off if also in the single-variable case we'd also return list-of-lists etc.)\n\nBeware of legacy, though. There might be users out there that have grown fond of this bad behaviour and somehow depend on it.",
    "created_at": "2016-03-04T16:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217068",
    "user": "https://github.com/nbruin"
}
```

This solution doesn't fly. Presently:

```
sage: solve([x==5],[x])
[x == 5]
```
with this patch, it would return []. That's bad.

In general, I think it's bad to silently returning an empty list in a case where we know we failed to "solve" the system. An empty list can be interpreted as an inconsistent system of equations.

The original behaviour, returning the original system, indicates better a failure to solve than an empty solution list does. Therefore, I think that is preferable.

You could argue that returning the original system would be "invalid" output, because usually it means that the LH sides of the equations aren't the to-be-solved-for variables and/or the RH sides won't be free of them.

In that case, returning an error is a better solution.

I think the parsing that happens for `solution_dict=True` is definitely broken:

```
sage: solve([y == sin(x), y + 4*sin(x) == 5],[x,y],solution_dict=True)
[{y: sin(x)}, {y + 4*sin(x): 5}]
```
Compared with

```
sage: solve([x^2==5,y==6],[x,y],solution_dict=True)
[{y: 6, x: -sqrt(5)}, {y: 6, x: sqrt(5)}]
```
it's clearly very misleading output. So for `solution_dict=True` I think we have a good case for an error. Without it, I think the current output is misleading. But so is:

```
sage: solve(x-1,x)
[x == 1]
sage: solve([x-1],[x])
[x == 1]
sage: solve([x-1,y-1],[x,y])
[[x == 1, y == 1]]
sage: solve([x-1],[x],solution_dict=True)
TypeError: 'sage.symbolic.expression.Expression' object is not iterable
```
(we'd probably be better off if also in the single-variable case we'd also return list-of-lists etc.)

Beware of legacy, though. There might be users out there that have grown fond of this bad behaviour and somehow depend on it.



---

archive/issue_comments_217069.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-04T16:24:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217069",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_217070.json:
```json
{
    "body": "```\nsage: solve([x==5],[x])\n```\nreturns ` [x == 5]` as expected, the changed code gets executed only for system of equations.\nEven for cases like \n\n``` \nsage: solve([x==5,y==2],x,y) \n```\nmaxima returns list of list as solution ` [This is the Trac macro *x == 5, y == 2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x == 5, y == 2-macro)`, so an empty set is not returned. I also think returning error would be better for unsolved equations. For TypeError, the parsing for ` solution_dict = True`\ncan be fixed by checking length of variables list and adding appropriate condition.",
    "created_at": "2016-03-05T06:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16516#issuecomment-217070",
    "user": "https://trac.sagemath.org/admin/accounts/users/ajagekar.akshay"
}
```

```
sage: solve([x==5],[x])
```
returns ` [x == 5]` as expected, the changed code gets executed only for system of equations.
Even for cases like 

``` 
sage: solve([x==5,y==2],x,y) 
```
maxima returns list of list as solution ` [This is the Trac macro *x == 5, y == 2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x == 5, y == 2-macro)`, so an empty set is not returned. I also think returning error would be better for unsolved equations. For TypeError, the parsing for ` solution_dict = True`
can be fixed by checking length of variables list and adding appropriate condition.
