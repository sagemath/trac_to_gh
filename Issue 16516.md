# Issue 16516: solve of equation system misses trivial simplifications

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-08-04 07:09:19

(please write a better title)

Some trivial substitutions are not done by solve:

```
sage: x,y=var('x,y')
sage: solve([y==exp(x),2*y-exp(x)==1],x,y)
[y == e^x, 2*y - e^x == 1]
```

and, as reported in http://ask.sagemath.org/question/23652/solve-equations-with-sinx/

```
sage: solve([y==sin(x),y+4*sin(x)==5],x,y)
[y == sin(x), y + 4*sin(x) == 5]
```



---

Comment by rws created at 2014-08-04 07:39:53

Set to critical because it makes Sage look really stupid.


---

Comment by rws created at 2014-08-04 07:39:53

Changing priority from major to critical.


---

Comment by ajagekar.akshay created at 2016-03-03 05:01:09

I think it is maxima which is unable to solve the equations and returns

```
%solve([y = sin(x), y + 4*sin(x) = 5],[x,y])
```

in this case. Sage converts this to list of solutions. Can we condition sage to return "Unable to solve" instead of returning the equations? while reporting this upstream.


---

Comment by rws created at 2016-03-03 06:47:39

You mean a general change for unsolved equations/relations? That would be a different ticket which you would have to open. I'm not against a change but I'd rather have solve return a set, and in case of unsolved an empty set.


---

Comment by ajagekar.akshay created at 2016-03-03 15:14:03

A test which returned initial function instead of solutions was failing

```
solve([sin(x)==x,y^2==x],x,y)
Expected:
    [sin(x) == x, y^2 == x]
Got:
    []
```

 I have changed that test. Please have a look.


---

Comment by rws created at 2016-03-03 15:45:16

Your ticket branch shows MeatAxe changes. Probably you branched not from develop. Use `git trac checkout` to have a proper start.


---

Comment by git created at 2016-03-03 16:03:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ajagekar.akshay created at 2016-03-03 16:05:43

Sorry for that mistake.


---

Comment by ajagekar.akshay created at 2016-03-04 14:03:15

Changing status from new to needs_review.


---

Comment by nbruin created at 2016-03-04 16:24:37

This solution doesn't fly. Presently:

```
sage: solve([x==5],[x])
[x == 5]
```

with this patch, it would return []. That's bad.

In general, I think it's bad to silently returning an empty list in a case where we know we failed to "solve" the system. An empty list can be interpreted as an inconsistent system of equations.

The original behaviour, returning the original system, indicates better a failure to solve than an empty solution list does. Therefore, I think that is preferable.

You could argue that returning the original system would be "invalid" output, because usually it means that the LH sides of the equations aren't the to-be-solved-for variables and/or the RH sides won't be free of them.

In that case, returning an error is a better solution.

I think the parsing that happens for `solution_dict=True` is definitely broken:


```
sage: solve([y == sin(x), y + 4*sin(x) == 5],[x,y],solution_dict=True)
[{y: sin(x)}, {y + 4*sin(x): 5}]
```

Compared with

```
sage: solve([x^2==5,y==6],[x,y],solution_dict=True)
[{y: 6, x: -sqrt(5)}, {y: 6, x: sqrt(5)}]
```

it's clearly very misleading output. So for `solution_dict=True` I think we have a good case for an error. Without it, I think the current output is misleading. But so is:

```
sage: solve(x-1,x)
[x == 1]
sage: solve([x-1],[x])
[x == 1]
sage: solve([x-1,y-1],[x,y])
[This is the Trac macro *x == 1, y == 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x == 1, y == 1-macro)
sage: solve([x-1],[x],solution_dict=True)
TypeError: 'sage.symbolic.expression.Expression' object is not iterable
```

(we'd probably be better off if also in the single-variable case we'd also return list-of-lists etc.)

Beware of legacy, though. There might be users out there that have grown fond of this bad behaviour and somehow depend on it.


---

Comment by nbruin created at 2016-03-04 16:24:37

Changing status from needs_review to needs_work.


---

Comment by ajagekar.akshay created at 2016-03-05 06:16:19


```
sage: solve([x==5],[x])
```

returns ` [x == 5]` as expected, the changed code gets executed only for system of equations.
Even for cases like 
{{{ 
sage: solve([x==5,y==2],x,y) 
}}}
maxima returns list of list as solution ` [This is the Trac macro *x == 5, y == 2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x == 5, y == 2-macro)`, so an empty set is not returned. I also think returning error would be better for unsolved equations. For TypeError, the parsing for ` solution_dict = True`
can be fixed by checking length of variables list and adding appropriate condition.


---

Comment by mmezzarobba created at 2020-10-08 09:34:35

Changing priority from critical to major.
