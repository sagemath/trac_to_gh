# Issue 16644: Fix caching of NumberField_generic.__pari_bnf_certified

Issue created by migration from Trac.

Original creator: pbruin

Original creation time: 2014-08-26 11:46:48

CC:  jdemeyer

Keywords: cache, performance

The method `NumberField_generic.pari_bnf()` does not detect if the PARI `bnf` has already been certified and therefore always calls `bnfcertify()`.  This is due to name-mangling of double-underscore attributes; more precisely,

```
getattr(self, "__pari_bnf_certified", False)
```

should be

```
getattr(self, "_NumberField_generic__pari_bnf_certified", False)
```



---

Comment by pbruin created at 2014-08-26 11:54:26

Changing status from new to needs_review.


---

Comment by pbruin created at 2014-08-26 11:54:26

Before:

```
sage: K.<a> = NumberField(x^2 - 17*x - 8)
sage: K.pari_bnf();
sage: %timeit K.pari_bnf()
100 loops, best of 3: 3.01 ms per loop
```

After:

```
sage: K.<a> = NumberField(x^2 - 17*x - 8)
sage: K.pari_bnf();
sage: %timeit K.pari_bnf()
1000000 loops, best of 3: 1.56 Î¼s per loop
```



---

Comment by jdemeyer created at 2014-08-28 19:41:36

I would much prefer to use `_pari_bnf_certified` instead of `_NumberField_generic__pari_bnf_certified`, it would the code a lot more readable.


---

Comment by jdemeyer created at 2014-08-28 19:41:36

Changing status from needs_review to needs_work.


---

Comment by pbruin created at 2014-08-28 20:05:35

I have nothing against that, but for consistency we should then change all number field attributes starting with `__pari`, namely:
- `__pari_bnf`
- `__pari_bnf_certified`
- `__pari_nf`
- `__pari_polynomial`
The same could be done for elements, ideals and unit groups, if that isn't taking it too far.


---

Comment by jdemeyer created at 2014-08-28 20:07:12

Replying to [comment:3 pbruin]:
> I have nothing against that, but for consistency we should then change all number field attributes starting with `__pari`, namely:
> - `__pari_bnf`
> - `__pari_bnf_certified`
> - `__pari_nf`
> - `__pari_polynomial`
Good for me...


---

Comment by pbruin created at 2014-08-28 20:40:54

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-09-02 11:24:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-09-06 11:02:34

Resolution: fixed
