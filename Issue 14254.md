# Issue 14254: indentation problem with "except" in doctests

Issue created by migration from https://trac.sagemath.org/ticket/14458

Original creator: zimmerma

Original creation time: 2013-04-16 12:06:52

Assignee: roed

CC:  ncohen mmezzarobba

Consider the following doctest:

```
"""
  sage: try:
  ...      raise ValueError
  ...      print "Le probleme a une solution !"
  ...   except:
  ...      print "Le probleme est infaisable !"
  Le probleme est infaisable !
"""
```

Then with Sage 5.7, `sage -t doctest.sage` fails with:

```
      File "<doctest __main__.example_0[2]>", line 4
        except:
              ^
    IndentationError: unindent does not match any outer indentation level
```


However, with the following modified doctest, where `except` is wrongly indented, `sage -t` works:

```
"""
  sage: try:
  ...      raise ValueError
  ...      print "Le probleme a une solution !"
  ... except:
  ...      print "Le probleme est infaisable !"
  Le probleme est infaisable !
"""
```

This is annoying when using sagetex: either we use the first version and the doctest fails, or we use the second version and the printed code is badly indented.


---

Comment by roed created at 2013-04-16 14:10:53

You should use the following, which will work in Sage 5.9:


```
sage: try:
....:     raise ValueError
....:     print "Le probleme a une solution !"
....: except:
....:     print "Le probleme est infaisable !"
Le probleme est infaisable !
```



---

Comment by zimmerma created at 2013-04-16 14:18:33

unfortunately our book is currently based on 5.7, not 5.9.
And this would force us to change all

```
...
```

to

```
....:
```

if I understand correctly. Btw, what is the ticket corresponding to this change?

Paul


---

Comment by roed created at 2013-04-16 17:25:46

The ticket is #12415.  I guess I'm confused about exactly what the issue is.  You say that you get an indentation error in Sage 5.7?  The change I'm referring to wasn't merged until 5.9.  Is this a test that's in a book you're currently working on?  Did this test work in some previous version of Sage?


---

Comment by zimmerma created at 2013-04-16 18:40:28

David, yes this is an example of our book on Sage. The issue is that in our LaTeX source, we have the
example, that is either processed by LaTeX to produce the pdf of the book, or by sagetex to produce doctests to ensure the example works with Sage n+1.

Previously we had the 2nd version (with except not aligned with try): the doctest worked, but a reader of the book reported about the non-alignment issue. We fixed the alignment, and now the doctest fails.

This is a non-blocking issue for us, since with sagetex we can duplicate the example, one for the pdf, one to produce the doctest. Since we never had the correct alignment, we don't know if it ever worked before.

Paul


---

Comment by roed created at 2013-04-17 00:40:17

I would guess that it never worked.  I assume you want the code in the book to work with versions of Sage before 5.9?  Or is that not a requirement?


---

Comment by zimmerma created at 2013-04-17 06:27:51

Replying to [comment:5 roed]:
> I would guess that it never worked.  I assume you want the code in the book to work with versions of Sage before 5.9?  Or is that not a requirement?

the **printed** version of the example in the book will be ok, and will work with any version of Sage.

This is only a doctest issue, and as I said it is non-blocking for our book, since we have a workaround.

Paul


---

Comment by roed created at 2013-04-17 06:37:01

Replying to [comment:6 zimmerma]:
> Replying to [comment:5 roed]:
> > I would guess that it never worked.  I assume you want the code in the book to work with versions of Sage before 5.9?  Or is that not a requirement?
> 
> the **printed** version of the example in the book will be ok, and will work with any version of Sage.
> 
> This is only a doctest issue, and as I said it is non-blocking for our book, since we have a workaround.

Sure.  Then I guess I would argue for closing this as a duplicate/wontfix, since #12415 introduces a syntax that essentially achieves what you're looking for.


---

Comment by zimmerma created at 2013-04-17 07:28:57

> Then I guess I would argue for closing this as a duplicate/wontfix, since #12415 introduces a syntax that essentially achieves what you're looking for.

with #12415 is the syntax we use in this ticket description still valid? And does it work as
expected (with correct alignement)? We don't want to invalidate all examples from our book...

Paul


---

Comment by roed created at 2013-04-17 07:35:52

Replying to [comment:8 zimmerma]:
> > Then I guess I would argue for closing this as a duplicate/wontfix, since #12415 introduces a syntax that essentially achieves what you're looking for.
> 
> with #12415 is the syntax we use in this ticket description still valid? And does it work as
> expected (with correct alignement)? We don't want to invalidate all examples from our book...
> 
> Paul

Yes, it should still work.  There's just a preprocessing step which replaces "....: " with "... "


---

Comment by zimmerma created at 2013-04-17 07:41:56

good, then indeed we can close this ticket.

Paul


---

Comment by roed created at 2013-04-17 07:43:59

Changing status from new to needs_review.


---

Comment by roed created at 2013-04-17 07:44:08

Changing status from needs_review to positive_review.


---

Comment by zimmerma created at 2013-04-17 08:18:57

Nathann just checked with Sage 5.9, and it stills fails with `...`, i.e.,
the first example in the ticket description.

Paul


---

Comment by ncohen created at 2013-04-17 08:21:36

> Nathann just checked with Sage 5.9, and it stills fails with `...`, i.e.,
> the first example in the ticket description.

(though I personally think that the book has to adapt to Sage, not the opposite)

Nathann


---

Comment by roed created at 2013-04-17 08:31:14

Yes, I should have been more clear: the first example should fail.  It's equivalent to the plain Python


```
try:
     raise ValueError
     print "Le probleme a une solution !"
  except:
     print "Le probleme est infaisable !"
```

which is of course a Syntax error.  If you want an example that's formatted reasonably, use the new syntax introduced by #12415: that's why it was added.  The second example should work correctly in the new framework though.


---

Comment by jdemeyer created at 2013-04-17 16:00:53

I would actually recommend to use

```
sage: try:
....:     raise ValueError
....:     print "Le probleme a une solution !"
....: except:
....:     print "Le probleme est infaisable !"
Le probleme est infaisable !
```

in print in the book. Because that's what a user sees on the command line if they type in the example, both with old and new versions of Sage.


---

Comment by jdemeyer created at 2013-04-19 18:53:39

Resolution: invalid


---

Comment by jdemeyer created at 2013-05-01 08:36:26

In #14512, I propose to use the

```
sage:
....:
....:
```

syntax in _all_ doctests.
