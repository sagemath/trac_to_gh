# Issue 12368: Graph library passes almost surelly erroneous calls without an exception

archive/issues_012368.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  @vbraun @nathanncohen\n\n1. Dense backend doesn't support edge labels, but add_edge(1, 2, 3) passes and behaves like add_edge(1, 2, None). (#12387)\n   2. Adding a loop to a graph with allows_loops=False do nothing.\n   3. Adding an already present edge to a graph with allows_multiedges=False do nothing.\n   4. (Other?)\n\nIs this the proper behavior?\n\nIssue created by migration from https://trac.sagemath.org/ticket/12540\n\n",
    "created_at": "2012-02-19T17:02:02Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Graph library passes almost surelly erroneous calls without an exception",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12368",
    "user": "https://trac.sagemath.org/admin/accounts/users/brunellus"
}
```
Assignee: jason, ncohen, rlm

CC:  @vbraun @nathanncohen

1. Dense backend doesn't support edge labels, but add_edge(1, 2, 3) passes and behaves like add_edge(1, 2, None). (#12387)
   2. Adding a loop to a graph with allows_loops=False do nothing.
   3. Adding an already present edge to a graph with allows_multiedges=False do nothing.
   4. (Other?)

Is this the proper behavior?

Issue created by migration from https://trac.sagemath.org/ticket/12540





---

archive/issue_comments_145547.json:
```json
{
    "body": "No answer here, so I ask explicitly again about (2).\n\nIn `SparseGraphBackend`, for example, the following lines appear in the `add_edge` method:\n\n```python\n        if (not self.loops(None)) and u_int == v_int:\n            return\n```\n\n\nThis means that if the backend does not allow loops, the `add_edge` method silently ignore the added edge.  By default, `SparseGraphBackend` does not allow loops.\n\nIs this a wanted behaviour?\n\nIf not, there are couple of ways to handle this:\n\n1. raise from inside the backend method\n2. warn (somehow) from inside the backend method\n3. let the backend return `False` (or whatever) in case the edge was not added, and let the graph itself notice it and raise/warn",
    "created_at": "2016-11-29T09:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12368#issuecomment-145547",
    "user": "https://github.com/pelegm"
}
```

No answer here, so I ask explicitly again about (2).

In `SparseGraphBackend`, for example, the following lines appear in the `add_edge` method:

```python
        if (not self.loops(None)) and u_int == v_int:
            return
```


This means that if the backend does not allow loops, the `add_edge` method silently ignore the added edge.  By default, `SparseGraphBackend` does not allow loops.

Is this a wanted behaviour?

If not, there are couple of ways to handle this:

1. raise from inside the backend method
2. warn (somehow) from inside the backend method
3. let the backend return `False` (or whatever) in case the edge was not added, and let the graph itself notice it and raise/warn



---

archive/issue_comments_145548.json:
```json
{
    "body": "The behavior for loops has change and the default behavior is now to raise an error by default.\n\n```\nsage: G = Graph([(0, 0)], loops=None, data_structure=\"sparse\")\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: cannot add edge from 0 to 0 in graph without loops\nsage:\nsage: G = Graph([(0, 0)], loops=None, data_structure=\"dense\")\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: cannot add edge from 0 to 0 in graph without loops\nsage:\nsage: G = Graph([(0, 0)], loops=False, data_structure=\"sparse\")\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: cannot add edge from 0 to 0 in graph without loops\nsage:\nsage: G = Graph([(0, 0)], loops=False, data_structure=\"dense\")\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n...\nValueError: cannot add edge from 0 to 0 in graph without loops\n```\n",
    "created_at": "2021-12-08T16:04:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12368",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12368#issuecomment-145548",
    "user": "https://github.com/dcoudert"
}
```

The behavior for loops has change and the default behavior is now to raise an error by default.

```
sage: G = Graph([(0, 0)], loops=None, data_structure="sparse")
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: cannot add edge from 0 to 0 in graph without loops
sage:
sage: G = Graph([(0, 0)], loops=None, data_structure="dense")
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: cannot add edge from 0 to 0 in graph without loops
sage:
sage: G = Graph([(0, 0)], loops=False, data_structure="sparse")
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: cannot add edge from 0 to 0 in graph without loops
sage:
sage: G = Graph([(0, 0)], loops=False, data_structure="dense")
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
...
ValueError: cannot add edge from 0 to 0 in graph without loops
```

