# Issue 27225: move toolchain into a separate package

Issue created by migration from https://trac.sagemath.org/ticket/27462

Original creator: dimpase

Original creation time: 2019-03-11 11:24:33

CC:  embray jdemeyer fbissey vbraun @timokau

Subject to relatively easy to complete  #27212, #27258, and #27259,
every Sage toolchain part and dependency need not be built any more.

This allows moving the toolchain into a separate package, with 
parts seldom needed on sufficiently new Linux, Cygwin, and OSX+Homebrew (or whatever that comes with gfortran).


---

Comment by jdemeyer created at 2019-03-11 11:26:53

Replying to [ticket:27462 dimpase]:
> This allows moving the toolchain into a separate package

What do you mean here?


---

Comment by dimpase created at 2019-03-11 11:32:04

I mean: create sage-toolchain, a helper package that might be needed to build Sage on tricky systems, but not needed in most cases.

With gcc, gfortran, mpir, gmp, mpfr (and maybe some more things like patch) moved over there.


---

Comment by jdemeyer created at 2019-03-11 11:33:49

Replying to [comment:2 dimpase]:
> I mean: create sage-toolchain, a helper package

A "package" in the sense of a Sage package?

I'm -1 to this idea: by replacing clearly defined separate packages by one big package, you're making things more complicated rather than simpler.

I don't really understand which problem this ticket is trying to solve. If you really want to reduce some complexity, I suggest to review #27215.


---

Comment by dimpase created at 2019-03-11 11:40:23

Replying to [comment:3 jdemeyer]:
> Replying to [comment:2 dimpase]:
> > I mean: create sage-toolchain, a helper package
> 
> A "package" in the sense of a Sage package?

no, no, a separate from Sage thing, like cysignals, say...


---

Comment by jdemeyer created at 2019-03-11 11:46:13

Replying to [comment:4 dimpase]:
> no, no, a separate from Sage thing, like cysignals, say...

cysignals is a Sage package...


---

Comment by jdemeyer created at 2019-03-11 11:48:22

But mpir, mpfr, mpc are already existing packages "like cysignals". So you're suggesting to bundle these packages in a bigger package, adding another layer of packaging? And this is somehow going to simplify things?


---

Comment by dimpase created at 2019-03-11 11:52:55

Replying to [comment:5 jdemeyer]:
> Replying to [comment:4 dimpase]:
> > no, no, a separate from Sage thing, like cysignals, say...
> 
> cysignals is a Sage package...

wrong analogy, sorry. Like tar, which used to be in Sage, IIRC...


---

Comment by dimpase created at 2019-03-11 11:58:46

A package in sense of autotools, if you like. Which can be built and installed somewhere, maybe with `sudo`, using a slimmed down Sage build system.


---

Comment by embray created at 2019-03-12 12:25:59

I have thought of doing something similar, but not in the way you're describing.  What I would like to do, as I've written many times, is strip out _all_ of the sage-the-distribution tooling from the main Sage repository, and make the actual sage repository just everything that's currently under `src/` and not much else.

There would be a base system for the tooling that makes up sage-the-distribution, including the components for building the toolchain itself (where necessary).  On top of that there would be an implementation of sage-the-distribution that is otherwise more-or-less the specific collection of SPKGs we have currently, including sagelib itself as an SPKG (see #27348).

That would be completely different from what you're describing here, but I think would achieve the same results.

I'm not sure this is worth the effort.  Why waste effort cobbling together our own gcc-and-friends toolchain rather than focus on just building on existing supported toolchains (e.g. homebrew, etc.)?  Who would this idea even be in service to except maybe some OSX users trying to build on Xcode?


---

Comment by dimpase created at 2019-03-12 12:46:35

What you describe is a non-incremental, or at least I don't understand how it is incremental.

And what I describe is pretty much incremental, and I don't see why it's much of an effort, as basically all the needed tooling for the toolchain is already there.
I agree that the main users of the separate toolchain would be the OSX users trying to build on Xcode (with a smaller population trying to build on old/weird Linux systems, for one or other reason, e.g. on HPC clusters).


---

Comment by embray created at 2019-03-12 12:57:23

I'm not sure what you mean by "incremental".

I'm also not really clear how you're envisioning cobbling together a bunch of different packages into a single source package distribution.  It seems like reinventing the wheel for not much benefit.

Sorry, I just don't see the point to this.  I think you're worrying about a problem that's outside the scope of the Sage project (and that's not your fault--this problem was already dug for us when Sage made it our problem by shipping its own gcc package). A technical debt we should work to remove/marginalize, not make more work out of.  I _think_ that's what you're trying to do in a way, but I think we're better off leaving that to other projects like Homebrew (I would be interested in trying to build Sage on Homebrew and make sure that works; I just don't know anything about Homebrew in the first place but am willing to learn).


---

Comment by dimpase created at 2019-03-12 12:58:09

And when you say "a base system for the tooling that makes up sage-the-distribution" it's exactly what I have in mind: it would start just with the toolchain alone, and gradually absorb more pieces. There is an effort to maintain this, naturally, I don't see how thie effort would be smaller than along the way proposed here.

While many (me including) wish to drop gcc and friends from Sage completely, this is a no-starter proposition at the moment. And we do have to start somewhere, don't we?


---

Comment by dimpase created at 2019-03-12 13:14:57

Replying to [comment:13 embray]:
> I'm not sure what you mean by "incremental".
> 
> I'm also not really clear how you're envisioning cobbling together a bunch of different packages into a single source package distribution.  It seems like reinventing the wheel for not much benefit.

The wheel is already there (it's called Sage). One basically just has to remove a lot of spokes, pythons, and other snakes from it :-).
The goodies it provides are in a prefix called SAGE_LOCAL.

And "incremental" is that the spokes etc may be added back, incrementally.


> 
> Sorry, I just don't see the point to this.  I think you're worrying about a problem that's outside the scope of the Sage project (and that's not your fault--this problem was already dug for us when Sage made it our problem by shipping its own gcc package).

It's not outside the Sage project (or its grief, if you like) just because its tooling is what a lot of effort (and electricity) is spent on. And a lot of grief comes from the monolitic nature, which this proposal aims at reducing.

>  A technical debt we should work to remove/marginalize, not make more work out of. 
Sure, but we have to start the removal, yet, you cannot just remove without offering
continuity. 

> I _think_ that's what you're trying to do in a way, but I think we're better off leaving that to other projects like Homebrew (I would be interested in trying to build Sage on Homebrew and make sure that works; I just don't know anything about Homebrew in the first place but am willing to learn).

An early Sage 8.7 beta I tried to build on Homebrew (with more stuff from #27330 than currently merged) worked and passed all the tests on my old dying OSX 10.13 laptop.
It's basically done in the sense that no gcc/gfortran etc needs to be built on OSX.


---

Comment by embray created at 2019-03-12 13:54:42

Replying to [comment:14 dimpase]:
> And when you say "a base system for the tooling that makes up sage-the-distribution" it's exactly what I have in mind: it would start just with the toolchain alone, and gradually absorb more pieces. There is an effort to maintain this, naturally, I don't see how thie effort would be smaller than along the way proposed here.

Right. I think we both essentially want the same thing here in terms of end result.  Maybe just different ideas about the approach.  But it's hard to tell because it's not clear exactly what you have in mind.  What I want to do is just reuse what we already have, but make it easier to maintain in a separate source tree.


---

Comment by embray created at 2019-06-14 14:54:19

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by mkoeppe created at 2020-02-09 02:00:31

I suggest to close this ticket because its description is unclear.


---

Comment by mkoeppe created at 2020-02-09 02:00:31

Changing status from new to needs_review.


---

Comment by dimpase created at 2020-02-10 00:35:19

Sage toolchain is a well-defined subset of spkg's, with particularly convoluted rebuild rules (as some of them are dual-purpose, needed for building as well as for sagelib itself). 

It's a proposal to spin it out into a separate "mini-sage-the-distro",
which on systems with enough system packages will be basically empty. The remaining part of spkg's will be closer to pip-installable thing.


---

Comment by dimpase created at 2020-02-10 00:36:31

the question is of course whether to do such a separation is too much work for little gain.


---

Comment by dimpase created at 2020-02-10 00:36:31

Changing status from needs_review to needs_info.


---

Comment by mkoeppe created at 2020-02-10 00:44:39

Are you talking about a binary distribution?


---

Comment by dimpase created at 2020-02-10 01:04:55

source.


---

Comment by mkoeppe created at 2020-02-10 01:39:50

Where would it be installed?


---

Comment by dimpase created at 2020-02-10 11:02:10

Replying to [comment:23 mkoeppe]:
> Where would it be installed?
it should have its own prefix, so that different versions of sagelib can be used with it.

essentially, it'd be a "NanoConda".


---

Comment by dimpase created at 2020-11-06 16:03:16

Changing status from needs_info to positive_review.


---

Comment by dimpase created at 2020-11-06 16:03:16

we are moving this way :-)


---

Comment by mkoeppe created at 2021-06-24 20:15:37

Resolution: invalid
