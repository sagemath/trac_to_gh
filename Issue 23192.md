# Issue 23192: Multivector fields and the Schouten-Nijenhuis bracket

Issue created by migration from Trac.

Original creator: egourgoulhon

Original creation time: 2017-07-13 22:09:28

CC:  bpym tscrim

Keywords: multivector, Schouten-Nijenhuis bracket

This ticket implements *multivector fields* (i.e. alternating contravariant tensor fields) on differentiable manifolds, via the parent classes 

- `MultivectorModule`: set _A<sup>p</sup>(M)_ of multivector fields of a degree _p_ on a manifold _M_, considered as a module over the commutative algebra _C<sup>k</sup>(M)_ of differentiable scalar fields
- `MultivectorFreeModule`: set _A<sup>p</sup>(M)_ of multivector fields of a degree _p_ on a _parallelizable_ manifold _M_, considered as a _free_ module of rank binomial(_n,p_) over _C<sup>k</sup>(M)_ (where _n_=dim_M_)

and the element classes

- `MultivectorField`: multivector field on a differentiable manifold
- `MultivectorFieldParal`: multivector field on a parallelizable differentiable manifold

The classes `MultivectorFreeModule` and `MultivectorFieldParal` inherit from respectively `ExtPowerFreeModule` and `AlternatingContrTensor`, which have been introduced in #23207.

The classes `VectorField` and `VectorFieldParal` inherit now from the new classes `MultivectorField` and `MultivectorFieldParal`, since a vector field is a multivector field of degree 1. 

The ticket implements the *exterior product* _A<sup>p</sup>(M)_ x _A<sup>q</sup>(M)_ ---> _A<sup>p+q</sup>(M)_ (method `wedge`), as well as the **interior products**
- _A<sup>p</sup>(M)_ x Omega_<sup>q</sup>(M)_ ---> Omega_<sup>q-p</sup>(M)_
- Omega_<sup>p</sup>(M)_ x _A<sup>q</sup>(M)_ ---> _A<sup>q-p</sup>(M)_
for _p<=q_, where Omega_<sup>p</sup>(M)_ is the _C<sup>k</sup>(M)_-module of differential forms of degree _p_ on _M_ (method `interior_product`).
The ticket also implements the *Schouten-Nijenhuis bracket* _A<sup>p</sup>(M)_x_A<sup>q</sup>(M)_ ---> _A<sup>p+q-1</sup>(M)_ (method `bracket`), extending the Lie bracket of vector fields.

This is a follow up of #23207 within the [SageManifolds project](http://sagemanifolds.obspm.fr/) (see the metaticket #18528 for an overview).


---

Comment by egourgoulhon created at 2017-07-13 22:10:36

Last 10 new commits:


---

Comment by egourgoulhon created at 2017-07-13 22:10:36

Changing status from new to needs_review.


---

Comment by git created at 2017-09-05 07:41:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2017-09-05 07:47:43

Following what has been done in #23623 for tensor field modules, the above commit changes the potentially expensive test

```
if comp == 0:
    return self.zero() 
```

to 

```
if isinstance(comp, (int, Integer)) and comp == 0:
    return self.zero()
```

in `_element_constructor_` of classes `MultivectorModule` and `MultivectorFreeModule`.


---

Comment by git created at 2017-09-20 09:00:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2017-09-20 09:03:57

The above commit (cf. comment:4) solves a merge conflict with Sage 8.1.beta5 in the master file for references (`src/doc/en/reference/references/index.rst`).


---

Comment by tscrim created at 2017-09-29 20:15:10

A few minor comments:

Typo (appears twice):

```
- ``other`` -- a multivector field, `b` say
```


No comma here:

```
- ``other`` -- a multivector field, of degree `p`
```


Could you remove a few of these extra blanklines:

```diff
+    The Lie derivative of a 2-vector field is a 2-vector field::
+
+        sage: ab.lie_der(a)
+        2-vector field on the 3-dimensional differentiable manifold R3
+
+
+
+    """
+    def __init__(self, vector_field_module, degree, name=None,
+                 latex_name=None):
```


It is a little easier to read

```diff
-       resu_name = None ; resu_latex_name = None
+       resu_name = None
+       resu_latex_name = None
```


Do you need to use Sage's `Set`? It is quite a bit slower than the Python `set`.

For things like this:

```python
                resu._restrictions[dom] = \
                                     dom.tensor_field_module((p,0))(rst)
```

it is better on 1 line and go over the 80 char/line for maintenance and readability. This is more a judgment call about the lesser of two evils.


---

Comment by git created at 2017-09-30 08:53:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2017-09-30 09:00:41

Replying to [comment:6 tscrim]:

Thanks for your comments; the above commit takes them into account.

> Do you need to use Sage's `Set`? 

Yes, because I need the method `subsets`, which does not exist for Python `set`.


---

Comment by git created at 2017-09-30 15:12:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2017-09-30 15:15:39

I've just noticed a typo in the `__call__` method of `TensorField`, as well as a redundant import in `vectorfield_module.py`. The above commit corrects this.


---

Comment by tscrim created at 2017-09-30 15:45:51

Replying to [comment:8 egourgoulhon]:
> Replying to [comment:6 tscrim]:
> > Do you need to use Sage's `Set`? 
> 
> Yes, because I need the method `subsets`, which does not exist for Python `set`.

I am pretty sure you can use:

```
sage: import itertools
sage: list(itertools.combinations([1,2,3], 2))
[(1, 2), (1, 3), (2, 3)]
```

to iterate over all subsets of a fixed size. (There is also `from sage.misc.misc import powerset` for an iterator over all subsets.) I don't even think you need to convert the subsets, which are tuples, to Python `set`s.


---

Comment by git created at 2017-10-01 12:26:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2017-10-01 12:32:00

Replying to [comment:11 tscrim]:
> 
> I am pretty sure you can use:
> {{{
> sage: import itertools
> sage: list(itertools.combinations([1,2,3], 2))
> [(1, 2), (1, 3), (2, 3)]
> }}}
> to iterate over all subsets of a fixed size. (There is also `from sage.misc.misc import powerset` for an iterator over all subsets.) I don't even think you need to convert the subsets, which are tuples, to Python `set`s. 

Thanks for the tip. The above commit implements this. I've quickly checked that this is supported by Python 3 as well. Do you confirm?


---

Comment by tscrim created at 2017-10-01 15:06:48

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-10-01 15:06:48

Yep, all looks good. Thanks.


---

Comment by egourgoulhon created at 2017-10-01 15:28:35

Thank you very much for the review!


---

Comment by vbraun created at 2017-10-05 06:55:50

Resolution: fixed
