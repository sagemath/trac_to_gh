# Issue 23192: Multivector fields and the Schouten-Nijenhuis bracket

archive/issues_023192.json:
```json
{
    "body": "CC:  bpym @tscrim\n\nKeywords: multivector, Schouten-Nijenhuis bracket\n\nThis ticket implements **multivector fields** (i.e. alternating contravariant tensor fields) on differentiable manifolds, via the parent classes \n\n- `MultivectorModule`: set *A<sup>p</sup>(M)* of multivector fields of a degree *p* on a manifold *M*, considered as a module over the commutative algebra *C<sup>k</sup>(M)* of differentiable scalar fields\n- `MultivectorFreeModule`: set *A<sup>p</sup>(M)* of multivector fields of a degree *p* on a *parallelizable* manifold *M*, considered as a *free* module of rank binomial(*n,p*) over *C<sup>k</sup>(M)* (where *n*=dim*M*)\n\nand the element classes\n\n- `MultivectorField`: multivector field on a differentiable manifold\n- `MultivectorFieldParal`: multivector field on a parallelizable differentiable manifold\n\nThe classes `MultivectorFreeModule` and `MultivectorFieldParal` inherit from respectively `ExtPowerFreeModule` and `AlternatingContrTensor`, which have been introduced in #23207.\n\nThe classes `VectorField` and `VectorFieldParal` inherit now from the new classes `MultivectorField` and `MultivectorFieldParal`, since a vector field is a multivector field of degree 1. \n\nThe ticket implements the **exterior product** *A<sup>p</sup>(M)* x *A<sup>q</sup>(M)* ---> *A<sup>p+q</sup>(M)* (method `wedge`), as well as the **interior products**\n- *A<sup>p</sup>(M)* x Omega*<sup>q</sup>(M)* ---> Omega*<sup>q-p</sup>(M)*\n- Omega*<sup>p</sup>(M)* x *A<sup>q</sup>(M)* ---> *A<sup>q-p</sup>(M)*\nfor *p<=q*, where Omega*<sup>p</sup>(M)* is the *C<sup>k</sup>(M)*-module of differential forms of degree *p* on *M* (method `interior_product`).\nThe ticket also implements the **Schouten-Nijenhuis bracket** *A<sup>p</sup>(M)*x*A<sup>q</sup>(M)* ---> *A<sup>p+q-1</sup>(M)* (method `bracket`), extending the Lie bracket of vector fields.\n\nThis is a follow up of #23207 within the [SageManifolds project](http://sagemanifolds.obspm.fr/) (see the metaticket #18528 for an overview).\n\nIssue created by migration from https://trac.sagemath.org/ticket/23429\n\n",
    "created_at": "2017-07-13T22:09:28Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Multivector fields and the Schouten-Nijenhuis bracket",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23192",
    "user": "https://github.com/egourgoulhon"
}
```
CC:  bpym @tscrim

Keywords: multivector, Schouten-Nijenhuis bracket

This ticket implements **multivector fields** (i.e. alternating contravariant tensor fields) on differentiable manifolds, via the parent classes 

- `MultivectorModule`: set *A<sup>p</sup>(M)* of multivector fields of a degree *p* on a manifold *M*, considered as a module over the commutative algebra *C<sup>k</sup>(M)* of differentiable scalar fields
- `MultivectorFreeModule`: set *A<sup>p</sup>(M)* of multivector fields of a degree *p* on a *parallelizable* manifold *M*, considered as a *free* module of rank binomial(*n,p*) over *C<sup>k</sup>(M)* (where *n*=dim*M*)

and the element classes

- `MultivectorField`: multivector field on a differentiable manifold
- `MultivectorFieldParal`: multivector field on a parallelizable differentiable manifold

The classes `MultivectorFreeModule` and `MultivectorFieldParal` inherit from respectively `ExtPowerFreeModule` and `AlternatingContrTensor`, which have been introduced in #23207.

The classes `VectorField` and `VectorFieldParal` inherit now from the new classes `MultivectorField` and `MultivectorFieldParal`, since a vector field is a multivector field of degree 1. 

The ticket implements the **exterior product** *A<sup>p</sup>(M)* x *A<sup>q</sup>(M)* ---> *A<sup>p+q</sup>(M)* (method `wedge`), as well as the **interior products**
- *A<sup>p</sup>(M)* x Omega*<sup>q</sup>(M)* ---> Omega*<sup>q-p</sup>(M)*
- Omega*<sup>p</sup>(M)* x *A<sup>q</sup>(M)* ---> *A<sup>q-p</sup>(M)*
for *p<=q*, where Omega*<sup>p</sup>(M)* is the *C<sup>k</sup>(M)*-module of differential forms of degree *p* on *M* (method `interior_product`).
The ticket also implements the **Schouten-Nijenhuis bracket** *A<sup>p</sup>(M)*x*A<sup>q</sup>(M)* ---> *A<sup>p+q-1</sup>(M)* (method `bracket`), extending the Lie bracket of vector fields.

This is a follow up of #23207 within the [SageManifolds project](http://sagemanifolds.obspm.fr/) (see the metaticket #18528 for an overview).

Issue created by migration from https://trac.sagemath.org/ticket/23429





---

archive/issue_comments_324084.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2017-07-13T22:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324084",
    "user": "https://github.com/egourgoulhon"
}
```

Last 10 new commits:



---

archive/issue_comments_324085.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-13T22:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324085",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_324086.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-05T07:41:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324086",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324087.json:
```json
{
    "body": "Following what has been done in #23623 for tensor field modules, the above commit changes the potentially expensive test\n\n```\nif comp == 0:\n    return self.zero() \n```\n\nto \n\n```\nif isinstance(comp, (int, Integer)) and comp == 0:\n    return self.zero()\n```\n\nin `_element_constructor_` of classes `MultivectorModule` and `MultivectorFreeModule`.",
    "created_at": "2017-09-05T07:47:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324087",
    "user": "https://github.com/egourgoulhon"
}
```

Following what has been done in #23623 for tensor field modules, the above commit changes the potentially expensive test

```
if comp == 0:
    return self.zero() 
```

to 

```
if isinstance(comp, (int, Integer)) and comp == 0:
    return self.zero()
```

in `_element_constructor_` of classes `MultivectorModule` and `MultivectorFreeModule`.



---

archive/issue_comments_324088.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-20T09:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324088",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324089.json:
```json
{
    "body": "The above commit (cf. comment:4) solves a merge conflict with Sage 8.1.beta5 in the master file for references (`src/doc/en/reference/references/index.rst`).",
    "created_at": "2017-09-20T09:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324089",
    "user": "https://github.com/egourgoulhon"
}
```

The above commit (cf. comment:4) solves a merge conflict with Sage 8.1.beta5 in the master file for references (`src/doc/en/reference/references/index.rst`).



---

archive/issue_comments_324090.json:
```json
{
    "body": "A few minor comments:\n\nTypo (appears twice):\n\n```\n- ``other`` -- a multivector field, `b` say\n```\n\n\nNo comma here:\n\n```\n- ``other`` -- a multivector field, of degree `p`\n```\n\n\nCould you remove a few of these extra blanklines:\n\n```diff\n+    The Lie derivative of a 2-vector field is a 2-vector field::\n+\n+        sage: ab.lie_der(a)\n+        2-vector field on the 3-dimensional differentiable manifold R3\n+\n+\n+\n+    \"\"\"\n+    def __init__(self, vector_field_module, degree, name=None,\n+                 latex_name=None):\n```\n\n\nIt is a little easier to read\n\n```diff\n-       resu_name = None ; resu_latex_name = None\n+       resu_name = None\n+       resu_latex_name = None\n```\n\n\nDo you need to use Sage's `Set`? It is quite a bit slower than the Python `set`.\n\nFor things like this:\n\n```python\n                resu._restrictions[dom] = \\\n                                     dom.tensor_field_module((p,0))(rst)\n```\n\nit is better on 1 line and go over the 80 char/line for maintenance and readability. This is more a judgment call about the lesser of two evils.",
    "created_at": "2017-09-29T20:15:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324090",
    "user": "https://github.com/tscrim"
}
```

A few minor comments:

Typo (appears twice):

```
- ``other`` -- a multivector field, `b` say
```


No comma here:

```
- ``other`` -- a multivector field, of degree `p`
```


Could you remove a few of these extra blanklines:

```diff
+    The Lie derivative of a 2-vector field is a 2-vector field::
+
+        sage: ab.lie_der(a)
+        2-vector field on the 3-dimensional differentiable manifold R3
+
+
+
+    """
+    def __init__(self, vector_field_module, degree, name=None,
+                 latex_name=None):
```


It is a little easier to read

```diff
-       resu_name = None ; resu_latex_name = None
+       resu_name = None
+       resu_latex_name = None
```


Do you need to use Sage's `Set`? It is quite a bit slower than the Python `set`.

For things like this:

```python
                resu._restrictions[dom] = \
                                     dom.tensor_field_module((p,0))(rst)
```

it is better on 1 line and go over the 80 char/line for maintenance and readability. This is more a judgment call about the lesser of two evils.



---

archive/issue_comments_324091.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-30T08:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324091",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324092.json:
```json
{
    "body": "Replying to [comment:6 tscrim]:\n\nThanks for your comments; the above commit takes them into account.\n\n> Do you need to use Sage's `Set`? \n\nYes, because I need the method `subsets`, which does not exist for Python `set`.",
    "created_at": "2017-09-30T09:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324092",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:6 tscrim]:

Thanks for your comments; the above commit takes them into account.

> Do you need to use Sage's `Set`? 

Yes, because I need the method `subsets`, which does not exist for Python `set`.



---

archive/issue_comments_324093.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-30T15:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324093",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324094.json:
```json
{
    "body": "I've just noticed a typo in the `__call__` method of `TensorField`, as well as a redundant import in `vectorfield_module.py`. The above commit corrects this.",
    "created_at": "2017-09-30T15:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324094",
    "user": "https://github.com/egourgoulhon"
}
```

I've just noticed a typo in the `__call__` method of `TensorField`, as well as a redundant import in `vectorfield_module.py`. The above commit corrects this.



---

archive/issue_comments_324095.json:
```json
{
    "body": "Replying to [comment:8 egourgoulhon]:\n> Replying to [comment:6 tscrim]:\n> > Do you need to use Sage's `Set`? \n> \n> Yes, because I need the method `subsets`, which does not exist for Python `set`.\n\nI am pretty sure you can use:\n\n```\nsage: import itertools\nsage: list(itertools.combinations([1,2,3], 2))\n[(1, 2), (1, 3), (2, 3)]\n```\n\nto iterate over all subsets of a fixed size. (There is also `from sage.misc.misc import powerset` for an iterator over all subsets.) I don't even think you need to convert the subsets, which are tuples, to Python `set`s.",
    "created_at": "2017-09-30T15:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324095",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:8 egourgoulhon]:
> Replying to [comment:6 tscrim]:
> > Do you need to use Sage's `Set`? 
> 
> Yes, because I need the method `subsets`, which does not exist for Python `set`.

I am pretty sure you can use:

```
sage: import itertools
sage: list(itertools.combinations([1,2,3], 2))
[(1, 2), (1, 3), (2, 3)]
```

to iterate over all subsets of a fixed size. (There is also `from sage.misc.misc import powerset` for an iterator over all subsets.) I don't even think you need to convert the subsets, which are tuples, to Python `set`s.



---

archive/issue_comments_324096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-01T12:26:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_324097.json:
```json
{
    "body": "Replying to [comment:11 tscrim]:\n> \n> I am pretty sure you can use:\n> {{{\n> sage: import itertools\n> sage: list(itertools.combinations([1,2,3], 2))\n> [(1, 2), (1, 3), (2, 3)]\n> }}}\n> to iterate over all subsets of a fixed size. (There is also `from sage.misc.misc import powerset` for an iterator over all subsets.) I don't even think you need to convert the subsets, which are tuples, to Python `set`s. \n\nThanks for the tip. The above commit implements this. I've quickly checked that this is supported by Python 3 as well. Do you confirm?",
    "created_at": "2017-10-01T12:32:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324097",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:11 tscrim]:
> 
> I am pretty sure you can use:
> {{{
> sage: import itertools
> sage: list(itertools.combinations([1,2,3], 2))
> [(1, 2), (1, 3), (2, 3)]
> }}}
> to iterate over all subsets of a fixed size. (There is also `from sage.misc.misc import powerset` for an iterator over all subsets.) I don't even think you need to convert the subsets, which are tuples, to Python `set`s. 

Thanks for the tip. The above commit implements this. I've quickly checked that this is supported by Python 3 as well. Do you confirm?



---

archive/issue_comments_324098.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-01T15:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324098",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_324099.json:
```json
{
    "body": "Yep, all looks good. Thanks.",
    "created_at": "2017-10-01T15:06:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324099",
    "user": "https://github.com/tscrim"
}
```

Yep, all looks good. Thanks.



---

archive/issue_comments_324100.json:
```json
{
    "body": "Thank you very much for the review!",
    "created_at": "2017-10-01T15:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324100",
    "user": "https://github.com/egourgoulhon"
}
```

Thank you very much for the review!



---

archive/issue_comments_324101.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-05T06:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23192#issuecomment-324101",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_021771.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2017-10-05T06:55:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23192",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23192#event-21771"
}
```
