# Issue 21464: Compiling sagelib with clang: failure in sage/symbolic/expression.pyx - pynac problem

archive/issues_021464.json:
```json
{
    "body": "CC:  @rwst @mkoeppe\n\nI am hitting the following error in compiling sagelib with clang\n\n```\n[sagelib-7.4.rc1] [1/9] clang -fno-strict-aliasing -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p3/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/cysignals -I/Users/fbissey/build/sage/local/include -I/Users/fbissey/build/sage/local/include/python2.7 -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/numpy/core/include -I/Users/fbissey/build/sage/src -I/Users/fbissey/build/sage/src/sage/ext -I/Users/fbissey/build/sage/src/build/cythonized -I/Users/fbissey/build/sage/src/build/cythonized/sage/ext -I/Users/fbissey/build/sage/local/include/python2.7 -c /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp -o build/temp.macosx-10.9-x86_64-2.7/Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.o -std=c++11 -fno-strict-aliasing\n[sagelib-7.4.rc1] In file included from /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:\n[sagelib-7.4.rc1] In file included from /Users/fbissey/build/sage/src/sage/symbolic/ginac_wrap.h:11:\n[sagelib-7.4.rc1] In file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:38:\n[sagelib-7.4.rc1] /Users/fbissey/build/sage/local/include/pynac/integral.h:44:5: warning: 'GiNaC::integral::evalf' hides overloaded virtual function [-Woverloaded-virtual]\n[sagelib-7.4.rc1]         ex evalf(int level=0) const;\n[sagelib-7.4.rc1]            ^\n[sagelib-7.4.rc1] /Users/fbissey/build/sage/local/include/pynac/basic.h:176:13: note: hidden overloaded virtual function 'GiNaC::basic::evalf' declared here: different number of parameters (2 vs 1)\n[sagelib-7.4.rc1]         virtual ex evalf(int level = 0, PyObject* parent=nullptr) const;\n[sagelib-7.4.rc1]                    ^\n[sagelib-7.4.rc1] /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:27231:30: error: no member named 'operator!=' in 'std::__1::__list_const_iterator<GiNaC::ex, void *>'\n[sagelib-7.4.rc1]     __pyx_t_2 = (__pyx_v_itr.operator!=(__pyx_v_lstend) != 0);\n[sagelib-7.4.rc1]                  ~~~~~~~~~~~ ^\n[sagelib-7.4.rc1] /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:27446:30: error: no member named 'operator!=' in 'std::__1::__list_const_iterator<GiNaC::ex, void *>'\n[sagelib-7.4.rc1]     __pyx_t_3 = (__pyx_v_itr.operator!=(__pyx_v_found.end()) != 0);\n[sagelib-7.4.rc1]                  ~~~~~~~~~~~ ^\n[sagelib-7.4.rc1] /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:28649:30: error: no member named 'operator!=' in 'std::__1::__tree_const_iterator<GiNaC::ex, std::__1::__tree_node<GiNaC::ex, void *> *, long>'\n[sagelib-7.4.rc1]     __pyx_t_3 = (__pyx_v_itr.operator!=(__pyx_v_sym_set.end()) != 0);\n[sagelib-7.4.rc1]                  ~~~~~~~~~~~ ^\n[sagelib-7.4.rc1] 1 warning and 3 errors generated.\n```\n\nThis looks like a `pynac` or `pynac` related problem.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21701\n\n",
    "created_at": "2016-10-14T01:47:35Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "Compiling sagelib with clang: failure in sage/symbolic/expression.pyx - pynac problem",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21464",
    "user": "https://github.com/kiwifb"
}
```
CC:  @rwst @mkoeppe

I am hitting the following error in compiling sagelib with clang

```
[sagelib-7.4.rc1] [1/9] clang -fno-strict-aliasing -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p3/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/cysignals -I/Users/fbissey/build/sage/local/include -I/Users/fbissey/build/sage/local/include/python2.7 -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/numpy/core/include -I/Users/fbissey/build/sage/src -I/Users/fbissey/build/sage/src/sage/ext -I/Users/fbissey/build/sage/src/build/cythonized -I/Users/fbissey/build/sage/src/build/cythonized/sage/ext -I/Users/fbissey/build/sage/local/include/python2.7 -c /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp -o build/temp.macosx-10.9-x86_64-2.7/Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.o -std=c++11 -fno-strict-aliasing
[sagelib-7.4.rc1] In file included from /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:
[sagelib-7.4.rc1] In file included from /Users/fbissey/build/sage/src/sage/symbolic/ginac_wrap.h:11:
[sagelib-7.4.rc1] In file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:38:
[sagelib-7.4.rc1] /Users/fbissey/build/sage/local/include/pynac/integral.h:44:5: warning: 'GiNaC::integral::evalf' hides overloaded virtual function [-Woverloaded-virtual]
[sagelib-7.4.rc1]         ex evalf(int level=0) const;
[sagelib-7.4.rc1]            ^
[sagelib-7.4.rc1] /Users/fbissey/build/sage/local/include/pynac/basic.h:176:13: note: hidden overloaded virtual function 'GiNaC::basic::evalf' declared here: different number of parameters (2 vs 1)
[sagelib-7.4.rc1]         virtual ex evalf(int level = 0, PyObject* parent=nullptr) const;
[sagelib-7.4.rc1]                    ^
[sagelib-7.4.rc1] /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:27231:30: error: no member named 'operator!=' in 'std::__1::__list_const_iterator<GiNaC::ex, void *>'
[sagelib-7.4.rc1]     __pyx_t_2 = (__pyx_v_itr.operator!=(__pyx_v_lstend) != 0);
[sagelib-7.4.rc1]                  ~~~~~~~~~~~ ^
[sagelib-7.4.rc1] /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:27446:30: error: no member named 'operator!=' in 'std::__1::__list_const_iterator<GiNaC::ex, void *>'
[sagelib-7.4.rc1]     __pyx_t_3 = (__pyx_v_itr.operator!=(__pyx_v_found.end()) != 0);
[sagelib-7.4.rc1]                  ~~~~~~~~~~~ ^
[sagelib-7.4.rc1] /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:28649:30: error: no member named 'operator!=' in 'std::__1::__tree_const_iterator<GiNaC::ex, std::__1::__tree_node<GiNaC::ex, void *> *, long>'
[sagelib-7.4.rc1]     __pyx_t_3 = (__pyx_v_itr.operator!=(__pyx_v_sym_set.end()) != 0);
[sagelib-7.4.rc1]                  ~~~~~~~~~~~ ^
[sagelib-7.4.rc1] 1 warning and 3 errors generated.
```

This looks like a `pynac` or `pynac` related problem.

Issue created by migration from https://trac.sagemath.org/ticket/21701





---

archive/issue_comments_297586.json:
```json
{
    "body": "Do you have a clue Ralph? I have a feeling this will require some work `pynac` side rather than `sage` side, but I don't mix very well with `c++`.",
    "created_at": "2016-10-14T01:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297586",
    "user": "https://github.com/kiwifb"
}
```

Do you have a clue Ralph? I have a feeling this will require some work `pynac` side rather than `sage` side, but I don't mix very well with `c++`.



---

archive/issue_comments_297587.json:
```json
{
    "body": "Can you try with `clang -stdlib=libstdc++ ...`?",
    "created_at": "2016-10-14T06:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297587",
    "user": "https://github.com/rwst"
}
```

Can you try with `clang -stdlib=libstdc++ ...`?



---

archive/issue_comments_297588.json:
```json
{
    "body": "I just noticed that clang is used instead of clang++, that may have an impact. I will try to rectify that and if it doesn't work try what you said.",
    "created_at": "2016-10-14T07:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297588",
    "user": "https://github.com/kiwifb"
}
```

I just noticed that clang is used instead of clang++, that may have an impact. I will try to rectify that and if it doesn't work try what you said.



---

archive/issue_comments_297589.json:
```json
{
    "body": "No luck. Difficult to force `clang++` I had to go manual\n\n```\nMirage:src fbissey$ clang++ -fno-strict-aliasing -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p3/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/cysignals -I/Users/fbissey/build/sage/local/include -I/Users/fbissey/build/sage/local/include/python2.7 -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/numpy/core/include -I/Users/fbissey/build/sage/src -I/Users/fbissey/build/sage/src/sage/ext -I/Users/fbissey/build/sage/src/build/cythonized -I/Users/fbissey/build/sage/src/build/cythonized/sage/ext -I/Users/fbissey/build/sage/local/include/python2.7 -c /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp -o build/temp.macosx-10.9-x86_64-2.7/Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.o -std=c++11 -fno-strict-aliasing -stdlib=libstdc++\nIn file included from /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:\nIn file included from /Users/fbissey/build/sage/src/sage/symbolic/ginac_wrap.h:11:\nIn file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:28:\nIn file included from /Users/fbissey/build/sage/local/include/pynac/basic.h:40:\nIn file included from /Users/fbissey/build/sage/local/include/pynac/registrar.h:30:\n/Users/fbissey/build/sage/local/include/pynac/class_info.h:43:31: error: no member named 'move' in namespace 'std'; did you mean 'modf'?\n        class_info(OPT  o) : options(std::move(o)), next(first), parent(nullptr)\n                                     ^~~~~~~~~\n                                     modf\n/usr/include/math.h:407:15: note: 'modf' declared here\nextern double modf(double, double *);\n              ^\nIn file included from /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:\nIn file included from /Users/fbissey/build/sage/src/sage/symbolic/ginac_wrap.h:11:\nIn file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:28:\nIn file included from /Users/fbissey/build/sage/local/include/pynac/basic.h:40:\nIn file included from /Users/fbissey/build/sage/local/include/pynac/registrar.h:31:\n/Users/fbissey/build/sage/local/include/pynac/print.h:244:21: error: no type named 'unique_ptr' in namespace 'std'\n        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}\n                      ~~~~~^\n/Users/fbissey/build/sage/local/include/pynac/print.h:244:31: error: expected ')'\n        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}\n                                     ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:244:15: note: to match this '('\n        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}\n                     ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:269:7: error: no type named 'unique_ptr' in namespace 'std'\n        std::unique_ptr<print_functor_impl> impl;\n        ~~~~~^\n/Users/fbissey/build/sage/local/include/pynac/print.h:269:17: error: expected member name or ';' after declaration specifiers\n        std::unique_ptr<print_functor_impl> impl;\n        ~~~~~~~~~~~~~~~^\n/Users/fbissey/build/sage/local/include/pynac/print.h:242:20: error: member initializer 'impl' does not name a non-static data member or base class\n        print_functor() : impl(nullptr) {}\n                          ^~~~~~~~~~~~~\n/Users/fbissey/build/sage/local/include/pynac/print.h:243:58: error: no member named 'impl' in 'GiNaC::print_functor'\n        print_functor(const print_functor & other) : impl(other.impl.get() ? other.impl->duplicate() : nullptr) {}\n                                                          ~~~~~ ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:243:77: error: no member named 'impl' in 'GiNaC::print_functor'\n        print_functor(const print_functor & other) : impl(other.impl.get() ? other.impl->duplicate() : nullptr) {}\n                                                                             ~~~~~ ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:244:71: error: no member named 'move' in namespace 'std'\n        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}\n                                                                        ~~~~~^\n/Users/fbissey/build/sage/local/include/pynac/print.h:244:76: error: use of undeclared identifier 'impl_'\n        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}\n                                                                                  ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:247:58: error: member initializer 'impl' does not name a non-static data member or base class\n        print_functor(void f(const T &, const C &, unsigned)) : impl(new print_ptrfun_handler<T, C>(f)) {}\n                                                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n/Users/fbissey/build/sage/local/include/pynac/print.h:250:59: error: member initializer 'impl' does not name a non-static data member or base class\n        print_functor(void (T::*f)(const C &, unsigned) const) : impl(new print_memfun_handler<T, C>(f)) {}\n                                                                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n/Users/fbissey/build/sage/local/include/pynac/print.h:255:34: error: no member named 'impl' in 'GiNaC::print_functor'\n                        print_functor_impl *p = other.impl.get();\n                                                ~~~~~ ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:256:4: error: use of undeclared identifier 'impl'\n                        impl.reset(p ? other.impl->duplicate() : nullptr);\n                        ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:256:25: error: no member named 'impl' in 'GiNaC::print_functor'\n                        impl.reset(p ? other.impl->duplicate() : nullptr);\n                                       ~~~~~ ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:263:5: error: use of undeclared identifier 'impl'\n                (*impl)(obj, c, level);\n                  ^\n/Users/fbissey/build/sage/local/include/pynac/print.h:266:33: error: use of undeclared identifier 'impl'\n        bool is_valid() const { return impl.get(); }\n                                       ^\nIn file included from /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:\nIn file included from /Users/fbissey/build/sage/src/sage/symbolic/ginac_wrap.h:11:\nIn file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:28:\n/Users/fbissey/build/sage/local/include/pynac/basic.h:364:60: error: no member named 'forward' in namespace 'std'\n        return const_cast<B &>(static_cast<const B &>((new B(std::forward<Args>(args)...))->setflag(status_flags::dynallocated)));\n                                                             ~~~~~^\n/Users/fbissey/build/sage/local/include/pynac/basic.h:364:68: error: 'Args' does not refer to a value\n        return const_cast<B &>(static_cast<const B &>((new B(std::forward<Args>(args)...))->setflag(status_flags::dynallocated)));\n                                                                          ^\n/Users/fbissey/build/sage/local/include/pynac/basic.h:361:31: note: declared here\ntemplate<class B, typename... Args>\n                              ^\nfatal error: too many errors emitted, stopping now [-ferror-limit=]\n20 errors generated.\n```\n",
    "created_at": "2016-10-14T07:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297589",
    "user": "https://github.com/kiwifb"
}
```

No luck. Difficult to force `clang++` I had to go manual

```
Mirage:src fbissey$ clang++ -fno-strict-aliasing -I/Users/fbissey/build/sage/local/var/tmp/sage/build/python2-2.7.10.p3/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/cysignals -I/Users/fbissey/build/sage/local/include -I/Users/fbissey/build/sage/local/include/python2.7 -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/numpy/core/include -I/Users/fbissey/build/sage/src -I/Users/fbissey/build/sage/src/sage/ext -I/Users/fbissey/build/sage/src/build/cythonized -I/Users/fbissey/build/sage/src/build/cythonized/sage/ext -I/Users/fbissey/build/sage/local/include/python2.7 -c /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp -o build/temp.macosx-10.9-x86_64-2.7/Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.o -std=c++11 -fno-strict-aliasing -stdlib=libstdc++
In file included from /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:
In file included from /Users/fbissey/build/sage/src/sage/symbolic/ginac_wrap.h:11:
In file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:28:
In file included from /Users/fbissey/build/sage/local/include/pynac/basic.h:40:
In file included from /Users/fbissey/build/sage/local/include/pynac/registrar.h:30:
/Users/fbissey/build/sage/local/include/pynac/class_info.h:43:31: error: no member named 'move' in namespace 'std'; did you mean 'modf'?
        class_info(OPT  o) : options(std::move(o)), next(first), parent(nullptr)
                                     ^~~~~~~~~
                                     modf
/usr/include/math.h:407:15: note: 'modf' declared here
extern double modf(double, double *);
              ^
In file included from /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:
In file included from /Users/fbissey/build/sage/src/sage/symbolic/ginac_wrap.h:11:
In file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:28:
In file included from /Users/fbissey/build/sage/local/include/pynac/basic.h:40:
In file included from /Users/fbissey/build/sage/local/include/pynac/registrar.h:31:
/Users/fbissey/build/sage/local/include/pynac/print.h:244:21: error: no type named 'unique_ptr' in namespace 'std'
        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}
                      ~~~~~^
/Users/fbissey/build/sage/local/include/pynac/print.h:244:31: error: expected ')'
        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}
                                     ^
/Users/fbissey/build/sage/local/include/pynac/print.h:244:15: note: to match this '('
        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}
                     ^
/Users/fbissey/build/sage/local/include/pynac/print.h:269:7: error: no type named 'unique_ptr' in namespace 'std'
        std::unique_ptr<print_functor_impl> impl;
        ~~~~~^
/Users/fbissey/build/sage/local/include/pynac/print.h:269:17: error: expected member name or ';' after declaration specifiers
        std::unique_ptr<print_functor_impl> impl;
        ~~~~~~~~~~~~~~~^
/Users/fbissey/build/sage/local/include/pynac/print.h:242:20: error: member initializer 'impl' does not name a non-static data member or base class
        print_functor() : impl(nullptr) {}
                          ^~~~~~~~~~~~~
/Users/fbissey/build/sage/local/include/pynac/print.h:243:58: error: no member named 'impl' in 'GiNaC::print_functor'
        print_functor(const print_functor & other) : impl(other.impl.get() ? other.impl->duplicate() : nullptr) {}
                                                          ~~~~~ ^
/Users/fbissey/build/sage/local/include/pynac/print.h:243:77: error: no member named 'impl' in 'GiNaC::print_functor'
        print_functor(const print_functor & other) : impl(other.impl.get() ? other.impl->duplicate() : nullptr) {}
                                                                             ~~~~~ ^
/Users/fbissey/build/sage/local/include/pynac/print.h:244:71: error: no member named 'move' in namespace 'std'
        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}
                                                                        ~~~~~^
/Users/fbissey/build/sage/local/include/pynac/print.h:244:76: error: use of undeclared identifier 'impl_'
        print_functor(std::unique_ptr<print_functor_impl> impl_) : impl(std::move(impl_)) {}
                                                                                  ^
/Users/fbissey/build/sage/local/include/pynac/print.h:247:58: error: member initializer 'impl' does not name a non-static data member or base class
        print_functor(void f(const T &, const C &, unsigned)) : impl(new print_ptrfun_handler<T, C>(f)) {}
                                                                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
/Users/fbissey/build/sage/local/include/pynac/print.h:250:59: error: member initializer 'impl' does not name a non-static data member or base class
        print_functor(void (T::*f)(const C &, unsigned) const) : impl(new print_memfun_handler<T, C>(f)) {}
                                                                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
/Users/fbissey/build/sage/local/include/pynac/print.h:255:34: error: no member named 'impl' in 'GiNaC::print_functor'
                        print_functor_impl *p = other.impl.get();
                                                ~~~~~ ^
/Users/fbissey/build/sage/local/include/pynac/print.h:256:4: error: use of undeclared identifier 'impl'
                        impl.reset(p ? other.impl->duplicate() : nullptr);
                        ^
/Users/fbissey/build/sage/local/include/pynac/print.h:256:25: error: no member named 'impl' in 'GiNaC::print_functor'
                        impl.reset(p ? other.impl->duplicate() : nullptr);
                                       ~~~~~ ^
/Users/fbissey/build/sage/local/include/pynac/print.h:263:5: error: use of undeclared identifier 'impl'
                (*impl)(obj, c, level);
                  ^
/Users/fbissey/build/sage/local/include/pynac/print.h:266:33: error: use of undeclared identifier 'impl'
        bool is_valid() const { return impl.get(); }
                                       ^
In file included from /Users/fbissey/build/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:
In file included from /Users/fbissey/build/sage/src/sage/symbolic/ginac_wrap.h:11:
In file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:28:
/Users/fbissey/build/sage/local/include/pynac/basic.h:364:60: error: no member named 'forward' in namespace 'std'
        return const_cast<B &>(static_cast<const B &>((new B(std::forward<Args>(args)...))->setflag(status_flags::dynallocated)));
                                                             ~~~~~^
/Users/fbissey/build/sage/local/include/pynac/basic.h:364:68: error: 'Args' does not refer to a value
        return const_cast<B &>(static_cast<const B &>((new B(std::forward<Args>(args)...))->setflag(status_flags::dynallocated)));
                                                                          ^
/Users/fbissey/build/sage/local/include/pynac/basic.h:361:31: note: declared here
template<class B, typename... Args>
                              ^
fatal error: too many errors emitted, stopping now [-ferror-limit=]
20 errors generated.
```




---

archive/issue_comments_297590.json:
```json
{
    "body": "The first error in the description comes from the following in the generated file\n\n```\n  /* \"sage/symbolic/expression.pyx\":4581\n *         cdef GExListIter itr = mlst.begin()\n *         cdef GExListIter lstend = mlst.end()\n *         while itr.is_not_equal(lstend):             # <<<<<<<<<<<<<<\n *             key = new_Expression_from_GEx(self._parent, itr.obj().lhs())\n *             val = new_Expression_from_GEx(self._parent, itr.obj().rhs())\n */\n  while (1) {\n    __pyx_t_2 = (__pyx_v_itr.operator!=(__pyx_v_lstend) != 0);\n    if (!__pyx_t_2) break;\n```\n\nThat's how the `while` from cython is transformed.",
    "created_at": "2016-10-14T07:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297590",
    "user": "https://github.com/kiwifb"
}
```

The first error in the description comes from the following in the generated file

```
  /* "sage/symbolic/expression.pyx":4581
 *         cdef GExListIter itr = mlst.begin()
 *         cdef GExListIter lstend = mlst.end()
 *         while itr.is_not_equal(lstend):             # <<<<<<<<<<<<<<
 *             key = new_Expression_from_GEx(self._parent, itr.obj().lhs())
 *             val = new_Expression_from_GEx(self._parent, itr.obj().rhs())
 */
  while (1) {
    __pyx_t_2 = (__pyx_v_itr.operator!=(__pyx_v_lstend) != 0);
    if (!__pyx_t_2) break;
```

That's how the `while` from cython is transformed.



---

archive/issue_comments_297591.json:
```json
{
    "body": "Is this Mac or Linux? Please state in the description.",
    "created_at": "2016-10-14T07:51:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297591",
    "user": "https://github.com/rwst"
}
```

Is this Mac or Linux? Please state in the description.



---

archive/issue_comments_297592.json:
```json
{
    "body": "As you can see from https://gcc.gnu.org/onlinedocs/gcc-4.6.3/libstdc++/api/a00344.html the libstdc++ has an `operator!=` member for `std::lst::const_iterator`. The definition is in stl_list.h. From the error it looks like the MacOS version does not have it, although Cython needs it. This is not a Pynac issue IMHO.",
    "created_at": "2016-10-14T08:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297592",
    "user": "https://github.com/rwst"
}
```

As you can see from https://gcc.gnu.org/onlinedocs/gcc-4.6.3/libstdc++/api/a00344.html the libstdc++ has an `operator!=` member for `std::lst::const_iterator`. The definition is in stl_list.h. From the error it looks like the MacOS version does not have it, although Cython needs it. This is not a Pynac issue IMHO.



---

archive/issue_comments_297593.json:
```json
{
    "body": "Replying to [comment:8 rws]:\n> As you can see from https://gcc.gnu.org/onlinedocs/gcc-4.6.3/libstdc++/api/a00344.html the libstdc++ has an `operator!=` member for `std::lst::const_iterator`. The definition is in stl_list.h. From the error it looks like the MacOS version does not have it, although Cython needs it. This is not a Pynac issue IMHO.\n\nThen somebody should test if this error happens only on OS X. So the question is: what happens with `clang` on Linux?",
    "created_at": "2016-10-14T08:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297593",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 rws]:
> As you can see from https://gcc.gnu.org/onlinedocs/gcc-4.6.3/libstdc++/api/a00344.html the libstdc++ has an `operator!=` member for `std::lst::const_iterator`. The definition is in stl_list.h. From the error it looks like the MacOS version does not have it, although Cython needs it. This is not a Pynac issue IMHO.

Then somebody should test if this error happens only on OS X. So the question is: what happens with `clang` on Linux?



---

archive/issue_comments_297594.json:
```json
{
    "body": "Actually, using a command adapted from yours (clang-3.8.0):\n\n```\nclang -fno-strict-aliasing -I/home/ralf/sage/local/include/python2.7 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/home/ralf/sage/local/lib/python2.7/site-packages/cysignals -I/home/ralf/sage/local/include -I/home/ralf/sage/src/build/sage/local/include/python2.7 -I/home/ralf/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/ralf/sage/src/build -I/home/ralf/sage/src/build/sage/ext -I/home/ralf/sage/src/build/cythonized -I/home/ralf/sage/src/build/cythonized/sage/ext -I/home/ralf/sage/src/build/sage/local/include/python2.7 -c /home/ralf/sage/src/build/cythonized/sage/symbolic/expression.cpp -o /home/ralf/sage/src/build/cythonized/sage/symbolic/expression.o -std=c++11 -fno-strict-aliasing\n\nIn file included from /home/ralf/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:\nIn file included from /home/ralf/sage/src/build/cythonized/sage/symbolic/ginac_wrap.h:11:\nIn file included from /home/ralf/sage/local/include/pynac/ginac.h:38:\n/home/ralf/sage/local/include/pynac/integral.h:44:5: warning: \n      'GiNaC::integral::evalf' hides overloaded virtual function\n      [-Woverloaded-virtual]\n        ex evalf(int level=0) const;\n           ^\n/home/ralf/sage/local/include/pynac/basic.h:177:13: note: hidden overloaded\n      virtual function 'GiNaC::basic::evalf' declared here: different number of\n      parameters (2 vs 1)\n        virtual ex evalf(int level = 0, PyObject* parent=nullptr) const;\n                   ^\n1 warning generated.\n```\n\nSo no errors. But I have a full libstdc++ on system. So it is possible that your Xcode version is missing a part of it.",
    "created_at": "2016-10-14T13:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297594",
    "user": "https://github.com/rwst"
}
```

Actually, using a command adapted from yours (clang-3.8.0):

```
clang -fno-strict-aliasing -I/home/ralf/sage/local/include/python2.7 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/home/ralf/sage/local/lib/python2.7/site-packages/cysignals -I/home/ralf/sage/local/include -I/home/ralf/sage/src/build/sage/local/include/python2.7 -I/home/ralf/sage/local/lib/python2.7/site-packages/numpy/core/include -I/home/ralf/sage/src/build -I/home/ralf/sage/src/build/sage/ext -I/home/ralf/sage/src/build/cythonized -I/home/ralf/sage/src/build/cythonized/sage/ext -I/home/ralf/sage/src/build/sage/local/include/python2.7 -c /home/ralf/sage/src/build/cythonized/sage/symbolic/expression.cpp -o /home/ralf/sage/src/build/cythonized/sage/symbolic/expression.o -std=c++11 -fno-strict-aliasing

In file included from /home/ralf/sage/src/build/cythonized/sage/symbolic/expression.cpp:336:
In file included from /home/ralf/sage/src/build/cythonized/sage/symbolic/ginac_wrap.h:11:
In file included from /home/ralf/sage/local/include/pynac/ginac.h:38:
/home/ralf/sage/local/include/pynac/integral.h:44:5: warning: 
      'GiNaC::integral::evalf' hides overloaded virtual function
      [-Woverloaded-virtual]
        ex evalf(int level=0) const;
           ^
/home/ralf/sage/local/include/pynac/basic.h:177:13: note: hidden overloaded
      virtual function 'GiNaC::basic::evalf' declared here: different number of
      parameters (2 vs 1)
        virtual ex evalf(int level = 0, PyObject* parent=nullptr) const;
                   ^
1 warning generated.
```

So no errors. But I have a full libstdc++ on system. So it is possible that your Xcode version is missing a part of it.



---

archive/issue_comments_297595.json:
```json
{
    "body": "Cannot dismiss that I guess. That would be a big blow on apple's part.",
    "created_at": "2016-10-14T19:44:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297595",
    "user": "https://github.com/kiwifb"
}
```

Cannot dismiss that I guess. That would be a big blow on apple's part.



---

archive/issue_comments_297596.json:
```json
{
    "body": "OK it is there: `/usr/include/c++/4.2.1/bits/stl_list.h` on OS X and it has the right operator. Of course anything with `bits` is an internal header and apparently the proper way to include it is with `<list>`. So I am guessing some inclusion is either using a non-standard header or rely on some indirect inclusion. Digging...",
    "created_at": "2016-10-15T02:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297596",
    "user": "https://github.com/kiwifb"
}
```

OK it is there: `/usr/include/c++/4.2.1/bits/stl_list.h` on OS X and it has the right operator. Of course anything with `bits` is an internal header and apparently the proper way to include it is with `<list>`. So I am guessing some inclusion is either using a non-standard header or rely on some indirect inclusion. Digging...



---

archive/issue_comments_297597.json:
```json
{
    "body": "Even manually adding `#include <list>` in the cpp file doesn't solve the problem. There must something subtle at work.",
    "created_at": "2016-10-15T04:31:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297597",
    "user": "https://github.com/kiwifb"
}
```

Even manually adding `#include <list>` in the cpp file doesn't solve the problem. There must something subtle at work.



---

archive/issue_comments_297598.json:
```json
{
    "body": "My understanding of some C++ matters is shaky at best. Does it make a difference that `operator!=` is a \"non-member\" function? http://en.cppreference.com/w/cpp/container/list",
    "created_at": "2016-10-15T04:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297598",
    "user": "https://github.com/kiwifb"
}
```

My understanding of some C++ matters is shaky at best. Does it make a difference that `operator!=` is a "non-member" function? http://en.cppreference.com/w/cpp/container/list



---

archive/issue_comments_297599.json:
```json
{
    "body": "Note that the missing `operator!=()` is not a member of `list` but of `list::const_iterator`, see line 266 in https://gcc.gnu.org/onlinedocs/gcc-4.6.3/libstdc++/api/a01055_source.html\n\nDoes the exact equivalent exist in your stl_list.h?",
    "created_at": "2016-10-15T05:16:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297599",
    "user": "https://github.com/rwst"
}
```

Note that the missing `operator!=()` is not a member of `list` but of `list::const_iterator`, see line 266 in https://gcc.gnu.org/onlinedocs/gcc-4.6.3/libstdc++/api/a01055_source.html

Does the exact equivalent exist in your stl_list.h?



---

archive/issue_comments_297600.json:
```json
{
    "body": "It appears to be in the header - which bears a lot of similarities with your link. We are talking about this section?\n\n```\n00198   template<typename _Tp>\n00199     struct _List_const_iterator\n```\n",
    "created_at": "2016-10-15T05:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297600",
    "user": "https://github.com/kiwifb"
}
```

It appears to be in the header - which bears a lot of similarities with your link. We are talking about this section?

```
00198   template<typename _Tp>
00199     struct _List_const_iterator
```




---

archive/issue_comments_297601.json:
```json
{
    "body": "Yes.",
    "created_at": "2016-10-15T05:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297601",
    "user": "https://github.com/rwst"
}
```

Yes.



---

archive/issue_comments_297602.json:
```json
{
    "body": "sage 7.5.beta2 (includes all the stuff we found out so far) and xcode 8.1 on sierra and still a similar kind of error. Different place but same error\n\n```\n clang++ -fno-strict-aliasing -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/fbissey/build/sage/local/include -I/Users/fbissey/build/sage/local/include/python2.7 -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/numpy/core/include -I/Users/fbissey/build/sage/src -I/Users/fbissey/build/sage/src/sage/ext -I/Users/fbissey/build/sage/src/build/cythonized -I/Users/fbissey/build/sage/src/build/cythonized/sage/ext -I/Users/fbissey/build/sage/local/include/python2.7 -c /Users/fbissey/build/sage/src/build/cythonized/sage/libs/pynac/pynac.cpp -o src/build/temp.macosx-10.9-x86_64-2.7/Users/fbissey/build/sage/src/build/cythonized/sage/libs/pynac/pynac.o -std=c++11 -fno-strict-aliasing\nIn file included from /Users/fbissey/build/sage/src/build/cythonized/sage/libs/pynac/pynac.cpp:486:\nIn file included from /Users/fbissey/build/sage/src/sage/libs/pynac/wrap.h:11:\nIn file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:38:\n/Users/fbissey/build/sage/local/include/pynac/integral.h:44:5: warning: 'GiNaC::integral::evalf' hides overloaded virtual function [-Woverloaded-virtual]\n        ex evalf(int level=0) const;\n           ^\n/Users/fbissey/build/sage/local/include/pynac/basic.h:177:13: note: hidden overloaded virtual function 'GiNaC::basic::evalf' declared here: different number of parameters\n      (2 vs 1)\n        virtual ex evalf(int level = 0, PyObject* parent=nullptr) const;\n                   ^\n/Users/fbissey/build/sage/src/build/cythonized/sage/libs/pynac/pynac.cpp:4479:30: error: no member named 'operator!=' in 'std::__1::__tree_const_iterator<unsigned int,\n      std::__1::__tree_node<unsigned int, void *> *, long>'\n    __pyx_t_2 = (__pyx_v_itr.operator!=(__pyx_v_s.end()) != 0);\n                 ~~~~~~~~~~~ ^\n1 warning and 1 error generated.\n```\n",
    "created_at": "2016-11-11T04:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297602",
    "user": "https://github.com/kiwifb"
}
```

sage 7.5.beta2 (includes all the stuff we found out so far) and xcode 8.1 on sierra and still a similar kind of error. Different place but same error

```
 clang++ -fno-strict-aliasing -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/fbissey/build/sage/local/include -I/Users/fbissey/build/sage/local/include/python2.7 -I/Users/fbissey/build/sage/local/lib/python2.7/site-packages/numpy/core/include -I/Users/fbissey/build/sage/src -I/Users/fbissey/build/sage/src/sage/ext -I/Users/fbissey/build/sage/src/build/cythonized -I/Users/fbissey/build/sage/src/build/cythonized/sage/ext -I/Users/fbissey/build/sage/local/include/python2.7 -c /Users/fbissey/build/sage/src/build/cythonized/sage/libs/pynac/pynac.cpp -o src/build/temp.macosx-10.9-x86_64-2.7/Users/fbissey/build/sage/src/build/cythonized/sage/libs/pynac/pynac.o -std=c++11 -fno-strict-aliasing
In file included from /Users/fbissey/build/sage/src/build/cythonized/sage/libs/pynac/pynac.cpp:486:
In file included from /Users/fbissey/build/sage/src/sage/libs/pynac/wrap.h:11:
In file included from /Users/fbissey/build/sage/local/include/pynac/ginac.h:38:
/Users/fbissey/build/sage/local/include/pynac/integral.h:44:5: warning: 'GiNaC::integral::evalf' hides overloaded virtual function [-Woverloaded-virtual]
        ex evalf(int level=0) const;
           ^
/Users/fbissey/build/sage/local/include/pynac/basic.h:177:13: note: hidden overloaded virtual function 'GiNaC::basic::evalf' declared here: different number of parameters
      (2 vs 1)
        virtual ex evalf(int level = 0, PyObject* parent=nullptr) const;
                   ^
/Users/fbissey/build/sage/src/build/cythonized/sage/libs/pynac/pynac.cpp:4479:30: error: no member named 'operator!=' in 'std::__1::__tree_const_iterator<unsigned int,
      std::__1::__tree_node<unsigned int, void *> *, long>'
    __pyx_t_2 = (__pyx_v_itr.operator!=(__pyx_v_s.end()) != 0);
                 ~~~~~~~~~~~ ^
1 warning and 1 error generated.
```




---

archive/issue_comments_297603.json:
```json
{
    "body": "It's different. Before it was list, now it's tree. BTW the warning is fixed in flint git master.",
    "created_at": "2016-11-11T06:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297603",
    "user": "https://github.com/rwst"
}
```

It's different. Before it was list, now it's tree. BTW the warning is fixed in flint git master.



---

archive/issue_comments_297604.json:
```json
{
    "body": "Ah no sorry, different warning, not flint.",
    "created_at": "2016-11-11T06:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297604",
    "user": "https://github.com/rwst"
}
```

Ah no sorry, different warning, not flint.



---

archive/issue_comments_297605.json:
```json
{
    "body": "The original one had three errors, 2 \"list\" and one \"tree\". In any case it is extremely vexing. I need to find a C++ expert that could have a clue.",
    "created_at": "2016-11-11T07:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297605",
    "user": "https://github.com/kiwifb"
}
```

The original one had three errors, 2 "list" and one "tree". In any case it is extremely vexing. I need to find a C++ expert that could have a clue.



---

archive/issue_comments_297606.json:
```json
{
    "body": "C++ guru needed...",
    "created_at": "2016-11-22T22:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297606",
    "user": "https://github.com/dimpase"
}
```

C++ guru needed...



---

archive/issue_comments_297607.json:
```json
{
    "body": "I don't claim being a tenured C++ guru, but\n\n```\npynac.pxd:        bint is_not_equal \"operator!=\" (GParamSetIter i)\n```\n\nlooks strange. IIRC iterators can be compared for non-equality using merely `!=`.\nIf in `sage/libs/pynac/pynac.pyx` (line 194) I replace\n\n```\nwhile itr.is_not_equal(s.end()):\n```\n\nwith \n\n```\nwhile itr != s.end():\n```\n\nthis still compiles (with gcc), and tests in symbolic/ pass, too.\n\nCan you try this with clang?",
    "created_at": "2016-11-23T11:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297607",
    "user": "https://github.com/dimpase"
}
```

I don't claim being a tenured C++ guru, but

```
pynac.pxd:        bint is_not_equal "operator!=" (GParamSetIter i)
```

looks strange. IIRC iterators can be compared for non-equality using merely `!=`.
If in `sage/libs/pynac/pynac.pyx` (line 194) I replace

```
while itr.is_not_equal(s.end()):
```

with 

```
while itr != s.end():
```

this still compiles (with gcc), and tests in symbolic/ pass, too.

Can you try this with clang?



---

archive/issue_comments_297608.json:
```json
{
    "body": "That appears to be effective, let's see how far I can go with it.",
    "created_at": "2016-11-23T23:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297608",
    "user": "https://github.com/kiwifb"
}
```

That appears to be effective, let's see how far I can go with it.



---

archive/issue_comments_297609.json:
```json
{
    "body": "Had a new C/C++ conflict but I was still on 7.5.beta2. Switched to beta3 and rebuilding now.",
    "created_at": "2016-11-24T00:34:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297609",
    "user": "https://github.com/kiwifb"
}
```

Had a new C/C++ conflict but I was still on 7.5.beta2. Switched to beta3 and rebuilding now.



---

archive/issue_comments_297610.json:
```json
{
    "body": "OK that changes definitely get me past the compiling of `sage/libs/pynac/pynac.so`, the new issue in beta3 means that I haven't reach the initial problem in `sage/symbolyc/expression.pyx`. Since there were several errors that particular fix may be insufficient. I should put a temporary branch here for other people interested in testing at some point.",
    "created_at": "2016-11-24T01:02:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297610",
    "user": "https://github.com/kiwifb"
}
```

OK that changes definitely get me past the compiling of `sage/libs/pynac/pynac.so`, the new issue in beta3 means that I haven't reach the initial problem in `sage/symbolyc/expression.pyx`. Since there were several errors that particular fix may be insufficient. I should put a temporary branch here for other people interested in testing at some point.



---

archive/issue_comments_297611.json:
```json
{
    "body": "After sorting the `m4ri` problems I am back at the original error in expression.pyx. I will see if I can apply Dima's suggestion again.",
    "created_at": "2016-11-24T01:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297611",
    "user": "https://github.com/kiwifb"
}
```

After sorting the `m4ri` problems I am back at the original error in expression.pyx. I will see if I can apply Dima's suggestion again.



---

archive/issue_comments_297612.json:
```json
{
    "body": "Had to apply Dima's suggestion 3 times. We have compile!",
    "created_at": "2016-11-24T01:50:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297612",
    "user": "https://github.com/kiwifb"
}
```

Had to apply Dima's suggestion 3 times. We have compile!



---

archive/issue_comments_297613.json:
```json
{
    "body": "Nice. Looks like another example where gcc is more generous than clang with template function creation.",
    "created_at": "2016-11-24T04:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297613",
    "user": "https://github.com/rwst"
}
```

Nice. Looks like another example where gcc is more generous than clang with template function creation.



---

archive/issue_comments_297614.json:
```json
{
    "body": "Replying to [comment:29 rws]:\n> Nice. Looks like another example where gcc is more generous than clang with template function creation. \n\nWell, I am not sure it is about templates - it seems to be about an operator `!=` being replaced by gcc with \"plain\" `!=`. Or perhaps I'm misreading the code there.",
    "created_at": "2016-11-24T07:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297614",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:29 rws]:
> Nice. Looks like another example where gcc is more generous than clang with template function creation. 

Well, I am not sure it is about templates - it seems to be about an operator `!=` being replaced by gcc with "plain" `!=`. Or perhaps I'm misreading the code there.



---

archive/issue_comments_297615.json:
```json
{
    "body": "Ideally, all those `cdef struct` in `pynac.pxd` should be replaced by `cdef cppclass`.",
    "created_at": "2016-11-24T08:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297615",
    "user": "https://github.com/jdemeyer"
}
```

Ideally, all those `cdef struct` in `pynac.pxd` should be replaced by `cdef cppclass`.



---

archive/issue_comments_297616.json:
```json
{
    "body": "Yes, I have numerous warning about `struct` that should `class`. \n\nI am doing a new compile from scratch, doctests of the first build has shown a few issues but it started as 7.5.beta2 switched to beta3 in flight so everything will be cross-checked with a new build.",
    "created_at": "2016-11-24T08:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297616",
    "user": "https://github.com/kiwifb"
}
```

Yes, I have numerous warning about `struct` that should `class`. 

I am doing a new compile from scratch, doctests of the first build has shown a few issues but it started as 7.5.beta2 switched to beta3 in flight so everything will be cross-checked with a new build.



---

archive/issue_comments_297617.json:
```json
{
    "body": "I have been grepping `is_not_equal` over the entire sage tree and apart from the one occurence in `pynac.pyx` and 3 in `symbolic/expression.pyx` I found 3 in `pynac.pxd`\n\n```\ngrep -rI is_not_equal src/sage/*\nsrc/sage/libs/pynac/pynac.pxd:        bint is_not_equal \"operator!=\" (GExListIter i)\nsrc/sage/libs/pynac/pynac.pxd:        bint is_not_equal \"operator!=\" (GParamSetIter i)\nsrc/sage/libs/pynac/pynac.pxd:        bint is_not_equal \"operator!=\" (GExSetIter i)\n```\n\nI am guessing they can go as well if I remove all the instances of `is_not_equal`. Second opinion? Ralf?",
    "created_at": "2016-11-24T20:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297617",
    "user": "https://github.com/kiwifb"
}
```

I have been grepping `is_not_equal` over the entire sage tree and apart from the one occurence in `pynac.pyx` and 3 in `symbolic/expression.pyx` I found 3 in `pynac.pxd`

```
grep -rI is_not_equal src/sage/*
src/sage/libs/pynac/pynac.pxd:        bint is_not_equal "operator!=" (GExListIter i)
src/sage/libs/pynac/pynac.pxd:        bint is_not_equal "operator!=" (GParamSetIter i)
src/sage/libs/pynac/pynac.pxd:        bint is_not_equal "operator!=" (GExSetIter i)
```

I am guessing they can go as well if I remove all the instances of `is_not_equal`. Second opinion? Ralf?



---

archive/issue_comments_297618.json:
```json
{
    "body": "Replying to [comment:33 fbissey]:\n> I have been grepping `is_not_equal` over the entire sage tree and apart from the one occurence in `pynac.pyx` and 3 in `symbolic/expression.pyx` I found 3 in `pynac.pxd`\n> {{{\n> grep -rI is_not_equal src/sage/*\n> src/sage/libs/pynac/pynac.pxd:        bint is_not_equal \"operator!=\" (GExListIter i)\n> src/sage/libs/pynac/pynac.pxd:        bint is_not_equal \"operator!=\" (GParamSetIter i)\n> src/sage/libs/pynac/pynac.pxd:        bint is_not_equal \"operator!=\" (GExSetIter i)\n> }}}\n> I am guessing they can go as well if I remove all the instances of `is_not_equal`. Second opinion? Ralf?\n\nWhy would you remove these that compile? This seems to be asking for trouble.\nThe whole point of that `operator!=` is that you can actually provide your own implementation. E.g. in Sage there  are lots of these in `local/include/[boost,NTL]`, and moreover in\n\n```\nlocal/include/pynac/ptr.h:      bool operator!=(const ptr<U> & rhs) const throw() { return p != get_pointer(rhs); }\nlocal/include/pynac/ptr.h:      inline friend bool operator!=(const ptr & lhs, const U * rhs) throw() { return lhs.p != rhs; }\nlocal/include/pynac/ptr.h:      inline friend bool operator!=(const U * lhs, const ptr & rhs) throw() { return lhs != rhs.p; }\nlocal/include/pynac/ex.h:       bool operator!=(const const_iterator &other) const throw()\nlocal/include/pynac/ex.h:       bool operator!=(const _iter_rep &other) const throw()\nlocal/include/pynac/ex.h:       bool operator!=(const const_preorder_iterator &other) const throw()\nlocal/include/pynac/ex.h:       bool operator!=(const const_postorder_iterator &other) const throw()\nlocal/include/pynac/operators.h:const relational operator!=(const ex & lh, const ex & rh);\nlocal/include/pynac/numeric.h:  bool operator!=(const numeric &other) const;\n```\n\nWe should check whether one of the latter must have been taken by the compiler,\nbut somehow the compiler didn't manage it.\nI guess that in particular `GExListIter` and `GExSetIter` are dealt with such an operator in `local/include/pynac/ex.h`, and it does do some stuff...",
    "created_at": "2016-11-24T22:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297618",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:33 fbissey]:
> I have been grepping `is_not_equal` over the entire sage tree and apart from the one occurence in `pynac.pyx` and 3 in `symbolic/expression.pyx` I found 3 in `pynac.pxd`
> {{{
> grep -rI is_not_equal src/sage/*
> src/sage/libs/pynac/pynac.pxd:        bint is_not_equal "operator!=" (GExListIter i)
> src/sage/libs/pynac/pynac.pxd:        bint is_not_equal "operator!=" (GParamSetIter i)
> src/sage/libs/pynac/pynac.pxd:        bint is_not_equal "operator!=" (GExSetIter i)
> }}}
> I am guessing they can go as well if I remove all the instances of `is_not_equal`. Second opinion? Ralf?

Why would you remove these that compile? This seems to be asking for trouble.
The whole point of that `operator!=` is that you can actually provide your own implementation. E.g. in Sage there  are lots of these in `local/include/[boost,NTL]`, and moreover in

```
local/include/pynac/ptr.h:      bool operator!=(const ptr<U> & rhs) const throw() { return p != get_pointer(rhs); }
local/include/pynac/ptr.h:      inline friend bool operator!=(const ptr & lhs, const U * rhs) throw() { return lhs.p != rhs; }
local/include/pynac/ptr.h:      inline friend bool operator!=(const U * lhs, const ptr & rhs) throw() { return lhs != rhs.p; }
local/include/pynac/ex.h:       bool operator!=(const const_iterator &other) const throw()
local/include/pynac/ex.h:       bool operator!=(const _iter_rep &other) const throw()
local/include/pynac/ex.h:       bool operator!=(const const_preorder_iterator &other) const throw()
local/include/pynac/ex.h:       bool operator!=(const const_postorder_iterator &other) const throw()
local/include/pynac/operators.h:const relational operator!=(const ex & lh, const ex & rh);
local/include/pynac/numeric.h:  bool operator!=(const numeric &other) const;
```

We should check whether one of the latter must have been taken by the compiler,
but somehow the compiler didn't manage it.
I guess that in particular `GExListIter` and `GExSetIter` are dealt with such an operator in `local/include/pynac/ex.h`, and it does do some stuff...



---

archive/issue_comments_297619.json:
```json
{
    "body": "Why would I remove them?\n 1) proven not work with clang\n 2) I am removing all the instances were they are used\n\nI could understand keeping them just in case if they were working, but my experience is that they do not. If I keep them there someone will try to use them and break the clang build.\n\n<disclaimer: I am a bit grumpy after dealing with some very ugly setup on the Pan cluster in Auckland for a local user. Right now, I am seeing them as an accident waiting to happen.>",
    "created_at": "2016-11-24T22:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297619",
    "user": "https://github.com/kiwifb"
}
```

Why would I remove them?
 1) proven not work with clang
 2) I am removing all the instances were they are used

I could understand keeping them just in case if they were working, but my experience is that they do not. If I keep them there someone will try to use them and break the clang build.

<disclaimer: I am a bit grumpy after dealing with some very ugly setup on the Pan cluster in Auckland for a local user. Right now, I am seeing them as an accident waiting to happen.>



---

archive/issue_comments_297620.json:
```json
{
    "body": "Replying to [comment:35 fbissey]:\n> Why would I remove them?\n>  1) proven not work with clang\n>  2) I am removing all the instances were they are used\n> \n> I could understand keeping them just in case if they were working, but my experience is that they do not. If I keep them there someone will try to use them and break the clang build.\n\njust removing them potentially introduces bugs/memory leaks. I'd think it's ok to remove the `GParamSetIter` operator!=, but not the other two. Did you have to remove the latter to compile, too?\n\nAnyhow, this all should be fixable by doing something right in C++ code.",
    "created_at": "2016-11-24T23:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297620",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:35 fbissey]:
> Why would I remove them?
>  1) proven not work with clang
>  2) I am removing all the instances were they are used
> 
> I could understand keeping them just in case if they were working, but my experience is that they do not. If I keep them there someone will try to use them and break the clang build.

just removing them potentially introduces bugs/memory leaks. I'd think it's ok to remove the `GParamSetIter` operator!=, but not the other two. Did you have to remove the latter to compile, too?

Anyhow, this all should be fixable by doing something right in C++ code.



---

archive/issue_comments_297621.json:
```json
{
    "body": "Can you explain to me how something that is not used can prevent memory leaks? May be I shouldn't ask, it is C++ after all.",
    "created_at": "2016-11-25T00:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297621",
    "user": "https://github.com/kiwifb"
}
```

Can you explain to me how something that is not used can prevent memory leaks? May be I shouldn't ask, it is C++ after all.



---

archive/issue_comments_297622.json:
```json
{
    "body": "I should answer the question: No I didn't need to remove it to compile. I discovered them as an afterthought. I started to wonder if there were many other instances, and that's when I discovered those.",
    "created_at": "2016-11-25T00:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297622",
    "user": "https://github.com/kiwifb"
}
```

I should answer the question: No I didn't need to remove it to compile. I discovered them as an afterthought. I started to wonder if there were many other instances, and that's when I discovered those.



---

archive/issue_comments_297623.json:
```json
{
    "body": "Replying to [comment:37 fbissey]:\n> Can you explain to me how something that is not used can prevent memory leaks? May be I shouldn't ask, it is C++ after all.\n\nHmm, what do you mean by saying \"not used\"? Try removing definitions of \n`operator!=` from pynac C++ headers in local/include/, and see how far\nyou can go (using gcc, even). E.g. this one (in ex.h) clearly does stuff:\n\n```\n        bool operator==(const const_iterator &other) const throw()\n        {\n                return are_ex_trivially_equal(e, other.e) && i == other.i;\n        }\n\n        bool operator!=(const const_iterator &other) const throw()\n        {\n                return !(*this == other);\n        }\n```\n\nby invoking `are_ex_trivially_equal()`. (This would be a proper test of \"not used\" claim).",
    "created_at": "2016-11-25T00:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297623",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:37 fbissey]:
> Can you explain to me how something that is not used can prevent memory leaks? May be I shouldn't ask, it is C++ after all.

Hmm, what do you mean by saying "not used"? Try removing definitions of 
`operator!=` from pynac C++ headers in local/include/, and see how far
you can go (using gcc, even). E.g. this one (in ex.h) clearly does stuff:

```
        bool operator==(const const_iterator &other) const throw()
        {
                return are_ex_trivially_equal(e, other.e) && i == other.i;
        }

        bool operator!=(const const_iterator &other) const throw()
        {
                return !(*this == other);
        }
```

by invoking `are_ex_trivially_equal()`. (This would be a proper test of "not used" claim).



---

archive/issue_comments_297624.json:
```json
{
    "body": "I think we are not talking about the same thing Dima! You are talking about removing `operator!=` definitions. I am only talking about removing the three instances of `is_not_equal`. `is_not_equal` was only used in the places that caused `clang` to fail.",
    "created_at": "2016-11-25T00:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297624",
    "user": "https://github.com/kiwifb"
}
```

I think we are not talking about the same thing Dima! You are talking about removing `operator!=` definitions. I am only talking about removing the three instances of `is_not_equal`. `is_not_equal` was only used in the places that caused `clang` to fail.



---

archive/issue_comments_297625.json:
```json
{
    "body": "Replying to [comment:40 fbissey]:\n> I think we are not talking about the same thing Dima! You are talking about removing `operator!=` definitions. I am only talking about removing the three instances of `is_not_equal`. `is_not_equal` was only used in the places that caused `clang` to fail.\n\nCython converts `is_not_equal` into `operator!=`. By replacing `is_not_equal` with `!=` in cython files, we in effect replacing whatever `operator!=` implementation is picked by the C++ compiler with a \"trivial\" implementation, which might be correct, or not. In clang's OSX case, it simply fails to pick an appropriate implementation of `operator!=`. This might either be a bug of the compiler, or a missing default implementation in STL.\n\nSee, there are several ifs here.",
    "created_at": "2016-11-25T00:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297625",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:40 fbissey]:
> I think we are not talking about the same thing Dima! You are talking about removing `operator!=` definitions. I am only talking about removing the three instances of `is_not_equal`. `is_not_equal` was only used in the places that caused `clang` to fail.

Cython converts `is_not_equal` into `operator!=`. By replacing `is_not_equal` with `!=` in cython files, we in effect replacing whatever `operator!=` implementation is picked by the C++ compiler with a "trivial" implementation, which might be correct, or not. In clang's OSX case, it simply fails to pick an appropriate implementation of `operator!=`. This might either be a bug of the compiler, or a missing default implementation in STL.

See, there are several ifs here.



---

archive/issue_comments_297626.json:
```json
{
    "body": "I am not going to fight that fight. If a reviewer think they should not go, fine with me. Still needs some testing on normal setups. Not expecting problems but we never know.\n----\nNew commits:",
    "created_at": "2016-11-25T01:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297626",
    "user": "https://github.com/kiwifb"
}
```

I am not going to fight that fight. If a reviewer think they should not go, fine with me. Still needs some testing on normal setups. Not expecting problems but we never know.
----
New commits:



---

archive/issue_comments_297627.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-11-25T01:01:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297627",
    "user": "https://github.com/kiwifb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_297628.json:
```json
{
    "body": "If I want to test this on OS X, do I just do `export CC=clang` and then `make`?",
    "created_at": "2016-11-25T04:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297628",
    "user": "https://github.com/jhpalmieri"
}
```

If I want to test this on OS X, do I just do `export CC=clang` and then `make`?



---

archive/issue_comments_297629.json:
```json
{
    "body": "Replying to [comment:43 jhpalmieri]:\n> If I want to test this on OS X, do I just do `export CC=clang` and then `make`?\n\nNo. You also need this\n\n```\ndiff --git a/src/bin/sage-env b/src/bin/sage-env\nindex 54c0783..e25081d 100644\n--- a/src/bin/sage-env\n+++ b/src/bin/sage-env\n@@ -528,15 +528,15 @@ if [ \"$UNAME\" = \"Darwin\" ]; then\n fi\n \n # Override CC, CPP, CXX, FC if the GCC spkg was installed.\n-if [ -x \"$SAGE_LOCAL/bin/gcc\" ]; then\n-    CC=gcc\n-fi\n-if [ -x \"$SAGE_LOCAL/bin/cpp\" ]; then\n-    CPP=cpp\n-fi\n-if [ -x \"$SAGE_LOCAL/bin/g++\" ]; then\n-    CXX=g++\n-fi\n+#if [ -x \"$SAGE_LOCAL/bin/gcc\" ]; then\n+#    CC=gcc\n+#fi\n+#if [ -x \"$SAGE_LOCAL/bin/cpp\" ]; then\n+#    CPP=cpp\n+#fi\n+#if [ -x \"$SAGE_LOCAL/bin/g++\" ]; then\n+#    CXX=g++\n+#fi\n if [ -x \"$SAGE_LOCAL/bin/gfortran\" ]; then\n     FC=gfortran\n fi\n```\n\nThen `CC=clang CXX=clang++ make`. I don't have a proper way to switch yet, the last thing I tried made `gcc` fail to build (we still need `gcc` because of `gfortran`).",
    "created_at": "2016-11-25T04:45:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297629",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:43 jhpalmieri]:
> If I want to test this on OS X, do I just do `export CC=clang` and then `make`?

No. You also need this

```
diff --git a/src/bin/sage-env b/src/bin/sage-env
index 54c0783..e25081d 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -528,15 +528,15 @@ if [ "$UNAME" = "Darwin" ]; then
 fi
 
 # Override CC, CPP, CXX, FC if the GCC spkg was installed.
-if [ -x "$SAGE_LOCAL/bin/gcc" ]; then
-    CC=gcc
-fi
-if [ -x "$SAGE_LOCAL/bin/cpp" ]; then
-    CPP=cpp
-fi
-if [ -x "$SAGE_LOCAL/bin/g++" ]; then
-    CXX=g++
-fi
+#if [ -x "$SAGE_LOCAL/bin/gcc" ]; then
+#    CC=gcc
+#fi
+#if [ -x "$SAGE_LOCAL/bin/cpp" ]; then
+#    CPP=cpp
+#fi
+#if [ -x "$SAGE_LOCAL/bin/g++" ]; then
+#    CXX=g++
+#fi
 if [ -x "$SAGE_LOCAL/bin/gfortran" ]; then
     FC=gfortran
 fi
```

Then `CC=clang CXX=clang++ make`. I don't have a proper way to switch yet, the last thing I tried made `gcc` fail to build (we still need `gcc` because of `gfortran`).



---

archive/issue_comments_297630.json:
```json
{
    "body": "I forgot there is one more problem to build sage with clang that is not included in this ticket. The first line `src/sage/libs/pynac/pynac.pxd` has to be edited out.",
    "created_at": "2016-11-25T05:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297630",
    "user": "https://github.com/kiwifb"
}
```

I forgot there is one more problem to build sage with clang that is not included in this ticket. The first line `src/sage/libs/pynac/pynac.pxd` has to be edited out.



---

archive/issue_comments_297631.json:
```json
{
    "body": "Replying to [comment:42 fbissey]:\n> I am not going to fight that fight. If a reviewer think they should not go, fine with me. Still needs some testing on normal setups. Not expecting problems but we never know.\n\nI see no problem because in `ginac/fderivative.h`\n\n```\ntypedef std::multiset<unsigned> paramset;\n```\n\nthis is just a standard container with a standard iterator. Rather, the Pynac interface in `pynac.pxd` could be cleaned up more rigourously (in another ticket).",
    "created_at": "2016-11-25T06:54:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297631",
    "user": "https://github.com/rwst"
}
```

Replying to [comment:42 fbissey]:
> I am not going to fight that fight. If a reviewer think they should not go, fine with me. Still needs some testing on normal setups. Not expecting problems but we never know.

I see no problem because in `ginac/fderivative.h`

```
typedef std::multiset<unsigned> paramset;
```

this is just a standard container with a standard iterator. Rather, the Pynac interface in `pynac.pxd` could be cleaned up more rigourously (in another ticket).



---

archive/issue_comments_297632.json:
```json
{
    "body": "I think it's possible that the code in `pynac.pxd` was written because at the time there was no `std::multiset` support in Cython.",
    "created_at": "2016-11-25T07:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297632",
    "user": "https://github.com/rwst"
}
```

I think it's possible that the code in `pynac.pxd` was written because at the time there was no `std::multiset` support in Cython.



---

archive/issue_comments_297633.json:
```json
{
    "body": "Replying to [comment:46 rws]:\n> Replying to [comment:42 fbissey]:\n> > I am not going to fight that fight. If a reviewer think they should not go, fine with me. Still needs some testing on normal setups. Not expecting problems but we never know.\n> \n> I see no problem because in `ginac/fderivative.h`\n> {{{\n> typedef std::multiset<unsigned> paramset;\n> }}}\n> this is just a standard container with a standard iterator.\nand this is why the 1st chunk of the patch :\n\n```\n     cdef GParamSetIter itr = s.begin()\n     res = []\n-    while itr.is_not_equal(s.end()):\n+    while itr != s.end():\n         res.append(itr.obj())\n         itr.inc()\n     return res\n```\n\nis perfectly fine with me, \nbut the other ones are about different containers, and it seems that for them\n`operator!=` implementations are provided, and are not totally trivial\n(see my comment 39 above).",
    "created_at": "2016-11-25T09:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297633",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:46 rws]:
> Replying to [comment:42 fbissey]:
> > I am not going to fight that fight. If a reviewer think they should not go, fine with me. Still needs some testing on normal setups. Not expecting problems but we never know.
> 
> I see no problem because in `ginac/fderivative.h`
> {{{
> typedef std::multiset<unsigned> paramset;
> }}}
> this is just a standard container with a standard iterator.
and this is why the 1st chunk of the patch :

```
     cdef GParamSetIter itr = s.begin()
     res = []
-    while itr.is_not_equal(s.end()):
+    while itr != s.end():
         res.append(itr.obj())
         itr.inc()
     return res
```

is perfectly fine with me, 
but the other ones are about different containers, and it seems that for them
`operator!=` implementations are provided, and are not totally trivial
(see my comment 39 above).



---

archive/issue_comments_297634.json:
```json
{
    "body": "Replying to [comment:41 dimpase]:\n> Cython converts `is_not_equal` into `operator!=`. By replacing `is_not_equal` with `!=` in cython files, we in effect replacing whatever `operator!=` implementation is picked by the C++ compiler with a \"trivial\" implementation\n\n...if no custom operator `!=` is provided, which is exactly what you want. If a custom operator `!=` operator is provided, then C++ will use that for `!=`. Writing `operator!=` is more explicit than `!=` but it means the same thing.",
    "created_at": "2016-11-25T09:19:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297634",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:41 dimpase]:
> Cython converts `is_not_equal` into `operator!=`. By replacing `is_not_equal` with `!=` in cython files, we in effect replacing whatever `operator!=` implementation is picked by the C++ compiler with a "trivial" implementation

...if no custom operator `!=` is provided, which is exactly what you want. If a custom operator `!=` operator is provided, then C++ will use that for `!=`. Writing `operator!=` is more explicit than `!=` but it means the same thing.



---

archive/issue_comments_297635.json:
```json
{
    "body": "Replying to [comment:49 jdemeyer]:\n> Replying to [comment:41 dimpase]:\n> > Cython converts `is_not_equal` into `operator!=`. By replacing `is_not_equal` with `!=` in cython files, we in effect replacing whatever `operator!=` implementation is picked by the C++ compiler with a \"trivial\" implementation\n> \n> ...if no custom operator `!=` is provided, which is exactly what you want. If a custom operator `!=` operator is provided, then C++ will use that for `!=`. Writing `operator!=` is more explicit than `!=` but it means the same thing.\n\nit seems to me that for some `is_not_equal` implementations of `operator!=` are provided in pynac, and are picked up by gcc, but not by clang`@`osx.",
    "created_at": "2016-11-25T09:33:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297635",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:49 jdemeyer]:
> Replying to [comment:41 dimpase]:
> > Cython converts `is_not_equal` into `operator!=`. By replacing `is_not_equal` with `!=` in cython files, we in effect replacing whatever `operator!=` implementation is picked by the C++ compiler with a "trivial" implementation
> 
> ...if no custom operator `!=` is provided, which is exactly what you want. If a custom operator `!=` operator is provided, then C++ will use that for `!=`. Writing `operator!=` is more explicit than `!=` but it means the same thing.

it seems to me that for some `is_not_equal` implementations of `operator!=` are provided in pynac, and are picked up by gcc, but not by clang`@`osx.



---

archive/issue_comments_297636.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-25T09:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297636",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_297637.json:
```json
{
    "body": "Replying to [comment:50 dimpase]:\n> it seems to me that for some `is_not_equal` implementations of `operator!=` are provided in pynac, and are picked up by gcc, but not by clang`@`osx.\n\nIt's in the C++ standard library, not Pynac. The fix makes sense to me. It could be that the C++ standard library on OS X is different, but that shouldn't matter here.",
    "created_at": "2016-11-25T09:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297637",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:50 dimpase]:
> it seems to me that for some `is_not_equal` implementations of `operator!=` are provided in pynac, and are picked up by gcc, but not by clang`@`osx.

It's in the C++ standard library, not Pynac. The fix makes sense to me. It could be that the C++ standard library on OS X is different, but that shouldn't matter here.



---

archive/issue_comments_297638.json:
```json
{
    "body": "claiming co-authorship ;-)",
    "created_at": "2016-11-25T10:32:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297638",
    "user": "https://github.com/dimpase"
}
```

claiming co-authorship ;-)



---

archive/issue_comments_297639.json:
```json
{
    "body": "Honestly, I only typed, so you are very welcome.",
    "created_at": "2016-11-25T10:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297639",
    "user": "https://github.com/kiwifb"
}
```

Honestly, I only typed, so you are very welcome.



---

archive/issue_comments_297640.json:
```json
{
    "body": "On OS X, I get a failure building the Sage library:\n\n```\n[sagelib-7.5.beta3] 1 warning generated.\n[sagelib-7.5.beta3] clang++ -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib build/temp.macosx-10.9-x86_64-2.7/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/ppl.o build/temp.macosx-10.9-x86_64-2.7/sage/libs/ppl_shim.o -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -lppl -lgmp -lgmpxx -lm -lstdc++ -o build/lib.macosx-10.9-x86_64-2.7/sage/libs/ppl.so -lpari -Ddummy\n[sagelib-7.5.beta3] [  6/308] clang -fno-strict-aliasing -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/var/tmp/sage/build/python2-2.7.10.p3/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include/python2.7 -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib/python2.7/site-packages/numpy/core/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/sage/ext -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/ext -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include/python2.7 -c /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/pynac/constant.c -o build/temp.macosx-10.9-x86_64-2.7/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/pynac/constant.o -std=c++11 -fno-strict-aliasing\n[sagelib-7.5.beta3] error: invalid argument '-std=c++11' not allowed with 'C/ObjC'\n[sagelib-7.5.beta3] error: command 'clang' failed with exit status 1\n[sagelib-7.5.beta3] [  7/308] clang -fno-strict-aliasing -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/var/tmp/sage/build/python2-2.7.10.p3/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include/python2.7 -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib/python2.7/site-packages/numpy/core/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/sage/ext -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/ext -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include/python2.7 -c /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/pynac/pynac.c -o build/temp.macosx-10.9-x86_64-2.7/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/pynac/pynac.o -std=c++11 -fno-strict-aliasing\n[sagelib-7.5.beta3] error: invalid argument '-std=c++11' not allowed with 'C/ObjC'\n[sagelib-7.5.beta3] make[3]: *** [sage] Error 1\n[sagelib-7.5.beta3] \n[sagelib-7.5.beta3] real\t0m5.450s\n[sagelib-7.5.beta3] user\t0m4.112s\n[sagelib-7.5.beta3] sys\t0m0.925s\nmake[2]: *** [sagelib] Error 2\nmake[1]: *** [all] Error 2\n\nreal\t0m6.149s\nuser\t0m4.477s\nsys\t0m1.067s\n***************************************************************\nError building Sage.\n\nThe following package(s) may have failed to build (not necessarily\nduring this run of 'make all'):\n\nThe build directory may contain configuration files and other potentially\nhelpful information. WARNING: if you now run 'make' again, the build\ndirectory will, by default, be deleted. Set the environment variable\nSAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.\n\nmake: *** [all] Error 1\n```\n",
    "created_at": "2016-11-25T17:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297640",
    "user": "https://github.com/jhpalmieri"
}
```

On OS X, I get a failure building the Sage library:

```
[sagelib-7.5.beta3] 1 warning generated.
[sagelib-7.5.beta3] clang++ -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib build/temp.macosx-10.9-x86_64-2.7/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/ppl.o build/temp.macosx-10.9-x86_64-2.7/sage/libs/ppl_shim.o -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -L/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib -lppl -lgmp -lgmpxx -lm -lstdc++ -o build/lib.macosx-10.9-x86_64-2.7/sage/libs/ppl.so -lpari -Ddummy
[sagelib-7.5.beta3] [  6/308] clang -fno-strict-aliasing -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/var/tmp/sage/build/python2-2.7.10.p3/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include/python2.7 -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib/python2.7/site-packages/numpy/core/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/sage/ext -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/ext -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include/python2.7 -c /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/pynac/constant.c -o build/temp.macosx-10.9-x86_64-2.7/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/pynac/constant.o -std=c++11 -fno-strict-aliasing
[sagelib-7.5.beta3] error: invalid argument '-std=c++11' not allowed with 'C/ObjC'
[sagelib-7.5.beta3] error: command 'clang' failed with exit status 1
[sagelib-7.5.beta3] [  7/308] clang -fno-strict-aliasing -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/var/tmp/sage/build/python2-2.7.10.p3/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include/python2.7 -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/lib/python2.7/site-packages/numpy/core/include -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/sage/ext -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/ext -I/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/local/include/python2.7 -c /Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/pynac/pynac.c -o build/temp.macosx-10.9-x86_64-2.7/Users/palmieri/Desktop/Sage_stuff/sage_builds/TESTING/sage-7.5.beta4/src/build/cythonized/sage/libs/pynac/pynac.o -std=c++11 -fno-strict-aliasing
[sagelib-7.5.beta3] error: invalid argument '-std=c++11' not allowed with 'C/ObjC'
[sagelib-7.5.beta3] make[3]: *** [sage] Error 1
[sagelib-7.5.beta3] 
[sagelib-7.5.beta3] real	0m5.450s
[sagelib-7.5.beta3] user	0m4.112s
[sagelib-7.5.beta3] sys	0m0.925s
make[2]: *** [sagelib] Error 2
make[1]: *** [all] Error 2

real	0m6.149s
user	0m4.477s
sys	0m1.067s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make all'):

The build directory may contain configuration files and other potentially
helpful information. WARNING: if you now run 'make' again, the build
directory will, by default, be deleted. Set the environment variable
SAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.

make: *** [all] Error 1
```




---

archive/issue_comments_297641.json:
```json
{
    "body": "This is after making the changes\n\n```diff\ndiff --git a/src/bin/sage-env b/src/bin/sage-env\nindex 54c0783..fa8c557 100644\n--- a/src/bin/sage-env\n+++ b/src/bin/sage-env\n@@ -528,15 +528,15 @@ if [ \"$UNAME\" = \"Darwin\" ]; then\n fi\n \n # Override CC, CPP, CXX, FC if the GCC spkg was installed.\n-if [ -x \"$SAGE_LOCAL/bin/gcc\" ]; then\n-    CC=gcc\n-fi\n-if [ -x \"$SAGE_LOCAL/bin/cpp\" ]; then\n-    CPP=cpp\n-fi\n-if [ -x \"$SAGE_LOCAL/bin/g++\" ]; then\n-    CXX=g++\n-fi\n+# if [ -x \"$SAGE_LOCAL/bin/gcc\" ]; then\n+#     CC=gcc\n+# fi\n+# if [ -x \"$SAGE_LOCAL/bin/cpp\" ]; then\n+#     CPP=cpp\n+# fi\n+# if [ -x \"$SAGE_LOCAL/bin/g++\" ]; then\n+#     CXX=g++\n+# fi\n if [ -x \"$SAGE_LOCAL/bin/gfortran\" ]; then\n     FC=gfortran\n fi\ndiff --git a/src/sage/libs/pynac/pynac.pxd b/src/sage/libs/pynac/pynac.pxd\nindex 9b3ecfb..da5d447 100644\n--- a/src/sage/libs/pynac/pynac.pxd\n+++ b/src/sage/libs/pynac/pynac.pxd\n@@ -1,4 +1,3 @@\n-# distutils: language = c++\n # distutils: libraries = pynac gmp\n # distutils: extra_compile_args = -std=c++11\n \"\"\"\n```\n",
    "created_at": "2016-11-25T17:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297641",
    "user": "https://github.com/jhpalmieri"
}
```

This is after making the changes

```diff
diff --git a/src/bin/sage-env b/src/bin/sage-env
index 54c0783..fa8c557 100644
--- a/src/bin/sage-env
+++ b/src/bin/sage-env
@@ -528,15 +528,15 @@ if [ "$UNAME" = "Darwin" ]; then
 fi
 
 # Override CC, CPP, CXX, FC if the GCC spkg was installed.
-if [ -x "$SAGE_LOCAL/bin/gcc" ]; then
-    CC=gcc
-fi
-if [ -x "$SAGE_LOCAL/bin/cpp" ]; then
-    CPP=cpp
-fi
-if [ -x "$SAGE_LOCAL/bin/g++" ]; then
-    CXX=g++
-fi
+# if [ -x "$SAGE_LOCAL/bin/gcc" ]; then
+#     CC=gcc
+# fi
+# if [ -x "$SAGE_LOCAL/bin/cpp" ]; then
+#     CPP=cpp
+# fi
+# if [ -x "$SAGE_LOCAL/bin/g++" ]; then
+#     CXX=g++
+# fi
 if [ -x "$SAGE_LOCAL/bin/gfortran" ]; then
     FC=gfortran
 fi
diff --git a/src/sage/libs/pynac/pynac.pxd b/src/sage/libs/pynac/pynac.pxd
index 9b3ecfb..da5d447 100644
--- a/src/sage/libs/pynac/pynac.pxd
+++ b/src/sage/libs/pynac/pynac.pxd
@@ -1,4 +1,3 @@
-# distutils: language = c++
 # distutils: libraries = pynac gmp
 # distutils: extra_compile_args = -std=c++11
 """
```




---

archive/issue_comments_297642.json:
```json
{
    "body": "Replying to [comment:54 jhpalmieri]:\n> On OS X, I get a failure building the Sage library:\n\nAre you still on OSX 10.9 ?\n(and on Xcode 6 ?) Well, no wonder it might not work.",
    "created_at": "2016-11-25T17:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297642",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:54 jhpalmieri]:
> On OS X, I get a failure building the Sage library:

Are you still on OSX 10.9 ?
(and on Xcode 6 ?) Well, no wonder it might not work.



---

archive/issue_comments_297643.json:
```json
{
    "body": "This is on OS X 10.12, Xcode 8.1.",
    "created_at": "2016-11-25T17:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297643",
    "user": "https://github.com/jhpalmieri"
}
```

This is on OS X 10.12, Xcode 8.1.



---

archive/issue_comments_297644.json:
```json
{
    "body": "Replying to [comment:57 jhpalmieri]:\n> This is on OS X 10.12, Xcode 8.1.\nI was confused by `macosx-10.9-x86_64-2.7` string in your log...\n\nAnyway, I think I know where this comes from: you probably need\n\n```\ndiff --git a/src/sage/libs/m4ri.pxd b/src/sage/libs/m4ri.pxd\nindex a1fe594..ea07121 100644\n--- a/src/sage/libs/m4ri.pxd\n+++ b/src/sage/libs/m4ri.pxd\n@@ -1,4 +1,3 @@\n-# distutils: extra_compile_args = -std=c99\n \n cdef extern from \"m4ri/m4ri.h\":\n     ctypedef int rci_t\n```\n",
    "created_at": "2016-11-25T18:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297644",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:57 jhpalmieri]:
> This is on OS X 10.12, Xcode 8.1.
I was confused by `macosx-10.9-x86_64-2.7` string in your log...

Anyway, I think I know where this comes from: you probably need

```
diff --git a/src/sage/libs/m4ri.pxd b/src/sage/libs/m4ri.pxd
index a1fe594..ea07121 100644
--- a/src/sage/libs/m4ri.pxd
+++ b/src/sage/libs/m4ri.pxd
@@ -1,4 +1,3 @@
-# distutils: extra_compile_args = -std=c99
 
 cdef extern from "m4ri/m4ri.h":
     ctypedef int rci_t
```




---

archive/issue_comments_297645.json:
```json
{
    "body": "My fault I said to edit `pynac.pxd` instead of `m4ri.pxd` I was busy with something else at the time.",
    "created_at": "2016-11-25T18:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297645",
    "user": "https://github.com/kiwifb"
}
```

My fault I said to edit `pynac.pxd` instead of `m4ri.pxd` I was busy with something else at the time.



---

archive/issue_comments_297646.json:
```json
{
    "body": "Replying to [comment:58 dimpase]:\n> Replying to [comment:57 jhpalmieri]:\n> > This is on OS X 10.12, Xcode 8.1.\n> I was confused by `macosx-10.9-x86_64-2.7` string in your log...\n> \n> Anyway, I think I know where this comes from: you probably need\n> {{{\n> diff --git a/src/sage/libs/m4ri.pxd b/src/sage/libs/m4ri.pxd\n> index a1fe594..ea07121 100644\n> --- a/src/sage/libs/m4ri.pxd\n> +++ b/src/sage/libs/m4ri.pxd\n> `@``@` -1,4 +1,3 `@``@`\n> -# distutils: extra_compile_args = -std=c99\n>  \n>  cdef extern from \"m4ri/m4ri.h\":\n>      ctypedef int rci_t\n> }}}\n> \n> \n> \nRight, so, and, as Francois says, put back `# distutils: language = c++` into `src/sage/libs/pynac/pynac.pxd`",
    "created_at": "2016-11-25T18:20:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297646",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:58 dimpase]:
> Replying to [comment:57 jhpalmieri]:
> > This is on OS X 10.12, Xcode 8.1.
> I was confused by `macosx-10.9-x86_64-2.7` string in your log...
> 
> Anyway, I think I know where this comes from: you probably need
> {{{
> diff --git a/src/sage/libs/m4ri.pxd b/src/sage/libs/m4ri.pxd
> index a1fe594..ea07121 100644
> --- a/src/sage/libs/m4ri.pxd
> +++ b/src/sage/libs/m4ri.pxd
> `@``@` -1,4 +1,3 `@``@`
> -# distutils: extra_compile_args = -std=c99
>  
>  cdef extern from "m4ri/m4ri.h":
>      ctypedef int rci_t
> }}}
> 
> 
> 
Right, so, and, as Francois says, put back `# distutils: language = c++` into `src/sage/libs/pynac/pynac.pxd`



---

archive/issue_comments_297647.json:
```json
{
    "body": "The `macos-10.9...` may come from these lines in `sage-env`:\n\n```\n# Mac OS X-specific setup\nif [ \"$UNAME\" = \"Darwin\" ]; then\n    # set MACOSX_DEPLOYMENT_TARGET -- if set incorrectly, this can\n    # cause lots of random \"Abort trap\" issues on OSX. see trac\n    # #7095 for an example.\n    MACOSX_VERSION=`uname -r | awk -F. '{print $1}'`\n    if [ $MACOSX_VERSION -ge 14 ]; then\n        # various packages have still have issues with\n        # two digit OS X versions\n        MACOSX_DEPLOYMENT_TARGET=10.9\n    else\n        MACOSX_DEPLOYMENT_TARGET=10.$[$MACOSX_VERSION-4]\n    fi\n    export MACOSX_DEPLOYMENT_TARGET MACOSX_VERSION\nfi\n```\n",
    "created_at": "2016-11-25T18:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297647",
    "user": "https://github.com/jhpalmieri"
}
```

The `macos-10.9...` may come from these lines in `sage-env`:

```
# Mac OS X-specific setup
if [ "$UNAME" = "Darwin" ]; then
    # set MACOSX_DEPLOYMENT_TARGET -- if set incorrectly, this can
    # cause lots of random "Abort trap" issues on OSX. see trac
    # #7095 for an example.
    MACOSX_VERSION=`uname -r | awk -F. '{print $1}'`
    if [ $MACOSX_VERSION -ge 14 ]; then
        # various packages have still have issues with
        # two digit OS X versions
        MACOSX_DEPLOYMENT_TARGET=10.9
    else
        MACOSX_DEPLOYMENT_TARGET=10.$[$MACOSX_VERSION-4]
    fi
    export MACOSX_DEPLOYMENT_TARGET MACOSX_VERSION
fi
```




---

archive/issue_comments_297648.json:
```json
{
    "body": "Replying to [comment:61 jhpalmieri]:\nBut this sounds alarming, to have such a version mismatch, \nas you do set it incorrectly...\n\n> {{{\n> # Mac OS X-specific setup\n> if [ \"$UNAME\" = \"Darwin\" ]; then\n>     # set MACOSX_DEPLOYMENT_TARGET -- if set incorrectly, this can\n>     # cause lots of random \"Abort trap\" issues on OSX.\n> }}}",
    "created_at": "2016-11-25T18:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297648",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:61 jhpalmieri]:
But this sounds alarming, to have such a version mismatch, 
as you do set it incorrectly...

> {{{
> # Mac OS X-specific setup
> if [ "$UNAME" = "Darwin" ]; then
>     # set MACOSX_DEPLOYMENT_TARGET -- if set incorrectly, this can
>     # cause lots of random "Abort trap" issues on OSX.
> }}}



---

archive/issue_comments_297649.json:
```json
{
    "body": "I plan to test what happens if we remove those lines and just set `MACOSX_DEPLOYMENT_TARGET` correctly. It may take me a few days to get to it, though.",
    "created_at": "2016-11-25T18:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297649",
    "user": "https://github.com/jhpalmieri"
}
```

I plan to test what happens if we remove those lines and just set `MACOSX_DEPLOYMENT_TARGET` correctly. It may take me a few days to get to it, though.



---

archive/issue_comments_297650.json:
```json
{
    "body": "`MACOSX_DEPLOYMENT_TARGET` was set that way on purpose some time ago. That makes binaries backward compatible for example. There is nothing wrong with it in itself. And at the time there were difficulties for putting it at `10.10` (because two digits instead of one). By any means we can see what happens when we raise it.",
    "created_at": "2016-11-25T18:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297650",
    "user": "https://github.com/kiwifb"
}
```

`MACOSX_DEPLOYMENT_TARGET` was set that way on purpose some time ago. That makes binaries backward compatible for example. There is nothing wrong with it in itself. And at the time there were difficulties for putting it at `10.10` (because two digits instead of one). By any means we can see what happens when we raise it.



---

archive/issue_comments_297651.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-27T16:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21464#issuecomment-297651",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_057470.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-27T16:45:33Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21464",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21464#event-57470"
}
```
