# Issue 17057: Add gcd to number field elements

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2014-11-05 13:55:59

CC:  kcrisman

Implement `gcd()` for number fields analogous to `factor()`.

The `gcd()` of two number field elements doesn't always make sense, but if it exists (in particular, if the class number is 1), then `a.gcd(b)` should work.


---

Comment by jdemeyer created at 2014-11-27 08:41:14

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-11-27 08:41:14

New commits:


---

Comment by kcrisman created at 2015-02-19 19:21:23

This is red for some reason.

Also, how does this play into the big discussion about xgcd earlier?  I assume it would not be affected, but just asking.


---

Comment by git created at 2015-02-19 20:36:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-02-19 20:37:06

Replying to [comment:5 kcrisman]:
> This is red for some reason.
Fixed.

> Also, how does this play into the big discussion about xgcd earlier?  I assume it would not be affected, but just asking.
I don't think it's related.


---

Comment by vdelecroix created at 2015-02-22 10:45:19

typo in the doc

```diff
- The following field has class number 3, but it the ideal
+ The following field has class number 3, but if the ideal
```



---

Comment by vdelecroix created at 2015-02-22 10:45:19

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-02-22 19:41:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-02-22 19:50:05

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-04-08 20:08:20

Hello,

Note that the behavior of `gcd` for `QQ` is quite special

```
sage: gcd(1/3, 2/3)
1/3
```

It is the implementation provided by the category `QuotientFields`. It would be different from

```
sage: K = NumberField(x-1, 'a')
sage: K(1/3).gcd(K(2/3))
1
```

I do not care so much as it is specified in the documentation. But a number field is always the quotient field of its maximal order... Do you think we should care?

Vincent


---

Comment by vdelecroix created at 2015-04-08 20:08:20

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2015-04-08 20:27:59

Replying to [comment:11 vdelecroix]:
> I do not care so much as it is specified in the documentation. But a number field is always the quotient field of its maximal order... Do you think we should care?
The problem is that a `gcd()` is not always defined for maximal orders in number fields (if the class number is not 1). So we cannot simply use the fraction field implementation. And for consistency, I don't want to treat the class-number=1 case differently.


---

Comment by jdemeyer created at 2015-04-08 20:28:06

Changing status from needs_info to needs_review.


---

Comment by vdelecroix created at 2015-04-08 20:29:00

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-04-10 20:17:51


```
sage -t --warn-long 47.1 src/sage/categories/quotient_fields.py
**********************************************************************
File "src/sage/categories/quotient_fields.py", line 101, in sage.categories.quotient_fields.QuotientFields.ElementMethods.gcd
Failed example:
    gcd(t, i)
Expected:
    Traceback (most recent call last):
    ...
    TypeError: unable to find gcd
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.quotient_fields.QuotientFields.ElementMethods.gcd[13]>", line 1, in <module>
        gcd(t, i)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/rings/arith.py", line 1551, in gcd
        return GCD(b, **kwargs)
      File "sage/structure/element.pyx", line 3473, in sage.structure.element.NamedBinopMethod.__call__ (build/cythonized/sage/structure/element.c:28398)
        return self._func(x,y, **kwds)
      File "sage/rings/polynomial/polynomial_element.pyx", line 3713, in sage.rings.polynomial.polynomial_element.Polynomial.gcd (build/cythonized/sage/rings/polynomial/polynomial_element.c:34450)
        raise NotImplementedError("%s does not provide a gcd implementation for univariate polynomials"%self.base_ring())
    NotImplementedError: Maximal Order in Number Field in i with defining polynomial x^2 + 1 does not provide a gcd implementation for univariate polynomials
**********************************************************************
File "src/sage/categories/quotient_fields.py", line 177, in sage.categories.quotient_fields.QuotientFields.ElementMethods.lcm
Failed example:
    lcm(t, i)
Expected:
    Traceback (most recent call last):
    ...
    AttributeError: 'sage.rings.polynomial.polynomial_element.Polynomial_generic_dense' object has no attribute 'gcd'
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.quotient_fields.QuotientFields.ElementMethods.lcm[11]>", line 1, in <module>
        lcm(t, i)
      File "/mnt/disk/home/release/Sage/local/lib/python2.7/site-packages/sage/rings/arith.py", line 1698, in lcm
        return LCM(b)
      File "sage/structure/element.pyx", line 3473, in sage.structure.element.NamedBinopMethod.__call__ (build/cythonized/sage/structure/element.c:28398)
        return self._func(x,y, **kwds)
      File "sage/rings/polynomial/polynomial_element.pyx", line 3722, in sage.rings.polynomial.polynomial_element.Polynomial.lcm (build/cythonized/sage/rings/polynomial/polynomial_element.c:34544)
        g = self.gcd(other)
      File "sage/structure/element.pyx", line 3473, in sage.structure.element.NamedBinopMethod.__call__ (build/cythonized/sage/structure/element.c:28398)
        return self._func(x,y, **kwds)
      File "sage/rings/polynomial/polynomial_element.pyx", line 3713, in sage.rings.polynomial.polynomial_element.Polynomial.gcd (build/cythonized/sage/rings/polynomial/polynomial_element.c:34450)
        raise NotImplementedError("%s does not provide a gcd implementation for univariate polynomials"%self.base_ring())
    NotImplementedError: Maximal Order in Number Field in i with defining polynomial x^2 + 1 does not provide a gcd implementation for univariate polynomials
**********************************************************************
2 items had failures:
   1 of  19 in sage.categories.quotient_fields.QuotientFields.ElementMethods.gcd
   1 of  17 in sage.categories.quotient_fields.QuotientFields.ElementMethods.lcm
    [153 tests, 2 failures, 0.99 s]
----------------------------------------------------------------------
sage -t --warn-long 47.1 src/sage/categories/quotient_fields.py  # 2 doctests failed
----------------------------------------------------------------------
```



---

Comment by vbraun created at 2015-04-10 20:17:51

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-04-11 11:10:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-04-11 11:17:26

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2015-04-11 12:10:23

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2015-04-11 12:10:23

All test passed.


---

Comment by vbraun created at 2015-04-14 19:44:04

Resolution: fixed
