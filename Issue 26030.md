# Issue 26030: py3: fix IPython's automatic pprinting of dicts in doctests

archive/issues_026030.json:
```json
{
    "body": "CC:  @fchapoton @vinklein\n\nAs discussed [here](https://trac.sagemath.org/ticket/26097#comment:21), IPython has its own pprint library which, like the stdlib's, normally displays dicts such that their output is sorted by key.\n\nHowever, it is not doing this on Python 3.6+, which it turns out is by design.  Instead it opts to keep the dict's \"natural\" insertion order which is preserved in CPython 3.6+.\n\nHowever, there is a global flag to control this, which we should set at least for running the doctests.  I agree that for normal usage the default behavior is desirable, but for the sake of the doctests it's easier to make the output as close to Python 2 as possible, at least until we drop Python 2 support.\n\nFixing this should fix a number of trivial test failures.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26267\n\n",
    "created_at": "2018-09-13T09:48:59Z",
    "labels": [
        "python3",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "py3: fix IPython's automatic pprinting of dicts in doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26030",
    "user": "@embray"
}
```
CC:  @fchapoton @vinklein

As discussed [here](https://trac.sagemath.org/ticket/26097#comment:21), IPython has its own pprint library which, like the stdlib's, normally displays dicts such that their output is sorted by key.

However, it is not doing this on Python 3.6+, which it turns out is by design.  Instead it opts to keep the dict's "natural" insertion order which is preserved in CPython 3.6+.

However, there is a global flag to control this, which we should set at least for running the doctests.  I agree that for normal usage the default behavior is desirable, but for the sake of the doctests it's easier to make the output as close to Python 2 as possible, at least until we drop Python 2 support.

Fixing this should fix a number of trivial test failures.

Issue created by migration from https://trac.sagemath.org/ticket/26267





---

archive/issue_comments_367174.json:
```json
{
    "body": "I haven't run the full test suite on this yet so I don't know if it will *break* any existing tests.  I don't think it will, but let's see what a patchbot says.\n----\nNew commits:",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367174",
    "user": "@embray"
}
```

I haven't run the full test suite on this yet so I don't know if it will *break* any existing tests.  I don't think it will, but let's see what a patchbot says.
----
New commits:



---

archive/issue_comments_367175.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-13T09:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367175",
    "user": "@embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_367176.json:
```json
{
    "body": "great !! This was really needed.",
    "created_at": "2018-09-13T09:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367176",
    "user": "@fchapoton"
}
```

great !! This was really needed.



---

archive/issue_comments_367177.json:
```json
{
    "body": "Funny, i was currently looking at how to force the doctests framework to use python pprint for dict rather than IPython's. Doesn't know there is global flag for that.",
    "created_at": "2018-09-13T09:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367177",
    "user": "@vinklein"
}
```

Funny, i was currently looking at how to force the doctests framework to use python pprint for dict rather than IPython's. Doesn't know there is global flag for that.



---

archive/issue_comments_367178.json:
```json
{
    "body": "It still uses IPython's, it just controls the behavior of whether or not it should re-sort dict keys.",
    "created_at": "2018-09-13T10:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367178",
    "user": "@embray"
}
```

It still uses IPython's, it just controls the behavior of whether or not it should re-sort dict keys.



---

archive/issue_comments_367179.json:
```json
{
    "body": "apparently no doctest failure",
    "created_at": "2018-09-13T11:28:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367179",
    "user": "@fchapoton"
}
```

apparently no doctest failure



---

archive/issue_comments_367180.json:
```json
{
    "body": "I wish whoever runs \"fermat\" would either fix or disable those magma tests.  I would look into fixing them myself but I don't have access to magma as far as I know :)",
    "created_at": "2018-09-13T11:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367180",
    "user": "@embray"
}
```

I wish whoever runs "fermat" would either fix or disable those magma tests.  I would look into fixing them myself but I don't have access to magma as far as I know :)



---

archive/issue_comments_367181.json:
```json
{
    "body": "I already fixed one of those, but there will remain two of them.",
    "created_at": "2018-09-13T11:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367181",
    "user": "@fchapoton"
}
```

I already fixed one of those, but there will remain two of them.



---

archive/issue_comments_367182.json:
```json
{
    "body": "Well, that's progress at least :)",
    "created_at": "2018-09-13T11:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367182",
    "user": "@embray"
}
```

Well, that's progress at least :)



---

archive/issue_comments_367183.json:
```json
{
    "body": "I restarted my Ubuntu patchbot.  Apparently it hasn't done anything in 10 days, and it's not at all clear why it stalled :(",
    "created_at": "2018-09-13T11:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367183",
    "user": "@embray"
}
```

I restarted my Ubuntu patchbot.  Apparently it hasn't done anything in 10 days, and it's not at all clear why it stalled :(



---

archive/issue_comments_367184.json:
```json
{
    "body": "One fully green bot. I think this is good to go. Thanks a lot.",
    "created_at": "2018-09-13T14:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367184",
    "user": "@fchapoton"
}
```

One fully green bot. I think this is good to go. Thanks a lot.



---

archive/issue_comments_367185.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-13T14:36:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367185",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_367186.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-14T20:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26030",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26030#issuecomment-367186",
    "user": "@vbraun"
}
```

Resolution: fixed
