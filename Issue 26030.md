# Issue 26030: py3: fix IPython's automatic pprinting of dicts in doctests

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2018-09-13 09:48:59

CC:  chapoton vklein

As discussed [here](https://trac.sagemath.org/ticket/26097#comment:21), IPython has its own pprint library which, like the stdlib's, normally displays dicts such that their output is sorted by key.

However, it is not doing this on Python 3.6+, which it turns out is by design.  Instead it opts to keep the dict's "natural" insertion order which is preserved in CPython 3.6+.

However, there is a global flag to control this, which we should set at least for running the doctests.  I agree that for normal usage the default behavior is desirable, but for the sake of the doctests it's easier to make the output as close to Python 2 as possible, at least until we drop Python 2 support.

Fixing this should fix a number of trivial test failures.


---

Comment by embray created at 2018-09-13 09:52:40

I haven't run the full test suite on this yet so I don't know if it will _break_ any existing tests.  I don't think it will, but let's see what a patchbot says.
----
New commits:


---

Comment by embray created at 2018-09-13 09:52:40

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-09-13 09:54:36

great !! This was really needed.


---

Comment by vklein created at 2018-09-13 09:56:44

Funny, i was currently looking at how to force the doctests framework to use python pprint for dict rather than IPython's. Doesn't know there is global flag for that.


---

Comment by embray created at 2018-09-13 10:09:27

It still uses IPython's, it just controls the behavior of whether or not it should re-sort dict keys.


---

Comment by chapoton created at 2018-09-13 11:28:44

apparently no doctest failure


---

Comment by embray created at 2018-09-13 11:30:37

I wish whoever runs "fermat" would either fix or disable those magma tests.  I would look into fixing them myself but I don't have access to magma as far as I know :)


---

Comment by chapoton created at 2018-09-13 11:31:26

I already fixed one of those, but there will remain two of them.


---

Comment by embray created at 2018-09-13 11:33:24

Well, that's progress at least :)


---

Comment by embray created at 2018-09-13 11:34:18

I restarted my Ubuntu patchbot.  Apparently it hasn't done anything in 10 days, and it's not at all clear why it stalled :(


---

Comment by chapoton created at 2018-09-13 14:36:07

One fully green bot. I think this is good to go. Thanks a lot.


---

Comment by chapoton created at 2018-09-13 14:36:07

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-09-14 20:26:46

Resolution: fixed
