# Issue 32432: Adding upper and lower Bruhat cones of M. Dyer to Coxeter groups

archive/issues_032432.json:
```json
{
    "body": "CC:  @tscrim\n\nKeywords: Coxeter groups, reflection groups, Bruhat order, Bruhat cones,\n\nTo a pair of elements x,y in a Coxeter group W one can associate two polyhedral cones. The 'upper bruhat cone' generated by all roots beta such that s_beta * x covers x and s_beta * x <= y and similarly the 'lower bruhat cone' generated by all beta sucht that y covers s_beta * y and x <= s_beta * y .\n\nThese cones were used in https://eudml.org/doc/174610 and https://arxiv.org/abs/2103.03715\n\nIssue created by migration from https://trac.sagemath.org/ticket/32669\n\n",
    "created_at": "2021-10-11T13:05:22Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Adding upper and lower Bruhat cones of M. Dyer to Coxeter groups",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32432",
    "user": "https://github.com/DennisJahn"
}
```
CC:  @tscrim

Keywords: Coxeter groups, reflection groups, Bruhat order, Bruhat cones,

To a pair of elements x,y in a Coxeter group W one can associate two polyhedral cones. The 'upper bruhat cone' generated by all roots beta such that s_beta * x covers x and s_beta * x <= y and similarly the 'lower bruhat cone' generated by all beta sucht that y covers s_beta * y and x <= s_beta * y .

These cones were used in https://eudml.org/doc/174610 and https://arxiv.org/abs/2103.03715

Issue created by migration from https://trac.sagemath.org/ticket/32669





---

archive/issue_comments_462092.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-13T09:43:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462092",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462093.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-13T11:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462093",
    "user": "https://github.com/DennisJahn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462094.json:
```json
{
    "body": "would examples with WeylGroup or CoxeterGroup work ?",
    "created_at": "2021-10-13T15:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462094",
    "user": "https://github.com/fchapoton"
}
```

would examples with WeylGroup or CoxeterGroup work ?



---

archive/issue_comments_462095.json:
```json
{
    "body": "The method reflection_to_positive_root() is used. As far as I saw neither WeylGroup nor CoxeterGroup has this method. WeylGroup has furthermore no method to obtain roots roots.",
    "created_at": "2021-10-14T07:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462095",
    "user": "https://github.com/DennisJahn"
}
```

The method reflection_to_positive_root() is used. As far as I saw neither WeylGroup nor CoxeterGroup has this method. WeylGroup has furthermore no method to obtain roots roots.



---

archive/issue_comments_462096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-14T07:40:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462096",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462097.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-14T13:36:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462097",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462098.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-15T07:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462098",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462099.json:
```json
{
    "body": "in Weyl Groups, there is \n\n```\nsrc/sage/categories/weyl_groups.py:        def reflection_to_root\n```\n",
    "created_at": "2021-10-15T07:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462099",
    "user": "https://github.com/fchapoton"
}
```

in Weyl Groups, there is 

```
src/sage/categories/weyl_groups.py:        def reflection_to_root
```




---

archive/issue_comments_462100.json:
```json
{
    "body": "I see. Then writing a similar method for Weyl Groups should be possible using reflection_to_root() and then to_ambient()",
    "created_at": "2021-10-15T08:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462100",
    "user": "https://github.com/DennisJahn"
}
```

I see. Then writing a similar method for Weyl Groups should be possible using reflection_to_root() and then to_ambient()



---

archive/issue_comments_462101.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-25T13:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462101",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-25T14:30:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462102",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462103.json:
```json
{
    "body": "Thank you for your contribuation. I have a rather long list of comments. Most of them are minor issues I think.\n\nA green bot unfortunatly only means that you added the optional tags correctly, as the bots don't have gap3 installed.\n\n- You should probably add your references from the ticket description.\n  As pointed in https://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style\nat `REFERENCES` and `ALGORITHM`.\n\n-\n\n```\n            wi = self.apply_simple_reflection(i, side = 'right')\n            return [(u.apply_simple_reflection(i, side='right'),r.apply_conjugation_by_simple_reflection(i)) for u,r in wi.bruhat_lower_covers_reflections() if not u.has_descent(i, side='right')] + [(wi, self.parent().simple_reflection(i))]\n```\n\n  Those lines need some work. `side='right` is a keyword and should therefore not contain spaces.\n  The second line is way to long and should be wrapped according to PEP8.\n  We are not ultra stright with 79 characters, but it is still good to keep it at that.\n  Also it is impossible to understand what this line does like this. So I would propose:\n\n```\n            wi = self.apply_simple_reflection(i, side='right')\n            return [(u.apply_simple_reflection(i, side='right'),\n                     r.apply_conjugation_by_simple_reflection(i))\n                    for u, r in wi.bruhat_lower_covers_reflections()\n                    if not u.has_descent(i, side='right')] + [\n                (wi, self.parent().simple_reflection(i))]\n```\n\n  Yes, I know that you did not introduce this ultra-long line, but it is still good to fix it, when touching.\n- From the ticket I gather that your changes in `coxeter_group.py` are motivated by a bug. Can you please add a test to `CoxeterGroups` that illustrates what has been fixed now. Something:\n\n```\nTESTS:\n\nCheck bug discovered in :trac:`32669` is fixed:\n\n    sage: 2 + 2\n    4\n```\n\n- The description on `bruhat_cone` is hard to read. The first line should just be a brief sentence describing what the function does. No need to contain all definitions.\n- This should be reworked:\n\n```diff\n+        For ``side`` = ``'upper'``: ``s_beta`` ``x`` covers ``x`` and ``x`` <= ``s_beta`` ``x`` <= ``y``.\n+\n+        For ``side`` = ``'lower'``: ``y`` covers ``s_beta`` ``y`` and ``x`` <= ``s_beta`` ``y`` <= ``y``.\n```\n\n  I don't know what it means. What are those things called: `Upper Bruhat cone` and `Lower Bruhat cone`? If you just call them by names, that already makes the start easier to read. You know you can also use latex in the docstring. Maybe this makes it easier to read:\nhttps://doc.sagemath.org/html/en/developer/coding_basics.html#section-latex-typeset\n- The input `x` and `y` needs to be explained.\n- Your doctests do not pass:\n\n```\nFile \"src/sage/combinat/root_system/reflection_group_real.py\", line 732, in sage.combinat.root_system.reflection_group_real.RealReflectionGroup.bruhat_cone\nFailed example:\n    W.bruhat_cone(x, y)                                   # optional - gap3\nExpected:\n    A 2-dimensional polyhedron in ZZ^2 defined as the convex hull of 1 vertex and 2 rays\nGot:\n    A 2-dimensional polyhedron in QQ^2 defined as the convex hull of 1 vertex and 2 rays\n**********************************************************************\nFile \"src/sage/combinat/root_system/reflection_group_real.py\", line 738, in sage.combinat.root_system.reflection_group_real.RealReflectionGroup.bruhat_cone\nFailed example:\n    W.bruhat_cone(x, y, side = 'lower')                   # optional - gap3\nExpected:\n    A 6-dimensional polyhedron in ZZ^6 defined as the convex hull of 1 vertex and 6 rays\nGot:\n    A 6-dimensional polyhedron in QQ^6 defined as the convex hull of 1 vertex and 6 rays\n```\n\n\nThere are also other failing doctests discovered, because people apparently do not test `gap3` at all:\n\n```\nFile \"src/sage/combinat/root_system/reflection_group_element.pyx\", line 72, in sage.combinat.root_system.reflection_group_element.ComplexReflectionGroupElement.__hash__\nFailed example:\n    WB_hash.intersection(WC_hash)                     # optional - gap3\nExpected:\n    set()\nGot:\n    {-9126606217563690753,\n     -9111617679337390865,\n     -9021783181305004801,\n     -9008457096590967825,\n     -8825287278071369473,\n     -8737678173820754961,\n     -8665277549911544081,\n     -8446633060280535041,\n     -8323654867644563729,\n     -8124071536798024977,\n     -8116295769124982033,\n     -8108062643194285329,\n     -8049278353572089345,\n     -8046023783577836817,\n     -8045847864374923025,\n     -8042003968497354753,\n     -7957288799848911889,\n     ...\n```\n\n  However, you did not cause this I think. If we don't fix them here (which definitely needs not to happen), which should open a ticket for them.\n  Likewise `src/sage/categories/coxeter_groups.py` does not pass:\n\n```\n$ sage -t --long --optional=build,debian,dochtml,e_antic,normaliz,pip,pynormaliz,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg,gap3 src/sage/categories/coxeter_groups.py \ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-11-22-12-29-31-05e09ddd.\nGit branch: test_32669\nUsing --optional=build,debian,dochtml,e_antic,gap3,normaliz,pip,pynormaliz,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg\nDoctesting 1 file.\nsage -t --long --random-seed=289954757401290987674537126910226284546 src/sage/categories/coxeter_groups.py\n**********************************************************************\nFile \"src/sage/categories/coxeter_groups.py\", line 240, in sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_group_as_finitely_presented_group\nFailed example:\n    W.braid_group_as_finitely_presented_group()            # optional - gap3\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5998)\n        return self.cache[k]\n      File \"sage/misc/weak_dict.pyx\", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3752)\n        raise KeyError(k)\n    KeyError: ((<class 'sage.combinat.root_system.type_relabel.CartanType'>, ['B', 3], Finite family {1: 5, 2: 'BB', 3: 'AA'}), ())\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_group_as_finitely_presented_group[5]>\", line 1, in <module>\n        W.braid_group_as_finitely_presented_group()            # optional - gap3\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py\", line 251, in braid_group_as_finitely_presented_group\n        rels = self.braid_relations()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)\n        self.cache = f(self._instance)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_complex.py\", line 1392, in braid_relations\n        return super(ComplexReflectionGroup,self).braid_relations()\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py\", line 215, in braid_relations\n        M = self.coxeter_matrix()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)\n        self.cache = f(self._instance)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py\", line 639, in coxeter_matrix\n        return self.cartan_type().coxeter_matrix()\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py\", line 430, in cartan_type\n        return C.relabel(CG.is_isomorphic(G, edge_labels=True, certificate=True)[1])\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/cartan_type.py\", line 1236, in relabel\n        return type_relabel.CartanType(self, relabelling)\n      File \"sage/misc/classcall_metaclass.pyx\", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1779)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py\", line 57, in __classcall__\n        return super(CartanType, cls).__classcall__(cls, type, relabelling)\n      File \"sage/misc/cachefunc.pyx\", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6126)\n        w = self.f(*args, **kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/structure/unique_representation.py\", line 1007, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 482, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2243)\n        return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py\", line 179, in __init__\n        self._index_set = tuple(sorted(relabelling[i] for i in type.index_set()))\n    TypeError: '<' not supported between instances of 'str' and 'int'\n**********************************************************************\nFile \"src/sage/categories/coxeter_groups.py\", line 288, in sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_orbit\nFailed example:\n    W.braid_orbit(w.reduced_word())                        # optional - gap3\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5998)\n        return self.cache[k]\n      File \"sage/misc/weak_dict.pyx\", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3752)\n        raise KeyError(k)\n    KeyError: ((<class 'sage.combinat.root_system.type_relabel.CartanType'>, ['A', 3], Finite family {1: 'AA', 2: 'BB', 3: 5}), ())\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_orbit[8]>\", line 1, in <module>\n        W.braid_orbit(w.reduced_word())                        # optional - gap3\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py\", line 318, in braid_orbit\n        braid_rels = self.braid_relations()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)\n        self.cache = f(self._instance)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_complex.py\", line 1392, in braid_relations\n        return super(ComplexReflectionGroup,self).braid_relations()\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py\", line 215, in braid_relations\n        M = self.coxeter_matrix()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)\n        self.cache = f(self._instance)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py\", line 639, in coxeter_matrix\n        return self.cartan_type().coxeter_matrix()\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py\", line 430, in cartan_type\n        return C.relabel(CG.is_isomorphic(G, edge_labels=True, certificate=True)[1])\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/cartan_type.py\", line 1236, in relabel\n        return type_relabel.CartanType(self, relabelling)\n      File \"sage/misc/classcall_metaclass.pyx\", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1779)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py\", line 57, in __classcall__\n        return super(CartanType, cls).__classcall__(cls, type, relabelling)\n      File \"sage/misc/cachefunc.pyx\", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6126)\n        w = self.f(*args, **kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/structure/unique_representation.py\", line 1007, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 482, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2243)\n        return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py\", line 179, in __init__\n        self._index_set = tuple(sorted(relabelling[i] for i in type.index_set()))\n    TypeError: '<' not supported between instances of 'int' and 'str'\n**********************************************************************\nFile \"src/sage/categories/coxeter_groups.py\", line 1538, in sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.reduced_words\nFailed example:\n    w.reduced_words()                                      # optional - gap3\nException raised:\n    Traceback (most recent call last):\n      File \"sage/misc/cachefunc.pyx\", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5998)\n        return self.cache[k]\n      File \"sage/misc/weak_dict.pyx\", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3752)\n        raise KeyError(k)\n    KeyError: ((<class 'sage.combinat.root_system.type_relabel.CartanType'>, ['A', 3], Finite family {1: 'AA', 2: 'BB', 3: 5}), ())\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.reduced_words[9]>\", line 1, in <module>\n        w.reduced_words()                                      # optional - gap3\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py\", line 1566, in reduced_words\n        return self.parent().braid_orbit(self.reduced_word())\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py\", line 318, in braid_orbit\n        braid_rels = self.braid_relations()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)\n        self.cache = f(self._instance)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_complex.py\", line 1392, in braid_relations\n        return super(ComplexReflectionGroup,self).braid_relations()\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py\", line 215, in braid_relations\n        M = self.coxeter_matrix()\n      File \"sage/misc/cachefunc.pyx\", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)\n        self.cache = f(self._instance)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py\", line 639, in coxeter_matrix\n        return self.cartan_type().coxeter_matrix()\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py\", line 430, in cartan_type\n        return C.relabel(CG.is_isomorphic(G, edge_labels=True, certificate=True)[1])\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/cartan_type.py\", line 1236, in relabel\n        return type_relabel.CartanType(self, relabelling)\n      File \"sage/misc/classcall_metaclass.pyx\", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1779)\n        return cls.classcall(cls, *args, **kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py\", line 57, in __classcall__\n        return super(CartanType, cls).__classcall__(cls, type, relabelling)\n      File \"sage/misc/cachefunc.pyx\", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6126)\n        w = self.f(*args, **kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/structure/unique_representation.py\", line 1007, in __classcall__\n        instance = typecall(cls, *args, **options)\n      File \"sage/misc/classcall_metaclass.pyx\", line 482, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2243)\n        return (<PyTypeObject*>type).tp_call(cls, args, kwds)\n      File \"/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py\", line 179, in __init__\n        self._index_set = tuple(sorted(relabelling[i] for i in type.index_set()))\n    TypeError: '<' not supported between instances of 'int' and 'str'\n**********************************************************************\n3 items had failures:\n   1 of  11 in sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.reduced_words\n   1 of   7 in sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_group_as_finitely_presented_group\n   1 of  10 in sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_orbit\n    [504 tests, 3 failures, 5.61 s]\n```\n\n- It would be good to have doctests that illustrate some actual properties. E.g. you could illustrate the definition.\n- In your actual code there are also some very long lines. They could also be wrapped. E.g.:\n\n```diff\n-            roots = [self.reflection_to_positive_root(x*r*x.inverse()) for z, r in x.bruhat_upper_covers_reflections() if z.bruhat_le(y)]\n+            roots = [self.reflection_to_positive_root(x * r * x.inverse())\n+                     for z, r in x.bruhat_upper_covers_reflections()\n+                     if z.bruhat_le(y)]\n```\n\n- After the `ValueError` there could be an empty line. Likewise an empty line would make sense after `from sage.rings.qqbar import AA as base_ring`, because this is when the `if ... else` is over.",
    "created_at": "2021-11-22T11:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462103",
    "user": "https://github.com/kliem"
}
```

Thank you for your contribuation. I have a rather long list of comments. Most of them are minor issues I think.

A green bot unfortunatly only means that you added the optional tags correctly, as the bots don't have gap3 installed.

- You should probably add your references from the ticket description.
  As pointed in https://doc.sagemath.org/html/en/developer/coding_basics.html#python-code-style
at `REFERENCES` and `ALGORITHM`.

-

```
            wi = self.apply_simple_reflection(i, side = 'right')
            return [(u.apply_simple_reflection(i, side='right'),r.apply_conjugation_by_simple_reflection(i)) for u,r in wi.bruhat_lower_covers_reflections() if not u.has_descent(i, side='right')] + [(wi, self.parent().simple_reflection(i))]
```

  Those lines need some work. `side='right` is a keyword and should therefore not contain spaces.
  The second line is way to long and should be wrapped according to PEP8.
  We are not ultra stright with 79 characters, but it is still good to keep it at that.
  Also it is impossible to understand what this line does like this. So I would propose:

```
            wi = self.apply_simple_reflection(i, side='right')
            return [(u.apply_simple_reflection(i, side='right'),
                     r.apply_conjugation_by_simple_reflection(i))
                    for u, r in wi.bruhat_lower_covers_reflections()
                    if not u.has_descent(i, side='right')] + [
                (wi, self.parent().simple_reflection(i))]
```

  Yes, I know that you did not introduce this ultra-long line, but it is still good to fix it, when touching.
- From the ticket I gather that your changes in `coxeter_group.py` are motivated by a bug. Can you please add a test to `CoxeterGroups` that illustrates what has been fixed now. Something:

```
TESTS:

Check bug discovered in :trac:`32669` is fixed:

    sage: 2 + 2
    4
```

- The description on `bruhat_cone` is hard to read. The first line should just be a brief sentence describing what the function does. No need to contain all definitions.
- This should be reworked:

```diff
+        For ``side`` = ``'upper'``: ``s_beta`` ``x`` covers ``x`` and ``x`` <= ``s_beta`` ``x`` <= ``y``.
+
+        For ``side`` = ``'lower'``: ``y`` covers ``s_beta`` ``y`` and ``x`` <= ``s_beta`` ``y`` <= ``y``.
```

  I don't know what it means. What are those things called: `Upper Bruhat cone` and `Lower Bruhat cone`? If you just call them by names, that already makes the start easier to read. You know you can also use latex in the docstring. Maybe this makes it easier to read:
https://doc.sagemath.org/html/en/developer/coding_basics.html#section-latex-typeset
- The input `x` and `y` needs to be explained.
- Your doctests do not pass:

```
File "src/sage/combinat/root_system/reflection_group_real.py", line 732, in sage.combinat.root_system.reflection_group_real.RealReflectionGroup.bruhat_cone
Failed example:
    W.bruhat_cone(x, y)                                   # optional - gap3
Expected:
    A 2-dimensional polyhedron in ZZ^2 defined as the convex hull of 1 vertex and 2 rays
Got:
    A 2-dimensional polyhedron in QQ^2 defined as the convex hull of 1 vertex and 2 rays
**********************************************************************
File "src/sage/combinat/root_system/reflection_group_real.py", line 738, in sage.combinat.root_system.reflection_group_real.RealReflectionGroup.bruhat_cone
Failed example:
    W.bruhat_cone(x, y, side = 'lower')                   # optional - gap3
Expected:
    A 6-dimensional polyhedron in ZZ^6 defined as the convex hull of 1 vertex and 6 rays
Got:
    A 6-dimensional polyhedron in QQ^6 defined as the convex hull of 1 vertex and 6 rays
```


There are also other failing doctests discovered, because people apparently do not test `gap3` at all:

```
File "src/sage/combinat/root_system/reflection_group_element.pyx", line 72, in sage.combinat.root_system.reflection_group_element.ComplexReflectionGroupElement.__hash__
Failed example:
    WB_hash.intersection(WC_hash)                     # optional - gap3
Expected:
    set()
Got:
    {-9126606217563690753,
     -9111617679337390865,
     -9021783181305004801,
     -9008457096590967825,
     -8825287278071369473,
     -8737678173820754961,
     -8665277549911544081,
     -8446633060280535041,
     -8323654867644563729,
     -8124071536798024977,
     -8116295769124982033,
     -8108062643194285329,
     -8049278353572089345,
     -8046023783577836817,
     -8045847864374923025,
     -8042003968497354753,
     -7957288799848911889,
     ...
```

  However, you did not cause this I think. If we don't fix them here (which definitely needs not to happen), which should open a ticket for them.
  Likewise `src/sage/categories/coxeter_groups.py` does not pass:

```
$ sage -t --long --optional=build,debian,dochtml,e_antic,normaliz,pip,pynormaliz,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg,gap3 src/sage/categories/coxeter_groups.py 
too many failed tests, not using stored timings
Running doctests with ID 2021-11-22-12-29-31-05e09ddd.
Git branch: test_32669
Using --optional=build,debian,dochtml,e_antic,gap3,normaliz,pip,pynormaliz,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg
Doctesting 1 file.
sage -t --long --random-seed=289954757401290987674537126910226284546 src/sage/categories/coxeter_groups.py
**********************************************************************
File "src/sage/categories/coxeter_groups.py", line 240, in sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_group_as_finitely_presented_group
Failed example:
    W.braid_group_as_finitely_presented_group()            # optional - gap3
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5998)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3752)
        raise KeyError(k)
    KeyError: ((<class 'sage.combinat.root_system.type_relabel.CartanType'>, ['B', 3], Finite family {1: 5, 2: 'BB', 3: 'AA'}), ())

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_group_as_finitely_presented_group[5]>", line 1, in <module>
        W.braid_group_as_finitely_presented_group()            # optional - gap3
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py", line 251, in braid_group_as_finitely_presented_group
        rels = self.braid_relations()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)
        self.cache = f(self._instance)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_complex.py", line 1392, in braid_relations
        return super(ComplexReflectionGroup,self).braid_relations()
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py", line 215, in braid_relations
        M = self.coxeter_matrix()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)
        self.cache = f(self._instance)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py", line 639, in coxeter_matrix
        return self.cartan_type().coxeter_matrix()
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py", line 430, in cartan_type
        return C.relabel(CG.is_isomorphic(G, edge_labels=True, certificate=True)[1])
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/cartan_type.py", line 1236, in relabel
        return type_relabel.CartanType(self, relabelling)
      File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1779)
        return cls.classcall(cls, *args, **kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py", line 57, in __classcall__
        return super(CartanType, cls).__classcall__(cls, type, relabelling)
      File "sage/misc/cachefunc.pyx", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6126)
        w = self.f(*args, **kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/structure/unique_representation.py", line 1007, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 482, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2243)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py", line 179, in __init__
        self._index_set = tuple(sorted(relabelling[i] for i in type.index_set()))
    TypeError: '<' not supported between instances of 'str' and 'int'
**********************************************************************
File "src/sage/categories/coxeter_groups.py", line 288, in sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_orbit
Failed example:
    W.braid_orbit(w.reduced_word())                        # optional - gap3
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5998)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3752)
        raise KeyError(k)
    KeyError: ((<class 'sage.combinat.root_system.type_relabel.CartanType'>, ['A', 3], Finite family {1: 'AA', 2: 'BB', 3: 5}), ())

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_orbit[8]>", line 1, in <module>
        W.braid_orbit(w.reduced_word())                        # optional - gap3
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py", line 318, in braid_orbit
        braid_rels = self.braid_relations()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)
        self.cache = f(self._instance)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_complex.py", line 1392, in braid_relations
        return super(ComplexReflectionGroup,self).braid_relations()
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py", line 215, in braid_relations
        M = self.coxeter_matrix()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)
        self.cache = f(self._instance)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py", line 639, in coxeter_matrix
        return self.cartan_type().coxeter_matrix()
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py", line 430, in cartan_type
        return C.relabel(CG.is_isomorphic(G, edge_labels=True, certificate=True)[1])
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/cartan_type.py", line 1236, in relabel
        return type_relabel.CartanType(self, relabelling)
      File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1779)
        return cls.classcall(cls, *args, **kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py", line 57, in __classcall__
        return super(CartanType, cls).__classcall__(cls, type, relabelling)
      File "sage/misc/cachefunc.pyx", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6126)
        w = self.f(*args, **kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/structure/unique_representation.py", line 1007, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 482, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2243)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py", line 179, in __init__
        self._index_set = tuple(sorted(relabelling[i] for i in type.index_set()))
    TypeError: '<' not supported between instances of 'int' and 'str'
**********************************************************************
File "src/sage/categories/coxeter_groups.py", line 1538, in sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.reduced_words
Failed example:
    w.reduced_words()                                      # optional - gap3
Exception raised:
    Traceback (most recent call last):
      File "sage/misc/cachefunc.pyx", line 996, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:5998)
        return self.cache[k]
      File "sage/misc/weak_dict.pyx", line 704, in sage.misc.weak_dict.WeakValueDictionary.__getitem__ (build/cythonized/sage/misc/weak_dict.c:3752)
        raise KeyError(k)
    KeyError: ((<class 'sage.combinat.root_system.type_relabel.CartanType'>, ['A', 3], Finite family {1: 'AA', 2: 'BB', 3: 5}), ())

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.reduced_words[9]>", line 1, in <module>
        w.reduced_words()                                      # optional - gap3
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py", line 1566, in reduced_words
        return self.parent().braid_orbit(self.reduced_word())
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py", line 318, in braid_orbit
        braid_rels = self.braid_relations()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)
        self.cache = f(self._instance)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_complex.py", line 1392, in braid_relations
        return super(ComplexReflectionGroup,self).braid_relations()
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/categories/coxeter_groups.py", line 215, in braid_relations
        M = self.coxeter_matrix()
      File "sage/misc/cachefunc.pyx", line 2310, in sage.misc.cachefunc.CachedMethodCallerNoArgs.__call__ (build/cythonized/sage/misc/cachefunc.c:12957)
        self.cache = f(self._instance)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py", line 639, in coxeter_matrix
        return self.cartan_type().coxeter_matrix()
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/reflection_group_real.py", line 430, in cartan_type
        return C.relabel(CG.is_isomorphic(G, edge_labels=True, certificate=True)[1])
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/cartan_type.py", line 1236, in relabel
        return type_relabel.CartanType(self, relabelling)
      File "sage/misc/classcall_metaclass.pyx", line 320, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1779)
        return cls.classcall(cls, *args, **kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py", line 57, in __classcall__
        return super(CartanType, cls).__classcall__(cls, type, relabelling)
      File "sage/misc/cachefunc.pyx", line 1001, in sage.misc.cachefunc.CachedFunction.__call__ (build/cythonized/sage/misc/cachefunc.c:6126)
        w = self.f(*args, **kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/structure/unique_representation.py", line 1007, in __classcall__
        instance = typecall(cls, *args, **options)
      File "sage/misc/classcall_metaclass.pyx", line 482, in sage.misc.classcall_metaclass.typecall (build/cythonized/sage/misc/classcall_metaclass.c:2243)
        return (<PyTypeObject*>type).tp_call(cls, args, kwds)
      File "/srv/public/kliem/sage/local/var/lib/sage/venv-python3.7/lib/python3.7/site-packages/sage/combinat/root_system/type_relabel.py", line 179, in __init__
        self._index_set = tuple(sorted(relabelling[i] for i in type.index_set()))
    TypeError: '<' not supported between instances of 'int' and 'str'
**********************************************************************
3 items had failures:
   1 of  11 in sage.categories.coxeter_groups.CoxeterGroups.ElementMethods.reduced_words
   1 of   7 in sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_group_as_finitely_presented_group
   1 of  10 in sage.categories.coxeter_groups.CoxeterGroups.ParentMethods.braid_orbit
    [504 tests, 3 failures, 5.61 s]
```

- It would be good to have doctests that illustrate some actual properties. E.g. you could illustrate the definition.
- In your actual code there are also some very long lines. They could also be wrapped. E.g.:

```diff
-            roots = [self.reflection_to_positive_root(x*r*x.inverse()) for z, r in x.bruhat_upper_covers_reflections() if z.bruhat_le(y)]
+            roots = [self.reflection_to_positive_root(x * r * x.inverse())
+                     for z, r in x.bruhat_upper_covers_reflections()
+                     if z.bruhat_le(y)]
```

- After the `ValueError` there could be an empty line. Likewise an empty line would make sense after `from sage.rings.qqbar import AA as base_ring`, because this is when the `if ... else` is over.



---

archive/issue_comments_462104.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-23T12:29:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462104",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462105.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-23T12:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462105",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462106.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-24T12:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462106",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462107.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-24T13:41:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462107",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462108.json:
```json
{
    "body": "Replying to [comment:14 gh-kliem]:\n\nThank you very much for your detailed feedback.\n\n> * You should probably add your references from the ticket description.\n\nI added the references.\n\n> * Those lines need some work.\n> * The second line is way to long and should be wrapped according to PEP8.\n> * Also it is impossible to understand what this line does like this.\n\nI changed the lines according to your suggestions.\n\n> * From the ticket I gather that your changes in `coxeter_groups.py` are motivated by a bug. Can you please add a test to `CoxeterGroups` that illustrates what has been fixed now.\n\nI added a test. The bug did only occur for the permutation implementation, so the test is only for this implementation.\n\n> * The description on `bruhat_cone` is hard to read.\n\nThere now is a new description using latex but I'm not sure if this description would be better in an `ALGORITHM` section.\n\n> * Your doctests do not pass:\n\nThey should pass now.\n\n> * There are also other failing doctests discovered, because people apparently do not test `gap3` at all.\n\nI would prefer opening a new ticket for this. \n\n> * In your actual code there are also some very long lines.\n\nI wrapped them and added the suggested empty lines.",
    "created_at": "2021-11-24T14:05:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462108",
    "user": "https://github.com/DennisJahn"
}
```

Replying to [comment:14 gh-kliem]:

Thank you very much for your detailed feedback.

> * You should probably add your references from the ticket description.

I added the references.

> * Those lines need some work.
> * The second line is way to long and should be wrapped according to PEP8.
> * Also it is impossible to understand what this line does like this.

I changed the lines according to your suggestions.

> * From the ticket I gather that your changes in `coxeter_groups.py` are motivated by a bug. Can you please add a test to `CoxeterGroups` that illustrates what has been fixed now.

I added a test. The bug did only occur for the permutation implementation, so the test is only for this implementation.

> * The description on `bruhat_cone` is hard to read.

There now is a new description using latex but I'm not sure if this description would be better in an `ALGORITHM` section.

> * Your doctests do not pass:

They should pass now.

> * There are also other failing doctests discovered, because people apparently do not test `gap3` at all.

I would prefer opening a new ticket for this. 

> * In your actual code there are also some very long lines.

I wrapped them and added the suggested empty lines.



---

archive/issue_comments_462109.json:
```json
{
    "body": "`Tests:` should be `TESTS:`\n\nfor arxiv, use the arxiv role, namely `:arxiv:`2103.03715``\n\nthe new `raise` must have a doctest\n\nThe `else` here is superfluous :\n\n```\n+        else:\n+            if backend == 'cdd':\n```\n\nRemoving it would allow to indent the code less",
    "created_at": "2021-11-26T07:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462109",
    "user": "https://github.com/fchapoton"
}
```

`Tests:` should be `TESTS:`

for arxiv, use the arxiv role, namely `:arxiv:`2103.03715``

the new `raise` must have a doctest

The `else` here is superfluous :

```
+        else:
+            if backend == 'cdd':
```

Removing it would allow to indent the code less



---

archive/issue_comments_462110.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-26T10:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462111.json:
```json
{
    "body": "Replying to [comment:20 chapoton]:\n> `Tests:` should be `TESTS:`\n> \n> for arxiv, use the arxiv role, namely `:arxiv:`2103.03715``\n> \n> the new `raise` must have a doctest\n> \n> The `else` here is superfluous :\n> {{{\n> +        else:\n> +            if backend == 'cdd':\n> }}}\n> Removing it would allow to indent the code less\n\nThanks!\nI changed/added the parts according to your comment.\nThe local doctests for `reflection_group_real.py` including `gap3` passed.",
    "created_at": "2021-11-26T11:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462111",
    "user": "https://github.com/DennisJahn"
}
```

Replying to [comment:20 chapoton]:
> `Tests:` should be `TESTS:`
> 
> for arxiv, use the arxiv role, namely `:arxiv:`2103.03715``
> 
> the new `raise` must have a doctest
> 
> The `else` here is superfluous :
> {{{
> +        else:
> +            if backend == 'cdd':
> }}}
> Removing it would allow to indent the code less

Thanks!
I changed/added the parts according to your comment.
The local doctests for `reflection_group_real.py` including `gap3` passed.



---

archive/issue_comments_462112.json:
```json
{
    "body": "the new tests for raise are not indented correctly",
    "created_at": "2021-11-26T14:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462112",
    "user": "https://github.com/fchapoton"
}
```

the new tests for raise are not indented correctly



---

archive/issue_comments_462113.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-26T19:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462114.json:
```json
{
    "body": "Replying to [comment:23 chapoton]:\n> the new tests for raise are not indented correctly\n\nYou are correct, I completely missed that.",
    "created_at": "2021-11-26T19:10:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462114",
    "user": "https://github.com/DennisJahn"
}
```

Replying to [comment:23 chapoton]:
> the new tests for raise are not indented correctly

You are correct, I completely missed that.



---

archive/issue_comments_462115.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-29T09:11:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462115",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462116.json:
```json
{
    "body": "typo in *cooresponding* (at least twice)",
    "created_at": "2021-11-29T20:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462116",
    "user": "https://github.com/fchapoton"
}
```

typo in *cooresponding* (at least twice)



---

archive/issue_comments_462117.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-11-30T09:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462117",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462118.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-03T08:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462118",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462119.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-18T14:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462119",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_462120.json:
```json
{
    "body": "red branch, so needs a rebase => needs_work status",
    "created_at": "2022-03-18T14:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462120",
    "user": "https://github.com/fchapoton"
}
```

red branch, so needs a rebase => needs_work status



---

archive/issue_comments_462121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-03-22T12:43:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462121",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_462122.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-03-23T11:56:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_462123.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-24T10:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462123",
    "user": "https://github.com/DennisJahn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_462124.json:
```json
{
    "body": "I did a rebase but I'm not really sure if I did it correctly.\nThere are three doctests failing but they are on methods I didn't touch.\n\nSetting it back to *needs_review* for comments and (maybe) a review.",
    "created_at": "2022-03-24T10:24:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462124",
    "user": "https://github.com/DennisJahn"
}
```

I did a rebase but I'm not really sure if I did it correctly.
There are three doctests failing but they are on methods I didn't touch.

Setting it back to *needs_review* for comments and (maybe) a review.



---

archive/issue_comments_462125.json:
```json
{
    "body": "Your branch is a little mess, with too many commits. I would suggest to start a new branch afresh. Please just copy-paste your changes atop the latest develop, so that there is only one commit.\n\nI am also not so sure about the \"bug\" in Coxeter groups. Travis, any opinion ?\n\nAnd you should rather add doctests not depending on the gap3 package too.",
    "created_at": "2022-04-12T06:39:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462125",
    "user": "https://github.com/fchapoton"
}
```

Your branch is a little mess, with too many commits. I would suggest to start a new branch afresh. Please just copy-paste your changes atop the latest develop, so that there is only one commit.

I am also not so sure about the "bug" in Coxeter groups. Travis, any opinion ?

And you should rather add doctests not depending on the gap3 package too.



---

archive/issue_comments_462126.json:
```json
{
    "body": "It may be a good idea to add an alias\n\n```\nreflection_to_positive_root = reflection_to_root\n```\n\nin\n\n```\nsrc/sage/categories/weyl_groups.py\n```\n",
    "created_at": "2022-04-12T07:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462126",
    "user": "https://github.com/fchapoton"
}
```

It may be a good idea to add an alias

```
reflection_to_positive_root = reflection_to_root
```

in

```
src/sage/categories/weyl_groups.py
```




---

archive/issue_comments_462127.json:
```json
{
    "body": "I also think we should not use `gap3` for the doctests. There are plenty of other implementations available.\n\nThe \u201cbug\u201d should be on a separate ticket, but I don\u2019t know if it is a bug. Nevertheless, it is likely an improvement because we should be explicit about the side (although it should be consistent).",
    "created_at": "2022-04-12T15:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462127",
    "user": "https://github.com/tscrim"
}
```

I also think we should not use `gap3` for the doctests. There are plenty of other implementations available.

The “bug” should be on a separate ticket, but I don’t know if it is a bug. Nevertheless, it is likely an improvement because we should be explicit about the side (although it should be consistent).



---

archive/issue_comments_462128.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-13T11:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462129.json:
```json
{
    "body": "Replying to [comment:36 chapoton]:\n> Your branch is a little mess, with too many commits. I would suggest to start a new branch afresh. Please just copy-paste your changes atop the latest develop, so that there is only one commit.\n\nI hope this worked.\n \n> I am also not so sure about the \"bug\" in Coxeter groups. Travis, any opinion ?\n\nThe bug only appeared using the *permutation* implementation. If you run the new doctest with the old function you should see the problem.\n\n> And you should rather add doctests not depending on the gap3 package too.\n\nI'm confused about that. The implementation of ReflectionGroup in reflection_group_real.py heavily depends on gap3 and cannot be used without it. Why should there be doctests without gap3? Is this even possible?",
    "created_at": "2022-04-13T11:38:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462129",
    "user": "https://github.com/DennisJahn"
}
```

Replying to [comment:36 chapoton]:
> Your branch is a little mess, with too many commits. I would suggest to start a new branch afresh. Please just copy-paste your changes atop the latest develop, so that there is only one commit.

I hope this worked.
 
> I am also not so sure about the "bug" in Coxeter groups. Travis, any opinion ?

The bug only appeared using the *permutation* implementation. If you run the new doctest with the old function you should see the problem.

> And you should rather add doctests not depending on the gap3 package too.

I'm confused about that. The implementation of ReflectionGroup in reflection_group_real.py heavily depends on gap3 and cannot be used without it. Why should there be doctests without gap3? Is this even possible?



---

archive/issue_comments_462130.json:
```json
{
    "body": "Replying to [comment:40 gh-DennisJahn]:\n> Replying to [comment:36 chapoton]:\n> > Your branch is a little mess, with too many commits. I would suggest to start a new branch afresh. Please just copy-paste your changes atop the latest develop, so that there is only one commit.\n> \n> I hope this worked.\n\nNo. If you click on the word \"Commits\" here above, you will see that your branch is still made of very many commits. Maybe I was not clear enough in my suggestion ? Save outside of the the git repository of sage the current status (in your branch) of the 2 files that you have modified. Then use git to start a new branch on top of develop. Then copy back the modified files and commit. Then push here under a new branch name.\n\n> > And you should rather add doctests not depending on the gap3 package too.\n> \n> I'm confused about that. The implementation of ReflectionGroup in reflection_group_real.py heavily depends on gap3 and cannot be used without it. Why should there be doctests without gap3? Is this even possible?\n\nGap3 itself is no longer maintained, and it's rather miraculous that it still works and that one can use it for reflection groups in sage. Using comment:37, your code should work on Weyl groups and be doctested for them.",
    "created_at": "2022-04-13T12:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462130",
    "user": "https://github.com/fchapoton"
}
```

Replying to [comment:40 gh-DennisJahn]:
> Replying to [comment:36 chapoton]:
> > Your branch is a little mess, with too many commits. I would suggest to start a new branch afresh. Please just copy-paste your changes atop the latest develop, so that there is only one commit.
> 
> I hope this worked.

No. If you click on the word "Commits" here above, you will see that your branch is still made of very many commits. Maybe I was not clear enough in my suggestion ? Save outside of the the git repository of sage the current status (in your branch) of the 2 files that you have modified. Then use git to start a new branch on top of develop. Then copy back the modified files and commit. Then push here under a new branch name.

> > And you should rather add doctests not depending on the gap3 package too.
> 
> I'm confused about that. The implementation of ReflectionGroup in reflection_group_real.py heavily depends on gap3 and cannot be used without it. Why should there be doctests without gap3? Is this even possible?

Gap3 itself is no longer maintained, and it's rather miraculous that it still works and that one can use it for reflection groups in sage. Using comment:37, your code should work on Weyl groups and be doctested for them.



---

archive/issue_comments_462131.json:
```json
{
    "body": "Replying to [comment:41 chapoton]:\n> No. If you click on the word \"Commits\" here above, you will see that your branch is still made of very many commits. Maybe I was not clear enough in my suggestion ? Save outside of the the git repository of sage the current status (in your branch) of the 2 files that you have modified. Then use git to start a new branch on top of develop. Then copy back the modified files and commit. Then push here under a new branch name.\n\nI used 'git reset --hard develop' locally and pushed my modifications after that but that wasn't enough then. I'll try something else.\n \n> Gap3 itself is no longer maintained, and it's rather miraculous that it still works and that one can use it for reflection groups in sage. Using comment:37, your code should work on Weyl groups and be doctested for them.\n\nThe method bruhat_cone is already implemented for Weyl groups. That was done in #32710.\nThe purpose of this ticket is to implement it for reflection groups to also include non-crystallographic coxeter groups and further use the implementation for subword complexes in #32681.",
    "created_at": "2022-04-13T14:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462131",
    "user": "https://github.com/DennisJahn"
}
```

Replying to [comment:41 chapoton]:
> No. If you click on the word "Commits" here above, you will see that your branch is still made of very many commits. Maybe I was not clear enough in my suggestion ? Save outside of the the git repository of sage the current status (in your branch) of the 2 files that you have modified. Then use git to start a new branch on top of develop. Then copy back the modified files and commit. Then push here under a new branch name.

I used 'git reset --hard develop' locally and pushed my modifications after that but that wasn't enough then. I'll try something else.
 
> Gap3 itself is no longer maintained, and it's rather miraculous that it still works and that one can use it for reflection groups in sage. Using comment:37, your code should work on Weyl groups and be doctested for them.

The method bruhat_cone is already implemented for Weyl groups. That was done in #32710.
The purpose of this ticket is to implement it for reflection groups to also include non-crystallographic coxeter groups and further use the implementation for subword complexes in #32681.



---

archive/issue_comments_462132.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-14T07:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462132",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_462133.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-14T07:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462134.json:
```json
{
    "body": "Replying to [comment:42 gh-DennisJahn]:\n\n> I used 'git reset --hard develop' locally and pushed my modifications after that but that wasn't enough then. I'll try something else.\n\nNow it should have worked. There are only two entries in the list of commits, one for each modified file.",
    "created_at": "2022-04-14T07:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462134",
    "user": "https://github.com/DennisJahn"
}
```

Replying to [comment:42 gh-DennisJahn]:

> I used 'git reset --hard develop' locally and pushed my modifications after that but that wasn't enough then. I'll try something else.

Now it should have worked. There are only two entries in the list of commits, one for each modified file.



---

archive/issue_comments_462135.json:
```json
{
    "body": "thanks.\n\nNow, I see a lot of code duplication with the existing implementation in Weyl groups found in\n\n```\nsrc/sage/categories/weyl_groups.py\n```\n\n\nIn my opinion, it is desirable and should be possible to have only one common implementation.",
    "created_at": "2022-04-14T08:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462135",
    "user": "https://github.com/fchapoton"
}
```

thanks.

Now, I see a lot of code duplication with the existing implementation in Weyl groups found in

```
src/sage/categories/weyl_groups.py
```


In my opinion, it is desirable and should be possible to have only one common implementation.



---

archive/issue_comments_462136.json:
```json
{
    "body": "Replying to [comment:46 chapoton]:\n> thanks.\n> \n> Now, I see a lot of code duplication with the existing implementation in Weyl groups found in\n> {{{\n> src/sage/categories/weyl_groups.py\n> }}}\n> \n> In my opinion, it is desirable and should be possible to have only one common implementation.\n\nI would agree but I think we had this discussion already. I can' find it anymore though.\n\nThe only parent/super category in common is coxeter groups and there is no implementation of roots or the cartan matrix in there. Furthermore the implementation of roots in Weyl groups is very different from the one in reflection groups.\nIn Weyl groups their embedding depends on the degree of the group (A4 having 5, E6 and E8 having 8), while in reflection groups it depends on the rank.\n\nI currently have no idea how to combine these worlds.",
    "created_at": "2022-04-14T09:01:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462136",
    "user": "https://github.com/DennisJahn"
}
```

Replying to [comment:46 chapoton]:
> thanks.
> 
> Now, I see a lot of code duplication with the existing implementation in Weyl groups found in
> {{{
> src/sage/categories/weyl_groups.py
> }}}
> 
> In my opinion, it is desirable and should be possible to have only one common implementation.

I would agree but I think we had this discussion already. I can' find it anymore though.

The only parent/super category in common is coxeter groups and there is no implementation of roots or the cartan matrix in there. Furthermore the implementation of roots in Weyl groups is very different from the one in reflection groups.
In Weyl groups their embedding depends on the degree of the group (A4 having 5, E6 and E8 having 8), while in reflection groups it depends on the rank.

I currently have no idea how to combine these worlds.



---

archive/issue_comments_462137.json:
```json
{
    "body": "This is still done at the category level, so there should be some other implementation not relying on `gap3`, right?\n\nI don\u2019t understand the point you are making about the implementation of the roots. The data is well-defined and the root systems are isomorphic. I agree with `@`chapoton that we should have one common code that is agnostic to the choice of implementation. If things are not melding together properly, then we need to look at the code and unify it somehow.\n\nThen there is an issue with the permutation implementation about either its internal consistency or with the generic implementation that needs to be fixed. This would sweep the issue under the rug.",
    "created_at": "2022-04-16T17:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462137",
    "user": "https://github.com/tscrim"
}
```

This is still done at the category level, so there should be some other implementation not relying on `gap3`, right?

I don’t understand the point you are making about the implementation of the roots. The data is well-defined and the root systems are isomorphic. I agree with `@`chapoton that we should have one common code that is agnostic to the choice of implementation. If things are not melding together properly, then we need to look at the code and unify it somehow.

Then there is an issue with the permutation implementation about either its internal consistency or with the generic implementation that needs to be fixed. This would sweep the issue under the rug.



---

archive/issue_comments_462138.json:
```json
{
    "body": "Replying to [comment:48 tscrim]:\n> This is still done at the category level, so there should be some other implementation not relying on `gap3`, right?\n\nThe implementation for Weyl groups is done in\n\n```\nsrc/sage/categories/weyl_groups.py\n```\n\nat the category level, yes. \nThe implementation for this ticket is done in\n\n```\nsrc/sage/combinat/root_system/reflection_group_real.py\n```\n\nwhat is, if I understand correctly, not at the catagory level.\n\nFurthermore, I think, the only super category in common is CoxeterGroups. \nAnd for reflection groups this seems to be the case only sometimes?\nWhat I mean is that, depending on the input data, sometimes a reflection group is initialized as Coxeter group, but not always.\n\nSo my question/problem is: Where should an implementation of 'Bruhat cones' be done such that both, Weyl groups and reflection groups, can use it? \nWherever that is should be an existing implementation of roots that is compatible with the implementations used for Weyl groups and reflection groups. \n\n------\n\n> Then there is an issue with the permutation implementation about either its internal consistency or with the generic implementation that needs to be fixed. This would sweep the issue under the rug.\n\nI did not dive fully into this function. It wasn't working and all the other, similar functions used the side='right' flag. So I tried that and then it worked...",
    "created_at": "2022-04-19T08:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462138",
    "user": "https://github.com/DennisJahn"
}
```

Replying to [comment:48 tscrim]:
> This is still done at the category level, so there should be some other implementation not relying on `gap3`, right?

The implementation for Weyl groups is done in

```
src/sage/categories/weyl_groups.py
```

at the category level, yes. 
The implementation for this ticket is done in

```
src/sage/combinat/root_system/reflection_group_real.py
```

what is, if I understand correctly, not at the catagory level.

Furthermore, I think, the only super category in common is CoxeterGroups. 
And for reflection groups this seems to be the case only sometimes?
What I mean is that, depending on the input data, sometimes a reflection group is initialized as Coxeter group, but not always.

So my question/problem is: Where should an implementation of 'Bruhat cones' be done such that both, Weyl groups and reflection groups, can use it? 
Wherever that is should be an existing implementation of roots that is compatible with the implementations used for Weyl groups and reflection groups. 

------

> Then there is an issue with the permutation implementation about either its internal consistency or with the generic implementation that needs to be fixed. This would sweep the issue under the rug.

I did not dive fully into this function. It wasn't working and all the other, similar functions used the side='right' flag. So I tried that and then it worked...



---

archive/issue_comments_462139.json:
```json
{
    "body": "Dear Travis and Frederic, `@`tscrim, `@`chapoton:\n\nDennis is about to finish his thesis and I would like this code to go in! I do not understand your points that this should go into the category level because neither Coxeter groups (finite or not) or complex reflection groups there come with a root system attached. This code heavily uses root systems, so this is needed.\n\nWeylGroups have this at the category level, that's why it worked for these.\n\nBest,\nChristian",
    "created_at": "2022-09-12T10:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462139",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Dear Travis and Frederic, `@`tscrim, `@`chapoton:

Dennis is about to finish his thesis and I would like this code to go in! I do not understand your points that this should go into the category level because neither Coxeter groups (finite or not) or complex reflection groups there come with a root system attached. This code heavily uses root systems, so this is needed.

WeylGroups have this at the category level, that's why it worked for these.

Best,
Christian



---

archive/issue_comments_462140.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-12T11:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462140",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462141.json:
```json
{
    "body": "oh, well. Let's move on.\n\n\nLet me note that to still depend on gap3 in 2022 is a bit sad.",
    "created_at": "2022-09-12T11:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462141",
    "user": "https://github.com/fchapoton"
}
```

oh, well. Let's move on.


Let me note that to still depend on gap3 in 2022 is a bit sad.



---

archive/issue_comments_462142.json:
```json
{
    "body": "Thanks Frederic!\n\n> Let me note that to still depend on gap3 in 2022 is a bit sad.\n\nI agree, but Jean Michel is porting it to julia (https://github.com/jmichel7/Gapjm.jl). Once this is done, we can move there!",
    "created_at": "2022-09-12T12:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462142",
    "user": "https://trac.sagemath.org/admin/accounts/users/stumpc5"
}
```

Thanks Frederic!

> Let me note that to still depend on gap3 in 2022 is a bit sad.

I agree, but Jean Michel is porting it to julia (https://github.com/jmichel7/Gapjm.jl). Once this is done, we can move there!



---

archive/issue_comments_462143.json:
```json
{
    "body": "Well, this does not sound like really good news to me.",
    "created_at": "2022-09-12T12:53:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462143",
    "user": "https://github.com/fchapoton"
}
```

Well, this does not sound like really good news to me.



---

archive/issue_comments_462144.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-09-12T13:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462144",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_462145.json:
```json
{
    "body": "I just have some little doc things though before merging it in:\n\nPlease move the references to the master reference file and roughly follow the format there.\n\n\n```diff\n-        - ``x`` - an element in the group `W`\n-\n-        - ``y`` - an element in the group `W`\n-\n-        - ``side`` (default: ``'upper'``) -- must be one of the following:\n+        - ``x`` -- an element in the group `W`\n+        - ``y`` \u2014 an element in the group `W`\n+        - ``side`` \u2014 (default: ``'upper'``) must be one of the following:\n```\n",
    "created_at": "2022-09-12T13:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462145",
    "user": "https://github.com/tscrim"
}
```

I just have some little doc things though before merging it in:

Please move the references to the master reference file and roughly follow the format there.


```diff
-        - ``x`` - an element in the group `W`
-
-        - ``y`` - an element in the group `W`
-
-        - ``side`` (default: ``'upper'``) -- must be one of the following:
+        - ``x`` -- an element in the group `W`
+        - ``y`` — an element in the group `W`
+        - ``side`` — (default: ``'upper'``) must be one of the following:
```




---

archive/issue_comments_462146.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-13T07:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462147.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-09-13T07:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462147",
    "user": "https://github.com/DennisJahn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_462148.json:
```json
{
    "body": "Thank you.",
    "created_at": "2022-09-13T07:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462148",
    "user": "https://github.com/tscrim"
}
```

Thank you.



---

archive/issue_comments_462149.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-13T07:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462149",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462150.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-20T20:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32432",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32432#issuecomment-462150",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
