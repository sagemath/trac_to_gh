# Issue 26061: Add build/bin to path in bootstrap script

Issue created by migration from https://trac.sagemath.org/ticket/26298

Original creator: embray

Original creation time: 2018-09-17 11:23:51

`bootstrap` runs `build/bin/sage-download-file`, but since #18438 this has `sage-system-python` in its shebang line, which is not in the path by default.

This can be fixed by putting `$SAGE_ROOT/build/bin` explicitly on the `$PATH`.


---

Comment by embray created at 2018-09-17 11:26:11

New commits:


---

Comment by embray created at 2018-09-17 11:26:11

Changing status from new to needs_review.


---

Comment by vbraun created at 2018-09-23 12:48:22

Bootstrap still fails; I force download with

```
$ git clean -f -d -x
$ ./bootstrap -D
rm -rf config configure build/make/Makefile-auto.in
./bootstrap: line 61: sage-download-file: command not found
Error: downloading configure-282.tar.gz failed
```

The problem is that `SAGE_ROOT` isn't actually set to anything...

See also https://groups.google.com/d/msg/sage-devel/iCrymoWbWxo/AOeOKFEpCwAJ


---

Comment by embray created at 2018-09-24 14:09:31

Changing status from needs_review to needs_work.


---

Comment by embray created at 2018-09-24 14:09:31

D'oh, that is true.  I guess if SAGE_ROOT is not already set it should set SAGE_ROOT to the directory the script is in.


---

Comment by embray created at 2018-09-24 14:11:10

It occurs to me that at some point I exported SAGE_ROOT to my environment, so it still worked.


---

Comment by embray created at 2018-09-24 14:15:19

Hmm, no, that doesn't seem to be it either.  Even if I make sure SAGE_ROOT is not set and PATH is also clean, `./bootstrap -D` still works for me on this branch.


---

Comment by embray created at 2018-09-24 14:18:45

I see, `./bootstrap` _does_ eventually source `src/bin/sage-env`.  So why would it not work?


---

Comment by embray created at 2018-09-24 16:14:44

Oh, I guess at this point `src/bin/sage-env-config` is not generated yet, so you also have to make sure that is deleted.


---

Comment by git created at 2018-09-24 17:14:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-09-25 09:39:28

Changing status from needs_work to needs_review.


---

Comment by embray created at 2018-09-25 09:40:21

I'm still not wild about this, but I'm open to other ideas.  Maybe there's a simpler solution I'm not seeing.


---

Comment by mkoeppe created at 2018-09-27 19:15:57

Looks good to me, but perhaps it would make sense to simplify it by unconditionally setting SAGE_ROOT to the path of the script.


---

Comment by embray created at 2018-09-28 10:07:39

Replying to [comment:11 mkoeppe]:
> Looks good to me, but perhaps it would make sense to simplify it by unconditionally setting SAGE_ROOT to the path of the script. 

I'm inclined to agree, but I'm not positive either.  Is there any one would ever want to set SAGE_ROOT to a different path here, e.g. with mind towards building in a separate directory from source (e.g. VPATH style, although with VPATH builds I think it still assumes `configure` is in the source directory).


---

Comment by mkoeppe created at 2018-09-28 21:16:41

Replying to [comment:12 embray]:
> Is there any one would ever want to set SAGE_ROOT to a different path here, e.g. with mind towards building in a separate directory from source

I think it's an ancient, long obsolete use-case. Note that `configure` unconditionally sets SAGE_ROOT, so let's match that.

>  (e.g. VPATH style, although with VPATH builds I think it still assumes `configure` is in the source directory).

definitely don't need for VPATH.


---

Comment by embray created at 2018-10-01 11:30:30

Ok, I'll make that simplification then.


---

Comment by git created at 2018-10-01 11:34:43

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by embray created at 2018-10-01 11:35:50

Works for me, but someone else should confirm.


---

Comment by mkoeppe created at 2018-10-01 17:17:34

The commit message should probably be adjusted.


---

Comment by mkoeppe created at 2018-10-01 17:19:45

Otherwise looks good to me and seems to work.


---

Comment by mkoeppe created at 2018-10-01 18:11:17

Changing status from needs_review to positive_review.


---

Comment by embray created at 2018-10-02 09:07:07

I agree the commit message should be updated.  I'm not sure if it's too late or not though.


---

Comment by embray created at 2018-10-02 09:07:25

I'll go ahead and give it a try.


---

Comment by vbraun created at 2018-10-03 21:56:42

Resolution: fixed
