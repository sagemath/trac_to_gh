# Issue 26061: Add build/bin to path in bootstrap script

archive/issues_026061.json:
```json
{
    "body": "`bootstrap` runs `build/bin/sage-download-file`, but since #18438 this has `sage-system-python` in its shebang line, which is not in the path by default.\n\nThis can be fixed by putting `$SAGE_ROOT/build/bin` explicitly on the `$PATH`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26298\n\n",
    "created_at": "2018-09-17T11:23:51Z",
    "labels": [
        "build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Add build/bin to path in bootstrap script",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26061",
    "user": "embray"
}
```
`bootstrap` runs `build/bin/sage-download-file`, but since #18438 this has `sage-system-python` in its shebang line, which is not in the path by default.

This can be fixed by putting `$SAGE_ROOT/build/bin` explicitly on the `$PATH`.

Issue created by migration from https://trac.sagemath.org/ticket/26298





---

archive/issue_comments_367524.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-09-17T11:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367524",
    "user": "embray"
}
```

New commits:



---

archive/issue_comments_367525.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-17T11:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367525",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_367526.json:
```json
{
    "body": "Bootstrap still fails; I force download with\n\n```\n$ git clean -f -d -x\n$ ./bootstrap -D\nrm -rf config configure build/make/Makefile-auto.in\n./bootstrap: line 61: sage-download-file: command not found\nError: downloading configure-282.tar.gz failed\n```\n\nThe problem is that `SAGE_ROOT` isn't actually set to anything...\n\nSee also https://groups.google.com/d/msg/sage-devel/iCrymoWbWxo/AOeOKFEpCwAJ",
    "created_at": "2018-09-23T12:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367526",
    "user": "vbraun"
}
```

Bootstrap still fails; I force download with

```
$ git clean -f -d -x
$ ./bootstrap -D
rm -rf config configure build/make/Makefile-auto.in
./bootstrap: line 61: sage-download-file: command not found
Error: downloading configure-282.tar.gz failed
```

The problem is that `SAGE_ROOT` isn't actually set to anything...

See also https://groups.google.com/d/msg/sage-devel/iCrymoWbWxo/AOeOKFEpCwAJ



---

archive/issue_comments_367527.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-24T14:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367527",
    "user": "embray"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_367528.json:
```json
{
    "body": "D'oh, that is true.  I guess if SAGE_ROOT is not already set it should set SAGE_ROOT to the directory the script is in.",
    "created_at": "2018-09-24T14:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367528",
    "user": "embray"
}
```

D'oh, that is true.  I guess if SAGE_ROOT is not already set it should set SAGE_ROOT to the directory the script is in.



---

archive/issue_comments_367529.json:
```json
{
    "body": "It occurs to me that at some point I exported SAGE_ROOT to my environment, so it still worked.",
    "created_at": "2018-09-24T14:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367529",
    "user": "embray"
}
```

It occurs to me that at some point I exported SAGE_ROOT to my environment, so it still worked.



---

archive/issue_comments_367530.json:
```json
{
    "body": "Hmm, no, that doesn't seem to be it either.  Even if I make sure SAGE_ROOT is not set and PATH is also clean, `./bootstrap -D` still works for me on this branch.",
    "created_at": "2018-09-24T14:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367530",
    "user": "embray"
}
```

Hmm, no, that doesn't seem to be it either.  Even if I make sure SAGE_ROOT is not set and PATH is also clean, `./bootstrap -D` still works for me on this branch.



---

archive/issue_comments_367531.json:
```json
{
    "body": "I see, `./bootstrap` *does* eventually source `src/bin/sage-env`.  So why would it not work?",
    "created_at": "2018-09-24T14:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367531",
    "user": "embray"
}
```

I see, `./bootstrap` *does* eventually source `src/bin/sage-env`.  So why would it not work?



---

archive/issue_comments_367532.json:
```json
{
    "body": "Oh, I guess at this point `src/bin/sage-env-config` is not generated yet, so you also have to make sure that is deleted.",
    "created_at": "2018-09-24T16:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367532",
    "user": "embray"
}
```

Oh, I guess at this point `src/bin/sage-env-config` is not generated yet, so you also have to make sure that is deleted.



---

archive/issue_comments_367533.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-24T17:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367533",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_367534.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-25T09:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367534",
    "user": "embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_367535.json:
```json
{
    "body": "I'm still not wild about this, but I'm open to other ideas.  Maybe there's a simpler solution I'm not seeing.",
    "created_at": "2018-09-25T09:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367535",
    "user": "embray"
}
```

I'm still not wild about this, but I'm open to other ideas.  Maybe there's a simpler solution I'm not seeing.



---

archive/issue_comments_367536.json:
```json
{
    "body": "Looks good to me, but perhaps it would make sense to simplify it by unconditionally setting SAGE_ROOT to the path of the script.",
    "created_at": "2018-09-27T19:15:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367536",
    "user": "mkoeppe"
}
```

Looks good to me, but perhaps it would make sense to simplify it by unconditionally setting SAGE_ROOT to the path of the script.



---

archive/issue_comments_367537.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> Looks good to me, but perhaps it would make sense to simplify it by unconditionally setting SAGE_ROOT to the path of the script. \n\nI'm inclined to agree, but I'm not positive either.  Is there any one would ever want to set SAGE_ROOT to a different path here, e.g. with mind towards building in a separate directory from source (e.g. VPATH style, although with VPATH builds I think it still assumes `configure` is in the source directory).",
    "created_at": "2018-09-28T10:07:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367537",
    "user": "embray"
}
```

Replying to [comment:11 mkoeppe]:
> Looks good to me, but perhaps it would make sense to simplify it by unconditionally setting SAGE_ROOT to the path of the script. 

I'm inclined to agree, but I'm not positive either.  Is there any one would ever want to set SAGE_ROOT to a different path here, e.g. with mind towards building in a separate directory from source (e.g. VPATH style, although with VPATH builds I think it still assumes `configure` is in the source directory).



---

archive/issue_comments_367538.json:
```json
{
    "body": "Replying to [comment:12 embray]:\n> Is there any one would ever want to set SAGE_ROOT to a different path here, e.g. with mind towards building in a separate directory from source\n\nI think it's an ancient, long obsolete use-case. Note that `configure` unconditionally sets SAGE_ROOT, so let's match that.\n\n>  (e.g. VPATH style, although with VPATH builds I think it still assumes `configure` is in the source directory).\n\ndefinitely don't need for VPATH.",
    "created_at": "2018-09-28T21:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367538",
    "user": "mkoeppe"
}
```

Replying to [comment:12 embray]:
> Is there any one would ever want to set SAGE_ROOT to a different path here, e.g. with mind towards building in a separate directory from source

I think it's an ancient, long obsolete use-case. Note that `configure` unconditionally sets SAGE_ROOT, so let's match that.

>  (e.g. VPATH style, although with VPATH builds I think it still assumes `configure` is in the source directory).

definitely don't need for VPATH.



---

archive/issue_comments_367539.json:
```json
{
    "body": "Ok, I'll make that simplification then.",
    "created_at": "2018-10-01T11:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367539",
    "user": "embray"
}
```

Ok, I'll make that simplification then.



---

archive/issue_comments_367540.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-10-01T11:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367540",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_367541.json:
```json
{
    "body": "Works for me, but someone else should confirm.",
    "created_at": "2018-10-01T11:35:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367541",
    "user": "embray"
}
```

Works for me, but someone else should confirm.



---

archive/issue_comments_367542.json:
```json
{
    "body": "The commit message should probably be adjusted.",
    "created_at": "2018-10-01T17:17:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367542",
    "user": "mkoeppe"
}
```

The commit message should probably be adjusted.



---

archive/issue_comments_367543.json:
```json
{
    "body": "Otherwise looks good to me and seems to work.",
    "created_at": "2018-10-01T17:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367543",
    "user": "mkoeppe"
}
```

Otherwise looks good to me and seems to work.



---

archive/issue_comments_367544.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-01T18:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367544",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_367545.json:
```json
{
    "body": "I agree the commit message should be updated.  I'm not sure if it's too late or not though.",
    "created_at": "2018-10-02T09:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367545",
    "user": "embray"
}
```

I agree the commit message should be updated.  I'm not sure if it's too late or not though.



---

archive/issue_comments_367546.json:
```json
{
    "body": "I'll go ahead and give it a try.",
    "created_at": "2018-10-02T09:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367546",
    "user": "embray"
}
```

I'll go ahead and give it a try.



---

archive/issue_comments_367547.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-03T21:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26061#issuecomment-367547",
    "user": "vbraun"
}
```

Resolution: fixed
