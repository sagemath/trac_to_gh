# Issue 24909: Cleanup of AbstractPartitionDiagram

archive/issues_024909.json:
```json
{
    "body": "CC:  darij alauve tscrim ghseeli s.r.doty\n\nKeywords: IMA coding sprint, CHAs, set partitions, diagram algebras\n\nThe `AbstractPartitionDiagram` class from diagram_algebra.py inherits from `SetPartitions` and many of the methods will fail if one tries to use them because they assume that the base set is `\\{1,2,...,n\\}`.\n\nThis ticket will factor out the relevant classes from `SetPartition` and have `AbstractPartitionDiagram` inherit only those.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25146\n\n",
    "created_at": "2018-04-11T15:31:00Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "title": "Cleanup of AbstractPartitionDiagram",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24909",
    "user": "zabrocki"
}
```
CC:  darij alauve tscrim ghseeli s.r.doty

Keywords: IMA coding sprint, CHAs, set partitions, diagram algebras

The `AbstractPartitionDiagram` class from diagram_algebra.py inherits from `SetPartitions` and many of the methods will fail if one tries to use them because they assume that the base set is `\{1,2,...,n\}`.

This ticket will factor out the relevant classes from `SetPartition` and have `AbstractPartitionDiagram` inherit only those.

Issue created by migration from https://trac.sagemath.org/ticket/25146





---

archive/issue_comments_350224.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-12T21:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350224",
    "user": "zabrocki"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_350225.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-12T21:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350225",
    "user": "zabrocki"
}
```

New commits:



---

archive/issue_comments_350226.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-12T23:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350226",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350227.json:
```json
{
    "body": "Wouldn't `max_block_size` be good to have in the general setpartition class - if needed at all?\n\n(I somehow doubt it's useful, because typing `max(len(b) for b in S)` is quite brief. On the other hand, it is a very useful invariant.  Besides, `max` takes an iterator, so the brackets can be omitted.)\n\nIt's a great ticket, in any case!",
    "created_at": "2018-04-13T05:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350227",
    "user": "mantepse"
}
```

Wouldn't `max_block_size` be good to have in the general setpartition class - if needed at all?

(I somehow doubt it's useful, because typing `max(len(b) for b in S)` is quite brief. On the other hand, it is a very useful invariant.  Besides, `max` takes an iterator, so the brackets can be omitted.)

It's a great ticket, in any case!



---

archive/issue_comments_350228.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T14:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350228",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350229.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T14:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350229",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350230.json:
```json
{
    "body": "I moved the `max_block_size` to `AbstractSetPartitions`, for diagram algebras I thought it was an invariant worth giving a name to.",
    "created_at": "2018-04-13T14:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350230",
    "user": "zabrocki"
}
```

I moved the `max_block_size` to `AbstractSetPartitions`, for diagram algebras I thought it was an invariant worth giving a name to.



---

archive/issue_comments_350231.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T15:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350231",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350232.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-13T15:45:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350232",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350233.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-13T16:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350233",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350234.json:
```json
{
    "body": "Thank you Mike.",
    "created_at": "2018-04-13T16:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350234",
    "user": "tscrim"
}
```

Thank you Mike.



---

archive/issue_comments_350235.json:
```json
{
    "body": "Thank you for the review!",
    "created_at": "2018-04-13T17:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350235",
    "user": "zabrocki"
}
```

Thank you for the review!



---

archive/issue_comments_350236.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-04-23T22:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350236",
    "user": "tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_350237.json:
```json
{
    "body": "I forgot to run the long tests. I am getting the same failure as the patchbot.",
    "created_at": "2018-04-23T22:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350237",
    "user": "tscrim"
}
```

I forgot to run the long tests. I am getting the same failure as the patchbot.



---

archive/issue_comments_350238.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-23T22:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350238",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350239.json:
```json
{
    "body": "Actually, we should not be running `TestSuite` on the ABC precisely because it is an ABC.",
    "created_at": "2018-04-23T22:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350239",
    "user": "tscrim"
}
```

Actually, we should not be running `TestSuite` on the ABC precisely because it is an ABC.



---

archive/issue_comments_350240.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-23T22:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350240",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_350241.json:
```json
{
    "body": "Now that I am actually trying to use and debug it, I am finding these changes to be difficult to work with. It can also be improved to better use OOP.",
    "created_at": "2018-04-23T22:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350241",
    "user": "tscrim"
}
```

Now that I am actually trying to use and debug it, I am finding these changes to be difficult to work with. It can also be improved to better use OOP.



---

archive/issue_comments_350242.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-23T22:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350242",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_350243.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-23T23:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350243",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350244.json:
```json
{
    "body": "I removed a lot of essentially duplicate code, did some code simplification (which resulted in a change in the iteration order), and removed the (IMO completely useless) option to pass in a parent to `BrauerDiagram` (if you want it to have a particular parent, construct it the usual way from the parent).\n\nI did do one little thing which might be considered a bit of a hack to remove the need for the `__init__`, but I think the simplified code is useful.",
    "created_at": "2018-04-23T23:35:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350244",
    "user": "tscrim"
}
```

I removed a lot of essentially duplicate code, did some code simplification (which resulted in a change in the iteration order), and removed the (IMO completely useless) option to pass in a parent to `BrauerDiagram` (if you want it to have a particular parent, construct it the usual way from the parent).

I did do one little thing which might be considered a bit of a hack to remove the need for the `__init__`, but I think the simplified code is useful.



---

archive/issue_comments_350245.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-23T23:36:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350245",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_350246.json:
```json
{
    "body": "Have been reading carefully your changes, using the code, performed the full tests, and it seems to work well.  Thanks for cleaning that up.\n\nThere is a change in the behavior of the element class of `BrauerDiagrams` since `BrauerDiagram(BrauerDiagrams(1), [This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))` is no longer a proper call (I had code which allowed both old and new behavior) and it should now be `BrauerDiagram([This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))` or `BrauerDiagrams(1)([This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))`.",
    "created_at": "2018-04-25T13:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350246",
    "user": "zabrocki"
}
```

Have been reading carefully your changes, using the code, performed the full tests, and it seems to work well.  Thanks for cleaning that up.

There is a change in the behavior of the element class of `BrauerDiagrams` since `BrauerDiagram(BrauerDiagrams(1), [This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))` is no longer a proper call (I had code which allowed both old and new behavior) and it should now be `BrauerDiagram([This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))` or `BrauerDiagrams(1)([This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))`.



---

archive/issue_comments_350247.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-25T13:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350247",
    "user": "zabrocki"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350248.json:
```json
{
    "body": "I'm troubled about changing the behavior of `BrauerDiagram`. Should there not be code trapping for old and new form of expected arguments? and throwing a deprecation warning? I haven't looked yet, but I'm sure I have a lot of code that uses the old form. Perhaps others do as well.",
    "created_at": "2018-04-25T15:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350248",
    "user": "alauve"
}
```

I'm troubled about changing the behavior of `BrauerDiagram`. Should there not be code trapping for old and new form of expected arguments? and throwing a deprecation warning? I haven't looked yet, but I'm sure I have a lot of code that uses the old form. Perhaps others do as well.



---

archive/issue_comments_350249.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2018-04-25T17:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350249",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_350250.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-04-25T17:44:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350250",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_350251.json:
```json
{
    "body": "I agree that the change of behavior should be depreciated and I changed the `__classcall_private__` to accept the old notation and raise a deprecation warning.",
    "created_at": "2018-04-25T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350251",
    "user": "zabrocki"
}
```

I agree that the change of behavior should be depreciated and I changed the `__classcall_private__` to accept the old notation and raise a deprecation warning.



---

archive/issue_comments_350252.json:
```json
{
    "body": "We do not need to deprecate it. If you were creating a Brauer diagram by `BrauerDiagram(P, data)` with parent `P`, you were misusing the class. The standard way in Sage to construct an element from a parent is do to `P(data)` (or if you need every last bit of speed, `P.element_class(data)`) so it gets the correct class with the category stuff mixed in. So there should be no code that uses the parent as the first argument. I am -1 on deprecating it; it is a [spacebar](https://xkcd.com/1172/) IMO.",
    "created_at": "2018-04-26T04:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350252",
    "user": "tscrim"
}
```

We do not need to deprecate it. If you were creating a Brauer diagram by `BrauerDiagram(P, data)` with parent `P`, you were misusing the class. The standard way in Sage to construct an element from a parent is do to `P(data)` (or if you need every last bit of speed, `P.element_class(data)`) so it gets the correct class with the category stuff mixed in. So there should be no code that uses the parent as the first argument. I am -1 on deprecating it; it is a [spacebar](https://xkcd.com/1172/) IMO.



---

archive/issue_comments_350253.json:
```json
{
    "body": "I'll take Travis' advice because the other element classes do not follow this way of creating an element.  I wasn't quite sure how to un-commit, hence I create a new branch.",
    "created_at": "2018-05-02T19:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350253",
    "user": "zabrocki"
}
```

I'll take Travis' advice because the other element classes do not follow this way of creating an element.  I wasn't quite sure how to un-commit, hence I create a new branch.



---

archive/issue_comments_350254.json:
```json
{
    "body": "Thank you.\n\nFor future reference `git reset --hard HEAD^` sets it back one commit and then you would need to do a forced push.",
    "created_at": "2018-05-02T21:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350254",
    "user": "tscrim"
}
```

Thank you.

For future reference `git reset --hard HEAD^` sets it back one commit and then you would need to do a forced push.



---

archive/issue_comments_350255.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-02T21:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350255",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_350256.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2018-05-10T07:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350256",
    "user": "vbraun"
}
```

Merge conflict



---

archive/issue_comments_350257.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-10T07:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350257",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_350258.json:
```json
{
    "body": "Something has gotten serious borked with both branches. Trying to fix.",
    "created_at": "2018-05-10T07:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350258",
    "user": "tscrim"
}
```

Something has gotten serious borked with both branches. Trying to fix.



---

archive/issue_comments_350259.json:
```json
{
    "body": "So the problem comes from 1d651d5, where the old behavior seems to have been accidentally partially restored.",
    "created_at": "2018-05-10T08:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350259",
    "user": "tscrim"
}
```

So the problem comes from 1d651d5, where the old behavior seems to have been accidentally partially restored.



---

archive/issue_comments_350260.json:
```json
{
    "body": "Even more strange is that #25162 is unaffected...",
    "created_at": "2018-05-10T08:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350260",
    "user": "tscrim"
}
```

Even more strange is that #25162 is unaffected...



---

archive/issue_comments_350261.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-10T09:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350261",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_350262.json:
```json
{
    "body": "Trivial fix, but annoying to do.",
    "created_at": "2018-05-10T09:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350262",
    "user": "tscrim"
}
```

Trivial fix, but annoying to do.



---

archive/issue_comments_350263.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-10T09:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350263",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_350264.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-14T17:36:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24909",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24909#issuecomment-350264",
    "user": "vbraun"
}
```

Resolution: fixed
