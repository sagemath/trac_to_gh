# Issue 24909: Cleanup of AbstractPartitionDiagram

Issue created by migration from Trac.

Original creator: zabrocki

Original creation time: 2018-04-11 15:31:00

CC:  darij alauve tscrim ghseeli s.r.doty

Keywords: IMA coding sprint, CHAs, set partitions, diagram algebras

The `AbstractPartitionDiagram` class from diagram_algebra.py inherits from `SetPartitions` and many of the methods will fail if one tries to use them because they assume that the base set is `\{1,2,...,n\}`.

This ticket will factor out the relevant classes from `SetPartition` and have `AbstractPartitionDiagram` inherit only those.


---

Comment by zabrocki created at 2018-04-12 21:01:40

Changing status from new to needs_review.


---

Comment by zabrocki created at 2018-04-12 21:01:40

New commits:


---

Comment by git created at 2018-04-12 23:10:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2018-04-13 05:22:44

Wouldn't `max_block_size` be good to have in the general setpartition class - if needed at all?

(I somehow doubt it's useful, because typing `max(len(b) for b in S)` is quite brief. On the other hand, it is a very useful invariant.  Besides, `max` takes an iterator, so the brackets can be omitted.)

It's a great ticket, in any case!


---

Comment by git created at 2018-04-13 14:02:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-13 14:07:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by zabrocki created at 2018-04-13 14:22:26

I moved the `max_block_size` to `AbstractSetPartitions`, for diagram algebras I thought it was an invariant worth giving a name to.


---

Comment by git created at 2018-04-13 15:28:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-13 15:45:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-04-13 16:57:59

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-04-13 16:57:59

Thank you Mike.


---

Comment by zabrocki created at 2018-04-13 17:45:57

Thank you for the review!


---

Comment by tscrim created at 2018-04-23 22:06:21

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2018-04-23 22:06:21

I forgot to run the long tests. I am getting the same failure as the patchbot.


---

Comment by git created at 2018-04-23 22:11:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-04-23 22:11:53

Actually, we should not be running `TestSuite` on the ABC precisely because it is an ABC.


---

Comment by tscrim created at 2018-04-23 22:11:53

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-04-23 22:47:10

Now that I am actually trying to use and debug it, I am finding these changes to be difficult to work with. It can also be improved to better use OOP.


---

Comment by tscrim created at 2018-04-23 22:47:10

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-04-23 23:32:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-04-23 23:35:57

I removed a lot of essentially duplicate code, did some code simplification (which resulted in a change in the iteration order), and removed the (IMO completely useless) option to pass in a parent to `BrauerDiagram` (if you want it to have a particular parent, construct it the usual way from the parent).

I did do one little thing which might be considered a bit of a hack to remove the need for the `__init__`, but I think the simplified code is useful.


---

Comment by tscrim created at 2018-04-23 23:36:15

Changing status from needs_work to needs_review.


---

Comment by zabrocki created at 2018-04-25 13:45:29

Have been reading carefully your changes, using the code, performed the full tests, and it seems to work well.  Thanks for cleaning that up.

There is a change in the behavior of the element class of `BrauerDiagrams` since `BrauerDiagram(BrauerDiagrams(1), [This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))` is no longer a proper call (I had code which allowed both old and new behavior) and it should now be `BrauerDiagram([This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))` or `BrauerDiagrams(1)([This is the Trac macro *1,-1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,-1-macro))`.


---

Comment by zabrocki created at 2018-04-25 13:45:29

Changing status from needs_review to positive_review.


---

Comment by alauve created at 2018-04-25 15:35:54

I'm troubled about changing the behavior of `BrauerDiagram`. Should there not be code trapping for old and new form of expected arguments? and throwing a deprecation warning? I haven't looked yet, but I'm sure I have a lot of code that uses the old form. Perhaps others do as well.


---

Comment by git created at 2018-04-25 17:44:11

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2018-04-25 17:44:11

Changing status from positive_review to needs_review.


---

Comment by zabrocki created at 2018-04-25 17:47:42

I agree that the change of behavior should be depreciated and I changed the `__classcall_private__` to accept the old notation and raise a deprecation warning.


---

Comment by tscrim created at 2018-04-26 04:28:06

We do not need to deprecate it. If you were creating a Brauer diagram by `BrauerDiagram(P, data)` with parent `P`, you were misusing the class. The standard way in Sage to construct an element from a parent is do to `P(data)` (or if you need every last bit of speed, `P.element_class(data)`) so it gets the correct class with the category stuff mixed in. So there should be no code that uses the parent as the first argument. I am -1 on deprecating it; it is a [spacebar](https://xkcd.com/1172/) IMO.


---

Comment by zabrocki created at 2018-05-02 19:46:59

I'll take Travis' advice because the other element classes do not follow this way of creating an element.  I wasn't quite sure how to un-commit, hence I create a new branch.


---

Comment by tscrim created at 2018-05-02 21:10:29

Thank you.

For future reference `git reset --hard HEAD^` sets it back one commit and then you would need to do a forced push.


---

Comment by tscrim created at 2018-05-02 21:10:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-10 07:13:42

Merge conflict


---

Comment by vbraun created at 2018-05-10 07:13:42

Changing status from positive_review to needs_work.


---

Comment by tscrim created at 2018-05-10 07:58:17

Something has gotten serious borked with both branches. Trying to fix.


---

Comment by tscrim created at 2018-05-10 08:09:49

So the problem comes from 1d651d5, where the old behavior seems to have been accidentally partially restored.


---

Comment by tscrim created at 2018-05-10 08:27:26

Even more strange is that #25162 is unaffected...


---

Comment by git created at 2018-05-10 09:50:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-05-10 09:51:39

Trivial fix, but annoying to do.


---

Comment by tscrim created at 2018-05-10 09:51:39

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2018-05-14 17:36:01

Resolution: fixed
