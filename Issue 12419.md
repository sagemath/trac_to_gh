# Issue 12419: same color shows up different in graphics_array

archive/issues_012419.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  @kcrisman @mkoeppe\n\nKeywords: graphics_array, color\n\nThe code\n\n```\ng = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.5)\ngraphics_array([g,g,g]).show()\n```\n\nproduces three circles, the first two with color 0xFF7F7F (html-color-code), the third one with color 0xFF3F3F (html-color-code). But all three should have the same color.\n\nThis was reported on [the public bug reports from the notebook interface](https://spreadsheets.google.com/pub?key=pCwvGVwSMxTzT6E2xNdo5fA)\n\nIssue created by migration from https://trac.sagemath.org/ticket/12591\n\n",
    "created_at": "2012-02-26T13:23:17Z",
    "labels": [
        "graphics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "same color shows up different in graphics_array",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12419",
    "user": "@dkrenn"
}
```
Assignee: jason, was

CC:  @kcrisman @mkoeppe

Keywords: graphics_array, color

The code

```
g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.5)
graphics_array([g,g,g]).show()
```

produces three circles, the first two with color 0xFF7F7F (html-color-code), the third one with color 0xFF3F3F (html-color-code). But all three should have the same color.

This was reported on [the public bug reports from the notebook interface](https://spreadsheets.google.com/pub?key=pCwvGVwSMxTzT6E2xNdo5fA)

Issue created by migration from https://trac.sagemath.org/ticket/12591





---

archive/issue_comments_146713.json:
```json
{
    "body": "Huh, that's interesting.   Apparently the `alpha` is not propogated to the last one.\n\nRelated tickets: #10657 and friends.",
    "created_at": "2012-02-27T15:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146713",
    "user": "@kcrisman"
}
```

Huh, that's interesting.   Apparently the `alpha` is not propogated to the last one.

Related tickets: #10657 and friends.



---

archive/issue_comments_146714.json:
```json
{
    "body": "In fact, there is another manifestation of this there.\n\n```\n\nReplying to [comment:3 eviatarbach]:\n> This is also a problem with other options, such as tick_formatter, ticks, and axes_labels. They are only applied to the last graphic; see attached image produced by the following code:\n> graphics_array([plot(sin(B*x), xmin=-2*pi, xmax=2*pi, tick_formatter=pi, ticks=pi/2, axes_labels=('', '%s'%B)) for B in [-2,-1,-1/2,1/2,1,2]], 3, 2)\n```\n",
    "created_at": "2012-02-27T15:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146714",
    "user": "@kcrisman"
}
```

In fact, there is another manifestation of this there.

```

Replying to [comment:3 eviatarbach]:
> This is also a problem with other options, such as tick_formatter, ticks, and axes_labels. They are only applied to the last graphic; see attached image produced by the following code:
> graphics_array([plot(sin(B*x), xmin=-2*pi, xmax=2*pi, tick_formatter=pi, ticks=pi/2, axes_labels=('', '%s'%B)) for B in [-2,-1,-1/2,1/2,1,2]], 3, 2)
```




---

archive/issue_comments_146715.json:
```json
{
    "body": "It seems that the last one is just duplicated (which looks the same as doubling alpha).\n\n```\nsage: g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.1)\nsage: graphics_array([g,g,g]).show()\n```\n",
    "created_at": "2014-11-02T20:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146715",
    "user": "@fchapoton"
}
```

It seems that the last one is just duplicated (which looks the same as doubling alpha).

```
sage: g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.1)
sage: graphics_array([g,g,g]).show()
```




---

archive/issue_comments_146716.json:
```json
{
    "body": "More serious proof of duplication of the last object of the group:\n\n```\nsage: g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.1, legend_label='pink')\nsage: graphics_array([g,g,g]).show()\n```\n\nBut where on earth does this duplication come from ?",
    "created_at": "2014-11-03T20:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146716",
    "user": "@fchapoton"
}
```

More serious proof of duplication of the last object of the group:

```
sage: g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.1, legend_label='pink')
sage: graphics_array([g,g,g]).show()
```

But where on earth does this duplication come from ?



---

archive/issue_comments_146717.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-04T13:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146717",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_146718.json:
```json
{
    "body": "The culprit was the line\n\n\n```\n        g.save(filename, dpi=dpi, figure=figure, sub=subplot,\n               verify=do_verify, axes=axes, **kwds)\n```\n\n\nin sage/plot/graphics.py. Here g was defined inside the previous loop, so after the loop it gets once again the last value.\n\nI have just extracted the last object by stopping the loop one step before.\n----\nNew commits:",
    "created_at": "2014-11-04T13:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146718",
    "user": "@fchapoton"
}
```

The culprit was the line


```
        g.save(filename, dpi=dpi, figure=figure, sub=subplot,
               verify=do_verify, axes=axes, **kwds)
```


in sage/plot/graphics.py. Here g was defined inside the previous loop, so after the loop it gets once again the last value.

I have just extracted the last object by stopping the loop one step before.
----
New commits:



---

archive/issue_comments_146719.json:
```json
{
    "body": "Huh, nice find!  Do you think this would go toward fixing #10657 or #11160?",
    "created_at": "2014-11-04T14:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146719",
    "user": "@kcrisman"
}
```

Huh, nice find!  Do you think this would go toward fixing #10657 or #11160?



---

archive/issue_comments_146720.json:
```json
{
    "body": "Probably all this happens at the very same place, but I do not understand this matplotlib business, so I am not able to do better than what I did.",
    "created_at": "2014-11-04T19:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146720",
    "user": "@fchapoton"
}
```

Probably all this happens at the very same place, but I do not understand this matplotlib business, so I am not able to do better than what I did.



---

archive/issue_comments_146721.json:
```json
{
    "body": "Note that the legend in the third picture is no longer duplicated, but does not look the same:\n\n```\nsage: g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.1, legend_label='pink')\nsage: graphics_array([g,g,g]).show()\n```\n",
    "created_at": "2014-11-04T19:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146721",
    "user": "@fchapoton"
}
```

Note that the legend in the third picture is no longer duplicated, but does not look the same:

```
sage: g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.1, legend_label='pink')
sage: graphics_array([g,g,g]).show()
```




---

archive/issue_comments_146722.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-11-05T17:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146722",
    "user": "@kcrisman"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_146723.json:
```json
{
    "body": "> Note that the legend in the third picture is no longer duplicated, but does not look the same:\n> {{{\n> sage: g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.1, legend_label='pink')\n> sage: graphics_array([g,g,g]).show()\n> }}}\nNoted.  I tried getting rid of that last call to `save` and instead doing all in the loop, but that didn't work.  Probably we'll need to directly import stuff like\n\n```\n            from matplotlib.backends.backend_agg import FigureCanvasAgg\n            figure.set_canvas(FigureCanvasAgg(figure))\n            # this messes up the aspect ratio!\n            #figure.canvas.mpl_connect('draw_event', pad_for_tick_labels)\n\n            # tight_layout adjusts the *subplot* parameters so ticks aren't cut off, etc.\n            figure.tight_layout()\n\n            opts = dict(dpi=dpi, transparent=transparent)\n            if fig_tight is True:\n                opts['bbox_inches'] = 'tight'\n            if self._bbox_extra_artists:\n                opts['bbox_extra_artists'] = self._bbox_extra_artists\n\n            figure.savefig(filename, **opts)\n```\n\nfrom the singular graphics object save code.",
    "created_at": "2014-11-05T17:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146723",
    "user": "@kcrisman"
}
```

> Note that the legend in the third picture is no longer duplicated, but does not look the same:
> {{{
> sage: g = circle((0,0),1,rgbcolor='red',fill=True, alpha=0.1, legend_label='pink')
> sage: graphics_array([g,g,g]).show()
> }}}
Noted.  I tried getting rid of that last call to `save` and instead doing all in the loop, but that didn't work.  Probably we'll need to directly import stuff like

```
            from matplotlib.backends.backend_agg import FigureCanvasAgg
            figure.set_canvas(FigureCanvasAgg(figure))
            # this messes up the aspect ratio!
            #figure.canvas.mpl_connect('draw_event', pad_for_tick_labels)

            # tight_layout adjusts the *subplot* parameters so ticks aren't cut off, etc.
            figure.tight_layout()

            opts = dict(dpi=dpi, transparent=transparent)
            if fig_tight is True:
                opts['bbox_inches'] = 'tight'
            if self._bbox_extra_artists:
                opts['bbox_extra_artists'] = self._bbox_extra_artists

            figure.savefig(filename, **opts)
```

from the singular graphics object save code.



---

archive/issue_comments_146724.json:
```json
{
    "body": "> Noted.  I tried getting rid of that last call to `save` and instead doing all in the loop, but that didn't work.  Probably we'll need to directly import stuff like <snip>\n> from the singular graphics object save code.\nYes, this works, though one has to (for now) get rid of the transparent and I just got rid of the last two if clauses since they didn't seem relevant to the array case for now.",
    "created_at": "2014-11-05T17:24:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146724",
    "user": "@kcrisman"
}
```

> Noted.  I tried getting rid of that last call to `save` and instead doing all in the loop, but that didn't work.  Probably we'll need to directly import stuff like <snip>
> from the singular graphics object save code.
Yes, this works, though one has to (for now) get rid of the transparent and I just got rid of the last two if clauses since they didn't seem relevant to the array case for now.



---

archive/issue_comments_146725.json:
```json
{
    "body": "But there is a problem...\n> In fact, there is another manifestation of this there.\n> {{{\n> > graphics_array([plot(sin(B*x), xmin=-2*pi, xmax=2*pi, tick_formatter=pi, ticks=pi/2, axes_labels=('', '%s'%B)) for B in [-2,-1,-1/2,1/2,1,2]], 3, 2)\n> }}}\nActually, it turns out that fixing this ticket makes that issue even worse.  It's only in that save command which I just removed that all these extra options get used at all!  So the \"right\" fix for this would fix both; the current fix would leave that the same but still have the problem mentioned.\n\nYour current fix, though, as far as I can tell, doesn't really make things *worse*, because for me in vanilla Sage I get for the command you mention in this comment\n> Note that the legend in the third picture is no longer duplicated, but does not look the same:\nthat it just has two of the weird legends, so one weird legend is better than duplicated weird legends, right?\n\nLet me know what you think; properly doctested (well, mentioned in a tests section, though perhaps we could extract the last element of a graphics array and check that it just has one figure), this change is a step in the right direction, I think.",
    "created_at": "2014-11-05T17:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146725",
    "user": "@kcrisman"
}
```

But there is a problem...
> In fact, there is another manifestation of this there.
> {{{
> > graphics_array([plot(sin(B*x), xmin=-2*pi, xmax=2*pi, tick_formatter=pi, ticks=pi/2, axes_labels=('', '%s'%B)) for B in [-2,-1,-1/2,1/2,1,2]], 3, 2)
> }}}
Actually, it turns out that fixing this ticket makes that issue even worse.  It's only in that save command which I just removed that all these extra options get used at all!  So the "right" fix for this would fix both; the current fix would leave that the same but still have the problem mentioned.

Your current fix, though, as far as I can tell, doesn't really make things *worse*, because for me in vanilla Sage I get for the command you mention in this comment
> Note that the legend in the third picture is no longer duplicated, but does not look the same:
that it just has two of the weird legends, so one weird legend is better than duplicated weird legends, right?

Let me know what you think; properly doctested (well, mentioned in a tests section, though perhaps we could extract the last element of a graphics array and check that it just has one figure), this change is a step in the right direction, I think.



---

archive/issue_comments_146726.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-14T12:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146726",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146727.json:
```json
{
    "body": "The issues described here are fixed in #27865.",
    "created_at": "2019-05-24T12:43:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146727",
    "user": "@egourgoulhon"
}
```

The issues described here are fixed in #27865.



---

archive/issue_comments_146728.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-06-28T12:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146728",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_146729.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-28T16:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146729",
    "user": "@egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_146730.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2019-06-30T11:59:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12419",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12419#issuecomment-146730",
    "user": "@fchapoton"
}
```

Resolution: duplicate
