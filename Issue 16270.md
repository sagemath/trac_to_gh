# Issue 16270: Better handling of subspace construction in pushout

Issue created by migration from Trac.

Original creator: pbruin

Original creation time: 2014-06-21 00:08:58

CC:  simonking nthiery jpflori

Keywords: pushout subspace

When taking a pushout of two modules in the case where the construction of exactly one of them involves a subspace construction, the result does not have a coercion map from the other object:

```
sage: A = ZZ^2
sage: V = span([This is the Trac macro *1, 2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 2-macro), QQ)
sage: P = sage.categories.pushout.pushout(A, V)
sage: P
Vector space of degree 2 and dimension 1 over Rational Field
User basis matrix:
[1 2]
sage: P.has_coerce_map_from(A)
False
```

The explanation is that for the other currently existing constructions `F`, the result `F(X)` of applying the construction to `X` has a coercion map _from_ `X`, but for the subspace construction, `F(X)` only has a coercion map _to_ `X`.

This ticket addresses this by equipping the class `ConstructionFunctor` with an attribute `coercion_reversed`, which is `False` by default; if it is `True` for a construction `F`, then the pushout of two objects omits `F` in the case where (at a given step of constructing the pushout) exactly one of the two constructions is `F`.  Of course, we set `coercion_reversed = True` for the subspace construction.

No change is necessary in the case where both constructions involve `F`, since this situation should be taken care of by `F.merge()`.  This is indeed true for the subspace construction, where `F.merge()` takes the sum of the two subspaces.

The situation described above can be viewed as the case where one of the two constructions involves a "trivial" application of `F`, i.e. with the subspace equal to the whole space.  Hence we should interpret our situation as a case where the effect of `merge()` with one trivial argument is desired.

In the above example, this strategy will cause `P` to be equal to `QQ^2`, as might be expected.


---

Comment by pbruin created at 2014-06-21 00:12:57

Changing status from new to needs_review.


---

Comment by tscrim created at 2014-06-23 00:07:21

I think this is good, but Simon/Nicolas, could I get a second opinion on this?


---

Comment by tscrim created at 2014-06-23 00:07:21

Changing keywords from "pushout subspace" to "pushout subspace, sd59".


---

Comment by jj created at 2014-08-29 22:37:33

What about the discussion we had on sage-devel / the example 1.1 + x^2

I liked the suggestion of doing a coercion check for exceptional cases.
That would however involve applying/evaluating (part of) the functor prematurely
(which is not necessarily wrong/bad).


---

Comment by pbruin created at 2014-08-29 22:51:40

Replying to [comment:4 jj]:
> What about the discussion we had on sage-devel / the example 1.1 + x^2
I was planning to come back to this, but I'm currently slightly busy (moving house)...
> I liked the suggestion of doing a coercion check for exceptional cases.
> That would however involve applying/evaluating (part of) the functor prematurely
> (which is not necessarily wrong/bad).
Yes, but as you say it is not a bad thing; in the end we have to apply the "merged" functor anyway, so the consequence of this coercion checking is just that the logic becomes a little bit more complicated.

If you feel like implementing this, feel free to go ahead; I'm not sure if I'll have enough time very soon.


---

Comment by SimonKing created at 2014-08-30 07:49:29

Replying to [ticket:16507 pbruin]:
> This ticket addresses this by equipping the class `ConstructionFunctor` with an attribute `coercion_reversed`, which is `False` by default; if it is `True` for a construction `F`, then the pushout of two objects omits `F` in the case where (at a given step of constructing the pushout) exactly one of the two constructions is `F`.  Of course, we set `coercion_reversed = True` for the subspace construction.

I hope this will not end up with a pullback construction.

What do you mean by "exactly one of the two constructions is `F`"? Isn't it the case that one can simply drop all "reversed" construction functors, _before_ constructing the pushout? Say, if you have direct construction functors F1,...,F5 and reversed construction functors R1,R2, and consider `(F5*R2*F4*F3*R1*F2*F1)(ZZ)`, then `(R2*F4*F3*R1*F2*F1)(ZZ)` coerces into `(F4*F3*R1*F2*F1)(ZZ)` and `(F4*F3*R1*F2*F1)(ZZ)` coerces into `(F5*F4*F3*R1*F2*F1)(ZZ)`. Would this already imply that `(F5*R2*F4*F3*R1*F2*F1)(ZZ)` coerces into `(F5*F4*F3*R1*F2*F1)(ZZ)`? If yes, then one could inductively remove all the reversed construction functors, and will eventually construct the pushout of `(F5*F4*F3*F2*F1)(ZZ)` with the other given parent.


---

Comment by robertwb created at 2014-08-30 09:20:06

New commits:


---

Comment by git created at 2014-08-30 09:22:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-08-30 23:47:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pbruin created at 2014-09-04 15:02:25

Replying to [comment:6 SimonKing]:
> I hope this will not end up with a pullback construction.
It definitely won't; this algorithm is far from being symmetric.
> Isn't it the case that one can simply drop all "reversed" construction functors, _before_ constructing the pushout?
In that case you would end up with some object admitting coercion maps from both original objects, but the idea is to try to get something as close as possible to the "real" push-out.  Hopefully Robert's list of examples makes it clear that one shouldn't just throw away all "coercion-reversed" constructions.


---

Comment by pbruin created at 2014-12-08 21:16:52

Replying to [comment:18:ticket:10513 jpflori (#10513)]:
> Could you add a little documentation about the `coercion_reverse` thing?
> Or rather, move it in the actual code, rather than in comments?
> Not that the category/coercion stuff is already obscure, but...
It's a bit annoying to document member variables, one would have to do it in the class docstring.  Anyway, I'll try if I can do this in a reasonable way.


---

Comment by pbruin created at 2014-12-08 22:58:37

I ended up moving this explanation to the docstring of `pushout()` instead, and also made a number of other documentation improvements.


---

Comment by jpflori created at 2014-12-10 13:16:28

Looks better to me!


---

Comment by jpflori created at 2014-12-10 13:16:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-12-18 00:57:08

Resolution: fixed
