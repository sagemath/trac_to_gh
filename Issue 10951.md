# Issue 10951: Don't use version of Sage in default pickle directory

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2011-03-28 08:22:01

Assignee: was

Keywords: pickle

I don't see any good reason why the version number of Sage is used when creating pickles using `sage.structure.sage_object.picklejar`


```
def picklejar(obj, dir=None):
    """
    Create pickled sobj of obj in dir, with name the absolute value of
    the hash of the pickle of obj.  This is used in conjunction with
    sage.structure.sage_object.unpickle_all.

    To use this to test the whole Sage library right now, set the
    environment variable SAGE_PICKLE_JAR, which will make it so dumps
    will by default call picklejar with the default dir.  Once you do
    that and doctest Sage, you'll find that the SAGE_ROOT/tmp/
    contains a bunch of pickled objects along with corresponding txt
    descriptions of them.  Use the
    sage.structure.sage_object.unpickle_all to see if they unpickle
    later.

    INPUTS:

    - ``obj`` - a pickleable object

    - ``dir`` - a string or None; if None defaults to
      ``SAGE_ROOT/tmp/pickle_jar-version``
```



---

Comment by jdemeyer created at 2011-03-28 12:05:11

Changing status from new to needs_review.


---

Attachment


---

Comment by nthiery created at 2011-05-25 14:08:56

I myself don't have a strong feeling one way or the other for including the version. Since the release manager is the main user of this function, I happy to abide if he finds it more practical. Beside this harmless change, the patch adds more tests and fixes a typo. And all test pass. So, positive review.


---

Comment by nthiery created at 2011-05-25 14:08:56

Changing status from needs_review to positive_review.


---

Attachment


---

Comment by jdemeyer created at 2011-05-31 12:56:23

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2011-05-31 17:05:44

Additional patch needs review.


---

Comment by jdemeyer created at 2011-05-31 17:05:44

Changing status from needs_work to needs_review.


---

Comment by nthiery created at 2011-05-31 20:27:01

I don't know if it matters in any way, but is there an easy way to restore the original permissions, whatether they are, rather than forcing to 755?


---

Comment by jdemeyer created at 2011-06-01 07:14:51

Replying to [comment:7 nthiery]:
> I don't know if it matters in any way, but is there an easy way to restore the original permissions, whatether they are, rather than forcing to 755?

I guess one could use `os.stat()` but I don't see a reason to add this complication.  The only thing which matters is that the directory can be *removed* without errors.


---

Comment by nthiery created at 2011-06-01 10:20:19

Ok, good enough. Please check the failure reported by the buildbot. If it's just a random independent thing, then you can set a positive review on my behalf.

Cheers,


---

Comment by jdemeyer created at 2011-06-01 11:33:39

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-06-01 11:33:39

It is a random independent thing:

```
The following tests failed:

	sage -t  -force_lib devel/sage-11069/sage/schemes/plane_conics/all.py # 0 doctests failed
```



---

Comment by jdemeyer created at 2011-06-07 08:36:15

Resolution: fixed
