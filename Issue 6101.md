# Issue 6101: computation of induced morphism on homology and cohomology of simplicial complex morphisms

Issue created by migration from https://trac.sagemath.org/ticket/6101

Original creator: bantieau

Original creation time: 2009-05-21 03:43:56

Assignee: bantieau

CC:  jhpalmieri nthiery simonking

Add functionality to sage to compute the effect of a simplicial complex morphism on homology and cohomology.

This patch will rely on fuctionality in #6099, #6100, and #5882.


---

Comment by jhpalmieri created at 2015-09-10 22:08:11

New commits:


---

Comment by jhpalmieri created at 2015-09-10 22:08:11

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2015-09-10 22:08:22

Changing priority from minor to major.


---

Comment by cnassau created at 2015-09-11 08:48:00

Hi John,

This seems pretty interesting. I just started to play around with it and was struck by a couple of minor usability issues: 

```
sage: X=simplicial_complexes.BrucknerGrunbaumSphere()
sage: phi, M = algebraic_topological_model(X, GF(2))
sage: phi
Chain homotopy between Chain complex morphism from Chain complex with at most 4 nonzero terms over Finite Field of size 2 to Chain complex with at most 4 nonzero terms over Finite Field of size 2 and Chain complex morphism from Chain complex with at most 4 nonzero terms over Finite Field of size 2 to Chain complex with at most 4 nonzero terms over Finite Field of size 2
sage: phi._codomain()
Trivial chain
sage: phi._domain()
Trivial chain
sage: phi._codomain() is phi._domain()
False
```


As you can see, I made the basic mistake of thinking of "phi._domain" as private functions, when they are in fact just attributes:

```
sage: phi._domain
Chain complex with at most 4 nonzero terms over Finite Field of size 2
sage: phi._domain is phi._f._domain
True
```

The Sage maps that I'm used to (mainly morphisms between CombinatorialFreeModules) have public "domain" and "codomain" methods; this might have spared me a 5 minute detour in this case. I have no good idea, though, what to call the $H_0$ and $H_1$ of a homotopy $H_t$...  

Also, I wonder if phi shouldn't better be printed like

```
sage: phi
Chain homotopy between 
    Chain complex morphism 
      From: Chain complex with at most 4 nonzero terms over Finite Field of size 2
      To:   Chain complex with at most 4 nonzero terms over Finite Field of size 2
and Chain complex morphism
      From: Chain complex with at most 4 nonzero terms over Finite Field of size 2
      To:   Chain complex with at most 4 nonzero terms over Finite Field of size 2
```

At least this is the way morphisms between combinatorial free modules are printed:

```
sage: A,B=[CombinatorialFreeModule(GF(2),x) for x in [(1,2,3),(2,3,4)]]
sage: f=A.module_morphism(codomain=B,on_basis = lambda x:x+1) ; f
Generic morphism:
  From: Free module generated by {1, 2, 3} over Finite Field of size 2
  To:   Free module generated by {2, 3, 4} over Finite Field of size 2
```



---

Comment by chapoton created at 2015-09-11 11:36:00

doc does not build

WARNING: citation not found: G-DR


---

Comment by jhpalmieri created at 2015-09-11 15:06:31

Replying to [comment:11 chapoton]:
> doc does not build
> 
> WARNING: citation not found: G-DR

Sorry, that should be `G-DR03`. I'll fix it.


---

Comment by tscrim created at 2015-09-11 15:20:48

As Christian implied, you should use `.domain()` and `.codomain()` in the docstring and try to make thing behave like other morphisms as much as possible (anything inheriting from `Morphism` has some method like `_repr_defn` or similar).

For the record, this is on my todo list, but I don't know when I might be able to do a full review.


---

Comment by git created at 2015-09-11 15:44:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-09-11 15:48:13

Good suggestions, Christian. I've made some changes to try to address them.

Regarding $H_0$ and $H_1$ (currently `._f` and `._g`), I don't know good names either, but I also almost never needed to use those attributes (only when constructing the dual chain homotopy).


---

Comment by git created at 2015-09-11 18:27:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-09-11 18:28:11

(Same commits as before, but I also put them on #19179 and #6102, where they really belong.)


---

Comment by git created at 2015-09-11 18:39:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cnassau created at 2015-09-11 20:35:41

Replying to [comment:17 jhpalmieri]:
> (Same commits as before, but I also put them on #19179 and #6102, where they really belong.)

I'm a bit confused by these dependencies - what's the right place to start reviewing things: 6101, 6102, or 19179 ?


---

Comment by jhpalmieri created at 2015-09-11 21:12:39

In principle, #19179 is first, then #6102, then this one. However, #19179 has one or two doctests that use things that aren't introduced until #6102, so they will fail. You can read the code there and run everything, though.

#6102 should build and pass doctests, so it would come next (or jointly with #19179). This ticket comes last. The new code for this ticket should be all in the commit labeled "trac 6101: maps in (co)homology induced by simplicial maps".

I suppose I should change the `_repr_` method for induced homology maps here, but not right now.


---

Comment by cnassau created at 2015-09-12 08:46:36

Replying to [comment:15 jhpalmieri]:
> Good suggestions, Christian. I've made some changes to try to address them.
> 
> Regarding $H_0$ and $H_1$ (currently `._f` and `._g`), I don't know good names either, but I also almost never needed to use those attributes (only when constructing the dual chain homotopy).

I wonder if we might use bracket-notation, so that a homotopy `H` goes from `H[0]` to `H[1]`? But I don't know if there are precedents in Sage for custom `__getitem__`, `__setitem__` methods. And I'm also not sure, whether there's a real need for this...


---

Comment by git created at 2015-09-12 16:25:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-14 15:18:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-10-15 19:30:05

Okay, last up is this ticket. A first question from a quick lookover is could we use `Morphism` as the base class?


---

Comment by jhpalmieri created at 2015-10-15 20:35:20

This needs to be rebased on top of the most recent #6102. I'm working on it. I'll also look into using `Morphism`. Does that mean that we also change the already-existing `ChainComplexMorphism` and `SimplicialComplexMorphism`?


---

Comment by jhpalmieri created at 2015-10-15 20:35:20

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2015-10-15 22:15:49

Replying to [comment:25 jhpalmieri]:
> I'll also look into using `Morphism`. Does that mean that we also change the already-existing `ChainComplexMorphism` and `SimplicialComplexMorphism`?

It gives us a little bit of extra features (like `register_as_coercion()`) and more consistent class hierarchy, but it isn't a requirement. It might also make things easier once homsets become proper parents too, but that is so far down the road that it's not worth it the worry either.


---

Comment by git created at 2015-10-17 05:40:09

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by jhpalmieri created at 2015-10-17 05:41:51

Okay, here's an attempt at using `Morphism`. I also used `Parent` for `SimplicialComplex` (instead of `CategoryObject`). The only issue with this is that the test suite for simplicial complexes fails unless I skip `_test_category`.


---

Comment by tscrim created at 2015-10-17 15:41:44

Would you be opposed to basing this on #18175 (which should be positively reviewed soon I hope)? This might solve the issues with `_test_category`, but I suspect this is more due to a lack of an element class. If you were to use the category of (abstract) simplical complexes from #18175, the intent was that elements correspond to faces.

I should also ask how you feel about using morphism, does it feel any more natural to do things this way or do you think that continuing to work on this isn't worth the time (at this stage)?


---

Comment by jhpalmieri created at 2015-10-17 21:07:59

If I try to merge #18175, the test suite fails more tests than before:

```
The following tests failed: _test_an_element, _test_elements, _test_elements_eq_reflexive, _test_elements_eq_symmetric, _test_elements_eq_transitive, _test_elements_neq, _test_some_elements
```

because

```
NotImplementedError: please implement _an_element_ for Simplicial complex ...
```

I'm not sure what `_an_element_` should return: a simplex (since a simplicial complex is a set of simplices)? a vertex (since their images determine maps)? a facet (since they determine the complex)?

As far as morphisms go, it was not hard to switch to them (assuming I did everything right).


---

Comment by tscrim created at 2015-10-17 21:22:31

I would just have it return the first facet (and the empty simplex for the empty complex), but it just has to be any element of the parent object (which could include the empty simplex).


---

Comment by jhpalmieri created at 2015-10-17 21:26:03

Going this route tempts me to make `Simplex` inherit from `Element`, but you might want to construct abstract instances of `Simplex` which are not elements of any particular complex. So I can't use the `Element.__init__` method, which requires setting a parent. As a result, I don't think I can use `_element_constructor_` for simplicial complexes. Instead, I can do something like this (plus doctests):

```diff
diff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py
index 8d00cd6..366c1db 100644
--- a/src/sage/homology/simplicial_complex.py
+++ b/src/sage/homology/simplicial_complex.py
@@ -1077,6 +1077,21 @@ class SimplicialComplex(Parent, GenericCellComplex):
         """
         return self._vertex_set
 
+    def _an_element_(self):
+        return self.facets()[0]
+
+    def __contains__(self, x):
+        if not isinstance(x, Simplex):
+            return False
+        dim = x.dimension()
+        return x in self.n_faces(dim)
+
+    def __call__(self, simplex):    # not _element_constructor_
+        if simplex not in self:
+            raise ValueError
+        return simplex
+
     def maximal_faces(self):
         """
         The maximal faces (a.k.a. facets) of this simplicial complex.
```

Then the full test suite passes.


---

Comment by tscrim created at 2015-10-17 21:30:59

We can always subclass `Simplex` as something like `SimplexElement` and changing out some calls to `Simplex(data)` to `self.element_class(self, data)`. I wouldn't really want to overwrite `__call__` unless we really have to... I can also do some of the work for this changeover as well.


---

Comment by git created at 2015-10-17 22:37:52

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by jhpalmieri created at 2015-10-17 22:39:00

I tried implementing `SimplexElement` and it turned into a real mess, so I gave up. Instead, here is my version using `__call__`.


---

Comment by jhpalmieri created at 2015-10-17 22:39:00

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2015-10-18 15:17:26

Oh, and I would welcome any help with this or other approaches.


---

Comment by tscrim created at 2015-10-18 16:54:33

I will work on this later this week.


---

Comment by tscrim created at 2015-10-20 13:48:34

Man...non hashable parents really throw a big wrench into the coercion framework. In some ways that is not surprising, as they get put into a big `dict` to store the necessary coercions, but I would have liked it to better handle non-hashable parents.

Well, one of the problems that you had was `Element` tries to use coercion on elements which do not define rich comparisons, which caused problems until I changed `Simplex.__cmp__` to rich comparisons (I <3 `functools.total_ordering`). However, even with that change, I could not get the combination of `class Element(Simplex, Element)` in `SimplicialComplex` to pickle (granted, I did not try too hard). I think the problem is that `SimplicialComplex` is defined by a set of its elements, and we get a loop of sorts with the pickling...

Therefore I decided to just add a warning message to `SimplicialComplex` instead. Simon, Nicolas, the reason I am cc-ing you is to make sure that this abuse of `Parent` is acceptable to you (or if you had any thoughts about the pickling issues). At least until a follow-up ticket takes care of things.
----
New commits:


---

Comment by git created at 2015-10-22 18:17:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-10-24 22:45:52

John, if nobody objects to the current setup in a few days, then I think we should set this to positive review.


---

Comment by jhpalmieri created at 2015-10-24 22:53:37

Sounds great. I certainly don't have any objection to your warning.


---

Comment by tscrim created at 2015-10-28 02:18:31

Okay, I think we've let enough time for a response pass. Feel free to set a positive review if you're still in agreement.


---

Comment by jhpalmieri created at 2015-10-28 03:40:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-10-28 17:59:47

Resolution: fixed
