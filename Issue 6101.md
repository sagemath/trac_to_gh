# Issue 6101: computation of induced morphism on homology and cohomology of simplicial complex morphisms

archive/issues_006101.json:
```json
{
    "body": "Assignee: bantieau\n\nCC:  jhpalmieri nthiery simonking\n\nAdd functionality to sage to compute the effect of a simplicial complex morphism on homology and cohomology.\n\nThis patch will rely on fuctionality in #6099, #6100, and #5882.\n\nIssue created by migration from https://trac.sagemath.org/ticket/6101\n\n",
    "created_at": "2009-05-21T03:43:56Z",
    "labels": [
        "algebraic topology",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.10",
    "title": "computation of induced morphism on homology and cohomology of simplicial complex morphisms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/6101",
    "user": "bantieau"
}
```
Assignee: bantieau

CC:  jhpalmieri nthiery simonking

Add functionality to sage to compute the effect of a simplicial complex morphism on homology and cohomology.

This patch will rely on fuctionality in #6099, #6100, and #5882.

Issue created by migration from https://trac.sagemath.org/ticket/6101





---

archive/issue_comments_048681.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-09-10T22:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48681",
    "user": "jhpalmieri"
}
```

New commits:



---

archive/issue_comments_048682.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-10T22:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48682",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_048683.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2015-09-10T22:08:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48683",
    "user": "jhpalmieri"
}
```

Changing priority from minor to major.



---

archive/issue_comments_048684.json:
```json
{
    "body": "Hi John,\n\nThis seems pretty interesting. I just started to play around with it and was struck by a couple of minor usability issues: \n\n```\nsage: X=simplicial_complexes.BrucknerGrunbaumSphere()\nsage: phi, M = algebraic_topological_model(X, GF(2))\nsage: phi\nChain homotopy between Chain complex morphism from Chain complex with at most 4 nonzero terms over Finite Field of size 2 to Chain complex with at most 4 nonzero terms over Finite Field of size 2 and Chain complex morphism from Chain complex with at most 4 nonzero terms over Finite Field of size 2 to Chain complex with at most 4 nonzero terms over Finite Field of size 2\nsage: phi._codomain()\nTrivial chain\nsage: phi._domain()\nTrivial chain\nsage: phi._codomain() is phi._domain()\nFalse\n```\n\n\nAs you can see, I made the basic mistake of thinking of \"phi._domain\" as private functions, when they are in fact just attributes:\n\n```\nsage: phi._domain\nChain complex with at most 4 nonzero terms over Finite Field of size 2\nsage: phi._domain is phi._f._domain\nTrue\n```\n\nThe Sage maps that I'm used to (mainly morphisms between CombinatorialFreeModules) have public \"domain\" and \"codomain\" methods; this might have spared me a 5 minute detour in this case. I have no good idea, though, what to call the $H_0$ and $H_1$ of a homotopy $H_t$...  \n\nAlso, I wonder if phi shouldn't better be printed like\n\n```\nsage: phi\nChain homotopy between \n    Chain complex morphism \n      From: Chain complex with at most 4 nonzero terms over Finite Field of size 2\n      To:   Chain complex with at most 4 nonzero terms over Finite Field of size 2\nand Chain complex morphism\n      From: Chain complex with at most 4 nonzero terms over Finite Field of size 2\n      To:   Chain complex with at most 4 nonzero terms over Finite Field of size 2\n```\n\nAt least this is the way morphisms between combinatorial free modules are printed:\n\n```\nsage: A,B=[CombinatorialFreeModule(GF(2),x) for x in [(1,2,3),(2,3,4)]]\nsage: f=A.module_morphism(codomain=B,on_basis = lambda x:x+1) ; f\nGeneric morphism:\n  From: Free module generated by {1, 2, 3} over Finite Field of size 2\n  To:   Free module generated by {2, 3, 4} over Finite Field of size 2\n```\n",
    "created_at": "2015-09-11T08:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48684",
    "user": "cnassau"
}
```

Hi John,

This seems pretty interesting. I just started to play around with it and was struck by a couple of minor usability issues: 

```
sage: X=simplicial_complexes.BrucknerGrunbaumSphere()
sage: phi, M = algebraic_topological_model(X, GF(2))
sage: phi
Chain homotopy between Chain complex morphism from Chain complex with at most 4 nonzero terms over Finite Field of size 2 to Chain complex with at most 4 nonzero terms over Finite Field of size 2 and Chain complex morphism from Chain complex with at most 4 nonzero terms over Finite Field of size 2 to Chain complex with at most 4 nonzero terms over Finite Field of size 2
sage: phi._codomain()
Trivial chain
sage: phi._domain()
Trivial chain
sage: phi._codomain() is phi._domain()
False
```


As you can see, I made the basic mistake of thinking of "phi._domain" as private functions, when they are in fact just attributes:

```
sage: phi._domain
Chain complex with at most 4 nonzero terms over Finite Field of size 2
sage: phi._domain is phi._f._domain
True
```

The Sage maps that I'm used to (mainly morphisms between CombinatorialFreeModules) have public "domain" and "codomain" methods; this might have spared me a 5 minute detour in this case. I have no good idea, though, what to call the $H_0$ and $H_1$ of a homotopy $H_t$...  

Also, I wonder if phi shouldn't better be printed like

```
sage: phi
Chain homotopy between 
    Chain complex morphism 
      From: Chain complex with at most 4 nonzero terms over Finite Field of size 2
      To:   Chain complex with at most 4 nonzero terms over Finite Field of size 2
and Chain complex morphism
      From: Chain complex with at most 4 nonzero terms over Finite Field of size 2
      To:   Chain complex with at most 4 nonzero terms over Finite Field of size 2
```

At least this is the way morphisms between combinatorial free modules are printed:

```
sage: A,B=[CombinatorialFreeModule(GF(2),x) for x in [(1,2,3),(2,3,4)]]
sage: f=A.module_morphism(codomain=B,on_basis = lambda x:x+1) ; f
Generic morphism:
  From: Free module generated by {1, 2, 3} over Finite Field of size 2
  To:   Free module generated by {2, 3, 4} over Finite Field of size 2
```




---

archive/issue_comments_048685.json:
```json
{
    "body": "doc does not build\n\nWARNING: citation not found: G-DR",
    "created_at": "2015-09-11T11:36:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48685",
    "user": "chapoton"
}
```

doc does not build

WARNING: citation not found: G-DR



---

archive/issue_comments_048686.json:
```json
{
    "body": "Replying to [comment:11 chapoton]:\n> doc does not build\n> \n> WARNING: citation not found: G-DR\n\nSorry, that should be `G-DR03`. I'll fix it.",
    "created_at": "2015-09-11T15:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48686",
    "user": "jhpalmieri"
}
```

Replying to [comment:11 chapoton]:
> doc does not build
> 
> WARNING: citation not found: G-DR

Sorry, that should be `G-DR03`. I'll fix it.



---

archive/issue_comments_048687.json:
```json
{
    "body": "As Christian implied, you should use `.domain()` and `.codomain()` in the docstring and try to make thing behave like other morphisms as much as possible (anything inheriting from `Morphism` has some method like `_repr_defn` or similar).\n\nFor the record, this is on my todo list, but I don't know when I might be able to do a full review.",
    "created_at": "2015-09-11T15:20:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48687",
    "user": "tscrim"
}
```

As Christian implied, you should use `.domain()` and `.codomain()` in the docstring and try to make thing behave like other morphisms as much as possible (anything inheriting from `Morphism` has some method like `_repr_defn` or similar).

For the record, this is on my todo list, but I don't know when I might be able to do a full review.



---

archive/issue_comments_048688.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-11T15:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48688",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_048689.json:
```json
{
    "body": "Good suggestions, Christian. I've made some changes to try to address them.\n\nRegarding $H_0$ and $H_1$ (currently `._f` and `._g`), I don't know good names either, but I also almost never needed to use those attributes (only when constructing the dual chain homotopy).",
    "created_at": "2015-09-11T15:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48689",
    "user": "jhpalmieri"
}
```

Good suggestions, Christian. I've made some changes to try to address them.

Regarding $H_0$ and $H_1$ (currently `._f` and `._g`), I don't know good names either, but I also almost never needed to use those attributes (only when constructing the dual chain homotopy).



---

archive/issue_comments_048690.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-11T18:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48690",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_048691.json:
```json
{
    "body": "(Same commits as before, but I also put them on #19179 and #6102, where they really belong.)",
    "created_at": "2015-09-11T18:28:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48691",
    "user": "jhpalmieri"
}
```

(Same commits as before, but I also put them on #19179 and #6102, where they really belong.)



---

archive/issue_comments_048692.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-11T18:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48692",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_048693.json:
```json
{
    "body": "Replying to [comment:17 jhpalmieri]:\n> (Same commits as before, but I also put them on #19179 and #6102, where they really belong.)\n\nI'm a bit confused by these dependencies - what's the right place to start reviewing things: 6101, 6102, or 19179 ?",
    "created_at": "2015-09-11T20:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48693",
    "user": "cnassau"
}
```

Replying to [comment:17 jhpalmieri]:
> (Same commits as before, but I also put them on #19179 and #6102, where they really belong.)

I'm a bit confused by these dependencies - what's the right place to start reviewing things: 6101, 6102, or 19179 ?



---

archive/issue_comments_048694.json:
```json
{
    "body": "In principle, #19179 is first, then #6102, then this one. However, #19179 has one or two doctests that use things that aren't introduced until #6102, so they will fail. You can read the code there and run everything, though.\n\n#6102 should build and pass doctests, so it would come next (or jointly with #19179). This ticket comes last. The new code for this ticket should be all in the commit labeled \"trac 6101: maps in (co)homology induced by simplicial maps\".\n\nI suppose I should change the `_repr_` method for induced homology maps here, but not right now.",
    "created_at": "2015-09-11T21:12:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48694",
    "user": "jhpalmieri"
}
```

In principle, #19179 is first, then #6102, then this one. However, #19179 has one or two doctests that use things that aren't introduced until #6102, so they will fail. You can read the code there and run everything, though.

#6102 should build and pass doctests, so it would come next (or jointly with #19179). This ticket comes last. The new code for this ticket should be all in the commit labeled "trac 6101: maps in (co)homology induced by simplicial maps".

I suppose I should change the `_repr_` method for induced homology maps here, but not right now.



---

archive/issue_comments_048695.json:
```json
{
    "body": "Replying to [comment:15 jhpalmieri]:\n> Good suggestions, Christian. I've made some changes to try to address them.\n> \n> Regarding $H_0$ and $H_1$ (currently `._f` and `._g`), I don't know good names either, but I also almost never needed to use those attributes (only when constructing the dual chain homotopy).\n\nI wonder if we might use bracket-notation, so that a homotopy `H` goes from `H[0]` to `H[1]`? But I don't know if there are precedents in Sage for custom `__getitem__`, `__setitem__` methods. And I'm also not sure, whether there's a real need for this...",
    "created_at": "2015-09-12T08:46:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48695",
    "user": "cnassau"
}
```

Replying to [comment:15 jhpalmieri]:
> Good suggestions, Christian. I've made some changes to try to address them.
> 
> Regarding $H_0$ and $H_1$ (currently `._f` and `._g`), I don't know good names either, but I also almost never needed to use those attributes (only when constructing the dual chain homotopy).

I wonder if we might use bracket-notation, so that a homotopy `H` goes from `H[0]` to `H[1]`? But I don't know if there are precedents in Sage for custom `__getitem__`, `__setitem__` methods. And I'm also not sure, whether there's a real need for this...



---

archive/issue_comments_048696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-12T16:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48696",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_048697.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-09-14T15:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48697",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_048698.json:
```json
{
    "body": "Okay, last up is this ticket. A first question from a quick lookover is could we use `Morphism` as the base class?",
    "created_at": "2015-10-15T19:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48698",
    "user": "tscrim"
}
```

Okay, last up is this ticket. A first question from a quick lookover is could we use `Morphism` as the base class?



---

archive/issue_comments_048699.json:
```json
{
    "body": "This needs to be rebased on top of the most recent #6102. I'm working on it. I'll also look into using `Morphism`. Does that mean that we also change the already-existing `ChainComplexMorphism` and `SimplicialComplexMorphism`?",
    "created_at": "2015-10-15T20:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48699",
    "user": "jhpalmieri"
}
```

This needs to be rebased on top of the most recent #6102. I'm working on it. I'll also look into using `Morphism`. Does that mean that we also change the already-existing `ChainComplexMorphism` and `SimplicialComplexMorphism`?



---

archive/issue_comments_048700.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-10-15T20:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48700",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_048701.json:
```json
{
    "body": "Replying to [comment:25 jhpalmieri]:\n> I'll also look into using `Morphism`. Does that mean that we also change the already-existing `ChainComplexMorphism` and `SimplicialComplexMorphism`?\n\nIt gives us a little bit of extra features (like `register_as_coercion()`) and more consistent class hierarchy, but it isn't a requirement. It might also make things easier once homsets become proper parents too, but that is so far down the road that it's not worth it the worry either.",
    "created_at": "2015-10-15T22:15:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48701",
    "user": "tscrim"
}
```

Replying to [comment:25 jhpalmieri]:
> I'll also look into using `Morphism`. Does that mean that we also change the already-existing `ChainComplexMorphism` and `SimplicialComplexMorphism`?

It gives us a little bit of extra features (like `register_as_coercion()`) and more consistent class hierarchy, but it isn't a requirement. It might also make things easier once homsets become proper parents too, but that is so far down the road that it's not worth it the worry either.



---

archive/issue_comments_048702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-10-17T05:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48702",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_048703.json:
```json
{
    "body": "Okay, here's an attempt at using `Morphism`. I also used `Parent` for `SimplicialComplex` (instead of `CategoryObject`). The only issue with this is that the test suite for simplicial complexes fails unless I skip `_test_category`.",
    "created_at": "2015-10-17T05:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48703",
    "user": "jhpalmieri"
}
```

Okay, here's an attempt at using `Morphism`. I also used `Parent` for `SimplicialComplex` (instead of `CategoryObject`). The only issue with this is that the test suite for simplicial complexes fails unless I skip `_test_category`.



---

archive/issue_comments_048704.json:
```json
{
    "body": "Would you be opposed to basing this on #18175 (which should be positively reviewed soon I hope)? This might solve the issues with `_test_category`, but I suspect this is more due to a lack of an element class. If you were to use the category of (abstract) simplical complexes from #18175, the intent was that elements correspond to faces.\n\nI should also ask how you feel about using morphism, does it feel any more natural to do things this way or do you think that continuing to work on this isn't worth the time (at this stage)?",
    "created_at": "2015-10-17T15:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48704",
    "user": "tscrim"
}
```

Would you be opposed to basing this on #18175 (which should be positively reviewed soon I hope)? This might solve the issues with `_test_category`, but I suspect this is more due to a lack of an element class. If you were to use the category of (abstract) simplical complexes from #18175, the intent was that elements correspond to faces.

I should also ask how you feel about using morphism, does it feel any more natural to do things this way or do you think that continuing to work on this isn't worth the time (at this stage)?



---

archive/issue_comments_048705.json:
```json
{
    "body": "If I try to merge #18175, the test suite fails more tests than before:\n\n```\nThe following tests failed: _test_an_element, _test_elements, _test_elements_eq_reflexive, _test_elements_eq_symmetric, _test_elements_eq_transitive, _test_elements_neq, _test_some_elements\n```\n\nbecause\n\n```\nNotImplementedError: please implement _an_element_ for Simplicial complex ...\n```\n\nI'm not sure what `_an_element_` should return: a simplex (since a simplicial complex is a set of simplices)? a vertex (since their images determine maps)? a facet (since they determine the complex)?\n\nAs far as morphisms go, it was not hard to switch to them (assuming I did everything right).",
    "created_at": "2015-10-17T21:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48705",
    "user": "jhpalmieri"
}
```

If I try to merge #18175, the test suite fails more tests than before:

```
The following tests failed: _test_an_element, _test_elements, _test_elements_eq_reflexive, _test_elements_eq_symmetric, _test_elements_eq_transitive, _test_elements_neq, _test_some_elements
```

because

```
NotImplementedError: please implement _an_element_ for Simplicial complex ...
```

I'm not sure what `_an_element_` should return: a simplex (since a simplicial complex is a set of simplices)? a vertex (since their images determine maps)? a facet (since they determine the complex)?

As far as morphisms go, it was not hard to switch to them (assuming I did everything right).



---

archive/issue_comments_048706.json:
```json
{
    "body": "I would just have it return the first facet (and the empty simplex for the empty complex), but it just has to be any element of the parent object (which could include the empty simplex).",
    "created_at": "2015-10-17T21:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48706",
    "user": "tscrim"
}
```

I would just have it return the first facet (and the empty simplex for the empty complex), but it just has to be any element of the parent object (which could include the empty simplex).



---

archive/issue_comments_048707.json:
```json
{
    "body": "Going this route tempts me to make `Simplex` inherit from `Element`, but you might want to construct abstract instances of `Simplex` which are not elements of any particular complex. So I can't use the `Element.__init__` method, which requires setting a parent. As a result, I don't think I can use `_element_constructor_` for simplicial complexes. Instead, I can do something like this (plus doctests):\n\n```diff\ndiff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py\nindex 8d00cd6..366c1db 100644\n--- a/src/sage/homology/simplicial_complex.py\n+++ b/src/sage/homology/simplicial_complex.py\n@@ -1077,6 +1077,21 @@ class SimplicialComplex(Parent, GenericCellComplex):\n         \"\"\"\n         return self._vertex_set\n \n+    def _an_element_(self):\n+        return self.facets()[0]\n+\n+    def __contains__(self, x):\n+        if not isinstance(x, Simplex):\n+            return False\n+        dim = x.dimension()\n+        return x in self.n_faces(dim)\n+\n+    def __call__(self, simplex):    # not _element_constructor_\n+        if simplex not in self:\n+            raise ValueError\n+        return simplex\n+\n     def maximal_faces(self):\n         \"\"\"\n         The maximal faces (a.k.a. facets) of this simplicial complex.\n```\n\nThen the full test suite passes.",
    "created_at": "2015-10-17T21:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48707",
    "user": "jhpalmieri"
}
```

Going this route tempts me to make `Simplex` inherit from `Element`, but you might want to construct abstract instances of `Simplex` which are not elements of any particular complex. So I can't use the `Element.__init__` method, which requires setting a parent. As a result, I don't think I can use `_element_constructor_` for simplicial complexes. Instead, I can do something like this (plus doctests):

```diff
diff --git a/src/sage/homology/simplicial_complex.py b/src/sage/homology/simplicial_complex.py
index 8d00cd6..366c1db 100644
--- a/src/sage/homology/simplicial_complex.py
+++ b/src/sage/homology/simplicial_complex.py
@@ -1077,6 +1077,21 @@ class SimplicialComplex(Parent, GenericCellComplex):
         """
         return self._vertex_set
 
+    def _an_element_(self):
+        return self.facets()[0]
+
+    def __contains__(self, x):
+        if not isinstance(x, Simplex):
+            return False
+        dim = x.dimension()
+        return x in self.n_faces(dim)
+
+    def __call__(self, simplex):    # not _element_constructor_
+        if simplex not in self:
+            raise ValueError
+        return simplex
+
     def maximal_faces(self):
         """
         The maximal faces (a.k.a. facets) of this simplicial complex.
```

Then the full test suite passes.



---

archive/issue_comments_048708.json:
```json
{
    "body": "We can always subclass `Simplex` as something like `SimplexElement` and changing out some calls to `Simplex(data)` to `self.element_class(self, data)`. I wouldn't really want to overwrite `__call__` unless we really have to... I can also do some of the work for this changeover as well.",
    "created_at": "2015-10-17T21:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48708",
    "user": "tscrim"
}
```

We can always subclass `Simplex` as something like `SimplexElement` and changing out some calls to `Simplex(data)` to `self.element_class(self, data)`. I wouldn't really want to overwrite `__call__` unless we really have to... I can also do some of the work for this changeover as well.



---

archive/issue_comments_048709.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-10-17T22:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48709",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_048710.json:
```json
{
    "body": "I tried implementing `SimplexElement` and it turned into a real mess, so I gave up. Instead, here is my version using `__call__`.",
    "created_at": "2015-10-17T22:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48710",
    "user": "jhpalmieri"
}
```

I tried implementing `SimplexElement` and it turned into a real mess, so I gave up. Instead, here is my version using `__call__`.



---

archive/issue_comments_048711.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-10-17T22:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48711",
    "user": "jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_048712.json:
```json
{
    "body": "Oh, and I would welcome any help with this or other approaches.",
    "created_at": "2015-10-18T15:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48712",
    "user": "jhpalmieri"
}
```

Oh, and I would welcome any help with this or other approaches.



---

archive/issue_comments_048713.json:
```json
{
    "body": "I will work on this later this week.",
    "created_at": "2015-10-18T16:54:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48713",
    "user": "tscrim"
}
```

I will work on this later this week.



---

archive/issue_comments_048714.json:
```json
{
    "body": "Man...non hashable parents really throw a big wrench into the coercion framework. In some ways that is not surprising, as they get put into a big `dict` to store the necessary coercions, but I would have liked it to better handle non-hashable parents.\n\nWell, one of the problems that you had was `Element` tries to use coercion on elements which do not define rich comparisons, which caused problems until I changed `Simplex.__cmp__` to rich comparisons (I <3 `functools.total_ordering`). However, even with that change, I could not get the combination of `class Element(Simplex, Element)` in `SimplicialComplex` to pickle (granted, I did not try too hard). I think the problem is that `SimplicialComplex` is defined by a set of its elements, and we get a loop of sorts with the pickling...\n\nTherefore I decided to just add a warning message to `SimplicialComplex` instead. Simon, Nicolas, the reason I am cc-ing you is to make sure that this abuse of `Parent` is acceptable to you (or if you had any thoughts about the pickling issues). At least until a follow-up ticket takes care of things.\n----\nNew commits:",
    "created_at": "2015-10-20T13:48:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48714",
    "user": "tscrim"
}
```

Man...non hashable parents really throw a big wrench into the coercion framework. In some ways that is not surprising, as they get put into a big `dict` to store the necessary coercions, but I would have liked it to better handle non-hashable parents.

Well, one of the problems that you had was `Element` tries to use coercion on elements which do not define rich comparisons, which caused problems until I changed `Simplex.__cmp__` to rich comparisons (I <3 `functools.total_ordering`). However, even with that change, I could not get the combination of `class Element(Simplex, Element)` in `SimplicialComplex` to pickle (granted, I did not try too hard). I think the problem is that `SimplicialComplex` is defined by a set of its elements, and we get a loop of sorts with the pickling...

Therefore I decided to just add a warning message to `SimplicialComplex` instead. Simon, Nicolas, the reason I am cc-ing you is to make sure that this abuse of `Parent` is acceptable to you (or if you had any thoughts about the pickling issues). At least until a follow-up ticket takes care of things.
----
New commits:



---

archive/issue_comments_048715.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-22T18:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48715",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_048716.json:
```json
{
    "body": "John, if nobody objects to the current setup in a few days, then I think we should set this to positive review.",
    "created_at": "2015-10-24T22:45:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48716",
    "user": "tscrim"
}
```

John, if nobody objects to the current setup in a few days, then I think we should set this to positive review.



---

archive/issue_comments_048717.json:
```json
{
    "body": "Sounds great. I certainly don't have any objection to your warning.",
    "created_at": "2015-10-24T22:53:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48717",
    "user": "jhpalmieri"
}
```

Sounds great. I certainly don't have any objection to your warning.



---

archive/issue_comments_048718.json:
```json
{
    "body": "Okay, I think we've let enough time for a response pass. Feel free to set a positive review if you're still in agreement.",
    "created_at": "2015-10-28T02:18:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48718",
    "user": "tscrim"
}
```

Okay, I think we've let enough time for a response pass. Feel free to set a positive review if you're still in agreement.



---

archive/issue_comments_048719.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-28T03:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48719",
    "user": "jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_048720.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-28T17:59:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/6101",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/6101#issuecomment-48720",
    "user": "vbraun"
}
```

Resolution: fixed
