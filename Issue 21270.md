# Issue 21270: Make sagelib a PyPI package

archive/issues_021270.json:
```json
{
    "body": "CC:  @jdemeyer @williamstein @vbraun @videlec @dimpase @kiwifb @embray @nexttime aenge @nthiery @miguelmarco @kwankyu @robertwb @infinity0 @tobihan @defeo @slel @timokau @kevinywlui @isuruf @jhpalmieri\n\nThis is a task ticket organizing the steps necessary to eventually provide sagelib via PyPI.\n\nIt would be used by a Python user as follows. Let's assume a user has already installed every package that sage-the-distribution provides on their distribution.\nThen a simple\n\n```\n  pip install sagelib\n```\n\nwould install sagelib in the user's Python installation. Then the user could do `from sage.all import *`.\n\nHere are the steps:\n- #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`\n- Make `setup.py sdist` work\n- ...\n\nIssue created by migration from https://trac.sagemath.org/ticket/21507\n\n",
    "created_at": "2016-09-16T16:05:10Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Make sagelib a PyPI package",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21270",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @jdemeyer @williamstein @vbraun @videlec @dimpase @kiwifb @embray @nexttime aenge @nthiery @miguelmarco @kwankyu @robertwb @infinity0 @tobihan @defeo @slel @timokau @kevinywlui @isuruf @jhpalmieri

This is a task ticket organizing the steps necessary to eventually provide sagelib via PyPI.

It would be used by a Python user as follows. Let's assume a user has already installed every package that sage-the-distribution provides on their distribution.
Then a simple

```
  pip install sagelib
```

would install sagelib in the user's Python installation. Then the user could do `from sage.all import *`.

Here are the steps:
- #21480: Make `sagelib setup.py` self-contained, independent of `SAGE_ROOT`, and handle `--build-base`
- Make `setup.py sdist` work
- ...

Issue created by migration from https://trac.sagemath.org/ticket/21507





---

archive/issue_comments_294801.json:
```json
{
    "body": "Thanks for taking the lead on this.  There's more still be to added to the list of issues, such as providing binary wheels and how that will be handled.  I think it will be important to also make more progress on making some hard dependencies optional (that is, allow optional features to fail gracefully if a dependency for that feature is not found).",
    "created_at": "2016-09-22T15:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294801",
    "user": "https://github.com/embray"
}
```

Thanks for taking the lead on this.  There's more still be to added to the list of issues, such as providing binary wheels and how that will be handled.  I think it will be important to also make more progress on making some hard dependencies optional (that is, allow optional features to fail gracefully if a dependency for that feature is not found).



---

archive/issue_comments_294802.json:
```json
{
    "body": "Replying to [comment:10 embray]:\n> There's more still be to added to the list of issues, such as providing binary wheels and how that will be handled.  \n\nDefinitely. I'm hoping that we can use this ticket to organize it.\n\n> I think it will be important to also make more progress on making some hard dependencies optional (that is, allow optional features to fail gracefully if a dependency for that feature is not found).\n\nI agree.",
    "created_at": "2016-09-22T17:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294802",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 embray]:
> There's more still be to added to the list of issues, such as providing binary wheels and how that will be handled.  

Definitely. I'm hoping that we can use this ticket to organize it.

> I think it will be important to also make more progress on making some hard dependencies optional (that is, allow optional features to fail gracefully if a dependency for that feature is not found).

I agree.



---

archive/issue_comments_294803.json:
```json
{
    "body": "Here's a question for the distutils experts. Is a Python package allowed to install things in `bin/`? Do any other Python packages do that? \nWhere would one install helper scripts? Is there a Python equivalent of `$prefix/libexec`?",
    "created_at": "2016-09-22T19:29:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294803",
    "user": "https://github.com/mkoeppe"
}
```

Here's a question for the distutils experts. Is a Python package allowed to install things in `bin/`? Do any other Python packages do that? 
Where would one install helper scripts? Is there a Python equivalent of `$prefix/libexec`?



---

archive/issue_comments_294804.json:
```json
{
    "body": "This Python package, which is part of SMC, installs many things to /usr/local/bin using completely standard approaches: https://github.com/sagemathinc/smc/tree/master/src/smc_pyutil.  See, in particular, the console_scripts section of setup.py: https://github.com/sagemathinc/smc/blob/master/src/smc_pyutil/setup.py#L58",
    "created_at": "2016-09-22T20:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294804",
    "user": "https://github.com/williamstein"
}
```

This Python package, which is part of SMC, installs many things to /usr/local/bin using completely standard approaches: https://github.com/sagemathinc/smc/tree/master/src/smc_pyutil.  See, in particular, the console_scripts section of setup.py: https://github.com/sagemathinc/smc/blob/master/src/smc_pyutil/setup.py#L58



---

archive/issue_comments_294805.json:
```json
{
    "body": "Thanks a lot! Following your pointer, I've found this documentation: http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html, which I will refer to alongside the example that you pointed out.",
    "created_at": "2016-09-22T20:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294805",
    "user": "https://github.com/mkoeppe"
}
```

Thanks a lot! Following your pointer, I've found this documentation: http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html, which I will refer to alongside the example that you pointed out.



---

archive/issue_comments_294806.json:
```json
{
    "body": "This now #21569.",
    "created_at": "2016-09-22T22:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294806",
    "user": "https://github.com/mkoeppe"
}
```

This now #21569.



---

archive/issue_comments_294807.json:
```json
{
    "body": "I don't like the phrasing \"PyPI package\".  There's no such thing as a \"PyPI package\" per se.  \nLet's be more clear about what we want here--should it be buildable from a source package?  Or are we providing binary wheels?  Both? Neither?",
    "created_at": "2016-09-23T11:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294807",
    "user": "https://github.com/embray"
}
```

I don't like the phrasing "PyPI package".  There's no such thing as a "PyPI package" per se.  
Let's be more clear about what we want here--should it be buildable from a source package?  Or are we providing binary wheels?  Both? Neither?



---

archive/issue_comments_294808.json:
```json
{
    "body": "I wonder if this work might not also benefit from adopting portions of [astropy-helpers](https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers) into Sage's build tools.  I don't think it would necessarily be appropriate to use directly--although there's nothing very \"astropy\" specific in astropy-helpers, a lot of it does assume one is using the astropy project template, or something close to it.  But large swaths of it are very generic, and I put a lot of work into developing tools for build sanity of large Python projects.\n\nSome key features that I think might benefit sage include:\n\n* per-subpackage `setup_package.py` modules, which can contain any number of a [(mostly) well-documented](http://docs.astropy.org/en/stable/development/building.html#customizing-setup-build-for-subpackages) hooks for building compiled modules in that sub-package.  This provides a clear and explicit alternative to a monolithic module_list.py (see the discussion [here](https://github.com/cython/cython/pull/466#issuecomment-249185195)), and would also make it easier to break off some of Sage's subpackages into standalone packages should the time ever come for that.\n* one of the less-well-documented features is also that `setup_package.py` can contain hooks for setup.py commands.  For example, if a module contains some generated code (a la `sage_setup.autogen`), it can include a `pre_build_ext` hook to make sure the generated code is up to date before running the `./setup.py build_ext` command (either explicitly, or implicitly as a sub-command).  This makes it relatively easy for individual submodules to put hooks into the build process without having to write complicated command subclasses cluttered with subpackage-specific crud.\n* smarter handling of Cython modules--for example, when creating a source tarball it will make sure all Cython modules have been Cythonized, and it will include the resulting C/C++ sources in the source tarball.  This ensures that the user does not need Cython to be installed in order to build from source (which is good, because even if they do have Cython it will often be the wrong version--and in Sage's case missing important patches as well).\n\nThose are the main ones for now but I could probably think of more.",
    "created_at": "2016-09-23T13:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294808",
    "user": "https://github.com/embray"
}
```

I wonder if this work might not also benefit from adopting portions of [astropy-helpers](https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers) into Sage's build tools.  I don't think it would necessarily be appropriate to use directly--although there's nothing very "astropy" specific in astropy-helpers, a lot of it does assume one is using the astropy project template, or something close to it.  But large swaths of it are very generic, and I put a lot of work into developing tools for build sanity of large Python projects.

Some key features that I think might benefit sage include:

* per-subpackage `setup_package.py` modules, which can contain any number of a [(mostly) well-documented](http://docs.astropy.org/en/stable/development/building.html#customizing-setup-build-for-subpackages) hooks for building compiled modules in that sub-package.  This provides a clear and explicit alternative to a monolithic module_list.py (see the discussion [here](https://github.com/cython/cython/pull/466#issuecomment-249185195)), and would also make it easier to break off some of Sage's subpackages into standalone packages should the time ever come for that.
* one of the less-well-documented features is also that `setup_package.py` can contain hooks for setup.py commands.  For example, if a module contains some generated code (a la `sage_setup.autogen`), it can include a `pre_build_ext` hook to make sure the generated code is up to date before running the `./setup.py build_ext` command (either explicitly, or implicitly as a sub-command).  This makes it relatively easy for individual submodules to put hooks into the build process without having to write complicated command subclasses cluttered with subpackage-specific crud.
* smarter handling of Cython modules--for example, when creating a source tarball it will make sure all Cython modules have been Cythonized, and it will include the resulting C/C++ sources in the source tarball.  This ensures that the user does not need Cython to be installed in order to build from source (which is good, because even if they do have Cython it will often be the wrong version--and in Sage's case missing important patches as well).

Those are the main ones for now but I could probably think of more.



---

archive/issue_comments_294809.json:
```json
{
    "body": "Replying to [comment:21 embray]:\n> I don't like the phrasing \"PyPI package\".  There's no such thing as a \"PyPI package\" per se.  \n> Let's be more clear about what we want here--should it be buildable from a source package?  Or are we providing binary wheels?  Both? Neither?\n\nThe scope of this ticket is a source package that is pip-installable and would be listed as such on PyPI.\n\nBinary packaging (about which I don't know anything at the moment) is beyond the scope of this ticket.",
    "created_at": "2016-09-23T15:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294809",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:21 embray]:
> I don't like the phrasing "PyPI package".  There's no such thing as a "PyPI package" per se.  
> Let's be more clear about what we want here--should it be buildable from a source package?  Or are we providing binary wheels?  Both? Neither?

The scope of this ticket is a source package that is pip-installable and would be listed as such on PyPI.

Binary packaging (about which I don't know anything at the moment) is beyond the scope of this ticket.



---

archive/issue_comments_294810.json:
```json
{
    "body": "Replying to [comment:22 embray]:\n> I wonder if this work might not also benefit from adopting portions of [astropy-helpers](https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers) into Sage's build tools.  \n\nThis all sounds great and seems like it could be part of #21508 or be a follow up to it.",
    "created_at": "2016-09-23T15:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294810",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:22 embray]:
> I wonder if this work might not also benefit from adopting portions of [astropy-helpers](https://github.com/astropy/astropy-helpers/tree/master/astropy_helpers) into Sage's build tools.  

This all sounds great and seems like it could be part of #21508 or be a follow up to it.



---

archive/issue_comments_294811.json:
```json
{
    "body": "I've updated the description to explain the scope of the ticket better.",
    "created_at": "2016-09-23T17:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294811",
    "user": "https://github.com/mkoeppe"
}
```

I've updated the description to explain the scope of the ticket better.



---

archive/issue_comments_294812.json:
```json
{
    "body": "I have a request: currently the sage kernel for `jupyter` is created directly in place on the file system rather than being \"installed\". Similarly there are 3 links created by the `jupyter` kernel installation. That's not ideal from a distro point of view, and I am not sure that's acceptable from `pip` point of view.",
    "created_at": "2016-10-23T07:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294812",
    "user": "https://github.com/kiwifb"
}
```

I have a request: currently the sage kernel for `jupyter` is created directly in place on the file system rather than being "installed". Similarly there are 3 links created by the `jupyter` kernel installation. That's not ideal from a distro point of view, and I am not sure that's acceptable from `pip` point of view.



---

archive/issue_comments_294813.json:
```json
{
    "body": "Replying to [comment:31 fbissey]:\n> That's not ideal from a distro point of view, and I am not sure that's acceptable from `pip` point of view.\n\nCan you elaborate why that is an issue?",
    "created_at": "2016-10-23T09:31:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294813",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:31 fbissey]:
> That's not ideal from a distro point of view, and I am not sure that's acceptable from `pip` point of view.

Can you elaborate why that is an issue?



---

archive/issue_comments_294814.json:
```json
{
    "body": "Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root. At no point you do something to the live system before the \"merge\", moving the staged install to the live file system.\n\nI know we had some discussion when the current mechanic has been put in place as part of the install phase, unfortunately it doesn't obey --root. I will run a new check since it's been a while since I hit this.\n\nPrior to 7.5.beta0 I have been patching to build `kernel.json` and then install it with python_package_data. I have decided that the patching to `setup.py` would be to invasive now and currently in 7.5.beta0+ I install manually at the package manager level.",
    "created_at": "2016-10-23T09:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294814",
    "user": "https://github.com/kiwifb"
}
```

Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root. At no point you do something to the live system before the "merge", moving the staged install to the live file system.

I know we had some discussion when the current mechanic has been put in place as part of the install phase, unfortunately it doesn't obey --root. I will run a new check since it's been a while since I hit this.

Prior to 7.5.beta0 I have been patching to build `kernel.json` and then install it with python_package_data. I have decided that the patching to `setup.py` would be to invasive now and currently in 7.5.beta0+ I install manually at the package manager level.



---

archive/issue_comments_294815.json:
```json
{
    "body": "Replying to [comment:33 fbissey]:\n> Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root. At no point you do something to the live system before the \"merge\", moving the staged install to the live file system.\n> \n> I know we had some discussion when the current mechanic has been put in place as part of the install phase, unfortunately it doesn't obey --root. I will run a new check since it's been a while since I hit this.\n> \n> Prior to 7.5.beta0 I have been patching to build `kernel.json` and then install it with python_package_data. I have decided that the patching to `setup.py` would be to invasive now and currently in 7.5.beta0+ I install manually at the package manager level.\n\nSorry, but I don't see how the above is an answer to my question.",
    "created_at": "2016-10-23T09:54:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294815",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:33 fbissey]:
> Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root. At no point you do something to the live system before the "merge", moving the staged install to the live file system.
> 
> I know we had some discussion when the current mechanic has been put in place as part of the install phase, unfortunately it doesn't obey --root. I will run a new check since it's been a while since I hit this.
> 
> Prior to 7.5.beta0 I have been patching to build `kernel.json` and then install it with python_package_data. I have decided that the patching to `setup.py` would be to invasive now and currently in 7.5.beta0+ I install manually at the package manager level.

Sorry, but I don't see how the above is an answer to my question.



---

archive/issue_comments_294816.json:
```json
{
    "body": "...or maybe the problem is that the kernel spec is generated during the *install* phase.\n\nThen the problem is not the fact that it is generated, but *when* it is generated.",
    "created_at": "2016-10-23T09:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294816",
    "user": "https://github.com/jdemeyer"
}
```

...or maybe the problem is that the kernel spec is generated during the *install* phase.

Then the problem is not the fact that it is generated, but *when* it is generated.



---

archive/issue_comments_294817.json:
```json
{
    "body": "Replying to [comment:33 fbissey]:\n> Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root.\n\nJust to make me understand better, what are the commands that you would typically run to install a Python package this way?",
    "created_at": "2016-10-23T09:57:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294817",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:33 fbissey]:
> Very simple. From a distro point of view (and good build system), you only build in a sandbox isolated from the main system. Then you stage your installation, if you are using autotools, by using DESTDIR, if using setup.py usually with --root.

Just to make me understand better, what are the commands that you would typically run to install a Python package this way?



---

archive/issue_comments_294818.json:
```json
{
    "body": "Would be worse during the build phase\n\n```\n        self.kernel_dir = os.path.join(JUPYTER_PATH, \"kernels\", self.identifier())\n```\n\nthat's straight on the file system.\n\nFor the installation, instead of just doing `python setup.py install` you do `python setup.py install --root=$DESTDIR`. It's supposed to do the same thing than using `DESTDIR` in autotool, everything will be installed as it normally should except that all the paths will be prefixed with DESTDIR.",
    "created_at": "2016-10-23T10:02:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294818",
    "user": "https://github.com/kiwifb"
}
```

Would be worse during the build phase

```
        self.kernel_dir = os.path.join(JUPYTER_PATH, "kernels", self.identifier())
```

that's straight on the file system.

For the installation, instead of just doing `python setup.py install` you do `python setup.py install --root=$DESTDIR`. It's supposed to do the same thing than using `DESTDIR` in autotool, everything will be installed as it normally should except that all the paths will be prefixed with DESTDIR.



---

archive/issue_comments_294819.json:
```json
{
    "body": "Replying to [comment:37 fbissey]:\n> For the installation, instead of just doing `python setup.py install` you do `python setup.py install --root=$DESTDIR`.\n\nAnd why does it make a difference then whether the kernel spec files are generated or copied during that `install` step? I am a bit lost here...",
    "created_at": "2016-10-23T10:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294819",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:37 fbissey]:
> For the installation, instead of just doing `python setup.py install` you do `python setup.py install --root=$DESTDIR`.

And why does it make a difference then whether the kernel spec files are generated or copied during that `install` step? I am a bit lost here...



---

archive/issue_comments_294820.json:
```json
{
    "body": "The problem is that it created directly on the file system rather than in `DESTDIR`, not a problem for sage the distribution but a pain in the ass for the other people\n\n```\n>>> Install sage-9999 into /scratch2/portage/sci-mathematics/sage-9999/image/ category sci-mathematics\n * python2_7: running distutils-r1_run_phase distutils-r1_python_install\n/usr/bin/python2.7 setup.py install --root=/scratch2/portage/sci-mathematics/sage-9999/image/_python2.7\nmake: Nothing to be done for 'all'.\n....\n....\nbyte-compiling /scratch2/portage/sci-mathematics/sage-9999/image/_python2.7/usr/lib64/python2.7/site-packages/sage/structure/all.py to all.pyc\nwriting byte-compilation script '/scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py'\n/usr/bin/python2.7 -OO /scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py\nremoving /scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py\nrunning install_egg_info\nWriting /scratch2/portage/sci-mathematics/sage-9999/image/_python2.7/usr/lib64/python2.7/site-packages/sage-9999-py2.7.egg-info\nerror: [Errno 13] Permission denied: '/usr/share/jupyter/kernels/sagemath/kernel.json'\n```\n\nThe correct jargon for this is \"sandbox violation\", the build process is not supposed to write on the live file system at this stage.",
    "created_at": "2016-10-23T10:20:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294820",
    "user": "https://github.com/kiwifb"
}
```

The problem is that it created directly on the file system rather than in `DESTDIR`, not a problem for sage the distribution but a pain in the ass for the other people

```
>>> Install sage-9999 into /scratch2/portage/sci-mathematics/sage-9999/image/ category sci-mathematics
 * python2_7: running distutils-r1_run_phase distutils-r1_python_install
/usr/bin/python2.7 setup.py install --root=/scratch2/portage/sci-mathematics/sage-9999/image/_python2.7
make: Nothing to be done for 'all'.
....
....
byte-compiling /scratch2/portage/sci-mathematics/sage-9999/image/_python2.7/usr/lib64/python2.7/site-packages/sage/structure/all.py to all.pyc
writing byte-compilation script '/scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py'
/usr/bin/python2.7 -OO /scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py
removing /scratch2/portage/sci-mathematics/sage-9999/temp/tmpoErZMu.py
running install_egg_info
Writing /scratch2/portage/sci-mathematics/sage-9999/image/_python2.7/usr/lib64/python2.7/site-packages/sage-9999-py2.7.egg-info
error: [Errno 13] Permission denied: '/usr/share/jupyter/kernels/sagemath/kernel.json'
```

The correct jargon for this is "sandbox violation", the build process is not supposed to write on the live file system at this stage.



---

archive/issue_comments_294821.json:
```json
{
    "body": "In that case, I would prefer to fix the problem by *generating* the files in the correct place. That should not be so hard, feel free to create a ticket for that.",
    "created_at": "2016-10-23T10:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294821",
    "user": "https://github.com/jdemeyer"
}
```

In that case, I would prefer to fix the problem by *generating* the files in the correct place. That should not be so hard, feel free to create a ticket for that.



---

archive/issue_comments_294822.json:
```json
{
    "body": "I wish, `--root` is not very well documented as far as I can see. `DESTDIR` is quite easy we know the variable name. I am not sure there is a real equivalent variable for `setup.py`, otherwise I would have filled a trivial ticket long ago. I'll look again.",
    "created_at": "2016-10-23T10:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294822",
    "user": "https://github.com/kiwifb"
}
```

I wish, `--root` is not very well documented as far as I can see. `DESTDIR` is quite easy we know the variable name. I am not sure there is a real equivalent variable for `setup.py`, otherwise I would have filled a trivial ticket long ago. I'll look again.



---

archive/issue_comments_294823.json:
```json
{
    "body": "I think the distinction of when or how the file is generated is mostly irrelevant, but fbissey is right that it should be generated in the right location, and not directly to JUPYTER_PATH.",
    "created_at": "2016-11-07T13:44:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294823",
    "user": "https://github.com/embray"
}
```

I think the distinction of when or how the file is generated is mostly irrelevant, but fbissey is right that it should be generated in the right location, and not directly to JUPYTER_PATH.



---

archive/issue_comments_294824.json:
```json
{
    "body": "Replying to [comment:45 embray]:\n> I think the distinction of when or how the file is generated is mostly irrelevant, but fbissey is right that it should be generated in the right location, and not directly to JUPYTER_PATH.\n\nThat would be OK if it was done relative to the argument of `--root`, you wouldn't know how to get to that Erik? I meant to look it up deeper but stuff is piling on me.",
    "created_at": "2016-11-07T19:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294824",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:45 embray]:
> I think the distinction of when or how the file is generated is mostly irrelevant, but fbissey is right that it should be generated in the right location, and not directly to JUPYTER_PATH.

That would be OK if it was done relative to the argument of `--root`, you wouldn't know how to get to that Erik? I meant to look it up deeper but stuff is piling on me.



---

archive/issue_comments_294825.json:
```json
{
    "body": "Yeah, I'd be willing to look into it.  There should maybe be yet another ticket opened specifically for this issue.",
    "created_at": "2016-11-08T11:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294825",
    "user": "https://github.com/embray"
}
```

Yeah, I'd be willing to look into it.  There should maybe be yet another ticket opened specifically for this issue.



---

archive/issue_comments_294826.json:
```json
{
    "body": "Changing keywords from \"\" to \"pip, PyPI\".",
    "created_at": "2018-02-14T10:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294826",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "pip, PyPI".



---

archive/issue_comments_294827.json:
```json
{
    "body": "There is interest in this process, see\n[Ask Sage #40947: SageMath as a regular python package](https://ask.sagemath.org/question/40947/sagemath-as-a-regular-python-package/).",
    "created_at": "2018-02-14T10:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294827",
    "user": "https://github.com/slel"
}
```

There is interest in this process, see
[Ask Sage #40947: SageMath as a regular python package](https://ask.sagemath.org/question/40947/sagemath-as-a-regular-python-package/).



---

archive/issue_comments_294828.json:
```json
{
    "body": "Added #25546",
    "created_at": "2018-06-08T18:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294828",
    "user": "https://github.com/jdemeyer"
}
```

Added #25546



---

archive/issue_comments_294829.json:
```json
{
    "body": "I propose that we get this task ticket done in 2020.",
    "created_at": "2020-01-18T18:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294829",
    "user": "https://github.com/mkoeppe"
}
```

I propose that we get this task ticket done in 2020.



---

archive/issue_comments_294830.json:
```json
{
    "body": "The major problem I feel with making something like Sage into a python package is owing to the enormous complexity of Sagemath, the application itself has such major features , and I am not sure how much would we need to modify the application in order to help the proper incorporation of Sage into ordinary python code.",
    "created_at": "2020-03-21T05:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294830",
    "user": "https://github.com/Shlokatadistance"
}
```

The major problem I feel with making something like Sage into a python package is owing to the enormous complexity of Sagemath, the application itself has such major features , and I am not sure how much would we need to modify the application in order to help the proper incorporation of Sage into ordinary python code.



---

archive/issue_comments_294831.json:
```json
{
    "body": "Yes, the complexity is why we use a meta-ticket to organize the necessary steps.\n\nIf you want to help, you can work on a well-defined ticket such as #21516.",
    "created_at": "2020-03-21T13:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294831",
    "user": "https://github.com/mkoeppe"
}
```

Yes, the complexity is why we use a meta-ticket to organize the necessary steps.

If you want to help, you can work on a well-defined ticket such as #21516.



---

archive/issue_comments_294832.json:
```json
{
    "body": "Hi sorry for the delay, I'll start working on this right away\nReplying to [comment:62 mkoeppe]:\n> Yes, the complexity is why we use a meta-ticket to organize the necessary steps.\n> \n> If you want to help, you can work on a well-defined ticket such as #21516.",
    "created_at": "2020-03-30T05:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294832",
    "user": "https://github.com/Shlokatadistance"
}
```

Hi sorry for the delay, I'll start working on this right away
Replying to [comment:62 mkoeppe]:
> Yes, the complexity is why we use a meta-ticket to organize the necessary steps.
> 
> If you want to help, you can work on a well-defined ticket such as #21516.



---

archive/issue_comments_294833.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-26T21:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294833",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_294834.json:
```json
{
    "body": "Let's close this ticket. Meta-ticket #29705 describes the updated plan.",
    "created_at": "2020-10-26T21:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294834",
    "user": "https://github.com/mkoeppe"
}
```

Let's close this ticket. Meta-ticket #29705 describes the updated plan.



---

archive/issue_comments_294835.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-27T07:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294835",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_294836.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-06-13T06:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21270",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21270#issuecomment-294836",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
