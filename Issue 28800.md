# Issue 28800: cached_method does not work when the result of the method is None

Issue created by migration from https://trac.sagemath.org/ticket/29037

Original creator: tscrim

Original creation time: 2020-01-18 15:08:13

CC:  jdemeyer simonking saraedum klee

Keywords: cached method


```
sage: class Foo(object):
....:     def __init__(self):
....:         self.x = None
....:     @cached_method
....:     def bar(self):
....:         if self.x is None:
....:             return None
....:         return 5
....:     
sage: f = Foo()
sage: f.bar()
sage: f.x = -2
sage: f.bar()
5
sage: class Foo2(object):
....:     def __init__(self):
....:         self.x = None
....:     @cached_method
....:     def bar(self):
....:         if self.x is None:
....:             return -1
....:         return 5
....:     
sage: f2 = Foo2()
sage: f2.bar()
-1
sage: f2.x = 0
sage: f2.bar()
-1
```

Sometimes it is useful to do a long computation and return `None` (say, because you realize something is impossible) and then store that computation. Furthermore, this is not a documented special case AFAIK, so even if we do not change the behavior, we need to add it to the documentation.


---

Comment by SimonKing created at 2020-01-18 15:12:25

Replying to [ticket:29037 tscrim]:
> Sometimes it is useful to do a long computation and return `None` (say, because you realize something is impossible) and then store that computation. Furthermore, this is not a documented special case AFAIK...

Yes it is documented:

```python
cdef class CachedMethodCallerNoArgs(CachedFunction):
    """
    Utility class that is used by :class:`CachedMethod` to bind a
    cached method to an instance, in the case of a method that does
    not accept any arguments except ``self``.

    .. NOTE::

        The return value ``None`` would not be cached. So, if you have
        a method that does not accept arguments and may return ``None``
        after a lengthy computation, then ``@cached_method`` should not
        be used.
...
```



---

Comment by tscrim created at 2020-01-18 15:15:00

I see; I didn't think of looking there. Perhaps we can make that more prominent, perhaps in the `cached_method` decorator?


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
