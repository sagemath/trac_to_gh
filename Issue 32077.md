# Issue 32077: passing a generator to gcd() fails

archive/issues_032077.json:
```json
{
    "body": "Keywords: gcd, generator, list\n\nThe following use of `gcd()` fails:\n\n```\nsage: gcd(x for x in [123,456,789])\n# ...\nTypeError: object of type 'generator' has no len()\n```\n\n\nAt the same time, `lcm()` works fine with generators:\n\n```\nsage: lcm(x for x in [123,456,789])\n4917048\n```\n\n\nThe proposed fix is to make sure we consume the generator only once in `gcd()`, and enforce the type in `GCD_list()` before `len()` is called.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32314\n\n",
    "created_at": "2021-07-30T15:08:58Z",
    "labels": [
        "basic arithmetic",
        "minor",
        "bug"
    ],
    "title": "passing a generator to gcd() fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32077",
    "user": "lorenz"
}
```
Keywords: gcd, generator, list

The following use of `gcd()` fails:

```
sage: gcd(x for x in [123,456,789])
# ...
TypeError: object of type 'generator' has no len()
```


At the same time, `lcm()` works fine with generators:

```
sage: lcm(x for x in [123,456,789])
4917048
```


The proposed fix is to make sure we consume the generator only once in `gcd()`, and enforce the type in `GCD_list()` before `len()` is called.

Issue created by migration from https://trac.sagemath.org/ticket/32314





---

archive/issue_comments_458008.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-30T15:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458008",
    "user": "lorenz"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_458009.json:
```json
{
    "body": "It seems this \n\n```diff\n     if seq.universe() is ZZ:\n-        return GCD_list(a)\n+        return GCD_list(seq)\n     else:\n         return __GCD_sequence(seq, **kwargs)\n```\n\nis enough to fix the bug, and enforcing the type in `GCD_list()` is not necessary. Is it?",
    "created_at": "2021-08-06T02:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458009",
    "user": "klee"
}
```

It seems this 

```diff
     if seq.universe() is ZZ:
-        return GCD_list(a)
+        return GCD_list(seq)
     else:
         return __GCD_sequence(seq, **kwargs)
```

is enough to fix the bug, and enforcing the type in `GCD_list()` is not necessary. Is it?



---

archive/issue_comments_458010.json:
```json
{
    "body": "You're right. I moved the `list` cast in `GCD_list` to an earlier time because `GCD_list` was also failing on generators due to the `len()` call, but that could be considered intended. I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).",
    "created_at": "2021-08-06T03:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458010",
    "user": "lorenz"
}
```

You're right. I moved the `list` cast in `GCD_list` to an earlier time because `GCD_list` was also failing on generators due to the `len()` call, but that could be considered intended. I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).



---

archive/issue_comments_458011.json:
```json
{
    "body": "Replying to [comment:3 lorenz]:\n> I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).\n\nI prefer it because of the performance degradation.",
    "created_at": "2021-08-06T10:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458011",
    "user": "klee"
}
```

Replying to [comment:3 lorenz]:
> I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).

I prefer it because of the performance degradation.



---

archive/issue_comments_458012.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-06T11:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458012",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_458013.json:
```json
{
    "body": "Done.",
    "created_at": "2021-08-06T11:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458013",
    "user": "lorenz"
}
```

Done.



---

archive/issue_comments_458014.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-07T02:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458014",
    "user": "klee"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_458015.json:
```json
{
    "body": "LGTM",
    "created_at": "2021-08-07T02:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458015",
    "user": "klee"
}
```

LGTM



---

archive/issue_comments_458016.json:
```json
{
    "body": "what about the necessary new doctest ?",
    "created_at": "2021-08-07T06:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458016",
    "user": "chapoton"
}
```

what about the necessary new doctest ?



---

archive/issue_comments_458017.json:
```json
{
    "body": "Replying to [comment:9 chapoton]:\n> what about the necessary new doctest ?\n\nFeel free to set it back to needs work if you think a doctest is required.",
    "created_at": "2021-08-07T08:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458017",
    "user": "klee"
}
```

Replying to [comment:9 chapoton]:
> what about the necessary new doctest ?

Feel free to set it back to needs work if you think a doctest is required.



---

archive/issue_comments_458018.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-458018",
    "user": "vbraun"
}
```

Resolution: fixed
