# Issue 32077: passing a generator to gcd() fails

archive/issues_032077.json:
```json
{
    "body": "Keywords: gcd, generator, list\n\nThe following use of `gcd()` fails:\n\n```\nsage: gcd(x for x in [123,456,789])\n# ...\nTypeError: object of type 'generator' has no len()\n```\n\n\nAt the same time, `lcm()` works fine with generators:\n\n```\nsage: lcm(x for x in [123,456,789])\n4917048\n```\n\n\nThe proposed fix is to make sure we consume the generator only once in `gcd()`, and enforce the type in `GCD_list()` before `len()` is called.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32314\n\n",
    "created_at": "2021-07-30T15:08:58Z",
    "labels": [
        "component: basic arithmetic",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "passing a generator to gcd() fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32077",
    "user": "https://github.com/yyyyx4"
}
```
Keywords: gcd, generator, list

The following use of `gcd()` fails:

```
sage: gcd(x for x in [123,456,789])
# ...
TypeError: object of type 'generator' has no len()
```


At the same time, `lcm()` works fine with generators:

```
sage: lcm(x for x in [123,456,789])
4917048
```


The proposed fix is to make sure we consume the generator only once in `gcd()`, and enforce the type in `GCD_list()` before `len()` is called.

Issue created by migration from https://trac.sagemath.org/ticket/32314





---

archive/issue_comments_457453.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-30T15:09:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457453",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_457454.json:
```json
{
    "body": "It seems this \n\n```diff\n     if seq.universe() is ZZ:\n-        return GCD_list(a)\n+        return GCD_list(seq)\n     else:\n         return __GCD_sequence(seq, **kwargs)\n```\n\nis enough to fix the bug, and enforcing the type in `GCD_list()` is not necessary. Is it?",
    "created_at": "2021-08-06T02:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457454",
    "user": "https://github.com/kwankyu"
}
```

It seems this 

```diff
     if seq.universe() is ZZ:
-        return GCD_list(a)
+        return GCD_list(seq)
     else:
         return __GCD_sequence(seq, **kwargs)
```

is enough to fix the bug, and enforcing the type in `GCD_list()` is not necessary. Is it?



---

archive/issue_comments_457455.json:
```json
{
    "body": "You're right. I moved the `list` cast in `GCD_list` to an earlier time because `GCD_list` was also failing on generators due to the `len()` call, but that could be considered intended. I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).",
    "created_at": "2021-08-06T03:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457455",
    "user": "https://github.com/yyyyx4"
}
```

You're right. I moved the `list` cast in `GCD_list` to an earlier time because `GCD_list` was also failing on generators due to the `len()` call, but that could be considered intended. I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).



---

archive/issue_comments_457456.json:
```json
{
    "body": "Replying to [comment:3 lorenz]:\n> I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).\n\nI prefer it because of the performance degradation.",
    "created_at": "2021-08-06T10:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457456",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:3 lorenz]:
> I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).

I prefer it because of the performance degradation.



---

archive/issue_comments_457457.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-06T11:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457457",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_457458.json:
```json
{
    "body": "Done.",
    "created_at": "2021-08-06T11:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457458",
    "user": "https://github.com/yyyyx4"
}
```

Done.



---

archive/issue_comments_457459.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-07T02:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457459",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_457460.json:
```json
{
    "body": "LGTM",
    "created_at": "2021-08-07T02:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457460",
    "user": "https://github.com/kwankyu"
}
```

LGTM



---

archive/issue_comments_457461.json:
```json
{
    "body": "what about the necessary new doctest ?",
    "created_at": "2021-08-07T06:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457461",
    "user": "https://github.com/fchapoton"
}
```

what about the necessary new doctest ?



---

archive/issue_comments_457462.json:
```json
{
    "body": "Replying to [comment:9 chapoton]:\n> what about the necessary new doctest ?\n\nFeel free to set it back to needs work if you think a doctest is required.",
    "created_at": "2021-08-07T08:43:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457462",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:9 chapoton]:
> what about the necessary new doctest ?

Feel free to set it back to needs work if you think a doctest is required.



---

archive/issue_events_029147.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2021-10-19T20:30:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32077#event-29147"
}
```



---

archive/issue_comments_457463.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-19T20:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32077",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32077#issuecomment-457463",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
