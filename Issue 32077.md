# Issue 32077: passing a generator to gcd() fails

Issue created by migration from https://trac.sagemath.org/ticket/32314

Original creator: lorenz

Original creation time: 2021-07-30 15:08:58

Keywords: gcd, generator, list

The following use of `gcd()` fails:

```
sage: gcd(x for x in [123,456,789])
# ...
TypeError: object of type 'generator' has no len()
```


At the same time, `lcm()` works fine with generators:

```
sage: lcm(x for x in [123,456,789])
4917048
```


The proposed fix is to make sure we consume the generator only once in `gcd()`, and enforce the type in `GCD_list()` before `len()` is called.


---

Comment by lorenz created at 2021-07-30 15:09:13

Changing status from new to needs_review.


---

Comment by klee created at 2021-08-06 02:18:41

It seems this 

```diff
     if seq.universe() is ZZ:
-        return GCD_list(a)
+        return GCD_list(seq)
     else:
         return __GCD_sequence(seq, **kwargs)
```

is enough to fix the bug, and enforcing the type in `GCD_list()` is not necessary. Is it?


---

Comment by lorenz created at 2021-08-06 03:12:48

You're right. I moved the `list` cast in `GCD_list` to an earlier time because `GCD_list` was also failing on generators due to the `len()` call, but that could be considered intended. I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).


---

Comment by klee created at 2021-08-06 10:27:11

Replying to [comment:3 lorenz]:
> I can change it back if you prefer (I agree that there might be a tiny performance impact in some cases, like when you pass a massive `tuple` full of `Integer`s).

I prefer it because of the performance degradation.


---

Comment by git created at 2021-08-06 11:55:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2021-08-06 11:55:59

Done.


---

Comment by klee created at 2021-08-07 02:30:05

Changing status from needs_review to positive_review.


---

Comment by klee created at 2021-08-07 02:30:05

LGTM


---

Comment by chapoton created at 2021-08-07 06:51:19

what about the necessary new doctest ?


---

Comment by klee created at 2021-08-07 08:43:48

Replying to [comment:9 chapoton]:
> what about the necessary new doctest ?

Feel free to set it back to needs work if you think a doctest is required.


---

Comment by vbraun created at 2021-10-19 20:30:47

Resolution: fixed
