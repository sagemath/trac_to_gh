# Issue 12388: Artin Hasse Exponential

archive/issues_012388.json:
```json
{
    "body": "Assignee: roed\n\nCC:  caruso spancratz\n\nadd Artin Hasse Exponential to Zp and Qp\n\nIssue created by migration from https://trac.sagemath.org/ticket/12560\n\n",
    "created_at": "2012-02-22T08:49:51Z",
    "labels": [
        "padics",
        "major",
        "enhancement"
    ],
    "title": "Artin Hasse Exponential",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12388",
    "user": "magfrump"
}
```
Assignee: roed

CC:  caruso spancratz

add Artin Hasse Exponential to Zp and Qp

Issue created by migration from https://trac.sagemath.org/ticket/12560





---

archive/issue_comments_146162.json:
```json
{
    "body": "Attachment [12560.patch](tarball://root/attachments/some-uuid/ticket12560/12560.patch) by magfrump created at 2012-02-22 09:05:59",
    "created_at": "2012-02-22T09:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146162",
    "user": "magfrump"
}
```

Attachment [12560.patch](tarball://root/attachments/some-uuid/ticket12560/12560.patch) by magfrump created at 2012-02-22 09:05:59



---

archive/issue_comments_146163.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-22T09:07:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146163",
    "user": "magfrump"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_146164.json:
```json
{
    "body": "Two points, one trivial and one not:\n\n(1) Shouldn't it be \"Artin-Hasse exponential\" and not \"Artin Hasse Exponential\"?\n\n(2) There really aren't any tests which demonstrate that what the function returns is actually the A-H exp, as opposed to some other similar-looking element in the ring.  Probably there should be something in TESTS: which verifies some known properties.",
    "created_at": "2012-02-22T16:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146164",
    "user": "dsm"
}
```

Two points, one trivial and one not:

(1) Shouldn't it be "Artin-Hasse exponential" and not "Artin Hasse Exponential"?

(2) There really aren't any tests which demonstrate that what the function returns is actually the A-H exp, as opposed to some other similar-looking element in the ring.  Probably there should be something in TESTS: which verifies some known properties.



---

archive/issue_comments_146165.json:
```json
{
    "body": "(1) agreed\n\n(2) also agreed, I'm planning to add some doctests to that effect today.",
    "created_at": "2012-02-22T21:35:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146165",
    "user": "magfrump"
}
```

(1) agreed

(2) also agreed, I'm planning to add some doctests to that effect today.



---

archive/issue_comments_146166.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-25T22:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146166",
    "user": "dsm"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_146167.json:
```json
{
    "body": "Ping. This looks like low-hanging fruit; it just needs some more convincing doctests.",
    "created_at": "2016-08-19T22:02:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146167",
    "user": "kedlaya"
}
```

Ping. This looks like low-hanging fruit; it just needs some more convincing doctests.



---

archive/issue_comments_146168.json:
```json
{
    "body": "I made a branch, and refreshed it, but did not manage to make it compile..\n----\nNew commits:",
    "created_at": "2016-08-20T07:56:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146168",
    "user": "chapoton"
}
```

I made a branch, and refreshed it, but did not manage to make it compile..
----
New commits:



---

archive/issue_comments_146169.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T14:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146169",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146170.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-26T15:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146170",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146171.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-28T10:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146171",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146172.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-29T14:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146172",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146173.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-29T14:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146173",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_146174.json:
```json
{
    "body": "ok, ready. Needs review.",
    "created_at": "2016-08-29T14:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146174",
    "user": "chapoton"
}
```

ok, ready. Needs review.



---

archive/issue_comments_146175.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-29T15:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146175",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146176.json:
```json
{
    "body": "reference for the random test: theorem 2.5 of\n\nhttp://www.math.uconn.edu/~kconrad/blurbs/gradnumthy/AHrootofunity.pdf",
    "created_at": "2016-08-29T18:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146176",
    "user": "chapoton"
}
```

reference for the random test: theorem 2.5 of

http://www.math.uconn.edu/~kconrad/blurbs/gradnumthy/AHrootofunity.pdf



---

archive/issue_comments_146177.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-09-02T03:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146177",
    "user": "roed"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_146178.json:
```json
{
    "body": "Mostly good; here are some issues to fix.\n\n* When `prec=0`, the precision should be taken from the precision of the element rather than the precision cap of the parent (the process of finding the right precision may be more involved than just copying the precision of the element; I haven't thought about what the right precision should be in terms of the derivative of the artin-hasse exponential).\n* When `prec=1`, the resulting p-adic element should have absolute precision 1, not the precision equal to the precision cap of the parent (probably `self.parent(c)` should be `self.parent()(c,1)`).\n* It would be good to have the reference to Thm 2.5 of Conrad's notes in the docstring.\n* It would be nice to have a test along the lines of\n\n```\nsage: x = 3*Zp(3,30).random_element()\nsage: x.artin_hass_exp() == (sum(x^(p^i)/p^i for i in range(5)).exp()\nTrue\n```\n\n\nThanks for reviving the ticket though!",
    "created_at": "2016-09-02T03:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146178",
    "user": "roed"
}
```

Mostly good; here are some issues to fix.

* When `prec=0`, the precision should be taken from the precision of the element rather than the precision cap of the parent (the process of finding the right precision may be more involved than just copying the precision of the element; I haven't thought about what the right precision should be in terms of the derivative of the artin-hasse exponential).
* When `prec=1`, the resulting p-adic element should have absolute precision 1, not the precision equal to the precision cap of the parent (probably `self.parent(c)` should be `self.parent()(c,1)`).
* It would be good to have the reference to Thm 2.5 of Conrad's notes in the docstring.
* It would be nice to have a test along the lines of

```
sage: x = 3*Zp(3,30).random_element()
sage: x.artin_hass_exp() == (sum(x^(p^i)/p^i for i in range(5)).exp()
True
```


Thanks for reviving the ticket though!



---

archive/issue_comments_146179.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-09-02T07:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146179",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146180.json:
```json
{
    "body": "There remains to handle your remarks about precision.\n\nAnd also I am not very happy with all the imports that I have added, there may be a smarter way to avoid that.\n----\nNew commits:",
    "created_at": "2016-09-04T15:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146180",
    "user": "chapoton"
}
```

There remains to handle your remarks about precision.

And also I am not very happy with all the imports that I have added, there may be a smarter way to avoid that.
----
New commits:



---

archive/issue_comments_146181.json:
```json
{
    "body": "I think that precision is fine.\n\nSmall other remarks:\n- Shouldn't we cpdef the function `artin_hasse_exp`?\n- Why do we need an external function `floorlogp`? Shouldn't we integrate it directy in `artin_hasse_exp` (and actually not call it at each iteration of the main loop)? \n- I would use `None` instead of `0` for the default of `prec`\n- It is enough to evaluate the Artin-Hasse series up to `prec/self.valuation()`\n- Shouldn't we cache the coefficients of the Artin-Hasse series and/or only compute them modulo `pi^prec`?\n\nBy the way, I think I can imagine faster algorithms for computing the Artin-Hasse exponential but it will be for another ticket.",
    "created_at": "2017-05-22T14:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146181",
    "user": "caruso"
}
```

I think that precision is fine.

Small other remarks:
- Shouldn't we cpdef the function `artin_hasse_exp`?
- Why do we need an external function `floorlogp`? Shouldn't we integrate it directy in `artin_hasse_exp` (and actually not call it at each iteration of the main loop)? 
- I would use `None` instead of `0` for the default of `prec`
- It is enough to evaluate the Artin-Hasse series up to `prec/self.valuation()`
- Shouldn't we cache the coefficients of the Artin-Hasse series and/or only compute them modulo `pi^prec`?

By the way, I think I can imagine faster algorithms for computing the Artin-Hasse exponential but it will be for another ticket.



---

archive/issue_comments_146182.json:
```json
{
    "body": "Also notice that the class `pAdicGenericElement` is a generic class whose instances and not only elements of Zp or Qp but also elements in finite extensions. However your code is definitely specific to Zp / Qp as its relies on integer lifts.",
    "created_at": "2017-05-27T19:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146182",
    "user": "caruso"
}
```

Also notice that the class `pAdicGenericElement` is a generic class whose instances and not only elements of Zp or Qp but also elements in finite extensions. However your code is definitely specific to Zp / Qp as its relies on integer lifts.



---

archive/issue_comments_146183.json:
```json
{
    "body": "Comments only on the Cython aspects:\n\nDon't include `stdsage.pxi` (#22896) or `cysignals/signals.pxi` (see, e.g., #23121).\n\nYou should use (#17668):\n\n```diff\n-        cdef Rational c = PY_NEW(Rational)\n+        cdef Rational c = Rational.__new__(Rational)\n```\n\n\nWith how Cython works, it is no worse to compactify:\n\n```\ncdef long floorlogp(long x, long b):\n    \"\"\"\n    A fast way to find the floor of the log base ``b`` of ``x``.\n    \"\"\"\n    cdef long t = b\n    cdef long n = 0\n    while t <= x:\n        t *= b\n        n += 1\n    return n\n```\n\nHowever, isn't this just `x // b` since `x` and `b` are both non-negative?\n\n\n```diff\n-        cdef sage.rings.integer.Integer p_as_Integer\n+        cdef Integer p_as_Integer\n```\n\n\n\n```diff\n-        if self.valuation() < 1:\n+        if self.valuation_c() < 1:\n```\n\n\nIt would be great to use `self.lift_c()` instead of `self.lift()`, as `self.lift()` in all cases just redirects to `self.lift_c()`. However, the code is not properly set up to do this. :(\n\nSince this is a `cdef` class, you can just use `self._parent` (which is a much faster call and cleaner Cython code).\n\nActually, as far as I can see, you don't need anything past\n\n```\np_as_Integer = self.parent().prime()\n```\n\nwhen `prec == 1` (other than maybe `mpq_set_si(a[0], 1, 1)`). So I would move that code block/special case before that. Actually, if I am reading the code correctly, you could do it as a special case before\n\n```\na = <mpq_t *> sig_malloc(prec * sizeof(mpq_t))\n```\n",
    "created_at": "2017-06-04T23:21:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146183",
    "user": "tscrim"
}
```

Comments only on the Cython aspects:

Don't include `stdsage.pxi` (#22896) or `cysignals/signals.pxi` (see, e.g., #23121).

You should use (#17668):

```diff
-        cdef Rational c = PY_NEW(Rational)
+        cdef Rational c = Rational.__new__(Rational)
```


With how Cython works, it is no worse to compactify:

```
cdef long floorlogp(long x, long b):
    """
    A fast way to find the floor of the log base ``b`` of ``x``.
    """
    cdef long t = b
    cdef long n = 0
    while t <= x:
        t *= b
        n += 1
    return n
```

However, isn't this just `x // b` since `x` and `b` are both non-negative?


```diff
-        cdef sage.rings.integer.Integer p_as_Integer
+        cdef Integer p_as_Integer
```



```diff
-        if self.valuation() < 1:
+        if self.valuation_c() < 1:
```


It would be great to use `self.lift_c()` instead of `self.lift()`, as `self.lift()` in all cases just redirects to `self.lift_c()`. However, the code is not properly set up to do this. :(

Since this is a `cdef` class, you can just use `self._parent` (which is a much faster call and cleaner Cython code).

Actually, as far as I can see, you don't need anything past

```
p_as_Integer = self.parent().prime()
```

when `prec == 1` (other than maybe `mpq_set_si(a[0], 1, 1)`). So I would move that code block/special case before that. Actually, if I am reading the code correctly, you could do it as a special case before

```
a = <mpq_t *> sig_malloc(prec * sizeof(mpq_t))
```




---

archive/issue_comments_146184.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd87\".",
    "created_at": "2017-07-17T17:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146184",
    "user": "roed"
}
```

Changing keywords from "" to "sd87".



---

archive/issue_comments_146185.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-23T08:53:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146185",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146186.json:
```json
{
    "body": "Changing keywords from \"sd87\" to \"sd87, padicIMA\".",
    "created_at": "2018-07-22T20:09:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146186",
    "user": "roed"
}
```

Changing keywords from "sd87" to "sd87, padicIMA".



---

archive/issue_comments_146187.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2018-08-12T17:51:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146187",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_146188.json:
```json
{
    "body": "I've just written another implementation that solves the equation (with unknown `y`)\n\n```\nlog(y) = x + x^p/p + x^(p^2)/p^2 + x^(p^3)/p^3 + ...\n```\n\nusing a Newton scheme.\n\nIt works over any p-adic ring/field (that's why I make this ticket dependent from #23218). \nMoreover, it is expected to be fast as soon as there exists a fast implementation of the logarithm for this ring/field. For example:\n\n```\nsage: R = Zp(3,1000)\nsage: x = 3 * R.random_element()\nsage: %time y1 = x.artin_hasse_exp()\nCPU times: user 9.14 s, sys: 0 ns, total: 9.14 s\nWall time: 9.16 s\nsage: %time y2 = x.artin_hasse_exp_Newton()\nCPU times: user 8 ms, sys: 4 ms, total: 12 ms\nWall time: 9.81 ms\nsage: y1 == y2\nTrue\n```\n\nHowever, with precision 20, `artin_hasse_exp` is faster because it is written in Cython.",
    "created_at": "2018-08-12T18:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146188",
    "user": "caruso"
}
```

I've just written another implementation that solves the equation (with unknown `y`)

```
log(y) = x + x^p/p + x^(p^2)/p^2 + x^(p^3)/p^3 + ...
```

using a Newton scheme.

It works over any p-adic ring/field (that's why I make this ticket dependent from #23218). 
Moreover, it is expected to be fast as soon as there exists a fast implementation of the logarithm for this ring/field. For example:

```
sage: R = Zp(3,1000)
sage: x = 3 * R.random_element()
sage: %time y1 = x.artin_hasse_exp()
CPU times: user 9.14 s, sys: 0 ns, total: 9.14 s
Wall time: 9.16 s
sage: %time y2 = x.artin_hasse_exp_Newton()
CPU times: user 8 ms, sys: 4 ms, total: 12 ms
Wall time: 9.81 ms
sage: y1 == y2
True
```

However, with precision 20, `artin_hasse_exp` is faster because it is written in Cython.



---

archive/issue_comments_146189.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-13T02:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146189",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146190.json:
```json
{
    "body": "I've added a \"direct\" implementation that just evaluates\n\n```\nexp(x + x^p/p + x^(p^2)/p^2 + ...)\n```\n\nAn heuristic is used for choosing the fastest algorithm (hopefully), depending on the input and the methods available for this input.\n\nI've also improved the computation of the Artin-Hasse series: the computation is now done modulo some power of `p` (and not in `QQ` as before) and the result is cached.\n\nOn my laptop, timings are now:\n\n\n```\nsage: R = Zp(3,1000)\nsage: elt = 3 * R.random_element()\nsage: %timeit elt.artin_hasse_exp()  # use the \"direct\" algorithm\n100 loops, best of 3: 2.22 ms per loop\nsage: %timeit elt.artin_hasse_exp(algorithm='direct')\n100 loops, best of 3: 2.14 ms per loop\nsage: %timeit elt.artin_hasse_exp(algorithm='newton')\n100 loops, best of 3: 4.84 ms per loop\nsage: %timeit elt.artin_hasse_exp(algorithm='series')\n100 loops, best of 3: 17.4 ms per loop\n```\n\n\nAnd for an extension:\n\n\n```\nsage: S.<pi> = R.extension(x^2 + 3)\nsage: elt = pi * S.random_element()\nsage: %timeit elt.artin_hasse_exp()  # use the \"series\" algorithm\n10 loops, best of 3: 121 ms per loop\nsage: %timeit elt.artin_hasse_exp(algorithm='direct')\nTraceback (most recent call last):\n...\nNotImplementedError: One factor of the Artin-Hasse exponential does not converge\nsage: %timeit elt.artin_hasse_exp(algorithm='newton')\n1 loop, best of 3: 333 ms per loop\nsage: %timeit elt.artin_hasse_exp(algorithm='series')\n10 loops, best of 3: 121 ms per loop\n```\n",
    "created_at": "2018-08-13T02:31:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146190",
    "user": "caruso"
}
```

I've added a "direct" implementation that just evaluates

```
exp(x + x^p/p + x^(p^2)/p^2 + ...)
```

An heuristic is used for choosing the fastest algorithm (hopefully), depending on the input and the methods available for this input.

I've also improved the computation of the Artin-Hasse series: the computation is now done modulo some power of `p` (and not in `QQ` as before) and the result is cached.

On my laptop, timings are now:


```
sage: R = Zp(3,1000)
sage: elt = 3 * R.random_element()
sage: %timeit elt.artin_hasse_exp()  # use the "direct" algorithm
100 loops, best of 3: 2.22 ms per loop
sage: %timeit elt.artin_hasse_exp(algorithm='direct')
100 loops, best of 3: 2.14 ms per loop
sage: %timeit elt.artin_hasse_exp(algorithm='newton')
100 loops, best of 3: 4.84 ms per loop
sage: %timeit elt.artin_hasse_exp(algorithm='series')
100 loops, best of 3: 17.4 ms per loop
```


And for an extension:


```
sage: S.<pi> = R.extension(x^2 + 3)
sage: elt = pi * S.random_element()
sage: %timeit elt.artin_hasse_exp()  # use the "series" algorithm
10 loops, best of 3: 121 ms per loop
sage: %timeit elt.artin_hasse_exp(algorithm='direct')
Traceback (most recent call last):
...
NotImplementedError: One factor of the Artin-Hasse exponential does not converge
sage: %timeit elt.artin_hasse_exp(algorithm='newton')
1 loop, best of 3: 333 ms per loop
sage: %timeit elt.artin_hasse_exp(algorithm='series')
10 loops, best of 3: 121 ms per loop
```




---

archive/issue_comments_146191.json:
```json
{
    "body": "Great!  Let me know when this is ready for review.  I may wait until #23218 is merged into a beta so that I can see the changes.",
    "created_at": "2018-08-13T15:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146191",
    "user": "roed"
}
```

Great!  Let me know when this is ready for review.  I may wait until #23218 is merged into a beta so that I can see the changes.



---

archive/issue_comments_146192.json:
```json
{
    "body": "* patchbot reports 2 failing doctests\n\n* you need to document every single function, even with underscore names",
    "created_at": "2018-08-14T08:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146192",
    "user": "chapoton"
}
```

* patchbot reports 2 failing doctests

* you need to document every single function, even with underscore names



---

archive/issue_comments_146193.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-16T15:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146193",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146194.json:
```json
{
    "body": "I've added the missing doctests. The ticket is now ready for review.",
    "created_at": "2018-08-16T15:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146194",
    "user": "caruso"
}
```

I've added the missing doctests. The ticket is now ready for review.



---

archive/issue_comments_146195.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-16T15:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146195",
    "user": "caruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_146196.json:
```json
{
    "body": "You need to use\n\n```\n+        r\"\"\"\n```\n\ninstead of \n\n```\n+        \"\"\"\n```\n\nin every doc that contains latex commands somewhere (`\\log` for example)",
    "created_at": "2018-08-16T16:35:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146196",
    "user": "chapoton"
}
```

You need to use

```
+        r"""
```

instead of 

```
+        """
```

in every doc that contains latex commands somewhere (`\log` for example)



---

archive/issue_comments_146197.json:
```json
{
    "body": "and the branch does not apply on the latest beta..",
    "created_at": "2018-08-16T16:39:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146197",
    "user": "chapoton"
}
```

and the branch does not apply on the latest beta..



---

archive/issue_comments_146198.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-16T16:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146198",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146199.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-16T17:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146199",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146200.json:
```json
{
    "body": "Thanks. Should be fixed.",
    "created_at": "2018-08-16T17:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146200",
    "user": "caruso"
}
```

Thanks. Should be fixed.



---

archive/issue_comments_146201.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-16T17:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146201",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146202.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-16T19:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146202",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146203.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-16T19:41:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146203",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146204.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-18T06:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146204",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146205.json:
```json
{
    "body": "typo:\n\n```\nis not is the domain of convergence of the\n```\n",
    "created_at": "2018-08-18T07:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146205",
    "user": "chapoton"
}
```

typo:

```
is not is the domain of convergence of the
```




---

archive/issue_comments_146206.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-18T08:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146206",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146207.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-13T21:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146207",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146208.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-13T21:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146208",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146209.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-14T06:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146209",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_146210.json:
```json
{
    "body": "this seems to make some patchbots turn crazy, for some reason...",
    "created_at": "2018-09-20T06:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146210",
    "user": "chapoton"
}
```

this seems to make some patchbots turn crazy, for some reason...



---

archive/issue_comments_146211.json:
```json
{
    "body": "I don't see anything in the ticket that is executed at startup, except this line:\n\n```\n_AHE_coefficients_cache = { }\n```\n\nbut I don't except this to cause slowness.",
    "created_at": "2018-09-20T06:28:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146211",
    "user": "caruso"
}
```

I don't see anything in the ticket that is executed at startup, except this line:

```
_AHE_coefficients_cache = { }
```

but I don't except this to cause slowness.



---

archive/issue_comments_146212.json:
```json
{
    "body": "This is very probably not the fault of anything in this ticket. Probably a new bug of the patchbot, maybe on the server side..",
    "created_at": "2018-09-20T06:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146212",
    "user": "chapoton"
}
```

This is very probably not the fault of anything in this ticket. Probably a new bug of the patchbot, maybe on the server side..



---

archive/issue_comments_146213.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-20T19:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146213",
    "user": "roed"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_146214.json:
```json
{
    "body": "I ran tests locally and they all passed.  Looks good to me.",
    "created_at": "2018-09-20T19:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146214",
    "user": "roed"
}
```

I ran tests locally and they all passed.  Looks good to me.



---

archive/issue_comments_146215.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-22T10:22:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146215",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_146216.json:
```json
{
    "body": "Is \"Sebastian Pancrantz\" a typo for \"Sebastian Pancratz\"?",
    "created_at": "2018-10-24T11:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146216",
    "user": "jdemeyer"
}
```

Is "Sebastian Pancrantz" a typo for "Sebastian Pancratz"?



---

archive/issue_comments_146217.json:
```json
{
    "body": "I'm assuming that it is, correct me if I'm wrong.",
    "created_at": "2018-10-24T11:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146217",
    "user": "jdemeyer"
}
```

I'm assuming that it is, correct me if I'm wrong.



---

archive/issue_comments_146218.json:
```json
{
    "body": "This should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12388#issuecomment-146218",
    "user": "embray"
}
```

This should be re-targeted for 8.5.
