# Issue 22458: Upgrade cysignals

archive/issues_022458.json:
```json
{
    "body": "CC:  @vbraun\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22695\n\n",
    "created_at": "2017-03-28T13:42:54Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Upgrade cysignals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22458",
    "user": "@jdemeyer"
}
```
CC:  @vbraun



Issue created by migration from https://trac.sagemath.org/ticket/22695





---

archive/issue_comments_312939.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-11T14:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312939",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_312940.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-11T14:36:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312940",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_312941.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-13T13:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312941",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_312942.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-13T14:29:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312942",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_312943.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-13T14:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312943",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_312944.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-13T15:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312944",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_312945.json:
```json
{
    "body": "Doctest failure in `src/sage/repl/ipython_kernel/kernel.py`",
    "created_at": "2017-04-13T15:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312945",
    "user": "@jdemeyer"
}
```

Doctest failure in `src/sage/repl/ipython_kernel/kernel.py`



---

archive/issue_comments_312946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-13T15:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312946",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312947.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-13T15:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312947",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_312948.json:
```json
{
    "body": "Passes all doctests.",
    "created_at": "2017-04-13T20:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312948",
    "user": "@jdemeyer"
}
```

Passes all doctests.



---

archive/issue_comments_312949.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-13T22:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312949",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_312950.json:
```json
{
    "body": "Debug build fails with\n\n```\n[cysignals-1.6.0]     gcc -fno-strict-aliasing -g -O2 -g -O0 -Wall -Wno-unused -fPIC -Isrc/cysignals -Ibuild/src -Ibuild/src/cysignals -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c build/src/cysignals/signals.c -o build/temp.linux-x86_64-2.7-pydebug/build/src/cysignals/signals.o\n[cysignals-1.6.0]     In file included from build/src/cysignals/signals.c:460:0:\n[cysignals-1.6.0]     build/src/cysignals/macros.h: In function 'sig_block':\n[cysignals-1.6.0]     build/src/cysignals/macros.h:243:9: warning: implicit declaration of function 'print_backtrace' [-Wimplicit-function-declaration]\n[cysignals-1.6.0]              print_backtrace();\n[cysignals-1.6.0]              ^~~~~~~~~~~~~~~\n[cysignals-1.6.0]     In file included from build/src/cysignals/signals.c:463:0:\n[cysignals-1.6.0]     build/src/cysignals/implementation.c: At top level:\n[cysignals-1.6.0]     build/src/cysignals/implementation.c:72:13: warning: conflicting types for 'print_backtrace'\n[cysignals-1.6.0]      static void print_backtrace(void);\n[cysignals-1.6.0]                  ^~~~~~~~~~~~~~~\n[cysignals-1.6.0]     build/src/cysignals/implementation.c:72:13: error: static declaration of 'print_backtrace' follows non-static declaration\n[cysignals-1.6.0]     In file included from build/src/cysignals/signals.c:460:0:\n[cysignals-1.6.0]     build/src/cysignals/macros.h:243:9: note: previous implicit declaration of 'print_backtrace' was here\n[cysignals-1.6.0]              print_backtrace();\n[cysignals-1.6.0]              ^~~~~~~~~~~~~~~\n[cysignals-1.6.0]     error: command 'gcc' failed with exit status 1\n[cysignals-1.6.0]     Running setup.py install for cysignals: finished with status 'error'\n```\n",
    "created_at": "2017-04-14T12:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312950",
    "user": "@vbraun"
}
```

Debug build fails with

```
[cysignals-1.6.0]     gcc -fno-strict-aliasing -g -O2 -g -O0 -Wall -Wno-unused -fPIC -Isrc/cysignals -Ibuild/src -Ibuild/src/cysignals -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c build/src/cysignals/signals.c -o build/temp.linux-x86_64-2.7-pydebug/build/src/cysignals/signals.o
[cysignals-1.6.0]     In file included from build/src/cysignals/signals.c:460:0:
[cysignals-1.6.0]     build/src/cysignals/macros.h: In function 'sig_block':
[cysignals-1.6.0]     build/src/cysignals/macros.h:243:9: warning: implicit declaration of function 'print_backtrace' [-Wimplicit-function-declaration]
[cysignals-1.6.0]              print_backtrace();
[cysignals-1.6.0]              ^~~~~~~~~~~~~~~
[cysignals-1.6.0]     In file included from build/src/cysignals/signals.c:463:0:
[cysignals-1.6.0]     build/src/cysignals/implementation.c: At top level:
[cysignals-1.6.0]     build/src/cysignals/implementation.c:72:13: warning: conflicting types for 'print_backtrace'
[cysignals-1.6.0]      static void print_backtrace(void);
[cysignals-1.6.0]                  ^~~~~~~~~~~~~~~
[cysignals-1.6.0]     build/src/cysignals/implementation.c:72:13: error: static declaration of 'print_backtrace' follows non-static declaration
[cysignals-1.6.0]     In file included from build/src/cysignals/signals.c:460:0:
[cysignals-1.6.0]     build/src/cysignals/macros.h:243:9: note: previous implicit declaration of 'print_backtrace' was here
[cysignals-1.6.0]              print_backtrace();
[cysignals-1.6.0]              ^~~~~~~~~~~~~~~
[cysignals-1.6.0]     error: command 'gcc' failed with exit status 1
[cysignals-1.6.0]     Running setup.py install for cysignals: finished with status 'error'
```




---

archive/issue_comments_312951.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-04-14T12:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312951",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_312952.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-04-17T17:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312952",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_312953.json:
```json
{
    "body": "Fixed in 1.6.3",
    "created_at": "2017-04-17T17:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312953",
    "user": "@jdemeyer"
}
```

Fixed in 1.6.3



---

archive/issue_comments_312954.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-17T17:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312954",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_312955.json:
```json
{
    "body": "The tests don't work:\n\n```\n[cysignals-1.6.3] creating build/temp.macosx-10.9-x86_64-2.7\n[cysignals-1.6.3] gcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.13.p0/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cysignals-1.6.3/src/tmp/user/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c cysignals_example.cpp -o build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o\n[cysignals-1.6.3] cysignals_example.cpp:470:28: fatal error: struct_signals.h: No such file or directory\n[cysignals-1.6.3] compilation terminated.\n[cysignals-1.6.3] error: command 'gcc' failed with exit status 1\n[cysignals-1.6.3] make[3]: *** [check-prefix-example] Error 1\n[cysignals-1.6.3] src/cysignals/pselect.pyx\n[cysignals-1.6.3] src/cysignals/pysignals.pyx\n[cysignals-1.6.3] src/cysignals/signals.pyx\n[cysignals-1.6.3] src/cysignals/tests.pyx\n[cysignals-1.6.3] make[3]: Target `check' not remade because of errors.\n[cysignals-1.6.3] \n[cysignals-1.6.3] real\t0m35.818s\n[cysignals-1.6.3] user\t0m29.127s\n[cysignals-1.6.3] sys\t0m0.960s\n[cysignals-1.6.3] ************************************************************************\n[cysignals-1.6.3] Error testing package cysignals-1.6.3\n[cysignals-1.6.3] ************************************************************************\n```\n",
    "created_at": "2017-04-17T22:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312955",
    "user": "@vbraun"
}
```

The tests don't work:

```
[cysignals-1.6.3] creating build/temp.macosx-10.9-x86_64-2.7
[cysignals-1.6.3] gcc -fno-strict-aliasing -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/python2-2.7.13.p0/include -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -I/Users/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cysignals-1.6.3/src/tmp/user/lib/python2.7/site-packages/cysignals -I/Users/buildslave-sage/slave/sage_git/build/local/include/python2.7 -c cysignals_example.cpp -o build/temp.macosx-10.9-x86_64-2.7/cysignals_example.o
[cysignals-1.6.3] cysignals_example.cpp:470:28: fatal error: struct_signals.h: No such file or directory
[cysignals-1.6.3] compilation terminated.
[cysignals-1.6.3] error: command 'gcc' failed with exit status 1
[cysignals-1.6.3] make[3]: *** [check-prefix-example] Error 1
[cysignals-1.6.3] src/cysignals/pselect.pyx
[cysignals-1.6.3] src/cysignals/pysignals.pyx
[cysignals-1.6.3] src/cysignals/signals.pyx
[cysignals-1.6.3] src/cysignals/tests.pyx
[cysignals-1.6.3] make[3]: Target `check' not remade because of errors.
[cysignals-1.6.3] 
[cysignals-1.6.3] real	0m35.818s
[cysignals-1.6.3] user	0m29.127s
[cysignals-1.6.3] sys	0m0.960s
[cysignals-1.6.3] ************************************************************************
[cysignals-1.6.3] Error testing package cysignals-1.6.3
[cysignals-1.6.3] ************************************************************************
```




---

archive/issue_comments_312956.json:
```json
{
    "body": "I cannot reproduce that on Linux. Are you using some unusual compiler or environment variables?\n\nI'll test it on your OSX machine now.",
    "created_at": "2017-04-18T07:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312956",
    "user": "@jdemeyer"
}
```

I cannot reproduce that on Linux. Are you using some unusual compiler or environment variables?

I'll test it on your OSX machine now.



---

archive/issue_comments_312957.json:
```json
{
    "body": "Got it. It's a race condition with parallel builds.\n\nThanks for the report.",
    "created_at": "2017-04-18T07:45:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312957",
    "user": "@jdemeyer"
}
```

Got it. It's a race condition with parallel builds.

Thanks for the report.



---

archive/issue_comments_312958.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-04-18T07:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312958",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_312959.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-18T08:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312959",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_312960.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-18T08:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312960",
    "user": "@jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_312961.json:
```json
{
    "body": "Fixed in two ways:\n\n1. Instead of doing `make check` (which does a temporary installation), we run `make check-install` in Sage, which checks the installed version of `cysignals`.\n\n2. The race condition with `make check` is fixed upstream.",
    "created_at": "2017-04-18T08:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312961",
    "user": "@jdemeyer"
}
```

Fixed in two ways:

1. Instead of doing `make check` (which does a temporary installation), we run `make check-install` in Sage, which checks the installed version of `cysignals`.

2. The race condition with `make check` is fixed upstream.



---

archive/issue_comments_312962.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-20T18:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22458",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22458#issuecomment-312962",
    "user": "@vbraun"
}
```

Resolution: fixed
