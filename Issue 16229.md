# Issue 16229: Add gambit as an optional package

Issue created by migration from https://trac.sagemath.org/ticket/16466

Original creator: jcampbell

Original creation time: 2014-06-10 08:11:18

Include [gambit](http://gambit.sourceforge.net/gambit13/index.html) as one the optional packages that can be installed with sage.
The tarball can be found [here](http://gambit.sourceforge.net/gambit13/index.html).


---

Comment by vinceknight created at 2014-06-10 08:12:22

Listening in.


---

Comment by jcampbell created at 2014-06-10 08:47:10

New commits:


---

Comment by jcampbell created at 2014-06-10 08:47:10

Changing status from new to needs_review.


---

Comment by tmonteil created at 2014-06-10 10:39:04

Hi, i did not try to install the package, but here are a few suggestions for SPKG.txt : 

- title : gambit (lower case)
- license : GPL v2+ (easier to read)
- SPKG Maintainers : James Campbell (you are the maintainer, Theodore Turocy is the upstream author but does not maintain the sage package in the long term. By the way you should add your login on the trac homepage http://trac.sagemath.org/)
- Upstream contact : http://www.gambit-project.org/ seems more appropriate since it contains a contact link.


---

Comment by git created at 2014-06-10 14:35:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2014-06-10 15:50:06

I installed it without problem, and could try some python examples, so it looks good to go. As minor cosmetic changes, could you just: 

- remove the line "Put a bulleted list of dependencies here:" in SPKG.txt
- chmod +x spkg-install
- In the "Upstream Contact" section, write someting like

```
 * Website: http://www.gambit-project.org/
 * Mailing list: http://sourceforge.net/p/gambit/mailman/gambit-devel/
```

(those mailing-lists are not easy to find from the website, and may be useful if one need to report some issues upstream)


---

Comment by git created at 2014-06-10 16:38:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2014-06-10 17:00:01

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2014-06-13 14:37:31

Awesome work!  Sorry I was awol for a few days on the game theory stuff - and likely to be again, though I will try to ask about it at the Social Choice and Welfare conference next week.


---

Comment by vinceknight created at 2014-06-14 09:39:34

Thanks Karl! James has been making good progress. We're getting in to the intricacies of the project but what's really great is that Ted Turocy (head gambit person) is very keen and making certain tweaks to gambit to make things play nice with Sage). Will keep you up to speed as we carry on :)


---

Comment by git created at 2014-06-17 11:39:33

Changing status from positive_review to needs_review.


---

Comment by git created at 2014-06-17 11:39:33

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by jcampbell created at 2014-06-17 11:40:22

New commits:
----
New commits:


---

Comment by tmonteil created at 2014-06-17 13:14:27

Changing status from needs_review to needs_work.


---

Comment by tmonteil created at 2014-06-17 13:14:27

Hi Vince, the tarball you proposes for upload is not the same as the upstream one (whose sha1sum is `47696dce362653ed5536b7b18dec475bbd5f4313`). It is better use the original one, that can be downloaded at http://sourceforge.net/projects/gambit/files/gambit14/14.0.2/. If you need to modify it to let it work with Sage, you should add patches in the `SAGE_ROOT/build/pkgs/gambit/patches/` directory and apply them from the `spkg-install` script.

While you are at it, could you please add a newline at the end of the files `package-version.txt`,  `spkg-install` and `SPKG.txt` ?


---

Comment by jcampbell created at 2014-06-17 13:35:44

At the moment there exists a Gambit branch that is exclusively for optimising gambit for sage. Any changes that are made there will hopefully be merged into Gambit's next release (due at the end of August I believe). 

The changes that have been made so far are requited for ticket #16333 and so we thought it best to switch to temporarily hosting our own version of the Gambit tarball so that when people come to review that ticket, they will be using the correct version of Gambit.

Once the next release is sorted this should not be a problem and the tarball can revert back to the one at sourceforge.net


---

Comment by kcrisman created at 2014-08-27 19:22:22

So... what's the status on this?  I _finally_ have time to look at these tickets seriously again and would really like to do so over the next couple days - especially since the knot theory and Android app summer projects were successful :)


---

Comment by vinceknight created at 2014-08-27 20:59:03

Replying to [comment:17 kcrisman]:
> So... what's the status on this?  I _finally_ have time to look at these tickets seriously again and would really like to do so over the next couple days - especially since the knot theory and Android app summer projects were successful :)

That would be really great Karl!

Things have been pretty busy recently and I'm only just getting back to trying to find reviewers for the two main tickets (I'm not counting this one).

I've actually had to change the url for this one to: http://vincent-knight.com/other/gambit-14.0.2.tar.gz

I'm not entirely sure I've done that right though... James took care all this and I can't say I looked in to the package stuff... He's currently away from a machine but should be able to sort this particular ticket (relevant to #16333) when he's back or if anyone is eager to review I'll figure out asap! :)


---

Comment by kcrisman created at 2014-08-28 17:45:36

Thierry, what platform were you testing on?  On Mac OS X 10.7 I get

```
sage: import gambit
sage: gambit.Game.new_tree()
EFG 2 R "" { }
""

t "" 0
sage: gambit.new_tree()
---------------------------------------------------------------------------
AttributeError: 'module' object has no attribute 'new_tree'
```

contrary to expectations from [the documentation](http://www.gambit-project.org/gambit14/pyapi.html).  Maybe I installed something wrong...

Suggestion for update: since gambit has a test suite, an spkg-check thing would be good.


---

Comment by tmonteil created at 2014-08-29 15:15:30

I a running Debian GNU/Linux stable (wheezy).

I just checkout on the branch i reviewed (which is commit 55d779abbce6e354f5803befc3cb05b465c03f01 based on Sage 6.3.beta3), rebuilt sage, and installed gambit package (version 13.1.2), and i got:


```
sage: import gambit
sage: gambit.Game.new_tree()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-f105b844ddea> in <module>()
----> 1 gambit.Game.new_tree()

AttributeError: 'module' object has no attribute 'Game'
sage: gambit.new_tree()
EFG 2 R "" { }
""

t "" 0
```



---

Comment by tmonteil created at 2014-08-29 15:19:03

I would really prefer that Sage ships an official binary offered by upstream, not a customized temporary one. What is the current status of your Sage's specific branch being merged ? If it is for not too long, i think it is worth waiting this merge.


---

Comment by kcrisman created at 2014-08-29 16:24:31

Wow, exactly the opposite.  Huh.

----

True, this is not so high priority yet especially as the branches are a little mixed up.


---

Comment by vinceknight created at 2014-08-29 20:39:45

Replying to [comment:23 kcrisman]:
> Wow, exactly the opposite.  Huh.
> 

Hi both, very strange that you're getting the weird behaviour.

Completely agree that it would be idea for this to just be 'a normal' upstream binary of gambit but the reason it's this personalised version is after conversation with the main gambit dev. There needed to be a slight tweak to how the Python api worked, with a view to including this change to future versions of gambit.

When it came to hosting it the gambit maintainer said it was best (I forget if there was an actual reason) to just have it on my site. As a point of action, I'll check some things with James and get in touch with the gambit maintainer to see if we can fix this.

I'm beginning to wonder if since the main purpose of this is for #16333, but that most of #16333 works without gambit, it would be possible to modify/open new tickets so that #16333 can be review 'sans gambit' and a new ticket is opened to take care of getting gambit as an optional package in Sage and to check that the one implementation of the algorithm also works.


> 
> True, this is not so high priority yet especially as the branches are a little mixed up.

Agree that this is not high priority based on above, I've left you a message on #16331 re confusion of branches: not too sure what to do there/here... I think we were quite eager to avoid a branch mess but might have managed to create one anyway :) Sorry...

Thank you both very much for looking through this.


---

Comment by kcrisman created at 2014-08-31 00:50:34

> I'm beginning to wonder if since the main purpose of this is for #16333, but that most of #16333 works without gambit, it would be possible to modify/open new tickets so that #16333 can be review 'sans gambit' and a new ticket is opened to take care of getting gambit as an optional package in Sage and to check that the one implementation of the algorithm also works.

I think that might be good.


---

Comment by tscrim created at 2014-08-31 01:33:07

Replying to [comment:24 vinceknight]:
> Completely agree that it would be idea for this to just be 'a normal' upstream binary of gambit but the reason it's this personalised version is after conversation with the main gambit dev. There needed to be a slight tweak to how the Python api worked, with a view to including this change to future versions of gambit.

The standard approach is to create a patch (or if there are more logical grouping, multiple patches) which apply to a clean version of gambit. As these changes get released into gambit, we remove (a part of) the patch.

> I'm beginning to wonder if since the main purpose of this is for #16333, but that most of #16333 works without gambit, it would be possible to modify/open new tickets so that #16333 can be review 'sans gambit' and a new ticket is opened to take care of getting gambit as an optional package in Sage and to check that the one implementation of the algorithm also works.

I'm also for separating things out here considering the spkg doesn't seem like it will be ready soon.


---

Comment by vinceknight created at 2014-09-02 07:59:31

Ok thanks, I think it would be helpful (before I start changing/opening tickets and risk breaking everything) to just confirm a few things with someone/anyone. Would either of you be free to talk about this for 5 minutes?


---

Comment by kcrisman created at 2014-09-03 12:59:57

> Ok thanks, I think it would be helpful (before I start changing/opening tickets and risk breaking everything) to just confirm a few things with someone/anyone. Would either of you be free to talk about this for 5 minutes?
Not now, sorry :(  But my recommendation, assuming it is technically not too difficult, is to
 1. Make #16333 for the basic functionality for games, even if some things are not implemented
 1. Make this ticket be about both the optional package and making it work with Sage
 1. Make some other ticket be about any other add ons you are thinking of.
<rant>Apropos of this, I really feel like the patch workflow (as opposed to never-rewrite-history branch workflow) is better in situations like this.  Too confusing otherwise.</rant>


---

Comment by vinceknight created at 2014-09-03 13:20:44

Replying to [comment:28 kcrisman]:
> > Ok thanks, I think it would be helpful (before I start changing/opening tickets and risk breaking everything) to just confirm a few things with someone/anyone. Would either of you be free to talk about this for 5 minutes?
> Not now, sorry :(  But my recommendation, assuming it is technically not too difficult, is to
>  1. Make #16333 for the basic functionality for games, even if some things are not implemented
>  1. Make this ticket be about both the optional package and making it work with Sage
>  1. Make some other ticket be about any other add ons you are thinking of.

This sounds sensible to me but my understanding is that we can't change the name of a trac ticket (or at least we shouldn't). If that's the case is it enough to explain in the comments what the change is to be? 

If I'm wrong and it's fine to change the name of a ticket should I just go ahead and do that?


---

Comment by tscrim created at 2014-09-03 14:46:26

Replying to [comment:27 vinceknight]:
> Ok thanks, I think it would be helpful (before I start changing/opening tickets and risk breaking everything) to just confirm a few things with someone/anyone. Would either of you be free to talk about this for 5 minutes?

I might have a little bit of time tonight. Send me an e-mail (tscrim at ucdavis.edu) and we can figure something out.

Replying to [comment:28 kcrisman]:
> Not now, sorry :(  But my recommendation, assuming it is technically not too difficult, is to
>  1. Make #16333 for the basic functionality for games, even if some things are not implemented
>  1. Make this ticket be about both the optional package and making it work with Sage
>  1. Make some other ticket be about any other add ons you are thinking of.

I concur.

> <rant>Apropos of this, I really feel like the patch workflow (as opposed to never-rewrite-history branch workflow) is better in situations like this.  Too confusing otherwise.</rant>

You can start a new branch and merge in up to some commit by using the sha1 (or cherry-pick a single commit). Although I wouldn't worry so much about having the perfect "clean" history and instead use `git diff` and

```
git log --no-merges ^develop
```

to see all commits not in develop.


---

Comment by kcrisman created at 2014-09-03 15:32:54

> This sounds sensible to me but my understanding is that we can't change the name of a trac ticket (or at least we shouldn't). If that's the case is it enough to explain in the comments what the change is to be? 
> 
> If I'm wrong and it's fine to change the name of a ticket should I just go ahead and do that?
Yes, absolutely one can do that, as long as it's clear why and related to the original thing.  For instance, often a ticket will start off as "fix trivial error in foo - easy" and by the end become "rewrite entire functionality of bar" which then happens to have fixing the trivial error as a corollary - because that was the only way to fix the supposedly trivial error!


---

Comment by vinceknight created at 2014-09-03 16:52:58

Ok this sounds like a simple enough fix :)

I'm going camping for 4 days tomorrow so unless I get to speak to tscrim (thank you very much for the offer) I'll leave making the change till next week just in case I make a mess that I'm not around to fix.


---

Comment by kcrisman created at 2014-09-03 18:08:55

> I'm going camping for 4 days tomorrow so unless I get to speak to tscrim (thank you very much for the offer) I'll leave making the change till next week just in case I make a mess that I'm not around to fix.
Nice!  Yes, next week is better for me as well.


---

Comment by vinceknight created at 2014-09-09 17:02:29

Just had a very helpful conversation with tscrim and I here is how this mess will be fixed:

1. Create a new ticket that will branch directly from develop and be to implement methods that only require lrs. Ticket is here: #16954
2. Reword #16333 so that it becomes dependent on above ticket and this ticket: and implements the use of gambit. This has been done.

All these tickets have been set to 'needs work'. Fixing #16954 should not take too long (it's just cleaning and removing code).


---

Comment by kcrisman created at 2014-10-27 19:00:54

Okay, I got back to this.  Unfortunately, now it doesn't even build.  ?  This is on Mac OS X 10.7.


```
creating build/tools/lcp
gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -I../.. -I.. -I/Users/.../sage/local/include/python2.7 -c gambit/lib/libgambit.cpp -o build/temp.macosx-10.7-x86_64-2.7/gambit/lib/libgambit.o
gambit/lib/libgambit.cpp: In function 'PyObject* __pyx_pf_6gambit_3lib_9libgambit_9LCPSolver_4solve(__pyx_obj_6gambit_3lib_9libgambit_LCPSolver*, __pyx_obj_6gambit_3lib_9libgambit_Game*, PyObject*, PyObject*)':
gambit/lib/libgambit.cpp:45630:35: error: '>>' should be '> >' within a nested template argument list
error: command 'gcc' failed with exit status 1
```



---

Comment by vinceknight created at 2014-11-23 12:19:24

Getting back to this (apologies for the delay).

We're now pointing towards a 'standard' release of gambit which should work fine in the modifications to the `NormalFormGame` class that we'll start working on (shouldn't take long as code is pretty much ready).

Assuming this version of gambit installs fine and is ok (this branch is merge with latest branch of `develop` and gambit has built on two separate OSs), what would be the best way to proceed to getting gambit in to the `NormalFormGame` class.

I think there are two approaches:

1. Work on this ticket to modify `NormalFormGame` so that it has an interface to gambit. I think that this was the plan at some point but looking at some dev guidance it seems that adding a package should be a single self contained ticket.
2. Wait for this ticket to be merged in to `develop` and work on a new branch of that on a different ticket (this is my preferred option as I think it's least likely to break stuff...)

Thanks :)
----
New commits:


---

Comment by vinceknight created at 2014-11-23 12:19:24

Changing status from needs_work to needs_review.


---

Comment by vinceknight created at 2014-11-23 12:23:25

(Karl, I'm hoping that this version of gambit installs fine on your OS, has run fine on my MAC OS 10.9.5)


---

Comment by tscrim created at 2014-11-23 22:28:29

FTR, this installed on my Ubuntu 12.04 LTS system.


---

Comment by kcrisman created at 2014-11-24 13:38:36

You already have #16333 for the purposes of actually writing the gambit interface, as long as a few examples we test here work out properly this time I think this ticket should be _just_ for adding gambit.  Maybe you could put in a couple absolutely minimal gambit-optional doctests to verify that it imports and creates a game, I guess.  This could be in a file gambit.py that just serves as a way for people to test and use it independently of Sage (though see below because of the preparser):

For instance, I still get the following (it does compile now):

```
sage: sage: import gambit
sage: sage: gambit.Game.new_tree()
EFG 2 R "" { }
""

t "" 0
sage: g.players[0].label="A"  # turns out not to work in Sage because of preparer, that's okay
---------------------------------------------------------------------------
TypeError: collection indexes must be int or str, not Integer
sage: g.players[int(0)].label="A"
```

I can't find the previously non-working version in the documentation now, maybe that was changed.  For posterity, it doesn't work now.

```
sage: sage: gambit.new_tree()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-3-46627785e350> in <module>()
----> 1 gambit.new_tree()

AttributeError: 'module' object has no attribute 'new_tree'
```


Travis, did you try any actual gambit examples?  If these work I guess that would be enough.

Vincent, I think that the gambit documentation still leaves something to be desired.  For instance,

```
In [1]: g = gambit.Game.read_game("e02.nfg")
```

doesn't work right, because the file is not there (I guess).  In R and similar things there is a standard way to access such built-in examples.  Not necessary per se, but it would be nice if examples worked right.


---

Comment by vinceknight created at 2014-11-24 15:08:34

Replying to [comment:40 kcrisman]:
> You already have #16333 for the purposes of actually writing the gambit interface, as long as a few examples we test here work out properly this time I think this ticket should be _just_ for adding gambit.  Maybe you could put in a couple absolutely minimal gambit-optional doctests to verify that it imports and creates a game, I guess.  This could be in a file gambit.py that just serves as a way for people to test and use it independently of Sage (though see below because of the preparser):
> 
> For instance, I still get the following (it does compile now):
> {{{
> sage: sage: import gambit
> sage: sage: gambit.Game.new_tree()
> EFG 2 R "" { }
> ""
> 
> t "" 0
> sage: g.players[0].label="A"  # turns out not to work in Sage because of preparer, that's okay
> ---------------------------------------------------------------------------
> TypeError: collection indexes must be int or str, not Integer
> sage: g.players[int(0)].label="A"
> }}}
> I can't find the previously non-working version in the documentation now, maybe that was changed.  For posterity, it doesn't work now.
> {{{
> sage: sage: gambit.new_tree()
> ---------------------------------------------------------------------------
> AttributeError                            Traceback (most recent call last)
> <ipython-input-3-46627785e350> in <module>()
> ----> 1 gambit.new_tree()
> 
> AttributeError: 'module' object has no attribute 'new_tree'
> }}}
> 
> Travis, did you try any actual gambit examples?  If these work I guess that would be enough.
> 
> Vincent, I think that the gambit documentation still leaves something to be desired.  For instance,
> {{{
> In [1]: g = gambit.Game.read_game("e02.nfg")
> }}}
> doesn't work right, because the file is not there (I guess).  In R and similar things there is a standard way to access such built-in examples.  Not necessary per se, but it would be nice if examples worked right.

Not too sure where the gambit.py would go but like the idea of writing tests for it: would I put it in the game_theory folder and just make sure it doesn't come up in the docs etc...?

For simplicity here is some code you can just paste in to a Sage session to test gambit:

A prisoner's dilemma:


```
sage: import gambit
sage: g = gambit.Game.new_table([2,2])
sage: g[int(0), int(0)][int(0)] = int(8)
sage: g[int(0), int(0)][int(1)] = int(8)
sage: g[int(0), int(1)][int(0)] = int(2)
sage: g[int(0), int(1)][int(1)] = int(10)
sage: g[int(1), int(0)][int(0)] = int(10)
sage: g[int(1), int(0)][int(1)] = int(2)
sage: g[int(1), int(1)][int(0)] = int(5)
sage: g[int(1), int(1)][int(1)] = int(5)
sage: solver = gambit.nash.ExternalLCPSolver()
sage: solver.solve(g)
[<NashProfile for '': [0.0, 1.0, 0.0, 1.0]>]
```


A battle of the sexes:


```
e: import gambit
sage: g = gambit.Game.new_table([2,2])
sage: g[int(0), int(0)][int(0)] = int(2)
sage: g[int(0), int(0)][int(1)] = int(1)
sage: g[int(0), int(1)][int(0)] = int(0)
sage: g[int(0), int(1)][int(1)] = int(0)
sage: g[int(1), int(0)][int(0)] = int(0)
sage: g[int(1), int(0)][int(1)] = int(0)
sage: g[int(1), int(1)][int(0)] = int(1)
sage: g[int(1), int(1)][int(1)] = int(2)
sage: solver = gambit.nash.ExternalLCPSolver()
sage: solver.solve(g)
[<NashProfile for '': [1.0, 0.0, 1.0, 0.0]>,
 <NashProfile for '': [0.6666666667, 0.3333333333, 0.3333333333, 0.6666666667]>,
 <NashProfile for '': [0.0, 1.0, 0.0, 1.0]>]
```


I assume this is the sort of stuff (with more documentation) that would go in to the gambit.py file.

For info, these are examples we had checked ourselves and is what is required for us to get the LCP solver working in `NormalFormGame`.


---

Comment by kcrisman created at 2014-11-24 15:25:04

I think that if you just added a file `game_theory/gambit.py` that explained how to use it independently of Sage, that would be fine.

In fact, you could have untested examples that show it in the Ipython setting - notebook or command line - since presumably it will work there.  In fact, I just tried it, and it does!  So if someone wanted to "just use" Gambit they could do it that way.

But if that is a lot of work, you can definitely think of that as a followup ticket, though one that would be very useful to get in before the new year (at which point I will have much less time to review such things).


---

Comment by tscrim created at 2014-11-24 15:26:43

I didn't try any examples, but I will later today.


---

Comment by vinceknight created at 2014-11-24 15:27:58

Replying to [comment:42 kcrisman]:
> I think that if you just added a file `game_theory/gambit.py` that explained how to use it independently of Sage, that would be fine.
> 
> In fact, you could have untested examples that show it in the Ipython setting - notebook or command line - since presumably it will work there.  In fact, I just tried it, and it does!  So if someone wanted to "just use" Gambit they could do it that way.
> 
> But if that is a lot of work, you can definitely think of that as a followup ticket, though one that would be very useful to get in before the new year (at which point I will have much less time to review such things).

Cool, I'll go ahead and do that: it's not a substantial amount of work so I'm happy to do it as part of this ticket or should I keep this ticket solely for the purpose of packaging the third party code?


---

Comment by kcrisman created at 2014-11-24 15:29:13

If it's not much work, please do do it here, then it's done!


---

Comment by git created at 2014-11-24 16:43:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vinceknight created at 2014-11-24 16:45:25

I've added a file as discussed. It's at the moment just documentation but it does give 3/4 examples. Note that the file can still be used to doctest:


```
./sage -t src/sage/game_theory/gambit.py 
```


Let me know if you were thinking of something a bit different.


---

Comment by kcrisman created at 2014-11-24 17:36:24


```
+Note that all of the above examples can be used in Ipython without the need to
+convert integers to instances of `int`.
```

I think that copy/paste some of the documentation from the Gambit site, and/or actual examples (there should be a way to mark these as not tested or not Sage tests, especially since it won't have `sage:` in front) would be best instead of this remark.

In fact, you could put that _first_ and then say "if you really want to use Gambit in Sage without using the (soon-to-come) interface, do this stuff with int".  

By the way, we can positively review this ticket and then put its goal to "sage-pending" waiting on #16333; this is already a prereq for that, so one can make it that dependency without having to merge this in the main develop branch right away.  Then you can preface all this with a remark (on that ticket or here) linking to `normal_form_game.py` or some of the functions there (see the developer guide for how to do this) so that curious folks mostly just go right back to where they belong, and this remains a "fyi" document only.


---

Comment by git created at 2014-11-24 18:24:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vinceknight created at 2014-11-24 18:29:42

Replying to [comment:48 kcrisman]:
> {{{
> +Note that all of the above examples can be used in Ipython without the need to
> +convert integers to instances of `int`.
> }}}
> I think that copy/paste some of the documentation from the Gambit site, and/or actual examples (there should be a way to mark these as not tested or not Sage tests, especially since it won't have `sage:` in front) would be best instead of this remark.
> 
> In fact, you could put that _first_ and then say "if you really want to use Gambit in Sage without using the (soon-to-come) interface, do this stuff with int".  
> 

I've gone with your suggestion: moving most of the packages to Ipython as well as a discussion of how to run the Sage Ipython cli tool.

Also note that I've made the tests for `gambit.py` have the optional tag so now to run them you need:


```
./sage -t --optional=gambit src/sage/game_theory/gambit.py 
```


I thought it was worth doing this in case an overall global test of Sage would try to test this gambit file.

> By the way, we can positively review this ticket and then put its goal to "sage-pending" waiting on #16333; this is already a prereq for that, so one can make it that dependency without having to merge this in the main develop branch right away.  Then you can preface all this with a remark (on that ticket or here) linking to `normal_form_game.py` or some of the functions there (see the developer guide for how to do this) so that curious folks mostly just go right back to where they belong, and this remains a "fyi" document only.

Not too sure what is best: I'm happy enough with letting this merge in to develop now? I don't think it's likely that many people would have a problem with it being merged as is, happy to follow your guidance. Either way work on #16333 will come from a branch of this once it's been positively reviewed.


---

Comment by kcrisman created at 2014-11-24 19:14:26

Is the following correct?

```
that can be run easily in an Ipython notebook. To run the Ipython notebook
packaged with Sage run (from root of Sage)::
    $ ./sage -ipython
```

Isn't it just an Ipython command line that shows up, and a different command for the notebook?  I wouldn't worry about the notebook, by the way - just demonstrating that it works in CLI is fine, as a proof of concept.


---

Comment by git created at 2014-11-24 19:22:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-11-24 19:23:35

Okay, I think this is fine, except for a few minor issues.
* Add to reference manual?
* Please recheck for duplication like

```
+    In [1]: g = gambit.Game.new_table([2,2])
+    In [2]: g = gambit.Game.new_table([2,2])
```

* I have a feeling that if this is added to reference, there will be a hiccup here.

```
+Here is a list of various other solvers that can be used:
+
+- ExternalEnumPureSolver
+- ExternalEnumMixedSolver
+- ExternalLPSolver
+- ExternalLCPSolver
+- ExternalSimpdivSolver
+- ExternalGlobalNewtonSolver
+- ExternalEnumPolySolver
+- ExternalLyapunovSolver
+- ExternalIteratedPolymatrixSolver
+- ExternalLogitSolver
+
+    In [22]: solver = gambit.nash.ExternalEnumPureSolver()
+    In [23]: solver.solve(g)
+    Out[23]: [<NashProfile for '': [Fraction(0, 1), Fraction(1, 1), Fraction(0, 1), Fraction(1, 1)]>]
+
```

   Because there is what is intended to be a literal block after a list.  You should have another sentence explaining it and then the usual double colon.
* You will need to add `import gambit` before each of your Ipython examples, otherwise they don't work.


---

Comment by vinceknight created at 2014-11-24 19:24:35

Replying to [comment:51 kcrisman]:
> Is the following correct?
> {{{
> that can be run easily in an Ipython notebook. To run the Ipython notebook
> packaged with Sage run (from root of Sage)::
>     $ ./sage -ipython
> }}}
> Isn't it just an Ipython command line that shows up, and a different command for the notebook?  I wouldn't worry about the notebook, by the way - just demonstrating that it works in CLI is fine, as a proof of concept.

Yeah you're completely right. Have addressed.


---

Comment by kcrisman created at 2014-11-24 20:57:22

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2014-11-24 20:57:22

I think our messages may have crossed in the ether.


---

Comment by git created at 2014-11-24 21:07:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-11-24 21:11:34

Looks nice!  What do you think about reference?  Maybe that can wait to #16333 in any case... I'm not really worrying about it, as long as it does happen.


---

Comment by vinceknight created at 2014-11-24 21:12:28

Replying to [comment:53 kcrisman]:
> Okay, I think this is fine, except for a few minor issues.
> * Add to reference manual?

I tried doing this but conscious to not actually want to import `gambit.py` as a Sage module, I only wanted to add it to the relevant `index.rst`. When trying to build the docs though I got an error:


```
[game_theo] /Users/vince/sage/src/doc/en/reference/game_theory/sage/game_theory/gambit.rst:11: WARNING: autodoc can't import/find module 'sage.game_theory.gambit', it reported error: "No module named gambit", please check your spelling and sys.path
```


This makes me think that I also need to link gambit.py as a library _which I don't want to do_ (especially named as it is). Am I missing something: is there a best way to do this or should we just leave it as it is? So that it is in essence 'for developers'?

> * Please recheck for duplication like
> {{{
> +    In [1]: g = gambit.Game.new_table([2,2])
> +    In [2]: g = gambit.Game.new_table([2,2])
> }}}

Have checked through.

> * I have a feeling that if this is added to reference, there will be a hiccup here.
> {{{
> +Here is a list of various other solvers that can be used:
> +
> +- ExternalEnumPureSolver
> +- ExternalEnumMixedSolver
> +- ExternalLPSolver
> +- ExternalLCPSolver
> +- ExternalSimpdivSolver
> +- ExternalGlobalNewtonSolver
> +- ExternalEnumPolySolver
> +- ExternalLyapunovSolver
> +- ExternalIteratedPolymatrixSolver
> +- ExternalLogitSolver
> +
> +    In [22]: solver = gambit.nash.ExternalEnumPureSolver()
> +    In [23]: solver.solve(g)
> +    Out[23]: [<NashProfile for '': [Fraction(0, 1), Fraction(1, 1), Fraction(0, 1), Fraction(1, 1)]>]
> +
> }}}
>    Because there is what is intended to be a literal block after a list.  You should have another sentence explaining it and then the usual double colon.

Yup: have fixed.

> * You will need to add `import gambit` before each of your Ipython examples, otherwise they don't work.

Woops: yup have added those in.


---

Comment by vinceknight created at 2014-11-24 21:13:22

Replying to [comment:57 kcrisman]:
> Looks nice!  What do you think about reference?  Maybe that can wait to #16333 in any case... I'm not really worrying about it, as long as it does happen.

Our messages just crossed again :) I think easiest to leave for #16333, could even then delete `gambit.py` and include the documentation in the docs for #16333.


---

Comment by kcrisman created at 2014-11-24 21:18:53

Yes, I agree this is not important enough to worry on the doc for this ticket.

However, I think that there should be another way to solve it - namely, by adding a file gambit.rst to src/doc/en/reference/game_theory/ where one wouldn't have to import the module to get the doc built.  This happens in some other modules in the reference manual.


---

Comment by vinceknight created at 2014-11-24 21:22:42

Replying to [comment:60 kcrisman]:
> Yes, I agree this is not important enough to worry on the doc for this ticket.
> 
> However, I think that there should be another way to solve it - namely, by adding a file gambit.rst to src/doc/en/reference/game_theory/ where one wouldn't have to import the module to get the doc built.  This happens in some other modules in the reference manual.

Right, I thought I might be missing something. I'll take a look at that when I get to working on #16333, I'll see what looks best: either a standalone gambit (if possible I think this could be nicest) section or include it as an addendum to the docs for `NormalFormGame`.

Let me know if there's anything else I can do for this one :)


---

Comment by kcrisman created at 2014-11-24 21:26:36

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2014-11-24 21:26:36

Nope, I think we're ready here!   I do want to see that Travis is able to just run a couple of the examples on Linux, possibly having it pass tests with `--optional=gambit`, so I'll let him push the final button.


---

Comment by tscrim created at 2014-11-24 22:22:44

I get slightly different output than what's in the prisoner's dilemma test (well, beyond my player's names):

```
NFG 1 R "Prisoners dilemma game" { "Alice" "Bob" }

{ { "1" "2" }
{ "1" "2" }
}
""

{
{ "" 0, 0 }
{ "" 0, 0 }
{ "" 0, 0 }
{ "" 0, 0 }
}
1 2 3 4 

```

I think it's equivalent, but I'm not completely sure. I'll let the final okay to Vince or Karl-Dieter.


---

Comment by kcrisman created at 2014-11-25 01:34:30

Haha, it's not just equivalent, it's *correct* and whatever is there is not what we get!  Vince, I think the current one must have been left over from before - an easy fix, copy and paste (it's not doctested, after all).  Similarly, `Out [22]` should be

```
[<NashProfile for 'A prisoner's dilemma game': [Fraction(0, 1), Fraction(1, 1), Fraction(0, 1), Fraction(1, 1)]>]
```



---

Comment by git created at 2014-11-25 07:06:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vinceknight created at 2014-11-25 07:07:31

Sorry both: clumsy mistake (indeed copy and paste relics). :)


---

Comment by kcrisman created at 2014-11-25 13:37:41

Travis, I'm going to assume you had no other problems running the stuff on Ubuntu.


---

Comment by kcrisman created at 2014-11-25 13:37:41

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-11-25 15:58:40

Nope, no other problems (other than when I tried to run Sage's IPython in the `game_theory` directory and the local `gambit` module got picked up, but that's a user error).


---

Comment by vbraun created at 2014-11-27 22:24:47

Resolution: fixed
