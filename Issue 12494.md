# Issue 12494: Optional CLooG spkg

archive/issues_012494.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  leif\n\nKeywords: CLooG\n\nAs much as I understand, some compiler optimizations rely on `CLooG` (the Chunky Loop Generator) being installed.\n\nHence, I suggest to have an optional spkg. At least on openSuse, the straight forward way to make an spkg (no patches, and an spkg-install and spkg-check that just to `./configure --prefix...`, `make`, `make install` and  `make check`) seems to work.\n\nThis is related with #12369 and #12661.\n\nInstall http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/cloog-0.17.0.spkg\n\nIssue created by migration from https://trac.sagemath.org/ticket/12666\n\n",
    "created_at": "2012-03-13T20:25:58Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "title": "Optional CLooG spkg",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12494",
    "user": "SimonKing"
}
```
Assignee: tbd

CC:  leif

Keywords: CLooG

As much as I understand, some compiler optimizations rely on `CLooG` (the Chunky Loop Generator) being installed.

Hence, I suggest to have an optional spkg. At least on openSuse, the straight forward way to make an spkg (no patches, and an spkg-install and spkg-check that just to `./configure --prefix...`, `make`, `make install` and  `make check`) seems to work.

This is related with #12369 and #12661.

Install http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/cloog-0.17.0.spkg

Issue created by migration from https://trac.sagemath.org/ticket/12666





---

archive/issue_comments_148018.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-03-13T20:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148018",
    "user": "SimonKing"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_148019.json:
```json
{
    "body": "I forgot to mention that `CLooG` needs `GMP`. Therefore it might be needed to install the spkg from #12661 as well.",
    "created_at": "2012-03-13T21:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148019",
    "user": "SimonKing"
}
```

I forgot to mention that `CLooG` needs `GMP`. Therefore it might be needed to install the spkg from #12661 as well.



---

archive/issue_comments_148020.json:
```json
{
    "body": "It turns out that the gcc package from #12369 can not use this cloog package.\n\nI am not sure whether this is because of wrong sources (there seems to be a difference between cloog and cloog-ppl) or a missing configuration option.\n\nAnyway. With a cloog-ppl package using the options `--with-gmp --with-ppl`, the gcc package seems to pick up `CLooG PPL`. I'm afraid I can not post the updated packages, as sage.math seems to be down.",
    "created_at": "2012-03-14T07:27:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148020",
    "user": "SimonKing"
}
```

It turns out that the gcc package from #12369 can not use this cloog package.

I am not sure whether this is because of wrong sources (there seems to be a difference between cloog and cloog-ppl) or a missing configuration option.

Anyway. With a cloog-ppl package using the options `--with-gmp --with-ppl`, the gcc package seems to pick up `CLooG PPL`. I'm afraid I can not post the updated packages, as sage.math seems to be down.



---

archive/issue_comments_148021.json:
```json
{
    "body": "I think you are missing the configure option\n\n```\n--with-gmp-prefix=\"$SAGE_LOCAL\"\n```\n",
    "created_at": "2012-03-14T09:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148021",
    "user": "jdemeyer"
}
```

I think you are missing the configure option

```
--with-gmp-prefix="$SAGE_LOCAL"
```




---

archive/issue_comments_148022.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-14T09:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148022",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148023.json:
```json
{
    "body": "(even though CLooG seems to build without that option, which I cannot really explain...)",
    "created_at": "2012-03-14T09:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148023",
    "user": "jdemeyer"
}
```

(even though CLooG seems to build without that option, which I cannot really explain...)



---

archive/issue_comments_148024.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> (even though CLooG seems to build without that option, which I cannot really explain...)\n\nI guess it is since `CLooG` looks for GMP in the standard location, \"standard\" being determined by the `--prefix=\"$SAGE_LOCAL\"` option that I do provide.\n\nAnyway. What is really missing is at least the option `--with-ppl`, or even a cloog-ppl package with that option.\n\nSince sage.math seems to be down, I can't post either of the two spkgs...",
    "created_at": "2012-03-14T09:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148024",
    "user": "SimonKing"
}
```

Replying to [comment:6 jdemeyer]:
> (even though CLooG seems to build without that option, which I cannot really explain...)

I guess it is since `CLooG` looks for GMP in the standard location, "standard" being determined by the `--prefix="$SAGE_LOCAL"` option that I do provide.

Anyway. What is really missing is at least the option `--with-ppl`, or even a cloog-ppl package with that option.

Since sage.math seems to be down, I can't post either of the two spkgs...



---

archive/issue_comments_148025.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-15T08:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148025",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148026.json:
```json
{
    "body": "[Leif](http://groups.google.com/group/sage-devel/browse_thread/thread/4e90520289b7b5ba/a84a9363d4ff6495) cited from the GCC prerequisites page:\n\n```\nCLooG-PPL version( 0.15 or CLooG 0.16\n    Necessary to build GCC with the Graphite loop optimizations. There\nare two versions available. CLooG-PPL 0.15 as well as CLooG 0.16. The\nformer is the default right now. It can be downloaded from\nftp://gcc.gnu.org/pub/gcc/infrastructure/ as cloog-ppl-0.15.tar.gz.\n\n    CLooG 0.16 support is still in testing stage, but will be the\ndefault in future GCC releases. It is also available at\nftp://gcc.gnu.org/pub/gcc/infrastructure/ as cloog-0.16.1.tar.gz. To\nuse it add the additional configure option --enable-cloog-backend=isl.\nEven if CLooG 0.16 does not use PPL, PPL is still required for\nGraphite.\n```\n\n\nActually, I found that `cloog-0.16.1` does not work, i.e., gcc does not build. Hence, I made a cloog_ppl-0.15.11 spkg, that I suggest to make an optional spkg.",
    "created_at": "2012-03-15T08:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148026",
    "user": "SimonKing"
}
```

[Leif](http://groups.google.com/group/sage-devel/browse_thread/thread/4e90520289b7b5ba/a84a9363d4ff6495) cited from the GCC prerequisites page:

```
CLooG-PPL version( 0.15 or CLooG 0.16
    Necessary to build GCC with the Graphite loop optimizations. There
are two versions available. CLooG-PPL 0.15 as well as CLooG 0.16. The
former is the default right now. It can be downloaded from
ftp://gcc.gnu.org/pub/gcc/infrastructure/ as cloog-ppl-0.15.tar.gz.

    CLooG 0.16 support is still in testing stage, but will be the
default in future GCC releases. It is also available at
ftp://gcc.gnu.org/pub/gcc/infrastructure/ as cloog-0.16.1.tar.gz. To
use it add the additional configure option --enable-cloog-backend=isl.
Even if CLooG 0.16 does not use PPL, PPL is still required for
Graphite.
```


Actually, I found that `cloog-0.16.1` does not work, i.e., gcc does not build. Hence, I made a cloog_ppl-0.15.11 spkg, that I suggest to make an optional spkg.



---

archive/issue_comments_148027.json:
```json
{
    "body": "Changing keywords from \"CLooG\" to \"CLooG PPL\".",
    "created_at": "2012-03-15T08:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148027",
    "user": "SimonKing"
}
```

Changing keywords from "CLooG" to "CLooG PPL".



---

archive/issue_comments_148028.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-03-15T13:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148028",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_148029.json:
```json
{
    "body": "You are missing the configure options\n\n```\n--with-gmp=\"$SAGE_LOCAL\" --with-ppl=\"$SAGE_LOCAL\"\n```\n\n\nIf I apply the following patch, CLooG-PPL builds fine (even without the GMP spkg):\n\n```diff\ndiff -r 93c792cfd365 spkg-install\n--- a/spkg-install      Wed Mar 14 08:12:41 2012 +0100\n+++ b/spkg-install      Thu Mar 15 14:46:53 2012 +0100\n@@ -10,7 +10,7 @@\n SAGE_CONF_OPTS=\"--enable-shared --disable-static\"\n\n cd src\n-./configure --libdir=\"$SAGE_LOCAL/lib\" --prefix=\"$SAGE_LOCAL\"  --with-gmp --with-ppl $SAGE_CONF_OPTS\n+./configure --libdir=\"$SAGE_LOCAL/lib\" --prefix=\"$SAGE_LOCAL\"  --with-gmp=\"$SAGE_LOCAL\" --with-ppl=\"$SAGE_LOCAL\" $SAGE_CONF_OPTS\n $MAKE\n if [ $? -ne 0 ]; then\n     echo \"Error building CLooG PPL.\"\n```\n",
    "created_at": "2012-03-15T13:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148029",
    "user": "jdemeyer"
}
```

You are missing the configure options

```
--with-gmp="$SAGE_LOCAL" --with-ppl="$SAGE_LOCAL"
```


If I apply the following patch, CLooG-PPL builds fine (even without the GMP spkg):

```diff
diff -r 93c792cfd365 spkg-install
--- a/spkg-install      Wed Mar 14 08:12:41 2012 +0100
+++ b/spkg-install      Thu Mar 15 14:46:53 2012 +0100
@@ -10,7 +10,7 @@
 SAGE_CONF_OPTS="--enable-shared --disable-static"

 cd src
-./configure --libdir="$SAGE_LOCAL/lib" --prefix="$SAGE_LOCAL"  --with-gmp --with-ppl $SAGE_CONF_OPTS
+./configure --libdir="$SAGE_LOCAL/lib" --prefix="$SAGE_LOCAL"  --with-gmp="$SAGE_LOCAL" --with-ppl="$SAGE_LOCAL" $SAGE_CONF_OPTS
 $MAKE
 if [ $? -ne 0 ]; then
     echo "Error building CLooG PPL."
```




---

archive/issue_comments_148030.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-03-15T13:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148030",
    "user": "SimonKing"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_148031.json:
```json
{
    "body": "Replying to [comment:9 jdemeyer]:\n> You are missing the configure options\n> {{{\n> --with-gmp=\"$SAGE_LOCAL\" --with-ppl=\"$SAGE_LOCAL\"\n> }}}\n> \n> If I apply the following patch, CLooG-PPL builds fine (even without the GMP spkg):\n\nCool! I just updated my [spkg on boxen.math](http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/cloog_ppl-0.15.11.spkg)",
    "created_at": "2012-03-15T13:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148031",
    "user": "SimonKing"
}
```

Replying to [comment:9 jdemeyer]:
> You are missing the configure options
> {{{
> --with-gmp="$SAGE_LOCAL" --with-ppl="$SAGE_LOCAL"
> }}}
> 
> If I apply the following patch, CLooG-PPL builds fine (even without the GMP spkg):

Cool! I just updated my [spkg on boxen.math](http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/cloog_ppl-0.15.11.spkg)



---

archive/issue_comments_148032.json:
```json
{
    "body": "Thanks, that seems to work.\n\nUnfortunately, I'm afraid your earlier performance tests with GCC are now invalidated and should be done again with this spkg and without GMP.",
    "created_at": "2012-03-15T14:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148032",
    "user": "jdemeyer"
}
```

Thanks, that seems to work.

Unfortunately, I'm afraid your earlier performance tests with GCC are now invalidated and should be done again with this spkg and without GMP.



---

archive/issue_comments_148033.json:
```json
{
    "body": "Should we obsolete this? Recent gcc still use cloog but with isl instead of ppl. Plus we upgraded ppl to 1.1 I don't think anyone patch cloog anymore to interface with ppl after 0.12.x. gcc was the main consumer of that.",
    "created_at": "2013-12-26T19:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148033",
    "user": "fbissey"
}
```

Should we obsolete this? Recent gcc still use cloog but with isl instead of ppl. Plus we upgraded ppl to 1.1 I don't think anyone patch cloog anymore to interface with ppl after 0.12.x. gcc was the main consumer of that.



---

archive/issue_comments_148034.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2013-12-26T19:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148034",
    "user": "fbissey"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_148035.json:
```json
{
    "body": "Replying to [comment:14 fbissey]:\n> Should we obsolete this? Recent gcc still use cloog but with isl instead of ppl. Plus we upgraded ppl to 1.1 I don't think anyone patch cloog anymore to interface with ppl after 0.12.x. gcc was the main consumer of that.\n\nMore than two and a half years later...\n\nI think we can close this, as while GCC 4.9 still uses CLooG and ISL, GCC 5.x and 6.x have dropped CLooG and now only use ISL (if at all, i.e., with `--enable-lto`).\n\n\\\\\n\nFeel free to open a new ticket making ISL an optional package.",
    "created_at": "2016-07-28T22:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148035",
    "user": "leif"
}
```

Replying to [comment:14 fbissey]:
> Should we obsolete this? Recent gcc still use cloog but with isl instead of ppl. Plus we upgraded ppl to 1.1 I don't think anyone patch cloog anymore to interface with ppl after 0.12.x. gcc was the main consumer of that.

More than two and a half years later...

I think we can close this, as while GCC 4.9 still uses CLooG and ISL, GCC 5.x and 6.x have dropped CLooG and now only use ISL (if at all, i.e., with `--enable-lto`).

\\

Feel free to open a new ticket making ISL an optional package.



---

archive/issue_comments_148036.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-07-28T22:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148036",
    "user": "leif"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_148037.json:
```json
{
    "body": "Changing keywords from \"CLooG PPL\" to \"CLooG PPL ISL GCC LTO\".",
    "created_at": "2016-07-28T22:00:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148037",
    "user": "leif"
}
```

Changing keywords from "CLooG PPL" to "CLooG PPL ISL GCC LTO".



---

archive/issue_comments_148038.json:
```json
{
    "body": "P.S.:  `--enable-lto` is meanwhile even the default.  GCC will automatically pick up ISL when present (installed library and headers, or source in the build tree) and otherwise simply disable LTO support.",
    "created_at": "2016-07-28T22:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148038",
    "user": "leif"
}
```

P.S.:  `--enable-lto` is meanwhile even the default.  GCC will automatically pick up ISL when present (installed library and headers, or source in the build tree) and otherwise simply disable LTO support.



---

archive/issue_comments_148039.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-07-28T22:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148039",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_148040.json:
```json
{
    "body": "cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not \"link time optimization\" unless you know something I don't. In any case I am for closing it too.",
    "created_at": "2016-07-28T22:51:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148040",
    "user": "fbissey"
}
```

cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not "link time optimization" unless you know something I don't. In any case I am for closing it too.



---

archive/issue_comments_148041.json:
```json
{
    "body": "Replying to [comment:20 fbissey]:\n> cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not \"link time optimization\" unless you know something I don't.\n\nYes, but that was (at least years ago) also, if not only, done *at link time*.  But LTO has massively changed (and improved) over the last years, they say.\n\nNot sure whether CLooG was initially used during *compilation* as well.\n\n\\\\\n\n\n> In any case I am for closing it too.\n\nOk, I guess Simon won't complain either.",
    "created_at": "2016-07-28T23:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148041",
    "user": "leif"
}
```

Replying to [comment:20 fbissey]:
> cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not "link time optimization" unless you know something I don't.

Yes, but that was (at least years ago) also, if not only, done *at link time*.  But LTO has massively changed (and improved) over the last years, they say.

Not sure whether CLooG was initially used during *compilation* as well.

\\


> In any case I am for closing it too.

Ok, I guess Simon won't complain either.



---

archive/issue_comments_148042.json:
```json
{
    "body": "Replying to [comment:21 leif]:\n> Replying to [comment:20 fbissey]:\n> > cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not \"link time optimization\" unless you know something I don't.\n> \n> Yes, but that was (at least years ago) also, if not only, done *at link time*.  But LTO has massively changed (and improved) over the last years, they say.\n> \n> Not sure whether CLooG was initially used during *compilation* as well.\n\nHmmm, strike that.  I couldn't find any reference, and both seem indeed independent, while combining them may of course be advantageous.  (Hence you're right, `--enable-lto` is orthogonal to `--with-isl`.)",
    "created_at": "2016-07-29T00:51:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148042",
    "user": "leif"
}
```

Replying to [comment:21 leif]:
> Replying to [comment:20 fbissey]:
> > cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not "link time optimization" unless you know something I don't.
> 
> Yes, but that was (at least years ago) also, if not only, done *at link time*.  But LTO has massively changed (and improved) over the last years, they say.
> 
> Not sure whether CLooG was initially used during *compilation* as well.

Hmmm, strike that.  I couldn't find any reference, and both seem indeed independent, while combining them may of course be advantageous.  (Hence you're right, `--enable-lto` is orthogonal to `--with-isl`.)



---

archive/issue_comments_148043.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2016-08-30T13:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148043",
    "user": "embray"
}
```

Resolution: wontfix



---

archive/issue_comments_148044.json:
```json
{
    "body": "Determined to be invalid/duplicate/wontfix (closing as \"wontfix\" as a catch-all resolution).",
    "created_at": "2016-08-30T13:32:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12494",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12494#issuecomment-148044",
    "user": "embray"
}
```

Determined to be invalid/duplicate/wontfix (closing as "wontfix" as a catch-all resolution).
