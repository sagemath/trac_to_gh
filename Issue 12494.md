# Issue 12494: Optional CLooG spkg

Issue created by migration from https://trac.sagemath.org/ticket/12666

Original creator: SimonKing

Original creation time: 2012-03-13 20:25:58

Assignee: tbd

CC:  leif

Keywords: CLooG

As much as I understand, some compiler optimizations rely on `CLooG` (the Chunky Loop Generator) being installed.

Hence, I suggest to have an optional spkg. At least on openSuse, the straight forward way to make an spkg (no patches, and an spkg-install and spkg-check that just to `./configure --prefix...`, `make`, `make install` and  `make check`) seems to work.

This is related with #12369 and #12661.

Install http://sage.math.washington.edu/home/SimonKing/SAGE/spkgs/cloog-0.17.0.spkg


---

Comment by SimonKing created at 2012-03-13 20:29:05

Changing status from new to needs_review.


---

Comment by SimonKing created at 2012-03-13 21:00:20

I forgot to mention that `CLooG` needs `GMP`. Therefore it might be needed to install the spkg from #12661 as well.


---

Comment by SimonKing created at 2012-03-14 07:27:01

It turns out that the gcc package from #12369 can not use this cloog package.

I am not sure whether this is because of wrong sources (there seems to be a difference between cloog and cloog-ppl) or a missing configuration option.

Anyway. With a cloog-ppl package using the options `--with-gmp --with-ppl`, the gcc package seems to pick up `CLooG PPL`. I'm afraid I can not post the updated packages, as sage.math seems to be down.


---

Comment by jdemeyer created at 2012-03-14 09:05:21

I think you are missing the configure option

```
--with-gmp-prefix="$SAGE_LOCAL"
```



---

Comment by jdemeyer created at 2012-03-14 09:05:21

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-03-14 09:07:40

(even though CLooG seems to build without that option, which I cannot really explain...)


---

Comment by SimonKing created at 2012-03-14 09:12:58

Replying to [comment:6 jdemeyer]:
> (even though CLooG seems to build without that option, which I cannot really explain...)

I guess it is since `CLooG` looks for GMP in the standard location, "standard" being determined by the `--prefix="$SAGE_LOCAL"` option that I do provide.

Anyway. What is really missing is at least the option `--with-ppl`, or even a cloog-ppl package with that option.

Since sage.math seems to be down, I can't post either of the two spkgs...


---

Comment by SimonKing created at 2012-03-15 08:48:13

Changing status from needs_work to needs_review.


---

Comment by SimonKing created at 2012-03-15 08:48:13

[Leif](http://groups.google.com/group/sage-devel/browse_thread/thread/4e90520289b7b5ba/a84a9363d4ff6495) cited from the GCC prerequisites page:

```
CLooG-PPL version( 0.15 or CLooG 0.16
    Necessary to build GCC with the Graphite loop optimizations. There
are two versions available. CLooG-PPL 0.15 as well as CLooG 0.16. The
former is the default right now. It can be downloaded from
ftp://gcc.gnu.org/pub/gcc/infrastructure/ as cloog-ppl-0.15.tar.gz.

    CLooG 0.16 support is still in testing stage, but will be the
default in future GCC releases. It is also available at
ftp://gcc.gnu.org/pub/gcc/infrastructure/ as cloog-0.16.1.tar.gz. To
use it add the additional configure option --enable-cloog-backend=isl.
Even if CLooG 0.16 does not use PPL, PPL is still required for
Graphite.
```


Actually, I found that `cloog-0.16.1` does not work, i.e., gcc does not build. Hence, I made a cloog_ppl-0.15.11 spkg, that I suggest to make an optional spkg.


---

Comment by SimonKing created at 2012-03-15 08:48:13

Changing keywords from "CLooG" to "CLooG PPL".


---

Comment by jdemeyer created at 2012-03-15 13:48:06

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-03-15 13:48:06

You are missing the configure options

```
--with-gmp="$SAGE_LOCAL" --with-ppl="$SAGE_LOCAL"
```


If I apply the following patch, CLooG-PPL builds fine (even without the GMP spkg):

```diff
diff -r 93c792cfd365 spkg-install
--- a/spkg-install      Wed Mar 14 08:12:41 2012 +0100
+++ b/spkg-install      Thu Mar 15 14:46:53 2012 +0100
@@ -10,7 +10,7 @@
 SAGE_CONF_OPTS="--enable-shared --disable-static"

 cd src
-./configure --libdir="$SAGE_LOCAL/lib" --prefix="$SAGE_LOCAL"  --with-gmp --with-ppl $SAGE_CONF_OPTS
+./configure --libdir="$SAGE_LOCAL/lib" --prefix="$SAGE_LOCAL"  --with-gmp="$SAGE_LOCAL" --with-ppl="$SAGE_LOCAL" $SAGE_CONF_OPTS
 $MAKE
 if [ $? -ne 0 ]; then
     echo "Error building CLooG PPL."
```



---

Comment by SimonKing created at 2012-03-15 13:57:49

Changing status from needs_work to needs_review.


---

Comment by SimonKing created at 2012-03-15 13:57:49

Replying to [comment:9 jdemeyer]:
> You are missing the configure options
> {{{
> --with-gmp="$SAGE_LOCAL" --with-ppl="$SAGE_LOCAL"
> }}}
> 
> If I apply the following patch, CLooG-PPL builds fine (even without the GMP spkg):

Cool! I just updated my [spkg on boxen.math](http://boxen.math.washington.edu/home/SimonKing/SAGE/spkgs/cloog_ppl-0.15.11.spkg)


---

Comment by jdemeyer created at 2012-03-15 14:08:39

Thanks, that seems to work.

Unfortunately, I'm afraid your earlier performance tests with GCC are now invalidated and should be done again with this spkg and without GMP.


---

Comment by fbissey created at 2013-12-26 19:40:38

Should we obsolete this? Recent gcc still use cloog but with isl instead of ppl. Plus we upgraded ppl to 1.1 I don't think anyone patch cloog anymore to interface with ppl after 0.12.x. gcc was the main consumer of that.


---

Comment by fbissey created at 2013-12-26 19:40:38

Changing status from needs_review to needs_info.


---

Comment by leif created at 2016-07-28 22:00:17

Replying to [comment:14 fbissey]:
> Should we obsolete this? Recent gcc still use cloog but with isl instead of ppl. Plus we upgraded ppl to 1.1 I don't think anyone patch cloog anymore to interface with ppl after 0.12.x. gcc was the main consumer of that.

More than two and a half years later...

I think we can close this, as while GCC 4.9 still uses CLooG and ISL, GCC 5.x and 6.x have dropped CLooG and now only use ISL (if at all, i.e., with `--enable-lto`).

\\

Feel free to open a new ticket making ISL an optional package.


---

Comment by leif created at 2016-07-28 22:00:17

Changing status from needs_info to needs_review.


---

Comment by leif created at 2016-07-28 22:00:17

Changing keywords from "CLooG PPL" to "CLooG PPL ISL GCC LTO".


---

Comment by leif created at 2016-07-28 22:17:35

P.S.:  `--enable-lto` is meanwhile even the default.  GCC will automatically pick up ISL when present (installed library and headers, or source in the build tree) and otherwise simply disable LTO support.


---

Comment by fbissey created at 2016-07-28 22:51:55

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2016-07-28 22:51:55

cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not "link time optimization" unless you know something I don't. In any case I am for closing it too.


---

Comment by leif created at 2016-07-28 23:14:18

Replying to [comment:20 fbissey]:
> cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not "link time optimization" unless you know something I don't.

Yes, but that was (at least years ago) also, if not only, done _at link time_.  But LTO has massively changed (and improved) over the last years, they say.

Not sure whether CLooG was initially used during _compilation_ as well.

\\


> In any case I am for closing it too.

Ok, I guess Simon won't complain either.


---

Comment by leif created at 2016-07-29 00:51:09

Replying to [comment:21 leif]:
> Replying to [comment:20 fbissey]:
> > cloog/isl and previously ppl were for the graphite plugin which does loop optimization, not "link time optimization" unless you know something I don't.
> 
> Yes, but that was (at least years ago) also, if not only, done _at link time_.  But LTO has massively changed (and improved) over the last years, they say.
> 
> Not sure whether CLooG was initially used during _compilation_ as well.

Hmmm, strike that.  I couldn't find any reference, and both seem indeed independent, while combining them may of course be advantageous.  (Hence you're right, `--enable-lto` is orthogonal to `--with-isl`.)


---

Comment by embray created at 2016-08-30 13:32:25

Resolution: wontfix


---

Comment by embray created at 2016-08-30 13:32:25

Determined to be invalid/duplicate/wontfix (closing as "wontfix" as a catch-all resolution).
