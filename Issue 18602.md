# Issue 18602: Boost Dominator Tree

archive/issues_018602.json:
```json
{
    "body": "CC:  @nathanncohen @dcoudert\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18839\n\n",
    "created_at": "2015-07-02T08:16:52Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Boost Dominator Tree",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18602",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```
CC:  @nathanncohen @dcoudert



Issue created by migration from https://trac.sagemath.org/ticket/18839





---

archive/issue_comments_252843.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2015-07-02T08:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252843",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_252844.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2015-07-02T08:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252844",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_252845.json:
```json
{
    "body": "Changing keywords from \"\" to \"Dominator tree, Boost\".",
    "created_at": "2015-07-02T08:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252845",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing keywords from "" to "Dominator tree, Boost".



---

archive/issue_comments_252846.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-07-02T10:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252846",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_252847.json:
```json
{
    "body": "This is the first draft of the Boost algorithm for computing dominator trees (see https://en.wikipedia.org/wiki/Dominator_%28graph_theory%29 for the definition of dominator tree).\n\n---\nNew commits:\n",
    "created_at": "2015-07-02T10:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252847",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

This is the first draft of the Boost algorithm for computing dominator trees (see https://en.wikipedia.org/wiki/Dominator_%28graph_theory%29 for the definition of dominator tree).

---
New commits:




---

archive/issue_comments_252848.json:
```json
{
    "body": "Nicely done.\n\nMay be you could combine methods  `dominator_tree_dictionary` and `dominator_tree` using an optional parameter (e.g., `return_dict=False`) ?\n\nActually I don't know which is the most useful: the tree or the dictionary.\n\nAlso, I suggest\n\n```\n- edges = [[v,dom_tree_dict[v]] for v in dom_tree_dict.keys() if dom_tree_dict[v] is not None]\n+ edges = [[v,dom_v] for v,dom_v in dom_tree_dict.iteritems() if not dom_v is None]\n```",
    "created_at": "2015-07-03T17:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252848",
    "user": "https://github.com/dcoudert"
}
```

Nicely done.

May be you could combine methods  `dominator_tree_dictionary` and `dominator_tree` using an optional parameter (e.g., `return_dict=False`) ?

Actually I don't know which is the most useful: the tree or the dictionary.

Also, I suggest

```
- edges = [[v,dom_tree_dict[v]] for v in dom_tree_dict.keys() if dom_tree_dict[v] is not None]
+ edges = [[v,dom_v] for v,dom_v in dom_tree_dict.iteritems() if not dom_v is None]
```



---

archive/issue_comments_252849.json:
```json
{
    "body": "> May be you could combine methods  `dominator_tree_dictionary` and `dominator_tree` using an optional parameter (e.g., `return_dict=False`) ?\n\n+1\n\nAlso, you do not need to write two functions (with doc+test) when everything it does is call another function defined outside, in a module. You will find many such examples at the bottom of `generic_graph.py`.\n\nNathann",
    "created_at": "2015-07-03T17:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252849",
    "user": "https://github.com/nathanncohen"
}
```

> May be you could combine methods  `dominator_tree_dictionary` and `dominator_tree` using an optional parameter (e.g., `return_dict=False`) ?

+1

Also, you do not need to write two functions (with doc+test) when everything it does is call another function defined outside, in a module. You will find many such examples at the bottom of `generic_graph.py`.

Nathann



---

archive/issue_comments_252850.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-06T07:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252850",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252851.json:
```json
{
    "body": "Done everything!",
    "created_at": "2015-07-06T07:44:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252851",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Done everything!



---

archive/issue_comments_252852.json:
```json
{
    "body": "Install OK, docbuild OK, doc looks good.\n\nHowever, I have questions on the expected behavior:\n- with 1-vertex graph:\n\n```\nsage: G = graphs.PathGraph(1)\nsage: G.dominator_tree(0)\n{0: None}\nsage: G.dominator_tree(0, return_dict=False)\nGraph on 0 vertices\n```\n- With disconnected graphs\n\n```\nsage: G = 2 * graphs.PathGraph(1)\nsage: G.dominator_tree(0)\n{0: None, 1: None}\nsage: G = 2 * graphs.PathGraph(2)\nsage: G.dominator_tree(0)\n{0: None, 1: 0, 2: None, 3: None}\n```\nIf this is effectively what we expect, then I will finalize the review.",
    "created_at": "2015-07-06T15:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252852",
    "user": "https://github.com/dcoudert"
}
```

Install OK, docbuild OK, doc looks good.

However, I have questions on the expected behavior:
- with 1-vertex graph:

```
sage: G = graphs.PathGraph(1)
sage: G.dominator_tree(0)
{0: None}
sage: G.dominator_tree(0, return_dict=False)
Graph on 0 vertices
```
- With disconnected graphs

```
sage: G = 2 * graphs.PathGraph(1)
sage: G.dominator_tree(0)
{0: None, 1: None}
sage: G = 2 * graphs.PathGraph(2)
sage: G.dominator_tree(0)
{0: None, 1: 0, 2: None, 3: None}
```
If this is effectively what we expect, then I will finalize the review.



---

archive/issue_comments_252853.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-06T15:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252854.json:
```json
{
    "body": "Helloooooo again,\n\nIs there any reason why you kept two functions with the same name (dominator_tree)? If you moved the 'graph output' to the one defined in `boost_graph.pyx`, you would only have to import it in the `GenericGraph` object. No duplication of doc/doctest.\n\nNathann",
    "created_at": "2015-07-06T15:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252854",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooo again,

Is there any reason why you kept two functions with the same name (dominator_tree)? If you moved the 'graph output' to the one defined in `boost_graph.pyx`, you would only have to import it in the `GenericGraph` object. No duplication of doc/doctest.

Nathann



---

archive/issue_comments_252855.json:
```json
{
    "body": "> However, I have questions on the expected behavior:\n> - with 1-vertex graph:\n> \n> ```\n> sage: G = graphs.[wiki:PathGraph](1)\n> sage: G.dominator_tree(0)\n> {0: None}\n> sage: G.dominator_tree(0, return_dict=False)\n> Graph on 0 vertices\n> ```\n\n\nYou are right, if the dominator tree is empty (that is, if from the root we cannot reach any other vertex) it is better to output a 1-vertex graph containing the root, not an empty graph. For the dictionary, I think the behavior is correct.\n\n> - With disconnected graphs\n> \n> ```\n> sage: G = 2 * graphs.[wiki:PathGraph](1)\n> sage: G.dominator_tree(0)\n> {0: None, 1: None}\n> sage: G = 2 * graphs.[wiki:PathGraph](2)\n> sage: G.dominator_tree(0)\n> {0: None, 1: 0, 2: None, 3: None}\n> ```\n> If this is effectively what we expect, then I will finalize the review.\n\n\nHere, the behavior is correct, in my opinion. I have changed the doc to better explain this case, by adding an \"OUTPUT\" block.",
    "created_at": "2015-07-06T15:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252855",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

> However, I have questions on the expected behavior:
> - with 1-vertex graph:
> 
> ```
> sage: G = graphs.[wiki:PathGraph](1)
> sage: G.dominator_tree(0)
> {0: None}
> sage: G.dominator_tree(0, return_dict=False)
> Graph on 0 vertices
> ```


You are right, if the dominator tree is empty (that is, if from the root we cannot reach any other vertex) it is better to output a 1-vertex graph containing the root, not an empty graph. For the dictionary, I think the behavior is correct.

> - With disconnected graphs
> 
> ```
> sage: G = 2 * graphs.[wiki:PathGraph](1)
> sage: G.dominator_tree(0)
> {0: None, 1: None}
> sage: G = 2 * graphs.[wiki:PathGraph](2)
> sage: G.dominator_tree(0)
> {0: None, 1: 0, 2: None, 3: None}
> ```
> If this is effectively what we expect, then I will finalize the review.


Here, the behavior is correct, in my opinion. I have changed the doc to better explain this case, by adding an "OUTPUT" block.



---

archive/issue_comments_252856.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-06T15:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252857.json:
```json
{
    "body": "You mean that I should move all the code in boost_graph.pyx, and then import this function through something like\n\n`GenericGraph.dominator_tree = types.MethodType(sage.graphs.base.boost_graph.dominator_tree(GenericGraph, ???))`\n\nCould you tell me the exact command? The three examples I have found in `generic_graph.py` do not have arguments...\n\nReplying to [comment:12 ncohen]:\n\n\n> Helloooooo again,\n> \n> Is there any reason why you kept two functions with the same name (dominator_tree)? If you moved the 'graph output' to the one defined in `boost_graph.pyx`, you would only have to import it in the `GenericGraph` object. No duplication of doc/doctest.\n> \n> Nathann",
    "created_at": "2015-07-06T15:53:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252857",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

You mean that I should move all the code in boost_graph.pyx, and then import this function through something like

`GenericGraph.dominator_tree = types.MethodType(sage.graphs.base.boost_graph.dominator_tree(GenericGraph, ???))`

Could you tell me the exact command? The three examples I have found in `generic_graph.py` do not have arguments...

Replying to [comment:12 ncohen]:


> Helloooooo again,
> 
> Is there any reason why you kept two functions with the same name (dominator_tree)? If you moved the 'graph output' to the one defined in `boost_graph.pyx`, you would only have to import it in the `GenericGraph` object. No duplication of doc/doctest.
> 
> Nathann



---

archive/issue_comments_252858.json:
```json
{
    "body": "A good example is  `GenericGraph.diameter = types.MethodType(sage.graphs.distances_all_pairs.diameter, None, GenericGraph)`.\nIt has several arguments (e.g. `method='iFUB'`).",
    "created_at": "2015-07-06T17:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252858",
    "user": "https://github.com/dcoudert"
}
```

A good example is  `GenericGraph.diameter = types.MethodType(sage.graphs.distances_all_pairs.diameter, None, GenericGraph)`.
It has several arguments (e.g. `method='iFUB'`).



---

archive/issue_comments_252859.json:
```json
{
    "body": "Hellooooooo!\n\nI have done it, but there is a problem: in order to obtain this result, `generic_graph` should import `boost_graph`, which imports `directed_graph`, which imports `generic_graph`, and I have cyclic dependencies. I tried to put\n\n```\nimport types\nfrom sage.graphs.generic_graph import GenericGraph\nGenericGraph.dominator_tree = types.MethodType(dominator_tree, None, GenericGraph)\n```\ninside boost_graph, but it is not imported when Sage starts, so I have to import boost_graph before running dominator_tree (and I don't like it). Any suggestion?\n\nReplying to [comment:16 dcoudert]:\n\n\n> A good example is  `GenericGraph.diameter = types.MethodType(sage.graphs.distances_all_pairs.diameter, None, GenericGraph)`.\n> It has several arguments (e.g. `method='iFUB'`).",
    "created_at": "2015-07-06T19:21:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252859",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hellooooooo!

I have done it, but there is a problem: in order to obtain this result, `generic_graph` should import `boost_graph`, which imports `directed_graph`, which imports `generic_graph`, and I have cyclic dependencies. I tried to put

```
import types
from sage.graphs.generic_graph import GenericGraph
GenericGraph.dominator_tree = types.MethodType(dominator_tree, None, GenericGraph)
```
inside boost_graph, but it is not imported when Sage starts, so I have to import boost_graph before running dominator_tree (and I don't like it). Any suggestion?

Replying to [comment:16 dcoudert]:


> A good example is  `GenericGraph.diameter = types.MethodType(sage.graphs.distances_all_pairs.diameter, None, GenericGraph)`.
> It has several arguments (e.g. `method='iFUB'`).



---

archive/issue_comments_252860.json:
```json
{
    "body": "This is weird since for instance the `distances_all_pairs` module imports `Graph` many times.\n\nCould you try the following: in the `boost_graph.pyx` file, move the `from sage.graphs.graph import Graph` statement inside all the methods using it. Same for `DiGraph` etc.\n\nDavid.",
    "created_at": "2015-07-06T20:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252860",
    "user": "https://github.com/dcoudert"
}
```

This is weird since for instance the `distances_all_pairs` module imports `Graph` many times.

Could you try the following: in the `boost_graph.pyx` file, move the `from sage.graphs.graph import Graph` statement inside all the methods using it. Same for `DiGraph` etc.

David.



---

archive/issue_comments_252861.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-06T20:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_252862.json:
```json
{
    "body": "Helloooooo!\n\nThank you very much: it worked! Now, I have rebased all my commits, so that the history of generic_graph is correct, and I have moved everything to boost_graph.\n\nReplying to [comment:18 dcoudert]:\n\n\n> This is weird since for instance the `distances_all_pairs` module imports `Graph` many times.\n> \n> Could you try the following: in the `boost_graph.pyx` file, move the `from sage.graphs.graph import Graph` statement inside all the methods using it. Same for `DiGraph` etc.\n> \n> David.",
    "created_at": "2015-07-06T20:43:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252862",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Helloooooo!

Thank you very much: it worked! Now, I have rebased all my commits, so that the history of generic_graph is correct, and I have moved everything to boost_graph.

Replying to [comment:18 dcoudert]:


> This is weird since for instance the `distances_all_pairs` module imports `Graph` many times.
> 
> Could you try the following: in the `boost_graph.pyx` file, move the `from sage.graphs.graph import Graph` statement inside all the methods using it. Same for `DiGraph` etc.
> 
> David.



---

archive/issue_comments_252863.json:
```json
{
    "body": "Something goes wrong with your last commits, some conflicts. I don't know how to solve that (not git expert).",
    "created_at": "2015-07-06T20:48:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252863",
    "user": "https://github.com/dcoudert"
}
```

Something goes wrong with your last commits, some conflicts. I don't know how to solve that (not git expert).



---

archive/issue_comments_252864.json:
```json
{
    "body": "Strange, in my computer it works correctly... Maybe you have to perform a forced pull, since I had to perform a forced push, or try to remove your local branch and re-download it... Nathann?",
    "created_at": "2015-07-06T20:50:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252864",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Strange, in my computer it works correctly... Maybe you have to perform a forced pull, since I had to perform a forced push, or try to remove your local branch and re-download it... Nathann?



---

archive/issue_comments_252865.json:
```json
{
    "body": "I also see conflicts. And the branch's name of thi ticket appears in red, which is a sign too.\n\nNathann",
    "created_at": "2015-07-07T06:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252865",
    "user": "https://github.com/nathanncohen"
}
```

I also see conflicts. And the branch's name of thi ticket appears in red, which is a sign too.

Nathann



---

archive/issue_comments_252866.json:
```json
{
    "body": "Michele: are you running beta7? If not, that's the reason.\n\nNathann",
    "created_at": "2015-07-07T06:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252866",
    "user": "https://github.com/nathanncohen"
}
```

Michele: are you running beta7? If not, that's the reason.

Nathann



---

archive/issue_comments_252867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-07T12:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_252868.json:
```json
{
    "body": "Now it should work: I have downloaded beta7, and I have added the missing parts.",
    "created_at": "2015-07-07T12:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252868",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Now it should work: I have downloaded beta7, and I have added the missing parts.



---

archive/issue_comments_252869.json:
```json
{
    "body": "Now it's working and I'm trying to understand the expected behavior of the method.\n\n- is it normal that the resulting tree is always a star ?\n\n```\nsage: G = graphs.RandomBarabasiAlbert(1000,2)\nsage: H = G.dominator_tree(0, return_dict=False)\nsage: H.is_tree() and H.diameter()<=2\nTrue\nsage: H = G.dominator_tree(193, return_dict=False)\nsage: H.is_tree() and H.diameter()<=2\nTrue\n```\n\n\n- I suggest to set parameter `return_dict=False` by default. Well I don't know which is the most useful\n\n- There is a labeling problem with the root.\n\n```\nsage: G = graphs.Grid2dGraph(4,4)\nsage: G.dominator_tree((0,0), return_dict=False).vertices()\n[0,\n (0, 1),\n (0, 2),\n (0, 3),\n (1, 0),\n (1, 1),\n (1, 2),\n (1, 3),\n (2, 0),\n (2, 1),\n (2, 2),\n (2, 3),\n (3, 0),\n (3, 1),\n (3, 2),\n (3, 3)]\nsage: G.dominator_tree((1,1), return_dict=False).vertices()\n[5,\n (0, 0),\n (0, 1),\n (0, 2),\n (0, 3),\n (1, 0),\n (1, 2),\n (1, 3),\n (2, 0),\n (2, 1),\n (2, 2),\n (2, 3),\n (3, 0),\n (3, 1),\n (3, 2),\n (3, 3)]\n```\n\n- Try also this. The output digraph is not connected and you have some labeling problems.\n\n```\nsage: D = digraphs.DeBruijn(2,4)\nsage: D.dominator_tree('0000', return_dict=False).show()\n```\n\nDavid.",
    "created_at": "2015-07-07T18:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252869",
    "user": "https://github.com/dcoudert"
}
```

Now it's working and I'm trying to understand the expected behavior of the method.

- is it normal that the resulting tree is always a star ?

```
sage: G = graphs.RandomBarabasiAlbert(1000,2)
sage: H = G.dominator_tree(0, return_dict=False)
sage: H.is_tree() and H.diameter()<=2
True
sage: H = G.dominator_tree(193, return_dict=False)
sage: H.is_tree() and H.diameter()<=2
True
```


- I suggest to set parameter `return_dict=False` by default. Well I don't know which is the most useful

- There is a labeling problem with the root.

```
sage: G = graphs.Grid2dGraph(4,4)
sage: G.dominator_tree((0,0), return_dict=False).vertices()
[0,
 (0, 1),
 (0, 2),
 (0, 3),
 (1, 0),
 (1, 1),
 (1, 2),
 (1, 3),
 (2, 0),
 (2, 1),
 (2, 2),
 (2, 3),
 (3, 0),
 (3, 1),
 (3, 2),
 (3, 3)]
sage: G.dominator_tree((1,1), return_dict=False).vertices()
[5,
 (0, 0),
 (0, 1),
 (0, 2),
 (0, 3),
 (1, 0),
 (1, 2),
 (1, 3),
 (2, 0),
 (2, 1),
 (2, 2),
 (2, 3),
 (3, 0),
 (3, 1),
 (3, 2),
 (3, 3)]
```

- Try also this. The output digraph is not connected and you have some labeling problems.

```
sage: D = digraphs.DeBruijn(2,4)
sage: D.dominator_tree('0000', return_dict=False).show()
```

David.



---

archive/issue_comments_252870.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-07-07T18:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252870",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_252871.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-07T20:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252872.json:
```json
{
    "body": "Replying to [comment:27 dcoudert]:\n\n> Now it's working and I'm trying to understand the expected behavior of the method.\n> \n> - is it normal that the resulting tree is always a star ?\n> \n> ```\n> sage: G = graphs.[wiki:RandomBarabasiAlbert](1000,2)\n> sage: H = G.dominator_tree(0, return_dict=False)\n> sage: H.is_tree() and H.diameter()<=2\n> True\n> sage: H = G.dominator_tree(193, return_dict=False)\n> sage: H.is_tree() and H.diameter()<=2\n> True\n> ```\n\n\nYes, it is: if the input is undirected, the dominator tree is a star if and only the if the graph is biconnected. In a Barabasi-Albert graph, the minimum degree is 2, so I believe it is.\n\n> \n> - I suggest to set parameter `return_dict=False` by default. Well I don't know which is the most useful\n\n\nDone!\n\n> - There is a labeling problem with the root.\n> \n> ```\n> sage: G = graphs.Grid2dGraph(4,4)\n> sage: G.dominator_tree((0,0), return_dict=False).vertices()\n> [0,\n> (0, 1),\n> (0, 2),\n> (0, 3),\n> (1, 0),\n> (1, 1),\n> (1, 2),\n> (1, 3),\n> (2, 0),\n> (2, 1),\n> (2, 2),\n> (2, 3),\n> (3, 0),\n> (3, 1),\n> (3, 2),\n> (3, 3)]\n> sage: G.dominator_tree((1,1), return_dict=False).vertices()\n> [5,\n> (0, 0),\n> (0, 1),\n> (0, 2),\n> (0, 3),\n> (1, 0),\n> (1, 2),\n> (1, 3),\n> (2, 0),\n> (2, 1),\n> (2, 2),\n> (2, 3),\n> (3, 0),\n> (3, 1),\n> (3, 2),\n> (3, 3)]\n> ```\n> \n> - Try also this. The output digraph is not connected and you have some labeling problems.\n> \n> ```\n> sage: D = digraphs.[wiki:DeBruijn](2,4)\n> sage: D.dominator_tree('0000', return_dict=False).show()\n> ```\n\n\nYes, you are right, I did not \"translate\" properly the Boost vertices into Sage labels. I have corrected that line and I have added a test to check that the translation is correct. The new line is:\n\n```\nedges = [[int_to_vertex[result[vertex_to_int[v]]], v] for v in g.vertices() if result[vertex_to_int[v]] != no_parent]\n```\nThank you very much!",
    "created_at": "2015-07-07T21:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252872",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Replying to [comment:27 dcoudert]:

> Now it's working and I'm trying to understand the expected behavior of the method.
> 
> - is it normal that the resulting tree is always a star ?
> 
> ```
> sage: G = graphs.[wiki:RandomBarabasiAlbert](1000,2)
> sage: H = G.dominator_tree(0, return_dict=False)
> sage: H.is_tree() and H.diameter()<=2
> True
> sage: H = G.dominator_tree(193, return_dict=False)
> sage: H.is_tree() and H.diameter()<=2
> True
> ```


Yes, it is: if the input is undirected, the dominator tree is a star if and only the if the graph is biconnected. In a Barabasi-Albert graph, the minimum degree is 2, so I believe it is.

> 
> - I suggest to set parameter `return_dict=False` by default. Well I don't know which is the most useful


Done!

> - There is a labeling problem with the root.
> 
> ```
> sage: G = graphs.Grid2dGraph(4,4)
> sage: G.dominator_tree((0,0), return_dict=False).vertices()
> [0,
> (0, 1),
> (0, 2),
> (0, 3),
> (1, 0),
> (1, 1),
> (1, 2),
> (1, 3),
> (2, 0),
> (2, 1),
> (2, 2),
> (2, 3),
> (3, 0),
> (3, 1),
> (3, 2),
> (3, 3)]
> sage: G.dominator_tree((1,1), return_dict=False).vertices()
> [5,
> (0, 0),
> (0, 1),
> (0, 2),
> (0, 3),
> (1, 0),
> (1, 2),
> (1, 3),
> (2, 0),
> (2, 1),
> (2, 2),
> (2, 3),
> (3, 0),
> (3, 1),
> (3, 2),
> (3, 3)]
> ```
> 
> - Try also this. The output digraph is not connected and you have some labeling problems.
> 
> ```
> sage: D = digraphs.[wiki:DeBruijn](2,4)
> sage: D.dominator_tree('0000', return_dict=False).show()
> ```


Yes, you are right, I did not "translate" properly the Boost vertices into Sage labels. I have corrected that line and I have added a test to check that the translation is correct. The new line is:

```
edges = [[int_to_vertex[result[vertex_to_int[v]]], v] for v in g.vertices() if result[vertex_to_int[v]] != no_parent]
```
Thank you very much!



---

archive/issue_comments_252873.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-07-07T21:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252873",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_252874.json:
```json
{
    "body": "> Yes, it is: if the input is undirected, the dominator tree is a star if and only the if the graph is biconnected. In a Barabasi-Albert graph, the minimum degree is 2, so I believe it is.\n\n\nSo for undirected graphs, we can first test if is it connected. If true, then we can directly construct and return the star (or the dict) without using boost, right? If False, then what's the output ?\n\nWhat for directed graphs?\n\nDavid.",
    "created_at": "2015-07-08T07:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252874",
    "user": "https://github.com/dcoudert"
}
```

> Yes, it is: if the input is undirected, the dominator tree is a star if and only the if the graph is biconnected. In a Barabasi-Albert graph, the minimum degree is 2, so I believe it is.


So for undirected graphs, we can first test if is it connected. If true, then we can directly construct and return the star (or the dict) without using boost, right? If False, then what's the output ?

What for directed graphs?

David.



---

archive/issue_comments_252875.json:
```json
{
    "body": "Hellooooo!\n\nReplying to [comment:30 dcoudert]:\n\n> So for undirected graphs, we can first test if is it connected. If true, then we can directly construct and return the star (or the dict) without using boost, right? If False, then what's the output ?\n\n\nWell, not connected but biconnected. In any case, probably the dominator tree in the undirected case can be found by computing biconnected components and cut vertices. There is a linear algorithm for biconnected components, but it is not very easy to implement, and the Boost algorithm is O(m log m), which is not much worse than O(m). Is the linear algorithm for BCC implemented in the hyperbolicity algorithm?\n\n> \n> What for directed graphs?\n\n\nWell, it is more complicated... I heard that finding linear algorithms for this problem is an open issue, and the Boost algorithm should be optimal. For more information, see the Boost help page http://www.boost.org/doc/libs/1_58_0/libs/graph/doc/lengauer_tarjan_dominator.htm.\n\nMichele",
    "created_at": "2015-07-08T08:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252875",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hellooooo!

Replying to [comment:30 dcoudert]:

> So for undirected graphs, we can first test if is it connected. If true, then we can directly construct and return the star (or the dict) without using boost, right? If False, then what's the output ?


Well, not connected but biconnected. In any case, probably the dominator tree in the undirected case can be found by computing biconnected components and cut vertices. There is a linear algorithm for biconnected components, but it is not very easy to implement, and the Boost algorithm is O(m log m), which is not much worse than O(m). Is the linear algorithm for BCC implemented in the hyperbolicity algorithm?

> 
> What for directed graphs?


Well, it is more complicated... I heard that finding linear algorithms for this problem is an open issue, and the Boost algorithm should be optimal. For more information, see the Boost help page http://www.boost.org/doc/libs/1_58_0/libs/graph/doc/lengauer_tarjan_dominator.htm.

Michele



---

archive/issue_comments_252876.json:
```json
{
    "body": "Replying to [comment:31 borassi]:\n> Hellooooo!\n> \n> Replying to [comment:30 dcoudert]:\n> \n> > So for undirected graphs, we can first test if is it connected. If true, then we can directly construct and return the star (or the dict) without using boost, right? If False, then what's the output ?\n\n> \n> Well, not connected but biconnected. \n\n\nOK, I see. Could you mention this in the description of the method? and perhaps add a simple example of a graph with 2 biconnected components. For Instance\n\n```\nsage: G = 2*graphs.CycleGraph(3)\nsage: G.add_edge(0,3)\nsage: G.dominator_tree(0, return_dict=True)\n{0: None, 1: 0, 2: 0, 3: 0, 4: 3, 5: 3}\n```\n\n> In any case, probably the dominator tree in the undirected case can be found by computing biconnected components and cut vertices. There is a linear algorithm for biconnected components, but it is not very easy to implement, and the Boost algorithm is O(m log m), which is not much worse than O(m). Is the linear algorithm for BCC implemented in the hyperbolicity algorithm?\n\n\nFor undirected graphs, we have `B,C = G.blocks_and_cut_vertices()`, where `B` is the list of blocks (list of vertices of each biconnected component) and `C` is the list of cut vertices. It's a Python implementation, but it's efficient. We use it for the hyperbolicity and many other algorithms.\n\nHowever, now that I have a better understanding of the method, I think it is better to let it as it is. So improve the doc and it should be ok.\n\nDavid.",
    "created_at": "2015-07-08T09:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252876",
    "user": "https://github.com/dcoudert"
}
```

Replying to [comment:31 borassi]:
> Hellooooo!
> 
> Replying to [comment:30 dcoudert]:
> 
> > So for undirected graphs, we can first test if is it connected. If true, then we can directly construct and return the star (or the dict) without using boost, right? If False, then what's the output ?

> 
> Well, not connected but biconnected. 


OK, I see. Could you mention this in the description of the method? and perhaps add a simple example of a graph with 2 biconnected components. For Instance

```
sage: G = 2*graphs.CycleGraph(3)
sage: G.add_edge(0,3)
sage: G.dominator_tree(0, return_dict=True)
{0: None, 1: 0, 2: 0, 3: 0, 4: 3, 5: 3}
```

> In any case, probably the dominator tree in the undirected case can be found by computing biconnected components and cut vertices. There is a linear algorithm for biconnected components, but it is not very easy to implement, and the Boost algorithm is O(m log m), which is not much worse than O(m). Is the linear algorithm for BCC implemented in the hyperbolicity algorithm?


For undirected graphs, we have `B,C = G.blocks_and_cut_vertices()`, where `B` is the list of blocks (list of vertices of each biconnected component) and `C` is the list of cut vertices. It's a Python implementation, but it's efficient. We use it for the hyperbolicity and many other algorithms.

However, now that I have a better understanding of the method, I think it is better to let it as it is. So improve the doc and it should be ok.

David.



---

archive/issue_comments_252877.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-08T13:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252877",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252878.json:
```json
{
    "body": "> However, now that I have a better understanding of the method, I think it is better to let it as it is. So improve the doc and it should be ok.\n\n\nDone!",
    "created_at": "2015-07-08T13:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252878",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

> However, now that I have a better understanding of the method, I think it is better to let it as it is. So improve the doc and it should be ok.


Done!



---

archive/issue_comments_252879.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-08T14:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252879",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_252880.json:
```json
{
    "body": "For me the patch is now good to go!",
    "created_at": "2015-07-08T14:00:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252880",
    "user": "https://github.com/dcoudert"
}
```

For me the patch is now good to go!



---

archive/issue_comments_252881.json:
```json
{
    "body": "Fails on 32-bit\n\n```\nsage -t --long src/sage/graphs/base/boost_graph.pyx\n**********************************************************************\nFile \"src/sage/graphs/base/boost_graph.pyx\", line 101, in sage.graphs.base.boost_graph.edge_connectivity\nFailed example:\n    edge_connectivity(g)\nExpected:\n    [4, [(0, 1), (0, 2), (0, 3), (0, 4)]]\nGot:\n    [4L, [(0L, 1L), (0L, 2L), (0L, 3L), (0L, 4L)]]\n**********************************************************************\n1 item had failures:\n```",
    "created_at": "2015-07-08T22:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252881",
    "user": "https://github.com/vbraun"
}
```

Fails on 32-bit

```
sage -t --long src/sage/graphs/base/boost_graph.pyx
**********************************************************************
File "src/sage/graphs/base/boost_graph.pyx", line 101, in sage.graphs.base.boost_graph.edge_connectivity
Failed example:
    edge_connectivity(g)
Expected:
    [4, [(0, 1), (0, 2), (0, 3), (0, 4)]]
Got:
    [4L, [(0L, 1L), (0L, 2L), (0L, 3L), (0L, 4L)]]
**********************************************************************
1 item had failures:
```



---

archive/issue_comments_252882.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-07-08T22:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252882",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_252883.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-09T07:37:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252884.json:
```json
{
    "body": "I think the problem is that on 32bit the C++ unsigned int is converted to a long. I replaced unsigned int with int for vertices, and now it should work. How can I test it on 32bit?",
    "created_at": "2015-07-09T07:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252884",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

I think the problem is that on 32bit the C++ unsigned int is converted to a long. I replaced unsigned int with int for vertices, and now it should work. How can I test it on 32bit?



---

archive/issue_comments_252885.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-07-09T07:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252885",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_252886.json:
```json
{
    "body": "To test on 32bits, you need a 32bits cpu. \nMay be one of the machines of the patchbot is 32bits and so you will get the answer soon.\nD.",
    "created_at": "2015-07-09T20:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252886",
    "user": "https://github.com/dcoudert"
}
```

To test on 32bits, you need a 32bits cpu. 
May be one of the machines of the patchbot is 32bits and so you will get the answer soon.
D.



---

archive/issue_comments_252887.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-07-10T08:18:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_252888.json:
```json
{
    "body": "Helloooooo!\n\nI have made a small modification in the Boost interface: now the Boost graph \"knows\" (through a vertex_property) the number associated to each vertex. This way, if the result is an vector, where in position i there is a property of vertex i, this vector is generated directly from Boost, without conversion.\n\nHowever, after this modification, I think this patch needs a new review, at least for this part.\n\nThank you very much!\n\nMichele\n\nPS: I still have no idea on how to test 32bit Sagemath, and I hope modifying the vertex name from unsigned int to int worked! Anyone is able to test it?",
    "created_at": "2015-07-10T08:21:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252888",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Helloooooo!

I have made a small modification in the Boost interface: now the Boost graph "knows" (through a vertex_property) the number associated to each vertex. This way, if the result is an vector, where in position i there is a property of vertex i, this vector is generated directly from Boost, without conversion.

However, after this modification, I think this patch needs a new review, at least for this part.

Thank you very much!

Michele

PS: I still have no idea on how to test 32bit Sagemath, and I hope modifying the vertex name from unsigned int to int worked! Anyone is able to test it?



---

archive/issue_comments_252889.json:
```json
{
    "body": "For me the patch is good to go.\nI tried the patch successfully using an old computer on which I can only use cplex 32bits and not cplex 64bits. So I assume it is 32bits... \nI cannot do better test.",
    "created_at": "2015-07-11T14:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252889",
    "user": "https://github.com/dcoudert"
}
```

For me the patch is good to go.
I tried the patch successfully using an old computer on which I can only use cplex 32bits and not cplex 64bits. So I assume it is 32bits... 
I cannot do better test.



---

archive/issue_comments_252890.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-07-11T14:13:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252890",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_052649.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-07-12T13:00:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18602#event-52649"
}
```



---

archive/issue_comments_252891.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-07-12T13:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18602",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18602#issuecomment-252891",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
