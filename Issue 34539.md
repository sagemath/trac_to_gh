# Issue 34539: GH Actions: Fix 'Build & Test using Conda'

Issue created by migration from https://trac.sagemath.org/ticket/34776

Original creator: mkoeppe

Original creation time: 2022-11-22 18:44:03

CC:  @tobiasdiez isuruf

https://github.com/mkoeppe/sage/actions/runs/3519527725/jobs/5899570344

```
 
  Encountered problems while solving:
    - package giac-1.5.0.37-h6866182_0 requires gsl >=2.4,<2.5.0a0, but none of the providers can be installed
```


https://github.com/mkoeppe/sage/actions/runs/3519527725/jobs/5899570635

```
  Encountered problems while solving:
    - nothing provides path.py >=7.1,<8 needed by sage-8.1-py27_1
  
  conda-forge/noarch        
  conda-forge/osx-64        
```





---

Comment by isuruf created at 2022-11-22 22:35:04

Those seem like old versions. Did something change in dependencies in `distros/conda.txt` files?


---

Comment by mkoeppe created at 2022-11-23 03:23:03

`src/environment-optional.yml` ends up with a dependency on `sage` (also causes #34777), which comes in from our `_sagemath` spkg. I'll fix this.


---

Comment by mkoeppe created at 2022-11-23 04:11:56

New commits:


---

Comment by mkoeppe created at 2022-11-23 04:11:56

Changing status from new to needs_review.


---

Comment by git created at 2022-11-23 04:12:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-11-23 06:15:54

That fixed it. Next problem: 

```
  Installing pip dependencies: 
Collecting jupymake>=0.9
    Downloading JuPyMake-0.9.tar.gz (10 kB)
    Preparing metadata (setup.py): started
    Preparing metadata (setup.py): finished with status 'error'
    Pip subprocess error:
    error: subprocess-exited-with-error
    
    × python setup.py egg_info did not run successfully.
    │ exit code: 1
    ╰─> [14 lines of output]
        Traceback (most recent call last):
          File "<string>", line 2, in <module>
          File "<pip-setuptools-caller>", line 34, in <module>
          File "/tmp/pip-install-2kcupmhw/jupymake_ac5dad76319647d4984156d3649190a7/setup.py", line 22, in <module>
            polymake_cflags = conditional_decode( subprocess.check_output( [ "polymake-config", "--cflags" ] ).strip() ).split(' ')
          File "/usr/share/miniconda/envs/sage-build/lib/python3.8/subprocess.py", line 415, in check_output
            return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,
          File "/usr/share/miniconda/envs/sage-build/lib/python3.8/subprocess.py", line 493, in run
            with Popen(*popenargs, **kwargs) as process:
          File "/usr/share/miniconda/envs/sage-build/lib/python3.8/subprocess.py", line 858, in __init__
            self._execute_child(args, executable, preexec_fn, close_fds,
          File "/usr/share/miniconda/envs/sage-build/lib/python3.8/subprocess.py", line 1704, in _execute_child
            raise child_exception_type(errno_num, err_msg, err_filename)
        FileNotFoundError: [Errno 2] No such file or directory: 'polymake-config'
        [end of output]
```

https://github.com/sagemath/sagetrac-mirror/actions/runs/3529084492/jobs/5919802842


---

Comment by mkoeppe created at 2022-11-23 06:15:54

Changing status from needs_review to needs_work.


---

Comment by isuruf created at 2022-11-23 06:23:46

We don't have a conda package for `polymake`. I guess you can't build `jupymake` without it.
