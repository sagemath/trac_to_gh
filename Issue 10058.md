# Issue 10058: PIL on OS X: ImportError: The _imaging C module is not installed

archive/issues_010058.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @jhpalmieri justin @kcrisman @TimDumol\n\nThe Python Imaging Library's `_imaging` module is not installed on some OS X systems.  This causes doctest failures in `sage/plot/plot3d/base.pyx`:\n\n```python\nsage -t  -long devel/sage/sage/plot/plot3d/base.pyx\n**********************************************************************\nFile \"/Users/Sage/sage-4.6.alpha0/devel/sage-main/sage/plot/plot3d/base.pyx\", line 1160:\n    sage: G.save(f)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/Sage/sage-4.6.alpha0/local/bin/ncadoctest.py\", line 1231, in run_one_test\n        self.run_one_example(test, example, filename, compileflags)\n      File \"/Users/Sage/sage-4.6.alpha0/local/bin/sagedoctest.py\", line 38, in run_one_example\n        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)\n      File \"/Users/Sage/sage-4.6.alpha0/local/bin/ncadoctest.py\", line 1172, in run_one_example\n        compileflags, 1) in test.globs\n      File \"<doctest __main__.example_35[4]>\", line 1, in <module>\n        G.save(f)###line 1160:\n    sage: G.save(f)\n      File \"base.pyx\", line 1198, in sage.plot.plot3d.base.Graphics3d.save (sage/plot/plot3d/base.c:11722)\n        Image.open(out_filename).save(filename)\n      File \"/Users/Sage/sage-4.6.alpha0/local/lib/python2.6/site-packages/PIL/Image.py\", line 1372, in save\n        self.load()\n      File \"/Users/Sage/sage-4.6.alpha0/local/lib/python2.6/site-packages/PIL/ImageFile.py\", line 155, in load\n        self.load_prepare()\n      File \"/Users/Sage/sage-4.6.alpha0/local/lib/python2.6/site-packages/PIL/ImageFile.py\", line 223, in load_prepare\n        self.im = Image.core.new(self.mode, self.size)\n      File \"/Users/Sage/sage-4.6.alpha0/local/lib/python2.6/site-packages/PIL/Image.py\", line 36, in __getattr__\n        raise ImportError(\"The _imaging C module is not installed\")\n    ImportError: The _imaging C module is not installed\n[...]\n```\nSee also: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/bb883d9d9956d23e/334ba8ad6d65af7e?#334ba8ad6d65af7e), [sage-release](http://groups.google.com/group/sage-release/msg/fe720bce3f933171).\n\nRelated tickets: #7344, #9864.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10059\n\n",
    "created_at": "2010-10-02T21:29:57Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "PIL on OS X: ImportError: The _imaging C module is not installed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10058",
    "user": "https://github.com/qed777"
}
```
Assignee: tbd

CC:  @jhpalmieri justin @kcrisman @TimDumol

The Python Imaging Library's `_imaging` module is not installed on some OS X systems.  This causes doctest failures in `sage/plot/plot3d/base.pyx`:

```python
sage -t  -long devel/sage/sage/plot/plot3d/base.pyx
**********************************************************************
File "/Users/Sage/sage-4.6.alpha0/devel/sage-main/sage/plot/plot3d/base.pyx", line 1160:
    sage: G.save(f)
Exception raised:
    Traceback (most recent call last):
      File "/Users/Sage/sage-4.6.alpha0/local/bin/ncadoctest.py", line 1231, in run_one_test
        self.run_one_example(test, example, filename, compileflags)
      File "/Users/Sage/sage-4.6.alpha0/local/bin/sagedoctest.py", line 38, in run_one_example
        OrigDocTestRunner.run_one_example(self, test, example, filename, compileflags)
      File "/Users/Sage/sage-4.6.alpha0/local/bin/ncadoctest.py", line 1172, in run_one_example
        compileflags, 1) in test.globs
      File "<doctest __main__.example_35[4]>", line 1, in <module>
        G.save(f)###line 1160:
    sage: G.save(f)
      File "base.pyx", line 1198, in sage.plot.plot3d.base.Graphics3d.save (sage/plot/plot3d/base.c:11722)
        Image.open(out_filename).save(filename)
      File "/Users/Sage/sage-4.6.alpha0/local/lib/python2.6/site-packages/PIL/Image.py", line 1372, in save
        self.load()
      File "/Users/Sage/sage-4.6.alpha0/local/lib/python2.6/site-packages/PIL/ImageFile.py", line 155, in load
        self.load_prepare()
      File "/Users/Sage/sage-4.6.alpha0/local/lib/python2.6/site-packages/PIL/ImageFile.py", line 223, in load_prepare
        self.im = Image.core.new(self.mode, self.size)
      File "/Users/Sage/sage-4.6.alpha0/local/lib/python2.6/site-packages/PIL/Image.py", line 36, in __getattr__
        raise ImportError("The _imaging C module is not installed")
    ImportError: The _imaging C module is not installed
[...]
```
See also: [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/bb883d9d9956d23e/334ba8ad6d65af7e?#334ba8ad6d65af7e), [sage-release](http://groups.google.com/group/sage-release/msg/fe720bce3f933171).

Related tickets: #7344, #9864.

Issue created by migration from https://trac.sagemath.org/ticket/10059





---

archive/issue_comments_101265.json:
```json
{
    "body": "Ah, now that I feel confident using `SAGE_CHECK=yes`, I see that this is going to bite in another place.\n\n```\n\nCode block begin...end\nPlot 5\nCode block begin...end\nPlot 6\nInline formula 13\nCode block begin...Traceback (most recent call last):\n  File \"example.sagetex.py\", line 192, in <module>\n<snip>\n    raise ImportError(\"The _imaging C module is not installed\")\nImportError: The _imaging C module is not installed\nend\nPlot 7\n  saving sage-plots-for-example.tex/plot-7.eps failed; saving to sage-plots-for-example.tex/plot-7.png instead.\n\n**** Error in Sage code on line 278 of example.tex! Traceback follows.\n\n**** Running Sage on example.sage failed! Fix example.tex and try again.\nError running Sage on example.sagetex.sage!\n\nreal\t0m53.056s\nuser\t0m13.153s\nsys\t0m4.808s\n************************************************************************\nError testing package sagetex-2.3.3.p2\n************************************************************************\n```\nSo now there are two places this causes failure - plot/plot3d/base.pyx and the sagetex package.  Another reason to try #7344, perhaps.",
    "created_at": "2012-03-06T03:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10058#issuecomment-101265",
    "user": "https://github.com/kcrisman"
}
```

Ah, now that I feel confident using `SAGE_CHECK=yes`, I see that this is going to bite in another place.

```

Code block begin...end
Plot 5
Code block begin...end
Plot 6
Inline formula 13
Code block begin...Traceback (most recent call last):
  File "example.sagetex.py", line 192, in <module>
<snip>
    raise ImportError("The _imaging C module is not installed")
ImportError: The _imaging C module is not installed
end
Plot 7
  saving sage-plots-for-example.tex/plot-7.eps failed; saving to sage-plots-for-example.tex/plot-7.png instead.

**** Error in Sage code on line 278 of example.tex! Traceback follows.

**** Running Sage on example.sage failed! Fix example.tex and try again.
Error running Sage on example.sagetex.sage!

real	0m53.056s
user	0m13.153s
sys	0m4.808s
************************************************************************
Error testing package sagetex-2.3.3.p2
************************************************************************
```
So now there are two places this causes failure - plot/plot3d/base.pyx and the sagetex package.  Another reason to try #7344, perhaps.



---

archive/issue_comments_101266.json:
```json
{
    "body": "Have you tried building Sage with `SAGE_BINARY_BUILD=yes`? (See the [http://sagemath.org/doc/installation/source.html#environment-variables installation guide and the pil spkg.) That fixes some problems like this for me. It would be nice to not have to do this, of course...",
    "created_at": "2012-03-06T03:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10058#issuecomment-101266",
    "user": "https://github.com/jhpalmieri"
}
```

Have you tried building Sage with `SAGE_BINARY_BUILD=yes`? (See the [http://sagemath.org/doc/installation/source.html#environment-variables installation guide and the pil spkg.) That fixes some problems like this for me. It would be nice to not have to do this, of course...



---

archive/issue_comments_101267.json:
```json
{
    "body": "No, I haven't.  On the other hand, I don't have one of those other tickets installed anyway.",
    "created_at": "2012-03-06T03:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10058#issuecomment-101267",
    "user": "https://github.com/kcrisman"
}
```

No, I haven't.  On the other hand, I don't have one of those other tickets installed anyway.



---

archive/issue_events_025560.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25560"
}
```



---

archive/issue_events_025561.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25561"
}
```



---

archive/issue_events_025562.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25562"
}
```



---

archive/issue_events_025563.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25563"
}
```



---

archive/issue_events_025564.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25564"
}
```



---

archive/issue_events_025565.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25565"
}
```



---

archive/issue_events_025566.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25566"
}
```



---

archive/issue_comments_101268.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-11T11:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10058#issuecomment-101268",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_101269.json:
```json
{
    "body": "We use now Pillow instead of PIL; Its likely that this is fixed. I haven't seen such an issue on the build bot. \n\nI suggest to close it as fixed.",
    "created_at": "2014-08-11T11:19:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10058#issuecomment-101269",
    "user": "https://github.com/vbraun"
}
```

We use now Pillow instead of PIL; Its likely that this is fixed. I haven't seen such an issue on the build bot. 

I suggest to close it as fixed.



---

archive/issue_events_025567.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-11T11:19:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25567"
}
```



---

archive/issue_events_025568.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-11T11:19:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25568"
}
```



---

archive/issue_comments_101270.json:
```json
{
    "body": "I haven't seen it for a long time either, so I suggest we close it and open a new one as well if it comes up again, since it won't be quite the same.",
    "created_at": "2014-08-14T13:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10058#issuecomment-101270",
    "user": "https://github.com/kcrisman"
}
```

I haven't seen it for a long time either, so I suggest we close it and open a new one as well if it comes up again, since it won't be quite the same.



---

archive/issue_events_025569.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-14T14:54:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10058#event-25569"
}
```



---

archive/issue_comments_101271.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2014-08-14T14:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10058",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10058#issuecomment-101271",
    "user": "https://github.com/vbraun"
}
```

Resolution: wontfix
