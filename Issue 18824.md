# Issue 18824: Auto-generated thematic index of functions

Issue created by migration from Trac.

Original creator: ncohen

Original creation time: 2015-08-20 14:02:11

CC:  dcoudert jmantysalo dlucas jsrn dimpase mmezzarobba

This branch extends the feature added by #18926, so that creating thematic index of functions is more reliable. In particular, we are now sure that *all* methods of a class appear in the index (no risk to 'forget' one), and we can pick a category for each of them.

The interface is the result of a *LOT* of try-and-fail, and corner cases, and bad surprises. It is totally open to disccussion, but know that there may be a reason (i.e. a use-case) explaining which this part is written that way. I am not very proud of everything it does either.

But it will definitely help us.

Nathann


---

Comment by ncohen created at 2015-08-20 14:02:45

Changing status from new to needs_review.


---

Comment by ncohen created at 2015-08-20 14:02:45

New commits:


---

Comment by git created at 2015-08-20 14:18:54

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jmantysalo created at 2015-08-21 05:03:44

Needs rebasing --> _needs_work_.

I won't review this because I don't know about Sphinx internals.

This patch clearly makes Sage better than it currently is, so I think this should be added. So this is just a suggestion: If we still have for example `is_chain_of_poset()` in the index, and not `is_chain_of_poset(elms)`, should it be possible to add different onliner to index than what is at the beginning of function? Like "Return True if given iterable is a chain of the poset." instead of "Return True if `elms` is a chain of the poset".


---

Comment by jmantysalo created at 2015-08-21 05:03:44

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-08-21 06:51:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-08-21 07:01:24

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2015-08-21 07:01:24

> So this is just a suggestion: If we still have for example `is_chain_of_poset()` in the index, and not `is_chain_of_poset(elms)`, should it be possible to add different onliner to index than what is at the beginning of function? Like "Return True if given iterable is a chain of the poset." instead of "Return True if `elms` is a chain of the poset".

I can imagine that such a feature could be useful eventually. One way to make it available would be  through the ``@`doc_index` constructor, which would then take both a index name and a description as an argument.

Nathann


---

Comment by jmantysalo created at 2015-08-21 07:48:34

Replying to [comment:6 ncohen]:

> > So this is just a suggestion: If we still have for example `is_chain_of_poset()` in the index, and not `is_chain_of_poset(elms)`, should it be possible to add different onliner to index than what is at the beginning of function? Like "Return True if given iterable is a chain of the poset." instead of "Return True if `elms` is a chain of the poset".
> 
> I can imagine that such a feature could be useful eventually. One way to make it available would be  through the ``@`doc_index` constructor, which would then take both a index name and a description as an argument.

Yes, that sounds good. Without this second argument it could work just like now.

I compiled this and got strange results. `graph.html` starts with "Algorithmically hard stuff", i.e. uses alphabetical list. Should be possible to change it.

Then, it starts right with "<link>chromatic_number()</link>   Returns the minimal number of colors needed to color the vertices", i.e. forgetting the ending "of the graph G.". And next one is "<link>chromatic_polynomial()</link> chromatic_polynomial(G, return_tree_basis=False)".

Do others get similar results? Can be just some Spinx error and maybe I must recompile or something.


---

Comment by ncohen created at 2015-08-21 07:53:21

Hello,

> I compiled this and got strange results. `graph.html` starts with "Algorithmically hard stuff", i.e. uses alphabetical list. Should be possible to change it.

Yeah, I thought about a way to enforce an ordering. It is the kind of things that I expect we will have some day, but I did not think it so urgent that it needed to be implemented here. A lexicographic ordering is not so bad, really.

> Then, it starts right with "<link>chromatic_number()</link>   Returns the minimal number of colors needed to color the vertices", i.e. forgetting the ending "of the graph G.". And next one is "<link>chromatic_polynomial()</link> chromatic_polynomial(G, return_tree_basis=False)".
> 
> Do others get similar results? Can be just some Spinx error and maybe I must recompile or something.

I did not notice, but I expect that you are right. I know how I wrote the code that extracts this text and it only takes 'the first line', not the first sentence. It is not related to this ticket thought, it's a code that is already in Sage.

I will probably write a fix for that today. I will add a comment here when I do.

Nathann


---

Comment by jmantysalo created at 2015-08-21 08:00:44

Replying to [comment:8 ncohen]:

> I know how I wrote the code that extracts this text and it only takes 'the first line', not the first sentence. It is not related to this ticket thought, it's a code that is already in Sage.

OK. That's what I guessed that happened. Also you should check that both `"""` and `r"""` works.

> I will probably write a fix for that today. I will add a comment here when I do.

OK. I will read it later, as I will be hearing a dissertation a hour from now on. (http://tampub.uta.fi/handle/10024/97895 - last two papers use Sage `:=)` )


---

Comment by ncohen created at 2015-08-21 08:14:50

> I will probably write a fix for that today. I will add a comment here when I do.

Done at #19067.

Nathann


---

Comment by git created at 2015-08-31 12:57:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-09 14:54:55

(the dependency of this ticket is now reviewed)


---

Comment by git created at 2015-09-30 12:29:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-30 12:29:53

Rebased against the latest beta.

If anybody has some time to review this, it would be cool.


---

Comment by dcoudert created at 2015-09-30 14:34:26

I had a look at the resulting html page and we have some problems:
- `Return the value of LovÃ¡sz theta-function of graph` 
- This is weird:
 - `chromatic_polynomial(G, return_tree_basis=False) File: sage/graphs/chrompoly.pyx (starting at line 28)`
 - `is_long_antihole_free(g, certificate=False) File: sage/graphs/weakly_chordal.pyx (starting at line 216)`
 - `is_cartesian_product(g, certificate=False, relabeling=False) File: sage/graphs/graph_decompositions/graph_products.pyx (starting at line 137)`
 - etc.


---

Comment by ncohen created at 2015-09-30 14:46:59

> - `Return the value of LovÃ¡sz theta-function of graph` 

Just an utf8 problem. Fixed.

> - This is weird:
>  - `chromatic_polynomial(G, return_tree_basis=False) File: sage/graphs/chrompoly.pyx (starting at line 28)`

What the hell `O_o`


```
sage: print Graph.chromatic_polynomial.__doc__
chromatic_polynomial(G, return_tree_basis=False)
File: sage/graphs/chrompoly.pyx (starting at line 28)

    Computes the chromatic polynomial of the graph G.

...
sage: print Graph.vertices.__doc__

        Return a list of the vertices.
...
```


Nathann


---

Comment by git created at 2015-09-30 14:47:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-30 14:59:25

Question asked at https://groups.google.com/d/topic/sage-devel/lNNEQvBlYKc/discussion


---

Comment by git created at 2015-09-30 15:18:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-30 15:19:40

Fixed (thanks to Jeroen)


---

Comment by dcoudert created at 2015-09-30 15:37:01

Much better now.
I assume that we can let the ordering problem (starting with algorithmic hard stuff is not necessarily the best choice) for another patch.


---

Comment by ncohen created at 2015-09-30 15:44:55

> I assume that we can let the ordering problem (starting with algorithmic hard stuff is not necessarily the best choice) for another patch.

Yep, I think so too. Or I can rename it to "NP-Hard problems" here if you prefer.

Nathann


---

Comment by dcoudert created at 2015-10-09 16:57:01

in the generated list for graph.py, I see:

```
strong_orientation() 	Returns a strongly connected orientation of the current graph. See also the Wikipedia article Strongly_connected_component.
```

with a link to the corresponding wikipedia page. 
For me this is acceptable but is this behavior expected?


---

Comment by ncohen created at 2015-10-09 18:14:13

Hello,

> in the generated list for graph.py, I see:
> {{{
> strong_orientation() 	Returns a strongly connected orientation of the current graph. See also the Wikipedia article Strongly_connected_component.
> }}}
> with a link to the corresponding wikipedia page. 
> For me this is acceptable but is this behavior expected?

It is only because the docstring of `strong_orientation` contains this additional line in its first paragraph. Can be solved by splitting it into two lines.

Nathann


---

Comment by git created at 2015-10-09 18:15:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2015-10-10 06:17:55

For me the patch is good to go, but the patchbot is complaining about something I don't understand. Can you check that?


---

Comment by ncohen created at 2015-10-10 06:24:37

I have no clue either `O_o`


---

Comment by jsrn created at 2015-10-10 12:30:46

It seems to be complaining that `sage.misc.collections` is, after the patch, being imported per default on Sage startup, and this wasn't the case before. The import per default is done since `sage.misc.rest_index_of_methods` is being imported per default, and it includes a line to import the `sage.misc.collections`.

Sage takes a long time to start, and to try to not aggravate that in the future, the patchbot checks whether a patch will make new modules load at startup.

I presume that `sage.misc.rest_index_of_methods` more or less has to load at startup. And I assume that the `sage.misc.collections.defaultdict` is being used to good effect. In this case, the patchbot warning can just be ignored.

Best,
Johan


---

Comment by ncohen created at 2015-10-10 12:44:32

I see. Thanks.

Nathann


---

Comment by dcoudert created at 2015-10-10 17:55:43

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2015-10-10 17:55:43

So then let's go.
David.


---

Comment by ncohen created at 2015-10-10 21:50:01

Thaaaaaaaaaaaaanks !!!!


---

Comment by vbraun created at 2015-10-12 07:16:06

Resolution: fixed
