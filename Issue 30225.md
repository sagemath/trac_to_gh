# Issue 30225: Dark theme for Three.js viewer

Issue created by migration from https://trac.sagemath.org/ticket/30462

Original creator: @jcamp0x2a

Original creation time: 2020-08-28 23:58:11

Keywords: threejs dark theme colors background jupyterlab

This ticket proposes introducing a dark theme to the Three.js viewer. The new `theme` viewer option will be used to control whether the original (and default) 'light' theme or the new 'dark' theme is used.

Aside from appeasing users -- myself included -- who generally prefer dark UIs, the main justification for this feature is that JupyterLab, unlike the Jupyter notebook, allows you to use a dark theme for its UI. When using that theme, however, the contrast between the dark UI and the bright background of Three.js plots can be quite harsh.


---

Comment by @jcamp0x2a created at 2020-08-29 00:03:51

Changing status from new to needs_review.


---

Comment by @jcamp0x2a created at 2020-08-29 00:03:51

Here are a couple examples:

[Points, lines, surfaces, and texts](https://jcamp0x2a.github.io/threejs-animation-example/dark_theme.html)

```python
surface = dodecahedron(mesh=True, color='blue').scale(0.5)
curve = parametric_plot3d([sin(x), cos(x), x/pi], (x, -pi, pi), color='red')
points = point3d([random_vector(RR, 3) for i in range(0, 100)], color='green')
text = text3d("Hello world!", (1, 1, 1), color='yellow')
show(surface + curve + points + text, theme='dark')
```


[Animation controls](https://jcamp0x2a.github.io/threejs-animation-example/dark_theme_anim.html)

```python
animate([dodecahedron().rotateZ(t*pi/32) for t in range(0, 64)]).interactive(delay=5, theme='dark')
```



---

Comment by paulmasson created at 2020-08-29 00:35:16

Cool idea! Minor quibble: you don't need parentheses around the condition during variable assignment via the ternary operator.


---

Comment by git created at 2020-08-29 00:55:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @jcamp0x2a created at 2020-08-29 00:57:05

Replying to [comment:2 paulmasson]:
> Cool idea! Minor quibble: you don't need parentheses around the condition during variable assignment via the ternary operator.

Good point. I have removed those unnecessary parentheses. Thanks for taking a look at this.


---

Comment by git created at 2020-08-29 01:00:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by paulmasson created at 2020-08-31 20:30:53

I can confirm that things work as expected, so almost ready to go.

I don't quite like the code inside `addLabel` that tests for the color black, since you haven't captured all possible ways to create that color via CSS. A foolproof method would be to create a DIV, set its color with the incoming CSS string and then check the numeric values of its computed style. That's a bit much, however, since anyone trying to use black text in a dark theme is obviously not going to see anything. We could just test for the string 'black', since it's being set internally as the default value, and see how much feedback we get on usage.

Also, why are the lines for testing viewpoint values highlighted? Can't see any changes...


---

Comment by @jcamp0x2a created at 2020-08-31 22:05:13

Replying to [comment:6 paulmasson]:
> That's a bit much, however, since anyone trying to use black text in a dark theme is obviously not going to see anything. We could just test for the string 'black', since it's being set internally as the default value, and see how much feedback we get on usage.

Although `'black'` is the default in the javascript, I was seeing `'#000000'` coming in from `text3d` when not specifying a color, so that's why that's there. The `'#000'` was a "hey why not?" addition.

I'm not particularly happy with it either in hindsight. I think that if the user explicitly sets the color to black, we should respect that. Same if they set it to white in the normal theme.

Maybe it would make more sense then to default the `text3d` and javascript colors to `None`/`null` and then choose whether to turn that into black/white based on the theme?

> Also, why are the lines for testing viewpoint values highlighted? Can't see any changes...

Sorry. It was probably vscode automatically cleaning up whitespace at the end of the line. I enabled all that auto-format stuff at one point, didn't like all the useless changes I was seeing in diffs, and thought I'd disabled it all. Guess not :)


---

Comment by paulmasson created at 2020-09-01 00:04:07

Replying to [comment:7 gh-jcamp0x2a]:
> Replying to [comment:6 paulmasson]:
> > That's a bit much, however, since anyone trying to use black text in a dark theme is obviously not going to see anything. We could just test for the string 'black', since it's being set internally as the default value, and see how much feedback we get on usage.
> 
> Although `'black'` is the default in the javascript, I was seeing `'#000000'` coming in from `text3d` when not specifying a color, so that's why that's there. The `'#000'` was a "hey why not?" addition.
> 
> I'm not particularly happy with it either in hindsight. I think that if the user explicitly sets the color to black, we should respect that. Same if they set it to white in the normal theme.
> 
> Maybe it would make more sense then to default the `text3d` and javascript colors to `None`/`null` and then choose whether to turn that into black/white based on the theme?
> 
I don't think we want to change defaults in the Python code: might affect the current user experience in other viewers. Perhaps we should just check for the defaults we know are being set, 'black' and '!#000000', and let the other formats exist as a way to override this behavior. If you agree then make that minor change and I'll set the ticket to positive.


---

Comment by git created at 2020-09-01 03:05:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @jcamp0x2a created at 2020-09-01 03:08:27

Replying to [comment:8 paulmasson]:
> I don't think we want to change defaults in the Python code: might affect the current user experience in other viewers. Perhaps we should just check for the defaults we know are being set, 'black' and '!#000000', and let the other formats exist as a way to override this behavior. If you agree then make that minor change and I'll set the ticket to positive.

Agreed...and done! Many thanks.


---

Comment by paulmasson created at 2020-09-01 22:12:26

Changing status from needs_review to positive_review.


---

Comment by paulmasson created at 2020-09-01 22:12:26

Thanks! All set now.

You really seem to be getting into the nuts and bolts of every part of Sage, even the build system. I'm curious as to what motivates such interest. My GitHub profile has an email address if you're willing to share information about your Sage-related projects.


---

Comment by @jcamp0x2a created at 2020-09-02 06:47:09

Replying to [comment:11 paulmasson]:
> Thanks! All set now.
> 
> You really seem to be getting into the nuts and bolts of every part of Sage, even the build system. I'm curious as to what motivates such interest. My GitHub profile has an email address if you're willing to share information about your Sage-related projects.

Thanks Paul. I appreciate your time in reviewing this ticket.

No particular projects underway. I've been using Sage in my own hobbyist adventures into math & physics, particularly for trying to visualize things and of course to cheat on the integrals in my books' exercise questions :) Figured it'd be nice to contribute back to the project in some way.


---

Comment by vbraun created at 2020-11-07 16:22:59

Resolution: fixed
