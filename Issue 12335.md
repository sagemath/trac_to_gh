# Issue 12335: Mark random symbolic expression doctests with #random

Issue created by migration from Trac.

Original creator: benjaminfjones

Original creation time: 2012-02-14 05:35:13

Assignee: burcin

CC:  burcin

Keywords: random, symbolic, doctest

Three doctests in `sage/symbolic/random_tests.py` change expected value whenever a new symbolic function is added to Sage. In particular,


```
sage: [f for (one,f,arity) in _mk_full_functions()]
```



```
sage: random_expr(50, nvars=3, coeff_generator=CDF.random_element)
```



```
sage: random_expr(5, verbose=True)
```


This makes adding symbolic functions to the Sage library somewhat painful, especially if more than one such patch is contributed per Sage release.

The patch provided marks the three particular random tests using `#random` so that the doctest framework ignores the output from such tests.


---

Comment by benjaminfjones created at 2012-02-14 05:36:53

mark random symbolic doctest with #random tag


---

Attachment


---

Comment by benjaminfjones created at 2012-02-14 05:37:56

Changing type from PLEASE CHANGE to task.


---

Comment by burcin created at 2012-02-14 10:40:03

Changing status from new to needs_review.


---

Comment by burcin created at 2012-02-14 10:40:49

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2012-02-16 04:25:44

Hmm.   While the second two are essentially 'random', I do have two questions.
 * How is `# random` usually used in our doctests?  It seems like it's used when the answer is random, not when the answer is very non-random but changes with new functionality.
 * The first test is actually kind of neat, because it shows what we all have.  Maybe it could be made non-random, but using a `...`  syntax?  I know that fairly recently we even then would have had to change things, but at least that would slow the rate of needing to change that test down a lot, and still preserve it as a test checking that we weren't importing something really weird by mistake.
That said, the sentiment behind this is fine.

----
Does this depend on #9130?


---

Comment by benjaminfjones created at 2012-02-16 19:31:15

Mark random symbolic doctest with #random tag; rebase to 5.0.beta4


---

Attachment

Replying to [comment:4 kcrisman]:
> Hmm.   While the second two are essentially 'random', I do have two questions.
>  * How is `# random` usually used in our doctests?  It seems like it's used when the answer is random, not when the answer is very non-random but changes with new functionality.
>  * The first test is actually kind of neat, because it shows what we all have.  Maybe it could be made non-random, but using a `...`  syntax?  I know that fairly recently we even then would have had to change things, but at least that would slow the rate of needing to change that test down a lot, and still preserve it as a test checking that we weren't importing something really weird by mistake.
> That said, the sentiment behind this is fine.

It's my understanding that a doctest with a #random tag is run and runtime errors are reported, but the output of the test is not checked against the result listed in the docstring. I agree, the output of those "random" tests is not random, the same random seed is set at the start of the tests. I can't find the use of `...` documented in the developer guide. In the guide the `hash` function is given as an example of a doctest that is marked #random because the output depends on the machine and the state of the python interpreter presumably. This doesn't mean the output of `hash` is random, just hard to determine at runtime.


> ----
> Does this depend on #9130?

It doesn't depend on #9130, but I just rebased the patch to 5.0.beta4 because #4489 was merged and that changed the random tests. The patch [attachment:trac_12507_v2.patch] applies cleanly to 5.0.beta4 now.


---

Comment by benjaminfjones created at 2012-02-16 19:48:04

I meant #4498 in my last comment.


---

Comment by jdemeyer created at 2012-02-17 23:36:00

*Be sure to update the "apply" part of the description when needed*


---

Comment by jdemeyer created at 2012-02-22 10:47:27

Resolution: fixed
