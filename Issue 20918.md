# Issue 20918: implement Muzychuk's "prolific" constructions of strongly regular graphs

Issue created by migration from https://trac.sagemath.org/ticket/21155

Original creator: dimpase

Original creation time: 2016-08-03 12:04:14

CC:  rschrecker vdelecroix

Currently one of few missing SRGs from A.E.Brouwer's database of SRGs is one with parameters (378,116,34,36), due to M.Muzychuk, construction S6 from "A generalization of Wallis-Fon-Der-Flaass construction of strongly regular graphs." J. Algebr. Comb. 25(2), 169â€“187 (2007).

Most of the work is already done by Rowan Schrecker, and just needs to be merged, see https://github.com/rschrecker/MuzychukProject


---

Comment by dimpase created at 2016-10-07 00:02:10

still needs some minor cleanup and more tests --- but works already
----
New commits:


---

Comment by dimpase created at 2016-10-07 08:26:42

I had to chase and fix a bug in `MuzychukS6Graph`, which constructed wrong graph if the input, i.e. (n,d) were Python `int` rather than Sage `ZZ` type. (Division is differently behaving if you divide two ints in Python2...)


---

Comment by git created at 2016-10-07 15:44:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-10-07 15:48:15

Changing status from new to needs_review.


---

Comment by dcoudert created at 2016-10-07 19:45:29

Hello,

clearly I don't understand your code, but I have simple remarks.


```
    for x in range(m):
        L_i[x] = [edge for edge in L.edges(labels=False) if x in edge]
```

should be 

```
    for x in range(m):
        L_i[x] = L.edges_incident(x, labels=False)
```


Then for this block

```
+    for C in ParClasses:
+        EC = matrix(QQ, v)
+        for i in range(v):
+            for j in range(v):
+                for line in C:
+                    if i in line and j in line:
+                        EC[i, j] = 1/k
```

Why not using this instead. I assume that `line` is a pair.

```
+    for C in ParClasses:
+        EC = matrix(QQ, v)
+        for line in C:
+            EC[i, j] = E[j, i] = 1/k
```


* `[i, j] = line` -> `i,j = line`


---

Comment by dimpase created at 2016-10-09 09:20:52

Replying to [comment:6 dcoudert]:
> Hello,
> 
> clearly I don't understand your code, but I have simple remarks.
> 
> {{{
>     for x in range(m):
>         L_i[x] = [edge for edge in L.edges(labels=False) if x in edge]
> }}}
> should be 
> {{{
>     for x in range(m):
>         L_i[x] = L.edges_incident(x, labels=False)
> }}}

right, thanks for pointing this out.

> 
> Then for this block
> {{{
> +    for C in ParClasses:
> +        EC = matrix(QQ, v)
> +        for i in range(v):
> +            for j in range(v):
> +                for line in C:
> +                    if i in line and j in line:
> +                        EC[i, j] = 1/k
> }}}
> Why not using this instead. I assume that `line` is a pair.

no, `line` is a hyperplane in the (d-1)-dimensional affine space over GF(n), and `C` is a class of
parallel hyperplanes.

> {{{
> +    for C in ParClasses:
> +        EC = matrix(QQ, v)
> +        for line in C:
> +            EC[i, j] = E[j, i] = 1/k
> }}}
> 
> * `[i, j] = line` -> `i,j = line`


---

Comment by dcoudert created at 2016-10-09 11:44:35

> no, `line` is a hyperplane in the (d-1)-dimensional affine space over GF(n), and `C` is a class of
> parallel hyperplanes.
OK, so you can at least do:

```
for C in ParClasses:
    EC = matrix(QQ, v)
    for i in range(v):
        for line in C:
            if not i in line:
                continue
            for j in range(i+1,v):
                if j in line:
                    EC[i, j] = EC[j, i] = 1/k
```



---

Comment by git created at 2016-10-09 18:17:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-10-14 12:36:15

test, pls ignore


---

Comment by dimpase created at 2016-10-14 12:43:51

Replying to [comment:10 dimpase]:
> test, pls ignore
test2


---

Comment by git created at 2016-10-24 21:32:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-10-24 21:33:48

more doc cleanup, testing 'random' options properly (and fixing bugs on the way).


---

Comment by git created at 2016-10-24 21:36:18

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-10-27 15:27:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-10-27 19:18:08


```
+    from __builtin__ import range
```

I suggest to use instead

```
from six.moves import range
```

(as fast as xrange)


---

Comment by dimpase created at 2016-10-27 19:44:09

Replying to [comment:16 chapoton]:
> {{{
> +    from __builtin__ import range
> }}}
> I suggest to use instead
> {{{
> from six.moves import range
> }}}
> (as fast as xrange)

this `range` does not have `.pop()`, while it is used in the code.
(and this is exactly why I added this import in the 1st place).


---

Comment by git created at 2016-11-02 12:46:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-12 21:59:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-11-12 22:03:18

this one is ready for review too...


---

Comment by chapoton created at 2016-11-18 07:33:34


```
.. [Mu07] M. Muzychuk.
```

should be

```
.. [Mu07] \M. Muzychuk.
```

for obscure sphinx reasons


---

Comment by git created at 2016-11-18 11:22:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-11-18 11:24:03

Replying to [comment:21 chapoton]:
> {{{
> .. [Mu07] M. Muzychuk.
> }}}
> should be
> {{{
> .. [Mu07] \M. Muzychuk.
> }}}
> for obscure sphinx reasons

fixed  by the latest commit.


---

Comment by dimpase created at 2016-11-18 23:38:33

this should tell bots to run tests


---

Comment by dcoudert created at 2016-11-19 09:26:12

Some possible minor improvements:

1) test `assert d > 1, 'd must be at least 2'` first.

2) replace 

```
    L_i = [0]*m
    for x in range(m):
        L_i[x] = L.edges_incident(x, labels=False)
```

with `L_i = [L.edges_incident(x, labels=False) for x in range(m)]`

3) precompute `ones_v = ones/v`} and use `EC -= ones_v` to avoid computing `ones/v` for each parallel class. It is also reused later in the code

4) use 

```
for i,j in itertools.combinations(line, 2):
    EC[i,j] = EC[j,i] = 1/k
```


5) the block `elif Phi == 'fixed':` could be
`Phi = {(x,line):val for x in range(m) for val,line in enumerate(L_i[x])} `

6) `phi = {(x, line):ParClasses[Phi[(x, line)]] for x in range(m) for line in L_i[x]} `

7) `A_i = [((v-k)/v)*ones - k*F_i[x] for x in range(m)]` or may be `A_i = [(v-k)*ones_v - k*F_i[x] for x in range(m)]`

8) add seealso sections in methods `MuzychukS6Graph` and `is_muzychuk_S6`.

Also, you should add a space after each `#` to ease the readability.


---

Comment by git created at 2016-11-19 23:27:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-11-19 23:29:33

OK, implemented, I also added few more `SEEALSO` for other strongly regular graphs, but I'd rather do this completely systematically on another ticket.


---

Comment by dcoudert created at 2016-11-20 13:50:17

Method `MuzychukS6Graph` is working correctly. You still have to improve its description. Something is missing with the last sentence `Let L be the complete graph...`.

I don't understand the proposed behavior of method `is_muzychuk_S6`. 

```
sage: is_muzychuk_S6(378, 116, 34, 36)
(<function MuzychukS6Graph at 0x19dce9cf8>, 3, 3)
sage: is_muzychuk_S6(378, 116, 34, 37)
```

With such a name, the method should return `True` or `False`, but it returns either the generator + parameters or nothing.
This is apparently the standard in `strongly_regular_db.pyx` but I don't understand this choice. Why not using an extra boolean parameter `certificate` to return either a boolean or a boolean plus the generator+parameters.


---

Comment by dimpase created at 2016-11-20 16:33:38

Replying to [comment:28 dcoudert]:
> Method `MuzychukS6Graph` is working correctly. You still have to improve its description. Something is missing with the last sentence `Let L be the complete graph...`.

I'll have a look, sure.

> 
> I don't understand the proposed behavior of method `is_muzychuk_S6`. 
> {{{
> sage: is_muzychuk_S6(378, 116, 34, 36)
> (<function MuzychukS6Graph at 0x19dce9cf8>, 3, 3)
> sage: is_muzychuk_S6(378, 116, 34, 37)
> }}}
> With such a name, the method should return `True` or `False`, but it returns either the generator + parameters or nothing.
> This is apparently the standard in `strongly_regular_db.pyx` but I don't understand this choice.

these `is_...()` are internal functions, optimised for speed. If `is_...()` returns nothing it indicates failure.

> Why not using an extra boolean parameter `certificate` to return either a boolean or a boolean plus the generator+parameters.

They were not meant for outside use. Also note that returning a generator is almost as cheap as returning a boolean, so there is really little incentive in having an extra parameter.


---

Comment by dcoudert created at 2016-11-20 17:28:56

> these `is_...()` are internal functions, optimised for speed. If `is_...()` returns nothing it indicates failure.

if it's for internal use only, then it's ok.

> They were not meant for outside use. Also note that returning a generator is almost as cheap as returning a boolean, so there is really little incentive in having an extra parameter.

I agree. I didn't know that the methods are for internal use only. So no need for extra parameter.


---

Comment by git created at 2016-11-21 10:11:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-11-21 10:13:45

Docs corrected. I meant to do this all along, but forgot, sorry about this.


---

Comment by dcoudert created at 2016-11-21 11:44:58

* two of then -> two of them
* Use 80 columns format for documentation
* Since #21454, references should be put in master biblio file

After that it should be ok.


---

Comment by git created at 2016-11-21 11:58:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2016-11-21 12:02:51

Replying to [comment:33 dcoudert]:
> * two of then -> two of them
done 
> * Use 80 columns format for documentation
done
> * Since #21454, references should be put in master biblio file
none of the files in `src/sage/graphs/` is touched by #21454.
This is obviously a task for another ticket, to move these references into the master.


---

Comment by dcoudert created at 2016-11-21 15:26:45

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2016-11-21 15:26:45

For me this patch is now good to go (compile, run, doctests, doc display nicely, etc.).


---

Comment by dimpase created at 2016-11-21 15:42:47

Thanks. The next in line is #21890, if you have time...


---

Comment by vbraun created at 2016-11-22 22:06:13

Resolution: fixed
