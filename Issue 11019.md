# Issue 11019: edge labels should be unique

archive/issues_011019.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  ncohen\n\n\n```\nsage: G = Graph()\nsage: G.add_edge(0,1,[7])\nsage: G.add_edge(0,2,[7])\nsage: G.edge_label(0,1)[0] += 1\nsage: G.edges()\n[(0, 1, [8]), (0, 2, [8])]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/11181\n\n",
    "created_at": "2011-04-12T06:59:14Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "edge labels should be unique",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11019",
    "user": "rlm"
}
```
Assignee: jason, ncohen, rlm

CC:  ncohen


```
sage: G = Graph()
sage: G.add_edge(0,1,[7])
sage: G.add_edge(0,2,[7])
sage: G.edge_label(0,1)[0] += 1
sage: G.edges()
[(0, 1, [8]), (0, 2, [8])]
```


Issue created by migration from https://trac.sagemath.org/ticket/11181





---

archive/issue_comments_119815.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-04-12T07:00:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119815",
    "user": "rlm"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_119816.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2011-04-12T17:28:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119816",
    "user": "rlm"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_119817.json:
```json
{
    "body": "Attachment",
    "created_at": "2011-04-12T23:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119817",
    "user": "rlm"
}
```

Attachment



---

archive/issue_comments_119818.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-04-12T23:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119818",
    "user": "rlm"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_119819.json:
```json
{
    "body": "I will look at the patch as soon as the buildbot shows its results.\n\nChristian",
    "created_at": "2011-04-14T12:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119819",
    "user": "stumpc5"
}
```

I will look at the patch as soon as the buildbot shows its results.

Christian



---

archive/issue_comments_119820.json:
```json
{
    "body": "Hello Christian !\n\nAs there is still no sign from the patchbot (and yeah, I like to read what's happening in the graph backends) I began to review this patch....\n\nI've got two questions though :\n\n- The first one is about line 1597... It begins with an \"else\" after a \"for\" loop, and I really don't understand how it compiles or what it means `O_o`\n- I edited several areas of the code to \"cache\" the label of a vertex which was called several times... I can not do that for the (tricky) iterators appearing just afterwards \n\n```\n\t    return iter([tuple(sorted(\n            (vertex_label(v_int, self.vertex_ints, self.vertex_labels, self._cg),\n\t     vertex_label(u_int, self.vertex_ints, self.vertex_labels, self._cg)\n            )))\n               \tfor v_int in vertices\n\t            for u_int in self._cg.out_neighbors(v_int)\n\t                if u_int >= v_int or u_int not in vertices\n                            for l_int in self._cg.all_arcs(v_int, u_int)])\n```\n\n       do you think it's woth doing ? In which case I would copy the code from the lines above thise one, and remove the label-related tests.... `:-)`\n\n- There is a ``self.edge_labels.pop(ll_int)`` in ``set_edge_label`` but not in `del_arc_unsafe`... Is there any reason ? `:-)`\n\nHave fuuuuuuuuuun !\n\nNathann",
    "created_at": "2011-04-15T16:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119820",
    "user": "ncohen"
}
```

Hello Christian !

As there is still no sign from the patchbot (and yeah, I like to read what's happening in the graph backends) I began to review this patch....

I've got two questions though :

- The first one is about line 1597... It begins with an "else" after a "for" loop, and I really don't understand how it compiles or what it means `O_o`
- I edited several areas of the code to "cache" the label of a vertex which was called several times... I can not do that for the (tricky) iterators appearing just afterwards 

```
	    return iter([tuple(sorted(
            (vertex_label(v_int, self.vertex_ints, self.vertex_labels, self._cg),
	     vertex_label(u_int, self.vertex_ints, self.vertex_labels, self._cg)
            )))
               	for v_int in vertices
	            for u_int in self._cg.out_neighbors(v_int)
	                if u_int >= v_int or u_int not in vertices
                            for l_int in self._cg.all_arcs(v_int, u_int)])
```

       do you think it's woth doing ? In which case I would copy the code from the lines above thise one, and remove the label-related tests.... `:-)`

- There is a ``self.edge_labels.pop(ll_int)`` in ``set_edge_label`` but not in `del_arc_unsafe`... Is there any reason ? `:-)`

Have fuuuuuuuuuun !

Nathann



---

archive/issue_comments_119821.json:
```json
{
    "body": "Replying to [comment:7 ncohen]:\n> - The first one is about line 1597... It begins with an \"else\" after a \"for\" loop, and I really don't understand how it compiles or what it means `O_o`\n\nhttp://docs.python.org/release/1.5/tut/node23.html\n\n> - I edited several areas of the code to \"cache\" the label of a vertex which was called several times... I can not do that for the (tricky) iterators appearing just afterwards \n\nSince those iterators construct a list anyway, there is no real reason for them to be written that way, but I didn't want to touch more code than necessary.\n\n>        do you think it's woth doing ? In which case I would copy the code from the lines above thise one, and remove the label-related tests.... `:-)`\n\nVery very careful! You'd do better to rearrange the current code. Each chunk of code is slightly different, of course..... This is maybe not worth it, I'm not really sure.\n\n>     - There is a ``self.edge_labels.pop(ll_int)`` in ``set_edge_label`` but not in `del_arc_unsafe`... Is there any reason ? `:-)`\n\nIt should be in `del_edge` if anywhere. Probably I just forgot to delete the edge label from the translation dictionary.\n\nYour referee patch looks good to me, although you may post another one after reading these comments....\n\nThanks!",
    "created_at": "2011-04-15T18:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119821",
    "user": "rlm"
}
```

Replying to [comment:7 ncohen]:
> - The first one is about line 1597... It begins with an "else" after a "for" loop, and I really don't understand how it compiles or what it means `O_o`

http://docs.python.org/release/1.5/tut/node23.html

> - I edited several areas of the code to "cache" the label of a vertex which was called several times... I can not do that for the (tricky) iterators appearing just afterwards 

Since those iterators construct a list anyway, there is no real reason for them to be written that way, but I didn't want to touch more code than necessary.

>        do you think it's woth doing ? In which case I would copy the code from the lines above thise one, and remove the label-related tests.... `:-)`

Very very careful! You'd do better to rearrange the current code. Each chunk of code is slightly different, of course..... This is maybe not worth it, I'm not really sure.

>     - There is a ``self.edge_labels.pop(ll_int)`` in ``set_edge_label`` but not in `del_arc_unsafe`... Is there any reason ? `:-)`

It should be in `del_edge` if anywhere. Probably I just forgot to delete the edge label from the translation dictionary.

Your referee patch looks good to me, although you may post another one after reading these comments....

Thanks!



---

archive/issue_comments_119822.json:
```json
{
    "body": "Hello again !\n\n> http://docs.python.org/release/1.5/tut/node23.html\n\nOkokokok ! Got it ! Tricky python `:-)`\n\nI rephrase this paragraph so that it now tests whether the label is None before... As -- if I make no mistake -- the id 0 never appears in the dictionary, being always identified with None, and so it's useless to read the whole list of labels.\n\n> Since those iterators construct a list anyway, there is no real reason for them to be written that way, but I didn't want to touch more code than necessary.\n\nWell, in the end I edited them. I tried to pay attention, and the doctests still pass, which is also a good sign ! If you can summon the energy to re-check it... `:-)`\n\n> It should be in `del_edge` if anywhere. Probably I just forgot to delete the edge label from the translation dictionary.\n\nI added them !\n\n> Your referee patch looks good to me, although you may post another one after reading these comments....\n\nAnd here it is... I also tried the following on the Sage without uour patches applied :\n\n\n```\nsage: def test():\n....:     for u,v in g.edges(labels = False):\n....:         g.delete_edge(u,v)\n....:         g.add_edge(u,v)\nsage: g = graphs.CompleteGraph(200)\nsage: %timeit test()\n5 loops, best of 3: 538 ms per loop\n```\n\n\nWith the patches applied \n\n\n```\n5 loops, best of 3: 495 ms per loop\n```\n\n\nWell.. Not much, but better this way `:-)`\n\nNathann",
    "created_at": "2011-04-16T09:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119822",
    "user": "ncohen"
}
```

Hello again !

> http://docs.python.org/release/1.5/tut/node23.html

Okokokok ! Got it ! Tricky python `:-)`

I rephrase this paragraph so that it now tests whether the label is None before... As -- if I make no mistake -- the id 0 never appears in the dictionary, being always identified with None, and so it's useless to read the whole list of labels.

> Since those iterators construct a list anyway, there is no real reason for them to be written that way, but I didn't want to touch more code than necessary.

Well, in the end I edited them. I tried to pay attention, and the doctests still pass, which is also a good sign ! If you can summon the energy to re-check it... `:-)`

> It should be in `del_edge` if anywhere. Probably I just forgot to delete the edge label from the translation dictionary.

I added them !

> Your referee patch looks good to me, although you may post another one after reading these comments....

And here it is... I also tried the following on the Sage without uour patches applied :


```
sage: def test():
....:     for u,v in g.edges(labels = False):
....:         g.delete_edge(u,v)
....:         g.add_edge(u,v)
sage: g = graphs.CompleteGraph(200)
sage: %timeit test()
5 loops, best of 3: 538 ms per loop
```


With the patches applied 


```
5 loops, best of 3: 495 ms per loop
```


Well.. Not much, but better this way `:-)`

Nathann



---

archive/issue_comments_119823.json:
```json
{
    "body": "Attachment\n\nSalut,\n\nto me, the patch and the review patch look fine! Thanks for the work.\n\nOne minor thing:\n\nThe code for iterator_edges, iterator_in_edges, and iterator_out_edges looks like most of it is redundant. Also, I don't understand why the multiple edges are not important in iterator_edges but is checked in both others.\n\nBest, Christian",
    "created_at": "2011-04-16T12:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119823",
    "user": "stumpc5"
}
```

Attachment

Salut,

to me, the patch and the review patch look fine! Thanks for the work.

One minor thing:

The code for iterator_edges, iterator_in_edges, and iterator_out_edges looks like most of it is redundant. Also, I don't understand why the multiple edges are not important in iterator_edges but is checked in both others.

Best, Christian



---

archive/issue_comments_119824.json:
```json
{
    "body": "Replying to [comment:10 stumpc5]:\n\nI was just checking how to simplify the code in the iterators: what is the advantage of returning an iterator after having constructed the complete list already? (Unfortunately, yield is not - yet - available in cython...).",
    "created_at": "2011-04-16T15:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119824",
    "user": "stumpc5"
}
```

Replying to [comment:10 stumpc5]:

I was just checking how to simplify the code in the iterators: what is the advantage of returning an iterator after having constructed the complete list already? (Unfortunately, yield is not - yet - available in cython...).



---

archive/issue_comments_119825.json:
```json
{
    "body": "Nathann,\n\nThanks for your work on this. I'll have a look tomorrow.\n\nChristian,\n\nReplying to [comment:11 stumpc5]:\n> I was just checking how to simplify the code in the iterators: what is the advantage of returning an iterator after having constructed the complete list already? (Unfortunately, yield is not - yet - available in cython...).\n\nThe particular block of code in question was written by Jason Grout, I think. It might be to be consistent with the NetworkX backends. Also, I think he was trying to write code to eventually be replaced by something which did yield, once Cython supported it. It certainly doesn't do any harm as it is.",
    "created_at": "2011-04-16T15:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119825",
    "user": "rlm"
}
```

Nathann,

Thanks for your work on this. I'll have a look tomorrow.

Christian,

Replying to [comment:11 stumpc5]:
> I was just checking how to simplify the code in the iterators: what is the advantage of returning an iterator after having constructed the complete list already? (Unfortunately, yield is not - yet - available in cython...).

The particular block of code in question was written by Jason Grout, I think. It might be to be consistent with the NetworkX backends. Also, I think he was trying to write code to eventually be replaced by something which did yield, once Cython supported it. It certainly doesn't do any harm as it is.



---

archive/issue_comments_119826.json:
```json
{
    "body": "Replying to [comment:12 rlm]:\n\n> The particular block of code in question was written by Jason Grout, I think. It might be to be consistent with the NetworkX backends. Also, I think he was trying to write code to eventually be replaced by something which did yield, once Cython supported it. It certainly doesn't do any harm as it is.\n\nI was just looking at it as Nathann did some changes in there. But I am totally fine with just leaving it as it is...",
    "created_at": "2011-04-16T15:54:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119826",
    "user": "stumpc5"
}
```

Replying to [comment:12 rlm]:

> The particular block of code in question was written by Jason Grout, I think. It might be to be consistent with the NetworkX backends. Also, I think he was trying to write code to eventually be replaced by something which did yield, once Cython supported it. It certainly doesn't do any harm as it is.

I was just looking at it as Nathann did some changes in there. But I am totally fine with just leaving it as it is...



---

archive/issue_comments_119827.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-04-20T20:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119827",
    "user": "rlm"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_119828.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2011-05-03T12:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11019",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11019#issuecomment-119828",
    "user": "jdemeyer"
}
```

Resolution: fixed
