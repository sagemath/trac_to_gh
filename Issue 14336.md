# Issue 14336: MILP constraints are silently misunderstood

Issue created by migration from https://trac.sagemath.org/ticket/14540

Original creator: ncohen

Original creation time: 2013-05-06 14:53:28

Assignee: ncohen

CC:  vbraun dimpase mkoeppe vdelecroix tscrim


```
sage: p = MixedIntegerLinearProgram()
sage: b = p.new_variable()
sage: p.add_constraint(int(1) <= b[0] + b[1] + b[2] <= int(2))
sage: p.show()
Maximization:
 
Constraints:
  x_0 + x_1 + x_2 <= 2.0
Variables:
  x_0 is a continuous variable (min=0.0, max=+oo)
  x_1 is a continuous variable (min=0.0, max=+oo)
  x_2 is a continuous variable (min=0.0, max=+oo)
```


The code above works on the command-line. In a script, you can do without the `int()`.

Nathann


---

Comment by dimpase created at 2013-05-06 17:40:08

`In a script` - do you mean a Python script, not Sage script, right?


---

Comment by ncohen created at 2013-05-06 20:17:30

Well, in any script that does not wrap integers with `Integer()`. So a .py that you load with `%runfile` is ok !

Nathann


---

Comment by dimpase created at 2013-05-07 00:40:20

Replying to [comment:2 ncohen]:
> Well, in any script that does not wrap integers with `Integer()`. So a .py that you load with `%runfile` is ok !
> 
> Nathann

and it's not only `int`, but `float`, too, that gives this problem.


---

Comment by jdemeyer created at 2016-04-19 08:45:06

I'm investigating this.


---

Comment by jdemeyer created at 2016-04-19 09:37:24

New commits:


---

Comment by jdemeyer created at 2016-04-19 09:37:24

Changing status from new to needs_review.


---

Comment by dimpase created at 2016-04-19 09:37:46

New commits:


---

Comment by mkoeppe created at 2016-04-20 21:12:32

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2016-04-20 21:12:32

It's not completely fixed. Example:

```
sage: p = MixedIntegerLinearProgram()
sage: b = p.new_variable()
sage: float(0) <= b[0] <= int(1) <= b[1] <= float(2)
1 <= x_1 <= 2
```



---

Comment by jdemeyer created at 2016-04-21 08:51:53

Allright, let's fix everything on this ticket...


---

Comment by git created at 2016-04-21 09:24:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-04-21 15:23:22

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2016-04-21 15:25:13

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-04-21 15:45:12

In the end, I had to rewrite most of the comparison code but still using the ideas of the original code.


---

Comment by mkoeppe created at 2016-04-21 18:30:30

It seems to work, except for bizarre behavior if one does try to chain in comparisons between constants.


```
sage: p = MixedIntegerLinearProgram()
sage: b = p.new_variable()
sage: b[0] <= 2 <= 2
True
sage: 0<=b[0]<=b[0]<=b[0]<=1
0 <= x_0 <= 2 <= x_0 <= x_0 <= 1
```


(The documentation should probably explain what is expected to work and what is not!)

I note that the unrelated comparison-hack code for SR silently throws away chained inequalities.

```
sage: var('x')
x
sage: x <= 2 <= 3
x <= 2
sage: x <= 2 <= x
x <= 2
```


Also, should `add_constraint` allow the user to add tautological constraints like this:

```
sage: p = MixedIntegerLinearProgram()
sage: p.add_constraint(0<=0)
ValueError: argument must be a linear function or constraint, got True
```


Someone should probably review your changes to `Parent` before this ticket is set to positive_review.


---

Comment by jdemeyer created at 2016-04-21 20:35:40

Replying to [comment:25 mkoeppe]:
> It seems to work, except for bizarre behavior if one does try to chain in comparisons between constants.
> 
> {{{
> sage: p = MixedIntegerLinearProgram()
> sage: b = p.new_variable()
> sage: b[0] <= 2 <= 2
> True
> sage: 0<=b[0]<=b[0]<=b[0]<=1
> 0 <= x_0 <= 2 <= x_0 <= x_0 <= 1
> }}}

There are theoretical limits to what can work without fundamentally changing Python (or the preparser if you want to go that way), that's why it is called a "hack".

I could add a bit of documentation, although a full explanation would probably be too technical.


---

Comment by mkoeppe created at 2016-04-22 00:20:24

Replying to [comment:26 jdemeyer]:

> I could add a bit of documentation, although a full explanation would probably be too technical.

It would suffice to explain that you can chain linear expressions with the same comparison, and also use constants at the very left hand side and the very right hand side. If the user tries anything beyond that, there's either an error or weirdness.


---

Comment by jdemeyer created at 2016-04-22 05:50:54

Replying to [comment:27 mkoeppe]:
> Replying to [comment:26 jdemeyer]:
> 
> > I could add a bit of documentation, although a full explanation would probably be too technical.
> 
> It would suffice to explain that you can chain linear expressions with the same comparison, and also use constants at the very left hand side and the very right hand side. If the user tries anything beyond that, there's either an error or weirdness.

Constants in the middle also work, just not two constants next to eachother. For example, `b[0] <= 0 <= b[1]` works as expected.


---

Comment by mkoeppe created at 2016-04-22 06:01:48

I know, it was just a suggestion how you could simplify the story when you write that documentation.


---

Comment by git created at 2016-04-22 08:55:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-04-22 09:19:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2016-04-22 23:19:29

Looks good to me, but the changes to `Parent` still need independent review.


---

Comment by tscrim created at 2016-04-24 21:48:09

The changes in `Parent` look good to me. If everything else is good, then this would be a positive review.


---

Comment by mkoeppe created at 2016-04-24 21:48:52

Thanks, Travis!


---

Comment by mkoeppe created at 2016-04-24 21:49:09

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2016-04-24 21:49:59

The patchbot complains about decreased coverage, though


---

Comment by mkoeppe created at 2016-04-24 21:49:59

Changing status from positive_review to needs_work.


---

Comment by git created at 2016-04-25 08:36:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2016-04-25 08:37:26

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2016-04-26 04:08:45

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-04-26 08:53:02

Thanks!


---

Comment by vbraun created at 2016-04-26 21:55:15

Resolution: fixed
