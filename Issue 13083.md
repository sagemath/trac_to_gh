# Issue 13083: Replace some deprecated python functions in sage/misc

Issue created by migration from https://trac.sagemath.org/ticket/13255

Original creator: aapitzsch

Original creation time: 2012-07-14 16:14:09

Assignee: jason

Keywords: python3

Moving forward to Python 3.

Execute

```
2to3 -f has_key -f except -f idioms -f ne -f raise
```

for each *.py (and *.pyx) in sage/misc.


---

Comment by aapitzsch created at 2012-07-14 16:18:39

Changing status from new to needs_review.


---

Comment by aapitzsch created at 2012-11-04 20:37:03

Apply trac_13255_rebased.patch


---

Comment by aapitzsch created at 2013-01-03 17:12:27

Apply trac_13255_rebased.patch


---

Comment by kcrisman created at 2013-01-03 19:44:35

Two questions that sound overly critical, but are really just out of curiosity:
 * Curious why you ported these forward right now; the current release manager has been skeptical of changes hitting many files that are mainly cosmetic (like whitespace), since it means a lot of rebasing for others (or can, anyway) - not that these won't be very needed eventually, but we aren't switching to Python 3 anytime soon.
 * Why not also move to the new string formatting syntax for these (ones only)?  The "percent" style wouldn't work in Python 3 either, so the job is sort of half done.


---

Comment by aapitzsch created at 2013-01-13 16:24:23

Replying to [comment:5 kcrisman]:
>  * Curious why you ported these forward right now; the current release manager has been skeptical of changes hitting many files that are mainly cosmetic (like whitespace), since it means a lot of rebasing for others (or can, anyway) - not that these won't be very needed eventually, but we aren't switching to Python 3 anytime soon.
Although we aren't switching to Python 3 in the near future, this work has to be done anyway. It might also speed up the process.

>  * Why not also move to the new string formatting syntax for these (ones only)?  The "percent" style wouldn't work in Python 3 either, so the job is sort of half done.
The "percent" style still works in Python 3 and I couldn't find a notice about its deprecation.

Thanks for reviewing my patches.


---

Comment by kcrisman created at 2013-01-15 02:32:44

> >  * Curious why you ported these forward right now; the current release manager has been skeptical of changes hitting many files that are mainly cosmetic (like whitespace), since it means a lot of rebasing for others (or can, anyway) - not that these won't be very needed eventually, but we aren't switching to Python 3 anytime soon.
> Although we aren't switching to Python 3 in the near future, this work has to be done anyway. It might also speed up the process.


See the current discussion at #13899 for why it might not be wise to do a large, commonly used directory all at once.

> 
> >  * Why not also move to the new string formatting syntax for these (ones only)?  The "percent" style wouldn't work in Python 3 either, so the job is sort of half done.
> The "percent" style still works in Python 3 and I couldn't find a notice about its deprecation.

[Interesting but true](http://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting)!  My [usual source of info](http://docs.python.org/release/3.0.1/whatsnew/3.0.html#pep-3101-a-new-approach-to-string-formatting) apparently never was incorporated.  My guess is that so many people found it irksome to switch legacy code that they never bothered deprecating it ... yet.


---

Attachment


---

Comment by aapitzsch created at 2013-03-11 23:27:52

It seems that patchbot tries to apply every patch attached to one ticket if the uploaded patch overwrites another with the same name although a previous comment said to apply only selected ones.

Apply trac_13255_rebased.patch.


---

Comment by ncohen created at 2013-07-05 22:32:49

Does not apply on 5.11.beta3 !

Nathann


---

Comment by ncohen created at 2013-07-05 22:32:49

Changing status from needs_review to needs_work.


---

Attachment

Apply trac_13255_rebased.2.patch


---

Comment by aapitzsch created at 2013-07-07 22:12:27

Changing status from needs_work to needs_review.


---

Comment by aapitzsch created at 2014-01-21 21:25:30

New commits:


---

Comment by ncohen created at 2014-01-22 09:08:56

I personally oppose the changes to the "print" function `:-P`

Nathann


---

Comment by git created at 2014-02-15 16:35:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-02-16 20:33:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-03-03 21:36:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wluebbe created at 2014-03-19 15:37:49

I had a look at the patch "trac 13255: replace some deprecated python functions in sage/misc".

There are about 51 affected modules. 4 of them have a new line `from __future__ import print_function`. 

But there are also modules with the new function `print()` but no `from __future__`. An example is `/src/sage/misc/attached_files.py`.

How can this work?


---

Comment by chapoton created at 2014-03-28 20:11:13

does not apply


---

Comment by chapoton created at 2014-03-28 20:11:13

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-03-30 22:20:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-03 22:25:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aapitzsch created at 2014-04-03 22:47:45

Changing status from needs_work to needs_review.


---

Comment by aapitzsch created at 2014-04-03 22:47:45

Replying to [comment:18 wluebbe]:
> I had a look at the patch "trac 13255: replace some deprecated python functions in sage/misc".
> 
> There are about 51 affected modules. 4 of them have a new line `from __future__ import print_function`. 
> 
> But there are also modules with the new function `print()` but no `from __future__`. An example is `/src/sage/misc/attached_files.py`.
> 
> How can this work?
> 

In these cases it's still the print statement and not the function that is used. The parentheses are ignored like in

```
sage: a = (5)
sage: a
5
```

so in most cases you can write
`print("some string")` instead of `print "some string"` without using `from __future__`


---

Comment by wluebbe created at 2014-04-04 06:09:41

Yes, meanwhile I have also discovered it while working on ticket:15989.

But apparently the tool 2to3 fix_print (or futurize fix_print_with_import) does not detect this case and wraps another pair of parenthesis around it.

Maybe we should not add `from __future__ import print_function` but just make sure that the print statement has those extra parenthesis?

I will mention this in ticket:15989.


---

Comment by git created at 2014-04-08 21:50:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aapitzsch created at 2014-04-08 22:04:33

Replying to [comment:23 wluebbe]:
> Maybe we should not add `from __future__ import print_function` but just make sure that the print statement has those extra parenthesis?
> 

In my opinion we should use `from __future__ import print_function` if necessary. It's a simple way to get python 2 and python 3 compatible `print`.

BTW could you review this patch? Thanks.


---

Comment by wluebbe created at 2014-04-09 12:01:28

Changing status from needs_review to positive_review.


---

Comment by wluebbe created at 2014-04-09 12:01:28

Looks good to and all doctests pass.

`from __future__ import print_function` is apparently only added when trailing "," are converted to `end=" "`.

Currently I would suggest NOT to wrap the print parameters with parenthesis in //doctests// as this might be handled be a new version of the preparser (see also ticket:15989).

BTW: I hope the changes to the `raise` statements will not interfere to much with ticket:15990.


---

Comment by vbraun created at 2014-04-10 21:26:00

reviewer name


---

Comment by vbraun created at 2014-04-11 08:26:22

Conflicts, mostly with #15990


---

Comment by wluebbe created at 2014-04-11 09:41:49

Not really unexpected. We'll should try with next beta.


---

Comment by git created at 2014-04-15 21:06:10

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2014-04-15 21:06:10

Changing status from positive_review to needs_review.


---

Comment by wluebbe created at 2014-04-16 14:30:18

I tested the change OK.

While I went through the patch I did some polishing and added it to a reviewer patch.


If you agree with my branch, you can set this to positive review. Otherwise set your latest patch to positive review.

The majority of changes simplify `"{0}{1}{2}"` to `"{}{}{}"`. Since Python 2.7 (and Python 3.1) the positional argument specifiers can be omitted [Format strings](https://docs.python.org/2.7/library/string.html#formatstrings).
----
New commits:


---

Comment by aapitzsch created at 2014-04-16 23:13:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-04-20 16:43:55

Resolution: fixed
