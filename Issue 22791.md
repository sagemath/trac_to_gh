# Issue 22791: Cannot construct module generator for A2 dual KR crystals

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2017-05-19 05:10:45

CC:  sage-combinat aschilling bsalisbury1

Keywords: crystals

We have

```
sage: K = crystals.KirillovReshetikhin(CartanType(['A',4,2]).dual(), 2, 2)
sage: K.module_generator()
---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-39-f16b6ab836d8> in <module>()
----> 1 KT.module_generator()

/home/travis/sage-build/local/lib/python2.7/site-packages/sage/combinat/crystals/kirillov_reshetikhin.pyc in module_generator(self)
    533         s = self.s()
    534         weight = s*Lambda[r] - s*Lambda[0] * Lambda[r].level() / Lambda[0].level()
--> 535         return [b for b in self.module_generators if b.weight() == weight][0]
    536 
    537     def r(self):

IndexError: list index out of range
```

This comes from the fact that the weight doesn't match:

```
sage: K.module_generators
[[], [This is the Trac macro *1, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1, 1-macro), [[1, 1], [2, 2]]]
sage: K.module_generators[-1].weight()
-2*Lambda[0] + 4*Lambda[2]
```

versus

```
sage: R = K.weight_lattice_realization()
sage: Lambda = R.fundamental_weights()
sage: r = K.r()
sage: s = K.s()
sage: s*Lambda[r] - s*Lambda[0] * Lambda[r].level() / Lambda[0].level()
-Lambda[0] + 2*Lambda[2]
sage: Lambda[2].level()
1
sage: Lambda[0].level()
2
```

When `s = 1`, then it fails with a non-divisible error.


---

Comment by tscrim created at 2017-05-19 05:11:29

I'm guessing this comes from resolving things with the B/C issues with the root system?


---

Comment by tscrim created at 2017-05-19 05:12:37

I'm not sure what the best way to fix things are. It feels too much of a hack to just special case the `r = n` for A<sub>2n</sub><sup>(2)\dagger</sup>, but that would work. Thoughts?


---

Comment by tscrim created at 2017-07-26 20:52:05

After some thought, the only reasonable way to really fix this is by special casing it.


---

Comment by tscrim created at 2017-07-26 20:52:05

Changing status from new to needs_review.


---

Comment by git created at 2017-07-26 20:59:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsalisbury1 created at 2017-07-28 16:19:36

Changing status from needs_review to positive_review.


---

Comment by bsalisbury1 created at 2017-07-28 16:19:36

Looks good to me.


---

Comment by vbraun created at 2017-07-29 15:30:54

Resolution: fixed
