# Issue 12677: The argspecs of extension function/methods is broken in the Sphinx documentation

Issue created by migration from Trac.

Original creator: hivert

Original creation time: 2012-04-17 10:36:02

Assignee: mvngu

Keywords: argspecs Cython

In the current Sphinx HTML doc, the extenstion function and methods have no arguments setup.

See for example the documentation of

```
reference/sage/symbolic/expression.html#sage.symbolic.expression.Expression.N
}}} 
which was [ok (see there)](http://www.sagemath.org/doc/reference/sage/symbolic/expression.html#sage.symbolic.expression.Expression.N) in Sage 4.8. The problem seems to have been introduced between release 5.0beta2 and 5.0beta7.

By the way, we should find a way to do regression test on that kinds of problems.


---

Comment by hivert created at 2012-04-17 10:36:42

Changing assignee from mvngu to mvngu, hivert.


---

Comment by jdemeyer created at 2012-04-18 09:10:58

Doctest for the issue


---

Attachment

I created a doctest for this issue, which obviously fails on recent Sage betas.


---

Comment by hivert created at 2012-04-18 09:37:06

Replying to [comment:2 jdemeyer]:
> I created a doctest for this issue, which obviously fails on recent Sage betas.

Thanks ! I tried to figureout a way to call directly Sphinx but this is much easier. I'll try to work on this this afternoon. Do you have somewhere the various beta compiled so that I can rsync them on boxen to help bissecting ? So far the few guesses I made to find the culprit were wrong.


---

Comment by jdemeyer created at 2012-04-18 11:26:44

sage-5.0.beta5 is still okay.


---

Comment by jdemeyer created at 2012-04-18 11:34:32

Replying to [comment:3 hivert]:
> Replying to [comment:2 jdemeyer]:
> > I created a doctest for this issue, which obviously fails on recent Sage betas.
> 
> Thanks ! I tried to figureout a way to call directly Sphinx but this is much easier. I'll try to work on this this afternoon. Do you have somewhere the various beta compiled so that I can rsync them on boxen to help bissecting ? So far the few guesses I made to find the culprit were wrong.
>  

Look at [http://boxen.math.washington.edu/home/release/](http://boxen.math.washington.edu/home/release/).  There should be binaries for all Sage betas, made on sage.math or boxen.math.


---

Comment by hivert created at 2012-04-18 13:52:50

It seems that I have a fix, but I don't understand how it worked before ! Still looking.

Florent


---

Comment by jdemeyer created at 2012-04-18 17:09:51

It looks like this was introduced in sage-5.0.beta8.


---

Comment by jdemeyer created at 2012-04-18 18:59:15

The culprit is #9128.


---

Comment by hivert created at 2012-04-18 19:50:49

Thanks for investigating.

Replying to [comment:9 jdemeyer]:
> The culprit is #9128.

Strange ! It was an obvious candidate and I'm pretty sure I started by checking this one. Still I don't understand what could cause that in #9128. I'm testing my fix.

Florent


---

Comment by jdemeyer created at 2012-04-19 08:47:22

Changing priority from blocker to critical.


---

Comment by hivert created at 2012-04-19 10:16:37

Hi,

I got the fix ! I'm definitely the culprit. For strange reason the following lines were removed by #9128. Putting them back should fix the problem.

```diff
diff --git a/doc/common/conf.py b/doc/common/conf.py
--- a/doc/common/conf.py
+++ b/doc/common/conf.py
`@``@` -576,6 +576,8 `@``@` def find_sage_dangling_links(app, env, n
     newnode.append(contnode)
     return newnode
 
+from sage.misc.sageinspect import sage_getargspec
+autodoc_builtin_argspec = sage_getargspec
 
 def setup(app):
     app.connect('autodoc-process-docstring', process_docstring_cython)
```



---

Attachment


---

Comment by hivert created at 2012-04-19 10:19:31

Changing status from new to needs_review.


---

Comment by hivert created at 2012-04-19 10:24:30

Jeroen: I'm reviewing your patch. Can you review mine ?

Florent


---

Comment by jdemeyer created at 2012-04-19 10:26:38

Replying to [comment:14 hivert]:
> Can you review mine ?
Sorry, no.  I'm not at all familiar with the docbuilding process.


---

Comment by mhansen created at 2012-04-19 17:57:06

Florent's patch is good, as is Jeroen (even if it is a bit sensitive to the particular HTML output used by Sphinx).


---

Comment by mhansen created at 2012-04-19 17:57:06

Changing status from needs_review to positive_review.


---

Comment by hivert created at 2012-04-20 06:11:15

Replying to [comment:16 mhansen]:
> Florent's patch is good, as is Jeroen (even if it is a bit sensitive to the particular HTML output used by Sphinx).

Thanks Mike !


---

Comment by jdemeyer created at 2012-04-26 20:09:39

Resolution: fixed


---

Comment by hthomas created at 2012-09-06 16:53:46

Hi!

The doctest introduced by this patch, at line 22 of sage/misc/sagedoc.py, is causing the sagepad.org patchbot to fail on some (trivial, unrelated) patches.  The problem seems to be that the doctest is trying to check the documentation when the documentation isn't built.  

I don't know if this is really a problem with this patch, or with the patchbot, but I thought I would try reporting it here.  If I should try elsewhere, please let me know!

You can see this failure at #12943, which is a completely trivial patch.  (It's also making the sagepad.org patchbot fail on #10527.  If you look at that ticket, though, don't look at the log for Volker's patchbot, which is having a different problem.)

cheers,

Hugh


---

Comment by jhpalmieri created at 2012-09-06 17:14:44

A complete set of documentation is an integral part of a Sage build, so doctests are supposed to fail if the documentation hasn't been built. This is not because of this ticket, I don't think.


---

Comment by hthomas created at 2012-09-07 04:09:05

Thanks.  The issue seems to be with the particular patchbot -- I have posted to sage-devel about it.
