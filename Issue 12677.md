# Issue 12677: The argspecs of extension function/methods is broken in the Sphinx documentation

archive/issues_012677.json:
```json
{
    "body": "Assignee: mvngu\n\nKeywords: argspecs Cython\n\nIn the current Sphinx HTML doc, the extenstion function and methods have no arguments setup.\n\nSee for example the documentation of\n\n```\nreference/sage/symbolic/expression.html#sage.symbolic.expression.Expression.N\n```\n \nwhich was [ok (see there)](http://www.sagemath.org/doc/reference/sage/symbolic/expression.html#sage.symbolic.expression.Expression.N) in Sage 4.8. The problem seems to have been introduced between release 5.0beta2 and 5.0beta7.\n\nBy the way, we should find a way to do regression test on that kinds of problems.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12849\n\n",
    "created_at": "2012-04-17T10:36:02Z",
    "labels": [
        "documentation",
        "blocker",
        "bug"
    ],
    "title": "The argspecs of extension function/methods is broken in the Sphinx documentation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12677",
    "user": "hivert"
}
```
Assignee: mvngu

Keywords: argspecs Cython

In the current Sphinx HTML doc, the extenstion function and methods have no arguments setup.

See for example the documentation of

```
reference/sage/symbolic/expression.html#sage.symbolic.expression.Expression.N
```
 
which was [ok (see there)](http://www.sagemath.org/doc/reference/sage/symbolic/expression.html#sage.symbolic.expression.Expression.N) in Sage 4.8. The problem seems to have been introduced between release 5.0beta2 and 5.0beta7.

By the way, we should find a way to do regression test on that kinds of problems.

Issue created by migration from https://trac.sagemath.org/ticket/12849





---

archive/issue_comments_151432.json:
```json
{
    "body": "Changing assignee from mvngu to mvngu, hivert.",
    "created_at": "2012-04-17T10:36:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151432",
    "user": "hivert"
}
```

Changing assignee from mvngu to mvngu, hivert.



---

archive/issue_comments_151433.json:
```json
{
    "body": "Doctest for the issue",
    "created_at": "2012-04-18T09:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151433",
    "user": "jdemeyer"
}
```

Doctest for the issue



---

archive/issue_comments_151434.json:
```json
{
    "body": "Attachment\n\nI created a doctest for this issue, which obviously fails on recent Sage betas.",
    "created_at": "2012-04-18T09:14:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151434",
    "user": "jdemeyer"
}
```

Attachment

I created a doctest for this issue, which obviously fails on recent Sage betas.



---

archive/issue_comments_151435.json:
```json
{
    "body": "Replying to [comment:2 jdemeyer]:\n> I created a doctest for this issue, which obviously fails on recent Sage betas.\n\nThanks ! I tried to figureout a way to call directly Sphinx but this is much easier. I'll try to work on this this afternoon. Do you have somewhere the various beta compiled so that I can rsync them on boxen to help bissecting ? So far the few guesses I made to find the culprit were wrong.",
    "created_at": "2012-04-18T09:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151435",
    "user": "hivert"
}
```

Replying to [comment:2 jdemeyer]:
> I created a doctest for this issue, which obviously fails on recent Sage betas.

Thanks ! I tried to figureout a way to call directly Sphinx but this is much easier. I'll try to work on this this afternoon. Do you have somewhere the various beta compiled so that I can rsync them on boxen to help bissecting ? So far the few guesses I made to find the culprit were wrong.



---

archive/issue_comments_151436.json:
```json
{
    "body": "sage-5.0.beta5 is still okay.",
    "created_at": "2012-04-18T11:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151436",
    "user": "jdemeyer"
}
```

sage-5.0.beta5 is still okay.



---

archive/issue_comments_151437.json:
```json
{
    "body": "Replying to [comment:3 hivert]:\n> Replying to [comment:2 jdemeyer]:\n> > I created a doctest for this issue, which obviously fails on recent Sage betas.\n> \n> Thanks ! I tried to figureout a way to call directly Sphinx but this is much easier. I'll try to work on this this afternoon. Do you have somewhere the various beta compiled so that I can rsync them on boxen to help bissecting ? So far the few guesses I made to find the culprit were wrong.\n>  \n\nLook at [http://boxen.math.washington.edu/home/release/](http://boxen.math.washington.edu/home/release/).  There should be binaries for all Sage betas, made on sage.math or boxen.math.",
    "created_at": "2012-04-18T11:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151437",
    "user": "jdemeyer"
}
```

Replying to [comment:3 hivert]:
> Replying to [comment:2 jdemeyer]:
> > I created a doctest for this issue, which obviously fails on recent Sage betas.
> 
> Thanks ! I tried to figureout a way to call directly Sphinx but this is much easier. I'll try to work on this this afternoon. Do you have somewhere the various beta compiled so that I can rsync them on boxen to help bissecting ? So far the few guesses I made to find the culprit were wrong.
>  

Look at [http://boxen.math.washington.edu/home/release/](http://boxen.math.washington.edu/home/release/).  There should be binaries for all Sage betas, made on sage.math or boxen.math.



---

archive/issue_comments_151438.json:
```json
{
    "body": "It seems that I have a fix, but I don't understand how it worked before ! Still looking.\n\nFlorent",
    "created_at": "2012-04-18T13:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151438",
    "user": "hivert"
}
```

It seems that I have a fix, but I don't understand how it worked before ! Still looking.

Florent



---

archive/issue_comments_151439.json:
```json
{
    "body": "It looks like this was introduced in sage-5.0.beta8.",
    "created_at": "2012-04-18T17:09:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151439",
    "user": "jdemeyer"
}
```

It looks like this was introduced in sage-5.0.beta8.



---

archive/issue_comments_151440.json:
```json
{
    "body": "The culprit is #9128.",
    "created_at": "2012-04-18T18:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151440",
    "user": "jdemeyer"
}
```

The culprit is #9128.



---

archive/issue_comments_151441.json:
```json
{
    "body": "Thanks for investigating.\n\nReplying to [comment:9 jdemeyer]:\n> The culprit is #9128.\n\nStrange ! It was an obvious candidate and I'm pretty sure I started by checking this one. Still I don't understand what could cause that in #9128. I'm testing my fix.\n\nFlorent",
    "created_at": "2012-04-18T19:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151441",
    "user": "hivert"
}
```

Thanks for investigating.

Replying to [comment:9 jdemeyer]:
> The culprit is #9128.

Strange ! It was an obvious candidate and I'm pretty sure I started by checking this one. Still I don't understand what could cause that in #9128. I'm testing my fix.

Florent



---

archive/issue_comments_151442.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2012-04-19T08:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151442",
    "user": "jdemeyer"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_151443.json:
```json
{
    "body": "Hi,\n\nI got the fix ! I'm definitely the culprit. For strange reason the following lines were removed by #9128. Putting them back should fix the problem.\n\n```diff\ndiff --git a/doc/common/conf.py b/doc/common/conf.py\n--- a/doc/common/conf.py\n+++ b/doc/common/conf.py\n@@ -576,6 +576,8 @@ def find_sage_dangling_links(app, env, n\n     newnode.append(contnode)\n     return newnode\n \n+from sage.misc.sageinspect import sage_getargspec\n+autodoc_builtin_argspec = sage_getargspec\n \n def setup(app):\n     app.connect('autodoc-process-docstring', process_docstring_cython)\n```\n",
    "created_at": "2012-04-19T10:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151443",
    "user": "hivert"
}
```

Hi,

I got the fix ! I'm definitely the culprit. For strange reason the following lines were removed by #9128. Putting them back should fix the problem.

```diff
diff --git a/doc/common/conf.py b/doc/common/conf.py
--- a/doc/common/conf.py
+++ b/doc/common/conf.py
@@ -576,6 +576,8 @@ def find_sage_dangling_links(app, env, n
     newnode.append(contnode)
     return newnode
 
+from sage.misc.sageinspect import sage_getargspec
+autodoc_builtin_argspec = sage_getargspec
 
 def setup(app):
     app.connect('autodoc-process-docstring', process_docstring_cython)
```




---

archive/issue_comments_151444.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-04-19T10:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151444",
    "user": "hivert"
}
```

Attachment



---

archive/issue_comments_151445.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-04-19T10:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151445",
    "user": "hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_151446.json:
```json
{
    "body": "Jeroen: I'm reviewing your patch. Can you review mine ?\n\nFlorent",
    "created_at": "2012-04-19T10:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151446",
    "user": "hivert"
}
```

Jeroen: I'm reviewing your patch. Can you review mine ?

Florent



---

archive/issue_comments_151447.json:
```json
{
    "body": "Replying to [comment:14 hivert]:\n> Can you review mine ?\nSorry, no.  I'm not at all familiar with the docbuilding process.",
    "created_at": "2012-04-19T10:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151447",
    "user": "jdemeyer"
}
```

Replying to [comment:14 hivert]:
> Can you review mine ?
Sorry, no.  I'm not at all familiar with the docbuilding process.



---

archive/issue_comments_151448.json:
```json
{
    "body": "Florent's patch is good, as is Jeroen (even if it is a bit sensitive to the particular HTML output used by Sphinx).",
    "created_at": "2012-04-19T17:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151448",
    "user": "mhansen"
}
```

Florent's patch is good, as is Jeroen (even if it is a bit sensitive to the particular HTML output used by Sphinx).



---

archive/issue_comments_151449.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-04-19T17:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151449",
    "user": "mhansen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_151450.json:
```json
{
    "body": "Replying to [comment:16 mhansen]:\n> Florent's patch is good, as is Jeroen (even if it is a bit sensitive to the particular HTML output used by Sphinx).\n\nThanks Mike !",
    "created_at": "2012-04-20T06:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151450",
    "user": "hivert"
}
```

Replying to [comment:16 mhansen]:
> Florent's patch is good, as is Jeroen (even if it is a bit sensitive to the particular HTML output used by Sphinx).

Thanks Mike !



---

archive/issue_comments_151451.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-04-26T20:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151451",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_151452.json:
```json
{
    "body": "Hi!\n\nThe doctest introduced by this patch, at line 22 of sage/misc/sagedoc.py, is causing the sagepad.org patchbot to fail on some (trivial, unrelated) patches.  The problem seems to be that the doctest is trying to check the documentation when the documentation isn't built.  \n\nI don't know if this is really a problem with this patch, or with the patchbot, but I thought I would try reporting it here.  If I should try elsewhere, please let me know!\n\nYou can see this failure at #12943, which is a completely trivial patch.  (It's also making the sagepad.org patchbot fail on #10527.  If you look at that ticket, though, don't look at the log for Volker's patchbot, which is having a different problem.)\n\ncheers,\n\nHugh",
    "created_at": "2012-09-06T16:53:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151452",
    "user": "hthomas"
}
```

Hi!

The doctest introduced by this patch, at line 22 of sage/misc/sagedoc.py, is causing the sagepad.org patchbot to fail on some (trivial, unrelated) patches.  The problem seems to be that the doctest is trying to check the documentation when the documentation isn't built.  

I don't know if this is really a problem with this patch, or with the patchbot, but I thought I would try reporting it here.  If I should try elsewhere, please let me know!

You can see this failure at #12943, which is a completely trivial patch.  (It's also making the sagepad.org patchbot fail on #10527.  If you look at that ticket, though, don't look at the log for Volker's patchbot, which is having a different problem.)

cheers,

Hugh



---

archive/issue_comments_151453.json:
```json
{
    "body": "A complete set of documentation is an integral part of a Sage build, so doctests are supposed to fail if the documentation hasn't been built. This is not because of this ticket, I don't think.",
    "created_at": "2012-09-06T17:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151453",
    "user": "jhpalmieri"
}
```

A complete set of documentation is an integral part of a Sage build, so doctests are supposed to fail if the documentation hasn't been built. This is not because of this ticket, I don't think.



---

archive/issue_comments_151454.json:
```json
{
    "body": "Thanks.  The issue seems to be with the particular patchbot -- I have posted to sage-devel about it.",
    "created_at": "2012-09-07T04:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12677",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12677#issuecomment-151454",
    "user": "hthomas"
}
```

Thanks.  The issue seems to be with the particular patchbot -- I have posted to sage-devel about it.
