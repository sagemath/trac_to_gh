# Issue 14304: jordan_form fails when base field specified

Issue created by migration from https://trac.sagemath.org/ticket/14508

Original creator: itolkov

Original creation time: 2013-04-30 05:54:35

Assignee: itolkov

CC:  tscrim nbruin sstarosta


```
sage: version()            
'Sage Version 5.9.beta5, Release Date: 2013-04-11'
sage: M=matrix([[0,1],[1,0]]);
sage: M.jordan_form()
[ 1| 0]
[--+--]
[ 0|-1]
sage: M.jordan_form(RationalField())
---------------------------------------------------------------------------
UnboundLocalError                         Traceback (most recent call last)
<ipython-input-6-3f73f89e1c74> in <module>()
----> 1 M.jordan_form(RationalField())

/usr/local/src/sage-5.9.beta5/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.jordan_form (sage/matrix/matrix2.c:44243)()

UnboundLocalError: local variable 'A' referenced before assignment
```


Fix coming shortly, as soon as I remember how to do that.


---

Comment by itolkov created at 2013-04-30 06:28:40

Changing status from new to needs_review.


---

Comment by itolkov created at 2013-04-30 07:27:06

Changing status from needs_review to needs_work.


---

Comment by itolkov created at 2013-04-30 07:27:06

Now that I'm at it, should probably fix a related issue.

```
sage: M=matrix([[0,1,0],[0,0,1],[1,0,0]])
sage: M.jordan_form(CyclotomicField(3))
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)
<ipython-input-2-32d8bd4f220b> in <module>()
----> 1 M.jordan_form(CyclotomicField(Integer(3)))

/usr/local/src/sage-5.9.beta5/local/lib/python2.7/site-packages/sage/matrix/matrix2.so in sage.matrix.matrix2.Matrix.jordan_form (sage/matrix/matrix2.c:44368)()

RuntimeError: Some eigenvalue does not exist in Integer Ring.
```



---

Comment by itolkov created at 2013-04-30 07:45:29

Changing status from needs_work to needs_review.


---

Comment by novoselt created at 2013-04-30 14:38:22

Looks good, but the commit message should be more descriptive and you need to put the ticket number on a line of the test that checks that this bug was fixed, i.e. add a comment

`... # Trac #14508`

I failed to find a reference in the developer's guide, but I am pretty sure that was the consensus.


---

Comment by itolkov created at 2013-05-01 01:55:55

How about this?


---

Attachment


---

Comment by ncohen created at 2013-05-20 11:10:29

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2013-05-20 11:10:29

Helloooooo !

It looks good to me, but when you add

```
if base_ring.is_field():
    A = self.change_ring(base_ring) 
```

Then you make a copy of `A` even if ``base_ring`` is equal to ``A.base_ring()``, aren't you ? Is that necessary ?

Nathann


---

Comment by darij created at 2013-10-10 00:41:16

A is no longer basechanged if the base_ring keyword was None and the base ring of A is a field. is this what we want?


---

Attachment


---

Comment by darij created at 2013-10-10 01:16:04

Changing status from needs_info to needs_review.


---

Comment by darij created at 2013-11-18 04:48:07

BTW, the `change_ring` methods on all the matrix classes I've checked (dense integer matrices, dense rational matrices, dense generic matrices) start out (more or less -- sometimes, the ring is first checked for being a ring) by checking whether the ring to map into is already the base ring, and if so, do nothing or simply copy the matrix if it's mutable. So it shouldn't be a bad slowdown or something. And with my patch, it happens only if the user explicitly specifies the `base_ring` variable. So is this still an issue?


---

Comment by ncohen created at 2014-02-04 10:47:00

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-02-04 10:47:00

HellooooooooO !!

Sorry for not having answered earlier, I must have missed the emails `:-/`

Anyway it looks good to me. Positive review, with a brand new git branch.

Nathann
----
New commits:


---

Comment by darij created at 2014-02-04 15:55:41

Thank you! Nothing like a positive review from Nathann when it comes to potential slowdown issues.


---

Comment by vbraun created at 2014-02-07 00:50:00

Resolution: fixed
