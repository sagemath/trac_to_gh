# Issue 34180: wrong result for multivariate polynomial evaluation

Issue created by migration from https://trac.sagemath.org/ticket/34417

Original creator: lorenz

Original creation time: 2022-08-24 04:05:07

CC:  malb

Example:


```sage
sage: R.<x,y> = Zmod(9)[]
sage: f = x^2 * y
sage: f(3, 1)
1
```



---

Comment by lorenz created at 2022-08-24 10:21:24

Things look fine up until the `fast_map_common_subexp()` call in `singular_polynomial_call()` in `src/sage/libs/singular/polynomial.pyx`. Either the arguments are set up wrong somehow, or it might be a Singular bug?


---

Comment by @DaveWitteMorris created at 2022-08-24 20:48:44

Thanks for finding the bug and looking into it.  I haven't investigated, but I am worried that it may indeed be a problem with Singular, because the online manual says: 

"SINGULAR supports coefficient ranges which are not fields, i.e. the integers Z and the finite rings Z/n for a number n. These coefficient rings were implemented in SINGULAR 3.0.5 and at the moment only limited functionality is available." [https://www.singular.uni-kl.de/Manual/4-3-1/sing_32.htm#SEC45](https://www.singular.uni-kl.de/Manual/4-3-1/sing_32.htm#SEC45)

and 

"In case of coefficient rings, which are not fields (i.e. Z and Z/m), only the following functions are guaranteed to work: 
* - basic polynomial arithmetic, i.e. addition, multiplication, exponentiation 
* - std, i.e. computing standard bases (and related: syz, etc.) 
* - interred 
* - reduce"
[https://www.singular.uni-kl.de/Manual/4-3-1/sing_28.htm#SEC39](https://www.singular.uni-kl.de/Manual/4-3-1/sing_28.htm#SEC39)


---

Comment by roed created at 2022-09-14 06:09:00

I'm not sure what's going on, but I wasn't able to reproduce the problem directly in singular:


```
sage: singular_console()
> ring R = (integer,9),(x,y),dp;
> poly f = x^2*y;
> subst(f,x,3,y,1);
0
```



---

Comment by klee created at 2022-09-27 23:19:07

See #34591 for a path to a solution.


---

Comment by klee created at 2022-09-28 13:32:55

Yes. There was a bug in `fast_map_common_subexp()`. I made a PR to Singular:

https://github.com/Singular/Singular/pull/1151


---

Comment by klee created at 2022-09-28 22:10:58

Replying to [comment:5 Kwankyu Lee]:
> See #34591 for a path to a solution.

#34591 will also be fixed by the upstream patch.


---

Comment by @DaveWitteMorris created at 2022-09-28 22:37:18

Thanks for fixing this! I looked at the singular code, but couldn't understand it, so didn't know what was wrong or how to fix it.
