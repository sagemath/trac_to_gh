# Issue 34278: factorization of symmetric functions

archive/issues_034278.json:
```json
{
    "body": "CC:  tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34515\n\n",
    "created_at": "2022-09-09T20:05:12Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "factorization of symmetric functions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34278",
    "user": "mantepse"
}
```
CC:  tscrim



Issue created by migration from https://trac.sagemath.org/ticket/34515





---

archive/issue_comments_486104.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2022-09-09T20:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486104",
    "user": "mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_486105.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2022-09-09T20:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486105",
    "user": "mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_486106.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-09-09T20:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486106",
    "user": "mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_486107.json:
```json
{
    "body": "I guess it would be good to tell the parent that it is a UFD whenever it is, but I don't know how.\n----\nNew commits:",
    "created_at": "2022-09-09T20:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486107",
    "user": "mantepse"
}
```

I guess it would be good to tell the parent that it is a UFD whenever it is, but I don't know how.
----
New commits:



---

archive/issue_comments_486108.json:
```json
{
    "body": "I think I like it:\n\n```\nsage: R.<t> = QQ[]\nsage: Sym = SymmetricFunctions(FractionField(R))\nsage: JP = Sym.jack(t).P(); JP\nSymmetric Functions over Fraction Field of Univariate Polynomial Ring in t over Rational Field in the Jack P basis\nsage: f = (JP[2,1]*t + JP[1,1,1])^2; f \n((20*t^3+60*t^2+40*t)/(t^3+12*t^2+47*t+60))*JackP[1, 1, 1, 1, 1, 1] + ((8*t^4+50*t^3+38*t^2+12*t)/(t^3+7*t^2+16*t+12))*JackP[2, 1, 1, 1, 1] +\n((4*t^8+36*t^7+113*t^6+170*t^5+186*t^4+139*t^3+60*t^2+12*t)/(t^6+17/2*t^5+59/2*t^4+107/2*t^3+107/2*t^2+28*t+6))*JackP[2, 2, 1, 1] +\n((6*t^6+21*t^5+10*t^4+6*t^3+13*t^2+12*t+4)/(t^4+6*t^3+13*t^2+12*t+4))*JackP[2, 2, 2] + ((22*t^5+40*t^4+34*t^3+12*t^2)/(t^4+6*t^3+13*t^2+12*t+4))*JackP[3, 1, 1, 1] +\n((2*t^5+13*t^4+25/3*t^3+16/3*t^2+4/3*t)/(t^3+19/6*t^2+8/3*t+2/3))*JackP[3, 2, 1] + (2*t^3/(t+1))*JackP[3, 3] + (2*t^3/(t+1))*JackP[4, 1, 1] + t^2*JackP[4, 2]\nsage: f.factor()\n(1/(t^2 + 4*t + 4)) * ((-t-2)*JackP[1, 1, 1] + (-t^2-2*t)*JackP[2, 1])^2\n```\n",
    "created_at": "2022-09-09T21:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486108",
    "user": "mantepse"
}
```

I think I like it:

```
sage: R.<t> = QQ[]
sage: Sym = SymmetricFunctions(FractionField(R))
sage: JP = Sym.jack(t).P(); JP
Symmetric Functions over Fraction Field of Univariate Polynomial Ring in t over Rational Field in the Jack P basis
sage: f = (JP[2,1]*t + JP[1,1,1])^2; f 
((20*t^3+60*t^2+40*t)/(t^3+12*t^2+47*t+60))*JackP[1, 1, 1, 1, 1, 1] + ((8*t^4+50*t^3+38*t^2+12*t)/(t^3+7*t^2+16*t+12))*JackP[2, 1, 1, 1, 1] +
((4*t^8+36*t^7+113*t^6+170*t^5+186*t^4+139*t^3+60*t^2+12*t)/(t^6+17/2*t^5+59/2*t^4+107/2*t^3+107/2*t^2+28*t+6))*JackP[2, 2, 1, 1] +
((6*t^6+21*t^5+10*t^4+6*t^3+13*t^2+12*t+4)/(t^4+6*t^3+13*t^2+12*t+4))*JackP[2, 2, 2] + ((22*t^5+40*t^4+34*t^3+12*t^2)/(t^4+6*t^3+13*t^2+12*t+4))*JackP[3, 1, 1, 1] +
((2*t^5+13*t^4+25/3*t^3+16/3*t^2+4/3*t)/(t^3+19/6*t^2+8/3*t+2/3))*JackP[3, 2, 1] + (2*t^3/(t+1))*JackP[3, 3] + (2*t^3/(t+1))*JackP[4, 1, 1] + t^2*JackP[4, 2]
sage: f.factor()
(1/(t^2 + 4*t + 4)) * ((-t-2)*JackP[1, 1, 1] + (-t^2-2*t)*JackP[2, 1])^2
```




---

archive/issue_comments_486109.json:
```json
{
    "body": "To set the category, you need to do two things:\n\n- Add it to the `super_categories` in `SymmetricFunctionBasses` in `sfa.py`.\n- Add it to the `cat` in the `class SymmetricFunctions` in `sf.py`.\n\nFor the code, you can use `M._from_dict` because we know each index is unique because we are using the monomial basis for polynomials.",
    "created_at": "2022-09-09T23:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486109",
    "user": "tscrim"
}
```

To set the category, you need to do two things:

- Add it to the `super_categories` in `SymmetricFunctionBasses` in `sfa.py`.
- Add it to the `cat` in the `class SymmetricFunctions` in `sf.py`.

For the code, you can use `M._from_dict` because we know each index is unique because we are using the monomial basis for polynomials.



---

archive/issue_comments_486110.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-12T11:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486110",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486111.json:
```json
{
    "body": "Ready!",
    "created_at": "2022-09-12T11:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486111",
    "user": "mantepse"
}
```

Ready!



---

archive/issue_comments_486112.json:
```json
{
    "body": "Thank you. Green bot => positive review.",
    "created_at": "2022-09-12T12:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486112",
    "user": "tscrim"
}
```

Thank you. Green bot => positive review.



---

archive/issue_comments_486113.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-11-12T20:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486113",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_486114.json:
```json
{
    "body": "I don't quite understand where this error suddenly comes from.",
    "created_at": "2022-11-12T20:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486114",
    "user": "mantepse"
}
```

I don't quite understand where this error suddenly comes from.



---

archive/issue_comments_486115.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-14T19:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486115",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486116.json:
```json
{
    "body": "Random guess is something happened with the categories, but I need to investigate.",
    "created_at": "2022-11-15T08:51:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486116",
    "user": "tscrim"
}
```

Random guess is something happened with the categories, but I need to investigate.



---

archive/issue_comments_486117.json:
```json
{
    "body": "THe problem is that `UniqueFactorizationDomains` expects that also `gcd` is implemented.  There should have been a `TestSuite` test that checks this, but apparently, there isn't.\n\n`gcd` can be implemented along the same lines (i.e., converting to a polynomial and back), and I have already done this, but I need to polish first.  I am not sure what the parent of `gcd(self, other)` should be, I am guessing `self.parent()`?\n\nI don't know whether `quo_rem` also has to be implemented.\n\nThere is another glitch: when the union of all partitions in the symmetric functions has only a single part, then the polynomial ring is univariate, and the element constructor works differently.  This is also easy to fix.",
    "created_at": "2022-11-15T09:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486117",
    "user": "mantepse"
}
```

THe problem is that `UniqueFactorizationDomains` expects that also `gcd` is implemented.  There should have been a `TestSuite` test that checks this, but apparently, there isn't.

`gcd` can be implemented along the same lines (i.e., converting to a polynomial and back), and I have already done this, but I need to polish first.  I am not sure what the parent of `gcd(self, other)` should be, I am guessing `self.parent()`?

I don't know whether `quo_rem` also has to be implemented.

There is another glitch: when the union of all partitions in the symmetric functions has only a single part, then the polynomial ring is univariate, and the element constructor works differently.  This is also easy to fix.



---

archive/issue_comments_486118.json:
```json
{
    "body": "I \"implemented\" `gcd` and `_floordiv_`, but it seems that this is not quite sufficient:\n\n```\nsage -t --random-seed=47916933199520535698691498656724910757 src/sage/rings/lazy_series.py\n**********************************************************************\nFile \"src/sage/rings/lazy_series.py\", line 150, in sage.rings.lazy_series\nFailed example:\n    check(L, L(p[1]))\nExpected nothing\nGot:\n    unable to convert p[] to a rational in (1) / (3*p[])\n    unable to convert p[] to a rational in (p[]) / (3*p[])\n    unable to convert p[] to a rational in (p[1]) / (3*p[])\n    unable to convert p[] to a rational in (p[] + p[1]) / (3*p[])\n    cannot invert self (= -p[1]) in (p[] + p[1]) / (p[] + p[1])\n    unable to convert p[] to a rational in (2*p[] + p[1] + (p[1,1])) / (3*p[])\n    cannot invert self (= -p[1, 1]) in (2*p[] + p[1] + (p[1,1])) / (2*p[] + p[1] + (p[1,1]))\n**********************************************************************\n1 item had failures:\n   1 of  55 in sage.rings.lazy_series\n    [1464 tests, 1 failure, 11.78 s]\n```\n\nVery likely, these are true bugs.  If so, there is another bug: these should also be detected by the doctests in the symmetric function code and the testsuite in `lazy_series_ring.py`, but aren't.",
    "created_at": "2022-11-19T14:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486118",
    "user": "mantepse"
}
```

I "implemented" `gcd` and `_floordiv_`, but it seems that this is not quite sufficient:

```
sage -t --random-seed=47916933199520535698691498656724910757 src/sage/rings/lazy_series.py
**********************************************************************
File "src/sage/rings/lazy_series.py", line 150, in sage.rings.lazy_series
Failed example:
    check(L, L(p[1]))
Expected nothing
Got:
    unable to convert p[] to a rational in (1) / (3*p[])
    unable to convert p[] to a rational in (p[]) / (3*p[])
    unable to convert p[] to a rational in (p[1]) / (3*p[])
    unable to convert p[] to a rational in (p[] + p[1]) / (3*p[])
    cannot invert self (= -p[1]) in (p[] + p[1]) / (p[] + p[1])
    unable to convert p[] to a rational in (2*p[] + p[1] + (p[1,1])) / (3*p[])
    cannot invert self (= -p[1, 1]) in (2*p[] + p[1] + (p[1,1])) / (2*p[] + p[1] + (p[1,1]))
**********************************************************************
1 item had failures:
   1 of  55 in sage.rings.lazy_series
    [1464 tests, 1 failure, 11.78 s]
```

Very likely, these are true bugs.  If so, there is another bug: these should also be detected by the doctests in the symmetric function code and the testsuite in `lazy_series_ring.py`, but aren't.



---

archive/issue_comments_486119.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-19T14:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486119",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486120.json:
```json
{
    "body": "Help needed.",
    "created_at": "2022-11-19T14:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486120",
    "user": "mantepse"
}
```

Help needed.



---

archive/issue_comments_486121.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-20T19:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486121",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486122.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-11-20T20:10:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486122",
    "user": "mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_486123.json:
```json
{
    "body": "The implementation is ugly, and I would like to see more systematic testing, but I would need some hints for that.",
    "created_at": "2022-11-20T20:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486123",
    "user": "mantepse"
}
```

The implementation is ugly, and I would like to see more systematic testing, but I would need some hints for that.



---

archive/issue_comments_486124.json:
```json
{
    "body": "I will try to take a look tomorrow.",
    "created_at": "2022-11-21T12:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486124",
    "user": "tscrim"
}
```

I will try to take a look tomorrow.



---

archive/issue_comments_486125.json:
```json
{
    "body": "Why are you testing if there is a `fraction_field()` method? Shouldn't it be more fundamental like being an integral domain (where the category provides a default)?\n\nWhat else are you currently unsure about? The implementation looks okay to me modulo the above question.\n\nOne other small thing I might change is\n\n```diff\n         R = self.base().base_ring()\n         cat = HopfAlgebras(R)\n+        categories = [self.base().Realizations(),\n+                      cat.Commutative().WithBasis(),\n+                      cat.Graded().Realizations()]\n         if R in PrincipalIdealDomains:\n+            categories.append(UniqueFactorizationDomains())\n+        return categories\n-            return [self.base().Realizations(),\n-                    cat.Commutative().WithBasis(),\n-                    cat.Graded().Realizations(),\n-                    UniqueFactorizationDomains()]\n-\n-        return [self.base().Realizations(),\n-                cat.Commutative().WithBasis(),\n-                cat.Graded().Realizations()]\n```\n",
    "created_at": "2022-11-24T00:34:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486125",
    "user": "tscrim"
}
```

Why are you testing if there is a `fraction_field()` method? Shouldn't it be more fundamental like being an integral domain (where the category provides a default)?

What else are you currently unsure about? The implementation looks okay to me modulo the above question.

One other small thing I might change is

```diff
         R = self.base().base_ring()
         cat = HopfAlgebras(R)
+        categories = [self.base().Realizations(),
+                      cat.Commutative().WithBasis(),
+                      cat.Graded().Realizations()]
         if R in PrincipalIdealDomains:
+            categories.append(UniqueFactorizationDomains())
+        return categories
-            return [self.base().Realizations(),
-                    cat.Commutative().WithBasis(),
-                    cat.Graded().Realizations(),
-                    UniqueFactorizationDomains()]
-
-        return [self.base().Realizations(),
-                cat.Commutative().WithBasis(),
-                cat.Graded().Realizations()]
```




---

archive/issue_comments_486126.json:
```json
{
    "body": "Replying to [comment:20 Travis Scrimshaw]:\n> Why are you testing if there is a `fraction_field()` method? Shouldn't it be more fundamental like being an integral domain (where the category provides a default)?\n\nUnfortunately, this is not true - there is no default implementation of `fraction_field`, this would be #34347.\n\n> What else are you currently unsure about? The implementation looks okay to me modulo the above question.\n\nThere are two separate issues:\n\n* it seems to me that the quality of our test suite should be improved in this ticket - and not postponed, because I only see it's lackingness here: we enhance the ring of symmetric functions, and a test in `lazy_series.py` fails, which is not even in the testsuite.\n\n* in `sfa.py`, I am providing the very same not entirely trivial code to convert to and from a polynomial three times.  Moreover, I think it might be better to put this code into `SymmetricFunctionAlgebra_multiplicative`, and thus separate factorization from conversion to a parent where we can do the factorization.",
    "created_at": "2022-11-24T08:11:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486126",
    "user": "mantepse"
}
```

Replying to [comment:20 Travis Scrimshaw]:
> Why are you testing if there is a `fraction_field()` method? Shouldn't it be more fundamental like being an integral domain (where the category provides a default)?

Unfortunately, this is not true - there is no default implementation of `fraction_field`, this would be #34347.

> What else are you currently unsure about? The implementation looks okay to me modulo the above question.

There are two separate issues:

* it seems to me that the quality of our test suite should be improved in this ticket - and not postponed, because I only see it's lackingness here: we enhance the ring of symmetric functions, and a test in `lazy_series.py` fails, which is not even in the testsuite.

* in `sfa.py`, I am providing the very same not entirely trivial code to convert to and from a polynomial three times.  Moreover, I think it might be better to put this code into `SymmetricFunctionAlgebra_multiplicative`, and thus separate factorization from conversion to a parent where we can do the factorization.



---

archive/issue_comments_486127.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-24T08:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486127",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486128.json:
```json
{
    "body": "Replying to [comment:21 Martin Rubey]:\n> Replying to [comment:20 Travis Scrimshaw]:\n> > Why are you testing if there is a `fraction_field()` method? Shouldn't it be more fundamental like being an integral domain (where the category provides a default)?\n> \n> Unfortunately, this is not true - there is no default implementation of `fraction_field`, this would be #34347.\n\nAh, right, it is not required yet. However, my question still holds. It is conceivable that division still makes sense without going to the fraction field:\n\n```\nsage: R.<z> = LaurentPolynomialRing(QQ)\nsage: (1 / z).parent()\nUnivariate Laurent Polynomial Ring in z over Rational Field\n```\n\nAdmittedly that is a bit of a special case, but testing for a fraction field feels like slightly too strong of a restriction.\n\n> > What else are you currently unsure about? The implementation looks okay to me modulo the above question.\n> \n> There are two separate issues:\n> \n> * it seems to me that the quality of our test suite should be improved in this ticket - and not postponed, because I only see it's lackingness here: we enhance the ring of symmetric functions, and a test in `lazy_series.py` fails, which is not even in the testsuite.\n\nThat is exactly what good doctests should do. Not everything needs to be, nor should be, jammed into the test suite. It has limitations of being a general purpose tool, part of which is based on the elements given to it to test. Of course, that should not be taken as we should not improve the test suite with general tests where appropriate. However, I don't think we should make broader changes on this ticket.\n\nAm I correct in that [ccc925f](https://git.sagemath.org/sage.git/commit/?id=ccc925fd1bd22721b9e478f13350231663c31334) fixes the failures you were seeing?\n\n> * in `sfa.py`, I am providing the very same not entirely trivial code to convert to and from a polynomial three times.  Moreover, I think it might be better to put this code into `SymmetricFunctionAlgebra_multiplicative`, and thus separate factorization from conversion to a parent where we can do the factorization.\n\nI think that conversion (as a hidden `_to_poly` and `_from_poly`) could work. Although it is not quite isolated because you have two different elements (for two methods) that should be in the same polynomial ring when done. That kind of communication would be hard. At this point, we aren't scaling this, so it might not be worth the time and effort to find a solution to this right now.\n\nAlso `_floordiv_` should have both its arguments are part of the same parent, hence the first part of that function should not be necessarily. For `gcd`, there is the decorator ``@`coerce_binop` that you can use to avoid the common parent finding too.",
    "created_at": "2022-11-24T08:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486128",
    "user": "tscrim"
}
```

Replying to [comment:21 Martin Rubey]:
> Replying to [comment:20 Travis Scrimshaw]:
> > Why are you testing if there is a `fraction_field()` method? Shouldn't it be more fundamental like being an integral domain (where the category provides a default)?
> 
> Unfortunately, this is not true - there is no default implementation of `fraction_field`, this would be #34347.

Ah, right, it is not required yet. However, my question still holds. It is conceivable that division still makes sense without going to the fraction field:

```
sage: R.<z> = LaurentPolynomialRing(QQ)
sage: (1 / z).parent()
Univariate Laurent Polynomial Ring in z over Rational Field
```

Admittedly that is a bit of a special case, but testing for a fraction field feels like slightly too strong of a restriction.

> > What else are you currently unsure about? The implementation looks okay to me modulo the above question.
> 
> There are two separate issues:
> 
> * it seems to me that the quality of our test suite should be improved in this ticket - and not postponed, because I only see it's lackingness here: we enhance the ring of symmetric functions, and a test in `lazy_series.py` fails, which is not even in the testsuite.

That is exactly what good doctests should do. Not everything needs to be, nor should be, jammed into the test suite. It has limitations of being a general purpose tool, part of which is based on the elements given to it to test. Of course, that should not be taken as we should not improve the test suite with general tests where appropriate. However, I don't think we should make broader changes on this ticket.

Am I correct in that [ccc925f](https://git.sagemath.org/sage.git/commit/?id=ccc925fd1bd22721b9e478f13350231663c31334) fixes the failures you were seeing?

> * in `sfa.py`, I am providing the very same not entirely trivial code to convert to and from a polynomial three times.  Moreover, I think it might be better to put this code into `SymmetricFunctionAlgebra_multiplicative`, and thus separate factorization from conversion to a parent where we can do the factorization.

I think that conversion (as a hidden `_to_poly` and `_from_poly`) could work. Although it is not quite isolated because you have two different elements (for two methods) that should be in the same polynomial ring when done. That kind of communication would be hard. At this point, we aren't scaling this, so it might not be worth the time and effort to find a solution to this right now.

Also `_floordiv_` should have both its arguments are part of the same parent, hence the first part of that function should not be necessarily. For `gcd`, there is the decorator ``@`coerce_binop` that you can use to avoid the common parent finding too.



---

archive/issue_comments_486129.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-24T16:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486129",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486130.json:
```json
{
    "body": "I simplified the code (before the commit, corner cases were failing).  Is the following intentional?\n\n```\nsage: R.<q> = ZZ[]\nsage: R(6).factor()\n2 * 3\nsage: R(6).factor().universe()\nInteger Ring\n```\n",
    "created_at": "2022-11-24T16:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486130",
    "user": "mantepse"
}
```

I simplified the code (before the commit, corner cases were failing).  Is the following intentional?

```
sage: R.<q> = ZZ[]
sage: R(6).factor()
2 * 3
sage: R(6).factor().universe()
Integer Ring
```




---

archive/issue_comments_486131.json:
```json
{
    "body": "Replying to [comment:23 Travis Scrimshaw]:\n> Replying to [comment:21 Martin Rubey]:\n> > Replying to [comment:20 Travis Scrimshaw]:\n> > > Why are you testing if there is a `fraction_field()` method? Shouldn't it be more fundamental like being an integral domain (where the category provides a default)?\n> > \n> > Unfortunately, this is not true - there is no default implementation of `fraction_field`, this would be #34347.\n> \n> Ah, right, it is not required yet. However, my question still holds. It is conceivable that division still makes sense without going to the fraction field:\n> {{{\n> sage: R.<z> = LaurentPolynomialRing(QQ)\n> sage: (1 / z).parent()\n> Univariate Laurent Polynomial Ring in z over Rational Field\n> }}}\n> Admittedly that is a bit of a special case, but testing for a fraction field feels like slightly too strong of a restriction.\n\nThe restriction is only in the case of exact series - but I don't quite understand your question: this `R` does have `_fraction_field`, and it coincides with `R`.\n\nOh, now I see.  I think I want `R.base_ring()` to have a fraction field...",
    "created_at": "2022-11-24T16:22:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486131",
    "user": "mantepse"
}
```

Replying to [comment:23 Travis Scrimshaw]:
> Replying to [comment:21 Martin Rubey]:
> > Replying to [comment:20 Travis Scrimshaw]:
> > > Why are you testing if there is a `fraction_field()` method? Shouldn't it be more fundamental like being an integral domain (where the category provides a default)?
> > 
> > Unfortunately, this is not true - there is no default implementation of `fraction_field`, this would be #34347.
> 
> Ah, right, it is not required yet. However, my question still holds. It is conceivable that division still makes sense without going to the fraction field:
> {{{
> sage: R.<z> = LaurentPolynomialRing(QQ)
> sage: (1 / z).parent()
> Univariate Laurent Polynomial Ring in z over Rational Field
> }}}
> Admittedly that is a bit of a special case, but testing for a fraction field feels like slightly too strong of a restriction.

The restriction is only in the case of exact series - but I don't quite understand your question: this `R` does have `_fraction_field`, and it coincides with `R`.

Oh, now I see.  I think I want `R.base_ring()` to have a fraction field...



---

archive/issue_comments_486132.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-24T16:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486132",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486133.json:
```json
{
    "body": "Can / should we do something about the unit in the factorization?\n\n```\nsage: n=6; [s(la).factor() for la in Partitions(n)]\n[s[6],\n (-1) * (-s[5, 1]),\n s[4, 2],\n s[4, 1, 1],\n (-1) * (-s[3, 3]),\n s[3, 2, 1],\n (-1) * (-s[3, 1, 1, 1]),\n (-1) * (-s[2, 2, 2]),\n (-1) * (-s[2, 2, 1, 1]),\n s[2, 1, 1, 1, 1],\n (-1) * (-s[1, 1, 1, 1, 1, 1])]\n```\n",
    "created_at": "2022-11-25T10:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486133",
    "user": "mantepse"
}
```

Can / should we do something about the unit in the factorization?

```
sage: n=6; [s(la).factor() for la in Partitions(n)]
[s[6],
 (-1) * (-s[5, 1]),
 s[4, 2],
 s[4, 1, 1],
 (-1) * (-s[3, 3]),
 s[3, 2, 1],
 (-1) * (-s[3, 1, 1, 1]),
 (-1) * (-s[2, 2, 2]),
 (-1) * (-s[2, 2, 1, 1]),
 s[2, 1, 1, 1, 1],
 (-1) * (-s[1, 1, 1, 1, 1, 1])]
```




---

archive/issue_comments_486134.json:
```json
{
    "body": "Factorizations in a UFD are only defined up to a unit. So we cannot do anything about that. We would have no way to say which factor to bring the unit to in general, and it isn\u2019t worth a special case for \u201csimple\u201d cases IMO.",
    "created_at": "2022-11-25T10:37:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486134",
    "user": "tscrim"
}
```

Factorizations in a UFD are only defined up to a unit. So we cannot do anything about that. We would have no way to say which factor to bring the unit to in general, and it isn’t worth a special case for “simple” cases IMO.



---

archive/issue_comments_486135.json:
```json
{
    "body": "D'accord !",
    "created_at": "2022-11-25T11:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486135",
    "user": "mantepse"
}
```

D'accord !



---

archive/issue_comments_486136.json:
```json
{
    "body": "I just noticed that there is a method for monomial symmetric functions doing the same, just less generally and with a bug:\n\n```\n    def from_polynomial_exp(self, p):\n    ...\n    assert self.base_ring() == p.parent().base_ring()\n    return self.sum_of_terms((Partition(exp=monomial), coeff)\n                             for monomial, coeff in p.dict().items())\n```\n\nshall I replace this with\n\n```\n    def from_polynomial_exp(self, p):\n    ...\n    assert self.base_ring() == p.parent().base_ring()\n    from sage.combinat.sf.sfa import _from_polynomial\n    return _from_polynomial(p, self)\n```\n\n?",
    "created_at": "2022-11-29T12:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486136",
    "user": "mantepse"
}
```

I just noticed that there is a method for monomial symmetric functions doing the same, just less generally and with a bug:

```
    def from_polynomial_exp(self, p):
    ...
    assert self.base_ring() == p.parent().base_ring()
    return self.sum_of_terms((Partition(exp=monomial), coeff)
                             for monomial, coeff in p.dict().items())
```

shall I replace this with

```
    def from_polynomial_exp(self, p):
    ...
    assert self.base_ring() == p.parent().base_ring()
    from sage.combinat.sf.sfa import _from_polynomial
    return _from_polynomial(p, self)
```

?



---

archive/issue_comments_486137.json:
```json
{
    "body": "Yes, we should replace it.",
    "created_at": "2022-11-30T05:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486137",
    "user": "tscrim"
}
```

Yes, we should replace it.



---

archive/issue_comments_486138.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-11-30T08:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486138",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486139.json:
```json
{
    "body": "anything else I should do?",
    "created_at": "2022-11-30T11:51:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486139",
    "user": "mantepse"
}
```

anything else I should do?



---

archive/issue_comments_486140.json:
```json
{
    "body": "Not that I can think of.",
    "created_at": "2022-12-01T04:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486140",
    "user": "tscrim"
}
```

Not that I can think of.



---

archive/issue_comments_486141.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-01T13:44:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486141",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486142.json:
```json
{
    "body": "Morally green bot. So is it ready for a positive review?",
    "created_at": "2022-12-02T04:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486142",
    "user": "tscrim"
}
```

Morally green bot. So is it ready for a positive review?



---

archive/issue_comments_486143.json:
```json
{
    "body": "Yes, please!",
    "created_at": "2022-12-02T05:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486143",
    "user": "mantepse"
}
```

Yes, please!



---

archive/issue_comments_486144.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-02T05:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486144",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_486145.json:
```json
{
    "body": "Merge failure on top of:\n\na372136c066 Trac #33941: Implement from_integer and to_integer for all finite fields, extending and replacing fetch_int and integer_representation\n\n3b1c9de1201 Trac #33757: commutativity test\n\n34266283ab5 Trac #29360: change_ring() should preserve sparsity of vectors and vector spaces\n\n1f56ce0e9d7 Trac #27652: parent of plethysm\n\n019537d9929 Trac #34693: Further support for matplotlib 3.6\n\n59e9f7b4f01 Trac #34658: Update numpy to 1.23.5, scipy 1.9.3, networkx 2.8.8, meson_python 0.11.0\n\n6d03a671290 Trac #34593: Document and manage temporary directories\n\n454290087ec Trac #33842: Upgrade python to 3.11\n\nf53f07a063f Trac #34766: GH Actions: Update actions\n\n795383fbdc9 Trac #34728: change sorting for WeierstrassIsomorphism\n\n2cec793d624 Trac #33562: Bad error message for weighted adjacency matrix\n\n3670306d20f Trac #34740: dead hyperlinks in developer manual\n\n9666ae7ced6 Trac #34722: some code cleanup in WeierstrassIsomorphism\n\nf41abf6243d Trac #34759: some details in filtered simplicial complexes\n\ndfc299ba564 Trac #34756: Documentation regarding setting up SageMath's Jupyter kernel in an existing installation points to wrong directory\n\n513a7bc6a9c Trac #34753: fix all W391 in pyx files\n\n7503e42cf2f Trac #34751: Update sage tutorial\n\n623ea7446d3 Trac #34745: modernize super in algebras/ again\n\nf2fa7597737 Trac #34741: OS X 13: filter out dylib warning\n\na4748c342ab Trac #34738: tiny details in symbolic min and max\n\nfb213dfda77 Trac #34769: use libgap in simplicial_complex\n\n01beb6a1069 Trac #34765: meson: Add spkg-configure.m4\n\nd94c7334140 Trac #34762: Fix random chain complex doctest\n\nb3398f0543d Trac #34761: Remove src/sage/libs/fes.pyx\n\n3c42a395c22 Trac #34754: Remove module-level imports from sage.plot\n\n0d120581338 Trac #34569: Fix some quasimodular forms rings methods for congruence subgroups\n\n84f02afa5c8 Updated [SageMath](SageMath) version to 9.8.beta4\n\n\n\nmerge was not clean: conflicts in src/sage/combinat/sf/sfa.py",
    "created_at": "2022-12-03T00:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486145",
    "user": "vbraun"
}
```

Merge failure on top of:

a372136c066 Trac #33941: Implement from_integer and to_integer for all finite fields, extending and replacing fetch_int and integer_representation

3b1c9de1201 Trac #33757: commutativity test

34266283ab5 Trac #29360: change_ring() should preserve sparsity of vectors and vector spaces

1f56ce0e9d7 Trac #27652: parent of plethysm

019537d9929 Trac #34693: Further support for matplotlib 3.6

59e9f7b4f01 Trac #34658: Update numpy to 1.23.5, scipy 1.9.3, networkx 2.8.8, meson_python 0.11.0

6d03a671290 Trac #34593: Document and manage temporary directories

454290087ec Trac #33842: Upgrade python to 3.11

f53f07a063f Trac #34766: GH Actions: Update actions

795383fbdc9 Trac #34728: change sorting for WeierstrassIsomorphism

2cec793d624 Trac #33562: Bad error message for weighted adjacency matrix

3670306d20f Trac #34740: dead hyperlinks in developer manual

9666ae7ced6 Trac #34722: some code cleanup in WeierstrassIsomorphism

f41abf6243d Trac #34759: some details in filtered simplicial complexes

dfc299ba564 Trac #34756: Documentation regarding setting up SageMath's Jupyter kernel in an existing installation points to wrong directory

513a7bc6a9c Trac #34753: fix all W391 in pyx files

7503e42cf2f Trac #34751: Update sage tutorial

623ea7446d3 Trac #34745: modernize super in algebras/ again

f2fa7597737 Trac #34741: OS X 13: filter out dylib warning

a4748c342ab Trac #34738: tiny details in symbolic min and max

fb213dfda77 Trac #34769: use libgap in simplicial_complex

01beb6a1069 Trac #34765: meson: Add spkg-configure.m4

d94c7334140 Trac #34762: Fix random chain complex doctest

b3398f0543d Trac #34761: Remove src/sage/libs/fes.pyx

3c42a395c22 Trac #34754: Remove module-level imports from sage.plot

0d120581338 Trac #34569: Fix some quasimodular forms rings methods for congruence subgroups

84f02afa5c8 Updated [SageMath](SageMath) version to 9.8.beta4



merge was not clean: conflicts in src/sage/combinat/sf/sfa.py



---

archive/issue_comments_486146.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-12-03T00:46:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486146",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_486147.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-04T16:24:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486147",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486148.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-04T16:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486148",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486149.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-12-04T16:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486149",
    "user": "mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_486150.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-12-04T19:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486150",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486151.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-12-05T00:58:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486151",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_486152.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-12-14T22:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34278",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34278#issuecomment-486152",
    "user": "vbraun"
}
```

Resolution: fixed
