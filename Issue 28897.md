# Issue 28897: node_number_at_depth broken for binary trees

Issue created by migration from https://trac.sagemath.org/ticket/29134

Original creator: @mwageringel

Original creation time: 2020-02-01 15:25:22

CC:  tscrim jmantysalo darijg


```
sage: ascii_art(BinaryTrees(3).list())
[ o    , o  ,   o  ,   o,     o ]
[  \      \    / \    /      /  ]
[   o      o  o   o  o      o   ]
[    \    /           \    /    ]
[     o  o             o  o     ]
sage: [t.node_number_at_depth(0) for t in BinaryTrees(3)]  # correct
[1, 1, 1, 1, 1]
sage: [t.node_number_at_depth(1) for t in BinaryTrees(3)]  # expected [1, 1, 2, 1, 1]
[2, 2, 2, 2, 2]
sage: [t.node_number_at_depth(2) for t in BinaryTrees(3)]  # expected [1, 1, 0, 1, 1]
[2, 2, 4, 2, 2]
```



---

Comment by chapoton created at 2020-02-01 20:56:34

For compactness, the usual ascii_art plot does not display the leaves, which nevertheless are nodes.

```
sage: ascii_art([t.to_full() for t in BinaryTrees(3)])
[   _o__       ,   __o___     ,     __o__    ,      __o___  ,        _o__   ]
[  /    \         /      \         /     \         /      \         /    \  ]
[ o     _o_      o       _o_      o       o      _o_       o      _o_     o ]
[      /   \            /   \    / \     / \    /   \            /   \      ]
[     o     o          o     o  o   o   o   o  o     o          o     o     ]
[          / \        / \                           / \        / \          ]
[         o   o      o   o                         o   o      o   o         ]
```



---

Comment by chapoton created at 2020-02-02 19:54:00

Changing status from new to needs_review.


---

Comment by chapoton created at 2020-02-02 19:54:00

I therefore suggest to close as invalid. All the conventions are clearly explained in the documentation.


---

Comment by @mwageringel created at 2020-02-02 20:48:36

Replying to [comment:1 chapoton]:
> For compactness, the usual ascii_art plot does not display the leaves, which nevertheless are nodes.

Indeed, that explains the output I got. It is still a bit confusing that `node_number_at_depth` counts nodes including leaves, while `node_number` does not include the leaves.


```
sage: [t.node_number() for t in BinaryTrees(3)]
[3, 3, 3, 3, 3]
```


In my opinion, there is an inconsistency that should be fixed.

The documentation is not that clear about this. If anything, I am inclined to interpret it as saying that leaves are not considered nodes in binary trees:


```
    Binary trees contain nodes and leaves, where each node has two
    children while each leaf has no children. The number of leaves
    of a binary tree always equals the number of nodes plus `1`.
```



---

Comment by tscrim created at 2020-02-02 23:55:13

I think it is slightly misleading to say `ascii_art` does not display the leaves. I would consider there to be two distinct sets of objects:

1 - binary trees with `n` nodes and
2 - full binary trees with `n` internal nodes.

There is a definite inconsistency here between `node_number` and `node_number_at_depth`. The problem is this corner case:

```
sage: T = BinaryTrees(3)[3]
sage: Tp = T[1]
sage: Tp
.
sage: Tp.is_empty()
True
sage: Tp.node_number_at_depth(0)
1
```

In particular, it says an empty tree has 1 node, which is wrong. This branch fixes this.
----
New commits:


---

Comment by @mwageringel created at 2020-02-03 09:37:59

Thanks for fixing this so quickly. It works exactly as I expect.

Frédéric, if you agree, I think this can be set to positive.


---

Comment by chapoton created at 2020-02-03 09:52:14

do whatever you want, I have no time


---

Comment by @mwageringel created at 2020-02-03 09:54:48

Ok, no problem.


---

Comment by @mwageringel created at 2020-02-03 09:54:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-02-11 21:06:20

Resolution: fixed
