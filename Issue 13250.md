# Issue 13250: Log scale plots should auto-expand axes range to include at least 2 ticks

Issue created by migration from Trac.

Original creator: ppurka

Original creation time: 2012-09-02 17:35:39

Assignee: jason, was

CC:  kcrisman

Keywords: log plot

This comes up from an internal(?) email where it was asked that log scale plots should have automatic expansion of the axis if there are not enough ticks. The current behavior is to raise an error.

The attached patch implements this feature and works as long as the user doesn't provide too few ticks via the `ticks` option of `show()`. This patch is a preliminary patch for feedback and should work well with the following plots, all of which fail without this patch:

```
sage: plot_loglog(x)
sage: plot_loglog(x, (1,10)).show(xmin=10, xmax=1)
sage: list_plot_loglog(zip([1, 10], [0.5, 6.0]))
sage: list_plot_loglog(zip([2, 3], [3, 4.0]), base=2)
sage: list_plot_loglog(zip([2, 10], [0.5, 4.0]))
```


Once completed, this patch should make #13340 invalid.

TODO: Add doctests and ensure that nothing breaks.


---

Comment by ppurka created at 2012-09-05 12:17:25

Changing status from new to needs_review.


---

Comment by ppurka created at 2012-09-05 12:17:25

I have completed this patch now. It should work in almost all cases. I say _almost_ because there are some instances like the one below which should be given the treatment of [GIGO](http://en.wikipedia.org/wiki/GIGO) ;)

```
list_plot_loglog([(1,2),(2,3)], plotjoined=True, ticks=[None,[1,20]])
```



---

Comment by ppurka created at 2012-09-05 12:30:25

Changing status from needs_review to needs_work.


---

Comment by ppurka created at 2012-09-05 12:48:19

Apply to devel/sage


---

Attachment


---

Comment by ppurka created at 2012-09-05 12:50:08

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2013-06-20 00:38:10

Trivial rebase needed; I'll upload a new one once I've finished reviewing this.


---

Comment by kcrisman created at 2013-06-20 00:53:38

Changing status from needs_review to needs_work.


---

Comment by kcrisman created at 2013-06-20 00:53:38

Hi ppurka!

Compare

```
sage: plot_loglog(x^2,(x,1,100),base=10,xmax=1.1)
sage: plot_loglog(x^2,(x,1,100),base=10,ymax = 1.1)
```

In principle, they should both curtail the plot (in different directions, of course).  But only the second one does.

Another one:

```
sage: plot_loglog(x^2,(x,1,100),base=10,ticks=[[],[]])
sage: plot_loglog(x^2,(x,1,2),base=10,ticks=[[],[]])
```

Neither one of these plots axes, but they don't raise the error.  With putting one tick each, then we are fine.  But I'm not sure what we really want here.

(I'm not going to bother with the rebase because right now it just is removing a few removals of whitespace, so all one has to do is do `hg qrefresh` and that's it.)


---

Comment by ppurka created at 2013-06-20 01:08:10

Replying to [comment:8 kcrisman]:
> Hi ppurka!
> 
> Compare
> {{{
> sage: plot_loglog(x^2,(x,1,100),base=10,xmax=1.1)
> sage: plot_loglog(x^2,(x,1,100),base=10,ymax = 1.1)
> }}}
> In principle, they should both curtail the plot (in different directions, of course).  But only the second one does.

This is #13368. The xmax when passed on to show works.

> 
> Another one:
> {{{
> sage: plot_loglog(x^2,(x,1,100),base=10,ticks=[[],[]])
> sage: plot_loglog(x^2,(x,1,2),base=10,ticks=[[],[]])
> }}}
> Neither one of these plots axes, but they don't raise the error.  With putting one tick each, then we are fine.  But I'm not sure what we really want here.

The behavior is the same without this patch, except that the second plot fails without this patch and passes with this patch. So this is some other bug.


---

Comment by ppurka created at 2013-06-20 01:14:36

The second behavior is now #14782


---

Comment by kcrisman created at 2013-06-20 01:27:49

> > Compare
> > {{{
> > sage: plot_loglog(x^2,(x,1,100),base=10,xmax=1.1)
> > sage: plot_loglog(x^2,(x,1,100),base=10,ymax = 1.1)
> > }}}
> > In principle, they should both curtail the plot (in different directions, of course).  But only the second one does.
> 
> This is #13368. The xmax when passed on to show works.
Hmm, that makes sense.  Yup,

```
plot_loglog(x^2,(x,1,100),base=10).show(xmax=1.1)
```

> The behavior is the same without this patch, except that the second plot fails without this patch and passes with this patch. So this is some other bug.
Thanks.

Okay, how about these?

```
p = list_plot(range(1, 10), plotjoined=True)
p.show(scale='loglog')
```

Only one major tick

```
p = list_plot(range(1, 10))
p.show(scale='loglog')
```

no horizontal axis at all!


---

Attachment

That said, I've still rebased, since I'm probably wrong and this is a different preexisting bug :)

apply trac_13422-rebase.patch


---

Comment by ppurka created at 2013-06-20 01:51:56

I am surprised these apply against 5.11. I thought they will fail. Although, I don't have 5.11 to verify.


---

Comment by kcrisman created at 2013-06-20 01:53:17

> I am surprised these apply against 5.11. I thought they will fail. Although, I don't have 5.11 to verify.
Nope, just a little whitespace that no longer needed to be removed.  I think there hasn't been a lot of graphics activity lately?


---

Comment by ppurka created at 2013-06-20 01:58:45

No, there hasn't been a lot of graphics activity. But I think it won't apply against #14664.


---

Comment by kcrisman created at 2013-06-20 02:02:09

> No, there hasn't been a lot of graphics activity. But I think it won't apply against #14664.
But it did!  In fact, that is where the whitespace thing happened, but everything else was fine.

Any thoughts on these two strange plots?


---

Comment by ppurka created at 2013-06-20 02:24:52

Replying to [comment:16 kcrisman]:
> Any thoughts on these two strange plots?
Hmm.. I don't know what is going on in those plots. I will need some time to investigate.


---

Comment by ppurka created at 2013-07-25 10:22:36

Replying to [comment:17 ppurka]:
> Replying to [comment:16 kcrisman]:
> > Any thoughts on these two strange plots?
> Hmm.. I don't know what is going on in those plots. I will need some time to investigate.
Haha! Those two plots are a classic but crafty examples of GIGO! `list_plot(range(1,10),...)` implicitly implies that we are plotting `list_plot(zip(range(0, 9), range(1, 10)),...)`. And, as we already have warnings in the documentation - it is not advised to have nonpositive numbers in the log scale.

Change the plots ever so slightly to the following and everything is fine and dandy

```
sage: rrr = range(1, 10)
sage: list_plot(zip(rrr,rrr), plotjoined=False, scale='loglog', size=20)
sage: list_plot(zip(rrr,rrr), plotjoined=True, scale='loglog')
```



---

Comment by ppurka created at 2013-07-25 10:23:44

Changing status from needs_work to needs_review.


---

Comment by ppurka created at 2013-07-25 10:23:44

Setting it back to needs review.


---

Comment by ppurka created at 2014-01-19 14:21:40

Added a git version of the patch. This is based on 6.1.beta5.


---

Comment by git created at 2014-05-03 11:18:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2014-06-02 13:44:46

The auto-expand is wonderful, but I don't think we should try to second-guess the user if he specifies the ticks manually. It's inconsistent with the rest of plotting, and annoying to be honest. It also doesn't in any way prevent me from creating a misleading plot.

I'm posting a patch on top of ppurka's that does two things:

* Removes the error when ticks are specified manually
* Factors get_vmin_vmax out into a separate method. It "fits" better where it was, but by making it a separate method, we can take advantage of the documentation/testing stuff that's already in place. I added a docstring and a few examples to show how it works.
----
New commits:


---

Comment by ppurka created at 2014-06-03 06:54:05

`@`mjo: I think we should give at least a warning if we don't give an error on too few ticks. Thanks for the other changes. I am OK with them.


---

Comment by git created at 2014-06-03 18:06:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2014-06-03 18:08:42

Alright, warning it is. I just pushed another commit to my branch.


---

Comment by kcrisman created at 2014-06-03 18:23:29

Hey guys, sorry I haven't been able to do much on this (and many other tickets) lately - this sounds like a good compromise, especially since warnings typically should only print once.


---

Comment by ppurka created at 2014-06-04 08:27:49

Changing status from needs_review to positive_review.


---

Comment by ppurka created at 2014-06-04 08:27:49

I am ok with your new changes. With `@`kcrisman's blessings, we can safely put this ticket to positive review `<sup>_</sup>`

`@`mjo: A request - since you are digging around in the plot code. If you get the time, please have a look at #13246. I will hopefully be able to update it quite soon with rebased patches.


---

Comment by vbraun created at 2014-06-04 14:48:16

Resolution: fixed
