# Issue 18861: implement Taylor 2-graphs for U_3(q) and related srg's

Issue created by migration from Trac.

Original creator: dimpase

Original creation time: 2015-08-26 22:30:43

CC:  ncohen

implement Taylor 2-graphs for U_3(q) and related srg's; 
the latter have to be constructed directly, as the two-graph gets very big and slow.

see §7E of [Brouwer and van Lint](http://www.win.tue.nl/~aeb/preprints/srgsurvey.pdf) and note the [correction](http://www.win.tue.nl/~aeb/preprints.html) saying 

§7E, A construction by D. Taylor, it should say: ... 
"the triples {x,y,z} for which H(x,y)H(y,z)H(z,x) is a square in GF(`q^2`) if q ≡ 3 mod 4, a nonsquare if q ≡ 1 mod 4"


---

Comment by dimpase created at 2015-08-26 22:31:52

also improve `__init__` of `TwoGraph`, using `**kwds`.


---

Comment by dimpase created at 2015-08-31 23:12:19

Last 10 new commits:


---

Comment by git created at 2015-08-31 23:26:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-08-31 23:27:13

New commits:
----
New commits:


---

Comment by git created at 2015-09-01 00:07:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-01 04:35:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-01 04:38:55

Changing status from new to needs_review.


---

Comment by dimpase created at 2015-09-01 04:38:55

I don't grok that `**kwds` business; the following does not work:

```
diff --git a/src/sage/combinat/designs/twographs.py b/src/sage/combinat/designs/twographs.py
index c86506b..d3b51c8 100644
--- a/src/sage/combinat/designs/twographs.py
+++ b/src/sage/combinat/designs/twographs.py
`@``@` -68,8 +68,7 `@``@` class TwoGraph(IncidenceStructure):
     :mod:`~sage.combinat.designs.twographs` module.
 
     """
-    def __init__(self, points=None, blocks=None, incidence_matrix=None,
-            name=None, check=False, copy=True):
+    def __init__(self, check=False, **kwds):
         r"""
         Constructor of the class
 
`@``@` -86,9 +85,7 `@``@` class TwoGraph(IncidenceStructure):
             sage: TwoGraph(p, check=True)
             Incidence structure with 10 points and 60 blocks
         """
-        IncidenceStructure.__init__(self, points=points, blocks=blocks,
-                                    incidence_matrix=incidence_matrix,
-                                    name=name, check=False, copy=copy)
+        IncidenceStructure.__init__(self, check=False, **kwds)
         if check:  # it is a very slow, O(|points|^4), test...
            from sage.combinat.designs.twographs import is_twograph
            assert is_twograph(self), "the structure is not a 2-graph!"
```


Any idea? Otherwise, the ticket is ready...


---

Comment by ncohen created at 2015-09-01 06:09:37

> Any idea? Otherwise, the ticket is ready...

What do you think of bug reports which say "that does not work" and do not say what's wrong?


---

Comment by chapoton created at 2015-09-01 07:46:33

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-09-01 07:46:33

doc does not build, see patchbot report


---

Comment by dimpase created at 2015-09-01 16:02:10

Replying to [comment:10 ncohen]:
> > Any idea? Otherwise, the ticket is ready...
> 
> What do you think of bug reports which say "that does not work" and do not say what's wrong?
well, I was wondering whether what I tried was totally silly...
Anyhow, here is what I get after this change:

```
sage -t twographs.py
**********************************************************************
File "twographs.py", line 78, in sage.combinat.designs.twographs.TwoGraph.__init__
Failed example:
    TwoGraph([This is the Trac macro *1,2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2-macro))
Exception raised:
    Traceback (most recent call last):
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.twographs.TwoGraph.__init__[1]>", line 1, in <module>
        TwoGraph([This is the Trac macro *Integer* that was inherited from the migration called with arguments (1),Integer)](https://trac.sagemath.org/wiki/WikiMacros#Integer-macro))
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/combinat/designs/twographs.py", line 88, in __init__
        IncidenceStructure.__init__(self, check=False, **kwds)
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/combinat/designs/incidence_structures.py", line 241, in __init__
        self._points = sorted(points)
    TypeError: 'NoneType' object is not iterable
**********************************************************************
File "twographs.py", line 80, in sage.combinat.designs.twographs.TwoGraph.__init__
Failed example:
    TwoGraph([This is the Trac macro *1,2* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,2-macro), check=True)
Expected:
    Traceback (most recent call last):
    ...
    AssertionError: the structure is not a 2-graph!
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/dima/software/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.combinat.designs.twographs.TwoGraph.__init__[2]>", line 1, in <module>
        TwoGraph([This is the Trac macro *Integer* that was inherited from the migration called with arguments (1),Integer)](https://trac.sagemath.org/wiki/WikiMacros#Integer-macro), check=True)
    TypeError: __init__() got multiple values for keyword argument 'check'
**********************************************************************
File "twographs.py", line 84, in sage.combinat.designs.twographs.TwoGraph.__init__
Failed example:
    p=graphs.PetersenGraph().twograph()
...
```



---

Comment by git created at 2015-09-01 16:35:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-01 16:36:30

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2015-09-01 19:15:47

What is this ? `O_o`


```
+- cf. ``git blame`` for the others involved
```


Nathann


---

Comment by dimpase created at 2015-09-01 20:00:02

Replying to [comment:15 ncohen]:
> What is this ? `O_o`
> 
> {{{
> +- cf. ``git blame`` for the others involved
> }}}
> 

What, your legal department does not approve this copyright notice?


---

Comment by dimpase created at 2015-09-01 20:01:09

of course I can remove it if you like...


---

Comment by ncohen created at 2015-09-01 20:18:42

> What, your legal department does not approve this copyright notice?

It committed suicide last month, but through an exorcist I was able to get in touch with one of its members: what about just removing the only entry that exists in this file, given that it is not representative of anything, instead of leaving it alone and adding your note?

Nathann


---

Comment by git created at 2015-09-01 20:28:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-01 20:30:02

Replying to [comment:18 ncohen]:
> > What, your legal department does not approve this copyright notice?
> 
> It committed suicide last month, but through an exorcist I was able to get in touch with one of its members: what about just removing the only entry that exists in this file, given that it is not representative of anything, instead of leaving it alone and adding your note?

be my guest.


---

Comment by git created at 2015-09-02 02:29:10

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2015-09-02 06:13:20

Sorry but I can't review this branch before its dependencies get merged. I'm trying to get the 'diff' file while excluding dependencies, but I can't obtain *only* what this branch changes...

Nathann


---

Comment by ncohen created at 2015-09-02 06:24:24


```
+    Test whether some Taylor two-graph SRG is `(v,k,\lambda,\mu)`-strongly regular.
+
+    For more information, see http://www.win.tue.nl/~aeb/graphs/srghub.html.
```


I don't find "Taylor" in that page.

Nathann


---

Comment by git created at 2015-09-02 17:25:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-02 17:26:31

Replying to [comment:23 ncohen]:
> {{{
> +    Test whether some Taylor two-graph SRG is `(v,k,\lambda,\mu)`-strongly regular.
> +
> +    For more information, see http://www.win.tue.nl/~aeb/graphs/srghub.html.
> }}}
> 
> I don't find "Taylor" in that page.e
fixed by the last commit.


---

Comment by dimpase created at 2015-09-02 17:27:10

Replying to [comment:21 git]:
> Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
> ||[edb886e](http://git.sagemath.org/sage.git/commit/?id=edb886e9f9d0f505f272fe769e69e8a51ab265df)||`authors cleared`||

this commit did not change anything. Fixed in the last commit.


---

Comment by git created at 2015-09-03 04:33:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-03 22:20:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-04 16:16:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-09-04 18:31:22

Good news: a new beta has been released, so I will be able to review this soon

Bad news: it is in conflcit with the latest beta `:-/`

Nathann


---

Comment by git created at 2015-09-04 19:45:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-04 19:49:22

Replying to [comment:33 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[d7878be](http://git.sagemath.org/sage.git/commit/?id=d7878be6695b3386b8e5e10ed71634b08519db7d)||`Merge branch 'taylor2graphs' into tay2`||

rebased over the latest beta


---

Comment by ncohen created at 2015-09-06 07:10:21

I pushed a speedup at `public/19098`. 

Nathann


---

Comment by ncohen created at 2015-09-06 08:43:41

Helloooooooooo Dima,

Two questions about this branch:

- It seems that you do not use the `taylor_twograph` function anywhere. If you
  think that it is useful in its own right I do not mind, but I couldn't help
  but notice the apparently large overlap between the code of `taylor_twograph`
  and the code of `TaylorTwographDescendantSRG`. Couldn't you let one of the two
  functions call the other? Especially since with the speedup commit, it takes
  less time to build the graph.

- I do not understand the point of this line. Could you explain? To me all it
  does is add a vertex `v0`
  {{{
  G = H.union(Graph([[v0], lambda x, y: x != y])) # to make sure vertices are not relabeled
  }}}

Nathann


---

Comment by dimpase created at 2015-09-06 17:43:13

New commits:


---

Comment by git created at 2015-09-06 17:44:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-06 17:47:51

Replying to [comment:36 ncohen]:
> Helloooooooooo Dima,
> 
> Two questions about this branch:
> 
> - It seems that you do not use the `taylor_twograph` function anywhere. If you
>   think that it is useful in its own right I do not mind, but I couldn't help
>   but notice the apparently large overlap between the code of `taylor_twograph`
>   and the code of `TaylorTwographDescendantSRG`. Couldn't you let one of the two
>   functions call the other? Especially since with the speedup commit, it takes
>   less time to build the graph.

OK, see my last commit.
> 
> - I do not understand the point of this line. Could you explain? To me all it
>   does is add a vertex `v0`
>   {{{
>   G = H.union(Graph([[v0], lambda x, y: x != y])) # to make sure vertices are not relabeled
>   }}}
> 
it makes `Graph([v0])` have vertex named by what's in `v0` rather than just by number 0.
And so `G`'s vertex names stay uniform. Perhaps there is a less ugly way, I don't know.
----
New commits:


---

Comment by ncohen created at 2015-09-06 17:52:13

> it makes `Graph([v0])` have vertex named by what's in `v0` rather than just by number 0.

What about `your_graph.add_vertex(v0)`?


---

Comment by git created at 2015-09-06 17:58:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-06 18:08:47

Replying to [comment:40 ncohen]:
> > it makes `Graph([v0])` have vertex named by what's in `v0` rather than just by number 0.
> 
> What about `your_graph.add_vertex(v0)`?

done by the last commit, thanks!


---

Comment by ncohen created at 2015-09-06 18:26:25

Hellooooooooo,

- Could you add an INPUT: section for every function that takes arguments as input?

- It is not necessary to check in `taylor_twograph` that `q` is an odd prime power, as this is done by the call to the subfunction

- Why?

```diff
-        sage: G = SRG_253_140_87_65()                # optional - gap_packages
-        sage: G.is_strongly_regular(parameters=True) # optional - gap_packages
+        sage: G = SRG_253_140_87_65()
+        sage: G.is_strongly_regular(parameters=True)
```


- (Unrelated) turns out that we have another problem with names

```
sage: graphs.strongly_regular_graph(126,50,13,24)
Subgraph of (Distance graph for distance 2 in ): Graph on 126 vertices
```


Nathann


---

Comment by git created at 2015-09-07 01:45:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-07 01:54:07

Replying to [comment:43 ncohen]:
> - Why?
> {{{
> #!diff
> -        sage: G = SRG_253_140_87_65()                # optional - gap_packages
> -        sage: G.is_strongly_regular(parameters=True) # optional - gap_packages
> +        sage: G = SRG_253_140_87_65()
> +        sage: G.is_strongly_regular(parameters=True)
> }}}

oops, I forgot to merge later updates to #19133. Fixed in the last push, as well as fixed
a further trivial typo in #19133.

> 
> - (Unrelated) turns out that we have another problem with names
> {{{
> sage: graphs.strongly_regular_graph(126,50,13,24)
> Subgraph of (Distance graph for distance 2 in ): Graph on 126 vertices
> }}}

IMHO all these `SRG_...` functions ought to return proper graph names.
not on this ticket...


---

Comment by git created at 2015-09-07 02:41:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dimpase created at 2015-09-07 02:49:15

Replying to [comment:46 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[6253d7a](http://git.sagemath.org/sage.git/commit/?id=6253d7ad6618213d1f32bd818592b5e7b83ef467)||`added INPUT, removed unnecessary check`||

this should address the rest of comment 43.


---

Comment by ncohen created at 2015-09-07 08:56:27

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-09-07 08:56:27

Okayyyyyyyyyyyyyyyyyyyyyyyyyyy !!

Thanks,

Nathann


---

Comment by vbraun created at 2015-09-07 21:34:51

Resolution: fixed
