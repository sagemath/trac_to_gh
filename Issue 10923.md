# Issue 10923: Implementation of the SubwordComplex as defined by Knutson and Miller

Issue created by migration from https://trac.sagemath.org/ticket/11010

Original creator: stumpc5

Original creation time: 2011-03-24 14:18:31

Assignee: tbd

This patch provides an implementation of the subword complex:

Fix a Coxeter system (W,S). Let Q = be a finite word in S and pi in W.

The subword complex Delta(Q,pi) is then defined to be the simplicial complex with vertices being {0,...,n-1}, (n = len(Q), one vertex for each letter in Q) and with facets given by all (indices of) subwords Q' of Q for which Q\Q' is a reduced expression for pi.


```
    sage: W = CoxeterGroup(['A',2])
    sage: w = W.from_reduced_word([1,2,1])
    sage: C = SubwordComplex([2,1,2,1,2],w); C
    Subword complex of type ['A', 2] for Q = [2, 1, 2, 1, 2] and pi = [1, 2, 1]
    sage: C.facets()
    {(1, 2), (3, 4), (0, 4), (2, 3), (0, 1)}
```


depends on Ticket #8359.

I will upload the patch as soon as the patch on Coxeter groups is ready.


---

Comment by stumpc5 created at 2011-04-04 14:04:48

Changing type from PLEASE CHANGE to enhancement.


---

Comment by stumpc5 created at 2011-04-04 14:04:48

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by stumpc5 created at 2011-04-04 14:04:48

Changing status from new to needs_work.


---

Comment by stumpc5 created at 2011-04-04 14:04:48

Changing keywords from "" to "subword complex, simplicial complex".


---

Comment by chapoton created at 2012-11-20 08:37:52

Changing status from needs_work to needs_review.


---

Comment by stumpc5 created at 2012-11-20 08:49:59

Replying to [comment:6 chapoton]:

Okay, I must confess that I tend to not finish implementations once the patch does what I want it to do...

The dependencies of this patch must (unfortunately) inherit as well the dependencies of #11122. This is to say that this patch actually relies on many things implemented in #11187.

I would be very, very glad if anyone would finally start reviewing the universal cyclotomic field, #8327 on which #11187 depends (I would first need to rebase it, and make sure that the trac version is updated to the newest version on the combinat queue).

Cheers, Christian


---

Attachment


---

Comment by chapoton created at 2014-03-05 15:55:37

I have made a git branch. It does not work: runs into an infinite recursion because of #15456.
----
New commits:


---

Comment by chapoton created at 2014-03-05 16:27:28

The code needs to be 100% doctested. Some empty methods should be removed.


---

Comment by chapoton created at 2014-03-05 16:27:28

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2014-03-07 20:51:31

Hello Christian, do you really think that this ticket depends on #11187 ?

I am tempted to ressurect this one, without waiting for the famous category-and-axiom ticket.

With not so much work, I managed to get a branch with only 19 failures.


---

Comment by git created at 2014-03-14 17:04:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-03-14 17:10:07

Here is a better branch.

I am removing the dependencies to #11187, #15456 as I think they are not really needed.

There are still 16 failing doctests. Work in progress.


---

Comment by stumpc5 created at 2014-03-14 17:38:55

Dear Frederic,

Thanks for your work on that -- I am super busy with other stuff, hopefully this will get better in about 4 weeks from now.

I am not sure if I/we should keep the construction for positive genus:
- Mathematically, this has not been considered before,

- it is not quite the right generalization of subword complexes as defined by Knutson-Miller. In particular, such complexes do not need to be vertex-decomposable or shellable.

- we have a proper generalization which will have similar combinatorics and will capture the needed behaviour for positive genus

- our paper in which I introduce these things is still on hold and we will need at least another 3-6 months before getting this into a state to make it publicly available

I should be able to quickly look at your branch during the weekend to clean things up a bit. Or do you prefer to work things out yourself?

Cheers, Christian


---

Comment by git created at 2014-03-14 20:55:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-03-14 21:00:35

Hello Christian,

I would be happy to see you come back here. The code is not very easy to understand by me alone.

The remaining issues (15 doctests) seem to be related to a strange use of roots, where Weyl group elements seem to be supposed to act on the indices of roots in the list of roots. And they do not, of course.

I will not do anything more on the ticket until next week.


---

Comment by stumpc5 created at 2014-03-15 18:23:40

Replying to [comment:17 chapoton]:

Hi,

> I would be happy to see you come back here. The code is not very easy to understand by me alone.

I spend some time today trying to get Sage working properly again, but I failed so far. I guess I need someone helping me to work properly with git...

* I upgraded Sage using http://wiki.sagemath.org/TentativeConventions#Get_the_latest_official_development_version_of_Sage, but I got an error ```error: command 'gcc' failed with exit status```, so this is my first problem

I don't know how to resolve that now (and I also don't know if I tried to upgrade to the newest development version or the latest stable version).

> The remaining issues (15 doctests) seem to be related to a strange use of roots, where Weyl group elements seem to be supposed to act on the indices of roots in the list of roots. And they do not, of course.

I use the CHEVIE implementation of finite reflection groups which are implemented as permutation groups on indices of roots. This speed things drastically, but it is not reall mathematically clean. Moreover, I just looked at the code, and

* I also pushed many non-features that are there only for my research (and for which I cannot prove what I want to prove)
* Many features only make sense for finite Coxeter groups, so such checks are still to be implemented.


---

Comment by stumpc5 created at 2014-03-17 09:12:06

Hello Frederic,

I now spent some time playing with the patch.

My main concern is: I can re-implement things to work with any implementation of Coxeter groups (i.e., with the current implementations of Weyl groups and Coxeter groups). BUT: this will slow down things drastically!

So we either leave this ticket open and wait for my CHEVIE version of Coxeter groups, 
#11187 (I am not too positive that these will make it into Sage this year though), or we get rid of the speedy implementations and have a slow version to play in very low ranks that can be used soon.

Cheers, Christian


---

Comment by git created at 2015-06-03 23:37:04

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2015-06-05 23:30:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2015-06-06 01:20:30

Vincent, please remove the `c` and the `html` file again from the branch since they are not supposed to be going into sage.


---

Comment by git created at 2015-06-06 15:41:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-06-23 07:42:32

does not apply, needs to be rebased


---

Comment by chapoton created at 2015-11-11 20:55:01

I have made a new branch, by disentangling u/vpilaud/ticket/11010 from #11187 (but sadly still depending on #11187).

It seems that all my previous work on this ticket was lost. I do not appreciate.

----
New commits:


---

Comment by stumpc5 created at 2015-11-11 22:17:52

> It seems that all my previous work on this ticket was lost. I do not appreciate.

I don't understand. How can work be lost on a ticket?


---

Comment by chapoton created at 2015-11-12 08:04:19

Sorry for having been a little rude. I was tired and angry yesterday evening.

It remains that I have done twice the same clean-up work. I think it was
because the branch by Vincent was not based on my previous branch.

I would really like if this ticket would no longer depend on #11187, which has
no hope to enter sage as long as it depends on gap3.

You said once that it could be possible, but with a high speed penalty. Maybe this is nevertheless the way to go.


---

Comment by git created at 2015-11-12 12:16:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-11-12 15:01:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-11-12 16:46:43

As far as I can see, just one thing is needed:

- `reflections()` (technically `nr_reflections()`, but we can just do `len(self.reflections())`)

We can construct this easily enough by conjugation of simple reflections:

```
sage: W = CoxeterGroup(['A',2])
sage: S = W.simple_reflections()
sage: I = W.index_set()
sage: R = RecursivelyEnumeratedSet(S, lambda x: [S[i]*x*S[i] for i in I if not x.has_descent(i)], structure="graded")
sage: list(R)
[
[-1  1]  [ 1  0]  [ 0 -1]
[ 0  1], [ 1 -1], [-1  0]
]
sage: all(x.absolute_length() for x in R)
True
```


The `apply_simple_reflection` is already a part of Sage for Coxeter groups.

Aside - This probably deserves to be in the category of finite Coxeter groups, but there is some slight conflict with this

```
sage: W = WeylGroup(['A',2], prefix='s')
sage: W.reflections()
Finite family {s1*s2*s1: (1, 0, -1), s1: (1, -1, 0), s2: (0, 1, -1)}
```

(Trying to do this on the Weyl group on the root system seems to run forever and `ctrl-C` out results in a nasty error message.)


---

Comment by git created at 2015-11-12 21:39:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-10 20:13:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-11 20:35:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-12 21:30:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-12 21:35:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-12 21:50:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-13 11:54:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-12-13 21:09:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-12-13 21:15:33

Ok, guys. We are *almost there*. Most of the things are working and hopefully not too slow. I have worked hard for two days, so please react !

Just 2 small remaining problems (unless the bot reveals some others):

* the "plot" code is broken, maybe we can remove that for the moment ? unless somebody wants to repair it ?
* the "root_polytope" method is not documented, any objection to its removal ? unless you can provide a working example ?

cheers,

Frederic


---

Comment by stumpc5 created at 2015-12-14 08:02:11

Hi Frederic -- thanks a lot for all your work here! I am still too busy to contribute, but I can promise to have had a closer look by the end of the week, together with my opinion on how to proceed and a few speed tests... Cheers, Christian


---

Comment by git created at 2015-12-14 18:10:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2015-12-19 12:05:57

Okay, things seem to work, great!

* Root polytope: all this patch was basically parked on trac for my own research. And this method is stuff for which nothing is proven so far, so it should not be part of the ticket anymore.

* Plot: what do you have in mind outside of types A and B?

* Here are a few timings:

  This patch:

```
sage: W = WeylGroup(['A',6])
sage: c = list(W.index_set()); Q = c + W.w0.coxeter_sorting_word(c)
sage: %time S = SubwordComplex(Q,W.w0)
CPU times: user 23.6 s, sys: 36 ms, total: 23.6 s
Wall time: 23.6 s
sage: len(S)
429
```

  The same patch based on the Coxeter group implementation:

```
sage: W = CoxeterGroup(['A',6])                                    
sage: c = list(W.index_set()); Q = c + W.w0.coxeter_sorting_word(c)
sage: %time S = SubwordComplex(Q,W.w0)                             
CPU times: user 0.41 s, sys: 0.00 s, total: 0.41 s
Wall time: 0.41 s
sage: len(S)                                                       
429
```



---

Comment by stumpc5 created at 2015-12-19 12:31:26

Changing status from needs_work to needs_review.


---

Comment by stumpc5 created at 2015-12-19 12:31:26

I removed some experimental code that is not supposed to be merged (this includes the root polytope), and fixed the plot. This file's tests pass locally, so let's see what the patchbot says...
----
New commits:


---

Comment by chapoton created at 2015-12-20 16:31:17

I think one should put a large *Warning* about

`To be used only with Coxeter groups in the implementation='reflection'`

In fact, it is not only slow but mostly broken with Weyl groups.

Side remark : it seems that one cannot use the quadratic fields Q(sqrt2) for type B
and Q(sqrt5) for type H. To be fixed in another ticket, maybe.


---

Comment by stumpc5 created at 2015-12-20 16:58:17

> In fact, it is not only slow but mostly broken with Weyl groups.

Oh yes, the doctests were written for `implementation='reflection'` so it does not show that it is broken for Weyl groups.

I will have a quick look whether I can fix that!


---

Comment by tscrim created at 2015-12-20 17:38:42

I'm not too surprised `WeylGroup` is slower; it goes through the GAP interface (in particular, for multiplication) whereas the reflection implementation (of Coxeter groups) does not. However because of this, it can't get things like conjugacy classes. There is probably quite a bit we can improve with (GAP) matrix groups, but that is an issue for another ticket.

However, it surprises me a little bit that it is broken for Weyl groups because the reflection implementation was fairly minimal (up to what comes from the category).


---

Comment by stumpc5 created at 2015-12-20 18:06:50

First, the definition of subword complexes is for Coxeter groups (finite or infinite), but many of its properties (see my paper with Vincent referenced in the header) come from understanding roots and weights. (This means that the construction works, but many methods don't.)

Second, I think the current failure is only because the method `WeylGroup.roots` is missing, as is the method `WeylGroupElement.action_on_root_indices`.
* Do you know how I can get the list of (simple, positive, almost positive, all) roots of a root system when I only have the Weyl group `W` at hand? It seems that I have to build a root system from the Cartan type, though it seems more natural to have a method `WeylGroup.root_system` or at least `WeylGroup.cartan_matrix`, wouldn't it?


---

Comment by chapoton created at 2015-12-20 18:10:01

New branch, where I have added a warning.

Do you really want this to work for Weyl groups ?

You can build roots for Weyl groups just as I did for the Coxeter groups, using a reduced word for w0. But it will not be enough..
----
New commits:


---

Comment by stumpc5 created at 2015-12-20 18:13:07

Replying to [comment:57 chapoton]:
> Do you really want this to work for Weyl groups ?

I just want to quickly see if I can get the method `root_configuration` working since many others only depend on this one. And many people do use Weyl groups...


---

Comment by stumpc5 created at 2015-12-20 18:42:46

Replying to [comment:56 stumpc5]:
> * Do you know how I can get the list of (simple, positive, almost positive, all) roots of a root system when I only have the Weyl group `W` at hand? It seems that I have to build a root system from the Cartan type, though it seems more natural to have a method `WeylGroup.root_system` or at least `WeylGroup.cartan_matrix`, wouldn't it?

Ah, `WeylGroup.domain` does it...


---

Comment by git created at 2015-12-21 10:24:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2015-12-21 10:41:27

> Do you really want this to work for Weyl groups ?

Okay, I give up on this -- I tried the past hours to get it done for Weyl groups, but I basically have to fix every single method, and even have to implement my own fundamental weights in order to make this work for Weyl groups. If this is crucial at some point, we can still get back to this...


---

Comment by stumpc5 created at 2016-01-03 13:08:40

The patchbot is happy, so I think this is ready to go -- or do you see any remaining problems?


---

Comment by git created at 2016-01-03 14:57:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-01-03 15:00:56

I am not quite satisfied with the custom naive type A/B recognition in the plot method. Travis, is there a better way ? or even a way to have the correct type printed in the repr ?


---

Comment by tscrim created at 2016-01-03 15:37:22

Replying to [comment:64 chapoton]:
> I am not quite satisfied with the custom naive type A/B recognition in the plot method. Travis, is there a better way ? or even a way to have the correct type printed in the repr ?

You can use the (relatively recent) Coxeter matrices and types:

```
sage: W = CoxeterGroup(['C',4])
sage: T = W.coxeter_matrix().coxeter_type(); T
Coxeter type of ['C', 4]
```

The current implementation for Coxeter types essentially wraps the Cartan types, so there is a "different" type for B and C. (This was done because there was a lot of information that could be pulled from the Cartan type, as there is a lot of hard-coded data, and I didn't want to have to try and decide on a naming scheme. I fully take the blame for the hacks involved.)

However, the information you're after is inside the wrapped type:

```
sage: T.cartan_type()
['B', 4]
sage: T.cartan_type().type()
'B'
sage: T.cartan_type().rank()
4
```



---

Comment by git created at 2016-01-03 16:59:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-01-03 17:00:47

ok, thanks Travis. I have done the needed changes, I think.


---

Comment by chapoton created at 2016-01-03 20:44:12

ok, I think that this can go. Christian, if you agree, set to positive.


---

Comment by stumpc5 created at 2016-01-03 21:04:17

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2016-01-03 23:17:52

Does the plotting also work for type C, being that it is the dual of type B (and we are dealing with Cartan types)?


---

Comment by stumpc5 created at 2016-01-04 10:08:00

Changing status from positive_review to needs_work.


---

Comment by stumpc5 created at 2016-01-04 10:08:00

I am rather confused now:
* First Sage start

```
sage: W = CoxeterGroup(['B',4])
sage: W.coxeter_matrix().coxeter_type()
Coxeter type of ['B', 4]
sage: W = CoxeterGroup(['C',4])
sage: W.coxeter_matrix().coxeter_type()
Coxeter type of ['B', 4]
```

* Second Sage start

```
sage: W = CoxeterGroup(['C',4])
sage: W.coxeter_matrix().coxeter_type()
Coxeter type of ['C', 4]
sage: W = CoxeterGroup(['B',4])
sage: W.coxeter_matrix().coxeter_type()
Coxeter type of ['C', 4]
```

In particular, the root systems `W.roots()` are not correct in the two second calls of `CoxeterGroup`.

Also, the plotting now assumes that the first index is the type B/C special one. This is, it is expected that

```
sage: s0 = W.simple_reflection(W.index-set()[0])
sage: s1 = W.simple_reflection(W.index-set()[1])
sage: (s0*s1).order()
4
```

I doubt that this is correct in the current implementation of `Coxeter groups` where the last index is expected to be special. If so, I will add some magic to figure out the proper labelling...


---

Comment by tscrim created at 2016-01-04 11:16:53

The first issue is the result of my quick hacking to get something working. The Coxeter matrices are equal for the Cartan types B and C, and the Coxeter matrix is the information passed to the `UniqueRepresentation` cache. There are a number of ways to go moving forward, but I think that deserves its own separate ticket.

For the second issue, yes, you are correct. The `n-1` and `n` nodes have the order 4 relation between them, as this agrees with the corresponding B/C Cartan types (and the Coxeter matrix). You are welcome to relabel the Coxeter type, which should work, or go to the Coxeter graph and find the edge label4ed by 4 and use those nodes. Personally, I would use the latter option since it is independent of the labeling.


---

Comment by stumpc5 created at 2016-01-04 13:16:26

I also have the problem that the plot only allows irreducible types. When playing with reducible types, I got to the types B vs. G bug in #19830...


---

Comment by chapoton created at 2016-01-04 19:32:26

Is this "needs_review" ?
----
New commits:


---

Comment by stumpc5 created at 2016-01-04 19:36:08

> Is this "needs_review" ?

Not quite, I wanted to add a few more doctests for the type B plotting with various indexing sets. But then saw that the indexing in `CoxeterGroup` is corrupted, see #19830. This is another issue, but I still want to add more examples/testing.


---

Comment by git created at 2016-01-05 15:22:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-01-05 15:27:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by stumpc5 created at 2016-01-05 15:28:31

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-01-06 11:24:46

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2016-01-06 11:24:46

ok, good enough for me.

I have made two minor doc changes, and now set this again to positive review.

Any further changes will have to be in another ticket.
----
New commits:


---

Comment by vbraun created at 2016-01-06 22:56:44

Resolution: fixed
