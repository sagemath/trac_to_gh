# Issue 34113: speed up powers of lazy Taylor series

Issue created by migration from https://trac.sagemath.org/ticket/34350

Original creator: mantepse

Original creation time: 2022-08-12 13:36:10

Keywords: LazyPowerSeries

As remarked in ticket:32324#comment:105, the computation of the square root of a lazy series is very slow.


---

Comment by tscrim created at 2022-08-15 02:18:24

Using a the na√Øve version using the Taylor series speeds things up considerably:

```
sage: L.<z> = LazyLaurentSeriesRing(QQ)
sage: f = sqrt(1 + z)
sage: %time f[200]
CPU times: user 254 ms, sys: 4.21 ms, total: 258 ms
Wall time: 258 ms
```

versus before

```
sage: %time f[200]
CPU times: user 2.39 s, sys: 1.83 ms, total: 2.4 s
Wall time: 2.4 s
```


Another example:

```
sage: q = ZZ['q'].fraction_field().gen()
sage: L.<z> = LazyLaurentSeriesRing(q.parent())
sage: f = (1 - z)^q
sage: f
1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)
sage: %time f[200]
CPU times: user 439 ms, sys: 0 ns, total: 439 ms
Wall time: 439 ms
```

versus before

```
sage: %time c = f[200]
CPU times: user 10.3 s, sys: 9.75 ms, total: 10.3 s
Wall time: 10.3 s
```

----
Last 10 new commits:


---

Comment by tscrim created at 2022-08-15 02:18:24

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-08-15 02:19:28

I based this off #32324 since that is positively reviewed, although I can remove this if necessary.


---

Comment by MartinPepin created at 2022-09-21 14:58:49

I reproduced the time difference, that's indeed huge!

I also took the opportunity to update the docstring for `__pow__` with your examples. Before that it was only documenting integer powers. Once you have reviewed this change I think it's good to go.
----
New commits:


---

Comment by tscrim created at 2022-09-22 03:56:14

Hi Martin P. Thanks for the review. Can you quickly do two minor little tweaks to follow our docstring conventions:

```diff
-        - ``n`` -- the power to which to raise the series. This may be an
-          integer, a rational number, an element of the base ring, or an other
-          series.
+        - ``n`` -- the power to which to raise the series; this may be a
+          rational number, an element of the base ring, or another series
```


```diff
             sage: f
-            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)
+            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3
+             + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4
+             + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5
+             + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6
+             + O(z^7)
         """
```

Once you do those, you can set a positive review.


---

Comment by git created at 2022-09-22 07:36:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by MartinPepin created at 2022-09-22 07:37:40

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-09-25 16:34:17

Resolution: fixed
