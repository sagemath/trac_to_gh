# Issue 34113: speed up powers of lazy Taylor series

archive/issues_034113.json:
```json
{
    "body": "Keywords: LazyPowerSeries\n\nAs remarked in ticket:32324#comment:105, the computation of the square root of a lazy series is very slow.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34350\n\n",
    "created_at": "2022-08-12T13:36:10Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "speed up powers of lazy Taylor series",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34113",
    "user": "@mantepse"
}
```
Keywords: LazyPowerSeries

As remarked in ticket:32324#comment:105, the computation of the square root of a lazy series is very slow.

Issue created by migration from https://trac.sagemath.org/ticket/34350





---

archive/issue_comments_483972.json:
```json
{
    "body": "Using a the na\u00efve version using the Taylor series speeds things up considerably:\n\n```\nsage: L.<z> = LazyLaurentSeriesRing(QQ)\nsage: f = sqrt(1 + z)\nsage: %time f[200]\nCPU times: user 254 ms, sys: 4.21 ms, total: 258 ms\nWall time: 258 ms\n```\n\nversus before\n\n```\nsage: %time f[200]\nCPU times: user 2.39 s, sys: 1.83 ms, total: 2.4 s\nWall time: 2.4 s\n```\n\n\nAnother example:\n\n```\nsage: q = ZZ['q'].fraction_field().gen()\nsage: L.<z> = LazyLaurentSeriesRing(q.parent())\nsage: f = (1 - z)^q\nsage: f\n1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)\nsage: %time f[200]\nCPU times: user 439 ms, sys: 0 ns, total: 439 ms\nWall time: 439 ms\n```\n\nversus before\n\n```\nsage: %time c = f[200]\nCPU times: user 10.3 s, sys: 9.75 ms, total: 10.3 s\nWall time: 10.3 s\n```\n\n----\nLast 10 new commits:",
    "created_at": "2022-08-15T02:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34113#issuecomment-483972",
    "user": "@tscrim"
}
```

Using a the na√Øve version using the Taylor series speeds things up considerably:

```
sage: L.<z> = LazyLaurentSeriesRing(QQ)
sage: f = sqrt(1 + z)
sage: %time f[200]
CPU times: user 254 ms, sys: 4.21 ms, total: 258 ms
Wall time: 258 ms
```

versus before

```
sage: %time f[200]
CPU times: user 2.39 s, sys: 1.83 ms, total: 2.4 s
Wall time: 2.4 s
```


Another example:

```
sage: q = ZZ['q'].fraction_field().gen()
sage: L.<z> = LazyLaurentSeriesRing(q.parent())
sage: f = (1 - z)^q
sage: f
1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)
sage: %time f[200]
CPU times: user 439 ms, sys: 0 ns, total: 439 ms
Wall time: 439 ms
```

versus before

```
sage: %time c = f[200]
CPU times: user 10.3 s, sys: 9.75 ms, total: 10.3 s
Wall time: 10.3 s
```

----
Last 10 new commits:



---

archive/issue_comments_483973.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-15T02:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34113#issuecomment-483973",
    "user": "@tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_483974.json:
```json
{
    "body": "I based this off #32324 since that is positively reviewed, although I can remove this if necessary.",
    "created_at": "2022-08-15T02:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34113#issuecomment-483974",
    "user": "@tscrim"
}
```

I based this off #32324 since that is positively reviewed, although I can remove this if necessary.



---

archive/issue_comments_483975.json:
```json
{
    "body": "I reproduced the time difference, that's indeed huge!\n\nI also took the opportunity to update the docstring for `__pow__` with your examples. Before that it was only documenting integer powers. Once you have reviewed this change I think it's good to go.\n----\nNew commits:",
    "created_at": "2022-09-21T14:58:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34113#issuecomment-483975",
    "user": "@Kerl13"
}
```

I reproduced the time difference, that's indeed huge!

I also took the opportunity to update the docstring for `__pow__` with your examples. Before that it was only documenting integer powers. Once you have reviewed this change I think it's good to go.
----
New commits:



---

archive/issue_comments_483976.json:
```json
{
    "body": "Hi Martin P. Thanks for the review. Can you quickly do two minor little tweaks to follow our docstring conventions:\n\n```diff\n-        - ``n`` -- the power to which to raise the series. This may be an\n-          integer, a rational number, an element of the base ring, or an other\n-          series.\n+        - ``n`` -- the power to which to raise the series; this may be a\n+          rational number, an element of the base ring, or another series\n```\n\n\n```diff\n             sage: f\n-            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)\n+            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3\n+             + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4\n+             + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5\n+             + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6\n+             + O(z^7)\n         \"\"\"\n```\n\nOnce you do those, you can set a positive review.",
    "created_at": "2022-09-22T03:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34113#issuecomment-483976",
    "user": "@tscrim"
}
```

Hi Martin P. Thanks for the review. Can you quickly do two minor little tweaks to follow our docstring conventions:

```diff
-        - ``n`` -- the power to which to raise the series. This may be an
-          integer, a rational number, an element of the base ring, or an other
-          series.
+        - ``n`` -- the power to which to raise the series; this may be a
+          rational number, an element of the base ring, or another series
```


```diff
             sage: f
-            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3 + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4 + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5 + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6 + O(z^7)
+            1 - q*z + ((q^2 - q)/2)*z^2 + ((-q^3 + 3*q^2 - 2*q)/6)*z^3
+             + ((q^4 - 6*q^3 + 11*q^2 - 6*q)/24)*z^4
+             + ((-q^5 + 10*q^4 - 35*q^3 + 50*q^2 - 24*q)/120)*z^5
+             + ((q^6 - 15*q^5 + 85*q^4 - 225*q^3 + 274*q^2 - 120*q)/720)*z^6
+             + O(z^7)
         """
```

Once you do those, you can set a positive review.



---

archive/issue_comments_483977.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-22T07:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34113#issuecomment-483977",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483978.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-22T07:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34113#issuecomment-483978",
    "user": "@Kerl13"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_483979.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-25T16:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34113#issuecomment-483979",
    "user": "@vbraun"
}
```

Resolution: fixed
