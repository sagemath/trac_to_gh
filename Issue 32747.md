# Issue 32747: fix _row_ambient_module/_column_ambient_module and make them public

archive/issues_032747.json:
```json
{
    "body": "CC:  slabbe mjo @kliem\n\nMatrices have methods `_row_ambient_module`/`_column_ambient_module` (in `matrix2.pyx`) which are useful. However the caching they implement is broken (the key used to cache is different from the one used to fetch).\n\nWe also make these methods public and deprecate the underscore versions.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32984\n\n",
    "created_at": "2021-12-06T18:35:57Z",
    "labels": [
        "linear algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "fix _row_ambient_module/_column_ambient_module and make them public",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32747",
    "user": "vdelecroix"
}
```
CC:  slabbe mjo @kliem

Matrices have methods `_row_ambient_module`/`_column_ambient_module` (in `matrix2.pyx`) which are useful. However the caching they implement is broken (the key used to cache is different from the one used to fetch).

We also make these methods public and deprecate the underscore versions.

Issue created by migration from https://trac.sagemath.org/ticket/32984





---

archive/issue_comments_467087.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-12-06T19:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467087",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_467088.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-12-06T19:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467088",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_467089.json:
```json
{
    "body": "deprecation should be doctested (c'est p\u00e9nible, je sais)",
    "created_at": "2021-12-06T19:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467089",
    "user": "chapoton"
}
```

deprecation should be doctested (c'est pÃ©nible, je sais)



---

archive/issue_comments_467090.json:
```json
{
    "body": "I must have missed this in the ticket list, and have unfortunately reviewed the conflicting #32901, #32902, and #32903 first.\n\nDo we need the deprecations for private underscore methods? They should only be used internally, where we can update the name ourselves.",
    "created_at": "2021-12-07T02:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467090",
    "user": "mjo"
}
```

I must have missed this in the ticket list, and have unfortunately reviewed the conflicting #32901, #32902, and #32903 first.

Do we need the deprecations for private underscore methods? They should only be used internally, where we can update the name ourselves.



---

archive/issue_comments_467091.json:
```json
{
    "body": "This ticket is from today :) I will wait that the tickets you mention are being merged. Thanks for the notice.",
    "created_at": "2021-12-07T02:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467091",
    "user": "vdelecroix"
}
```

This ticket is from today :) I will wait that the tickets you mention are being merged. Thanks for the notice.



---

archive/issue_comments_467092.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-12-07T02:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467092",
    "user": "vdelecroix"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_467093.json:
```json
{
    "body": "Replying to [comment:5 vdelecroix]:\n> This ticket is from today :) I will wait that the tickets you mention are being merged. Thanks for the notice.\n\nOh, good, it's innumeracy and not blindness for me... =)\n\nOne more thing: I think ultimately we may be able to speed up the library as a whole by removing the `base_ring` argument. Right now we have to check it every time, even though the common case is `base_ring=None`. I have a strong suspicion that we would be better off eliminating the parameter, and asking callers to use `change_ring()` afterwards in the cases where some other base ring is needed. It needs some testing. I only bring it up because I saw you've changed one `change_ring()` to `base_ring=`.",
    "created_at": "2021-12-07T02:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467093",
    "user": "mjo"
}
```

Replying to [comment:5 vdelecroix]:
> This ticket is from today :) I will wait that the tickets you mention are being merged. Thanks for the notice.

Oh, good, it's innumeracy and not blindness for me... =)

One more thing: I think ultimately we may be able to speed up the library as a whole by removing the `base_ring` argument. Right now we have to check it every time, even though the common case is `base_ring=None`. I have a strong suspicion that we would be better off eliminating the parameter, and asking callers to use `change_ring()` afterwards in the cases where some other base ring is needed. It needs some testing. I only bring it up because I saw you've changed one `change_ring()` to `base_ring=`.



---

archive/issue_comments_467094.json:
```json
{
    "body": "Checking `base_ring is None` or `base_ring is not None` is much faster than any C function call (`None` is implemented as a `NULL` pointer in Python and such check is perfectly optimized in Cython). I am suspicious that it would make any difference.",
    "created_at": "2021-12-07T02:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467094",
    "user": "vdelecroix"
}
```

Checking `base_ring is None` or `base_ring is not None` is much faster than any C function call (`None` is implemented as a `NULL` pointer in Python and such check is perfectly optimized in Cython). I am suspicious that it would make any difference.



---

archive/issue_comments_467095.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-12-26T12:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467095",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_467096.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-12-26T13:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467096",
    "user": "vdelecroix"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_467097.json:
```json
{
    "body": "Why'd you have to move them from matrix2 to matrix1?\n\nI really don't think you should bother with a deprecation for the internal underscore method. They're not listed in the tab-completion, and are typically \"use at your own risk\" in any python project. Removing them will just waste 15 minutes of someone's time a year from now.",
    "created_at": "2021-12-27T12:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467097",
    "user": "mjo"
}
```

Why'd you have to move them from matrix2 to matrix1?

I really don't think you should bother with a deprecation for the internal underscore method. They're not listed in the tab-completion, and are typically "use at your own risk" in any python project. Removing them will just waste 15 minutes of someone's time a year from now.



---

archive/issue_comments_467098.json:
```json
{
    "body": "Replying to [comment:14 mjo]:\n> Why'd you have to move them from matrix2 to matrix1?\n \nBecause it is used in the methods `row` and `column` inside `matrix1.pyx`\n\n> I really don't think you should bother with a deprecation for the internal underscore method. They're not listed in the tab-completion, and are typically \"use at your own risk\" in any python project. Removing them will just waste 15 minutes of someone's time a year from now.\n\nThis method with underscore is precious and used in my own project. I would prefer seeing a deprecation with a pointer to this ticket rather than an `AttributeError` with no explanation at all.",
    "created_at": "2021-12-27T15:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467098",
    "user": "vdelecroix"
}
```

Replying to [comment:14 mjo]:
> Why'd you have to move them from matrix2 to matrix1?
 
Because it is used in the methods `row` and `column` inside `matrix1.pyx`

> I really don't think you should bother with a deprecation for the internal underscore method. They're not listed in the tab-completion, and are typically "use at your own risk" in any python project. Removing them will just waste 15 minutes of someone's time a year from now.

This method with underscore is precious and used in my own project. I would prefer seeing a deprecation with a pointer to this ticket rather than an `AttributeError` with no explanation at all.



---

archive/issue_comments_467099.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-12-27T15:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467099",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467100.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-27T17:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467100",
    "user": "mjo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_467101.json:
```json
{
    "body": "Ok, fine by me then. I am crossing my fingers that the last commit doesn't break the patchbot.",
    "created_at": "2021-12-27T17:17:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467101",
    "user": "mjo"
}
```

Ok, fine by me then. I am crossing my fingers that the last commit doesn't break the patchbot.



---

archive/issue_comments_467102.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-12-27T21:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467102",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_467103.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-12-27T21:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467103",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_467104.json:
```json
{
    "body": "Actually patchbot was not happy even before. I hope I fixed it.",
    "created_at": "2021-12-27T21:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467104",
    "user": "vdelecroix"
}
```

Actually patchbot was not happy even before. I hope I fixed it.



---

archive/issue_comments_467105.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-28T13:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467105",
    "user": "vdelecroix"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_467106.json:
```json
{
    "body": "Since I did not change anything to the functionalities, I assume this could go back in positive review.",
    "created_at": "2021-12-28T13:04:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467106",
    "user": "vdelecroix"
}
```

Since I did not change anything to the functionalities, I assume this could go back in positive review.



---

archive/issue_comments_467107.json:
```json
{
    "body": "Yeah that's OK. I was going to wait for the green check mark this time, but I see it's already there.",
    "created_at": "2021-12-28T14:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467107",
    "user": "mjo"
}
```

Yeah that's OK. I was going to wait for the green check mark this time, but I see it's already there.



---

archive/issue_comments_467108.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-31T23:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32747",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32747#issuecomment-467108",
    "user": "vbraun"
}
```

Resolution: fixed
