# Issue 32747: fix _row_ambient_module/_column_ambient_module and make them public

Issue created by migration from https://trac.sagemath.org/ticket/32984

Original creator: vdelecroix

Original creation time: 2021-12-06 18:35:57

CC:  slabbe mjo @kliem

Matrices have methods `_row_ambient_module`/`_column_ambient_module` (in `matrix2.pyx`) which are useful. However the caching they implement is broken (the key used to cache is different from the one used to fetch).

We also make these methods public and deprecate the underscore versions.


---

Comment by vdelecroix created at 2021-12-06 19:11:37

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2021-12-06 19:11:37

New commits:


---

Comment by chapoton created at 2021-12-06 19:25:47

deprecation should be doctested (c'est pÃ©nible, je sais)


---

Comment by mjo created at 2021-12-07 02:27:04

I must have missed this in the ticket list, and have unfortunately reviewed the conflicting #32901, #32902, and #32903 first.

Do we need the deprecations for private underscore methods? They should only be used internally, where we can update the name ourselves.


---

Comment by vdelecroix created at 2021-12-07 02:34:04

This ticket is from today :) I will wait that the tickets you mention are being merged. Thanks for the notice.


---

Comment by vdelecroix created at 2021-12-07 02:34:35

Changing status from needs_review to needs_work.


---

Comment by mjo created at 2021-12-07 02:49:29

Replying to [comment:5 vdelecroix]:
> This ticket is from today :) I will wait that the tickets you mention are being merged. Thanks for the notice.

Oh, good, it's innumeracy and not blindness for me... =)

One more thing: I think ultimately we may be able to speed up the library as a whole by removing the `base_ring` argument. Right now we have to check it every time, even though the common case is `base_ring=None`. I have a strong suspicion that we would be better off eliminating the parameter, and asking callers to use `change_ring()` afterwards in the cases where some other base ring is needed. It needs some testing. I only bring it up because I saw you've changed one `change_ring()` to `base_ring=`.


---

Comment by vdelecroix created at 2021-12-07 02:59:49

Checking `base_ring is None` or `base_ring is not None` is much faster than any C function call (`None` is implemented as a `NULL` pointer in Python and such check is perfectly optimized in Cython). I am suspicious that it would make any difference.


---

Comment by git created at 2021-12-26 12:36:29

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2021-12-26 13:35:53

Changing status from needs_work to needs_review.


---

Comment by mjo created at 2021-12-27 12:59:11

Why'd you have to move them from matrix2 to matrix1?

I really don't think you should bother with a deprecation for the internal underscore method. They're not listed in the tab-completion, and are typically "use at your own risk" in any python project. Removing them will just waste 15 minutes of someone's time a year from now.


---

Comment by vdelecroix created at 2021-12-27 15:32:27

Replying to [comment:14 mjo]:
> Why'd you have to move them from matrix2 to matrix1?
 
Because it is used in the methods `row` and `column` inside `matrix1.pyx`

> I really don't think you should bother with a deprecation for the internal underscore method. They're not listed in the tab-completion, and are typically "use at your own risk" in any python project. Removing them will just waste 15 minutes of someone's time a year from now.

This method with underscore is precious and used in my own project. I would prefer seeing a deprecation with a pointer to this ticket rather than an `AttributeError` with no explanation at all.


---

Comment by git created at 2021-12-27 15:43:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2021-12-27 17:17:51

Changing status from needs_review to positive_review.


---

Comment by mjo created at 2021-12-27 17:17:51

Ok, fine by me then. I am crossing my fingers that the last commit doesn't break the patchbot.


---

Comment by git created at 2021-12-27 21:00:22

Changing status from positive_review to needs_review.


---

Comment by git created at 2021-12-27 21:00:22

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by vdelecroix created at 2021-12-27 21:01:21

Actually patchbot was not happy even before. I hope I fixed it.


---

Comment by vdelecroix created at 2021-12-28 13:04:41

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2021-12-28 13:04:41

Since I did not change anything to the functionalities, I assume this could go back in positive review.


---

Comment by mjo created at 2021-12-28 14:20:25

Yeah that's OK. I was going to wait for the green check mark this time, but I see it's already there.


---

Comment by vbraun created at 2022-01-31 23:30:46

Resolution: fixed
