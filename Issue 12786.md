# Issue 12786: Fix sageinspect to better support classes with metaclasses.

Issue created by migration from Trac.

Original creator: nthiery

Original creation time: 2012-05-17 06:19:22

Assignee: mvngu

CC:  sage-combinat simonking

Keywords: sageinspect

I need the attached tiny fix for #12953.


---

Comment by SimonKing created at 2012-05-17 06:26:02

What attached fix?

Could you verify that what you intend to attach is not a duplicate of #11791?


---

Comment by nthiery created at 2012-05-17 06:42:32

Changing status from new to needs_review.


---

Comment by nthiery created at 2012-05-17 06:43:56

Replying to [comment:1 SimonKing]:
> What attached fix?

There it is; I decided at the last minute to add some doctests.

> Could you verify that what you intend to attach is not a duplicate of #11791?

I actually fixed the title since it's more about old style classes. If the tests I put in the patch pass, I am happy to have this ticket closed as dup of #11791.

Cheers,


---

Attachment


---

Comment by SimonKing created at 2012-05-17 07:07:05

I am not sure what the two doc tests are supposed to demonstrate, as they just test against errors being raised.

Anyway, with #11791 (plus dependencies plus something more, so, someone else should cross verify), I get

```
sage: from sage.misc.sageinspect import sage_getsourcelines
sage: class Foo: pass
....: 
sage: sage_getsourcelines(Foo)  # Is it intended to fix this?
Traceback (most recent call last):
...
IOError: could not find class definition
sage: import inspect 
sage: inspect.findsource(Sets.ParentMethods) # Why is Python's inspect module tested??
Traceback (most recent call last):
...
IOError: could not find class definition
sage: L = sage_getsourcelines(Sets.ParentMethods)  # works just fine
sage: print ''.join(L[0])
    class ParentMethods:
#         # currently overriden by the default implementation in sage.structure.Parent
#         def __call__(self, *args, **options):
#             return self.element_class(*args, **options)

        # Todo: simplify the _element_constructor definition logic
...
            """
            if category is None:
                category = self.category()
            from sage.combinat.free_module import CombinatorialFreeModule
            return CombinatorialFreeModule(base_ring, self, category = category.Algebras(base_ring))
```


The code line that is changed in your patch is not touched by #11791. So, how does it actually change things?


---

Comment by nthiery created at 2012-05-17 07:38:58

Replying to [comment:4 SimonKing]:
> I am not sure what the two doc tests are supposed to demonstrate, as they just test against errors being raised.

The error is worst without the patch :-)

> Anyway, with #11791 (plus dependencies plus something more, so, someone else should cross verify), I get
> {{{
> sage: from sage.misc.sageinspect import sage_getsourcelines
> sage: class Foo: pass
> ....: 
> sage: sage_getsourcelines(Foo)  # Is it intended to fix this?
> Traceback (most recent call last):
> ...
> IOError: could not find class definition
> sage: import inspect 
> sage: inspect.findsource(Sets.ParentMethods) # Why is Python's inspect module tested??
> Traceback (most recent call last):
> ...
> IOError: could not find class definition
> sage: L = sage_getsourcelines(Sets.ParentMethods)  # works just fine

Cool.

> The code line that is changed in your patch is not touched by #11791. So, how does it actually change things?

From the brief look I had at your path, the line is still there, but
the logic has changed a bit before. I don't know, and honestly I don't
want to spend more time on this. I guess I'll simply change #12953 to
simply not test introspection too deeply since it will get better
soon. Then it won't depend on this ticket and/or #11971.

Feel free to mark this one as a dup if you want!

Cheers,
                          Nicolas


---

Comment by rws created at 2014-02-17 17:43:59

Changing status from needs_review to positive_review.


---

Comment by rws created at 2014-02-17 17:43:59

Appears to be no longer relevant.


---

Comment by vbraun created at 2014-02-19 18:57:15

Resolution: wontfix
