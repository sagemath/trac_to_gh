# Issue 28410: conversion of Symbolic Ring to FriCAS Expression Integer

archive/issues_028410.json:
```json
{
    "body": "CC:  @fchapoton\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28647\n\n",
    "created_at": "2019-10-24T11:43:30Z",
    "labels": [
        "component: please change"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "conversion of Symbolic Ring to FriCAS Expression Integer",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28410",
    "user": "https://github.com/mantepse"
}
```
CC:  @fchapoton



Issue created by migration from https://trac.sagemath.org/ticket/28647





---

archive/issue_comments_400805.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2019-10-24T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400805",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_400806.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-24T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400806",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_400807.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-10-24T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400807",
    "user": "https://github.com/mantepse"
}
```

New commits:



---

archive/issue_comments_400808.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to interfaces: optional.",
    "created_at": "2019-10-24T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400808",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to interfaces: optional.



---

archive/issue_comments_400809.json:
```json
{
    "body": "Possible collision with #28641 which refers to the same ask.sagemath.org question.",
    "created_at": "2019-10-24T12:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400809",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Possible collision with #28641 which refers to the same ask.sagemath.org question.



---

archive/issue_comments_400810.json:
```json
{
    "body": "Replying to [comment:3 tmonteil]:\n> Possible collision with #28641 which refers to the same ask.sagemath.org question.\n\nYes, but the solutions are orthogonal to each other.  In other words: after applying this branch, #28641 solves a different problem.",
    "created_at": "2019-10-24T15:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400810",
    "user": "https://github.com/mantepse"
}
```

Replying to [comment:3 tmonteil]:
> Possible collision with #28641 which refers to the same ask.sagemath.org question.

Yes, but the solutions are orthogonal to each other.  In other words: after applying this branch, #28641 solves a different problem.



---

archive/issue_comments_400811.json:
```json
{
    "body": "some failing doctests in src/sage/functions/generalized.py and src/sage/functions/exp_integral.py",
    "created_at": "2019-10-24T15:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400811",
    "user": "https://github.com/fchapoton"
}
```

some failing doctests in src/sage/functions/generalized.py and src/sage/functions/exp_integral.py



---

archive/issue_comments_400812.json:
```json
{
    "body": "There are unfortunately more problems.  In particular, `fricas(I)` calls `FriCASConverter.pyobject(I, I)` (as it should).  But this now returns `I` instead of `%i`.",
    "created_at": "2019-10-25T10:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400812",
    "user": "https://github.com/mantepse"
}
```

There are unfortunately more problems.  In particular, `fricas(I)` calls `FriCASConverter.pyobject(I, I)` (as it should).  But this now returns `I` instead of `%i`.



---

archive/issue_comments_400813.json:
```json
{
    "body": "I'm afraid my approach won't work, because FriCAS distinguishes between `Expression Integer` and `Expression Complex Integer`.\n\nPut differently, the complex unit `I` is not an element of `Expression Integer`, but would have to be expressed as `sqrt(-1)`.  I see the following options:\n\n1. rewrite `I` as `sqrt(-1)`,\n2. always use `Expression Complex Integer`,\n3. detect whether `I` appears and distinguish accordingly,\n4. somehow let FriCAS decide\n\nI tend towards option 1., but I am not sure at all.",
    "created_at": "2019-10-25T11:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400813",
    "user": "https://github.com/mantepse"
}
```

I'm afraid my approach won't work, because FriCAS distinguishes between `Expression Integer` and `Expression Complex Integer`.

Put differently, the complex unit `I` is not an element of `Expression Integer`, but would have to be expressed as `sqrt(-1)`.  I see the following options:

1. rewrite `I` as `sqrt(-1)`,
2. always use `Expression Complex Integer`,
3. detect whether `I` appears and distinguish accordingly,
4. somehow let FriCAS decide

I tend towards option 1., but I am not sure at all.



---

archive/issue_comments_400814.json:
```json
{
    "body": "help appreciated",
    "created_at": "2019-10-28T15:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400814",
    "user": "https://github.com/mantepse"
}
```

help appreciated



---

archive/issue_comments_400815.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-28T15:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400815",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400816.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-16T14:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400816",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400817.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-11-16T14:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400817",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400818.json:
```json
{
    "body": "I think I have to make an exception for the conversion of symbols, because otherwise `fricas.integrate(ex, x)` won't work anymore.",
    "created_at": "2019-11-16T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400818",
    "user": "https://github.com/mantepse"
}
```

I think I have to make an exception for the conversion of symbols, because otherwise `fricas.integrate(ex, x)` won't work anymore.



---

archive/issue_comments_400819.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-11-16T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400819",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400820.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-20T08:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400821.json:
```json
{
    "body": "Changing keywords from \"\" to \"FriCAS\".",
    "created_at": "2019-11-20T08:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400821",
    "user": "https://github.com/mantepse"
}
```

Changing keywords from "" to "FriCAS".



---

archive/issue_comments_400822.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-20T08:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400823.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-11-20T08:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400823",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-21T09:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400825.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400825",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_400826.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400826",
    "user": "https://github.com/mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_400827.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-11-01T18:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400827",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400828.json:
```json
{
    "body": "red branch => needs work",
    "created_at": "2020-11-01T18:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400828",
    "user": "https://github.com/fchapoton"
}
```

red branch => needs work



---

archive/issue_comments_400829.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-01T19:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400830.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-01T21:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400830",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400831.json:
```json
{
    "body": "Unfortunately, #18036 breaks this.",
    "created_at": "2020-11-02T14:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400831",
    "user": "https://github.com/mantepse"
}
```

Unfortunately, #18036 breaks this.



---

archive/issue_comments_400832.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-11-02T14:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400832",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_400833.json:
```json
{
    "body": "(and I have no idea currently how to fix this)",
    "created_at": "2020-11-02T14:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400833",
    "user": "https://github.com/mantepse"
}
```

(and I have no idea currently how to fix this)



---

archive/issue_comments_400834.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400834",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_400835.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-31T19:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400836.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-31T19:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400836",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_400837.json:
```json
{
    "body": "I believe you can simplify\n\n```diff\n-            if (isinstance(obj, NumberFieldElement_quadratic) and\n-                obj.parent() is GaussianField()):\n+            if isinstance(obj, NumberFieldElement_gaussian):\n```\n\nI probably would also add a test that includes `SR(I)` (or `sqrt(-1)`) to make sure that alternative version yields what you want. Other than that, LGTM.",
    "created_at": "2021-06-01T01:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400837",
    "user": "https://github.com/tscrim"
}
```

I believe you can simplify

```diff
-            if (isinstance(obj, NumberFieldElement_quadratic) and
-                obj.parent() is GaussianField()):
+            if isinstance(obj, NumberFieldElement_gaussian):
```

I probably would also add a test that includes `SR(I)` (or `sqrt(-1)`) to make sure that alternative version yields what you want. Other than that, LGTM.



---

archive/issue_comments_400838.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-01T06:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400839.json:
```json
{
    "body": "Yes, you are right!  I copied these lines from the generic class `InterfaceInit`, so I applied your suggestion there, too.",
    "created_at": "2021-06-01T06:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400839",
    "user": "https://github.com/mantepse"
}
```

Yes, you are right!  I copied these lines from the generic class `InterfaceInit`, so I applied your suggestion there, too.



---

archive/issue_comments_400840.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-01T06:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_400841.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-01T06:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400841",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_400842.json:
```json
{
    "body": "Thank you. LGTM.",
    "created_at": "2021-06-01T06:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400842",
    "user": "https://github.com/tscrim"
}
```

Thank you. LGTM.



---

archive/issue_events_026298.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-07T21:40:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/28410#event-26298"
}
```



---

archive/issue_comments_400843.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-07T21:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-400843",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
