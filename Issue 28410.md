# Issue 28410: conversion of Symbolic Ring to FriCAS Expression Integer

Issue created by migration from https://trac.sagemath.org/ticket/28647

Original creator: mantepse

Original creation time: 2019-10-24 11:43:30

CC:  chapoton




---

Comment by mantepse created at 2019-10-24 11:47:04

Changing type from PLEASE CHANGE to defect.


---

Comment by mantepse created at 2019-10-24 11:47:04

Changing status from new to needs_review.


---

Comment by mantepse created at 2019-10-24 11:47:04

New commits:


---

Comment by mantepse created at 2019-10-24 11:47:04

Changing component from PLEASE CHANGE to interfaces: optional.


---

Comment by tmonteil created at 2019-10-24 12:18:12

Possible collision with #28641 which refers to the same ask.sagemath.org question.


---

Comment by mantepse created at 2019-10-24 15:06:41

Replying to [comment:3 tmonteil]:
> Possible collision with #28641 which refers to the same ask.sagemath.org question.

Yes, but the solutions are orthogonal to each other.  In other words: after applying this branch, #28641 solves a different problem.


---

Comment by chapoton created at 2019-10-24 15:56:54

some failing doctests in src/sage/functions/generalized.py and src/sage/functions/exp_integral.py


---

Comment by mantepse created at 2019-10-25 10:31:25

There are unfortunately more problems.  In particular, `fricas(I)` calls `FriCASConverter.pyobject(I, I)` (as it should).  But this now returns `I` instead of `%i`.


---

Comment by mantepse created at 2019-10-25 11:39:14

I'm afraid my approach won't work, because FriCAS distinguishes between `Expression Integer` and `Expression Complex Integer`.

Put differently, the complex unit `I` is not an element of `Expression Integer`, but would have to be expressed as `sqrt(-1)`.  I see the following options:

    1. rewrite `I` as `sqrt(-1)`,
    2. always use `Expression Complex Integer`,
    3. detect whether `I` appears and distinguish accordingly,
    4. somehow let FriCAS decide

I tend towards option 1., but I am not sure at all.


---

Comment by mantepse created at 2019-10-28 15:26:39

help appreciated


---

Comment by mantepse created at 2019-10-28 15:26:39

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-11-16 14:35:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2019-11-16 14:40:26

Changing status from needs_work to needs_review.


---

Comment by mantepse created at 2019-11-16 14:43:42

I think I have to make an exception for the conversion of symbols, because otherwise `fricas.integrate(ex, x)` won't work anymore.


---

Comment by mantepse created at 2019-11-16 14:43:42

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-11-20 08:12:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2019-11-20 08:24:12

Changing keywords from "" to "FriCAS".


---

Comment by git created at 2019-11-20 08:39:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2019-11-20 08:40:00

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-11-21 09:56:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by chapoton created at 2020-11-01 18:02:00

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2020-11-01 18:02:00

red branch => needs work


---

Comment by git created at 2020-11-01 19:13:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2020-11-01 21:27:13

Changing status from needs_work to needs_review.


---

Comment by mantepse created at 2020-11-02 14:06:01

Unfortunately, #18036 breaks this.


---

Comment by mantepse created at 2020-11-02 14:06:01

Changing status from needs_review to needs_work.


---

Comment by mantepse created at 2020-11-02 14:20:00

(and I have no idea currently how to fix this)


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by git created at 2021-05-31 19:28:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2021-05-31 19:29:58

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2021-06-01 01:16:04

I believe you can simplify

```diff
-            if (isinstance(obj, NumberFieldElement_quadratic) and
-                obj.parent() is GaussianField()):
+            if isinstance(obj, NumberFieldElement_gaussian):
```

I probably would also add a test that includes `SR(I)` (or `sqrt(-1)`) to make sure that alternative version yields what you want. Other than that, LGTM.


---

Comment by git created at 2021-06-01 06:21:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2021-06-01 06:22:18

Yes, you are right!  I copied these lines from the generic class `InterfaceInit`, so I applied your suggestion there, too.


---

Comment by git created at 2021-06-01 06:30:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2021-06-01 06:33:27

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2021-06-01 06:33:27

Thank you. LGTM.


---

Comment by vbraun created at 2021-06-07 21:40:24

Resolution: fixed
