# Issue 28410: conversion of Symbolic Ring to FriCAS Expression Integer

archive/issues_028410.json:
```json
{
    "body": "CC:  @fchapoton\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28647\n\n",
    "created_at": "2019-10-24T11:43:30Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "conversion of Symbolic Ring to FriCAS Expression Integer",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28410",
    "user": "@mantepse"
}
```
CC:  @fchapoton



Issue created by migration from https://trac.sagemath.org/ticket/28647





---

archive/issue_comments_401247.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2019-10-24T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401247",
    "user": "@mantepse"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_401248.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-10-24T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401248",
    "user": "@mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_401249.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-10-24T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401249",
    "user": "@mantepse"
}
```

New commits:



---

archive/issue_comments_401250.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to interfaces: optional.",
    "created_at": "2019-10-24T11:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401250",
    "user": "@mantepse"
}
```

Changing component from PLEASE CHANGE to interfaces: optional.



---

archive/issue_comments_401251.json:
```json
{
    "body": "Possible collision with #28641 which refers to the same ask.sagemath.org question.",
    "created_at": "2019-10-24T12:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401251",
    "user": "tmonteil"
}
```

Possible collision with #28641 which refers to the same ask.sagemath.org question.



---

archive/issue_comments_401252.json:
```json
{
    "body": "Replying to [comment:3 tmonteil]:\n> Possible collision with #28641 which refers to the same ask.sagemath.org question.\n\nYes, but the solutions are orthogonal to each other.  In other words: after applying this branch, #28641 solves a different problem.",
    "created_at": "2019-10-24T15:06:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401252",
    "user": "@mantepse"
}
```

Replying to [comment:3 tmonteil]:
> Possible collision with #28641 which refers to the same ask.sagemath.org question.

Yes, but the solutions are orthogonal to each other.  In other words: after applying this branch, #28641 solves a different problem.



---

archive/issue_comments_401253.json:
```json
{
    "body": "some failing doctests in src/sage/functions/generalized.py and src/sage/functions/exp_integral.py",
    "created_at": "2019-10-24T15:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401253",
    "user": "@fchapoton"
}
```

some failing doctests in src/sage/functions/generalized.py and src/sage/functions/exp_integral.py



---

archive/issue_comments_401254.json:
```json
{
    "body": "There are unfortunately more problems.  In particular, `fricas(I)` calls `FriCASConverter.pyobject(I, I)` (as it should).  But this now returns `I` instead of `%i`.",
    "created_at": "2019-10-25T10:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401254",
    "user": "@mantepse"
}
```

There are unfortunately more problems.  In particular, `fricas(I)` calls `FriCASConverter.pyobject(I, I)` (as it should).  But this now returns `I` instead of `%i`.



---

archive/issue_comments_401255.json:
```json
{
    "body": "I'm afraid my approach won't work, because FriCAS distinguishes between `Expression Integer` and `Expression Complex Integer`.\n\nPut differently, the complex unit `I` is not an element of `Expression Integer`, but would have to be expressed as `sqrt(-1)`.  I see the following options:\n\n1. rewrite `I` as `sqrt(-1)`,\n2. always use `Expression Complex Integer`,\n3. detect whether `I` appears and distinguish accordingly,\n4. somehow let FriCAS decide\n\nI tend towards option 1., but I am not sure at all.",
    "created_at": "2019-10-25T11:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401255",
    "user": "@mantepse"
}
```

I'm afraid my approach won't work, because FriCAS distinguishes between `Expression Integer` and `Expression Complex Integer`.

Put differently, the complex unit `I` is not an element of `Expression Integer`, but would have to be expressed as `sqrt(-1)`.  I see the following options:

1. rewrite `I` as `sqrt(-1)`,
2. always use `Expression Complex Integer`,
3. detect whether `I` appears and distinguish accordingly,
4. somehow let FriCAS decide

I tend towards option 1., but I am not sure at all.



---

archive/issue_comments_401256.json:
```json
{
    "body": "help appreciated",
    "created_at": "2019-10-28T15:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401256",
    "user": "@mantepse"
}
```

help appreciated



---

archive/issue_comments_401257.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-10-28T15:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401257",
    "user": "@mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_401258.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-16T14:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401258",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401259.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-11-16T14:40:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401259",
    "user": "@mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_401260.json:
```json
{
    "body": "I think I have to make an exception for the conversion of symbols, because otherwise `fricas.integrate(ex, x)` won't work anymore.",
    "created_at": "2019-11-16T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401260",
    "user": "@mantepse"
}
```

I think I have to make an exception for the conversion of symbols, because otherwise `fricas.integrate(ex, x)` won't work anymore.



---

archive/issue_comments_401261.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-11-16T14:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401261",
    "user": "@mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_401262.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-20T08:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401262",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401263.json:
```json
{
    "body": "Changing keywords from \"\" to \"FriCAS\".",
    "created_at": "2019-11-20T08:24:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401263",
    "user": "@mantepse"
}
```

Changing keywords from "" to "FriCAS".



---

archive/issue_comments_401264.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-20T08:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401264",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401265.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-11-20T08:40:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401265",
    "user": "@mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_401266.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-11-21T09:56:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401266",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401267.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401267",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_401268.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401268",
    "user": "@mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_401269.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-11-01T18:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401269",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_401270.json:
```json
{
    "body": "red branch => needs work",
    "created_at": "2020-11-01T18:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401270",
    "user": "@fchapoton"
}
```

red branch => needs work



---

archive/issue_comments_401271.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-01T19:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401271",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401272.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-01T21:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401272",
    "user": "@mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_401273.json:
```json
{
    "body": "Unfortunately, #18036 breaks this.",
    "created_at": "2020-11-02T14:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401273",
    "user": "@mantepse"
}
```

Unfortunately, #18036 breaks this.



---

archive/issue_comments_401274.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-11-02T14:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401274",
    "user": "@mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_401275.json:
```json
{
    "body": "(and I have no idea currently how to fix this)",
    "created_at": "2020-11-02T14:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401275",
    "user": "@mantepse"
}
```

(and I have no idea currently how to fix this)



---

archive/issue_comments_401276.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401276",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_401277.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-05-31T19:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401277",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401278.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-05-31T19:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401278",
    "user": "@mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_401279.json:
```json
{
    "body": "I believe you can simplify\n\n```diff\n-            if (isinstance(obj, NumberFieldElement_quadratic) and\n-                obj.parent() is GaussianField()):\n+            if isinstance(obj, NumberFieldElement_gaussian):\n```\n\nI probably would also add a test that includes `SR(I)` (or `sqrt(-1)`) to make sure that alternative version yields what you want. Other than that, LGTM.",
    "created_at": "2021-06-01T01:16:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401279",
    "user": "@tscrim"
}
```

I believe you can simplify

```diff
-            if (isinstance(obj, NumberFieldElement_quadratic) and
-                obj.parent() is GaussianField()):
+            if isinstance(obj, NumberFieldElement_gaussian):
```

I probably would also add a test that includes `SR(I)` (or `sqrt(-1)`) to make sure that alternative version yields what you want. Other than that, LGTM.



---

archive/issue_comments_401280.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-01T06:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401280",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401281.json:
```json
{
    "body": "Yes, you are right!  I copied these lines from the generic class `InterfaceInit`, so I applied your suggestion there, too.",
    "created_at": "2021-06-01T06:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401281",
    "user": "@mantepse"
}
```

Yes, you are right!  I copied these lines from the generic class `InterfaceInit`, so I applied your suggestion there, too.



---

archive/issue_comments_401282.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-01T06:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401282",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_401283.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-01T06:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401283",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_401284.json:
```json
{
    "body": "Thank you. LGTM.",
    "created_at": "2021-06-01T06:33:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401284",
    "user": "@tscrim"
}
```

Thank you. LGTM.



---

archive/issue_comments_401285.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-07T21:40:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28410",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28410#issuecomment-401285",
    "user": "@vbraun"
}
```

Resolution: fixed
