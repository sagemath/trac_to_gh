# Issue 33930: Fix docstring markup in sage/matroids, sage/geometry, sage/modules

Issue created by migration from https://trac.sagemath.org/ticket/34167

Original creator: klee

Original creation time: 2022-07-12 06:13:51

CC:  tscrim jhpalmieri


```
sage/matroids/graphic_matroid.py:325:1: RST214 Inline literal start-string without end-string.
sage/geometry/polyhedron/constructor.py:174:1: RST201 Block quote ends without a blank line; unexpected unindent.
sage/modules/tutorial_free_modules.py:3:1: RST303 Unknown directive type "MODULEAUTHOR".
sage/modules/tensor_operations.py:250:1: RST303 Unknown directive type "todo".
sage/modules/tensor_operations.py:327:1: RST215 Inline interpreted text or phrase reference start-string without end-string.
sage/modules/free_module.py:455:1: RST303 Unknown directive type "todo".
```



---

Comment by chapoton created at 2022-07-13 09:37:52

in this one, I could not fix the issue in geometry..
----
New commits:


---

Comment by jhpalmieri created at 2022-07-13 21:20:09

This could be related to #34168#comment:13: the title of the file is "Polyhedra", and this somehow leads to it flagging a line starting with "Polyhedra" as being an error. If you change the first line of the file like this:

```diff
diff --git a/src/sage/geometry/polyhedron/constructor.py b/src/sage/geometry/polyhedron/constructor.py
index 4606d979cf..4b705b371a 100644
--- a/src/sage/geometry/polyhedron/constructor.py
+++ b/src/sage/geometry/polyhedron/constructor.py
@@ -1,5 +1,5 @@
 r"""
-Polyhedra
+Constructing polyhedra
 
 In this module, a polyhedron is a convex (possibly unbounded) set in
 Euclidean space cut out by a finite set of linear inequalities and
```

the error will go away. I think this is a bug in the lexer/parser/flake8/whatever, and I would rather someone fix that, but this is a workaround.


---

Comment by mkoeppe created at 2022-07-14 14:16:33

Changing type from PLEASE CHANGE to defect.


---

Comment by mkoeppe created at 2022-07-14 14:16:33

Changing component from PLEASE CHANGE to documentation.


---

Comment by mkoeppe created at 2022-07-14 14:16:33

Changing priority from major to minor.


---

Comment by mkoeppe created at 2022-07-14 14:16:33

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-07-14 14:16:33

Let's defer this failure to a follow-up ticket


---

Comment by mkoeppe created at 2022-07-14 14:20:57


```
diff --git a/src/sage/modules/tutorial_free_modules.py b/src/sage/modules/tutorial_free_modules.py
index 0808fe0..88810b2 100644
--- a/src/sage/modules/tutorial_free_modules.py
+++ b/src/sage/modules/tutorial_free_modules.py
@@ -1,7 +1,7 @@
 r"""
 Tutorial: Using free modules and vector spaces
 
-.. MODULEAUTHOR:: Jason Bandlow
+AUTHOR: Jason Bandlow
 
 In this tutorial, we show how to construct and manipulate free modules
 and vector spaces and their elements.
```


`git grep MODULEAUTHOR` shows that it is used in a number of other files and is also documented in the developer guide.

Should we remove it from the developer guide?

Or should we add it to the directives known to the linter?


---

Comment by jhpalmieri created at 2022-07-14 16:13:15

I think we should:

- add `MODULEAUTHOR` to the list of known directives, and
- change `show_authors` to `True` so that the `MODULEAUTHOR` is actually displayed: its default is `False`, and it can be set on line 179 of `sage_docbuild/conf.py`:

```diff
diff --git a/src/sage_docbuild/conf.py b/src/sage_docbuild/conf.py
index c9b81a8ba7..5efcc9f86e 100644
--- a/src/sage_docbuild/conf.py
+++ b/src/sage_docbuild/conf.py
@@ -176,7 +176,7 @@ exclude_patterns = ['.build']
 
 # If true, sectionauthor and moduleauthor directives will be shown in the
 # output. They are ignored by default.
-#show_authors = False
+show_authors = True
 
 # Default lexer to use when highlighting code blocks, using the IPython
 # console lexers. 'ipycon' is the IPython console, which is what we want
```



---

Comment by jhpalmieri created at 2022-07-14 16:19:01

(The directive is mainly used in the thematic tutorials where `show_authors` is specifically set to `True`, but it's used a few other places as well.)


---

Comment by jhpalmieri created at 2022-07-14 22:47:20

The same passage in the Developer's guide mentions directives "image", "figure", and "autofunction". The last one is not used, but the others are. Do they need to be added?


---

Comment by jhpalmieri created at 2022-07-14 22:48:01

Last 10 new commits:


---

Comment by jhpalmieri created at 2022-07-14 22:48:37

(Adding to the list of directives requires adding #30448 as a dependency.)


---

Comment by mkoeppe created at 2022-07-14 23:29:12

Replying to [comment:9 jhpalmieri]:
> The same passage in the Developer's guide mentions directives "image", "figure", 

I think these two may be built in to the rst spec, so no need to add

> and "autofunction". The last one is not used, but the others are. Do they need to be added?

I guess autofunction would be good to add, for completeness of the sphinx directives


---

Comment by git created at 2022-07-15 00:47:10

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-07-15 00:47:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2022-07-15 00:52:32

Replying to [comment:13 mkoeppe]:
> I guess autofunction would be good to add, for completeness of the sphinx directives

Done. Note that I did not revert the change from `MODULEAUTHOR` to `AUTHOR` for Jason Bandlow.


---

Comment by klee created at 2022-07-15 09:30:14

LGTM. Thank you.


---

Comment by klee created at 2022-07-15 09:30:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-07-28 19:16:05

Merge failure on top of:

8d7c0022e2 Trac #34165: Fix docstring markup in sage/tests/book_stein_modform.py

07e1a716ad Trac #34162: Fix docstring markup in sage/doctest

3cfa5a1b95 Trac #34161: Fix docstring markup in sage/databases

411bb16ba0 Trac #34159: Fix docstring markup in sage/modular

1bc96cee2e Trac #34158: Fix docstring markup in sage/manifolds

87a05b5d35 Trac #34156: Fix docstring markup in sage/game_theory

af1bfa810c Trac #34153: pycodestyle cleanup in sage/geometry/hyperplane_arrangement/hyperplane.py

96ab5f3ffc Trac #34146: Modernize super in coding/

992333a3c7 Trac #34143: three-argument pow() on integers returns IntegerMod

84ea5a2927 Trac #34101: cutwidth_dyn use after free

7812ae01d9 Trac #34086: E231 in src/sage/graphs/strongly_regular_db.pyx - part 1

a9055ca510 Trac #34079: pycodestyle cleanup in 6 files of src/sage/graphs/

5ed3caeeb4 Trac #34078: pycodestyle cleanup in src/sage/graphs/graph_plot.py

785ba0960e Trac #34077: pycodestyle cleanup in src/sage/graphs/graph_input.py

691239d449 Trac #34073: pycodestyle cleanup in src/sage/graphs/graph_coloring.pyx

061241f24b Trac #34068: pycodestyle cleanup in src/sage/graphs/connectivity.pyx

65b834a993 Trac #33971: Height of a dynamical system is wrong

385b628ef7 Trac #22857: Using symbolic variables in domain 'positive' makes Sage crash

cc6a8fb370 Trac #10980: Make sure symbolic gridline values are okay

1a32d02790 Trac #34227: Compute the similarity class type of a given matrix; compute invariant subspace generating function from similarity class type

1f9fbb8fca Trac #34218: Implement longest_increasing_subsequence_number

d55f18bd80 Trac #34216: configure: Use --with-system-{gfortran,openssl,python3}=force on Cygwin

ffa1104f58 Trac #34214: Faster version of longest_increasing_subsequence_length

4c250eb283 Trac #34208: Remove package sip

e8caec9232 Trac #34200: Add importlib_metadata to Sphinx's dependencies

195b7578eb Trac #34189: Remove imports from sage.all and sage.rings.all in sage.rings

8117fe9e0f Trac #34187: Remove src/sage/__init__.py

99e0db84b0 Trac #34177: Update setuptools to 63.2.0

22e1027795 Trac #34176: update curl to version 7.84

68c736c3c9 Trac #33817: GH Actions: Add test of the modularized distributions

6b7bed7c35 Trac #32406: Make "./configure --enable-editable" the default

2c1e4a1a1b Trac #31568: Add commands "sage --lldb", "sage -t --lldb"

96b57ea0f5 Trac #31451: Faster version of longest_increasing_subsequences

991429de56 Trac #34115: tox.yml: Refactor using reusable workflows, update Linux platforms

05a53e3c45 Trac #33627: Remove sage-gdb-commands from src/bin

c17e6377ce Trac #22349: Deprecate sorting of Graph vertices and edges by default

c19c47fd63 Trac #34174: insufficient precision in scaling elliptic curves over number fields by units

aa8a4647f9 Trac #34172: Fix docstring markup in sage/groups and sage/misc

4142099591 Trac #34168: Fix docstring markup in sage/categories

e9be1728bb Trac #34166: Fix docstring markup in sage/tests except sage/tests/book_stein_modform.py

6e41b53b09 Trac #34164: Fix docstring markup in sage/plot and sage/graphs

b03229e112 Trac #34163: Fix docstring markup in sage/interfaces

46849b8d41 Trac #34160: Fix docstring markup in sage/schemes

984137bbb8 Trac #34155: OpenSSL 3.0.5 security update

ced8f29e11 Trac #34151: get rid of Oops messages in quadratic forms

b0456638af Trac #34149: make documentation building compatible with sphinx 5

07d4b909f0 Trac #34105: ZeroDivisionError while reducing a polynomial w.r.t. the zero ideal

db21903ace Trac #33798: Implement the Links-Gould polynomial invariant for links

04ad7f9577 Trac #33705: "make doc-clean" should remove inventory, doctrees

977e691dc1 Trac #33636: replace loadable_module_extension() by importlib.machinery.EXTENSION_SUFFIXES

c744d7c09c Trac #29097: build/make/Makefile.in: Rename make targets SPKG-clean to SPKG-uninstall

8312ee1e90 Trac #33530: Upgrade ipython to 8.x

067a66c7e9 Trac #33428: prompt_toolkit 3.0.25+ breaks Ctrl-C

79ed9e5ddb Trac #33160: update Singular to 4.3.1

4cc4817aeb Trac #32088: gfan testsuite hangs on 32bit

10247d5f2a Trac #31049: "setup.py develop" rewrites the installed sage-version.sh as if it is a Python script

7f7149489c Updated [SageMath](SageMath) version to 9.7.beta6



merge was not clean: conflicts in src/sage/matroids/graphic_matroid.py


---

Comment by vbraun created at 2022-07-28 19:16:05

Changing status from positive_review to needs_work.


---

Comment by jhpalmieri created at 2022-07-28 22:23:13

I would rather wait for the next beta to deal with this, rather than try to figure out where the merge conflict is.


---

Comment by klee created at 2022-07-28 23:46:13

Replying to [comment:19 jhpalmieri]:
> I would rather wait for the next beta to deal with this, rather than try to figure out where the merge conflict is.

I agree.

On the other hand, I did try to find the conflicting ticket and found that it is #22349. It is tedious to do this manually. It would be useful if we have the command `git trac merge 31049 32088 ... 34165` that stops at the ticket that has a merge conflict. Moreover the merge conflict message from the release manager could be so that we can just copy and paste the command. But deciding to actually put the found ticket as a dependency seems another matter though.


---

Comment by jhpalmieri created at 2022-07-29 00:14:12

If that's the conflict, the patch is

```diff
diff --git a/src/sage/matroids/graphic_matroid.py b/src/sage/matroids/graphic_matroid.py
index f82a2145e9b..bd79b89e94f 100644
--- a/src/sage/matroids/graphic_matroid.py
+++ b/src/sage/matroids/graphic_matroid.py
@@ -344,7 +344,7 @@ class GraphicMatroid(Matroid):
              frozenset({4})]
         """
         star_list = []
-        for v in self._G.vertices():
+        for v in self._G.vertices(sort=False):
             star = [l for (_, _, l) in self._G.edges_incident(v)]
             star_list.append(frozenset(star))
         return frozenset(star_list)
```



---

Comment by jhpalmieri created at 2022-07-29 00:14:52

(I'm actually surprised that #22349 hasn't caused more problems, since it's a bit of a patch bomb.)


---

Comment by mkoeppe created at 2022-08-01 22:08:13

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-08-01 22:08:13

New commits:


---

Comment by mkoeppe created at 2022-08-01 22:09:11

Changing priority from minor to major.


---

Comment by klee created at 2022-08-01 23:11:11

Changing status from needs_review to positive_review.


---

Comment by klee created at 2022-08-01 23:11:11

Okay.


---

Comment by mkoeppe created at 2022-08-04 23:18:28

Changing priority from major to critical.


---

Comment by mkoeppe created at 2022-08-04 23:18:28

dependency of a "critical" ticket


---

Comment by vbraun created at 2022-08-06 07:44:09

Resolution: fixed
