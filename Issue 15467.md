# Issue 15467: Stupid waste of time in graphs 1

archive/issues_015467.json:
```json
{
    "body": "CC:  azi\n\n............\n\nThe point is that MY computations are never long because of the add/remove edge functions. I should pay more attention `T_T`\n\nBefore\n\n```\nsage: g = graphs.RandomGNP(1500,.4)\nsage: edges = g.edges(labels=False)\nsage: %time Graph(edges)\nCPU times: user 2.50 s, sys: 0.03 s, total: 2.52 s\nWall time: 2.55 s\nGraph on 1500 vertices\nsage: h = Graph()\nsage: %time h.add_edges(edges)\nCPU times: user 4.90 s, sys: 0.02 s, total: 4.92 s\nWall time: 4.93 s\n```\n\nAfter\n\n```\nsage: g = graphs.RandomGNP(1500,.4)\nsage: edges = g.edges(labels=False)\nsage: %time Graph(edges)\nCPU times: user 2.12 s, sys: 0.02 s, total: 2.14 s\nWall time: 2.16 s\nGraph on 1500 vertices\nsage: h = Graph()\nsage: %time h.add_edges(edges)\nCPU times: user 1.48 s, sys: 0.02 s, total: 1.50 s\nWall time: 1.52 s\n```\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/15704\n\n",
    "closed_at": "2014-05-12T11:34:42Z",
    "created_at": "2014-01-21T18:49:01Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Stupid waste of time in graphs 1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15467",
    "user": "https://github.com/nathanncohen"
}
```
CC:  azi

............

The point is that MY computations are never long because of the add/remove edge functions. I should pay more attention `T_T`

Before

```
sage: g = graphs.RandomGNP(1500,.4)
sage: edges = g.edges(labels=False)
sage: %time Graph(edges)
CPU times: user 2.50 s, sys: 0.03 s, total: 2.52 s
Wall time: 2.55 s
Graph on 1500 vertices
sage: h = Graph()
sage: %time h.add_edges(edges)
CPU times: user 4.90 s, sys: 0.02 s, total: 4.92 s
Wall time: 4.93 s
```

After

```
sage: g = graphs.RandomGNP(1500,.4)
sage: edges = g.edges(labels=False)
sage: %time Graph(edges)
CPU times: user 2.12 s, sys: 0.02 s, total: 2.14 s
Wall time: 2.16 s
Graph on 1500 vertices
sage: h = Graph()
sage: %time h.add_edges(edges)
CPU times: user 1.48 s, sys: 0.02 s, total: 1.50 s
Wall time: 1.52 s
```

Nathann

Issue created by migration from https://trac.sagemath.org/ticket/15704





---

archive/issue_comments_199551.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-21T18:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199551",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_199552.json:
```json
{
    "body": "This is the kind of patches that breaks code everywhere in Sage. We better wait for the patchbot to say it passes tests before getting it in.\n\nNathann",
    "created_at": "2014-01-21T18:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199552",
    "user": "https://github.com/nathanncohen"
}
```

This is the kind of patches that breaks code everywhere in Sage. We better wait for the patchbot to say it passes tests before getting it in.

Nathann



---

archive/issue_comments_199553.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-21T18:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199553",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199554.json:
```json
{
    "body": "I think you should have something documenting what happens with the old \"bad\" behavior.  I assume it raises a well-formed error that tells people exactly what to do?\n\nAlso, it's not clear from the diff whether there are now no examples of adding edges with 2-tuples, which I assume is still supported.",
    "created_at": "2014-01-21T20:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199554",
    "user": "https://github.com/kcrisman"
}
```

I think you should have something documenting what happens with the old "bad" behavior.  I assume it raises a well-formed error that tells people exactly what to do?

Also, it's not clear from the diff whether there are now no examples of adding edges with 2-tuples, which I assume is still supported.



---

archive/issue_comments_199555.json:
```json
{
    "body": "Yo !\n\n> I think you should have something documenting what happens with the old \"bad\" behavior.  I assume it raises a well-formed error that tells people exactly what to do?\n\n\nWell, it raises the same error as `u,v=1`. To be honest I was afraid of adding a try/catch around the loop for the exception is a `ValueError`, and I don't it to catch a `ValueError` in `_backend.add_edge` if there is one.\n\n```\nsage: g = Graph()                \nsage: g.add_edges([(0,1),(0,1,1)])\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-4-edffa551e119> in <module>()\n----> 1 g.add_edges([(Integer(0),Integer(1)),(Integer(0),Integer(1),Integer(1))])\n\n/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in add_edges(self, edges)\n   8970         else:\n   8971             self._backend.add_edge(e0[0], e0[1], None, self._directed)\n-> 8972             for u,v in it:\n   8973                 self._backend.add_edge(u, v, None, self._directed)\n   8974 \n\nValueError: too many values to unpack\n```\n\nI hope it will be explicit enough for the users, and that they will notice they feed the loop with heterogeneous data.\n\nAs for testing `add_edges()` with only pairs, not only it is still supported but I think most calls to this function only feed pairs `:-P`\n\nI added a commit.\n\nNathann",
    "created_at": "2014-01-22T08:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199555",
    "user": "https://github.com/nathanncohen"
}
```

Yo !

> I think you should have something documenting what happens with the old "bad" behavior.  I assume it raises a well-formed error that tells people exactly what to do?


Well, it raises the same error as `u,v=1`. To be honest I was afraid of adding a try/catch around the loop for the exception is a `ValueError`, and I don't it to catch a `ValueError` in `_backend.add_edge` if there is one.

```
sage: g = Graph()                
sage: g.add_edges([(0,1),(0,1,1)])
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-4-edffa551e119> in <module>()
----> 1 g.add_edges([(Integer(0),Integer(1)),(Integer(0),Integer(1),Integer(1))])

/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in add_edges(self, edges)
   8970         else:
   8971             self._backend.add_edge(e0[0], e0[1], None, self._directed)
-> 8972             for u,v in it:
   8973                 self._backend.add_edge(u, v, None, self._directed)
   8974 

ValueError: too many values to unpack
```

I hope it will be explicit enough for the users, and that they will notice they feed the loop with heterogeneous data.

As for testing `add_edges()` with only pairs, not only it is still supported but I think most calls to this function only feed pairs `:-P`

I added a commit.

Nathann



---

archive/issue_comments_199556.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-22T08:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199556",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199557.json:
```json
{
    "body": "A commit to haul what we sow.\n\nNathann",
    "created_at": "2014-01-22T10:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199557",
    "user": "https://github.com/nathanncohen"
}
```

A commit to haul what we sow.

Nathann



---

archive/issue_comments_199558.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-22T10:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199558",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199559.json:
```json
{
    "body": "OOps. Perhaps I should change the commit message `:-PPPP`",
    "created_at": "2014-01-22T10:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199559",
    "user": "https://github.com/nathanncohen"
}
```

OOps. Perhaps I should change the commit message `:-PPPP`



---

archive/issue_comments_199560.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-22T10:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199560",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_046090.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15467#event-46090"
}
```



---

archive/issue_comments_199561.json:
```json
{
    "body": "Hi Nathann,\n\nmy branch: u/vdelecroix/15704\n\nI simplified the `add_edges`. That way we can use the old syntax and is not much slower (as calling `len` is very cheap). What do you think?",
    "created_at": "2014-04-22T14:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199561",
    "user": "https://github.com/videlec"
}
```

Hi Nathann,

my branch: u/vdelecroix/15704

I simplified the `add_edges`. That way we can use the old syntax and is not much slower (as calling `len` is very cheap). What do you think?



---

archive/issue_comments_199562.json:
```json
{
    "body": "Can you provide timings for this change ? If it is not that bad it is good to have indeed.\n\nNathann",
    "created_at": "2014-04-23T13:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199562",
    "user": "https://github.com/nathanncohen"
}
```

Can you provide timings for this change ? If it is not that bad it is good to have indeed.

Nathann



---

archive/issue_comments_199563.json:
```json
{
    "body": "Replying to [comment:14 ncohen]:\n> Can you provide timings for this change ? If it is not that bad it is good to have indeed.\n\n\nHere they are. Your version\n\n```\nsage: g = graphs.RandomGNP(1500,.4)\nsage: edges = g.edges(labels=False)\nsage: h = Graph()\nsage: %time h.add_edges(edges)\nCPU times: user 2.21 s, sys: 32 ms, total: 2.24 s\nWall time: 2.23 s\n```\nmine\n\n```\nsage: g = graphs.RandomGNP(1500,.4)\nsage: edges = g.edges(labels=False)\nsage: h = Graph()\nsage: %time h.add_edges(edges)\nCPU times: user 2.48 s, sys: 32 ms, total: 2.51 s\nWall time: 2.51 s\n```\n\n(Be careful the branch is not yet merged with 6.2.rc0 and `sage -b` is horribly long)",
    "created_at": "2014-04-23T15:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199563",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:14 ncohen]:
> Can you provide timings for this change ? If it is not that bad it is good to have indeed.


Here they are. Your version

```
sage: g = graphs.RandomGNP(1500,.4)
sage: edges = g.edges(labels=False)
sage: h = Graph()
sage: %time h.add_edges(edges)
CPU times: user 2.21 s, sys: 32 ms, total: 2.24 s
Wall time: 2.23 s
```
mine

```
sage: g = graphs.RandomGNP(1500,.4)
sage: edges = g.edges(labels=False)
sage: h = Graph()
sage: %time h.add_edges(edges)
CPU times: user 2.48 s, sys: 32 ms, total: 2.51 s
Wall time: 2.51 s
```

(Be careful the branch is not yet merged with 6.2.rc0 and `sage -b` is horribly long)



---

archive/issue_comments_199564.json:
```json
{
    "body": "Hmmm.... 10%... I'd vote for the first version. What do you think ? Yours handles more case, but it would mean that input is a bit messy ?...\n\nNathann",
    "created_at": "2014-04-23T15:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199564",
    "user": "https://github.com/nathanncohen"
}
```

Hmmm.... 10%... I'd vote for the first version. What do you think ? Yours handles more case, but it would mean that input is a bit messy ?...

Nathann



---

archive/issue_comments_199565.json:
```json
{
    "body": "Replying to [comment:16 ncohen]:\n> Hmmm.... 10%... I'd vote for the first version. What do you think ? Yours handles more case, but it would mean that input is a bit messy ?...\n\n\n   - + 10% is a lot\n   - - the messy input was in the documentation before you removed it\n\nThe main question: is this function critical? Is there any piece of code that uses it intensively?",
    "created_at": "2014-04-23T15:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199565",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:16 ncohen]:
> Hmmm.... 10%... I'd vote for the first version. What do you think ? Yours handles more case, but it would mean that input is a bit messy ?...


   - + 10% is a lot
   - - the messy input was in the documentation before you removed it

The main question: is this function critical? Is there any piece of code that uses it intensively?



---

archive/issue_comments_199566.json:
```json
{
    "body": "Well, I began to write those patches because Jernej was not able to build a Graph with Sage .... I do not think that it really is the bottleneck in any code, but if the error message is clear, I don't think anybody can really complain that Sage refuses inputs like `G.add_edges([(0,1,'l'), (0,1)])`.\n\nSo well. I'd go for the most efficient way to do it, given that I do not see this being a real problem for anybody.... I don't like to know that everybody loses 10% to prevent several users from cleaning their input a bit `:-P`\n\nNathann",
    "created_at": "2014-04-23T15:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199566",
    "user": "https://github.com/nathanncohen"
}
```

Well, I began to write those patches because Jernej was not able to build a Graph with Sage .... I do not think that it really is the bottleneck in any code, but if the error message is clear, I don't think anybody can really complain that Sage refuses inputs like `G.add_edges([(0,1,'l'), (0,1)])`.

So well. I'd go for the most efficient way to do it, given that I do not see this being a real problem for anybody.... I don't like to know that everybody loses 10% to prevent several users from cleaning their input a bit `:-P`

Nathann



---

archive/issue_comments_199567.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-23T15:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199567",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199568.json:
```json
{
    "body": "Then leeeeet's go!\n\nVincent",
    "created_at": "2014-04-23T15:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199568",
    "user": "https://github.com/videlec"
}
```

Then leeeeet's go!

Vincent



---

archive/issue_comments_199569.json:
```json
{
    "body": "Thaaaaaanks !\n\nNathann",
    "created_at": "2014-04-23T15:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199569",
    "user": "https://github.com/nathanncohen"
}
```

Thaaaaaanks !

Nathann



---

archive/issue_events_046091.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15467#event-46091"
}
```



---

archive/issue_events_046092.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15467#event-46092"
}
```



---

archive/issue_comments_199570.json:
```json
{
    "body": "Reviewer name",
    "created_at": "2014-05-07T15:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199570",
    "user": "https://github.com/vbraun"
}
```

Reviewer name



---

archive/issue_comments_199571.json:
```json
{
    "body": "doctest failures after merge",
    "created_at": "2014-05-08T09:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199571",
    "user": "https://github.com/vbraun"
}
```

doctest failures after merge



---

archive/issue_comments_199572.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-05-08T09:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199572",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_199573.json:
```json
{
    "body": "turns out some combinat code was feeding the function with non-uniform input.\n\nTesting the whole Sage code... It would be cool if I could set up a patchbot on my office's computer, really `:-/`\n\nNathann",
    "created_at": "2014-05-08T09:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199573",
    "user": "https://github.com/nathanncohen"
}
```

turns out some combinat code was feeding the function with non-uniform input.

Testing the whole Sage code... It would be cool if I could set up a patchbot on my office's computer, really `:-/`

Nathann



---

archive/issue_comments_199574.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-08T10:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199574",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199575.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-05-08T10:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199575",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_199576.json:
```json
{
    "body": "Passes all long tests.",
    "created_at": "2014-05-08T10:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199576",
    "user": "https://github.com/nathanncohen"
}
```

Passes all long tests.



---

archive/issue_events_046093.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-12T11:34:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/15467#event-46093"
}
```



---

archive/issue_comments_199577.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-12T11:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199577",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
