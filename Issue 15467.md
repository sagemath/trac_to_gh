# Issue 15467: Stupid waste of time in graphs 1

archive/issues_015467.json:
```json
{
    "body": "CC:  azi\n\n............\n\nThe point is that MY computations are never long because of the add/remove edge functions. I should pay more attention `T_T`\n\nBefore\n\n```\nsage: g = graphs.RandomGNP(1500,.4)\nsage: edges = g.edges(labels=False)\nsage: %time Graph(edges)\nCPU times: user 2.50 s, sys: 0.03 s, total: 2.52 s\nWall time: 2.55 s\nGraph on 1500 vertices\nsage: h = Graph()\nsage: %time h.add_edges(edges)\nCPU times: user 4.90 s, sys: 0.02 s, total: 4.92 s\nWall time: 4.93 s\n```\n\n\nAfter\n\n```\nsage: g = graphs.RandomGNP(1500,.4)\nsage: edges = g.edges(labels=False)\nsage: %time Graph(edges)\nCPU times: user 2.12 s, sys: 0.02 s, total: 2.14 s\nWall time: 2.16 s\nGraph on 1500 vertices\nsage: h = Graph()\nsage: %time h.add_edges(edges)\nCPU times: user 1.48 s, sys: 0.02 s, total: 1.50 s\nWall time: 1.52 s\n```\n\n\nNathann\n\nIssue created by migration from https://trac.sagemath.org/ticket/15704\n\n",
    "created_at": "2014-01-21T18:49:01Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "Stupid waste of time in graphs 1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15467",
    "user": "@nathanncohen"
}
```
CC:  azi

............

The point is that MY computations are never long because of the add/remove edge functions. I should pay more attention `T_T`

Before

```
sage: g = graphs.RandomGNP(1500,.4)
sage: edges = g.edges(labels=False)
sage: %time Graph(edges)
CPU times: user 2.50 s, sys: 0.03 s, total: 2.52 s
Wall time: 2.55 s
Graph on 1500 vertices
sage: h = Graph()
sage: %time h.add_edges(edges)
CPU times: user 4.90 s, sys: 0.02 s, total: 4.92 s
Wall time: 4.93 s
```


After

```
sage: g = graphs.RandomGNP(1500,.4)
sage: edges = g.edges(labels=False)
sage: %time Graph(edges)
CPU times: user 2.12 s, sys: 0.02 s, total: 2.14 s
Wall time: 2.16 s
Graph on 1500 vertices
sage: h = Graph()
sage: %time h.add_edges(edges)
CPU times: user 1.48 s, sys: 0.02 s, total: 1.50 s
Wall time: 1.52 s
```


Nathann

Issue created by migration from https://trac.sagemath.org/ticket/15704





---

archive/issue_comments_199821.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-21T18:49:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199821",
    "user": "@nathanncohen"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_199822.json:
```json
{
    "body": "This is the kind of patches that breaks code everywhere in Sage. We better wait for the patchbot to say it passes tests before getting it in.\n\nNathann",
    "created_at": "2014-01-21T18:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199822",
    "user": "@nathanncohen"
}
```

This is the kind of patches that breaks code everywhere in Sage. We better wait for the patchbot to say it passes tests before getting it in.

Nathann



---

archive/issue_comments_199823.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-21T18:59:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199823",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199824.json:
```json
{
    "body": "I think you should have something documenting what happens with the old \"bad\" behavior.  I assume it raises a well-formed error that tells people exactly what to do?\n\nAlso, it's not clear from the diff whether there are now no examples of adding edges with 2-tuples, which I assume is still supported.",
    "created_at": "2014-01-21T20:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199824",
    "user": "@kcrisman"
}
```

I think you should have something documenting what happens with the old "bad" behavior.  I assume it raises a well-formed error that tells people exactly what to do?

Also, it's not clear from the diff whether there are now no examples of adding edges with 2-tuples, which I assume is still supported.



---

archive/issue_comments_199825.json:
```json
{
    "body": "Yo !\n\n> I think you should have something documenting what happens with the old \"bad\" behavior.  I assume it raises a well-formed error that tells people exactly what to do?\n\nWell, it raises the same error as `u,v=1`. To be honest I was afraid of adding a try/catch around the loop for the exception is a `ValueError`, and I don't it to catch a `ValueError` in `_backend.add_edge` if there is one.\n\n\n```\nsage: g = Graph()                \nsage: g.add_edges([(0,1),(0,1,1)])\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-4-edffa551e119> in <module>()\n----> 1 g.add_edges([(Integer(0),Integer(1)),(Integer(0),Integer(1),Integer(1))])\n\n/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in add_edges(self, edges)\n   8970         else:\n   8971             self._backend.add_edge(e0[0], e0[1], None, self._directed)\n-> 8972             for u,v in it:\n   8973                 self._backend.add_edge(u, v, None, self._directed)\n   8974 \n\nValueError: too many values to unpack\n```\n\n\nI hope it will be explicit enough for the users, and that they will notice they feed the loop with heterogeneous data.\n\nAs for testing `add_edges()` with only pairs, not only it is still supported but I think most calls to this function only feed pairs `:-P`\n\nI added a commit.\n\nNathann",
    "created_at": "2014-01-22T08:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199825",
    "user": "@nathanncohen"
}
```

Yo !

> I think you should have something documenting what happens with the old "bad" behavior.  I assume it raises a well-formed error that tells people exactly what to do?

Well, it raises the same error as `u,v=1`. To be honest I was afraid of adding a try/catch around the loop for the exception is a `ValueError`, and I don't it to catch a `ValueError` in `_backend.add_edge` if there is one.


```
sage: g = Graph()                
sage: g.add_edges([(0,1),(0,1,1)])
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-4-edffa551e119> in <module>()
----> 1 g.add_edges([(Integer(0),Integer(1)),(Integer(0),Integer(1),Integer(1))])

/home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/graphs/generic_graph.pyc in add_edges(self, edges)
   8970         else:
   8971             self._backend.add_edge(e0[0], e0[1], None, self._directed)
-> 8972             for u,v in it:
   8973                 self._backend.add_edge(u, v, None, self._directed)
   8974 

ValueError: too many values to unpack
```


I hope it will be explicit enough for the users, and that they will notice they feed the loop with heterogeneous data.

As for testing `add_edges()` with only pairs, not only it is still supported but I think most calls to this function only feed pairs `:-P`

I added a commit.

Nathann



---

archive/issue_comments_199826.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-22T08:36:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199826",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199827.json:
```json
{
    "body": "A commit to haul what we sow.\n\nNathann",
    "created_at": "2014-01-22T10:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199827",
    "user": "@nathanncohen"
}
```

A commit to haul what we sow.

Nathann



---

archive/issue_comments_199828.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-22T10:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199828",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199829.json:
```json
{
    "body": "OOps. Perhaps I should change the commit message `:-PPPP`",
    "created_at": "2014-01-22T10:28:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199829",
    "user": "@nathanncohen"
}
```

OOps. Perhaps I should change the commit message `:-PPPP`



---

archive/issue_comments_199830.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-22T10:29:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199830",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199831.json:
```json
{
    "body": "Hi Nathann,\n\nmy branch: u/vdelecroix/15704\n\nI simplified the `add_edges`. That way we can use the old syntax and is not much slower (as calling `len` is very cheap). What do you think?",
    "created_at": "2014-04-22T14:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199831",
    "user": "@videlec"
}
```

Hi Nathann,

my branch: u/vdelecroix/15704

I simplified the `add_edges`. That way we can use the old syntax and is not much slower (as calling `len` is very cheap). What do you think?



---

archive/issue_comments_199832.json:
```json
{
    "body": "Can you provide timings for this change ? If it is not that bad it is good to have indeed.\n\nNathann",
    "created_at": "2014-04-23T13:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199832",
    "user": "@nathanncohen"
}
```

Can you provide timings for this change ? If it is not that bad it is good to have indeed.

Nathann



---

archive/issue_comments_199833.json:
```json
{
    "body": "Replying to [comment:14 ncohen]:\n> Can you provide timings for this change ? If it is not that bad it is good to have indeed.\n\nHere they are. Your version\n\n```\nsage: g = graphs.RandomGNP(1500,.4)\nsage: edges = g.edges(labels=False)\nsage: h = Graph()\nsage: %time h.add_edges(edges)\nCPU times: user 2.21 s, sys: 32 ms, total: 2.24 s\nWall time: 2.23 s\n```\n\nmine\n\n```\nsage: g = graphs.RandomGNP(1500,.4)\nsage: edges = g.edges(labels=False)\nsage: h = Graph()\nsage: %time h.add_edges(edges)\nCPU times: user 2.48 s, sys: 32 ms, total: 2.51 s\nWall time: 2.51 s\n```\n\n\n(Be careful the branch is not yet merged with 6.2.rc0 and `sage -b` is horribly long)",
    "created_at": "2014-04-23T15:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199833",
    "user": "@videlec"
}
```

Replying to [comment:14 ncohen]:
> Can you provide timings for this change ? If it is not that bad it is good to have indeed.

Here they are. Your version

```
sage: g = graphs.RandomGNP(1500,.4)
sage: edges = g.edges(labels=False)
sage: h = Graph()
sage: %time h.add_edges(edges)
CPU times: user 2.21 s, sys: 32 ms, total: 2.24 s
Wall time: 2.23 s
```

mine

```
sage: g = graphs.RandomGNP(1500,.4)
sage: edges = g.edges(labels=False)
sage: h = Graph()
sage: %time h.add_edges(edges)
CPU times: user 2.48 s, sys: 32 ms, total: 2.51 s
Wall time: 2.51 s
```


(Be careful the branch is not yet merged with 6.2.rc0 and `sage -b` is horribly long)



---

archive/issue_comments_199834.json:
```json
{
    "body": "Hmmm.... 10%... I'd vote for the first version. What do you think ? Yours handles more case, but it would mean that input is a bit messy ?...\n\nNathann",
    "created_at": "2014-04-23T15:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199834",
    "user": "@nathanncohen"
}
```

Hmmm.... 10%... I'd vote for the first version. What do you think ? Yours handles more case, but it would mean that input is a bit messy ?...

Nathann



---

archive/issue_comments_199835.json:
```json
{
    "body": "Replying to [comment:16 ncohen]:\n> Hmmm.... 10%... I'd vote for the first version. What do you think ? Yours handles more case, but it would mean that input is a bit messy ?...\n\n- + 10% is a lot\n- - the messy input was in the documentation before you removed it\n\nThe main question: is this function critical? Is there any piece of code that uses it intensively?",
    "created_at": "2014-04-23T15:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199835",
    "user": "@videlec"
}
```

Replying to [comment:16 ncohen]:
> Hmmm.... 10%... I'd vote for the first version. What do you think ? Yours handles more case, but it would mean that input is a bit messy ?...

- + 10% is a lot
- - the messy input was in the documentation before you removed it

The main question: is this function critical? Is there any piece of code that uses it intensively?



---

archive/issue_comments_199836.json:
```json
{
    "body": "Well, I began to write those patches because Jernej was not able to build a Graph with Sage .... I do not think that it really is the bottleneck in any code, but if the error message is clear, I don't think anybody can really complain that Sage refuses inputs like `G.add_edges([(0,1,'l'), (0,1)])`.\n\nSo well. I'd go for the most efficient way to do it, given that I do not see this being a real problem for anybody.... I don't like to know that everybody loses 10% to prevent several users from cleaning their input a bit `:-P`\n\nNathann",
    "created_at": "2014-04-23T15:53:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199836",
    "user": "@nathanncohen"
}
```

Well, I began to write those patches because Jernej was not able to build a Graph with Sage .... I do not think that it really is the bottleneck in any code, but if the error message is clear, I don't think anybody can really complain that Sage refuses inputs like `G.add_edges([(0,1,'l'), (0,1)])`.

So well. I'd go for the most efficient way to do it, given that I do not see this being a real problem for anybody.... I don't like to know that everybody loses 10% to prevent several users from cleaning their input a bit `:-P`

Nathann



---

archive/issue_comments_199837.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-04-23T15:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199837",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199838.json:
```json
{
    "body": "Then leeeeet's go!\n\nVincent",
    "created_at": "2014-04-23T15:56:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199838",
    "user": "@videlec"
}
```

Then leeeeet's go!

Vincent



---

archive/issue_comments_199839.json:
```json
{
    "body": "Thaaaaaanks !\n\nNathann",
    "created_at": "2014-04-23T15:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199839",
    "user": "@nathanncohen"
}
```

Thaaaaaanks !

Nathann



---

archive/issue_comments_199840.json:
```json
{
    "body": "Reviewer name",
    "created_at": "2014-05-07T15:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199840",
    "user": "@vbraun"
}
```

Reviewer name



---

archive/issue_comments_199841.json:
```json
{
    "body": "doctest failures after merge",
    "created_at": "2014-05-08T09:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199841",
    "user": "@vbraun"
}
```

doctest failures after merge



---

archive/issue_comments_199842.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-05-08T09:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199842",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_199843.json:
```json
{
    "body": "turns out some combinat code was feeding the function with non-uniform input.\n\nTesting the whole Sage code... It would be cool if I could set up a patchbot on my office's computer, really `:-/`\n\nNathann",
    "created_at": "2014-05-08T09:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199843",
    "user": "@nathanncohen"
}
```

turns out some combinat code was feeding the function with non-uniform input.

Testing the whole Sage code... It would be cool if I could set up a patchbot on my office's computer, really `:-/`

Nathann



---

archive/issue_comments_199844.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-08T10:03:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199844",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199845.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-05-08T10:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199845",
    "user": "@nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_199846.json:
```json
{
    "body": "Passes all long tests.",
    "created_at": "2014-05-08T10:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199846",
    "user": "@nathanncohen"
}
```

Passes all long tests.



---

archive/issue_comments_199847.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-12T11:34:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15467",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15467#issuecomment-199847",
    "user": "@vbraun"
}
```

Resolution: fixed
