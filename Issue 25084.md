# Issue 25084: coxeter3 spkg-install: sed -i is not portable

Issue created by migration from https://trac.sagemath.org/ticket/25321

Original creator: jhpalmieri

Original creation time: 2018-05-09 23:21:58

CC:  dimpase embray jhpalmieri slelievre vbraun was tscrim

In `build/pkgs/coxeter3/spkg-install`, the line

```
sed -i "s|@SAGE_LOCAL@|$SAGE_LOCAL|g" directories.h
```

does not work on OS X because `sed -i` is not portable. (It prints an error and continues, and it does not change the file `directories.h`.) On OS X, the following works:

```
sed -e "s|@SAGE_LOCAL@|$SAGE_LOCAL|g" -i '' directories.h
```

but I'm not sure this works with GNU sed.


---

Comment by jhpalmieri created at 2018-05-09 23:24:27

See https://stackoverflow.com/questions/5694228/sed-in-place-flag-that-works-both-on-mac-bsd-and-linux for some information (perhaps accurate?) about `sed` on BSD/OSX vs. GNU/Linux.


---

Comment by slelievre created at 2018-07-11 11:23:59

Does someone know a portable invocation of sed that would work here?
Otherwise, could we detect the OS, and use an appropriate invocation?


---

Comment by slelievre created at 2018-07-11 11:23:59

Changing keywords from "" to "coxeter3, sed, macOS".


---

Comment by embray created at 2018-07-11 11:55:30

Incredible...

Use Perl instead?


---

Comment by vbraun created at 2018-07-11 14:10:34

The stackoverflow link explains how to do it.


---

Comment by tscrim created at 2018-07-11 15:24:00

Let me know when you send a PR, and I will merge it.


---

Comment by jhpalmieri created at 2018-07-11 17:18:27

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2018-07-11 17:18:27

This works on OS X. I don't know about linux or cygwin.
----
New commits:


---

Comment by jhpalmieri created at 2018-07-11 17:50:26

To check, run `./sage -i -s coxeter3` and then see if the file `local/var/tmp/sage/build/coxeter3-.../src/directories.h` contains ``@`SAGE_LOCAL`@`` or actual paths. It is supposed to contain paths.


---

Comment by slelievre created at 2018-07-11 21:59:47

Replying to [comment:1 jhpalmieri]:
> See https://stackoverflow.com/questions/5694228/sed-in-place-flag-that-works-both-on-mac-bsd-and-linux
> for some information (perhaps accurate?) about `sed` on BSD/OSX vs. GNU/Linux.

The [answer by kine](https://stackoverflow.com/a/22084103) to that
StackOverflow question creates an extra file that then needs to be deleted.

The [answer by nwinkler](https://stackoverflow.com/a/51060063) there
might be better, but it has had no upvotes at StackOverflow.


---

Comment by jhpalmieri created at 2018-07-11 22:45:19

The extra file is in a temporary build directory, so unless you use the `-s` flag when installing, who cares? And if you do use the `-s` flag, you probably know what you're doing.


---

Comment by jhpalmieri created at 2018-09-04 21:29:36

Ping?


---

Comment by dimpase created at 2018-09-04 22:36:47

LGTM


---

Comment by dimpase created at 2018-09-04 22:36:59

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2018-09-04 22:44:51

Replying to [comment:5 tscrim]:
> Let me know when you send a PR, and I will merge it.

This is a change to the `spkg-install` file, not to the actual coxeter3 package. So no PR to merge.


---

Comment by vbraun created at 2018-09-06 07:11:44

Resolution: fixed
