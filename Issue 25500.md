# Issue 25500: Move LaurentPolynomialRing to a new-style parent and some optimizations

Issue created by migration from https://trac.sagemath.org/ticket/25737

Original creator: tscrim

Original creation time: 2018-07-02 10:58:29

CC:  tscrim jdemeyer

Keywords: days94

We change the base class of `ParentWithGens` to `Parent` and do some optimizations and cleanup.


---

Comment by tscrim created at 2018-07-02 10:59:02

With my current new branch:

```
sage: R.<x> = LaurentPolynomialRing(QQ)
sage: p = (1 + x)^20
sage: q = (x^-1 + 1 + x)^10
sage: %timeit p * q
The slowest run took 20.04 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.84 µs per loop
```

versus old

```
sage: %timeit p * q
The slowest run took 18.42 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 2.72 µs per loop
```



---

Comment by tscrim created at 2018-07-02 11:04:33

New commits:


---

Comment by git created at 2018-07-02 11:18:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2018-07-02 13:15:28

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-07-02 13:16:28

Now with a much faster `dict` method:

```
sage: R.<x> = LaurentPolynomialRing(QQ)
sage: p = (1 + x)^20
sage: %timeit p.dict()
100000 loops, best of 3: 5.73 µs per loop
sage: %timeit p.dict()
The slowest run took 10.67 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 5.81 µs per loop
sage: R.<x> = LaurentPolynomialRing(ZZ)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 26.06 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 3.22 µs per loop
sage: S.<y> = PolynomialRing(QQ)
sage: R.<x> = LaurentPolynomialRing(S)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 6.25 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.6 µs per loop
```

versus old

```
sage: R.<x> = LaurentPolynomialRing(QQ)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 1011.87 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 13 µs per loop
sage: R.<x> = LaurentPolynomialRing(ZZ)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 5.78 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 7.43 µs per loop
sage: S.<y> = PolynomialRing(QQ)
sage: R.<x> = LaurentPolynomialRing(S)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 8.44 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 20 µs per loop
```



---

Comment by tscrim created at 2018-07-02 13:42:00

New commits:


---

Comment by git created at 2018-07-02 15:59:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2018-07-02 16:01:06

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-07-02 16:01:06

Now at

```
sage: %timeit p * q
The slowest run took 22.18 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.71 µs per loop
```



---

Comment by chapoton created at 2018-07-03 06:38:09

failing doctests

```
sage -t --long --warn-long 73.5 src/sage/algebras/cluster_algebra.py  # 2 doctests failed
```



---

Comment by chapoton created at 2018-07-03 06:38:09

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-07-03 07:12:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-03 07:15:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-07-03 07:16:42

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-07-03 07:16:42

Tests now pass in `cluster_algebra.py`; I also made `laurent_polynomial_ring.py` have a clean `pyflakes`.


---

Comment by chapoton created at 2018-07-04 08:59:49

ok, let it be. Thanks for your hard work on enhancing sage, Travis.


---

Comment by chapoton created at 2018-07-04 08:59:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-05 08:17:24

Resolution: fixed


---

Comment by vdelecroix created at 2018-08-07 20:13:54

Travis, I don't understand why you did not even take the time to mention what you were doing here in a comment of #25524...


---

Comment by tscrim created at 2018-08-07 20:35:31

Because I had forgotten about #25524. `^^;;`
