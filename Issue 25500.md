# Issue 25500: Move LaurentPolynomialRing to a new-style parent and some optimizations

archive/issues_025500.json:
```json
{
    "body": "CC:  tscrim jdemeyer\n\nKeywords: days94\n\nWe change the base class of `ParentWithGens` to `Parent` and do some optimizations and cleanup.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25737\n\n",
    "created_at": "2018-07-02T10:58:29Z",
    "labels": [
        "algebra",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Move LaurentPolynomialRing to a new-style parent and some optimizations",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25500",
    "user": "tscrim"
}
```
CC:  tscrim jdemeyer

Keywords: days94

We change the base class of `ParentWithGens` to `Parent` and do some optimizations and cleanup.

Issue created by migration from https://trac.sagemath.org/ticket/25737





---

archive/issue_comments_359710.json:
```json
{
    "body": "With my current new branch:\n\n```\nsage: R.<x> = LaurentPolynomialRing(QQ)\nsage: p = (1 + x)^20\nsage: q = (x^-1 + 1 + x)^10\nsage: %timeit p * q\nThe slowest run took 20.04 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.84 \u00b5s per loop\n```\n\nversus old\n\n```\nsage: %timeit p * q\nThe slowest run took 18.42 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 2.72 \u00b5s per loop\n```\n",
    "created_at": "2018-07-02T10:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359710",
    "user": "tscrim"
}
```

With my current new branch:

```
sage: R.<x> = LaurentPolynomialRing(QQ)
sage: p = (1 + x)^20
sage: q = (x^-1 + 1 + x)^10
sage: %timeit p * q
The slowest run took 20.04 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.84 µs per loop
```

versus old

```
sage: %timeit p * q
The slowest run took 18.42 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 2.72 µs per loop
```




---

archive/issue_comments_359711.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-07-02T11:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359711",
    "user": "tscrim"
}
```

New commits:



---

archive/issue_comments_359712.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-02T11:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359712",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_359713.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-02T13:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359713",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_359714.json:
```json
{
    "body": "Now with a much faster `dict` method:\n\n```\nsage: R.<x> = LaurentPolynomialRing(QQ)\nsage: p = (1 + x)^20\nsage: %timeit p.dict()\n100000 loops, best of 3: 5.73 \u00b5s per loop\nsage: %timeit p.dict()\nThe slowest run took 10.67 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 5.81 \u00b5s per loop\nsage: R.<x> = LaurentPolynomialRing(ZZ)\nsage: p = (1 + x)^20\nsage: %timeit p.dict()\nThe slowest run took 26.06 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 3.22 \u00b5s per loop\nsage: S.<y> = PolynomialRing(QQ)\nsage: R.<x> = LaurentPolynomialRing(S)\nsage: p = (1 + x)^20\nsage: %timeit p.dict()\nThe slowest run took 6.25 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.6 \u00b5s per loop\n```\n\nversus old\n\n```\nsage: R.<x> = LaurentPolynomialRing(QQ)\nsage: p = (1 + x)^20\nsage: %timeit p.dict()\nThe slowest run took 1011.87 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 13 \u00b5s per loop\nsage: R.<x> = LaurentPolynomialRing(ZZ)\nsage: p = (1 + x)^20\nsage: %timeit p.dict()\nThe slowest run took 5.78 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 7.43 \u00b5s per loop\nsage: S.<y> = PolynomialRing(QQ)\nsage: R.<x> = LaurentPolynomialRing(S)\nsage: p = (1 + x)^20\nsage: %timeit p.dict()\nThe slowest run took 8.44 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 20 \u00b5s per loop\n```\n",
    "created_at": "2018-07-02T13:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359714",
    "user": "tscrim"
}
```

Now with a much faster `dict` method:

```
sage: R.<x> = LaurentPolynomialRing(QQ)
sage: p = (1 + x)^20
sage: %timeit p.dict()
100000 loops, best of 3: 5.73 µs per loop
sage: %timeit p.dict()
The slowest run took 10.67 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 5.81 µs per loop
sage: R.<x> = LaurentPolynomialRing(ZZ)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 26.06 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 3.22 µs per loop
sage: S.<y> = PolynomialRing(QQ)
sage: R.<x> = LaurentPolynomialRing(S)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 6.25 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.6 µs per loop
```

versus old

```
sage: R.<x> = LaurentPolynomialRing(QQ)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 1011.87 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 13 µs per loop
sage: R.<x> = LaurentPolynomialRing(ZZ)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 5.78 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 7.43 µs per loop
sage: S.<y> = PolynomialRing(QQ)
sage: R.<x> = LaurentPolynomialRing(S)
sage: p = (1 + x)^20
sage: %timeit p.dict()
The slowest run took 8.44 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 20 µs per loop
```




---

archive/issue_comments_359715.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-07-02T13:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359715",
    "user": "tscrim"
}
```

New commits:



---

archive/issue_comments_359716.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-02T15:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359716",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_359717.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-02T16:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359717",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_359718.json:
```json
{
    "body": "Now at\n\n```\nsage: %timeit p * q\nThe slowest run took 22.18 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.71 \u00b5s per loop\n```\n",
    "created_at": "2018-07-02T16:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359718",
    "user": "tscrim"
}
```

Now at

```
sage: %timeit p * q
The slowest run took 22.18 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.71 µs per loop
```




---

archive/issue_comments_359719.json:
```json
{
    "body": "failing doctests\n\n```\nsage -t --long --warn-long 73.5 src/sage/algebras/cluster_algebra.py  # 2 doctests failed\n```\n",
    "created_at": "2018-07-03T06:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359719",
    "user": "chapoton"
}
```

failing doctests

```
sage -t --long --warn-long 73.5 src/sage/algebras/cluster_algebra.py  # 2 doctests failed
```




---

archive/issue_comments_359720.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-03T06:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359720",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359721.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-03T07:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359721",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359722.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-03T07:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359722",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359723.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-03T07:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359723",
    "user": "tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359724.json:
```json
{
    "body": "Tests now pass in `cluster_algebra.py`; I also made `laurent_polynomial_ring.py` have a clean `pyflakes`.",
    "created_at": "2018-07-03T07:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359724",
    "user": "tscrim"
}
```

Tests now pass in `cluster_algebra.py`; I also made `laurent_polynomial_ring.py` have a clean `pyflakes`.



---

archive/issue_comments_359725.json:
```json
{
    "body": "ok, let it be. Thanks for your hard work on enhancing sage, Travis.",
    "created_at": "2018-07-04T08:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359725",
    "user": "chapoton"
}
```

ok, let it be. Thanks for your hard work on enhancing sage, Travis.



---

archive/issue_comments_359726.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-04T08:59:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359726",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_359727.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-05T08:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359727",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_359728.json:
```json
{
    "body": "Travis, I don't understand why you did not even take the time to mention what you were doing here in a comment of #25524...",
    "created_at": "2018-08-07T20:13:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359728",
    "user": "vdelecroix"
}
```

Travis, I don't understand why you did not even take the time to mention what you were doing here in a comment of #25524...



---

archive/issue_comments_359729.json:
```json
{
    "body": "Because I had forgotten about #25524. `^^;;`",
    "created_at": "2018-08-07T20:35:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25500",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25500#issuecomment-359729",
    "user": "tscrim"
}
```

Because I had forgotten about #25524. `^^;;`
