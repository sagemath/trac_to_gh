# Issue 27250: spkg-configure.m4 for cmake

Issue created by migration from https://trac.sagemath.org/ticket/27487

Original creator: dimpase

Original creation time: 2019-03-14 16:26:25

CC:  embray fbissey slelievre vklein

practically a copy of the one for patch


---

Comment by dimpase created at 2019-03-14 16:26:36

Changing status from new to needs_review.


---

Comment by embray created at 2019-03-14 16:33:14

Well, this system's cmake is < 3.11, so in this case it "worked" in that it refused to use my system cmake.  I don't know how strict the 3.11 requirement is but I'm fine with leaving it for now.

I'll also test on a system with a newer cmake.


---

Comment by embray created at 2019-03-14 16:35:47

Apparently 3.11 is actually quite recent.  Unless there's a specific need for it, let's try setting to just 3.0 and see how that goes (my Cygwin has ~~3.8~~3.6.2 for example).


---

Comment by git created at 2019-03-14 16:41:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-03-14 16:42:34

OK, now it's 3.0.


---

Comment by dimpase created at 2019-03-19 11:21:19

Are you still checking this? There is an extra complication here that cmake
keeps 3.x for long, issuing updates with numbers 3.x.y to them on a regular basis.
Perhaps it's better to go all the way to x big enough for the meaningful cases such as current cygwin etc.


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by slelievre created at 2019-04-14 02:28:24

Note: we upgraded to cmake 3.11.0 in #25109 because cmake 3.8.1 was
not enough to build primecount 4.3 (an optional package).

However, primecount 4.6 was released on 2019-04-13 and lowered the
requirement from cmake 3.9 to cmake 3.4, if I understand correctly.


---

Comment by slelievre created at 2019-04-14 02:37:33

See the [primecount changelog](https://github.com/kimwalisch/primecount/blob/master/ChangeLog)
-- no tarball on the GitHub releases page yet.


---

Comment by slelievre created at 2019-04-14 18:11:02

Tarball now uploaded to GitHub. The upgrade to primecount 4.6 is tracked at #27662.

Consider cmake 3.4.3 (released 2016-01-25) rather than cmake 3.0.2 (released 2014-09-11).


---

Comment by git created at 2019-04-14 22:24:27

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2019-04-14 22:25:26

bumped up the minimal cmake version to 3.4.
Please review.


---

Comment by embray created at 2019-04-24 14:29:29

Okay, sounds good to me.  Does this mean we still need to upgrade primecount though?


---

Comment by vdelecroix created at 2019-04-25 05:47:31

Replying to [comment:13 embray]:
> Okay, sounds good to me.  Does this mean we still need to upgrade primecount though?

done at #27662


---

Comment by dimpase created at 2019-04-25 10:24:28

To review: 

* pull the branch
* make sure Sage's cmake is not installed. (`make cmake-clean` should do the job)
* make sure you have `cmake` (version 3.4 or better) installed on the box.
* run `./bootstrap` (you nedd autotools, yes)
* run `./configure` and inspect its output - you should see that `cmake` is marked as `not installed)
* to make sure this all works, try it on #27662 (or some other cmake-dependent Sage thing)

As this branch merely adds an `spkg-configure.m4` file, there is no pressing need to have Sage's configure package updated. It will get in as soon as an update of the latter happens.


---

Comment by vdelecroix created at 2019-04-25 14:55:42

At least, `cmake-3.14.1` is successfully detected on arch.


---

Comment by vdelecroix created at 2019-04-25 14:57:00

And `sage -i primecount` did not trigger `cmake` compilation!

Thank you.


---

Comment by vdelecroix created at 2019-04-25 14:57:00

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2019-04-25 15:15:25

Thanks!


---

Comment by vbraun created at 2019-05-06 11:56:34

Resolution: fixed
