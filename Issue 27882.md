# Issue 27882: Implement random triangulations of a polygon

Issue created by migration from https://trac.sagemath.org/ticket/28119

Original creator: @hensc

Original creation time: 2019-07-05 11:19:33

CC:  chapoton

This will provide a fast almost uniform random generator for triangulations of polygons.

This will extend the functionality of `graphs.RandomTriangulation()` to choosing the degree of the outer face of the triangulation. Currently, only outer faces of degree 3 are provided.

As the current implementation, this will use the algorithm via a bijection with blossoming trees due to Schaeffer and Poulalhon (Optimal Coding and Sampling of Triangulations, Algorithmica 2006).


---

Comment by @hensc created at 2019-07-30 10:09:20

Changing status from new to needs_review.


---

Comment by @hensc created at 2019-07-30 10:09:20

New commits:


---

Comment by git created at 2019-07-30 11:57:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-07-30 15:36:14

failing doctests, see patchbot report


---

Comment by git created at 2019-07-30 17:20:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @hensc created at 2019-07-30 17:26:37

In the former implementation of `RandomTriangulation()` the resulting graph always had an edge `(-1,-2)`. Since this had not been part of the documentation of `RandomTriangulation()`, I did not recover this behavior but fixed the two places where this behavior was expected.


---

Comment by chapoton created at 2019-07-31 07:28:12

Does the change in "minimal_schnyder_wood" mean that this function will need an argument "root" in order to work correctly ? If so, its doc and code must be changed accordingly.


---

Comment by @hensc created at 2019-07-31 09:22:31

I did not change anything in `minimal_schnyder_wood()`. But it is correct that this function needs an argument `root` if the graph has no edge `(-1,-2)`. In the former implementation of `RandomTriangulation()` the vertices of the root edge of the resulting graph were labelled `-1` and `-2`. To me it seems quite random that these behaviors used to fit together, but now that I think about it, at least it makes sense to take the root edge as an outer edge of the Schnyder wood.

Therefore, I will relabel the root edge vertices to `-1` and `-2` and add this to the documentation. I would prefer to return the root edge, but I think that's a to big change just for design reasons.

Letting `minimal_schnyder_wood()` choose a random root edge if none is given should not be done in this ticket, I think.


---

Comment by git created at 2019-07-31 10:22:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-07-31 19:20:32

This

```
k = (len(pendant_word)+4) / 2
```

should rather use `//`, no ?

I am getting 16 failures when testing with python3-built sage. Maybe all caused by the line above creating a float. 

Please add before the line 

```
from six.moves import range
```

another line containing

```
from __future__ import print_function, division
```

so that the behaviour of division becomes py3-like.


---

Comment by chapoton created at 2019-08-01 15:39:11

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-08-02 18:01:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @hensc created at 2019-08-02 18:03:00

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-08-02 18:41:48

Sorry, but this is breaking the following code (randomly, maybe once every 5 calls)

```
sage: T = TamariIntervalPosets(40)
sage: T.random_element()  
```

I guess I should have documented more the expected behaviour..


---

Comment by git created at 2019-08-02 21:01:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @hensc created at 2019-08-02 21:14:55

I think I could fix the problem. In the function `from_minimal_schnyder_wood(g)` which is called in `TamariIntervalPosets.random_element()` they expect the list `g._embedding[-1]` to end with `-2`. I did not like the idea to require the output of `RandomTriangulation()` to have this property. Therefore I fixed it in `TamariIntervalPosets.random_element()`. In my opinion, the cleanest solution would be to remove this requirement from `from_minimal_schnyder_wood()`. But not in this ticket.


---

Comment by git created at 2019-08-03 10:11:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @hensc created at 2019-08-03 14:35:04

I think this requirement makes sense for `minimal_schnyder_wood()`. Therefore now I prefer this solution.


---

Comment by chapoton created at 2019-08-05 14:43:18

ok, let it be. Thanks for your contribution.


---

Comment by chapoton created at 2019-08-05 14:43:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-08-08 21:24:36

Resolution: fixed
