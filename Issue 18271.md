# Issue 18271: Various python 3 issues

Issue created by migration from Trac.

Original creator: ohanar

Original creation time: 2015-05-26 00:29:27

CC:  vbraun ncohen

There are a number of really small issues when trying to build with python 3:

1. sagenb is a marked as dependency of jmol, even though this is no longer the case
2. sagenb is marked as a runtime dependency of sage, again this is no longer the case
3. scons and sagenb don't work with python 3, so they should only be a standard package for python 2
4. atlas needs a small change to make its build script work with python 3


---

Comment by ohanar created at 2015-05-26 00:29:36

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-05-26 07:09:23

The `notebook()` command uses sagenb, so its a runtime dependency. See also #18512

I'm fine with EOL'ing SageNB with Python2, but you should probably post to sage-devel to see if anybody is interested in maintaining it.


---

Comment by jdemeyer created at 2015-05-26 08:54:58

Replying to [comment:3 vbraun]:
> The `notebook()` command uses sagenb, so its a runtime dependency.
No, it's not a run-time dependency, since Sage works without the Sage notebook. Of course, the `notebook()` command doesn't work, but that doesn't matter.


---

Comment by jdemeyer created at 2015-05-26 08:56:15

Unless you add support for the `python2standard` package type, this branch isn't going to work.


---

Comment by jdemeyer created at 2015-05-26 08:56:15

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2015-05-26 09:01:08

There are other packages that could be removed yet Sage would still starts up; of course some functionality is then missing. I don't see how sagenb is different. Define "works". If you mean "works enough to create the conway polynomial pickles" then I guess so.

The `python2standard` type is from #17607


---

Comment by jdemeyer created at 2015-05-26 09:25:43

Replying to [comment:6 vbraun]:
> Define "works".

This is actually documented in `build/deps`:

```
# Everything needed to start up Sage using "./sage".  Of course, not
# every part of Sage will work.  It does not include Maxima for example.
```



---

Comment by jdemeyer created at 2015-05-26 09:26:51

I guess a formal definition of "works" is that

```
./sage -c ""
```

has exit status `0`.


---

Comment by jdemeyer created at 2015-05-26 09:27:23

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-05-26 10:07:13

I don't like this from #17607:

```
    if [ "$1" = all ]; then
        PKG_VAR=PYTHON
        if [ "$SAGE_PYTHON3" = yes ]; then
            PKG_NAME=python3
        else
            PKG_NAME=python2
        fi
        PKG_VERSION=$(newest_version $PKG_NAME)
        echo "$PKG_NAME $PKG_VERSION $PKG_VAR"
    fi
```


Just define `PYTHON` as alias of `PYTHON2` or `PYTHON3`, analogous how `build/install` deals with `GMP/MPIR` and the toolchain. See the `SAGE_MP_LIBRARY` and `TOOLCHAIN` variables.


---

Comment by vbraun created at 2015-05-26 10:10:31

We will have to remove python2 in the not so distant future so I don't see the value in winning any beauty contests in the meantime.


---

Comment by jdemeyer created at 2015-05-26 10:33:04

Replying to [comment:11 vbraun]:
> We will have to remove python2 in the not so distant future
I think that future might be more distant than you think... but that is besides the point anyway.

> I don't see the value in winning any beauty contests in the meantime.
This isn't just about beauty. It's about writing code which is easy to understand by doing things in a consistent way.


---

Comment by ncohen created at 2015-05-26 10:40:10

> This isn't just about beauty. It's about writing code which is easy to understand by doing things in a consistent way.

+1

Plus we might also want to work on the build/ files to make them more readable, and that task is not made simpler if we have to clean "workarounds" on the way.

Nathann

P.S.: this does not exactly give the impression of a 'clean job'.


```
(GRRR|…)~/.Sage/build/pkgs$ head python3/checksums.ini -n 1
tarball=Python-VERSION.tar.gz
(GRRR|…)~/.Sage/build/pkgs$ head python2/checksums.ini -n 1
tarball=python-VERSION.tar.gz
```



---

Comment by vbraun created at 2015-05-26 10:42:29

Replying to [comment:13 ncohen]:
> Plus we might also want to work on the build/ files to make them more readable

Like strip out the Python 2.x stuff in a little bit over 4 years?


---

Comment by jdemeyer created at 2015-05-26 11:57:58

Replying to [comment:6 vbraun]:
> The `python2standard` type is from #17607
...and I will remove it in #18517 since it's a very ugly hack to add to the build system.


---

Comment by jdemeyer created at 2015-05-26 13:09:42

What exactly are you trying to achieve with making `scons` build on Python 2 only? How do you solve the problem that `c_lib` still requires `scons` to build?


---

Comment by jdemeyer created at 2015-05-26 13:09:42

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-05-26 13:11:34

For `sagenb`, you could instead edit `build/pkgs/sagenb/spkg-install` to skip the package on Python 3.


---

Comment by vbraun created at 2015-05-26 14:14:42

`scons` doesn't support Python 3 at this point.


---

Comment by jdemeyer created at 2015-05-26 14:47:01

Replying to [comment:18 vbraun]:
> `scons` doesn't support Python 3 at this point.
I know, but read my question: How do you solve the problem that `c_lib` still requires `scons` to build? In other words: what's the gain from removing `SCONS` as standard package if it's still a dependency of `csage`?


---

Comment by vbraun created at 2015-05-26 16:42:46

I don't claim to have solved that, but we might want to get rid of scons. I think Andrew did some work towards autotoolizing polybori. We might want to do the same for `c_lib`, though its not the only option.


---

Comment by jdemeyer created at 2015-05-26 16:51:14

Replying to [comment:20 vbraun]:
> I don't claim to have solved that, but we might want to get rid of scons.
If it helps you, I propose to make `scons` an optional package. It will still be built by default since it's needed as dependency of `polybori` and `c_lib`.

> We might want to do the same for `c_lib`, though its not the only option.
I assume you are aware of #17854?


---

Comment by ohanar created at 2015-05-26 17:25:41

Replying to [comment:21 jdemeyer]:
> Replying to [comment:20 vbraun]:
> > I don't claim to have solved that, but we might want to get rid of scons.
> If it helps you, I propose to make `scons` an optional package. It will still be built by default since it's needed as dependency of `polybori` and `c_lib`.

Yes, I agree that this is cleaner than what I did. I'll make a patch sometime today updating this.

> > We might want to do the same for `c_lib`, though its not the only option.
> I assume you are aware of #17854?

I've been basically assuming that #17854 will be done in the not too distant future, which will remove half of the scons dependency.


---

Comment by git created at 2015-05-26 18:31:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ohanar created at 2015-05-26 18:47:29

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2015-05-26 18:52:16

Related: https://github.com/sagemath/sagenb/issues/343


---

Comment by jdemeyer created at 2015-05-26 18:53:38

Replying to [comment:22 ohanar]:
> I've been basically assuming that #17854 will be done in the not too distant future
It's only `ntl_wrap` which remains (#18367). Moving `ntl_wrap` to the Sage library is relatively easy I think but a lot of boring work.


---

Comment by jdemeyer created at 2015-05-26 20:08:09

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2015-05-26 20:08:09


```
The content of "/usr/local/src/sage-config/build/pkgs/sagenb/type" must be 'base', 'standard', 'optional' or 'experimental'
```

(just set back the type to `standard`, see #18517)


---

Comment by git created at 2015-05-27 01:43:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ohanar created at 2015-05-27 01:44:00

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2015-05-27 11:55:58

This is probably good, but I'd rather wait for Sage 6.8.beta1 to formally review this.


---

Comment by jdemeyer created at 2015-05-30 09:06:47

New commits:


---

Comment by jdemeyer created at 2015-05-30 09:36:01

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-05-30 14:14:46

Reviewer name is missing


---

Comment by vbraun created at 2015-05-30 14:14:50

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2015-05-30 14:26:24

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-06-02 14:42:10

Resolution: fixed
