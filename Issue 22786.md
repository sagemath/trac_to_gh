# Issue 22786: Upgrade to Sphinx 1.6.x

archive/issues_022786.json:
```json
{
    "body": "CC:  @kiwifb @embray\n\n**Tarball**: https://pypi.python.org/packages/0a/32/594257b9fccc8ce4d120e86d481cabe55ee9de7c1686af2ee58eb4ec741e/Sphinx-1.6.1.tar.gz\n\nIssue created by migration from https://trac.sagemath.org/ticket/23023\n\n",
    "created_at": "2017-05-18T11:12:23Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Upgrade to Sphinx 1.6.x",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22786",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @kiwifb @embray

**Tarball**: https://pypi.python.org/packages/0a/32/594257b9fccc8ce4d120e86d481cabe55ee9de7c1686af2ee58eb4ec741e/Sphinx-1.6.1.tar.gz

Issue created by migration from https://trac.sagemath.org/ticket/23023





---

archive/issue_comments_318072.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-05-19T18:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318072",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-07-03T09:40:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_318074.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-04T08:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318074",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_318075.json:
```json
{
    "body": "Are we using sphinx.websupport for anything? This is now split:\n\n\n```\n# -*- coding: utf-8 -*-\n\"\"\"\n    sphinx.websupport\n    ~~~~~~~~~~~~~~~~~\n\n    Base Module for web support functions.\n\n    :copyright: Copyright 2007-2017 by the Sphinx team, see AUTHORS.\n    :license: BSD, see LICENSE for details.\n\"\"\"\n\nimport warnings\n\nfrom sphinx.deprecation import RemovedInSphinx20Warning\n\ntry:\n    from sphinxcontrib.websupport import WebSupport  # NOQA\n    from sphinxcontrib.websupport import errors  # NOQA\n    from sphinxcontrib.websupport.search import BaseSearch, SEARCH_ADAPTERS  # NOQA\n    from sphinxcontrib.websupport.storage import StorageBackend  # NOQA\n\n    warnings.warn('sphinx.websupport module is now provided as sphinxcontrib-websupport. '\n                  'sphinx.websupport will be removed at Sphinx-2.0. '\n                  'Please use the package instead.',\n                  RemovedInSphinx20Warning)\nexcept ImportError:\n    warnings.warn('Since Sphinx-1.6, sphinx.websupport module is now separated to '\n                  'sphinxcontrib-websupport package. Please add it into your dependency list.')\n```\n",
    "created_at": "2017-07-04T22:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318075",
    "user": "https://github.com/kiwifb"
}
```

Are we using sphinx.websupport for anything? This is now split:


```
# -*- coding: utf-8 -*-
"""
    sphinx.websupport
    ~~~~~~~~~~~~~~~~~

    Base Module for web support functions.

    :copyright: Copyright 2007-2017 by the Sphinx team, see AUTHORS.
    :license: BSD, see LICENSE for details.
"""

import warnings

from sphinx.deprecation import RemovedInSphinx20Warning

try:
    from sphinxcontrib.websupport import WebSupport  # NOQA
    from sphinxcontrib.websupport import errors  # NOQA
    from sphinxcontrib.websupport.search import BaseSearch, SEARCH_ADAPTERS  # NOQA
    from sphinxcontrib.websupport.storage import StorageBackend  # NOQA

    warnings.warn('sphinx.websupport module is now provided as sphinxcontrib-websupport. '
                  'sphinx.websupport will be removed at Sphinx-2.0. '
                  'Please use the package instead.',
                  RemovedInSphinx20Warning)
except ImportError:
    warnings.warn('Since Sphinx-1.6, sphinx.websupport module is now separated to '
                  'sphinxcontrib-websupport package. Please add it into your dependency list.')
```




---

archive/issue_comments_318076.json:
```json
{
    "body": "This thing needs imagemagick's `convert` program. Not sure if we would use it and this is a relatively low requirement on a normal desktop but still surprised me. From `sphinx/ext/imgconverter.py`\n\n```\ndef setup(app):\n    # type: (Sphinx) -> Dict[unicode, Any]\n    app.add_post_transform(ImagemagickConverter)\n    app.add_config_value('image_converter', 'convert', 'env')\n    app.add_config_value('image_converter_args', [], 'env')\n\n    return {\n        'version': 'builtin',\n        'parallel_read_safe': True,\n        'parallel_write_safe': True,\n    }\n```\n\nI have been trying to run the self tests for myself and that came up. Because it is a relatively new machine install `convert` was not installed.",
    "created_at": "2017-07-05T02:41:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318076",
    "user": "https://github.com/kiwifb"
}
```

This thing needs imagemagick's `convert` program. Not sure if we would use it and this is a relatively low requirement on a normal desktop but still surprised me. From `sphinx/ext/imgconverter.py`

```
def setup(app):
    # type: (Sphinx) -> Dict[unicode, Any]
    app.add_post_transform(ImagemagickConverter)
    app.add_config_value('image_converter', 'convert', 'env')
    app.add_config_value('image_converter_args', [], 'env')

    return {
        'version': 'builtin',
        'parallel_read_safe': True,
        'parallel_write_safe': True,
    }
```

I have been trying to run the self tests for myself and that came up. Because it is a relatively new machine install `convert` was not installed.



---

archive/issue_comments_318077.json:
```json
{
    "body": "Replying to [comment:11 fbissey]:\n> I have been trying to run the self tests for myself and that came up.\n\nExactly what came up? What happened? And is it a regression from Sphinx 1.5.3 to Sphinx 1.6.3?",
    "created_at": "2017-07-05T10:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318077",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:11 fbissey]:
> I have been trying to run the self tests for myself and that came up.

Exactly what came up? What happened? And is it a regression from Sphinx 1.5.3 to Sphinx 1.6.3?



---

archive/issue_comments_318078.json:
```json
{
    "body": "Replying to [comment:12 jdemeyer]:\n> Replying to [comment:11 fbissey]:\n> > I have been trying to run the self tests for myself and that came up.\n> \n> Exactly what came up? What happened? And is it a regression from Sphinx 1.5.3 to Sphinx 1.6.3?\n\nsphinx own testsuite. I didn't have `convert` installed on the system and it broke. That stuff appears to be new, that extension didn't exist in 1.5.3, I haven't tested it within sage yet. The spkg doesn't have a spkg-check anyway, too many requirements not in sage to run it. But I'll probably do a test run soon without `convert` installed to see if it needs to be added to the list of sage's requirement",
    "created_at": "2017-07-05T10:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318078",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 fbissey]:
> > I have been trying to run the self tests for myself and that came up.
> 
> Exactly what came up? What happened? And is it a regression from Sphinx 1.5.3 to Sphinx 1.6.3?

sphinx own testsuite. I didn't have `convert` installed on the system and it broke. That stuff appears to be new, that extension didn't exist in 1.5.3, I haven't tested it within sage yet. The spkg doesn't have a spkg-check anyway, too many requirements not in sage to run it. But I'll probably do a test run soon without `convert` installed to see if it needs to be added to the list of sage's requirement



---

archive/issue_comments_318079.json:
```json
{
    "body": "Replying to [comment:13 fbissey]:\n> But I'll probably do a test run soon without `convert` installed to see if it needs to be added to the list of sage's requirement\n\nSounds good. If it's only needed for the Sphinx testsuite but not for Sage, I wouldn't worry about it.",
    "created_at": "2017-07-05T10:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318079",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:13 fbissey]:
> But I'll probably do a test run soon without `convert` installed to see if it needs to be added to the list of sage's requirement

Sounds good. If it's only needed for the Sphinx testsuite but not for Sage, I wouldn't worry about it.



---

archive/issue_comments_318080.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-06T01:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318080",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318081.json:
```json
{
    "body": "Looks fine to me.",
    "created_at": "2017-07-06T01:36:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318081",
    "user": "https://github.com/kiwifb"
}
```

Looks fine to me.



---

archive/issue_comments_318082.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-07-12T12:49:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318082",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_318083.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-07-29T20:41:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318083",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_318084.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-07-30T14:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318084",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_318085.json:
```json
{
    "body": "The japanese docs don't build any more (make all-pdf works):\n\n```\n[docpdf] make[2]: Entering directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/ja/a_tour_of_sage'\n[docpdf] make[2]: *** No rule to make target 'all-pdf-ja'.  Stop.\n[docpdf] make[2]: Leaving directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/ja/a_tour_of_sage'\n[docpdf] Error building the documentation.\n```\n\n\nFor the record, we now also depend on latexmk (in TeXlive):\n\n```\n[docpdf] [repl     ] WARNING: LaTeX file written to /mnt/disk/home/release/Sage/local/share/doc/sage/latex/en/reference/repl\n[docpdf] make[2]: Entering directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/en/reference/repl'\n[docpdf] latexmk -pdf -dvi- -ps-  'repl.tex'\n[docpdf] make[2]: latexmk: Command not found\n[docpdf] Makefile:33: recipe for target 'repl.pdf' failed\n```\n\nThis is easily fixed by installing latexmk.",
    "created_at": "2017-07-30T14:00:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318085",
    "user": "https://github.com/vbraun"
}
```

The japanese docs don't build any more (make all-pdf works):

```
[docpdf] make[2]: Entering directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/ja/a_tour_of_sage'
[docpdf] make[2]: *** No rule to make target 'all-pdf-ja'.  Stop.
[docpdf] make[2]: Leaving directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/ja/a_tour_of_sage'
[docpdf] Error building the documentation.
```


For the record, we now also depend on latexmk (in TeXlive):

```
[docpdf] [repl     ] WARNING: LaTeX file written to /mnt/disk/home/release/Sage/local/share/doc/sage/latex/en/reference/repl
[docpdf] make[2]: Entering directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/en/reference/repl'
[docpdf] latexmk -pdf -dvi- -ps-  'repl.tex'
[docpdf] make[2]: latexmk: Command not found
[docpdf] Makefile:33: recipe for target 'repl.pdf' failed
```

This is easily fixed by installing latexmk.



---

archive/issue_comments_318086.json:
```json
{
    "body": "I can see it. `make all-pdf` completing is probably thanks to parallel building. In docbuild/__init__.py\n\n```\n    def pdf(self):\n        \"\"\"\n        Builds the PDF files for this document.  This is done by first\n        (re)-building the LaTeX output, going into that LaTeX\n        directory, and running 'make all-pdf' (or for the special case of\n        the ja docs, 'all-pdf-ja(ex,to run platex)' there.\n\n        EXAMPLES::\n\n            sage: from sage_setup.docbuild import DocBuilder\n            sage: b = DocBuilder('tutorial')\n            sage: b.pdf() #not tested\n        \"\"\"\n        self.latex()\n        tex_dir = self._output_dir('latex')\n        pdf_dir = self._output_dir('pdf')\n        make_target = \"cd '%s' && $MAKE %s && mv -f *.pdf '%s'\"\n        error_message = \"failed to run $MAKE %s in %s\"\n        MB_LANG = {'ja': 'all-pdf-ja'} # language name : the modified target\n\n        # Replace the command for languages that require special processing\n        if self.lang in MB_LANG:\n            command = MB_LANG[self.lang]\n        else:\n            command = 'all-pdf'\n\n        if subprocess.call(make_target%(tex_dir, command, pdf_dir), shell=True):\n            raise RuntimeError(error_message%(command, tex_dir))\n        logger.warning(\"Build finished.  The built documents can be found in %s\", pdf_dir)\n```\n\nso `ja` used to be treated specially. But it appears that with sphinx 1.6.3 the Japanese specific target is not produced, just the regular `all-pdf`. \n\nSetting `MB_LANG={}` seems to work but the bigger question is whether to keep expecting some exceptions. sphinx may be moving away from particularism, in that case we should ditch it too.",
    "created_at": "2017-07-31T00:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318086",
    "user": "https://github.com/kiwifb"
}
```

I can see it. `make all-pdf` completing is probably thanks to parallel building. In docbuild/__init__.py

```
    def pdf(self):
        """
        Builds the PDF files for this document.  This is done by first
        (re)-building the LaTeX output, going into that LaTeX
        directory, and running 'make all-pdf' (or for the special case of
        the ja docs, 'all-pdf-ja(ex,to run platex)' there.

        EXAMPLES::

            sage: from sage_setup.docbuild import DocBuilder
            sage: b = DocBuilder('tutorial')
            sage: b.pdf() #not tested
        """
        self.latex()
        tex_dir = self._output_dir('latex')
        pdf_dir = self._output_dir('pdf')
        make_target = "cd '%s' && $MAKE %s && mv -f *.pdf '%s'"
        error_message = "failed to run $MAKE %s in %s"
        MB_LANG = {'ja': 'all-pdf-ja'} # language name : the modified target

        # Replace the command for languages that require special processing
        if self.lang in MB_LANG:
            command = MB_LANG[self.lang]
        else:
            command = 'all-pdf'

        if subprocess.call(make_target%(tex_dir, command, pdf_dir), shell=True):
            raise RuntimeError(error_message%(command, tex_dir))
        logger.warning("Build finished.  The built documents can be found in %s", pdf_dir)
```

so `ja` used to be treated specially. But it appears that with sphinx 1.6.3 the Japanese specific target is not produced, just the regular `all-pdf`. 

Setting `MB_LANG={}` seems to work but the bigger question is whether to keep expecting some exceptions. sphinx may be moving away from particularism, in that case we should ditch it too.



---

archive/issue_comments_318087.json:
```json
{
    "body": "Let's start moving this forwards again. I conformed to the boiler plate in #23179 and remove the Japanese specific stuff. If I were upstream I would have removed any kind of particularism at that level, so I am acting as if they just did until proven otherwise.\n----\nNew commits:",
    "created_at": "2017-08-08T02:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318087",
    "user": "https://github.com/kiwifb"
}
```

Let's start moving this forwards again. I conformed to the boiler plate in #23179 and remove the Japanese specific stuff. If I were upstream I would have removed any kind of particularism at that level, so I am acting as if they just did until proven otherwise.
----
New commits:



---

archive/issue_comments_318088.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-08T02:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318088",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318089.json:
```json
{
    "body": "Thanks for moving forward with this! I'll test it right away.",
    "created_at": "2017-08-08T07:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318089",
    "user": "https://github.com/jdemeyer"
}
```

Thanks for moving forward with this! I'll test it right away.



---

archive/issue_comments_318090.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-08T18:41:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318090",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318091.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-08-10T21:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318091",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_318092.json:
```json
{
    "body": "\n```\nsage -t --long --warn-long 75.4 src/doc/en/thematic_tutorials/sandpile.rst  # 2 doctests failed\nsage -t --long --warn-long 75.4 src/sage/sandpiles/sandpile.py  # 2 doctests failed\nsage -t --long --warn-long 75.4 src/sage/repl/ipython_tests.py  # 1 doctest failed\n```\n",
    "created_at": "2017-08-10T21:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318092",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long --warn-long 75.4 src/doc/en/thematic_tutorials/sandpile.rst  # 2 doctests failed
sage -t --long --warn-long 75.4 src/sage/sandpiles/sandpile.py  # 2 doctests failed
sage -t --long --warn-long 75.4 src/sage/repl/ipython_tests.py  # 1 doctest failed
```




---

archive/issue_comments_318093.json:
```json
{
    "body": "Problem with \"smart\" quotes? See http://www.sphinx-doc.org/en/stable/config.html#confval-html_use_smartypants. Should we create a `docutils.conf` file? I tried creating one containing\n\n```\n[parsers]\nsmart_quotes = no\n```\n\nbut I couldn't figure out the right place to put it, or at least no location that I tried had any effect on the failing doctests.",
    "created_at": "2017-08-10T23:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318093",
    "user": "https://github.com/jhpalmieri"
}
```

Problem with "smart" quotes? See http://www.sphinx-doc.org/en/stable/config.html#confval-html_use_smartypants. Should we create a `docutils.conf` file? I tried creating one containing

```
[parsers]
smart_quotes = no
```

but I couldn't figure out the right place to put it, or at least no location that I tried had any effect on the failing doctests.



---

archive/issue_comments_318094.json:
```json
{
    "body": "Could be. Jeroen and I both doctested the stuff before - without issues. My personal suspicion is interference with another merged ticket. In any case I am re-starting at Volker's current snapshot to see if I can reproduce it.",
    "created_at": "2017-08-10T23:36:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318094",
    "user": "https://github.com/kiwifb"
}
```

Could be. Jeroen and I both doctested the stuff before - without issues. My personal suspicion is interference with another merged ticket. In any case I am re-starting at Volker's current snapshot to see if I can reproduce it.



---

archive/issue_comments_318095.json:
```json
{
    "body": "I see the doctest failures on OS X when I apply this on top of 8.1.beta1. Could it be platform-specific?\n\nNote that changing line 680 in `local/lib/python2.7/site-packages/sphinx/environment/__init__.py`\n\n```\n       self.settings['smart_quotes'] = True\n```\n\nfrom `True` to `False` fixes the doctests.",
    "created_at": "2017-08-10T23:39:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318095",
    "user": "https://github.com/jhpalmieri"
}
```

I see the doctest failures on OS X when I apply this on top of 8.1.beta1. Could it be platform-specific?

Note that changing line 680 in `local/lib/python2.7/site-packages/sphinx/environment/__init__.py`

```
       self.settings['smart_quotes'] = True
```

from `True` to `False` fixes the doctests.



---

archive/issue_comments_318096.json:
```json
{
    "body": "I think I figured out the right place for `docutils.conf`:\n\n```diff\ndiff --git a/src/sage/misc/sphinxify.py b/src/sage/misc/sphinxify.py\nindex f084a19bf6..f114b9fcd7 100644\n--- a/src/sage/misc/sphinxify.py\n+++ b/src/sage/misc/sphinxify.py\n@@ -80,6 +80,10 @@ def sphinxify(docstring, format='html'):\n     # buildername, confoverrides, status, warning, freshenv).\n     confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')\n \n+    open(os.path.join(srcdir, 'docutils.conf'), 'w').write(r\"\"\"\n+[parser]\n+smart_quotes = no\n+\"\"\")\n     doctreedir = os.path.join(srcdir, 'doctrees')\n     confoverrides = {'html_context': {}, 'master_doc': 'docstring'}\n  \n```\n\nBut even though Sphinx seems to find this file, it doesn't change Sphinx's setting for `self.settings['smart_quotes']`.",
    "created_at": "2017-08-11T00:00:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318096",
    "user": "https://github.com/jhpalmieri"
}
```

I think I figured out the right place for `docutils.conf`:

```diff
diff --git a/src/sage/misc/sphinxify.py b/src/sage/misc/sphinxify.py
index f084a19bf6..f114b9fcd7 100644
--- a/src/sage/misc/sphinxify.py
+++ b/src/sage/misc/sphinxify.py
@@ -80,6 +80,10 @@ def sphinxify(docstring, format='html'):
     # buildername, confoverrides, status, warning, freshenv).
     confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')
 
+    open(os.path.join(srcdir, 'docutils.conf'), 'w').write(r"""
+[parser]
+smart_quotes = no
+""")
     doctreedir = os.path.join(srcdir, 'doctrees')
     confoverrides = {'html_context': {}, 'master_doc': 'docstring'}
  
```

But even though Sphinx seems to find this file, it doesn't change Sphinx's setting for `self.settings['smart_quotes']`.



---

archive/issue_comments_318097.json:
```json
{
    "body": "Not platform specific, but it may have been triggered by something else. What you show about the sphinx environment is quite suggestive. I will investigate that stuff.",
    "created_at": "2017-08-11T01:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318097",
    "user": "https://github.com/kiwifb"
}
```

Not platform specific, but it may have been triggered by something else. What you show about the sphinx environment is quite suggestive. I will investigate that stuff.



---

archive/issue_comments_318098.json:
```json
{
    "body": "I cannot seem to be able to force the smart_quotes to `False` at runtime either. More curious, I am looking at the file `sandpile.py` and there are other instances of help messages with double quotes that don't trigger doctests failures. So I am wondering if utf8 is also part of the mix.",
    "created_at": "2017-08-11T02:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318098",
    "user": "https://github.com/kiwifb"
}
```

I cannot seem to be able to force the smart_quotes to `False` at runtime either. More curious, I am looking at the file `sandpile.py` and there are other instances of help messages with double quotes that don't trigger doctests failures. So I am wondering if utf8 is also part of the mix.



---

archive/issue_comments_318099.json:
```json
{
    "body": "It's strange. In the two sandpile files with failures, single quotes are getting replaced, but not `--` by an en-dash. In `ipython_tests.py`, `--` is replaced by en-dashes, but that's all, the quotes are not changed.",
    "created_at": "2017-08-11T02:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318099",
    "user": "https://github.com/jhpalmieri"
}
```

It's strange. In the two sandpile files with failures, single quotes are getting replaced, but not `--` by an en-dash. In `ipython_tests.py`, `--` is replaced by en-dashes, but that's all, the quotes are not changed.



---

archive/issue_comments_318100.json:
```json
{
    "body": "Two more things: first, I am seeing some messages unnecessarily labeled as \"warnings\":\n\n```\n[dochtml] Build finished.  The built documents can be found in /Users/palmieri/Desktop/Sage_stuff/git/sage/local/share/doc/sage/inventory/en/reference/parallel\n[dochtml] [parallel ] WARNING: Build finished.  The built documents can be found in /Users/palmieri/Desktop/Sage_stuff/git/sage/local/share/doc/sage/inventory/en/reference/parallel\n```\n\nSecond, there are deprecation warnings:\n\n```\n/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sphinx/util/compat.py:40: RemovedInSphinx17Warning: sphinx.util.compat.Directive is deprecated and will be removed in Sphinx 1.7, please use docutils' instead.\n```\n\nIt looks like these can be removed with this change:\n\n```diff\ndiff --git a/src/sage_setup/docbuild/ext/sage_autodoc.py b/src/sage_setup/docbuild/ext/sage_autodoc.py\nindex 32b045c6bf..7590e22918 100644\n--- a/src/sage_setup/docbuild/ext/sage_autodoc.py\n+++ b/src/sage_setup/docbuild/ext/sage_autodoc.py\n@@ -39,7 +39,7 @@ from sphinx.locale import _\n from sphinx.pycode import ModuleAnalyzer, PycodeError\n from sphinx.application import ExtensionError\n from sphinx.util.nodes import nested_parse_with_titles\n-from sphinx.util.compat import Directive\n+from docutils.parsers.rst import Directive\n from sphinx.util.inspect import getargspec, isdescriptor, safe_getmembers, \\\n     safe_getattr, object_description, is_builtin_class_method\n from sphinx.util.docstrings import prepare_docstring\n```\n\nEdit: this is while building the reference manual.",
    "created_at": "2017-08-11T03:05:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318100",
    "user": "https://github.com/jhpalmieri"
}
```

Two more things: first, I am seeing some messages unnecessarily labeled as "warnings":

```
[dochtml] Build finished.  The built documents can be found in /Users/palmieri/Desktop/Sage_stuff/git/sage/local/share/doc/sage/inventory/en/reference/parallel
[dochtml] [parallel ] WARNING: Build finished.  The built documents can be found in /Users/palmieri/Desktop/Sage_stuff/git/sage/local/share/doc/sage/inventory/en/reference/parallel
```

Second, there are deprecation warnings:

```
/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sphinx/util/compat.py:40: RemovedInSphinx17Warning: sphinx.util.compat.Directive is deprecated and will be removed in Sphinx 1.7, please use docutils' instead.
```

It looks like these can be removed with this change:

```diff
diff --git a/src/sage_setup/docbuild/ext/sage_autodoc.py b/src/sage_setup/docbuild/ext/sage_autodoc.py
index 32b045c6bf..7590e22918 100644
--- a/src/sage_setup/docbuild/ext/sage_autodoc.py
+++ b/src/sage_setup/docbuild/ext/sage_autodoc.py
@@ -39,7 +39,7 @@ from sphinx.locale import _
 from sphinx.pycode import ModuleAnalyzer, PycodeError
 from sphinx.application import ExtensionError
 from sphinx.util.nodes import nested_parse_with_titles
-from sphinx.util.compat import Directive
+from docutils.parsers.rst import Directive
 from sphinx.util.inspect import getargspec, isdescriptor, safe_getmembers, \
     safe_getattr, object_description, is_builtin_class_method
 from sphinx.util.docstrings import prepare_docstring
```

Edit: this is while building the reference manual.



---

archive/issue_comments_318101.json:
```json
{
    "body": "Yes, we can definitely do something about the deprecation. The `WARNING` is more curious.",
    "created_at": "2017-08-11T03:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318101",
    "user": "https://github.com/kiwifb"
}
```

Yes, we can definitely do something about the deprecation. The `WARNING` is more curious.



---

archive/issue_comments_318102.json:
```json
{
    "body": "Looks like the WARNING is self inflicted\n\n```\n        # replacements: pairs of regular expressions and their replacements,\n        # to be applied to Sphinx output.\n        self.replacements = [(re.compile('build succeeded, [0-9]+ warning[s]?.'),\n                              'build succeeded.')]\n```\n\nfrom `sage_setup/docbuild/sphinxbuild.py`",
    "created_at": "2017-08-11T03:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318102",
    "user": "https://github.com/kiwifb"
}
```

Looks like the WARNING is self inflicted

```
        # replacements: pairs of regular expressions and their replacements,
        # to be applied to Sphinx output.
        self.replacements = [(re.compile('build succeeded, [0-9]+ warning[s]?.'),
                              'build succeeded.')]
```

from `sage_setup/docbuild/sphinxbuild.py`



---

archive/issue_comments_318103.json:
```json
{
    "body": "Replying to [comment:27 jhpalmieri]:\n> I think I figured out the right place for `docutils.conf`:\n> {{{\n> #!diff\n> diff --git a/src/sage/misc/sphinxify.py b/src/sage/misc/sphinxify.py\n> index f084a19bf6..f114b9fcd7 100644\n> --- a/src/sage/misc/sphinxify.py\n> +++ b/src/sage/misc/sphinxify.py\n> `@``@` -80,6 +80,10 `@``@` def sphinxify(docstring, format='html'):\n>      # buildername, confoverrides, status, warning, freshenv).\n>      confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')\n>  \n> +    open(os.path.join(srcdir, 'docutils.conf'), 'w').write(r\"\"\"\n> +[parser]\n> +smart_quotes = no\n> +\"\"\")\n>      doctreedir = os.path.join(srcdir, 'doctrees')\n>      confoverrides = {'html_context': {}, 'master_doc': 'docstring'}\n>   \n> }}}\n> But even though Sphinx seems to find this file, it doesn't change Sphinx's setting for `self.settings['smart_quotes']`.\n\nparser -> parsers I got something to work that way specifying `DOCUTILSCONFIG`",
    "created_at": "2017-08-11T03:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318103",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:27 jhpalmieri]:
> I think I figured out the right place for `docutils.conf`:
> {{{
> #!diff
> diff --git a/src/sage/misc/sphinxify.py b/src/sage/misc/sphinxify.py
> index f084a19bf6..f114b9fcd7 100644
> --- a/src/sage/misc/sphinxify.py
> +++ b/src/sage/misc/sphinxify.py
> `@``@` -80,6 +80,10 `@``@` def sphinxify(docstring, format='html'):
>      # buildername, confoverrides, status, warning, freshenv).
>      confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')
>  
> +    open(os.path.join(srcdir, 'docutils.conf'), 'w').write(r"""
> +[parser]
> +smart_quotes = no
> +""")
>      doctreedir = os.path.join(srcdir, 'doctrees')
>      confoverrides = {'html_context': {}, 'master_doc': 'docstring'}
>   
> }}}
> But even though Sphinx seems to find this file, it doesn't change Sphinx's setting for `self.settings['smart_quotes']`.

parser -> parsers I got something to work that way specifying `DOCUTILSCONFIG`



---

archive/issue_comments_318104.json:
```json
{
    "body": "Yes, your change but with `parsers` instead of `parser` works for sandpile.py.",
    "created_at": "2017-08-11T03:43:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318104",
    "user": "https://github.com/kiwifb"
}
```

Yes, your change but with `parsers` instead of `parser` works for sandpile.py.



---

archive/issue_comments_318105.json:
```json
{
    "body": "Good, thanks for catching that. I thought I had tried \"parsers\", and in fact I had, but with the wrong location for `docutils.conf`.",
    "created_at": "2017-08-11T04:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318105",
    "user": "https://github.com/jhpalmieri"
}
```

Good, thanks for catching that. I thought I had tried "parsers", and in fact I had, but with the wrong location for `docutils.conf`.



---

archive/issue_comments_318106.json:
```json
{
    "body": "We can silence the warnings by adding the appropriate regular expression to `self.useless_chatter`:\n\n```diff\ndiff --git a/src/sage_setup/docbuild/sphinxbuild.py b/src/sage_setup/docbuild/sphinxbuild.py\nindex 1deac3d312..ade37bd80f 100644\n--- a/src/sage_setup/docbuild/sphinxbuild.py\n+++ b/src/sage_setup/docbuild/sphinxbuild.py\n@@ -56,6 +56,7 @@ class SageSphinxLogger(object):\n             re.compile('WARNING: while setting up extension'),\n             re.compile('WARNING: Any IDs not assiend for figure node'),\n             re.compile('WARNING: .* is not referenced'),\n+            re.compile('WARNING: Build finished.*'),\n             re.compile('language \"hu\" not supported'),\n             )\n \n```\n",
    "created_at": "2017-08-11T04:42:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318106",
    "user": "https://github.com/jhpalmieri"
}
```

We can silence the warnings by adding the appropriate regular expression to `self.useless_chatter`:

```diff
diff --git a/src/sage_setup/docbuild/sphinxbuild.py b/src/sage_setup/docbuild/sphinxbuild.py
index 1deac3d312..ade37bd80f 100644
--- a/src/sage_setup/docbuild/sphinxbuild.py
+++ b/src/sage_setup/docbuild/sphinxbuild.py
@@ -56,6 +56,7 @@ class SageSphinxLogger(object):
             re.compile('WARNING: while setting up extension'),
             re.compile('WARNING: Any IDs not assiend for figure node'),
             re.compile('WARNING: .* is not referenced'),
+            re.compile('WARNING: Build finished.*'),
             re.compile('language "hu" not supported'),
             )
 
```




---

archive/issue_comments_318107.json:
```json
{
    "body": "Here is a branch with my proposed changes.\n----\nNew commits:",
    "created_at": "2017-08-11T04:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318107",
    "user": "https://github.com/jhpalmieri"
}
```

Here is a branch with my proposed changes.
----
New commits:



---

archive/issue_comments_318108.json:
```json
{
    "body": "Replying to [comment:37 jhpalmieri]:\n> We can silence the warnings by adding the appropriate regular expression to `self.useless_chatter`:\n> {{{\n> #!diff\n> diff --git a/src/sage_setup/docbuild/sphinxbuild.py b/src/sage_setup/docbuild/sphinxbuild.py\n> index 1deac3d312..ade37bd80f 100644\n> --- a/src/sage_setup/docbuild/sphinxbuild.py\n> +++ b/src/sage_setup/docbuild/sphinxbuild.py\n> `@``@` -56,6 +56,7 `@``@` class SageSphinxLogger(object):\n>              re.compile('WARNING: while setting up extension'),\n>              re.compile('WARNING: Any IDs not assiend for figure node'),\n>              re.compile('WARNING: .* is not referenced'),\n> +            re.compile('WARNING: Build finished.*'),\n>              re.compile('language \"hu\" not supported'),\n>              )\n>  \n> }}}\nYes we could, but I believe we are generating them ourselves a few lines down #23023?replyto=37#comment:33. I think we shouldn't generate them in the first place.",
    "created_at": "2017-08-11T05:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318108",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:37 jhpalmieri]:
> We can silence the warnings by adding the appropriate regular expression to `self.useless_chatter`:
> {{{
> #!diff
> diff --git a/src/sage_setup/docbuild/sphinxbuild.py b/src/sage_setup/docbuild/sphinxbuild.py
> index 1deac3d312..ade37bd80f 100644
> --- a/src/sage_setup/docbuild/sphinxbuild.py
> +++ b/src/sage_setup/docbuild/sphinxbuild.py
> `@``@` -56,6 +56,7 `@``@` class SageSphinxLogger(object):
>              re.compile('WARNING: while setting up extension'),
>              re.compile('WARNING: Any IDs not assiend for figure node'),
>              re.compile('WARNING: .* is not referenced'),
> +            re.compile('WARNING: Build finished.*'),
>              re.compile('language "hu" not supported'),
>              )
>  
> }}}
Yes we could, but I believe we are generating them ourselves a few lines down #23023?replyto=37#comment:33. I think we shouldn't generate them in the first place.



---

archive/issue_comments_318109.json:
```json
{
    "body": "These warning messages say \"Build finished...\". The other line (from comment:33) refers to strings saying \"build succeeded...\", so I don't think they're the same thing.",
    "created_at": "2017-08-11T15:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318109",
    "user": "https://github.com/jhpalmieri"
}
```

These warning messages say "Build finished...". The other line (from comment:33) refers to strings saying "build succeeded...", so I don't think they're the same thing.



---

archive/issue_comments_318110.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-12T03:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318110",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318111.json:
```json
{
    "body": "Replying to [comment:41 jhpalmieri]:\n> These warning messages say \"Build finished...\". The other line (from comment:33) refers to strings saying \"build succeeded...\", so I don't think they're the same thing.\n\nRight you are. So, at the very least back to need review. I find it surprising that there doesn't seem to be an easier way to set smart_quotes but that's the only documented way.",
    "created_at": "2017-08-12T03:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318111",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:41 jhpalmieri]:
> These warning messages say "Build finished...". The other line (from comment:33) refers to strings saying "build succeeded...", so I don't think they're the same thing.

Right you are. So, at the very least back to need review. I find it surprising that there doesn't seem to be an easier way to set smart_quotes but that's the only documented way.



---

archive/issue_comments_318112.json:
```json
{
    "body": "Everything else was positively reviewed, so I can't review my own branch. Can you reproduce the doctest failures and verify that the change to sphinxify.py fixes them?\n\nFrom the docutils documentation, it sounds like there is a command-line switch to turn off smart quotes, but I don't think we can use that since we are not calling docutils from the command line.",
    "created_at": "2017-08-12T05:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318112",
    "user": "https://github.com/jhpalmieri"
}
```

Everything else was positively reviewed, so I can't review my own branch. Can you reproduce the doctest failures and verify that the change to sphinxify.py fixes them?

From the docutils documentation, it sounds like there is a command-line switch to turn off smart quotes, but I don't think we can use that since we are not calling docutils from the command line.



---

archive/issue_comments_318113.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-12T06:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318113",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318114.json:
```json
{
    "body": "Replying to [comment:43 jhpalmieri]:\n> Everything else was positively reviewed, so I can't review my own branch. Can you reproduce the doctest failures and verify that the change to sphinxify.py fixes them?\n> \n\nI can and I already checked.\n\n> From the docutils documentation, it sounds like there is a command-line switch to turn off smart quotes, but I don't think we can use that since we are not calling docutils from the command line.\n\nYes. I am fairly sure there is a direct way to get sphinx to call docutils with different options but I don't know how to do it.",
    "created_at": "2017-08-12T06:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318114",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:43 jhpalmieri]:
> Everything else was positively reviewed, so I can't review my own branch. Can you reproduce the doctest failures and verify that the change to sphinxify.py fixes them?
> 

I can and I already checked.

> From the docutils documentation, it sounds like there is a command-line switch to turn off smart quotes, but I don't think we can use that since we are not calling docutils from the command line.

Yes. I am fairly sure there is a direct way to get sphinx to call docutils with different options but I don't know how to do it.



---

archive/issue_comments_318115.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-08-12T17:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318115",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_318116.json:
```json
{
    "body": "Parallel \"make doc-pdf\" doesn't work, hangs with N = number of processes python zombies.",
    "created_at": "2017-08-12T17:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318116",
    "user": "https://github.com/vbraun"
}
```

Parallel "make doc-pdf" doesn't work, hangs with N = number of processes python zombies.



---

archive/issue_comments_318117.json:
```json
{
    "body": "Replying to [comment:45 vbraun]:\n> Parallel \"make doc-pdf\" doesn't work, hangs with N = number of processes python zombies.\n\nI can't reproduce this on OS X. More silly warning messages, but it completes:\n\n```\n[docpdf] Elapsed time: 895.7 seconds.\n[docpdf] [website  ] WARNING: Elapsed time: 895.7 seconds.\n[docpdf] Done building the documentation!\n[docpdf] [website  ] WARNING: Done building the documentation!\n\nreal\t15m5.280s\nuser\t59m42.040s\nsys\t3m0.851s\nSage build/upgrade complete!\n```\n",
    "created_at": "2017-08-12T21:23:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318117",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:45 vbraun]:
> Parallel "make doc-pdf" doesn't work, hangs with N = number of processes python zombies.

I can't reproduce this on OS X. More silly warning messages, but it completes:

```
[docpdf] Elapsed time: 895.7 seconds.
[docpdf] [website  ] WARNING: Elapsed time: 895.7 seconds.
[docpdf] Done building the documentation!
[docpdf] [website  ] WARNING: Done building the documentation!

real	15m5.280s
user	59m42.040s
sys	3m0.851s
Sage build/upgrade complete!
```




---

archive/issue_comments_318118.json:
```json
{
    "body": "Couldn't reproduce it here either on Gentoo at \"-j8\".",
    "created_at": "2017-08-13T01:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318118",
    "user": "https://github.com/kiwifb"
}
```

Couldn't reproduce it here either on Gentoo at "-j8".



---

archive/issue_comments_318119.json:
```json
{
    "body": "And in case it matters, I'm using \"-j6\".",
    "created_at": "2017-08-13T03:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318119",
    "user": "https://github.com/jhpalmieri"
}
```

And in case it matters, I'm using "-j6".



---

archive/issue_comments_318120.json:
```json
{
    "body": "Just got a hicup while doing another test. `typing` wasn't installed in time for building doc-pdf, so dependencies will have to be tweaked.",
    "created_at": "2017-08-13T22:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318120",
    "user": "https://github.com/kiwifb"
}
```

Just got a hicup while doing another test. `typing` wasn't installed in time for building doc-pdf, so dependencies will have to be tweaked.



---

archive/issue_comments_318121.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-13T23:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318121",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_318122.json:
```json
{
    "body": "That should take care of that last problem, but it doesn't explain Volker's issue that we cannot seem to able to reproduce. I am waiting for more opinions before putting it back to positive.\n----\nNew commits:",
    "created_at": "2017-08-13T23:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318122",
    "user": "https://github.com/kiwifb"
}
```

That should take care of that last problem, but it doesn't explain Volker's issue that we cannot seem to able to reproduce. I am waiting for more opinions before putting it back to positive.
----
New commits:



---

archive/issue_comments_318123.json:
```json
{
    "body": "Should `typing` be a dependency for `sphinx`, or just for doc-building?",
    "created_at": "2017-08-14T00:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318123",
    "user": "https://github.com/jhpalmieri"
}
```

Should `typing` be a dependency for `sphinx`, or just for doc-building?



---

archive/issue_comments_318124.json:
```json
{
    "body": "It is a runtime dependency. You could probably use some functionalities of sphinx without touching `typing`, that's why I put it there rather a dependency of `sphinx` but I gave it some thought.",
    "created_at": "2017-08-14T01:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318124",
    "user": "https://github.com/kiwifb"
}
```

It is a runtime dependency. You could probably use some functionalities of sphinx without touching `typing`, that's why I put it there rather a dependency of `sphinx` but I gave it some thought.



---

archive/issue_comments_318125.json:
```json
{
    "body": "Do we wait for more information, or do we mark this as \"positive review\" and hope that the dependencies fix the problem?",
    "created_at": "2017-08-14T05:20:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318125",
    "user": "https://github.com/jhpalmieri"
}
```

Do we wait for more information, or do we mark this as "positive review" and hope that the dependencies fix the problem?



---

archive/issue_comments_318126.json:
```json
{
    "body": "We may as well have another go.",
    "created_at": "2017-08-14T05:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318126",
    "user": "https://github.com/kiwifb"
}
```

We may as well have another go.



---

archive/issue_comments_318127.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-14T05:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318127",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_318128.json:
```json
{
    "body": "Replying to [comment:52 fbissey]:\n> It is a runtime dependency. You could probably use some functionalities of sphinx without touching `typing`, that's why I put it there rather a dependency of `sphinx` but I gave it some thought.\n\nI agree. You don't need typing just to install Sphinx.",
    "created_at": "2017-08-14T08:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318128",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:52 fbissey]:
> It is a runtime dependency. You could probably use some functionalities of sphinx without touching `typing`, that's why I put it there rather a dependency of `sphinx` but I gave it some thought.

I agree. You don't need typing just to install Sphinx.



---

archive/issue_comments_318129.json:
```json
{
    "body": "Still get the error from `make -j10 doc-pdf`. The docpdf.log contains errors like\n\n```\n<sin_plot.png, id=51, 602.25pt x 501.875pt> <use sin_plot.png> [3 [85]]make[2]: *** write jobserver: Bad file descriptor.  Stop.\n```\n\nSeems like some script is mucking with the inherited make jobserver file descriptor.",
    "created_at": "2017-08-14T22:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318129",
    "user": "https://github.com/vbraun"
}
```

Still get the error from `make -j10 doc-pdf`. The docpdf.log contains errors like

```
<sin_plot.png, id=51, 602.25pt x 501.875pt> <use sin_plot.png> [3 [85]]make[2]: *** write jobserver: Bad file descriptor.  Stop.
```

Seems like some script is mucking with the inherited make jobserver file descriptor.



---

archive/issue_comments_318130.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-08-14T22:34:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318130",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_318131.json:
```json
{
    "body": "That a little bit more to work on than your first report. I'll see if I can trigger this again.",
    "created_at": "2017-08-14T22:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318131",
    "user": "https://github.com/kiwifb"
}
```

That a little bit more to work on than your first report. I'll see if I can trigger this again.



---

archive/issue_comments_318132.json:
```json
{
    "body": "Btw which latexmk are you using? 4.52c here...",
    "created_at": "2017-08-15T06:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318132",
    "user": "https://github.com/vbraun"
}
```

Btw which latexmk are you using? 4.52c here...



---

archive/issue_comments_318133.json:
```json
{
    "body": "`4.35` here, I can upgrade to see if it has an impact. I may be slow to respond in the next couple of days. The proverbial `s**t` hit the fan at work today.",
    "created_at": "2017-08-15T07:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318133",
    "user": "https://github.com/kiwifb"
}
```

`4.35` here, I can upgrade to see if it has an impact. I may be slow to respond in the next couple of days. The proverbial `s**t` hit the fan at work today.



---

archive/issue_comments_318134.json:
```json
{
    "body": "4.52c for me.",
    "created_at": "2017-08-15T14:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318134",
    "user": "https://github.com/jhpalmieri"
}
```

4.52c for me.



---

archive/issue_comments_318135.json:
```json
{
    "body": "No difference with `latekmk-4.52c` here.",
    "created_at": "2017-08-20T22:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318135",
    "user": "https://github.com/kiwifb"
}
```

No difference with `latekmk-4.52c` here.



---

archive/issue_comments_318136.json:
```json
{
    "body": "I upgraded to Fedora 26 and can't reproduce it any more...",
    "created_at": "2017-08-26T09:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318136",
    "user": "https://github.com/vbraun"
}
```

I upgraded to Fedora 26 and can't reproduce it any more...



---

archive/issue_events_021416.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-08-26T09:58:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/22786#event-21416"
}
```



---

archive/issue_comments_318137.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-26T09:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318137",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_318138.json:
```json
{
    "body": "Replying to [comment:62 vbraun]:\n> I upgraded to Fedora 26 and can't reproduce it any more...\n\nWeird. But glad we are moving forward on that one.",
    "created_at": "2017-08-26T10:03:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318138",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:62 vbraun]:
> I upgraded to Fedora 26 and can't reproduce it any more...

Weird. But glad we are moving forward on that one.



---

archive/issue_comments_318139.json:
```json
{
    "body": "Thanks for finally getting this done.",
    "created_at": "2017-08-28T14:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318139",
    "user": "https://github.com/jdemeyer"
}
```

Thanks for finally getting this done.



---

archive/issue_comments_318140.json:
```json
{
    "body": "What is the reason for `typing` package being `standard` rather than `pip` type?",
    "created_at": "2017-08-31T08:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318140",
    "user": "https://github.com/dimpase"
}
```

What is the reason for `typing` package being `standard` rather than `pip` type?



---

archive/issue_comments_318141.json:
```json
{
    "body": "Not sure. I cannot say I really ever cared for that particular distinction - sorry.",
    "created_at": "2017-08-31T08:22:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318141",
    "user": "https://github.com/kiwifb"
}
```

Not sure. I cannot say I really ever cared for that particular distinction - sorry.



---

archive/issue_comments_318142.json:
```json
{
    "body": "Replying to [comment:67 fbissey]:\n> Not sure. I cannot say I really ever cared for that particular distinction - sorry.\nIn particular, it's about having an extra tarball to care about; (`pip` type, to the contrary, is just a placeholder, no tarball to worry about...)\n\nThe only thing I can imagine is that one needs to specify in some standard package that it depends on it (either via Sage deps mechanism, or via pip/setup.py, I suppose...)",
    "created_at": "2017-08-31T08:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318142",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:67 fbissey]:
> Not sure. I cannot say I really ever cared for that particular distinction - sorry.
In particular, it's about having an extra tarball to care about; (`pip` type, to the contrary, is just a placeholder, no tarball to worry about...)

The only thing I can imagine is that one needs to specify in some standard package that it depends on it (either via Sage deps mechanism, or via pip/setup.py, I suppose...)



---

archive/issue_comments_318143.json:
```json
{
    "body": "Right, if you need to download it then it really makes it a special kind of optional package. `typing` is meant to be a standard package so part of the sage tarball.",
    "created_at": "2017-08-31T08:34:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318143",
    "user": "https://github.com/kiwifb"
}
```

Right, if you need to download it then it really makes it a special kind of optional package. `typing` is meant to be a standard package so part of the sage tarball.



---

archive/issue_comments_318144.json:
```json
{
    "body": "Replying to [comment:66 dimpase]:\n> What is the reason for `typing` package being `standard` rather than `pip` type?\n\n`standard` packages can depend only on `standard` packages: we do not assume Internet access when building Sage from source.",
    "created_at": "2017-08-31T08:37:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318144",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:66 dimpase]:
> What is the reason for `typing` package being `standard` rather than `pip` type?

`standard` packages can depend only on `standard` packages: we do not assume Internet access when building Sage from source.



---

archive/issue_comments_318145.json:
```json
{
    "body": "I am stuck on #14645 with a pip package I don't know how to specify, due to \"`-`\" in its name, namely `sphinxcontrib-websupport`. It cannot be of type `pip`, as `-` is not allowed in the Sage package names, as far as I can tell...",
    "created_at": "2017-08-31T08:53:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318145",
    "user": "https://github.com/dimpase"
}
```

I am stuck on #14645 with a pip package I don't know how to specify, due to "`-`" in its name, namely `sphinxcontrib-websupport`. It cannot be of type `pip`, as `-` is not allowed in the Sage package names, as far as I can tell...



---

archive/issue_comments_318146.json:
```json
{
    "body": "And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.",
    "created_at": "2017-08-31T08:58:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318146",
    "user": "https://github.com/kiwifb"
}
```

And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.



---

archive/issue_comments_318147.json:
```json
{
    "body": "Replying to [comment:72 fbissey]:\n> And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.\n\nOf course with a standard package you can do anything in principle, but the standard machinery you used it `typing` won't work IMHO, as `sage-pip-install` (i.e. `$PIP_INSTALL` used in `spkg-install`) does not seem to allow\nthe name of pip package to be installed as an argument...",
    "created_at": "2017-08-31T09:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318147",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:72 fbissey]:
> And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.

Of course with a standard package you can do anything in principle, but the standard machinery you used it `typing` won't work IMHO, as `sage-pip-install` (i.e. `$PIP_INSTALL` used in `spkg-install`) does not seem to allow
the name of pip package to be installed as an argument...



---

archive/issue_comments_318148.json:
```json
{
    "body": "Replying to [comment:73 dimpase]:\n> Replying to [comment:72 fbissey]:\n> > And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.\n> \n> Of course with a standard package you can do anything in principle, but the standard machinery you used it `typing` won't work IMHO, as `sage-pip-install` (i.e. `$PIP_INSTALL` used in `spkg-install`) does not seem to allow\n> the name of pip package to be installed as an argument...\n\nWe should really have this conversation at #14645 not here. I am not sure what your problem is with `$PIP_INSTALL`. It is a replacement for `python setup.py` in the package source tree. It behaves in a similar way but is better at package management operation (it knows how to remove a previous install properly).",
    "created_at": "2017-08-31T09:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318148",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:73 dimpase]:
> Replying to [comment:72 fbissey]:
> > And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.
> 
> Of course with a standard package you can do anything in principle, but the standard machinery you used it `typing` won't work IMHO, as `sage-pip-install` (i.e. `$PIP_INSTALL` used in `spkg-install`) does not seem to allow
> the name of pip package to be installed as an argument...

We should really have this conversation at #14645 not here. I am not sure what your problem is with `$PIP_INSTALL`. It is a replacement for `python setup.py` in the package source tree. It behaves in a similar way but is better at package management operation (it knows how to remove a previous install properly).



---

archive/issue_comments_318149.json:
```json
{
    "body": "I have opened #23764 to deal with this issue. Sorry for noise here.",
    "created_at": "2017-08-31T09:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318149",
    "user": "https://github.com/dimpase"
}
```

I have opened #23764 to deal with this issue. Sorry for noise here.



---

archive/issue_comments_318150.json:
```json
{
    "body": "See #23834 for a followup.",
    "created_at": "2017-09-11T23:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22786#issuecomment-318150",
    "user": "https://github.com/jhpalmieri"
}
```

See #23834 for a followup.
