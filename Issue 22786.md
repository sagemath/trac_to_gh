# Issue 22786: Upgrade to Sphinx 1.6.x

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-05-18 11:12:23

CC:  fbissey embray

*Tarball*: https://pypi.python.org/packages/0a/32/594257b9fccc8ce4d120e86d481cabe55ee9de7c1686af2ee58eb4ec741e/Sphinx-1.6.1.tar.gz


---

Comment by git created at 2017-05-19 18:27:55

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2017-07-03 09:40:12

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-07-04 08:27:38

Changing status from new to needs_review.


---

Comment by fbissey created at 2017-07-04 22:07:00

Are we using sphinx.websupport for anything? This is now split:


```
# -*- coding: utf-8 -*-
"""
    sphinx.websupport
    ~~~~~~~~~~~~~~~~~

    Base Module for web support functions.

    :copyright: Copyright 2007-2017 by the Sphinx team, see AUTHORS.
    :license: BSD, see LICENSE for details.
"""

import warnings

from sphinx.deprecation import RemovedInSphinx20Warning

try:
    from sphinxcontrib.websupport import WebSupport  # NOQA
    from sphinxcontrib.websupport import errors  # NOQA
    from sphinxcontrib.websupport.search import BaseSearch, SEARCH_ADAPTERS  # NOQA
    from sphinxcontrib.websupport.storage import StorageBackend  # NOQA

    warnings.warn('sphinx.websupport module is now provided as sphinxcontrib-websupport. '
                  'sphinx.websupport will be removed at Sphinx-2.0. '
                  'Please use the package instead.',
                  RemovedInSphinx20Warning)
except ImportError:
    warnings.warn('Since Sphinx-1.6, sphinx.websupport module is now separated to '
                  'sphinxcontrib-websupport package. Please add it into your dependency list.')
```



---

Comment by fbissey created at 2017-07-05 02:41:22

This thing needs imagemagick's `convert` program. Not sure if we would use it and this is a relatively low requirement on a normal desktop but still surprised me. From `sphinx/ext/imgconverter.py`

```
def setup(app):
    # type: (Sphinx) -> Dict[unicode, Any]
    app.add_post_transform(ImagemagickConverter)
    app.add_config_value('image_converter', 'convert', 'env')
    app.add_config_value('image_converter_args', [], 'env')

    return {
        'version': 'builtin',
        'parallel_read_safe': True,
        'parallel_write_safe': True,
    }
```

I have been trying to run the self tests for myself and that came up. Because it is a relatively new machine install `convert` was not installed.


---

Comment by jdemeyer created at 2017-07-05 10:00:08

Replying to [comment:11 fbissey]:
> I have been trying to run the self tests for myself and that came up.

Exactly what came up? What happened? And is it a regression from Sphinx 1.5.3 to Sphinx 1.6.3?


---

Comment by fbissey created at 2017-07-05 10:11:48

Replying to [comment:12 jdemeyer]:
> Replying to [comment:11 fbissey]:
> > I have been trying to run the self tests for myself and that came up.
> 
> Exactly what came up? What happened? And is it a regression from Sphinx 1.5.3 to Sphinx 1.6.3?

sphinx own testsuite. I didn't have `convert` installed on the system and it broke. That stuff appears to be new, that extension didn't exist in 1.5.3, I haven't tested it within sage yet. The spkg doesn't have a spkg-check anyway, too many requirements not in sage to run it. But I'll probably do a test run soon without `convert` installed to see if it needs to be added to the list of sage's requirement


---

Comment by jdemeyer created at 2017-07-05 10:35:09

Replying to [comment:13 fbissey]:
> But I'll probably do a test run soon without `convert` installed to see if it needs to be added to the list of sage's requirement

Sounds good. If it's only needed for the Sphinx testsuite but not for Sage, I wouldn't worry about it.


---

Comment by fbissey created at 2017-07-06 01:36:36

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2017-07-06 01:36:36

Looks fine to me.


---

Comment by jdemeyer created at 2017-07-12 12:49:52

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2017-07-29 20:41:08

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2017-07-30 14:00:47

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-07-30 14:00:47

The japanese docs don't build any more (make all-pdf works):

```
[docpdf] make[2]: Entering directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/ja/a_tour_of_sage'
[docpdf] make[2]: *** No rule to make target 'all-pdf-ja'.  Stop.
[docpdf] make[2]: Leaving directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/ja/a_tour_of_sage'
[docpdf] Error building the documentation.
```


For the record, we now also depend on latexmk (in TeXlive):

```
[docpdf] [repl     ] WARNING: LaTeX file written to /mnt/disk/home/release/Sage/local/share/doc/sage/latex/en/reference/repl
[docpdf] make[2]: Entering directory '/mnt/disk/home/release/Sage/local/share/doc/sage/latex/en/reference/repl'
[docpdf] latexmk -pdf -dvi- -ps-  'repl.tex'
[docpdf] make[2]: latexmk: Command not found
[docpdf] Makefile:33: recipe for target 'repl.pdf' failed
```

This is easily fixed by installing latexmk.


---

Comment by fbissey created at 2017-07-31 00:02:49

I can see it. `make all-pdf` completing is probably thanks to parallel building. In docbuild/__init__.py

```
    def pdf(self):
        """
        Builds the PDF files for this document.  This is done by first
        (re)-building the LaTeX output, going into that LaTeX
        directory, and running 'make all-pdf' (or for the special case of
        the ja docs, 'all-pdf-ja(ex,to run platex)' there.

        EXAMPLES::

            sage: from sage_setup.docbuild import DocBuilder
            sage: b = DocBuilder('tutorial')
            sage: b.pdf() #not tested
        """
        self.latex()
        tex_dir = self._output_dir('latex')
        pdf_dir = self._output_dir('pdf')
        make_target = "cd '%s' && $MAKE %s && mv -f *.pdf '%s'"
        error_message = "failed to run $MAKE %s in %s"
        MB_LANG = {'ja': 'all-pdf-ja'} # language name : the modified target

        # Replace the command for languages that require special processing
        if self.lang in MB_LANG:
            command = MB_LANG[self.lang]
        else:
            command = 'all-pdf'

        if subprocess.call(make_target%(tex_dir, command, pdf_dir), shell=True):
            raise RuntimeError(error_message%(command, tex_dir))
        logger.warning("Build finished.  The built documents can be found in %s", pdf_dir)
```

so `ja` used to be treated specially. But it appears that with sphinx 1.6.3 the Japanese specific target is not produced, just the regular `all-pdf`. 

Setting `MB_LANG={}` seems to work but the bigger question is whether to keep expecting some exceptions. sphinx may be moving away from particularism, in that case we should ditch it too.


---

Comment by fbissey created at 2017-08-08 02:39:15

Let's start moving this forwards again. I conformed to the boiler plate in #23179 and remove the Japanese specific stuff. If I were upstream I would have removed any kind of particularism at that level, so I am acting as if they just did until proven otherwise.
----
New commits:


---

Comment by fbissey created at 2017-08-08 02:39:15

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2017-08-08 07:36:30

Thanks for moving forward with this! I'll test it right away.


---

Comment by jdemeyer created at 2017-08-08 18:41:27

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-08-10 21:58:29

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-08-10 21:58:29


```
sage -t --long --warn-long 75.4 src/doc/en/thematic_tutorials/sandpile.rst  # 2 doctests failed
sage -t --long --warn-long 75.4 src/sage/sandpiles/sandpile.py  # 2 doctests failed
sage -t --long --warn-long 75.4 src/sage/repl/ipython_tests.py  # 1 doctest failed
```



---

Comment by jhpalmieri created at 2017-08-10 23:33:23

Problem with "smart" quotes? See http://www.sphinx-doc.org/en/stable/config.html#confval-html_use_smartypants. Should we create a `docutils.conf` file? I tried creating one containing

```
[parsers]
smart_quotes = no
```

but I couldn't figure out the right place to put it, or at least no location that I tried had any effect on the failing doctests.


---

Comment by fbissey created at 2017-08-10 23:36:43

Could be. Jeroen and I both doctested the stuff before - without issues. My personal suspicion is interference with another merged ticket. In any case I am re-starting at Volker's current snapshot to see if I can reproduce it.


---

Comment by jhpalmieri created at 2017-08-10 23:39:28

I see the doctest failures on OS X when I apply this on top of 8.1.beta1. Could it be platform-specific?

Note that changing line 680 in `local/lib/python2.7/site-packages/sphinx/environment/__init__.py`

```
       self.settings['smart_quotes'] = True
```

from `True` to `False` fixes the doctests.


---

Comment by jhpalmieri created at 2017-08-11 00:00:06

I think I figured out the right place for `docutils.conf`:

```diff
diff --git a/src/sage/misc/sphinxify.py b/src/sage/misc/sphinxify.py
index f084a19bf6..f114b9fcd7 100644
--- a/src/sage/misc/sphinxify.py
+++ b/src/sage/misc/sphinxify.py
`@``@` -80,6 +80,10 `@``@` def sphinxify(docstring, format='html'):
     # buildername, confoverrides, status, warning, freshenv).
     confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')
 
+    open(os.path.join(srcdir, 'docutils.conf'), 'w').write(r"""
+[parser]
+smart_quotes = no
+""")
     doctreedir = os.path.join(srcdir, 'doctrees')
     confoverrides = {'html_context': {}, 'master_doc': 'docstring'}
  
```

But even though Sphinx seems to find this file, it doesn't change Sphinx's setting for `self.settings['smart_quotes']`.


---

Comment by fbissey created at 2017-08-11 01:05:28

Not platform specific, but it may have been triggered by something else. What you show about the sphinx environment is quite suggestive. I will investigate that stuff.


---

Comment by fbissey created at 2017-08-11 02:22:22

I cannot seem to be able to force the smart_quotes to `False` at runtime either. More curious, I am looking at the file `sandpile.py` and there are other instances of help messages with double quotes that don't trigger doctests failures. So I am wondering if utf8 is also part of the mix.


---

Comment by jhpalmieri created at 2017-08-11 02:56:52

It's strange. In the two sandpile files with failures, single quotes are getting replaced, but not `--` by an en-dash. In `ipython_tests.py`, `--` is replaced by en-dashes, but that's all, the quotes are not changed.


---

Comment by jhpalmieri created at 2017-08-11 03:05:20

Two more things: first, I am seeing some messages unnecessarily labeled as "warnings":

```
[dochtml] Build finished.  The built documents can be found in /Users/palmieri/Desktop/Sage_stuff/git/sage/local/share/doc/sage/inventory/en/reference/parallel
[dochtml] [parallel ] WARNING: Build finished.  The built documents can be found in /Users/palmieri/Desktop/Sage_stuff/git/sage/local/share/doc/sage/inventory/en/reference/parallel
```

Second, there are deprecation warnings:

```
/Users/palmieri/Desktop/Sage_stuff/git/sage/local/lib/python2.7/site-packages/sphinx/util/compat.py:40: RemovedInSphinx17Warning: sphinx.util.compat.Directive is deprecated and will be removed in Sphinx 1.7, please use docutils' instead.
```

It looks like these can be removed with this change:

```diff
diff --git a/src/sage_setup/docbuild/ext/sage_autodoc.py b/src/sage_setup/docbuild/ext/sage_autodoc.py
index 32b045c6bf..7590e22918 100644
--- a/src/sage_setup/docbuild/ext/sage_autodoc.py
+++ b/src/sage_setup/docbuild/ext/sage_autodoc.py
`@``@` -39,7 +39,7 `@``@` from sphinx.locale import _
 from sphinx.pycode import ModuleAnalyzer, PycodeError
 from sphinx.application import ExtensionError
 from sphinx.util.nodes import nested_parse_with_titles
-from sphinx.util.compat import Directive
+from docutils.parsers.rst import Directive
 from sphinx.util.inspect import getargspec, isdescriptor, safe_getmembers, \
     safe_getattr, object_description, is_builtin_class_method
 from sphinx.util.docstrings import prepare_docstring
```

Edit: this is while building the reference manual.


---

Comment by fbissey created at 2017-08-11 03:09:52

Yes, we can definitely do something about the deprecation. The `WARNING` is more curious.


---

Comment by fbissey created at 2017-08-11 03:16:27

Looks like the WARNING is self inflicted

```
        # replacements: pairs of regular expressions and their replacements,
        # to be applied to Sphinx output.
        self.replacements = [(re.compile('build succeeded, [0-9]+ warning[s]?.'),
                              'build succeeded.')]
```

from `sage_setup/docbuild/sphinxbuild.py`


---

Comment by fbissey created at 2017-08-11 03:38:14

Replying to [comment:27 jhpalmieri]:
> I think I figured out the right place for `docutils.conf`:
> {{{
> #!diff
> diff --git a/src/sage/misc/sphinxify.py b/src/sage/misc/sphinxify.py
> index f084a19bf6..f114b9fcd7 100644
> --- a/src/sage/misc/sphinxify.py
> +++ b/src/sage/misc/sphinxify.py
> `@``@` -80,6 +80,10 `@``@` def sphinxify(docstring, format='html'):
>      # buildername, confoverrides, status, warning, freshenv).
>      confdir = os.path.join(SAGE_DOC_SRC, 'en', 'introspect')
>  
> +    open(os.path.join(srcdir, 'docutils.conf'), 'w').write(r"""
> +[parser]
> +smart_quotes = no
> +""")
>      doctreedir = os.path.join(srcdir, 'doctrees')
>      confoverrides = {'html_context': {}, 'master_doc': 'docstring'}
>   
> }}}
> But even though Sphinx seems to find this file, it doesn't change Sphinx's setting for `self.settings['smart_quotes']`.

parser -> parsers I got something to work that way specifying `DOCUTILSCONFIG`


---

Comment by fbissey created at 2017-08-11 03:43:00

Yes, your change but with `parsers` instead of `parser` works for sandpile.py.


---

Comment by jhpalmieri created at 2017-08-11 04:37:15

Good, thanks for catching that. I thought I had tried "parsers", and in fact I had, but with the wrong location for `docutils.conf`.


---

Comment by jhpalmieri created at 2017-08-11 04:42:43

We can silence the warnings by adding the appropriate regular expression to `self.useless_chatter`:

```diff
diff --git a/src/sage_setup/docbuild/sphinxbuild.py b/src/sage_setup/docbuild/sphinxbuild.py
index 1deac3d312..ade37bd80f 100644
--- a/src/sage_setup/docbuild/sphinxbuild.py
+++ b/src/sage_setup/docbuild/sphinxbuild.py
`@``@` -56,6 +56,7 `@``@` class SageSphinxLogger(object):
             re.compile('WARNING: while setting up extension'),
             re.compile('WARNING: Any IDs not assiend for figure node'),
             re.compile('WARNING: .* is not referenced'),
+            re.compile('WARNING: Build finished.*'),
             re.compile('language "hu" not supported'),
             )
 
```



---

Comment by jhpalmieri created at 2017-08-11 04:47:45

Here is a branch with my proposed changes.
----
New commits:


---

Comment by fbissey created at 2017-08-11 05:32:55

Replying to [comment:37 jhpalmieri]:
> We can silence the warnings by adding the appropriate regular expression to `self.useless_chatter`:
> {{{
> #!diff
> diff --git a/src/sage_setup/docbuild/sphinxbuild.py b/src/sage_setup/docbuild/sphinxbuild.py
> index 1deac3d312..ade37bd80f 100644
> --- a/src/sage_setup/docbuild/sphinxbuild.py
> +++ b/src/sage_setup/docbuild/sphinxbuild.py
> `@``@` -56,6 +56,7 `@``@` class SageSphinxLogger(object):
>              re.compile('WARNING: while setting up extension'),
>              re.compile('WARNING: Any IDs not assiend for figure node'),
>              re.compile('WARNING: .* is not referenced'),
> +            re.compile('WARNING: Build finished.*'),
>              re.compile('language "hu" not supported'),
>              )
>  
> }}}
Yes we could, but I believe we are generating them ourselves a few lines down #23023?replyto=37#comment:33. I think we shouldn't generate them in the first place.


---

Comment by jhpalmieri created at 2017-08-11 15:02:42

These warning messages say "Build finished...". The other line (from comment:33) refers to strings saying "build succeeded...", so I don't think they're the same thing.


---

Comment by fbissey created at 2017-08-12 03:09:33

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2017-08-12 03:09:33

Replying to [comment:41 jhpalmieri]:
> These warning messages say "Build finished...". The other line (from comment:33) refers to strings saying "build succeeded...", so I don't think they're the same thing.

Right you are. So, at the very least back to need review. I find it surprising that there doesn't seem to be an easier way to set smart_quotes but that's the only documented way.


---

Comment by jhpalmieri created at 2017-08-12 05:45:26

Everything else was positively reviewed, so I can't review my own branch. Can you reproduce the doctest failures and verify that the change to sphinxify.py fixes them?

From the docutils documentation, it sounds like there is a command-line switch to turn off smart quotes, but I don't think we can use that since we are not calling docutils from the command line.


---

Comment by fbissey created at 2017-08-12 06:38:06

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2017-08-12 06:38:06

Replying to [comment:43 jhpalmieri]:
> Everything else was positively reviewed, so I can't review my own branch. Can you reproduce the doctest failures and verify that the change to sphinxify.py fixes them?
> 

I can and I already checked.

> From the docutils documentation, it sounds like there is a command-line switch to turn off smart quotes, but I don't think we can use that since we are not calling docutils from the command line.

Yes. I am fairly sure there is a direct way to get sphinx to call docutils with different options but I don't know how to do it.


---

Comment by vbraun created at 2017-08-12 17:45:42

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-08-12 17:45:42

Parallel "make doc-pdf" doesn't work, hangs with N = number of processes python zombies.


---

Comment by jhpalmieri created at 2017-08-12 21:23:02

Replying to [comment:45 vbraun]:
> Parallel "make doc-pdf" doesn't work, hangs with N = number of processes python zombies.

I can't reproduce this on OS X. More silly warning messages, but it completes:

```
[docpdf] Elapsed time: 895.7 seconds.
[docpdf] [website  ] WARNING: Elapsed time: 895.7 seconds.
[docpdf] Done building the documentation!
[docpdf] [website  ] WARNING: Done building the documentation!

real	15m5.280s
user	59m42.040s
sys	3m0.851s
Sage build/upgrade complete!
```



---

Comment by fbissey created at 2017-08-13 01:55:01

Couldn't reproduce it here either on Gentoo at "-j8".


---

Comment by jhpalmieri created at 2017-08-13 03:27:22

And in case it matters, I'm using "-j6".


---

Comment by fbissey created at 2017-08-13 22:58:17

Just got a hicup while doing another test. `typing` wasn't installed in time for building doc-pdf, so dependencies will have to be tweaked.


---

Comment by fbissey created at 2017-08-13 23:40:54

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2017-08-13 23:40:54

That should take care of that last problem, but it doesn't explain Volker's issue that we cannot seem to able to reproduce. I am waiting for more opinions before putting it back to positive.
----
New commits:


---

Comment by jhpalmieri created at 2017-08-14 00:29:36

Should `typing` be a dependency for `sphinx`, or just for doc-building?


---

Comment by fbissey created at 2017-08-14 01:14:49

It is a runtime dependency. You could probably use some functionalities of sphinx without touching `typing`, that's why I put it there rather a dependency of `sphinx` but I gave it some thought.


---

Comment by jhpalmieri created at 2017-08-14 05:20:58

Do we wait for more information, or do we mark this as "positive review" and hope that the dependencies fix the problem?


---

Comment by fbissey created at 2017-08-14 05:23:41

We may as well have another go.


---

Comment by fbissey created at 2017-08-14 05:23:41

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2017-08-14 08:33:35

Replying to [comment:52 fbissey]:
> It is a runtime dependency. You could probably use some functionalities of sphinx without touching `typing`, that's why I put it there rather a dependency of `sphinx` but I gave it some thought.

I agree. You don't need typing just to install Sphinx.


---

Comment by vbraun created at 2017-08-14 22:34:15

Still get the error from `make -j10 doc-pdf`. The docpdf.log contains errors like

```
<sin_plot.png, id=51, 602.25pt x 501.875pt> <use sin_plot.png> [3 [85]]make[2]: *** write jobserver: Bad file descriptor.  Stop.
```

Seems like some script is mucking with the inherited make jobserver file descriptor.


---

Comment by vbraun created at 2017-08-14 22:34:15

Changing status from positive_review to needs_work.


---

Comment by fbissey created at 2017-08-14 22:36:26

That a little bit more to work on than your first report. I'll see if I can trigger this again.


---

Comment by vbraun created at 2017-08-15 06:46:43

Btw which latexmk are you using? 4.52c here...


---

Comment by fbissey created at 2017-08-15 07:22:14

`4.35` here, I can upgrade to see if it has an impact. I may be slow to respond in the next couple of days. The proverbial `s**t` hit the fan at work today.


---

Comment by jhpalmieri created at 2017-08-15 14:37:30

4.52c for me.


---

Comment by fbissey created at 2017-08-20 22:42:35

No difference with `latekmk-4.52c` here.


---

Comment by vbraun created at 2017-08-26 09:58:12

I upgraded to Fedora 26 and can't reproduce it any more...


---

Comment by vbraun created at 2017-08-26 09:58:15

Resolution: fixed


---

Comment by fbissey created at 2017-08-26 10:03:27

Replying to [comment:62 vbraun]:
> I upgraded to Fedora 26 and can't reproduce it any more...

Weird. But glad we are moving forward on that one.


---

Comment by jdemeyer created at 2017-08-28 14:47:48

Thanks for finally getting this done.


---

Comment by dimpase created at 2017-08-31 08:20:32

What is the reason for `typing` package being `standard` rather than `pip` type?


---

Comment by fbissey created at 2017-08-31 08:22:48

Not sure. I cannot say I really ever cared for that particular distinction - sorry.


---

Comment by dimpase created at 2017-08-31 08:26:49

Replying to [comment:67 fbissey]:
> Not sure. I cannot say I really ever cared for that particular distinction - sorry.
In particular, it's about having an extra tarball to care about; (`pip` type, to the contrary, is just a placeholder, no tarball to worry about...)

The only thing I can imagine is that one needs to specify in some standard package that it depends on it (either via Sage deps mechanism, or via pip/setup.py, I suppose...)


---

Comment by fbissey created at 2017-08-31 08:34:36

Right, if you need to download it then it really makes it a special kind of optional package. `typing` is meant to be a standard package so part of the sage tarball.


---

Comment by jdemeyer created at 2017-08-31 08:37:59

Replying to [comment:66 dimpase]:
> What is the reason for `typing` package being `standard` rather than `pip` type?

`standard` packages can depend only on `standard` packages: we do not assume Internet access when building Sage from source.


---

Comment by dimpase created at 2017-08-31 08:53:39

I am stuck on #14645 with a pip package I don't know how to specify, due to "`-`" in its name, namely `sphinxcontrib-websupport`. It cannot be of type `pip`, as `-` is not allowed in the Sage package names, as far as I can tell...


---

Comment by fbissey created at 2017-08-31 08:58:02

And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.


---

Comment by dimpase created at 2017-08-31 09:09:21

Replying to [comment:72 fbissey]:
> And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.

Of course with a standard package you can do anything in principle, but the standard machinery you used it `typing` won't work IMHO, as `sage-pip-install` (i.e. `$PIP_INSTALL` used in `spkg-install`) does not seem to allow
the name of pip package to be installed as an argument...


---

Comment by fbissey created at 2017-08-31 09:25:45

Replying to [comment:73 dimpase]:
> Replying to [comment:72 fbissey]:
> > And can it be a standard package or is it the same problem? In any case that problem should be its own ticket.
> 
> Of course with a standard package you can do anything in principle, but the standard machinery you used it `typing` won't work IMHO, as `sage-pip-install` (i.e. `$PIP_INSTALL` used in `spkg-install`) does not seem to allow
> the name of pip package to be installed as an argument...

We should really have this conversation at #14645 not here. I am not sure what your problem is with `$PIP_INSTALL`. It is a replacement for `python setup.py` in the package source tree. It behaves in a similar way but is better at package management operation (it knows how to remove a previous install properly).


---

Comment by dimpase created at 2017-08-31 09:35:27

I have opened #23764 to deal with this issue. Sorry for noise here.


---

Comment by jhpalmieri created at 2017-09-11 23:03:53

See #23834 for a followup.
