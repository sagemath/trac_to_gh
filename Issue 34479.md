# Issue 34479: fix assertion failure in AdditiveAbelianGroupWrapper._discrete_log_pgroup when group is trivial

Issue created by migration from https://trac.sagemath.org/ticket/34716

Original creator: lorenz

Original creation time: 2022-11-02 17:01:49

As of Sage 9.7, this causes an assertion failure:


```sage
sage: E = EllipticCurve(GF(487^2), [311,205])
sage: G = E.abelian_group().torsion_subgroup(42)
sage: P, Q = G.torsion_subgroup(6).gens()
sage: G.discrete_log(2*P + 3*Q, [P, Q])
```


The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `._discrete_log_pgroup()`. Easy fix.


---

Comment by lorenz created at 2022-11-02 17:02:31

Changing status from new to needs_review.


---

Comment by klee created at 2022-11-03 04:02:18

Wouldn't it be slightly more efficient to put the check in `discrete_log` so that trivial CRT data is discarded?


---

Comment by git created at 2022-11-03 05:35:48

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by lorenz created at 2022-11-03 05:39:20

Thanks, added the check to the loop in `.discrete_log()`. I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p‑group after all, so the function should behave correctly.


---

Comment by klee created at 2022-11-03 06:12:46

Replying to [comment:5 Lorenz Panny]:
> I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p‑group after all, so the function should behave correctly.

As it is a non-public function (whose name starts with an underline) only for internal use, you may restrict the use of the function only for non-trivial p-groups, perhaps just with a comment about the restriction on the input. Thus you may avoid the duplicate check.

But if you still want to keep it for the reason you mentioned, just let me know.


---

Comment by git created at 2022-11-03 06:27:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by lorenz created at 2022-11-03 06:30:33

I don't mind. Done.


---

Comment by klee created at 2022-11-03 12:03:45

Thanks. LGTM.


---

Comment by klee created at 2022-11-03 12:03:45

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-11-07 20:25:22

Resolution: fixed
