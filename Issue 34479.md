# Issue 34479: fix assertion failure in AdditiveAbelianGroupWrapper._discrete_log_pgroup when group is trivial

archive/issues_034479.json:
```json
{
    "body": "As of Sage 9.7, this causes an assertion failure:\n\n\n```sage\nsage: E = EllipticCurve(GF(487^2), [311,205])\nsage: G = E.abelian_group().torsion_subgroup(42)\nsage: P, Q = G.torsion_subgroup(6).gens()\nsage: G.discrete_log(2*P + 3*Q, [P, Q])\n```\n\n\nThe reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `._discrete_log_pgroup()`. Easy fix.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34716\n\n",
    "created_at": "2022-11-02T17:01:49Z",
    "labels": [
        "group theory",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "fix assertion failure in AdditiveAbelianGroupWrapper._discrete_log_pgroup when group is trivial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34479",
    "user": "@yyyyx4"
}
```
As of Sage 9.7, this causes an assertion failure:


```sage
sage: E = EllipticCurve(GF(487^2), [311,205])
sage: G = E.abelian_group().torsion_subgroup(42)
sage: P, Q = G.torsion_subgroup(6).gens()
sage: G.discrete_log(2*P + 3*Q, [P, Q])
```


The reason is that the `p`-power part of the group generated by `P` and `Q` is trivial for some prime(s) `p` dividing the group order, which throws off `._discrete_log_pgroup()`. Easy fix.

Issue created by migration from https://trac.sagemath.org/ticket/34716





---

archive/issue_comments_488245.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-11-02T17:02:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488245",
    "user": "@yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_488246.json:
```json
{
    "body": "Wouldn't it be slightly more efficient to put the check in `discrete_log` so that trivial CRT data is discarded?",
    "created_at": "2022-11-03T04:02:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488246",
    "user": "@kwankyu"
}
```

Wouldn't it be slightly more efficient to put the check in `discrete_log` so that trivial CRT data is discarded?



---

archive/issue_comments_488247.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-11-03T05:35:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488247",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_488248.json:
```json
{
    "body": "Thanks, added the check to the loop in `.discrete_log()`. I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p\u2011group after all, so the function should behave correctly.",
    "created_at": "2022-11-03T05:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488248",
    "user": "@yyyyx4"
}
```

Thanks, added the check to the loop in `.discrete_log()`. I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p‑group after all, so the function should behave correctly.



---

archive/issue_comments_488249.json:
```json
{
    "body": "Replying to [comment:5 Lorenz Panny]:\n> I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p\u2011group after all, so the function should behave correctly.\n\nAs it is a non-public function (whose name starts with an underline) only for internal use, you may restrict the use of the function only for non-trivial p-groups, perhaps just with a comment about the restriction on the input. Thus you may avoid the duplicate check.\n\nBut if you still want to keep it for the reason you mentioned, just let me know.",
    "created_at": "2022-11-03T06:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488249",
    "user": "@kwankyu"
}
```

Replying to [comment:5 Lorenz Panny]:
> I didn't remove the check in `_discrete_log_pgroup()` because the trivial group is a p‑group after all, so the function should behave correctly.

As it is a non-public function (whose name starts with an underline) only for internal use, you may restrict the use of the function only for non-trivial p-groups, perhaps just with a comment about the restriction on the input. Thus you may avoid the duplicate check.

But if you still want to keep it for the reason you mentioned, just let me know.



---

archive/issue_comments_488250.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-11-03T06:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488250",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_488251.json:
```json
{
    "body": "I don't mind. Done.",
    "created_at": "2022-11-03T06:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488251",
    "user": "@yyyyx4"
}
```

I don't mind. Done.



---

archive/issue_comments_488252.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2022-11-03T12:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488252",
    "user": "@kwankyu"
}
```

Thanks. LGTM.



---

archive/issue_comments_488253.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-11-03T12:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488253",
    "user": "@kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_488254.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-11-07T20:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34479",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34479#issuecomment-488254",
    "user": "@vbraun"
}
```

Resolution: fixed
