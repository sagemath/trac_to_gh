# Issue 17759: Missing Source in numerical_approx??

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2015-03-18 22:41:10

CC:  simonking cremona fbissey


```
sage: GaussianIntegers = NumberField(x^2+1, 'I').ring_of_integers()
sage: A = GaussianIntegers([2,1])
sage: A.n??
Type:           builtin_function_or_method
String form:    <built-in method numerical_approx of sage.rings.number_field.number_field_element_quadratic.OrderElement_quadratic object at 0x7f28be1b5410>
Docstring:
   Return a numerical approximation of x with at least prec bits of
   precision.

   EXAMPLES:

      sage: (2/3).n()
      0.666666666666667
      sage: pi.n(digits=10)  # indirect doctest
      3.141592654
      sage: pi.n(prec=20)   # indirect doctest
      3.1416

   TESTS:

   Check that http://trac.sagemath.org/14778 is fixed:

      sage: (0).n(algorithm='foo')
      0.000000000000000

Init docstring: x.__init__(...) initializes x; see help(type(x)) for signature
```

Note that the actual code is missing, it only shows the docstring. But `sage_getsource` does include the method body::

```
sage: print sage.misc.sageinspect.sage_getsource(A.n)
    def numerical_approx(self, prec=None, digits=None, algorithm=None):
        """
        Return a numerical approximation of x with at least prec bits of
        precision.

        EXAMPLES::

            sage: (2/3).n()
            0.666666666666667
            sage: pi.n(digits=10)  # indirect doctest
            3.141592654
            sage: pi.n(prec=20)   # indirect doctest
            3.1416

        TESTS:

        Check that :trac:`14778` is fixed::

            sage: (0).n(algorithm='foo')
            0.000000000000000
        """
        from sage.misc.functional import numerical_approx
        return numerical_approx(self, prec=prec, digits=digits,
                                algorithm=algorithm)
```




---

Comment by SimonKing created at 2015-03-19 08:47:02

I tried the example with sage-6.5.beta4, and it works fine:

```
sage: GaussianIntegers = NumberField(x^2+1, 'I').ring_of_integers()
sage: A = GaussianIntegers([2,1])
sage: A.n??
Type:           builtin_function_or_method
String form:    <built-in method numerical_approx of sage.rings.number_field.number_field_element_quadratic.OrderElement_quadratic object at 0x7f2c4fbb6650>
Definition:     A.n(self, prec=None, digits=None, algorithm=None)
Source:
    def numerical_approx(self, prec=None, digits=None, algorithm=None):
        """
        Return a numerical approximation of x with at least prec bits of
        precision.

        EXAMPLES::

            sage: (2/3).n()
            0.666666666666667
            sage: pi.n(digits=10)
            3.141592654
            sage: pi.n(prec=20)   # 20 bits
            3.1416

        TESTS:

        Check that :trac:`14778` is fixed::

            sage: (0).n(algorithm='foo')
            0.000000000000000
        """
        import sage.misc.functional
        return sage.misc.functional.numerical_approx(self, prec=prec,
                                                     digits=digits,                                                                                                              
                                                     algorithm=algorithm)                                                                                                        

Init docstring: x.__init__(...) initializes x; see help(type(x)) for signature
```

So, we should have a look at changes in sageinspect that have occurred since 6.5.beta4.


---

Comment by jdemeyer created at 2015-03-19 09:48:39

My bet would be something IPython-related.


---

Comment by vbraun created at 2015-03-19 09:55:10

We updated to IPython 3.0 in beta4, and there was nothing that should have impacted the commandline after that.


---

Comment by vbraun created at 2015-03-19 09:56:46

PS: The only change in sageinspect.py was #17900: Setup interrupts in Cython, though that doesn't sound like it should have changed anything either.


---

Comment by vbraun created at 2015-03-22 23:24:35

Changing priority from major to blocker.


---

Comment by vbraun created at 2015-03-25 00:20:50

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-03-25 00:20:50

It was due to the IPython 3 update, they introduced a new function to find the source file that was not aware of Sage's Cython files.
----
New commits:


---

Comment by vbraun created at 2015-03-29 21:47:39

Now would be a good time to review this...


---

Comment by fbissey created at 2015-03-29 22:07:59

Looks good. A cursory look with `grep` seem to indicate that you found everything that needed adjusting. The bot will find anything we missed.


---

Comment by fbissey created at 2015-03-29 22:07:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-03-30 20:28:17

Fails on UW mod:

```
sage -t --long src/sage/repl/ipython_tests.py
**********************************************************************
File "src/sage/repl/ipython_tests.py", line 10, in sage.repl.ipython_tests
Failed example:
    shell.run_cell(u'%pinfo dummy')
[...]
    /mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python2.7/site-packages/IPython/core/page.pyc in _detect_screen_size(screen_lines_def)
        101     # unconditionally reset it every time.  It's cheaper than making
        102     # the checks.
    --> 103     term_flags = termios.tcgetattr(sys.stdout)
        104 
        105     # Curses modifies the stdout buffer size by default, which messes
    <BLANKLINE>
    error: (25, 'Inappropriate ioctl for device')
```



---

Comment by fbissey created at 2015-03-30 20:32:33

Now that's a curious message. Is it the only machine it fails on?


---

Comment by vbraun created at 2015-03-31 10:35:24

Yes, only fails on mod (Linux 2.6.24 :-)

https://github.com/ipython/ipython/pull/8208


---

Comment by git created at 2015-03-31 10:39:30

Changing status from positive_review to needs_review.


---

Comment by git created at 2015-03-31 10:39:30

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by vbraun created at 2015-03-31 23:57:43

Has been merged upstream.


---

Comment by vbraun created at 2015-03-31 23:58:07

Resolution: fixed
