# Issue 26913: Fix Python 3 Sage doctesting

Issue created by migration from https://trac.sagemath.org/ticket/27150

Original creator: vdelecroix

Original creation time: 2019-01-27 17:21:01

CC:  chapoton

running `sage -t` in a Python 2 or Python 3 installation of Sage results in a wrong set of `--optional`

```
$ sage -t XXX
...
Using --optional=dochtml,memlimit,mpir,python2,sage
...
```

In a Python 2 installation the `py2` should be on while on Python 3 it should be `py3`. For now, a lot of doctests are simply ignored by the default `sage -t` command.

See also [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/n0fn8JwtKys).


---

Comment by jdemeyer created at 2019-01-27 17:35:06

It's just a UI issue. Everything is behaving as it should be...


---

Comment by jdemeyer created at 2019-01-27 17:35:06

Changing priority from critical to minor.


---

Comment by vdelecroix created at 2019-01-27 17:37:38

I don't agree: python2 doctesting is also broken. The py2 tag is not in the optional list and hence ignored.


---

Comment by jdemeyer created at 2019-01-27 17:39:53

Are you really sure?


---

Comment by vdelecroix created at 2019-01-27 17:45:01

It depends what you mean by "normal". More precisely:
- the optional `py2/py3` do not appear on the command line due to the filtering in line 1018 of `doctest/control.py`

```
return ",".join(sorted(tags - auto_optional_tags))
```

- the `python2` appears in the list because `python2` is an optional package (is it installed under any circumstances?)

Both look quite artificial to me.

Conclusion: doctests are not broken - behavior is very confusing.


---

Comment by jdemeyer created at 2019-01-27 17:47:42

Changing type from defect to enhancement.


---

Comment by jdemeyer created at 2019-01-27 17:47:42

Everything is working as designed but the design might be confusing. That's why I said that it's an UI issue.


---

Comment by vdelecroix created at 2019-01-27 18:12:26

`@`jeroen: Do you know whether `python2` is always installed? (it got installed on my fresh py3 build). Why is it optional?


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by embray created at 2019-06-14 14:55:02

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by mkoeppe created at 2021-09-07 09:18:07

Outdated, should close


---

Comment by mkoeppe created at 2021-09-07 09:18:07

Changing status from new to needs_review.


---

Comment by chapoton created at 2021-09-07 09:24:31

ok


---

Comment by chapoton created at 2021-09-07 09:24:31

Resolution: invalid
