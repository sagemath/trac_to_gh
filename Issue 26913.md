# Issue 26913: Fix Python 3 Sage doctesting

archive/issues_026913.json:
```json
{
    "body": "CC:  chapoton\n\nrunning `sage -t` in a Python 2 or Python 3 installation of Sage results in a wrong set of `--optional`\n\n```\n$ sage -t XXX\n...\nUsing --optional=dochtml,memlimit,mpir,python2,sage\n...\n```\n\nIn a Python 2 installation the `py2` should be on while on Python 3 it should be `py3`. For now, a lot of doctests are simply ignored by the default `sage -t` command.\n\nSee also [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/n0fn8JwtKys).\n\nIssue created by migration from https://trac.sagemath.org/ticket/27150\n\n",
    "created_at": "2019-01-27T17:21:01Z",
    "labels": [
        "doctest framework",
        "critical",
        "bug"
    ],
    "title": "Fix Python 3 Sage doctesting",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26913",
    "user": "vdelecroix"
}
```
CC:  chapoton

running `sage -t` in a Python 2 or Python 3 installation of Sage results in a wrong set of `--optional`

```
$ sage -t XXX
...
Using --optional=dochtml,memlimit,mpir,python2,sage
...
```

In a Python 2 installation the `py2` should be on while on Python 3 it should be `py3`. For now, a lot of doctests are simply ignored by the default `sage -t` command.

See also [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/n0fn8JwtKys).

Issue created by migration from https://trac.sagemath.org/ticket/27150





---

archive/issue_comments_378622.json:
```json
{
    "body": "It's just a UI issue. Everything is behaving as it should be...",
    "created_at": "2019-01-27T17:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378622",
    "user": "jdemeyer"
}
```

It's just a UI issue. Everything is behaving as it should be...



---

archive/issue_comments_378623.json:
```json
{
    "body": "Changing priority from critical to minor.",
    "created_at": "2019-01-27T17:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378623",
    "user": "jdemeyer"
}
```

Changing priority from critical to minor.



---

archive/issue_comments_378624.json:
```json
{
    "body": "I don't agree: python2 doctesting is also broken. The py2 tag is not in the optional list and hence ignored.",
    "created_at": "2019-01-27T17:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378624",
    "user": "vdelecroix"
}
```

I don't agree: python2 doctesting is also broken. The py2 tag is not in the optional list and hence ignored.



---

archive/issue_comments_378625.json:
```json
{
    "body": "Are you really sure?",
    "created_at": "2019-01-27T17:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378625",
    "user": "jdemeyer"
}
```

Are you really sure?



---

archive/issue_comments_378626.json:
```json
{
    "body": "It depends what you mean by \"normal\". More precisely:\n- the optional `py2/py3` do not appear on the command line due to the filtering in line 1018 of `doctest/control.py`\n\n```\nreturn \",\".join(sorted(tags - auto_optional_tags))\n```\n\n- the `python2` appears in the list because `python2` is an optional package (is it installed under any circumstances?)\n\nBoth look quite artificial to me.\n\nConclusion: doctests are not broken - behavior is very confusing.",
    "created_at": "2019-01-27T17:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378626",
    "user": "vdelecroix"
}
```

It depends what you mean by "normal". More precisely:
- the optional `py2/py3` do not appear on the command line due to the filtering in line 1018 of `doctest/control.py`

```
return ",".join(sorted(tags - auto_optional_tags))
```

- the `python2` appears in the list because `python2` is an optional package (is it installed under any circumstances?)

Both look quite artificial to me.

Conclusion: doctests are not broken - behavior is very confusing.



---

archive/issue_comments_378627.json:
```json
{
    "body": "Changing type from defect to enhancement.",
    "created_at": "2019-01-27T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378627",
    "user": "jdemeyer"
}
```

Changing type from defect to enhancement.



---

archive/issue_comments_378628.json:
```json
{
    "body": "Everything is working as designed but the design might be confusing. That's why I said that it's an UI issue.",
    "created_at": "2019-01-27T17:47:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378628",
    "user": "jdemeyer"
}
```

Everything is working as designed but the design might be confusing. That's why I said that it's an UI issue.



---

archive/issue_comments_378629.json:
```json
{
    "body": "`@`jeroen: Do you know whether `python2` is always installed? (it got installed on my fresh py3 build). Why is it optional?",
    "created_at": "2019-01-27T18:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378629",
    "user": "vdelecroix"
}
```

`@`jeroen: Do you know whether `python2` is always installed? (it got installed on my fresh py3 build). Why is it optional?



---

archive/issue_comments_378630.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378630",
    "user": "embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_378631.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378631",
    "user": "embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_378632.json:
```json
{
    "body": "Outdated, should close",
    "created_at": "2021-09-07T09:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378632",
    "user": "mkoeppe"
}
```

Outdated, should close



---

archive/issue_comments_378633.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-07T09:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378633",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_378634.json:
```json
{
    "body": "ok",
    "created_at": "2021-09-07T09:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378634",
    "user": "chapoton"
}
```

ok



---

archive/issue_comments_378635.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-09-07T09:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26913#issuecomment-378635",
    "user": "chapoton"
}
```

Resolution: invalid
