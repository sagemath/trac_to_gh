# Issue 32255: sage-pip-install: Try installing without --no-deps first

archive/issues_032255.json:
```json
{
    "body": "CC:  @dimpase @seblabbe @jhpalmieri\n\nWe currently use `pip install` with the option `--no-deps` - which suppresses installation of runtime dependencies, as we rely on our own dependency management.\n\nIn order to make package upgrades (which might change dependencies) more robust, we change this to first attempt an install without `--no-deps`. Since we still use `--no-index`, it will not actually install from PyPI but fail with an error.\nWe then issue a warning (for developers) but fall back to the install with `--no-deps` (for robustness for users).\n\n(Prompted by #31280#comment:93, #30974#comment:14)\n\nIssue created by migration from https://trac.sagemath.org/ticket/32492\n\n",
    "created_at": "2021-09-08T17:49:08Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "sage-pip-install: Try installing without --no-deps first",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32255",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @seblabbe @jhpalmieri

We currently use `pip install` with the option `--no-deps` - which suppresses installation of runtime dependencies, as we rely on our own dependency management.

In order to make package upgrades (which might change dependencies) more robust, we change this to first attempt an install without `--no-deps`. Since we still use `--no-index`, it will not actually install from PyPI but fail with an error.
We then issue a warning (for developers) but fall back to the install with `--no-deps` (for robustness for users).

(Prompted by #31280#comment:93, #30974#comment:14)

Issue created by migration from https://trac.sagemath.org/ticket/32492





---

archive/issue_comments_460006.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-09-08T18:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460006",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_460007.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-08T18:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460007",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_460008.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-09-08T18:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460008",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_460009.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-09-08T19:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_460010.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-08T19:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460010",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460011.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-08T19:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460011",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_460012.json:
```json
{
    "body": "Adding #29847 as a dependency, which fixes the venv install for `memory_allocator`",
    "created_at": "2021-09-08T19:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460012",
    "user": "https://github.com/mkoeppe"
}
```

Adding #29847 as a dependency, which fixes the venv install for `memory_allocator`



---

archive/issue_comments_460013.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-09-08T19:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_460014.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-09-08T23:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460014",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_460015.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-08T23:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460015",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460016.json:
```json
{
    "body": "This doesn't quite work as intended. Weirdly, `pip` is ignoring the installed packages if it does not also have access to a package index (we use `--no-index` and also poison proxy variables, so it does not use PyPI).",
    "created_at": "2021-09-09T00:59:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460016",
    "user": "https://github.com/mkoeppe"
}
```

This doesn't quite work as intended. Weirdly, `pip` is ignoring the installed packages if it does not also have access to a package index (we use `--no-index` and also poison proxy variables, so it does not use PyPI).



---

archive/issue_comments_460017.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-09T01:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460017",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460018.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-09T01:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460018",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460019.json:
```json
{
    "body": "This version works for me. It makes use of the previously built wheels that are kept in `$SAGE_VENV/var/lib/sage/wheels/`",
    "created_at": "2021-09-09T01:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460019",
    "user": "https://github.com/mkoeppe"
}
```

This version works for me. It makes use of the previously built wheels that are kept in `$SAGE_VENV/var/lib/sage/wheels/`



---

archive/issue_comments_460020.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-09T01:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460020",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_460021.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-16T01:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460021",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_460022.json:
```json
{
    "body": "This seems to work as advertised. Is there room at some point for a pickier build process that actually produces errors when this kind of thing comes up? (Something that could be used by buildbots or developers working new packages but not the default.)",
    "created_at": "2021-09-17T18:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460022",
    "user": "https://github.com/jhpalmieri"
}
```

This seems to work as advertised. Is there room at some point for a pickier build process that actually produces errors when this kind of thing comes up? (Something that could be used by buildbots or developers working new packages but not the default.)



---

archive/issue_comments_460023.json:
```json
{
    "body": "A related question: how do we convince people to actually check for these warnings?",
    "created_at": "2021-09-17T18:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460023",
    "user": "https://github.com/jhpalmieri"
}
```

A related question: how do we convince people to actually check for these warnings?



---

archive/issue_comments_460024.json:
```json
{
    "body": "I think there's room for escalation in a follow-up ticket, but I think it's safer to first bring it to wider testing by developers in the current form.",
    "created_at": "2021-09-17T18:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460024",
    "user": "https://github.com/mkoeppe"
}
```

I think there's room for escalation in a follow-up ticket, but I think it's safer to first bring it to wider testing by developers in the current form.



---

archive/issue_comments_460025.json:
```json
{
    "body": "I've opened #32529 for this.",
    "created_at": "2021-09-17T18:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460025",
    "user": "https://github.com/mkoeppe"
}
```

I've opened #32529 for this.



---

archive/issue_comments_460026.json:
```json
{
    "body": "I tested this with `ipykernel`. It does indeed print a warning about a missing dependency, and it's not too hard to see from the log file that it's `debugpy`.",
    "created_at": "2021-09-17T22:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460026",
    "user": "https://github.com/jhpalmieri"
}
```

I tested this with `ipykernel`. It does indeed print a warning about a missing dependency, and it's not too hard to see from the log file that it's `debugpy`.



---

archive/issue_comments_460027.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-17T22:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460027",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_460028.json:
```json
{
    "body": "Thanks for reviewing!",
    "created_at": "2021-09-17T23:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460028",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for reviewing!



---

archive/issue_events_086189.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-25T23:18:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32255#event-86189"
}
```



---

archive/issue_comments_460029.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-25T23:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32255",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32255#issuecomment-460029",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
