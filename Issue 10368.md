# Issue 10368: Yet another bug in factorization over number fields

Issue created by migration from Trac.

Original creator: lftabera

Original creation time: 2010-12-02 15:15:28

Assignee: tbd

CC:  jdemeyer

Keywords: factorization, number fields

I have found several issues factoring polynomials over number fields. This time pari seems to work ok, so it is not related to #10279



```
sage: N.<a>=NumberField(x^6+x^5+x^4+x^3+x^2+x+1)
sage: K.<t>=N[]
sage: l = (-1/7*a^5 - 1/7*a^4 - 1/7*a^3 - 1/7*a^2 - 2/7*a - 1/7)*t^10 + (4/7*a^5 - 2/7*a^4 - 2/7*a^3 - 2/7*a^2 - 2/7*a - 6/7)*t^9 + (90/49*a^5 + 152/49*a^4 + 18/49*a^3 + 24/49*a^2 + 30/49*a + 36/49)*t^8 + (-10/49*a^5 + 10/7*a^4 + 198/49*a^3 - 102/49*a^2 - 60/49*a - 26/49)*t^7 + (40/49*a^5 + 45/49*a^4 + 60/49*a^3 + 277/49*a^2 - 204/49*a - 78/49)*t^6 + (90/49*a^5 + 110/49*a^4 + 2*a^3 + 80/49*a^2 + 46/7*a - 30/7)*t^5 + (30/7*a^5 + 260/49*a^4 + 250/49*a^3 + 232/49*a^2 + 32/7*a + 8)*t^4 + (-184/49*a^5 - 58/49*a^4 - 52/49*a^3 - 66/49*a^2 - 72/49*a - 72/49)*t^3 + (18/49*a^5 - 32/49*a^4 + 10/49*a^3 + 4/49*a^2)*t^2 + (2/49*a^4 - 4/49*a^3 + 2/49*a^2)*t
sage: factor(l)
```


Depending on the execution I get two answers

wrong answer:


```
(-1/7*a^5 - 1/7*a^4 - 1/7*a^3 - 1/7*a^2 - 2/7*a - 1/7) * t^4 * (t^6 + (-19/7*a^5 - 17/7*a^4 - 15/7*a^3 - 13/7*a^2 - 11/7*a - 9/7)*t^5 + (2*a^5 - 10/7*a^4 - 16/7*a^3 + 10/7*a^2 - 2/7*a + 18/7)*t^4 + (-40/7*a^5 - 8/7*a^4 - 40/7*a^3 - 48/7*a^2 - 32/7)*t^3 + (26/7*a^5 - 6/7*a^4 + 26/7*a^3 - 6/7*a^2 - 4/7*a + 34/7)*t^2 + (-20/7*a^5 - 4/7*a^4 - 20/7*a^3 - 4/7*a^2 - 20/7*a - 16/7)*t + 2/7*a^5 - 2/7*a^4 + 2/7*a^3 - 2/7*a^2 + 2/7*a - 2/7)
```


solution that looks right:


```
(-1/7*a^5 - 1/7*a^4 - 1/7*a^3 - 1/7*a^2 - 2/7*a - 1/7) * t * (t - a^5 - a^4 - a^3 - a^2 - a - 1)^4 * (t^5 + (-12/7*a^5 - 10/7*a^4 - 8/7*a^3 - 6/7*a^2 - 4/7*a - 2/7)*t^4 + (12/7*a^5 - 8/7*a^3 + 16/7*a^2 + 2/7*a + 20/7)*t^3 + (-20/7*a^5 - 20/7*a^3 - 20/7*a^2 + 4/7*a - 2)*t^2 + (12/7*a^5 + 12/7*a^3 + 2/7*a + 16/7)*t - 4/7*a^5 - 4/7*a^3 - 4/7*a - 2/7)
```


With pari I only get the second answer, so it looks like a sage problem.

Next example is different:


```
sage: l2 = (-1/7*a^5 - 1/7*a^4 - 1/7*a^3 - 1/7*a^2 - 2/7*a - 1/7)*t^10 + (4/7*a^5 - 2/7*a^4 - 2/7*a^3 - 2/7*a^2 - 2/7*a - 6/7)*t^9 + (90/49*a^5 + 152/49*a^4 + 18/49*a^3 + 24/49*a^2 + 30/49*a + 36/49)*t^8 + (-10/49*a^5 + 10/7*a^4 + 198/49*a^3 - 102/49*a^2 - 60/49*a - 26/49)*t^7 + (40/49*a^5 + 45/49*a^4 + 60/49*a^3 + 277/49*a^2 - 204/49*a - 78/49)*t^6 + (90/49*a^5 + 110/49*a^4 + 2*a^3 + 80/49*a^2 + 46/7*a - 30/7)*t^5 + (30/7*a^5 + 260/49*a^4 + 250/49*a^3 + 232/49*a^2 + 32/7*a + 8)*t^4 + (-184/49*a^5 - 58/49*a^4 - 52/49*a^3 - 66/49*a^2 - 72/49*a - 72/49)*t^3 + (18/49*a^5 - 32/49*a^4 + 10/49*a^3 + 4/49*a^2)*t^2 + (2/49*a^4 - 4/49*a^3 + 2/49*a^2)*t
```


The pari released with sage computes the factorization without problems, but trying to compute the factorization with sage the program starts to eat all available ram and you have to kill the program.


---

Comment by fwclarke created at 2010-12-10 13:41:20

I think this is very likely a pari bug, and is the same one ([http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1132](http://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=1132)) that was fixed in response to #10279.  If I'm right, it would be solved by #10430.

This is the simplest example (of the first problem) that I have found:


```
trousseau-bash% sage-4.6/sage
----------------------------------------------------------------------
----------------------------------------------------------------------
sage: L.<a> = QuadraticField(3)
sage: PL.<y> = L[]
sage: (y*(y^2 - (1 + a)/3)*(y^2 - a/2)^2).factor()
y^3 * (y^4 + (-5/6*a - 1/3)*y^2 + 1/6*a + 1/2)
```

This is the equivalent in pari (producing the same erroneous result):
| Sage Version 4.6, Release Date: 2010-10-30                         |
| Type notebook() for the GUI, and license() for information.        |

```
trousseau-bash% sage-4.6/sage -gp
                   GP/PARI CALCULATOR Version 2.4.3 (development svn-12577:12605)
                    i386 running darwin (x86-64/GMP-4.2.1 kernel) 64-bit version
...
parisize = 8000000, primelimit = 500509
? K = nfinit(a^2 - 3);
? f = x*(x^2 + Mod(-(a + 1)/3, a^2 - 3))*(x^2 + Mod(-a/2, a^2 - 3))^2;
? nffactor(K, f)
%1 = 
[x 3]

[x^4 + Mod(-5/6*a - 1/3, a^2 - 3)*x^2 + Mod(1/6*a + 1/2, a^2 - 3) 1]

```

But with the version of pari in sage 4.5.3 the result is correct:


```
trousseau-bash% sage-4.5.3/sage -gp
                            GP/PARI CALCULATOR Version 2.3.5 (released)
                    i386 running darwin (x86-64/GMP-4.2.1 kernel) 64-bit version
 ...
parisize = 8000000, primelimit = 500000
? K = nfinit(a^2 - 3);
? f = x*(x^2 + Mod(-(a + 1)/3, a^2 - 3))*(x^2 + Mod(-a/2, a^2 - 3))^2;
? nffactor(K, f)
%1 = 
[x 1]

[x^2 + Mod(-1/2*a, a^2 - 3) 2]

[x^2 + Mod(-1/3*a - 1/3, a^2 - 3) 1]

```



---

Comment by jdemeyer created at 2010-12-10 13:53:58

To the submitter of the bug: your `l` and `l2` in the report are the same and this is probably not what you meant.

I can confirm that the first bug involving `l` is indeed fixed by #10430.


---

Comment by lftabera created at 2010-12-10 17:04:48

Interesting, I was not able to reproduce the problem in gp. But being a pari bug makes sense.

I have corrected the second example, with gp I have no problems to factor the polynomial. Maybe the problem is with libpari.


---

Attachment


---

Comment by jdemeyer created at 2010-12-10 22:04:41

Changing status from new to needs_review.


---

Comment by lftabera created at 2010-12-15 12:50:39

Changing status from needs_review to positive_review.


---

Comment by lftabera created at 2010-12-15 12:50:39

I confirm that the patch solves the problems mentioned for these cases and also some others I have found. With the latests versions of PARI we do not need to be so careful with non-monic polynomials. In the future we may consider eliminating the unit parameter from _factor_pari_helper. It is used right now in a few other places right now though.

The patch also includes some documentation corrections.

Depends on: #10430, #10279. 

Positive review.


---

Comment by jdemeyer created at 2011-01-19 22:23:11

Resolution: fixed


---

Comment by jdemeyer created at 2011-01-20 09:11:08

Changing status from closed to new.


---

Comment by jdemeyer created at 2011-01-20 09:11:08

Resolution changed from fixed to 


---

Comment by jdemeyer created at 2011-01-20 09:11:17

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2011-01-20 09:11:26

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-01-25 08:15:43

Resolution: fixed
