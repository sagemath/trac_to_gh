# Issue 33082: polynomial rings should not attempt to use Singular in characteristic >= 2^31

archive/issues_033082.json:
```json
{
    "body": "Example:\n\n```\nsage: R.<x,y> = GF(2147483659^2)[]\nsage: x.resultant(y)\n# [...]\nTypeError: Singular error:\n   ? Wrong or unknown ground field specification\n   ? cannot make ring\n   ? error occurred in or before STDIN line 14: `ring sage8=(2147483659,z2),(x, y),dp;`\n   ? expected ring-expression. type 'help ring;'\n```\n\n\nReason: `can_convert_to_singular()` only checks that the characteristic is small for *prime* fields, but Singular equally can't handle base rings of large composite characteristic and non-prime finite fields of large characteristic.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33319\n\n",
    "created_at": "2022-02-10T04:04:18Z",
    "labels": [
        "component: algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "polynomial rings should not attempt to use Singular in characteristic >= 2^31",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33082",
    "user": "https://github.com/yyyyx4"
}
```
Example:

```
sage: R.<x,y> = GF(2147483659^2)[]
sage: x.resultant(y)
# [...]
TypeError: Singular error:
   ? Wrong or unknown ground field specification
   ? cannot make ring
   ? error occurred in or before STDIN line 14: `ring sage8=(2147483659,z2),(x, y),dp;`
   ? expected ring-expression. type 'help ring;'
```


Reason: `can_convert_to_singular()` only checks that the characteristic is small for *prime* fields, but Singular equally can't handle base rings of large composite characteristic and non-prime finite fields of large characteristic.

Issue created by migration from https://trac.sagemath.org/ticket/33319





---

archive/issue_comments_471005.json:
```json
{
    "body": "The individual commits should be easier to understand than the overall diff.\n----\nNew commits:",
    "created_at": "2022-02-12T06:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471005",
    "user": "https://github.com/yyyyx4"
}
```

The individual commits should be easier to understand than the overall diff.
----
New commits:



---

archive/issue_comments_471006.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-12T06:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471006",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_471007.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-02-21T06:09:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_471008.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-21T06:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471009.json:
```json
{
    "body": "I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.\n\nThere are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something. The adding of the fallback warnings might need some justification.",
    "created_at": "2022-02-22T08:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471009",
    "user": "https://github.com/tscrim"
}
```

I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.

There are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something. The adding of the fallback warnings might need some justification.



---

archive/issue_comments_471010.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-23T05:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471010",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471011.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> There are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something.\n\nIndeed, they were subtly indicating a missing `)` in one of the Singular commands. :-)\n\n\n> I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.\n\nI agree, but I couldn't think of any situation where this code would be a performance bottleneck: The biggest part of the time is spent on waiting for the Singular interface anyway, and do users really construct tons of polynomial rings in a tight loop?\n\nSome benchmarking shows that the new branch is indeed a tiny bit slower than before:\n\n```\nsage: R = PolynomialRing(QQ, 'x,y,z', implementation='singular')\nsage: %timeit R._singular_init_()\n```\n\n...reports ~400\u00b5s on this branch, compared to ~390\u00b5s before. I don't really think this matters, but if you prefer I can try to move the function back to the cythonized file (ideally while keeping only a single copy).",
    "created_at": "2022-02-23T05:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471011",
    "user": "https://github.com/yyyyx4"
}
```

Replying to [comment:5 tscrim]:
> There are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something.

Indeed, they were subtly indicating a missing `)` in one of the Singular commands. :-)


> I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.

I agree, but I couldn't think of any situation where this code would be a performance bottleneck: The biggest part of the time is spent on waiting for the Singular interface anyway, and do users really construct tons of polynomial rings in a tight loop?

Some benchmarking shows that the new branch is indeed a tiny bit slower than before:

```
sage: R = PolynomialRing(QQ, 'x,y,z', implementation='singular')
sage: %timeit R._singular_init_()
```

...reports ~400µs on this branch, compared to ~390µs before. I don't really think this matters, but if you prefer I can try to move the function back to the cythonized file (ideally while keeping only a single copy).



---

archive/issue_comments_471012.json:
```json
{
    "body": "Replying to [comment:7 lorenz]:\n> Replying to [comment:5 tscrim]:\n> > There are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something.\n> \n> Indeed, they were subtly indicating a missing `)` in one of the Singular commands. :-)\n\nI am glad it helped.\n\n> > I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.\n> \n> I agree, but I couldn't think of any situation where this code would be a performance bottleneck: The biggest part of the time is spent on waiting for the Singular interface anyway, and do users really construct tons of polynomial rings in a tight loop?\n\nAh, I thought it was for polynomials, not the rings. I agree with you fully and you can disregard my comment.\n\nIf the bot comes back green, then it is a positive review.",
    "created_at": "2022-02-23T05:53:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471012",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:7 lorenz]:
> Replying to [comment:5 tscrim]:
> > There are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something.
> 
> Indeed, they were subtly indicating a missing `)` in one of the Singular commands. :-)

I am glad it helped.

> > I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.
> 
> I agree, but I couldn't think of any situation where this code would be a performance bottleneck: The biggest part of the time is spent on waiting for the Singular interface anyway, and do users really construct tons of polynomial rings in a tight loop?

Ah, I thought it was for polynomials, not the rings. I agree with you fully and you can disregard my comment.

If the bot comes back green, then it is a positive review.



---

archive/issue_comments_471013.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-24T05:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471014.json:
```json
{
    "body": "Patchbot is morally green (though I'm not sure what's up with the one failure\u2009\u2014\u2009it appears to be somewhat consistent, but is probably unrelated to these changes?).\n\nI applied two more small tweaks to hopefully make the patchbot plugins happy too.",
    "created_at": "2022-02-24T05:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471014",
    "user": "https://github.com/yyyyx4"
}
```

Patchbot is morally green (though I'm not sure what's up with the one failure — it appears to be somewhat consistent, but is probably unrelated to these changes?).

I applied two more small tweaks to hopefully make the patchbot plugins happy too.



---

archive/issue_comments_471015.json:
```json
{
    "body": "Thank you.",
    "created_at": "2022-02-24T06:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471015",
    "user": "https://github.com/tscrim"
}
```

Thank you.



---

archive/issue_comments_471016.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-24T06:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471016",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_471017.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-02-24T19:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471017",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_471018.json:
```json
{
    "body": "Merge failure on top of:\n\n02f0da0fc4 Trac #33272: Update sphinx to 4.4\n\n7594fe2b4d Trac #33165: faster evaluation of polynomials in R[x] at monomials in R[y] or R[u,v] and variables in R[x]/(f)\n\n73b75c36bb Trac #33001: Invoke manifolds with structure more conveniently\n\n2b980bc727 Trac #32958: findstat: enforce limit on how many elements to compute\n\nf690435a7f Trac #32953: Sphere: improve handling of default charts\n\naffaa06c9a Trac #32644: Typos in documentation of sage/modular/quasimodform\n\n1491ab2b23 Trac #31576: Projective points over rings with zero divisors\n\n05e75749d5 Trac #31355: upgrade lrcalc to 2.1\n\n4c5660bae4 Trac #30680: Finitely presented modules over the Steenrod algebra\n\n472e893b31 Trac #29927: shifting issue in padic _set_from_list functions\n\n1f683e92f7 Trac #29215: valuation error\n\nad663d9393 Trac #22081: Add new option to hyperbolic graphics to select the model\n\nca4c2aa62c Trac #33390: singular spkg-configure.m4: Better test for help\n\n58e2a16d8c Trac #33390: singular spkg-configure.m4: Better test for help\n\nb96b86a4bc Trac #33377: GenericGraph.[weighted]adjacency_matrix, incidence_matrix: Accept keyword arguments for matrix constructor\n\n5705d221fd Trac #33374: adjust error messages in algebras/\n\nf71a59cf4d Trac #33367: Adjust some error messages in `combinat/`\n\nd2b071e65f Trac #33364: remove traces of # py3 and some # py2\n\n518f9fc106 Trac #33358: Fix for rename of conda e-antic package to libeantic\n\n7abda14ee4 Trac #33357: Random set partition with fixed block sizes does not respect the constraint and other improvements\n\nb17a291d87 Trac #33353: increase tolerance of doctests in modular/modform/numerical.py\n\nbfa90bbd18 Trac #33351: raw docs and other pycodestyle details in some pyx files\n\n09c55f3d97 Trac #33349: a few details in designs\n\ned86487af3 Trac #33342: fix indentation in toy_variety.py\n\n2fd405438b Trac #33341: pycodestyle cleaning in convolution.py\n\n016f864459 Trac #33336: Fix deprecation warning with scipy 1.8.\n\na64514b5ce Trac #33335: fix E111 (indentation) in geometry, groups, logic, matrix\n\naa255bf264 Trac #33334: fix E111 (indentation) in rings\n\nb35def6864 Trac #33333: Deduplicate package names in installation guide\n\ndf13563584 Trac #33332: fix E111 (indentation) in dynamics, numerical, modules, interfaces\n\nfd2d77c807 Trac #33328: Some improvements for signed permutations\n\n9d77db7871 Trac #33323: Cardinality of partitions of negative values\n\n567da5a2d4 Trac #33309: Make Sage documentation functional\n\n70505410c7 Trac #33247: Restore quiet in `./configure -q`\n\n56c6240253 Trac #33149: use lazy_string() for string formatting when creating exceptions\n\n5bf1f88d7b Trac #32465: Refactor {Matrix,Vector}_double_dense through ..._numpy_dense, add ..._numpy_integer_dense\n\n72f573e606 Trac #30649: Reimplement \"sage -p SPKG\" as \"cd $SAGE_ROOT && make SPKG-no-deps\"\n\n9941688328 Trac #33150: more direct conversion from QQbar to real and complex ball fields\n\nd08b099239 Trac #33127: Fix warning about missing sage-site when SAGE_ROOT is removed after installation\n\nf456256a0a Trac #33100: is_positive_definite returns wrong results\n\nca6ac0bcd0 Trac #33054: conda-forge (linux): primecount fails to install\n\n347ee9349c Trac #32987: Deprecate sage.misc.misc.sage_makedirs\n\n433e4d9eb2 Trac #30252: Make TensorProducts of finite-dimensional modules / vector spaces finite-dimensional\n\n29b0897532 Trac #32965: tox / GH Actions: Add centos-7-devtoolset-gcc_{9,10,11}\n\n15c8011dd0 Updated [SageMath](SageMath) version to 9.6.beta2\n\n\n\nmerge was not clean: conflicts in src/sage/rings/polynomial/polynomial_singular_interface.py",
    "created_at": "2022-02-24T19:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471018",
    "user": "https://github.com/vbraun"
}
```

Merge failure on top of:

02f0da0fc4 Trac #33272: Update sphinx to 4.4

7594fe2b4d Trac #33165: faster evaluation of polynomials in R[x] at monomials in R[y] or R[u,v] and variables in R[x]/(f)

73b75c36bb Trac #33001: Invoke manifolds with structure more conveniently

2b980bc727 Trac #32958: findstat: enforce limit on how many elements to compute

f690435a7f Trac #32953: Sphere: improve handling of default charts

affaa06c9a Trac #32644: Typos in documentation of sage/modular/quasimodform

1491ab2b23 Trac #31576: Projective points over rings with zero divisors

05e75749d5 Trac #31355: upgrade lrcalc to 2.1

4c5660bae4 Trac #30680: Finitely presented modules over the Steenrod algebra

472e893b31 Trac #29927: shifting issue in padic _set_from_list functions

1f683e92f7 Trac #29215: valuation error

ad663d9393 Trac #22081: Add new option to hyperbolic graphics to select the model

ca4c2aa62c Trac #33390: singular spkg-configure.m4: Better test for help

58e2a16d8c Trac #33390: singular spkg-configure.m4: Better test for help

b96b86a4bc Trac #33377: GenericGraph.[weighted]adjacency_matrix, incidence_matrix: Accept keyword arguments for matrix constructor

5705d221fd Trac #33374: adjust error messages in algebras/

f71a59cf4d Trac #33367: Adjust some error messages in `combinat/`

d2b071e65f Trac #33364: remove traces of # py3 and some # py2

518f9fc106 Trac #33358: Fix for rename of conda e-antic package to libeantic

7abda14ee4 Trac #33357: Random set partition with fixed block sizes does not respect the constraint and other improvements

b17a291d87 Trac #33353: increase tolerance of doctests in modular/modform/numerical.py

bfa90bbd18 Trac #33351: raw docs and other pycodestyle details in some pyx files

09c55f3d97 Trac #33349: a few details in designs

ed86487af3 Trac #33342: fix indentation in toy_variety.py

2fd405438b Trac #33341: pycodestyle cleaning in convolution.py

016f864459 Trac #33336: Fix deprecation warning with scipy 1.8.

a64514b5ce Trac #33335: fix E111 (indentation) in geometry, groups, logic, matrix

aa255bf264 Trac #33334: fix E111 (indentation) in rings

b35def6864 Trac #33333: Deduplicate package names in installation guide

df13563584 Trac #33332: fix E111 (indentation) in dynamics, numerical, modules, interfaces

fd2d77c807 Trac #33328: Some improvements for signed permutations

9d77db7871 Trac #33323: Cardinality of partitions of negative values

567da5a2d4 Trac #33309: Make Sage documentation functional

70505410c7 Trac #33247: Restore quiet in `./configure -q`

56c6240253 Trac #33149: use lazy_string() for string formatting when creating exceptions

5bf1f88d7b Trac #32465: Refactor {Matrix,Vector}_double_dense through ..._numpy_dense, add ..._numpy_integer_dense

72f573e606 Trac #30649: Reimplement "sage -p SPKG" as "cd $SAGE_ROOT && make SPKG-no-deps"

9941688328 Trac #33150: more direct conversion from QQbar to real and complex ball fields

d08b099239 Trac #33127: Fix warning about missing sage-site when SAGE_ROOT is removed after installation

f456256a0a Trac #33100: is_positive_definite returns wrong results

ca6ac0bcd0 Trac #33054: conda-forge (linux): primecount fails to install

347ee9349c Trac #32987: Deprecate sage.misc.misc.sage_makedirs

433e4d9eb2 Trac #30252: Make TensorProducts of finite-dimensional modules / vector spaces finite-dimensional

29b0897532 Trac #32965: tox / GH Actions: Add centos-7-devtoolset-gcc_{9,10,11}

15c8011dd0 Updated [SageMath](SageMath) version to 9.6.beta2



merge was not clean: conflicts in src/sage/rings/polynomial/polynomial_singular_interface.py



---

archive/issue_comments_471019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-01T05:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471020.json:
```json
{
    "body": "Trivial merge, but let's see what the patchbot says.",
    "created_at": "2022-03-01T08:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471020",
    "user": "https://github.com/yyyyx4"
}
```

Trivial merge, but let's see what the patchbot says.



---

archive/issue_comments_471021.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-01T08:06:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471021",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_471022.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-01T12:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471022",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_471023.json:
```json
{
    "body": "Morally green.",
    "created_at": "2022-03-01T12:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471023",
    "user": "https://github.com/tscrim"
}
```

Morally green.



---

archive/issue_events_029941.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2022-03-03T22:19:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33082#event-29941"
}
```



---

archive/issue_comments_471024.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-03T22:19:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33082",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33082#issuecomment-471024",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
