# Issue 33082: polynomial rings should not attempt to use Singular in characteristic >= 2^31

Issue created by migration from https://trac.sagemath.org/ticket/33319

Original creator: lorenz

Original creation time: 2022-02-10 04:04:18

Example:

```
sage: R.<x,y> = GF(2147483659^2)[]
sage: x.resultant(y)
# [...]
TypeError: Singular error:
   ? Wrong or unknown ground field specification
   ? cannot make ring
   ? error occurred in or before STDIN line 14: `ring sage8=(2147483659,z2),(x, y),dp;`
   ? expected ring-expression. type 'help ring;'
```


Reason: `can_convert_to_singular()` only checks that the characteristic is small for _prime_ fields, but Singular equally can't handle base rings of large composite characteristic and non-prime finite fields of large characteristic.


---

Comment by lorenz created at 2022-02-12 06:34:20

The individual commits should be easier to understand than the overall diff.
----
New commits:


---

Comment by lorenz created at 2022-02-12 06:34:20

Changing status from new to needs_review.


---

Comment by git created at 2022-02-21 06:09:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-02-21 06:09:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-02-22 08:24:13

I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.

There are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something. The adding of the fallback warnings might need some justification.


---

Comment by git created at 2022-02-23 05:34:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-02-23 05:47:49

Replying to [comment:5 tscrim]:
> There are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something.

Indeed, they were subtly indicating a missing `)` in one of the Singular commands. :-)


> I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.

I agree, but I couldn't think of any situation where this code would be a performance bottleneck: The biggest part of the time is spent on waiting for the Singular interface anyway, and do users really construct tons of polynomial rings in a tight loop?

Some benchmarking shows that the new branch is indeed a tiny bit slower than before:

```
sage: R = PolynomialRing(QQ, 'x,y,z', implementation='singular')
sage: %timeit R._singular_init_()
```

...reports ~400µs on this branch, compared to ~390µs before. I don't really think this matters, but if you prefer I can try to move the function back to the cythonized file (ideally while keeping only a single copy).


---

Comment by tscrim created at 2022-02-23 05:53:51

Replying to [comment:7 lorenz]:
> Replying to [comment:5 tscrim]:
> > There are a number of doctest failures. Most appear to be trivial, but they might be subtly indicating something.
> 
> Indeed, they were subtly indicating a missing `)` in one of the Singular commands. :-)

I am glad it helped.

> > I am not sure I entirely like moving something from Cython that could be called a lot to a Python function. I understand it would be easier to maintain, but I am not sure it is worth the potential speed tradeoff since this is a fairly important part of Sage. This isn't a strong opinion, but it is something to consider.
> 
> I agree, but I couldn't think of any situation where this code would be a performance bottleneck: The biggest part of the time is spent on waiting for the Singular interface anyway, and do users really construct tons of polynomial rings in a tight loop?

Ah, I thought it was for polynomials, not the rings. I agree with you fully and you can disregard my comment.

If the bot comes back green, then it is a positive review.


---

Comment by git created at 2022-02-24 05:57:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-02-24 05:59:30

Patchbot is morally green (though I'm not sure what's up with the one failure — it appears to be somewhat consistent, but is probably unrelated to these changes?).

I applied two more small tweaks to hopefully make the patchbot plugins happy too.


---

Comment by tscrim created at 2022-02-24 06:16:55

Thank you.


---

Comment by tscrim created at 2022-02-24 06:16:55

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-02-24 19:03:32

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-02-24 19:03:32

Merge failure on top of:

02f0da0fc4 Trac #33272: Update sphinx to 4.4

7594fe2b4d Trac #33165: faster evaluation of polynomials in R[x] at monomials in R[y] or R[u,v] and variables in R[x]/(f)

73b75c36bb Trac #33001: Invoke manifolds with structure more conveniently

2b980bc727 Trac #32958: findstat: enforce limit on how many elements to compute

f690435a7f Trac #32953: Sphere: improve handling of default charts

affaa06c9a Trac #32644: Typos in documentation of sage/modular/quasimodform

1491ab2b23 Trac #31576: Projective points over rings with zero divisors

05e75749d5 Trac #31355: upgrade lrcalc to 2.1

4c5660bae4 Trac #30680: Finitely presented modules over the Steenrod algebra

472e893b31 Trac #29927: shifting issue in padic _set_from_list functions

1f683e92f7 Trac #29215: valuation error

ad663d9393 Trac #22081: Add new option to hyperbolic graphics to select the model

ca4c2aa62c Trac #33390: singular spkg-configure.m4: Better test for help

58e2a16d8c Trac #33390: singular spkg-configure.m4: Better test for help

b96b86a4bc Trac #33377: GenericGraph.[weighted]adjacency_matrix, incidence_matrix: Accept keyword arguments for matrix constructor

5705d221fd Trac #33374: adjust error messages in algebras/

f71a59cf4d Trac #33367: Adjust some error messages in `combinat/`

d2b071e65f Trac #33364: remove traces of # py3 and some # py2

518f9fc106 Trac #33358: Fix for rename of conda e-antic package to libeantic

7abda14ee4 Trac #33357: Random set partition with fixed block sizes does not respect the constraint and other improvements

b17a291d87 Trac #33353: increase tolerance of doctests in modular/modform/numerical.py

bfa90bbd18 Trac #33351: raw docs and other pycodestyle details in some pyx files

09c55f3d97 Trac #33349: a few details in designs

ed86487af3 Trac #33342: fix indentation in toy_variety.py

2fd405438b Trac #33341: pycodestyle cleaning in convolution.py

016f864459 Trac #33336: Fix deprecation warning with scipy 1.8.

a64514b5ce Trac #33335: fix E111 (indentation) in geometry, groups, logic, matrix

aa255bf264 Trac #33334: fix E111 (indentation) in rings

b35def6864 Trac #33333: Deduplicate package names in installation guide

df13563584 Trac #33332: fix E111 (indentation) in dynamics, numerical, modules, interfaces

fd2d77c807 Trac #33328: Some improvements for signed permutations

9d77db7871 Trac #33323: Cardinality of partitions of negative values

567da5a2d4 Trac #33309: Make Sage documentation functional

70505410c7 Trac #33247: Restore quiet in `./configure -q`

56c6240253 Trac #33149: use lazy_string() for string formatting when creating exceptions

5bf1f88d7b Trac #32465: Refactor {Matrix,Vector}_double_dense through ..._numpy_dense, add ..._numpy_integer_dense

72f573e606 Trac #30649: Reimplement "sage -p SPKG" as "cd $SAGE_ROOT && make SPKG-no-deps"

9941688328 Trac #33150: more direct conversion from QQbar to real and complex ball fields

d08b099239 Trac #33127: Fix warning about missing sage-site when SAGE_ROOT is removed after installation

f456256a0a Trac #33100: is_positive_definite returns wrong results

ca6ac0bcd0 Trac #33054: conda-forge (linux): primecount fails to install

347ee9349c Trac #32987: Deprecate sage.misc.misc.sage_makedirs

433e4d9eb2 Trac #30252: Make TensorProducts of finite-dimensional modules / vector spaces finite-dimensional

29b0897532 Trac #32965: tox / GH Actions: Add centos-7-devtoolset-gcc_{9,10,11}

15c8011dd0 Updated [SageMath](SageMath) version to 9.6.beta2



merge was not clean: conflicts in src/sage/rings/polynomial/polynomial_singular_interface.py


---

Comment by git created at 2022-03-01 05:33:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by lorenz created at 2022-03-01 08:06:27

Trivial merge, but let's see what the patchbot says.


---

Comment by lorenz created at 2022-03-01 08:06:27

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2022-03-01 12:05:02

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-03-01 12:05:02

Morally green.


---

Comment by vbraun created at 2022-03-03 22:19:50

Resolution: fixed
