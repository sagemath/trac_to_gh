# Issue 28052: Settings in ipython_config.py can cause tests to fail

Issue created by migration from https://trac.sagemath.org/ticket/28289

Original creator: embray

Original creation time: 2019-07-30 09:54:04

For example, I modify `~/.sage/ipython-5.0.0/profile_default/ipython_config.py` to set the `c.TerminalInteractiveShell.colors` to a different value, and get test failures in REPL tests where different terminal color codes are output than expected.

There's all kinds of other ways, I'm sure, that different ipython_config.py settings could cause tests to fail.

Loading this file should be prevented when running the tests.  

It occurs to me now that this is the cause of some of the failures reported in #25361, since the Windows installer sets some specific defaults in ipython_config.py.


---

Comment by embray created at 2019-11-08 11:10:24

Changing priority from major to minor.


---

Comment by embray created at 2019-11-08 11:24:59

Changing status from new to needs_review.


---

Comment by embray created at 2019-11-08 11:24:59

This is a slightly softer approach, for now, than completely disabling loading of `ipython_config.py`.  I realized that the `get_test_shell()` used in the tests does apply a default configuration to the options that are known to affect the tests.  However, it only applied this configuration to the `InteractiveShell` class, and not to its subclass `TerminalInteractiveShell`.

Applying the default config to `TerminalInteractiveShell` as well fixes the immediate problems I was seeing so this is good-enough for now.
----
New commits:


---

Comment by @mwageringel created at 2019-12-01 16:42:35

Changing status from needs_review to positive_review.


---

Comment by @mwageringel created at 2019-12-01 16:42:35

Ok, this looks good to me. Though note that you can configure IPython options in your `init.sage` file instead which does not get sourced during tests. For example I have

```
%config TerminalInteractiveShell.colors = 'Neutral'
```

to get correct colors in embedded shells like in interact mode of the interfaces.


---

Comment by embray created at 2019-12-02 11:40:42

Thanks, that's good to know.  Though in the case of the Windows version of Sage there are some defaults set in an ipython_config.py that's created during installation.  I could include a default "init.sage" too, but seeing as how it's a bit more of a "user-facing" file I wanted to leave it untouched.


---

Comment by vbraun created at 2019-12-04 22:43:27

Resolution: fixed
