# Issue 25311: get rid of twisted reactor

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2018-06-08 20:32:47

CC:  jdemeyer embray fbissey

if possible. This does not seems to be used anywhere.


---

Comment by chapoton created at 2018-06-08 20:33:13

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-06-08 20:33:13

New commits:


---

Comment by jdemeyer created at 2018-06-08 21:05:05

It's used by sagenb. I'm not sure whether that code in sage is needed though.


---

Comment by fbissey created at 2018-06-08 21:26:30

At the very least it creates a `twisted` dependency for sage that I was not aware off. If we can, we definitely should remove it.


---

Comment by dimpase created at 2018-06-10 08:53:41

should we perhaps instead downgrade sagenb to optional, and mark these tests as such?


---

Comment by dimpase created at 2018-06-10 08:55:40

#8785 appears  to explain the reason for these tests.


---

Comment by fbissey created at 2018-06-10 09:37:00

I have seen stuff a bit like that before. This is annoying because it is hard for a normal dev to reproduce (https://github.com/cschwan/sage-on-gentoo/issues/363 for example would require to build qt4 and some python-qt4 bindings inside a vanilla sage install before reproducing). If we still need to keep it, should we at least put the `from twisted.internet import reactor` in `multiprocessing_sage.py` inside a try block so it doesn't cause problem if `twisted` is not installed?


---

Comment by chapoton created at 2018-06-11 20:25:59

The bot is green. I would be ready to take the risk of the removal..


---

Comment by fbissey created at 2018-06-11 21:21:14

Right let's wait for complaints after the 8.3 release :)


---

Comment by fbissey created at 2018-06-11 21:21:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-06-14 07:41:04

Resolution: fixed


---

Comment by embray created at 2018-06-22 15:12:59

FWIW this sort of thing will less likely be a problem come the day we can fully switch to Python 3, where the `multiprocessing` module has been refactored to not use so much module-global state that interacts poorly when `multiprocessing` is used by multiple Python modules for different purposes within the same application.


---

Comment by kcrisman created at 2018-06-25 18:56:32

Apparently this breaks certain functionality for getting from the current default notebook back to sagenb.  See #22431.  Should we probably open a blocker to revert at least some of this?


---

Comment by chapoton created at 2018-06-25 18:58:57

which part needs to be reverted ?


---

Comment by dimpase created at 2018-06-25 19:01:38

I would rather propose to remove that "getting back" functionality, as non-essential.


---

Comment by kcrisman created at 2018-06-25 22:08:43

No, because the default is currently the Exporter Jeroen and/or Volker wrote.  So in that case one would move straight to Jupyter.  I don't know that sagenb has been deprecated at all properly w/ message, much less long enough for moving to only Jupyter.  This is an easy fix.


---

Comment by kcrisman created at 2018-06-26 20:56:32

See #25667 as a followup.
