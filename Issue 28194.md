# Issue 28194: integrate(1/(a-c*b),a) incorrect

archive/issues_028194.json:
```json
{
    "body": "Keywords: integration, 1/x\n\nThis appears to be a Macsyma related error.\n\n\n```\nintegrate(1/(a-b),a)\n```\n\n => log(a-b), which is correct\n\n\n```\nintegrate(1/(a-c*b),a)\n```\n\n => log(c*b-a), which is *incorrect*.\n\n\n```\nSympy.integrate(1/(a-c*b),a)\n=> log(a-c*b), which is correct.\n```\n \n\nAs SymPy does this correctly can we get a quick fix by rerouting 1/x type integrals through SymPy? I am not familiar with the details of the backed translation used by the integrate function.\n\nI assume this should also be reported upstream, but I do not know how to verify that it really is an upstream error.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28431\n\n",
    "created_at": "2019-08-30T15:03:15Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "title": "integrate(1/(a-c*b),a) incorrect",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28194",
    "user": "gutow"
}
```
Keywords: integration, 1/x

This appears to be a Macsyma related error.


```
integrate(1/(a-b),a)
```

 => log(a-b), which is correct


```
integrate(1/(a-c*b),a)
```

 => log(c*b-a), which is *incorrect*.


```
Sympy.integrate(1/(a-c*b),a)
=> log(a-c*b), which is correct.
```
 

As SymPy does this correctly can we get a quick fix by rerouting 1/x type integrals through SymPy? I am not familiar with the details of the backed translation used by the integrate function.

I assume this should also be reported upstream, but I do not know how to verify that it really is an upstream error.

Issue created by migration from https://trac.sagemath.org/ticket/28431





---

archive/issue_comments_398146.json:
```json
{
    "body": "I believe I have isolated this to maxima or how Sage is using it.\n\nIncorrect:\n\n```\n>integrate(1/(a-b*n),a, algorithm='maxima')\nlog(b*n - a)\n```\n\n\nCorrect:\n\n```\n>integrate(1/(a-b*n),a, algorithm='sympy')\nlog(-b*n + a)\n```\n",
    "created_at": "2019-08-30T17:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398146",
    "user": "gutow"
}
```

I believe I have isolated this to maxima or how Sage is using it.

Incorrect:

```
>integrate(1/(a-b*n),a, algorithm='maxima')
log(b*n - a)
```


Correct:

```
>integrate(1/(a-b*n),a, algorithm='sympy')
log(-b*n + a)
```




---

archive/issue_comments_398147.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2019-11-20T18:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398147",
    "user": "charpent"
}
```

Changing priority from major to critical.



---

archive/issue_comments_398148.json:
```json
{
    "body": "Changing keywords from \"integration, 1/x\" to \"integration, 1/x, maxima\".",
    "created_at": "2019-11-20T18:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398148",
    "user": "charpent"
}
```

Changing keywords from "integration, 1/x" to "integration, 1/x, maxima".



---

archive/issue_comments_398149.json:
```json
{
    "body": "The problem may be with our translation from `maxima`, which, by itself, behaves correctly:\n\n```\ncharpent@p-202-021:~$ sage -maxima\n;;; Loading #P\"/usr/local/sage-python3/local/lib/ecl/sb-bsd-sockets.fas\"\n;;; Loading #P\"/usr/local/sage-python3/local/lib/ecl/sockets.fas\"\n;;; Loading #P\"/usr/local/sage-python3/local/lib/ecl/defsystem.fas\"\n;;; Loading #P\"/usr/local/sage-python3/local/lib/ecl/cmp.fas\"\nMaxima 5.42.2 http://maxima.sourceforge.net\nusing Lisp ECL 16.1.2\nDistributed under the GNU Public License. See the file COPYING.\nDedicated to the memory of William Schelter.\nThe function bug_report() provides bug reporting information.\n(%i1) integrate(1/(a-b*c),a);\n(%o1)                            log(a - b c)\n```\n\nwhich is **correct**. And, BTW:\n\n```\n(%i5) diff(integrate(1/(a-b*c),a),a);\n\n(%o5) 1/(a-b*c)\n```\n\nalso correct.\n\n**EDIT :** This is **not** yet another effect of `domain:complex`:\n\n```\n(%i7) domain:complex;              \n\n(%o7) complex\n(%i8) integrate(1/(a-b*c),a);\n\n(%o8) log(a-b*c)\n```\n\nwhich is again correct...\n\nFurthermore:\n\n```\nsage: var(\"a, b, c\")\n(a, b, c)\nsage: integrate(1/(a-c*b),a)\nlog(b*c - a)                           /* Wrong */\nsage: integrate(1/(a-c*b),a).diff(a)\n-1/(b*c - a)                           /* CORRECT ??? */\n```\n\n\nTwo wrongs make one right ??? \n\nThis is, IMHO, a seemingly innocuous sign of a serious problem in a basic ability. I raise the priority to `critical`.",
    "created_at": "2019-11-20T18:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398149",
    "user": "charpent"
}
```

The problem may be with our translation from `maxima`, which, by itself, behaves correctly:

```
charpent@p-202-021:~$ sage -maxima
;;; Loading #P"/usr/local/sage-python3/local/lib/ecl/sb-bsd-sockets.fas"
;;; Loading #P"/usr/local/sage-python3/local/lib/ecl/sockets.fas"
;;; Loading #P"/usr/local/sage-python3/local/lib/ecl/defsystem.fas"
;;; Loading #P"/usr/local/sage-python3/local/lib/ecl/cmp.fas"
Maxima 5.42.2 http://maxima.sourceforge.net
using Lisp ECL 16.1.2
Distributed under the GNU Public License. See the file COPYING.
Dedicated to the memory of William Schelter.
The function bug_report() provides bug reporting information.
(%i1) integrate(1/(a-b*c),a);
(%o1)                            log(a - b c)
```

which is **correct**. And, BTW:

```
(%i5) diff(integrate(1/(a-b*c),a),a);

(%o5) 1/(a-b*c)
```

also correct.

**EDIT :** This is **not** yet another effect of `domain:complex`:

```
(%i7) domain:complex;              

(%o7) complex
(%i8) integrate(1/(a-b*c),a);

(%o8) log(a-b*c)
```

which is again correct...

Furthermore:

```
sage: var("a, b, c")
(a, b, c)
sage: integrate(1/(a-c*b),a)
log(b*c - a)                           /* Wrong */
sage: integrate(1/(a-c*b),a).diff(a)
-1/(b*c - a)                           /* CORRECT ??? */
```


Two wrongs make one right ??? 

This is, IMHO, a seemingly innocuous sign of a serious problem in a basic ability. I raise the priority to `critical`.



---

archive/issue_comments_398150.json:
```json
{
    "body": "I think that `integrate(1/(x-a), x)` should actually be `log(abs(x-a))`, because for `x < a` the expression `log(x-a)` doesn't make much sense, does it?",
    "created_at": "2019-11-20T19:26:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398150",
    "user": "mantepse"
}
```

I think that `integrate(1/(x-a), x)` should actually be `log(abs(x-a))`, because for `x < a` the expression `log(x-a)` doesn't make much sense, does it?



---

archive/issue_comments_398151.json:
```json
{
    "body": "I think the simplification\n\n```\nsage: 1/(a-b*c)\n-1/(b*c - a)\n```\n\nexplains this. In maxima:\n\n```\n(%i1) integrate( -1/(b*c-a), a);\n(%o1)                            log(b c - a)\n```\n\nWe're not doing anything wrong. It's really down to branch choice. (having `log(abs(x-a))` as antiderivative doesn't play nice with complex analytic computations)\nFurthermore,\n\n```\nsage: log(b*c-a).diff(a)\n-1/(b*c - a)\n```\n\nis just correct.\n\nThis is just us using a monomial ordering and a normalization of rational functions that leads maxima to choosing a branch for an antiderivative that doesn't match what you might expect to be chosen naively.",
    "created_at": "2019-11-20T20:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398151",
    "user": "nbruin"
}
```

I think the simplification

```
sage: 1/(a-b*c)
-1/(b*c - a)
```

explains this. In maxima:

```
(%i1) integrate( -1/(b*c-a), a);
(%o1)                            log(b c - a)
```

We're not doing anything wrong. It's really down to branch choice. (having `log(abs(x-a))` as antiderivative doesn't play nice with complex analytic computations)
Furthermore,

```
sage: log(b*c-a).diff(a)
-1/(b*c - a)
```

is just correct.

This is just us using a monomial ordering and a normalization of rational functions that leads maxima to choosing a branch for an antiderivative that doesn't match what you might expect to be chosen naively.



---

archive/issue_comments_398152.json:
```json
{
    "body": "Replying to [comment:4 mantepse]:\n> I think that `integrate(1/(x-a), x)` should actually be `log(abs(x-a))`, \n\nNope. Whereas\n\n```\nsage: with assuming (x, \"real\", a, \"real\"): (log(abs(x-a))).diff(x)\n-1/(a - x)\n```\n\n\nIn general, \n\n```\nsage: (log(abs(x-a))).diff(x)\n-1/2*(a - x + conjugate(a) - conjugate(x))/abs(-a + x)^2\n```\n\n\n> because for `x < a` the expression `log(x-a)` doesn't make much sense, does it?\n\nIt [does](https://en.wikipedia.org/wiki/Logarithm#Complex_logarithm). In the complex plane, and at the cost of choosing one among an infinity of solutions (branch choice).\n\nSeen another way, the //definite// integral `integrate(x-a),x,b, c`} does make sense, and can be  trivially computed (use the change of variable t=x-a), **except** if a+b<0 //and// a+c>0 : the function can't be integrated in x==a, and the integration constant has absolutely no reason to be the same on the two sides of this discontinuity. If you suppose that the two integration constants are the same, you obtain a [Cauchy principal value](https://en.wikipedia.org/wiki/Cauchy_principal_value), which is **not** a value of the integral.",
    "created_at": "2019-11-20T20:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398152",
    "user": "charpent"
}
```

Replying to [comment:4 mantepse]:
> I think that `integrate(1/(x-a), x)` should actually be `log(abs(x-a))`, 

Nope. Whereas

```
sage: with assuming (x, "real", a, "real"): (log(abs(x-a))).diff(x)
-1/(a - x)
```


In general, 

```
sage: (log(abs(x-a))).diff(x)
-1/2*(a - x + conjugate(a) - conjugate(x))/abs(-a + x)^2
```


> because for `x < a` the expression `log(x-a)` doesn't make much sense, does it?

It [does](https://en.wikipedia.org/wiki/Logarithm#Complex_logarithm). In the complex plane, and at the cost of choosing one among an infinity of solutions (branch choice).

Seen another way, the //definite// integral `integrate(x-a),x,b, c`} does make sense, and can be  trivially computed (use the change of variable t=x-a), **except** if a+b<0 //and// a+c>0 : the function can't be integrated in x==a, and the integration constant has absolutely no reason to be the same on the two sides of this discontinuity. If you suppose that the two integration constants are the same, you obtain a [Cauchy principal value](https://en.wikipedia.org/wiki/Cauchy_principal_value), which is **not** a value of the integral.



---

archive/issue_comments_398153.json:
```json
{
    "body": "Replying to [comment:5 nbruin]:\n> I think the simplification\n> {{{\n> sage: 1/(a-b*c)\n> -1/(b*c - a)\n> }}}\n> explains this. In maxima:\n> {{{\n> (%i1) integrate( -1/(b*c-a), a);\n> (%o1)                            log(b c - a)\n> }}}\n\nThis is //another// (Maxima's) error.\n\n> We're not doing anything wrong.\n\nSo, why are we obtaining the //opposite// of the expected result (which is //correctly// given by Maxima) //in the original case// ?\n\nBecause //we// are passing a \"simplified\" operand, which sends us in Maxima's trap.\n\nNot our fault ?\n\n> It's really down to branch choice. (having `log(abs(x-a))` as antiderivative doesn't play nice with complex analytic computations)\n\nNope : unless I'm sorely mistaken (which is always possible), a branch choice problem would leave us with a constant (pure imaginary in this case, I believe)  added to the correct value, //not// its opposite...",
    "created_at": "2019-11-20T20:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398153",
    "user": "charpent"
}
```

Replying to [comment:5 nbruin]:
> I think the simplification
> {{{
> sage: 1/(a-b*c)
> -1/(b*c - a)
> }}}
> explains this. In maxima:
> {{{
> (%i1) integrate( -1/(b*c-a), a);
> (%o1)                            log(b c - a)
> }}}

This is //another// (Maxima's) error.

> We're not doing anything wrong.

So, why are we obtaining the //opposite// of the expected result (which is //correctly// given by Maxima) //in the original case// ?

Because //we// are passing a "simplified" operand, which sends us in Maxima's trap.

Not our fault ?

> It's really down to branch choice. (having `log(abs(x-a))` as antiderivative doesn't play nice with complex analytic computations)

Nope : unless I'm sorely mistaken (which is always possible), a branch choice problem would leave us with a constant (pure imaginary in this case, I believe)  added to the correct value, //not// its opposite...



---

archive/issue_comments_398154.json:
```json
{
    "body": "Replying to [comment:6 charpent]:\n\nTo illustrate, compare:\n\n```\nsage: integrate(1/x, x, -3, -1)\n-log(3)\nsage: integrate(1/x, x, -3, 1)\n---------------------------------------------------------------------------\nRuntimeError                              Traceback (most recent call last)\n\n[ Snip... ]\n\nValueError: Integral is divergent.\n```\n",
    "created_at": "2019-11-20T20:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398154",
    "user": "charpent"
}
```

Replying to [comment:6 charpent]:

To illustrate, compare:

```
sage: integrate(1/x, x, -3, -1)
-log(3)
sage: integrate(1/x, x, -3, 1)
---------------------------------------------------------------------------
RuntimeError                              Traceback (most recent call last)

[ Snip... ]

ValueError: Integral is divergent.
```




---

archive/issue_comments_398155.json:
```json
{
    "body": "Replying to [comment:8 charpent]:\n\nAnother illustration (to show that Maxima tries to give us a principal value, on whoch Sage chokes):\n\n```\nsage: %maxima integrate(1/x, x, -3, 1)\n---------------------------------------------------------------------------\n\n[ Snip ... ]\n\nTypeError: error evaluating \"integrate(1/x,x,-3,1)\":\nError executing code in Maxima\nCODE:\n\tintegrate(1/x,x,-3,1);\nMaxima ERROR:\n\tPrincipal Value\n(%o67) -log(3)\n```\n",
    "created_at": "2019-11-20T21:05:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398155",
    "user": "charpent"
}
```

Replying to [comment:8 charpent]:

Another illustration (to show that Maxima tries to give us a principal value, on whoch Sage chokes):

```
sage: %maxima integrate(1/x, x, -3, 1)
---------------------------------------------------------------------------

[ Snip ... ]

TypeError: error evaluating "integrate(1/x,x,-3,1)":
Error executing code in Maxima
CODE:
	integrate(1/x,x,-3,1);
Maxima ERROR:
	Principal Value
(%o67) -log(3)
```




---

archive/issue_comments_398156.json:
```json
{
    "body": "Sorry about my mistake, I thought that we were playing in the reals.",
    "created_at": "2019-11-20T21:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398156",
    "user": "mantepse"
}
```

Sorry about my mistake, I thought that we were playing in the reals.



---

archive/issue_comments_398157.json:
```json
{
    "body": "Replying to [comment:7 charpent]:\n> Nope : unless I'm sorely mistaken (which is always possible), a branch choice problem would leave us with a constant (pure imaginary in this case, I believe)  added to the correct value, //not// its opposite...\n\n```\nlog( b*c -a ) = log ( (-1) *(a-b*c))= log(-1) + log(a-b*c)\n```\n\nso, with certain branch choices they do differ by a constant and therefore have the same derivative; and the derivative has no complicated branch choices. Hence, `log(a-b*c)` and `log(b*c-a)` are both valid antiderivatives.",
    "created_at": "2019-11-20T22:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398157",
    "user": "nbruin"
}
```

Replying to [comment:7 charpent]:
> Nope : unless I'm sorely mistaken (which is always possible), a branch choice problem would leave us with a constant (pure imaginary in this case, I believe)  added to the correct value, //not// its opposite...

```
log( b*c -a ) = log ( (-1) *(a-b*c))= log(-1) + log(a-b*c)
```

so, with certain branch choices they do differ by a constant and therefore have the same derivative; and the derivative has no complicated branch choices. Hence, `log(a-b*c)` and `log(b*c-a)` are both valid antiderivatives.



---

archive/issue_comments_398158.json:
```json
{
    "body": "Replying to [comment:10 mantepse]:\n> Sorry about my mistake, I thought that we were playing in the reals.\n\nMost of Sage's (and Maxima's) symbolic functions aim to play with complexes. Roughly speaking, they assume that SR element are complexes. Hence the difference in x.log().abs().diff() with and without assumptions about x...\n\nFor example:\n\n```\nsage: PolynomialRing(QQ,\"x\")(x^2+1).is_irreducible()\nTrue\nsage: PolynomialRing(QQbar,\"x\")(x^2+1).is_irreducible()\nFalse\nsage: PolynomialRing(SR,\"x\")(x^2+1).is_irreducible()\nFalse\n```\n\n\nBut note that:\n\n```\nsage: (x^2+1).is_irreducible()\n\n[ Snip ... ]\n\nAttributeError: 'sage.symbolic.expression.Expression' object has no attribute 'is_irreducible'\n```\n\n\nSo these rules are not cast in stone...",
    "created_at": "2019-11-20T22:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398158",
    "user": "charpent"
}
```

Replying to [comment:10 mantepse]:
> Sorry about my mistake, I thought that we were playing in the reals.

Most of Sage's (and Maxima's) symbolic functions aim to play with complexes. Roughly speaking, they assume that SR element are complexes. Hence the difference in x.log().abs().diff() with and without assumptions about x...

For example:

```
sage: PolynomialRing(QQ,"x")(x^2+1).is_irreducible()
True
sage: PolynomialRing(QQbar,"x")(x^2+1).is_irreducible()
False
sage: PolynomialRing(SR,"x")(x^2+1).is_irreducible()
False
```


But note that:

```
sage: (x^2+1).is_irreducible()

[ Snip ... ]

AttributeError: 'sage.symbolic.expression.Expression' object has no attribute 'is_irreducible'
```


So these rules are not cast in stone...



---

archive/issue_comments_398159.json:
```json
{
    "body": "Replying to [comment:11 nbruin]:\n> Replying to [comment:7 charpent]:\n> > Nope : unless I'm sorely mistaken (which is always possible), a branch choice problem would leave us with a constant (pure imaginary in this case, I believe)  added to the correct value, //not// its opposite...\n> {{{\n> log( b*c -a ) = log ( (-1) *(a-b*c))= log(-1) + log(a-b*c)\n> }}}\n> so, with certain branch choices they do differ by a constant and therefore have the same derivative; and the derivative has no complicated branch choices. Hence, `log(a-b*c)` and `log(b*c-a)` are both valid antiderivatives.\n\nDamn... You're right !\n\nI stand corrected.\n\nBut still:\n\n```\nsage: with assuming(a, \"real\", b, \"real\", c, \"real\"): (1/(a - b*c)).integrate(a)\nlog(b*c - a)\n```\n\nis hard to swallow... Choosing `I*pi` as an integration constant in a problem involving real quantities is a stretch of imagination...\n\nBut that's a nice excuse for any undergrad committing an error of sign in an integration problem. Which, BTW, won't hold in the case of //definite// integration.",
    "created_at": "2019-11-20T22:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398159",
    "user": "charpent"
}
```

Replying to [comment:11 nbruin]:
> Replying to [comment:7 charpent]:
> > Nope : unless I'm sorely mistaken (which is always possible), a branch choice problem would leave us with a constant (pure imaginary in this case, I believe)  added to the correct value, //not// its opposite...
> {{{
> log( b*c -a ) = log ( (-1) *(a-b*c))= log(-1) + log(a-b*c)
> }}}
> so, with certain branch choices they do differ by a constant and therefore have the same derivative; and the derivative has no complicated branch choices. Hence, `log(a-b*c)` and `log(b*c-a)` are both valid antiderivatives.

Damn... You're right !

I stand corrected.

But still:

```
sage: with assuming(a, "real", b, "real", c, "real"): (1/(a - b*c)).integrate(a)
log(b*c - a)
```

is hard to swallow... Choosing `I*pi` as an integration constant in a problem involving real quantities is a stretch of imagination...

But that's a nice excuse for any undergrad committing an error of sign in an integration problem. Which, BTW, won't hold in the case of //definite// integration.



---

archive/issue_comments_398160.json:
```json
{
    "body": "So Sage needs to be clear about what conditions the solution holds for. It should also work correctly if forced to use real numbers and get the sign correct without a hidden constant of integration. If Maxima can handle this Sage should too.",
    "created_at": "2019-11-21T00:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398160",
    "user": "gutow"
}
```

So Sage needs to be clear about what conditions the solution holds for. It should also work correctly if forced to use real numbers and get the sign correct without a hidden constant of integration. If Maxima can handle this Sage should too.



---

archive/issue_comments_398161.json:
```json
{
    "body": "Thinking on this a little more, another option that does not hide a mysterious choice of integration constants, such as log(-1), would be to provide multiple valid integrations. I'm thinking of behavior something like this:\n\n```\n>(1/(a-b)).integrate(a)\n   [log(a-b),log(b-a)]\n```\n\nas when reporting other results with multiple valid solutions. This would leave the user to pick the correct one for their situation. If they are limited to real numbers then they would pick the version that provides positive input to the log function.\n\nI am not sure about how this generalizes.",
    "created_at": "2019-12-03T02:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398161",
    "user": "gutow"
}
```

Thinking on this a little more, another option that does not hide a mysterious choice of integration constants, such as log(-1), would be to provide multiple valid integrations. I'm thinking of behavior something like this:

```
>(1/(a-b)).integrate(a)
   [log(a-b),log(b-a)]
```

as when reporting other results with multiple valid solutions. This would leave the user to pick the correct one for their situation. If they are limited to real numbers then they would pick the version that provides positive input to the log function.

I am not sure about how this generalizes.



---

archive/issue_comments_398162.json:
```json
{
    "body": "Replying to [comment:15 gutow]:\n> Thinking on this a little more, another option that does not hide a mysterious choice of integration constants, such as log(-1), would be to provide multiple valid integrations. I'm thinking of behavior something like this:\n> {{{\n> >(1/(a-b)).integrate(a)\n>    [log(a-b),log(b-a)]\n> }}}\n> as when reporting other results with multiple valid solutions. This would leave the user to pick the correct one for their situation. If they are limited to real numbers then they would pick the version that provides positive input to the log function.\n> \n> I am not sure about how this generalizes.\n\nIt doesn't. This is exactly what integration constants express. You'd have to give an uncountable set of antiderivatives.",
    "created_at": "2019-12-03T03:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398162",
    "user": "nbruin"
}
```

Replying to [comment:15 gutow]:
> Thinking on this a little more, another option that does not hide a mysterious choice of integration constants, such as log(-1), would be to provide multiple valid integrations. I'm thinking of behavior something like this:
> {{{
> >(1/(a-b)).integrate(a)
>    [log(a-b),log(b-a)]
> }}}
> as when reporting other results with multiple valid solutions. This would leave the user to pick the correct one for their situation. If they are limited to real numbers then they would pick the version that provides positive input to the log function.
> 
> I am not sure about how this generalizes.

It doesn't. This is exactly what integration constants express. You'd have to give an uncountable set of antiderivatives.



---

archive/issue_comments_398163.json:
```json
{
    "body": "Replying to [comment:16 nbruin]:\n> Replying to [comment:15 gutow]:\n> > Thinking on this a little more, another option that does not hide a mysterious choice of integration constants, such as log(-1), would be to provide multiple valid integrations. I'm thinking of behavior something like this:\n> > {{{\n> > >(1/(a-b)).integrate(a)\n> >    [log(a-b),log(b-a)]\n> > }}}\n> > as when reporting other results with multiple valid solutions. This would leave the user to pick the correct one for their situation. If they are limited to real numbers then they would pick the version that provides positive input to the log function.\n> > \n> > I am not sure about how this generalizes.\n> \n> It doesn't. This is exactly what integration constants express. You'd have to give an uncountable set of antiderivatives.\nDuh! Of course, it doesn't generalize. I get my dunce hat for this one!\n\nI am beginning to lean towards some kind of \"domain\" control as discussed on sage-devel. I can see `algorithm='maxima_real' or 'sympy_real'` as easy to use. The default should remain the complex domain. To facilitate usability by people like me (physical scientists and their students) the default domain needs to be stated up-front in the documentation for integrate.\n\nAs was discussed in the sage-devel thread, I am not clear this solves all the issues. However, it ought to help with the issue of log in the real domain requiring a positive real number input. I would expect it to trigger an error requiring an assumption about whether a > b or not.",
    "created_at": "2019-12-03T04:13:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398163",
    "user": "gutow"
}
```

Replying to [comment:16 nbruin]:
> Replying to [comment:15 gutow]:
> > Thinking on this a little more, another option that does not hide a mysterious choice of integration constants, such as log(-1), would be to provide multiple valid integrations. I'm thinking of behavior something like this:
> > {{{
> > >(1/(a-b)).integrate(a)
> >    [log(a-b),log(b-a)]
> > }}}
> > as when reporting other results with multiple valid solutions. This would leave the user to pick the correct one for their situation. If they are limited to real numbers then they would pick the version that provides positive input to the log function.
> > 
> > I am not sure about how this generalizes.
> 
> It doesn't. This is exactly what integration constants express. You'd have to give an uncountable set of antiderivatives.
Duh! Of course, it doesn't generalize. I get my dunce hat for this one!

I am beginning to lean towards some kind of "domain" control as discussed on sage-devel. I can see `algorithm='maxima_real' or 'sympy_real'` as easy to use. The default should remain the complex domain. To facilitate usability by people like me (physical scientists and their students) the default domain needs to be stated up-front in the documentation for integrate.

As was discussed in the sage-devel thread, I am not clear this solves all the issues. However, it ought to help with the issue of log in the real domain requiring a positive real number input. I would expect it to trigger an error requiring an assumption about whether a > b or not.



---

archive/issue_comments_398164.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398164",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_398165.json:
```json
{
    "body": "I'm not even sure this is an error, but at any rate this is not critical, given that (up to integration constants and branch choice) this is correct.\n\nAs to documentation, there are a few places where we do mention this (IIRC).  We haven't apologized for it, and I don't think we have to, but it's certainly true that it's confusing, and adding to the documentation in some *visible* places would be salutary.",
    "created_at": "2021-03-25T12:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398165",
    "user": "kcrisman"
}
```

I'm not even sure this is an error, but at any rate this is not critical, given that (up to integration constants and branch choice) this is correct.

As to documentation, there are a few places where we do mention this (IIRC).  We haven't apologized for it, and I don't think we have to, but it's certainly true that it's confusing, and adding to the documentation in some *visible* places would be salutary.



---

archive/issue_comments_398166.json:
```json
{
    "body": "Changing priority from critical to minor.",
    "created_at": "2021-03-25T12:34:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398166",
    "user": "kcrisman"
}
```

Changing priority from critical to minor.



---

archive/issue_comments_398167.json:
```json
{
    "body": "Also, to Jonathan's suggestion, it seems like making the context in comment:6 more advertised would be useful.  But since neither Sympy nor Maxima add the absolute value, I'm not sure if that aspect is really 'fixable'.",
    "created_at": "2021-03-25T12:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398167",
    "user": "kcrisman"
}
```

Also, to Jonathan's suggestion, it seems like making the context in comment:6 more advertised would be useful.  But since neither Sympy nor Maxima add the absolute value, I'm not sure if that aspect is really 'fixable'.



---

archive/issue_comments_398168.json:
```json
{
    "body": "Replying to [comment:22 kcrisman]:\n> Also, to Jonathan's suggestion, it seems like making the context in comment:6 more advertised would be useful.  But since neither Sympy nor Maxima add the absolute value, I'm not sure if that aspect is really 'fixable'.\n\nFrom a practical usability perspective, I still think there should be a way to request the domain of the result, in addition to being much clearer about how the branch was chosen.",
    "created_at": "2021-03-25T15:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398168",
    "user": "gutow"
}
```

Replying to [comment:22 kcrisman]:
> Also, to Jonathan's suggestion, it seems like making the context in comment:6 more advertised would be useful.  But since neither Sympy nor Maxima add the absolute value, I'm not sure if that aspect is really 'fixable'.

From a practical usability perspective, I still think there should be a way to request the domain of the result, in addition to being much clearer about how the branch was chosen.



---

archive/issue_comments_398169.json:
```json
{
    "body": "That may be true, but if Maxima and Sympy don't, I'm not sure how we can :(",
    "created_at": "2021-03-25T15:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398169",
    "user": "kcrisman"
}
```

That may be true, but if Maxima and Sympy don't, I'm not sure how we can :(



---

archive/issue_comments_398170.json:
```json
{
    "body": "Could open an issue with https://github.com/sympy/sympy expressing this feature request.",
    "created_at": "2021-03-25T16:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28194",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28194#issuecomment-398170",
    "user": "mkoeppe"
}
```

Could open an issue with https://github.com/sympy/sympy expressing this feature request.
