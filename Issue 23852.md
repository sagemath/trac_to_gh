# Issue 23852: Max common neighbors for Graphs

Issue created by migration from https://trac.sagemath.org/ticket/24089

Original creator: afrancis

Original creation time: 2017-10-22 22:16:59

CC:  dcoudert

Keywords: neighbors, graphs, link prediction

Use adjacency matrix to implement maximum common neighbors score for graphs. 


---

Comment by afrancis created at 2017-10-23 16:53:59

Changing priority from minor to major.


---

Comment by afrancis created at 2017-10-23 16:53:59

Changing keywords from "neighbors, graphs, link prediction" to "neighbors, graphs, link prediction,sd90".


---

Comment by git created at 2017-10-24 17:21:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-24 22:37:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-10-24 22:53:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by afrancis created at 2017-10-24 23:05:04

Changing status from new to needs_review.


---

Comment by dcoudert created at 2017-10-25 08:01:02

Here I have similar comments as for #24094. You can have a look to [doc.sagemath.org/html/en/developer/coding_basics.html].


---

Comment by dcoudert created at 2017-10-25 08:01:02

Changing status from needs_review to needs_work.


---

Comment by @rajat1433 created at 2019-03-19 05:39:58

Set assignee to @rajat1433.


---

Comment by git created at 2019-03-19 09:08:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-19 09:09:47

Done a lot of refactoring and improvement in the original author's code , following the pep8 guidelines and also added vertices option to common_neighbors_matrix method.


---

Comment by @rajat1433 created at 2019-03-19 09:12:52

Changing status from needs_work to needs_review.


---

Comment by git created at 2019-03-19 09:12:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-03-19 10:46:38

Changing status from needs_review to needs_work.


---

Comment by dcoudert created at 2019-03-19 10:46:38

several comments

**common_neighbors_matrix**

- We could shorten the short description to

```
Return a matrix of numbers of common neighbors between each pairs.
```

  an then add the explanation about `(i, j)` entry

- pep8:

```diff
-        - ``nonedgesonly``-- Boolean (default: `True`); if ``true``, assigns
+        - ``nonedgesonly``-- boolean (default: ``True``); if ``True``, assigns
```


- remove `# add edge`. Not useful

```
            sage: G = Graph([(0,0)],loops=True) # add edges
```


- same here

```
            sage: G = graphs.CompleteGraph(4) # Check Complete Graph
```


- you must document at the begining of the method that it is working for simple graphs only, and so that neither loops nor multiple edges are accepted. Then instead of this test, you could use:

```
-        if self.has_loops():
-            raise ValueError('Unable to compute simple graph common neighbors for graphs with loops')
+        self._scream_if_not_simple()
```


- this method is defined in `graph.py`, so self is not directed.

- use `vertices = list(self)` but the documentation of the `vertices` parameter says that default in `self.vertices()`.

- `range(0, self.order())`: no need to add 0 -> `range(self.order())`

- we expect the matrix to be symmetric, so 

```diff
-        for v in range(0, self.order()):
-            for w in range(0, self.order()):
-                if v == w:
-                    M[v, w] = 0
-                if nonedgesonly == True:
-                    if A[v, w] > 0:
-                        M[v, w] = 0
+        for v in range(self.order()):
+            M[v, v] = 0
+            for w in range(v + 1, self.order()):
+                if nonedgesonly and A[v, w]:
+                    M[v, w] = M[w, v] = 0
```


**most_common_neighbors**

- ```nonedgesonly`` -- Boolean (default: `True`); if ``True``,` same as above

- `non-adajacent` -> non-adjacent`

- alignment 80 columns

```
+        The common neighbors matrix  for a fan on 6 vertices counting only non-adjacent vertex pairs ::
```


- remove `#Check Complete Graph`

- document that the method is for simple graphs only and add `self._scream_if_not_simple()`

- document that the method is defined for graphs of order `\geq 2` and do

```diff
-            raise ValueError('Unable to find node pairs with common neighbors for graphs with less than 2 nodes')
+            raise ValueError('this method is defined for graphs with at least 2 vertices')
```


- what is `max(max(M)` ?

- The matrix is symmetric, and the current implementation outputs pair (u, v) and (v, u).


---

Comment by git created at 2019-03-19 11:23:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-19 11:24:13


```
    what is max(max(M))
```



Its the maximum value in a 2d matrix.



```
    The matrix is symmetric, and the current implementation outputs pair (u, v) and (v, u).
```

 
no it outputed only (u,v) bcoz second loop started from v.



```
use vertices = list(self) but the documentation of the vertices parameter says that default in self.vertices(). 
```


I have now restored self.vertices in the code. (Or should I do other way round including list(self) in documentation as well as code?

All the changes suggested are commited.
----
New commits:
----
New commits:


---

Comment by @rajat1433 created at 2019-03-19 11:25:18

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2019-03-19 12:15:02

Replying to [comment:17 gh-rajat1433]:
> 
> {{{
>     what is max(max(M))
> }}}
> 
> 
> Its the maximum value in a 2d matrix.

I don't think so

```
sage: G = graphs.CycleGraph(4)
sage: A = G.adjacency_matrix()
sage: M = A**2
sage: M
[2 0 2 0]
[0 2 0 2]
[2 0 2 0]
[0 2 0 2]
sage: M[1, 1] = 3
sage: M
[2 0 2 0]
[0 3 0 2]
[2 0 2 0]
[0 2 0 2]
sage: max(max(M))
2
sage: max(M)
(2, 0, 2, 0)
```


`max(M)` returns the "maximum" row according some definition, apparently lexicographic.


use for instance `max(M.coefficients())`


> I have now restored self.vertices in the code. (Or should I do other way round including list(self) in documentation as well as code?

it's consistent with `adjacency_matrix, so it's OK.


---

Comment by @rajat1433 created at 2019-03-19 12:31:16

fixed for maximum value


---

Comment by git created at 2019-03-19 12:35:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-03-19 12:53:56

almost done ;)


```diff
             for v in range(self.num_verts()):
-                for w in range(v, self.num_verts()):
+                for w in range(v + 1, self.num_verts()):
```


and also, you can do

```diff
-            ValueError: This method is not known to work on graphs with loops. Perhaps this method can be updated to handle them, but in the meantime if you want to use it please disallow loops using allow_loops().
+            ValueError: This method is not known to work on graphs with
+            multiedges. Perhaps this method can be updated to handle them, but
+            in the meantime if you want to use it please disallow multiedges
+            using allow_multiple_edges().
```


and 

```diff
-        The (`i` , `j`) entry of the matrix gives the number of common
+        The `(i , j)` entry of the matrix gives the number of common
```



---

Comment by git created at 2019-03-19 14:02:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-19 14:03:14

Thanks for the review. I have fixed the remaining documentation bugs.


---

Comment by dcoudert created at 2019-03-19 14:09:08

LGTM


---

Comment by dcoudert created at 2019-03-19 14:09:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-24 00:41:38

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2019-03-24 00:41:38

Merge conflict


---

Comment by git created at 2019-03-24 05:10:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-03-24 05:12:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-24 05:16:33

I have merged it with latest release i.e. 8.7 rc0 to avoid any conflicts. Is milestone 8.7 good or I have to make it 8.8 ?


---

Comment by @rajat1433 created at 2019-03-24 05:16:41

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2019-03-24 18:14:55

The milestone is now 8.8. Version 8.7 has been released. The last develop version is 8.7, and the first beta of 8.8 will be shortly released.


- a better code when `nonedgesonly = False`

```diff
-            for w in range(v + 1, self.order()):
-                if nonedgesonly and A[v, w]:
-                    M[v, w] = M[w, v] = 0
+            if nonedgesonly:
+                for w in range(v + 1, self.order()):
+                    if A[v, w]:
+                        M[v, w] = M[w, v] = 0
```


- Add a `.` at the end of `Return vertex pairs with maximal number of common neighbors`

- only 1 empty line before the INPUT block

- Do simple validity test first

```diff
-        verts = list(self)
-        M = self.common_neighbors_matrix(vertices=verts, nonedgesonly=nonedgesonly)
-        if self.num_verts() < 2:
-            raise ValueError('this method is defined for graphs with at least 2 vertices')
+        if self.num_verts() < 2:
+            raise ValueError('this method is defined for graphs with at least 2 vertices')
+        verts = list(self)
+        M = self.common_neighbors_matrix(vertices=verts, nonedgesonly=nonedgesonly)
```


- no need to call twice `M.coefficients()`. Use a variable `coefficients = M.coefficients()`


---

Comment by git created at 2019-03-24 19:06:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-03-24 19:07:28

Thanks for the review. I have made the changes.


---

Comment by dcoudert created at 2019-03-25 13:14:00

LGTM


---

Comment by dcoudert created at 2019-03-25 13:14:00

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-03-29 12:36:47

Resolution: fixed
