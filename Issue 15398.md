# Issue 15398: free Pre-Lie algebras

Issue created by migration from https://trac.sagemath.org/ticket/15635

Original creator: chapoton

Original creation time: 2014-01-05 16:07:23

CC:  sage-combinat tscrim darij

Keywords: trees

one has shuffle algebras, one could have pre-Lie algebras, as soon as one has rooted trees (#11529)


---

Attachment


---

Comment by chapoton created at 2014-06-08 19:00:28

First step, a git branch that does not look too bad.
----
New commits:


---

Comment by git created at 2014-06-08 20:16:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-06-09 07:57:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-06-09 08:03:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-06-09 08:10:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-02-16 16:41:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-02-16 17:01:58

Changing status from new to needs_review.


---

Comment by chapoton created at 2015-02-16 17:01:58

Changing keywords from "trees" to "trees, prelie algebra".


---

Comment by chapoton created at 2015-02-16 17:01:58

This should be ready, once rooted trees are ok.


---

Comment by git created at 2015-02-17 15:05:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-02-17 15:10:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-02-17 15:41:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-02-17 20:06:25

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2015-02-17 20:06:25

Changing type from task to enhancement.


---

Comment by chapoton created at 2015-02-17 20:06:25

There is a coercion doctest failing.


---

Comment by darij created at 2015-02-25 21:30:56

Please define the free pre-Lie algebra in a docstring. They might all be equivalent, but there are probably several ways to implement it and label the basis elements.

This could use some translation:

```
+ # on aurait besoin ici de LabelledRootedTrees(names)
+ # pour restreindre les etiquettes aux valeurs autorisees
```



---

Comment by git created at 2015-03-03 08:58:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-06 17:25:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-03-06 21:11:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-21 16:09:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-04-21 18:56:26

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2015-04-21 19:52:11

Here's some comments after taking a look:

- I'm not sure about using `<` to denote the pre-Lie product in Sage, as python does something subtle, but very natural, with triple comparisons:

```
sage: A = FreePreLieAlgebra(QQ,'x,y')
sage: A.gens()
Family (B[x[]], B[,[]], B[y[]])
sage: x,a,y = A.gens()
sage: x < x < x
B[x[x[]]]
sage: (x < x) < x
B[x[x[], x[]]] + B[x[x[x[]]]]
sage: x < (x < x)
B[x[x[x[]]]]
sage: x < x and x < x   # This is equivalent to x < x < x
B[x[x[]]]
```

Instead I think you should let `*` denote the pre-Lie product and have the free pre-Lie algebra be in `MagmaticAlgebras` (perhaps `.Unital()`?). Thus rename `pre_Lie_product_on_basis` to `product_on_basis`.

- You shouldn't need `_coerce_impl` since the default when `_coerce_map_from_` returns `True` is to go through `_element_constructor_`.

- I think you should not use the `__ngens` idiom, but instead use the more explicit `len(self.algebra_generators())` or `self.algebra_generators().cardinality()`.

- For the `return Family(self._alphabet, lambda a: self.term(self.basis().keys()(a)))` should be consistently ordered...


---

Comment by git created at 2015-04-22 09:28:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-04-29 06:25:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-05-01 09:28:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-05-01 09:32:50

Thanks Travis for your comments. I have done something for the first three, but I do not
understand the last one.

I removed the shortcut `<` alltogether. Using `*` is almost as good.

I removed `coerced_impl` and it still works.

I used `len(self.algebra_generators())`.


---

Comment by tscrim created at 2015-05-01 15:05:12

Thanks! The last one was that line was commented out with a line above it saying about `Family` not returning a consistent ordering, which is not correct as I understand it.

I plan to do a full review over this weekend.


---

Comment by tscrim created at 2015-05-03 06:33:02

I made some review changes:

- I added `algebras.FreePreLie` and made this the standard entry point.
- I moved the main explanation doc from the module level to the class. I also made some minor tweaks to the doc overall.
- I also renamed the file by removing the `s` as this is the standard in Sage AFAIK.
- I changed the output of `algebra_generators` as per my previous point. The ordering should be consistent as this was something we changed awhile ago.
- Subsequently, I changed around some things so that it works with infinite generating sets.
- I changed the `some_elements` and implemented an `an_element` method.

If you're happy with my changes, then you can set a positive review.

PS/EDIT - It would be nice to have the trees with specified labels, as this would allow the generic implementation of `an_element` and removing of the `_alphabet` parameter (well, pushing it down a level).
----
New commits:


---

Comment by chapoton created at 2015-05-04 06:53:08

Thanks a lot for your work on that ticket. I have not yet got time to look at your changes seriously.

> - I added `algebras.FreePreLie` and made this the standard entry point.

*I do not quite agree*. Most people would not call them algebras, because they are NOT associative

> - I moved the main explanation doc from the module level to the class. I also made some minor tweaks to the doc overall.

> - I also renamed the file by removing the `s` as this is the standard in Sage AFAIK.

No problem with removing s

> - I changed the output of `algebra_generators` as per my previous point. The ordering should be consistent as this was something we changed awhile ago.
> - Subsequently, I changed around some things so that it works with infinite generating sets.

Great !

> - I changed the `some_elements` and implemented an `an_element` method.
> 
> If you're happy with my changes, then you can set a positive review.

The first point is problematic in my opinion.

> PS/EDIT - It would be nice to have the trees with specified labels, as this would allow the generic implementation of `an_element` and removing of the `_alphabet` parameter (well, pushing it down a level).

yes, I agree !


---

Comment by chapoton created at 2015-05-04 09:38:33

Doc does not build, because of the removal of s was forgotten in module_list


---

Comment by chapoton created at 2015-05-05 08:03:00

corrected the module-list

there remains the problem about the entry in the catalog.
----
New commits:


---

Comment by git created at 2015-05-05 18:24:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-05-06 02:11:53

Thanks for fixing the module list (I didn't have time until this afternoon to come back to this).

Replying to [comment:32 chapoton]:
> > - I added `algebras.FreePreLie` and made this the standard entry point.
> 
> *I do not quite agree*. Most people would not call them algebras, because they are NOT associative

I understand your point, but what would people call them, non-associative algebras? The one of the current thoughts is to rename `MagmaticAlgebras` to `Algebras` and add axioms like "associative" (#15043). Also, what do you say about [Jordan algebras](http://en.wikipedia.org/wiki/Jordan_algebra) being in the catalog?

Irregardless of nomenclature, I would say that having this as a global entry point doesn't harm anyone as the name is clear (and there's no danger of confusion), it is documented that it not associative, it makes it discoverable, and `FreePreLieAlgebra` in the global namespace IMO adds some clutter.

Another option would be to create a (stub) category for pre-Lie algebras, werhich might be bett for the long term, and have a method `free` similar to:

```
sage: Groups().free(names='x,y,z')
Free Group on generators {x, y, z}
```

(and something similar should probably be done for associative unital algebras).


---

Comment by chapoton created at 2015-05-06 08:47:39

* Jordan algebras are not in the catalog, as far as I can see (6.7.beta4)

* if J is a Jordan algebra, then `J in Algebras` returns False

So I really think that the catalog 'algebras' should be kept for associative algebras.

Maybe this should be discussed on sage-devel or sage-combinat-devel ?


---

Comment by tscrim created at 2015-05-06 19:13:53

Replying to [comment:37 chapoton]:
> * Jordan algebras are not in the catalog, as far as I can see (6.7.beta4)

I guess I forgot to add them...

> * if J is a Jordan algebra, then `J in Algebras` returns False

Hmm...this would definitely create an mild inconsistency in the current state with `Algebras` being associative and unital (at least in the global namespace; for imports, I would say the implementor should be aware of what assumptions are being made).

> Maybe this should be discussed on sage-devel or sage-combinat-devel ?

This is now https://groups.google.com/forum/#!topic/sage-devel/uXN5619Fg54.


---

Comment by tscrim created at 2015-05-09 18:16:44

Given the discussion on sage-devel, would you be okay with letting this stay in the algebras catalog?


---

Comment by chapoton created at 2015-05-11 07:52:45

Yes, ok to let it go in the algebra catalog.


---

Comment by tscrim created at 2015-05-13 04:22:34

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2015-05-13 04:22:34

Then positive review.


---

Comment by vbraun created at 2015-05-13 20:11:35

Resolution: fixed
