# Issue 31674: Boolean symbolic expressions

archive/issues_031674.json:
```json
{
    "body": "CC:  @EmmanuelCharpentier @nbruin @egourgoulhon @fchapoton @spaghettisalat @kcrisman\n\nAs proposed in https://groups.google.com/g/sage-devel/c/U_WGbYG2zOE/m/yq-EDEXDAgAJ\n\nIssue created by migration from https://trac.sagemath.org/ticket/31911\n\n",
    "created_at": "2021-06-05T04:27:19Z",
    "labels": [
        "symbolics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Boolean symbolic expressions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31674",
    "user": "@mkoeppe"
}
```
CC:  @EmmanuelCharpentier @nbruin @egourgoulhon @fchapoton @spaghettisalat @kcrisman

As proposed in https://groups.google.com/g/sage-devel/c/U_WGbYG2zOE/m/yq-EDEXDAgAJ

Issue created by migration from https://trac.sagemath.org/ticket/31911





---

archive/issue_comments_452411.json:
```json
{
    "body": "Here's an attempt \n----\nNew commits:",
    "created_at": "2021-06-05T05:47:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452411",
    "user": "@mkoeppe"
}
```

Here's an attempt 
----
New commits:



---

archive/issue_comments_452412.json:
```json
{
    "body": "Replying to [comment:2 mkoeppe]:\n> Here's an attempt \n> ----\n> New commits:\n> ||[863c636](https://git.sagemath.org/sage.git/commit?id=863c636f52e73c08b3730a99ce7345cb694544da)||`sage.functions.boolean.AndSymbolic: New`||\n\nI'll test that tomorrow. A couple remarks :\n\n* `eval` can be farmed out to `sympy`'s `And` (one of the goals of this addition being the ability to use `Sympy`'s `Piecewise` expressions of integrals and ODE solutions, often involving logical expressions...). I was originally aiming at wrapping `Sympy`'s logical functions, but got stopped by :\n\n* The showstopper problem I haven't been able to solve yet is **translation to Maxima** and //backtranslation//.\n\n  This is utterly necessary if you want to keep logical symbolic expressions (or symbolic expressions involving logical parts, as in `case` calls) `simplify`able (other `Expression` methods are also farmed out to Maxima...).\n\n  OTOH, `maxima_calculus` should be easier, since this interface works \"naturally\" with the Lisp function tree representing Maxima expressions.\n\n* Translation to `Mathematica` and `Sympy` should be trivial (give the names in a  `conversions` argument). I don't know (yet) what is offered by `giac` and `fricas`, but maintaining universal translatability seems highly desirable...\n\nHTH,",
    "created_at": "2021-06-05T23:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452412",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:2 mkoeppe]:
> Here's an attempt 
> ----
> New commits:
> ||[863c636](https://git.sagemath.org/sage.git/commit?id=863c636f52e73c08b3730a99ce7345cb694544da)||`sage.functions.boolean.AndSymbolic: New`||

I'll test that tomorrow. A couple remarks :

* `eval` can be farmed out to `sympy`'s `And` (one of the goals of this addition being the ability to use `Sympy`'s `Piecewise` expressions of integrals and ODE solutions, often involving logical expressions...). I was originally aiming at wrapping `Sympy`'s logical functions, but got stopped by :

* The showstopper problem I haven't been able to solve yet is **translation to Maxima** and //backtranslation//.

  This is utterly necessary if you want to keep logical symbolic expressions (or symbolic expressions involving logical parts, as in `case` calls) `simplify`able (other `Expression` methods are also farmed out to Maxima...).

  OTOH, `maxima_calculus` should be easier, since this interface works "naturally" with the Lisp function tree representing Maxima expressions.

* Translation to `Mathematica` and `Sympy` should be trivial (give the names in a  `conversions` argument). I don't know (yet) what is offered by `giac` and `fricas`, but maintaining universal translatability seems highly desirable...

HTH,



---

archive/issue_comments_452413.json:
```json
{
    "body": "Replying to [ticket:31911 mkoeppe]:\n> \n> One application is for the restrictions of a `Chart`.\nMay I ask which application?",
    "created_at": "2021-06-06T21:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452413",
    "user": "@egourgoulhon"
}
```

Replying to [ticket:31911 mkoeppe]:
> 
> One application is for the restrictions of a `Chart`.
May I ask which application?



---

archive/issue_comments_452414.json:
```json
{
    "body": "Right now, chart restrictions have an ad-hoc representation as nested lists and tuples of symbolic relation expressions; this could be replaced by the corresponding boolean expressions (instances of `AndSymbolic`, `OrSymbolic`)",
    "created_at": "2021-06-06T21:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452414",
    "user": "@mkoeppe"
}
```

Right now, chart restrictions have an ad-hoc representation as nested lists and tuples of symbolic relation expressions; this could be replaced by the corresponding boolean expressions (instances of `AndSymbolic`, `OrSymbolic`)



---

archive/issue_comments_452415.json:
```json
{
    "body": "Replying to [comment:6 mkoeppe]:\n> Right now, chart restrictions have an ad-hoc representation as nested lists and tuples of symbolic relation expressions; this could be replaced by the corresponding boolean expressions (instances of `AndSymbolic`, `OrSymbolic`)\nAh yes, this would be nice! Thanks for your answer.",
    "created_at": "2021-06-06T21:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452415",
    "user": "@egourgoulhon"
}
```

Replying to [comment:6 mkoeppe]:
> Right now, chart restrictions have an ad-hoc representation as nested lists and tuples of symbolic relation expressions; this could be replaced by the corresponding boolean expressions (instances of `AndSymbolic`, `OrSymbolic`)
Ah yes, this would be nice! Thanks for your answer.



---

archive/issue_comments_452416.json:
```json
{
    "body": "For converting to maxima, some help would be welcome. My last failed attempt looked like this:\n\n```diff\ndiff --git a/src/sage/functions/boolean.py b/src/sage/functions/boolean.py\nindex 58089dce81..d32acca761 100644\n--- a/src/sage/functions/boolean.py\n+++ b/src/sage/functions/boolean.py\n@@ -31,7 +31,8 @@ class AndSymbolic(BuiltinFunction):\n \n         \"\"\"\n         BuiltinFunction.__init__(self, 'and_symbolic', nargs=0,\n-                                 conversions=dict(sympy='And'))\n+                                 conversions=dict(sympy='And',\n+                                                  maxima='andsymbolic'))\n \n     def _eval_(self, *args):\n \ndiff --git a/src/sage/interfaces/maxima_lib.py b/src/sage/interfaces/maxima_lib.py\nindex 40367c5242..2f6ab545f8 100644\n--- a/src/sage/interfaces/maxima_lib.py\n+++ b/src/sage/interfaces/maxima_lib.py\n@@ -113,6 +113,9 @@ ecl_eval('(defun principal nil (cond ($noprincipal (diverg)) ((not pcprntd) (mer\n ecl_eval(\"(remprop 'mfactorial 'grind)\") # don't use ! for factorials (#11539)\n ecl_eval(\"(setf $errormsg nil)\")\n \n+ecl_eval(\"(defmfun $andsymbolic (&rest args) (simplify (cons '(mand) args)))\")\n+\n+\n # the following is a direct adaptation of the definition of \"retrieve\"\n # in the Maxima file macsys.lisp. This routine is normally responsible\n # for displaying a question and returning the answer. We change it to\n@@ -1213,7 +1216,8 @@ sage_op_dict = {\n     sage.symbolic.expression.operator.neg : \"MMINUS\",\n     sage.symbolic.expression.operator.pow : \"MEXPT\",\n     sage.symbolic.expression.operator.or_ : \"MOR\",\n-    sage.symbolic.expression.operator.and_ : \"MAND\",\n+    #sage.symbolic.expression.operator.and_ : \"MAND\",\n```\n",
    "created_at": "2021-08-13T22:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452416",
    "user": "@mkoeppe"
}
```

For converting to maxima, some help would be welcome. My last failed attempt looked like this:

```diff
diff --git a/src/sage/functions/boolean.py b/src/sage/functions/boolean.py
index 58089dce81..d32acca761 100644
--- a/src/sage/functions/boolean.py
+++ b/src/sage/functions/boolean.py
@@ -31,7 +31,8 @@ class AndSymbolic(BuiltinFunction):
 
         """
         BuiltinFunction.__init__(self, 'and_symbolic', nargs=0,
-                                 conversions=dict(sympy='And'))
+                                 conversions=dict(sympy='And',
+                                                  maxima='andsymbolic'))
 
     def _eval_(self, *args):
 
diff --git a/src/sage/interfaces/maxima_lib.py b/src/sage/interfaces/maxima_lib.py
index 40367c5242..2f6ab545f8 100644
--- a/src/sage/interfaces/maxima_lib.py
+++ b/src/sage/interfaces/maxima_lib.py
@@ -113,6 +113,9 @@ ecl_eval('(defun principal nil (cond ($noprincipal (diverg)) ((not pcprntd) (mer
 ecl_eval("(remprop 'mfactorial 'grind)") # don't use ! for factorials (#11539)
 ecl_eval("(setf $errormsg nil)")
 
+ecl_eval("(defmfun $andsymbolic (&rest args) (simplify (cons '(mand) args)))")
+
+
 # the following is a direct adaptation of the definition of "retrieve"
 # in the Maxima file macsys.lisp. This routine is normally responsible
 # for displaying a question and returning the answer. We change it to
@@ -1213,7 +1216,8 @@ sage_op_dict = {
     sage.symbolic.expression.operator.neg : "MMINUS",
     sage.symbolic.expression.operator.pow : "MEXPT",
     sage.symbolic.expression.operator.or_ : "MOR",
-    sage.symbolic.expression.operator.and_ : "MAND",
+    #sage.symbolic.expression.operator.and_ : "MAND",
```




---

archive/issue_comments_452417.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-08-13T22:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452417",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_452418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-13T22:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452418",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452419.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-13T23:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452419",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452420.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T02:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452420",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452421.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T03:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452421",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452422.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T03:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452422",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452423.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T04:51:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452423",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452424.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-08-14T05:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452424",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_452425.json:
```json
{
    "body": "Thank you for implementing this!\n\nIt seems that there is no entry for the new symbolic boolean operators in the reference manual. There should probably be more examples of use. A few naive trials:\n\n```\nsage: var('x y')\n(x, y)\nsage: s = x>0 & y<0\nTypeError: unsupported operand type(s) for &: 'sage.symbolic.expression.Expression'\n and 'sage.symbolic.expression.Expression'\n```\n\n\n\n```\nsage: from sage.functions.boolean import and_symbolic\nsage: s = and_symbolic(x>0, y<0)\nsage: bool(s.subs({x: 1, y: -2}))\nTypeError: unable to make sense of Maxima expression 'and_symbolic(1>0,-2<0)'\n in Sage\n```\n",
    "created_at": "2021-08-14T15:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452425",
    "user": "@egourgoulhon"
}
```

Thank you for implementing this!

It seems that there is no entry for the new symbolic boolean operators in the reference manual. There should probably be more examples of use. A few naive trials:

```
sage: var('x y')
(x, y)
sage: s = x>0 & y<0
TypeError: unsupported operand type(s) for &: 'sage.symbolic.expression.Expression'
 and 'sage.symbolic.expression.Expression'
```



```
sage: from sage.functions.boolean import and_symbolic
sage: s = and_symbolic(x>0, y<0)
sage: bool(s.subs({x: 1, y: -2}))
TypeError: unable to make sense of Maxima expression 'and_symbolic(1>0,-2<0)'
 in Sage
```




---

archive/issue_comments_452426.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T16:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452426",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452427.json:
```json
{
    "body": "Replying to [comment:20 egourgoulhon]:\n> {{{\n> sage: var('x y')\n> (x, y)\n> sage: s = x>0 & y<0\n> TypeError: unsupported operand type(s) for &: 'sage.symbolic.expression.Expression'\n>  and 'sage.symbolic.expression.Expression'\n> }}}\n\nThe `&` operator is now implemented -- note that due to Python operator precedence, the operands need to be put in parentheses:\n\n```\nsage: var('x y') \n(x, y) \nsage: (x>0) & (y<0)                                                                                                                                                            \nand_symbolic(x > 0, y < 0)\n```\n",
    "created_at": "2021-08-14T16:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452427",
    "user": "@mkoeppe"
}
```

Replying to [comment:20 egourgoulhon]:
> {{{
> sage: var('x y')
> (x, y)
> sage: s = x>0 & y<0
> TypeError: unsupported operand type(s) for &: 'sage.symbolic.expression.Expression'
>  and 'sage.symbolic.expression.Expression'
> }}}

The `&` operator is now implemented -- note that due to Python operator precedence, the operands need to be put in parentheses:

```
sage: var('x y') 
(x, y) 
sage: (x>0) & (y<0)                                                                                                                                                            
and_symbolic(x > 0, y < 0)
```




---

archive/issue_comments_452428.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T17:15:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452428",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452429.json:
```json
{
    "body": "This is work in progress, no ?\n\n* A `symbolic_not` is necessary. It might implement De Morgan's equalities (or this could be delegated to `.expand` and `.factor`, or, alternatively delegated to the [logical functions](https://doc.sagemath.org/html/en/reference/logic/index.html)).\n\n* These functions currently do nothing :\n\n\n```\nsage: var(\"a, b\")                                                               \n(a, b)\nsage: and_symbolic((a>0), (b<0))                                                \n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-2-67fb44f33113> in <module>\n----> 1 and_symbolic((a>Integer(0)), (b<Integer(0)))\n\nNameError: name 'and_symbolic' is not defined\nsage: (a>0) & (b<0)                                                             \nand_symbolic(a > 0, b < 0)\nsage: ((a>0) & (b<0)).subs(a==3)                                                \nand_symbolic(3 > 0, b < 0)\n```\n\n\nCompare :\n\n```\nsage: ((a>0) & (b<0)).subs(a==3)._sympy_().simplify()._sage_()                  \nb < 0\nsage: sympy.Not(sympy.And(a._sympy_(), b._sympy_()))                            \n~(a & b)\nsage: sympy.Not(sympy.And(a._sympy_(), b._sympy_())).simplify()                 \n~a | ~b\n```\n\n\n==> `needs_work`\n----\nNew commits:",
    "created_at": "2021-08-14T17:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452429",
    "user": "@EmmanuelCharpentier"
}
```

This is work in progress, no ?

* A `symbolic_not` is necessary. It might implement De Morgan's equalities (or this could be delegated to `.expand` and `.factor`, or, alternatively delegated to the [logical functions](https://doc.sagemath.org/html/en/reference/logic/index.html)).

* These functions currently do nothing :


```
sage: var("a, b")                                                               
(a, b)
sage: and_symbolic((a>0), (b<0))                                                
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-2-67fb44f33113> in <module>
----> 1 and_symbolic((a>Integer(0)), (b<Integer(0)))

NameError: name 'and_symbolic' is not defined
sage: (a>0) & (b<0)                                                             
and_symbolic(a > 0, b < 0)
sage: ((a>0) & (b<0)).subs(a==3)                                                
and_symbolic(3 > 0, b < 0)
```


Compare :

```
sage: ((a>0) & (b<0)).subs(a==3)._sympy_().simplify()._sage_()                  
b < 0
sage: sympy.Not(sympy.And(a._sympy_(), b._sympy_()))                            
~(a & b)
sage: sympy.Not(sympy.And(a._sympy_(), b._sympy_())).simplify()                 
~a | ~b
```


==> `needs_work`
----
New commits:



---

archive/issue_comments_452430.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-14T17:19:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452430",
    "user": "@EmmanuelCharpentier"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_452431.json:
```json
{
    "body": "Replying to [comment:25 charpent]:\n> This is work in progress, no ?\n\nYes; setting it to \"needs review\" allows the patchbot to run",
    "created_at": "2021-08-14T17:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452431",
    "user": "@mkoeppe"
}
```

Replying to [comment:25 charpent]:
> This is work in progress, no ?

Yes; setting it to "needs review" allows the patchbot to run



---

archive/issue_comments_452432.json:
```json
{
    "body": "`and_symbolic` is not a global binding -- you need to import it to use it, or the `NameError` shows up. See doctests",
    "created_at": "2021-08-14T17:22:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452432",
    "user": "@mkoeppe"
}
```

`and_symbolic` is not a global binding -- you need to import it to use it, or the `NameError` shows up. See doctests



---

archive/issue_comments_452433.json:
```json
{
    "body": "Replying to [comment:25 charpent]:\n> * A `symbolic_not` is necessary. \n\nYes, good point; any help with implementing it is welcome...",
    "created_at": "2021-08-14T17:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452433",
    "user": "@mkoeppe"
}
```

Replying to [comment:25 charpent]:
> * A `symbolic_not` is necessary. 

Yes, good point; any help with implementing it is welcome...



---

archive/issue_comments_452434.json:
```json
{
    "body": "Do we want `and_symbolic`, `or_symbolic`, `not_symbolic` as global bindings?\n\n(The names are modeled after the existing `min_symbolic`, `max_symbolic`.)\n\nIn particular, for `not_symbolic`, we cannot rely on an operator to make it available: Sage already repurposes the bitwise inversion operator `~` for multiplicative inversion.",
    "created_at": "2021-08-14T17:39:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452434",
    "user": "@mkoeppe"
}
```

Do we want `and_symbolic`, `or_symbolic`, `not_symbolic` as global bindings?

(The names are modeled after the existing `min_symbolic`, `max_symbolic`.)

In particular, for `not_symbolic`, we cannot rely on an operator to make it available: Sage already repurposes the bitwise inversion operator `~` for multiplicative inversion.



---

archive/issue_comments_452435.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2021-08-14T17:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452435",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_452436.json:
```json
{
    "body": "Replying to [comment:27 mkoeppe]:\n> `and_symbolic` is not a global binding -- you need to import it to use it, or the `NameError` shows up. See doctests\n\n`and_symbolic` is a tad heavy to be exported. However, global `And`, `Or` and `Not` would be welcome...\n\nBTW, that's how they are  known in Sympy...",
    "created_at": "2021-08-14T17:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452436",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:27 mkoeppe]:
> `and_symbolic` is not a global binding -- you need to import it to use it, or the `NameError` shows up. See doctests

`and_symbolic` is a tad heavy to be exported. However, global `And`, `Or` and `Not` would be welcome...

BTW, that's how they are  known in Sympy...



---

archive/issue_comments_452437.json:
```json
{
    "body": "But capitalized And, Or, Not seem out of line with our naming scheme for symbolic functions - they are all lowercase if I'm not mistaken.",
    "created_at": "2021-08-14T17:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452437",
    "user": "@mkoeppe"
}
```

But capitalized And, Or, Not seem out of line with our naming scheme for symbolic functions - they are all lowercase if I'm not mistaken.



---

archive/issue_comments_452438.json:
```json
{
    "body": "(see `src/sage/functions/all.py`)",
    "created_at": "2021-08-14T17:50:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452438",
    "user": "@mkoeppe"
}
```

(see `src/sage/functions/all.py`)



---

archive/issue_comments_452439.json:
```json
{
    "body": "For extending `sage.misc.parser`, I would follow `sage.logic.logicparser` (even though I am not sure of its relevance), which uses `~` for logical 'not'. (It also uses `->` and `<->` for implication/equivalence; and (incompatible with the expression parser) `^` for logical 'xor'.)",
    "created_at": "2021-08-14T18:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452439",
    "user": "@mkoeppe"
}
```

For extending `sage.misc.parser`, I would follow `sage.logic.logicparser` (even though I am not sure of its relevance), which uses `~` for logical 'not'. (It also uses `->` and `<->` for implication/equivalence; and (incompatible with the expression parser) `^` for logical 'xor'.)



---

archive/issue_comments_452440.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T18:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452440",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452441.json:
```json
{
    "body": "Replying to [comment:34 mkoeppe]:\n> For extending `sage.misc.parser`, I would follow `sage.logic.logicparser` (even though I am not sure of its relevance), which uses `~` for logical 'not'. (It also uses `->` and `<->` for implication/equivalence; and (incompatible with the expression parser) `^` for logical 'xor'.)\n\nThis would entail conditioning the interpretation of `~` to the type of its arguments, which is fishy : `~(x>0)` is indubitably a logical expression, but `~(x>0).subs(x==0)` could be understood as ~True}}}, which is ... -2 (!).\n\n`Not` can be unambiguous, and nine characters lighter than \"symbolic_not\" ; furthermore, \"our naming scheme for symbolic functions\" is a scheme, not Gospel...\n----\nNew commits:",
    "created_at": "2021-08-14T18:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452441",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:34 mkoeppe]:
> For extending `sage.misc.parser`, I would follow `sage.logic.logicparser` (even though I am not sure of its relevance), which uses `~` for logical 'not'. (It also uses `->` and `<->` for implication/equivalence; and (incompatible with the expression parser) `^` for logical 'xor'.)

This would entail conditioning the interpretation of `~` to the type of its arguments, which is fishy : `~(x>0)` is indubitably a logical expression, but `~(x>0).subs(x==0)` could be understood as ~True}}}, which is ... -2 (!).

`Not` can be unambiguous, and nine characters lighter than "symbolic_not" ; furthermore, "our naming scheme for symbolic functions" is a scheme, not Gospel...
----
New commits:



---

archive/issue_comments_452442.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T18:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452442",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452443.json:
```json
{
    "body": "Replying to [comment:36 charpent]:\n> Replying to [comment:34 mkoeppe]:\n> > For extending `sage.misc.parser`, I would follow `sage.logic.logicparser` (even though I am not sure of its relevance), which uses `~` for logical 'not'. [...]\n> \n> This would entail conditioning the interpretation of `~` [...]\n\nNote, this is just for the expression parser, not for Python semantics.\n\nAs I said in comment:29, we cannot use Python operators to make the operation available. We agree here.",
    "created_at": "2021-08-14T18:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452443",
    "user": "@mkoeppe"
}
```

Replying to [comment:36 charpent]:
> Replying to [comment:34 mkoeppe]:
> > For extending `sage.misc.parser`, I would follow `sage.logic.logicparser` (even though I am not sure of its relevance), which uses `~` for logical 'not'. [...]
> 
> This would entail conditioning the interpretation of `~` [...]

Note, this is just for the expression parser, not for Python semantics.

As I said in comment:29, we cannot use Python operators to make the operation available. We agree here.



---

archive/issue_comments_452444.json:
```json
{
    "body": "Replying to [comment:36 charpent]:\n> `Not` can be unambiguous, and nine characters lighter than \"symbolic_not\" ; \n\nIt would be `not_symbolic`, which is discoverable by typing `not<TAB>` and autocompletes from `not_<TAB>`, so I don't think the length is a significant burden.",
    "created_at": "2021-08-14T18:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452444",
    "user": "@mkoeppe"
}
```

Replying to [comment:36 charpent]:
> `Not` can be unambiguous, and nine characters lighter than "symbolic_not" ; 

It would be `not_symbolic`, which is discoverable by typing `not<TAB>` and autocompletes from `not_<TAB>`, so I don't think the length is a significant burden.



---

archive/issue_comments_452445.json:
```json
{
    "body": "Replying to [comment:38 mkoeppe]:\n> Replying to [comment:36 charpent]:\n> > Replying to [comment:34 mkoeppe]:\n> > > For extending `sage.misc.parser`, I would follow `sage.logic.logicparser` (even though I am not sure of its relevance), which uses `~` for logical 'not'. [...]\n> > \n> > This would entail conditioning the interpretation of `~` [...]\n> \n> Note, this is just for the expression parser, not for Python semantics.\n> \n> As I said in comment:29, we cannot use Python operators to make the operation available. We agree here.\n\n\n\nPossible alternatives :\n\n* forget operators, and limit this functionality to logic functions.\n\n* Borrow inspiration from R and create `&&`, `||` and possibly `~~` operators (analogous  to our representation of bit XOR as `^^`).\n\nIMHO, a functional representatin is the most useful...",
    "created_at": "2021-08-14T18:36:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452445",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:38 mkoeppe]:
> Replying to [comment:36 charpent]:
> > Replying to [comment:34 mkoeppe]:
> > > For extending `sage.misc.parser`, I would follow `sage.logic.logicparser` (even though I am not sure of its relevance), which uses `~` for logical 'not'. [...]
> > 
> > This would entail conditioning the interpretation of `~` [...]
> 
> Note, this is just for the expression parser, not for Python semantics.
> 
> As I said in comment:29, we cannot use Python operators to make the operation available. We agree here.



Possible alternatives :

* forget operators, and limit this functionality to logic functions.

* Borrow inspiration from R and create `&&`, `||` and possibly `~~` operators (analogous  to our representation of bit XOR as `^^`).

IMHO, a functional representatin is the most useful...



---

archive/issue_comments_452446.json:
```json
{
    "body": "Replying to [comment:40 charpent]:\n> create `&&`, `||` and possibly `~~` operators (analogous  to our representation of bit XOR as `^^`).\n\nYou mean in the preparser?  I'll not touch that.\n\nIn just Python, creating new operators such as `&&` is not possible.",
    "created_at": "2021-08-14T18:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452446",
    "user": "@mkoeppe"
}
```

Replying to [comment:40 charpent]:
> create `&&`, `||` and possibly `~~` operators (analogous  to our representation of bit XOR as `^^`).

You mean in the preparser?  I'll not touch that.

In just Python, creating new operators such as `&&` is not possible.



---

archive/issue_comments_452447.json:
```json
{
    "body": "Something is fishhy in the maxima__>Sage conversion :\n\n\n```\nsage: maxima(\"(a>0) and (b<0)\")                                                 \na>0andb<0\nsage: maxima(\"(a>0) and (b<0)\")._sage_()                                        \nand_symbolic(a > 0, 0 < 0)\n```\n\n\n* The second clause is ill-translated\n\n* the operator's translation should be `&` (or a call to `symbolic_and` or `And`).",
    "created_at": "2021-08-14T18:58:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452447",
    "user": "@EmmanuelCharpentier"
}
```

Something is fishhy in the maxima__>Sage conversion :


```
sage: maxima("(a>0) and (b<0)")                                                 
a>0andb<0
sage: maxima("(a>0) and (b<0)")._sage_()                                        
and_symbolic(a > 0, 0 < 0)
```


* The second clause is ill-translated

* the operator's translation should be `&` (or a call to `symbolic_and` or `And`).



---

archive/issue_comments_452448.json:
```json
{
    "body": "Yes, see comment:10 -- I have not figured out maxima conversion -- hoping for help from the experts",
    "created_at": "2021-08-14T19:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452448",
    "user": "@mkoeppe"
}
```

Yes, see comment:10 -- I have not figured out maxima conversion -- hoping for help from the experts



---

archive/issue_comments_452449.json:
```json
{
    "body": "\n```\nsage: maxima(\"(a>0) and (b<0)\")                                                 \na>0andb<0\n```\n\nDidn't you fix the whitespace-eating behavior some time recently?",
    "created_at": "2021-08-14T19:01:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452449",
    "user": "@mkoeppe"
}
```


```
sage: maxima("(a>0) and (b<0)")                                                 
a>0andb<0
```

Didn't you fix the whitespace-eating behavior some time recently?



---

archive/issue_comments_452450.json:
```json
{
    "body": "Note\n\n```\nsage: sage.calculus.calculus.symbolic_expression_from_string(\"a>0andb<0\", accept_sequence=True)                          \nand_symbolic(a > 0, 0 < 0)\nsage: sage.calculus.calculus.symbolic_expression_from_string(\"a>0and b<0\", accept_sequence=True)                         \nand_symbolic(a > 0, b < 0)\nsage: sage.calculus.calculus.symbolic_expression_from_string(\"0andb\", accept_sequence=True)                              \n0\n```\n",
    "created_at": "2021-08-14T19:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452450",
    "user": "@mkoeppe"
}
```

Note

```
sage: sage.calculus.calculus.symbolic_expression_from_string("a>0andb<0", accept_sequence=True)                          
and_symbolic(a > 0, 0 < 0)
sage: sage.calculus.calculus.symbolic_expression_from_string("a>0and b<0", accept_sequence=True)                         
and_symbolic(a > 0, b < 0)
sage: sage.calculus.calculus.symbolic_expression_from_string("0andb", accept_sequence=True)                              
0
```




---

archive/issue_comments_452451.json:
```json
{
    "body": "Our expression parser has poor error checking and silently ignores unexpected trailing tokens in some situations:\n\n```\nsage: sage.calculus.calculus.symbolic_expression_from_string(\"0fffffif\", accept_sequence=True)                           \n0\n```\n",
    "created_at": "2021-08-14T19:18:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452451",
    "user": "@mkoeppe"
}
```

Our expression parser has poor error checking and silently ignores unexpected trailing tokens in some situations:

```
sage: sage.calculus.calculus.symbolic_expression_from_string("0fffffif", accept_sequence=True)                           
0
```




---

archive/issue_comments_452452.json:
```json
{
    "body": "Actually, this is just implicit multiplication `0*fffffif`, which gets simplified to 0.",
    "created_at": "2021-08-14T19:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452452",
    "user": "@mkoeppe"
}
```

Actually, this is just implicit multiplication `0*fffffif`, which gets simplified to 0.



---

archive/issue_comments_452453.json:
```json
{
    "body": "Replying to [comment:45 mkoeppe]:\n> {{{\n> sage: maxima(\"(a>0) and (b<0)\")                                                 \n> a>0andb<0\n> }}}\n> Didn't you fix the whitespace-eating behavior some time recently?\n\nI see, that's #31796, which appears to be stuck",
    "created_at": "2021-08-14T19:23:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452453",
    "user": "@mkoeppe"
}
```

Replying to [comment:45 mkoeppe]:
> {{{
> sage: maxima("(a>0) and (b<0)")                                                 
> a>0andb<0
> }}}
> Didn't you fix the whitespace-eating behavior some time recently?

I see, that's #31796, which appears to be stuck



---

archive/issue_comments_452454.json:
```json
{
    "body": "Replying to [comment:45 mkoeppe]:\n> {{{\n> sage: maxima(\"(a>0) and (b<0)\")                                                 \n> a>0andb<0\n> }}}\n> Didn't you fix the whitespace-eating behavior some time recently?\n> \n\nI tried. But this patch entailed other bugs, which I hanven't yet understood == back to the old drawing board...",
    "created_at": "2021-08-14T20:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452454",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:45 mkoeppe]:
> {{{
> sage: maxima("(a>0) and (b<0)")                                                 
> a>0andb<0
> }}}
> Didn't you fix the whitespace-eating behavior some time recently?
> 

I tried. But this patch entailed other bugs, which I hanven't yet understood == back to the old drawing board...



---

archive/issue_comments_452455.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T21:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452455",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452456.json:
```json
{
    "body": "Now, with the repaired #31796 merged, the problem is fixed:\n\n```\nsage: maxima(\"(a>0) and (b<0)\")                                                                                    \na > 0 and b < 0\nsage: maxima(\"(a>0) and (b<0)\")._sage_()                                                                           \nand_symbolic(a > 0, b < 0)\n```\n",
    "created_at": "2021-08-14T21:19:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452456",
    "user": "@mkoeppe"
}
```

Now, with the repaired #31796 merged, the problem is fixed:

```
sage: maxima("(a>0) and (b<0)")                                                                                    
a > 0 and b < 0
sage: maxima("(a>0) and (b<0)")._sage_()                                                                           
and_symbolic(a > 0, b < 0)
```




---

archive/issue_comments_452457.json:
```json
{
    "body": "I'm setting this again to `needs_review` so that the patchbot runs; obviously more work is needed.",
    "created_at": "2021-08-14T21:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452457",
    "user": "@mkoeppe"
}
```

I'm setting this again to `needs_review` so that the patchbot runs; obviously more work is needed.



---

archive/issue_comments_452458.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2021-08-14T21:22:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452458",
    "user": "@mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_452459.json:
```json
{
    "body": "Replying to [comment:53 mkoeppe]:\n> Now, with the repaired #31796 merged, the problem is fixed:\n> {{{\n> sage: maxima(\"(a>0) and (b<0)\")                                                                                    \n> a > 0 and b < 0\n> sage: maxima(\"(a>0) and (b<0)\")._sage_()                                                                           \n> and_symbolic(a > 0, b < 0)\n> }}}\n\nThanks a lot ; I was searching in that direction, but missed the target you reached masterfully. Kudos !\n\nBTW : \"something\" translating Maxima's `is` would be as useful as a translation of Maxima's `and`, `or` and `not`, necessary for the present ticket : \n\n\n```\n(%i3) is(a>2);\n(%o3)                               unknown\n(%i4) is(subst([a=3],a>2));\n(%o4)                                true\n```\n\n\nNot coincidentally, it has the same Sage syntax collision problem...\n\nShouldn't it be added to this ticket ? Alternatively, we could create a new ticket for this and and depend on it.",
    "created_at": "2021-08-14T21:46:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452459",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:53 mkoeppe]:
> Now, with the repaired #31796 merged, the problem is fixed:
> {{{
> sage: maxima("(a>0) and (b<0)")                                                                                    
> a > 0 and b < 0
> sage: maxima("(a>0) and (b<0)")._sage_()                                                                           
> and_symbolic(a > 0, b < 0)
> }}}

Thanks a lot ; I was searching in that direction, but missed the target you reached masterfully. Kudos !

BTW : "something" translating Maxima's `is` would be as useful as a translation of Maxima's `and`, `or` and `not`, necessary for the present ticket : 


```
(%i3) is(a>2);
(%o3)                               unknown
(%i4) is(subst([a=3],a>2));
(%o4)                                true
```


Not coincidentally, it has the same Sage syntax collision problem...

Shouldn't it be added to this ticket ? Alternatively, we could create a new ticket for this and and depend on it.



---

archive/issue_comments_452460.json:
```json
{
    "body": "Could you elaborate on `is`? What collides with what?",
    "created_at": "2021-08-14T21:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452460",
    "user": "@mkoeppe"
}
```

Could you elaborate on `is`? What collides with what?



---

archive/issue_comments_452461.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T22:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452461",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452462.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T22:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452462",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452463.json:
```json
{
    "body": "Replying to [comment:56 mkoeppe]:\n> Could you elaborate on `is`? What collides with what?\n\n`is` is a Sage operator, roughly equivalent to Lisp's `eq` :\n\n```\nsage: x.parent() is SR\nTrue\n```\n\n\nTherefore, the Maxima's `is` can't be translated by the mechanism used for Maxima's functions : \n\n```\nsage: maxima.is(x>0)\n  File \"<ipython-input-6-e177b9fc4016>\", line 1\n    maxima.is(x>Integer(0))\n           ^\nSyntaxError: invalid syntax\n\nsage: maxima_calculus.is(x>0)\n  File \"<ipython-input-7-dea1cf49bee0>\", line 1\n    maxima_calculus.is(x>Integer(0))\n                    ^\nSyntaxError: invalid syntax\n```\n",
    "created_at": "2021-08-14T22:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452463",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:56 mkoeppe]:
> Could you elaborate on `is`? What collides with what?

`is` is a Sage operator, roughly equivalent to Lisp's `eq` :

```
sage: x.parent() is SR
True
```


Therefore, the Maxima's `is` can't be translated by the mechanism used for Maxima's functions : 

```
sage: maxima.is(x>0)
  File "<ipython-input-6-e177b9fc4016>", line 1
    maxima.is(x>Integer(0))
           ^
SyntaxError: invalid syntax

sage: maxima_calculus.is(x>0)
  File "<ipython-input-7-dea1cf49bee0>", line 1
    maxima_calculus.is(x>Integer(0))
                    ^
SyntaxError: invalid syntax
```




---

archive/issue_comments_452464.json:
```json
{
    "body": "A simple workaround for this is:\n\n```\nsage: getattr(maxima, 'is')(x>0)                                                                                         \nunknown\n```\n",
    "created_at": "2021-08-14T22:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452464",
    "user": "@mkoeppe"
}
```

A simple workaround for this is:

```
sage: getattr(maxima, 'is')(x>0)                                                                                         
unknown
```




---

archive/issue_comments_452465.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T22:51:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452465",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452466.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-14T23:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452466",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452467.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-15T00:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452467",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452468.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-15T00:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452468",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452469.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> For converting to maxima, some help would be welcome.\n\nI think I figured a solution",
    "created_at": "2021-08-15T00:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452469",
    "user": "@mkoeppe"
}
```

Replying to [comment:10 mkoeppe]:
> For converting to maxima, some help would be welcome.

I think I figured a solution



---

archive/issue_comments_452470.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-15T04:37:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452470",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452471.json:
```json
{
    "body": "Still problematic :\n\n```\nsage: not_symbolic((a>0) & ((b<0) | (x!=0))).simplify()\na <= 0\n```\n\nWorse :\n\n```\nsage: ((a>0) | (x!=0)).simplify()\n1\n```\n\nBTW :\n\n```\nsage: ~((a>0) & ((b<0) | (x!=0)))\n1/and_symbolic(a > 0, or_symbolic(b < 0, x != 0))\n```\n",
    "created_at": "2021-08-15T09:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452471",
    "user": "@EmmanuelCharpentier"
}
```

Still problematic :

```
sage: not_symbolic((a>0) & ((b<0) | (x!=0))).simplify()
a <= 0
```

Worse :

```
sage: ((a>0) | (x!=0)).simplify()
1
```

BTW :

```
sage: ~((a>0) & ((b<0) | (x!=0)))
1/and_symbolic(a > 0, or_symbolic(b < 0, x != 0))
```




---

archive/issue_comments_452472.json:
```json
{
    "body": "Indeed:\n\n```\nsage: var('a,b')                                                                                                         \n(a, b)\nsage: ((a>0) | (x!=0)).simplify()                                                                                        \n1\nsage: ((a>0) | (x!=0))._maxima_()                                                                                        \ntrue\nsage: ((a>0) | (x!=0))                                                                                                   \nor_symbolic(a > 0, x != 0)\nsage: f = ((a>0) | (x!=0))                                                                                               \nsage: f._maxima_init_()                                                                                                  \n'(_SAGE_VAR_a > 0) or (_SAGE_VAR_x # 0)'\nsage: maxima(_)                                                                                                          \ntrue\nsage: (x!=0)._maxima_()                                                                                                  \n_SAGE_VAR_x # 0\nsage: (a>0)._maxima_()                                                                                                   \n_SAGE_VAR_a > 0\nsage: maxima('(a>0) or (x # 0)')                                                                                         \ntrue\n```\n\nIs this a maxima bug?",
    "created_at": "2021-08-15T14:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452472",
    "user": "@mkoeppe"
}
```

Indeed:

```
sage: var('a,b')                                                                                                         
(a, b)
sage: ((a>0) | (x!=0)).simplify()                                                                                        
1
sage: ((a>0) | (x!=0))._maxima_()                                                                                        
true
sage: ((a>0) | (x!=0))                                                                                                   
or_symbolic(a > 0, x != 0)
sage: f = ((a>0) | (x!=0))                                                                                               
sage: f._maxima_init_()                                                                                                  
'(_SAGE_VAR_a > 0) or (_SAGE_VAR_x # 0)'
sage: maxima(_)                                                                                                          
true
sage: (x!=0)._maxima_()                                                                                                  
_SAGE_VAR_x # 0
sage: (a>0)._maxima_()                                                                                                   
_SAGE_VAR_a > 0
sage: maxima('(a>0) or (x # 0)')                                                                                         
true
```

Is this a maxima bug?



---

archive/issue_comments_452473.json:
```json
{
    "body": "Replying to [comment:69 charpent]:\n> BTW :\n> {{{\n> sage: ~((a>0) & ((b<0) | (x!=0)))\n> 1/and_symbolic(a > 0, or_symbolic(b < 0, x != 0))\n> }}}\n\nYes, this is as discussed in comment:29, comment:38.",
    "created_at": "2021-08-15T14:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452473",
    "user": "@mkoeppe"
}
```

Replying to [comment:69 charpent]:
> BTW :
> {{{
> sage: ~((a>0) & ((b<0) | (x!=0)))
> 1/and_symbolic(a > 0, or_symbolic(b < 0, x != 0))
> }}}

Yes, this is as discussed in comment:29, comment:38.



---

archive/issue_comments_452474.json:
```json
{
    "body": "Replying to [comment:70 mkoeppe]:\n> Is this a maxima bug?\n\nMinimal example in plain maxima 5.45.0:\n\n```\n(%i8) (x#0);\n(%o8)                                x # 0\n(%i9) (x#0) or (x#0);\n(%o9)                                true\n```\n",
    "created_at": "2021-08-15T14:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452474",
    "user": "@mkoeppe"
}
```

Replying to [comment:70 mkoeppe]:
> Is this a maxima bug?

Minimal example in plain maxima 5.45.0:

```
(%i8) (x#0);
(%o8)                                x # 0
(%i9) (x#0) or (x#0);
(%o9)                                true
```




---

archive/issue_comments_452475.json:
```json
{
    "body": "I think our translation of Python's `==` and `!=` to `=` and `#` on the Maxima side is wrong, and we should use `equal` and `notequal` instead - see https://maxima.sourceforge.io/docs/manual/maxima_169.html (Special operator: if)",
    "created_at": "2021-08-15T15:02:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452475",
    "user": "@mkoeppe"
}
```

I think our translation of Python's `==` and `!=` to `=` and `#` on the Maxima side is wrong, and we should use `equal` and `notequal` instead - see https://maxima.sourceforge.io/docs/manual/maxima_169.html (Special operator: if)



---

archive/issue_comments_452476.json:
```json
{
    "body": "Replying to [comment:72 mkoeppe]:\n> Replying to [comment:70 mkoeppe]:\n> > Is this a maxima bug?\n> \n> Minimal example in plain maxima 5.45.0:\n> {{{\n> (%i8) (x#0);\n> (%o8)                                x # 0\n> (%i9) (x#0) or (x#0);\n> (%o9)                                true\n> }}}\n> \n\nDid you (or do you plan to) report it in Maxima's bug report system ?\n\nBTW : Sympy's logical functions seem exempt from this bug :\n\n```\nsage: foo = x!=0\nsage: sympy.And(*map(lambda u:u._sympy_(), (foo, foo)))._sage_()\nx != 0\nsage: sympy.Or(*map(lambda u:u._sympy_(), (foo, foo)))._sage_()\nx != 0\nsage: sympy.Not(foo._sympy_())._sage_()\nx == 0\n```\n\nWrapping Sympy's functions may be a quick way out (that was my initial plan...).",
    "created_at": "2021-08-15T15:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452476",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:72 mkoeppe]:
> Replying to [comment:70 mkoeppe]:
> > Is this a maxima bug?
> 
> Minimal example in plain maxima 5.45.0:
> {{{
> (%i8) (x#0);
> (%o8)                                x # 0
> (%i9) (x#0) or (x#0);
> (%o9)                                true
> }}}
> 

Did you (or do you plan to) report it in Maxima's bug report system ?

BTW : Sympy's logical functions seem exempt from this bug :

```
sage: foo = x!=0
sage: sympy.And(*map(lambda u:u._sympy_(), (foo, foo)))._sage_()
x != 0
sage: sympy.Or(*map(lambda u:u._sympy_(), (foo, foo)))._sage_()
x != 0
sage: sympy.Not(foo._sympy_())._sage_()
x == 0
```

Wrapping Sympy's functions may be a quick way out (that was my initial plan...).



---

archive/issue_comments_452477.json:
```json
{
    "body": "Replying to [comment:73 mkoeppe]:\n> I think our translation of Python's `==` and `!=` to `=` and `#` on the Maxima side is wrong, and we should use `equal` and `notequal` instead - see https://maxima.sourceforge.io/docs/manual/maxima_169.html (Special operator: if)\n\nDoesn't seem to be a question of precedence :\n\n```\n(%i9) x#0 or x#0;\n\n(%o9) true\n(%i10) (x#0) or (x#0);\n\n(%o10) true\n```\n",
    "created_at": "2021-08-15T15:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452477",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:73 mkoeppe]:
> I think our translation of Python's `==` and `!=` to `=` and `#` on the Maxima side is wrong, and we should use `equal` and `notequal` instead - see https://maxima.sourceforge.io/docs/manual/maxima_169.html (Special operator: if)

Doesn't seem to be a question of precedence :

```
(%i9) x#0 or x#0;

(%o9) true
(%i10) (x#0) or (x#0);

(%o10) true
```




---

archive/issue_comments_452478.json:
```json
{
    "body": "No, I no longer think this is a Maxima bug.\n\nI think it is a bug in our interface `sage.interfaces.maxima_abstract`. There are already two places that work around it (by using `equal`, `notequal`): `Expression._maxima_init_assume_` and `test_relation_maxima`.",
    "created_at": "2021-08-15T15:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452478",
    "user": "@mkoeppe"
}
```

No, I no longer think this is a Maxima bug.

I think it is a bug in our interface `sage.interfaces.maxima_abstract`. There are already two places that work around it (by using `equal`, `notequal`): `Expression._maxima_init_assume_` and `test_relation_maxima`.



---

archive/issue_comments_452479.json:
```json
{
    "body": "See the early tickets #1163, #2218",
    "created_at": "2021-08-15T15:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452479",
    "user": "@mkoeppe"
}
```

See the early tickets #1163, #2218



---

archive/issue_comments_452480.json:
```json
{
    "body": "Replying to [comment:76 mkoeppe]:\n> No, I no longer think this is a Maxima bug.\n> \n> I think it is a bug in our interface `sage.interfaces.maxima_abstract`. There are already two places that work around it (by using `equal`, `notequal`): `Expression._maxima_init_assume_` and `test_relation_maxima`.\n> \n\nIndeed, the documentation is quite clear : `=` and `#` : //syntactic// (in)equality (i. e. isomorphic structures) ; `equal` and `unequal` : //value// (= structural) (in)equality.\n\nThis might be a heavy change. Separate ticket, separately tested ?",
    "created_at": "2021-08-15T15:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452480",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:76 mkoeppe]:
> No, I no longer think this is a Maxima bug.
> 
> I think it is a bug in our interface `sage.interfaces.maxima_abstract`. There are already two places that work around it (by using `equal`, `notequal`): `Expression._maxima_init_assume_` and `test_relation_maxima`.
> 

Indeed, the documentation is quite clear : `=` and `#` : //syntactic// (in)equality (i. e. isomorphic structures) ; `equal` and `unequal` : //value// (= structural) (in)equality.

This might be a heavy change. Separate ticket, separately tested ?



---

archive/issue_comments_452481.json:
```json
{
    "body": "Yes, I agree. There is a big potential for breakage. I've opened #32383 for it.",
    "created_at": "2021-08-15T16:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452481",
    "user": "@mkoeppe"
}
```

Yes, I agree. There is a big potential for breakage. I've opened #32383 for it.



---

archive/issue_comments_452482.json:
```json
{
    "body": "A possible plan B (independent of the Maxima snag) is to wrap Sympy's symbolic functions `And`, `Or` and `Not`, possibly leaving the logical operators to a later ticket. This is easy, the only problem being Maxima (1+back)translation, which you have solved.\n\nWrapping a Python method (imptementation of these functions in Sympy) shouldn't be as heavy as invoking a function in another interpreter : we stay in Python.\n\nThis is new functionality, after all : we don't (yet) have to worry about backwards compatibility. Introducing it with limited syntax (possibly extended later) isn't a drawback to anybody.\n\nThoughts ?",
    "created_at": "2021-08-15T16:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452482",
    "user": "@EmmanuelCharpentier"
}
```

A possible plan B (independent of the Maxima snag) is to wrap Sympy's symbolic functions `And`, `Or` and `Not`, possibly leaving the logical operators to a later ticket. This is easy, the only problem being Maxima (1+back)translation, which you have solved.

Wrapping a Python method (imptementation of these functions in Sympy) shouldn't be as heavy as invoking a function in another interpreter : we stay in Python.

This is new functionality, after all : we don't (yet) have to worry about backwards compatibility. Introducing it with limited syntax (possibly extended later) isn't a drawback to anybody.

Thoughts ?



---

archive/issue_comments_452483.json:
```json
{
    "body": "Sympy translation already works, in both directions.",
    "created_at": "2021-08-15T16:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452483",
    "user": "@mkoeppe"
}
```

Sympy translation already works, in both directions.



---

archive/issue_comments_452484.json:
```json
{
    "body": "And there is no remaining issue with \"syntax\".",
    "created_at": "2021-08-15T16:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452484",
    "user": "@mkoeppe"
}
```

And there is no remaining issue with "syntax".



---

archive/issue_comments_452485.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-08-15T23:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452485",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452486.json:
```json
{
    "body": "This passes tests but will need more work:\n- without #32383, roundtripping through maxima is not safe\n- `Parser`: Use a `make_...` function instead of importing `and_symbolic` and hardcoding its use - so that the other uses of `Parser` are not affected\n- Add more documentation and tests\n- possibly create a direct conversion from `bool` to `SR` so that we get to see `False`/`True`, not `0`/`1`\n- various places, for example the `solve` method and global function, should be generalized so that they deal with (at least some) boolean symbolic expressions",
    "created_at": "2021-08-16T04:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452486",
    "user": "@mkoeppe"
}
```

This passes tests but will need more work:
- without #32383, roundtripping through maxima is not safe
- `Parser`: Use a `make_...` function instead of importing `and_symbolic` and hardcoding its use - so that the other uses of `Parser` are not affected
- Add more documentation and tests
- possibly create a direct conversion from `bool` to `SR` so that we get to see `False`/`True`, not `0`/`1`
- various places, for example the `solve` method and global function, should be generalized so that they deal with (at least some) boolean symbolic expressions



---

archive/issue_comments_452487.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-16T04:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452487",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_452488.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2022-02-03T18:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452488",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_452489.json:
```json
{
    "body": "Rebased.",
    "created_at": "2022-02-03T18:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31674",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31674#issuecomment-452489",
    "user": "@mkoeppe"
}
```

Rebased.
