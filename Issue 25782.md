# Issue 25782: py3: fixes to sage.rings.polynomial.real_roots

Issue created by migration from https://trac.sagemath.org/ticket/26019

Original creator: embray

Original creation time: 2018-08-07 10:43:59

This fixes all the tests for this module on Python 3, and also serves as a small follow-up to #25247.


---

Comment by embray created at 2018-08-07 10:44:07

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-08-07 13:48:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-08-10 12:00:49

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-08-10 12:00:49

See patchbot


---

Comment by embray created at 2018-08-10 13:27:35

For the record:


```
sage -t --long src/sage/schemes/elliptic_curves/ell_rational_field.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/ell_rational_field.py", line 3338, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.elliptic_exponential
Failed example:
    2 * E.elliptic_exponential(z)
Expected:
    (-1.52184235874404 - 0.0581413944316544*I : 0.948655866506124 - 0.0381469928565030*I : 1.00000000000000)
Got:
    (-0.379082374337223 + 0.401554153021658*I : -1.64457248125273 + 0.436489289368578*I : 1.00000000000000)
**********************************************************************
File "src/sage/schemes/elliptic_curves/ell_rational_field.py", line 3340, in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.elliptic_exponential
Failed example:
    E.elliptic_exponential(2 * z)
Expected:
    (-1.52184235874404 - 0.0581413944316562*I : 0.948655866506128 - 0.0381469928565034*I : 1.00000000000000)
Got:
    (-0.379082374337223 + 0.401554153021660*I : -1.64457248125273 + 0.436489289368575*I : 1.00000000000000)
**********************************************************************
1 item had failures:
   2 of  21 in sage.schemes.elliptic_curves.ell_rational_field.EllipticCurve_rational_field.elliptic_exponential
    [848 tests, 2 failures, 176.91 s]
----------------------------------------------------------------------
sage -t --long src/sage/schemes/elliptic_curves/ell_rational_field.py  # 2 doctests failed
----------------------------------------------------------------------
```


possibly related to the randomization change but that's not clear yet.


---

Comment by git created at 2018-08-14 13:06:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2018-08-14 13:09:53

This should fix it.  A just as valid fix would have been to change the expected output of the tests that broke, which only broke due to a valid, but non-obvious, change in the PRNG sequence due to adding a call to `randstate.python_random()`, which in turn calls `ZZ.random_element()`.

So technically nothing was actually broken.  Nevertheless, it occurred to me that in this case we were seeding the Python `Random` with `ZZ.random_element()`, and then immediately re-seeding it, which could just as well be avoided by the addition of a new optional argument to `randstate.python_random()`.


---

Comment by embray created at 2018-08-14 13:09:53

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-08-15 06:57:12

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-08-15 06:57:12

ok, then


---

Comment by vbraun created at 2018-08-17 21:13:54

Resolution: fixed
