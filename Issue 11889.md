# Issue 11889: Doctest interfaces/psage.py

Issue created by migration from https://trac.sagemath.org/ticket/12061

Original creator: ppurka

Original creation time: 2011-11-20 08:33:00

Assignee: was

Keywords: doctest

Towards completing #12024

 * Have been unable to figure out what the `.set()` and `.get()` methods do

Attaching patch.


---

Comment by ppurka created at 2011-11-20 09:02:18

Apply to devel/sage


---

Attachment

Form some reason doctesting this file goes into an infinite recursion with twisted, but all the commands work on the Sage command line. I had to run it like this to see the output `.sage/tmp/psage_26566.py` is the file Sage created while trying to doctest.

```
PYTHONVERBOSE=1 ~/Installations/sage-4.7.2/sage -python psage_26566.py 2>&1 | tee ~/test.out
```


And `~/test.out` contains in particular this output just before the infinite recursion starts:

```
import sage.modules.vector_double_dense # dynamically loaded from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/modules/vector_double_dense.so
dlopen("/home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/modules/vector_real_double_dense.so", 2);
import sage.modules.vector_real_double_dense # dynamically loaded from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/modules/vector_real_double_dense.so
import sage.finance.time_series # dynamically loaded from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/finance/time_series.so
import sage.stats.intlist # dynamically loaded from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/stats/intlist.so
# /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/plot/plot3d/implicit_plot3d.pyc matches /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/plot/plot3d/implicit_plot3d.py
import sage.plot.plot3d.implicit_plot3d # precompiled from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/plot/plot3d/implicit_plot3d.pyc
dlopen("/home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/plot/plot3d/implicit_surface.so", 2);
import sage.plot.plot3d.implicit_surface # dynamically loaded from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/plot/plot3d/implicit_surface.so
dlopen("/home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/plot/complex_plot.so", 2);
import sage.plot.complex_plot # dynamically loaded from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/plot/complex_plot.so
Exception IOError: IOError(2, 'No such file or directory') in <bound method SageElement.__del__ of <<currently executing code>>> ignored
dlopen("/home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/libs/flint/flint.so", 2);
import sage.libs.flint.flint # dynamically loaded from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/sage/libs/flint/flint.so
# /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/reactor.pyc matches /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/reactor.py
import twisted.internet.reactor # precompiled from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/reactor.pyc
# /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/selectreactor.pyc matches /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/selectreactor.py
import twisted.internet.selectreactor # precompiled from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/selectreactor.pyc
# /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/interfaces.pyc matches /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/interfaces.py
import twisted.internet.interfaces # precompiled from /home/punarbasu/Installations/sage-4.7.2/local/lib/python2.6/site-packages/Twisted-9.0.0-py2.6-linux-x86_64.egg/twisted/internet/interfaces.pyc
Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
 ignored
Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
 ignored
Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
 ignored
Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
 ignored
Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
 ignored
Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
Exception RuntimeError: RuntimeError('maximum recursion depth exceeded while calling a Python object',) in Exception RuntimeError: 'maximum recursion depth exceeded in __subclasscheck__' in <type 'exceptions.RuntimeError'> ignored
 ignored
```



---

Attachment

Apply to devel/sage


---

Comment by ppurka created at 2012-03-01 11:30:11

Finally I have been able to figure out the cause of the infinite recursion. The fix is present in the patch.


---

Comment by ppurka created at 2012-03-01 11:30:11

Changing status from new to needs_review.


---

Comment by ppurka created at 2012-03-01 11:30:11

Changing type from defect to enhancement.


---

Comment by ppurka created at 2012-03-01 11:40:27

Two functions are not directly or indirectly doctested: `PSage._send_nowait()` and `PSageElement.is_locked()`. Is the latter class even used??


---

Comment by jdemeyer created at 2012-04-02 09:28:30

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-04-02 09:28:30

Why add `time.sleep(10)`?

If you do, you also need to add "# long time".


---

Comment by ppurka created at 2012-04-02 12:26:39

Replying to [comment:4 jdemeyer]:
> Why add `time.sleep(10)`?
> 
> If you do, you also need to add "# long time".

I did this after testing many different inputs and this was one input which doesn't take too long but which also doesn't give the result immediately. So, `time.sleep(10)` is there to wait until the computations are all over.

Is there a better way to test this? Otherwise, I will add `# long time` as you suggested.


---

Comment by ppurka created at 2012-04-29 15:19:06

Hmm.. I have a [patch ready](https://github.com/ppurka/sage-patches/blob/master/sage_devel/trac_12061-doctest_interfaces_psage.2.patch) but I am unable to upload it. Something is wrong with trac. The upload page is simply stuck and never finishes the upload. I will just record the terminal output here and upload the patch some other day.

```
...2.experimental/devel/sage» ../../sage -t -long sage/interfaces/psage.py 
sage -t -long "devel/sage-main/sage/interfaces/psage.py"    
	 [24.8 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 24.8 seconds
...2.experimental/devel/sage» ../../sage -coverage sage/interfaces/psage.py 
----------------------------------------------------------------------
sage/interfaces/psage.py
ERROR: Please add a `TestSuite(s).run()` doctest.
SCORE sage/interfaces/psage.py: 71% (10 of 14)

Missing documentation:
	 * _start(self):
	 * _send_nowait(self, x):
	 * _object_class(self):
	 * is_locked(self):

----------------------------------------------------------------------

```



---

Attachment

Apply only this patch to devel/sage


---

Comment by ppurka created at 2012-05-01 09:00:50

There seems to be some weird problem with trac. I am unable to upload the original file since it contained

```
:trac:`1991`
```

instead of

```
:trac:`#1991`
```


Even after I did that change, I am unable to upload it as a .patch file. So I renamed the file and it works.


---

Comment by ppurka created at 2012-05-01 09:00:50

Changing status from needs_work to needs_review.


---

Attachment


---

Comment by ppurka created at 2012-05-26 14:51:01

Changing keywords from "doctest" to "doctest sd40.5".


---

Comment by ppurka created at 2012-05-27 10:09:43

patchbot: apply trac_12061.txt


---

Comment by ppurka created at 2012-05-27 10:23:12

removing sd40.5. This PSage has extremely weird behavior which changes between several different versions of Sage. The doctests used to all pass earlier and now they don't.


---

Comment by ppurka created at 2012-05-27 10:23:12

Changing keywords from "doctest sd40.5" to "doctest".


---

Comment by jdemeyer created at 2012-07-27 20:41:50

Please fill in your real name as Author.


---

Comment by ppurka created at 2012-07-28 12:52:28

Sorry jdemeyer. It seems I tend to not fill up author fields. Will try to remember to do so from next time.


---

Comment by ppurka created at 2012-07-28 12:52:50

Changing status from needs_review to needs_work.
