# Issue 29486: inverses of ring homomorphisms

Issue created by migration from https://trac.sagemath.org/ticket/29723

Original creator: @mwageringel

Original creation time: 2020-05-21 17:13:18

CC:  rburing nbruin dimpase yzh

Given a homomorphism `f: K[x] -> K[y]` of (multivariate) polynomial rings that respects the `K`-algebra structure, we can find preimages of `y` by computing normal forms modulo the graph ideal `(x-f(x))` in `K[y,x]` with respect to an elimination order. More generally, this works for morphisms of quotient rings `K[x]/I -> K[y]/J`, which allows to handle many types of ring homomorphisms in Sage.

This ticket constructs the graph ideal and implements the method `inverse` for ring homomorphisms. This functionality can then be used for related computations such as inverse images, kernels and subalgebra membership tests, which will be implemented on another ticket.

References: e.g. [BW1993] Propositions 6.44, 7.71; or [Decker-Schreyer](https://www.math.uni-sb.de/ag/schreyer/images/PDFs/teaching/ws1617ag/book.pdf), Proposition 2.5.12 and Exercise 2.5.13.

See also #9792 and related posts on the [mailing list](https://groups.google.com/forum/#!topic/sage-support/aJn0T0jIfwU) and at [Ask-Sagemath](https://ask.sagemath.org/question/51336/implicitization-by-symmetric-polynomials/).


---

Comment by @mwageringel created at 2020-06-01 16:04:30

Changing status from new to needs_review.


---

Comment by @mwageringel created at 2020-06-01 16:04:30

It turns out to be more convenient to implement `inverse_image` first, so this branch is now based on #9792 (kernel and inverse_image of (polynomial) ring homomorphisms).

I would appreciate if someone could give these tickets a review.
----
New commits:


---

Comment by tscrim created at 2020-06-15 01:07:00

Is there a particular reason why you raise a `ZeroDivisionError` if the inverse doesn't exist? I feel like it would be better as a `ValueError` (or maybe a `TypeError`).


---

Comment by @mwageringel created at 2020-06-15 17:38:23

Mainly for consistency with morphisms between vector spaces:


```
sage: f = (QQ^2).hom([[1,1], [1,1]], QQ^2)
sage: f.inverse()
...
ZeroDivisionError: matrix morphism not invertible
```


Morphisms can be composed using the multiplication operator, so with respect to that operation, a `ZeroDivisionError` sort of makes sense. Another option would be to raise an `ArithmeticError`. I do not have a strong opinion about this matter, though.

This reminds me that we should probably add an alias `__invert__` for ring homomorphisms as well, so that the syntax `~f` can be used.


---

Comment by tscrim created at 2020-06-15 22:56:36

Replying to [comment:3 gh-mwageringel]:
> Mainly for consistency with morphisms between vector spaces:
> 
> {{{
> sage: f = (QQ^2).hom([[1,1], [1,1]], QQ^2)
> sage: f.inverse()
> ...
> ZeroDivisionError: matrix morphism not invertible
> }}}
> 
> Morphisms can be composed using the multiplication operator, so with respect to that operation, a `ZeroDivisionError` sort of makes sense. Another option would be to raise an `ArithmeticError`. I do not have a strong opinion about this matter, though.

I see, and I agree that it sort of makes sense. Then let us keep it as a `ZeroDivisionError`.

> This reminds me that we should probably add an alias `__invert__` for ring homomorphisms as well, so that the syntax `~f` can be used.

Please do so. Once that is done, this will be a positive review.


---

Comment by git created at 2020-06-16 17:32:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mwageringel created at 2020-06-16 17:37:26

Thank you. I have rebased the branch and implemented `__invert__` -- not as an alias though, as it would not work well with inheritance.


---

Comment by tscrim created at 2020-06-16 23:31:06

Thanks. Looks good overall, but the patchbot reports some failures:

```
sage -t --long src/sage/rings/polynomial/skew_polynomial_ring.py  # 1 doctest failed
sage -t --long src/sage/rings/polynomial/skew_polynomial_element.pyx  # 3 doctests failed
```

Once fixed, you can set a positive review.


---

Comment by git created at 2020-06-21 17:40:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-06-22 00:04:09

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-06-22 00:04:09

LGTM.


---

Comment by vbraun created at 2020-06-23 22:58:52

Merge conflict


---

Comment by vbraun created at 2020-06-23 22:58:52

Changing status from positive_review to needs_work.


---

Comment by git created at 2020-06-27 09:21:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by @mwageringel created at 2020-06-27 09:24:16

Changing status from needs_work to needs_review.


---

Comment by @mwageringel created at 2020-06-27 09:24:16

I have resolved the conflict. Let us see what the bot says.


---

Comment by tscrim created at 2020-06-28 13:13:05

LGTM.


---

Comment by tscrim created at 2020-06-28 13:13:05

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-07-08 19:34:19

Resolution: fixed
