# Issue 18901: Discrete Gaussian Lattice Sampler Unexpected Behavour for _call_in_lattice()

archive/issues_018901.json:
```json
{
    "body": "CC:  @malb\n\nKeywords: discrete gaussian lattice sampler call_in_lattice\n\nThe _call_in_lattice() method for DiscreteGaussianLatticeSampler is supposed to be a shortcut for __call__(), which outputs a sample from the discrete Gaussian distribution $D_{\\Lambda, c}$, in the case when the vector $c$ is in the lattice. The algorithm being used for sampling is [Gentry, Craig, Chris Peikert, and Vinod Vaikuntanathan. \"Trapdoors for hard lattices and new cryptographic constructions.\" Proceedings of the fortieth annual ACM symposium on Theory of computing. ACM, 2008]. \n\nHowever, this shortcut function seems to be oversimplifying the sampling process. For example, we take a non-standard basis of the standard lattice in dimension 2 and take $c = 0$:\n\n\n```\nsage: from sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler\nsage: B = Matrix([[1,1],[1,0]]); \nsage: D = DiscreteGaussianDistributionLatticeSampler(B, 5.0); \n\nsage: v0, v1 =[], []\nsage: for i in range(100):\n              v = D()\n              v0.append(v[0])\n              v1.append(v[1])\n\nsage: RR(std(v0))\n8.42768405826052\n\nsage: RR(std(v1))\n3.82193298177398\n```\n\nThe standard deviation of the two coordinates are visibly different, while they should be the same, since the Gaussian distribution on the standard lattice has spherical symmetry. \n\nI would guess a simple fix is to not use _call_in_lattice() and always use the more general _call().\n\nIssue created by migration from https://trac.sagemath.org/ticket/19138\n\n",
    "created_at": "2015-09-04T22:54:45Z",
    "labels": [
        "statistics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Discrete Gaussian Lattice Sampler Unexpected Behavour for _call_in_lattice()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18901",
    "user": "haochen_uw"
}
```
CC:  @malb

Keywords: discrete gaussian lattice sampler call_in_lattice

The _call_in_lattice() method for DiscreteGaussianLatticeSampler is supposed to be a shortcut for __call__(), which outputs a sample from the discrete Gaussian distribution $D_{\Lambda, c}$, in the case when the vector $c$ is in the lattice. The algorithm being used for sampling is [Gentry, Craig, Chris Peikert, and Vinod Vaikuntanathan. "Trapdoors for hard lattices and new cryptographic constructions." Proceedings of the fortieth annual ACM symposium on Theory of computing. ACM, 2008]. 

However, this shortcut function seems to be oversimplifying the sampling process. For example, we take a non-standard basis of the standard lattice in dimension 2 and take $c = 0$:


```
sage: from sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler
sage: B = Matrix([[1,1],[1,0]]); 
sage: D = DiscreteGaussianDistributionLatticeSampler(B, 5.0); 

sage: v0, v1 =[], []
sage: for i in range(100):
              v = D()
              v0.append(v[0])
              v1.append(v[1])

sage: RR(std(v0))
8.42768405826052

sage: RR(std(v1))
3.82193298177398
```

The standard deviation of the two coordinates are visibly different, while they should be the same, since the Gaussian distribution on the standard lattice has spherical symmetry. 

I would guess a simple fix is to not use _call_in_lattice() and always use the more general _call().

Issue created by migration from https://trac.sagemath.org/ticket/19138





---

archive/issue_comments_258862.json:
```json
{
    "body": "You're right, I was being silly when I wrote that optimisation.\n----\nNew commits:",
    "created_at": "2015-09-05T14:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18901#issuecomment-258862",
    "user": "@malb"
}
```

You're right, I was being silly when I wrote that optimisation.
----
New commits:



---

archive/issue_comments_258863.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-09-05T14:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18901#issuecomment-258863",
    "user": "@malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_258864.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-13T20:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18901#issuecomment-258864",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258865.json:
```json
{
    "body": "I've rebased this ticket to the current development branch. Anybody up for reviewing this ticket?",
    "created_at": "2016-05-13T20:16:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18901#issuecomment-258865",
    "user": "@malb"
}
```

I've rebased this ticket to the current development branch. Anybody up for reviewing this ticket?



---

archive/issue_comments_258866.json:
```json
{
    "body": "wrong syntax here:\n\n```\nthat `trac:19138` is fixed\n```\n\nshould be\n\n```\nthat :trac:`19138` is fixed\n```\n",
    "created_at": "2016-05-13T20:23:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18901#issuecomment-258866",
    "user": "@fchapoton"
}
```

wrong syntax here:

```
that `trac:19138` is fixed
```

should be

```
that :trac:`19138` is fixed
```




---

archive/issue_comments_258867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-13T22:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18901#issuecomment-258867",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_258868.json:
```json
{
    "body": "does not apply",
    "created_at": "2016-07-28T08:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18901#issuecomment-258868",
    "user": "@fchapoton"
}
```

does not apply



---

archive/issue_comments_258869.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-07-28T08:00:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18901#issuecomment-258869",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.
