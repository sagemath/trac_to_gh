# Issue 18901: Discrete Gaussian Lattice Sampler Unexpected Behavour for _call_in_lattice()

Issue created by migration from Trac.

Original creator: haochen_uw

Original creation time: 2015-09-04 22:54:45

CC:  malb

Keywords: discrete gaussian lattice sampler call_in_lattice

The _call_in_lattice() method for DiscreteGaussianLatticeSampler is supposed to be a shortcut for __call__(), which outputs a sample from the discrete Gaussian distribution $D_{\Lambda, c}$, in the case when the vector $c$ is in the lattice. The algorithm being used for sampling is [Gentry, Craig, Chris Peikert, and Vinod Vaikuntanathan. "Trapdoors for hard lattices and new cryptographic constructions." Proceedings of the fortieth annual ACM symposium on Theory of computing. ACM, 2008]. 

However, this shortcut function seems to be oversimplifying the sampling process. For example, we take a non-standard basis of the standard lattice in dimension 2 and take $c = 0$:


```
sage: from sage.stats.distributions.discrete_gaussian_lattice import DiscreteGaussianDistributionLatticeSampler
sage: B = Matrix([[1,1],[1,0]]); 
sage: D = DiscreteGaussianDistributionLatticeSampler(B, 5.0); 

sage: v0, v1 =[], []
sage: for i in range(100):
              v = D()
              v0.append(v[0])
              v1.append(v[1])

sage: RR(std(v0))
8.42768405826052

sage: RR(std(v1))
3.82193298177398
```

The standard deviation of the two coordinates are visibly different, while they should be the same, since the Gaussian distribution on the standard lattice has spherical symmetry. 

I would guess a simple fix is to not use _call_in_lattice() and always use the more general _call().


---

Comment by malb created at 2015-09-05 14:38:55

You're right, I was being silly when I wrote that optimisation.
----
New commits:


---

Comment by malb created at 2015-09-05 14:38:55

Changing status from new to needs_review.


---

Comment by git created at 2016-05-13 20:15:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by malb created at 2016-05-13 20:16:05

I've rebased this ticket to the current development branch. Anybody up for reviewing this ticket?


---

Comment by chapoton created at 2016-05-13 20:23:36

wrong syntax here:

```
that `trac:19138` is fixed
```

should be

```
that :trac:`19138` is fixed
```



---

Comment by git created at 2016-05-13 22:41:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-07-28 08:00:34

does not apply


---

Comment by chapoton created at 2016-07-28 08:00:34

Changing status from needs_review to needs_work.
