# Issue 25833: Upgrade to MathJax 3 and configure Sage

archive/issues_025596.json:
```json
{
    "body": "CC:  @antonio-rojas @egourgoulhon @embray @kiwifb @timokau @jdemeyer @jhpalmieri @kcrisman @miguelmarco @novoselt @haraldschilly @slel tmonteil @vbraun @orlitzky\n\nKeywords: upgrade, mathjax\n\nMathjax v3.2.0 was released on 2021-06-17, see [https://github.com/mathjax/MathJax](https://github.com/mathjax/MathJax).\n\nThis will be done in three steps: \n\n- Step 1: Fix Sage to be compatible with MathJax3. Done in #31517.\n- Step 2: Provide mathjax spkg upgraded to MathJax3. \n- Step 3: Configure Sage to use MathJax3.\n\nThis ticket focuses on the Steps 2 and 3. \n\nTo install mathjax, you can download the tarball from a temporary URL:\n\n  https://drive.google.com/file/d/1-tMjjIwftzoGngFh549_kUO3Chmy3qhI/view?usp=sharing\n\nand place the tarball in `upstream/` and `make`, or you can just do `make` since the tarball will be automatically downloaded from the attachment of this ticket after unsuccessful attempts to download from sage mirrors.\n\nWe can now choose whether to use mathjax CDN or not. The default is not to. To use CDN, do\n\n```\nexport SAGE_DOCBUILD_OPTS=\"--use-cdns\"\n```\nbefore `make` online doc.\n\nRelated tickets:\n\n- #30296 System package information and spkg-configure for mathjax\n\n- #33600 Configure mathjax in sphinx config and upgrade to Mathjax v3\n\nIssue created by migration from https://trac.sagemath.org/ticket/25833\n\n",
    "closed_at": "2022-05-24T22:45:06Z",
    "created_at": "2018-07-11T18:57:57Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "Upgrade to MathJax 3 and configure Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25833",
    "user": "https://github.com/slel"
}
```
CC:  @antonio-rojas @egourgoulhon @embray @kiwifb @timokau @jdemeyer @jhpalmieri @kcrisman @miguelmarco @novoselt @haraldschilly @slel tmonteil @vbraun @orlitzky

Keywords: upgrade, mathjax

Mathjax v3.2.0 was released on 2021-06-17, see [https://github.com/mathjax/MathJax](https://github.com/mathjax/MathJax).

This will be done in three steps: 

- Step 1: Fix Sage to be compatible with MathJax3. Done in #31517.
- Step 2: Provide mathjax spkg upgraded to MathJax3. 
- Step 3: Configure Sage to use MathJax3.

This ticket focuses on the Steps 2 and 3. 

To install mathjax, you can download the tarball from a temporary URL:

  https://drive.google.com/file/d/1-tMjjIwftzoGngFh549_kUO3Chmy3qhI/view?usp=sharing

and place the tarball in `upstream/` and `make`, or you can just do `make` since the tarball will be automatically downloaded from the attachment of this ticket after unsuccessful attempts to download from sage mirrors.

We can now choose whether to use mathjax CDN or not. The default is not to. To use CDN, do

```
export SAGE_DOCBUILD_OPTS="--use-cdns"
```
before `make` online doc.

Related tickets:

- #30296 System package information and spkg-configure for mathjax

- #33600 Configure mathjax in sphinx config and upgrade to Mathjax v3

Issue created by migration from https://trac.sagemath.org/ticket/25833





---

archive/issue_comments_360496.json:
```json
{
    "body": "The second public beta release for MathJax v3 was released.\n\n- [announcement on the MathJax Users list](https://groups.google.com/d/topic/mathjax-users/tkGOgWJV2bM/discussion)\n\nThe announcement ends with this note:\n\n> MathJax v3 is in beta release. Do not use this in production,\n> but please test it and report issues on the MathJax v3 issue tracker!\n\n>\n> We are continuing to add more functionality to version 3, and will be\n> releasing additional beta versions as new features become available.\n> So watch this site for more news to come!",
    "created_at": "2018-10-24T23:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360496",
    "user": "https://github.com/slel"
}
```

The second public beta release for MathJax v3 was released.

- [announcement on the MathJax Users list](https://groups.google.com/d/topic/mathjax-users/tkGOgWJV2bM/discussion)

The announcement ends with this note:

> MathJax v3 is in beta release. Do not use this in production,
> but please test it and report issues on the MathJax v3 issue tracker!

>
> We are continuing to add more functionality to version 3, and will be
> releasing additional beta versions as new features become available.
> So watch this site for more news to come!



---

archive/issue_comments_360497.json:
```json
{
    "body": "Do you know how light it will be compared to https://katex.org/ ?",
    "created_at": "2018-10-25T08:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360497",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Do you know how light it will be compared to https://katex.org/ ?



---

archive/issue_comments_360498.json:
```json
{
    "body": "Replying to [comment:2 tmonteil]:\n> Do you know how light it will be compared to https://katex.org/ ?\n\n\nNo. This might be a good question to ask on the [mathjax-users mailing list](https://groups.google.com/d/topic/mathjax-users/).\n\nMeanwhile the [third public beta for MathJax 3 was announced](https://groups.google.com/d/topic/mathjax-users/NmUrM3i9lNc/discussion) on 28 Nov 2018.",
    "created_at": "2018-12-14T17:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360498",
    "user": "https://github.com/slel"
}
```

Replying to [comment:2 tmonteil]:
> Do you know how light it will be compared to https://katex.org/ ?


No. This might be a good question to ask on the [mathjax-users mailing list](https://groups.google.com/d/topic/mathjax-users/).

Meanwhile the [third public beta for MathJax 3 was announced](https://groups.google.com/d/topic/mathjax-users/NmUrM3i9lNc/discussion) on 28 Nov 2018.



---

archive/issue_comments_360499.json:
```json
{
    "body": "MathJax v3 beta.4 released 2019-05-21.",
    "created_at": "2019-05-24T04:06:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360499",
    "user": "https://github.com/slel"
}
```

MathJax v3 beta.4 released 2019-05-21.



---

archive/issue_comments_360500.json:
```json
{
    "body": "MathJax 3.0.5 was released (2020-04).",
    "created_at": "2020-04-11T19:03:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360500",
    "user": "https://github.com/slel"
}
```

MathJax 3.0.5 was released (2020-04).



---

archive/issue_comments_360501.json:
```json
{
    "body": "It's worth paying attention to the fact that Mathjax 3 is missing a significant feature that might be really critical for Sage, which is \"automatic line breaking\".  See the discussion here:\n\nhttps://github.com/mathjax/MathJax/issues/2312#issuecomment-692695446\n\nE.g., \"So line breaking and other features will most likely have to wait until next year.\"  \"That's the reason why nearly nobody is using MathJax 3.\"   etc.\n\nI think this is very important to be aware of, and it's one reason why CoCalc doesn't use MathJax 3, and uses KaTeX by default.   For some applications automatic line breaking probably isn't so important, but it might be very important for Sage, due to people often printing out polynomials and big formulas.",
    "created_at": "2021-06-13T19:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360501",
    "user": "https://github.com/williamstein"
}
```

It's worth paying attention to the fact that Mathjax 3 is missing a significant feature that might be really critical for Sage, which is "automatic line breaking".  See the discussion here:

https://github.com/mathjax/MathJax/issues/2312#issuecomment-692695446

E.g., "So line breaking and other features will most likely have to wait until next year."  "That's the reason why nearly nobody is using MathJax 3."   etc.

I think this is very important to be aware of, and it's one reason why CoCalc doesn't use MathJax 3, and uses KaTeX by default.   For some applications automatic line breaking probably isn't so important, but it might be very important for Sage, due to people often printing out polynomials and big formulas.



---

archive/issue_comments_360502.json:
```json
{
    "body": "Replying to [comment:9 was]:\n> It's worth paying attention to the fact that Mathjax 3 is missing a significant feature that might be really critical for Sage, which is \"automatic line breaking\".  \n\n\nIt is jupyter people who decides what math rendering web engine is used in jupyter, which is the official frontend of Sage. I think whether Sage will be moving to MathJax3 or something else is dependent on what they do.",
    "created_at": "2021-06-14T01:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360502",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:9 was]:
> It's worth paying attention to the fact that Mathjax 3 is missing a significant feature that might be really critical for Sage, which is "automatic line breaking".  


It is jupyter people who decides what math rendering web engine is used in jupyter, which is the official frontend of Sage. I think whether Sage will be moving to MathJax3 or something else is dependent on what they do.



---

archive/issue_comments_360503.json:
```json
{
    "body": "Replying to [comment:10 klee]:\n> Replying to [comment:9 was]:\n> > It's worth paying attention to the fact that Mathjax 3 is missing a significant feature that might be really critical for Sage, which is \"automatic line breaking\".  \n\n> \n> It is jupyter people who decides what math rendering web engine is used in jupyter, which is the official frontend of Sage. I think whether Sage will be moving to MathJax3 or something else is dependent on what they do.\n\n\nThanks.  Here's their plan regarding this issue: https://github.com/jupyterlab/jupyterlab/issues/7218#issuecomment-532146044",
    "created_at": "2021-06-14T02:05:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360503",
    "user": "https://github.com/williamstein"
}
```

Replying to [comment:10 klee]:
> Replying to [comment:9 was]:
> > It's worth paying attention to the fact that Mathjax 3 is missing a significant feature that might be really critical for Sage, which is "automatic line breaking".  

> 
> It is jupyter people who decides what math rendering web engine is used in jupyter, which is the official frontend of Sage. I think whether Sage will be moving to MathJax3 or something else is dependent on what they do.


Thanks.  Here's their plan regarding this issue: https://github.com/jupyterlab/jupyterlab/issues/7218#issuecomment-532146044



---

archive/issue_comments_360504.json:
```json
{
    "body": "> It's worth paying attention to the fact that Mathjax 3 is missing a significant feature that might be really critical for Sage, which is \"automatic line breaking\".  See the discussion here:\n> \n\n\nThanks, William, I'll pass that on upstream to PreTeXt.",
    "created_at": "2021-06-14T11:47:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360504",
    "user": "https://github.com/kcrisman"
}
```

> It's worth paying attention to the fact that Mathjax 3 is missing a significant feature that might be really critical for Sage, which is "automatic line breaking".  See the discussion here:
> 


Thanks, William, I'll pass that on upstream to PreTeXt.



---

archive/issue_comments_360505.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-07T04:52:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360506.json:
```json
{
    "body": "To support #33600, I prepared a new package for mathjax3.\n\nI've never done creating a spkg before and don't understand everything about this business. So please help. This is a public branch!\n\nI used the mathjax2 spkg as a template, and managed to place a tarball in `upstream/` directory and install from it to `local/share/mathjax3` by `sage -i mathjax3`.",
    "created_at": "2022-04-07T05:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360506",
    "user": "https://github.com/kwankyu"
}
```

To support #33600, I prepared a new package for mathjax3.

I've never done creating a spkg before and don't understand everything about this business. So please help. This is a public branch!

I used the mathjax2 spkg as a template, and managed to place a tarball in `upstream/` directory and install from it to `local/share/mathjax3` by `sage -i mathjax3`.



---

archive/issue_comments_360507.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-07T05:08:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360507",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360508.json:
```json
{
    "body": "Fixed first mistake.",
    "created_at": "2022-04-07T05:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360508",
    "user": "https://github.com/kwankyu"
}
```

Fixed first mistake.



---

archive/issue_comments_360509.json:
```json
{
    "body": "To the uninitiated (like me):\n\nFirst\n\n```\ncd build/pkgs/mathjax3/\nspkg-src \n``` \nto make the tarball `upstream/mathjax-3.2.0.tar.gz`.",
    "created_at": "2022-04-07T05:21:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360509",
    "user": "https://github.com/kwankyu"
}
```

To the uninitiated (like me):

First

```
cd build/pkgs/mathjax3/
spkg-src 
``` 
to make the tarball `upstream/mathjax-3.2.0.tar.gz`.



---

archive/issue_comments_360510.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-07T07:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360510",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360511.json:
```json
{
    "body": "After installed, mathjax files are in `local/share/mathjax3/mathjax/...`. This is necessary to put mathjax files into `_static/mathjax/...` for sage documentation.",
    "created_at": "2022-04-07T07:38:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360511",
    "user": "https://github.com/kwankyu"
}
```

After installed, mathjax files are in `local/share/mathjax3/mathjax/...`. This is necessary to put mathjax files into `_static/mathjax/...` for sage documentation.



---

archive/issue_comments_360512.json:
```json
{
    "body": "When it's convenient, could you please upload the tarball somewhere? (As you've observed, I think we've always built our own mathjax tarball, so we can't use the \"upstream_url\" field in `checksums.ini` to download from a standard location.)",
    "created_at": "2022-04-07T15:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360512",
    "user": "https://github.com/jhpalmieri"
}
```

When it's convenient, could you please upload the tarball somewhere? (As you've observed, I think we've always built our own mathjax tarball, so we can't use the "upstream_url" field in `checksums.ini` to download from a standard location.)



---

archive/issue_events_064621.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2022-04-08T00:25:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25833#event-64621"
}
```



---

archive/issue_comments_360513.json:
```json
{
    "body": "Replying to [comment:23 jhpalmieri]:\n> When it's convenient, could you please upload the tarball somewhere? (As you've observed, I think we've always built our own mathjax tarball, so we can't use the \"upstream_url\" field in `checksums.ini` to download from a standard location.)\n\n\nRight. Presently the tarball is just a slight repackaging of the official mathjax3 distribution. Fortunately the size of the tarball (around 4.8Mb) is just slightly larger than our mathjax2 tarball. But they have plans to add more fonts to mathjax3 and then we would be forced to reduce the size by cutting unnecessary fonts from the distribution.",
    "created_at": "2022-04-08T00:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360513",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:23 jhpalmieri]:
> When it's convenient, could you please upload the tarball somewhere? (As you've observed, I think we've always built our own mathjax tarball, so we can't use the "upstream_url" field in `checksums.ini` to download from a standard location.)


Right. Presently the tarball is just a slight repackaging of the official mathjax3 distribution. Fortunately the size of the tarball (around 4.8Mb) is just slightly larger than our mathjax2 tarball. But they have plans to add more fonts to mathjax3 and then we would be forced to reduce the size by cutting unnecessary fonts from the distribution.



---

archive/issue_comments_360514.json:
```json
{
    "body": "Do we need a sage-devel discussion to add mathjax3 as a standard spkg?",
    "created_at": "2022-04-08T00:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360514",
    "user": "https://github.com/kwankyu"
}
```

Do we need a sage-devel discussion to add mathjax3 as a standard spkg?



---

archive/issue_comments_360515.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T01:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360515",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360516.json:
```json
{
    "body": "Replying to [comment:27 klee]:\n> Do we need a sage-devel discussion to add mathjax3 as a standard spkg?\n\n\nI thought of adding mathjax3 side by side with mathjax(2). But it seems that we don't need to keep mathjax(2) once we have mathjax3 in sage.\n\nSo now I am thinking of replacing the mathjax(2) with the new mathjax(3). Then we don't need a sage-devel discussion...",
    "created_at": "2022-04-08T07:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360516",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:27 klee]:
> Do we need a sage-devel discussion to add mathjax3 as a standard spkg?


I thought of adding mathjax3 side by side with mathjax(2). But it seems that we don't need to keep mathjax(2) once we have mathjax3 in sage.

So now I am thinking of replacing the mathjax(2) with the new mathjax(3). Then we don't need a sage-devel discussion...



---

archive/issue_comments_360517.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T12:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360518.json:
```json
{
    "body": "Replying to [comment:31 klee]:\n> \n> So now I am thinking of replacing the mathjax(2) with the new mathjax(3). Then we don't need a sage-devel discussion...\n\n\nWhat about the line breaking issue pointed out in comment:9 ?",
    "created_at": "2022-04-08T14:15:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360518",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:31 klee]:
> 
> So now I am thinking of replacing the mathjax(2) with the new mathjax(3). Then we don't need a sage-devel discussion...


What about the line breaking issue pointed out in comment:9 ?



---

archive/issue_comments_360519.json:
```json
{
    "body": "Replying to [comment:34 egourgoulhon]:\n> Replying to [comment:31 klee]:\n> > \n> > So now I am thinking of replacing the mathjax(2) with the new mathjax(3). Then we don't need a sage-devel discussion...\n\n> \n> What about the line breaking issue pointed out in comment:9 ?\n\n\nAs I understand it, it is only relevant with the mathjax used with jupyter.\n\nPresently the mathjax used by Sphinx for sage documentation is different from the mathjax used by jupyter. So we don't need to worry about the issue.",
    "created_at": "2022-04-08T14:53:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360519",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:34 egourgoulhon]:
> Replying to [comment:31 klee]:
> > 
> > So now I am thinking of replacing the mathjax(2) with the new mathjax(3). Then we don't need a sage-devel discussion...

> 
> What about the line breaking issue pointed out in comment:9 ?


As I understand it, it is only relevant with the mathjax used with jupyter.

Presently the mathjax used by Sphinx for sage documentation is different from the mathjax used by jupyter. So we don't need to worry about the issue.



---

archive/issue_comments_360520.json:
```json
{
    "body": "Isn't it enough to only copy the `tex-chtml.js` file from the mathjax release? It looks like this file is self-contained (hard to say as its minified).",
    "created_at": "2022-04-08T18:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360520",
    "user": "https://github.com/tobiasdiez"
}
```

Isn't it enough to only copy the `tex-chtml.js` file from the mathjax release? It looks like this file is self-contained (hard to say as its minified).



---

archive/issue_comments_360521.json:
```json
{
    "body": "Replying to [comment:36 gh-tobiasdiez]:\n> Isn't it enough to only copy the `tex-chtml.js` file from the mathjax release? It looks like this file is self-contained (hard to say as its minified).\n\n\nIt is self-contained. But it does not contain all extensions. To be future safe, I think we should not minimize our tarball. The tarball is not big...yet.",
    "created_at": "2022-04-08T23:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360521",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:36 gh-tobiasdiez]:
> Isn't it enough to only copy the `tex-chtml.js` file from the mathjax release? It looks like this file is self-contained (hard to say as its minified).


It is self-contained. But it does not contain all extensions. To be future safe, I think we should not minimize our tarball. The tarball is not big...yet.



---

archive/issue_comments_360522.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-08T23:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360522",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360523.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-08T23:52:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360523",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_360524.json:
```json
{
    "body": "After a discussion in #33600 (Configure mathjax in sphinx config and upgrade to Mathjax v3), we decided to merge both tickets to here.",
    "created_at": "2022-04-08T23:57:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360524",
    "user": "https://github.com/kwankyu"
}
```

After a discussion in #33600 (Configure mathjax in sphinx config and upgrade to Mathjax v3), we decided to merge both tickets to here.



---

archive/issue_comments_360525.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-09T02:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360525",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360526.json:
```json
{
    "body": "The mathjax3 bug was also reported here: https://github.com/mathjax/MathJax/issues/2861",
    "created_at": "2022-04-09T02:48:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360526",
    "user": "https://github.com/kwankyu"
}
```

The mathjax3 bug was also reported here: https://github.com/mathjax/MathJax/issues/2861



---

archive/issue_comments_360527.json:
```json
{
    "body": "Replying to [comment:37 klee]:\n> Replying to [comment:36 gh-tobiasdiez]:\n> > Isn't it enough to only copy the `tex-chtml.js` file from the mathjax release? It looks like this file is self-contained (hard to say as its minified).\n\n> \n> It is self-contained. But it does not contain all extensions. To be future safe, I think we should not minimize our tarball. The tarball is not big...yet.\n\n\nOkay, makes sense to leave the tar untouched. What about only copying the tex-chtml file to `SAGE_SHARE` in `spkg-install.in`? This could then be easily extended to include other extensions etc if needed in the future.\n\nAlso I think the uncommented code in `spkg-src` can be safely deleted. The folder structure of the mathjax releases changed completely, so the mathjax 2 stuff is outdated. And if there is something useful in it, one could also use git history to recover it easily.",
    "created_at": "2022-04-09T11:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360527",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:37 klee]:
> Replying to [comment:36 gh-tobiasdiez]:
> > Isn't it enough to only copy the `tex-chtml.js` file from the mathjax release? It looks like this file is self-contained (hard to say as its minified).

> 
> It is self-contained. But it does not contain all extensions. To be future safe, I think we should not minimize our tarball. The tarball is not big...yet.


Okay, makes sense to leave the tar untouched. What about only copying the tex-chtml file to `SAGE_SHARE` in `spkg-install.in`? This could then be easily extended to include other extensions etc if needed in the future.

Also I think the uncommented code in `spkg-src` can be safely deleted. The folder structure of the mathjax releases changed completely, so the mathjax 2 stuff is outdated. And if there is something useful in it, one could also use git history to recover it easily.



---

archive/issue_comments_360528.json:
```json
{
    "body": "Otherwise it looks good to me. Is there still something to do?",
    "created_at": "2022-04-09T11:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360528",
    "user": "https://github.com/tobiasdiez"
}
```

Otherwise it looks good to me. Is there still something to do?



---

archive/issue_comments_360529.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-09T12:08:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360529",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360530.json:
```json
{
    "body": "Replying to [comment:47 gh-tobiasdiez]:\n> Okay, makes sense to leave the tar untouched. What about only copying the tex-chtml file to `SAGE_SHARE` in `spkg-install.in`? \n\n\nWhy do that? Do you worry the performance of the documentation website? Having the whole mathjax files has nothing to do with the performance. The html files only load `tex-chtml.js`.\n\n> This could then be easily extended to include other extensions etc if needed in the future.\n\n\nIt would be \"easy\" only if all mathjax files are already in `local/share/mathjax`. The size of this directory only slightly increases with this ticket.\n\n> Also I think the uncommented code in `spkg-src` can be safely deleted. The folder structure of the mathjax releases changed completely, so the mathjax 2 stuff is outdated. And if there is something useful in it, one could also use git history to recover it easily.\n\n\nOkay. Done.",
    "created_at": "2022-04-09T12:20:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360530",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:47 gh-tobiasdiez]:
> Okay, makes sense to leave the tar untouched. What about only copying the tex-chtml file to `SAGE_SHARE` in `spkg-install.in`? 


Why do that? Do you worry the performance of the documentation website? Having the whole mathjax files has nothing to do with the performance. The html files only load `tex-chtml.js`.

> This could then be easily extended to include other extensions etc if needed in the future.


It would be "easy" only if all mathjax files are already in `local/share/mathjax`. The size of this directory only slightly increases with this ticket.

> Also I think the uncommented code in `spkg-src` can be safely deleted. The folder structure of the mathjax releases changed completely, so the mathjax 2 stuff is outdated. And if there is something useful in it, one could also use git history to recover it easily.


Okay. Done.



---

archive/issue_comments_360531.json:
```json
{
    "body": "Replying to [comment:48 gh-tobiasdiez]:\n> Otherwise it looks good to me. Is there still something to do?\n\n\nPerhaps no. But before we go to \"needs review\", I want that more people check the documentation built with mathjax3 (with CDN and without) to find any degradation or regression of the doc compared with the doc built with mathjax2. Let's not rush.",
    "created_at": "2022-04-09T12:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360531",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:48 gh-tobiasdiez]:
> Otherwise it looks good to me. Is there still something to do?


Perhaps no. But before we go to "needs review", I want that more people check the documentation built with mathjax3 (with CDN and without) to find any degradation or regression of the doc compared with the doc built with mathjax2. Let's not rush.



---

archive/issue_comments_360532.json:
```json
{
    "body": "Replying to [comment:50 klee]:\n> Replying to [comment:47 gh-tobiasdiez]:\n> > Okay, makes sense to leave the tar untouched. What about only copying the tex-chtml file to `SAGE_SHARE` in `spkg-install.in`? \n\n> \n> Why do that? Do you worry the performance of the documentation website? Having the whole mathjax files has nothing to do with the performance. The html files only load `tex-chtml.js`.\n\n\nMainly for clarity, because then in sage_share/mathjax there are only files that are also actually used. But it's not a big issue.\n\n> > Also I think the uncommented code in `spkg-src` can be safely deleted. The folder structure of the mathjax releases changed completely, so the mathjax 2 stuff is outdated. And if there is something useful in it, one could also use git history to recover it easily.\n\n> \n> Okay. Done.\n\n\nThanks!",
    "created_at": "2022-04-09T19:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360532",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:50 klee]:
> Replying to [comment:47 gh-tobiasdiez]:
> > Okay, makes sense to leave the tar untouched. What about only copying the tex-chtml file to `SAGE_SHARE` in `spkg-install.in`? 

> 
> Why do that? Do you worry the performance of the documentation website? Having the whole mathjax files has nothing to do with the performance. The html files only load `tex-chtml.js`.


Mainly for clarity, because then in sage_share/mathjax there are only files that are also actually used. But it's not a big issue.

> > Also I think the uncommented code in `spkg-src` can be safely deleted. The folder structure of the mathjax releases changed completely, so the mathjax 2 stuff is outdated. And if there is something useful in it, one could also use git history to recover it easily.

> 
> Okay. Done.


Thanks!



---

archive/issue_comments_360533.json:
```json
{
    "body": "Replying to [comment:51 klee]:\n> Replying to [comment:48 gh-tobiasdiez]:\n> > Otherwise it looks good to me. Is there still something to do?\n\n> \n> Perhaps no. But before we go to \"needs review\", I want that more people check the documentation built with mathjax3 (with CDN and without) to find any degradation or regression of the doc compared with the doc built with mathjax2. Let's not rush.\n\n\nSure!\nThe documentation workflow on github fails with this ticket since the mathjax tar cannot be downloaded. Is this to be expected? Should/can the script not fallback to get mathjax from github instead of trying to download it from mirrors?",
    "created_at": "2022-04-09T19:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360533",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:51 klee]:
> Replying to [comment:48 gh-tobiasdiez]:
> > Otherwise it looks good to me. Is there still something to do?

> 
> Perhaps no. But before we go to "needs review", I want that more people check the documentation built with mathjax3 (with CDN and without) to find any degradation or regression of the doc compared with the doc built with mathjax2. Let's not rush.


Sure!
The documentation workflow on github fails with this ticket since the mathjax tar cannot be downloaded. Is this to be expected? Should/can the script not fallback to get mathjax from github instead of trying to download it from mirrors?



---

archive/issue_comments_360534.json:
```json
{
    "body": "Replying to [comment:23 jhpalmieri]:\n> When it's convenient, could you please upload the tarball somewhere? (As you've observed, I think we've always built our own mathjax tarball, so we can't use the \"upstream_url\" field in `checksums.ini` to download from a standard location.)\n\n\nThe temporary URL should be put in checksums.ini, then all the automated tools will work.",
    "created_at": "2022-04-09T20:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360534",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:23 jhpalmieri]:
> When it's convenient, could you please upload the tarball somewhere? (As you've observed, I think we've always built our own mathjax tarball, so we can't use the "upstream_url" field in `checksums.ini` to download from a standard location.)


The temporary URL should be put in checksums.ini, then all the automated tools will work.



---

archive/issue_comments_360535.json:
```json
{
    "body": "Replying to [comment:54 mkoeppe]:\n> Replying to [comment:23 jhpalmieri]:\n> > When it's convenient, could you please upload the tarball somewhere? (As you've observed, I think we've always built our own mathjax tarball, so we can't use the \"upstream_url\" field in `checksums.ini` to download from a standard location.)\n\n> \n> The temporary URL should be put in checksums.ini, then all the automated tools will work.\n\n\nIn fact, that doesn't work (with me). Perhaps because Google Drive is not an ftp server...",
    "created_at": "2022-04-10T09:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360535",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:54 mkoeppe]:
> Replying to [comment:23 jhpalmieri]:
> > When it's convenient, could you please upload the tarball somewhere? (As you've observed, I think we've always built our own mathjax tarball, so we can't use the "upstream_url" field in `checksums.ini` to download from a standard location.)

> 
> The temporary URL should be put in checksums.ini, then all the automated tools will work.


In fact, that doesn't work (with me). Perhaps because Google Drive is not an ftp server...



---

archive/issue_comments_360536.json:
```json
{
    "body": "If the file is not too big, you can attach it to this ticket and use the resulting URL instead.",
    "created_at": "2022-04-10T21:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360536",
    "user": "https://github.com/mkoeppe"
}
```

If the file is not too big, you can attach it to this ticket and use the resulting URL instead.



---

archive/issue_comments_360537.json:
```json
{
    "body": "Attachment [mathjax-3.2.0.tar.gz](tarball://root/attachments/some-uuid/ticket25833/mathjax-3.2.0.tar.gz) by git created at 2022-04-11 00:31:56\n\nBranch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-11T00:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Attachment [mathjax-3.2.0.tar.gz](tarball://root/attachments/some-uuid/ticket25833/mathjax-3.2.0.tar.gz) by git created at 2022-04-11 00:31:56

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360538.json:
```json
{
    "body": "Replying to [comment:58 mkoeppe]:\n> If the file is not too big, \n\n\nI am not sure how big is \"too big\".\n\n> you can attach it to this ticket and use the resulting URL instead. \n\n\nAnyway, done. Would this be a temporary (to be deleted before the branch is merged) or permanent (keep the tarball in trac) url?",
    "created_at": "2022-04-11T00:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360538",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:58 mkoeppe]:
> If the file is not too big, 


I am not sure how big is "too big".

> you can attach it to this ticket and use the resulting URL instead. 


Anyway, done. Would this be a temporary (to be deleted before the branch is merged) or permanent (keep the tarball in trac) url?



---

archive/issue_comments_360539.json:
```json
{
    "body": "Replying to [comment:60 klee]:\n> Replying to [comment:58 mkoeppe]:\n> > If the file is not too big, \n\n> \n> I am not sure how big is \"too big\".\n\n\nIt worked, so it was not too big",
    "created_at": "2022-04-11T00:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360539",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:60 klee]:
> Replying to [comment:58 mkoeppe]:
> > If the file is not too big, 

> 
> I am not sure how big is "too big".


It worked, so it was not too big



---

archive/issue_comments_360540.json:
```json
{
    "body": "Replying to [comment:60 klee]:\n> Replying to [comment:58 mkoeppe]:\n> > If the file is not too big, \n\n> \n> I am not sure how big is \"too big\".\n> \n> > you can attach it to this ticket and use the resulting URL instead. \n\n> \n> Anyway, done. Would this be a temporary (to be deleted before the branch is merged) or permanent (keep the tarball in trac) url?\n\n\nEither permanent or kept at least until the release manager has made the next beta. The release management scripts make use of the `upstream_url` to send files to the file server.",
    "created_at": "2022-04-11T00:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360540",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:60 klee]:
> Replying to [comment:58 mkoeppe]:
> > If the file is not too big, 

> 
> I am not sure how big is "too big".
> 
> > you can attach it to this ticket and use the resulting URL instead. 

> 
> Anyway, done. Would this be a temporary (to be deleted before the branch is merged) or permanent (keep the tarball in trac) url?


Either permanent or kept at least until the release manager has made the next beta. The release management scripts make use of the `upstream_url` to send files to the file server.



---

archive/issue_comments_360541.json:
```json
{
    "body": "The github action still fails with the same error (no mirror found): https://github.com/sagemath/sagetrac-mirror/runs/5964659669?check_suite_focus=true",
    "created_at": "2022-04-11T17:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360541",
    "user": "https://github.com/tobiasdiez"
}
```

The github action still fails with the same error (no mirror found): https://github.com/sagemath/sagetrac-mirror/runs/5964659669?check_suite_focus=true



---

archive/issue_comments_360542.json:
```json
{
    "body": "Replying to [comment:63 mkoeppe]:\n> > Anyway, done. Would this be a temporary (to be deleted before the branch is merged) or permanent (keep the tarball in trac) url?\n\n> \n> Either permanent or kept at least until the release manager has made the next beta. The release management scripts make use of the `upstream_url` to send files to the file server.\n\n\nThat's good to know. Then I would not remove the `upstream_url` and the tarball attached.",
    "created_at": "2022-04-12T00:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360542",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:63 mkoeppe]:
> > Anyway, done. Would this be a temporary (to be deleted before the branch is merged) or permanent (keep the tarball in trac) url?

> 
> Either permanent or kept at least until the release manager has made the next beta. The release management scripts make use of the `upstream_url` to send files to the file server.


That's good to know. Then I would not remove the `upstream_url` and the tarball attached.



---

archive/issue_comments_360543.json:
```json
{
    "body": "While I see no difference in the quality of typeset maths in mathjax3 docs from mathjax2 docs, I observe mathjax3 docs load slightly slower than mathjax2 docs. Do you see the same? This is strange because mathjax3 is supposed (said) to load faster than mathjax2...",
    "created_at": "2022-04-12T10:45:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360543",
    "user": "https://github.com/kwankyu"
}
```

While I see no difference in the quality of typeset maths in mathjax3 docs from mathjax2 docs, I observe mathjax3 docs load slightly slower than mathjax2 docs. Do you see the same? This is strange because mathjax3 is supposed (said) to load faster than mathjax2...



---

archive/issue_comments_360544.json:
```json
{
    "body": "With MathJax3, the docs actually load for me, so I think #18596 has been fixed as a side effect. One thing I've noticed though is that, even with the default value of `--use-cdns=False`, I get references to a few CDNs in my docs. For example,\n\n```\n$ grep '<script.*src=' ./local/share/doc/sage/html/en/reference/index.html\n    <script data-url_root=\"./\" id=\"documentation_options\" src=\"_static/documentation_options.js\"></script>\n    <script src=\"_static/jquery.js\"></script>\n    <script src=\"_static/underscore.js\"></script>\n    <script src=\"_static/doctools.js\"></script>\n    <script src=\"_static/thebelab-helper.js\"></script>\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js\"></script>\n    <script src=\"https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js\"></script>\n    <script defer=\"defer\" src=\"_static/mathjax/tex-chtml.js\"></script>\n  <!-- <script src=\"_static/thebe.js\" type=\"text/javascript\"></script> -->\n  <!-- <script src=\"_static/thebe-sage.js\" type=\"text/javascript\"></script> -->\n```\n\nI don't know if those are related to this ticket, but I figured I'd mention it.",
    "created_at": "2022-04-13T20:20:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360544",
    "user": "https://github.com/orlitzky"
}
```

With MathJax3, the docs actually load for me, so I think #18596 has been fixed as a side effect. One thing I've noticed though is that, even with the default value of `--use-cdns=False`, I get references to a few CDNs in my docs. For example,

```
$ grep '<script.*src=' ./local/share/doc/sage/html/en/reference/index.html
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/thebelab-helper.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script defer="defer" src="_static/mathjax/tex-chtml.js"></script>
  <!-- <script src="_static/thebe.js" type="text/javascript"></script> -->
  <!-- <script src="_static/thebe-sage.js" type="text/javascript"></script> -->
```

I don't know if those are related to this ticket, but I figured I'd mention it.



---

archive/issue_comments_360545.json:
```json
{
    "body": "Replying to [comment:66 klee]:\n> While I see no difference in the quality of typeset maths in mathjax3 docs from mathjax2 docs, I observe mathjax3 docs load slightly slower than mathjax2 docs. Do you see the same? This is strange because mathjax3 is supposed (said) to load faster than mathjax2...\n\n\nIf you please could fix the documentation github workflow, then one can easily test this by running some benchmarks (e.g. using https://pagespeed.web.dev/).",
    "created_at": "2022-04-13T20:22:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360545",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:66 klee]:
> While I see no difference in the quality of typeset maths in mathjax3 docs from mathjax2 docs, I observe mathjax3 docs load slightly slower than mathjax2 docs. Do you see the same? This is strange because mathjax3 is supposed (said) to load faster than mathjax2...


If you please could fix the documentation github workflow, then one can easily test this by running some benchmarks (e.g. using https://pagespeed.web.dev/).



---

archive/issue_comments_360546.json:
```json
{
    "body": "Replying to [comment:67 mjo]:\n> With MathJax3, the docs actually load for me, so I think #18596 has been fixed as a side effect. \n\n\nGood. \n\n> One thing I've noticed though is that, even with the default value of `--use-cdns=False`, I get references to a few CDNs in my docs. For example,\n> \n> \n> ```\n> $ grep '<script.*src=' ./local/share/doc/sage/html/en/reference/index.html\n>     <script data-url_root=\"./\" id=\"documentation_options\" src=\"_static/documentation_options.js\"></script>\n>     <script src=\"_static/jquery.js\"></script>\n>     <script src=\"_static/underscore.js\"></script>\n>     <script src=\"_static/doctools.js\"></script>\n>     <script src=\"_static/thebelab-helper.js\"></script>\n>     <script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js\"></script>\n>     <script src=\"https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js\"></script>\n>     <script defer=\"defer\" src=\"_static/mathjax/tex-chtml.js\"></script>\n>   <!-- <script src=\"_static/thebe.js\" type=\"text/javascript\"></script> -->\n>   <!-- <script src=\"_static/thebe-sage.js\" type=\"text/javascript\"></script> -->\n> ```\n> \n> I don't know if those are related to this ticket, but I figured I'd mention it.\n\n\nSee ticket:33320#comment:82.",
    "created_at": "2022-04-14T00:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360546",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:67 mjo]:
> With MathJax3, the docs actually load for me, so I think #18596 has been fixed as a side effect. 


Good. 

> One thing I've noticed though is that, even with the default value of `--use-cdns=False`, I get references to a few CDNs in my docs. For example,
> 
> 
> ```
> $ grep '<script.*src=' ./local/share/doc/sage/html/en/reference/index.html
>     <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
>     <script src="_static/jquery.js"></script>
>     <script src="_static/underscore.js"></script>
>     <script src="_static/doctools.js"></script>
>     <script src="_static/thebelab-helper.js"></script>
>     <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
>     <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
>     <script defer="defer" src="_static/mathjax/tex-chtml.js"></script>
>   <!-- <script src="_static/thebe.js" type="text/javascript"></script> -->
>   <!-- <script src="_static/thebe-sage.js" type="text/javascript"></script> -->
> ```
> 
> I don't know if those are related to this ticket, but I figured I'd mention it.


See ticket:33320#comment:82.



---

archive/issue_comments_360547.json:
```json
{
    "body": "Replying to [comment:68 gh-tobiasdiez]:\n> Replying to [comment:66 klee]:\n> > While I see no difference in the quality of typeset maths in mathjax3 docs from mathjax2 docs, I observe mathjax3 docs load slightly slower than mathjax2 docs. Do you see the same? This is strange because mathjax3 is supposed (said) to load faster than mathjax2...\n\n> \n> If you please could fix the documentation github workflow, then one can easily test this by running some benchmarks (e.g. using https://pagespeed.web.dev/).\n\n\nI have no experience with github workflow, but I will see it. \n\nFor the issue, I am waiting for an answer to https://github.com/mathjax/MathJax/issues/2862.",
    "created_at": "2022-04-14T00:21:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360547",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:68 gh-tobiasdiez]:
> Replying to [comment:66 klee]:
> > While I see no difference in the quality of typeset maths in mathjax3 docs from mathjax2 docs, I observe mathjax3 docs load slightly slower than mathjax2 docs. Do you see the same? This is strange because mathjax3 is supposed (said) to load faster than mathjax2...

> 
> If you please could fix the documentation github workflow, then one can easily test this by running some benchmarks (e.g. using https://pagespeed.web.dev/).


I have no experience with github workflow, but I will see it. 

For the issue, I am waiting for an answer to https://github.com/mathjax/MathJax/issues/2862.



---

archive/issue_comments_360548.json:
```json
{
    "body": "Replying to [comment:64 gh-tobiasdiez]:\n> The github action still fails with the same error (no mirror found): https://github.com/sagemath/sagetrac-mirror/runs/5964659669?check_suite_focus=true\n\n\nI don't know what is going on with github workflow, but I cannot find something like this in the log:\n\n```\n[mathjax-3.2.0] ERROR [transfer|run:135]: [Errno socket error] [Errno 404] Not Found: '//sagepad.org/spkg/upstream/mathjax/mathjax-3.2.0.tar.gz'\n[mathjax-3.2.0] Attempting to download from https://trac.sagemath.org/raw-attachment/ticket/25833/mathjax-3.2.0.tar.gz\n[mathjax-3.2.0] [......................................................................]\n[mathjax-3.2.0] mathjax-3.2.0\n[mathjax-3.2.0] ====================================================\n[mathjax-3.2.0] Setting up build directory for mathjax-3.2.0\n[mathjax-3.2.0] Finished extraction\n[mathjax-3.2.0] No patch files found in ../patches\n[mathjax-3.2.0] ****************************************************\n[mathjax-3.2.0] Host system:\n[mathjax-3.2.0] Darwin Hera.local 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:45:05 PDT 2022; root:xnu-8020.101.4~15/RELEASE_X86_64 x86_64\n[mathjax-3.2.0] ****************************************************\n[mathjax-3.2.0] C compiler: gcc\n[mathjax-3.2.0] C compiler version:\n[mathjax-3.2.0] Apple clang version 13.1.6 (clang-1316.0.21.2.3)\n[mathjax-3.2.0] Target: x86_64-apple-darwin21.4.0\n[mathjax-3.2.0] Thread model: posix\n[mathjax-3.2.0] InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin\n[mathjax-3.2.0] ****************************************************\n[mathjax-3.2.0] Package 'mathjax' is currently not installed\n[mathjax-3.2.0] No legacy uninstaller found for 'mathjax'; nothing to do\n[mathjax-3.2.0] src/mathjax -> /Users/kwankyu/GitHub/sage-dev/local/var/tmp/sage/build/mathjax-3.2.0/inst/Users/kwankyu/GitHub/sage-dev/local/share/mathjax\n[mathjax-3.2.0] \n[mathjax-3.2.0] real\t0m0.117s\n[mathjax-3.2.0] user\t0m0.015s\n[mathjax-3.2.0] sys\t0m0.099s\n[mathjax-3.2.0] Copying package files from temporary location /Users/kwankyu/GitHub/sage-dev/local/var/tmp/sage/build/mathjax-3.2.0/inst to /Users/kwankyu/GitHub/sage-dev/local\n[mathjax-3.2.0] Successfully installed mathjax-3.2.0\n[mathjax-3.2.0] Deleting temporary build directory\n[mathjax-3.2.0] /Users/kwankyu/GitHub/sage-dev/local/var/tmp/sage/build/mathjax-3.2.0\n[mathjax-3.2.0] Finished installing mathjax-3.2.0\n```",
    "created_at": "2022-04-14T02:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360548",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:64 gh-tobiasdiez]:
> The github action still fails with the same error (no mirror found): https://github.com/sagemath/sagetrac-mirror/runs/5964659669?check_suite_focus=true


I don't know what is going on with github workflow, but I cannot find something like this in the log:

```
[mathjax-3.2.0] ERROR [transfer|run:135]: [Errno socket error] [Errno 404] Not Found: '//sagepad.org/spkg/upstream/mathjax/mathjax-3.2.0.tar.gz'
[mathjax-3.2.0] Attempting to download from https://trac.sagemath.org/raw-attachment/ticket/25833/mathjax-3.2.0.tar.gz
[mathjax-3.2.0] [......................................................................]
[mathjax-3.2.0] mathjax-3.2.0
[mathjax-3.2.0] ====================================================
[mathjax-3.2.0] Setting up build directory for mathjax-3.2.0
[mathjax-3.2.0] Finished extraction
[mathjax-3.2.0] No patch files found in ../patches
[mathjax-3.2.0] ****************************************************
[mathjax-3.2.0] Host system:
[mathjax-3.2.0] Darwin Hera.local 21.4.0 Darwin Kernel Version 21.4.0: Fri Mar 18 00:45:05 PDT 2022; root:xnu-8020.101.4~15/RELEASE_X86_64 x86_64
[mathjax-3.2.0] ****************************************************
[mathjax-3.2.0] C compiler: gcc
[mathjax-3.2.0] C compiler version:
[mathjax-3.2.0] Apple clang version 13.1.6 (clang-1316.0.21.2.3)
[mathjax-3.2.0] Target: x86_64-apple-darwin21.4.0
[mathjax-3.2.0] Thread model: posix
[mathjax-3.2.0] InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin
[mathjax-3.2.0] ****************************************************
[mathjax-3.2.0] Package 'mathjax' is currently not installed
[mathjax-3.2.0] No legacy uninstaller found for 'mathjax'; nothing to do
[mathjax-3.2.0] src/mathjax -> /Users/kwankyu/GitHub/sage-dev/local/var/tmp/sage/build/mathjax-3.2.0/inst/Users/kwankyu/GitHub/sage-dev/local/share/mathjax
[mathjax-3.2.0] 
[mathjax-3.2.0] real	0m0.117s
[mathjax-3.2.0] user	0m0.015s
[mathjax-3.2.0] sys	0m0.099s
[mathjax-3.2.0] Copying package files from temporary location /Users/kwankyu/GitHub/sage-dev/local/var/tmp/sage/build/mathjax-3.2.0/inst to /Users/kwankyu/GitHub/sage-dev/local
[mathjax-3.2.0] Successfully installed mathjax-3.2.0
[mathjax-3.2.0] Deleting temporary build directory
[mathjax-3.2.0] /Users/kwankyu/GitHub/sage-dev/local/var/tmp/sage/build/mathjax-3.2.0
[mathjax-3.2.0] Finished installing mathjax-3.2.0
```



---

archive/issue_comments_360549.json:
```json
{
    "body": "Ah, you need `./configure --enable-download-from-upstream-url`.",
    "created_at": "2022-04-14T04:08:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360549",
    "user": "https://github.com/kwankyu"
}
```

Ah, you need `./configure --enable-download-from-upstream-url`.



---

archive/issue_comments_360550.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-14T07:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360550",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360551.json:
```json
{
    "body": "The last commit is to lessen flickering in the reference main page because of slow mathjax rendering.",
    "created_at": "2022-04-14T07:51:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360551",
    "user": "https://github.com/kwankyu"
}
```

The last commit is to lessen flickering in the reference main page because of slow mathjax rendering.



---

archive/issue_comments_360552.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-14T07:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360552",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_360553.json:
```json
{
    "body": "It seems there is nothing for us to do for a bit slow loading of mathjax3.\n\nLet's move on.",
    "created_at": "2022-04-14T07:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360553",
    "user": "https://github.com/kwankyu"
}
```

It seems there is nothing for us to do for a bit slow loading of mathjax3.

Let's move on.



---

archive/issue_comments_360554.json:
```json
{
    "body": "Replying to [comment:72 klee]:\n> Ah, you need `./configure --enable-download-from-upstream-url`.\n\n\nOkay! Matthias (and everyone else), would it make sense to add this flag to the github actions?",
    "created_at": "2022-04-14T17:33:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360554",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:72 klee]:
> Ah, you need `./configure --enable-download-from-upstream-url`.


Okay! Matthias (and everyone else), would it make sense to add this flag to the github actions?



---

archive/issue_comments_360555.json:
```json
{
    "body": "Yes, we already use it everywhere. Did we forget to add it in the ones that you added?",
    "created_at": "2022-04-14T17:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360555",
    "user": "https://github.com/mkoeppe"
}
```

Yes, we already use it everywhere. Did we forget to add it in the ones that you added?



---

archive/issue_comments_360556.json:
```json
{
    "body": "Replying to [comment:77 mkoeppe]:\n> Yes, we already use it everywhere. \n\n\nA patchbot also failed in the same way.",
    "created_at": "2022-04-15T07:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360556",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:77 mkoeppe]:
> Yes, we already use it everywhere. 


A patchbot also failed in the same way.



---

archive/issue_comments_360557.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-16T17:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360557",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360558.json:
```json
{
    "body": "Replying to [comment:77 mkoeppe]:\n> Yes, we already use it everywhere. Did we forget to add it in the ones that you added?\n\n\nThanks, I've now added it to the Build & Test and Build documentation workflows. The latter works now (the former has currently some issues with the ubuntu server, but that's not specific to this ticket).",
    "created_at": "2022-04-16T19:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360558",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:77 mkoeppe]:
> Yes, we already use it everywhere. Did we forget to add it in the ones that you added?


Thanks, I've now added it to the Build & Test and Build documentation workflows. The latter works now (the former has currently some issues with the ubuntu server, but that's not specific to this ticket).



---

archive/issue_comments_360559.json:
```json
{
    "body": "Replying to [comment:66 klee]:\n> While I see no difference in the quality of typeset maths in mathjax3 docs from mathjax2 docs, I observe mathjax3 docs load slightly slower than mathjax2 docs. Do you see the same? This is strange because mathjax3 is supposed (said) to load faster than mathjax2...\n\n\nI cannot confirm these performance issues. On the contrary, the mathjax 3 version seems to load faster.\n\n- Mathjax3: https://7b43a317c103400d467a6c8d65fb6d6181d4ee37--sagemath-tobias.netlify.app/reference/manifolds/sage/manifolds/differentiable/vectorfield.html\n- Mathjax2: https://625315e3e8aca22301c90442--sagemath-tobias.netlify.app/reference/manifolds/sage/manifolds/differentiable/vectorfield.html",
    "created_at": "2022-04-16T19:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360559",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:66 klee]:
> While I see no difference in the quality of typeset maths in mathjax3 docs from mathjax2 docs, I observe mathjax3 docs load slightly slower than mathjax2 docs. Do you see the same? This is strange because mathjax3 is supposed (said) to load faster than mathjax2...


I cannot confirm these performance issues. On the contrary, the mathjax 3 version seems to load faster.

- Mathjax3: https://7b43a317c103400d467a6c8d65fb6d6181d4ee37--sagemath-tobias.netlify.app/reference/manifolds/sage/manifolds/differentiable/vectorfield.html
- Mathjax2: https://625315e3e8aca22301c90442--sagemath-tobias.netlify.app/reference/manifolds/sage/manifolds/differentiable/vectorfield.html



---

archive/issue_comments_360560.json:
```json
{
    "body": "I'm fine with your changes! Thanks",
    "created_at": "2022-04-16T19:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360560",
    "user": "https://github.com/tobiasdiez"
}
```

I'm fine with your changes! Thanks



---

archive/issue_comments_360561.json:
```json
{
    "body": "Replying to [comment:80 gh-tobiasdiez]:\n> Replying to [comment:77 mkoeppe]:\n> > Yes, we already use it everywhere. Did we forget to add it in the ones that you added?\n\n> \n> Thanks, I've now added it to the Build & Test and Build documentation workflows. The latter works now (the former has currently some issues with the ubuntu server, but that's not specific to this ticket).\n\n\nI've cherry-picked this onto #33724.",
    "created_at": "2022-04-16T19:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360561",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:80 gh-tobiasdiez]:
> Replying to [comment:77 mkoeppe]:
> > Yes, we already use it everywhere. Did we forget to add it in the ones that you added?

> 
> Thanks, I've now added it to the Build & Test and Build documentation workflows. The latter works now (the former has currently some issues with the ubuntu server, but that's not specific to this ticket).


I've cherry-picked this onto #33724.



---

archive/issue_comments_360562.json:
```json
{
    "body": "Okay, thanks!",
    "created_at": "2022-04-16T21:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360562",
    "user": "https://github.com/tobiasdiez"
}
```

Okay, thanks!



---

archive/issue_comments_360563.json:
```json
{
    "body": "Replying to [comment:81 gh-tobiasdiez]:\n> I cannot confirm these performance issues. On the contrary, the mathjax 3 version seems to load faster.\n> \n> - Mathjax3: https://7b43a317c103400d467a6c8d65fb6d6181d4ee37--sagemath-tobias.netlify.app/reference/manifolds/sage/manifolds/differentiable/vectorfield.html\n> - Mathjax2: https://625315e3e8aca22301c90442--sagemath-tobias.netlify.app/reference/manifolds/sage/manifolds/differentiable/vectorfield.html\n\n\nOkay. That seems depend.",
    "created_at": "2022-04-16T23:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360563",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:81 gh-tobiasdiez]:
> I cannot confirm these performance issues. On the contrary, the mathjax 3 version seems to load faster.
> 
> - Mathjax3: https://7b43a317c103400d467a6c8d65fb6d6181d4ee37--sagemath-tobias.netlify.app/reference/manifolds/sage/manifolds/differentiable/vectorfield.html
> - Mathjax2: https://625315e3e8aca22301c90442--sagemath-tobias.netlify.app/reference/manifolds/sage/manifolds/differentiable/vectorfield.html


Okay. That seems depend.



---

archive/issue_comments_360564.json:
```json
{
    "body": "Replying to [comment:70 klee]:\n> For the issue, I am waiting for an answer to https://github.com/mathjax/MathJax/issues/2862.\n\n\nAccording to the answer, mathjax3 is not to blame if the performance issue is ever real. It's also not clear if the performance issue really exists. \n\nAs there is no other issue raised with the mathjax3 documentation, let's get this in.",
    "created_at": "2022-04-19T04:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360564",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:70 klee]:
> For the issue, I am waiting for an answer to https://github.com/mathjax/MathJax/issues/2862.


According to the answer, mathjax3 is not to blame if the performance issue is ever real. It's also not clear if the performance issue really exists. 

As there is no other issue raised with the mathjax3 documentation, let's get this in.



---

archive/issue_comments_360565.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-19T04:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360565",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_360566.json:
```json
{
    "body": "Thanks! \n\nFor the performance issues, there are a few things not related to mathjax that could be improved: https://pagespeed.web.dev/report?url=https%3A%2F%2F7b43a317c103400d467a6c8d65fb6d6181d4ee37--sagemath-tobias.netlify.app%2Freference%2Fmanifolds%2Fsage%2Fmanifolds%2Fdifferentiable%2Fvectorfield.html\n\nNotably, the `require` script is quite expensive to load.",
    "created_at": "2022-04-20T19:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360566",
    "user": "https://github.com/tobiasdiez"
}
```

Thanks! 

For the performance issues, there are a few things not related to mathjax that could be improved: https://pagespeed.web.dev/report?url=https%3A%2F%2F7b43a317c103400d467a6c8d65fb6d6181d4ee37--sagemath-tobias.netlify.app%2Freference%2Fmanifolds%2Fsage%2Fmanifolds%2Fdifferentiable%2Fvectorfield.html

Notably, the `require` script is quite expensive to load.



---

archive/issue_comments_360567.json:
```json
{
    "body": "Replying to [comment:88 gh-tobiasdiez]:\n> Notably, the `require` script is quite expensive to load.\n\n\nYes. I noticed that. See ticket:33320#comment:82.",
    "created_at": "2022-04-21T00:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360567",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:88 gh-tobiasdiez]:
> Notably, the `require` script is quite expensive to load.


Yes. I noticed that. See ticket:33320#comment:82.



---

archive/issue_comments_360568.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2022-04-29T02:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360568",
    "user": "https://github.com/kwankyu"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_360569.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-29T02:25:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360569",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_360570.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-04-29T02:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360570",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_360571.json:
```json
{
    "body": "Rebased on the dependency #33763.",
    "created_at": "2022-04-29T02:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360571",
    "user": "https://github.com/kwankyu"
}
```

Rebased on the dependency #33763.



---

archive/issue_comments_360572.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-29T03:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360572",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_360573.json:
```json
{
    "body": "The dependency got positive review.",
    "created_at": "2022-04-29T18:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360573",
    "user": "https://github.com/kwankyu"
}
```

The dependency got positive review.



---

archive/issue_comments_360574.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-29T18:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360574",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_360575.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-24T22:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360575",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_064622.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-05-24T22:45:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25833#event-64622"
}
```



---

archive/issue_comments_360576.json:
```json
{
    "body": "Why the double `mathjax/mathjax` subdir in the installation path? This looks weird and it will break using distro packages (so far only Arch seems to be shipping mathjax 3, but I doubt any distro will install it to `/usr/share/mathjax/mathjax`)",
    "created_at": "2022-05-30T19:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360576",
    "user": "https://github.com/antonio-rojas"
}
```

Why the double `mathjax/mathjax` subdir in the installation path? This looks weird and it will break using distro packages (so far only Arch seems to be shipping mathjax 3, but I doubt any distro will install it to `/usr/share/mathjax/mathjax`)



---

archive/issue_comments_360577.json:
```json
{
    "body": "Replying to [comment:96 arojas]:\n> Why the double `mathjax/mathjax` subdir in the installation path? This looks weird \n\n\nIf I remember correctly, that was the result of wishing to put the (second) `mathjax` directory into `_static` so that all mathjax files are kept in `_static/mathjax` and not mixed with other static files (unlike the situation with mathjax2), while not touching the spkg installation procedure (specifically `build/pkgs/mathjax/spkg-install.in`). Hence the tarball of spkg `mathjax` consists of a single directory `mathjax`.\n\n> and it will break using distro packages (so far only Arch seems to be shipping mathjax 3, but I doubt any distro will install it to `/usr/share/mathjax/mathjax`)\n\n\nI don't know how the distro package works. Can't they change the installation script to install the package as they want, that is, into `/usr/share/mathjax`?\n\nIf they can't, would it solve the problem that the spkg tarball consists of mathjax files instead of the single directory? If we do so, then we need to touch the spkg installation procedure.",
    "created_at": "2022-05-31T00:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360577",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:96 arojas]:
> Why the double `mathjax/mathjax` subdir in the installation path? This looks weird 


If I remember correctly, that was the result of wishing to put the (second) `mathjax` directory into `_static` so that all mathjax files are kept in `_static/mathjax` and not mixed with other static files (unlike the situation with mathjax2), while not touching the spkg installation procedure (specifically `build/pkgs/mathjax/spkg-install.in`). Hence the tarball of spkg `mathjax` consists of a single directory `mathjax`.

> and it will break using distro packages (so far only Arch seems to be shipping mathjax 3, but I doubt any distro will install it to `/usr/share/mathjax/mathjax`)


I don't know how the distro package works. Can't they change the installation script to install the package as they want, that is, into `/usr/share/mathjax`?

If they can't, would it solve the problem that the spkg tarball consists of mathjax files instead of the single directory? If we do so, then we need to touch the spkg installation procedure.



---

archive/issue_comments_360578.json:
```json
{
    "body": "Replying to [comment:97 klee]:\n> I don't know how the distro package works. Can't they change the installation script to install the package as they want, that is, into `/usr/share/mathjax`?\n> \n> If they can't, would it solve the problem that the spkg tarball consists of mathjax files instead of the single directory? If we do so, then we need to touch the spkg installation procedure. \n\n\nOK, I see. The problem is that, if mathjax is installed in `/usr/share/mathjax` (as it is on Arch, and I assume other distros once they upgrade), sphinx will copy its content to `_static`, which is not what Sage expects, so mathjax won't work in docs. And setting `MATHJAX_DIR=/usr/share` is not an option, as this would copy the entire contents of `/usr/share` into `_static`.\n\nIt's unfortunate that sphinx doesn't allow to specify a single dir to be copied into `_static`, this would allow the issue to be solved cleanly. I've opened a ticket upstream for this https://github.com/sphinx-doc/sphinx/issues/10499 so we can have a reasonable solution eventually.\n\nFor now, if we can't come up with a better solution, I guess I can just copy the mathjax dir to some temporary location at build time and set that as `MATHJAX_DIR`",
    "created_at": "2022-05-31T07:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360578",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:97 klee]:
> I don't know how the distro package works. Can't they change the installation script to install the package as they want, that is, into `/usr/share/mathjax`?
> 
> If they can't, would it solve the problem that the spkg tarball consists of mathjax files instead of the single directory? If we do so, then we need to touch the spkg installation procedure. 


OK, I see. The problem is that, if mathjax is installed in `/usr/share/mathjax` (as it is on Arch, and I assume other distros once they upgrade), sphinx will copy its content to `_static`, which is not what Sage expects, so mathjax won't work in docs. And setting `MATHJAX_DIR=/usr/share` is not an option, as this would copy the entire contents of `/usr/share` into `_static`.

It's unfortunate that sphinx doesn't allow to specify a single dir to be copied into `_static`, this would allow the issue to be solved cleanly. I've opened a ticket upstream for this https://github.com/sphinx-doc/sphinx/issues/10499 so we can have a reasonable solution eventually.

For now, if we can't come up with a better solution, I guess I can just copy the mathjax dir to some temporary location at build time and set that as `MATHJAX_DIR`



---

archive/issue_comments_360579.json:
```json
{
    "body": "Replying to [comment:98 arojas]:\n> It's unfortunate that sphinx doesn't allow to specify a single dir to be copied into `_static`, this would allow the issue to be solved cleanly. I've opened a ticket upstream for this https://github.com/sphinx-doc/sphinx/issues/10499 so we can have a reasonable solution eventually.\n\n\nTrue. Thanks.\n \n> For now, if we can't come up with a better solution, I guess I can just copy the mathjax dir to some temporary location at build time and set that as `MATHJAX_DIR`\n\n\nI experimented with the idea of using a symbolic link instead of copying, but it didn't work. Still no better solution. Thanks.",
    "created_at": "2022-05-31T13:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25833",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25833#issuecomment-360579",
    "user": "https://github.com/kwankyu"
}
```

Replying to [comment:98 arojas]:
> It's unfortunate that sphinx doesn't allow to specify a single dir to be copied into `_static`, this would allow the issue to be solved cleanly. I've opened a ticket upstream for this https://github.com/sphinx-doc/sphinx/issues/10499 so we can have a reasonable solution eventually.


True. Thanks.
 
> For now, if we can't come up with a better solution, I guess I can just copy the mathjax dir to some temporary location at build time and set that as `MATHJAX_DIR`


I experimented with the idea of using a symbolic link instead of copying, but it didn't work. Still no better solution. Thanks.
