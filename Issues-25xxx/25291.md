# Issue 25291: speed up generic polynomials

archive/issues_025054.json:
```json
{
    "body": "\n\nBranch/Commit: 19226310609d1f5e95b95210e78376915e9acfa1\n\nReviewer: Travis Scrimshaw, Marc Mezzarobba\n\nAuthor: Marc Mezzarobba, Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25291\n\n",
    "closed_at": "2018-05-18T17:48:59Z",
    "created_at": "2018-05-04T10:37:53Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "speed up generic polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25291",
    "user": "https://github.com/mezzarobba"
}
```


Branch/Commit: 19226310609d1f5e95b95210e78376915e9acfa1

Reviewer: Travis Scrimshaw, Marc Mezzarobba

Author: Marc Mezzarobba, Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25291





---

archive/issue_comments_482870.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-04T10:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482870",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_482871.json:
```json
{
    "body": "Changing commit from \"f584428af0d57ba2a2cac79e77dda747acf39d0c\" to \"7bb0dc8c263d8af8deed5a5ff11002c6e7a245d8\"",
    "created_at": "2018-05-04T10:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f584428af0d57ba2a2cac79e77dda747acf39d0c" to "7bb0dc8c263d8af8deed5a5ff11002c6e7a245d8"



---

archive/issue_comments_482872.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-04T10:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_482873.json:
```json
{
    "body": "<a id='comment:3'></a>I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.\n\nHave you also run some timings?\n\nI will also push some further changes that are micro-optimizations (mostly avoiding extra calls to `degree()` by using `get_unsafe()` because we have already checked the degree is non-negative).",
    "created_at": "2018-05-05T08:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482873",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.

Have you also run some timings?

I will also push some further changes that are micro-optimizations (mostly avoiding extra calls to `degree()` by using `get_unsafe()` because we have already checked the degree is non-negative).



---

archive/issue_comments_482874.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [tscrim](#comment%3A3):\n> I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.\n\n\nFine with me.\n\n> Have you also run some timings?\n\n\nNo micro-benchmarks, but this change seems to speed up the \u201creal-world\u201d code I was profiling by ~3%.",
    "created_at": "2018-05-05T09:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482874",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:4'></a>Replying to [tscrim](#comment%3A3):
> I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.


Fine with me.

> Have you also run some timings?


No micro-benchmarks, but this change seems to speed up the “real-world” code I was profiling by ~3%.



---

archive/issue_comments_482875.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-05T09:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482875",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_482876.json:
```json
{
    "body": "Changing commit from \"7bb0dc8c263d8af8deed5a5ff11002c6e7a245d8\" to \"31be20254270b9e152f57af986a160e23e560bd9\"",
    "created_at": "2018-05-05T09:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7bb0dc8c263d8af8deed5a5ff11002c6e7a245d8" to "31be20254270b9e152f57af986a160e23e560bd9"



---

archive/issue_comments_482877.json:
```json
{
    "body": "Changing commit from \"31be20254270b9e152f57af986a160e23e560bd9\" to \"19226310609d1f5e95b95210e78376915e9acfa1\"",
    "created_at": "2018-05-05T11:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482877",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "31be20254270b9e152f57af986a160e23e560bd9" to "19226310609d1f5e95b95210e78376915e9acfa1"



---

archive/issue_comments_482878.json:
```json
{
    "body": "Changing branch from \"u/mmezzarobba/polynomial_get_fast\" to \"u/tscrim/polynomial_get_coeff_c-25291\"",
    "created_at": "2018-05-05T11:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482878",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "u/mmezzarobba/polynomial_get_fast" to "u/tscrim/polynomial_get_coeff_c-25291"



---

archive/issue_comments_482879.json:
```json
{
    "body": "<a id='comment:6'></a>I chose `get_coeff_c` to be more explicit that it is a C-level method and so that there would be less chances of accidental conflicts with subclasses.\n\nAll of the other changes I did should be micro-optimizations as they avoid checks, multiple calls to other functions (e.g., `degree()`), have more direct paths. I didn't do every possible place because I felt the code clarity outweighed a (very) micro speed gain. Unfortunately there were a few places where having the field with 1 element made it so we had to have different cases (the unit code in particular).\n\nMarc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n\n---\nNew commits:",
    "created_at": "2018-05-05T11:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482879",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>I chose `get_coeff_c` to be more explicit that it is a C-level method and so that there would be less chances of accidental conflicts with subclasses.

All of the other changes I did should be micro-optimizations as they avoid checks, multiple calls to other functions (e.g., `degree()`), have more direct paths. I didn't do every possible place because I felt the code clarity outweighed a (very) micro speed gain. Unfortunately there were a few places where having the field with 1 element made it so we had to have different cases (the unit code in particular).

Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?

---
New commits:



---

archive/issue_comments_482880.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-05-05T11:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482880",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_482881.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [tscrim](#comment%3A6):\n> Marc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n\n\nIt seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)",
    "created_at": "2018-05-05T12:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482881",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:7'></a>Replying to [tscrim](#comment%3A6):
> Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?


It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)



---

archive/issue_comments_482882.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [mmezzarobba](#comment%3A7):\n> Replying to [tscrim](#comment%3A6):\n> > Marc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n\n> \n> It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)\n\n\nThank you for running it. That is about what I was generically expecting given my changes (not clearly significant, but a noticeable improvement).\n\nSo if my changes are good, feel free to set a positive review. Thank you for your work.",
    "created_at": "2018-05-05T12:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482882",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Replying to [mmezzarobba](#comment%3A7):
> Replying to [tscrim](#comment%3A6):
> > Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?

> 
> It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)


Thank you for running it. That is about what I was generically expecting given my changes (not clearly significant, but a noticeable improvement).

So if my changes are good, feel free to set a positive review. Thank you for your work.



---

archive/issue_comments_482883.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-05T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482883",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_482884.json:
```json
{
    "body": "Changing reviewer from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Marc Mezzarobba\"",
    "created_at": "2018-05-05T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482884",
    "user": "https://github.com/mezzarobba"
}
```

Changing reviewer from "Travis Scrimshaw" to "Travis Scrimshaw, Marc Mezzarobba"



---

archive/issue_comments_482885.json:
```json
{
    "body": "<a id='comment:9'></a>Thank you!",
    "created_at": "2018-05-05T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482885",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>Thank you!



---

archive/issue_comments_482886.json:
```json
{
    "body": "Changing author from \"Marc Mezzarobba\" to \"Marc Mezzarobba, Travis Scrimshaw\"",
    "created_at": "2018-05-05T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482886",
    "user": "https://github.com/mezzarobba"
}
```

Changing author from "Marc Mezzarobba" to "Marc Mezzarobba, Travis Scrimshaw"



---

archive/issue_comments_482887.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482887",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_482888.json:
```json
{
    "body": "Changing branch from \"u/tscrim/polynomial_get_coeff_c-25291\" to \"19226310609d1f5e95b95210e78376915e9acfa1\"",
    "created_at": "2018-05-18T17:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-482888",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/tscrim/polynomial_get_coeff_c-25291" to "19226310609d1f5e95b95210e78376915e9acfa1"



---

archive/issue_events_063400.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:48:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25291#event-63400"
}
```
