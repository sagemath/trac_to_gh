# Issue 25291: speed up generic polynomials

archive/issues_025054.json:
```json
{
    "body": "\n\nBranch/Commit: 19226310609d1f5e95b95210e78376915e9acfa1\n\nReviewer: Travis Scrimshaw, Marc Mezzarobba\n\nAuthor: Marc Mezzarobba, Travis Scrimshaw\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25291\n\n",
    "closed_at": "2018-05-18T17:48:59Z",
    "created_at": "2018-05-04T10:37:53Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "speed up generic polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25291",
    "user": "https://github.com/mezzarobba"
}
```


Branch/Commit: 19226310609d1f5e95b95210e78376915e9acfa1

Reviewer: Travis Scrimshaw, Marc Mezzarobba

Author: Marc Mezzarobba, Travis Scrimshaw

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25291





---

archive/issue_comments_375216.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-04T10:38:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375216",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_375217.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-04T10:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375217",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375218.json:
```json
{
    "body": "<a id='comment:3'></a>I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.\n\nHave you also run some timings?\n\nI will also push some further changes that are micro-optimizations (mostly avoiding extra calls to `degree()` by using `get_unsafe()` because we have already checked the degree is non-negative).",
    "created_at": "2018-05-05T08:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375218",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.

Have you also run some timings?

I will also push some further changes that are micro-optimizations (mostly avoiding extra calls to `degree()` by using `get_unsafe()` because we have already checked the degree is non-negative).



---

archive/issue_comments_375219.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 tscrim]:\n> I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.\n\n\nFine with me.\n\n> Have you also run some timings?\n\n\nNo micro-benchmarks, but this change seems to speed up the \u201creal-world\u201d code I was profiling by ~3%.",
    "created_at": "2018-05-05T09:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375219",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:4'></a>Replying to [comment:3 tscrim]:
> I know this is close to bikeshedding, but I think a slightly more descriptive name would be more appropriate, such as `get_coeff` or `get_coeff_c`, would be better in the long-term for code readability.


Fine with me.

> Have you also run some timings?


No micro-benchmarks, but this change seems to speed up the “real-world” code I was profiling by ~3%.



---

archive/issue_comments_375220.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-05T09:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375220",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375221.json:
```json
{
    "body": "<a id='comment:6'></a>I chose `get_coeff_c` to be more explicit that it is a C-level method and so that there would be less chances of accidental conflicts with subclasses.\n\nAll of the other changes I did should be micro-optimizations as they avoid checks, multiple calls to other functions (e.g., `degree()`), have more direct paths. I didn't do every possible place because I felt the code clarity outweighed a (very) micro speed gain. Unfortunately there were a few places where having the field with 1 element made it so we had to have different cases (the unit code in particular).\n\nMarc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n\n---\nNew commits:",
    "created_at": "2018-05-05T11:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375221",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>I chose `get_coeff_c` to be more explicit that it is a C-level method and so that there would be less chances of accidental conflicts with subclasses.

All of the other changes I did should be micro-optimizations as they avoid checks, multiple calls to other functions (e.g., `degree()`), have more direct paths. I didn't do every possible place because I felt the code clarity outweighed a (very) micro speed gain. Unfortunately there were a few places where having the field with 1 element made it so we had to have different cases (the unit code in particular).

Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?

---
New commits:



---

archive/issue_comments_375222.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 tscrim]:\n> Marc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n\n\nIt seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)",
    "created_at": "2018-05-05T12:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375222",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:7'></a>Replying to [comment:6 tscrim]:
> Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?


It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)



---

archive/issue_comments_375223.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 mmezzarobba]:\n> Replying to [comment:6 tscrim]:\n> > Marc, could you run your \"real-world\" example again against the code on your branch to see if you notice any differences?\n\n> \n> It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)\n\n\nThank you for running it. That is about what I was generically expecting given my changes (not clearly significant, but a noticeable improvement).\n\nSo if my changes are good, feel free to set a positive review. Thank you for your work.",
    "created_at": "2018-05-05T12:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375223",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:8'></a>Replying to [comment:7 mmezzarobba]:
> Replying to [comment:6 tscrim]:
> > Marc, could you run your "real-world" example again against the code on your branch to see if you notice any differences?

> 
> It seems again a bit (2%?) faster. (Of course, that may be measurement error--perhaps even more than with my first commit, which was motivated by `__getitem__()` showing up in the profiler output!)


Thank you for running it. That is about what I was generically expecting given my changes (not clearly significant, but a noticeable improvement).

So if my changes are good, feel free to set a positive review. Thank you for your work.



---

archive/issue_comments_375224.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-05T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375224",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375225.json:
```json
{
    "body": "<a id='comment:9'></a>Thank you!",
    "created_at": "2018-05-05T20:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375225",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:9'></a>Thank you!



---

archive/issue_comments_375226.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25291#issuecomment-375226",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063400.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:48:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25291",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25291#event-63400"
}
```
