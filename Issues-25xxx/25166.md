# Issue 25166: Random regular bipartite graph generator and bipartite graph embeddings

archive/issues_025166.json:
```json
{
    "body": "Add a generator of random regular bipartite graph, `RandomRegularBipartite`.\n\nThis ticket also unifies the graph embedding method of `CompleteBipartiteGraph`, `RandomRegularBipartite` and `RandomBipartite` by using method `_line_embedding` from `graph_plot.py`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25403\n\n",
    "closed_at": "2018-08-05T08:18:14Z",
    "created_at": "2018-05-19T17:34:32Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Random regular bipartite graph generator and bipartite graph embeddings",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25166",
    "user": "https://github.com/dcoudert"
}
```
Add a generator of random regular bipartite graph, `RandomRegularBipartite`.

This ticket also unifies the graph embedding method of `CompleteBipartiteGraph`, `RandomRegularBipartite` and `RandomBipartite` by using method `_line_embedding` from `graph_plot.py`.

Issue created by migration from https://trac.sagemath.org/ticket/25403





---

archive/issue_comments_354063.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-19T18:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354063",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354064.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-19T18:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354064",
    "user": "https://github.com/dcoudert"
}
```

New commits:



---

archive/issue_comments_354065.json:
```json
{
    "body": "Hello, this is my first attempt to review a patch... feel free to let me know if any of these suggestions are inappropriate or out of scope!\n\nFirst, am I correct that `RandomRegularBipartite` does not sample uniformly from the set of random regular bipartite graphs with the given sizes and degrees? If this is the case, then the documentation for this function should make it more clear what the sampled distribution is. \n\nSecond, would you mind adding documentation (and possibly tests) for the position dictionaries generated by `RandomBipartite` and `RandomRegularBipartite`?\n\nI also noticed that the only other random graph generator which assigns positions is `RandomTriangulation` and it only does so if the parameter `set_position` is explicitly set to `True`. Should these two functions thus also be given a `set_position` parameter for consistency?\n\nFinally, the name given to the graph generated by `RandomRegularBipartite` could be made more informative, perhaps something like:\n\n```python\nname=\"Random regular bipartite graph of size {}+{} with degrees {} and {}\".format(n1, n2, d1, d2)\n```",
    "created_at": "2018-07-24T23:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354065",
    "user": "https://github.com/bryangingechen"
}
```

Hello, this is my first attempt to review a patch... feel free to let me know if any of these suggestions are inappropriate or out of scope!

First, am I correct that `RandomRegularBipartite` does not sample uniformly from the set of random regular bipartite graphs with the given sizes and degrees? If this is the case, then the documentation for this function should make it more clear what the sampled distribution is. 

Second, would you mind adding documentation (and possibly tests) for the position dictionaries generated by `RandomBipartite` and `RandomRegularBipartite`?

I also noticed that the only other random graph generator which assigns positions is `RandomTriangulation` and it only does so if the parameter `set_position` is explicitly set to `True`. Should these two functions thus also be given a `set_position` parameter for consistency?

Finally, the name given to the graph generated by `RandomRegularBipartite` could be made more informative, perhaps something like:

```python
name="Random regular bipartite graph of size {}+{} with degrees {} and {}".format(n1, n2, d1, d2)
```



---

archive/issue_comments_354066.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-25T11:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354067.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-25T11:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354068.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-25T11:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_063796.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2018-07-25T11:44:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25166#event-63796"
}
```



---

archive/issue_comments_354069.json:
```json
{
    "body": "Thank you for reviewing this ticket. It helps a lot.\n\nI have implemented all your comments. For `RandomTriangulation`, the time to compute the positions of vertices is non negligible (planar embedding). Here, it's quite cheap, but I agree that in many cases we don't need it.\n\nDon't forget to put your real name in the field \"Reviewers\"",
    "created_at": "2018-07-25T11:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354069",
    "user": "https://github.com/dcoudert"
}
```

Thank you for reviewing this ticket. It helps a lot.

I have implemented all your comments. For `RandomTriangulation`, the time to compute the positions of vertices is non negligible (planar embedding). Here, it's quite cheap, but I agree that in many cases we don't need it.

Don't forget to put your real name in the field "Reviewers"



---

archive/issue_comments_354070.json:
```json
{
    "body": "Thanks for making the changes! It seems however there is some issue with the tests. After checking out your branch and building, `sage -t src/sage/graphs/generators/random.py` fails with a timeout. It seems the culprit is:\n\n\n```python\nsage: graphs.RandomRegularBipartite(2, 3, 3, set_position=True).get_pos() ## line 318 ##\n```\n\nThis particular graph must be complete bipartite, so perhaps there is some issue when generating these. In the complete bipartite case (`d1 == n2`) maybe the edge generation should just be made deterministic.\n\nFinally, it would probably be more helpful to users if the coordinates of the positions were included in the docstring in addition to the code comments.",
    "created_at": "2018-07-25T14:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354070",
    "user": "https://github.com/bryangingechen"
}
```

Thanks for making the changes! It seems however there is some issue with the tests. After checking out your branch and building, `sage -t src/sage/graphs/generators/random.py` fails with a timeout. It seems the culprit is:


```python
sage: graphs.RandomRegularBipartite(2, 3, 3, set_position=True).get_pos() ## line 318 ##
```

This particular graph must be complete bipartite, so perhaps there is some issue when generating these. In the complete bipartite case (`d1 == n2`) maybe the edge generation should just be made deterministic.

Finally, it would probably be more helpful to users if the coordinates of the positions were included in the docstring in addition to the code comments.



---

archive/issue_comments_354071.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-25T14:51:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354071",
    "user": "https://github.com/bryangingechen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_354072.json:
```json
{
    "body": "It's more complicated than that. If found other situations like `graphs.RandomRegularBipartite(6, 6, 5, set_position=True)` that can loop endlessly :(\nSo we need another, more secured, algorithms...",
    "created_at": "2018-07-25T15:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354072",
    "user": "https://github.com/dcoudert"
}
```

It's more complicated than that. If found other situations like `graphs.RandomRegularBipartite(6, 6, 5, set_position=True)` that can loop endlessly :(
So we need another, more secured, algorithms...



---

archive/issue_comments_354073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-29T13:05:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354074.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-29T13:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354075.json:
```json
{
    "body": "This new version should perform better.",
    "created_at": "2018-07-29T13:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354075",
    "user": "https://github.com/dcoudert"
}
```

This new version should perform better.



---

archive/issue_comments_354076.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-29T14:59:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354076",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_354077.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-31T12:05:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354077",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354078.json:
```json
{
    "body": "Hi, I went ahead and pushed some changes to this branch:\n\n- I had a look at the reference [MW1990]. Thanks for taking the time to implement much of their algorithm! However, I noticed that your implementation did not include the (indeed, rather complicated) probabilistic check to restart in their \"NODOUBLES\" function. For now, I have simply made a change to the docstring to point out that the generated graph is not uniformly random.\n- I added a check on the maximum degree to the function (plus a note in the docstring and a doctest).\n- I fixed a typo: `retart` instead of `restart`.\n- I added information about the positions to the docstring. Also, I'm not sure if we need to do anything about this, but I figured I would point out here that the positions added by this ticket are inconsistent with the position generated by `sage.graphs.CompleteBipartiteGraph`. That function places the two parts horizontally and also uses differently scaled spacing.\n- I fixed some other typos in the comments and docstrings and combined some imports into one line.\n\nEverything else seemed OK, so you may set to positive_review if you're happy with my changes.\n\n---\nNew commits:",
    "created_at": "2018-07-31T12:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354078",
    "user": "https://github.com/bryangingechen"
}
```

Hi, I went ahead and pushed some changes to this branch:

- I had a look at the reference [MW1990]. Thanks for taking the time to implement much of their algorithm! However, I noticed that your implementation did not include the (indeed, rather complicated) probabilistic check to restart in their "NODOUBLES" function. For now, I have simply made a change to the docstring to point out that the generated graph is not uniformly random.
- I added a check on the maximum degree to the function (plus a note in the docstring and a doctest).
- I fixed a typo: `retart` instead of `restart`.
- I added information about the positions to the docstring. Also, I'm not sure if we need to do anything about this, but I figured I would point out here that the positions added by this ticket are inconsistent with the position generated by `sage.graphs.CompleteBipartiteGraph`. That function places the two parts horizontally and also uses differently scaled spacing.
- I fixed some other typos in the comments and docstrings and combined some imports into one line.

Everything else seemed OK, so you may set to positive_review if you're happy with my changes.

---
New commits:



---

archive/issue_comments_354079.json:
```json
{
    "body": "Thank you for all the corrections.\n\nFor the consistency of positions, what I can do is add a method in `graph_plot.py` for bipartite embedding, like `_bipartite_embedding(g, V1, V2, first=(0,1), last=(1,0))` in the flavor of `_line_embedding`, and then use it in all bipartite graphs generators.\nIt can proceed as the plotting of `CompleteBipartiteGraph`.\nWould you agree on that ?",
    "created_at": "2018-07-31T15:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354079",
    "user": "https://github.com/dcoudert"
}
```

Thank you for all the corrections.

For the consistency of positions, what I can do is add a method in `graph_plot.py` for bipartite embedding, like `_bipartite_embedding(g, V1, V2, first=(0,1), last=(1,0))` in the flavor of `_line_embedding`, and then use it in all bipartite graphs generators.
It can proceed as the plotting of `CompleteBipartiteGraph`.
Would you agree on that ?



---

archive/issue_comments_354080.json:
```json
{
    "body": "Replying to [comment:16 dcoudert]:\n> For the consistency of positions, what I can do is add a method in `graph_plot.py` for bipartite embedding, like `_bipartite_embedding(g, V1, V2, first=(0,1), last=(1,0))` in the flavor of `_line_embedding`, and then use it in all bipartite graphs generators.\n> It can proceed as the plotting of `CompleteBipartiteGraph`.\n> Would you agree on that ?\n\n\nI wasn't familiar with those methods in `graph_plot`, but this sounds like a great solution! We should probably update the ticket title / description now though.",
    "created_at": "2018-07-31T15:24:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354080",
    "user": "https://github.com/bryangingechen"
}
```

Replying to [comment:16 dcoudert]:
> For the consistency of positions, what I can do is add a method in `graph_plot.py` for bipartite embedding, like `_bipartite_embedding(g, V1, V2, first=(0,1), last=(1,0))` in the flavor of `_line_embedding`, and then use it in all bipartite graphs generators.
> It can proceed as the plotting of `CompleteBipartiteGraph`.
> Would you agree on that ?


I wasn't familiar with those methods in `graph_plot`, but this sounds like a great solution! We should probably update the ticket title / description now though.



---

archive/issue_comments_354081.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-31T15:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354081",
    "user": "https://github.com/bryangingechen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_354082.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-31T16:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354082",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354083.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-31T17:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354083",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_354084.json:
```json
{
    "body": "I have chosen not to create a new method in `graph_plot.py` as the need for bipartite embedding is rather limited so far. I use 2 calls to `_line_embedding` instead.\n\nI have corrected the method for `_line_embedding` to avoid errors with graphs on 0 or 1 vertex.",
    "created_at": "2018-07-31T17:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354084",
    "user": "https://github.com/dcoudert"
}
```

I have chosen not to create a new method in `graph_plot.py` as the need for bipartite embedding is rather limited so far. I use 2 calls to `_line_embedding` instead.

I have corrected the method for `_line_embedding` to avoid errors with graphs on 0 or 1 vertex.



---

archive/issue_comments_354085.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-31T19:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354085",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354086.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-31T20:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354086",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354087.json:
```json
{
    "body": "I removed a trailing whitespace and fixed a doctest that was broken by the change to graph name inside `CompleteBipartiteGraph`. Feel free to set to positive_review after you see this.",
    "created_at": "2018-07-31T20:58:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354087",
    "user": "https://github.com/bryangingechen"
}
```

I removed a trailing whitespace and fixed a doctest that was broken by the change to graph name inside `CompleteBipartiteGraph`. Feel free to set to positive_review after you see this.



---

archive/issue_comments_354088.json:
```json
{
    "body": "So then. Thanks.",
    "created_at": "2018-07-31T21:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354088",
    "user": "https://github.com/dcoudert"
}
```

So then. Thanks.



---

archive/issue_comments_354089.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-31T21:14:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354089",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_063797.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-05T08:18:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25166#event-63797"
}
```



---

archive/issue_comments_354090.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-05T08:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25166",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25166#issuecomment-354090",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
