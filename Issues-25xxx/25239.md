# Issue 25239: QQbar points of subschemes not valid

archive/issues_025002.json:
```json
{
    "body": "Keywords: SI2019\n\nThere seems to be a numerical issues with QQbar elements for _check_satisfies_equations in subschemes. I can't seem to get a direct reproduction, but the issue appears in \n\n```\nsage: P.<x,y> = ProjectiveSpace(QQ, 1)\nsage: f = DynamicalSystem([16*x^2 - 21*y^2, 16*y^2])\nsage: f.automorphism_group()\n```\nShould be just the identity conjugation.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25239\n\n",
    "closed_at": "2019-07-09T19:14:06Z",
    "created_at": "2018-04-24T13:41:23Z",
    "labels": [
        "component: number fields",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "QQbar points of subschemes not valid",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25239",
    "user": "https://github.com/bhutz"
}
```
Keywords: SI2019

There seems to be a numerical issues with QQbar elements for _check_satisfies_equations in subschemes. I can't seem to get a direct reproduction, but the issue appears in 

```
sage: P.<x,y> = ProjectiveSpace(QQ, 1)
sage: f = DynamicalSystem([16*x^2 - 21*y^2, 16*y^2])
sage: f.automorphism_group()
```
Should be just the identity conjugation.

Issue created by migration from https://trac.sagemath.org/ticket/25239





---

archive/issue_comments_351432.json:
```json
{
    "body": "I'm not totally sure what the right fix is here. It seems that 'touching' the elements causes the numerical issues to go away. The branch has this particular kind of 'fix'. It would be nice to have a better fix for this...",
    "created_at": "2018-04-24T13:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351432",
    "user": "https://github.com/bhutz"
}
```

I'm not totally sure what the right fix is here. It seems that 'touching' the elements causes the numerical issues to go away. The branch has this particular kind of 'fix'. It would be nice to have a better fix for this...



---

archive/issue_comments_351433.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-04-24T13:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351433",
    "user": "https://github.com/bhutz"
}
```

New commits:



---

archive/issue_comments_351434.json:
```json
{
    "body": "I'm not able to reproduce the behaviour on 8.2rc4.",
    "created_at": "2018-04-25T16:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351434",
    "user": "https://github.com/nbruin"
}
```

I'm not able to reproduce the behaviour on 8.2rc4.



---

archive/issue_comments_351435.json:
```json
{
    "body": "that would be excellent! I'm running 8.2rc1, so I'll update again and get post again.",
    "created_at": "2018-04-25T16:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351435",
    "user": "https://github.com/bhutz"
}
```

that would be excellent! I'm running 8.2rc1, so I'll update again and get post again.



---

archive/issue_comments_351436.json:
```json
{
    "body": "hmm...the original issue definitely appears to be fixed. However, the example I boiled it down to on the sage-devel ticket still does not work, but gives a different error now.\n\nThis was fails for enumeration, but it shouldn't be enumerating on a dimension 0 subscheme\n\n```\nP.<x,y,z,w>=ProjectiveSpace(QQ,3)\nX=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])\nX.change_ring(QQbar).rational_points()\n```\n\nThis now also works.\n\n```\nP.<x,y,z,w>=ProjectiveSpace(QQbar,3)\nX=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])\nX.rational_points()\n```\n\nSo this ticket requires some more work, but the original issue (and hence the branch) are now outdated.",
    "created_at": "2018-04-25T17:30:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351436",
    "user": "https://github.com/bhutz"
}
```

hmm...the original issue definitely appears to be fixed. However, the example I boiled it down to on the sage-devel ticket still does not work, but gives a different error now.

This was fails for enumeration, but it shouldn't be enumerating on a dimension 0 subscheme

```
P.<x,y,z,w>=ProjectiveSpace(QQ,3)
X=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])
X.change_ring(QQbar).rational_points()
```

This now also works.

```
P.<x,y,z,w>=ProjectiveSpace(QQbar,3)
X=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])
X.rational_points()
```

So this ticket requires some more work, but the original issue (and hence the branch) are now outdated.



---

archive/issue_comments_351437.json:
```json
{
    "body": "One more comment...it is still the same issue:\n\n```\nP.<x,y,z,w>=ProjectiveSpace(QQ,3)\nX=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])\nY=X.change_ring(QQbar)\nY(QQbar).points()\n```\n\nfails with\n\n```\nTypeError: Coordinates [-1, -1.821428571428572?, -4/7, 1] do not define a point on Closed subscheme of Projective Space of dimension 3 over Algebraic Field defined by:\n  (-7/4)*z - w,\n  x + (-7/4)*z,\n  (-3/4)*x + y + (-9/16)*z + 3/4*w\n```",
    "created_at": "2018-04-25T17:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351437",
    "user": "https://github.com/bhutz"
}
```

One more comment...it is still the same issue:

```
P.<x,y,z,w>=ProjectiveSpace(QQ,3)
X=P.subscheme([-7/4*z-w, x-7/4*z, -3/4*x+y-9/16*z+3/4*w])
Y=X.change_ring(QQbar)
Y(QQbar).points()
```

fails with

```
TypeError: Coordinates [-1, -1.821428571428572?, -4/7, 1] do not define a point on Closed subscheme of Projective Space of dimension 3 over Algebraic Field defined by:
  (-7/4)*z - w,
  x + (-7/4)*z,
  (-3/4)*x + y + (-9/16)*z + 3/4*w
```



---

archive/issue_events_063309.json:
```json
{
    "actor": "https://github.com/jasminecamero",
    "created_at": "2019-06-20T14:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25239#event-63309"
}
```



---

archive/issue_comments_351438.json:
```json
{
    "body": "The error is now fixed as of version [SageMath](SageMath) 8.8.rc0.",
    "created_at": "2019-06-20T14:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351438",
    "user": "https://github.com/jasminecamero"
}
```

The error is now fixed as of version [SageMath](SageMath) 8.8.rc0.



---

archive/issue_comments_351439.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-20T15:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351439",
    "user": "https://github.com/jasminecamero"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_351440.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-20T15:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351440",
    "user": "https://github.com/jasminecamero"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_063310.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-09T19:14:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25239#event-63310"
}
```



---

archive/issue_comments_351441.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2019-07-09T19:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351441",
    "user": "https://github.com/fchapoton"
}
```

Resolution: worksforme



---

archive/issue_comments_351442.json:
```json
{
    "body": "I am closing the ticket as required.\n\nNote that in this situation, one should rather check if the fixed issue is doctested somewhere, and if not, add a doctest. Please keep this in mind for the next time.",
    "created_at": "2019-07-09T19:14:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351442",
    "user": "https://github.com/fchapoton"
}
```

I am closing the ticket as required.

Note that in this situation, one should rather check if the fixed issue is doctested somewhere, and if not, add a doctest. Please keep this in mind for the next time.



---

archive/issue_comments_351443.json:
```json
{
    "body": "Changing keywords from \"\" to \"SI2019\".",
    "created_at": "2019-08-13T17:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25239#issuecomment-351443",
    "user": "https://github.com/bhutz"
}
```

Changing keywords from "" to "SI2019".
