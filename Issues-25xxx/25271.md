# Issue 25271: exact division sometimes fails in QQbar[x,y]

archive/issues_025034.json:
```json
{
    "assignees": [],
    "body": "The following example (cribbed from Sage's multivariate polynomial discriminant code and an algebraic curve test case) is an exact division (output suppressed for brevity):\n\n```\nsage: R.<x,y> = QQ[]\nsage: f = 3*x*(x-1)*y^4 -4*(x-1)*(x-2)*y^3 + (4/27)*(x-2)^4\nsage: ans = f.resultant(f.derivative(y), y) / (f.coefficient(y^4))\nsage: R(ans);\n```\n\nHowever, if we try the same thing over `QQbar`, it doesn't work:\n\n```\nsage: R.<x,y> = QQbar[]\nsage: f = 3*x*(x-1)*y^4 -4*(x-1)*(x-2)*y^3 + (4/27)*(x-2)^4\nsage: ans = f.resultant(f.derivative(y), y) / (f.coefficient(y^4))\nsage: R(ans);\nTypeError: unable to coerce since the denominator is not 1\n```\n\nIn both cases, `ans` comes back in a fraction field, though in the first example, it is a polynomial and be converted back to `R`.  In the second example, it is an (improper) rational function.\n\n`ans` doesn't involve `y`, and one way to \"fix\" this is to convert into `QQbar[x]` before performing the division:\n\n```\nsage: R.<x,y> = QQbar[]\nsage: f = 3*x*(x-1)*y^4 -4*(x-1)*(x-2)*y^3 + (4/27)*(x-2)^4\nsage: Rx = QQbar[x]\nsage: ans = Rx(f.resultant(f.derivative(y), y)) / Rx(f.coefficient(y^4))\nsage: R(Rx(ans));\n```\n\n`ans` still comes back in a fraction field, and has to be converted to `Rx` before it can be converted to `R`, but at least the univariate code recognizes it as an exact division, where the multivariate code seems not to.\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25271_\n\n",
    "created_at": "2018-05-01T05:22:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/component%3A%20commutative%20algebra",
        "https://github.com/sagemath/sage/labels/invalid",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "exact division sometimes fails in QQbar[x,y]",
    "type": "issue",
    "updated_at": "2023-01-07T01:41:10Z",
    "url": "https://github.com/sagemath/sage/issues/25271",
    "user": "https://github.com/BrentBaccala"
}
```
The following example (cribbed from Sage's multivariate polynomial discriminant code and an algebraic curve test case) is an exact division (output suppressed for brevity):

```
sage: R.<x,y> = QQ[]
sage: f = 3*x*(x-1)*y^4 -4*(x-1)*(x-2)*y^3 + (4/27)*(x-2)^4
sage: ans = f.resultant(f.derivative(y), y) / (f.coefficient(y^4))
sage: R(ans);
```

However, if we try the same thing over `QQbar`, it doesn't work:

```
sage: R.<x,y> = QQbar[]
sage: f = 3*x*(x-1)*y^4 -4*(x-1)*(x-2)*y^3 + (4/27)*(x-2)^4
sage: ans = f.resultant(f.derivative(y), y) / (f.coefficient(y^4))
sage: R(ans);
TypeError: unable to coerce since the denominator is not 1
```

In both cases, `ans` comes back in a fraction field, though in the first example, it is a polynomial and be converted back to `R`.  In the second example, it is an (improper) rational function.

`ans` doesn't involve `y`, and one way to "fix" this is to convert into `QQbar[x]` before performing the division:

```
sage: R.<x,y> = QQbar[]
sage: f = 3*x*(x-1)*y^4 -4*(x-1)*(x-2)*y^3 + (4/27)*(x-2)^4
sage: Rx = QQbar[x]
sage: ans = Rx(f.resultant(f.derivative(y), y)) / Rx(f.coefficient(y^4))
sage: R(Rx(ans));
```

`ans` still comes back in a fraction field, and has to be converted to `Rx` before it can be converted to `R`, but at least the univariate code recognizes it as an exact division, where the multivariate code seems not to.

_Issue created by migration from https://trac.sagemath.org/ticket/25271_





---

archive/issue_events_331669.json:
```json
{
    "actor": "https://github.com/BrentBaccala",
    "created_at": "2018-05-01T05:22:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25271#event-331669"
}
```



---

archive/issue_events_331670.json:
```json
{
    "actor": "https://github.com/BrentBaccala",
    "created_at": "2018-05-01T05:22:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20commutative%20algebra",
    "label_color": "0000ff",
    "label_name": "component: commutative algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25271#event-331670"
}
```



---

archive/issue_events_331671.json:
```json
{
    "actor": "https://github.com/BrentBaccala",
    "created_at": "2018-05-01T05:22:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25271#event-331671"
}
```



---

archive/issue_events_331672.json:
```json
{
    "actor": "https://github.com/BrentBaccala",
    "created_at": "2018-05-01T05:22:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25271#event-331672"
}
```



---

archive/issue_events_331673.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:41:45Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25271#event-331673"
}
```



---

archive/issue_events_331674.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T01:41:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25271#event-331674"
}
```



---

archive/issue_events_331675.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T01:41:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25271#event-331675"
}
```



---

archive/issue_comments_389185.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nWorks OK in 9.8.beta6",
    "created_at": "2023-01-07T01:41:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25271#issuecomment-389185",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
Works OK in 9.8.beta6



---

archive/issue_events_331676.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T01:41:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25271",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25271#event-331676"
}
```
