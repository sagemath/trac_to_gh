# Issue 25659: make BrauerAlgebra faster

archive/issues_025422.json:
```json
{
    "body": "Using the fast iterator from perfect matchings, we get a nice speedup for the Brauer algebra:\n\n```\nsage: %timeit len([SetPartition(p) for p in da.brauer_diagrams(6)])\n1 loop, best of 3: 6.69 s per loop\n```\n\n```\nsage: %timeit len([SetPartition(p) for p in da.brauer_diagrams(6)])\n1 loop, best of 3: 180 ms per loop\n```\n\nCC:  @alauve @tscrim @zabrocki\n\nBranch/Commit: [ef607379694c9394a7d4b90b95aadc6db3782830](https://github.com/sagemath/sagetrac-mirror/commit/ef607379694c9394a7d4b90b95aadc6db3782830)\n\nReviewer: Travis Scrimshaw, Martin Rubey\n\nAuthor: Martin Rubey, Travis Scrimshaw\n\nDependencies: #25462 #26111\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25659\n\n",
    "closed_at": "2018-09-02T09:37:01Z",
    "created_at": "2018-06-25T09:34:30Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "make BrauerAlgebra faster",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25659",
    "user": "https://github.com/mantepse"
}
```
Using the fast iterator from perfect matchings, we get a nice speedup for the Brauer algebra:

```
sage: %timeit len([SetPartition(p) for p in da.brauer_diagrams(6)])
1 loop, best of 3: 6.69 s per loop
```

```
sage: %timeit len([SetPartition(p) for p in da.brauer_diagrams(6)])
1 loop, best of 3: 180 ms per loop
```

CC:  @alauve @tscrim @zabrocki

Branch/Commit: [ef607379694c9394a7d4b90b95aadc6db3782830](https://github.com/sagemath/sagetrac-mirror/commit/ef607379694c9394a7d4b90b95aadc6db3782830)

Reviewer: Travis Scrimshaw, Martin Rubey

Author: Martin Rubey, Travis Scrimshaw

Dependencies: #25462 #26111

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25659





---

archive/issue_comments_493579.json:
```json
{
    "body": "Branch: [u/mantepse/make_braueralgebra_faster](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/make_braueralgebra_faster)",
    "created_at": "2018-06-25T11:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493579",
    "user": "https://github.com/mantepse"
}
```

Branch: [u/mantepse/make_braueralgebra_faster](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/make_braueralgebra_faster)



---

archive/issue_comments_493580.json:
```json
{
    "body": "Commit: [626ce17a078add5bbdcd639725d5485dd5366875](https://github.com/sagemath/sagetrac-mirror/commit/626ce17a078add5bbdcd639725d5485dd5366875)",
    "created_at": "2018-06-25T11:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493580",
    "user": "https://github.com/mantepse"
}
```

Commit: [626ce17a078add5bbdcd639725d5485dd5366875](https://github.com/sagemath/sagetrac-mirror/commit/626ce17a078add5bbdcd639725d5485dd5366875)



---

archive/issue_comments_493581.json:
```json
{
    "body": "Author: Martin Rubey",
    "created_at": "2018-06-25T11:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493581",
    "user": "https://github.com/mantepse"
}
```

Author: Martin Rubey



---

archive/issue_comments_493582.json:
```json
{
    "body": "<a id='comment:2'></a>\nLast 10 new commits:\n|                                                                                                                                          |                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|\n|[4ca5dfd](https://github.com/sagemath/sagetrac-mirror/commit/4ca5dfde0c7b3f6095d59a38af050a76beb7dfc3)|`revert a call to Set which works after #25496`|\n|[75a3043](https://github.com/sagemath/sagetrac-mirror/commit/75a30435cc07e7414e096e88c14c5af2934a4690)|`use the fast iterators and correct check`|\n|[a7be1ef](https://github.com/sagemath/sagetrac-mirror/commit/a7be1effe7a106c409958801c5d7875f353bf1e7)|`fix (and partially improve) tests in diagram algebras`|\n|[ce6e63c](https://github.com/sagemath/sagetrac-mirror/commit/ce6e63c5506a1e686310fc4fe2661bde4edac41e)|`remove unused imports`|\n|[589f135](https://github.com/sagemath/sagetrac-mirror/commit/589f13596c3ab0f51fdc8792e5c5b3555a19803b)|`adress reviewer's comments: new method number_of_blocks and deprecation of n, partition_diagrams now returns iterator`|\n|[ca293e3](https://github.com/sagemath/sagetrac-mirror/commit/ca293e395e482e3da3fe5e875b296eec4518cc8c)|`avoid itertools and modify docstring`|\n|[09bd542](https://github.com/sagemath/sagetrac-mirror/commit/09bd54239403ac40940557d607f8ad49aecef255)|`pyflakes fixes`|\n|[823769c](https://github.com/sagemath/sagetrac-mirror/commit/823769cb02435497113d13b0e3b22e3b9cd218bd)|`Revert \"pyflakes fixes\"`|\n|[1059d62](https://github.com/sagemath/sagetrac-mirror/commit/1059d621497b476837e2779adc7ae4aa875a3924)|`Merge branch 'u/mantepse/make_setpartition_much_faster' of git://trac.sagemath.org/sage into t/25659/make_braueralgebra_faster`|\n|[626ce17](https://github.com/sagemath/sagetrac-mirror/commit/626ce17a078add5bbdcd639725d5485dd5366875)|`use fast iterator from perfect matchings for Brauer diagrams`|",
    "created_at": "2018-06-25T11:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493582",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:2'></a>
Last 10 new commits:
|                                                                                                                                          |                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------|
|[4ca5dfd](https://github.com/sagemath/sagetrac-mirror/commit/4ca5dfde0c7b3f6095d59a38af050a76beb7dfc3)|`revert a call to Set which works after #25496`|
|[75a3043](https://github.com/sagemath/sagetrac-mirror/commit/75a30435cc07e7414e096e88c14c5af2934a4690)|`use the fast iterators and correct check`|
|[a7be1ef](https://github.com/sagemath/sagetrac-mirror/commit/a7be1effe7a106c409958801c5d7875f353bf1e7)|`fix (and partially improve) tests in diagram algebras`|
|[ce6e63c](https://github.com/sagemath/sagetrac-mirror/commit/ce6e63c5506a1e686310fc4fe2661bde4edac41e)|`remove unused imports`|
|[589f135](https://github.com/sagemath/sagetrac-mirror/commit/589f13596c3ab0f51fdc8792e5c5b3555a19803b)|`adress reviewer's comments: new method number_of_blocks and deprecation of n, partition_diagrams now returns iterator`|
|[ca293e3](https://github.com/sagemath/sagetrac-mirror/commit/ca293e395e482e3da3fe5e875b296eec4518cc8c)|`avoid itertools and modify docstring`|
|[09bd542](https://github.com/sagemath/sagetrac-mirror/commit/09bd54239403ac40940557d607f8ad49aecef255)|`pyflakes fixes`|
|[823769c](https://github.com/sagemath/sagetrac-mirror/commit/823769cb02435497113d13b0e3b22e3b9cd218bd)|`Revert "pyflakes fixes"`|
|[1059d62](https://github.com/sagemath/sagetrac-mirror/commit/1059d621497b476837e2779adc7ae4aa875a3924)|`Merge branch 'u/mantepse/make_setpartition_much_faster' of git://trac.sagemath.org/sage into t/25659/make_braueralgebra_faster`|
|[626ce17](https://github.com/sagemath/sagetrac-mirror/commit/626ce17a078add5bbdcd639725d5485dd5366875)|`use fast iterator from perfect matchings for Brauer diagrams`|



---

archive/issue_comments_493583.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-25T11:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493583",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_493584.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,11 @@\n+Using the fast iterator from perfect matchings, we get a nice speedup for the Brauer algebra:\n \n+```\n+sage: %timeit len([SetPartition(p) for p in da.brauer_diagrams(6)])\n+1 loop, best of 3: 6.69 s per loop\n+```\n+\n+```\n+sage: %timeit len([SetPartition(p) for p in da.brauer_diagrams(6)])\n+1 loop, best of 3: 180 ms per loop\n+```\n``````\n",
    "created_at": "2018-06-25T11:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493584",
    "user": "https://github.com/mantepse"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,11 @@
+Using the fast iterator from perfect matchings, we get a nice speedup for the Brauer algebra:
 
+```
+sage: %timeit len([SetPartition(p) for p in da.brauer_diagrams(6)])
+1 loop, best of 3: 6.69 s per loop
+```
+
+```
+sage: %timeit len([SetPartition(p) for p in da.brauer_diagrams(6)])
+1 loop, best of 3: 180 ms per loop
+```
``````




---

archive/issue_comments_493585.json:
```json
{
    "body": "Dependencies: #25462",
    "created_at": "2018-06-25T11:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493585",
    "user": "https://github.com/mantepse"
}
```

Dependencies: #25462



---

archive/issue_comments_493586.json:
```json
{
    "body": "<a id='comment:4'></a>\nQuick comments (I will comment on #25462 either later this week or next week since I am at FPSAC this week):\n\n- It seems like the `iter_aux` should be pulled out as a separate method (maybe even function?) of `PerfectMatchings` and called directly by the Brauer diagrams iterator (it makes no sense to create the temporary element object).\n\n- When checking going to the orbit basis, if you are not going to use `an_element` (which I still recommend using as it should not be machine dependent), then at least use a sum of 2 or more basis elements with at least one coefficient as that is a better test.\n\n- Bikeshedding again on the condensed output (as before, you can ignore, but I still will mention it):\n  {{{#!diff\n         sage: [SetPartition(p) for p in da.brauer_diagrams(5/2)]\n-        [{{-3, 3}, {-2, 1}, {-1, 2}}, {{-3, 3}, {-2, 2}, {-1, 1}}, {{-3, 3}, {-2, -1}, {1, 2}}]\n+        [{{-3, 3}, {-2, -1}, {1, 2}},\n+         {{-3, 3}, {-2, 2}, {-1, 1}},\n+         {{-3, 3}, {-2, 1}, {-1, 2}}]\n  }}}\n\nOtherwise LGTM (modulo #25462) and is quite a speedup. I do wonder if `_iterator_part` did not return `Set` objects, what the speed difference would be, but we can address that on a later ticket.",
    "created_at": "2018-07-17T12:06:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493586",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
Quick comments (I will comment on #25462 either later this week or next week since I am at FPSAC this week):

- It seems like the `iter_aux` should be pulled out as a separate method (maybe even function?) of `PerfectMatchings` and called directly by the Brauer diagrams iterator (it makes no sense to create the temporary element object).

- When checking going to the orbit basis, if you are not going to use `an_element` (which I still recommend using as it should not be machine dependent), then at least use a sum of 2 or more basis elements with at least one coefficient as that is a better test.

- Bikeshedding again on the condensed output (as before, you can ignore, but I still will mention it):
  {{{#!diff
         sage: [SetPartition(p) for p in da.brauer_diagrams(5/2)]
-        [{{-3, 3}, {-2, 1}, {-1, 2}}, {{-3, 3}, {-2, 2}, {-1, 1}}, {{-3, 3}, {-2, -1}, {1, 2}}]
+        [{{-3, 3}, {-2, -1}, {1, 2}},
+         {{-3, 3}, {-2, 2}, {-1, 1}},
+         {{-3, 3}, {-2, 1}, {-1, 2}}]
  }}}

Otherwise LGTM (modulo #25462) and is quite a speedup. I do wonder if `_iterator_part` did not return `Set` objects, what the speed difference would be, but we can address that on a later ticket.



---

archive/issue_comments_493587.json:
```json
{
    "body": "<a id='comment:5'></a>\n> - It seems like the `iter_aux` should be pulled out as a separate method (maybe even function?) of `PerfectMatchings` and called directly by the Brauer diagrams iterator (it makes no sense to create the temporary element object).\n\n\nas for #25462: please provide a name, so there is at least some uniformity across sage.  And again, since it is not unlikely that one does several computations in the same (Brauer) algebra, it might make more sense to use `.list()`, which caches the result.",
    "created_at": "2018-07-17T14:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493587",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:5'></a>
> - It seems like the `iter_aux` should be pulled out as a separate method (maybe even function?) of `PerfectMatchings` and called directly by the Brauer diagrams iterator (it makes no sense to create the temporary element object).


as for #25462: please provide a name, so there is at least some uniformity across sage.  And again, since it is not unlikely that one does several computations in the same (Brauer) algebra, it might make more sense to use `.list()`, which caches the result.



---

archive/issue_comments_493588.json:
```json
{
    "body": "<a id='comment:6'></a>\nI would probably call it `_iterator`, but its hidden. So as long as it locally makes sense, I think it is fine. Currently, we don't really have many such functions/methods, so there is not really a danger of non-uniformity.",
    "created_at": "2018-07-18T03:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493588",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>
I would probably call it `_iterator`, but its hidden. So as long as it locally makes sense, I think it is fine. Currently, we don't really have many such functions/methods, so there is not really a danger of non-uniformity.



---

archive/issue_comments_493589.json:
```json
{
    "body": "<a id='comment:7'></a>\nIf they are using the same Brauer algebra, you should cache the result of `basis()`. I don't see what the iterator returning the raw Python objects (i.e., not an instance of the `Element` class) has to do with caching via `.list()`.",
    "created_at": "2018-07-18T03:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493589",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
If they are using the same Brauer algebra, you should cache the result of `basis()`. I don't see what the iterator returning the raw Python objects (i.e., not an instance of the `Element` class) has to do with caching via `.list()`.



---

archive/issue_comments_493590.json:
```json
{
    "body": "Changing commit from \"[626ce17a078add5bbdcd639725d5485dd5366875](https://github.com/sagemath/sagetrac-mirror/commit/626ce17a078add5bbdcd639725d5485dd5366875)\" to \"[3d5f553675b18818631854380275c952cd20adba](https://github.com/sagemath/sagetrac-mirror/commit/3d5f553675b18818631854380275c952cd20adba)\"",
    "created_at": "2018-08-13T12:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493590",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[626ce17a078add5bbdcd639725d5485dd5366875](https://github.com/sagemath/sagetrac-mirror/commit/626ce17a078add5bbdcd639725d5485dd5366875)" to "[3d5f553675b18818631854380275c952cd20adba](https://github.com/sagemath/sagetrac-mirror/commit/3d5f553675b18818631854380275c952cd20adba)"



---

archive/issue_comments_493591.json:
```json
{
    "body": "<a id='comment:8'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[91e8d5c](https://github.com/sagemath/sagetrac-mirror/commit/91e8d5cdb67385f777ac11ece73682a8440bc0ba)|`Merge commit '9c5298d' into public/25462`|\n|[ce2962b](https://github.com/sagemath/sagetrac-mirror/commit/ce2962b001f088e28a2e568334c5d4daf58a5f32)|`restore richer doc tests`|\n|[ba08ff3](https://github.com/sagemath/sagetrac-mirror/commit/ba08ff35c1aec6cd454219653e2394fd256f396f)|`reviewer's comments`|\n|[95ce20f](https://github.com/sagemath/sagetrac-mirror/commit/95ce20f8b875cbb2cc8848b09120544a895612b5)|`provide iterators which return lists of lists`|\n|[d2e0e6e](https://github.com/sagemath/sagetrac-mirror/commit/d2e0e6e2114e3fa758ddd7a9295f03a5792421c3)|`inline a computation by reviewer's request`|\n|[947233c](https://github.com/sagemath/sagetrac-mirror/commit/947233c544347fd6938f69357ecdd0fd16df2878)|`Merge branch 'public/25462' of git://trac.sagemath.org/sage into public/combinat/speedup_set_partitions-25462`|\n|[a79e302](https://github.com/sagemath/sagetrac-mirror/commit/a79e30251c4757969d0b849ce47c4fc07fcc3456)|`Reverted to an_element() and added some additional reviewer changes.`|\n|[87bf535](https://github.com/sagemath/sagetrac-mirror/commit/87bf535461a19ba4d8730fe08e91c55bab042003)|`Cythonizing iterator.`|\n|[ba6a115](https://github.com/sagemath/sagetrac-mirror/commit/ba6a115f30e3b7db0b972c0ec2bf3f511457dad3)|`Fixing doctests due to ordering change.`|\n|[3d5f553](https://github.com/sagemath/sagetrac-mirror/commit/3d5f553675b18818631854380275c952cd20adba)|`Merge branch 'public/combinat/speedup_set_partitions-25462' of git://trac.sagemath.org/sage into t/25659/make_braueralgebra_faster`|",
    "created_at": "2018-08-13T12:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493591",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[91e8d5c](https://github.com/sagemath/sagetrac-mirror/commit/91e8d5cdb67385f777ac11ece73682a8440bc0ba)|`Merge commit '9c5298d' into public/25462`|
|[ce2962b](https://github.com/sagemath/sagetrac-mirror/commit/ce2962b001f088e28a2e568334c5d4daf58a5f32)|`restore richer doc tests`|
|[ba08ff3](https://github.com/sagemath/sagetrac-mirror/commit/ba08ff35c1aec6cd454219653e2394fd256f396f)|`reviewer's comments`|
|[95ce20f](https://github.com/sagemath/sagetrac-mirror/commit/95ce20f8b875cbb2cc8848b09120544a895612b5)|`provide iterators which return lists of lists`|
|[d2e0e6e](https://github.com/sagemath/sagetrac-mirror/commit/d2e0e6e2114e3fa758ddd7a9295f03a5792421c3)|`inline a computation by reviewer's request`|
|[947233c](https://github.com/sagemath/sagetrac-mirror/commit/947233c544347fd6938f69357ecdd0fd16df2878)|`Merge branch 'public/25462' of git://trac.sagemath.org/sage into public/combinat/speedup_set_partitions-25462`|
|[a79e302](https://github.com/sagemath/sagetrac-mirror/commit/a79e30251c4757969d0b849ce47c4fc07fcc3456)|`Reverted to an_element() and added some additional reviewer changes.`|
|[87bf535](https://github.com/sagemath/sagetrac-mirror/commit/87bf535461a19ba4d8730fe08e91c55bab042003)|`Cythonizing iterator.`|
|[ba6a115](https://github.com/sagemath/sagetrac-mirror/commit/ba6a115f30e3b7db0b972c0ec2bf3f511457dad3)|`Fixing doctests due to ordering change.`|
|[3d5f553](https://github.com/sagemath/sagetrac-mirror/commit/3d5f553675b18818631854380275c952cd20adba)|`Merge branch 'public/combinat/speedup_set_partitions-25462' of git://trac.sagemath.org/sage into t/25659/make_braueralgebra_faster`|



---

archive/issue_comments_493592.json:
```json
{
    "body": "<a id='comment:9'></a>\nI merged and rebased, ready for review! (after this ticket, I'll do #25662)",
    "created_at": "2018-08-13T12:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493592",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:9'></a>
I merged and rebased, ready for review! (after this ticket, I'll do #25662)



---

archive/issue_comments_493593.json:
```json
{
    "body": "<a id='comment:10'></a>\nYou should compare this against #25462. Another comparison should be done potentially replacing iteration over `SetPartitions(X)` with the dedicated iterator that does not create full elements of `SetPartitions(X)` (I probably should have done this swap on #25462...).\n\nFrom looking at the `PerfectMatchings.__iter__`, that looks like it could be make into a simple backtracking algorithm and be really ameable to cythonization as an iterator object (so a pure `cdef` implementation).",
    "created_at": "2018-08-13T12:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493593",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>
You should compare this against #25462. Another comparison should be done potentially replacing iteration over `SetPartitions(X)` with the dedicated iterator that does not create full elements of `SetPartitions(X)` (I probably should have done this swap on #25462...).

From looking at the `PerfectMatchings.__iter__`, that looks like it could be make into a simple backtracking algorithm and be really ameable to cythonization as an iterator object (so a pure `cdef` implementation).



---

archive/issue_comments_493594.json:
```json
{
    "body": "<a id='comment:11'></a>\nThe iterator for perfect matchings is almost certainly not best possible (given python's aversion against recursion).  Do you need a better one?  It might be good to compare a cythonized version with https://stackoverflow.com/a/13020502/4680581",
    "created_at": "2018-08-13T12:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493594",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:11'></a>
The iterator for perfect matchings is almost certainly not best possible (given python's aversion against recursion).  Do you need a better one?  It might be good to compare a cythonized version with https://stackoverflow.com/a/13020502/4680581



---

archive/issue_comments_493595.json:
```json
{
    "body": "<a id='comment:12'></a>\nI don't have a personal use for it, but I do like making things in Sage fast so it can (continue to) be the dominate software in combinatorics. So I tried the algorithm in that SO post, and it is basically the same time (both in Python). Those `pop` calls take up somewhere between 1/3 to 1/2 of the time.\n\nSo we come to a small crossroads. Do we implement it as a `SearchForest` and use the recursive-but-embarrassingly-parallelizable algorithm or do we make the current one in serial but fully cythonized?",
    "created_at": "2018-08-14T02:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493595",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>
I don't have a personal use for it, but I do like making things in Sage fast so it can (continue to) be the dominate software in combinatorics. So I tried the algorithm in that SO post, and it is basically the same time (both in Python). Those `pop` calls take up somewhere between 1/3 to 1/2 of the time.

So we come to a small crossroads. Do we implement it as a `SearchForest` and use the recursive-but-embarrassingly-parallelizable algorithm or do we make the current one in serial but fully cythonized?



---

archive/issue_comments_493596.json:
```json
{
    "body": "<a id='comment:13'></a>\nActually, probably the latter as for the former, that would only be useful if we wanted to do something on all such objects (and output order didn't matter).",
    "created_at": "2018-08-14T02:17:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493596",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
Actually, probably the latter as for the former, that would only be useful if we wanted to do something on all such objects (and output order didn't matter).



---

archive/issue_comments_493597.json:
```json
{
    "body": "Reviewer: Travis Scrimshaw, Martin Rubey",
    "created_at": "2018-08-14T04:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493597",
    "user": "https://github.com/tscrim"
}
```

Reviewer: Travis Scrimshaw, Martin Rubey



---

archive/issue_comments_493598.json:
```json
{
    "body": "Changing branch from \"[u/mantepse/make_braueralgebra_faster](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/make_braueralgebra_faster)\" to \"[public/combinat/speedup_brauer_algebra-25659](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/speedup_brauer_algebra-25659)\"",
    "created_at": "2018-08-14T04:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493598",
    "user": "https://github.com/tscrim"
}
```

Changing branch from "[u/mantepse/make_braueralgebra_faster](https://github.com/sagemath/sagetrac-mirror/tree/u/mantepse/make_braueralgebra_faster)" to "[public/combinat/speedup_brauer_algebra-25659](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/speedup_brauer_algebra-25659)"



---

archive/issue_comments_493599.json:
```json
{
    "body": "Changing author from \"Martin Rubey\" to \"Martin Rubey, Travis Scrimshaw\"",
    "created_at": "2018-08-14T04:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493599",
    "user": "https://github.com/tscrim"
}
```

Changing author from "Martin Rubey" to "Martin Rubey, Travis Scrimshaw"



---

archive/issue_comments_493600.json:
```json
{
    "body": "Changing commit from \"[3d5f553675b18818631854380275c952cd20adba](https://github.com/sagemath/sagetrac-mirror/commit/3d5f553675b18818631854380275c952cd20adba)\" to \"[c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1](https://github.com/sagemath/sagetrac-mirror/commit/c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1)\"",
    "created_at": "2018-08-14T04:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493600",
    "user": "https://github.com/tscrim"
}
```

Changing commit from "[3d5f553675b18818631854380275c952cd20adba](https://github.com/sagemath/sagetrac-mirror/commit/3d5f553675b18818631854380275c952cd20adba)" to "[c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1](https://github.com/sagemath/sagetrac-mirror/commit/c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1)"



---

archive/issue_comments_493601.json:
```json
{
    "body": "<a id='comment:14'></a>\nHere is where I am currently at:\n\n```\nsage: %time for x in PerfectMatchings(10): pass\nCPU times: user 4 ms, sys: 0 ns, total: 4 ms\nWall time: 964 \u00b5s\nsage: %time for x in PerfectMatchings(16): pass\nCPU times: user 796 ms, sys: 28 ms, total: 824 ms\nWall time: 794 ms\nsage: %time for x in PerfectMatchings(20): pass\nCPU times: user 3min 49s, sys: 8 ms, total: 3min 49s\nWall time: 3min 49s\n```\nversus with your branch:\n\n```\nsage: %time for x in PerfectMatchings(10): pass\nCPU times: user 8 ms, sys: 4 ms, total: 12 ms\nWall time: 7.14 ms\nsage: %time for x in PerfectMatchings(16): pass\nCPU times: user 14.4 s, sys: 0 ns, total: 14.4 s\nWall time: 14.4 s\n```\nThe timing for 20 would take far too long (extrapolating, somewhere between 30-90 minutes).\nI am pretty sure I can make this faster by better controlling what integers to look at.\n\nBTW:\n\n```\nsage: PerfectMatchings(20).cardinality()\n654729075\n```\n\n---\nNew commits:\n|                                                                                                                                          |                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|\n|[c7fdf9b](https://github.com/sagemath/sagetrac-mirror/commit/c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1)|`Initial Cython version of the PerfectMatchings iterator.`|",
    "created_at": "2018-08-14T04:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493601",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>
Here is where I am currently at:

```
sage: %time for x in PerfectMatchings(10): pass
CPU times: user 4 ms, sys: 0 ns, total: 4 ms
Wall time: 964 Âµs
sage: %time for x in PerfectMatchings(16): pass
CPU times: user 796 ms, sys: 28 ms, total: 824 ms
Wall time: 794 ms
sage: %time for x in PerfectMatchings(20): pass
CPU times: user 3min 49s, sys: 8 ms, total: 3min 49s
Wall time: 3min 49s
```
versus with your branch:

```
sage: %time for x in PerfectMatchings(10): pass
CPU times: user 8 ms, sys: 4 ms, total: 12 ms
Wall time: 7.14 ms
sage: %time for x in PerfectMatchings(16): pass
CPU times: user 14.4 s, sys: 0 ns, total: 14.4 s
Wall time: 14.4 s
```
The timing for 20 would take far too long (extrapolating, somewhere between 30-90 minutes).
I am pretty sure I can make this faster by better controlling what integers to look at.

BTW:

```
sage: PerfectMatchings(20).cardinality()
654729075
```

---
New commits:
|                                                                                                                                          |                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------|
|[c7fdf9b](https://github.com/sagemath/sagetrac-mirror/commit/c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1)|`Initial Cython version of the PerfectMatchings iterator.`|



---

archive/issue_comments_493602.json:
```json
{
    "body": "<a id='comment:15'></a>\nImpressive!  Is this (essentially) the same algorithm?\n\nI was thinking about calling all these iterators `iterator_raw` (or `raw_iterator`), with the specification that calling the parent on them \"works\".\n\nHowever, now they actually only work for the base set `0,1,...`, which makes even more sense, but doesn't fit this specification :-)",
    "created_at": "2018-08-14T06:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493602",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:15'></a>
Impressive!  Is this (essentially) the same algorithm?

I was thinking about calling all these iterators `iterator_raw` (or `raw_iterator`), with the specification that calling the parent on them "works".

However, now they actually only work for the base set `0,1,...`, which makes even more sense, but doesn't fit this specification :-)



---

archive/issue_comments_493603.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [mantepse](#comment%3A15):\n> Impressive!  Is this (essentially) the same algorithm?\n\n\nYes, although how I find the \"next\" available entry I can add is dumb (search through a list). What I want to do is make it more linked-list like so I can quickly add and remove entires. However, this requires me to be a little more smart about how I do things.\n\n> I was thinking about calling all these iterators `iterator_raw` (or `raw_iterator`), with the specification that calling the parent on them \"works\".\n> \n> However, now they actually only work for the base set `0,1,...`, which makes even more sense, but doesn't fit this specification :-)\n\n\nThis is purely something for speed. If you want to call the parent on them, well, that's why we have the parents. ;)",
    "created_at": "2018-08-14T06:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493603",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>
Replying to [mantepse](#comment%3A15):
> Impressive!  Is this (essentially) the same algorithm?


Yes, although how I find the "next" available entry I can add is dumb (search through a list). What I want to do is make it more linked-list like so I can quickly add and remove entires. However, this requires me to be a little more smart about how I do things.

> I was thinking about calling all these iterators `iterator_raw` (or `raw_iterator`), with the specification that calling the parent on them "works".
> 
> However, now they actually only work for the base set `0,1,...`, which makes even more sense, but doesn't fit this specification :-)


This is purely something for speed. If you want to call the parent on them, well, that's why we have the parents. ;)



---

archive/issue_comments_493604.json:
```json
{
    "body": "<a id='comment:17'></a>\nIt just occurred to me that the key word is \"fixed-point-free involution\" :-)\n\nAlgorithm 3 on page 23 of\n\nhttp://www.info2.uqam.ca/~walsh_t/papers/Involutions%20paper.pdf\n\nshould be yet faster...",
    "created_at": "2018-08-14T08:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493604",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:17'></a>
It just occurred to me that the key word is "fixed-point-free involution" :-)

Algorithm 3 on page 23 of

http://www.info2.uqam.ca/~walsh_t/papers/Involutions%20paper.pdf

should be yet faster...



---

archive/issue_comments_493605.json:
```json
{
    "body": "<a id='comment:18'></a>\nHere is a naive implementation of Walsh's algorithm.  Warning: `generate(n)` generates the matchings on `2n` points.  Could you please compare?  To avoid work, I did not switch the index set to `0,..,n-1`.\n\n```\ndef generate(n):\n    e = list(range(1,2*n+1))\n    f = [i+1 if i % 2 == 1 else i-1 for i in e]\n    odd = up = done = False\n\n    yield f[:]\n    while True:\n        i = e[0]\n        if i == n:\n            return\n        if odd:\n            x = 2*i-1\n            y = f[x-1]\n            g = y-2*i\n            up = (g % 2 == 1)\n        else:\n            x = i\n            y = f[x-1]\n            g = y - (i+1)\n            up = (g % 2 == 0)\n        if up:\n            g += 1\n            j = y+1\n        else:\n            g -= 1\n            j = y-1\n        J = f[j-1]\n        f[y-1],f[j-1],f[x-1],f[J-1] = J, x, j, y\n        odd = not odd\n        e[0] = 1\n        if g == 0 or g == 2*(n-i):\n            e[i-1], e[i+1-1] = e[i+1-1], i+1\n\n        yield f[:]\n```",
    "created_at": "2018-08-14T10:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493605",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:18'></a>
Here is a naive implementation of Walsh's algorithm.  Warning: `generate(n)` generates the matchings on `2n` points.  Could you please compare?  To avoid work, I did not switch the index set to `0,..,n-1`.

```
def generate(n):
    e = list(range(1,2*n+1))
    f = [i+1 if i % 2 == 1 else i-1 for i in e]
    odd = up = done = False

    yield f[:]
    while True:
        i = e[0]
        if i == n:
            return
        if odd:
            x = 2*i-1
            y = f[x-1]
            g = y-2*i
            up = (g % 2 == 1)
        else:
            x = i
            y = f[x-1]
            g = y - (i+1)
            up = (g % 2 == 0)
        if up:
            g += 1
            j = y+1
        else:
            g -= 1
            j = y-1
        J = f[j-1]
        f[y-1],f[j-1],f[x-1],f[J-1] = J, x, j, y
        odd = not odd
        e[0] = 1
        if g == 0 or g == 2*(n-i):
            e[i-1], e[i+1-1] = e[i+1-1], i+1

        yield f[:]
```



---

archive/issue_comments_493606.json:
```json
{
    "body": "<a id='comment:19'></a>\nHere is the same thing with indices adapted and some trivial optimizations.  I don't know enough cython to optimize that further.  The main question is probably how to adapt it to directly produce the perfect matchings in the data structure we want (whatever that is).\n\n```\ndef generate(int n):\n    cdef int i, x, y, g, j, J\n    e = list(range(2*n))\n    f = [i+1 if i % 2 == 0 else i-1 for i in e]\n    odd = False\n\n    yield f[:]\n    while True:\n\ti = e[0]\n\tif i == n-1:\n            return\n\tif odd:\n            x = 2*i\n\telse:\n            x = i\n\ty = f[x]\n\tg = y-x-1\n        if (g % 2 == odd):\n            g += 1\n            j = y+1\n        else:\n            g -= 1\n            j = y-1\n        J = f[j]\n        f[y] = J; f[J] = y; f[x] = j; f[j] = x;\n        odd = not odd\n        e[0] = 0\n        if g == 0 or g == 2*(n-i-1):\n            e[i] = e[i+1]; e[i+1] = i+1\n\n        yield f[:]\n```",
    "created_at": "2018-08-14T11:29:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493606",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:19'></a>
Here is the same thing with indices adapted and some trivial optimizations.  I don't know enough cython to optimize that further.  The main question is probably how to adapt it to directly produce the perfect matchings in the data structure we want (whatever that is).

```
def generate(int n):
    cdef int i, x, y, g, j, J
    e = list(range(2*n))
    f = [i+1 if i % 2 == 0 else i-1 for i in e]
    odd = False

    yield f[:]
    while True:
	i = e[0]
	if i == n-1:
            return
	if odd:
            x = 2*i
	else:
            x = i
	y = f[x]
	g = y-x-1
        if (g % 2 == odd):
            g += 1
            j = y+1
        else:
            g -= 1
            j = y-1
        J = f[j]
        f[y] = J; f[J] = y; f[x] = j; f[j] = x;
        odd = not odd
        e[0] = 0
        if g == 0 or g == 2*(n-i-1):
            e[i] = e[i+1]; e[i+1] = i+1

        yield f[:]
```



---

archive/issue_comments_493607.json:
```json
{
    "body": "<a id='comment:20'></a>\nOK, I just checked: it should be fairly easy to produce restricted growth functions instead, which is nice, because then we use them consistently.",
    "created_at": "2018-08-14T15:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493607",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:20'></a>
OK, I just checked: it should be fairly easy to produce restricted growth functions instead, which is nice, because then we use them consistently.



---

archive/issue_comments_493608.json:
```json
{
    "body": "<a id='comment:21'></a>\nFirst, bad news is my iterator had a bug, so the timings of[comment:14](#comment%3A14) are invalid. The good news it was easy to fix. Now I took your algorithm and added a simple conversion function. Now from testing, both algorithms are comparable in speed with the optimizations I have currently added. I am going to do some more work before pushing to see what I can do to optimize both.",
    "created_at": "2018-08-15T02:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493608",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
First, bad news is my iterator had a bug, so the timings of[comment:14](#comment%3A14) are invalid. The good news it was easy to fix. Now I took your algorithm and added a simple conversion function. Now from testing, both algorithms are comparable in speed with the optimizations I have currently added. I am going to do some more work before pushing to see what I can do to optimize both.



---

archive/issue_comments_493609.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|\n|[dd4441a](https://github.com/sagemath/sagetrac-mirror/commit/dd4441aaaa326942d724fe527605f5e496c1ced5)|`Added fixed point free involution generator and convert to SP. Fixing bug in PerfectMatchingsIterator.`|\n|[034589d](https://github.com/sagemath/sagetrac-mirror/commit/034589d06a1e2add2842a6f429bee940d3578d52)|`Optimizing generation using fixed-point-free involutions.`|\n|[7942eab](https://github.com/sagemath/sagetrac-mirror/commit/7942eab8a8188c8849fd1395b4ac1e33030edbfe)|`Using FPF involution iterator and skipping sorting.`|",
    "created_at": "2018-08-15T02:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493609",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------|
|[dd4441a](https://github.com/sagemath/sagetrac-mirror/commit/dd4441aaaa326942d724fe527605f5e496c1ced5)|`Added fixed point free involution generator and convert to SP. Fixing bug in PerfectMatchingsIterator.`|
|[034589d](https://github.com/sagemath/sagetrac-mirror/commit/034589d06a1e2add2842a6f429bee940d3578d52)|`Optimizing generation using fixed-point-free involutions.`|
|[7942eab](https://github.com/sagemath/sagetrac-mirror/commit/7942eab8a8188c8849fd1395b4ac1e33030edbfe)|`Using FPF involution iterator and skipping sorting.`|



---

archive/issue_comments_493610.json:
```json
{
    "body": "Changing commit from \"[c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1](https://github.com/sagemath/sagetrac-mirror/commit/c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1)\" to \"[7942eab8a8188c8849fd1395b4ac1e33030edbfe](https://github.com/sagemath/sagetrac-mirror/commit/7942eab8a8188c8849fd1395b4ac1e33030edbfe)\"",
    "created_at": "2018-08-15T02:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493610",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1](https://github.com/sagemath/sagetrac-mirror/commit/c7fdf9be32fee30ef3fb3698fcafeaf5455dd5e1)" to "[7942eab8a8188c8849fd1395b4ac1e33030edbfe](https://github.com/sagemath/sagetrac-mirror/commit/7942eab8a8188c8849fd1395b4ac1e33030edbfe)"



---

archive/issue_comments_493611.json:
```json
{
    "body": "<a id='comment:23'></a>\nSo I opted to use the fixed-point-free involution generator as I could guarantee that the result of converting to a set partition is ordered (by minimal element). Since I was getting comparable timings (most of which was actually coming from the creation of the actual elements), I figured this would give us the most speed. It also seemed easier to maintain in the long run (less low-level tricks). Here are my timings:\n\n```\nsage: %time for x in PerfectMatchings(10): pass\nCPU times: user 4 ms, sys: 0 ns, total: 4 ms\nWall time: 5.84 ms\nsage: %time for x in PerfectMatchings(12): pass\nCPU times: user 60 ms, sys: 8 ms, total: 68 ms\nWall time: 52.7 ms\nsage: %time for x in PerfectMatchings(14): pass\nCPU times: user 604 ms, sys: 32 ms, total: 636 ms\nWall time: 574 ms\nsage: %time for x in PerfectMatchings(16): pass\nCPU times: user 8.86 s, sys: 76 ms, total: 8.94 s\nWall time: 8.79 s\nsage: %time for x in PerfectMatchings(18): pass\nCPU times: user 2min 39s, sys: 32 ms, total: 2min 39s\nWall time: 2min 39s\nsage: PerfectMatchings(18).cardinality()\n34459425\n```",
    "created_at": "2018-08-15T03:00:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493611",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>
So I opted to use the fixed-point-free involution generator as I could guarantee that the result of converting to a set partition is ordered (by minimal element). Since I was getting comparable timings (most of which was actually coming from the creation of the actual elements), I figured this would give us the most speed. It also seemed easier to maintain in the long run (less low-level tricks). Here are my timings:

```
sage: %time for x in PerfectMatchings(10): pass
CPU times: user 4 ms, sys: 0 ns, total: 4 ms
Wall time: 5.84 ms
sage: %time for x in PerfectMatchings(12): pass
CPU times: user 60 ms, sys: 8 ms, total: 68 ms
Wall time: 52.7 ms
sage: %time for x in PerfectMatchings(14): pass
CPU times: user 604 ms, sys: 32 ms, total: 636 ms
Wall time: 574 ms
sage: %time for x in PerfectMatchings(16): pass
CPU times: user 8.86 s, sys: 76 ms, total: 8.94 s
Wall time: 8.79 s
sage: %time for x in PerfectMatchings(18): pass
CPU times: user 2min 39s, sys: 32 ms, total: 2min 39s
Wall time: 2min 39s
sage: PerfectMatchings(18).cardinality()
34459425
```



---

archive/issue_comments_493612.json:
```json
{
    "body": "<a id='comment:24'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[88595ed](https://github.com/sagemath/sagetrac-mirror/commit/88595ed97d4195dee784012d7a4994669c8c52a8)|`Use the new backend iterators in diagram_algebras.py.`|",
    "created_at": "2018-08-15T03:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493612",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[88595ed](https://github.com/sagemath/sagetrac-mirror/commit/88595ed97d4195dee784012d7a4994669c8c52a8)|`Use the new backend iterators in diagram_algebras.py.`|



---

archive/issue_comments_493613.json:
```json
{
    "body": "Changing commit from \"[7942eab8a8188c8849fd1395b4ac1e33030edbfe](https://github.com/sagemath/sagetrac-mirror/commit/7942eab8a8188c8849fd1395b4ac1e33030edbfe)\" to \"[88595ed97d4195dee784012d7a4994669c8c52a8](https://github.com/sagemath/sagetrac-mirror/commit/88595ed97d4195dee784012d7a4994669c8c52a8)\"",
    "created_at": "2018-08-15T03:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493613",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[7942eab8a8188c8849fd1395b4ac1e33030edbfe](https://github.com/sagemath/sagetrac-mirror/commit/7942eab8a8188c8849fd1395b4ac1e33030edbfe)" to "[88595ed97d4195dee784012d7a4994669c8c52a8](https://github.com/sagemath/sagetrac-mirror/commit/88595ed97d4195dee784012d7a4994669c8c52a8)"



---

archive/issue_comments_493614.json:
```json
{
    "body": "Changing commit from \"[88595ed97d4195dee784012d7a4994669c8c52a8](https://github.com/sagemath/sagetrac-mirror/commit/88595ed97d4195dee784012d7a4994669c8c52a8)\" to \"[80b13f475002464b629e1e000ddd0e0e8c234970](https://github.com/sagemath/sagetrac-mirror/commit/80b13f475002464b629e1e000ddd0e0e8c234970)\"",
    "created_at": "2018-08-15T03:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493614",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[88595ed97d4195dee784012d7a4994669c8c52a8](https://github.com/sagemath/sagetrac-mirror/commit/88595ed97d4195dee784012d7a4994669c8c52a8)" to "[80b13f475002464b629e1e000ddd0e0e8c234970](https://github.com/sagemath/sagetrac-mirror/commit/80b13f475002464b629e1e000ddd0e0e8c234970)"



---

archive/issue_comments_493615.json:
```json
{
    "body": "<a id='comment:25'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[80b13f4](https://github.com/sagemath/sagetrac-mirror/commit/80b13f475002464b629e1e000ddd0e0e8c234970)|`Use the new backend iterators in diagram_algebras.py.`|",
    "created_at": "2018-08-15T03:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493615",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[80b13f4](https://github.com/sagemath/sagetrac-mirror/commit/80b13f475002464b629e1e000ddd0e0e8c234970)|`Use the new backend iterators in diagram_algebras.py.`|



---

archive/issue_comments_493616.json:
```json
{
    "body": "<a id='comment:26'></a>\nI am now using the backend iterators for all of the diagram algebras. So with this, if my changes are good, then positive review.",
    "created_at": "2018-08-15T03:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493616",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>
I am now using the backend iterators for all of the diagram algebras. So with this, if my changes are good, then positive review.



---

archive/issue_events_073042.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-08-15T03:45:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25659#event-73042"
}
```



---

archive/issue_comments_493617.json:
```json
{
    "body": "<a id='comment:28'></a>\nGreat!\n\nI created #26065 - it would almost certainly be better to create restricted growth functions directly with Walsh's Gray code.  Just in case someone is bored :-) \n\nFrom your last two commits, it seems that the order of generation for the set partition iterator changed again - I don't care much, but it does seem strange.\n\nWalsh's paper has actually appeared, here is a citation:\n\n```\n@article {MR1821628,\n    AUTHOR = {Walsh, Timothy},\n     TITLE = {Gray codes for involutions},\n   JOURNAL = {J. Combin. Math. Combin. Comput.},\n  FJOURNAL = {Journal of Combinatorial Mathematics and Combinatorial\n              Computing},\n    VOLUME = {36},\n      YEAR = {2001},\n     PAGES = {95--118},\n      ISSN = {0835-3026},\n   MRCLASS = {05A05 (68R05)},\n  MRNUMBER = {1821628},\nMRREVIEWER = {Theodore C. Enns},\n}\n```",
    "created_at": "2018-08-15T04:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493617",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:28'></a>
Great!

I created #26065 - it would almost certainly be better to create restricted growth functions directly with Walsh's Gray code.  Just in case someone is bored :-) 

From your last two commits, it seems that the order of generation for the set partition iterator changed again - I don't care much, but it does seem strange.

Walsh's paper has actually appeared, here is a citation:

```
@article {MR1821628,
    AUTHOR = {Walsh, Timothy},
     TITLE = {Gray codes for involutions},
   JOURNAL = {J. Combin. Math. Combin. Comput.},
  FJOURNAL = {Journal of Combinatorial Mathematics and Combinatorial
              Computing},
    VOLUME = {36},
      YEAR = {2001},
     PAGES = {95--118},
      ISSN = {0835-3026},
   MRCLASS = {05A05 (68R05)},
  MRNUMBER = {1821628},
MRREVIEWER = {Theodore C. Enns},
}
```



---

archive/issue_comments_493618.json:
```json
{
    "body": "Changing commit from \"[80b13f475002464b629e1e000ddd0e0e8c234970](https://github.com/sagemath/sagetrac-mirror/commit/80b13f475002464b629e1e000ddd0e0e8c234970)\" to \"[b48610309c8963d03ec5e7c671a84bf6bf868993](https://github.com/sagemath/sagetrac-mirror/commit/b48610309c8963d03ec5e7c671a84bf6bf868993)\"",
    "created_at": "2018-08-15T06:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493618",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[80b13f475002464b629e1e000ddd0e0e8c234970](https://github.com/sagemath/sagetrac-mirror/commit/80b13f475002464b629e1e000ddd0e0e8c234970)" to "[b48610309c8963d03ec5e7c671a84bf6bf868993](https://github.com/sagemath/sagetrac-mirror/commit/b48610309c8963d03ec5e7c671a84bf6bf868993)"



---

archive/issue_comments_493619.json:
```json
{
    "body": "<a id='comment:29'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[b486103](https://github.com/sagemath/sagetrac-mirror/commit/b48610309c8963d03ec5e7c671a84bf6bf868993)|`add reference`|",
    "created_at": "2018-08-15T06:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493619",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[b486103](https://github.com/sagemath/sagetrac-mirror/commit/b48610309c8963d03ec5e7c671a84bf6bf868993)|`add reference`|



---

archive/issue_comments_493620.json:
```json
{
    "body": "<a id='comment:30'></a>\nI found that the different order comes from an additional `sorted` in `SetPartitions_set.__iter__`, so there is nothing to worry about.\n\nI added a reference, I'm happy with positive review.\n\n---\nNew commits:\n|                                                                                                                                          |               |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[b486103](https://github.com/sagemath/sagetrac-mirror/commit/b48610309c8963d03ec5e7c671a84bf6bf868993)|`add reference`|",
    "created_at": "2018-08-15T06:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493620",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:30'></a>
I found that the different order comes from an additional `sorted` in `SetPartitions_set.__iter__`, so there is nothing to worry about.

I added a reference, I'm happy with positive review.

---
New commits:
|                                                                                                                                          |               |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[b486103](https://github.com/sagemath/sagetrac-mirror/commit/b48610309c8963d03ec5e7c671a84bf6bf868993)|`add reference`|



---

archive/issue_comments_493621.json:
```json
{
    "body": "<a id='comment:31'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[77d6902](https://github.com/sagemath/sagetrac-mirror/commit/77d6902bdbc93e557354d4e9d07a77d4696fc446)|`Minor tweaks.`|",
    "created_at": "2018-08-15T06:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493621",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[77d6902](https://github.com/sagemath/sagetrac-mirror/commit/77d6902bdbc93e557354d4e9d07a77d4696fc446)|`Minor tweaks.`|



---

archive/issue_comments_493622.json:
```json
{
    "body": "Changing commit from \"[b48610309c8963d03ec5e7c671a84bf6bf868993](https://github.com/sagemath/sagetrac-mirror/commit/b48610309c8963d03ec5e7c671a84bf6bf868993)\" to \"[77d6902bdbc93e557354d4e9d07a77d4696fc446](https://github.com/sagemath/sagetrac-mirror/commit/77d6902bdbc93e557354d4e9d07a77d4696fc446)\"",
    "created_at": "2018-08-15T06:38:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493622",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[b48610309c8963d03ec5e7c671a84bf6bf868993](https://github.com/sagemath/sagetrac-mirror/commit/b48610309c8963d03ec5e7c671a84bf6bf868993)" to "[77d6902bdbc93e557354d4e9d07a77d4696fc446](https://github.com/sagemath/sagetrac-mirror/commit/77d6902bdbc93e557354d4e9d07a77d4696fc446)"



---

archive/issue_comments_493623.json:
```json
{
    "body": "<a id='comment:32'></a>\nThank you. I made a few small tweaks to the reference. If my tweaks are good with you, then positive review.",
    "created_at": "2018-08-15T06:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493623",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>
Thank you. I made a few small tweaks to the reference. If my tweaks are good with you, then positive review.



---

archive/issue_comments_493624.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-15T07:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493624",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_493625.json:
```json
{
    "body": "<a id='comment:34'></a>\nMerge conflict",
    "created_at": "2018-08-15T22:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493625",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:34'></a>
Merge conflict



---

archive/issue_comments_493626.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-15T22:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493626",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_493627.json:
```json
{
    "body": "<a id='comment:35'></a>\n`@`vbraun: dear Volker, I cannot see the merge conflict...",
    "created_at": "2018-08-16T07:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493627",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:35'></a>
`@`vbraun: dear Volker, I cannot see the merge conflict...



---

archive/issue_comments_493628.json:
```json
{
    "body": "<a id='comment:36'></a>\nIt will be with the (hopefully soon) forthcoming 8.4.beta2.",
    "created_at": "2018-08-16T07:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493628",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:36'></a>
It will be with the (hopefully soon) forthcoming 8.4.beta2.



---

archive/issue_comments_493629.json:
```json
{
    "body": "Changing commit from \"[77d6902bdbc93e557354d4e9d07a77d4696fc446](https://github.com/sagemath/sagetrac-mirror/commit/77d6902bdbc93e557354d4e9d07a77d4696fc446)\" to \"[25dabd7c587025b7daf31b93da1b4cd5999ca3aa](https://github.com/sagemath/sagetrac-mirror/commit/25dabd7c587025b7daf31b93da1b4cd5999ca3aa)\"",
    "created_at": "2018-08-25T21:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493629",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[77d6902bdbc93e557354d4e9d07a77d4696fc446](https://github.com/sagemath/sagetrac-mirror/commit/77d6902bdbc93e557354d4e9d07a77d4696fc446)" to "[25dabd7c587025b7daf31b93da1b4cd5999ca3aa](https://github.com/sagemath/sagetrac-mirror/commit/25dabd7c587025b7daf31b93da1b4cd5999ca3aa)"



---

archive/issue_comments_493630.json:
```json
{
    "body": "<a id='comment:37'></a>\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n|                                                                                                                                           |                                             |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|\n|[a17239b](https://github.com/sagemath/sagetrac-mirror/commit/a17239b054dbed216feba1b1b03b50f51df196eb)|`Using new iterator in the free Lie algebra.`|\n|[bbacc76](https://github.com/sagemath/sagetrac-mirror/commit/bbacc76e3cd1da57b7463069c49b4c1d38ae9f21)|`Added long test to lyndon_word.py.`|\n|[95d5d91](https://github.com/sagemath/sagetrac-mirror/commit/95d5d9190b1f149507d91839edbd1bdcefeb152f)|`Merge branch 'public/combinat/speedup_set_partitions-25462' of git://trac.sagemath.org/sage into public/combinat/fast_lyndon_iter-26111`|\n|[8cc9d0e](https://github.com/sagemath/sagetrac-mirror/commit/8cc9d0e9cda0a33477caf88a93be69d48bff600e)|`Using a Cython version of FKM algorithm to generate Lyndon words.`|\n|[7b25ddc](https://github.com/sagemath/sagetrac-mirror/commit/7b25ddc646833c95d3d92c0fec399e3df6a7370f)|`Using faster generator for LyndonWords and fixing doctest in free_lie_algebra.py.`|\n|[b9d8ee4](https://github.com/sagemath/sagetrac-mirror/commit/b9d8ee495e9425e34c56361b694899f6aad226da)|`Corner case, pyflakes, and some extra doctests.`|\n|[2b3f9d4](https://github.com/sagemath/sagetrac-mirror/commit/2b3f9d4ae0ef57562e87109ce08db3355dee1795)|`fix doc and rename iterator`|\n|[0b4c68b](https://github.com/sagemath/sagetrac-mirror/commit/0b4c68b2ba3c7e270ac8d4137c137695132fc588)|`A few more doc tweaks and making Ruskey a proper reference.`|\n|[9521ad1](https://github.com/sagemath/sagetrac-mirror/commit/9521ad1d0a8f8fa991b9e4d55ac53d2478a896e4)|`Merge branch 'public/combinat/speedup_brauer_algebra-25659' of git://trac.sagemath.org/sage into public/combinat/speedup_brauer_algebra-25659`|\n|[25dabd7](https://github.com/sagemath/sagetrac-mirror/commit/25dabd7c587025b7daf31b93da1b4cd5999ca3aa)|`A little doc tweak.`|",
    "created_at": "2018-08-25T21:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493630",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
|                                                                                                                                           |                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------|
|[a17239b](https://github.com/sagemath/sagetrac-mirror/commit/a17239b054dbed216feba1b1b03b50f51df196eb)|`Using new iterator in the free Lie algebra.`|
|[bbacc76](https://github.com/sagemath/sagetrac-mirror/commit/bbacc76e3cd1da57b7463069c49b4c1d38ae9f21)|`Added long test to lyndon_word.py.`|
|[95d5d91](https://github.com/sagemath/sagetrac-mirror/commit/95d5d9190b1f149507d91839edbd1bdcefeb152f)|`Merge branch 'public/combinat/speedup_set_partitions-25462' of git://trac.sagemath.org/sage into public/combinat/fast_lyndon_iter-26111`|
|[8cc9d0e](https://github.com/sagemath/sagetrac-mirror/commit/8cc9d0e9cda0a33477caf88a93be69d48bff600e)|`Using a Cython version of FKM algorithm to generate Lyndon words.`|
|[7b25ddc](https://github.com/sagemath/sagetrac-mirror/commit/7b25ddc646833c95d3d92c0fec399e3df6a7370f)|`Using faster generator for LyndonWords and fixing doctest in free_lie_algebra.py.`|
|[b9d8ee4](https://github.com/sagemath/sagetrac-mirror/commit/b9d8ee495e9425e34c56361b694899f6aad226da)|`Corner case, pyflakes, and some extra doctests.`|
|[2b3f9d4](https://github.com/sagemath/sagetrac-mirror/commit/2b3f9d4ae0ef57562e87109ce08db3355dee1795)|`fix doc and rename iterator`|
|[0b4c68b](https://github.com/sagemath/sagetrac-mirror/commit/0b4c68b2ba3c7e270ac8d4137c137695132fc588)|`A few more doc tweaks and making Ruskey a proper reference.`|
|[9521ad1](https://github.com/sagemath/sagetrac-mirror/commit/9521ad1d0a8f8fa991b9e4d55ac53d2478a896e4)|`Merge branch 'public/combinat/speedup_brauer_algebra-25659' of git://trac.sagemath.org/sage into public/combinat/speedup_brauer_algebra-25659`|
|[25dabd7](https://github.com/sagemath/sagetrac-mirror/commit/25dabd7c587025b7daf31b93da1b4cd5999ca3aa)|`A little doc tweak.`|



---

archive/issue_comments_493631.json:
```json
{
    "body": "<a id='comment:38'></a>\nHmm...I got a strange merge conflict when I rebased this over #26111. Well, still better to wait for 8.4.beta2.",
    "created_at": "2018-08-25T21:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493631",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>
Hmm...I got a strange merge conflict when I rebased this over #26111. Well, still better to wait for 8.4.beta2.



---

archive/issue_comments_493632.json:
```json
{
    "body": "Changing dependencies from \"#25462\" to \"#25462 #26111\"",
    "created_at": "2018-08-25T21:33:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493632",
    "user": "https://github.com/tscrim"
}
```

Changing dependencies from "#25462" to "#25462 #26111"



---

archive/issue_comments_493633.json:
```json
{
    "body": "Changing commit from \"[25dabd7c587025b7daf31b93da1b4cd5999ca3aa](https://github.com/sagemath/sagetrac-mirror/commit/25dabd7c587025b7daf31b93da1b4cd5999ca3aa)\" to \"[d4fccc7493bdd2f8969611282d08b4527dde5bd9](https://github.com/sagemath/sagetrac-mirror/commit/d4fccc7493bdd2f8969611282d08b4527dde5bd9)\"",
    "created_at": "2018-08-26T17:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493633",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[25dabd7c587025b7daf31b93da1b4cd5999ca3aa](https://github.com/sagemath/sagetrac-mirror/commit/25dabd7c587025b7daf31b93da1b4cd5999ca3aa)" to "[d4fccc7493bdd2f8969611282d08b4527dde5bd9](https://github.com/sagemath/sagetrac-mirror/commit/d4fccc7493bdd2f8969611282d08b4527dde5bd9)"



---

archive/issue_comments_493634.json:
```json
{
    "body": "<a id='comment:39'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                                                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------|\n|[d4fccc7](https://github.com/sagemath/sagetrac-mirror/commit/d4fccc7493bdd2f8969611282d08b4527dde5bd9)|`Merge branch 'develop' of git://trac.sagemath.org/sage into t/25659/public/combinat/speedup_brauer_algebra-25659`|",
    "created_at": "2018-08-26T17:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493634",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:39'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                                                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------|
|[d4fccc7](https://github.com/sagemath/sagetrac-mirror/commit/d4fccc7493bdd2f8969611282d08b4527dde5bd9)|`Merge branch 'develop' of git://trac.sagemath.org/sage into t/25659/public/combinat/speedup_brauer_algebra-25659`|



---

archive/issue_comments_493635.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-26T17:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493635",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_493636.json:
```json
{
    "body": "<a id='comment:40'></a>\nalmost trivial rebase",
    "created_at": "2018-08-26T17:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493636",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:40'></a>
almost trivial rebase



---

archive/issue_comments_493637.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-26T22:11:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493637",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_493638.json:
```json
{
    "body": "<a id='comment:42'></a>\nSee patchbot",
    "created_at": "2018-08-30T17:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493638",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:42'></a>
See patchbot



---

archive/issue_comments_493639.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-30T17:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493639",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_493640.json:
```json
{
    "body": "Changing commit from \"[d4fccc7493bdd2f8969611282d08b4527dde5bd9](https://github.com/sagemath/sagetrac-mirror/commit/d4fccc7493bdd2f8969611282d08b4527dde5bd9)\" to \"[ef607379694c9394a7d4b90b95aadc6db3782830](https://github.com/sagemath/sagetrac-mirror/commit/ef607379694c9394a7d4b90b95aadc6db3782830)\"",
    "created_at": "2018-08-30T22:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493640",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[d4fccc7493bdd2f8969611282d08b4527dde5bd9](https://github.com/sagemath/sagetrac-mirror/commit/d4fccc7493bdd2f8969611282d08b4527dde5bd9)" to "[ef607379694c9394a7d4b90b95aadc6db3782830](https://github.com/sagemath/sagetrac-mirror/commit/ef607379694c9394a7d4b90b95aadc6db3782830)"



---

archive/issue_comments_493641.json:
```json
{
    "body": "<a id='comment:43'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[ef60737](https://github.com/sagemath/sagetrac-mirror/commit/ef607379694c9394a7d4b90b95aadc6db3782830)|`Fixing doctests due to output order.`|",
    "created_at": "2018-08-30T22:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493641",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[ef60737](https://github.com/sagemath/sagetrac-mirror/commit/ef607379694c9394a7d4b90b95aadc6db3782830)|`Fixing doctests due to output order.`|



---

archive/issue_comments_493642.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-30T22:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493642",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_493643.json:
```json
{
    "body": "<a id='comment:44'></a>\nMartin, can you check that you are getting the doctest order I am (which matches the patchbot)?",
    "created_at": "2018-08-30T22:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493643",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:44'></a>
Martin, can you check that you are getting the doctest order I am (which matches the patchbot)?



---

archive/issue_comments_493644.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-31T05:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493644",
    "user": "https://github.com/mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_493645.json:
```json
{
    "body": "<a id='comment:45'></a>\nall tests pass here (on Ubuntu 16.04, Intel(R) Core(TM) i5-4570 CPU).  Thanks for fixing the tests and taking initiative!",
    "created_at": "2018-08-31T05:12:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493645",
    "user": "https://github.com/mantepse"
}
```

<a id='comment:45'></a>
all tests pass here (on Ubuntu 16.04, Intel(R) Core(TM) i5-4570 CPU).  Thanks for fixing the tests and taking initiative!



---

archive/issue_events_073043.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-02T09:37:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25659#event-73043"
}
```



---

archive/issue_comments_493646.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-02T09:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493646",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_493647.json:
```json
{
    "body": "Changing branch from \"[public/combinat/speedup_brauer_algebra-25659](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/speedup_brauer_algebra-25659)\" to \"[ef607379694c9394a7d4b90b95aadc6db3782830](https://github.com/sagemath/sagetrac-mirror/commit/ef607379694c9394a7d4b90b95aadc6db3782830)\"",
    "created_at": "2018-09-02T09:37:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25659#issuecomment-493647",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[public/combinat/speedup_brauer_algebra-25659](https://github.com/sagemath/sagetrac-mirror/tree/public/combinat/speedup_brauer_algebra-25659)" to "[ef607379694c9394a7d4b90b95aadc6db3782830](https://github.com/sagemath/sagetrac-mirror/commit/ef607379694c9394a7d4b90b95aadc6db3782830)"
