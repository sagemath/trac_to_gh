# Issue 25668: Run relocate-once.py with Sage's Python2 and with error checking

archive/issues_025431.json:
```json
{
    "body": "Running Sage for the first time after installing from binary under\nLinux or macOS leads to running `relocate-once.py`.\n\nBefore this ticket, when run by Python 3 (eg as installed by Anaconda),\nit would lead to the following error.\n\n```\n$ ./sage\nRecursionError: maximum recursion depth exceeded during compilation\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\n```\nwhich seems to come from Python3 choking on a very long line in\n`relocate-once.py`, because of the Python3 bug described as\n[Python issue 32758](https://bugs.python.org/issue32758).\n\nSee reports by Sage users at\n\n- https://ask.sagemath.org/question/42736/linux-binary-seems-to-be-source/\n- https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/\n- https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/\n\nReported in \"upstream\" binary-pkg at [binary-pkg issue 16](https://github.com/sagemath/binary-pkg/issues/16) -- see the fix there.\n\nAfter that fix, relocate-once.py can run with Python 3, and this ticket adds\nerror-checking after running relocate-once.py, with a meaningful error\nin case of failure.\n\nThe tentative solution at one point was to make `relocate-once.py` be run\nwith Sage's Python2, whence the now-inaccurate ticket summary.\n\n\n**CC:**  @fchapoton @embray @jhpalmieri @saraedum @slel @vbraun\n\n**Keywords:** Anaconda, RecursionError\n\n**Branch:** [abb2a89e1d211acc7d7d25c233707fe299f04f15](https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15)\n\n**Upstream:** Reported upstream. No feedback yet.\n\n**Reviewer:** Jeroen Demeyer, Volker Braun\n\n**Author:** John Palmieri\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25668\n\n",
    "closed_at": "2018-12-15T19:24:25Z",
    "created_at": "2018-06-26T21:10:37Z",
    "labels": [
        "component: distribution",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Run relocate-once.py with Sage's Python2 and with error checking",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25668",
    "user": "https://github.com/jhpalmieri"
}
```
Running Sage for the first time after installing from binary under
Linux or macOS leads to running `relocate-once.py`.

Before this ticket, when run by Python 3 (eg as installed by Anaconda),
it would lead to the following error.

```
$ ./sage
RecursionError: maximum recursion depth exceeded during compilation
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
```
which seems to come from Python3 choking on a very long line in
`relocate-once.py`, because of the Python3 bug described as
[Python issue 32758](https://bugs.python.org/issue32758).

See reports by Sage users at

- https://ask.sagemath.org/question/42736/linux-binary-seems-to-be-source/
- https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/
- https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/

Reported in "upstream" binary-pkg at [binary-pkg issue 16](https://github.com/sagemath/binary-pkg/issues/16) -- see the fix there.

After that fix, relocate-once.py can run with Python 3, and this ticket adds
error-checking after running relocate-once.py, with a meaningful error
in case of failure.

The tentative solution at one point was to make `relocate-once.py` be run
with Sage's Python2, whence the now-inaccurate ticket summary.


**CC:**  @fchapoton @embray @jhpalmieri @saraedum @slel @vbraun

**Keywords:** Anaconda, RecursionError

**Branch:** [abb2a89e1d211acc7d7d25c233707fe299f04f15](https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15)

**Upstream:** Reported upstream. No feedback yet.

**Reviewer:** Jeroen Demeyer, Volker Braun

**Author:** John Palmieri

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/25668





---

archive/issue_comments_493880.json:
```json
{
    "body": "<a id='comment:1'></a>\nAccording to \"j.c.\" on ask.sagemath.org, the solution to installing a binary with Ananconda installed is:\n\n```\nOn the off-chance you're using Anaconda, try commenting out the export \nPATH=\"/anaconda/bin:$PATH\" line in the .bash_profile file (and restarting \nyour terminal) before you run Sage for the first time.\n\nYou can uncomment it again after sage successfully runs (until you have \nto rebuild or upgrade Sage).\n```",
    "created_at": "2018-06-26T21:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493880",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:1'></a>
According to "j.c." on ask.sagemath.org, the solution to installing a binary with Ananconda installed is:

```
On the off-chance you're using Anaconda, try commenting out the export 
PATH="/anaconda/bin:$PATH" line in the .bash_profile file (and restarting 
your terminal) before you run Sage for the first time.

You can uncomment it again after sage successfully runs (until you have 
to rebuild or upgrade Sage).
```



---

archive/issue_events_073058.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25668#event-73058"
}
```



---

archive/issue_comments_493881.json:
```json
{
    "body": "<a id='comment:2'></a>\nthis probably deserves the \"critical\" status, given the number of people trapped by the error message..",
    "created_at": "2018-07-11T11:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493881",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>
this probably deserves the "critical" status, given the number of people trapped by the error message..



---

archive/issue_comments_493882.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"Anaconda, RecursionError\".",
    "created_at": "2018-07-11T11:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493882",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "" to "Anaconda, RecursionError".



---

archive/issue_comments_493883.json:
```json
{
    "body": "**Branch:** [u/slelievre/binary_releases__give_better_error_message_if_anaconda_is_present](https://github.com/sagemath/sagetrac-mirror/tree/u/slelievre/binary_releases__give_better_error_message_if_anaconda_is_present)",
    "created_at": "2018-07-11T11:49:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493883",
    "user": "https://github.com/slel"
}
```

**Branch:** [u/slelievre/binary_releases__give_better_error_message_if_anaconda_is_present](https://github.com/sagemath/sagetrac-mirror/tree/u/slelievre/binary_releases__give_better_error_message_if_anaconda_is_present)



---

archive/issue_comments_493884.json:
```json
{
    "body": "**Commit:** [c374e9a35563ef5593f3e955281cecb646359a94](https://github.com/sagemath/sagetrac-mirror/commit/c374e9a35563ef5593f3e955281cecb646359a94)",
    "created_at": "2018-07-11T11:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493884",
    "user": "https://github.com/slel"
}
```

**Commit:** [c374e9a35563ef5593f3e955281cecb646359a94](https://github.com/sagemath/sagetrac-mirror/commit/c374e9a35563ef5593f3e955281cecb646359a94)



---

archive/issue_comments_493885.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-07-11T11:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493885",
    "user": "https://github.com/slel"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_493886.json:
```json
{
    "body": "<a id='comment:5'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c374e9a35563ef5593f3e955281cecb646359a94\">c374e9a</a></td><td><code>Improve error message when Sage fails to start with RecursionError</code></td></tr></table>\n",
    "created_at": "2018-07-11T11:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493886",
    "user": "https://github.com/slel"
}
```

<a id='comment:5'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c374e9a35563ef5593f3e955281cecb646359a94">c374e9a</a></td><td><code>Improve error message when Sage fails to start with RecursionError</code></td></tr></table>




---

archive/issue_comments_493887.json:
```json
{
    "body": "**Author:** Samuel Leli\u00e8vre",
    "created_at": "2018-07-11T11:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493887",
    "user": "https://github.com/slel"
}
```

**Author:** Samuel Lelièvre



---

archive/issue_comments_493888.json:
```json
{
    "body": "<a id='comment:6'></a>\nThis is catching all errors, not just a `RecursionError`, I think. Is it worth trying to catch just that one?",
    "created_at": "2018-07-11T21:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493888",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:6'></a>
This is catching all errors, not just a `RecursionError`, I think. Is it worth trying to catch just that one?



---

archive/issue_comments_493889.json:
```json
{
    "body": "<a id='comment:7'></a>\nAnd why does the if block `if [ ! -x \"$SAGE_LOCAL/bin/sage\" ]; then ...` run at all? This is bash, not Python, so how is anaconda interfering? What is causing the recursion error?",
    "created_at": "2018-07-11T21:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493889",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
And why does the if block `if [ ! -x "$SAGE_LOCAL/bin/sage" ]; then ...` run at all? This is bash, not Python, so how is anaconda interfering? What is causing the recursion error?



---

archive/issue_comments_493890.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [jhpalmieri](#comment%3A7):\n> And why does the if block `if [ ! -x \"$SAGE_LOCAL/bin/sage\" ]; then ...` run at all? This is bash, not Python, so how is anaconda interfering? What is causing the recursion error?\n\n\nExactly my thought too! The only reasonable explanation is that anaconda itself sets some `$SAGE_XXX` variables.",
    "created_at": "2018-07-11T21:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493890",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Replying to [jhpalmieri](#comment%3A7):
> And why does the if block `if [ ! -x "$SAGE_LOCAL/bin/sage" ]; then ...` run at all? This is bash, not Python, so how is anaconda interfering? What is causing the recursion error?


Exactly my thought too! The only reasonable explanation is that anaconda itself sets some `$SAGE_XXX` variables.



---

archive/issue_comments_493891.json:
```json
{
    "body": "<a id='comment:9'></a>\nFirst, I think we should catch an error if `relocate-once.py` does not run successfully, and in particular that's when the message about Anaconda should be printed. \n\nSecond, there are several problems in `relocate-once.py`:\n- Related to anaconda and/or Python 3: the `RecursionError` comes from the line starting\n\n```\np('local/lib/libflint-13.5.2.dylib').patch(1552, 1684)...\n```\n That line is 61957 characters long (!), and I wonder if its length is causing problems. Certainly if I delete just that line, I no longer get the `RecursionError`.\n- related to Python 3, if I delete the aforementioned line, I get\n\n```\nRewriting paths for your new installation directory\n===================================================\n\nThis might take a few minutes but only has to be done once.\n\nTraceback (most recent call last):\n  File \"/Users/jpalmier/Downloads/SageMath/relocate-once.py\", line 145, in <module>\n    p('build/make/Makefile-auto').substitute().save()\n  File \"/Users/jpalmier/Downloads/SageMath/relocate-once.py\", line 133, in __call__\n    filename = os.path.join(self.root_path, filename)\n  File \"/anaconda3/lib/python3.6/posixpath.py\", line 94, in join\n    genericpath._check_arg_types('join', a, *p)\n  File \"/anaconda3/lib/python3.6/genericpath.py\", line 151, in _check_arg_types\n    raise TypeError(\"Can't mix strings and bytes in path components\") from None\nTypeError: Can't mix strings and bytes in path components\n```",
    "created_at": "2018-07-11T21:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493891",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
First, I think we should catch an error if `relocate-once.py` does not run successfully, and in particular that's when the message about Anaconda should be printed. 

Second, there are several problems in `relocate-once.py`:
- Related to anaconda and/or Python 3: the `RecursionError` comes from the line starting

```
p('local/lib/libflint-13.5.2.dylib').patch(1552, 1684)...
```
 That line is 61957 characters long (!), and I wonder if its length is causing problems. Certainly if I delete just that line, I no longer get the `RecursionError`.
- related to Python 3, if I delete the aforementioned line, I get

```
Rewriting paths for your new installation directory
===================================================

This might take a few minutes but only has to be done once.

Traceback (most recent call last):
  File "/Users/jpalmier/Downloads/SageMath/relocate-once.py", line 145, in <module>
    p('build/make/Makefile-auto').substitute().save()
  File "/Users/jpalmier/Downloads/SageMath/relocate-once.py", line 133, in __call__
    filename = os.path.join(self.root_path, filename)
  File "/anaconda3/lib/python3.6/posixpath.py", line 94, in join
    genericpath._check_arg_types('join', a, *p)
  File "/anaconda3/lib/python3.6/genericpath.py", line 151, in _check_arg_types
    raise TypeError("Can't mix strings and bytes in path components") from None
TypeError: Can't mix strings and bytes in path components
```



---

archive/issue_comments_493892.json:
```json
{
    "body": "<a id='comment:10'></a>\nWe really need a test machine where this error occurs to see what the value of `$SAGE_LOCAL` is at that point.",
    "created_at": "2018-07-11T21:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493892",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>
We really need a test machine where this error occurs to see what the value of `$SAGE_LOCAL` is at that point.



---

archive/issue_comments_493893.json:
```json
{
    "body": "<a id='comment:11'></a>\nOK, so the problem is with `relocate-once.py`. That wasn't obvious at all so I guess the error handler there should be improved...",
    "created_at": "2018-07-11T21:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493893",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
OK, so the problem is with `relocate-once.py`. That wasn't obvious at all so I guess the error handler there should be improved...



---

archive/issue_comments_493894.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jdemeyer](#comment%3A11):\n> OK, so the problem is with `relocate-once.py`. That wasn't obvious at all so I guess the error handler there should be improved...\n\n\nYou mean, there should be an error handler there?",
    "created_at": "2018-07-11T22:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493894",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Replying to [jdemeyer](#comment%3A11):
> OK, so the problem is with `relocate-once.py`. That wasn't obvious at all so I guess the error handler there should be improved...


You mean, there should be an error handler there?



---

archive/issue_comments_493895.json:
```json
{
    "body": "<a id='comment:13'></a>\nBy the way, I have now installed Anaconda on OS X, and it's easy enough to add or remove the bad parts in my PATH to test things. Others should feel free to do the same.",
    "created_at": "2018-07-11T22:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493895",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
By the way, I have now installed Anaconda on OS X, and it's easy enough to add or remove the bad parts in my PATH to test things. Others should feel free to do the same.



---

archive/issue_comments_493896.json:
```json
{
    "body": "<a id='comment:14'></a>\nIs the problem just that the script is run with Python 3 instead of Python 2?",
    "created_at": "2018-07-11T22:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493896",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:14'></a>
Is the problem just that the script is run with Python 3 instead of Python 2?



---

archive/issue_comments_493897.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [jhpalmieri](#comment%3A12):\n> You mean, there should be an error handler there?\n\n\nI'm just wondering who is displaying the message `RecursionError: maximum recursion depth exceeded during compilation`? That's not how Python displays errors by default.",
    "created_at": "2018-07-11T22:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493897",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'></a>
Replying to [jhpalmieri](#comment%3A12):
> You mean, there should be an error handler there?


I'm just wondering who is displaying the message `RecursionError: maximum recursion depth exceeded during compilation`? That's not how Python displays errors by default.



---

archive/issue_comments_493898.json:
```json
{
    "body": "<a id='comment:16'></a>\nIf I run `relocate-once.py` using Sage's Python 3.6.6, I do not get the recursion error. (I get the string/bytes error, of course.) So maybe Anaconda's Python 3.6.5 is badly configured?",
    "created_at": "2018-07-11T22:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493898",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
If I run `relocate-once.py` using Sage's Python 3.6.6, I do not get the recursion error. (I get the string/bytes error, of course.) So maybe Anaconda's Python 3.6.5 is badly configured?



---

archive/issue_comments_493899.json:
```json
{
    "body": "<a id='comment:17'></a>\nFurther debugging: if I put some echo statements in the `sage` script before and after running `relocate-once.py`, they both execute. If I put a print statement in `relocate-once.py`, it doesn't print. I am really wondering if the long line makes anaconda's Python 3 barf before it even loads the file.",
    "created_at": "2018-07-11T22:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493899",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>
Further debugging: if I put some echo statements in the `sage` script before and after running `relocate-once.py`, they both execute. If I put a print statement in `relocate-once.py`, it doesn't print. I am really wondering if the long line makes anaconda's Python 3 barf before it even loads the file.



---

archive/issue_comments_493900.json:
```json
{
    "body": "<a id='comment:18'></a>\nIt looks something like the issue discussed in https://bugs.python.org/issue32758.",
    "created_at": "2018-07-11T22:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493900",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>
It looks something like the issue discussed in https://bugs.python.org/issue32758.



---

archive/issue_comments_493901.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [jdemeyer](#comment%3A15):\n> \n> I'm just wondering who is displaying the message\n> > \n> > ```\n> > RecursionError: maximum recursion depth exceeded during compilation}}}\n\n> That's not how Python displays errors by default.\n\nSearching the web for [ \"maximum recursion depth exceeded during compilation\" ]\nyields many results, including the following one not related to Sage:\n\n- https://www.reddit.com/r/learnpython/comments/3zusdy/eval_python_beginner/\n\nIt might indicate that the error has something to do with a call to `eval`(?).\n\nThis other result shows that the error can occur even just running `sage --version`:\n\n- https://github.com/Homebrew/homebrew-cask/issues/18279",
    "created_at": "2018-07-11T22:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493901",
    "user": "https://github.com/slel"
}
```

<a id='comment:19'></a>
Replying to [jdemeyer](#comment%3A15):
> 
> I'm just wondering who is displaying the message
> > 
> > ```
> > RecursionError: maximum recursion depth exceeded during compilation}}}

> That's not how Python displays errors by default.

Searching the web for [ "maximum recursion depth exceeded during compilation" ]
yields many results, including the following one not related to Sage:

- https://www.reddit.com/r/learnpython/comments/3zusdy/eval_python_beginner/

It might indicate that the error has something to do with a call to `eval`(?).

This other result shows that the error can occur even just running `sage --version`:

- https://github.com/Homebrew/homebrew-cask/issues/18279



---

archive/issue_comments_493902.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [slelievre](#comment%3A19):\n> It might indicate that the error has something to do with a call to `eval`(?).\n\n\nOr more generally, just the Python parser. All the evidence points to Python crashing while parsing the `.py` file, before it even executes anything. So it crashes with just the error message without a traceback.",
    "created_at": "2018-07-11T22:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493902",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>
Replying to [slelievre](#comment%3A19):
> It might indicate that the error has something to do with a call to `eval`(?).


Or more generally, just the Python parser. All the evidence points to Python crashing while parsing the `.py` file, before it even executes anything. So it crashes with just the error message without a traceback.



---

archive/issue_comments_493903.json:
```json
{
    "body": "<a id='comment:21'></a>\nOne obvious fix in Sage is to add error checking in the top-level `sage` script:\n\n```sh\n# If this is a freshly-unpacked binary tarball then run the installer\n# Note: relocate-once.py deletes itself upon successful completion\nif [ -x \"$SAGE_ROOT/relocate-once.py\" ]; then\n    \"$SAGE_ROOT/relocate-once.py\"\nfi\n```",
    "created_at": "2018-07-11T22:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493903",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
One obvious fix in Sage is to add error checking in the top-level `sage` script:

```sh
# If this is a freshly-unpacked binary tarball then run the installer
# Note: relocate-once.py deletes itself upon successful completion
if [ -x "$SAGE_ROOT/relocate-once.py" ]; then
    "$SAGE_ROOT/relocate-once.py"
fi
```



---

archive/issue_comments_493904.json:
```json
{
    "body": "<a id='comment:22'></a>\nIt's not the length of the line, it's the number of methods on the line. If I change `patch(1552, 1684)` (etc.) to `patch(1,1)` throughout, the line gets much shorter, but it still crashes. 1500 methods seems to be the limit.",
    "created_at": "2018-07-11T22:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493904",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
It's not the length of the line, it's the number of methods on the line. If I change `patch(1552, 1684)` (etc.) to `patch(1,1)` throughout, the line gets much shorter, but it still crashes. 1500 methods seems to be the limit.



---

archive/issue_comments_493905.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [jdemeyer](#comment%3A21):\n> One obvious fix in Sage is to add error checking in the top-level `sage` script:\n> \n> ```\n> #!sh\n> # If this is a freshly-unpacked binary tarball then run the installer\n> # Note: relocate-once.py deletes itself upon successful completion\n> if [ -x \"$SAGE_ROOT/relocate-once.py\" ]; then\n>     \"$SAGE_ROOT/relocate-once.py\"\n> fi\n> ```\n\n\nYes, exactly.",
    "created_at": "2018-07-11T22:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493905",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>
Replying to [jdemeyer](#comment%3A21):
> One obvious fix in Sage is to add error checking in the top-level `sage` script:
> 
> ```
> #!sh
> # If this is a freshly-unpacked binary tarball then run the installer
> # Note: relocate-once.py deletes itself upon successful completion
> if [ -x "$SAGE_ROOT/relocate-once.py" ]; then
>     "$SAGE_ROOT/relocate-once.py"
> fi
> ```


Yes, exactly.



---

archive/issue_comments_493906.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [jhpalmieri](#comment%3A16):\n> If I run `relocate-once.py` using Sage's Python 3.6.6, I do not get the recursion error. (I get the string/bytes error, of course.) So maybe Anaconda's Python 3.6.5 is badly configured?\n\n\nMaybe I was wrong about this: Sage's Python 3 is now giving this error on a similar file: `[1,2,3]` with `.sort()` appended 1500 times \u2013\u00a0not good Python, but enough methods to give Python 3 problems. Not Python 2, though.",
    "created_at": "2018-07-11T22:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493906",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:24'></a>
Replying to [jhpalmieri](#comment%3A16):
> If I run `relocate-once.py` using Sage's Python 3.6.6, I do not get the recursion error. (I get the string/bytes error, of course.) So maybe Anaconda's Python 3.6.5 is badly configured?


Maybe I was wrong about this: Sage's Python 3 is now giving this error on a similar file: `[1,2,3]` with `.sort()` appended 1500 times – not good Python, but enough methods to give Python 3 problems. Not Python 2, though.



---

archive/issue_comments_493907.json:
```json
{
    "body": "<a id='comment:25'></a>\nIn any case, down the line, we should also fix the Python 3 incompatibilities in `relocate-once.py`.",
    "created_at": "2018-07-11T22:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493907",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>
In any case, down the line, we should also fix the Python 3 incompatibilities in `relocate-once.py`.



---

archive/issue_comments_493908.json:
```json
{
    "body": "**Changing commit** from \"[c374e9a35563ef5593f3e955281cecb646359a94](https://github.com/sagemath/sagetrac-mirror/commit/c374e9a35563ef5593f3e955281cecb646359a94)\" to \"\".",
    "created_at": "2018-07-14T07:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493908",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[c374e9a35563ef5593f3e955281cecb646359a94](https://github.com/sagemath/sagetrac-mirror/commit/c374e9a35563ef5593f3e955281cecb646359a94)" to "".



---

archive/issue_comments_493909.json:
```json
{
    "body": "**Changing branch** from \"[u/slelievre/binary_releases__give_better_error_message_if_anaconda_is_present](https://github.com/sagemath/sagetrac-mirror/tree/u/slelievre/binary_releases__give_better_error_message_if_anaconda_is_present)\" to \"\".",
    "created_at": "2018-07-14T07:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493909",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/slelievre/binary_releases__give_better_error_message_if_anaconda_is_present](https://github.com/sagemath/sagetrac-mirror/tree/u/slelievre/binary_releases__give_better_error_message_if_anaconda_is_present)" to "".



---

archive/issue_comments_493910.json:
```json
{
    "body": "**Changing author** from \"Samuel Leli\u00e8vre\" to \"\".",
    "created_at": "2018-07-14T07:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493910",
    "user": "https://github.com/jdemeyer"
}
```

**Changing author** from "Samuel Lelièvre" to "".



---

archive/issue_comments_493911.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-07-14T07:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493911",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_493912.json:
```json
{
    "body": "<a id='comment:27'></a>\nShould we check whether we're running Python 3, whether executing `relocate-once.py` exits successfully, or both?",
    "created_at": "2018-07-14T14:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493912",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:27'></a>
Should we check whether we're running Python 3, whether executing `relocate-once.py` exits successfully, or both?



---

archive/issue_comments_493913.json:
```json
{
    "body": "<a id='comment:28'></a>\nDon't check whether you are doing the wrong thing, just do the right thing: `python2 relocate-once.py`.\n\nAnd yes, the exit status must be checked.",
    "created_at": "2018-07-14T19:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493913",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Don't check whether you are doing the wrong thing, just do the right thing: `python2 relocate-once.py`.

And yes, the exit status must be checked.



---

archive/issue_comments_493914.json:
```json
{
    "body": "<a id='comment:29'></a>\nOn my OS X machine:\n\n```\n$ which python2\n$ ls /usr/bin/pyth*\n/usr/bin/python           /usr/bin/python2.7        /usr/bin/pythonw\n/usr/bin/python-config    /usr/bin/python2.7-config /usr/bin/pythonw2.7\n```\nSo do we hard-code `python2.7`? Seems too fragile. Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky. `command -v python2 && python2 relocate-once.py`, etc.? What do you suggest?\n\nIt seems like right now, the best we can do is check the exit status and print a message. Maybe try to detect if Python 3 is the problem. I've also opened an issue for Python 3 compatibility at the `sagemath/binary-pkg` github page.",
    "created_at": "2018-07-14T20:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493914",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:29'></a>
On my OS X machine:

```
$ which python2
$ ls /usr/bin/pyth*
/usr/bin/python           /usr/bin/python2.7        /usr/bin/pythonw
/usr/bin/python-config    /usr/bin/python2.7-config /usr/bin/pythonw2.7
```
So do we hard-code `python2.7`? Seems too fragile. Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky. `command -v python2 && python2 relocate-once.py`, etc.? What do you suggest?

It seems like right now, the best we can do is check the exit status and print a message. Maybe try to detect if Python 3 is the problem. I've also opened an issue for Python 3 compatibility at the `sagemath/binary-pkg` github page.



---

archive/issue_comments_493915.json:
```json
{
    "body": "**Changing upstream** from \"N/A\" to \"Reported upstream. No feedback yet.\".",
    "created_at": "2018-07-14T20:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493915",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing upstream** from "N/A" to "Reported upstream. No feedback yet.".



---

archive/issue_comments_493916.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -19,3 +19,4 @@\n - https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/\n - https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/\n \n+Reported \"upstream\" at https://github.com/sagemath/binary-pkg/issues/16\n``````\n",
    "created_at": "2018-07-14T20:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493916",
    "user": "https://github.com/jhpalmieri"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -19,3 +19,4 @@
 - https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/
 - https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/
 
+Reported "upstream" at https://github.com/sagemath/binary-pkg/issues/16
``````




---

archive/issue_comments_493917.json:
```json
{
    "body": "<a id='comment:30'></a>\nHere is one suggestion:\n\n```diff\ndiff --git a/sage b/sage\nindex 64629eee30..81ab7e908e 100755\n--- a/sage\n+++ b/sage\n@@ -125,6 +125,28 @@ export SAGE_ROOT\n # Note: relocate-once.py deletes itself upon successful completion\n if [ -x \"$SAGE_ROOT/relocate-once.py\" ]; then\n     \"$SAGE_ROOT/relocate-once.py\"\n+    if [ $? -ne 0 ]; then\n+        PYVER=`python -c 'import sys; print(sys.version_info[0])'`\n+        if [ $PYVER = '3' ]; then\n+           echo >&2\n+           echo >&2 \"Error: Sage must run the script 'relocate-once.py' to complete\"\n+           echo >&2 \"this installation. The script is not compatible with Python 3,\"\n+           echo >&2 \"which is your system's version of Python. Please ensure that\"\n+           echo >&2 \"the command 'python' runs Python 2. This only needs to be done\"\n+           echo >&2 \"the first you run Sage.\"\n+           echo >&2\n+           echo >&2 \"If you have Anaconda installed, for example, it may have modified\"\n+           echo >&2 \"your PATH. Check your PATH by running the terminal command\"\n+           echo >&2 \"    echo \\$PATH\"\n+           echo >&2 \"If it starts with something containing '/anaconda3/bin', you need\"\n+           echo >&2 \"to remove this from your PATH the first time you run Sage. After\"\n+           echo >&2 \"Sage has run once, you may restore the original value of PATH.\"\n+           exit 1\n+        else\n+           echo >&2 \"Error running the script 'relocate-once.py'.\"\n+           exit 1\n+        fi\n+    fi\n fi\n \n # Run the actual Sage script\n```",
    "created_at": "2018-07-14T20:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493917",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>
Here is one suggestion:

```diff
diff --git a/sage b/sage
index 64629eee30..81ab7e908e 100755
--- a/sage
+++ b/sage
@@ -125,6 +125,28 @@ export SAGE_ROOT
 # Note: relocate-once.py deletes itself upon successful completion
 if [ -x "$SAGE_ROOT/relocate-once.py" ]; then
     "$SAGE_ROOT/relocate-once.py"
+    if [ $? -ne 0 ]; then
+        PYVER=`python -c 'import sys; print(sys.version_info[0])'`
+        if [ $PYVER = '3' ]; then
+           echo >&2
+           echo >&2 "Error: Sage must run the script 'relocate-once.py' to complete"
+           echo >&2 "this installation. The script is not compatible with Python 3,"
+           echo >&2 "which is your system's version of Python. Please ensure that"
+           echo >&2 "the command 'python' runs Python 2. This only needs to be done"
+           echo >&2 "the first you run Sage."
+           echo >&2
+           echo >&2 "If you have Anaconda installed, for example, it may have modified"
+           echo >&2 "your PATH. Check your PATH by running the terminal command"
+           echo >&2 "    echo \$PATH"
+           echo >&2 "If it starts with something containing '/anaconda3/bin', you need"
+           echo >&2 "to remove this from your PATH the first time you run Sage. After"
+           echo >&2 "Sage has run once, you may restore the original value of PATH."
+           exit 1
+        else
+           echo >&2 "Error running the script 'relocate-once.py'."
+           exit 1
+        fi
+    fi
 fi
 
 # Run the actual Sage script
```



---

archive/issue_comments_493918.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [jhpalmieri](#comment%3A29):\n> Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky.\n\n\nClunky but I think it's the best solution. I would probably skip the `python2.6` check though.\n\nDo we already know why things go wrong with Anaconda?",
    "created_at": "2018-07-15T08:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493918",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:31'></a>
Replying to [jhpalmieri](#comment%3A29):
> Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky.


Clunky but I think it's the best solution. I would probably skip the `python2.6` check though.

Do we already know why things go wrong with Anaconda?



---

archive/issue_comments_493919.json:
```json
{
    "body": "<a id='comment:32'></a>\nCouldn't `relocate-once.py` be run using the Python2 shipped by Sage?",
    "created_at": "2018-07-15T09:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493919",
    "user": "https://github.com/slel"
}
```

<a id='comment:32'></a>
Couldn't `relocate-once.py` be run using the Python2 shipped by Sage?



---

archive/issue_comments_493920.json:
```json
{
    "body": "**Branch:** [u/jhpalmieri/python2-relocate-once](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/python2-relocate-once)",
    "created_at": "2018-07-15T18:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493920",
    "user": "https://github.com/jhpalmieri"
}
```

**Branch:** [u/jhpalmieri/python2-relocate-once](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/python2-relocate-once)



---

archive/issue_comments_493921.json:
```json
{
    "body": "**Commit:** [478b430f1a304b2ff6cd5ed97d45692e140574c8](https://github.com/sagemath/sagetrac-mirror/commit/478b430f1a304b2ff6cd5ed97d45692e140574c8)",
    "created_at": "2018-07-15T18:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493921",
    "user": "https://github.com/jhpalmieri"
}
```

**Commit:** [478b430f1a304b2ff6cd5ed97d45692e140574c8](https://github.com/sagemath/sagetrac-mirror/commit/478b430f1a304b2ff6cd5ed97d45692e140574c8)



---

archive/issue_comments_493922.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-07-15T18:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493922",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_493923.json:
```json
{
    "body": "**Author:** John Palmieri",
    "created_at": "2018-07-15T18:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493923",
    "user": "https://github.com/jhpalmieri"
}
```

**Author:** John Palmieri



---

archive/issue_comments_493924.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [jdemeyer](#comment%3A31):\n> Replying to [jhpalmieri](#comment%3A29):\n> > Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky.\n\n> \n> Clunky but I think it's the best solution. I would probably skip the `python2.6` check though.\n> \n> Do we already know why things go wrong with Anaconda?\n\n\nIt seems to me that either Python 3 in general, or Anaconda's Python 3, doesn't like lines with too many attributes/methods. Even without that line, the script is not compatible with Python 3.\n\nReplying to [slelievre](#comment%3A32):\n> Couldn't `relocate-once.py` be run using the Python2 shipped by Sage?\n\n\nThat's a good idea, let's do that. This branch works for me.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/478b430f1a304b2ff6cd5ed97d45692e140574c8\">478b430</a></td><td><code>trac 25668: run relocate-once.py with Sage's python2.</code></td></tr></table>\n",
    "created_at": "2018-07-15T18:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493924",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>
Replying to [jdemeyer](#comment%3A31):
> Replying to [jhpalmieri](#comment%3A29):
> > Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky.

> 
> Clunky but I think it's the best solution. I would probably skip the `python2.6` check though.
> 
> Do we already know why things go wrong with Anaconda?


It seems to me that either Python 3 in general, or Anaconda's Python 3, doesn't like lines with too many attributes/methods. Even without that line, the script is not compatible with Python 3.

Replying to [slelievre](#comment%3A32):
> Couldn't `relocate-once.py` be run using the Python2 shipped by Sage?


That's a good idea, let's do that. This branch works for me.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/478b430f1a304b2ff6cd5ed97d45692e140574c8">478b430</a></td><td><code>trac 25668: run relocate-once.py with Sage's python2.</code></td></tr></table>




---

archive/issue_comments_493925.json:
```json
{
    "body": "**Changing commit** from \"[478b430f1a304b2ff6cd5ed97d45692e140574c8](https://github.com/sagemath/sagetrac-mirror/commit/478b430f1a304b2ff6cd5ed97d45692e140574c8)\" to \"[030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5](https://github.com/sagemath/sagetrac-mirror/commit/030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5)\".",
    "created_at": "2018-07-15T18:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493925",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[478b430f1a304b2ff6cd5ed97d45692e140574c8](https://github.com/sagemath/sagetrac-mirror/commit/478b430f1a304b2ff6cd5ed97d45692e140574c8)" to "[030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5](https://github.com/sagemath/sagetrac-mirror/commit/030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5)".



---

archive/issue_comments_493926.json:
```json
{
    "body": "<a id='comment:35'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5\">030c1bc</a></td><td><code>trac 25668: run relocate-once.py with Sage's python2.</code></td></tr></table>\n",
    "created_at": "2018-07-15T18:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5">030c1bc</a></td><td><code>trac 25668: run relocate-once.py with Sage's python2.</code></td></tr></table>




---

archive/issue_events_073059.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "rename": {
        "from": "Binary releases: give better error message if anaconda is present",
        "to": "Run relocate-once.py with Sage's Python2 and with error checking"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25668#event-73059"
}
```



---

archive/issue_comments_493927.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n-Apparently if Anaconda is installed, you get this message when you run a newly installed Sage binary:\n+Running Sage for the first time after installing from binary under\n+Linux or macOS leads to running `relocate-once.py`. When it is run\n+by Python3 (eg the one installed by Anaconda), it leads to the\n+following error.\n \n ```\n $ ./sage\n@@ -11,12 +14,18 @@\n a binary tarball instead. Read README.txt for more information.\n ************************************************************************\n ```\n-Can we give a better error message?\n+which seems to come from Python3 choking on a very long line in\n+`relocate-once.py`, because of the Python3 bug described as\n+[Python issue 32758](https://bugs.python.org/issue32758).\n \n-See\n+See reports by Sage users at\n \n - https://ask.sagemath.org/question/42736/linux-binary-seems-to-be-source/\n - https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/\n - https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/\n \n-Reported \"upstream\" at https://github.com/sagemath/binary-pkg/issues/16\n+Reported in \"upstream\" binary-pkg at https://github.com/sagemath/binary-pkg/issues/16\n+\n+To fix the issue, this ticket\n+- makes `relocate-once.py` be run with Sage's Python2, which should prevent the `RecursionError`,\n+- adds error-checking after running relocate-once.py, with a meaningful error in case of failure.\n``````\n",
    "created_at": "2018-07-15T19:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493927",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,7 @@
-Apparently if Anaconda is installed, you get this message when you run a newly installed Sage binary:
+Running Sage for the first time after installing from binary under
+Linux or macOS leads to running `relocate-once.py`. When it is run
+by Python3 (eg the one installed by Anaconda), it leads to the
+following error.
 
 ```
 $ ./sage
@@ -11,12 +14,18 @@
 a binary tarball instead. Read README.txt for more information.
 ************************************************************************
 ```
-Can we give a better error message?
+which seems to come from Python3 choking on a very long line in
+`relocate-once.py`, because of the Python3 bug described as
+[Python issue 32758](https://bugs.python.org/issue32758).
 
-See
+See reports by Sage users at
 
 - https://ask.sagemath.org/question/42736/linux-binary-seems-to-be-source/
 - https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/
 - https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/
 
-Reported "upstream" at https://github.com/sagemath/binary-pkg/issues/16
+Reported in "upstream" binary-pkg at https://github.com/sagemath/binary-pkg/issues/16
+
+To fix the issue, this ticket
+- makes `relocate-once.py` be run with Sage's Python2, which should prevent the `RecursionError`,
+- adds error-checking after running relocate-once.py, with a meaningful error in case of failure.
``````




---

archive/issue_comments_493928.json:
```json
{
    "body": "<a id='comment:36'></a>\nMaking ticket summary and description reflect the diagnosis and the proposed fix.",
    "created_at": "2018-07-15T19:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493928",
    "user": "https://github.com/slel"
}
```

<a id='comment:36'></a>
Making ticket summary and description reflect the diagnosis and the proposed fix.



---

archive/issue_comments_493929.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [jhpalmieri](#comment%3A34):\n> This branch works for me.\n\n\nHow did you test it?",
    "created_at": "2018-07-16T06:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493929",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:37'></a>
Replying to [jhpalmieri](#comment%3A34):
> This branch works for me.


How did you test it?



---

archive/issue_comments_493930.json:
```json
{
    "body": "<a id='comment:38'></a>\nIf this really works, then positive review. But you have to convince me that you tested it properly.",
    "created_at": "2018-07-16T06:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493930",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:38'></a>
If this really works, then positive review. But you have to convince me that you tested it properly.



---

archive/issue_comments_493931.json:
```json
{
    "body": "<a id='comment:39'></a>\nFirst, I'm relying on this assumption: `relocate-once.py` will only be present in binary releases (and therefore `$SAGE_ROOT/local/bin/python2` exists). I tested by downloading a binary release. I also downloaded Anaconda and let it modify my path (when you install, at least on OS X, it writes to `$HOME/.profile`). So I had this:\n\n```\n$ echo $PATH\n/Users/palmieri/anaconda3/bin:....\n$ which python\n/Users/palmieri/anaconda3/bin/python\n$ python --version\nPython 3.6.5 :: Anaconda, Inc.\n```\nThen running `./sage` from the binary distribution works:\n\n```\n$ ./sage\n\nRewriting paths for your new installation directory\n===================================================\n\nThis might take a few minutes but only has to be done once.\n\npatching ...\n...\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.2, Release Date: 2018-05-05                     \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: 3+5\n8\nsage: Sq(2)**2\nSq(1,1)\n```\n\nI also took a binary distribution and broke `relocate-once.py`. The result of running `./sage`:\n\n```\n$ ./sage\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/BDIST/SageMath/relocate-once.py\", line 9\n    print('hello\")\n                 ^\nSyntaxError: EOL while scanning string literal\nError running the script 'relocate-once.py'.\n```\nNote that I didn't actually build a binary distribution, I just patched the file `SAGE_ROOT/sage` by hand.\n\nThe error message if I run `./sage` from a freshly unpacked source tarball of course remains the same (since `relocate-once.py` does not exist, the if block is not executed).\n\nWhat else would you like me to check?",
    "created_at": "2018-07-16T16:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493931",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:39'></a>
First, I'm relying on this assumption: `relocate-once.py` will only be present in binary releases (and therefore `$SAGE_ROOT/local/bin/python2` exists). I tested by downloading a binary release. I also downloaded Anaconda and let it modify my path (when you install, at least on OS X, it writes to `$HOME/.profile`). So I had this:

```
$ echo $PATH
/Users/palmieri/anaconda3/bin:....
$ which python
/Users/palmieri/anaconda3/bin/python
$ python --version
Python 3.6.5 :: Anaconda, Inc.
```
Then running `./sage` from the binary distribution works:

```
$ ./sage

Rewriting paths for your new installation directory
===================================================

This might take a few minutes but only has to be done once.

patching ...
...
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.2, Release Date: 2018-05-05                     │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
sage: 3+5
8
sage: Sq(2)**2
Sq(1,1)
```

I also took a binary distribution and broke `relocate-once.py`. The result of running `./sage`:

```
$ ./sage
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/BDIST/SageMath/relocate-once.py", line 9
    print('hello")
                 ^
SyntaxError: EOL while scanning string literal
Error running the script 'relocate-once.py'.
```
Note that I didn't actually build a binary distribution, I just patched the file `SAGE_ROOT/sage` by hand.

The error message if I run `./sage` from a freshly unpacked source tarball of course remains the same (since `relocate-once.py` does not exist, the if block is not executed).

What else would you like me to check?



---

archive/issue_comments_493932.json:
```json
{
    "body": "<a id='comment:40'></a>\nOn which system did you check?",
    "created_at": "2018-07-17T06:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493932",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'></a>
On which system did you check?



---

archive/issue_comments_493933.json:
```json
{
    "body": "<a id='comment:41'></a>\nOS X \u2013\u00a0it is the only system I have easy access to.",
    "created_at": "2018-07-17T16:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493933",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'></a>
OS X – it is the only system I have easy access to.



---

archive/issue_comments_493934.json:
```json
{
    "body": "<a id='comment:42'></a>\nshall we put this into \"positive review\" now ?",
    "created_at": "2018-07-20T15:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493934",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:42'></a>
shall we put this into "positive review" now ?



---

archive/issue_comments_493935.json:
```json
{
    "body": "<a id='comment:43'></a>\nupdate milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493935",
    "user": "https://github.com/videlec"
}
```

<a id='comment:43'></a>
update milestone 8.3 -> 8.4



---

archive/issue_events_073060.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25668#event-73060"
}
```



---

archive/issue_comments_493936.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2018-08-07T15:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493936",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_493937.json:
```json
{
    "body": "<a id='comment:45'></a>\nAny progress on this? I would very much like it to get merged in 8.4, since it has been a common issue, at least on ask.sagemath.org.",
    "created_at": "2018-08-27T16:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493937",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:45'></a>
Any progress on this? I would very much like it to get merged in 8.4, since it has been a common issue, at least on ask.sagemath.org.



---

archive/issue_comments_493938.json:
```json
{
    "body": "<a id='comment:47'></a>\nPing?",
    "created_at": "2018-12-06T22:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493938",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:47'></a>
Ping?



---

archive/issue_comments_493939.json:
```json
{
    "body": "<a id='comment:48'></a>\nVolker, would you review this?",
    "created_at": "2018-12-10T11:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493939",
    "user": "https://github.com/slel"
}
```

<a id='comment:48'></a>
Volker, would you review this?



---

archive/issue_events_073061.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-12-10T11:30:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25668#event-73061"
}
```



---

archive/issue_events_073062.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-12-10T11:30:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25668#event-73062"
}
```



---

archive/issue_comments_493940.json:
```json
{
    "body": "<a id='comment:49'></a>\nMaybe it works, but it seems a bit sketchy to use the Python in Sage to run relocate-once.py.  I admit, I don't quite understand exactly what it is `relocate-once.py` does, but if the Python in Sage and the libraries it depends on haven't been \"relocated\" yet, how can you guarantee they'll work properly?\n\nI think it would make more sense to modify `relocate-once.py` to just work better on more Pythons.  In particular, I don't think it's *necessary* for it be implemented in such a way that it does not contain extremely long expressions that tax the parser/peephole optimizers in Python.",
    "created_at": "2018-12-10T11:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493940",
    "user": "https://github.com/embray"
}
```

<a id='comment:49'></a>
Maybe it works, but it seems a bit sketchy to use the Python in Sage to run relocate-once.py.  I admit, I don't quite understand exactly what it is `relocate-once.py` does, but if the Python in Sage and the libraries it depends on haven't been "relocated" yet, how can you guarantee they'll work properly?

I think it would make more sense to modify `relocate-once.py` to just work better on more Pythons.  In particular, I don't think it's *necessary* for it be implemented in such a way that it does not contain extremely long expressions that tax the parser/peephole optimizers in Python.



---

archive/issue_comments_493941.json:
```json
{
    "body": "<a id='comment:50'></a>\nThis is a rather fragile workaround, run Sage's python2 while the rpaths in the binary point to the wrong place and pray that none of those shared libraries end up being used by relocate-once.\n\nThe thing that needs to be done eventually is making relocate-once python3 compatible, including not emitting very long chains of method calls.",
    "created_at": "2018-12-10T12:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493941",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:50'></a>
This is a rather fragile workaround, run Sage's python2 while the rpaths in the binary point to the wrong place and pray that none of those shared libraries end up being used by relocate-once.

The thing that needs to be done eventually is making relocate-once python3 compatible, including not emitting very long chains of method calls.



---

archive/issue_comments_493942.json:
```json
{
    "body": "<a id='comment:51'></a>\nA compromise would be to use the system Python 2 if we can find it (via something like `python2 relocate-once.py || python2.7 relocate-once.py || ...`) and otherwise call Sage's Python 2 and hope that it works. Is it better to have something that you know will break if the system `python` runs Python 3, or to have something that might work in that situation, even if it's fragile?\n\nOtherwise, this puts the ball in the court of the people who maintain the Sage binary distributions. I seem to have opened up https://github.com/sagemath/binary-pkg/issues/16 6 months ago, but no progress yet. I don't have the time to figure out how `relocate-once.py` is generated and then to redo it to avoid the long chains of methods.",
    "created_at": "2018-12-10T19:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493942",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:51'></a>
A compromise would be to use the system Python 2 if we can find it (via something like `python2 relocate-once.py || python2.7 relocate-once.py || ...`) and otherwise call Sage's Python 2 and hope that it works. Is it better to have something that you know will break if the system `python` runs Python 3, or to have something that might work in that situation, even if it's fragile?

Otherwise, this puts the ball in the court of the people who maintain the Sage binary distributions. I seem to have opened up https://github.com/sagemath/binary-pkg/issues/16 6 months ago, but no progress yet. I don't have the time to figure out how `relocate-once.py` is generated and then to redo it to avoid the long chains of methods.



---

archive/issue_comments_493943.json:
```json
{
    "body": "<a id='comment:52'></a>\nI'm fixing this at https://github.com/sagemath/binary-pkg/issues/16",
    "created_at": "2018-12-11T02:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493943",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:52'></a>
I'm fixing this at https://github.com/sagemath/binary-pkg/issues/16



---

archive/issue_comments_493944.json:
```json
{
    "body": "<a id='comment:53'></a>\nI don't know if this has ever happened specifically with the relocate-once.py script, but I've also had problems in the past with Python 2.7 bytecode compiler crashing on extremely long expressions, particularly arithmetic expressions like `a = 1; a + a + a + a + ...` repeating a few thousand times (incidentally only if `a` is a variable; if it's a `1` literal I think those constant expressions get optimized before reaching the compiler).\n\nIn fact it was only a couple years ago I think that they fixed this to at least raise a `RuntimeError` instead of segfaulting.",
    "created_at": "2018-12-11T07:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493944",
    "user": "https://github.com/embray"
}
```

<a id='comment:53'></a>
I don't know if this has ever happened specifically with the relocate-once.py script, but I've also had problems in the past with Python 2.7 bytecode compiler crashing on extremely long expressions, particularly arithmetic expressions like `a = 1; a + a + a + a + ...` repeating a few thousand times (incidentally only if `a` is a variable; if it's a `1` literal I think those constant expressions get optimized before reaching the compiler).

In fact it was only a couple years ago I think that they fixed this to at least raise a `RuntimeError` instead of segfaulting.



---

archive/issue_comments_493945.json:
```json
{
    "body": "<a id='comment:54'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b0bacb9ac1a62f1dbf3b0de0ab293936ad7a0b0\">3b0bacb</a></td><td><code>trac 25668: run relocate-once.py with Sage's python2.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15\">abb2a89</a></td><td><code>trac 25668: add error-checking after running relocate-once.py.</code></td></tr></table>\n",
    "created_at": "2018-12-11T16:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493945",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:54'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b0bacb9ac1a62f1dbf3b0de0ab293936ad7a0b0">3b0bacb</a></td><td><code>trac 25668: run relocate-once.py with Sage's python2.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15">abb2a89</a></td><td><code>trac 25668: add error-checking after running relocate-once.py.</code></td></tr></table>




---

archive/issue_comments_493946.json:
```json
{
    "body": "**Changing commit** from \"[030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5](https://github.com/sagemath/sagetrac-mirror/commit/030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5)\" to \"[abb2a89e1d211acc7d7d25c233707fe299f04f15](https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15)\".",
    "created_at": "2018-12-11T16:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493946",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5](https://github.com/sagemath/sagetrac-mirror/commit/030c1bc8519f9eb3be9ffc8cc37951e6dfc43ca5)" to "[abb2a89e1d211acc7d7d25c233707fe299f04f15](https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15)".



---

archive/issue_comments_493947.json:
```json
{
    "body": "<a id='comment:55'></a>\nReplying to [vbraun](#comment%3A52):\n> I'm fixing this at https://github.com/sagemath/binary-pkg/issues/16 \n\n\nThanks!\n\nFor this ticket, the only thing left to do is error-checking. Ready for review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b0bacb9ac1a62f1dbf3b0de0ab293936ad7a0b0\">3b0bacb</a></td><td><code>trac 25668: run relocate-once.py with Sage's python2.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15\">abb2a89</a></td><td><code>trac 25668: add error-checking after running relocate-once.py.</code></td></tr></table>\n",
    "created_at": "2018-12-11T17:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493947",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:55'></a>
Replying to [vbraun](#comment%3A52):
> I'm fixing this at https://github.com/sagemath/binary-pkg/issues/16 


Thanks!

For this ticket, the only thing left to do is error-checking. Ready for review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b0bacb9ac1a62f1dbf3b0de0ab293936ad7a0b0">3b0bacb</a></td><td><code>trac 25668: run relocate-once.py with Sage's python2.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15">abb2a89</a></td><td><code>trac 25668: add error-checking after running relocate-once.py.</code></td></tr></table>




---

archive/issue_events_073063.json:
```json
{
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25668#event-73063"
}
```



---

archive/issue_comments_493948.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-12-12T14:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493948",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_493949.json:
```json
{
    "body": "**Changing reviewer** from \"Jeroen Demeyer\" to \"Jeroen Demeyer, Volker Braun\".",
    "created_at": "2018-12-12T14:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493949",
    "user": "https://github.com/vbraun"
}
```

**Changing reviewer** from "Jeroen Demeyer" to "Jeroen Demeyer, Volker Braun".



---

archive/issue_comments_493950.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/python2-relocate-once](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/python2-relocate-once)\" to \"[abb2a89e1d211acc7d7d25c233707fe299f04f15](https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15)\".",
    "created_at": "2018-12-15T19:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493950",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jhpalmieri/python2-relocate-once](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/python2-relocate-once)" to "[abb2a89e1d211acc7d7d25c233707fe299f04f15](https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15)".



---

archive/issue_comments_493951.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2018-12-15T19:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493951",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_events_073064.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-15T19:24:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25668#event-73064"
}
```



---

archive/issue_comments_493952.json:
```json
{
    "body": "**Changing commit** from \"[abb2a89e1d211acc7d7d25c233707fe299f04f15](https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15)\" to \"\".",
    "created_at": "2018-12-29T18:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493952",
    "user": "https://github.com/slel"
}
```

**Changing commit** from "[abb2a89e1d211acc7d7d25c233707fe299f04f15](https://github.com/sagemath/sagetrac-mirror/commit/abb2a89e1d211acc7d7d25c233707fe299f04f15)" to "".



---

archive/issue_comments_493953.json:
```json
{
    "body": "<a id='comment:59'></a>\n(Editing ticket description to reflect that the fix is not the one\nsuggested by the ticket summary.)",
    "created_at": "2018-12-29T18:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493953",
    "user": "https://github.com/slel"
}
```

<a id='comment:59'></a>
(Editing ticket description to reflect that the fix is not the one
suggested by the ticket summary.)



---

archive/issue_comments_493954.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,8 @@\n Running Sage for the first time after installing from binary under\n-Linux or macOS leads to running `relocate-once.py`. When it is run\n-by Python3 (eg the one installed by Anaconda), it leads to the\n-following error.\n+Linux or macOS leads to running `relocate-once.py`.\n+\n+Before this ticket, when run by Python 3 (eg as installed by Anaconda),\n+it would lead to the following error.\n \n ```\n $ ./sage\n@@ -24,8 +25,12 @@\n - https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/\n - https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/\n \n-Reported in \"upstream\" binary-pkg at https://github.com/sagemath/binary-pkg/issues/16\n+Reported in \"upstream\" binary-pkg at [binary-pkg issue 16](https://github.com/sagemath/binary-pkg/issues/16) -- see the fix there.\n \n-To fix the issue, this ticket\n-- makes `relocate-once.py` be run with Sage's Python2, which should prevent the `RecursionError`,\n-- adds error-checking after running relocate-once.py, with a meaningful error in case of failure.\n+After that fix, relocate-once.py can run with Python 3, and this ticket adds\n+error-checking after running relocate-once.py, with a meaningful error\n+in case of failure.\n+\n+The tentative solution at one point was to make `relocate-once.py` be run\n+with Sage's Python2, whence the now-inaccurate ticket summary.\n+\n``````\n",
    "created_at": "2018-12-29T18:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25668",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25668#issuecomment-493954",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,8 @@
 Running Sage for the first time after installing from binary under
-Linux or macOS leads to running `relocate-once.py`. When it is run
-by Python3 (eg the one installed by Anaconda), it leads to the
-following error.
+Linux or macOS leads to running `relocate-once.py`.
+
+Before this ticket, when run by Python 3 (eg as installed by Anaconda),
+it would lead to the following error.
 
 ```
 $ ./sage
@@ -24,8 +25,12 @@
 - https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/
 - https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/
 
-Reported in "upstream" binary-pkg at https://github.com/sagemath/binary-pkg/issues/16
+Reported in "upstream" binary-pkg at [binary-pkg issue 16](https://github.com/sagemath/binary-pkg/issues/16) -- see the fix there.
 
-To fix the issue, this ticket
-- makes `relocate-once.py` be run with Sage's Python2, which should prevent the `RecursionError`,
-- adds error-checking after running relocate-once.py, with a meaningful error in case of failure.
+After that fix, relocate-once.py can run with Python 3, and this ticket adds
+error-checking after running relocate-once.py, with a meaningful error
+in case of failure.
+
+The tentative solution at one point was to make `relocate-once.py` be run
+with Sage's Python2, whence the now-inaccurate ticket summary.
+
``````

