# Issue 25039: Add sdh_install helper function to sage-dist-helpers

archive/issues_024802.json:
```json
{
    "body": "    Adds a new `sdh_install` helper function:\n\n    This is like a very simplified version of the `install` program, and is\n    intended for use by packages whose spkg-install just copies some files (or\n    more complex packages that copy some files as one of its steps).  The\n    majority of its functionality is just in ensuring that the full destination\n    path exists, and to provide some error checking.  This replaces some\n    patterns that occur frequently in some spkg-installs.\n\n    Also updates the mathjax and thebe packages as two examples of its usage (this implements #24024 for those packages).\n\nKeywords: destdir mathjax thebe\n\nBranch/Commit: 0f848c3153b06b42839e908a5f3324084a604ac9\n\nReviewer: Jeroen Demeyer\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25039\n\n",
    "closed_at": "2018-05-18T17:49:56Z",
    "created_at": "2018-03-27T12:03:25Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Add sdh_install helper function to sage-dist-helpers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25039",
    "user": "https://github.com/embray"
}
```
    Adds a new `sdh_install` helper function:

    This is like a very simplified version of the `install` program, and is
    intended for use by packages whose spkg-install just copies some files (or
    more complex packages that copy some files as one of its steps).  The
    majority of its functionality is just in ensuring that the full destination
    path exists, and to provide some error checking.  This replaces some
    patterns that occur frequently in some spkg-installs.

    Also updates the mathjax and thebe packages as two examples of its usage (this implements #24024 for those packages).

Keywords: destdir mathjax thebe

Branch/Commit: 0f848c3153b06b42839e908a5f3324084a604ac9

Reviewer: Jeroen Demeyer

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25039





---

archive/issue_comments_347893.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-27T12:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347893",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_347894.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-27T14:36:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347895.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-03-27T14:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347895",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347896.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-27T19:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347896",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_347897.json:
```json
{
    "body": "<a id='comment:4'></a>1. I don't really understand the point of\n\n```\n    if [ $# -eq 0 ]; then\n        sdh_die \"At least a source and destination file are required\"\n    fi\n```\nsince it would fail anyway later and no error message would be given for `sdh_install -T`.\n\n2. It looks strange to put this in an `else` block, it's just part of the normal flow of execution:\n\n```\n    else\n        dest=\"${SAGE_DESTDIR}$dest\"\n    fi\n```\n\n3. I seem to recall that `cp -R` is more portable than `cp -r`. So unless you have a good reason for using `cp -r`, I recommend `cp -R`.\n\n4. For consistency, I would start all `sdh_die` messages with `Error:`\n\n5. `echo \"Installing files for ${PKG_NAME}:\"` looks like unneeded verbosity. I would drop that.\n\n6. If `mkdir` or `cp` fails, it already prints an error message, so I don't need that we need `sdh_die` for that. I would just write `cp ... || exit $?`.",
    "created_at": "2018-03-27T19:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347897",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>1. I don't really understand the point of

```
    if [ $# -eq 0 ]; then
        sdh_die "At least a source and destination file are required"
    fi
```
since it would fail anyway later and no error message would be given for `sdh_install -T`.

2. It looks strange to put this in an `else` block, it's just part of the normal flow of execution:

```
    else
        dest="${SAGE_DESTDIR}$dest"
    fi
```

3. I seem to recall that `cp -R` is more portable than `cp -r`. So unless you have a good reason for using `cp -r`, I recommend `cp -R`.

4. For consistency, I would start all `sdh_die` messages with `Error:`

5. `echo "Installing files for ${PKG_NAME}:"` looks like unneeded verbosity. I would drop that.

6. If `mkdir` or `cp` fails, it already prints an error message, so I don't need that we need `sdh_die` for that. I would just write `cp ... || exit $?`.



---

archive/issue_comments_347898.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 jdemeyer]:\n> 1. I don't really understand the point of\n> \n> ```\n>     if [ $# -eq 0 ]; then\n>         sdh_die \"At least a source and destination file are required\"\n>     fi\n> ```\n> since it would fail anyway later and no error message would be given for `sdh_install -T`.\n\n\nI mean, it will still fail for `sdh_install -T` because the `$src` variable will be empty. I thought an explicit check of \"there are arguments\" would enhance clarity but in retrospect I agree it's superfluous.\n\n> \n> 2. It looks strange to put this in an `else` block, it's just part of the normal flow of execution:\n> \n> ```\n>     else\n>         dest=\"${SAGE_DESTDIR}$dest\"\n>     fi\n> ```\n\n\nYep. I think that was just the result of remolding of slightly different logic.\n\n> 3. I seem to recall that `cp -R` is more portable than `cp -r`. So unless you have a good reason for using `cp -r`, I recommend `cp -R`.\n\n\nI suspect it's not really a problem for us since I've already seen `cp -r` in some of the `spkg-install`s I've used this in--including standard packages.  If that were a problem for a platform we care about it would have come up by now.  However, I seem to recall the same now that you mention it, so I could change it.\n\n> 4. For consistency, I would start all `sdh_die` messages with `Error:`\n\n\n+1 \n\n> 5. `echo \"Installing files for ${PKG_NAME}:\"` looks like unneeded verbosity. I would drop that.\n\n\n+1 Some of the other `sdh_` commands had some kind of message like this so I put it in for consistency.  But after trying this on a few packages it hasn't been too helpful (especially in cases where there are multiple `sdh_install` calls in the package).\n \n> 6. If `mkdir` or `cp` fails, it already prints an error message, so I don't need that we need `sdh_die` for that. I would just write `cp ... || exit $?`.\n\n\nA lot of the code this function is replacing was also adding its own error messages on top of `mkdir` and/or `cp`, so this was just carried over from that.  In most cases those programs' error messages should be sufficient though.",
    "created_at": "2018-03-28T09:20:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347898",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>Replying to [comment:4 jdemeyer]:
> 1. I don't really understand the point of
> 
> ```
>     if [ $# -eq 0 ]; then
>         sdh_die "At least a source and destination file are required"
>     fi
> ```
> since it would fail anyway later and no error message would be given for `sdh_install -T`.


I mean, it will still fail for `sdh_install -T` because the `$src` variable will be empty. I thought an explicit check of "there are arguments" would enhance clarity but in retrospect I agree it's superfluous.

> 
> 2. It looks strange to put this in an `else` block, it's just part of the normal flow of execution:
> 
> ```
>     else
>         dest="${SAGE_DESTDIR}$dest"
>     fi
> ```


Yep. I think that was just the result of remolding of slightly different logic.

> 3. I seem to recall that `cp -R` is more portable than `cp -r`. So unless you have a good reason for using `cp -r`, I recommend `cp -R`.


I suspect it's not really a problem for us since I've already seen `cp -r` in some of the `spkg-install`s I've used this in--including standard packages.  If that were a problem for a platform we care about it would have come up by now.  However, I seem to recall the same now that you mention it, so I could change it.

> 4. For consistency, I would start all `sdh_die` messages with `Error:`


+1 

> 5. `echo "Installing files for ${PKG_NAME}:"` looks like unneeded verbosity. I would drop that.


+1 Some of the other `sdh_` commands had some kind of message like this so I put it in for consistency.  But after trying this on a few packages it hasn't been too helpful (especially in cases where there are multiple `sdh_install` calls in the package).
 
> 6. If `mkdir` or `cp` fails, it already prints an error message, so I don't need that we need `sdh_die` for that. I would just write `cp ... || exit $?`.


A lot of the code this function is replacing was also adding its own error messages on top of `mkdir` and/or `cp`, so this was just carried over from that.  In most cases those programs' error messages should be sufficient though.



---

archive/issue_comments_347899.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-28T09:26:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347899",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_347900.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-28T09:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347900",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_347901.json:
```json
{
    "body": "<a id='comment:8'></a>Wait... did you actually agree with all my comments? :-)",
    "created_at": "2018-03-29T09:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347901",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Wait... did you actually agree with all my comments? :-)



---

archive/issue_comments_347902.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-29T09:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347902",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_347903.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 jdemeyer]:\n> Wait... did you actually agree with all my comments? :-)\n\n\nFair enough--but it's not like I set out to disagree with you.  I thought they were all reasonable enough :)",
    "created_at": "2018-03-29T09:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347903",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>Replying to [comment:8 jdemeyer]:
> Wait... did you actually agree with all my comments? :-)


Fair enough--but it's not like I set out to disagree with you.  I thought they were all reasonable enough :)



---

archive/issue_comments_347904.json:
```json
{
    "body": "<a id='comment:11'></a>New commits:",
    "created_at": "2018-04-11T08:04:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347904",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>New commits:



---

archive/issue_comments_347905.json:
```json
{
    "body": "<a id='comment:12'></a>Thanks for catching that.  It was originally called `sdh_install_files` but I decided to shorten it later.",
    "created_at": "2018-04-11T13:11:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347905",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Thanks for catching that.  It was originally called `sdh_install_files` but I decided to shorten it later.



---

archive/issue_comments_347906.json:
```json
{
    "body": "<a id='comment:13'></a>Just rebased on current develop.\n\n---\nNew commits:",
    "created_at": "2018-04-18T09:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347906",
    "user": "https://github.com/embray"
}
```

<a id='comment:13'></a>Just rebased on current develop.

---
New commits:



---

archive/issue_events_062807.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T09:07:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25039#event-62807"
}
```



---

archive/issue_comments_347907.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-05-09T18:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347907",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_347908.json:
```json
{
    "body": "<a id='comment:14'></a>Merge conflict",
    "created_at": "2018-05-09T18:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347908",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>Merge conflict



---

archive/issue_comments_347909.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-17T16:17:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347909",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_347910.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-05-17T16:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347910",
    "user": "https://github.com/embray"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_347911.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25039#issuecomment-347911",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062808.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:49:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25039",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25039#event-62808"
}
```
