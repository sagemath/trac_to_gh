# Issue 25966: Upgrade Arb to 2.14.0

archive/issues_025729.json:
```json
{
    "body": "https://github.com/fredrik-johansson/arb/archive/2.14.0.tar.gz\n\nBecause of more accurate error bounds (mainly for trigonometric functions), a large number of doctests have to be updated.\n\nCC:  @timokau @jdemeyer\n\nReviewer: Travis Scrimshaw, Timo Kaufmann\n\nAuthor: Fredrik Johansson\n\nBranch: 8bef4fd2876a61969b516fe4eb3b8ad7cc076c5e\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25966\n\n",
    "closed_at": "2018-08-09T21:27:50Z",
    "created_at": "2018-07-28T20:32:23Z",
    "labels": [
        "component: packages: standard"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Upgrade Arb to 2.14.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25966",
    "user": "https://github.com/fredrik-johansson"
}
```
https://github.com/fredrik-johansson/arb/archive/2.14.0.tar.gz

Because of more accurate error bounds (mainly for trigonometric functions), a large number of doctests have to be updated.

CC:  @timokau @jdemeyer

Reviewer: Travis Scrimshaw, Timo Kaufmann

Author: Fredrik Johansson

Branch: 8bef4fd2876a61969b516fe4eb3b8ad7cc076c5e

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25966





---

archive/issue_comments_386385.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2018-07-28T20:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386385",
    "user": "https://github.com/fredrik-johansson"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_386386.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2018-07-28T20:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386386",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_386387.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+https://github.com/fredrik-johansson/arb/archive/2.14.0.tar.gz\n \n+Because of more accurate error bounds (mainly for trigonometric functions), a large number of doctests have to be updated.\n \n Comment: 1\n \n``````\n",
    "created_at": "2018-07-28T20:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386387",
    "user": "https://github.com/fredrik-johansson"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+https://github.com/fredrik-johansson/arb/archive/2.14.0.tar.gz
 
+Because of more accurate error bounds (mainly for trigonometric functions), a large number of doctests have to be updated.
 
 Comment: 1
 
``````




---

archive/issue_comments_386388.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2018-07-28T20:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386388",
    "user": "https://github.com/fredrik-johansson"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_386389.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-28T20:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386389",
    "user": "https://github.com/fredrik-johansson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_386390.json:
```json
{
    "body": "<a id='comment:3'></a>Buildbots ahoy! *cough*authorname*cough*",
    "created_at": "2018-07-30T07:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386390",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'></a>Buildbots ahoy! *cough*authorname*cough*



---

archive/issue_comments_386391.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-30T07:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386391",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_386392.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-06T21:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386392",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_386393.json:
```json
{
    "body": "<a id='comment:5'></a>\n```\n**********************************************************************\nFile \"src/sage/rings/complex_arb.pyx\", line 1029, in sage.rings.complex_arb.ComplexBallField.?\nFailed example:\n    C.integral(lambda x, _: (x + x.exp()).sin(), 0, 8) # long time\nExpected:\n    [0.34740017...55347713 +/- 6.72e-598]\nGot:\n    [0.347400172657247807879512159119893124657456254866180183885492713616748213988785320529685104346604105756813796172006018707302714228197618073704004353678452866627436279471970216410908716043577412909956068587776704710948691279593004567821091508925369957240639547298886452332685264381903039098870525160076005978168808062746564134987731050142119306346307812114504420398584159417131096900798039662018221641127266271301569159908541386062975763888813212164702872661085356464323603726722886936732008463756755254875678750234857309302489895429562039632272592695502596880447563060128384223515181416786355347713 +/- 5.71e-598]\n**********************************************************************\n1 item had failures:\n   1 of  56 in sage.rings.complex_arb.ComplexBallField.?\n    [622 tests, 1 failure, 3.69 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/rings/complex_arb.pyx  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2018-08-06T21:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386393",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
```
**********************************************************************
File "src/sage/rings/complex_arb.pyx", line 1029, in sage.rings.complex_arb.ComplexBallField.?
Failed example:
    C.integral(lambda x, _: (x + x.exp()).sin(), 0, 8) # long time
Expected:
    [0.34740017...55347713 +/- 6.72e-598]
Got:
    [0.347400172657247807879512159119893124657456254866180183885492713616748213988785320529685104346604105756813796172006018707302714228197618073704004353678452866627436279471970216410908716043577412909956068587776704710948691279593004567821091508925369957240639547298886452332685264381903039098870525160076005978168808062746564134987731050142119306346307812114504420398584159417131096900798039662018221641127266271301569159908541386062975763888813212164702872661085356464323603726722886936732008463756755254875678750234857309302489895429562039632272592695502596880447563060128384223515181416786355347713 +/- 5.71e-598]
**********************************************************************
1 item had failures:
   1 of  56 in sage.rings.complex_arb.ComplexBallField.?
    [622 tests, 1 failure, 3.69 s]
----------------------------------------------------------------------
sage -t --long src/sage/rings/complex_arb.pyx  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_386394.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-06T22:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386394",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_386395.json:
```json
{
    "body": "<a id='comment:7'></a>I must have done the same thing and not run `--long`. Mea culpa. Fixed.\n\n---\nNew commits:",
    "created_at": "2018-08-06T22:15:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386395",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>I must have done the same thing and not run `--long`. Mea culpa. Fixed.

---
New commits:



---

archive/issue_comments_386396.json:
```json
{
    "body": "<a id='comment:8'></a>Am I allowed to give the positive review to the reviewer's patch? Are we waiting for other reviewing?",
    "created_at": "2018-08-07T02:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386396",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:8'></a>Am I allowed to give the positive review to the reviewer's patch? Are we waiting for other reviewing?



---

archive/issue_comments_386397.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 fredrik.johansson]:\n> Am I allowed to give the positive review to the reviewer's patch?\n\n\nYes.\n\n> Are we waiting for other reviewing?\n\n\nNot that I am aware of.",
    "created_at": "2018-08-07T03:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386397",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>Replying to [comment:8 fredrik.johansson]:
> Am I allowed to give the positive review to the reviewer's patch?


Yes.

> Are we waiting for other reviewing?


Not that I am aware of.



---

archive/issue_comments_386398.json:
```json
{
    "body": "<a id='comment:10'></a>Unfortunately Sage fails to build for me right now (for unrelated reasons) so I can't verify that the tests pass.",
    "created_at": "2018-08-07T06:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386398",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:10'></a>Unfortunately Sage fails to build for me right now (for unrelated reasons) so I can't verify that the tests pass.



---

archive/issue_comments_386399.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-07T09:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386399",
    "user": "https://github.com/timokau"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_386400.json:
```json
{
    "body": "<a id='comment:11'></a>Tests pass.",
    "created_at": "2018-08-07T09:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386400",
    "user": "https://github.com/timokau"
}
```

<a id='comment:11'></a>Tests pass.



---

archive/issue_comments_386401.json:
```json
{
    "body": "<a id='comment:12'></a>In the future it would be preferable to make use of `# abs tol 1e-42` feature to reduce the doctest precision. It would make the doctests less brittle.",
    "created_at": "2018-08-07T10:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386401",
    "user": "https://github.com/timokau"
}
```

<a id='comment:12'></a>In the future it would be preferable to make use of `# abs tol 1e-42` feature to reduce the doctest precision. It would make the doctests less brittle.



---

archive/issue_events_064885.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-09T21:27:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25966#event-64885"
}
```



---

archive/issue_comments_386402.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-09T21:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386402",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_386403.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 gh-timokau]:\n> In the future it would be preferable to make use of `# abs tol 1e-42` feature to reduce the doctest precision. It would make the doctests less brittle.\n\n\nSee the discussion at #18560. IMO it would be time to switch to using tolerances indeed. Jeroen, did you view of the issue change since that ticket?",
    "created_at": "2018-08-14T16:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386403",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:14'></a>Replying to [comment:12 gh-timokau]:
> In the future it would be preferable to make use of `# abs tol 1e-42` feature to reduce the doctest precision. It would make the doctests less brittle.


See the discussion at #18560. IMO it would be time to switch to using tolerances indeed. Jeroen, did you view of the issue change since that ticket?



---

archive/issue_comments_386404.json:
```json
{
    "body": "<a id='comment:15'></a>Differences when upgrading Arb are not a big issue IMO. In fact, it's helpful (for me) to look at the Sage doctests to see what improved or got worse between two versions. However, divergence between 32-bit and 64-bit results is plausible in the future and tolerances may be the best solution for that.",
    "created_at": "2018-08-16T14:09:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386404",
    "user": "https://github.com/fredrik-johansson"
}
```

<a id='comment:15'></a>Differences when upgrading Arb are not a big issue IMO. In fact, it's helpful (for me) to look at the Sage doctests to see what improved or got worse between two versions. However, divergence between 32-bit and 64-bit results is plausible in the future and tolerances may be the best solution for that.



---

archive/issue_comments_386405.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 fredrik.johansson]:\n> Differences when upgrading Arb are not a big issue IMO. In fact, it's helpful (for me) to look at the Sage doctests to see what improved or got worse between two versions. However, divergence between 32-bit and 64-bit results is plausible in the future and tolerances may be the best solution for that.\n\n\nThey are an issue when using sage outside of sage-the-distribution. They make it necessary that either the arb version used is the exact arb version sage-the-distribution uses or that patches are applied to sage. With tolerances we could potentially update sage and arb independently. And this is not only an issue for distributions. It could in the long run also allow sage-the-distribution to use the system's arb version (#24919).\n\nIn my opinion ideal sage tests should only fail if something is actually broken in sage, upstream projects or packaging. \"broken\" here may be an actual error or a api change.",
    "created_at": "2018-08-16T15:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25966#issuecomment-386405",
    "user": "https://github.com/timokau"
}
```

<a id='comment:16'></a>Replying to [comment:15 fredrik.johansson]:
> Differences when upgrading Arb are not a big issue IMO. In fact, it's helpful (for me) to look at the Sage doctests to see what improved or got worse between two versions. However, divergence between 32-bit and 64-bit results is plausible in the future and tolerances may be the best solution for that.


They are an issue when using sage outside of sage-the-distribution. They make it necessary that either the arb version used is the exact arb version sage-the-distribution uses or that patches are applied to sage. With tolerances we could potentially update sage and arb independently. And this is not only an issue for distributions. It could in the long run also allow sage-the-distribution to use the system's arb version (#24919).

In my opinion ideal sage tests should only fail if something is actually broken in sage, upstream projects or packaging. "broken" here may be an actual error or a api change.
