# Issue 25347: Packages hol_light (including flyspeck's formal_ineqs) and dependency camlp5

archive/issues_025110.json:
```json
{
    "body": "Experimental package for the HOL Light theorem prover (http://www.cl.cam.ac.uk/~jrh13/hol-light/), which includes the flyspeck project's formal verifier of nonlinear inequalities (https://github.com/monadius/formal_ineqs).\n\nAssuming distribution package for OCaml is available. Tested on Homebrew (`brew install ocaml-num`), which has version 4.06.1.\n\nAdding package `camlp5`. The package available in Homebrew does not seem to work for HOL light, probably because it has not been built in strict mode (https://github.com/jrh13/hol-light/blob/master/README)\n\n```\n(cd upstream && wget https://github.com/camlp5/camlp5/archive/rel705.tar.gz -O camlp5-7.05.tar.gz )\n```\n\nAdding package `hol_light`. Upstream has no releases. For now we pull directly from their git. Alternatively, could use Debian's `.orig.tar.gz` (https://packages.debian.org/stretch/hol-light) as our upstream.\n\nhol_light includes `formal_ineqs` from the Flyspeck project. Original source release without version number at https://github.com/flyspeck/flyspeck/tree/master/downloads, current development said to be at  https://github.com/monadius/formal_ineqs, which has some fixes for newer HOL Light.\n\n\nTo use (see https://github.com/monadius/formal_ineqs/blob/master/docs/FormalVerifier.pdf):\n\n```\n$ sage -sh\n$ hol-light\n# load_path := \"SAGE_LOCAL/share/formal_ineqs\" :: !load_path ;; \n# needs \"verifier/m_verifier_main.hl\";;\n```\n... this compiles for ca. 40 minutes.\n\n... and gives an error:\n\n```\n- : unit = ()\nFile \"misc/misc_vars.hl\" already loaded\n- : unit = ()\nFile \"_none_\", line 1:\nError: Unbound module Taylor_interval\nError in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/verifier/m_verifier_build.hl\n- : unit = ()\nFile \"_none_\", line 1:\nError: Unbound module Taylor_interval\nError in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/verifier/m_verifier.hl\n- : unit = ()\nFile \"verifier/m_verifier_build.hl\" already loaded\n- : unit = ()\nFile \"taylor/m_taylor.hl\" already loaded\n- : unit = ()\nFile \"misc/misc_vars.hl\" already loaded\n- : unit = ()\nFile \"_none_\", line 1:\nError: Unbound module Taylor_interval\nError in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/taylor/m_taylor_arith.hl\n- : unit = ()\nFile \"_none_\", line 1:\nError: Unbound module Taylor_interval\nError in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/taylor/m_taylor_arith2.hl\n- : unit = ()\nFile \"misc/misc_vars.hl\" already loaded\n- : unit = ()\nFile \"verifier/certificate.hl\" already loaded\n- : unit = ()\nFile \"informal/informal_taylor.hl\" already loaded\n- : unit = ()\nFile \"verifier/certificate.hl\" already loaded\n- : unit = ()\nFile \"verifier_options.hl\" already loaded\n- : unit = ()\nmodule Informal_search :\n  sig\n    type search_options = {\n      raw_intervals0 : bool;\n      max_width : float;\n      max_depth : int;\n      mono_depth : int;\n      pp : int;\n    }\n    val find_max : 'a list -> 'a * int\n    val split_domain :\n      int ->\n      int ->\n      Informal_taylor.m_cell_domain ->\n      Informal_taylor.m_cell_domain * Informal_taylor.m_cell_domain\n    val restrict_domain :\n      int ->\n      bool -> Informal_taylor.m_cell_domain -> Informal_taylor.m_cell_domain\n    type function_info = {\n      eval0 :\n        int ->\n        Informal_float.ifloat list ->\n        Informal_float.ifloat list -> Informal_interval.interval;\n      taylor :\n        int ->\n        int ->\n        Informal_taylor.m_cell_domain -> Informal_taylor.m_taylor_interval;\n      index : int;\n    }\n    type result =\n        Cell_inconclusive\n      | Cell_false\n      | Cell_result of Certificate.result_tree\n      | Cell_pass of bool * function_info\n    exception Construction_error of string * Informal_taylor.m_cell_domain *\n                function_info list\n    val error :\n      string -> Informal_taylor.m_cell_domain -> function_info list -> 'a\n    val init_vol : Informal_taylor.m_cell_domain -> unit\n    val update_verified_vol : Informal_taylor.m_cell_domain -> unit\n    val check_cell :\n      search_options ->\n      Informal_taylor.m_cell_domain -> function_info list -> result\n    val try_mono :\n      search_options ->\n      Informal_taylor.m_cell_domain ->\n      function_info -> Informal_taylor.m_taylor_interval -> result\n    val construct_certificate0 :\n      search_options ->\n      Informal_taylor.m_cell_domain ->\n      function_info list -> Certificate.result_tree\n    val construct_certificate :\n      search_options ->\n      Informal_taylor.m_cell_domain ->\n      ((int ->\n        Informal_float.ifloat list ->\n        Informal_float.ifloat list -> Informal_interval.interval) *\n       (int ->\n        int ->\n        Informal_taylor.m_cell_domain -> Informal_taylor.m_taylor_interval))\n      list -> Certificate.result_tree\n  end\n- : unit = ()\nFile \"informal/informal_verifier.hl\" already loaded\n- : unit = ()\nFile \"_none_\", line 1:\nError: Unbound module Eval_interval\nError in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/verifier/m_verifier_main.hl\nval it : unit = ()\n# File \"_none_\", line 1:\nError: Unbound module M_verifier_main\n```\n\n\nOther open questions:\n- Can it be compiled with ocamlopt?\n- Use checkpointing tool on Linux? On macOS?\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/25347\n\n",
    "created_at": "2018-05-11T18:52:30Z",
    "labels": [
        "component: packages: experimental"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-pending",
    "title": "Packages hol_light (including flyspeck's formal_ineqs) and dependency camlp5",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25347",
    "user": "https://github.com/mkoeppe"
}
```
Experimental package for the HOL Light theorem prover (http://www.cl.cam.ac.uk/~jrh13/hol-light/), which includes the flyspeck project's formal verifier of nonlinear inequalities (https://github.com/monadius/formal_ineqs).

Assuming distribution package for OCaml is available. Tested on Homebrew (`brew install ocaml-num`), which has version 4.06.1.

Adding package `camlp5`. The package available in Homebrew does not seem to work for HOL light, probably because it has not been built in strict mode (https://github.com/jrh13/hol-light/blob/master/README)

```
(cd upstream && wget https://github.com/camlp5/camlp5/archive/rel705.tar.gz -O camlp5-7.05.tar.gz )
```

Adding package `hol_light`. Upstream has no releases. For now we pull directly from their git. Alternatively, could use Debian's `.orig.tar.gz` (https://packages.debian.org/stretch/hol-light) as our upstream.

hol_light includes `formal_ineqs` from the Flyspeck project. Original source release without version number at https://github.com/flyspeck/flyspeck/tree/master/downloads, current development said to be at  https://github.com/monadius/formal_ineqs, which has some fixes for newer HOL Light.


To use (see https://github.com/monadius/formal_ineqs/blob/master/docs/FormalVerifier.pdf):

```
$ sage -sh
$ hol-light
# load_path := "SAGE_LOCAL/share/formal_ineqs" :: !load_path ;; 
# needs "verifier/m_verifier_main.hl";;
```
... this compiles for ca. 40 minutes.

... and gives an error:

```
- : unit = ()
File "misc/misc_vars.hl" already loaded
- : unit = ()
File "_none_", line 1:
Error: Unbound module Taylor_interval
Error in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/verifier/m_verifier_build.hl
- : unit = ()
File "_none_", line 1:
Error: Unbound module Taylor_interval
Error in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/verifier/m_verifier.hl
- : unit = ()
File "verifier/m_verifier_build.hl" already loaded
- : unit = ()
File "taylor/m_taylor.hl" already loaded
- : unit = ()
File "misc/misc_vars.hl" already loaded
- : unit = ()
File "_none_", line 1:
Error: Unbound module Taylor_interval
Error in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/taylor/m_taylor_arith.hl
- : unit = ()
File "_none_", line 1:
Error: Unbound module Taylor_interval
Error in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/taylor/m_taylor_arith2.hl
- : unit = ()
File "misc/misc_vars.hl" already loaded
- : unit = ()
File "verifier/certificate.hl" already loaded
- : unit = ()
File "informal/informal_taylor.hl" already loaded
- : unit = ()
File "verifier/certificate.hl" already loaded
- : unit = ()
File "verifier_options.hl" already loaded
- : unit = ()
module Informal_search :
  sig
    type search_options = {
      raw_intervals0 : bool;
      max_width : float;
      max_depth : int;
      mono_depth : int;
      pp : int;
    }
    val find_max : 'a list -> 'a * int
    val split_domain :
      int ->
      int ->
      Informal_taylor.m_cell_domain ->
      Informal_taylor.m_cell_domain * Informal_taylor.m_cell_domain
    val restrict_domain :
      int ->
      bool -> Informal_taylor.m_cell_domain -> Informal_taylor.m_cell_domain
    type function_info = {
      eval0 :
        int ->
        Informal_float.ifloat list ->
        Informal_float.ifloat list -> Informal_interval.interval;
      taylor :
        int ->
        int ->
        Informal_taylor.m_cell_domain -> Informal_taylor.m_taylor_interval;
      index : int;
    }
    type result =
        Cell_inconclusive
      | Cell_false
      | Cell_result of Certificate.result_tree
      | Cell_pass of bool * function_info
    exception Construction_error of string * Informal_taylor.m_cell_domain *
                function_info list
    val error :
      string -> Informal_taylor.m_cell_domain -> function_info list -> 'a
    val init_vol : Informal_taylor.m_cell_domain -> unit
    val update_verified_vol : Informal_taylor.m_cell_domain -> unit
    val check_cell :
      search_options ->
      Informal_taylor.m_cell_domain -> function_info list -> result
    val try_mono :
      search_options ->
      Informal_taylor.m_cell_domain ->
      function_info -> Informal_taylor.m_taylor_interval -> result
    val construct_certificate0 :
      search_options ->
      Informal_taylor.m_cell_domain ->
      function_info list -> Certificate.result_tree
    val construct_certificate :
      search_options ->
      Informal_taylor.m_cell_domain ->
      ((int ->
        Informal_float.ifloat list ->
        Informal_float.ifloat list -> Informal_interval.interval) *
       (int ->
        int ->
        Informal_taylor.m_cell_domain -> Informal_taylor.m_taylor_interval))
      list -> Certificate.result_tree
  end
- : unit = ()
File "informal/informal_verifier.hl" already loaded
- : unit = ()
File "_none_", line 1:
Error: Unbound module Eval_interval
Error in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/verifier/m_verifier_main.hl
val it : unit = ()
# File "_none_", line 1:
Error: Unbound module M_verifier_main
```


Other open questions:
- Can it be compiled with ocamlopt?
- Use checkpointing tool on Linux? On macOS?




Issue created by migration from https://trac.sagemath.org/ticket/25347





---

archive/issue_comments_352925.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-05-11T19:28:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25347#issuecomment-352925",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_352926.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-11T19:43:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25347#issuecomment-352926",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_352927.json:
```json
{
    "body": "Earliest error:\n\n```\nException: Failure \"tryfind\".\nError in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/hol-light/Multivariate/realanalysis.ml\n- : unit = ()\nFile \"/Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/trig/series.hl\", line 318, characters 55-84:\nError: Unbound value REAL_INTEGRABLE_UNIFORM_LIMIT\nError in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/trig/series.hl\n- : unit = ()\nFile \"_none_\", line 1:\nError: Unbound module Series\n```",
    "created_at": "2018-05-11T21:01:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25347#issuecomment-352927",
    "user": "https://github.com/mkoeppe"
}
```

Earliest error:

```
Exception: Failure "tryfind".
Error in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/hol-light/Multivariate/realanalysis.ml
- : unit = ()
File "/Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/trig/series.hl", line 318, characters 55-84:
Error: Unbound value REAL_INTEGRABLE_UNIFORM_LIMIT
Error in included file /Users/mkoeppe/s/sage/some-sage-install-prefix/share/formal_ineqs/trig/series.hl
- : unit = ()
File "_none_", line 1:
Error: Unbound module Series
```



---

archive/issue_comments_352928.json:
```json
{
    "body": "Just a comment on the installer scripts: you should use the `sdh_...` functions (grep for `sdh_make_install` for example).",
    "created_at": "2018-05-12T12:17:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25347#issuecomment-352928",
    "user": "https://github.com/jdemeyer"
}
```

Just a comment on the installer scripts: you should use the `sdh_...` functions (grep for `sdh_make_install` for example).



---

archive/issue_comments_352929.json:
```json
{
    "body": "I don't really like how you pull from git at install time. Better just make a proper package from the git repo. For `script` packages, there is no dependency or version checking.\n\nAnd even if you do want to pull from git, this is really bad:\n\n```\nif [ -n \"${FORMAL_INEQS_COMMIT}\" ]; then\n    git checkout ${FORMAL_INEQS_COMMIT}\nelse\n    git pull --ff-only\nfi\n```\nYou really should fix a commit, not just pull whatever is on the master branch.\n\n(NOTE: for experimental packages, you can do whatever you want. So take these comments as advice, not as a requirement)",
    "created_at": "2018-05-12T12:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25347#issuecomment-352929",
    "user": "https://github.com/jdemeyer"
}
```

I don't really like how you pull from git at install time. Better just make a proper package from the git repo. For `script` packages, there is no dependency or version checking.

And even if you do want to pull from git, this is really bad:

```
if [ -n "${FORMAL_INEQS_COMMIT}" ]; then
    git checkout ${FORMAL_INEQS_COMMIT}
else
    git pull --ff-only
fi
```
You really should fix a commit, not just pull whatever is on the master branch.

(NOTE: for experimental packages, you can do whatever you want. So take these comments as advice, not as a requirement)



---

archive/issue_comments_352930.json:
```json
{
    "body": "Thanks for the comments; yes, these are very preliminary scripts and before I would set this ticket to review, it would be replaced by using a tarball.",
    "created_at": "2018-05-12T20:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25347#issuecomment-352930",
    "user": "https://github.com/mkoeppe"
}
```

Thanks for the comments; yes, these are very preliminary scripts and before I would set this ticket to review, it would be replaced by using a tarball.



---

archive/issue_comments_352931.json:
```json
{
    "body": "Loading Formal_ineqs also fails in Debian's version of the package. https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=898514",
    "created_at": "2018-05-12T22:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25347#issuecomment-352931",
    "user": "https://github.com/mkoeppe"
}
```

Loading Formal_ineqs also fails in Debian's version of the package. https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=898514



---

archive/issue_comments_352932.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-13T15:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25347",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25347#issuecomment-352932",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:
