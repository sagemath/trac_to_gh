# Issue 25236: Deprecate various functions from old coercion model

archive/issues_024999.json:
```json
{
    "body": "Yet another piece of removing the old coercion model...\n\n1. All functions which are only used internally by the old coercion model get two leading underscores or are inlined in another function.\n\n2. All functions which are only called from Cython are changed to a `cdef` function.\n\n3. The public functions `coerce_map_from_c` and `has_coerce_map_from_c` are kept as deprecated alias. The other removed functions already had a leading underscore and are simply removed. As a consequence, there are no longer any public non-deprecated methods in the `parent_old.Parent` class.\n\n4. Remove Python access to the `_has_coerce_map_from` cache.\n\nCC:  @tscrim\n\nBranch/Commit: 5ea77573c21f193b87a79a31602becf0b9c84b4d\n\nReviewer: Marc Mezzarobba\n\nAuthor: Jeroen Demeyer\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25236\n\n",
    "closed_at": "2018-05-14T17:35:22Z",
    "created_at": "2018-04-24T08:44:06Z",
    "labels": [
        "component: coercion"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Deprecate various functions from old coercion model",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25236",
    "user": "https://github.com/jdemeyer"
}
```
Yet another piece of removing the old coercion model...

1. All functions which are only used internally by the old coercion model get two leading underscores or are inlined in another function.

2. All functions which are only called from Cython are changed to a `cdef` function.

3. The public functions `coerce_map_from_c` and `has_coerce_map_from_c` are kept as deprecated alias. The other removed functions already had a leading underscore and are simply removed. As a consequence, there are no longer any public non-deprecated methods in the `parent_old.Parent` class.

4. Remove Python access to the `_has_coerce_map_from` cache.

CC:  @tscrim

Branch/Commit: 5ea77573c21f193b87a79a31602becf0b9c84b4d

Reviewer: Marc Mezzarobba

Author: Jeroen Demeyer

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25236





---

archive/issue_comments_374458.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n-This is only used by the old coercion and called only from within the old coercion model. We rename it to \\`_has_coerce_map_from_old\\` and make it a \\`cdef\\` function while keeping \\`has_coerce_map_from_c\\` as deprecated alias.\n+The functions \\`coerce_map_from_c\\` and \\`has_coerce_map_from_c\\` are only used by the old coercion and called only from within the old coercion model. We rename them to \\`__coerce_map_from_c\\` and \\`__has_coerce_map_from_c\\` and make them \\`cdef\\` functions.\n \n-The Cython function \\`has_coerce_map_from_c_impl\\` is folded into \\`_has_coerce_map_from_old\\`.\n+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \\`parent_old.Parent\\` class.\n+\n+The Cython function \\`has_coerce_map_from_c_impl\\` is removed and folded into \\`__has_coerce_map_from_c\\`.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-24T09:07:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374458",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,8 @@
-This is only used by the old coercion and called only from within the old coercion model. We rename it to \`_has_coerce_map_from_old\` and make it a \`cdef\` function while keeping \`has_coerce_map_from_c\` as deprecated alias.
+The functions \`coerce_map_from_c\` and \`has_coerce_map_from_c\` are only used by the old coercion and called only from within the old coercion model. We rename them to \`__coerce_map_from_c\` and \`__has_coerce_map_from_c\` and make them \`cdef\` functions.
 
-The Cython function \`has_coerce_map_from_c_impl\` is folded into \`_has_coerce_map_from_old\`.
+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \`parent_old.Parent\` class.
+
+The Cython function \`has_coerce_map_from_c_impl\` is removed and folded into \`__has_coerce_map_from_c\`.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_events_063303.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-24T09:07:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25236#event-63303"
}
```



---

archive/issue_comments_374459.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+The functions \\`coerce_map_from_c\\` and \\`has_coerce_map_from_c\\` are only used by the old coercion and called only from within the old coercion model. We rename them to \\`__coerce_map_from_c\\` and \\`__has_coerce_map_from_c\\` and make them \\`cdef\\` functions.\n \n+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \\`parent_old.Parent\\` class.\n+\n+Further, the \\`cdef\\` function \\`coerce_map_from_c_impl\\` is renamed to \\`__coerce_map_from_c_impl\\` and the \\`has_coerce_map_from_c_impl\\` is removed and folded into \\`__has_coerce_map_from_c\\`.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-24T09:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374459",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,8 @@
+The functions \`coerce_map_from_c\` and \`has_coerce_map_from_c\` are only used by the old coercion and called only from within the old coercion model. We rename them to \`__coerce_map_from_c\` and \`__has_coerce_map_from_c\` and make them \`cdef\` functions.
 
+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \`parent_old.Parent\` class.
+
+Further, the \`cdef\` function \`coerce_map_from_c_impl\` is renamed to \`__coerce_map_from_c_impl\` and the \`has_coerce_map_from_c_impl\` is removed and folded into \`__has_coerce_map_from_c\`.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_374460.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+The functions \\`coerce_map_from_c\\` and \\`has_coerce_map_from_c\\` are only used by the old coercion and called only from within the old coercion model. We rename them to \\`__coerce_map_from_c\\` and \\`__has_coerce_map_from_c\\` and make them \\`cdef\\` functions.\n \n+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \\`parent_old.Parent\\` class.\n+\n+Further, the \\`cdef\\` function \\`coerce_map_from_c_impl\\` is renamed to \\`__coerce_map_from_c_impl\\` and the \\`has_coerce_map_from_c_impl\\` is removed and folded into \\`__has_coerce_map_from_c\\`.\n+\n+Finally, Python access to \\`_has_coerce_map_from\\` is removed.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-24T09:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374460",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,10 @@
+The functions \`coerce_map_from_c\` and \`has_coerce_map_from_c\` are only used by the old coercion and called only from within the old coercion model. We rename them to \`__coerce_map_from_c\` and \`__has_coerce_map_from_c\` and make them \`cdef\` functions.
 
+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \`parent_old.Parent\` class.
+
+Further, the \`cdef\` function \`coerce_map_from_c_impl\` is renamed to \`__coerce_map_from_c_impl\` and the \`has_coerce_map_from_c_impl\` is removed and folded into \`__has_coerce_map_from_c\`.
+
+Finally, Python access to \`_has_coerce_map_from\` is removed.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_374461.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+The functions \\`coerce_map_from_c\\` and \\`has_coerce_map_from_c\\` are only used by the old coercion model and are called only from within the old coercion model. We change them to \\`cdef\\` function \\`__coerce_map_from_c\\` and \\`__has_coerce_map_from_c\\`.\n \n+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \\`parent_old.Parent\\` class.\n+\n+Further, the \\`cdef\\` function \\`coerce_map_from_c_impl\\` is renamed to \\`__coerce_map_from_c_impl\\` and \\`has_coerce_map_from_c_impl\\` is removed and folded into \\`__has_coerce_map_from_c\\`.\n+\n+Finally, Python access to \\`_has_coerce_map_from\\` is removed.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-24T09:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374461",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,10 @@
+The functions \`coerce_map_from_c\` and \`has_coerce_map_from_c\` are only used by the old coercion model and are called only from within the old coercion model. We change them to \`cdef\` function \`__coerce_map_from_c\` and \`__has_coerce_map_from_c\`.
 
+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \`parent_old.Parent\` class.
+
+Further, the \`cdef\` function \`coerce_map_from_c_impl\` is renamed to \`__coerce_map_from_c_impl\` and \`has_coerce_map_from_c_impl\` is removed and folded into \`__has_coerce_map_from_c\`.
+
+Finally, Python access to \`_has_coerce_map_from\` is removed.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_374462.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-24T09:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374462",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_374463.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Yet another piece of removing the old coercion model...\n \n+The functions \\`coerce_map_from_c\\` and \\`has_coerce_map_from_c\\` are only used by the old coercion model and are called only from within the old coercion model. We change them to \\`cdef\\` function \\`__coerce_map_from_c\\` and \\`__has_coerce_map_from_c\\`.\n+\n+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \\`parent_old.Parent\\` class.\n+\n+Further, the \\`cdef\\` function \\`coerce_map_from_c_impl\\` is renamed to \\`__coerce_map_from_c_impl\\` and \\`has_coerce_map_from_c_impl\\` is removed and folded into \\`__has_coerce_map_from_c\\`.\n+\n+Finally, Python access to \\`_has_coerce_map_from\\` is removed.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-24T09:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374463",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Yet another piece of removing the old coercion model...
 
+The functions \`coerce_map_from_c\` and \`has_coerce_map_from_c\` are only used by the old coercion model and are called only from within the old coercion model. We change them to \`cdef\` function \`__coerce_map_from_c\` and \`__has_coerce_map_from_c\`.
+
+The old Python functions are kept as deprecated alias. As a consequence, there are no longer any public non-deprecated methods in the \`parent_old.Parent\` class.
+
+Further, the \`cdef\` function \`coerce_map_from_c_impl\` is renamed to \`__coerce_map_from_c_impl\` and \`has_coerce_map_from_c_impl\` is removed and folded into \`__has_coerce_map_from_c\`.
+
+Finally, Python access to \`_has_coerce_map_from\` is removed.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_374464.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2018-04-24T09:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374464",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_374465.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-24T12:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374465",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_374466.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Yet another piece of removing the old coercion model...\n \n+1. All functions which are only used internally by the old coercion model get two leading underscores and are changed to a \\`cdef\\` function to indicate that these really should not be used. This affects \\`coerce_map_from_c\\`, \\`has_coerce_map_from_c\\`.\n+\n+2. The public functions \\`coerce_map_from_c\\` and \\`has_coerce_map_from_c\\` are kept as deprecated alias. The other removed function already had a leading underscore and are simply removed. As a consequence, there are no longer any public non-deprecated methods in the \\`parent_old.Parent\\` class.\n+\n+3. \\`has_coerce_map_from_c_impl\\` is removed and folded into \\`__has_coerce_map_from_c\\`.\n+\n+4. Remove Python access to the \\`_has_coerce_map_from\\` cache.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-24T12:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374466",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Yet another piece of removing the old coercion model...
 
+1. All functions which are only used internally by the old coercion model get two leading underscores and are changed to a \`cdef\` function to indicate that these really should not be used. This affects \`coerce_map_from_c\`, \`has_coerce_map_from_c\`.
+
+2. The public functions \`coerce_map_from_c\` and \`has_coerce_map_from_c\` are kept as deprecated alias. The other removed function already had a leading underscore and are simply removed. As a consequence, there are no longer any public non-deprecated methods in the \`parent_old.Parent\` class.
+
+3. \`has_coerce_map_from_c_impl\` is removed and folded into \`__has_coerce_map_from_c\`.
+
+4. Remove Python access to the \`_has_coerce_map_from\` cache.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_374467.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Yet another piece of removing the old coercion model...\n \n+1. All functions which are only used internally by the old coercion model get two leading underscores or are inlined in another function.\n+\n+2. All functions which are only called from Cython are changed to a \\`cdef\\` function.\n+\n+3. The public functions \\`coerce_map_from_c\\` and \\`has_coerce_map_from_c\\` are kept as deprecated alias. The other removed function already had a leading underscore and are simply removed. As a consequence, there are no longer any public non-deprecated methods in the \\`parent_old.Parent\\` class.\n+\n+4. Remove Python access to the \\`_has_coerce_map_from\\` cache.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-24T12:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374467",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Yet another piece of removing the old coercion model...
 
+1. All functions which are only used internally by the old coercion model get two leading underscores or are inlined in another function.
+
+2. All functions which are only called from Cython are changed to a \`cdef\` function.
+
+3. The public functions \`coerce_map_from_c\` and \`has_coerce_map_from_c\` are kept as deprecated alias. The other removed function already had a leading underscore and are simply removed. As a consequence, there are no longer any public non-deprecated methods in the \`parent_old.Parent\` class.
+
+4. Remove Python access to the \`_has_coerce_map_from\` cache.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_374468.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-24T12:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374468",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_374469.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-24T14:31:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374469",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_374470.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Yet another piece of removing the old coercion model...\n \n+1. All functions which are only used internally by the old coercion model get two leading underscores or are inlined in another function.\n+\n+2. All functions which are only called from Cython are changed to a \\`cdef\\` function.\n+\n+3. The public functions \\`coerce_map_from_c\\` and \\`has_coerce_map_from_c\\` are kept as deprecated alias. The other removed functions already had a leading underscore and are simply removed. As a consequence, there are no longer any public non-deprecated methods in the \\`parent_old.Parent\\` class.\n+\n+4. Remove Python access to the \\`_has_coerce_map_from\\` cache.\n \n Author: Jeroen Demeyer\n \n```\n",
    "created_at": "2018-04-24T14:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374470",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Yet another piece of removing the old coercion model...
 
+1. All functions which are only used internally by the old coercion model get two leading underscores or are inlined in another function.
+
+2. All functions which are only called from Cython are changed to a \`cdef\` function.
+
+3. The public functions \`coerce_map_from_c\` and \`has_coerce_map_from_c\` are kept as deprecated alias. The other removed functions already had a leading underscore and are simply removed. As a consequence, there are no longer any public non-deprecated methods in the \`parent_old.Parent\` class.
+
+4. Remove Python access to the \`_has_coerce_map_from\` cache.
 
 Author: Jeroen Demeyer
 
```




---

archive/issue_comments_374471.json:
```json
{
    "body": "<a id='comment:12'></a>\n```\n+        raise NotImplementedError(\"please implement or _an_element_impl for %s\" % self)\n                                                    ^^^^ ?\n```",
    "created_at": "2018-04-25T06:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374471",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:12'></a>
```
+        raise NotImplementedError("please implement or _an_element_impl for %s" % self)
                                                    ^^^^ ?
```



---

archive/issue_comments_374472.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-25T07:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374472",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_374473.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-25T12:40:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374473",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_374474.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-14T17:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25236#issuecomment-374474",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063304.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-14T17:35:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25236",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25236#event-63304"
}
```
