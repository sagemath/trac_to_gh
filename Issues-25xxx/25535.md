# Issue 25535: failing internet doctest in sage/repl/load.py

archive/issues_025298.json:
```json
{
    "assignees": [],
    "body": "As reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ),\n\n```\nsage -tp --optional=sage,internet src/sage/repl/load.py\n```\n\ngives\n\n```\nsage -t src/sage/repl/load.py\n**********************************************************************\nFile \"src/sage/repl/load.py\", line 142, in sage.repl.load.load\nFailed example:\n    sage.repl.load.load('http://wstein.org/loadtest.py', globals())  # optional - internet\nException raised:\n    Traceback (most recent call last):\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 572, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 982, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.repl.load.load[16]>\", line 1, in <module>\n        sage.repl.load.load('http://wstein.org/loadtest.py', globals())  # optional - internet\n      File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/repl/load.py\", line 242, in load\n        code = compile(f.read(), fpath, 'exec')\n      File \"/home/slabbe/.sage/temp/labbe-laptop/4725/tmp_aLSpZn.py\", line 1\n        <!DOCTYPE html>\n        ^\n    SyntaxError: invalid syntax\n**********************************************************************\n1 item had failures:\n   1 of  37 in sage.repl.load.load\n    [45 tests, 1 failure, 3.81 s]\n----------------------------------------------------------------------\nsage -t src/sage/repl/load.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\n\n**Keywords:** thursdaysbdx\n\n**Branch/Commit:** [adeedb8cacfa38f4f4ad3580aa103aed646b0e0f](https://github.com/sagemath/sagetrac-mirror/commit/adeedb8cacfa38f4f4ad3580aa103aed646b0e0f)\n\n**Reviewer:** Vincent Klein\n\n**Author:** S\u00e9bastien Labb\u00e9\n\nIssue created by migration from https://trac.sagemath.org/ticket/25535\n\n",
    "closed_at": "2019-02-03T09:00:09Z",
    "created_at": "2018-06-07T20:09:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.7",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "failing internet doctest in sage/repl/load.py",
    "type": "issue",
    "updated_at": "2019-02-03T09:00:09Z",
    "url": "https://github.com/sagemath/sage/issues/25535",
    "user": "https://github.com/seblabbe"
}
```
As reported on [sage-release 8.3.beta3](https://groups.google.com/d/msg/sage-release/l635YEuT7Hs/WkHCnmWhAQAJ),

```
sage -tp --optional=sage,internet src/sage/repl/load.py
```

gives

```
sage -t src/sage/repl/load.py
**********************************************************************
File "src/sage/repl/load.py", line 142, in sage.repl.load.load
Failed example:
    sage.repl.load.load('http://wstein.org/loadtest.py', globals())  # optional - internet
Exception raised:
    Traceback (most recent call last):
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 572, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 982, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.repl.load.load[16]>", line 1, in <module>
        sage.repl.load.load('http://wstein.org/loadtest.py', globals())  # optional - internet
      File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/repl/load.py", line 242, in load
        code = compile(f.read(), fpath, 'exec')
      File "/home/slabbe/.sage/temp/labbe-laptop/4725/tmp_aLSpZn.py", line 1
        <!DOCTYPE html>
        ^
    SyntaxError: invalid syntax
**********************************************************************
1 item had failures:
   1 of  37 in sage.repl.load.load
    [45 tests, 1 failure, 3.81 s]
----------------------------------------------------------------------
sage -t src/sage/repl/load.py  # 1 doctest failed
----------------------------------------------------------------------
```


**Keywords:** thursdaysbdx

**Branch/Commit:** [adeedb8cacfa38f4f4ad3580aa103aed646b0e0f](https://github.com/sagemath/sagetrac-mirror/commit/adeedb8cacfa38f4f4ad3580aa103aed646b0e0f)

**Reviewer:** Vincent Klein

**Author:** Sébastien Labbé

Issue created by migration from https://trac.sagemath.org/ticket/25535





---

archive/issue_events_308122.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-06-07T20:09:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308122"
}
```



---

archive/issue_events_308123.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-06-07T20:09:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20doctest%20coverage",
    "label_color": "08517b",
    "label_name": "component: doctest coverage",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308123"
}
```



---

archive/issue_events_308124.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-06-07T20:09:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308124"
}
```



---

archive/issue_comments_394338.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis works:\n\n```\n$ wget http://wstein.org/loadtest.py\n$ cat loadtest.py \nprint \"hi from the net\"\n\nprint 2+3\n```\n\nBut it does not work from Sage:\n\n```\nsage: sage.repl.load.load('http://wstein.org/loadtest.py', globals())\n  File \"/home/slabbe/.sage/temp/labbe-laptop/25148/tmp_GGzNox.py\", line 1\n    <!DOCTYPE html>\n    ^\nSyntaxError: invalid syntax\n```\n\nThis allows to understand the problem:\n\n```\nsage: !cat /home/slabbe/.sage/temp/labbe-laptop/25148/tmp_GGzNox.py\n<!DOCTYPE html>\n...\n<head>\n<title>Access denied | wstein.org used Cloudflare to restrict access</title>\n...\n        <h2 class=\"cf-subheadline\">Access denied</h2>\n...\n            <h2 data-translate=\"what_happened\">What happened?</h2>\n            <p>The owner of this website (wstein.org) has banned your access based on your browser's signature. ...</p>\n          </div>\n...\n</script>\n</body>\n</html>\nsage: \n```",
    "created_at": "2018-08-25T13:11:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394338",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:1'></a>
This works:

```
$ wget http://wstein.org/loadtest.py
$ cat loadtest.py 
print "hi from the net"

print 2+3
```

But it does not work from Sage:

```
sage: sage.repl.load.load('http://wstein.org/loadtest.py', globals())
  File "/home/slabbe/.sage/temp/labbe-laptop/25148/tmp_GGzNox.py", line 1
    <!DOCTYPE html>
    ^
SyntaxError: invalid syntax
```

This allows to understand the problem:

```
sage: !cat /home/slabbe/.sage/temp/labbe-laptop/25148/tmp_GGzNox.py
<!DOCTYPE html>
...
<head>
<title>Access denied | wstein.org used Cloudflare to restrict access</title>
...
        <h2 class="cf-subheadline">Access denied</h2>
...
            <h2 data-translate="what_happened">What happened?</h2>
            <p>The owner of this website (wstein.org) has banned your access based on your browser's signature. ...</p>
          </div>
...
</script>
</body>
</html>
sage: 
```



---

archive/issue_comments_394339.json:
```json
{
    "body": "<a id='comment:2'></a>\nIs the point of that doctest to fetch a random python file from a webpage over http and execute it? If so, we should probably remove the doctest instead or amend it to use a local file / check the hash of the file first.",
    "created_at": "2018-08-25T14:22:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394339",
    "user": "https://github.com/timokau"
}
```

<a id='comment:2'></a>
Is the point of that doctest to fetch a random python file from a webpage over http and execute it? If so, we should probably remove the doctest instead or amend it to use a local file / check the hash of the file first.



---

archive/issue_comments_394340.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe issue that Cloudflare blocks the default python useragent was already encountered at #25222. We have a workaround there as well.\n\nIndeed the wisdom in executing a file fetched from the internet relatively blindly is questionable.",
    "created_at": "2018-08-26T18:12:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394340",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:3'></a>
The issue that Cloudflare blocks the default python useragent was already encountered at #25222. We have a workaround there as well.

Indeed the wisdom in executing a file fetched from the internet relatively blindly is questionable.



---

archive/issue_events_308125.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-09-01T09:39:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308125"
}
```



---

archive/issue_comments_394341.json:
```json
{
    "body": "<a id='comment:4'></a>\nAs suggested by nbruin, I added some User-Agent in `get_remote_file`. The problem is that I now use `urlopen` instead of `urlretrieve`. Thus, I can not specify the `report_hook` anymore which was used by the `verbose`.\n\nI set it to `needs_review` to get some feedback by the patchbots.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4eab4b746f3df347dc31b6277b17b58218a816d\">d4eab4b</a></td><td><code>25535: specifying a User-Agent</code></td></tr></table>\n",
    "created_at": "2018-09-01T09:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394341",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'></a>
As suggested by nbruin, I added some User-Agent in `get_remote_file`. The problem is that I now use `urlopen` instead of `urlretrieve`. Thus, I can not specify the `report_hook` anymore which was used by the `verbose`.

I set it to `needs_review` to get some feedback by the patchbots.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4eab4b746f3df347dc31b6277b17b58218a816d">d4eab4b</a></td><td><code>25535: specifying a User-Agent</code></td></tr></table>




---

archive/issue_comments_394342.json:
```json
{
    "body": "**Commit:** [d4eab4b746f3df347dc31b6277b17b58218a816d](https://github.com/sagemath/sagetrac-mirror/commit/d4eab4b746f3df347dc31b6277b17b58218a816d)",
    "created_at": "2018-09-01T09:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394342",
    "user": "https://github.com/seblabbe"
}
```

**Commit:** [d4eab4b746f3df347dc31b6277b17b58218a816d](https://github.com/sagemath/sagetrac-mirror/commit/d4eab4b746f3df347dc31b6277b17b58218a816d)



---

archive/issue_comments_394343.json:
```json
{
    "body": "**Branch:** [u/slabbe/25535](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/25535)",
    "created_at": "2018-09-01T09:39:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394343",
    "user": "https://github.com/seblabbe"
}
```

**Branch:** [u/slabbe/25535](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/25535)



---

archive/issue_comments_394344.json:
```json
{
    "body": "<a id='comment:5'></a>\nIn my opinion the security issue of fetching an executing a file from the internet (especially over HTTP) should also be addressed. Although you could argue that it is out of scope in this ticket, maybe it can be combined.",
    "created_at": "2018-09-01T11:22:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394344",
    "user": "https://github.com/timokau"
}
```

<a id='comment:5'></a>
In my opinion the security issue of fetching an executing a file from the internet (especially over HTTP) should also be addressed. Although you could argue that it is out of scope in this ticket, maybe it can be combined.



---

archive/issue_comments_394345.json:
```json
{
    "body": "<a id='comment:6'></a>\nIndeed, I wanted to say that my first commit was just fixing the doctest with the new url `http://www.sagemath.org/files/loadtest.py`. I am not a specialist on security issues.\n\nI know that fixing this doctest means that the `loadtest.py` file will be downloaded and executed each time someone runs optional doctests including those with tag `internet`. Is it possible that someone replaces the `loadtest.py` file by something else more malecious one day? I don't know. I let other discuss the security issue and possibly propose other commits, solutions...\n\nMeanwhile, I know that the doctest is broken which means that something is currently broken and keeping the doctest will guarrentees that the feature continue to be tested.",
    "created_at": "2018-09-02T21:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394345",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:6'></a>
Indeed, I wanted to say that my first commit was just fixing the doctest with the new url `http://www.sagemath.org/files/loadtest.py`. I am not a specialist on security issues.

I know that fixing this doctest means that the `loadtest.py` file will be downloaded and executed each time someone runs optional doctests including those with tag `internet`. Is it possible that someone replaces the `loadtest.py` file by something else more malecious one day? I don't know. I let other discuss the security issue and possibly propose other commits, solutions...

Meanwhile, I know that the doctest is broken which means that something is currently broken and keeping the doctest will guarrentees that the feature continue to be tested.



---

archive/issue_comments_394346.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [@seblabbe](#comment%3A6):\n> Is it possible that someone replaces the `loadtest.py` file by something else more malecious one day? I don't know. I let other discuss the security issue and possibly propose other commits, solutions...\n\nYes, that is one possibility. It could be replaced by someone on the sage team for various motivations (though rather unlikely) or be replaced as part of a server compromise. Targeted attacks that go unnoticed would also be possible.\nBut worse is the possibility of the request jost being MITM'd by *anybody* on the network since it is fetched over HTTP. So if you're running the sage doctests in a public wifi, anybody else in that wifi could execute code on your computer.\n\nPossible solutions include\n- first downloading the file, then verifying the contents match a hash, then loading it\n- just loading a local file\n\nDo we really need to test that we can fetch a file from the internet? Thats more or less a python primitive. And if we need to test that we can and should test it seperately from the `load` mechanism.",
    "created_at": "2018-09-02T21:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394346",
    "user": "https://github.com/timokau"
}
```

<a id='comment:7'></a>
Replying to [@seblabbe](#comment%3A6):
> Is it possible that someone replaces the `loadtest.py` file by something else more malecious one day? I don't know. I let other discuss the security issue and possibly propose other commits, solutions...

Yes, that is one possibility. It could be replaced by someone on the sage team for various motivations (though rather unlikely) or be replaced as part of a server compromise. Targeted attacks that go unnoticed would also be possible.
But worse is the possibility of the request jost being MITM'd by *anybody* on the network since it is fetched over HTTP. So if you're running the sage doctests in a public wifi, anybody else in that wifi could execute code on your computer.

Possible solutions include
- first downloading the file, then verifying the contents match a hash, then loading it
- just loading a local file

Do we really need to test that we can fetch a file from the internet? Thats more or less a python primitive. And if we need to test that we can and should test it seperately from the `load` mechanism.



---

archive/issue_comments_394347.json:
```json
{
    "body": "<a id='comment:8'></a>\nthe loadtest.py file should also be made python3-compatible\n\nEDIT: DONE",
    "created_at": "2018-09-03T06:05:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394347",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
the loadtest.py file should also be made python3-compatible

EDIT: DONE



---

archive/issue_comments_394348.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f01ebe4896f3cc023d4c5eca1f72f47bcd3326a\">5f01ebe</a></td><td><code>25535: specifying a User-Agent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05e53d0c041d17ab7921c4ce950cb57c25a72767\">05e53d0</a></td><td><code>25535: fixing doctest of get_remote_file function</code></td></tr></table>\n",
    "created_at": "2018-09-20T09:23:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394348",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f01ebe4896f3cc023d4c5eca1f72f47bcd3326a">5f01ebe</a></td><td><code>25535: specifying a User-Agent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05e53d0c041d17ab7921c4ce950cb57c25a72767">05e53d0</a></td><td><code>25535: fixing doctest of get_remote_file function</code></td></tr></table>




---

archive/issue_comments_394349.json:
```json
{
    "body": "**Changing commit** from \"[d4eab4b746f3df347dc31b6277b17b58218a816d](https://github.com/sagemath/sagetrac-mirror/commit/d4eab4b746f3df347dc31b6277b17b58218a816d)\" to \"[05e53d0c041d17ab7921c4ce950cb57c25a72767](https://github.com/sagemath/sagetrac-mirror/commit/05e53d0c041d17ab7921c4ce950cb57c25a72767)\".",
    "created_at": "2018-09-20T09:23:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394349",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[d4eab4b746f3df347dc31b6277b17b58218a816d](https://github.com/sagemath/sagetrac-mirror/commit/d4eab4b746f3df347dc31b6277b17b58218a816d)" to "[05e53d0c041d17ab7921c4ce950cb57c25a72767](https://github.com/sagemath/sagetrac-mirror/commit/05e53d0c041d17ab7921c4ce950cb57c25a72767)".



---

archive/issue_comments_394350.json:
```json
{
    "body": "<a id='comment:10'></a>\nI rebased on top of the most recent beta and I added a commit.\n\nThere are three issues begin dealt in this ticket:\n\n- `get_remote_file` was broken\n- `get_remote_file` was not properly tested (even broken, the doctests were passing)\n- `load` was loading a file from the http which is not secure\n\nI believe the proposed two commits solves the above 3 issues (needs review).",
    "created_at": "2018-09-20T09:38:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394350",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:10'></a>
I rebased on top of the most recent beta and I added a commit.

There are three issues begin dealt in this ticket:

- `get_remote_file` was broken
- `get_remote_file` was not properly tested (even broken, the doctests were passing)
- `load` was loading a file from the http which is not secure

I believe the proposed two commits solves the above 3 issues (needs review).



---

archive/issue_comments_394351.json:
```json
{
    "body": "<a id='comment:11'></a>\nThere is one small thing that I am still not able to preserve. It is the loading bar of dots `........` as in:\n\n```\nsage: get_remote_file('http://www.sagemath.org/files/loadtest.py', verbose=True)\nAttempting to load remote file: http://www.sagemath.org/files/loadtest.py\nLoading: [.................]    \n```\n\nwhich used to be printed with the help of the `report_hook` which I can not use anymore since I replaced the call to `urlretrieve` by a call to `urlopen`:\n\n```diff\n-        urlretrieve(filename, temp_name, report_hook)\n+        content = urlopen(req, timeout=1)\n+        with open(temp_name, 'w') as f:\n+            f.write(content.read())\n```\n\nSomebody has a solution? (... one of them being getting rid of the report_hook thing)",
    "created_at": "2018-09-20T09:40:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394351",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:11'></a>
There is one small thing that I am still not able to preserve. It is the loading bar of dots `........` as in:

```
sage: get_remote_file('http://www.sagemath.org/files/loadtest.py', verbose=True)
Attempting to load remote file: http://www.sagemath.org/files/loadtest.py
Loading: [.................]    
```

which used to be printed with the help of the `report_hook` which I can not use anymore since I replaced the call to `urlretrieve` by a call to `urlopen`:

```diff
-        urlretrieve(filename, temp_name, report_hook)
+        content = urlopen(req, timeout=1)
+        with open(temp_name, 'w') as f:
+            f.write(content.read())
```

Somebody has a solution? (... one of them being getting rid of the report_hook thing)



---

archive/issue_comments_394352.json:
```json
{
    "body": "<a id='comment:12'></a>\nle plugin \"pyflakes\" est pas content, car un import est en trop..",
    "created_at": "2018-09-30T12:47:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394352",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>
le plugin "pyflakes" est pas content, car un import est en trop..



---

archive/issue_comments_394353.json:
```json
{
    "body": "**Changing commit** from \"[05e53d0c041d17ab7921c4ce950cb57c25a72767](https://github.com/sagemath/sagetrac-mirror/commit/05e53d0c041d17ab7921c4ce950cb57c25a72767)\" to \"[9e3c4f9ec5189c85561974072777d42b7c9b6fe7](https://github.com/sagemath/sagetrac-mirror/commit/9e3c4f9ec5189c85561974072777d42b7c9b6fe7)\".",
    "created_at": "2018-10-08T18:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394353",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[05e53d0c041d17ab7921c4ce950cb57c25a72767](https://github.com/sagemath/sagetrac-mirror/commit/05e53d0c041d17ab7921c4ce950cb57c25a72767)" to "[9e3c4f9ec5189c85561974072777d42b7c9b6fe7](https://github.com/sagemath/sagetrac-mirror/commit/9e3c4f9ec5189c85561974072777d42b7c9b6fe7)".



---

archive/issue_comments_394354.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68a6566f093ea8fb0886629c29cce5b1c36370fb\">68a6566</a></td><td><code>25535: specifying a User-Agent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf53dd808c4eb69017f1bfe5c0a79b1e944cbd2d\">bf53dd8</a></td><td><code>25535: fixing doctest of get_remote_file function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9e3c4f9ec5189c85561974072777d42b7c9b6fe7\">9e3c4f9</a></td><td><code>25535: removing urlretrieve command in comments</code></td></tr></table>\n",
    "created_at": "2018-10-08T18:59:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394354",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68a6566f093ea8fb0886629c29cce5b1c36370fb">68a6566</a></td><td><code>25535: specifying a User-Agent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf53dd808c4eb69017f1bfe5c0a79b1e944cbd2d">bf53dd8</a></td><td><code>25535: fixing doctest of get_remote_file function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9e3c4f9ec5189c85561974072777d42b7c9b6fe7">9e3c4f9</a></td><td><code>25535: removing urlretrieve command in comments</code></td></tr></table>




---

archive/issue_comments_394355.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@fchapoton](#comment%3A12):\n> le plugin \"pyflakes\" est pas content, car un import est en trop..\n\nyes, this was because of the `urlretrieve` that I am replacing by `urlopen`. I was waiting for an answer to my previous comment before removing the `import urlretrieve`...\n\nI removed it now and rebased the branch on top of 8.4.rc0",
    "created_at": "2018-10-08T19:04:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394355",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:14'></a>
Replying to [@fchapoton](#comment%3A12):
> le plugin "pyflakes" est pas content, car un import est en trop..

yes, this was because of the `urlretrieve` that I am replacing by `urlopen`. I was waiting for an answer to my previous comment before removing the `import urlretrieve`...

I removed it now and rebased the branch on top of 8.4.rc0



---

archive/issue_events_308126.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-01-10T09:56:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308126"
}
```



---

archive/issue_events_308127.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-01-10T09:56:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308127"
}
```



---

archive/issue_comments_394356.json:
```json
{
    "body": "**Assignee:** @vinklein",
    "created_at": "2019-01-10T10:05:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394356",
    "user": "https://github.com/vinklein"
}
```

**Assignee:** @vinklein



---

archive/issue_comments_394357.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [@seblabbe](#comment%3A11):\n> \n> Somebody has a solution? (... one of them being getting rid of the report_hook thing)\n\nOthers `urlopen` usage in sage don't seems to display a kind of \"Download progress bar\" and in my opinion something like \"Loading started\" and \"Loading ended\" is enough for the verbose mode. It's still possible to implement a read chunk by chunk if it's really needed.\n\nEither way the remaining `report_hook` function and `cur` global variable should be removed from the code.",
    "created_at": "2019-01-10T10:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394357",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:17'></a>
Replying to [@seblabbe](#comment%3A11):
> 
> Somebody has a solution? (... one of them being getting rid of the report_hook thing)

Others `urlopen` usage in sage don't seems to display a kind of "Download progress bar" and in my opinion something like "Loading started" and "Loading ended" is enough for the verbose mode. It's still possible to implement a read chunk by chunk if it's really needed.

Either way the remaining `report_hook` function and `cur` global variable should be removed from the code.



---

archive/issue_events_308128.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-01-10T13:05:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308128"
}
```



---

archive/issue_events_308129.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-01-10T13:05:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308129"
}
```



---

archive/issue_comments_394358.json:
```json
{
    "body": "<a id='comment:18'></a>\nok",
    "created_at": "2019-01-10T13:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394358",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:18'></a>
ok



---

archive/issue_comments_394359.json:
```json
{
    "body": "**Remove assignee** @vinklein.",
    "created_at": "2019-01-10T13:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394359",
    "user": "https://github.com/vinklein"
}
```

**Remove assignee** @vinklein.



---

archive/issue_comments_394360.json:
```json
{
    "body": "<a id='comment:19'></a>\nI am ok with the rest of this ticket, i have no other remark.",
    "created_at": "2019-01-10T13:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394360",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:19'></a>
I am ok with the rest of this ticket, i have no other remark.



---

archive/issue_events_308130.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "milestone_number": null,
    "milestone_title": "sage-8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308130"
}
```



---

archive/issue_events_308131.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-01-15T18:15:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "milestone_number": null,
    "milestone_title": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308131"
}
```



---

archive/issue_comments_394361.json:
```json
{
    "body": "<a id='comment:20'></a>\nRetarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394361",
    "user": "https://github.com/embray"
}
```

<a id='comment:20'></a>
Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_394362.json:
```json
{
    "body": "**Changing commit** from \"[9e3c4f9ec5189c85561974072777d42b7c9b6fe7](https://github.com/sagemath/sagetrac-mirror/commit/9e3c4f9ec5189c85561974072777d42b7c9b6fe7)\" to \"[adeedb8cacfa38f4f4ad3580aa103aed646b0e0f](https://github.com/sagemath/sagetrac-mirror/commit/adeedb8cacfa38f4f4ad3580aa103aed646b0e0f)\".",
    "created_at": "2019-01-31T09:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394362",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[9e3c4f9ec5189c85561974072777d42b7c9b6fe7](https://github.com/sagemath/sagetrac-mirror/commit/9e3c4f9ec5189c85561974072777d42b7c9b6fe7)" to "[adeedb8cacfa38f4f4ad3580aa103aed646b0e0f](https://github.com/sagemath/sagetrac-mirror/commit/adeedb8cacfa38f4f4ad3580aa103aed646b0e0f)".



---

archive/issue_comments_394363.json:
```json
{
    "body": "<a id='comment:21'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abcdf872215b0147e991955bc30f58cad69ba3dd\">abcdf87</a></td><td><code>25535: specifying a User-Agent</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a105e03e0f70c74120d89ea696bd554e476e384\">0a105e0</a></td><td><code>25535: fixing doctest of get_remote_file function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4bfc4ae14db0bec7acdc8b6296d8940b0a10af8\">b4bfc4a</a></td><td><code>25535: removing urlretrieve command in comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/adeedb8cacfa38f4f4ad3580aa103aed646b0e0f\">adeedb8</a></td><td><code>25535: cleaning report_hook</code></td></tr></table>\n",
    "created_at": "2019-01-31T09:28:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394363",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abcdf872215b0147e991955bc30f58cad69ba3dd">abcdf87</a></td><td><code>25535: specifying a User-Agent</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a105e03e0f70c74120d89ea696bd554e476e384">0a105e0</a></td><td><code>25535: fixing doctest of get_remote_file function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4bfc4ae14db0bec7acdc8b6296d8940b0a10af8">b4bfc4a</a></td><td><code>25535: removing urlretrieve command in comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/adeedb8cacfa38f4f4ad3580aa103aed646b0e0f">adeedb8</a></td><td><code>25535: cleaning report_hook</code></td></tr></table>




---

archive/issue_comments_394364.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"thursdaysbdx\".",
    "created_at": "2019-01-31T09:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394364",
    "user": "https://github.com/seblabbe"
}
```

**Changing keywords** from "" to "thursdaysbdx".



---

archive/issue_comments_394365.json:
```json
{
    "body": "**Author:** S\u00e9bastien Labb\u00e9",
    "created_at": "2019-01-31T09:29:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394365",
    "user": "https://github.com/seblabbe"
}
```

**Author:** Sébastien Labbé



---

archive/issue_events_308132.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-01-31T09:29:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308132"
}
```



---

archive/issue_events_308133.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2019-01-31T09:29:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308133"
}
```



---

archive/issue_comments_394366.json:
```json
{
    "body": "<a id='comment:23'></a>\nLooks good to me.",
    "created_at": "2019-01-31T10:08:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394366",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:23'></a>
Looks good to me.



---

archive/issue_comments_394367.json:
```json
{
    "body": "**Reviewer:** Vincent Klein",
    "created_at": "2019-01-31T10:08:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394367",
    "user": "https://github.com/vinklein"
}
```

**Reviewer:** Vincent Klein



---

archive/issue_events_308134.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-01-31T10:08:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308134"
}
```



---

archive/issue_events_308135.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2019-01-31T10:08:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308135"
}
```



---

archive/issue_events_308136.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-02-03T09:00:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308136"
}
```



---

archive/issue_events_308137.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "544032489d36f62d70cb5c01d04f392d7b94c11a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2019-02-03T09:00:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25535#event-308137"
}
```



---

archive/issue_comments_394368.json:
```json
{
    "body": "**Changing branch** from \"[u/slabbe/25535](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/25535)\" to \"[adeedb8cacfa38f4f4ad3580aa103aed646b0e0f](https://github.com/sagemath/sagetrac-mirror/commit/adeedb8cacfa38f4f4ad3580aa103aed646b0e0f)\".",
    "created_at": "2019-02-03T09:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25535",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25535#issuecomment-394368",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/slabbe/25535](https://github.com/sagemath/sagetrac-mirror/tree/u/slabbe/25535)" to "[adeedb8cacfa38f4f4ad3580aa103aed646b0e0f](https://github.com/sagemath/sagetrac-mirror/commit/adeedb8cacfa38f4f4ad3580aa103aed646b0e0f)".
