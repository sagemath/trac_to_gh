# Issue 25457: Enter the components of a metric while declaring

archive/issues_025220.json:
```json
{
    "body": "The main purpose of this ticket is to give the possibility of entering the components of a metric while declaring this metric on a manifold.\n\nIn this ticket, there is a method which determine the signature of a metric. So it is no more necessary to give the signature of your metric while declaring, Sage is able to compute it! Therefore Sage would give the truth class of the declaring metric: Riemannian metric or Lorentzian metric or pseudo-Riemannian metric or degenerate metric.  \n\nCC:  @egourgoulhon\n\nKeywords: Manifold, Pseudo-Riemannian Metric, Degenerate Metric\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Hans Fotsing Tetsing\n\nBranch: public/manifolds/MetricComponents\n\nStatus: needs_work\n\nDependencies: 0\n\nCommit: f494678c9733967e0054169761dbff78ee4e9adc\n\nIssue created by migration from https://trac.sagemath.org/ticket/25457\n\n",
    "created_at": "2018-05-28T19:16:14Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Enter the components of a metric while declaring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25457",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```
The main purpose of this ticket is to give the possibility of entering the components of a metric while declaring this metric on a manifold.

In this ticket, there is a method which determine the signature of a metric. So it is no more necessary to give the signature of your metric while declaring, Sage is able to compute it! Therefore Sage would give the truth class of the declaring metric: Riemannian metric or Lorentzian metric or pseudo-Riemannian metric or degenerate metric.  

CC:  @egourgoulhon

Keywords: Manifold, Pseudo-Riemannian Metric, Degenerate Metric

Reviewer: Eric Gourgoulhon

Author: Hans Fotsing Tetsing

Branch: public/manifolds/MetricComponents

Status: needs_work

Dependencies: 0

Commit: f494678c9733967e0054169761dbff78ee4e9adc

Issue created by migration from https://trac.sagemath.org/ticket/25457





---

archive/issue_comments_486846.json:
```json
{
    "body": "Changing commit from \"52ea82102a5949b7f63f946ffd6f4a0ca34b21b8\" to \"7dfaad99c70403bbe39f9a483aabf07caecafc86\"",
    "created_at": "2018-05-28T21:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486846",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "52ea82102a5949b7f63f946ffd6f4a0ca34b21b8" to "7dfaad99c70403bbe39f9a483aabf07caecafc86"



---

archive/issue_comments_486847.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-28T21:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486848.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-30T14:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486848",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_486849.json:
```json
{
    "body": "Changing commit from \"7dfaad99c70403bbe39f9a483aabf07caecafc86\" to \"188a1c318a9e3d41b8b31a3c5a50c11e1df6089c\"",
    "created_at": "2018-05-31T11:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486849",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7dfaad99c70403bbe39f9a483aabf07caecafc86" to "188a1c318a9e3d41b8b31a3c5a50c11e1df6089c"



---

archive/issue_comments_486850.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-31T11:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486850",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486851.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-31T15:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486851",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486852.json:
```json
{
    "body": "Changing commit from \"188a1c318a9e3d41b8b31a3c5a50c11e1df6089c\" to \"33edd0effe892b9810273f5246c6ea3be2f055dc\"",
    "created_at": "2018-05-31T15:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486852",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "188a1c318a9e3d41b8b31a3c5a50c11e1df6089c" to "33edd0effe892b9810273f5246c6ea3be2f055dc"



---

archive/issue_comments_486853.json:
```json
{
    "body": "Changing commit from \"33edd0effe892b9810273f5246c6ea3be2f055dc\" to \"76e40c54d973dc8e4de40bf3dbd636e9d1359f5f\"",
    "created_at": "2018-05-31T17:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "33edd0effe892b9810273f5246c6ea3be2f055dc" to "76e40c54d973dc8e4de40bf3dbd636e9d1359f5f"



---

archive/issue_comments_486854.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-31T17:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486854",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486855.json:
```json
{
    "body": "<a id='comment:7'></a>Thanks for this contribution!\n\nAs you can see on the [patchbot report](https://patchbot.sagemath.org/ticket/25457/) \n(which you can get by clicking on the yellow question mark at the top right and then on the \"shortlog\" items), there are many doctest failures, mostly due to the change in handling the metric signature. Could you fix this please? Before submitting the change, you can make sure that all doctests are passed by running\n\n```\nsage -tp --long src/sage/manifolds/\n```\nIn case you need more information about the patchbot, see [here](https://wiki.sagemath.org/buildbot).",
    "created_at": "2018-06-03T21:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486855",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>Thanks for this contribution!

As you can see on the [patchbot report](https://patchbot.sagemath.org/ticket/25457/) 
(which you can get by clicking on the yellow question mark at the top right and then on the "shortlog" items), there are many doctest failures, mostly due to the change in handling the metric signature. Could you fix this please? Before submitting the change, you can make sure that all doctests are passed by running

```
sage -tp --long src/sage/manifolds/
```
In case you need more information about the patchbot, see [here](https://wiki.sagemath.org/buildbot).



---

archive/issue_comments_486856.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-03T21:36:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486856",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_486857.json:
```json
{
    "body": "<a id='comment:8'></a>New commits:",
    "created_at": "2018-06-06T04:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486857",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

<a id='comment:8'></a>New commits:



---

archive/issue_comments_486858.json:
```json
{
    "body": "Changing branch from \"public/manifolds/Metric\" to \"public/manifolds/MetricComponents\"",
    "created_at": "2018-06-06T04:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486858",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Changing branch from "public/manifolds/Metric" to "public/manifolds/MetricComponents"



---

archive/issue_comments_486859.json:
```json
{
    "body": "Changing commit from \"76e40c54d973dc8e4de40bf3dbd636e9d1359f5f\" to \"\"",
    "created_at": "2018-06-06T04:52:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486859",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Changing commit from "76e40c54d973dc8e4de40bf3dbd636e9d1359f5f" to ""



---

archive/issue_comments_486860.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-06T04:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486861.json:
```json
{
    "body": "Changing commit from \"\" to \"a406fe689953d5431fda8cb915c6ba0ba2d4fc62\"",
    "created_at": "2018-06-06T04:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "a406fe689953d5431fda8cb915c6ba0ba2d4fc62"



---

archive/issue_comments_486862.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-06T05:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486862",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_486863.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-12T12:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486863",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_486864.json:
```json
{
    "body": "<a id='comment:12'></a>A doctest fails:\n\n```\nsage -t --long --warn-long 49.9 src/sage/manifolds/differentiable/metric.py\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/metric.py\", line 1006, in sage.manifolds.differentiable.metric.PseudoRiemannianMetric.riemann\nFailed example:\n    g.riemann()[:]\nExpected:\n    [[[[0, 0], [0, 0]], [[0, sin(th)^2], [-sin(th)^2, 0]]],\n    [[[0, (cos(th)^2 - 1)/sin(th)^2], [1, 0]], [[0, 0], [0, 0]]]]\nGot:\n    [[[[0, 0], [0, 0]], [[0, sin(th)^2], [-sin(th)^2, 0]]],\n     [[[0, -1], [1, 0]], [[0, 0], [0, 0]]]]\n**********************************************************************\n1 item had failures:\n   1 of  15 in sage.manifolds.differentiable.metric.PseudoRiemannianMetric.riemann\n    [534 tests, 1 failure, 86.67 s]\n```\nBesides, the following doctest in line 168-170 of `src/sage/manifolds/differentiable/pseudo_riemannian.py`:\n\n```    \nsage: g = M.metric()\nsage: g\nRiemannian metric g on the 4-dimensional Lorentzian manifold M\n```\nis not correct: the output should be `Lorentzian metric` (as it was prior to this ticket), since `M` has been declared in line 158 as being a Lorentzian manifold. \n\nSimilarly, in lines 566-567 of the same file, the output of the doctest \n\n```\nsage: h = M.metric('h', signature=1); h\nRiemannian metric h on the 3-dimensional Riemannian manifold M\n```\nis not correct, since a signature of 1 on a 3-dimensional manifold implies a Lorentzian metric. \n\nIn the helper function `_diag` defined in line 1908 of `src/sage/manifolds/differentiable/metric.py`, it is quite unconventional to name the first argument `self` since `_diag` is not a class method. \n\nYou should not end docstring lines by a backslash character, as done in lines 1976-1982 of `metric.py`. \n\nThe documentation fails to build: the command\n\n```\n./sage -docbuild reference/manifolds html\n```\nreturns errors like\n\n```\ndocstring of sage.manifolds.differentiable.metric.PseudoRiemannianMetricParal.index:7: \nWARNING: Bullet list ends without a blank line; unexpected unindent.\n```",
    "created_at": "2018-06-12T12:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486864",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:12'></a>A doctest fails:

```
sage -t --long --warn-long 49.9 src/sage/manifolds/differentiable/metric.py
**********************************************************************
File "src/sage/manifolds/differentiable/metric.py", line 1006, in sage.manifolds.differentiable.metric.PseudoRiemannianMetric.riemann
Failed example:
    g.riemann()[:]
Expected:
    [[[[0, 0], [0, 0]], [[0, sin(th)^2], [-sin(th)^2, 0]]],
    [[[0, (cos(th)^2 - 1)/sin(th)^2], [1, 0]], [[0, 0], [0, 0]]]]
Got:
    [[[[0, 0], [0, 0]], [[0, sin(th)^2], [-sin(th)^2, 0]]],
     [[[0, -1], [1, 0]], [[0, 0], [0, 0]]]]
**********************************************************************
1 item had failures:
   1 of  15 in sage.manifolds.differentiable.metric.PseudoRiemannianMetric.riemann
    [534 tests, 1 failure, 86.67 s]
```
Besides, the following doctest in line 168-170 of `src/sage/manifolds/differentiable/pseudo_riemannian.py`:

```    
sage: g = M.metric()
sage: g
Riemannian metric g on the 4-dimensional Lorentzian manifold M
```
is not correct: the output should be `Lorentzian metric` (as it was prior to this ticket), since `M` has been declared in line 158 as being a Lorentzian manifold. 

Similarly, in lines 566-567 of the same file, the output of the doctest 

```
sage: h = M.metric('h', signature=1); h
Riemannian metric h on the 3-dimensional Riemannian manifold M
```
is not correct, since a signature of 1 on a 3-dimensional manifold implies a Lorentzian metric. 

In the helper function `_diag` defined in line 1908 of `src/sage/manifolds/differentiable/metric.py`, it is quite unconventional to name the first argument `self` since `_diag` is not a class method. 

You should not end docstring lines by a backslash character, as done in lines 1976-1982 of `metric.py`. 

The documentation fails to build: the command

```
./sage -docbuild reference/manifolds html
```
returns errors like

```
docstring of sage.manifolds.differentiable.metric.PseudoRiemannianMetricParal.index:7: 
WARNING: Bullet list ends without a blank line; unexpected unindent.
```



---

archive/issue_comments_486865.json:
```json
{
    "body": "<a id='comment:13'></a>Another point: you should fill the *Description* field of this ticket, to tell what it is about.",
    "created_at": "2018-06-12T13:10:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486865",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:13'></a>Another point: you should fill the *Description* field of this ticket, to tell what it is about.



---

archive/issue_comments_486866.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-15T17:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486867.json:
```json
{
    "body": "Changing commit from \"a406fe689953d5431fda8cb915c6ba0ba2d4fc62\" to \"a6071cbff670f43afdd8b5bc62e6c44fa62f2467\"",
    "created_at": "2018-06-15T17:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a406fe689953d5431fda8cb915c6ba0ba2d4fc62" to "a6071cbff670f43afdd8b5bc62e6c44fa62f2467"



---

archive/issue_comments_486868.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n+The main purpose of this ticket is to give the possibility of entering the components of a metric while declaring this metric on a parallelizable manifold.\n \n-\n-Keywords: Parallelizable Manifold, Pseudo-Riemannian Metric, Degenerate Metric\n+In this ticket, there is a method which determine the signature of a metric. So it is no more necessary to give the signature of your metric while declaring, Sage is able to compute it! Therefore Sage would give the truth class of the declaring metric: Riemannian metric or Lorentzian metric or pseudo-Riemannian metric or degenerate metric.  \n \n Reviewer: Eric Gourgoulhon\n \n``````\n",
    "created_at": "2018-06-15T17:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486868",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
+The main purpose of this ticket is to give the possibility of entering the components of a metric while declaring this metric on a parallelizable manifold.
 
-
-Keywords: Parallelizable Manifold, Pseudo-Riemannian Metric, Degenerate Metric
+In this ticket, there is a method which determine the signature of a metric. So it is no more necessary to give the signature of your metric while declaring, Sage is able to compute it! Therefore Sage would give the truth class of the declaring metric: Riemannian metric or Lorentzian metric or pseudo-Riemannian metric or degenerate metric.  
 
 Reviewer: Eric Gourgoulhon
 
``````




---

archive/issue_comments_486869.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-15T17:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486869",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_486870.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-18T19:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486871.json:
```json
{
    "body": "Changing commit from \"a6071cbff670f43afdd8b5bc62e6c44fa62f2467\" to \"cae28a718d0cd7c9fe7b867855b84caaa6c83919\"",
    "created_at": "2018-06-18T19:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a6071cbff670f43afdd8b5bc62e6c44fa62f2467" to "cae28a718d0cd7c9fe7b867855b84caaa6c83919"



---

archive/issue_comments_486872.json:
```json
{
    "body": "<a id='comment:17'></a>I've pushed to the ticket branch a commit with small tweaks, which\n- correct errors in the documentation building\n- correct the doctest failure mentioned in comment:12 (trigonometric simplification)\n- apply some coding style along the recommended [PEP 8 conventions](https://www.python.org/dev/peps/pep-0008/), in particular: *\"The preferred way of wrapping long lines is by using Python's implied line continuation inside parentheses, brackets and braces. Long lines can be broken over multiple lines by wrapping expressions in parentheses. These should be used in preference to using a backslash for line continuation.\"*\n\nTo see all my changes, click on [cae28a7](https://git.sagemath.org/sage.git/commit/?id=cae28a718d0cd7c9fe7b867855b84caaa6c83919) in comment:16.\n\nThere are still some points that must be discussed or fixed: \n\n- At the moment, if no metric components are provided at some metric declaration (i.e. if `comp` is `None`), this defaults to initializing the metric components to  `diag(1,1,...,1)`. It would be preferable to left the components uninitialized instead, especially if the default chart is not of Cartesian type. I think we can make both behaviors (the previous one, with no components preinitialized, and the new one, with components set via the argument `comp=...`) coexist nicely\n- Since the argument `comp` is implemented only in `PseudoRiemannianMetricParal.__init__`, there is a difference of behavior between parallelizable manifolds and non-parallelizable ones; the argument `comp` has been added to `VectorFieldModule.metric` but is totally unused there. \n- Even on parallelizable manifolds, what if more than one chart is required to cover the manifold, like for instance **S**<sup>1</sup> or **S**<sup>3</sup> ?\n- The issue with the naming of the first argument of `_diag` mentioned in comment:12 is not addressed\n- The argument `comp` should be documented everywhere it has been added (e.g. in `VectorFieldFreeModule.metric`)",
    "created_at": "2018-06-18T19:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486872",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:17'></a>I've pushed to the ticket branch a commit with small tweaks, which
- correct errors in the documentation building
- correct the doctest failure mentioned in comment:12 (trigonometric simplification)
- apply some coding style along the recommended [PEP 8 conventions](https://www.python.org/dev/peps/pep-0008/), in particular: *"The preferred way of wrapping long lines is by using Python's implied line continuation inside parentheses, brackets and braces. Long lines can be broken over multiple lines by wrapping expressions in parentheses. These should be used in preference to using a backslash for line continuation."*

To see all my changes, click on [cae28a7](https://git.sagemath.org/sage.git/commit/?id=cae28a718d0cd7c9fe7b867855b84caaa6c83919) in comment:16.

There are still some points that must be discussed or fixed: 

- At the moment, if no metric components are provided at some metric declaration (i.e. if `comp` is `None`), this defaults to initializing the metric components to  `diag(1,1,...,1)`. It would be preferable to left the components uninitialized instead, especially if the default chart is not of Cartesian type. I think we can make both behaviors (the previous one, with no components preinitialized, and the new one, with components set via the argument `comp=...`) coexist nicely
- Since the argument `comp` is implemented only in `PseudoRiemannianMetricParal.__init__`, there is a difference of behavior between parallelizable manifolds and non-parallelizable ones; the argument `comp` has been added to `VectorFieldModule.metric` but is totally unused there. 
- Even on parallelizable manifolds, what if more than one chart is required to cover the manifold, like for instance **S**<sup>1</sup> or **S**<sup>3</sup> ?
- The issue with the naming of the first argument of `_diag` mentioned in comment:12 is not addressed
- The argument `comp` should be documented everywhere it has been added (e.g. in `VectorFieldFreeModule.metric`)



---

archive/issue_comments_486873.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-18T19:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486873",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_486874.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-27T17:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486874",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_486875.json:
```json
{
    "body": "Changing commit from \"cae28a718d0cd7c9fe7b867855b84caaa6c83919\" to \"f494678c9733967e0054169761dbff78ee4e9adc\"",
    "created_at": "2018-06-27T17:22:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486875",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "cae28a718d0cd7c9fe7b867855b84caaa6c83919" to "f494678c9733967e0054169761dbff78ee4e9adc"



---

archive/issue_comments_486876.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-27T17:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486876",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_486877.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+The main purpose of this ticket is to give the possibility of entering the components of a metric while declaring this metric on a manifold.\n \n+In this ticket, there is a method which determine the signature of a metric. So it is no more necessary to give the signature of your metric while declaring, Sage is able to compute it! Therefore Sage would give the truth class of the declaring metric: Riemannian metric or Lorentzian metric or pseudo-Riemannian metric or degenerate metric.  \n \n Reviewer: Eric Gourgoulhon\n \n``````\n",
    "created_at": "2018-06-27T17:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486877",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+The main purpose of this ticket is to give the possibility of entering the components of a metric while declaring this metric on a manifold.
 
+In this ticket, there is a method which determine the signature of a metric. So it is no more necessary to give the signature of your metric while declaring, Sage is able to compute it! Therefore Sage would give the truth class of the declaring metric: Riemannian metric or Lorentzian metric or pseudo-Riemannian metric or degenerate metric.  
 
 Reviewer: Eric Gourgoulhon
 
``````




---

archive/issue_comments_486878.json:
```json
{
    "body": "Changing keywords from \"Parallelizable Manifold, Pseudo-Riemannian Metric, Degenerate Metric\" to \"Manifold, Pseudo-Riemannian Metric, Degenerate Metric\".",
    "created_at": "2018-06-27T17:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486878",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Changing keywords from "Parallelizable Manifold, Pseudo-Riemannian Metric, Degenerate Metric" to "Manifold, Pseudo-Riemannian Metric, Degenerate Metric".



---

archive/issue_comments_486879.json:
```json
{
    "body": "Changing author from \"Hans FOTSING TETSING\" to \"Hans Fotsing Tetsing\"",
    "created_at": "2018-06-27T17:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486879",
    "user": "https://trac.sagemath.org/admin/accounts/users/Dicolevrai"
}
```

Changing author from "Hans FOTSING TETSING" to "Hans Fotsing Tetsing"



---

archive/issue_comments_486880.json:
```json
{
    "body": "<a id='comment:20'></a>There are various issues:\n- The doctest time of `metric.py` is too long: on my computer, running\n\n```\nsage -t --long src/sage/manifolds/differentiable/metric.py\n```\nyields a total CPU time of 144.2 s, while with Sage 8.3.rc0 (i.e. outside the ticket branch) it is only of 62.3 s. Such an increase of doctest time is not acceptable, especially for a new functionality, which in principle, does not require much computing.\nOne can see the culprits by running\n\n```\nsage -t --long --warn-long 5 src/sage/manifolds/differentiable/metric.py\n```\nwhich reports the doctests running for more than 5 s. They are the doctests involving a metric on the sphere, with the components given in 6 charts. Why do you choose such a lengthy example? It is also very long, and thus not pleasant to read, in the html documentation.\n\n- In line 726 of `levi_civita_connection.py`, you have changed the output of the doctest by replacing `Lorentzian metric` by `Riemannian metric` (so that the doctest is passed), but this not correct since the metric has been declared as Lorentzian a few lines above. Actually this reveals that the handling of metric signatures must be entirely rethinked after the introduction of your function for computing the signature (previously, there was only the concept of \"user declared signature\"). This is out of the scope of this ticket and I will open a new ticket for this.\n\n- The method `sign()` should return a tuple, and not a list, since the signature is intended to be immutable.\n\n- The documentation does not build, due to a spurious `u99` inserted in line 3216 of `src/sage/manifolds/differentiable/manifold.py`. On general grounds, please check that the documentation builds correctly, via\n\n```\nsage -docbuild reference/manifolds html\n```\nand that the html output is OK, before submitting a ticket for review.",
    "created_at": "2018-07-25T15:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486880",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:20'></a>There are various issues:
- The doctest time of `metric.py` is too long: on my computer, running

```
sage -t --long src/sage/manifolds/differentiable/metric.py
```
yields a total CPU time of 144.2 s, while with Sage 8.3.rc0 (i.e. outside the ticket branch) it is only of 62.3 s. Such an increase of doctest time is not acceptable, especially for a new functionality, which in principle, does not require much computing.
One can see the culprits by running

```
sage -t --long --warn-long 5 src/sage/manifolds/differentiable/metric.py
```
which reports the doctests running for more than 5 s. They are the doctests involving a metric on the sphere, with the components given in 6 charts. Why do you choose such a lengthy example? It is also very long, and thus not pleasant to read, in the html documentation.

- In line 726 of `levi_civita_connection.py`, you have changed the output of the doctest by replacing `Lorentzian metric` by `Riemannian metric` (so that the doctest is passed), but this not correct since the metric has been declared as Lorentzian a few lines above. Actually this reveals that the handling of metric signatures must be entirely rethinked after the introduction of your function for computing the signature (previously, there was only the concept of "user declared signature"). This is out of the scope of this ticket and I will open a new ticket for this.

- The method `sign()` should return a tuple, and not a list, since the signature is intended to be immutable.

- The documentation does not build, due to a spurious `u99` inserted in line 3216 of `src/sage/manifolds/differentiable/manifold.py`. On general grounds, please check that the documentation builds correctly, via

```
sage -docbuild reference/manifolds html
```
and that the html output is OK, before submitting a ticket for review.



---

archive/issue_comments_486881.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-25T15:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25457",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25457#issuecomment-486881",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.
