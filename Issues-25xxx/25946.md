# Issue 25946: py3: fixes for sage.schemes.hyperelliptic_curves

archive/issues_025709.json:
```json
{
    "body": "The main thing needed here was a `__hash__`.\nOr removing `__eq__` and `__ne__`\n\nPart of #24551\n\n**CC:**  @bhutz @JohnCremona @roed314\n\n**Keywords:** sagedays@icerm\n\n**Branch/Commit:** [f8687f7d8800aede97e36d4da30ae79da895b5f7](https://github.com/sagemath/sagetrac-mirror/commit/f8687f7d8800aede97e36d4da30ae79da895b5f7)\n\n**Reviewer:** Travis Scrimshaw, David Roe\n\n**Author:** Erik Bray\n\nIssue created by migration from https://trac.sagemath.org/ticket/25946\n\n",
    "closed_at": "2018-08-17T21:14:06Z",
    "created_at": "2018-07-27T10:26:47Z",
    "labels": [
        "component: python3",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "title": "py3: fixes for sage.schemes.hyperelliptic_curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/25946",
    "user": "https://github.com/embray"
}
```
The main thing needed here was a `__hash__`.
Or removing `__eq__` and `__ne__`

Part of #24551

**CC:**  @bhutz @JohnCremona @roed314

**Keywords:** sagedays@icerm

**Branch/Commit:** [f8687f7d8800aede97e36d4da30ae79da895b5f7](https://github.com/sagemath/sagetrac-mirror/commit/f8687f7d8800aede97e36d4da30ae79da895b5f7)

**Reviewer:** Travis Scrimshaw, David Roe

**Author:** Erik Bray

Issue created by migration from https://trac.sagemath.org/ticket/25946





---

archive/issue_events_230203.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-27T10:27:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230203"
}
```



---

archive/issue_comments_402038.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-07-27T12:53:38Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402038",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_events_230204.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-27T12:53:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230204"
}
```



---

archive/issue_events_230205.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-07-27T12:53:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230205"
}
```



---

archive/issue_comments_402039.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sagedays@icerm\".",
    "created_at": "2018-07-27T12:53:38Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402039",
    "user": "https://github.com/tscrim"
}
```

**Changing keywords** from "" to "sagedays@icerm".



---

archive/issue_comments_402040.json:
```json
{
    "body": "<a id='comment:2'></a>\nYou have too much data in your `__hash__`:\n\n```\nsage: P.<x> = QQ[]\nsage: f0 = 4*x^5 - 30*x^3 + 45*x - 22\nsage: C0 = HyperellipticCurve(f0)\nsage: P.<x> = RR[]\nsage: f1 = 4*x^5 - 30*x^3 + 45*x - 22\nsage: C1 = HyperellipticCurve(f1)\nsage: C1 == C0\nTrue\nsage: hash(C1) == hash(C0)\nFalse\n```\nSo you definitely have to remove `_PP` from the hash, and I would probably remove both the `__class__` as subclasses are not used in the `__eq__` comparison.",
    "created_at": "2018-07-27T12:53:38Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402040",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:2'></a>
You have too much data in your `__hash__`:

```
sage: P.<x> = QQ[]
sage: f0 = 4*x^5 - 30*x^3 + 45*x - 22
sage: C0 = HyperellipticCurve(f0)
sage: P.<x> = RR[]
sage: f1 = 4*x^5 - 30*x^3 + 45*x - 22
sage: C1 = HyperellipticCurve(f1)
sage: C1 == C0
True
sage: hash(C1) == hash(C0)
False
```
So you definitely have to remove `_PP` from the hash, and I would probably remove both the `__class__` as subclasses are not used in the `__eq__` comparison.



---

archive/issue_comments_402041.json:
```json
{
    "body": "<a id='comment:3'></a>\nI'm not 100% sure about that.  I'd need to double-check what the intention is here.  On Python 2 it was inheriting the flimsy default `__hash__` from `CategoryObject` that just hashes its `__repr__`.  So for this case I was including essentially the same data in the hash that would be needed to differentiate the reprs of two of these objects.\n\nBut maybe that's not necessary.  It just wasn't clear what the intent was (if any) due to the default hash...",
    "created_at": "2018-07-27T14:17:44Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402041",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
I'm not 100% sure about that.  I'd need to double-check what the intention is here.  On Python 2 it was inheriting the flimsy default `__hash__` from `CategoryObject` that just hashes its `__repr__`.  So for this case I was including essentially the same data in the hash that would be needed to differentiate the reprs of two of these objects.

But maybe that's not necessary.  It just wasn't clear what the intent was (if any) due to the default hash...



---

archive/issue_events_230206.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-27T14:17:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230206"
}
```



---

archive/issue_events_230207.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-27T14:17:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230207"
}
```



---

archive/issue_comments_402042.json:
```json
{
    "body": "<a id='comment:5'></a>\nI completely agree the `repr` hash is bad. I think the data used for equality should be what is used for the `__hash__`, not more. From what you're saying, it seems like we are actually fixing a bug if we only hash `self._hyperelliptic_polynomials`.\n\nMy understanding behind the default hash is that every object has a `repr` and generally two objects that compare equal have equal `repr` output.\n\nI don't use/know this code, so we probably have to ask someone who understands it better to confirm if you're worried enough.",
    "created_at": "2018-07-27T14:41:08Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402042",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
I completely agree the `repr` hash is bad. I think the data used for equality should be what is used for the `__hash__`, not more. From what you're saying, it seems like we are actually fixing a bug if we only hash `self._hyperelliptic_polynomials`.

My understanding behind the default hash is that every object has a `repr` and generally two objects that compare equal have equal `repr` output.

I don't use/know this code, so we probably have to ask someone who understands it better to confirm if you're worried enough.



---

archive/issue_comments_402043.json:
```json
{
    "body": "<a id='comment:6'></a>\nI could certainly try a simpler repr to start with and see what happens.  If that works, then I agree with you we should just use what `__eq__` compares.",
    "created_at": "2018-07-27T14:43:28Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402043",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
I could certainly try a simpler repr to start with and see what happens.  If that works, then I agree with you we should just use what `__eq__` compares.



---

archive/issue_comments_402044.json:
```json
{
    "body": "<a id='comment:7'></a>\nSounds good. Thanks.",
    "created_at": "2018-07-27T14:45:00Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402044",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
Sounds good. Thanks.



---

archive/issue_comments_402045.json:
```json
{
    "body": "<a id='comment:8'></a>\nany progress here ?",
    "created_at": "2018-08-10T07:19:57Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402045",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
any progress here ?



---

archive/issue_comments_402046.json:
```json
{
    "body": "<a id='comment:9'></a>\nI mean, clearly not.  I'd prefer if someone who knew this code were to chime in, but otherwise I'll get to it if/when I feel like taking the time to understand this code better.",
    "created_at": "2018-08-10T09:30:25Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402046",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
I mean, clearly not.  I'd prefer if someone who knew this code were to chime in, but otherwise I'll get to it if/when I feel like taking the time to understand this code better.



---

archive/issue_comments_402047.json:
```json
{
    "body": "<a id='comment:10'></a>\nTo be clear, I also agree with everything Travis wrote on this ticket; I'm just not in a rush to act on it because I don't feel qualified to make that judgment call w.r.t. this code.",
    "created_at": "2018-08-10T09:33:03Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402047",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
To be clear, I also agree with everything Travis wrote on this ticket; I'm just not in a rush to act on it because I don't feel qualified to make that judgment call w.r.t. this code.



---

archive/issue_comments_402048.json:
```json
{
    "body": "<a id='comment:11'></a>\nBen, do you know about this code or know who we should cc?",
    "created_at": "2018-08-10T09:52:02Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402048",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
Ben, do you know about this code or know who we should cc?



---

archive/issue_comments_402049.json:
```json
{
    "body": "<a id='comment:12'></a>\nI'm not familiar with this code. John may know.",
    "created_at": "2018-08-10T13:03:27Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402049",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:12'></a>
I'm not familiar with this code. John may know.



---

archive/issue_comments_402050.json:
```json
{
    "body": "<a id='comment:13'></a>\nI don't know or use the code (except perhaps occasionally) and so I do not really understand the issue here.  I don't think that I have ever written such a has function so do not know what properties it is supposed to have.\n\nWhat exactly was the problem which this patch is intended to fix?",
    "created_at": "2018-08-10T14:07:23Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402050",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:13'></a>
I don't know or use the code (except perhaps occasionally) and so I do not really understand the issue here.  I don't think that I have ever written such a has function so do not know what properties it is supposed to have.

What exactly was the problem which this patch is intended to fix?



---

archive/issue_comments_402051.json:
```json
{
    "body": "<a id='comment:14'></a>\nI'm really confused about whether or not we should call these hyperelliptic curves equal in the first place. The current code returns true because the polynomials are equal which is because both variables are named `x` even though they are over different fields, are two curves over different fields really `_equal_`, even if one is just a base change of the other? For contrast\n\n```\nsage: P.<x,y>= RR[]\nsage: C0 = Curve(y - x^2  - 1)\nsage: C0\nAffine Plane Curve over Real Field with 53 bits of precision defined by -x^2 + y - 1.00000000000000\nsage: P.<x,y>= QQ[]\nsage: C1 = Curve(y - x^2  - 1)\nsage: C1\nAffine Plane Curve over Rational Field defined by -x^2 + y - 1\nsage: C0 == C1\nFalse\n```",
    "created_at": "2018-08-10T15:45:38Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402051",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:14'></a>
I'm really confused about whether or not we should call these hyperelliptic curves equal in the first place. The current code returns true because the polynomials are equal which is because both variables are named `x` even though they are over different fields, are two curves over different fields really `_equal_`, even if one is just a base change of the other? For contrast

```
sage: P.<x,y>= RR[]
sage: C0 = Curve(y - x^2  - 1)
sage: C0
Affine Plane Curve over Real Field with 53 bits of precision defined by -x^2 + y - 1.00000000000000
sage: P.<x,y>= QQ[]
sage: C1 = Curve(y - x^2  - 1)
sage: C1
Affine Plane Curve over Rational Field defined by -x^2 + y - 1
sage: C0 == C1
False
```



---

archive/issue_comments_402052.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [alexjbest](#comment%3A14):\n> I'm really confused about whether or not we should call these hyperelliptic curves equal in the first place. The current code returns true because the polynomials are equal which is because both variables are named `x` even though they are over different fields, are two curves over different fields really `_equal_`, even if one is just a base change of the other?\n\n\nI had the same doubt before.  There's some inconsistency throughout Sage about when some objects defined over different fields are considered equal under `==`.  In some cases it's quite deliberate, in other cases it's not clear until and unless the original author chimes in.  If the author isn't even sure I would lean against calling them `==`, much less having the same hash.",
    "created_at": "2018-08-10T15:59:10Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402052",
    "user": "https://github.com/embray"
}
```

<a id='comment:15'></a>
Replying to [alexjbest](#comment%3A14):
> I'm really confused about whether or not we should call these hyperelliptic curves equal in the first place. The current code returns true because the polynomials are equal which is because both variables are named `x` even though they are over different fields, are two curves over different fields really `_equal_`, even if one is just a base change of the other?


I had the same doubt before.  There's some inconsistency throughout Sage about when some objects defined over different fields are considered equal under `==`.  In some cases it's quite deliberate, in other cases it's not clear until and unless the original author chimes in.  If the author isn't even sure I would lean against calling them `==`, much less having the same hash.



---

archive/issue_comments_402053.json:
```json
{
    "body": "<a id='comment:16'></a>\nI agree with Alex: to be equal the fields of definition should equal and the defining polynomials identical.  This is the case with elliptic curves:\n\n```\nsage: E = EllipticCurve([0,1])\nsage: E\nElliptic Curve defined by y^2 = x^3 + 1 over Rational Field\nsage: K.<i> = NumberField(x^2+1)\nsage: EK = E.change_ring(K)\nsage: EK\nElliptic Curve defined by y^2 = x^3 + 1 over Number Field in i with defining polynomial x^2 + 1\nsage: E == EK\nFalse\nsage: hash(E)\n8741953973726\nsage: hash(EK)\n8741951786400\n```\nI don't know what this hash function actually does: it calls hash_by_id, whatever that is.  I also don't know how to find out what function is being called by E==EK either!",
    "created_at": "2018-08-10T16:11:19Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402053",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:16'></a>
I agree with Alex: to be equal the fields of definition should equal and the defining polynomials identical.  This is the case with elliptic curves:

```
sage: E = EllipticCurve([0,1])
sage: E
Elliptic Curve defined by y^2 = x^3 + 1 over Rational Field
sage: K.<i> = NumberField(x^2+1)
sage: EK = E.change_ring(K)
sage: EK
Elliptic Curve defined by y^2 = x^3 + 1 over Number Field in i with defining polynomial x^2 + 1
sage: E == EK
False
sage: hash(E)
8741953973726
sage: hash(EK)
8741951786400
```
I don't know what this hash function actually does: it calls hash_by_id, whatever that is.  I also don't know how to find out what function is being called by E==EK either!



---

archive/issue_comments_402054.json:
```json
{
    "body": "<a id='comment:17'></a>\n`EllipticCurve` is a `UniqueFactory`, so the input (i.e., in part, the field) uniquely identifies the curve. So the `hash` and `==` is obtained by using `id` as there is a unique such object in memory at a given time. Changing the hyperelliptic to suppose the `UniqueRepresentation`-type behavior would be a very invasive and complicated surgery I think.\n\nSo the short-term fix IMO would be deciding an appropriate notion of `__eq__`, and then changing the `__hash__` to match. From what John is saying, we should also introduce a check that the defining fields are equal.\n\nAlso, from `git blame`, \"Nick Alexander\" and \"tornaria\" comes up a lot and David Kohel is listed in the copyright.",
    "created_at": "2018-08-10T23:17:52Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402054",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'></a>
`EllipticCurve` is a `UniqueFactory`, so the input (i.e., in part, the field) uniquely identifies the curve. So the `hash` and `==` is obtained by using `id` as there is a unique such object in memory at a given time. Changing the hyperelliptic to suppose the `UniqueRepresentation`-type behavior would be a very invasive and complicated surgery I think.

So the short-term fix IMO would be deciding an appropriate notion of `__eq__`, and then changing the `__hash__` to match. From what John is saying, we should also introduce a check that the defining fields are equal.

Also, from `git blame`, "Nick Alexander" and "tornaria" comes up a lot and David Kohel is listed in the copyright.



---

archive/issue_events_230208.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-08-14T08:05:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "needs info",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230208"
}
```



---

archive/issue_events_230209.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-08-14T08:05:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230209"
}
```



---

archive/issue_comments_402055.json:
```json
{
    "body": "**Changing commit** from \"[cb04ceb814b625383bce962fed09e39e7fa04184](https://github.com/sagemath/sagetrac-mirror/commit/cb04ceb814b625383bce962fed09e39e7fa04184)\" to \"[78ae9220be1f5279f1766ec78f597bb4634b69e2](https://github.com/sagemath/sagetrac-mirror/commit/78ae9220be1f5279f1766ec78f597bb4634b69e2)\".",
    "created_at": "2018-08-14T08:05:55Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402055",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[cb04ceb814b625383bce962fed09e39e7fa04184](https://github.com/sagemath/sagetrac-mirror/commit/cb04ceb814b625383bce962fed09e39e7fa04184)" to "[78ae9220be1f5279f1766ec78f597bb4634b69e2](https://github.com/sagemath/sagetrac-mirror/commit/78ae9220be1f5279f1766ec78f597bb4634b69e2)".



---

archive/issue_comments_402056.json:
```json
{
    "body": "<a id='comment:18'></a>\nI propose a solution : simply remove `__eq__`, `__ne__` and `__hash__` here.\n\nThen they are all provided by the general setting of projective subschemes, which seems to be a good idea. This will compare ambient spaces and defining ideals, which amount to compare base field and polynomials.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2726198f766abcf045d53b94c3b0ef9f563de1bf\">2726198</a></td><td><code>Merge branch 'u/embray/python3/sage-schemes-hyperelliptic_curves/misc' of ssh://trac.sagemath.org:22/sage into 8.4.b0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78ae9220be1f5279f1766ec78f597bb4634b69e2\">78ae922</a></td><td><code>py3: comparison and hash cleanup for hyperellliptic curves</code></td></tr></table>\n",
    "created_at": "2018-08-14T08:05:55Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402056",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>
I propose a solution : simply remove `__eq__`, `__ne__` and `__hash__` here.

Then they are all provided by the general setting of projective subschemes, which seems to be a good idea. This will compare ambient spaces and defining ideals, which amount to compare base field and polynomials.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2726198f766abcf045d53b94c3b0ef9f563de1bf">2726198</a></td><td><code>Merge branch 'u/embray/python3/sage-schemes-hyperelliptic_curves/misc' of ssh://trac.sagemath.org:22/sage into 8.4.b0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78ae9220be1f5279f1766ec78f597bb4634b69e2">78ae922</a></td><td><code>py3: comparison and hash cleanup for hyperellliptic curves</code></td></tr></table>




---

archive/issue_comments_402057.json:
```json
{
    "body": "**Changing branch** from \"[u/embray/python3/sage-schemes-hyperelliptic_curves/misc](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-schemes-hyperelliptic_curves/misc)\" to \"[public/25946](https://github.com/sagemath/sagetrac-mirror/tree/public/25946)\".",
    "created_at": "2018-08-14T08:05:55Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402057",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[u/embray/python3/sage-schemes-hyperelliptic_curves/misc](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/python3/sage-schemes-hyperelliptic_curves/misc)" to "[public/25946](https://github.com/sagemath/sagetrac-mirror/tree/public/25946)".



---

archive/issue_comments_402058.json:
```json
{
    "body": "<a id='comment:19'></a>\nThat sounds very sensible to me -- I do not know why the person who implemented these special functions thought it was necessary to override those of the parent class.\n\nAs far as I am concerned this is good to merge assuming that tests all pass.",
    "created_at": "2018-08-14T08:20:14Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402058",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:19'></a>
That sounds very sensible to me -- I do not know why the person who implemented these special functions thought it was necessary to override those of the parent class.

As far as I am concerned this is good to merge assuming that tests all pass.



---

archive/issue_comments_402059.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n-The main thing need here was a `__hash__`.\n+The main thing needed here was a `__hash__`.\n+Or removing `__eq__` and `__ne__`\n+\n+Part of #24551\n``````\n",
    "created_at": "2018-08-14T09:05:24Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402059",
    "user": "https://github.com/fchapoton"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,4 @@
-The main thing need here was a `__hash__`.
+The main thing needed here was a `__hash__`.
+Or removing `__eq__` and `__ne__`
+
+Part of #24551
``````




---

archive/issue_comments_402060.json:
```json
{
    "body": "<a id='comment:21'></a>\nfailing doctests in hyperelliptic_padic_field.py (sigh)",
    "created_at": "2018-08-14T11:42:50Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402060",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:21'></a>
failing doctests in hyperelliptic_padic_field.py (sigh)



---

archive/issue_comments_402061.json:
```json
{
    "body": "<a id='comment:22'></a>\nThis seems like a reasonable approach, but it seems that you exposed a poor assumption that was made somewhere else.  I don't know what a `sage.rings.padics.padic_ZZ_pX_CR_element.pAdicZZpXCRElement` is, or why it isn't hashable.  Perhaps it should be?\n\nIf it definitely shouldn't be hashable (e.g. it is not immutable) then maybe the problem is in `MPolynomialIdeal.__richcmp__`'s assumption that the generators of an ideal are definitely hashable (and if not, it should do something else to compare gens).",
    "created_at": "2018-08-14T12:16:59Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402061",
    "user": "https://github.com/embray"
}
```

<a id='comment:22'></a>
This seems like a reasonable approach, but it seems that you exposed a poor assumption that was made somewhere else.  I don't know what a `sage.rings.padics.padic_ZZ_pX_CR_element.pAdicZZpXCRElement` is, or why it isn't hashable.  Perhaps it should be?

If it definitely shouldn't be hashable (e.g. it is not immutable) then maybe the problem is in `MPolynomialIdeal.__richcmp__`'s assumption that the generators of an ideal are definitely hashable (and if not, it should do something else to compare gens).



---

archive/issue_comments_402062.json:
```json
{
    "body": "<a id='comment:23'></a>\nThere is a `_cache_key` method on these objects inside `src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx`\n\nBut its doc claims that there is no reasonable hash..",
    "created_at": "2018-08-14T12:22:40Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402062",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:23'></a>
There is a `_cache_key` method on these objects inside `src/sage/rings/padics/padic_ZZ_pX_CR_element.pyx`

But its doc claims that there is no reasonable hash..



---

archive/issue_comments_402063.json:
```json
{
    "body": "<a id='comment:24'></a>\nAdding David Roe in CC since he may be able to throw light on the p-adic ring issue.  Note that p-adic rings (as with the reals) are not exact, so comparison between elements is not so easy.",
    "created_at": "2018-08-14T12:33:01Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402063",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:24'></a>
Adding David Roe in CC since he may be able to throw light on the p-adic ring issue.  Note that p-adic rings (as with the reals) are not exact, so comparison between elements is not so easy.



---

archive/issue_comments_402064.json:
```json
{
    "body": "<a id='comment:25'></a>\nIncidentally, `MPolynomialIdeal.__richcmp__` was last touched by #23920.  The idea to use sets to compare gens was from Travis: ticket:23920#comment:9\n\nPerhaps there should be a try/except around this and attempt direct comparison if comparing by sets raises a `TypeError`.  I'm not sure what the impact is of computing a Groebner basis, or if it can be avoided in some other way as well.",
    "created_at": "2018-08-14T12:33:59Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402064",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>
Incidentally, `MPolynomialIdeal.__richcmp__` was last touched by #23920.  The idea to use sets to compare gens was from Travis: ticket:23920#comment:9

Perhaps there should be a try/except around this and attempt direct comparison if comparing by sets raises a `TypeError`.  I'm not sure what the impact is of computing a Groebner basis, or if it can be avoided in some other way as well.



---

archive/issue_comments_402065.json:
```json
{
    "body": "**Changing commit** from \"[78ae9220be1f5279f1766ec78f597bb4634b69e2](https://github.com/sagemath/sagetrac-mirror/commit/78ae9220be1f5279f1766ec78f597bb4634b69e2)\" to \"[243172790b441f1feb1f9dfa3cfdff9810f6705d](https://github.com/sagemath/sagetrac-mirror/commit/243172790b441f1feb1f9dfa3cfdff9810f6705d)\".",
    "created_at": "2018-08-14T12:38:41Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402065",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[78ae9220be1f5279f1766ec78f597bb4634b69e2](https://github.com/sagemath/sagetrac-mirror/commit/78ae9220be1f5279f1766ec78f597bb4634b69e2)" to "[243172790b441f1feb1f9dfa3cfdff9810f6705d](https://github.com/sagemath/sagetrac-mirror/commit/243172790b441f1feb1f9dfa3cfdff9810f6705d)".



---

archive/issue_comments_402066.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/243172790b441f1feb1f9dfa3cfdff9810f6705d\">2431727</a></td><td><code>adding the hash</code></td></tr></table>\n",
    "created_at": "2018-08-14T12:38:41Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/243172790b441f1feb1f9dfa3cfdff9810f6705d">2431727</a></td><td><code>adding the hash</code></td></tr></table>




---

archive/issue_comments_402067.json:
```json
{
    "body": "<a id='comment:27'></a>\nadding hash from the existing _cache_key seems to fix the failing doctests.. But is this a correct thing to do ?",
    "created_at": "2018-08-14T12:39:33Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402067",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>
adding hash from the existing _cache_key seems to fix the failing doctests.. But is this a correct thing to do ?



---

archive/issue_comments_402068.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [chapoton](#comment%3A27):\n> adding hash from the existing _cache_key seems to fix the failing doctests.. But is this a correct thing to do ?\n\n\nNo, I don't believe so, and the I think the explanation in the `_cache_key` docs is fairly clear why.  Instead: ticket:25946#comment:25",
    "created_at": "2018-08-14T12:51:18Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402068",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>
Replying to [chapoton](#comment%3A27):
> adding hash from the existing _cache_key seems to fix the failing doctests.. But is this a correct thing to do ?


No, I don't believe so, and the I think the explanation in the `_cache_key` docs is fairly clear why.  Instead: ticket:25946#comment:25



---

archive/issue_comments_402069.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d5573ef5de068bdae2165cc9c16f0ced2151219a\">d5573ef</a></td><td><code>py3: add a `__hash__` for HyperellipticCurve_generic</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f29c001301afd191bb6a99af2016fdddbbb99926\">f29c001</a></td><td><code>py3: need explicit cast to int for range</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3771812d49b682d9f8961cff4df7021babda57d9\">3771812</a></td><td><code>py3: comparison and hash cleanup for hyperellliptic curves</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9f9399ca5bdf787d8cb61f1174f71822b1ea241d\">9f9399c</a></td><td><code>tiny change in the comparison of ideals inside polynomial rings</code></td></tr></table>\n",
    "created_at": "2018-08-14T13:20:10Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402069",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d5573ef5de068bdae2165cc9c16f0ced2151219a">d5573ef</a></td><td><code>py3: add a `__hash__` for HyperellipticCurve_generic</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f29c001301afd191bb6a99af2016fdddbbb99926">f29c001</a></td><td><code>py3: need explicit cast to int for range</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3771812d49b682d9f8961cff4df7021babda57d9">3771812</a></td><td><code>py3: comparison and hash cleanup for hyperellliptic curves</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9f9399ca5bdf787d8cb61f1174f71822b1ea241d">9f9399c</a></td><td><code>tiny change in the comparison of ideals inside polynomial rings</code></td></tr></table>




---

archive/issue_comments_402070.json:
```json
{
    "body": "**Changing commit** from \"[243172790b441f1feb1f9dfa3cfdff9810f6705d](https://github.com/sagemath/sagetrac-mirror/commit/243172790b441f1feb1f9dfa3cfdff9810f6705d)\" to \"[9f9399ca5bdf787d8cb61f1174f71822b1ea241d](https://github.com/sagemath/sagetrac-mirror/commit/9f9399ca5bdf787d8cb61f1174f71822b1ea241d)\".",
    "created_at": "2018-08-14T13:20:10Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402070",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[243172790b441f1feb1f9dfa3cfdff9810f6705d](https://github.com/sagemath/sagetrac-mirror/commit/243172790b441f1feb1f9dfa3cfdff9810f6705d)" to "[9f9399ca5bdf787d8cb61f1174f71822b1ea241d](https://github.com/sagemath/sagetrac-mirror/commit/9f9399ca5bdf787d8cb61f1174f71822b1ea241d)".



---

archive/issue_comments_402071.json:
```json
{
    "body": "<a id='comment:30'></a>\nok. So here is my next proposal : when comparing ideals generated by a single polynomial, just compare this generator (no need to wrap by set).",
    "created_at": "2018-08-14T13:22:06Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402071",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:30'></a>
ok. So here is my next proposal : when comparing ideals generated by a single polynomial, just compare this generator (no need to wrap by set).



---

archive/issue_comments_402072.json:
```json
{
    "body": "<a id='comment:31'></a>\nTrue.  Is that case common enough to merit a special case?  Are there cases of ideals of rings over these types of p-adics whose ideal would be generated by more than one polynomials (and hence would still crash on the existing code)?\n\nWhat I'm saying is just, why not:\n\n```python\ntry:\n    same_gens = set(self.gens()) == set(other.gens())\nexcept TypeError:\n    same_gens = False\n\nif same_gens:\n    # Do whatever we do currently\nelse:\n    # Do whatever is necessary to compare the gens (construct a GB, etc).\n```",
    "created_at": "2018-08-14T13:47:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402072",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>
True.  Is that case common enough to merit a special case?  Are there cases of ideals of rings over these types of p-adics whose ideal would be generated by more than one polynomials (and hence would still crash on the existing code)?

What I'm saying is just, why not:

```python
try:
    same_gens = set(self.gens()) == set(other.gens())
except TypeError:
    same_gens = False

if same_gens:
    # Do whatever we do currently
else:
    # Do whatever is necessary to compare the gens (construct a GB, etc).
```



---

archive/issue_comments_402073.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecc4b361b04690708a037dc03c0975a5d312530f\">ecc4b36</a></td><td><code>change again the comparison of ideals</code></td></tr></table>\n",
    "created_at": "2018-08-14T14:07:06Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecc4b361b04690708a037dc03c0975a5d312530f">ecc4b36</a></td><td><code>change again the comparison of ideals</code></td></tr></table>




---

archive/issue_comments_402074.json:
```json
{
    "body": "**Changing commit** from \"[9f9399ca5bdf787d8cb61f1174f71822b1ea241d](https://github.com/sagemath/sagetrac-mirror/commit/9f9399ca5bdf787d8cb61f1174f71822b1ea241d)\" to \"[ecc4b361b04690708a037dc03c0975a5d312530f](https://github.com/sagemath/sagetrac-mirror/commit/ecc4b361b04690708a037dc03c0975a5d312530f)\".",
    "created_at": "2018-08-14T14:07:06Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402074",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9f9399ca5bdf787d8cb61f1174f71822b1ea241d](https://github.com/sagemath/sagetrac-mirror/commit/9f9399ca5bdf787d8cb61f1174f71822b1ea241d)" to "[ecc4b361b04690708a037dc03c0975a5d312530f](https://github.com/sagemath/sagetrac-mirror/commit/ecc4b361b04690708a037dc03c0975a5d312530f)".



---

archive/issue_comments_402075.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [embray](#comment%3A31):\n> True.  Is that case common enough to merit a special case?  Are there cases of ideals of rings over these types of p-adics whose ideal would be generated by more than one polynomials (and hence would still crash on the existing code)?\n\n\nCertainly:  in ZZ_p[X] the ideal generated by p and X.  But the number of gens will always be small, so why not sort the gens, however many there are?\n\nThis is an example of a common problem in Sage and other systems.  If I define two ideals (or other structures) in different ways and ask whether they are equal then the test may be very expensive.  But here we just test whether they have been presented in the same way (or with trivial changes such as changing the order of the generators).\n\n\n> \n> What I'm saying is just, why not:\n> \n> ```python\n> try:\n>     same_gens = set(self.gens()) == set(other.gens())\n> except TypeError:\n>     same_gens = False\n> \n> if same_gens:\n>     # Do whatever we do currently\n> else:\n>     # Do whatever is necessary to compare the gens (construct a GB, etc).\n> ```\n\n----\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecc4b361b04690708a037dc03c0975a5d312530f\">ecc4b36</a></td><td><code>change again the comparison of ideals</code></td></tr></table>\n",
    "created_at": "2018-08-14T14:08:03Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402075",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:33'></a>
Replying to [embray](#comment%3A31):
> True.  Is that case common enough to merit a special case?  Are there cases of ideals of rings over these types of p-adics whose ideal would be generated by more than one polynomials (and hence would still crash on the existing code)?


Certainly:  in ZZ_p[X] the ideal generated by p and X.  But the number of gens will always be small, so why not sort the gens, however many there are?

This is an example of a common problem in Sage and other systems.  If I define two ideals (or other structures) in different ways and ask whether they are equal then the test may be very expensive.  But here we just test whether they have been presented in the same way (or with trivial changes such as changing the order of the generators).


> 
> What I'm saying is just, why not:
> 
> ```python
> try:
>     same_gens = set(self.gens()) == set(other.gens())
> except TypeError:
>     same_gens = False
> 
> if same_gens:
>     # Do whatever we do currently
> else:
>     # Do whatever is necessary to compare the gens (construct a GB, etc).
> ```

----
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecc4b361b04690708a037dc03c0975a5d312530f">ecc4b36</a></td><td><code>change again the comparison of ideals</code></td></tr></table>




---

archive/issue_comments_402076.json:
```json
{
    "body": "<a id='comment:34'></a>\nHere is another tentative : first compare without set() then compare with set()",
    "created_at": "2018-08-14T14:08:55Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402076",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:34'></a>
Here is another tentative : first compare without set() then compare with set()



---

archive/issue_comments_402077.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [chapoton](#comment%3A34):\n> Here is another tentative : first compare without set() then compare with set()\n\n\nThat could still crash.  I don't know the math well enough to construct an interestingexample case, but say you have two copies of the same ideal, but their generators just happen to be in a different order, as in:\n\n```\nsage: R.<x,y> = QQ[]\nsage: R.ideal(x, y).gens()\n[x, y]\nsage: R.ideal(y, x).gens()\n```\n\nThis is the sort of case, as John wrote, that the `set()` call is intended for in the first place.  But if the elements `x` and `y` are not hashable, then the first test will still fail, and then the second test will be evaluated and will crash.\n\nIMO this comparison of gens() is just a special case shortcut which is fine as-is, but it should account for the possibility that some elements just aren't hashable, that's all.",
    "created_at": "2018-08-14T14:32:09Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402077",
    "user": "https://github.com/embray"
}
```

<a id='comment:35'></a>
Replying to [chapoton](#comment%3A34):
> Here is another tentative : first compare without set() then compare with set()


That could still crash.  I don't know the math well enough to construct an interestingexample case, but say you have two copies of the same ideal, but their generators just happen to be in a different order, as in:

```
sage: R.<x,y> = QQ[]
sage: R.ideal(x, y).gens()
[x, y]
sage: R.ideal(y, x).gens()
```

This is the sort of case, as John wrote, that the `set()` call is intended for in the first place.  But if the elements `x` and `y` are not hashable, then the first test will still fail, and then the second test will be evaluated and will crash.

IMO this comparison of gens() is just a special case shortcut which is fine as-is, but it should account for the possibility that some elements just aren't hashable, that's all.



---

archive/issue_comments_402078.json:
```json
{
    "body": "<a id='comment:36'></a>\nDoes hashable imply not sortable?  As I said, the lists of gens will be short normally, so something like testing sorted(s_gens)==sorted(o_gens) might work when the set() constructor does not?  There will still be silly trivial cases such as first giving {x,y} as gens then {x,x,y} and for sure someone will then complain.  But even as it is, we are not returning equality of the ideals (x,y) and (x+y,y).  We are never going to catch all trivial cases (and different users' idea of a trivial case will differ) so just comparing the list of gens with no processing at all is safest and most easily explained.",
    "created_at": "2018-08-14T14:45:10Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402078",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:36'></a>
Does hashable imply not sortable?  As I said, the lists of gens will be short normally, so something like testing sorted(s_gens)==sorted(o_gens) might work when the set() constructor does not?  There will still be silly trivial cases such as first giving {x,y} as gens then {x,x,y} and for sure someone will then complain.  But even as it is, we are not returning equality of the ideals (x,y) and (x+y,y).  We are never going to catch all trivial cases (and different users' idea of a trivial case will differ) so just comparing the list of gens with no processing at all is safest and most easily explained.



---

archive/issue_comments_402079.json:
```json
{
    "body": "**Changing commit** from \"[ecc4b361b04690708a037dc03c0975a5d312530f](https://github.com/sagemath/sagetrac-mirror/commit/ecc4b361b04690708a037dc03c0975a5d312530f)\" to \"[d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0](https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0)\".",
    "created_at": "2018-08-14T14:47:33Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402079",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ecc4b361b04690708a037dc03c0975a5d312530f](https://github.com/sagemath/sagetrac-mirror/commit/ecc4b361b04690708a037dc03c0975a5d312530f)" to "[d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0](https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0)".



---

archive/issue_comments_402080.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0\">d47fbb3</a></td><td><code>wrap with try</code></td></tr></table>\n",
    "created_at": "2018-08-14T14:47:33Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402080",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0">d47fbb3</a></td><td><code>wrap with try</code></td></tr></table>




---

archive/issue_comments_402081.json:
```json
{
    "body": "<a id='comment:38'></a>\nok, I have wrapped with \"try / except\".",
    "created_at": "2018-08-14T14:48:47Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402081",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:38'></a>
ok, I have wrapped with "try / except".



---

archive/issue_comments_402082.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [cremona](#comment%3A36):\n> Does hashable imply not sortable?  As I said, the lists of gens will be short normally, so something like testing sorted(s_gens)==sorted(o_gens) might work when the set() constructor does not?  There will still be silly trivial cases such as first giving {x,y} as gens then {x,x,y} and for sure someone will then complain.  But even as it is, we are not returning equality of the ideals (x,y) and (x+y,y).  We are never going to catch all trivial cases (and different users' idea of a trivial case will differ) so just comparing the list of gens with no processing at all is safest and most easily explained.\n\n\nI don't think sorting really helps here, because as I found out over in #25948, some elements can be \"sorted\" but the ordering is meaningless and unpredictable.",
    "created_at": "2018-08-14T14:55:48Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402082",
    "user": "https://github.com/embray"
}
```

<a id='comment:39'></a>
Replying to [cremona](#comment%3A36):
> Does hashable imply not sortable?  As I said, the lists of gens will be short normally, so something like testing sorted(s_gens)==sorted(o_gens) might work when the set() constructor does not?  There will still be silly trivial cases such as first giving {x,y} as gens then {x,x,y} and for sure someone will then complain.  But even as it is, we are not returning equality of the ideals (x,y) and (x+y,y).  We are never going to catch all trivial cases (and different users' idea of a trivial case will differ) so just comparing the list of gens with no processing at all is safest and most easily explained.


I don't think sorting really helps here, because as I found out over in #25948, some elements can be "sorted" but the ordering is meaningless and unpredictable.



---

archive/issue_comments_402083.json:
```json
{
    "body": "<a id='comment:40'></a>\nReplying to [git](#comment%3A37):\n> Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0\">d47fbb3</a></td><td><code>wrap with try</code></td></tr></table>\n\n\nYou could still get rid of `(s_gens == o_gens)`.  I don't think it's that useful.",
    "created_at": "2018-08-14T14:56:54Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402083",
    "user": "https://github.com/embray"
}
```

<a id='comment:40'></a>
Replying to [git](#comment%3A37):
> Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0">d47fbb3</a></td><td><code>wrap with try</code></td></tr></table>


You could still get rid of `(s_gens == o_gens)`.  I don't think it's that useful.



---

archive/issue_comments_402084.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [embray](#comment%3A40):\n> Replying to [git](#comment%3A37):\n> > Branch pushed to git repo; I updated commit sha1. **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0\">d47fbb3</a></td><td><code>wrap with try</code></td></tr></table>\n\n> \n> You could still get rid of `(s_gens == o_gens)`.  I don't think it's that useful.\n\n\nYes it is. It will handle the precise case that we are dealing with in this ticket, hyperelliptic curves over p-adics.",
    "created_at": "2018-08-14T14:59:47Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402084",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:41'></a>
Replying to [embray](#comment%3A40):
> Replying to [git](#comment%3A37):
> > Branch pushed to git repo; I updated commit sha1. **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0">d47fbb3</a></td><td><code>wrap with try</code></td></tr></table>

> 
> You could still get rid of `(s_gens == o_gens)`.  I don't think it's that useful.


Yes it is. It will handle the precise case that we are dealing with in this ticket, hyperelliptic curves over p-adics.



---

archive/issue_comments_402085.json:
```json
{
    "body": "<a id='comment:42'></a>\nOk, but I think as written you don't need the `same_gens` variable.  I only wrote it that way in my pseudo-code because I wasn't directly looking at the real code at the time, and didn't consider using a try/except/else.  I don't think we need to worry about `rich_to_bool` raising a `TypeError`.",
    "created_at": "2018-08-14T15:06:26Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402085",
    "user": "https://github.com/embray"
}
```

<a id='comment:42'></a>
Ok, but I think as written you don't need the `same_gens` variable.  I only wrote it that way in my pseudo-code because I wasn't directly looking at the real code at the time, and didn't consider using a try/except/else.  I don't think we need to worry about `rich_to_bool` raising a `TypeError`.



---

archive/issue_comments_402086.json:
```json
{
    "body": "**Changing commit** from \"[d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0](https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0)\" to \"[b129fc96811a9db8c454a395180e6ca2a8a1b5fb](https://github.com/sagemath/sagetrac-mirror/commit/b129fc96811a9db8c454a395180e6ca2a8a1b5fb)\".",
    "created_at": "2018-08-14T15:13:11Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402086",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0](https://github.com/sagemath/sagetrac-mirror/commit/d47fbb3f350c6e5ce4d2fdc809a3849699bebdd0)" to "[b129fc96811a9db8c454a395180e6ca2a8a1b5fb](https://github.com/sagemath/sagetrac-mirror/commit/b129fc96811a9db8c454a395180e6ca2a8a1b5fb)".



---

archive/issue_comments_402087.json:
```json
{
    "body": "<a id='comment:43'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b129fc96811a9db8c454a395180e6ca2a8a1b5fb\">b129fc9</a></td><td><code>fix</code></td></tr></table>\n",
    "created_at": "2018-08-14T15:13:11Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402087",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b129fc96811a9db8c454a395180e6ca2a8a1b5fb">b129fc9</a></td><td><code>fix</code></td></tr></table>




---

archive/issue_comments_402088.json:
```json
{
    "body": "<a id='comment:44'></a>\nlike that ?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b129fc96811a9db8c454a395180e6ca2a8a1b5fb\">b129fc9</a></td><td><code>fix</code></td></tr></table>\n",
    "created_at": "2018-08-14T15:13:25Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402088",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:44'></a>
like that ?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b129fc96811a9db8c454a395180e6ca2a8a1b5fb">b129fc9</a></td><td><code>fix</code></td></tr></table>




---

archive/issue_comments_402089.json:
```json
{
    "body": "<a id='comment:45'></a>\nYeah, though it would be nice to squash all these commits before we're done here.",
    "created_at": "2018-08-14T15:22:15Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402089",
    "user": "https://github.com/embray"
}
```

<a id='comment:45'></a>
Yeah, though it would be nice to squash all these commits before we're done here.



---

archive/issue_comments_402090.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8687f7d8800aede97e36d4da30ae79da895b5f7\">f8687f7</a></td><td><code>py3: comparison cleanup for hyperelliptic curves</code></td></tr></table>\n",
    "created_at": "2018-08-14T15:25:18Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402090",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8687f7d8800aede97e36d4da30ae79da895b5f7">f8687f7</a></td><td><code>py3: comparison cleanup for hyperelliptic curves</code></td></tr></table>




---

archive/issue_comments_402091.json:
```json
{
    "body": "**Changing commit** from \"[b129fc96811a9db8c454a395180e6ca2a8a1b5fb](https://github.com/sagemath/sagetrac-mirror/commit/b129fc96811a9db8c454a395180e6ca2a8a1b5fb)\" to \"[f8687f7d8800aede97e36d4da30ae79da895b5f7](https://github.com/sagemath/sagetrac-mirror/commit/f8687f7d8800aede97e36d4da30ae79da895b5f7)\".",
    "created_at": "2018-08-14T15:25:18Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402091",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b129fc96811a9db8c454a395180e6ca2a8a1b5fb](https://github.com/sagemath/sagetrac-mirror/commit/b129fc96811a9db8c454a395180e6ca2a8a1b5fb)" to "[f8687f7d8800aede97e36d4da30ae79da895b5f7](https://github.com/sagemath/sagetrac-mirror/commit/f8687f7d8800aede97e36d4da30ae79da895b5f7)".



---

archive/issue_comments_402092.json:
```json
{
    "body": "<a id='comment:47'></a>\ndone",
    "created_at": "2018-08-14T15:25:28Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402092",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:47'></a>
done



---

archive/issue_comments_402093.json:
```json
{
    "body": "<a id='comment:48'></a>\nThanks! Well, I'm happy, so you can set positive review if you want, or wait and see if anyone smarter than me wants to weigh on, though it seems like this approach meshes with what the other experts have said so far.",
    "created_at": "2018-08-14T15:32:35Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402093",
    "user": "https://github.com/embray"
}
```

<a id='comment:48'></a>
Thanks! Well, I'm happy, so you can set positive review if you want, or wait and see if anyone smarter than me wants to weigh on, though it seems like this approach meshes with what the other experts have said so far.



---

archive/issue_comments_402094.json:
```json
{
    "body": "<a id='comment:49'></a>\nI am happy (and making no claims to be cleverer than anyone else ;)) \n\nI would never have thought of using rich_to_bool() though.  Not clever enough!",
    "created_at": "2018-08-14T15:38:38Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402094",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:49'></a>
I am happy (and making no claims to be cleverer than anyone else ;)) 

I would never have thought of using rich_to_bool() though.  Not clever enough!



---

archive/issue_comments_402095.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, David Roe\".",
    "created_at": "2018-08-14T16:07:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402095",
    "user": "https://github.com/roed314"
}
```

**Changing reviewer** from "Travis Scrimshaw" to "Travis Scrimshaw, David Roe".



---

archive/issue_comments_402096.json:
```json
{
    "body": "<a id='comment:50'></a>\nSeems good to me too!",
    "created_at": "2018-08-14T16:07:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402096",
    "user": "https://github.com/roed314"
}
```

<a id='comment:50'></a>
Seems good to me too!



---

archive/issue_events_230210.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2018-08-14T16:07:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230210"
}
```



---

archive/issue_events_230211.json:
```json
{
    "actor": "https://github.com/roed314",
    "created_at": "2018-08-14T16:07:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230211"
}
```



---

archive/issue_events_230212.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-17T21:14:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230212"
}
```



---

archive/issue_events_230213.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-17T21:14:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25946#event-230213"
}
```



---

archive/issue_comments_402097.json:
```json
{
    "body": "**Changing branch** from \"[public/25946](https://github.com/sagemath/sagetrac-mirror/tree/public/25946)\" to \"[f8687f7d8800aede97e36d4da30ae79da895b5f7](https://github.com/sagemath/sagetrac-mirror/commit/f8687f7d8800aede97e36d4da30ae79da895b5f7)\".",
    "created_at": "2018-08-17T21:14:06Z",
    "issue": "https://github.com/sagemath/sage/issues/25946",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25946#issuecomment-402097",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/25946](https://github.com/sagemath/sagetrac-mirror/tree/public/25946)" to "[f8687f7d8800aede97e36d4da30ae79da895b5f7](https://github.com/sagemath/sagetrac-mirror/commit/f8687f7d8800aede97e36d4da30ae79da895b5f7)".
