# Issue 25305: Adding has_graphviz, has_ffmpeg, has_imagemagick to sage.doctest.external

archive/issues_025068.json:
```json
{
    "body": "Implement this:\n\n```\nsage: from sage.doctest.external import has_graphviz, has_ffmpeg, has_imagemagick\nsage: has_graphviz()   # random\nTrue\nsage: has_ffmpeg()   # random\nTrue\nsage: has_imagemagick()   # random\nTrue\n```\n\nso that graphviz, ffmpeg, imagemagick are included in the external software to be detected:\n\n```\n$ sage -t --optional=external,sage src/sage/graphs/graph_latex.py src/sage/plot/animate.py\n...\nUsing --optional=external\nExternal software to be detected: cplex,ffmpeg,graphviz,gurobi,\nimagemagick,internet,latex,macaulay2,magma,maple,mathematica,\nmatlab,octave,scilab\n...\n```\n\nKeywords: thursdaysbdx\n\nReviewer: Vincent Delecroix\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nBranch: ba9cf98f587a0304642946797b995f6790835aad\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25305\n\n",
    "closed_at": "2018-06-09T17:49:24Z",
    "created_at": "2018-05-08T08:40:30Z",
    "labels": [
        "component: doctest framework"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Adding has_graphviz, has_ffmpeg, has_imagemagick to sage.doctest.external",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25305",
    "user": "https://github.com/seblabbe"
}
```
Implement this:

```
sage: from sage.doctest.external import has_graphviz, has_ffmpeg, has_imagemagick
sage: has_graphviz()   # random
True
sage: has_ffmpeg()   # random
True
sage: has_imagemagick()   # random
True
```

so that graphviz, ffmpeg, imagemagick are included in the external software to be detected:

```
$ sage -t --optional=external,sage src/sage/graphs/graph_latex.py src/sage/plot/animate.py
...
Using --optional=external
External software to be detected: cplex,ffmpeg,graphviz,gurobi,
imagemagick,internet,latex,macaulay2,magma,maple,mathematica,
matlab,octave,scilab
...
```

Keywords: thursdaysbdx

Reviewer: Vincent Delecroix

Author: Sébastien Labbé

Branch: ba9cf98f587a0304642946797b995f6790835aad

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25305





---

archive/issue_comments_375415.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-08T08:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375415",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_375416.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2018-05-08T08:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375416",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_375417.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-08T11:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375417",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_375418.json:
```json
{
    "body": "<a id='comment:4'></a>I added `has_ffmpeg` and `have_imagemagick` in the second commit. \n\nFor references, the list `tests_not_run` below contains all tags of tests that are not run by default. The list was obtained from `grep \"not run\"` on the log of `./sage -t -p --all --long --show-skipped`:\n\n```\nsage: tests_not_run = ['4ti2', 'and', 'axiom', 'beautifulsoup', 'benzene', 'bliss', 'buckygen',\n....: 'cbc', 'chomp', 'coxeter3', 'cplex', 'cryptominisat', 'csdp', 'cunningham',\n....: 'database', 'database_cremona_ellcurve', 'database_gap',\n....: 'database_jones_numfield', 'database_kohel', 'database_mutation_class',\n....: 'database_odlyzko_zeta', 'database_pari', 'database_stein_watkins',\n....: 'database_symbolic_data', 'debug', 'fes', 'ffmpeg', 'fricas', 'frobby',\n....: 'gambit', 'gap3', 'gap_packages', 'gdb', 'giacpy_sage', 'ginv', 'glucose',\n....: 'gmp', 'gmpy2', 'gnuplot', 'gperftools', 'graphviz', 'growing', 'gurobi',\n....: 'hmisc', 'imagemagick', 'internet', 'java', 'kash', 'latex', 'latte_int',\n....: 'libbraiding', 'libhomfly', 'libjpeg', 'lie', 'lrs', 'lrslib', 'macaulay2',\n....: 'magma', 'maple', 'mathematica', 'mathematicafrontend', 'matlab', 'mcqd',\n....: 'meataxe', 'mupad', 'nonexistent_lp_solver', 'octave', 'ore_algebra', 'phc',\n....: 'plantri', 'polymake', 'polytopes_db_4d', 'py3', 'pynormaliz', 'python_igraph',\n....: 'qepcad', 'randomly', 'required', 'requires', 'rgraphics', 'rsat', 'runsnake',\n....: 'scilab', 'sirocco', 'sloane_database', 'surf', 'tdlib', 'the', 'tides',\n....: 'time', 'topcom', 'webbrowser']\n```\n\nAnd this is a tentative list of all \"external\" packages:\n\n```\nsage: S = set(package_versions('standard'))\nsage: O = set(package_versions('optional'))\nsage: E = set(package_versions('experimental'))\nsage: set(tests_not_run) - (S|O|E)\n{'and',\n 'axiom',\n 'beautifulsoup',\n 'chomp',\n 'cplex',\n 'cunningham',\n 'database',\n 'debug',\n 'fes',\n 'ffmpeg',\n 'ginv',\n 'glucose',\n 'gnuplot',\n 'gperftools',\n 'graphviz',\n 'growing',\n 'gurobi',\n 'hmisc',\n 'imagemagick',\n 'internet',\n 'java',\n 'kash',\n 'latex',\n 'libjpeg',\n 'lrs',\n 'macaulay2',\n 'magma',\n 'maple',\n 'mathematica',\n 'mathematicafrontend',\n 'matlab',\n 'mupad',\n 'nonexistent_lp_solver',\n 'octave',\n 'phc',\n 'polytopes_db_4d',\n 'py3',\n 'randomly',\n 'required',\n 'requires',\n 'rgraphics',\n 'rsat',\n 'runsnake',\n 'scilab',\n 'sloane_database',\n 'the',\n 'time',\n 'webbrowser'}\n```\n\nMaybe we want to detect some more external packages...",
    "created_at": "2018-05-08T12:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375418",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'></a>I added `has_ffmpeg` and `have_imagemagick` in the second commit. 

For references, the list `tests_not_run` below contains all tags of tests that are not run by default. The list was obtained from `grep "not run"` on the log of `./sage -t -p --all --long --show-skipped`:

```
sage: tests_not_run = ['4ti2', 'and', 'axiom', 'beautifulsoup', 'benzene', 'bliss', 'buckygen',
....: 'cbc', 'chomp', 'coxeter3', 'cplex', 'cryptominisat', 'csdp', 'cunningham',
....: 'database', 'database_cremona_ellcurve', 'database_gap',
....: 'database_jones_numfield', 'database_kohel', 'database_mutation_class',
....: 'database_odlyzko_zeta', 'database_pari', 'database_stein_watkins',
....: 'database_symbolic_data', 'debug', 'fes', 'ffmpeg', 'fricas', 'frobby',
....: 'gambit', 'gap3', 'gap_packages', 'gdb', 'giacpy_sage', 'ginv', 'glucose',
....: 'gmp', 'gmpy2', 'gnuplot', 'gperftools', 'graphviz', 'growing', 'gurobi',
....: 'hmisc', 'imagemagick', 'internet', 'java', 'kash', 'latex', 'latte_int',
....: 'libbraiding', 'libhomfly', 'libjpeg', 'lie', 'lrs', 'lrslib', 'macaulay2',
....: 'magma', 'maple', 'mathematica', 'mathematicafrontend', 'matlab', 'mcqd',
....: 'meataxe', 'mupad', 'nonexistent_lp_solver', 'octave', 'ore_algebra', 'phc',
....: 'plantri', 'polymake', 'polytopes_db_4d', 'py3', 'pynormaliz', 'python_igraph',
....: 'qepcad', 'randomly', 'required', 'requires', 'rgraphics', 'rsat', 'runsnake',
....: 'scilab', 'sirocco', 'sloane_database', 'surf', 'tdlib', 'the', 'tides',
....: 'time', 'topcom', 'webbrowser']
```

And this is a tentative list of all "external" packages:

```
sage: S = set(package_versions('standard'))
sage: O = set(package_versions('optional'))
sage: E = set(package_versions('experimental'))
sage: set(tests_not_run) - (S|O|E)
{'and',
 'axiom',
 'beautifulsoup',
 'chomp',
 'cplex',
 'cunningham',
 'database',
 'debug',
 'fes',
 'ffmpeg',
 'ginv',
 'glucose',
 'gnuplot',
 'gperftools',
 'graphviz',
 'growing',
 'gurobi',
 'hmisc',
 'imagemagick',
 'internet',
 'java',
 'kash',
 'latex',
 'libjpeg',
 'lrs',
 'macaulay2',
 'magma',
 'maple',
 'mathematica',
 'mathematicafrontend',
 'matlab',
 'mupad',
 'nonexistent_lp_solver',
 'octave',
 'phc',
 'polytopes_db_4d',
 'py3',
 'randomly',
 'required',
 'requires',
 'rgraphics',
 'rsat',
 'runsnake',
 'scilab',
 'sloane_database',
 'the',
 'time',
 'webbrowser'}
```

Maybe we want to detect some more external packages...



---

archive/issue_comments_375419.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-08T12:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375419",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375420.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,19 +1,24 @@\n Implement this:\n \n ```\n-sage: from sage.doctest.external import has_graphviz\n-sage: has_graphviz()\n+sage: from sage.doctest.external import has_graphviz, has_ffmpeg, has_imagemagick\n+sage: has_graphviz()   # random\n+True\n+sage: has_ffmpeg()   # random\n+True\n+sage: has_imagemagick()   # random\n True\n ```\n \n so that graphviz is included in the external software to be detected:\n \n ```\n-$ sage -t --optional=external src/sage/graphs/graph_latex.py\n+$ sage -t --optional=external src/sage/graphs/graph_latex.py src/sage/plot/animate.py\n ...\n Using --optional=external\n-External software to be detected: cplex,graphviz,gurobi,internet,latex,\n-macaulay2,magma,maple,mathematica,matlab,octave,scilab\n+External software to be detected: cplex,ffmpeg,graphviz,gurobi,\n+imagemagick,internet,latex,macaulay2,magma,maple,mathematica,\n+matlab,octave,scilab\n ...\n ```\n \n```\n",
    "created_at": "2018-05-10T07:58:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375420",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,19 +1,24 @@
 Implement this:
 
 ```
-sage: from sage.doctest.external import has_graphviz
-sage: has_graphviz()
+sage: from sage.doctest.external import has_graphviz, has_ffmpeg, has_imagemagick
+sage: has_graphviz()   # random
+True
+sage: has_ffmpeg()   # random
+True
+sage: has_imagemagick()   # random
 True
 ```
 
 so that graphviz is included in the external software to be detected:
 
 ```
-$ sage -t --optional=external src/sage/graphs/graph_latex.py
+$ sage -t --optional=external src/sage/graphs/graph_latex.py src/sage/plot/animate.py
 ...
 Using --optional=external
-External software to be detected: cplex,graphviz,gurobi,internet,latex,
-macaulay2,magma,maple,mathematica,matlab,octave,scilab
+External software to be detected: cplex,ffmpeg,graphviz,gurobi,
+imagemagick,internet,latex,macaulay2,magma,maple,mathematica,
+matlab,octave,scilab
 ...
 ```
 
```




---

archive/issue_comments_375421.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+Implement this:\n \n+```\n+sage: from sage.doctest.external import has_graphviz, has_ffmpeg, has_imagemagick\n+sage: has_graphviz()   # random\n+True\n+sage: has_ffmpeg()   # random\n+True\n+sage: has_imagemagick()   # random\n+True\n+```\n+\n+so that graphviz, ffmpeg, imagemagick are included in the external software to be detected:\n+\n+```\n+$ sage -t --optional=external src/sage/graphs/graph_latex.py src/sage/plot/animate.py\n+...\n+Using --optional=external\n+External software to be detected: cplex,ffmpeg,graphviz,gurobi,\n+imagemagick,internet,latex,macaulay2,magma,maple,mathematica,\n+matlab,octave,scilab\n+...\n+```\n \n Author: S\u00e9bastien Labb\u00e9\n \n```\n",
    "created_at": "2018-05-10T07:59:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375421",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,26 @@
+Implement this:
 
+```
+sage: from sage.doctest.external import has_graphviz, has_ffmpeg, has_imagemagick
+sage: has_graphviz()   # random
+True
+sage: has_ffmpeg()   # random
+True
+sage: has_imagemagick()   # random
+True
+```
+
+so that graphviz, ffmpeg, imagemagick are included in the external software to be detected:
+
+```
+$ sage -t --optional=external src/sage/graphs/graph_latex.py src/sage/plot/animate.py
+...
+Using --optional=external
+External software to be detected: cplex,ffmpeg,graphviz,gurobi,
+imagemagick,internet,latex,macaulay2,magma,maple,mathematica,
+matlab,octave,scilab
+...
+```
 
 Author: Sébastien Labbé
 
```




---

archive/issue_comments_375422.json:
```json
{
    "body": "<a id='comment:9'></a>Shouldn't this use the recently merged #20382?",
    "created_at": "2018-05-10T14:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375422",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>Shouldn't this use the recently merged #20382?



---

archive/issue_comments_375423.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 vdelecroix]:\n> Shouldn't this use the recently merged #20382?\n\n\nActually, I think that all the `has_xxx` stuff would better be features.",
    "created_at": "2018-05-13T10:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375423",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>Replying to [comment:9 vdelecroix]:
> Shouldn't this use the recently merged #20382?


Actually, I think that all the `has_xxx` stuff would better be features.



---

archive/issue_comments_375424.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,26 @@\n+Implement this:\n \n+```\n+sage: from sage.doctest.external import has_graphviz, has_ffmpeg, has_imagemagick\n+sage: has_graphviz()   # random\n+True\n+sage: has_ffmpeg()   # random\n+True\n+sage: has_imagemagick()   # random\n+True\n+```\n+\n+so that graphviz, ffmpeg, imagemagick are included in the external software to be detected:\n+\n+```\n+$ sage -t --optional=external,sage src/sage/graphs/graph_latex.py src/sage/plot/animate.py\n+...\n+Using --optional=external\n+External software to be detected: cplex,ffmpeg,graphviz,gurobi,\n+imagemagick,internet,latex,macaulay2,magma,maple,mathematica,\n+matlab,octave,scilab\n+...\n+```\n \n Author: S\u00e9bastien Labb\u00e9\n \n```\n",
    "created_at": "2018-05-15T14:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375424",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,26 @@
+Implement this:
 
+```
+sage: from sage.doctest.external import has_graphviz, has_ffmpeg, has_imagemagick
+sage: has_graphviz()   # random
+True
+sage: has_ffmpeg()   # random
+True
+sage: has_imagemagick()   # random
+True
+```
+
+so that graphviz, ffmpeg, imagemagick are included in the external software to be detected:
+
+```
+$ sage -t --optional=external,sage src/sage/graphs/graph_latex.py src/sage/plot/animate.py
+...
+Using --optional=external
+External software to be detected: cplex,ffmpeg,graphviz,gurobi,
+imagemagick,internet,latex,macaulay2,magma,maple,mathematica,
+matlab,octave,scilab
+...
+```
 
 Author: Sébastien Labbé
 
```




---

archive/issue_comments_375425.json:
```json
{
    "body": "<a id='comment:12'></a>New commits:",
    "created_at": "2018-05-15T14:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375425",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:12'></a>New commits:



---

archive/issue_comments_375426.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:9 vdelecroix]:\n> Shouldn't this use the recently merged #20382?\n\n\nOk as you wish. I am now using `find_executable` from the `Features` stuff instead of the `have_program` from the `misc` stuff.",
    "created_at": "2018-05-15T14:05:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375426",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:13'></a>Replying to [comment:9 vdelecroix]:
> Shouldn't this use the recently merged #20382?


Ok as you wish. I am now using `find_executable` from the `Features` stuff instead of the `have_program` from the `misc` stuff.



---

archive/issue_comments_375427.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:10 vdelecroix]: \n> Actually, I think that all the `has_xxx` stuff would better be features.\n\n\nWhy better? To me adding three new `has_key` functions to the `external.py` module makes things better. But changing `has_maple` in a way that it uses `features` does not make anything better.\n\nThe way the `external.py` module is coded right now is that the presence of an external software with name `tag` is detected with a method whose name is `has_tag`. The goal of this ticket is not to redesign all of this `external.py` module. So I suggest that further uses of feature inside of `external.py` be postpone to another ticket if this is at all pertinent.\n\nNeeds review!",
    "created_at": "2018-05-15T14:18:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375427",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:14'></a>Replying to [comment:10 vdelecroix]: 
> Actually, I think that all the `has_xxx` stuff would better be features.


Why better? To me adding three new `has_key` functions to the `external.py` module makes things better. But changing `has_maple` in a way that it uses `features` does not make anything better.

The way the `external.py` module is coded right now is that the presence of an external software with name `tag` is detected with a method whose name is `has_tag`. The goal of this ticket is not to redesign all of this `external.py` module. So I suggest that further uses of feature inside of `external.py` be postpone to another ticket if this is at all pertinent.

Needs review!



---

archive/issue_comments_375428.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-05-17T07:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375428",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_375429.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 slabbe]:\n> Replying to [comment:10 vdelecroix]: \n> > Actually, I think that all the `has_xxx` stuff would better be features.\n\n> \n> Why better? To me adding three new `has_key` functions to the `external.py` module makes things better. But changing `has_maple` in a way that it uses `features` does not make anything better.\n\n\nI just realized that it is not possible for `has_maple`. The maple interface allows subtle configurations such as\n- an alternative name for the executable\n- a remote execution through ssh\nThis is not the kind of things a feature is aware of.\n\n> The way the `external.py` module is coded right now is that the presence of an external software with name `tag` is detected with a method whose name is `has_tag`. The goal of this ticket is not to redesign all of this `external.py` module. So I suggest that further uses of feature inside of `external.py` be postpone to another ticket if this is at all pertinent.\n\n\nIn your situation, you are just checking for the presence of executable in the path. This is exactly what `sage.features.Executable` is about. The main difference between `has_XXX_ and a feature is that\n- a feature is not only about doctest\n- a feature can run small tests\n- meaningful error messages\n- this is not run twice in the same session\n\nWhat I wanted to suggest with my message is to introduce `sage.features.graphviz`, `sage.features.ffmpeg` and `sage.features.imagemagick` and simply use\n\n```\ndef has_ffmpeg():\n    from sage.features.ffmpeg import FFmpeg\n    return FFmpeg.is_present()\n```\nThe software `FFmpeg` is indeed used in other parts of Sage (e.g. `animate`) and it would help to have it as a feature.",
    "created_at": "2018-05-17T07:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375429",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>Replying to [comment:14 slabbe]:
> Replying to [comment:10 vdelecroix]: 
> > Actually, I think that all the `has_xxx` stuff would better be features.

> 
> Why better? To me adding three new `has_key` functions to the `external.py` module makes things better. But changing `has_maple` in a way that it uses `features` does not make anything better.


I just realized that it is not possible for `has_maple`. The maple interface allows subtle configurations such as
- an alternative name for the executable
- a remote execution through ssh
This is not the kind of things a feature is aware of.

> The way the `external.py` module is coded right now is that the presence of an external software with name `tag` is detected with a method whose name is `has_tag`. The goal of this ticket is not to redesign all of this `external.py` module. So I suggest that further uses of feature inside of `external.py` be postpone to another ticket if this is at all pertinent.


In your situation, you are just checking for the presence of executable in the path. This is exactly what `sage.features.Executable` is about. The main difference between `has_XXX_ and a feature is that
- a feature is not only about doctest
- a feature can run small tests
- meaningful error messages
- this is not run twice in the same session

What I wanted to suggest with my message is to introduce `sage.features.graphviz`, `sage.features.ffmpeg` and `sage.features.imagemagick` and simply use

```
def has_ffmpeg():
    from sage.features.ffmpeg import FFmpeg
    return FFmpeg.is_present()
```
The software `FFmpeg` is indeed used in other parts of Sage (e.g. `animate`) and it would help to have it as a feature.



---

archive/issue_comments_375430.json:
```json
{
    "body": "Changing keywords from \"\" to \"thursdaysbdx\".",
    "created_at": "2018-05-17T07:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375430",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "" to "thursdaysbdx".



---

archive/issue_comments_375431.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-05-20T13:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375431",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_375432.json:
```json
{
    "body": "<a id='comment:16'></a>I now creates the files for ffmpeg, imagemagick and graphviz in the feature module and I am using these to solve the problem described in this ticket.\n\nI suggest that the use of the `FFmpeg().require()` in `animate.py` etc be postpone to an indenpendent ticket.\n\n---\nNew commits:",
    "created_at": "2018-05-20T13:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375432",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:16'></a>I now creates the files for ffmpeg, imagemagick and graphviz in the feature module and I am using these to solve the problem described in this ticket.

I suggest that the use of the `FFmpeg().require()` in `animate.py` etc be postpone to an indenpendent ticket.

---
New commits:



---

archive/issue_comments_375433.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-20T13:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375433",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375434.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-20T13:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375434",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375435.json:
```json
{
    "body": "<a id='comment:19'></a>I fixed some doctests and removed `import os,subprocess` in the previous two forced pushed.",
    "created_at": "2018-05-20T13:37:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375435",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:19'></a>I fixed some doctests and removed `import os,subprocess` in the previous two forced pushed.



---

archive/issue_comments_375436.json:
```json
{
    "body": "<a id='comment:20'></a>Needs review!",
    "created_at": "2018-05-20T13:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375436",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:20'></a>Needs review!



---

archive/issue_comments_375437.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-29T05:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375437",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_375438.json:
```json
{
    "body": "<a id='comment:21'></a>Image magick is a suite and not a unique executable:\n- `magick`\n- `magick-script`\n- `convert`\n- `mogrify`\n- `identify`\n- `composite`\n- `montage`\n- `compare`\n- etc",
    "created_at": "2018-05-29T05:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375438",
    "user": "https://github.com/videlec"
}
```

<a id='comment:21'></a>Image magick is a suite and not a unique executable:
- `magick`
- `magick-script`
- `convert`
- `mogrify`
- `identify`
- `composite`
- `montage`
- `compare`
- etc



---

archive/issue_comments_375439.json:
```json
{
    "body": "<a id='comment:22'></a>Can you provide an example where a command from imagemagick other than `convert` is used in the sage source code?\n\n```\n$ sage -grep mogrify\n$ sage -grep magick-script\n$ sage -grep magick\nsage/misc/latex.py:    http://www.imagemagick.org\nsage/misc/latex.py:            print(\"http://www.imagemagick.org to download these programs.\")\nsage/misc/latex.py:            print(\"Go to http://www.imagemagick.org to download it.\")\nsage/misc/latex.py:            print(\"Go to http://www.imagemagick.org to download it.\")\nsage/combinat/words/paths.py:            See www.imagemagick.org, for example.\nsage/graphs/graph_latex.py:- convert: http://www.imagemagick.org (the ImageMagick suite)\nsage/plot/animate.py:- `ImageMagick <http://www.imagemagick.org>`_\nsage/plot/animate.py:              See www.imagemagick.org and www.ffmpeg.org for more information.\nsage/plot/animate.py:        - `ImageMagick <http://www.imagemagick.org>`_\nsage/plot/animate.py:See www.imagemagick.org and www.ffmpeg.org for more information.\"\"\"\nsage/plot/animate.py:See www.imagemagick.org and www.ffmpeg.org for more information.\"\"\"\nsage/plot/animate.py:              See www.imagemagick.org and www.ffmpeg.org for more information.\n\netc.\n```",
    "created_at": "2018-05-30T20:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375439",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:22'></a>Can you provide an example where a command from imagemagick other than `convert` is used in the sage source code?

```
$ sage -grep mogrify
$ sage -grep magick-script
$ sage -grep magick
sage/misc/latex.py:    http://www.imagemagick.org
sage/misc/latex.py:            print("http://www.imagemagick.org to download these programs.")
sage/misc/latex.py:            print("Go to http://www.imagemagick.org to download it.")
sage/misc/latex.py:            print("Go to http://www.imagemagick.org to download it.")
sage/combinat/words/paths.py:            See www.imagemagick.org, for example.
sage/graphs/graph_latex.py:- convert: http://www.imagemagick.org (the ImageMagick suite)
sage/plot/animate.py:- `ImageMagick <http://www.imagemagick.org>`_
sage/plot/animate.py:              See www.imagemagick.org and www.ffmpeg.org for more information.
sage/plot/animate.py:        - `ImageMagick <http://www.imagemagick.org>`_
sage/plot/animate.py:See www.imagemagick.org and www.ffmpeg.org for more information."""
sage/plot/animate.py:See www.imagemagick.org and www.ffmpeg.org for more information."""
sage/plot/animate.py:              See www.imagemagick.org and www.ffmpeg.org for more information.

etc.
```



---

archive/issue_comments_375440.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-30T20:21:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375440",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375441.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-30T20:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375441",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_375442.json:
```json
{
    "body": "<a id='comment:24'></a>Branch rebased on top of 8.3.beta2.\n\nAdded doc about the fact that currently only the presence of convert is checked.\n\nI also fix the doctest that was failing on the patchbot.\n\nNeeds review.",
    "created_at": "2018-05-30T20:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375442",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:24'></a>Branch rebased on top of 8.3.beta2.

Added doc about the fact that currently only the presence of convert is checked.

I also fix the doctest that was failing on the patchbot.

Needs review.



---

archive/issue_comments_375443.json:
```json
{
    "body": "<a id='comment:25'></a>You forgot the copyright.\n\nThe rest looks ok.",
    "created_at": "2018-06-03T09:09:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375443",
    "user": "https://github.com/videlec"
}
```

<a id='comment:25'></a>You forgot the copyright.

The rest looks ok.



---

archive/issue_comments_375444.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-03T09:09:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375444",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_375445.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-07T13:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375445",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_375446.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-07T13:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375446",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_375447.json:
```json
{
    "body": "<a id='comment:28'></a>Rebased the branch on top of 8.3.beta4.\n\nAdded a commit which adds the licence to the newly created files.\n\nNeeds review.",
    "created_at": "2018-06-07T13:40:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375447",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:28'></a>Rebased the branch on top of 8.3.beta4.

Added a commit which adds the licence to the newly created files.

Needs review.



---

archive/issue_comments_375448.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-07T15:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375448",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_375449.json:
```json
{
    "body": "<a id='comment:30'></a>Thank you for the review",
    "created_at": "2018-06-07T19:41:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375449",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:30'></a>Thank you for the review



---

archive/issue_comments_375450.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-09T17:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375450",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063425.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-09T17:49:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25305#event-63425"
}
```



---

archive/issue_comments_375451.json:
```json
{
    "body": "<a id='comment:32'></a>I noticed that some of the doctests have\n\n    # optional -- graphviz\n\nwhile some other doctests have\n\n    # optional: graphviz\n\nAre both styles equivalent?",
    "created_at": "2018-06-13T10:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25305#issuecomment-375451",
    "user": "https://github.com/slel"
}
```

<a id='comment:32'></a>I noticed that some of the doctests have

    # optional -- graphviz

while some other doctests have

    # optional: graphviz

Are both styles equivalent?
