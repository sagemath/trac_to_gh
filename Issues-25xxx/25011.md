# Issue 25011: Better fix to "GCC is installed multiple times"

archive/issues_024774.json:
```json
{
    "assignees": [
        "https://github.com/embray"
    ],
    "body": "#24907 added some code to `configure.ac` that may remove files from `$SAGE_LOCAL` when running `./configure`.  This is at best a bit sketchy.  Instead it should modify something in the Makefile--e.g. enable some rule to clean up GCC.  I haven't fully considered the details yet.  Ideally a fix to this would also not conflict too much with #24919.\n\nConfigure tarball: https://github.com/sagemath/sage/files/ticket25011/configure-280.tar.gz\n\nCC:  @kiwifb @vbraun\n\nBranch: **[`dc56a6c`](https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530)**\n\nReviewer: **Julian R\u00fcth, Dima Pasechnik**\n\nAuthor: **Erik Bray**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25011_\n\n",
    "closed_at": "2018-09-05T16:43:52Z",
    "created_at": "2018-03-19T11:23:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Better fix to \"GCC is installed multiple times\"",
    "type": "issue",
    "updated_at": "2018-09-06T09:33:04Z",
    "url": "https://github.com/sagemath/sage/issues/25011",
    "user": "https://github.com/embray"
}
```
#24907 added some code to `configure.ac` that may remove files from `$SAGE_LOCAL` when running `./configure`.  This is at best a bit sketchy.  Instead it should modify something in the Makefile--e.g. enable some rule to clean up GCC.  I haven't fully considered the details yet.  Ideally a fix to this would also not conflict too much with #24919.

Configure tarball: https://github.com/sagemath/sage/files/ticket25011/configure-280.tar.gz

CC:  @kiwifb @vbraun

Branch: **[`dc56a6c`](https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530)**

Reviewer: **Julian Rüth, Dima Pasechnik**

Author: **Erik Bray**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/25011_





---

archive/issue_events_347481.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-19T11:23:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347481"
}
```



---

archive/issue_events_347482.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-19T11:23:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347482"
}
```



---

archive/issue_events_347483.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-19T11:23:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347483"
}
```



---

archive/issue_events_347484.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-03-19T11:23:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347484"
}
```



---

archive/issue_comments_380900.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI fully agree that #24907 is ugly by the way :-)",
    "created_at": "2018-03-19T11:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380900",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:1" align="right">comment:1</div>

I fully agree that #24907 is ugly by the way :-)



---

archive/issue_comments_380901.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nYep--I don't mind either--I understand it was needed as a quick fix.  I just wish I'd had like 1 hour to give it a look and try something else, but it's fine to fix it later.",
    "created_at": "2018-03-19T11:59:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380901",
    "user": "https://github.com/embray"
}
```

<div id="comment:2" align="right">comment:2</div>

Yep--I don't mind either--I understand it was needed as a quick fix.  I just wish I'd had like 1 hour to give it a look and try something else, but it's fine to fix it later.



---

archive/issue_events_347485.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T10:20:46Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347485"
}
```



---

archive/issue_events_347486.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T10:20:46Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347486"
}
```



---

archive/issue_events_347487.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T10:20:46Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "subject": "https://github.com/embray",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347487"
}
```



---

archive/issue_events_347488.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T12:50:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347488"
}
```



---

archive/issue_comments_380902.json:
```json
{
    "body": "Author: **Erik Bray**",
    "created_at": "2018-04-18T12:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380902",
    "user": "https://github.com/embray"
}
```

Author: **Erik Bray**



---

archive/issue_comments_380903.json:
```json
{
    "body": "Branch: **[u/embray/build/ticket-25011](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-25011)**",
    "created_at": "2018-04-18T12:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380903",
    "user": "https://github.com/embray"
}
```

Branch: **[u/embray/build/ticket-25011](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-25011)**



---

archive/issue_comments_380904.json:
```json
{
    "body": "Commit: **[`829f199`](https://github.com/sagemath/sagetrac-mirror/commit/829f199c2a54e18f97774ec5df8ee15522e4153c)**",
    "created_at": "2018-04-18T12:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380904",
    "user": "https://github.com/embray"
}
```

Commit: **[`829f199`](https://github.com/sagemath/sagetrac-mirror/commit/829f199c2a54e18f97774ec5df8ee15522e4153c)**



---

archive/issue_comments_380905.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nHere's one possible approach to this.  I admit it's still kind of ugly.  But it fulfills the following (arguable) requirements that I set for the solution:\n\n1. A broken \"sage-gcc\" (will use this to refer explicitly to a GCC provided by Sage's gcc SPKG) is detected by configure, which should indicate this state somehow.\n2. If there is a broken sage-gcc it should be cleaned up by make before building any new spkgs.\n3. Once the broken sage-gcc is cleaned up, obviously no further attempt should be made by make to remove sage-gcc (once we rebuild the gcc SPKG we'll want to at least assume that it is no longer broken).\n4. Subsequent calls to `configure` or just `config.status` should still double-check that we have a working sage-gcc, and if not re-indicate that to make.\n\nThis is accomplished by having `configure` spit out a little stamp file to `build/make/.clean-broken-gcc` if a broken sage-gcc is detected.  A special target is added to the Makefile `_clean-broken-gcc` which checks for that stamp file and, if it exists, cleans up the broken sage-gcc and removes the stamp file (the cleanup having been completed).  This target is then added as a prerequisite to building all SPKGs.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f97ecfef40f234c2a3b3ff40efe59dce967cb7b\"><code>2f97ecf</code></a></td><td><code>should still set need_to_install_gcc=yes in configure if Sage's gcc is already installed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7cb9ce1fdeb60793e7d1e364a5dbe6b125243f1\"><code>f7cb9ce</code></a></td><td><code>build/make/Makefile should be rebuild with build/make/Makefile.in is updated</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14b6f4d6ac24d76c5e14b7ceb2901a00332496f4\"><code>14b6f4d</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/83b9004261d99cea30a50399e4402f05e950a9e2\"><code>83b9004</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/829f199c2a54e18f97774ec5df8ee15522e4153c\"><code>829f199</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr></table>\n",
    "created_at": "2018-04-18T12:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380905",
    "user": "https://github.com/embray"
}
```

<div id="comment:4" align="right">comment:4</div>

Here's one possible approach to this.  I admit it's still kind of ugly.  But it fulfills the following (arguable) requirements that I set for the solution:

1. A broken "sage-gcc" (will use this to refer explicitly to a GCC provided by Sage's gcc SPKG) is detected by configure, which should indicate this state somehow.
2. If there is a broken sage-gcc it should be cleaned up by make before building any new spkgs.
3. Once the broken sage-gcc is cleaned up, obviously no further attempt should be made by make to remove sage-gcc (once we rebuild the gcc SPKG we'll want to at least assume that it is no longer broken).
4. Subsequent calls to `configure` or just `config.status` should still double-check that we have a working sage-gcc, and if not re-indicate that to make.

This is accomplished by having `configure` spit out a little stamp file to `build/make/.clean-broken-gcc` if a broken sage-gcc is detected.  A special target is added to the Makefile `_clean-broken-gcc` which checks for that stamp file and, if it exists, cleans up the broken sage-gcc and removes the stamp file (the cleanup having been completed).  This target is then added as a prerequisite to building all SPKGs.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f97ecfef40f234c2a3b3ff40efe59dce967cb7b"><code>2f97ecf</code></a></td><td><code>should still set need_to_install_gcc=yes in configure if Sage's gcc is already installed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7cb9ce1fdeb60793e7d1e364a5dbe6b125243f1"><code>f7cb9ce</code></a></td><td><code>build/make/Makefile should be rebuild with build/make/Makefile.in is updated</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14b6f4d6ac24d76c5e14b7ceb2901a00332496f4"><code>14b6f4d</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/83b9004261d99cea30a50399e4402f05e950a9e2"><code>83b9004</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/829f199c2a54e18f97774ec5df8ee15522e4153c"><code>829f199</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr></table>




---

archive/issue_comments_380906.json:
```json
{
    "body": "Changed commit from **[`829f199`](https://github.com/sagemath/sagetrac-mirror/commit/829f199c2a54e18f97774ec5df8ee15522e4153c)** to **[`d4d7f6d`](https://github.com/sagemath/sagetrac-mirror/commit/d4d7f6de2fdbe3b248424ea3dcec44b249030dc4)**",
    "created_at": "2018-07-13T15:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380906",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`829f199`](https://github.com/sagemath/sagetrac-mirror/commit/829f199c2a54e18f97774ec5df8ee15522e4153c)** to **[`d4d7f6d`](https://github.com/sagemath/sagetrac-mirror/commit/d4d7f6de2fdbe3b248424ea3dcec44b249030dc4)**



---

archive/issue_comments_380907.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74173ece9e67f7a313ac325b53bbd2822b0e96b5\"><code>74173ec</code></a></td><td><code>should still set need_to_install_gcc=yes in configure if Sage's gcc is already installed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e31f57c5c9373cfdd5f8c0244827a58d4257ddf\"><code>2e31f57</code></a></td><td><code>build/make/Makefile should be rebuild with build/make/Makefile.in is updated</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/755bc58dc84de51847efaf966b0b5680721205ec\"><code>755bc58</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dd19cc95b96dda1646e582ab336ba647400565ce\"><code>dd19cc9</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4d7f6de2fdbe3b248424ea3dcec44b249030dc4\"><code>d4d7f6d</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr></table>\n",
    "created_at": "2018-07-13T15:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380907",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74173ece9e67f7a313ac325b53bbd2822b0e96b5"><code>74173ec</code></a></td><td><code>should still set need_to_install_gcc=yes in configure if Sage's gcc is already installed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e31f57c5c9373cfdd5f8c0244827a58d4257ddf"><code>2e31f57</code></a></td><td><code>build/make/Makefile should be rebuild with build/make/Makefile.in is updated</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/755bc58dc84de51847efaf966b0b5680721205ec"><code>755bc58</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dd19cc95b96dda1646e582ab336ba647400565ce"><code>dd19cc9</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4d7f6de2fdbe3b248424ea3dcec44b249030dc4"><code>d4d7f6d</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr></table>




---

archive/issue_comments_380908.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAlthough not explicitly needed, I've rebased this on 8.3.rc0, so that I can also rebase #24919",
    "created_at": "2018-07-13T15:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380908",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Although not explicitly needed, I've rebased this on 8.3.rc0, so that I can also rebase #24919



---

archive/issue_comments_380909.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI find this somewhat confusing and I wonder whether we really need all this special logic for this case (I don't know about the history of this, so I might have the wrong perspective\u2026)\n\nHere are a few questions:\n* Do I understand correctly that we only test GCC if we provided it? Why don't we always test?\n* Do we need the \"uninstall\" logic? Can't we just tell people that their GCC is broken and they should reinstall Sage, i.e., how frequent is this issue?",
    "created_at": "2018-07-17T14:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380909",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:7" align="right">comment:7</div>

I find this somewhat confusing and I wonder whether we really need all this special logic for this case (I don't know about the history of this, so I might have the wrong perspective…)

Here are a few questions:
* Do I understand correctly that we only test GCC if we provided it? Why don't we always test?
* Do we need the "uninstall" logic? Can't we just tell people that their GCC is broken and they should reinstall Sage, i.e., how frequent is this issue?



---

archive/issue_comments_380910.json:
```json
{
    "body": "Reviewer: **Julian R\u00fcth**",
    "created_at": "2018-07-17T14:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380910",
    "user": "https://github.com/saraedum"
}
```

Reviewer: **Julian Rüth**



---

archive/issue_events_347489.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-07-17T14:44:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347489"
}
```



---

archive/issue_events_347490.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-07-17T14:44:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347490"
}
```



---

archive/issue_comments_380911.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@saraedum](#comment:7):\n> I find this somewhat confusing and I wonder whether we really need all this special logic for this case (I don't know about the history of this, so I might have the wrong perspective\u2026)\n\nI don't exactly remember all the history myself. But whatever the case, the central issue is that if you install Sage's GCC package (I call it \"sage-gcc\"), and then somehow or other that gcc is broken (don't ask me how, but apparently it has happened due to past bugs), then you basically can't build any package for Sage anymore because it will try by default to use sage-gcc (since Sage-the-distribution mixes its build environment with its runtime target), and there's no way to force it *not* to.  So sage-gcc is installed but broken it's necessary as soon as possible to remove it.\n\nThe immediate background to this ticket, then, is that in #24907 Jeroen added a workaround which \"fixes\" it by `rm -rf`ing files from sage-gcc if it exists, and is broken.  The problem is that this is done by the `./configure` script itself, which really ought not to be writing things to `$SAGE_LOCAL` at all.\n\nThis fix then just uses `./configure` to test whether sage-gcc exists and is broken, and adds a special make target to clean it up immediately before trying to build anything else.  Therefore the existing Sage environment can still keep working, and sage-gcc can even be reinstalled if desired.\n\n> Here are a few questions:\n> * Do I understand correctly that we only test GCC if we provided it? Why don't we always test?\n\nNo, if you look later in the `configure.ac` there are several compiler-related checks, mostly using standard autoconf macros; however if you have a broken sage-gcc those will fail and the end result is Sage deciding that you need to install sage-gcc even though it's already installed (but broken).  This leads to basically an infinite loop of Sage trying to reinstall sage-gcc.\n\nTherefore it's necessary to have an explicit test for this case early on and make note of it.\n\n> * Do we need the \"uninstall\" logic? Can't we just tell people that their GCC is broken and they should reinstall Sage, i.e., how frequent is this issue?\n\nA few things about this:\n\n1. I resent that we ship our own GCC at all.  I would just as soon not, but enough people think that's important enough that we need to bend over backwards to support it and I don't care to fight that (just make it work a little better I hope, but that's a separate issue).\n\n2. Personally I would be fine with just saying \"do a make dist-clean and try again\".  But that does kind of suck because for some people building from scratch does take a very long time, and having a broken sage-gcc doesn't necessarily invalidate all the rest of the build.\n\n3. The uninstall process itself (all the `rm -rf`'s will be improved soon as we have DESTDIR support for sage-gcc.  Then we can replace that with just `sage-spkg-uninstall gcc` and it will be much cleaner overall.\n\n4. I'd also prefer if `./configure` just reported \"you have sage-gcc but it's broken; please uninstall it\".  But for automated builds and stuff like that it is kind of useful to have an automated cleanup.",
    "created_at": "2018-07-17T15:18:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380911",
    "user": "https://github.com/embray"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@saraedum](#comment:7):
> I find this somewhat confusing and I wonder whether we really need all this special logic for this case (I don't know about the history of this, so I might have the wrong perspective…)

I don't exactly remember all the history myself. But whatever the case, the central issue is that if you install Sage's GCC package (I call it "sage-gcc"), and then somehow or other that gcc is broken (don't ask me how, but apparently it has happened due to past bugs), then you basically can't build any package for Sage anymore because it will try by default to use sage-gcc (since Sage-the-distribution mixes its build environment with its runtime target), and there's no way to force it *not* to.  So sage-gcc is installed but broken it's necessary as soon as possible to remove it.

The immediate background to this ticket, then, is that in #24907 Jeroen added a workaround which "fixes" it by `rm -rf`ing files from sage-gcc if it exists, and is broken.  The problem is that this is done by the `./configure` script itself, which really ought not to be writing things to `$SAGE_LOCAL` at all.

This fix then just uses `./configure` to test whether sage-gcc exists and is broken, and adds a special make target to clean it up immediately before trying to build anything else.  Therefore the existing Sage environment can still keep working, and sage-gcc can even be reinstalled if desired.

> Here are a few questions:
> * Do I understand correctly that we only test GCC if we provided it? Why don't we always test?

No, if you look later in the `configure.ac` there are several compiler-related checks, mostly using standard autoconf macros; however if you have a broken sage-gcc those will fail and the end result is Sage deciding that you need to install sage-gcc even though it's already installed (but broken).  This leads to basically an infinite loop of Sage trying to reinstall sage-gcc.

Therefore it's necessary to have an explicit test for this case early on and make note of it.

> * Do we need the "uninstall" logic? Can't we just tell people that their GCC is broken and they should reinstall Sage, i.e., how frequent is this issue?

A few things about this:

1. I resent that we ship our own GCC at all.  I would just as soon not, but enough people think that's important enough that we need to bend over backwards to support it and I don't care to fight that (just make it work a little better I hope, but that's a separate issue).

2. Personally I would be fine with just saying "do a make dist-clean and try again".  But that does kind of suck because for some people building from scratch does take a very long time, and having a broken sage-gcc doesn't necessarily invalidate all the rest of the build.

3. The uninstall process itself (all the `rm -rf`'s will be improved soon as we have DESTDIR support for sage-gcc.  Then we can replace that with just `sage-spkg-uninstall gcc` and it will be much cleaner overall.

4. I'd also prefer if `./configure` just reported "you have sage-gcc but it's broken; please uninstall it".  But for automated builds and stuff like that it is kind of useful to have an automated cleanup.



---

archive/issue_events_347491.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-17T15:18:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347491"
}
```



---

archive/issue_events_347492.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-17T15:18:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347492"
}
```



---

archive/issue_comments_380912.json:
```json
{
    "body": "Changed commit from **[`d4d7f6d`](https://github.com/sagemath/sagetrac-mirror/commit/d4d7f6de2fdbe3b248424ea3dcec44b249030dc4)** to **[`42153c1`](https://github.com/sagemath/sagetrac-mirror/commit/42153c1f7ff4e89b981e14e81211b4a732bfb24f)**",
    "created_at": "2018-07-18T10:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380912",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d4d7f6d`](https://github.com/sagemath/sagetrac-mirror/commit/d4d7f6de2fdbe3b248424ea3dcec44b249030dc4)** to **[`42153c1`](https://github.com/sagemath/sagetrac-mirror/commit/42153c1f7ff4e89b981e14e81211b4a732bfb24f)**



---

archive/issue_comments_380913.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9346272e366e12a48dc1bc559105db1d0679f442\"><code>9346272</code></a></td><td><code>should still set need_to_install_gcc=yes in configure if Sage's gcc is already installed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/363bc17a2d5f7667a59ea062915cfc2d0b8fec18\"><code>363bc17</code></a></td><td><code>build/make/Makefile should be rebuilt when build/make/Makefile.in is updated</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8991c0110605066bc8483ef3a9ec3467fbbd287\"><code>d8991c0</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d3beac8151aabc931db7577d34225746913680a2\"><code>d3beac8</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/42153c1f7ff4e89b981e14e81211b4a732bfb24f\"><code>42153c1</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr></table>\n",
    "created_at": "2018-07-18T10:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380913",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9346272e366e12a48dc1bc559105db1d0679f442"><code>9346272</code></a></td><td><code>should still set need_to_install_gcc=yes in configure if Sage's gcc is already installed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/363bc17a2d5f7667a59ea062915cfc2d0b8fec18"><code>363bc17</code></a></td><td><code>build/make/Makefile should be rebuilt when build/make/Makefile.in is updated</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8991c0110605066bc8483ef3a9ec3467fbbd287"><code>d8991c0</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d3beac8151aabc931db7577d34225746913680a2"><code>d3beac8</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/42153c1f7ff4e89b981e14e81211b4a732bfb24f"><code>42153c1</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr></table>




---

archive/issue_comments_380914.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n(the above was just rebasing on 8.3.rc1 and fixing some typos in a commit message)",
    "created_at": "2018-07-18T10:05:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380914",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

(the above was just rebasing on 8.3.rc1 and fixing some typos in a commit message)



---

archive/issue_comments_380915.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nAck, I see why I'm getting mixed up.  I keep confusing this ticket with #25188; I seem to be having a serious dyslexic moment right now.",
    "created_at": "2018-07-18T10:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380915",
    "user": "https://github.com/embray"
}
```

<div id="comment:13" align="right">comment:13</div>

Ack, I see why I'm getting mixed up.  I keep confusing this ticket with #25188; I seem to be having a serious dyslexic moment right now.



---

archive/issue_comments_380916.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1153d736816dad8bb8368e6188636cb82502fcce\"><code>1153d73</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a6f7e5bebeafa39ac0977694bd864bad7e039d1\"><code>1a6f7e5</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52ef4c9cdd74390ecfb6b0c8d455c597f4612410\"><code>52ef4c9</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr></table>\n",
    "created_at": "2018-07-18T10:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380916",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1153d736816dad8bb8368e6188636cb82502fcce"><code>1153d73</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a6f7e5bebeafa39ac0977694bd864bad7e039d1"><code>1a6f7e5</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52ef4c9cdd74390ecfb6b0c8d455c597f4612410"><code>52ef4c9</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr></table>




---

archive/issue_comments_380917.json:
```json
{
    "body": "Changed commit from **[`42153c1`](https://github.com/sagemath/sagetrac-mirror/commit/42153c1f7ff4e89b981e14e81211b4a732bfb24f)** to **[`52ef4c9`](https://github.com/sagemath/sagetrac-mirror/commit/52ef4c9cdd74390ecfb6b0c8d455c597f4612410)**",
    "created_at": "2018-07-18T10:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380917",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`42153c1`](https://github.com/sagemath/sagetrac-mirror/commit/42153c1f7ff4e89b981e14e81211b4a732bfb24f)** to **[`52ef4c9`](https://github.com/sagemath/sagetrac-mirror/commit/52ef4c9cdd74390ecfb6b0c8d455c597f4612410)**



---

archive/issue_comments_380918.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI believe this issue can reasonably be addressed for Sage 8.4.",
    "created_at": "2018-07-18T11:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380918",
    "user": "https://github.com/embray"
}
```

<div id="comment:15" align="right">comment:15</div>

I believe this issue can reasonably be addressed for Sage 8.4.



---

archive/issue_events_347493.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347493"
}
```



---

archive/issue_events_347494.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:47:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347494"
}
```



---

archive/issue_comments_380919.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nSomething about this still isn't right.  Adding the `_clean-broken-gcc` phony target to gcc's dependencies forces `make gcc` to run even when it shouldn't.  I don't think that's how I intended `_clean-broken-gcc` to be used when I first started working on this issue, so I must have been out of my mind when I did that.",
    "created_at": "2018-07-18T13:35:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380919",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Something about this still isn't right.  Adding the `_clean-broken-gcc` phony target to gcc's dependencies forces `make gcc` to run even when it shouldn't.  I don't think that's how I intended `_clean-broken-gcc` to be used when I first started working on this issue, so I must have been out of my mind when I did that.



---

archive/issue_events_347495.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T13:35:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347495"
}
```



---

archive/issue_events_347496.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T13:35:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347496"
}
```



---

archive/issue_comments_380920.json:
```json
{
    "body": "Changed commit from **[`52ef4c9`](https://github.com/sagemath/sagetrac-mirror/commit/52ef4c9cdd74390ecfb6b0c8d455c597f4612410)** to **[`68990b9`](https://github.com/sagemath/sagetrac-mirror/commit/68990b96af2268ab2c9015741868a840bd69dd47)**",
    "created_at": "2018-07-19T07:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380920",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`52ef4c9`](https://github.com/sagemath/sagetrac-mirror/commit/52ef4c9cdd74390ecfb6b0c8d455c597f4612410)** to **[`68990b9`](https://github.com/sagemath/sagetrac-mirror/commit/68990b96af2268ab2c9015741868a840bd69dd47)**



---

archive/issue_comments_380921.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1eb1f332514617506fe3f97ce51b1b86a3bb01d4\"><code>1eb1f33</code></a></td><td><code>fix a typo with wildcards and add some gcc-* executables to be removed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68990b96af2268ab2c9015741868a840bd69dd47\"><code>68990b9</code></a></td><td><code>rather than try to make _clean-broken-gcc explicitly a prerequisite of spkg targets</code></td></tr></table>\n",
    "created_at": "2018-07-19T07:29:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380921",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1eb1f332514617506fe3f97ce51b1b86a3bb01d4"><code>1eb1f33</code></a></td><td><code>fix a typo with wildcards and add some gcc-* executables to be removed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68990b96af2268ab2c9015741868a840bd69dd47"><code>68990b9</code></a></td><td><code>rather than try to make _clean-broken-gcc explicitly a prerequisite of spkg targets</code></td></tr></table>




---

archive/issue_events_347497.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-19T07:33:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347497"
}
```



---

archive/issue_events_347498.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-19T07:33:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347498"
}
```



---

archive/issue_comments_380922.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI think this does the \"right\" thing now, so far as any of this is reasonable...",
    "created_at": "2018-07-19T07:33:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380922",
    "user": "https://github.com/embray"
}
```

<div id="comment:18" align="right">comment:18</div>

I think this does the "right" thing now, so far as any of this is reasonable...



---

archive/issue_comments_380923.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nOne thing to understand about the gcc spkg which I keep forgetting, but is important to how this works, is that at the end of its `spkg-install` script it runs `touch $SAGE_ROOT/configure`.  This means before any other package is built, it is forced to re-run `./configure`.\n\nWhen sage-gcc is installed it adds `$(SAGE_LOCAL)/bin/gcc` as a prerequisite to every spkg when `build/make/Makefile` is generated.  Since sage-gcc was forced to be reinstalled, this means `bin/gcc` will be newer than any other packages' stamp files, so they are forced to be rebuilt as well (this behavior was implemented partly in #24703).",
    "created_at": "2018-07-19T07:36:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380923",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

One thing to understand about the gcc spkg which I keep forgetting, but is important to how this works, is that at the end of its `spkg-install` script it runs `touch $SAGE_ROOT/configure`.  This means before any other package is built, it is forced to re-run `./configure`.

When sage-gcc is installed it adds `$(SAGE_LOCAL)/bin/gcc` as a prerequisite to every spkg when `build/make/Makefile` is generated.  Since sage-gcc was forced to be reinstalled, this means `bin/gcc` will be newer than any other packages' stamp files, so they are forced to be rebuilt as well (this behavior was implemented partly in #24703).



---

archive/issue_comments_380924.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThe fact that we ship gcc is largely due to the need to provide gfortran (or some other modern fortran) on OSX.\n\nPerhaps we should separate Sage from Sage's build toolchain, this would be a step towards despahgettifying this a bit.",
    "created_at": "2018-08-16T08:58:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380924",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

The fact that we ship gcc is largely due to the need to provide gfortran (or some other modern fortran) on OSX.

Perhaps we should separate Sage from Sage's build toolchain, this would be a step towards despahgettifying this a bit.



---

archive/issue_comments_380925.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nlooks good to me.",
    "created_at": "2018-08-16T09:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380925",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:21" align="right">comment:21</div>

looks good to me.



---

archive/issue_comments_380926.json:
```json
{
    "body": "Changed reviewer from **Julian R\u00fcth** to **Julian R\u00fcth, Dima Pasechnik**",
    "created_at": "2018-08-16T09:33:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380926",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **Julian Rüth** to **Julian Rüth, Dima Pasechnik**



---

archive/issue_events_347499.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-08-16T09:34:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347499"
}
```



---

archive/issue_events_347500.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-08-16T09:34:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347500"
}
```



---

archive/issue_comments_380927.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@dimpase](#comment:20):\n> The fact that we ship gcc is largely due to the need to provide gfortran (or some other modern fortran) on OSX.\n> \n> Perhaps we should separate Sage from Sage's build toolchain, this would be a step towards despahgettifying this a bit.\n\nI am 100% in favor of that and have a plan in mind for doing so.  But it's yet another herculean task that I'm not prepared to take on until I've made more progress on a few others (though it would certainly make some things I'm trying to do easier--maybe I shouldn't gone with my first instinct of pushing more for that in the first place).",
    "created_at": "2018-08-16T11:09:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380927",
    "user": "https://github.com/embray"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@dimpase](#comment:20):
> The fact that we ship gcc is largely due to the need to provide gfortran (or some other modern fortran) on OSX.
> 
> Perhaps we should separate Sage from Sage's build toolchain, this would be a step towards despahgettifying this a bit.

I am 100% in favor of that and have a plan in mind for doing so.  But it's yet another herculean task that I'm not prepared to take on until I've made more progress on a few others (though it would certainly make some things I'm trying to do easier--maybe I shouldn't gone with my first instinct of pushing more for that in the first place).



---

archive/issue_events_347501.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-18T17:45:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347501"
}
```



---

archive/issue_events_347502.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-18T17:45:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347502"
}
```



---

archive/issue_comments_380928.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nIf autotools are not installed:\n\n```\nmake[1]: warning: -jN forced in submake: disabling jobserver mode.\nmake[1]: Entering directory '/home/buildbot/slave/sage_git/build/build/make'\nmake[1]: *** No rule to make target '@SAGE_GCC_DEP@', needed by '/home/buildbot/slave/sage_git/build/local/var/lib/sage/installed/patch-2.7.5'.\nmake[1]: Target 'base-toolchain' not remade because of errors.\nmake[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'\n```",
    "created_at": "2018-08-18T17:45:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380928",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:24" align="right">comment:24</div>

If autotools are not installed:

```
make[1]: warning: -jN forced in submake: disabling jobserver mode.
make[1]: Entering directory '/home/buildbot/slave/sage_git/build/build/make'
make[1]: *** No rule to make target '@SAGE_GCC_DEP@', needed by '/home/buildbot/slave/sage_git/build/local/var/lib/sage/installed/patch-2.7.5'.
make[1]: Target 'base-toolchain' not remade because of errors.
make[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'
```



---

archive/issue_comments_380929.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@vbraun](#comment:24):\n> If autotools are not installed:\n> \n> ```\n> make[1]: warning: -jN forced in submake: disabling jobserver mode.\n> make[1]: Entering directory '/home/buildbot/slave/sage_git/build/build/make'\n> make[1]: *** No rule to make target '@SAGE_GCC_DEP@', needed by '/home/buildbot/slave/sage_git/build/local/var/lib/sage/installed/patch-2.7.5'.\n> make[1]: Target 'base-toolchain' not remade because of errors.\n> make[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'\n> ```\n\nThis must be a buildbot setup bug, at least I cannot reproduce it. Probably the bot has a stale\n./configure (as ./configure is no longer under git, the bot needs to get it somehow, autotools or not).",
    "created_at": "2018-08-19T06:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380929",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@vbraun](#comment:24):
> If autotools are not installed:
> 
> ```
> make[1]: warning: -jN forced in submake: disabling jobserver mode.
> make[1]: Entering directory '/home/buildbot/slave/sage_git/build/build/make'
> make[1]: *** No rule to make target '@SAGE_GCC_DEP@', needed by '/home/buildbot/slave/sage_git/build/local/var/lib/sage/installed/patch-2.7.5'.
> make[1]: Target 'base-toolchain' not remade because of errors.
> make[1]: Leaving directory '/home/buildbot/slave/sage_git/build/build/make'
> ```

This must be a buildbot setup bug, at least I cannot reproduce it. Probably the bot has a stale
./configure (as ./configure is no longer under git, the bot needs to get it somehow, autotools or not).



---

archive/issue_events_347503.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-08-19T06:43:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347503"
}
```



---

archive/issue_events_347504.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-08-19T06:43:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347504"
}
```



---

archive/issue_comments_380930.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOr it might be I don't understand the workflow for tickets involving modifications to ./configure.",
    "created_at": "2018-08-19T06:53:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380930",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Or it might be I don't understand the workflow for tickets involving modifications to ./configure.



---

archive/issue_comments_380931.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI agree with Dima.  Obviously you can't apply this change requires rebuilding the `configure` script.  How do you normally handle tickets that modify `configure`?  In this case both `configure.ac` and one of the `m4/` macros were updated.",
    "created_at": "2018-08-20T10:13:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380931",
    "user": "https://github.com/embray"
}
```

<div id="comment:27" align="right">comment:27</div>

I agree with Dima.  Obviously you can't apply this change requires rebuilding the `configure` script.  How do you normally handle tickets that modify `configure`?  In this case both `configure.ac` and one of the `m4/` macros were updated.



---

archive/issue_comments_380932.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nIt would be good to have answers on this because I have made changes in the past that modified configure, and have many more coming down the pipeline....",
    "created_at": "2018-08-20T10:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380932",
    "user": "https://github.com/embray"
}
```

<div id="comment:28" align="right">comment:28</div>

It would be good to have answers on this because I have made changes in the past that modified configure, and have many more coming down the pipeline....



---

archive/issue_comments_380933.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nOK, it's came back from my brain swap: e.g. on #12426 one was creating \n`configure-XYZ.tar.gz` to be placed in SAGE_ROOT/upstream, containing\n\n```\nconfigure\nconfig/compile\nconfig/config.guess\nconfig/config.sub\nconfig/install-sh\nconfig/missing\nbuild/make/Makefile-auto.in\n```\nwith XYZ doing a version bump. I don't know how it was done - perhaps just `tar`?\nfbissey should know. IMHO it's a hassle, and ought to be handled by build/patch-bots.",
    "created_at": "2018-08-20T12:37:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380933",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

OK, it's came back from my brain swap: e.g. on #12426 one was creating 
`configure-XYZ.tar.gz` to be placed in SAGE_ROOT/upstream, containing

```
configure
config/compile
config/config.guess
config/config.sub
config/install-sh
config/missing
build/make/Makefile-auto.in
```
with XYZ doing a version bump. I don't know how it was done - perhaps just `tar`?
fbissey should know. IMHO it's a hassle, and ought to be handled by build/patch-bots.



---

archive/issue_comments_380934.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@dimpase](#comment:29):\n> IMHO it's a hassle, and ought to be handled by build/patch-bots.\n\nI think normally it is.  Because the first time I updated `configure.ac` I also provided a configure tarball (there is actually a script that makes it--you can build it by running `./bootstrap -s`).\n\nBut somebody (I think either Volker or Jeroen) told me it wasn't necessary, and I haven't needed to bother since, even with tickets that changed much more than this one.  So I'm at a loss.",
    "created_at": "2018-08-20T13:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380934",
    "user": "https://github.com/embray"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@dimpase](#comment:29):
> IMHO it's a hassle, and ought to be handled by build/patch-bots.

I think normally it is.  Because the first time I updated `configure.ac` I also provided a configure tarball (there is actually a script that makes it--you can build it by running `./bootstrap -s`).

But somebody (I think either Volker or Jeroen) told me it wasn't necessary, and I haven't needed to bother since, even with tickets that changed much more than this one.  So I'm at a loss.



---

archive/issue_comments_380935.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@dimpase](#comment:29):\n> OK, it's came back from my brain swap: e.g. on #12426 one was creating \n> `configure-XYZ.tar.gz` to be placed in SAGE_ROOT/upstream, containing\n> \n> ```\n> configure\n> config/compile\n> config/config.guess\n> config/config.sub\n> config/install-sh\n> config/missing\n> build/make/Makefile-auto.in\n> ```\n> with XYZ doing a version bump. I don't know how it was done - perhaps just `tar`?\n> fbissey should know. IMHO it's a hassle, and ought to be handled by build/patch-bots.\n\nFor info, it is produced by a switch of the `bootstrap` script (`-s`) that you use to regenerate configure.",
    "created_at": "2018-08-20T19:16:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380935",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@dimpase](#comment:29):
> OK, it's came back from my brain swap: e.g. on #12426 one was creating 
> `configure-XYZ.tar.gz` to be placed in SAGE_ROOT/upstream, containing
> 
> ```
> configure
> config/compile
> config/config.guess
> config/config.sub
> config/install-sh
> config/missing
> build/make/Makefile-auto.in
> ```
> with XYZ doing a version bump. I don't know how it was done - perhaps just `tar`?
> fbissey should know. IMHO it's a hassle, and ought to be handled by build/patch-bots.

For info, it is produced by a switch of the `bootstrap` script (`-s`) that you use to regenerate configure.



---

archive/issue_comments_380936.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nI wrote that just above :)\n\nI'll go ahead and do that, but in the past I haven't had to...",
    "created_at": "2018-08-21T11:18:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380936",
    "user": "https://github.com/embray"
}
```

<div id="comment:32" align="right">comment:32</div>

I wrote that just above :)

I'll go ahead and do that, but in the past I haven't had to...



---

archive/issue_comments_380937.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nSo, what are we supposed to do about this?",
    "created_at": "2018-08-22T10:28:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380937",
    "user": "https://github.com/embray"
}
```

<div id="comment:33" align="right">comment:33</div>

So, what are we supposed to do about this?



---

archive/issue_events_347505.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-22T22:03:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347505"
}
```



---

archive/issue_events_347506.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-22T22:03:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347506"
}
```



---

archive/issue_comments_380938.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\ncreate new confball and add link to ticket",
    "created_at": "2018-08-22T22:03:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380938",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:34" align="right">comment:34</div>

create new confball and add link to ticket



---

archive/issue_comments_380939.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nWeird that I never had to do that before.  Does that mean some of my configure.ac changes weren't being tested?",
    "created_at": "2018-08-23T11:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380939",
    "user": "https://github.com/embray"
}
```

<div id="comment:35" align="right">comment:35</div>

Weird that I never had to do that before.  Does that mean some of my configure.ac changes weren't being tested?



---

archive/issue_comments_380940.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nI don't see why the buildbot master cannot run ./bootstrap before going further:\n\nhttp://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html",
    "created_at": "2018-08-23T12:40:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380940",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:36" align="right">comment:36</div>

I don't see why the buildbot master cannot run ./bootstrap before going further:

http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html



---

archive/issue_comments_380941.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@dimpase](#comment:36):\n> I don't see why the buildbot master cannot run ./bootstrap before going further:\n> \n> http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html\n\nIt does implicitly--the top-level `Makefile` re-runs `./bootstrap` if `configure` needs to be rebuilt (i.e. `configure.ac` or any of the `m4/` files changed).\n\nHowever, Volker is pointing out that this does not work for systems that don't have autoconf installed, such that running `./bootstrap` fails.\n\nPerhaps it's new that there's a buildbot build where that is the case?  I don't remember having any problem with this before.  Obviously on a system with no autoconf it's not going to work unless they can download a new `configure` tarball.",
    "created_at": "2018-08-23T12:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380941",
    "user": "https://github.com/embray"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@dimpase](#comment:36):
> I don't see why the buildbot master cannot run ./bootstrap before going further:
> 
> http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html

It does implicitly--the top-level `Makefile` re-runs `./bootstrap` if `configure` needs to be rebuilt (i.e. `configure.ac` or any of the `m4/` files changed).

However, Volker is pointing out that this does not work for systems that don't have autoconf installed, such that running `./bootstrap` fails.

Perhaps it's new that there's a buildbot build where that is the case?  I don't remember having any problem with this before.  Obviously on a system with no autoconf it's not going to work unless they can download a new `configure` tarball.



---

archive/issue_comments_380942.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@vbraun](#comment:34):\n> create new confball and add link to ticket\n\nDoes that mean I have to do that for every ticket that modifies configure?  Because I have several like that.",
    "created_at": "2018-08-23T12:59:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380942",
    "user": "https://github.com/embray"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@vbraun](#comment:34):
> create new confball and add link to ticket

Does that mean I have to do that for every ticket that modifies configure?  Because I have several like that.



---

archive/issue_comments_380943.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@embray](#comment:38):\n> Does that mean I have to do that for every ticket that modifies configure?  Because I have several like that.\n\nOnly if `configure.ac` is modified in an *incompatible* way. Sometimes you can get away with using an old version of `configure`.\n\nYes, it's annoying and it should be fixed by changing the release manager workflow.",
    "created_at": "2018-08-23T13:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380943",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@embray](#comment:38):
> Does that mean I have to do that for every ticket that modifies configure?  Because I have several like that.

Only if `configure.ac` is modified in an *incompatible* way. Sometimes you can get away with using an old version of `configure`.

Yes, it's annoying and it should be fixed by changing the release manager workflow.



---

archive/issue_comments_380944.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nReplying to [@embray](#comment:37):\n> Replying to [@dimpase](#comment:36):\n> > I don't see why the buildbot master cannot run ./bootstrap before going further:\n> > \n> > http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html\n\n> \n> It does implicitly--the top-level `Makefile` re-runs `./bootstrap` if `configure` needs to be rebuilt (i.e. `configure.ac` or any of the `m4/` files changed).\n> \n> However, Volker is pointing out that this does not work for systems that don't have autoconf installed, such that running `./bootstrap` fails.\n> \n> Perhaps it's new that there's a buildbot build where that is the case?  I don't remember having any problem with this before.  Obviously on a system with no autoconf it's not going to work unless they can download a new `configure` tarball.\n\nIMHO, buildbot is master-slave, and building happens on slaves, which get jobs from the master. I am saying that master should run ./bootstrap and send it over to slaves.",
    "created_at": "2018-08-23T13:43:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380944",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:40" align="right">comment:40</div>

Replying to [@embray](#comment:37):
> Replying to [@dimpase](#comment:36):
> > I don't see why the buildbot master cannot run ./bootstrap before going further:
> > 
> > http://docs.buildbot.net/0.8.3/Running-Commands-on-the-Master.html

> 
> It does implicitly--the top-level `Makefile` re-runs `./bootstrap` if `configure` needs to be rebuilt (i.e. `configure.ac` or any of the `m4/` files changed).
> 
> However, Volker is pointing out that this does not work for systems that don't have autoconf installed, such that running `./bootstrap` fails.
> 
> Perhaps it's new that there's a buildbot build where that is the case?  I don't remember having any problem with this before.  Obviously on a system with no autoconf it's not going to work unless they can download a new `configure` tarball.

IMHO, buildbot is master-slave, and building happens on slaves, which get jobs from the master. I am saying that master should run ./bootstrap and send it over to slaves.



---

archive/issue_comments_380945.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nUnfortunately that's not really how buildbot works.  In any case there's no reason the workers can't have autotools installed.  My guess is just that there is deliberately one that does not, in order to catch cases where a new `configure` tarball must be built.  I don't think that makes a lot of sense--I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do :shrug:",
    "created_at": "2018-08-23T15:05:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380945",
    "user": "https://github.com/embray"
}
```

<div id="comment:41" align="right">comment:41</div>

Unfortunately that's not really how buildbot works.  In any case there's no reason the workers can't have autotools installed.  My guess is just that there is deliberately one that does not, in order to catch cases where a new `configure` tarball must be built.  I don't think that makes a lot of sense--I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do :shrug:



---

archive/issue_comments_380946.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@embray](#comment:41):\n> Unfortunately that's not really how buildbot works.  In any case there's no reason the workers can't have autotools installed.  My guess is just that there is deliberately one that does not, in order to catch cases where a new `configure` tarball must be built.  I don't think that makes a lot of sense--I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do :shrug:\n\nWell I can think of one. Many people don't have autotools installed. Having autotools installed will mask the fact that a package forgot to run it after a change. It may then fail on a end user machine where autotools is not present and the maintainer mode kicks in and trigger a re-run.",
    "created_at": "2018-08-23T21:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380946",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@embray](#comment:41):
> Unfortunately that's not really how buildbot works.  In any case there's no reason the workers can't have autotools installed.  My guess is just that there is deliberately one that does not, in order to catch cases where a new `configure` tarball must be built.  I don't think that makes a lot of sense--I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do :shrug:

Well I can think of one. Many people don't have autotools installed. Having autotools installed will mask the fact that a package forgot to run it after a change. It may then fail on a end user machine where autotools is not present and the maintainer mode kicks in and trigger a re-run.



---

archive/issue_comments_380947.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nit is clear that Sage installation should not need autotools. What is unclear to me is why the release building process must run without autotools, and need a manually built configure tarball, something that is not only inconvenient, but error prone as well. \n\nby right, package configure must be updated, version bumped, as\n https://github.com/sagemath/sage/blob/master/build/pkgs/configure/checksums.ini\n\n\nshould not be ignored.\nPerhaps all this may be done by trac, automatically, for the lack of better place?",
    "created_at": "2018-08-24T09:41:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380947",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:43" align="right">comment:43</div>

it is clear that Sage installation should not need autotools. What is unclear to me is why the release building process must run without autotools, and need a manually built configure tarball, something that is not only inconvenient, but error prone as well. 

by right, package configure must be updated, version bumped, as
 https://github.com/sagemath/sage/blob/master/build/pkgs/configure/checksums.ini


should not be ignored.
Perhaps all this may be done by trac, automatically, for the lack of better place?



---

archive/issue_comments_380948.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@dimpase](#comment:43):\n> it is clear that Sage installation should not need autotools. What is unclear to me is why the release building process must run without autotools, and need a manually built configure tarball, something that is not only inconvenient, but error prone as well. \n\nExactly.  There's no reason (at least not obvious) the release process shouldn't just do this automatically, including for \"beta\" releases, so I don't see why this is being held up by a buildbot that can't build properly.\n\nThe fact that I've made past changes to configure but where it \"happened\" to keep working on those buildbots is a further argument that it's not useful to have in the first place.\n\nIt's not that I mind generating and uploading a new configure tarball.  That's easy.  Of course as I have multiple tickets open that modify configure, and as I have no way to \"guess\" which ones will or will not \"happen\" to work without an updated configure tarball, that just means I now have to generate configure tarballs for all of them, which is necessarily going to lead to merge conflicts, and slower acceptance of these tickets (each one is going to have a different new configure tarball go along with it).",
    "created_at": "2018-08-24T09:48:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380948",
    "user": "https://github.com/embray"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@dimpase](#comment:43):
> it is clear that Sage installation should not need autotools. What is unclear to me is why the release building process must run without autotools, and need a manually built configure tarball, something that is not only inconvenient, but error prone as well. 

Exactly.  There's no reason (at least not obvious) the release process shouldn't just do this automatically, including for "beta" releases, so I don't see why this is being held up by a buildbot that can't build properly.

The fact that I've made past changes to configure but where it "happened" to keep working on those buildbots is a further argument that it's not useful to have in the first place.

It's not that I mind generating and uploading a new configure tarball.  That's easy.  Of course as I have multiple tickets open that modify configure, and as I have no way to "guess" which ones will or will not "happen" to work without an updated configure tarball, that just means I now have to generate configure tarballs for all of them, which is necessarily going to lead to merge conflicts, and slower acceptance of these tickets (each one is going to have a different new configure tarball go along with it).



---

archive/issue_comments_380949.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nFor the record, the release script generates a new confball for every beta/rc release but not for every merged ticket. Doing it for every ticket has issues with size (every confball is 100k on the mirrors) and, more importantly, would make it more difficult for me to unmerge tickets because the version would always conflict.\n\nAn automatted solution would at the very least need to detect when a new confball is needed. E.g. extend ./bootstrap to have a maybe-save option that only saves a new confball if there was a relevant change over the current confball. And use non-consecutive version numbers. Perhaps just use a hash of the content (excluding file timestamps) as version number. Then I could run that with every ticket.",
    "created_at": "2018-08-25T12:15:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380949",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:45" align="right">comment:45</div>

For the record, the release script generates a new confball for every beta/rc release but not for every merged ticket. Doing it for every ticket has issues with size (every confball is 100k on the mirrors) and, more importantly, would make it more difficult for me to unmerge tickets because the version would always conflict.

An automatted solution would at the very least need to detect when a new confball is needed. E.g. extend ./bootstrap to have a maybe-save option that only saves a new confball if there was a relevant change over the current confball. And use non-consecutive version numbers. Perhaps just use a hash of the content (excluding file timestamps) as version number. Then I could run that with every ticket.



---

archive/issue_comments_380950.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@embray](#comment:41):\n> I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do\n\n...and Sage also does this.\n\nHowever, the buildbots don't build from a release, they build from the git repo. So this is purely a buildbot workflow issue, not a Sage release issue.",
    "created_at": "2018-08-25T14:02:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380950",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@embray](#comment:41):
> I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do

...and Sage also does this.

However, the buildbots don't build from a release, they build from the git repo. So this is purely a buildbot workflow issue, not a Sage release issue.



---

archive/issue_comments_380951.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nWhat I (more precisely, my scripts) did when I was release manager: create a fake source release every time you want to test Sage on the buildbot and then build from that fake source release on the buildbots instead of from git.",
    "created_at": "2018-08-25T14:09:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380951",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:47" align="right">comment:47</div>

What I (more precisely, my scripts) did when I was release manager: create a fake source release every time you want to test Sage on the buildbot and then build from that fake source release on the buildbots instead of from git.



---

archive/issue_comments_380952.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nI definitely want to leverage git on the buildbots though. Things are much easier to debug if you can easily switch between versions. E.g. if I find a problem that specific to a buildbot I can just log in and compare with the last known-good version, back out tickets, etc.",
    "created_at": "2018-08-25T14:32:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380952",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:48" align="right">comment:48</div>

I definitely want to leverage git on the buildbots though. Things are much easier to debug if you can easily switch between versions. E.g. if I find a problem that specific to a buildbot I can just log in and compare with the last known-good version, back out tickets, etc.



---

archive/issue_comments_380953.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@jdemeyer](#comment:46):\n> Replying to [@embray](#comment:41):\n> > I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do\n\n> \n> ...and Sage also does this.\n> \n> However, the buildbots don't build from a release, they build from the git repo. So this is purely a buildbot workflow issue, not a Sage release issue.\n\nI still don't understand.  The top-level Makefile ensures that `configure` is up-to-date by running `./bootstrap`.\n\nWhy is there even a buildbot that tries to build without autoconf?  If the configure tarball is updated when there is a release anyways, what use is this, especially if it produces false negatives?",
    "created_at": "2018-08-28T12:45:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380953",
    "user": "https://github.com/embray"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@jdemeyer](#comment:46):
> Replying to [@embray](#comment:41):
> > I think the `configure` script should just be built automatically every time a release is made and included in the source tarball like most projects do

> 
> ...and Sage also does this.
> 
> However, the buildbots don't build from a release, they build from the git repo. So this is purely a buildbot workflow issue, not a Sage release issue.

I still don't understand.  The top-level Makefile ensures that `configure` is up-to-date by running `./bootstrap`.

Why is there even a buildbot that tries to build without autoconf?  If the configure tarball is updated when there is a release anyways, what use is this, especially if it produces false negatives?



---

archive/issue_events_347507.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-28T12:46:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347507"
}
```



---

archive/issue_events_347508.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-28T12:46:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347508"
}
```



---

archive/issue_comments_380954.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nThis really ought to be resolved sensibly.  You want me to create a configure tarball and upload it, which I'm happy to do.  But there are going to be more of them, and likely with conflicting versions, etc--all the problems you described.  This shouldn't be needed to get a ticket merged.",
    "created_at": "2018-08-28T12:47:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380954",
    "user": "https://github.com/embray"
}
```

<div id="comment:51" align="right">comment:51</div>

This really ought to be resolved sensibly.  You want me to create a configure tarball and upload it, which I'm happy to do.  But there are going to be more of them, and likely with conflicting versions, etc--all the problems you described.  This shouldn't be needed to get a ticket merged.



---

archive/issue_comments_380955.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nReplying to [@embray](#comment:49):\n> Why is there even a buildbot that tries to build without autoconf?\n\nThis is a good idea actually. It ensures that Sage can be built on systems without autotools. Otherwise, you might mistakenly add a dependency on autotools and you would only notice that once somebody tries to build Sage on a system without autotools.",
    "created_at": "2018-08-28T12:49:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380955",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:52" align="right">comment:52</div>

Replying to [@embray](#comment:49):
> Why is there even a buildbot that tries to build without autoconf?

This is a good idea actually. It ensures that Sage can be built on systems without autotools. Otherwise, you might mistakenly add a dependency on autotools and you would only notice that once somebody tries to build Sage on a system without autotools.



---

archive/issue_comments_380956.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nOkay, I still think it's a bit strange not to just require that as a build dependency but let's say there's a valid reason for that:  Such a buildbot should be ignored then for tickets like this one that by requirement need autoconf to make any sense to build.",
    "created_at": "2018-08-28T13:08:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380956",
    "user": "https://github.com/embray"
}
```

<div id="comment:53" align="right">comment:53</div>

Okay, I still think it's a bit strange not to just require that as a build dependency but let's say there's a valid reason for that:  Such a buildbot should be ignored then for tickets like this one that by requirement need autoconf to make any sense to build.



---

archive/issue_comments_380957.json:
```json
{
    "body": "<div id=\"comment:54\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92fb34a66068bd4f1651412102c372e8c883754c\"><code>92fb34a</code></a></td><td><code>new configure tarball I guess</code></td></tr></table>\n",
    "created_at": "2018-08-28T13:11:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380957",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:54"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92fb34a66068bd4f1651412102c372e8c883754c"><code>92fb34a</code></a></td><td><code>new configure tarball I guess</code></td></tr></table>




---

archive/issue_comments_380958.json:
```json
{
    "body": "Changed commit from **[`68990b9`](https://github.com/sagemath/sagetrac-mirror/commit/68990b96af2268ab2c9015741868a840bd69dd47)** to **[`92fb34a`](https://github.com/sagemath/sagetrac-mirror/commit/92fb34a66068bd4f1651412102c372e8c883754c)**",
    "created_at": "2018-08-28T13:11:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380958",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`68990b9`](https://github.com/sagemath/sagetrac-mirror/commit/68990b96af2268ab2c9015741868a840bd69dd47)** to **[`92fb34a`](https://github.com/sagemath/sagetrac-mirror/commit/92fb34a66068bd4f1651412102c372e8c883754c)**



---

archive/issue_comments_380959.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@embray](#comment:53):\n> Such a buildbot should be ignored then for tickets like this one\n\nThe buildbot doesn't test *tickets*, it tests *releases* (before they are releases).",
    "created_at": "2018-08-28T13:12:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380959",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@embray](#comment:53):
> Such a buildbot should be ignored then for tickets like this one

The buildbot doesn't test *tickets*, it tests *releases* (before they are releases).



---

archive/issue_comments_380960.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nAttachment: **[configure-273.tar.gz](https://github.com/sagemath/sage/files/ticket25011/configure-273.tar.gz)**\n\nYes, I understand that.  And *releases* should just include the built `configure` script in the first place IMO.",
    "created_at": "2018-08-28T13:16:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380960",
    "user": "https://github.com/embray"
}
```

<div id="comment:56" align="right">comment:56</div>

Attachment: **[configure-273.tar.gz](https://github.com/sagemath/sage/files/ticket25011/configure-273.tar.gz)**

Yes, I understand that.  And *releases* should just include the built `configure` script in the first place IMO.



---

archive/issue_comments_380961.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nI mean, it's not testing releases if it's building from the git repo.",
    "created_at": "2018-08-28T13:16:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380961",
    "user": "https://github.com/embray"
}
```

<div id="comment:57" align="right">comment:57</div>

I mean, it's not testing releases if it's building from the git repo.



---

archive/issue_events_347509.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-28T13:16:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347509"
}
```



---

archive/issue_events_347510.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-08-28T13:16:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347510"
}
```



---

archive/issue_comments_380962.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nI'll just keep doing this.  I don't mind doing it and resolving the conflicts that inevitably emerge.  I just wish someone had said it was necessary in the first place.  I explicitly recall being told at one point that it wasn't.",
    "created_at": "2018-08-28T13:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380962",
    "user": "https://github.com/embray"
}
```

<div id="comment:59" align="right">comment:59</div>

I'll just keep doing this.  I don't mind doing it and resolving the conflicts that inevitably emerge.  I just wish someone had said it was necessary in the first place.  I explicitly recall being told at one point that it wasn't.



---

archive/issue_comments_380963.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n #24907 added some code to `configure.ac` that may remove files from `$SAGE_LOCAL` when running `./configure`.  This is at best a bit sketchy.  Instead it should modify something in the Makefile--e.g. enable some rule to clean up GCC.  I haven't fully considered the details yet.  Ideally a fix to this would also not conflict too much with #24919.\n+\n+Configure tarball: https://github.com/sagemath/sage/files/ticket25011/configure-273.tar.gz\n``````\n",
    "created_at": "2018-08-28T13:17:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380963",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
 #24907 added some code to `configure.ac` that may remove files from `$SAGE_LOCAL` when running `./configure`.  This is at best a bit sketchy.  Instead it should modify something in the Makefile--e.g. enable some rule to clean up GCC.  I haven't fully considered the details yet.  Ideally a fix to this would also not conflict too much with #24919.
+
+Configure tarball: https://github.com/sagemath/sage/files/ticket25011/configure-273.tar.gz
``````




---

archive/issue_comments_380964.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nReplying to [@vbraun](#comment:48):\n> I definitely want to leverage git on the buildbots though. Things are much easier to debug if you can easily switch between versions. E.g. if I find a problem that specific to a buildbot I can just log in and compare with the last known-good version, back out tickets, etc. \n\nUse git--make a release from git--build from the release.  Otherwise you're not actually testing releasing or building from a *release*.",
    "created_at": "2018-08-28T13:19:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380964",
    "user": "https://github.com/embray"
}
```

<div id="comment:61" align="right">comment:61</div>

Replying to [@vbraun](#comment:48):
> I definitely want to leverage git on the buildbots though. Things are much easier to debug if you can easily switch between versions. E.g. if I find a problem that specific to a buildbot I can just log in and compare with the last known-good version, back out tickets, etc. 

Use git--make a release from git--build from the release.  Otherwise you're not actually testing releasing or building from a *release*.



---

archive/issue_events_347511.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-29T22:37:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347511"
}
```



---

archive/issue_events_347512.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-29T22:37:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347512"
}
```



---

archive/issue_comments_380965.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nmerge conflict",
    "created_at": "2018-08-29T22:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380965",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:62" align="right">comment:62</div>

merge conflict



---

archive/issue_comments_380966.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nSpecifically with `build/pkgs/configure/checksums.ini` what a surprise.  Does this mean I need to rebuild the configure tarball too?",
    "created_at": "2018-09-03T10:04:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380966",
    "user": "https://github.com/embray"
}
```

<div id="comment:63" align="right">comment:63</div>

Specifically with `build/pkgs/configure/checksums.ini` what a surprise.  Does this mean I need to rebuild the configure tarball too?



---

archive/issue_comments_380967.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nIt's really frustrating to do by the way, because apparently my \"config.guess\" is too old, but when I download a recent one from upstream and place it in `config/` it just gets deleted again when I run `./bootstrap`.  So I have to manually edit `./bootstrap` to not do that in order to build the tarball.  Can't the release manager just do that?",
    "created_at": "2018-09-03T10:05:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380967",
    "user": "https://github.com/embray"
}
```

<div id="comment:64" align="right">comment:64</div>

It's really frustrating to do by the way, because apparently my "config.guess" is too old, but when I download a recent one from upstream and place it in `config/` it just gets deleted again when I run `./bootstrap`.  So I have to manually edit `./bootstrap` to not do that in order to build the tarball.  Can't the release manager just do that?



---

archive/issue_comments_380968.json:
```json
{
    "body": "Changed commit from **[`92fb34a`](https://github.com/sagemath/sagetrac-mirror/commit/92fb34a66068bd4f1651412102c372e8c883754c)** to **[`dc56a6c`](https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530)**",
    "created_at": "2018-09-03T10:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380968",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`92fb34a`](https://github.com/sagemath/sagetrac-mirror/commit/92fb34a66068bd4f1651412102c372e8c883754c)** to **[`dc56a6c`](https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530)**



---

archive/issue_comments_380969.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e28d39d13b42bbcd1f93a49b144a9e422a25ef0\"><code>4e28d39</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/458399b4850cf64b308eacafc4c00f1daba6f764\"><code>458399b</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/183f937f95c5eb8f1301e24cd63d9fe5ed80ba03\"><code>183f937</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b32c73ab6b1bfe0f0db955b4d9fa4a743860fff3\"><code>b32c73a</code></a></td><td><code>fix a typo with wildcards and add some gcc-* executables to be removed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eb96c972d2178bf49bcbe6c10c088c45bd093180\"><code>eb96c97</code></a></td><td><code>rather than try to make _clean-broken-gcc explicitly a prerequisite of spkg targets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530\"><code>dc56a6c</code></a></td><td><code>new configure tarball I guess</code></td></tr></table>\n",
    "created_at": "2018-09-03T10:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380969",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e28d39d13b42bbcd1f93a49b144a9e422a25ef0"><code>4e28d39</code></a></td><td><code>Reduce some unnecessary text duplication in the Makefile.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/458399b4850cf64b308eacafc4c00f1daba6f764"><code>458399b</code></a></td><td><code>Clean up a broken GCC in SAGE_LOCAL if it exists.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/183f937f95c5eb8f1301e24cd63d9fe5ed80ba03"><code>183f937</code></a></td><td><code>Ensure that the gcc SPKG always checks for and cleans up a broken gcc if it exists</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b32c73ab6b1bfe0f0db955b4d9fa4a743860fff3"><code>b32c73a</code></a></td><td><code>fix a typo with wildcards and add some gcc-* executables to be removed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eb96c972d2178bf49bcbe6c10c088c45bd093180"><code>eb96c97</code></a></td><td><code>rather than try to make _clean-broken-gcc explicitly a prerequisite of spkg targets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530"><code>dc56a6c</code></a></td><td><code>new configure tarball I guess</code></td></tr></table>




---

archive/issue_comments_380970.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nAttachment: **[configure-280.tar.gz](https://github.com/sagemath/sage/files/ticket25011/configure-280.tar.gz)**\n\nAdded a new one.  I think it's actually identical to the previous one, for some reason, despite the merge conflict.  But it has to have a new version number.",
    "created_at": "2018-09-03T10:14:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380970",
    "user": "https://github.com/embray"
}
```

<div id="comment:66" align="right">comment:66</div>

Attachment: **[configure-280.tar.gz](https://github.com/sagemath/sage/files/ticket25011/configure-280.tar.gz)**

Added a new one.  I think it's actually identical to the previous one, for some reason, despite the merge conflict.  But it has to have a new version number.



---

archive/issue_comments_380971.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n #24907 added some code to `configure.ac` that may remove files from `$SAGE_LOCAL` when running `./configure`.  This is at best a bit sketchy.  Instead it should modify something in the Makefile--e.g. enable some rule to clean up GCC.  I haven't fully considered the details yet.  Ideally a fix to this would also not conflict too much with #24919.\n \n-Configure tarball: https://github.com/sagemath/sage/files/ticket25011/configure-273.tar.gz\n+Configure tarball: https://github.com/sagemath/sage/files/ticket25011/configure-280.tar.gz\n``````\n",
    "created_at": "2018-09-03T10:14:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380971",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 #24907 added some code to `configure.ac` that may remove files from `$SAGE_LOCAL` when running `./configure`.  This is at best a bit sketchy.  Instead it should modify something in the Makefile--e.g. enable some rule to clean up GCC.  I haven't fully considered the details yet.  Ideally a fix to this would also not conflict too much with #24919.
 
-Configure tarball: https://github.com/sagemath/sage/files/ticket25011/configure-273.tar.gz
+Configure tarball: https://github.com/sagemath/sage/files/ticket25011/configure-280.tar.gz
``````




---

archive/issue_events_347513.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-03T10:14:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347513"
}
```



---

archive/issue_events_347514.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-03T10:14:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347514"
}
```



---

archive/issue_events_347515.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-05T16:43:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347515"
}
```



---

archive/issue_events_347516.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "3bc87a57d7d263e8d782fc28f0807e881ca117fb",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-09-05T16:43:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25011#event-347516"
}
```



---

archive/issue_comments_380972.json:
```json
{
    "body": "Changed branch from **[u/embray/build/ticket-25011](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-25011)** to **[`dc56a6c`](https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530)**",
    "created_at": "2018-09-05T16:43:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380972",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/build/ticket-25011](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/ticket-25011)** to **[`dc56a6c`](https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530)**



---

archive/issue_comments_380973.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nThanks! On to the next one...",
    "created_at": "2018-09-06T09:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380973",
    "user": "https://github.com/embray"
}
```

<div id="comment:68" align="right">comment:68</div>

Thanks! On to the next one...



---

archive/issue_comments_380974.json:
```json
{
    "body": "Changed commit from **[`dc56a6c`](https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530)** to none",
    "created_at": "2018-09-06T09:33:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25011#issuecomment-380974",
    "user": "https://github.com/embray"
}
```

Changed commit from **[`dc56a6c`](https://github.com/sagemath/sagetrac-mirror/commit/dc56a6cb78c99ce633118748a4aeeab13e445530)** to none
