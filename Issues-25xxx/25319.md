# Issue 25319: gcc, curl, git tarballs not included by sage --sdist

archive/issues_025082.json:
```json
{
    "body": "It seems that packages that are not built on a system because of a configure check are not included in the upstream directory when running `sage --sdist`. This will often include `gcc`, `curl`, `git`, `gfortran` (which is the same tarball as `gcc`).\n\nCC:  @vbraun @embray\n\nReviewer: John Palmieri\n\nAuthor: Jeroen Demeyer\n\nBranch: a6add271efcba7a31de354ce50632c2bb265aa59\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25319\n\n",
    "closed_at": "2018-06-14T07:41:19Z",
    "created_at": "2018-05-09T20:27:18Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "gcc, curl, git tarballs not included by sage --sdist",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25319",
    "user": "https://github.com/jhpalmieri"
}
```
It seems that packages that are not built on a system because of a configure check are not included in the upstream directory when running `sage --sdist`. This will often include `gcc`, `curl`, `git`, `gfortran` (which is the same tarball as `gcc`).

CC:  @vbraun @embray

Reviewer: John Palmieri

Author: Jeroen Demeyer

Branch: a6add271efcba7a31de354ce50632c2bb265aa59

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25319





---

archive/issue_comments_485592.json:
```json
{
    "body": "<a id='comment:1'></a>\nRelated, it would be nice if `sage -sdist` wouldn't rely on configure at all. Right now, sdist basically requires you to configure / build Sage before making a tarball which is an annoyance for release management. As we see on this ticket, it is also error prone.",
    "created_at": "2018-05-10T07:24:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485592",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:1'></a>
Related, it would be nice if `sage -sdist` wouldn't rely on configure at all. Right now, sdist basically requires you to configure / build Sage before making a tarball which is an annoyance for release management. As we see on this ticket, it is also error prone.



---

archive/issue_comments_485593.json:
```json
{
    "body": "Changing author from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2018-06-07T12:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485593",
    "user": "https://github.com/jdemeyer"
}
```

Changing author from "" to "Jeroen Demeyer"



---

archive/issue_comments_485594.json:
```json
{
    "body": "<a id='comment:2'></a>\nIt's this change from #21524:\n\n```diff\n@@ -58,11 +58,11 @@ all-sage: \\\n # option to make forces all targets to be built unconditionally)\n download-for-sdist: base\n        env SAGE_INSTALL_FETCH_ONLY=yes $(MAKE) -B SAGERUNTIME= \\\n-               $(SDIST_PACKAGES)\n+               $(SDIST_PACKAGE_INSTS)\n \n```\n\nJust reverting that should fix the problem.",
    "created_at": "2018-06-07T12:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485594",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>
It's this change from #21524:

```diff
@@ -58,11 +58,11 @@ all-sage: \
 # option to make forces all targets to be built unconditionally)
 download-for-sdist: base
        env SAGE_INSTALL_FETCH_ONLY=yes $(MAKE) -B SAGERUNTIME= \
-               $(SDIST_PACKAGES)
+               $(SDIST_PACKAGE_INSTS)
 
```

Just reverting that should fix the problem.



---

archive/issue_comments_485595.json:
```json
{
    "body": "Changing branch from \"\" to \"u/jdemeyer/gcc__curl__git_tarballs_not_included_by_sage___sdist\"",
    "created_at": "2018-06-07T13:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485595",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "" to "u/jdemeyer/gcc__curl__git_tarballs_not_included_by_sage___sdist"



---

archive/issue_comments_485596.json:
```json
{
    "body": "Changing commit from \"\" to \"a6add271efcba7a31de354ce50632c2bb265aa59\"",
    "created_at": "2018-06-07T13:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "" to "a6add271efcba7a31de354ce50632c2bb265aa59"



---

archive/issue_comments_485597.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                              |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|\n|[a6add27](https://github.com/sagemath/sagetrac-mirror/commit/a6add271efcba7a31de354ce50632c2bb265aa59)|`Drop \"base\" dependency of download-for-sdist`|",
    "created_at": "2018-06-07T13:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                              |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------|
|[a6add27](https://github.com/sagemath/sagetrac-mirror/commit/a6add271efcba7a31de354ce50632c2bb265aa59)|`Drop "base" dependency of download-for-sdist`|



---

archive/issue_comments_485598.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-07T13:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485598",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_485599.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [vbraun](#comment%3A1):\n> Related, it would be nice if `sage -sdist` wouldn't rely on configure at all.\n\n\nSeriously, what is wrong with requiring `./configure`? Every autotools package depends on `./configure` before you can do anything. It only takes a few seconds...\n\n> Right now, sdist basically requires you to configure / build Sage before making a tarball\n\n\nconfiguring yes, but not building!\n\nI just did\n\n```\nmake distclean && ./configure && ./sage --sdist\n```\nand it worked.",
    "created_at": "2018-06-07T13:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485599",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>
Replying to [vbraun](#comment%3A1):
> Related, it would be nice if `sage -sdist` wouldn't rely on configure at all.


Seriously, what is wrong with requiring `./configure`? Every autotools package depends on `./configure` before you can do anything. It only takes a few seconds...

> Right now, sdist basically requires you to configure / build Sage before making a tarball


configuring yes, but not building!

I just did

```
make distclean && ./configure && ./sage --sdist
```
and it worked.



---

archive/issue_comments_485600.json:
```json
{
    "body": "<a id='comment:7'></a>\nI am happy to give this a positive review, but maybe first someone (embray?) should explain the purpose of the change from #21524 that we are reverting.",
    "created_at": "2018-06-07T16:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485600",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>
I am happy to give this a positive review, but maybe first someone (embray?) should explain the purpose of the change from #21524 that we are reverting.



---

archive/issue_comments_485601.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-06-12T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485601",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_485602.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2018-06-12T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485602",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_485603.json:
```json
{
    "body": "<a id='comment:8'></a>\nOkay, let's move on.",
    "created_at": "2018-06-12T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485603",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
Okay, let's move on.



---

archive/issue_comments_485604.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-14T07:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485604",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_485605.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/gcc__curl__git_tarballs_not_included_by_sage___sdist\" to \"a6add271efcba7a31de354ce50632c2bb265aa59\"",
    "created_at": "2018-06-14T07:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485605",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/gcc__curl__git_tarballs_not_included_by_sage___sdist" to "a6add271efcba7a31de354ce50632c2bb265aa59"



---

archive/issue_events_072177.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-14T07:41:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25319#event-72177"
}
```



---

archive/issue_comments_485606.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jdemeyer](#comment%3A6):\n> Replying to [vbraun](#comment%3A1):\n> > Related, it would be nice if `sage -sdist` wouldn't rely on configure at all.\n\n> \n> Seriously, what is wrong with requiring `./configure`? Every autotools package depends on `./configure` before you can do anything. It only takes a few seconds...\n\n\nI agree with Jeroen :)\n\n> > Right now, sdist basically requires you to configure / build Sage before making a tarball\n\n> \n> configuring yes, but not building!\n> \n> I just did\n> \n> ```\n> make distclean && ./configure && ./sage --sdist\n> ```\n> and it worked.\n\n\n+1\n\nI didn't even know what `sage --sdist` is supposed to do though.  Is that documented somewhere?",
    "created_at": "2018-06-14T15:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485606",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
Replying to [jdemeyer](#comment%3A6):
> Replying to [vbraun](#comment%3A1):
> > Related, it would be nice if `sage -sdist` wouldn't rely on configure at all.

> 
> Seriously, what is wrong with requiring `./configure`? Every autotools package depends on `./configure` before you can do anything. It only takes a few seconds...


I agree with Jeroen :)

> > Right now, sdist basically requires you to configure / build Sage before making a tarball

> 
> configuring yes, but not building!
> 
> I just did
> 
> ```
> make distclean && ./configure && ./sage --sdist
> ```
> and it worked.


+1

I didn't even know what `sage --sdist` is supposed to do though.  Is that documented somewhere?



---

archive/issue_comments_485607.json:
```json
{
    "body": "Changing commit from \"a6add271efcba7a31de354ce50632c2bb265aa59\" to \"\"",
    "created_at": "2018-06-14T15:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485607",
    "user": "https://github.com/embray"
}
```

Changing commit from "a6add271efcba7a31de354ce50632c2bb265aa59" to ""



---

archive/issue_comments_485608.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [embray](#comment%3A10):\n> I didn't even know what `sage --sdist` is supposed to do though.  Is that documented somewhere?\n\n\nThe description of command-line options available from `sage --advanced` (and also in the [reference manual](http://doc.sagemath.org/html/en/reference/repl/options.html#command-line-options-for-sage)) says\n\n```\n  -sdist              -- build a source distribution of Sage\n```\nThat's the extent of the documentation, I think.",
    "created_at": "2018-06-14T15:20:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485608",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
Replying to [embray](#comment%3A10):
> I didn't even know what `sage --sdist` is supposed to do though.  Is that documented somewhere?


The description of command-line options available from `sage --advanced` (and also in the [reference manual](http://doc.sagemath.org/html/en/reference/repl/options.html#command-line-options-for-sage)) says

```
  -sdist              -- build a source distribution of Sage
```
That's the extent of the documentation, I think.



---

archive/issue_comments_485609.json:
```json
{
    "body": "<a id='comment:12'></a>\nIt's not really clear what's meant by that.",
    "created_at": "2018-06-20T13:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25319",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25319#issuecomment-485609",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
It's not really clear what's meant by that.
