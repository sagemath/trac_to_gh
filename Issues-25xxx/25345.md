# Issue 25345: Make it possible to test sage without htmldoc

archive/issues_025108.json:
```json
{
    "body": "Because the html docs are non-essential and take up a lot of space, distributions usually make them an optional dependency of sage.\n\nI am doing the same for nix and I would like to be able to test sage and the docs independent from each other.\n\nThis patch makes the doctests that depend on the htmldocs optional, but enables those doctests by default. So to exclude them, one has to explicitly specify `--optional=sage`.\n\nFor that to work I also make sure that the optional `py2` tag is only added if `sage` is in the optionals list. I don't know if it was intended that way, but it was definitely surprising to me that all tests marked as `py2` were *always* run, even with `--optional=asdf-does-not-exists`.\n\n(The same goes for `--long`: I expected it to act as an `AND` as in \"in optionals list AND long\", but instead it just includes all tests marked as long. I left that unchanged.)\n\nReviewer: Erik Bray\n\nAuthor: Timo Kaufmann\n\nBranch: db7bf45015e736ca2383597a2c63e4fae97c9485\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25345\n\n",
    "closed_at": "2018-08-07T20:40:41Z",
    "created_at": "2018-05-11T15:41:50Z",
    "labels": [
        "component: distribution"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Make it possible to test sage without htmldoc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25345",
    "user": "https://github.com/timokau"
}
```
Because the html docs are non-essential and take up a lot of space, distributions usually make them an optional dependency of sage.

I am doing the same for nix and I would like to be able to test sage and the docs independent from each other.

This patch makes the doctests that depend on the htmldocs optional, but enables those doctests by default. So to exclude them, one has to explicitly specify `--optional=sage`.

For that to work I also make sure that the optional `py2` tag is only added if `sage` is in the optionals list. I don't know if it was intended that way, but it was definitely surprising to me that all tests marked as `py2` were *always* run, even with `--optional=asdf-does-not-exists`.

(The same goes for `--long`: I expected it to act as an `AND` as in "in optionals list AND long", but instead it just includes all tests marked as long. I left that unchanged.)

Reviewer: Erik Bray

Author: Timo Kaufmann

Branch: db7bf45015e736ca2383597a2c63e4fae97c9485

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25345





---

archive/issue_comments_376033.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-11T15:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376033",
    "user": "https://github.com/timokau"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_376034.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-11T15:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376035.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2018-05-11T15:44:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376035",
    "user": "https://github.com/timokau"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_376036.json:
```json
{
    "body": "<a id='comment:6'></a>Somehow trac has problems with my branch, I can't figure out why.",
    "created_at": "2018-05-11T15:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376036",
    "user": "https://github.com/timokau"
}
```

<a id='comment:6'></a>Somehow trac has problems with my branch, I can't figure out why.



---

archive/issue_comments_376037.json:
```json
{
    "body": "<a id='comment:7'></a>Also looking back at the tests, it tells me `Using --optional=gfortran,mpir,python2,sage`, so apparently adding `htmldoc` didn't work. Does anybody know why?",
    "created_at": "2018-05-11T15:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376037",
    "user": "https://github.com/timokau"
}
```

<a id='comment:7'></a>Also looking back at the tests, it tells me `Using --optional=gfortran,mpir,python2,sage`, so apparently adding `htmldoc` didn't work. Does anybody know why?



---

archive/issue_comments_376038.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-11T16:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376039.json:
```json
{
    "body": "<a id='comment:9'></a>We just pushed an update to Trac--there might still be some bugs after all.  Probably not your branch's fault.",
    "created_at": "2018-05-11T16:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376039",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>We just pushed an update to Trac--there might still be some bugs after all.  Probably not your branch's fault.



---

archive/issue_comments_376040.json:
```json
{
    "body": "<a id='comment:10'></a>Ah, apparently it works now.",
    "created_at": "2018-05-11T16:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376040",
    "user": "https://github.com/timokau"
}
```

<a id='comment:10'></a>Ah, apparently it works now.



---

archive/issue_comments_376041.json:
```json
{
    "body": "<a id='comment:11'></a>1. You're adding bogus files like `octave-workspace`.\n\n2. I'm not too happy with the name `htmldoc`. It doesn't correspond to anything.\n\n3. As I mentioned on some other ticket, the `# optional` should only be on the first line of a test example.",
    "created_at": "2018-05-11T21:08:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376041",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>1. You're adding bogus files like `octave-workspace`.

2. I'm not too happy with the name `htmldoc`. It doesn't correspond to anything.

3. As I mentioned on some other ticket, the `# optional` should only be on the first line of a test example.



---

archive/issue_comments_376042.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-11T21:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376042",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_376043.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-12T14:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376043",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376044.json:
```json
{
    "body": "<a id='comment:14'></a>1. Sorry, I thought I double checked this time. Don't know how I missed this. By the way, should `octave-workspace` be in `.gitignore`? Somehow that always gets generated when I run the tests.\n\n2. I thought the makefile calls it `htmldoc`, but apparently its `dochtml`. Would that be better?\n\n3. I thought that was only because it was an `if` or something. I didn't know a single `#optional` will skip the whole test.\n\nWhile changing (2) I noticed that there are some tests that are marked as `long` and `dochtml`. That means that its impossible to run them without running *all* other `long` tests too. Is that behaviour of `long` on purpose?\n\n---\nNew commits:",
    "created_at": "2018-05-12T14:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376044",
    "user": "https://github.com/timokau"
}
```

<a id='comment:14'></a>1. Sorry, I thought I double checked this time. Don't know how I missed this. By the way, should `octave-workspace` be in `.gitignore`? Somehow that always gets generated when I run the tests.

2. I thought the makefile calls it `htmldoc`, but apparently its `dochtml`. Would that be better?

3. I thought that was only because it was an `if` or something. I didn't know a single `#optional` will skip the whole test.

While changing (2) I noticed that there are some tests that are marked as `long` and `dochtml`. That means that its impossible to run them without running *all* other `long` tests too. Is that behaviour of `long` on purpose?

---
New commits:



---

archive/issue_comments_376045.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-05-12T14:11:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376045",
    "user": "https://github.com/timokau"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_376046.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-13T14:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376046",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376047.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-13T16:11:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376047",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376048.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-13T23:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376048",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376049.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-14T09:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376049",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376050.json:
```json
{
    "body": "<a id='comment:19'></a>I'm not going to dwell on this, and if others think this is worth doing, I'm not going to argue about it, but I disagree with the premises of this ticket:\n\n> Because the html docs are non-essential\n\n\nDocumentation is an essential part of any software, so we should encourage everyone to build it or distribute it. Sage's philosophy has always been that documentation is a key part of the package, and an installation without it is incomplete. I think if someone chooses to not build the docs, then they should have the natural consequence of having some doctests fail.\n\n> and take up a lot of space, distributions usually make them an optional dependency of sage. \n\n\n650MB is not that much space these days, is it?",
    "created_at": "2018-05-14T14:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376050",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>I'm not going to dwell on this, and if others think this is worth doing, I'm not going to argue about it, but I disagree with the premises of this ticket:

> Because the html docs are non-essential


Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it. Sage's philosophy has always been that documentation is a key part of the package, and an installation without it is incomplete. I think if someone chooses to not build the docs, then they should have the natural consequence of having some doctests fail.

> and take up a lot of space, distributions usually make them an optional dependency of sage. 


650MB is not that much space these days, is it?



---

archive/issue_comments_376051.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 jhpalmieri]:\n> Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it. Sage's philosophy has always been that documentation is a key part of the package, and an installation without it is incomplete. I think if someone chooses to not build the docs, then they should have the natural consequence of having some doctests fail.\n\n\nWithout html documentation sage still offers the `?` function (as in `abs?`) that should suffice for a lot of use cases.\n\n> 650MB is not that much space these days, is it?\n\n\nMaybe not for you, but for somebody with a slow internet connection that wants to \"quickly check out this software\" its a lot of space/time.",
    "created_at": "2018-05-14T15:36:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376051",
    "user": "https://github.com/timokau"
}
```

<a id='comment:20'></a>Replying to [comment:19 jhpalmieri]:
> Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it. Sage's philosophy has always been that documentation is a key part of the package, and an installation without it is incomplete. I think if someone chooses to not build the docs, then they should have the natural consequence of having some doctests fail.


Without html documentation sage still offers the `?` function (as in `abs?`) that should suffice for a lot of use cases.

> 650MB is not that much space these days, is it?


Maybe not for you, but for somebody with a slow internet connection that wants to "quickly check out this software" its a lot of space/time.



---

archive/issue_comments_376052.json:
```json
{
    "body": "<a id='comment:21'></a>It would also be great if `?` could selectively pull docs from the internet whenever possible.",
    "created_at": "2018-05-14T16:17:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376052",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>It would also be great if `?` could selectively pull docs from the internet whenever possible.



---

archive/issue_comments_376053.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:20 gh-timokau]:\n> Replying to [comment:19 jhpalmieri]:\n> > Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it. Sage's philosophy has always been that documentation is a key part of the package, and an installation without it is incomplete. I think if someone chooses to not build the docs, then they should have the natural consequence of having some doctests fail.\n\n> \n> Without html documentation sage still offers the `?` function (as in `abs?`) that should suffice for a lot of use cases.\n\n\nI think you should analyze this more carefully before making this change. \"Should suffice\": when will it or won't it? For \"a lot of use cases\": which ones won't it suffice for? Reading the tutorial is one which is especially relevant to beginners; are there others? When you first start Sage, it says to run `help()` for help, and if you run this, it advertises two command which won't work without the docs: `tutorial()` and `manual()`.\n\nDeciding not to include documentation is, in my experience, almost always a bad choice.\n\n> > 650MB is not that much space these days, is it?\n\n> \n> Maybe not for you, but for somebody with a slow internet connection that wants to \"quickly check out this software\" its a lot of space/time.\n\n\nIt's not about me, it's compared to the size of the rest of the Sage installation.",
    "created_at": "2018-05-14T16:26:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376053",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>Replying to [comment:20 gh-timokau]:
> Replying to [comment:19 jhpalmieri]:
> > Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it. Sage's philosophy has always been that documentation is a key part of the package, and an installation without it is incomplete. I think if someone chooses to not build the docs, then they should have the natural consequence of having some doctests fail.

> 
> Without html documentation sage still offers the `?` function (as in `abs?`) that should suffice for a lot of use cases.


I think you should analyze this more carefully before making this change. "Should suffice": when will it or won't it? For "a lot of use cases": which ones won't it suffice for? Reading the tutorial is one which is especially relevant to beginners; are there others? When you first start Sage, it says to run `help()` for help, and if you run this, it advertises two command which won't work without the docs: `tutorial()` and `manual()`.

Deciding not to include documentation is, in my experience, almost always a bad choice.

> > 650MB is not that much space these days, is it?

> 
> Maybe not for you, but for somebody with a slow internet connection that wants to "quickly check out this software" its a lot of space/time.


It's not about me, it's compared to the size of the rest of the Sage installation.



---

archive/issue_comments_376054.json:
```json
{
    "body": "<a id='comment:23'></a>> I think you should analyze this more carefully before making this change.\n\n\nThis change does not disable documentation in any way. It is still enabled by default and tested by default. It simply makes it *possible* to disable.\n\n> \"Should suffice\": when will it or won't it? For \"a lot of use cases\": which ones won't it suffice for? Reading the tutorial is one which is especially relevant to beginners; are there others? When you first start Sage, it says to run `help()` for help, and if you run this, it advertises two command which won't work without the docs: `tutorial()` and `manual()`.\n\n\nWithout any facts to back it up, I'd guess that most beginners start with the online documentation.\n\n> Deciding not to include documentation is, in my experience, almost always a bad choice.\n\n\nIts the users choice.\n\n> > > 650MB is not that much space these days, is it?\n\n> > \n> > Maybe not for you, but for somebody with a slow internet connection that wants to \"quickly check out this software\" its a lot of space/time.\n\n> \n> It's not about me, it's compared to the size of the rest of the Sage installation.\n\n\nWell `sagelib` (basically everything sage excluding dependencies and docs) only takes up 257M.\nOf course realistically sage as a lot of dependencies that a user will not have pre-installed, but the documentation basically triples the minimum the user has to download.",
    "created_at": "2018-05-14T16:32:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376054",
    "user": "https://github.com/timokau"
}
```

<a id='comment:23'></a>> I think you should analyze this more carefully before making this change.


This change does not disable documentation in any way. It is still enabled by default and tested by default. It simply makes it *possible* to disable.

> "Should suffice": when will it or won't it? For "a lot of use cases": which ones won't it suffice for? Reading the tutorial is one which is especially relevant to beginners; are there others? When you first start Sage, it says to run `help()` for help, and if you run this, it advertises two command which won't work without the docs: `tutorial()` and `manual()`.


Without any facts to back it up, I'd guess that most beginners start with the online documentation.

> Deciding not to include documentation is, in my experience, almost always a bad choice.


Its the users choice.

> > > 650MB is not that much space these days, is it?

> > 
> > Maybe not for you, but for somebody with a slow internet connection that wants to "quickly check out this software" its a lot of space/time.

> 
> It's not about me, it's compared to the size of the rest of the Sage installation.


Well `sagelib` (basically everything sage excluding dependencies and docs) only takes up 257M.
Of course realistically sage as a lot of dependencies that a user will not have pre-installed, but the documentation basically triples the minimum the user has to download.



---

archive/issue_comments_376055.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:19 jhpalmieri]:\n> Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it.\n\n\nI don't think that this ticket changes that.\n\nI see little harm in marking those tests `optional` provided that `make (p)test(long)` still test them by default.",
    "created_at": "2018-05-15T13:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376055",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Replying to [comment:19 jhpalmieri]:
> Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it.


I don't think that this ticket changes that.

I see little harm in marking those tests `optional` provided that `make (p)test(long)` still test them by default.



---

archive/issue_comments_376056.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 jdemeyer]:\n> Replying to [comment:19 jhpalmieri]:\n> > Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it.\n\n> \n> I don't think that this ticket changes that.\n\n\nThis ticket makes it easier for people to make bad choices. That's its whole point.",
    "created_at": "2018-05-15T14:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376056",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:25'></a>Replying to [comment:24 jdemeyer]:
> Replying to [comment:19 jhpalmieri]:
> > Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it.

> 
> I don't think that this ticket changes that.


This ticket makes it easier for people to make bad choices. That's its whole point.



---

archive/issue_comments_376057.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:25 jhpalmieri]:\n> Replying to [comment:24 jdemeyer]:\n> > Replying to [comment:19 jhpalmieri]:\n> > > Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it.\n\n> > \n> > I don't think that this ticket changes that.\n\n> \n> This ticket makes it easier for people to make bad choices. That's its whole point.\n\n\nI think users should be able to make that choice. And distros already do allow them make that choice. The only thing that patch does is allowing them to stay closer to vanilla sage doing that (and pass the tests).",
    "created_at": "2018-05-15T16:34:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376057",
    "user": "https://github.com/timokau"
}
```

<a id='comment:26'></a>Replying to [comment:25 jhpalmieri]:
> Replying to [comment:24 jdemeyer]:
> > Replying to [comment:19 jhpalmieri]:
> > > Documentation is an essential part of any software, so we should encourage everyone to build it or distribute it.

> > 
> > I don't think that this ticket changes that.

> 
> This ticket makes it easier for people to make bad choices. That's its whole point.


I think users should be able to make that choice. And distros already do allow them make that choice. The only thing that patch does is allowing them to stay closer to vanilla sage doing that (and pass the tests).



---

archive/issue_comments_376058.json:
```json
{
    "body": "<a id='comment:27'></a>Are there any remaining objections?",
    "created_at": "2018-06-30T16:42:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376058",
    "user": "https://github.com/timokau"
}
```

<a id='comment:27'></a>Are there any remaining objections?



---

archive/issue_comments_376059.json:
```json
{
    "body": "<a id='comment:28'></a>I agree--shipping Sage without the full documentation is perfectly reasonable in my cases.  We should just ensure that code which assumes that the documentation is installed has a reasonable fallback (e.g. `tutorial()` returns a reasonable error message).\n\nIt should also be perfectly possible to run the tests without the docs (especially since the only tests that fail without them are tests that test the docs, so if the docs are not built it would be reasonable to skip those tests).",
    "created_at": "2018-07-10T14:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376059",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>I agree--shipping Sage without the full documentation is perfectly reasonable in my cases.  We should just ensure that code which assumes that the documentation is installed has a reasonable fallback (e.g. `tutorial()` returns a reasonable error message).

It should also be perfectly possible to run the tests without the docs (especially since the only tests that fail without them are tests that test the docs, so if the docs are not built it would be reasonable to skip those tests).



---

archive/issue_comments_376060.json:
```json
{
    "body": "<a id='comment:29'></a>> It should also be perfectly possible to run the tests without the docs (especially since the only tests that fail without them are tests that test the docs, so if the docs are not built it would be reasonable to skip those tests).\n\n\nYes that is exactly what this ticket accomplishes :) In fact I already applied this patch on the nixpkgs package and all doctests pass without documentation. I then run `sage -t --optional=dochtml --all` after building the documentation. That also has the advantage of being able to test the base installation and build the documentation at the same time. That advantage is limited however, since in practice the doctests and the docbuild both use all the resources they can get anyways. It can be nice for a distributed build however.",
    "created_at": "2018-07-10T14:34:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376060",
    "user": "https://github.com/timokau"
}
```

<a id='comment:29'></a>> It should also be perfectly possible to run the tests without the docs (especially since the only tests that fail without them are tests that test the docs, so if the docs are not built it would be reasonable to skip those tests).


Yes that is exactly what this ticket accomplishes :) In fact I already applied this patch on the nixpkgs package and all doctests pass without documentation. I then run `sage -t --optional=dochtml --all` after building the documentation. That also has the advantage of being able to test the base installation and build the documentation at the same time. That advantage is limited however, since in practice the doctests and the docbuild both use all the resources they can get anyways. It can be nice for a distributed build however.



---

archive/issue_comments_376061.json:
```json
{
    "body": "<a id='comment:30'></a>update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376061",
    "user": "https://github.com/videlec"
}
```

<a id='comment:30'></a>update milestone 8.3 -> 8.4



---

archive/issue_events_063543.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25345#event-63543"
}
```



---

archive/issue_comments_376062.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-06T14:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376062",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_376063.json:
```json
{
    "body": "<a id='comment:32'></a>We should ensure that built-ins like `tutorial()` behave reasonably when the docs are not installed, but the fact remains that Sage is already shipped by default in many cases without the docs, so that's a separate issue.  In the meantime we should certainly allow the tests to pass without docs.\n\nI would kind of like it if `dochtml` were automatically disabled if the docs are not found, but that could also hide a legitimate problem.  So I'm not sure what to do there.",
    "created_at": "2018-08-06T14:32:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376063",
    "user": "https://github.com/embray"
}
```

<a id='comment:32'></a>We should ensure that built-ins like `tutorial()` behave reasonably when the docs are not installed, but the fact remains that Sage is already shipped by default in many cases without the docs, so that's a separate issue.  In the meantime we should certainly allow the tests to pass without docs.

I would kind of like it if `dochtml` were automatically disabled if the docs are not found, but that could also hide a legitimate problem.  So I'm not sure what to do there.



---

archive/issue_comments_376064.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-07T20:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376064",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063544.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-07T20:40:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25345#event-63544"
}
```



---

archive/issue_comments_376065.json:
```json
{
    "body": "<a id='comment:34'></a>This is broken: tests marked `optional - dochtml` are not run by default. See #26110.",
    "created_at": "2018-08-22T20:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376065",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>This is broken: tests marked `optional - dochtml` are not run by default. See #26110.



---

archive/issue_comments_376066.json:
```json
{
    "body": "Replying to [ticket:25345 gh-timokau]:\n> I also make sure that the optional `py2` tag is only added if `sage` is in the optionals list.\n\n\nThis change doesn't really make sense to me. I think it's a feature that `# py2` tests are always run on Python 2, regardless of the `--optional` option. So I'm reverting this part in #26110.",
    "created_at": "2018-08-23T09:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25345#issuecomment-376066",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:25345 gh-timokau]:
> I also make sure that the optional `py2` tag is only added if `sage` is in the optionals list.


This change doesn't really make sense to me. I think it's a feature that `# py2` tests are always run on Python 2, regardless of the `--optional` option. So I'm reverting this part in #26110.
