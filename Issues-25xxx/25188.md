# Issue 25188: Repeated configure run with gcc already installed treats gcc as not installed

archive/issues_024951.json:
```json
{
    "body": "If `./configure` detects an existing GCC installed in Sage (`SAGE_INSTALL_GCC=exists`) then it should keep gcc selected among the packages to be installed as part of the distribution.  Otherwise it basically deselects gcc which is the wrong thing to do (with any package).\n\nCC:  @embray\n\nBranch/Commit: 5d0a98124f3e2b6d32de6fc1ffffc6ea660ea2b4\n\nReviewer: Volker Braun, Julian R\u00fcth, Dima Pasechnik\n\nAuthor: Erik Bray\n\nDependencies: #25857\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25188\n\n",
    "closed_at": "2018-10-29T22:46:40Z",
    "created_at": "2018-04-17T09:51:33Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Repeated configure run with gcc already installed treats gcc as not installed",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25188",
    "user": "https://github.com/jdemeyer"
}
```
If `./configure` detects an existing GCC installed in Sage (`SAGE_INSTALL_GCC=exists`) then it should keep gcc selected among the packages to be installed as part of the distribution.  Otherwise it basically deselects gcc which is the wrong thing to do (with any package).

CC:  @embray

Branch/Commit: 5d0a98124f3e2b6d32de6fc1ffffc6ea660ea2b4

Reviewer: Volker Braun, Julian RÃ¼th, Dima Pasechnik

Author: Erik Bray

Dependencies: #25857

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25188





---

archive/issue_comments_373782.json:
```json
{
    "body": "Attachment [Makefile](tarball://root/attachments/some-uuid/ticket25188/Makefile) by @jdemeyer created at 2018-04-17 09:52:12\n\nAuto-generated build/make/Makefile",
    "created_at": "2018-04-17T09:52:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373782",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [Makefile](tarball://root/attachments/some-uuid/ticket25188/Makefile) by @jdemeyer created at 2018-04-17 09:52:12

Auto-generated build/make/Makefile



---

archive/issue_comments_373783.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n It seems that \\`DUMMY_PACKAGES\\` in \\`build/make/Makefile\\` no longer works correctly.\n \n-\\`build/make/Makefile\\` contains\n+On the patchbot system \"arando\" (i686 Linux), [attachment:Makefile build/make/Makefile] contains\n \n \\`\\`\\`\n DUMMY_PACKAGES = \\\n```\n",
    "created_at": "2018-04-17T09:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373783",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,6 @@
 It seems that \`DUMMY_PACKAGES\` in \`build/make/Makefile\` no longer works correctly.
 
-\`build/make/Makefile\` contains
+On the patchbot system "arando" (i686 Linux), [attachment:Makefile build/make/Makefile] contains
 
 \`\`\`
 DUMMY_PACKAGES = \
```




---

archive/issue_comments_373784.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,28 @@\n+It seems that \\`DUMMY_PACKAGES\\` in \\`build/make/Makefile\\` no longer works correctly.\n \n+On the patchbot system \"arando\" (i686 Linux), [attachment:Makefile build/make/Makefile] contains\n+\n+\\`\\`\\`\n+DUMMY_PACKAGES = \\\n+    gcc \\\n+    gfortran \\\n+    git \\\n+\\`\\`\\`\n+\n+Despite this, a normal build rule for \\`gfortran\\` is generated. Partial output of \\`make -f build/make/Makefile -n DEBUG_RULES=1\\`:\n+\n+\\`\\`\\`\n+$(INST)/gfortran-7.2.0:   /bin/gcc  |  $(inst_mpir)  $(inst_mpfr)  $(inst_mpc)  $(inst_zlib)  $(inst_xz)\n+        +sage-logger -p '$(SAGE_SPKG) gfortran-7.2.0' '$(SAGE_LOGS)/gfortran-7.2.0.log'\n+\n+gfortran: $(INST)/gfortran-7.2.0\n+\n+gfortran-clean:\n+        rm -rf $(INST)/gfortran-7.2.0\n+\\`\\`\\`\n+This is causing build failures because \\`gcc\\` is also installed.\n+\n+Perhaps the problem is that \\`gfortran\\` appears both in \\`DUMMY_PACKAGES\\` and \\`NORMAL_PACKAGES\\`?\n \n Summary: DUMMY_PACKAGES does not work\n \n```\n",
    "created_at": "2018-04-17T10:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373784",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,28 @@
+It seems that \`DUMMY_PACKAGES\` in \`build/make/Makefile\` no longer works correctly.
 
+On the patchbot system "arando" (i686 Linux), [attachment:Makefile build/make/Makefile] contains
+
+\`\`\`
+DUMMY_PACKAGES = \
+    gcc \
+    gfortran \
+    git \
+\`\`\`
+
+Despite this, a normal build rule for \`gfortran\` is generated. Partial output of \`make -f build/make/Makefile -n DEBUG_RULES=1\`:
+
+\`\`\`
+$(INST)/gfortran-7.2.0:   /bin/gcc  |  $(inst_mpir)  $(inst_mpfr)  $(inst_mpc)  $(inst_zlib)  $(inst_xz)
+        +sage-logger -p '$(SAGE_SPKG) gfortran-7.2.0' '$(SAGE_LOGS)/gfortran-7.2.0.log'
+
+gfortran: $(INST)/gfortran-7.2.0
+
+gfortran-clean:
+        rm -rf $(INST)/gfortran-7.2.0
+\`\`\`
+This is causing build failures because \`gcc\` is also installed.
+
+Perhaps the problem is that \`gfortran\` appears both in \`DUMMY_PACKAGES\` and \`NORMAL_PACKAGES\`?
 
 Summary: DUMMY_PACKAGES does not work
 
```




---

archive/issue_comments_373785.json:
```json
{
    "body": "<a id='comment:3'></a>I don't think this is any different from how it used to work.  For each package, there is a variable in the Makefile called `inst_<pkgname>`.  If the package should be installed (particularly as a dependency of another package) its `inst_<pkgname>` should point to the real stamp file for that package under `SAGE_SPKG_INSTS`.  However, if the package is not being installed in Sage (i.e. due to a configure check) then its `inst_<pkgname>` just points to `.dummy`.  But explicit build rules for that package are still added to the Makefile, so if you run `make gfortran` you can still install the `gfortran` package, overriding the `configure`-time determination.\n\nI'm not 100% convinced that's the best behavior (I think if you want to override a `configure`-based selection you should have to actually re-run `configure`).  But that's how it always worked until now.",
    "created_at": "2018-04-17T16:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373785",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>I don't think this is any different from how it used to work.  For each package, there is a variable in the Makefile called `inst_<pkgname>`.  If the package should be installed (particularly as a dependency of another package) its `inst_<pkgname>` should point to the real stamp file for that package under `SAGE_SPKG_INSTS`.  However, if the package is not being installed in Sage (i.e. due to a configure check) then its `inst_<pkgname>` just points to `.dummy`.  But explicit build rules for that package are still added to the Makefile, so if you run `make gfortran` you can still install the `gfortran` package, overriding the `configure`-time determination.

I'm not 100% convinced that's the best behavior (I think if you want to override a `configure`-based selection you should have to actually re-run `configure`).  But that's how it always worked until now.



---

archive/issue_comments_373786.json:
```json
{
    "body": "<a id='comment:4'></a>I think the problem has more to do with the oddities of how gcc is being handled, especially since #24703.\n\nI was confused because you wrote that \"gcc is also installed\", but in your Makefile it has `gcc` in `DUMMY_PACKAGES` implying that it was not selected for installation.  Yet all the packages have `$(SAGE_LOCAL)/bin/gcc` as dependencies implying that it was installed at some point.\n\nI think that what #24703 missed is that even if `$SAGE_INSTALL_GCC = exists` it needs to be setting `needs_to_install_gcc = yes` (this doesn't actually mean it will reinstall gcc if it isn't necessary to--this just means gcc is selected for possible installation in Sage, pending checking of its prerequisites by make).   Since that isn't happening, the build system gets into a funny state where Sage's gcc *is* installed, but the build system doesn't really think it should be.",
    "created_at": "2018-04-17T17:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373786",
    "user": "https://github.com/embray"
}
```

<a id='comment:4'></a>I think the problem has more to do with the oddities of how gcc is being handled, especially since #24703.

I was confused because you wrote that "gcc is also installed", but in your Makefile it has `gcc` in `DUMMY_PACKAGES` implying that it was not selected for installation.  Yet all the packages have `$(SAGE_LOCAL)/bin/gcc` as dependencies implying that it was installed at some point.

I think that what #24703 missed is that even if `$SAGE_INSTALL_GCC = exists` it needs to be setting `needs_to_install_gcc = yes` (this doesn't actually mean it will reinstall gcc if it isn't necessary to--this just means gcc is selected for possible installation in Sage, pending checking of its prerequisites by make).   Since that isn't happening, the build system gets into a funny state where Sage's gcc *is* installed, but the build system doesn't really think it should be.



---

archive/issue_comments_373787.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-17T17:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373787",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_373788.json:
```json
{
    "body": "<a id='comment:5'></a>I'm not positive since you weren't clear on the actual symptoms, but I think this should fix the basic problem (I'm guessing that it was a complaint about no target for `$(SAGE_LOCAL)/bin/gcc`).\n\n---\nNew commits:",
    "created_at": "2018-04-17T17:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373788",
    "user": "https://github.com/embray"
}
```

<a id='comment:5'></a>I'm not positive since you weren't clear on the actual symptoms, but I think this should fix the basic problem (I'm guessing that it was a complaint about no target for `$(SAGE_LOCAL)/bin/gcc`).

---
New commits:



---

archive/issue_comments_373789.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-17T17:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_373790.json:
```json
{
    "body": "<a id='comment:7'></a>I haven't reviewed the patch, but it would really be useful if `DEBUG_RULES=1` would show *everything* that ends up in the `Makefile`. In particular, the expansions of the `inst_FOO` variables are currently missing.\n\nThis is precisely the sort of thing why I opposed #21524: the `Makefile` rules are too obscure to understand what is broken.",
    "created_at": "2018-04-17T18:47:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373790",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>I haven't reviewed the patch, but it would really be useful if `DEBUG_RULES=1` would show *everything* that ends up in the `Makefile`. In particular, the expansions of the `inst_FOO` variables are currently missing.

This is precisely the sort of thing why I opposed #21524: the `Makefile` rules are too obscure to understand what is broken.



---

archive/issue_comments_373791.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:4 embray]:\n> I was confused because you wrote that \"gcc is also installed\", but in your Makefile it has `gcc` in `DUMMY_PACKAGES` implying that it was not selected for installation.  Yet all the packages have `$(SAGE_LOCAL)/bin/gcc` as dependencies implying that it was installed at some point.\n\n\nYes, I meant \"gcc has been installed at some point in the past\". `configure` correctly detects that `gfortran` should not be installed, but it's still being installed anyway.",
    "created_at": "2018-04-17T18:52:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373791",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>Replying to [comment:4 embray]:
> I was confused because you wrote that "gcc is also installed", but in your Makefile it has `gcc` in `DUMMY_PACKAGES` implying that it was not selected for installation.  Yet all the packages have `$(SAGE_LOCAL)/bin/gcc` as dependencies implying that it was installed at some point.


Yes, I meant "gcc has been installed at some point in the past". `configure` correctly detects that `gfortran` should not be installed, but it's still being installed anyway.



---

archive/issue_comments_373792.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:3 embray]:\n> if you run `make gfortran` you can still install the `gfortran` package, overriding the `configure`-time determination.\n\n\nTo be clear: this is *not* what I'm doing. `gfortran` is build during the normal build process.",
    "created_at": "2018-04-17T18:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373792",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>Replying to [comment:3 embray]:
> if you run `make gfortran` you can still install the `gfortran` package, overriding the `configure`-time determination.


To be clear: this is *not* what I'm doing. `gfortran` is build during the normal build process.



---

archive/issue_comments_373793.json:
```json
{
    "body": "Resolution: worksforme",
    "created_at": "2018-04-17T19:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373793",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: worksforme



---

archive/issue_comments_373794.json:
```json
{
    "body": "<a id='comment:10'></a>Never mind, user error...",
    "created_at": "2018-04-17T19:01:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373794",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'></a>Never mind, user error...



---

archive/issue_events_063181.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-17T19:01:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63181"
}
```



---

archive/issue_events_063182.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-17T19:01:11Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63182"
}
```



---

archive/issue_comments_373795.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:7 jdemeyer]:\n> I haven't reviewed the patch, but it would really be useful if `DEBUG_RULES=1` would show *everything* that ends up in the `Makefile`. In particular, the expansions of the `inst_FOO` variables are currently missing.\n> \n> This is precisely the sort of thing why I opposed #21524: the `Makefile` rules are too obscure to understand what is broken.\n\n\nI don't think anything's really being obscured here.  The old hard-coded makefile didn't expand those variables either so if you suspected something to do with them you've lost nothing.",
    "created_at": "2018-04-18T13:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373795",
    "user": "https://github.com/embray"
}
```

<a id='comment:11'></a>Replying to [comment:7 jdemeyer]:
> I haven't reviewed the patch, but it would really be useful if `DEBUG_RULES=1` would show *everything* that ends up in the `Makefile`. In particular, the expansions of the `inst_FOO` variables are currently missing.
> 
> This is precisely the sort of thing why I opposed #21524: the `Makefile` rules are too obscure to understand what is broken.


I don't think anything's really being obscured here.  The old hard-coded makefile didn't expand those variables either so if you suspected something to do with them you've lost nothing.



---

archive/issue_comments_373796.json:
```json
{
    "body": "Resolution changed from worksforme to ",
    "created_at": "2018-04-18T13:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373796",
    "user": "https://github.com/embray"
}
```

Resolution changed from worksforme to 



---

archive/issue_comments_373797.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2018-04-18T13:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373797",
    "user": "https://github.com/embray"
}
```

Changing status from closed to new.



---

archive/issue_events_063183.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T13:18:41Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63183"
}
```



---

archive/issue_comments_373798.json:
```json
{
    "body": "<a id='comment:12'></a>Well don't just close it.  You've been very vague about what the actual problem is here, though you led me to actually examine the issue closely and this fix actually is the correct thing to do.\n\nIf `./configure` detects an existing GCC installed in Sage (`SAGE_INSTALL_GCC=exists`) then it should keep gcc selected among the packages to be installed as part of the distribution.  Otherwise it basically deselects gcc which is the wrong thing to do (with any package).",
    "created_at": "2018-04-18T13:18:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373798",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>Well don't just close it.  You've been very vague about what the actual problem is here, though you led me to actually examine the issue closely and this fix actually is the correct thing to do.

If `./configure` detects an existing GCC installed in Sage (`SAGE_INSTALL_GCC=exists`) then it should keep gcc selected among the packages to be installed as part of the distribution.  Otherwise it basically deselects gcc which is the wrong thing to do (with any package).



---

archive/issue_comments_373799.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-18T13:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373799",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_373800.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:9 jdemeyer]:\n> Replying to [comment:3 embray]:\n> > if you run `make gfortran` you can still install the `gfortran` package, overriding the `configure`-time determination.\n\n> \n> To be clear: this is *not* what I'm doing. `gfortran` is build during the normal build process.\n\n\nRight, I didn't think you were doing that.  I'm just explaining that that capability exists (even if it's sometimes not a good idea), and that that's nothing new.",
    "created_at": "2018-04-18T13:23:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373800",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>Replying to [comment:9 jdemeyer]:
> Replying to [comment:3 embray]:
> > if you run `make gfortran` you can still install the `gfortran` package, overriding the `configure`-time determination.

> 
> To be clear: this is *not* what I'm doing. `gfortran` is build during the normal build process.


Right, I didn't think you were doing that.  I'm just explaining that that capability exists (even if it's sometimes not a good idea), and that that's nothing new.



---

archive/issue_comments_373801.json:
```json
{
    "body": "Description changed:\n```diff\n\n```\n",
    "created_at": "2018-04-18T19:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373801",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff

```




---

archive/issue_events_063184.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-18T19:51:53Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63184"
}
```



---

archive/issue_events_063185.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-04-18T19:51:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63185"
}
```



---

archive/issue_comments_373802.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+If \\`./configure\\` detects an existing GCC installed in Sage (\\`SAGE_INSTALL_GCC=exists\\`) then it should keep gcc selected among the packages to be installed as part of the distribution.  Otherwise it basically deselects gcc which is the wrong thing to do (with any package).\n \n Summary: DUMMY_PACKAGES does not work\n \n```\n",
    "created_at": "2018-04-18T19:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373802",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+If \`./configure\` detects an existing GCC installed in Sage (\`SAGE_INSTALL_GCC=exists\`) then it should keep gcc selected among the packages to be installed as part of the distribution.  Otherwise it basically deselects gcc which is the wrong thing to do (with any package).
 
 Summary: DUMMY_PACKAGES does not work
 
```




---

archive/issue_comments_373803.json:
```json
{
    "body": "<a id='comment:17'></a>Lgtm; Jeroen, any comments?",
    "created_at": "2018-04-18T23:32:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373803",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:17'></a>Lgtm; Jeroen, any comments?



---

archive/issue_comments_373804.json:
```json
{
    "body": "<a id='comment:18'></a>I honestly don't understand the issue here. Which problem is this trying to solve?",
    "created_at": "2018-04-19T09:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373804",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'></a>I honestly don't understand the issue here. Which problem is this trying to solve?



---

archive/issue_comments_373805.json:
```json
{
    "body": "<a id='comment:19'></a>It's resolving the thing I at least thought you were confused about.\n\nSay you want to install gcc in Sage (whether explicitly, or by requirement of configure):\n\n```\n$ SAGE_INSTALL_GCC=yes ./configure\n```\n\nthen `./configure` correctly outputs:\n\n```\nchecking package versions...\n...\n    gcc-7.2.0\n...\n```\n\nThen you install the gcc SPKG (explicitly or otherwise):\n\n```\n$ make gcc\n```\n\nAnd in the Makefile you see\n\n```\nBUILT_PACKAGES =\\\n...\ngcc \\\n...\n```\n\nand\n\n```\nDUMMY_PACKAGES = \\\n    curl \\\n    gfortran \\\n    git \\\n```\n\nHowever, if you then re-run `./configure` (without explicitly supplying `SAGE_INSTALL_GCC=yes`):\n\n```\nchecking package versions...\n...\n    gcc-7.2.0 not installed (configure check)\n...\n```\n\nit now says gcc spkg will not be installed (even though it is in fact already installed, and should continue to be installed).  Furthermore this means:\n\n```\nDUMMY_PACKAGES = \\\n    curl \\\n    gcc \\\n    gfortran \\\n    git \\\n```\n\nso the stamp file for the gcc spkg is now `$SAGE_SPKG_INST/.dummy` and not the real stamp file for the actual installed gcc.  This obviously isn't the intended behavior, nor the behavior for any other package.  This bug is just unique to the gcc package because of how its installation state is being managed by the configure script.",
    "created_at": "2018-04-19T11:45:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373805",
    "user": "https://github.com/embray"
}
```

<a id='comment:19'></a>It's resolving the thing I at least thought you were confused about.

Say you want to install gcc in Sage (whether explicitly, or by requirement of configure):

```
$ SAGE_INSTALL_GCC=yes ./configure
```

then `./configure` correctly outputs:

```
checking package versions...
...
    gcc-7.2.0
...
```

Then you install the gcc SPKG (explicitly or otherwise):

```
$ make gcc
```

And in the Makefile you see

```
BUILT_PACKAGES =\
...
gcc \
...
```

and

```
DUMMY_PACKAGES = \
    curl \
    gfortran \
    git \
```

However, if you then re-run `./configure` (without explicitly supplying `SAGE_INSTALL_GCC=yes`):

```
checking package versions...
...
    gcc-7.2.0 not installed (configure check)
...
```

it now says gcc spkg will not be installed (even though it is in fact already installed, and should continue to be installed).  Furthermore this means:

```
DUMMY_PACKAGES = \
    curl \
    gcc \
    gfortran \
    git \
```

so the stamp file for the gcc spkg is now `$SAGE_SPKG_INST/.dummy` and not the real stamp file for the actual installed gcc.  This obviously isn't the intended behavior, nor the behavior for any other package.  This bug is just unique to the gcc package because of how its installation state is being managed by the configure script.



---

archive/issue_comments_373806.json:
```json
{
    "body": "<a id='comment:20'></a>Replying to [comment:19 embray]:\n> This obviously isn't the intended behavior\n\n\nI actually think that it is intended.",
    "created_at": "2018-04-19T12:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373806",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:20'></a>Replying to [comment:19 embray]:
> This obviously isn't the intended behavior


I actually think that it is intended.



---

archive/issue_events_063186.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-04-19T22:56:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63186"
}
```



---

archive/issue_comments_373807.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-04-19T22:56:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373807",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_373808.json:
```json
{
    "body": "<a id='comment:22'></a>I think the affected users would prefer not to recompile gcc if they can avoid it... Though I'll leave it to you two to figure it out. But if there is no resultion real soon (TM) then it won't be in 8.2.",
    "created_at": "2018-04-19T23:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373808",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>I think the affected users would prefer not to recompile gcc if they can avoid it... Though I'll leave it to you two to figure it out. But if there is no resultion real soon (TM) then it won't be in 8.2.



---

archive/issue_comments_373809.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2018-04-19T23:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373809",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_063187.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-04-19T23:02:09Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63187"
}
```



---

archive/issue_comments_373810.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2018-04-19T23:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373810",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_373811.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-19T23:02:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373811",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_373812.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:22 vbraun]:\n> I think the affected users would prefer not to recompile gcc if they can avoid it...\n\n\nIndeed. that's the idea. We never recompile GCC just for fun.",
    "created_at": "2018-04-20T05:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373812",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:24'></a>Replying to [comment:22 vbraun]:
> I think the affected users would prefer not to recompile gcc if they can avoid it...


Indeed. that's the idea. We never recompile GCC just for fun.



---

archive/issue_comments_373813.json:
```json
{
    "body": "<a id='comment:25'></a>It's not that it's recompiling GCC.  It's a reminder that GCC is supposed to be installed in Sage in the first place.  It's really wrong--it means that if you delete `$SAGE_LOCAL/var/lib/sage/installed/gcc-*` then the gcc package won't get rebuilt.  You *do* want that because otherwise the package is for all intents and purposes broken.  I also don't know why you would want to treat gcc differently from any other package in this regard.\n\nThe only way I could see this remotely making sense is if proper uninstallation were also implemented.  Otherwise you're effectively saying \"gcc is not part of this Sage distribution\" even though it is installed.",
    "created_at": "2018-04-20T13:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373813",
    "user": "https://github.com/embray"
}
```

<a id='comment:25'></a>It's not that it's recompiling GCC.  It's a reminder that GCC is supposed to be installed in Sage in the first place.  It's really wrong--it means that if you delete `$SAGE_LOCAL/var/lib/sage/installed/gcc-*` then the gcc package won't get rebuilt.  You *do* want that because otherwise the package is for all intents and purposes broken.  I also don't know why you would want to treat gcc differently from any other package in this regard.

The only way I could see this remotely making sense is if proper uninstallation were also implemented.  Otherwise you're effectively saying "gcc is not part of this Sage distribution" even though it is installed.



---

archive/issue_comments_373814.json:
```json
{
    "body": "<a id='comment:26'></a>Either way, doesn't strike me as a blocker.",
    "created_at": "2018-04-20T16:47:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373814",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:26'></a>Either way, doesn't strike me as a blocker.



---

archive/issue_comments_373815.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:25 embray]:\n> I also don't know why you would want to treat gcc differently from any other package in this regard.\n\n\nBecause GCC tends to give cyclic build dependencies: GCC depends on MPIR but MPIR depends on GCC.",
    "created_at": "2018-04-23T07:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373815",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:27'></a>Replying to [comment:25 embray]:
> I also don't know why you would want to treat gcc differently from any other package in this regard.


Because GCC tends to give cyclic build dependencies: GCC depends on MPIR but MPIR depends on GCC.



---

archive/issue_comments_373816.json:
```json
{
    "body": "<a id='comment:28'></a>Okay, but the current behavior doesn't seem like the correct way to resolve that.",
    "created_at": "2018-04-23T15:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373816",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>Okay, but the current behavior doesn't seem like the correct way to resolve that.



---

archive/issue_comments_373817.json:
```json
{
    "body": "<a id='comment:29'></a>This seems like a reasonable change to me. Feel free to set this to positive review from my end. What's the current status here embray?",
    "created_at": "2018-07-17T15:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373817",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:29'></a>This seems like a reasonable change to me. Feel free to set this to positive review from my end. What's the current status here embray?



---

archive/issue_comments_373818.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-07-17T15:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373818",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_373819.json:
```json
{
    "body": "<a id='comment:31'></a>Jeroen has expressed some concerns that this has problems related to cyclic dependencies.  I think it's the fact that when you install sage-gcc, mpir, mpc, mpfr, and other dependencies of gcc are installed first in order to bootstrap it, then gcc is build, then its dependencies are *rebuilt* with the new gcc.  After this point, if dependencies of gcc get rebuilt, it should not trigger gcc to be rebuilt as well.\n\nI think, with this patch, that still would not happen, but I need to make sure.\n\nEither way, I don't think pretending that sage-gcc is not selected is a good way to deal with this.  Better to see if a special case can be made for toolchain dependencies (as in the more recent ticket #25857).",
    "created_at": "2018-07-17T19:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373819",
    "user": "https://github.com/embray"
}
```

<a id='comment:31'></a>Jeroen has expressed some concerns that this has problems related to cyclic dependencies.  I think it's the fact that when you install sage-gcc, mpir, mpc, mpfr, and other dependencies of gcc are installed first in order to bootstrap it, then gcc is build, then its dependencies are *rebuilt* with the new gcc.  After this point, if dependencies of gcc get rebuilt, it should not trigger gcc to be rebuilt as well.

I think, with this patch, that still would not happen, but I need to make sure.

Either way, I don't think pretending that sage-gcc is not selected is a good way to deal with this.  Better to see if a special case can be made for toolchain dependencies (as in the more recent ticket #25857).



---

archive/issue_comments_373820.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2018-07-18T07:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_373821.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-18T07:27:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_373822.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-07-18T07:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373822",
    "user": "https://github.com/embray"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_373823.json:
```json
{
    "body": "<a id='comment:34'></a>I had to make a small change over the previous fix, but I'm pretty confident this works.  I also had to merge in the fix from #25857 in order to be able to be able to test this at all without breaking things too much.\n\nYou can install sage-gcc, then packages that gcc depends on like mpir can be reinstalled and updated as much as you want.  This isn't a problem because, in part, all of gcc's dependencies are listed as prerequisite-only.",
    "created_at": "2018-07-18T07:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373823",
    "user": "https://github.com/embray"
}
```

<a id='comment:34'></a>I had to make a small change over the previous fix, but I'm pretty confident this works.  I also had to merge in the fix from #25857 in order to be able to be able to test this at all without breaking things too much.

You can install sage-gcc, then packages that gcc depends on like mpir can be reinstalled and updated as much as you want.  This isn't a problem because, in part, all of gcc's dependencies are listed as prerequisite-only.



---

archive/issue_events_063188.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T10:20:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63188"
}
```



---

archive/issue_events_063189.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T10:20:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63189"
}
```



---

archive/issue_comments_373824.json:
```json
{
    "body": "<a id='comment:36'></a>I suppose this also needs configure tarball and bump...",
    "created_at": "2018-09-07T08:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373824",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:36'></a>I suppose this also needs configure tarball and bump...



---

archive/issue_comments_373825.json:
```json
{
    "body": "<a id='comment:37'></a>It might not need a configure tarball, since this looks like one of those ones that \"happens to work\" even without rebuilding configure.",
    "created_at": "2018-09-07T09:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373825",
    "user": "https://github.com/embray"
}
```

<a id='comment:37'></a>It might not need a configure tarball, since this looks like one of those ones that "happens to work" even without rebuilding configure.



---

archive/issue_comments_373826.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-15T09:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373826",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_373827.json:
```json
{
    "body": "<a id='comment:39'></a>Merge conflict",
    "created_at": "2018-10-18T12:11:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373827",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:39'></a>Merge conflict



---

archive/issue_comments_373828.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-10-18T16:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373828",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_373829.json:
```json
{
    "body": "<a id='comment:41'></a>Replying to [comment:40 vbraun]:\nIIRC that work branch was https://github.com/sagemath/sage - but this does not seem to be the case anymore. Please advice where to look.",
    "created_at": "2018-10-19T09:18:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373829",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:41'></a>Replying to [comment:40 vbraun]:
IIRC that work branch was https://github.com/sagemath/sage - but this does not seem to be the case anymore. Please advice where to look.



---

archive/issue_comments_373830.json:
```json
{
    "body": "<a id='comment:42'></a>a trivial merge",
    "created_at": "2018-10-28T08:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373830",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:42'></a>a trivial merge



---

archive/issue_comments_373831.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-10-28T08:30:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373831",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_063190.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-10-28T08:35:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63190"
}
```



---

archive/issue_events_063191.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2018-10-28T08:35:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63191"
}
```



---

archive/issue_comments_373832.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-29T22:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25188#issuecomment-373832",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063192.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-29T22:46:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25188",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25188#event-63192"
}
```
