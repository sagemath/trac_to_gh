# Issue 25365: Wrap ntl_mat_ZZ_p

archive/issues_025128.json:
```json
{
    "body": "Wrap some of the functionality for matrices over Z/pZ available in ntl\n\n**CC:**  @edgarcosta @videlec @jdemeyer @simon-king-jena\n\n**Keywords:** libs, sd87\n\n**Branch:** [public/ticket/25365](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/25365)\n\n**Commit:** [4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792](https://github.com/sagemath/sagetrac-mirror/commit/4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792)\n\n**Author:** Alex J. Best\n\nIssue created by migration from https://trac.sagemath.org/ticket/25365\n\n",
    "created_at": "2018-05-15T13:39:46Z",
    "labels": [
        "component: c lib",
        "enhancement",
        "needs work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "Wrap ntl_mat_ZZ_p",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/25365",
    "user": "https://github.com/alexjbest"
}
```
Wrap some of the functionality for matrices over Z/pZ available in ntl

**CC:**  @edgarcosta @videlec @jdemeyer @simon-king-jena

**Keywords:** libs, sd87

**Branch:** [public/ticket/25365](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/25365)

**Commit:** [4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792](https://github.com/sagemath/sagetrac-mirror/commit/4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792)

**Author:** Alex J. Best

Issue created by migration from https://trac.sagemath.org/ticket/25365





---

archive/issue_comments_390607.json:
```json
{
    "body": "**Branch:** [u/alexjbest/wrap-ntl-mat-ZZ-p](https://github.com/sagemath/sagetrac-mirror/tree/u/alexjbest/wrap-ntl-mat-ZZ-p)",
    "created_at": "2018-05-15T13:42:04Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390607",
    "user": "https://github.com/alexjbest"
}
```

**Branch:** [u/alexjbest/wrap-ntl-mat-ZZ-p](https://github.com/sagemath/sagetrac-mirror/tree/u/alexjbest/wrap-ntl-mat-ZZ-p)



---

archive/issue_comments_390608.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/747c0b440983e9e146cc1bad18ac6328f3e8def7\">747c0b4</a></td><td><code>actually implement sage rep of ntl</code></td></tr></table>\n",
    "created_at": "2018-05-16T22:53:53Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390608",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/747c0b440983e9e146cc1bad18ac6328f3e8def7">747c0b4</a></td><td><code>actually implement sage rep of ntl</code></td></tr></table>




---

archive/issue_comments_390609.json:
```json
{
    "body": "**Commit:** [747c0b440983e9e146cc1bad18ac6328f3e8def7](https://github.com/sagemath/sagetrac-mirror/commit/747c0b440983e9e146cc1bad18ac6328f3e8def7)",
    "created_at": "2018-05-16T22:53:53Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390609",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [747c0b440983e9e146cc1bad18ac6328f3e8def7](https://github.com/sagemath/sagetrac-mirror/commit/747c0b440983e9e146cc1bad18ac6328f3e8def7)



---

archive/issue_events_225085.json:
```json
{
    "actor": "https://github.com/alexjbest",
    "created_at": "2018-06-01T23:03:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225085"
}
```



---

archive/issue_comments_390610.json:
```json
{
    "body": "<a id='comment:4'></a>\ncc-ing a few people who might be interested and/or have the technical expertises to review this.",
    "created_at": "2018-06-03T08:00:26Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390610",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:4'></a>
cc-ing a few people who might be interested and/or have the technical expertises to review this.



---

archive/issue_comments_390611.json:
```json
{
    "body": "<a id='comment:5'></a>\n1. What is the point of having a Python wrapper that is not a Sage matrix class? This is something I don't understand.\n\n2. Why all the inline methods in `ntlwrap.cpp` are needed at all? Cython has very good support for C++ now. The ntl wrappers in Sage are not up to date and would better be cleaned up.\n\nAnd minor remarks:\n\n3. `for i from 0 <= i < _nrows:` is an old syntax. You would better use `range`.\n\n4. The copyright header\n\n```\n+#*****************************************************************************\n+#       Copyright (C) 2005 William Stein <wstein@gmail.com>\n```\n  should contain the *author* name with the appropriate year.\n\n5. This comment should be removed\n\n```\n+##############################################################################\n+#\n+# ntl_mat_ZZ_p: Matrices over ZZ_p via NTL\n+#\n+# AUTHORS:\n+#  - Martin Albrecht <malb@informatik.uni-bremen.de>\n+#    2006-01: initial version of mat_GF2E (based on code by William Stein)\n+#  - Alex J. Best <alex.j.best@gmail.com>\n+#    2018-02: transplanted to mat_ZZ_p\n+#\n+##############################################################################\n```\n  You need to convert it in a proper module documentation and add the relevant information in the AUTHOR section. You can find relevant information in the Sage precisely stated in the Sage Developer\u2019s Guide.",
    "created_at": "2018-06-03T08:17:06Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390611",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
1. What is the point of having a Python wrapper that is not a Sage matrix class? This is something I don't understand.

2. Why all the inline methods in `ntlwrap.cpp` are needed at all? Cython has very good support for C++ now. The ntl wrappers in Sage are not up to date and would better be cleaned up.

And minor remarks:

3. `for i from 0 <= i < _nrows:` is an old syntax. You would better use `range`.

4. The copyright header

```
+#*****************************************************************************
+#       Copyright (C) 2005 William Stein <wstein@gmail.com>
```
  should contain the *author* name with the appropriate year.

5. This comment should be removed

```
+##############################################################################
+#
+# ntl_mat_ZZ_p: Matrices over ZZ_p via NTL
+#
+# AUTHORS:
+#  - Martin Albrecht <malb@informatik.uni-bremen.de>
+#    2006-01: initial version of mat_GF2E (based on code by William Stein)
+#  - Alex J. Best <alex.j.best@gmail.com>
+#    2018-02: transplanted to mat_ZZ_p
+#
+##############################################################################
```
  You need to convert it in a proper module documentation and add the relevant information in the AUTHOR section. You can find relevant information in the Sage precisely stated in the Sage Developerâ€™s Guide.



---

archive/issue_events_225086.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-06-03T08:17:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225086"
}
```



---

archive/issue_events_225087.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-06-03T08:17:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225087"
}
```



---

archive/issue_comments_390612.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [vdelecroix](#comment%3A5):\n> 1. What is the point of having a Python wrapper that is not a Sage matrix class? This is something I don't understand.\n\nMore precisely, you need to choose between:\n\n- Write a complete matrix class whose \"backend\" would be a NTL c++ class. You would have to inherit from `sage.matrix.matrix_dense.Matrix_dense`. A good example is provided with `Matrix_integer_dense` that wraps FLINT.\n\n- Add some options to the methods of the current matrix classes to call NTL when appropriate. To that purpose, you have to convert the datastructure when needed. Some examples are also provided with `Matrix_integer_dense` that uses `iml` or `linbox`.",
    "created_at": "2018-06-03T08:23:21Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390612",
    "user": "https://github.com/videlec"
}
```

<a id='comment:7'></a>
Replying to [vdelecroix](#comment%3A5):
> 1. What is the point of having a Python wrapper that is not a Sage matrix class? This is something I don't understand.

More precisely, you need to choose between:

- Write a complete matrix class whose "backend" would be a NTL c++ class. You would have to inherit from `sage.matrix.matrix_dense.Matrix_dense`. A good example is provided with `Matrix_integer_dense` that wraps FLINT.

- Add some options to the methods of the current matrix classes to call NTL when appropriate. To that purpose, you have to convert the datastructure when needed. Some examples are also provided with `Matrix_integer_dense` that uses `iml` or `linbox`.



---

archive/issue_comments_390613.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [vdelecroix](#comment%3A5):\nThanks for the comments! I'm pleased to hear some of this can be made neater/more idiomatic.\n> 1. What is the point of having a Python wrapper that is not a Sage matrix class? This is something I don't understand.\n\nI appreciate that this is a little weird, the point is #25366 which is used in #20264, of course in an ideal world I would have implemented a lot more in this ticket. But I thought I would do this as a first step so that those tickets could be added and maybe later see what ntl has to offer sage matrices over Z/nZ more generally.\n> 2. Why all the inline methods in `ntlwrap.cpp` are needed at all? Cython has very good support for C++ now. The ntl wrappers in Sage are not up to date and would better be cleaned up.\n\nThat's great to hear, I'm not particularly up to date on cython, so I just took existing ntl wrappers and modified them until everything worked.\nIs it sufficient to just delete a lot of lines in ntlwrap now? I can of course go through and do this (for other modules also).\n\n> And minor remarks:\n> \n> 3. `for i from 0 <= i < _nrows:` is an old syntax. You would better use `range`.\n> \n> 4. The copyright header\n> \n> ```\n> +#*****************************************************************************\n> +#       Copyright (C) 2005 William Stein <wstein@gmail.com>\n> ```\n>   should contain the *author* name with the appropriate year.\n> \n> 5. This comment should be removed\n> \n> ```\n> +##############################################################################\n> +#\n> +# ntl_mat_ZZ_p: Matrices over ZZ_p via NTL\n> +#\n> +# AUTHORS:\n> +#  - Martin Albrecht <malb@informatik.uni-bremen.de>\n> +#    2006-01: initial version of mat_GF2E (based on code by William Stein)\n> +#  - Alex J. Best <alex.j.best@gmail.com>\n> +#    2018-02: transplanted to mat_ZZ_p\n> +#\n> +##############################################################################\n> ```\n>   You need to convert it in a proper module documentation and add the relevant information in the AUTHOR section. You can find relevant information in the Sage precisely stated in the Sage Developer\u2019s Guide.\n\nYeah most of this was just me copying `mat_GF2E` so I'll try and fix them both (all?), thanks!",
    "created_at": "2018-06-03T15:52:38Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390613",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:8'></a>
Replying to [vdelecroix](#comment%3A5):
Thanks for the comments! I'm pleased to hear some of this can be made neater/more idiomatic.
> 1. What is the point of having a Python wrapper that is not a Sage matrix class? This is something I don't understand.

I appreciate that this is a little weird, the point is #25366 which is used in #20264, of course in an ideal world I would have implemented a lot more in this ticket. But I thought I would do this as a first step so that those tickets could be added and maybe later see what ntl has to offer sage matrices over Z/nZ more generally.
> 2. Why all the inline methods in `ntlwrap.cpp` are needed at all? Cython has very good support for C++ now. The ntl wrappers in Sage are not up to date and would better be cleaned up.

That's great to hear, I'm not particularly up to date on cython, so I just took existing ntl wrappers and modified them until everything worked.
Is it sufficient to just delete a lot of lines in ntlwrap now? I can of course go through and do this (for other modules also).

> And minor remarks:
> 
> 3. `for i from 0 <= i < _nrows:` is an old syntax. You would better use `range`.
> 
> 4. The copyright header
> 
> ```
> +#*****************************************************************************
> +#       Copyright (C) 2005 William Stein <wstein@gmail.com>
> ```
>   should contain the *author* name with the appropriate year.
> 
> 5. This comment should be removed
> 
> ```
> +##############################################################################
> +#
> +# ntl_mat_ZZ_p: Matrices over ZZ_p via NTL
> +#
> +# AUTHORS:
> +#  - Martin Albrecht <malb@informatik.uni-bremen.de>
> +#    2006-01: initial version of mat_GF2E (based on code by William Stein)
> +#  - Alex J. Best <alex.j.best@gmail.com>
> +#    2018-02: transplanted to mat_ZZ_p
> +#
> +##############################################################################
> ```
>   You need to convert it in a proper module documentation and add the relevant information in the AUTHOR section. You can find relevant information in the Sage precisely stated in the Sage Developerâ€™s Guide.

Yeah most of this was just me copying `mat_GF2E` so I'll try and fix them both (all?), thanks!



---

archive/issue_comments_390614.json:
```json
{
    "body": "<a id='comment:9'></a>\nBTW, what is in NTL that you can not find in the current Sage matrix class?",
    "created_at": "2018-06-03T15:55:13Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390614",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
BTW, what is in NTL that you can not find in the current Sage matrix class?



---

archive/issue_comments_390615.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [vdelecroix](#comment%3A9):\n> BTW, what is in NTL that you can not find in the current Sage matrix class?\n\nIts #25366 that is needed this is a function that has mat_Zz_p's for input and output, which as far as i can tell sage does not currently understand at all. so in reality half of what I'm proposing here is not needed/used right now. But it seemed even less useful to just add the couple of accessors we need.",
    "created_at": "2018-06-03T18:57:43Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390615",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:10'></a>
Replying to [vdelecroix](#comment%3A9):
> BTW, what is in NTL that you can not find in the current Sage matrix class?

Its #25366 that is needed this is a function that has mat_Zz_p's for input and output, which as far as i can tell sage does not currently understand at all. so in reality half of what I'm proposing here is not needed/used right now. But it seemed even less useful to just add the couple of accessors we need.



---

archive/issue_comments_390616.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [alexjbest](#comment%3A10):\n> Replying to [vdelecroix](#comment%3A9):\n> > BTW, what is in NTL that you can not find in the current Sage matrix class?\n\n> Its #25366 that is needed this is a function that has mat_Zz_p's for input and output, which as far as i can tell sage does not currently understand at all. so in reality half of what I'm proposing here is not needed/used right now. But it seemed even less useful to just add the couple of accessors we need.\n\nIt is not clear to me why you need a Python wrapper to call a C++ NTL function. Converting a Sage matrix into a NTL `mat_ZZ_p` could be done without Python wrapper. At #24544 you can have a look at `sage/libs/linbox/conversion.pxd` that perform conversions `linbox C++ types <-> Sage types` without any intermediate Python wrapper. It saves a lot of code that boils down to\n\n```\ncdef class my_wrapping_class:\n    def my_method(self):\n        return self.wrapped_object.my_method()\n```\nIf you want to call NTL functions, just provide these conversions.\n\nThe wrapper that is provided in the branch would be useful if it provided an alternative implementation of matrices (see also [comment:5] and [comment:7]). Matrices do accept an implementation keyword and one can imagine an implementation using NTL\n\n```\nsage: MatrixSpace(ZZ, 2, implementation='gap')\nFull MatrixSpace of 2 by 2 dense matrices over Integer Ring (using Matrix_gap)\n```\n\nBut these two purposes are mostly disjoint and I am inclined to think that you are interested in the first situation.",
    "created_at": "2018-06-03T19:13:26Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390616",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>
Replying to [alexjbest](#comment%3A10):
> Replying to [vdelecroix](#comment%3A9):
> > BTW, what is in NTL that you can not find in the current Sage matrix class?

> Its #25366 that is needed this is a function that has mat_Zz_p's for input and output, which as far as i can tell sage does not currently understand at all. so in reality half of what I'm proposing here is not needed/used right now. But it seemed even less useful to just add the couple of accessors we need.

It is not clear to me why you need a Python wrapper to call a C++ NTL function. Converting a Sage matrix into a NTL `mat_ZZ_p` could be done without Python wrapper. At #24544 you can have a look at `sage/libs/linbox/conversion.pxd` that perform conversions `linbox C++ types <-> Sage types` without any intermediate Python wrapper. It saves a lot of code that boils down to

```
cdef class my_wrapping_class:
    def my_method(self):
        return self.wrapped_object.my_method()
```
If you want to call NTL functions, just provide these conversions.

The wrapper that is provided in the branch would be useful if it provided an alternative implementation of matrices (see also [comment:5] and [comment:7]). Matrices do accept an implementation keyword and one can imagine an implementation using NTL

```
sage: MatrixSpace(ZZ, 2, implementation='gap')
Full MatrixSpace of 2 by 2 dense matrices over Integer Ring (using Matrix_gap)
```

But these two purposes are mostly disjoint and I am inclined to think that you are interested in the first situation.



---

archive/issue_comments_390617.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [vdelecroix](#comment%3A11):\n> Replying to [alexjbest](#comment%3A10):\n> > Replying to [vdelecroix](#comment%3A9):\n> > > BTW, what is in NTL that you can not find in the current Sage matrix class?\n\n> > Its #25366 that is needed this is a function that has mat_Zz_p's for input and output, which as far as i can tell sage does not currently understand at all. so in reality half of what I'm proposing here is not needed/used right now. But it seemed even less useful to just add the couple of accessors we need.\n\n> \n> It is not clear to me why you need a Python wrapper to call a C++ NTL function. Converting a Sage matrix into a NTL `mat_ZZ_p` could be done without Python wrapper. At #24544 you can have a look at `sage/libs/linbox/conversion.pxd` that perform conversions `linbox C++ types <-> Sage types` without any intermediate Python wrapper. It saves a lot of code that boils down to\n> \n> ```\n> cdef class my_wrapping_class:\n>     def my_method(self):\n>         return self.wrapped_object.my_method()\n> ```\n> If you want to call NTL functions, just provide these conversions.\n> \n> The wrapper that is provided in the branch would be useful if it provided an alternative implementation of matrices (see also [comment:5] and [comment:7]). Matrices do accept an implementation keyword and one can imagine an implementation using NTL\n> \n> ```\n> sage: MatrixSpace(ZZ, 2, implementation='gap')\n> Full MatrixSpace of 2 by 2 dense matrices over Integer Ring (using Matrix_gap)\n> ```\n> \n> But these two purposes are mostly disjoint and I am inclined to think that you are interested in the first situation.\n\nYes thats a fair assesment, I suppose I thought it would be most helpful to lay a little groundwork for the latter purpose while doing the former. I would like to look into the alternative approach you suggest when I have some time as it does sound better, but that probably wont happen immediately.",
    "created_at": "2018-06-03T19:32:38Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390617",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:12'></a>
Replying to [vdelecroix](#comment%3A11):
> Replying to [alexjbest](#comment%3A10):
> > Replying to [vdelecroix](#comment%3A9):
> > > BTW, what is in NTL that you can not find in the current Sage matrix class?

> > Its #25366 that is needed this is a function that has mat_Zz_p's for input and output, which as far as i can tell sage does not currently understand at all. so in reality half of what I'm proposing here is not needed/used right now. But it seemed even less useful to just add the couple of accessors we need.

> 
> It is not clear to me why you need a Python wrapper to call a C++ NTL function. Converting a Sage matrix into a NTL `mat_ZZ_p` could be done without Python wrapper. At #24544 you can have a look at `sage/libs/linbox/conversion.pxd` that perform conversions `linbox C++ types <-> Sage types` without any intermediate Python wrapper. It saves a lot of code that boils down to
> 
> ```
> cdef class my_wrapping_class:
>     def my_method(self):
>         return self.wrapped_object.my_method()
> ```
> If you want to call NTL functions, just provide these conversions.
> 
> The wrapper that is provided in the branch would be useful if it provided an alternative implementation of matrices (see also [comment:5] and [comment:7]). Matrices do accept an implementation keyword and one can imagine an implementation using NTL
> 
> ```
> sage: MatrixSpace(ZZ, 2, implementation='gap')
> Full MatrixSpace of 2 by 2 dense matrices over Integer Ring (using Matrix_gap)
> ```
> 
> But these two purposes are mostly disjoint and I am inclined to think that you are interested in the first situation.

Yes thats a fair assesment, I suppose I thought it would be most helpful to lay a little groundwork for the latter purpose while doing the former. I would like to look into the alternative approach you suggest when I have some time as it does sound better, but that probably wont happen immediately.



---

archive/issue_comments_390618.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [vdelecroix](#comment%3A11):\n> If you want to call NTL functions, just provide these conversions.\n\nOk so over at #25366 I have tried to do as you suggest without adding any new classes, it was a fun exercise in permuting code until everything works... If you wouldn't mind checking it out and seeing how it compares to what you had in mind (the code at least, I'll fix all the style, the fact it says linbox still etc. once it seems the code is acceptable) that would be really helpful!",
    "created_at": "2018-06-13T09:34:25Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390618",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:13'></a>
Replying to [vdelecroix](#comment%3A11):
> If you want to call NTL functions, just provide these conversions.

Ok so over at #25366 I have tried to do as you suggest without adding any new classes, it was a fun exercise in permuting code until everything works... If you wouldn't mind checking it out and seeing how it compares to what you had in mind (the code at least, I'll fix all the style, the fact it says linbox still etc. once it seems the code is acceptable) that would be really helpful!



---

archive/issue_comments_390619.json:
```json
{
    "body": "<a id='comment:14'></a>\nIndeed, the code looks good.",
    "created_at": "2018-06-13T10:37:29Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390619",
    "user": "https://github.com/videlec"
}
```

<a id='comment:14'></a>
Indeed, the code looks good.



---

archive/issue_comments_390620.json:
```json
{
    "body": "<a id='comment:15'></a>\nupdate milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390620",
    "user": "https://github.com/videlec"
}
```

<a id='comment:15'></a>
update milestone 8.3 -> 8.4



---

archive/issue_events_225088.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225088"
}
```



---

archive/issue_events_225089.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225089"
}
```



---

archive/issue_comments_390621.json:
```json
{
    "body": "**Changing commit** from \"[747c0b440983e9e146cc1bad18ac6328f3e8def7](https://github.com/sagemath/sagetrac-mirror/commit/747c0b440983e9e146cc1bad18ac6328f3e8def7)\" to \"[d8cfecea9a86fe89af80fc1859b1195cc1d388a4](https://github.com/sagemath/sagetrac-mirror/commit/d8cfecea9a86fe89af80fc1859b1195cc1d388a4)\".",
    "created_at": "2019-07-14T11:53:39Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390621",
    "user": "https://github.com/fchapoton"
}
```

**Changing commit** from "[747c0b440983e9e146cc1bad18ac6328f3e8def7](https://github.com/sagemath/sagetrac-mirror/commit/747c0b440983e9e146cc1bad18ac6328f3e8def7)" to "[d8cfecea9a86fe89af80fc1859b1195cc1d388a4](https://github.com/sagemath/sagetrac-mirror/commit/d8cfecea9a86fe89af80fc1859b1195cc1d388a4)".



---

archive/issue_events_225090.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-14T11:53:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225090"
}
```



---

archive/issue_events_225091.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-14T11:53:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225091"
}
```



---

archive/issue_events_225092.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-14T11:53:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225092"
}
```



---

archive/issue_events_225093.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-07-14T11:53:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225093"
}
```



---

archive/issue_comments_390622.json:
```json
{
    "body": "**Changing branch** from \"[u/alexjbest/wrap-ntl-mat-ZZ-p](https://github.com/sagemath/sagetrac-mirror/tree/u/alexjbest/wrap-ntl-mat-ZZ-p)\" to \"[public/ticket/25365](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/25365)\".",
    "created_at": "2019-07-14T11:53:39Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390622",
    "user": "https://github.com/fchapoton"
}
```

**Changing branch** from "[u/alexjbest/wrap-ntl-mat-ZZ-p](https://github.com/sagemath/sagetrac-mirror/tree/u/alexjbest/wrap-ntl-mat-ZZ-p)" to "[public/ticket/25365](https://github.com/sagemath/sagetrac-mirror/tree/public/ticket/25365)".



---

archive/issue_comments_390623.json:
```json
{
    "body": "<a id='comment:16'></a>\nI have tried to rebase. \n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7b785b2a7cd4dd30a56b2aa439d743c70d9ecb1\">a7b785b</a></td><td><code>wrap ntl_mat_ZZ_p functionality</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8cfecea9a86fe89af80fc1859b1195cc1d388a4\">d8cfece</a></td><td><code>actually implement sage rep of ntl</code></td></tr></table>\n",
    "created_at": "2019-07-14T11:53:39Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390623",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:16'></a>
I have tried to rebase. 

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7b785b2a7cd4dd30a56b2aa439d743c70d9ecb1">a7b785b</a></td><td><code>wrap ntl_mat_ZZ_p functionality</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8cfecea9a86fe89af80fc1859b1195cc1d388a4">d8cfece</a></td><td><code>actually implement sage rep of ntl</code></td></tr></table>




---

archive/issue_comments_390624.json:
```json
{
    "body": "<a id='comment:17'></a>\nInstead of specifying the dependencies in the extension as\n\n```\n    Extension('sage.libs.ntl.ntl_mat_ZZ_p',\n              sources = [\"sage/libs/ntl/ntl_mat_ZZ_p.pyx\"],\n              libraries = [\"ntl\", \"gmp\", \"m\"],\n              language='c++'),\n```\nit is prefered to put them in the `.pxd` file via distutils directive (to be put on top of the file)\n\n```\n# distutils: libraries = ntl gmp m\n```\nThis way, any Cython file that includes the given pxd will be compiled with the appropriate linking.\n\nThe same applies to `language` and you could have a look at the various `pxd` files in `sage/libs`.",
    "created_at": "2019-07-14T12:34:30Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390624",
    "user": "https://github.com/videlec"
}
```

<a id='comment:17'></a>
Instead of specifying the dependencies in the extension as

```
    Extension('sage.libs.ntl.ntl_mat_ZZ_p',
              sources = ["sage/libs/ntl/ntl_mat_ZZ_p.pyx"],
              libraries = ["ntl", "gmp", "m"],
              language='c++'),
```
it is prefered to put them in the `.pxd` file via distutils directive (to be put on top of the file)

```
# distutils: libraries = ntl gmp m
```
This way, any Cython file that includes the given pxd will be compiled with the appropriate linking.

The same applies to `language` and you could have a look at the various `pxd` files in `sage/libs`.



---

archive/issue_comments_390625.json:
```json
{
    "body": "<a id='comment:18'></a>\nIs there a reason why you add the prefix `mat_ZZ_p_` to all function names? Cython perfectly supports function overloading (in C++). Since it is done that way in all other `pxd` I guess it makes sense. But it would be good to simplify it and stick to the name in the library.",
    "created_at": "2019-07-14T12:37:00Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390625",
    "user": "https://github.com/videlec"
}
```

<a id='comment:18'></a>
Is there a reason why you add the prefix `mat_ZZ_p_` to all function names? Cython perfectly supports function overloading (in C++). Since it is done that way in all other `pxd` I guess it makes sense. But it would be good to simplify it and stick to the name in the library.



---

archive/issue_comments_390626.json:
```json
{
    "body": "<a id='comment:19'></a>\nDon't put the declaration and implementation of `ntl_mat_ZZ_p` inside `sage/libs`. The repo `sage/libs` is intended for library declarations. All code related to matrices should go in `sage/matrix/`.",
    "created_at": "2019-07-14T12:38:31Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390626",
    "user": "https://github.com/videlec"
}
```

<a id='comment:19'></a>
Don't put the declaration and implementation of `ntl_mat_ZZ_p` inside `sage/libs`. The repo `sage/libs` is intended for library declarations. All code related to matrices should go in `sage/matrix/`.



---

archive/issue_events_225094.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-07-14T12:43:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225094"
}
```



---

archive/issue_events_225095.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2019-07-14T12:43:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225095"
}
```



---

archive/issue_comments_390627.json:
```json
{
    "body": "<a id='comment:20'></a>\nAnd many remarks from 14 months ago have not been adressed.",
    "created_at": "2019-07-14T12:43:53Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390627",
    "user": "https://github.com/videlec"
}
```

<a id='comment:20'></a>
And many remarks from 14 months ago have not been adressed.



---

archive/issue_events_225096.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225096"
}
```



---

archive/issue_events_225097.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-12-30T14:48:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225097"
}
```



---

archive/issue_comments_390628.json:
```json
{
    "body": "<a id='comment:21'></a>\nTicket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390628",
    "user": "https://github.com/embray"
}
```

<a id='comment:21'></a>
Ticket retargeted after milestone closed



---

archive/issue_events_225098.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225098"
}
```



---

archive/issue_events_225099.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-04-14T19:41:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225099"
}
```



---

archive/issue_comments_390629.json:
```json
{
    "body": "<a id='comment:22'></a>\nBatch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390629",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_390630.json:
```json
{
    "body": "<a id='comment:23'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792\">4fe3cf2</a></td><td><code>Merge branch 'public/ticket/25365' in 9.2.b2</code></td></tr></table>\n",
    "created_at": "2020-07-02T20:00:11Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390630",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792">4fe3cf2</a></td><td><code>Merge branch 'public/ticket/25365' in 9.2.b2</code></td></tr></table>




---

archive/issue_comments_390631.json:
```json
{
    "body": "**Changing commit** from \"[d8cfecea9a86fe89af80fc1859b1195cc1d388a4](https://github.com/sagemath/sagetrac-mirror/commit/d8cfecea9a86fe89af80fc1859b1195cc1d388a4)\" to \"[4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792](https://github.com/sagemath/sagetrac-mirror/commit/4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792)\".",
    "created_at": "2020-07-02T20:00:11Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390631",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d8cfecea9a86fe89af80fc1859b1195cc1d388a4](https://github.com/sagemath/sagetrac-mirror/commit/d8cfecea9a86fe89af80fc1859b1195cc1d388a4)" to "[4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792](https://github.com/sagemath/sagetrac-mirror/commit/4fe3cf2a1bcd965fc2a8eee1f06047cf13ecd792)".



---

archive/issue_events_225100.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225100"
}
```



---

archive/issue_events_225101.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225101"
}
```



---

archive/issue_events_225102.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225102"
}
```



---

archive/issue_events_225103.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225103"
}
```



---

archive/issue_comments_390632.json:
```json
{
    "body": "<a id='comment:25'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390632",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_225104.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225104"
}
```



---

archive/issue_events_225105.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225105"
}
```



---

archive/issue_comments_390633.json:
```json
{
    "body": "<a id='comment:26'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25365#issuecomment-390633",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_225106.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225106"
}
```



---

archive/issue_events_225107.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:24:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225107"
}
```



---

archive/issue_events_225108.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225108"
}
```



---

archive/issue_events_225109.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-04-02T20:27:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225109"
}
```



---

archive/issue_events_225110.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225110"
}
```



---

archive/issue_events_225111.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25365",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25365#event-225111"
}
```
