# Issue 25260: Upgrade to NumPy 1.15.2

archive/issues_025023.json:
```json
{
    "assignees": [],
    "body": "NumPy 1.15.2 was released.\n\n- [NumPy releases](https://github.com/numpy/numpy/releases)\n\n**Tarball**: https://files.pythonhosted.org/packages/45/ba/2a781ebbb0cd7962cc1d12a6b65bd4eff57ffda449fdbbae4726dc05fbc3/numpy-1.15.2.zip\n\nOur last upgrade was to NumPy 1.13.3 in #24063.\n\nA bug introduced in NumPy 1.15 prevents building NumPy on machines with many CPUs.\n\nThe issue is reported and solved upstream:\n\n- [NumPy issue 12087](https://github.com/numpy/numpy/issues/12087)\n- [NumPy pull request 12088](https://github.com/numpy/numpy/pull/12088)\n\n\nCC:  @kiwifb @infinity0 @jdemeyer @slel epalezzato\n\nKeywords: **upgrade, numpy**\n\nBranch: **[b151634](https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f)**\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Timo Kaufmann, Julian R\u00fcth, Bryan Gin-ge Chen**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25260_\n\n",
    "closed_at": "2018-10-20T11:59:06Z",
    "created_at": "2018-04-29T10:51:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.5",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade to NumPy 1.15.2",
    "type": "issue",
    "updated_at": "2018-11-11T22:29:25Z",
    "url": "https://github.com/sagemath/sage/issues/25260",
    "user": "https://github.com/slel"
}
```
NumPy 1.15.2 was released.

- [NumPy releases](https://github.com/numpy/numpy/releases)

**Tarball**: https://files.pythonhosted.org/packages/45/ba/2a781ebbb0cd7962cc1d12a6b65bd4eff57ffda449fdbbae4726dc05fbc3/numpy-1.15.2.zip

Our last upgrade was to NumPy 1.13.3 in #24063.

A bug introduced in NumPy 1.15 prevents building NumPy on machines with many CPUs.

The issue is reported and solved upstream:

- [NumPy issue 12087](https://github.com/numpy/numpy/issues/12087)
- [NumPy pull request 12088](https://github.com/numpy/numpy/pull/12088)


CC:  @kiwifb @infinity0 @jdemeyer @slel epalezzato

Keywords: **upgrade, numpy**

Branch: **[b151634](https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f)**

Upstream: **Fixed upstream, but not in a stable release.**

Reviewer: **Travis Scrimshaw**

Author: **Timo Kaufmann, Julian Rüth, Bryan Gin-ge Chen**

_Issue created by migration from https://trac.sagemath.org/ticket/25260_





---

archive/issue_events_331500.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-04-29T10:51:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331500"
}
```



---

archive/issue_events_331501.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-04-29T10:51:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331501"
}
```



---

archive/issue_events_331502.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-04-29T10:51:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331502"
}
```



---

archive/issue_events_331503.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-04-29T10:51:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331503"
}
```



---

archive/issue_comments_388876.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nFor NumPy 1.13.3 we have the tarball in .zip, should we also use the .zip this time or the .tar.gz?",
    "created_at": "2018-04-29T23:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388876",
    "user": "https://github.com/slel"
}
```

<a id='comment:1'>Comment 1:</a>
For NumPy 1.13.3 we have the tarball in .zip, should we also use the .zip this time or the .tar.gz?



---

archive/issue_comments_388877.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,10 @@\n - [NumPy releases](https://github.com/numpy/numpy/releases)\n \n Our last upgrade was to NumPy 1.13.3 in #24063.\n+\n+- tarball (tgz):\n+  https://github.com/numpy/numpy/releases/download/v1.14.3/numpy-1.14.3.tar.gz\n+- MD5:\n+  7c3c806ae27196c92d2fb3fbd4991e81\n+- SHA256:\n+  cfcfc7a9a8ba4275c60a815c683d59ac5e7aa9362d76573b6cc4324ffb1235fa\n``````\n",
    "created_at": "2018-04-29T23:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388877",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,10 @@
 - [NumPy releases](https://github.com/numpy/numpy/releases)
 
 Our last upgrade was to NumPy 1.13.3 in #24063.
+
+- tarball (tgz):
+  https://github.com/numpy/numpy/releases/download/v1.14.3/numpy-1.14.3.tar.gz
+- MD5:
+  7c3c806ae27196c92d2fb3fbd4991e81
+- SHA256:
+  cfcfc7a9a8ba4275c60a815c683d59ac5e7aa9362d76573b6cc4324ffb1235fa
``````




---

archive/issue_comments_388878.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nWe now support zip files I believe, so this is fine.",
    "created_at": "2018-04-29T23:32:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388878",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:2'>Comment 2:</a>
We now support zip files I believe, so this is fine.



---

archive/issue_comments_388879.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nIf we support both kinds of archive, we should probably use the smallest one.",
    "created_at": "2018-04-30T05:03:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388879",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:3'>Comment 3:</a>
If we support both kinds of archive, we should probably use the smallest one.



---

archive/issue_comments_388880.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nI don't know how or if I can add changes here, but I have fixed the doctests for the numpy+scipy upgrade [here](https://github.com/timokau/nixpkgs/blob/276be14b387f7f8f98eba05ecddeccb5ec8b8ef7/pkgs/applications/science/math/sage/patches/numpy-1.14.3.patch).\n\nIts mostly formatting. Interesting bits:\n\n- [here](https://github.com/timokau/nixpkgs/blob/276be14b387f7f8f98eba05ecddeccb5ec8b8ef7/pkgs/applications/science/math/sage/patches/numpy-1.14.3.patch#L119) I avoid a numpy deprecation warning (empty array should not be used as false) by always making sure points is a regular array and then comparing its `len`.\n- the `iprint` kwarg in `fmin_cobyla` is [deprecated](https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.optimize.fmin_cobyla.html) and repaced by `disp`\n\nEdit: I was a bit too fast and didn't test it properly. I'll post an updated version once thats tested.",
    "created_at": "2018-05-07T20:51:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388880",
    "user": "https://github.com/timokau"
}
```

<a id='comment:4'>Comment 4:</a>
I don't know how or if I can add changes here, but I have fixed the doctests for the numpy+scipy upgrade [here](https://github.com/timokau/nixpkgs/blob/276be14b387f7f8f98eba05ecddeccb5ec8b8ef7/pkgs/applications/science/math/sage/patches/numpy-1.14.3.patch).

Its mostly formatting. Interesting bits:

- [here](https://github.com/timokau/nixpkgs/blob/276be14b387f7f8f98eba05ecddeccb5ec8b8ef7/pkgs/applications/science/math/sage/patches/numpy-1.14.3.patch#L119) I avoid a numpy deprecation warning (empty array should not be used as false) by always making sure points is a regular array and then comparing its `len`.
- the `iprint` kwarg in `fmin_cobyla` is [deprecated](https://docs.scipy.org/doc/scipy-0.14.0/reference/generated/scipy.optimize.fmin_cobyla.html) and repaced by `disp`

Edit: I was a bit too fast and didn't test it properly. I'll post an updated version once thats tested.



---

archive/issue_comments_388881.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nI have [updated the patch](https://github.com/timokau/nixpkgs/blob/eeee5439e8e43bc9a6c31441440de675e16767e8/pkgs/applications/science/math/sage/patches/numpy-1.14.3.patch).\nThe doctests should pass now.",
    "created_at": "2018-05-08T19:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388881",
    "user": "https://github.com/timokau"
}
```

<a id='comment:5'>Comment 5:</a>
I have [updated the patch](https://github.com/timokau/nixpkgs/blob/eeee5439e8e43bc9a6c31441440de675e16767e8/pkgs/applications/science/math/sage/patches/numpy-1.14.3.patch).
The doctests should pass now.



---

archive/issue_comments_388882.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nChanging target from Numpy 1.14.3 to 1.14.4.",
    "created_at": "2018-06-10T10:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388882",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'>Comment 6:</a>
Changing target from Numpy 1.14.3 to 1.14.4.



---

archive/issue_comments_388883.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,12 +1,15 @@\n-NumPy 1.14.3 was released.\n+NumPy 1.14.4 was released.\n \n - [NumPy releases](https://github.com/numpy/numpy/releases)\n \n+Tarball:\n+\n+- tarball (tgz):\n+  https://github.com/numpy/numpy/releases/download/v1.14.4/numpy-1.14.4.tar.gz\n+- MD5:\n+  7de00fc3be91a3ab913d4efe206b3928\n+- SHA256:\n+  c9a83644685edf8b5383b7632daa37df115b41aa20ca6ec3139e707d88f7c903\n+\n Our last upgrade was to NumPy 1.13.3 in #24063.\n \n-- tarball (tgz):\n-  https://github.com/numpy/numpy/releases/download/v1.14.3/numpy-1.14.3.tar.gz\n-- MD5:\n-  7c3c806ae27196c92d2fb3fbd4991e81\n-- SHA256:\n-  cfcfc7a9a8ba4275c60a815c683d59ac5e7aa9362d76573b6cc4324ffb1235fa\n``````\n",
    "created_at": "2018-06-10T10:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388883",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,12 +1,15 @@
-NumPy 1.14.3 was released.
+NumPy 1.14.4 was released.
 
 - [NumPy releases](https://github.com/numpy/numpy/releases)
 
+Tarball:
+
+- tarball (tgz):
+  https://github.com/numpy/numpy/releases/download/v1.14.4/numpy-1.14.4.tar.gz
+- MD5:
+  7de00fc3be91a3ab913d4efe206b3928
+- SHA256:
+  c9a83644685edf8b5383b7632daa37df115b41aa20ca6ec3139e707d88f7c903
+
 Our last upgrade was to NumPy 1.13.3 in #24063.
 
-- tarball (tgz):
-  https://github.com/numpy/numpy/releases/download/v1.14.3/numpy-1.14.3.tar.gz
-- MD5:
-  7c3c806ae27196c92d2fb3fbd4991e81
-- SHA256:
-  cfcfc7a9a8ba4275c60a815c683d59ac5e7aa9362d76573b6cc4324ffb1235fa
``````




---

archive/issue_comments_388884.json:
```json
{
    "body": "Commit: **[3322ff1](https://github.com/sagemath/sagetrac-mirror/commit/3322ff1a1446cc5d0b8b34b6f7203250df0bdd5c)**",
    "created_at": "2018-07-08T20:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388884",
    "user": "https://github.com/timokau"
}
```

Commit: **[3322ff1](https://github.com/sagemath/sagetrac-mirror/commit/3322ff1a1446cc5d0b8b34b6f7203250df0bdd5c)**



---

archive/issue_comments_388885.json:
```json
{
    "body": "Branch: **[public/25260](https://github.com/sagemath/sagetrac-mirror/tree/public/25260)**",
    "created_at": "2018-07-08T20:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388885",
    "user": "https://github.com/timokau"
}
```

Branch: **[public/25260](https://github.com/sagemath/sagetrac-mirror/tree/public/25260)**



---

archive/issue_comments_388886.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI updated the package and applied my doctest fixes. `make ptestlong` passes.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3322ff1a1446cc5d0b8b34b6f7203250df0bdd5c\">3322ff1</a></td><td><code>Upgrade numpy to 1.14.4</code></td></tr></table>\n",
    "created_at": "2018-07-08T20:11:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388886",
    "user": "https://github.com/timokau"
}
```

<a id='comment:7'>Comment 7:</a>
I updated the package and applied my doctest fixes. `make ptestlong` passes.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3322ff1a1446cc5d0b8b34b6f7203250df0bdd5c">3322ff1</a></td><td><code>Upgrade numpy to 1.14.4</code></td></tr></table>




---

archive/issue_events_331504.json:
```json
{
    "actor": "https://github.com/timokau",
    "created_at": "2018-07-08T20:11:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331504"
}
```



---

archive/issue_events_331505.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-07-25T15:49:38Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331505"
}
```



---

archive/issue_events_331506.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-07-25T15:49:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331506"
}
```



---

archive/issue_events_331507.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-07-25T15:49:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331507"
}
```



---

archive/issue_events_331508.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-07-25T15:49:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331508"
}
```



---

archive/issue_comments_388887.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,11 @@\n-NumPy 1.14.4 was released.\n+NumPy 1.15.0 was released.\n \n - [NumPy releases](https://github.com/numpy/numpy/releases)\n \n Tarball:\n \n - tarball (tgz):\n-  https://github.com/numpy/numpy/releases/download/v1.14.4/numpy-1.14.4.tar.gz\n-- MD5:\n-  7de00fc3be91a3ab913d4efe206b3928\n-- SHA256:\n-  c9a83644685edf8b5383b7632daa37df115b41aa20ca6ec3139e707d88f7c903\n+  https://github.com/numpy/numpy/releases/download/v1.15.0/numpy-1.15.0.tar.gz\n \n Our last upgrade was to NumPy 1.13.3 in #24063.\n \n``````\n",
    "created_at": "2018-07-25T15:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388887",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,11 @@
-NumPy 1.14.4 was released.
+NumPy 1.15.0 was released.
 
 - [NumPy releases](https://github.com/numpy/numpy/releases)
 
 Tarball:
 
 - tarball (tgz):
-  https://github.com/numpy/numpy/releases/download/v1.14.4/numpy-1.14.4.tar.gz
-- MD5:
-  7de00fc3be91a3ab913d4efe206b3928
-- SHA256:
-  c9a83644685edf8b5383b7632daa37df115b41aa20ca6ec3139e707d88f7c903
+  https://github.com/numpy/numpy/releases/download/v1.15.0/numpy-1.15.0.tar.gz
 
 Our last upgrade was to NumPy 1.13.3 in #24063.
 
``````




---

archive/issue_comments_388888.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nNumpy 1.15.0 just came out.",
    "created_at": "2018-07-25T15:49:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388888",
    "user": "https://github.com/slel"
}
```

<a id='comment:8'>Comment 8:</a>
Numpy 1.15.0 just came out.



---

archive/issue_events_331509.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-07-25T15:50:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "title_is": "Upgrade to NumPy 1.15.0",
    "title_was": "Upgrade to NumPy 1.14.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331509"
}
```



---

archive/issue_comments_388889.json:
```json
{
    "body": "Dependencies: **#25755**",
    "created_at": "2018-08-04T10:03:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388889",
    "user": "https://github.com/jdemeyer"
}
```

Dependencies: **#25755**



---

archive/issue_comments_388890.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ecf870b98eda7070617b3b4516a0bb7d9695f28d\">ecf870b</a></td><td><code>Merge remote-tracking branch 'origin/develop' into u/gh-timokau/numpy-1.14.4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aede54d13c2263b551473c15e264cf32a8b971d0\">aede54d</a></td><td><code>Upgrade numpy to 1.15.0</code></td></tr></table>\n",
    "created_at": "2018-08-05T23:11:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388890",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:11'>Comment 11:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ecf870b98eda7070617b3b4516a0bb7d9695f28d">ecf870b</a></td><td><code>Merge remote-tracking branch 'origin/develop' into u/gh-timokau/numpy-1.14.4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aede54d13c2263b551473c15e264cf32a8b971d0">aede54d</a></td><td><code>Upgrade numpy to 1.15.0</code></td></tr></table>




---

archive/issue_comments_388891.json:
```json
{
    "body": "Changed commit from **[3322ff1](https://github.com/sagemath/sagetrac-mirror/commit/3322ff1a1446cc5d0b8b34b6f7203250df0bdd5c)** to **[aede54d](https://github.com/sagemath/sagetrac-mirror/commit/aede54d13c2263b551473c15e264cf32a8b971d0)**",
    "created_at": "2018-08-05T23:11:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388891",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3322ff1](https://github.com/sagemath/sagetrac-mirror/commit/3322ff1a1446cc5d0b8b34b6f7203250df0bdd5c)** to **[aede54d](https://github.com/sagemath/sagetrac-mirror/commit/aede54d13c2263b551473c15e264cf32a8b971d0)**



---

archive/issue_comments_388892.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nI've done most of the upgrade, but two failures in `src/sage/plot/histogram.py` remain. I think both are rooted in the following issue:\n\n```\n> import numpy\n> numpy.histogram([], range=(1.0,1.0))\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-05b803a2f80b> in <module>()\n----> 1 numpy.histogram([], range=(RealNumber('1.0'),RealNumber('1.0')))\n\n/home/timo/repos/sage/local/lib/python2.7/site-packages/numpy/lib/histograms.pyc in histogram(a, bins, range, normed, weights, density)\n    674     a, weights = _ravel_and_check_weights(a, weights)\n    675 \n--> 676     bin_edges, uniform_bins = _get_bin_edges(a, bins, range, weights)\n    677 \n    678     # Histogram is an integer or a float array depending on the weights.\n\n/home/timo/repos/sage/local/lib/python2.7/site-packages/numpy/lib/histograms.pyc in _get_bin_edges(a, bins, range, weights)\n    342         # shapes. To avoid this causing problems, we pick a type now and stick\n    343         # with it throughout.\n--> 344         bin_type = np.result_type(first_edge, last_edge, a)\n    345         if np.issubdtype(bin_type, np.integer):\n    346             bin_type = np.result_type(bin_type, float)\n\nTypeError: data type not understood\n```\n\nThis does not happen outside of sage. It probably has something to do with sages custom number types.",
    "created_at": "2018-08-05T23:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388892",
    "user": "https://github.com/timokau"
}
```

<a id='comment:12'>Comment 12:</a>
I've done most of the upgrade, but two failures in `src/sage/plot/histogram.py` remain. I think both are rooted in the following issue:

```
> import numpy
> numpy.histogram([], range=(1.0,1.0))

TypeError                                 Traceback (most recent call last)
<ipython-input-2-05b803a2f80b> in <module>()
----> 1 numpy.histogram([], range=(RealNumber('1.0'),RealNumber('1.0')))

/home/timo/repos/sage/local/lib/python2.7/site-packages/numpy/lib/histograms.pyc in histogram(a, bins, range, normed, weights, density)
    674     a, weights = _ravel_and_check_weights(a, weights)
    675 
--> 676     bin_edges, uniform_bins = _get_bin_edges(a, bins, range, weights)
    677 
    678     # Histogram is an integer or a float array depending on the weights.

/home/timo/repos/sage/local/lib/python2.7/site-packages/numpy/lib/histograms.pyc in _get_bin_edges(a, bins, range, weights)
    342         # shapes. To avoid this causing problems, we pick a type now and stick
    343         # with it throughout.
--> 344         bin_type = np.result_type(first_edge, last_edge, a)
    345         if np.issubdtype(bin_type, np.integer):
    346             bin_type = np.result_type(bin_type, float)

TypeError: data type not understood
```

This does not happen outside of sage. It probably has something to do with sages custom number types.



---

archive/issue_comments_388893.json:
```json
{
    "body": "Changed dependencies from **#25755** to **#25702**",
    "created_at": "2018-08-06T07:53:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388893",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#25755** to **#25702**



---

archive/issue_comments_388894.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5707a17e32da20ddb87ede66bbbd27bc2eeef38\">a5707a1</a></td><td><code>Merge in latest develop branch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b584304b315506dc891481aa95c9550be9f5f797\">b584304</a></td><td><code>Fix incorrect output in old docstring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6abfb96586477e6d96476a2a95fffa94e28f4a37\">6abfb96</a></td><td><code>fix spacing</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27a7f75a33bf2ce129c01cc9b2a287472e2b0f2e\">27a7f75</a></td><td><code>A historgram's range must be a Python float</code></td></tr></table>\n",
    "created_at": "2018-08-24T00:23:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388894",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:14'>Comment 14:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5707a17e32da20ddb87ede66bbbd27bc2eeef38">a5707a1</a></td><td><code>Merge in latest develop branch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b584304b315506dc891481aa95c9550be9f5f797">b584304</a></td><td><code>Fix incorrect output in old docstring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6abfb96586477e6d96476a2a95fffa94e28f4a37">6abfb96</a></td><td><code>fix spacing</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27a7f75a33bf2ce129c01cc9b2a287472e2b0f2e">27a7f75</a></td><td><code>A historgram's range must be a Python float</code></td></tr></table>




---

archive/issue_comments_388895.json:
```json
{
    "body": "Changed commit from **[aede54d](https://github.com/sagemath/sagetrac-mirror/commit/aede54d13c2263b551473c15e264cf32a8b971d0)** to **[27a7f75](https://github.com/sagemath/sagetrac-mirror/commit/27a7f75a33bf2ce129c01cc9b2a287472e2b0f2e)**",
    "created_at": "2018-08-24T00:23:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388895",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[aede54d](https://github.com/sagemath/sagetrac-mirror/commit/aede54d13c2263b551473c15e264cf32a8b971d0)** to **[27a7f75](https://github.com/sagemath/sagetrac-mirror/commit/27a7f75a33bf2ce129c01cc9b2a287472e2b0f2e)**



---

archive/issue_comments_388896.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nI haven't run full doctests but this fixes the issues in `histogram.py`.",
    "created_at": "2018-08-24T00:24:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388896",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:15'>Comment 15:</a>
I haven't run full doctests but this fixes the issues in `histogram.py`.



---

archive/issue_events_331510.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-08-24T00:24:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331510"
}
```



---

archive/issue_events_331511.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-08-24T00:24:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331511"
}
```



---

archive/issue_events_331512.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-24T08:41:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331512"
}
```



---

archive/issue_events_331513.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-24T08:41:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331513"
}
```



---

archive/issue_comments_388897.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nAvoid `map`, it's bad for Python 3 compatibility. Replace `map(float, options['range'])` -> `[float(x) for x in options['range']]` (which is also more readable to non-mathematicians)",
    "created_at": "2018-08-24T08:41:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388897",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'>Comment 16:</a>
Avoid `map`, it's bad for Python 3 compatibility. Replace `map(float, options['range'])` -> `[float(x) for x in options['range']]` (which is also more readable to non-mathematicians)



---

archive/issue_comments_388898.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nMixing `abs tol` and `...` is messy, it should be sufficient to use only `abs tol` here:\n\n```\n            sage: p = P[0]; p.ydata  # abs tol 1e-8\n            [0.0, 0.0, -0.211524990023434..., -0.211524990023434..., 0.244978663126864..., 0.244978663126864..., -0.149106180027477..., -0.149106180027477...]\n```",
    "created_at": "2018-08-24T08:42:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388898",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:17'>Comment 17:</a>
Mixing `abs tol` and `...` is messy, it should be sufficient to use only `abs tol` here:

```
            sage: p = P[0]; p.ydata  # abs tol 1e-8
            [0.0, 0.0, -0.211524990023434..., -0.211524990023434..., 0.244978663126864..., 0.244978663126864..., -0.149106180027477..., -0.149106180027477...]
```



---

archive/issue_comments_388899.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nNeeds rebase to 8.4.beta2.\n\nAlso don't forget your name as Author.",
    "created_at": "2018-08-26T07:31:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388899",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:18'>Comment 18:</a>
Needs rebase to 8.4.beta2.

Also don't forget your name as Author.



---

archive/issue_comments_388900.json:
```json
{
    "body": "Changed dependencies from **#25702** to none",
    "created_at": "2018-08-26T07:31:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388900",
    "user": "https://github.com/jdemeyer"
}
```

Changed dependencies from **#25702** to none



---

archive/issue_comments_388901.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nIn the meantime 1.15.1 was also released.",
    "created_at": "2018-08-28T14:14:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388901",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:19'>Comment 19:</a>
In the meantime 1.15.1 was also released.



---

archive/issue_comments_388902.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,7 @@\n-NumPy 1.15.0 was released.\n+NumPy 1.15.1 was released.\n \n - [NumPy releases](https://github.com/numpy/numpy/releases)\n \n-Tarball:\n-\n-- tarball (tgz):\n-  https://github.com/numpy/numpy/releases/download/v1.15.0/numpy-1.15.0.tar.gz\n+**Tarball**: https://files.pythonhosted.org/packages/65/ab/4dfcc20234fae12ee40c714b98077d6e3a10652496bd1488fa4828529b22/numpy-1.15.1.zip\n \n Our last upgrade was to NumPy 1.13.3 in #24063.\n-\n``````\n",
    "created_at": "2018-08-28T14:19:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388902",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,7 @@
-NumPy 1.15.0 was released.
+NumPy 1.15.1 was released.
 
 - [NumPy releases](https://github.com/numpy/numpy/releases)
 
-Tarball:
-
-- tarball (tgz):
-  https://github.com/numpy/numpy/releases/download/v1.15.0/numpy-1.15.0.tar.gz
+**Tarball**: https://files.pythonhosted.org/packages/65/ab/4dfcc20234fae12ee40c714b98077d6e3a10652496bd1488fa4828529b22/numpy-1.15.1.zip
 
 Our last upgrade was to NumPy 1.13.3 in #24063.
-
``````




---

archive/issue_events_331514.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-08-28T14:19:25Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "title_is": "Upgrade to NumPy 1.15.1",
    "title_was": "Upgrade to NumPy 1.15.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331514"
}
```



---

archive/issue_comments_388903.json:
```json
{
    "body": "Changed commit from **[27a7f75](https://github.com/sagemath/sagetrac-mirror/commit/27a7f75a33bf2ce129c01cc9b2a287472e2b0f2e)** to **[8494c36](https://github.com/sagemath/sagetrac-mirror/commit/8494c36f2f1a0cae559ca3600a93d58b90c11a06)**",
    "created_at": "2018-09-01T08:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388903",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[27a7f75](https://github.com/sagemath/sagetrac-mirror/commit/27a7f75a33bf2ce129c01cc9b2a287472e2b0f2e)** to **[8494c36](https://github.com/sagemath/sagetrac-mirror/commit/8494c36f2f1a0cae559ca3600a93d58b90c11a06)**



---

archive/issue_comments_388904.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7b54b376805f983b4f5276195ad17ce658c8efd\">d7b54b3</a></td><td><code>Merge branch 'develop' into 25260_numpy;</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8494c36f2f1a0cae559ca3600a93d58b90c11a06\">8494c36</a></td><td><code>Upgrade numpy package version to 1.15.1</code></td></tr></table>\n",
    "created_at": "2018-09-01T08:00:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388904",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:21'>Comment 21:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7b54b376805f983b4f5276195ad17ce658c8efd">d7b54b3</a></td><td><code>Merge branch 'develop' into 25260_numpy;</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8494c36f2f1a0cae559ca3600a93d58b90c11a06">8494c36</a></td><td><code>Upgrade numpy package version to 1.15.1</code></td></tr></table>




---

archive/issue_comments_388905.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nI fixed the merge conflict (in sage/plot/histogram.py due to the upgrade to matplotlib in #25702) and I bumped the version to 1.15.1. \n\nThere's one remaining failing doctest in histogram.py: #25702 added a test for the function `get_minmax_data` with the deprecated `normed` option. As of 1.15.0, numpy spits out a DeprecationWarning and I don't know the standard way to deal with this.",
    "created_at": "2018-09-01T08:11:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388905",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:22'>Comment 22:</a>
I fixed the merge conflict (in sage/plot/histogram.py due to the upgrade to matplotlib in #25702) and I bumped the version to 1.15.1. 

There's one remaining failing doctest in histogram.py: #25702 added a test for the function `get_minmax_data` with the deprecated `normed` option. As of 1.15.0, numpy spits out a DeprecationWarning and I don't know the standard way to deal with this.



---

archive/issue_comments_388906.json:
```json
{
    "body": "Author: **Timo Kaufmann, Julian R\u00fcth, Bryan Gin-ge Chen**",
    "created_at": "2018-09-01T08:11:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388906",
    "user": "https://github.com/bryangingechen"
}
```

Author: **Timo Kaufmann, Julian Rüth, Bryan Gin-ge Chen**



---

archive/issue_comments_388907.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nThanks! Can't you just switch it to use the `density` option?",
    "created_at": "2018-09-01T11:19:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388907",
    "user": "https://github.com/timokau"
}
```

<a id='comment:23'>Comment 23:</a>
Thanks! Can't you just switch it to use the `density` option?



---

archive/issue_comments_388908.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@timokau](#comment%3A23):\n> Thanks! Can't you just switch it to use the `density` option?\n\nThe point of the test seems to be to check the `normed` option; note that the first example in the docstring is essentially identical except it uses `density`.\n\nI thought about just deleting the test, but I figured I'd ask first.",
    "created_at": "2018-09-01T13:34:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388908",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@timokau](#comment%3A23):
> Thanks! Can't you just switch it to use the `density` option?

The point of the test seems to be to check the `normed` option; note that the first example in the docstring is essentially identical except it uses `density`.

I thought about just deleting the test, but I figured I'd ask first.



---

archive/issue_comments_388909.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\n`@`epalezzato since you authored #25702, why did you add that test testing the `normed` argument?",
    "created_at": "2018-09-02T21:47:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388909",
    "user": "https://github.com/timokau"
}
```

<a id='comment:25'>Comment 25:</a>
`@`epalezzato since you authored #25702, why did you add that test testing the `normed` argument?



---

archive/issue_comments_388910.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nThe new way is to use the `density` option, but Sage wants to give its users some time\nto adapt, so keeps `normed` working but with a deprecation warning.\n\nThe test should check that the deprecation warning works. Please adapt it to do that.\n\nFor examples of deprecation warnings in doctests, see:\n\nhttps://github.com/sagemath/sage/search?q=deprecationwarning\n\nAfter a year, the deprecated stuff can be removed.",
    "created_at": "2018-09-02T22:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388910",
    "user": "https://github.com/slel"
}
```

<a id='comment:26'>Comment 26:</a>
The new way is to use the `density` option, but Sage wants to give its users some time
to adapt, so keeps `normed` working but with a deprecation warning.

The test should check that the deprecation warning works. Please adapt it to do that.

For examples of deprecation warnings in doctests, see:

https://github.com/sagemath/sage/search?q=deprecationwarning

After a year, the deprecated stuff can be removed.



---

archive/issue_comments_388911.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nI ran into an annoying interaction between `rel tol` and `...` in the doctesting framework while trying to fix up the test. Reported as #26183.\n\nFor now I will try to work around it by making the test a little cruder.",
    "created_at": "2018-09-03T02:12:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388911",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:27'>Comment 27:</a>
I ran into an annoying interaction between `rel tol` and `...` in the doctesting framework while trying to fix up the test. Reported as #26183.

For now I will try to work around it by making the test a little cruder.



---

archive/issue_comments_388912.json:
```json
{
    "body": "Changed commit from **[8494c36](https://github.com/sagemath/sagetrac-mirror/commit/8494c36f2f1a0cae559ca3600a93d58b90c11a06)** to **[2d60567](https://github.com/sagemath/sagetrac-mirror/commit/2d605673654c77aa14456a040bcb22947de8bc7f)**",
    "created_at": "2018-09-03T02:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388912",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8494c36](https://github.com/sagemath/sagetrac-mirror/commit/8494c36f2f1a0cae559ca3600a93d58b90c11a06)** to **[2d60567](https://github.com/sagemath/sagetrac-mirror/commit/2d605673654c77aa14456a040bcb22947de8bc7f)**



---

archive/issue_comments_388913.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3aa09212978b1dedb5e67185648778a4fd0efbf2\">3aa0921</a></td><td><code>Merge branch 'develop' into 25260_numpy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d605673654c77aa14456a040bcb22947de8bc7f\">2d60567</a></td><td><code>Deprecate 'normed' option, fix doctest</code></td></tr></table>\n",
    "created_at": "2018-09-03T02:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388913",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:28'>Comment 28:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3aa09212978b1dedb5e67185648778a4fd0efbf2">3aa0921</a></td><td><code>Merge branch 'develop' into 25260_numpy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d605673654c77aa14456a040bcb22947de8bc7f">2d60567</a></td><td><code>Deprecate 'normed' option, fix doctest</code></td></tr></table>




---

archive/issue_events_331515.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-03T02:32:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331515"
}
```



---

archive/issue_events_331516.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-03T02:32:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331516"
}
```



---

archive/issue_events_331517.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-03T02:43:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331517"
}
```



---

archive/issue_events_331518.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-03T02:43:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331518"
}
```



---

archive/issue_comments_388914.json:
```json
{
    "body": "<a id='comment:30'>Comment 30:</a>\nOops, I haven't addressed comments 16 and 17 yet.",
    "created_at": "2018-09-03T02:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388914",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:30'>Comment 30:</a>
Oops, I haven't addressed comments 16 and 17 yet.



---

archive/issue_comments_388915.json:
```json
{
    "body": "<a id='comment:31'>Comment 31:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/164bfdc4239d849e8bbf561fa271288e56920739\">164bfdc</a></td><td><code>Reviewer comments</code></td></tr></table>\n",
    "created_at": "2018-09-03T02:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388915",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:31'>Comment 31:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/164bfdc4239d849e8bbf561fa271288e56920739">164bfdc</a></td><td><code>Reviewer comments</code></td></tr></table>




---

archive/issue_comments_388916.json:
```json
{
    "body": "Changed commit from **[2d60567](https://github.com/sagemath/sagetrac-mirror/commit/2d605673654c77aa14456a040bcb22947de8bc7f)** to **[164bfdc](https://github.com/sagemath/sagetrac-mirror/commit/164bfdc4239d849e8bbf561fa271288e56920739)**",
    "created_at": "2018-09-03T02:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388916",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2d60567](https://github.com/sagemath/sagetrac-mirror/commit/2d605673654c77aa14456a040bcb22947de8bc7f)** to **[164bfdc](https://github.com/sagemath/sagetrac-mirror/commit/164bfdc4239d849e8bbf561fa271288e56920739)**



---

archive/issue_events_331519.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-03T02:58:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331519"
}
```



---

archive/issue_events_331520.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-03T02:58:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331520"
}
```



---

archive/issue_events_331521.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-09-03T10:13:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331521"
}
```



---

archive/issue_events_331522.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-09-03T10:13:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331522"
}
```



---

archive/issue_comments_388917.json:
```json
{
    "body": "<a id='comment:33'>Comment 33:</a>\n`if options.get('range', None)` : do you mean `if 'range' in options`?",
    "created_at": "2018-09-03T10:13:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388917",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:33'>Comment 33:</a>
`if options.get('range', None)` : do you mean `if 'range' in options`?



---

archive/issue_comments_388918.json:
```json
{
    "body": "<a id='comment:34'>Comment 34:</a>\nI'm not convinced about\n\n```\n        if 'normed' in options:\n            from sage.misc.superseded import deprecation\n            deprecation(25260, \"the 'normed' option is deprecated. Use 'density' instead.\")\n```\nbecause it's essentially copying a deprecation warning that numpy already gives.",
    "created_at": "2018-09-03T10:14:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388918",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:34'>Comment 34:</a>
I'm not convinced about

```
        if 'normed' in options:
            from sage.misc.superseded import deprecation
            deprecation(25260, "the 'normed' option is deprecated. Use 'density' instead.")
```
because it's essentially copying a deprecation warning that numpy already gives.



---

archive/issue_comments_388919.json:
```json
{
    "body": "<a id='comment:35'>Comment 35:</a>\nAnd I'm also not convinced about\n\n```\n    points = list(points) # make sure points is a python list\n```\n\nWhy was that added?",
    "created_at": "2018-09-03T10:28:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388919",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:35'>Comment 35:</a>
And I'm also not convinced about

```
    points = list(points) # make sure points is a python list
```

Why was that added?



---

archive/issue_comments_388920.json:
```json
{
    "body": "<a id='comment:36'>Comment 36:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6\">1743f70</a></td><td><code>'normed' is not quite an alias for 'density'</code></td></tr></table>\n",
    "created_at": "2018-09-03T14:01:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388920",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:36'>Comment 36:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6">1743f70</a></td><td><code>'normed' is not quite an alias for 'density'</code></td></tr></table>




---

archive/issue_comments_388921.json:
```json
{
    "body": "Changed commit from **[164bfdc](https://github.com/sagemath/sagetrac-mirror/commit/164bfdc4239d849e8bbf561fa271288e56920739)** to **[1743f70](https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6)**",
    "created_at": "2018-09-03T14:01:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388921",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[164bfdc](https://github.com/sagemath/sagetrac-mirror/commit/164bfdc4239d849e8bbf561fa271288e56920739)** to **[1743f70](https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6)**



---

archive/issue_comments_388922.json:
```json
{
    "body": "<a id='comment:37'>Comment 37:</a>\nThanks for the quick feedback!\n\nReplying to [@jdemeyer](#comment%3A33):\n>if `options.get('range', None)` : do you mean `if 'range' in options`? \n\n`if 'range' in options:` does not work, since that also triggers upon passing `range=None` (which is the default).\n\nReplying to [@jdemeyer](#comment%3A34):\n> I'm not convinced about\n> \n> ```\n>         if 'normed' in options:\n>             from sage.misc.superseded import deprecation\n>             deprecation(25260, \"the 'normed' option is deprecated. Use 'density' instead.\")\n> ```\n> because it's essentially copying a deprecation warning that numpy already gives.\n\nWhat do you suggest? numpy / matplot (which do indeed also throw deprecation warnings) aren't called until either `_render_on_subplot` or `get_minmax_data` are run. I wanted to give the user a notice when they construct the initial `Histogram` object.\n\nReplying to [@jdemeyer](#comment%3A34):\n>And I'm also not convinced about\n>\n>```\n>    points = list(points) # make sure points is a python list\n>```\n>Why was that added?\n\n`points = list(points)` is necessary to properly treat the case when `points` is a generator or other non-list iterable. Note the test `line(enumerate(range(2)), marker = 'o', legend_label='a')` at line 498 which was apparently added for unrelated reasons in #13690.\n\nI made a change to a string which stated that `normed` was a deprecated alias for `density`. Strictly speaking, `normed` has different (incorrect) behavior from `density` [when constructing a histogram with non-uniform bars](https://github.com/numpy/numpy/blob/5adb81051086a45fe3b59ba506b567340ec9bd5e/numpy/lib/histograms.py#L818).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6\">1743f70</a></td><td><code>'normed' is not quite an alias for 'density'</code></td></tr></table>\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6\">1743f70</a></td><td><code>'normed' is not quite an alias for 'density'</code></td></tr></table>\n",
    "created_at": "2018-09-03T14:02:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388922",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:37'>Comment 37:</a>
Thanks for the quick feedback!

Replying to [@jdemeyer](#comment%3A33):
>if `options.get('range', None)` : do you mean `if 'range' in options`? 

`if 'range' in options:` does not work, since that also triggers upon passing `range=None` (which is the default).

Replying to [@jdemeyer](#comment%3A34):
> I'm not convinced about
> 
> ```
>         if 'normed' in options:
>             from sage.misc.superseded import deprecation
>             deprecation(25260, "the 'normed' option is deprecated. Use 'density' instead.")
> ```
> because it's essentially copying a deprecation warning that numpy already gives.

What do you suggest? numpy / matplot (which do indeed also throw deprecation warnings) aren't called until either `_render_on_subplot` or `get_minmax_data` are run. I wanted to give the user a notice when they construct the initial `Histogram` object.

Replying to [@jdemeyer](#comment%3A34):
>And I'm also not convinced about
>
>```
>    points = list(points) # make sure points is a python list
>```
>Why was that added?

`points = list(points)` is necessary to properly treat the case when `points` is a generator or other non-list iterable. Note the test `line(enumerate(range(2)), marker = 'o', legend_label='a')` at line 498 which was apparently added for unrelated reasons in #13690.

I made a change to a string which stated that `normed` was a deprecated alias for `density`. Strictly speaking, `normed` has different (incorrect) behavior from `density` [when constructing a histogram with non-uniform bars](https://github.com/numpy/numpy/blob/5adb81051086a45fe3b59ba506b567340ec9bd5e/numpy/lib/histograms.py#L818).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6">1743f70</a></td><td><code>'normed' is not quite an alias for 'density'</code></td></tr></table>

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6">1743f70</a></td><td><code>'normed' is not quite an alias for 'density'</code></td></tr></table>




---

archive/issue_comments_388923.json:
```json
{
    "body": "<a id='comment:38'>Comment 38:</a>\nReplying to [@bryangingechen](#comment%3A37):\n> Replying to [@jdemeyer](#comment%3A34):\n> > I'm not convinced about\n> > \n> > ```\n> >         if 'normed' in options:\n> >             from sage.misc.superseded import deprecation\n> >             deprecation(25260, \"the 'normed' option is deprecated. Use 'density' instead.\")\n> > ```\n> > because it's essentially copying a deprecation warning that numpy already gives.\n\n> What do you suggest? numpy / matplot (which do indeed also throw deprecation warnings) aren't called until either `_render_on_subplot` or `get_minmax_data` are run. I wanted to give the user a notice when they construct the initial `Histogram` object.\n\nI'm also in favor of throwing our own deprecation warning. That we're using numpy under the hood is an implementation detail. This way we have more control.",
    "created_at": "2018-09-06T14:30:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388923",
    "user": "https://github.com/timokau"
}
```

<a id='comment:38'>Comment 38:</a>
Replying to [@bryangingechen](#comment%3A37):
> Replying to [@jdemeyer](#comment%3A34):
> > I'm not convinced about
> > 
> > ```
> >         if 'normed' in options:
> >             from sage.misc.superseded import deprecation
> >             deprecation(25260, "the 'normed' option is deprecated. Use 'density' instead.")
> > ```
> > because it's essentially copying a deprecation warning that numpy already gives.

> What do you suggest? numpy / matplot (which do indeed also throw deprecation warnings) aren't called until either `_render_on_subplot` or `get_minmax_data` are run. I wanted to give the user a notice when they construct the initial `Histogram` object.

I'm also in favor of throwing our own deprecation warning. That we're using numpy under the hood is an implementation detail. This way we have more control.



---

archive/issue_comments_388924.json:
```json
{
    "body": "<a id='comment:39'>Comment 39:</a>\nThis is positive_review from me, pending Jeroen's judgement on the deprecation warning. Jeroen, would you mind commenting on that?",
    "created_at": "2018-09-07T15:39:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388924",
    "user": "https://github.com/timokau"
}
```

<a id='comment:39'>Comment 39:</a>
This is positive_review from me, pending Jeroen's judgement on the deprecation warning. Jeroen, would you mind commenting on that?



---

archive/issue_comments_388925.json:
```json
{
    "body": "<a id='comment:40'>Comment 40:</a>\nI don't have a strong opinion on the deprecation warning, I was mostly just commenting.\n\nHowever, `points = list(points)` is still wrong! The docs for `line2d` state\n\n```\n    -  ``points`` - either a single point (as a tuple), a list of\n       points, a single complex number, or a list of complex numbers.\n```\nIt's not at all clear to me that calling `list()` on a single point or a single complex number is the right thing to do.",
    "created_at": "2018-09-08T09:08:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388925",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:40'>Comment 40:</a>
I don't have a strong opinion on the deprecation warning, I was mostly just commenting.

However, `points = list(points)` is still wrong! The docs for `line2d` state

```
    -  ``points`` - either a single point (as a tuple), a list of
       points, a single complex number, or a list of complex numbers.
```
It's not at all clear to me that calling `list()` on a single point or a single complex number is the right thing to do.



---

archive/issue_comments_388926.json:
```json
{
    "body": "<a id='comment:41'>Comment 41:</a>\nIf it helps \"to properly treat the case when points is a generator or other non-list iterable\" (quote gh-bryangingechen) and doesn't make a difference in the case of a single point, why not?",
    "created_at": "2018-09-08T09:56:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388926",
    "user": "https://github.com/timokau"
}
```

<a id='comment:41'>Comment 41:</a>
If it helps "to properly treat the case when points is a generator or other non-list iterable" (quote gh-bryangingechen) and doesn't make a difference in the case of a single point, why not?



---

archive/issue_comments_388927.json:
```json
{
    "body": "<a id='comment:42'>Comment 42:</a>\nReplying to [@timokau](#comment%3A41):\n> doesn't make a difference in the case of a single point\n\nAre you sure about this part?",
    "created_at": "2018-09-08T13:11:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388927",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:42'>Comment 42:</a>
Replying to [@timokau](#comment%3A41):
> doesn't make a difference in the case of a single point

Are you sure about this part?



---

archive/issue_comments_388928.json:
```json
{
    "body": "<a id='comment:43'>Comment 43:</a>\nI have to admit I'm not. gh-bryangingechen, do you know more?",
    "created_at": "2018-09-08T13:50:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388928",
    "user": "https://github.com/timokau"
}
```

<a id='comment:43'>Comment 43:</a>
I have to admit I'm not. gh-bryangingechen, do you know more?



---

archive/issue_comments_388929.json:
```json
{
    "body": "<a id='comment:44'>Comment 44:</a>\nHi, thanks for pushing back on this. The code from this ticket indeed works fine with a single point (entered as a tuple, list, or a list containing a single tuple or single list, etc.). \n\nHowever, in the course of testing this, I realized that I did not completely understand the addition of `points = list(points)` in `line2d()` and my answer above to Jeroen was incorrect. Note that this line was actually added by gh-timokau [here](https://github.com/sagemath/sagetrac-mirror/blob/3322ff1a1446cc5d0b8b34b6f7203250df0bdd5c/src/sage/plot/line.py), so I should probably have deferred to him to explain it. \n\nAnyways, here's what I think now. The real reason this line was added was to properly treat `line(numpy.array([]))` (which is one of the doctests). The previous version of `line2d` used the more pythonic-looking `if not points:` to detect \"no points\". As of numpy 1.15, the truth value of `numpy.array([])` is still `False`, but it returns a DeprecationWarning that this behavior will be removed.\n\nSo to get around this, gh-timokau replaced `if not points:` with the `points = list(points)` and `if len(points) == 0`.\n\nTwo observations:\n\n- The test `if points in CC or points in CDF:` now always fails.\n\n- `xydata_from_point_list()` [already has this](https://github.com/sagemath/sage/blob/e8633b09919542a65e7e990c8369fee30c7edefd/src/sage/plot/plot.py#L777):\n\n```\nif not isinstance(points, (list, tuple)):\n    points = list(points)\n```\n\nFor the first point, I think we should just remove this test altogether, since it looks like it was originally there to catch some edge cases for `if not points:` (e.g. `points=CC(0)`). One somewhat related thing that I noticed was that symbolic complex input is not handled well: `line([1+I,I])` doesn't work but `line([CC(1+I),CC(I)])` does. Maybe this should be dealt with in another ticket for `xydata_from_point_list` though.\n\nThe second point gives me pause. Is there a cleaner way to detect both an empty list and an empty numpy array in `line2d`? I'd appreciate suggestions, as I don't see anything nice at the moment. It does seem like [dealing with empty numpy arrays](https://stackoverflow.com/a/9381545/) is a common pain point. \n\nThe current code does work so we could also just go with what we have.",
    "created_at": "2018-09-09T00:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388929",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:44'>Comment 44:</a>
Hi, thanks for pushing back on this. The code from this ticket indeed works fine with a single point (entered as a tuple, list, or a list containing a single tuple or single list, etc.). 

However, in the course of testing this, I realized that I did not completely understand the addition of `points = list(points)` in `line2d()` and my answer above to Jeroen was incorrect. Note that this line was actually added by gh-timokau [here](https://github.com/sagemath/sagetrac-mirror/blob/3322ff1a1446cc5d0b8b34b6f7203250df0bdd5c/src/sage/plot/line.py), so I should probably have deferred to him to explain it. 

Anyways, here's what I think now. The real reason this line was added was to properly treat `line(numpy.array([]))` (which is one of the doctests). The previous version of `line2d` used the more pythonic-looking `if not points:` to detect "no points". As of numpy 1.15, the truth value of `numpy.array([])` is still `False`, but it returns a DeprecationWarning that this behavior will be removed.

So to get around this, gh-timokau replaced `if not points:` with the `points = list(points)` and `if len(points) == 0`.

Two observations:

- The test `if points in CC or points in CDF:` now always fails.

- `xydata_from_point_list()` [already has this](https://github.com/sagemath/sage/blob/e8633b09919542a65e7e990c8369fee30c7edefd/src/sage/plot/plot.py#L777):

```
if not isinstance(points, (list, tuple)):
    points = list(points)
```

For the first point, I think we should just remove this test altogether, since it looks like it was originally there to catch some edge cases for `if not points:` (e.g. `points=CC(0)`). One somewhat related thing that I noticed was that symbolic complex input is not handled well: `line([1+I,I])` doesn't work but `line([CC(1+I),CC(I)])` does. Maybe this should be dealt with in another ticket for `xydata_from_point_list` though.

The second point gives me pause. Is there a cleaner way to detect both an empty list and an empty numpy array in `line2d`? I'd appreciate suggestions, as I don't see anything nice at the moment. It does seem like [dealing with empty numpy arrays](https://stackoverflow.com/a/9381545/) is a common pain point. 

The current code does work so we could also just go with what we have.



---

archive/issue_comments_388930.json:
```json
{
    "body": "<a id='comment:45'>Comment 45:</a>\nOh I forgot I added that, thanks for investigating :)\n\nI think `if not <something that is not a bool>` is an antipattern anyways, even if it still worked. If we don't want to change `points` to a list permanently, maybe we could just do `if len(list(points)) == 0` instead.",
    "created_at": "2018-09-09T20:54:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388930",
    "user": "https://github.com/timokau"
}
```

<a id='comment:45'>Comment 45:</a>
Oh I forgot I added that, thanks for investigating :)

I think `if not <something that is not a bool>` is an antipattern anyways, even if it still worked. If we don't want to change `points` to a list permanently, maybe we could just do `if len(list(points)) == 0` instead.



---

archive/issue_comments_388931.json:
```json
{
    "body": "<a id='comment:46'>Comment 46:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99512a8d5081a009e010cb18b926c469102e2244\">99512a8</a></td><td><code>Remove obsolete check for CC or CDF in line2d()</code></td></tr></table>\n",
    "created_at": "2018-09-10T20:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388931",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:46'>Comment 46:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99512a8d5081a009e010cb18b926c469102e2244">99512a8</a></td><td><code>Remove obsolete check for CC or CDF in line2d()</code></td></tr></table>




---

archive/issue_comments_388932.json:
```json
{
    "body": "Changed commit from **[1743f70](https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6)** to **[99512a8](https://github.com/sagemath/sagetrac-mirror/commit/99512a8d5081a009e010cb18b926c469102e2244)**",
    "created_at": "2018-09-10T20:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388932",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1743f70](https://github.com/sagemath/sagetrac-mirror/commit/1743f709cfb55db4fd6bc14c71406fdcc74354e6)** to **[99512a8](https://github.com/sagemath/sagetrac-mirror/commit/99512a8d5081a009e010cb18b926c469102e2244)**



---

archive/issue_comments_388933.json:
```json
{
    "body": "<a id='comment:47'>Comment 47:</a>\nUnfortunately, `if len(list(points)) == 0` breaks the `line(enumerate(range(2)), marker = 'o', legend_label='a')` test, since after spitting out all the values once, future calls to `list(points)` just return `[]`.\n\nThe commit I've just pushed simply removes the dead code and leaves `points = list(points)` and `if len(points) == 0:` alone. Since this does work and no better alternatives are coming to mind, I propose we just go with this.",
    "created_at": "2018-09-10T21:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388933",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:47'>Comment 47:</a>
Unfortunately, `if len(list(points)) == 0` breaks the `line(enumerate(range(2)), marker = 'o', legend_label='a')` test, since after spitting out all the values once, future calls to `list(points)` just return `[]`.

The commit I've just pushed simply removes the dead code and leaves `points = list(points)` and `if len(points) == 0:` alone. Since this does work and no better alternatives are coming to mind, I propose we just go with this.



---

archive/issue_events_331523.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-10T21:04:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331523"
}
```



---

archive/issue_events_331524.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-10T21:04:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331524"
}
```



---

archive/issue_comments_388934.json:
```json
{
    "body": "<a id='comment:49'>Comment 49:</a>\nAh right. I now remember that I had the same problem.\n\n> Since this does work and no better alternatives are coming to mind, I propose we just go with this. \n\n+1 from me. Jeroen?",
    "created_at": "2018-09-10T21:14:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388934",
    "user": "https://github.com/timokau"
}
```

<a id='comment:49'>Comment 49:</a>
Ah right. I now remember that I had the same problem.

> Since this does work and no better alternatives are coming to mind, I propose we just go with this. 

+1 from me. Jeroen?



---

archive/issue_comments_388935.json:
```json
{
    "body": "<a id='comment:50'>Comment 50:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f8dc1d1712617fa6de3dc792bb701fe59b804987\">f8dc1d1</a></td><td><code>Merge branch 'develop' into 25260_numpy</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45fb0bd5fd9e25ad46102d9428566b6455ca4d33\">45fb0bd</a></td><td><code>Upgrade numpy to v1.15.2</code></td></tr></table>\n",
    "created_at": "2018-09-23T17:34:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388935",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:50'>Comment 50:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f8dc1d1712617fa6de3dc792bb701fe59b804987">f8dc1d1</a></td><td><code>Merge branch 'develop' into 25260_numpy</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45fb0bd5fd9e25ad46102d9428566b6455ca4d33">45fb0bd</a></td><td><code>Upgrade numpy to v1.15.2</code></td></tr></table>




---

archive/issue_comments_388936.json:
```json
{
    "body": "Changed commit from **[99512a8](https://github.com/sagemath/sagetrac-mirror/commit/99512a8d5081a009e010cb18b926c469102e2244)** to **[45fb0bd](https://github.com/sagemath/sagetrac-mirror/commit/45fb0bd5fd9e25ad46102d9428566b6455ca4d33)**",
    "created_at": "2018-09-23T17:34:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388936",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[99512a8](https://github.com/sagemath/sagetrac-mirror/commit/99512a8d5081a009e010cb18b926c469102e2244)** to **[45fb0bd](https://github.com/sagemath/sagetrac-mirror/commit/45fb0bd5fd9e25ad46102d9428566b6455ca4d33)**



---

archive/issue_comments_388937.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n-NumPy 1.15.1 was released.\n+NumPy 1.15.2 was released.\n \n - [NumPy releases](https://github.com/numpy/numpy/releases)\n \n-**Tarball**: https://files.pythonhosted.org/packages/65/ab/4dfcc20234fae12ee40c714b98077d6e3a10652496bd1488fa4828529b22/numpy-1.15.1.zip\n+**Tarball**: https://github.com/numpy/numpy/archive/v1.15.2.tar.gz\n \n Our last upgrade was to NumPy 1.13.3 in #24063.\n``````\n",
    "created_at": "2018-09-23T17:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388937",
    "user": "https://github.com/bryangingechen"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
-NumPy 1.15.1 was released.
+NumPy 1.15.2 was released.
 
 - [NumPy releases](https://github.com/numpy/numpy/releases)
 
-**Tarball**: https://files.pythonhosted.org/packages/65/ab/4dfcc20234fae12ee40c714b98077d6e3a10652496bd1488fa4828529b22/numpy-1.15.1.zip
+**Tarball**: https://github.com/numpy/numpy/archive/v1.15.2.tar.gz
 
 Our last upgrade was to NumPy 1.13.3 in #24063.
``````




---

archive/issue_comments_388938.json:
```json
{
    "body": "<a id='comment:51'>Comment 51:</a>\nI've changed the target to 1.15.2, as that's just been released. Does anyone understand the numpy patches we have? They seem not to apply to this version and the build currently fails: \n\n```\n[numpy-1.15.2] Found local metadata for numpy-1.15.2\n[numpy-1.15.2] Using cached file /Applications/SageMath/upstream/numpy-1.15.2.tar.gz\n[numpy-1.15.2] numpy-1.15.2\n[numpy-1.15.2] ====================================================\n[numpy-1.15.2] Setting up build directory for numpy-1.15.2\n[numpy-1.15.2] Finished extraction\n[numpy-1.15.2] Applying patches from ../patches...\n[numpy-1.15.2] Applying ../patches/fix-numpy-1.13.3-for-python3.7.patch\n[numpy-1.15.2] patching file setup.py\n[numpy-1.15.2] Hunk #1 succeeded at 381 (offset 11 lines).\n[numpy-1.15.2] The next patch would create the file tools/cythonize.py,\n[numpy-1.15.2] which already exists!  Assume -R? [n]\n[numpy-1.15.2] Apply anyway? [n]\n[numpy-1.15.2] Skipping patch.\n[numpy-1.15.2] 1 out of 1 hunk ignored\n[numpy-1.15.2] Error applying '../patches/fix-numpy-1.13.3-for-python3.7.patch'\n[numpy-1.15.2] ************************************************************************\n[numpy-1.15.2] Error applying patches\n[numpy-1.15.2] ************************************************************************\n[numpy-1.15.2] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[numpy-1.15.2] explaining the problem and including the log file\n[numpy-1.15.2]   /Applications/SageMath/logs/pkgs/numpy-1.15.2.log\n[numpy-1.15.2] Describe your computer, operating system, etc.\n[numpy-1.15.2] ************************************************************************\nmake[3]: *** [/Applications/SageMath/local/var/lib/sage/installed/numpy-1.15.2] Error 1\nmake[2]: *** [all-build] Error 2\n```\n\nI have no experience with patching so if someone wants fix this themselves rather than explain to me how to do it they're also welcome to do so.",
    "created_at": "2018-09-23T17:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388938",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:51'>Comment 51:</a>
I've changed the target to 1.15.2, as that's just been released. Does anyone understand the numpy patches we have? They seem not to apply to this version and the build currently fails: 

```
[numpy-1.15.2] Found local metadata for numpy-1.15.2
[numpy-1.15.2] Using cached file /Applications/SageMath/upstream/numpy-1.15.2.tar.gz
[numpy-1.15.2] numpy-1.15.2
[numpy-1.15.2] ====================================================
[numpy-1.15.2] Setting up build directory for numpy-1.15.2
[numpy-1.15.2] Finished extraction
[numpy-1.15.2] Applying patches from ../patches...
[numpy-1.15.2] Applying ../patches/fix-numpy-1.13.3-for-python3.7.patch
[numpy-1.15.2] patching file setup.py
[numpy-1.15.2] Hunk #1 succeeded at 381 (offset 11 lines).
[numpy-1.15.2] The next patch would create the file tools/cythonize.py,
[numpy-1.15.2] which already exists!  Assume -R? [n]
[numpy-1.15.2] Apply anyway? [n]
[numpy-1.15.2] Skipping patch.
[numpy-1.15.2] 1 out of 1 hunk ignored
[numpy-1.15.2] Error applying '../patches/fix-numpy-1.13.3-for-python3.7.patch'
[numpy-1.15.2] ************************************************************************
[numpy-1.15.2] Error applying patches
[numpy-1.15.2] ************************************************************************
[numpy-1.15.2] Please email sage-devel (http://groups.google.com/group/sage-devel)
[numpy-1.15.2] explaining the problem and including the log file
[numpy-1.15.2]   /Applications/SageMath/logs/pkgs/numpy-1.15.2.log
[numpy-1.15.2] Describe your computer, operating system, etc.
[numpy-1.15.2] ************************************************************************
make[3]: *** [/Applications/SageMath/local/var/lib/sage/installed/numpy-1.15.2] Error 1
make[2]: *** [all-build] Error 2
```

I have no experience with patching so if someone wants fix this themselves rather than explain to me how to do it they're also welcome to do so.



---

archive/issue_events_331525.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-23T17:41:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331525"
}
```



---

archive/issue_events_331526.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-23T17:41:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331526"
}
```



---

archive/issue_events_331527.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-23T17:41:49Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "title_is": "Upgrade to NumPy 1.15.2",
    "title_was": "Upgrade to NumPy 1.15.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331527"
}
```



---

archive/issue_comments_388939.json:
```json
{
    "body": "<a id='comment:52'>Comment 52:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/839e504978764dcd8062ac40ecc811c5c1013d2d\">839e504</a></td><td><code>#25260 remove fix-numpy-1.13.3-for-python3.7.patch</code></td></tr></table>\n",
    "created_at": "2018-09-23T21:45:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388939",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:52'>Comment 52:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/839e504978764dcd8062ac40ecc811c5c1013d2d">839e504</a></td><td><code>#25260 remove fix-numpy-1.13.3-for-python3.7.patch</code></td></tr></table>




---

archive/issue_comments_388940.json:
```json
{
    "body": "Changed commit from **[45fb0bd](https://github.com/sagemath/sagetrac-mirror/commit/45fb0bd5fd9e25ad46102d9428566b6455ca4d33)** to **[839e504](https://github.com/sagemath/sagetrac-mirror/commit/839e504978764dcd8062ac40ecc811c5c1013d2d)**",
    "created_at": "2018-09-23T21:45:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388940",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[45fb0bd](https://github.com/sagemath/sagetrac-mirror/commit/45fb0bd5fd9e25ad46102d9428566b6455ca4d33)** to **[839e504](https://github.com/sagemath/sagetrac-mirror/commit/839e504978764dcd8062ac40ecc811c5c1013d2d)**



---

archive/issue_comments_388941.json:
```json
{
    "body": "<a id='comment:53'>Comment 53:</a>\nReplying to [@bryangingechen](#comment%3A51):\n> I have no experience with patching so if someone wants fix this themselves rather than explain to me how to do it they're also welcome to do so.\n\nA you can see in the first line of `$SAGE_ROOT/build/pkgs/numpy/patches/fix-numpy-1.13.3-for-python3.7.patch`, there is a link to https://github.com/numpy/numpy/issues/10500 which is now fixed (the patch or a similar one was applied upstream), so it sufice to remove that patch. I just did that and recompiled numpy and scipy, but did not run all doctests.",
    "created_at": "2018-09-23T21:51:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388941",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:53'>Comment 53:</a>
Replying to [@bryangingechen](#comment%3A51):
> I have no experience with patching so if someone wants fix this themselves rather than explain to me how to do it they're also welcome to do so.

A you can see in the first line of `$SAGE_ROOT/build/pkgs/numpy/patches/fix-numpy-1.13.3-for-python3.7.patch`, there is a link to https://github.com/numpy/numpy/issues/10500 which is now fixed (the patch or a similar one was applied upstream), so it sufice to remove that patch. I just did that and recompiled numpy and scipy, but did not run all doctests.



---

archive/issue_comments_388942.json:
```json
{
    "body": "<a id='comment:54'>Comment 54:</a>\nBy the way, both scipy and numpy offer self-tests using pytest), so we should add some `spkg-check` for them (not in that ticket).",
    "created_at": "2018-09-23T22:06:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388942",
    "user": "https://github.com/sagetrac-tmonteil"
}
```

<a id='comment:54'>Comment 54:</a>
By the way, both scipy and numpy offer self-tests using pytest), so we should add some `spkg-check` for them (not in that ticket).



---

archive/issue_comments_388943.json:
```json
{
    "body": "<a id='comment:55'>Comment 55:</a>\nThanks! For what it's worth, after your patch, all the tests seem to pass for me.",
    "created_at": "2018-09-24T00:55:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388943",
    "user": "https://github.com/bryangingechen"
}
```

<a id='comment:55'>Comment 55:</a>
Thanks! For what it's worth, after your patch, all the tests seem to pass for me.



---

archive/issue_events_331528.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-24T00:55:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331528"
}
```



---

archive/issue_events_331529.json:
```json
{
    "actor": "https://github.com/bryangingechen",
    "created_at": "2018-09-24T00:55:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331529"
}
```



---

archive/issue_events_331530.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-25T01:41:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331530"
}
```



---

archive/issue_events_331531.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-09-25T01:41:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331531"
}
```



---

archive/issue_comments_388944.json:
```json
{
    "body": "<a id='comment:56'>Comment 56:</a>\nThey also pass for me. So I am setting this to a positive review.",
    "created_at": "2018-09-25T01:41:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388944",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:56'>Comment 56:</a>
They also pass for me. So I am setting this to a positive review.



---

archive/issue_comments_388945.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2018-09-25T01:41:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388945",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_388946.json:
```json
{
    "body": "<a id='comment:57'>Comment 57:</a>\nThis fails on kucalc (48-core linux 64-bit):\n\n```\n**********************************************************************\nFile \"src/sage/misc/inline_fortran.py\", line 134, in sage.misc.inline_fortran._import_module_from_path._import_module_from_path_impl\nFailed example:\n    fortran(code, globals())\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 659, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1070, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.inline_fortran._import_module_from_path._import_module_from_path_impl[1]>\", line 1, in <module>\n        fortran(code, globals())\n      File \"sage/misc/lazy_import.pyx\", line 354, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3759)\n        return self.get_object()(*args, **kwds)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/inline_fortran.py\", line 96, in __call__\n        return self.eval(*args, **kwds)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/inline_fortran.py\", line 200, in eval\n        log_string)\n    RuntimeError: failed to compile Fortran code:\n    Traceback (most recent call last):\n      File \"<string>\", line 1, in <module>\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/f2py/f2py2e.py\", line 648, in main\n        run_compile()\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/f2py/f2py2e.py\", line 633, in run_compile\n        setup(ext_modules=[ext])\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/core.py\", line 169, in setup\n        return old_setup(**new_attr)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/core.py\", line 151, in setup\n        dist.run_commands()\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/dist.py\", line 953, in run_commands\n        self.run_command(cmd)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/dist.py\", line 972, in run_command\n        cmd_obj.run()\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/command/build.py\", line 47, in run\n        old_build.run(self)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/command/build.py\", line 127, in run\n        self.run_command(cmd_name)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/cmd.py\", line 326, in run_command\n        self.distribution.run_command(command)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/dist.py\", line 972, in run_command\n        cmd_obj.run()\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/command/build_ext.py\", line 262, in run\n        self.build_extensions()\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/command/build_ext.py\", line 449, in build_extensions\n        self.build_extension(ext)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/command/build_ext.py\", line 380, in build_extension\n        **kws)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/ccompiler.py\", line 337, in CCompiler_compile\n        pool = multiprocessing.pool.ThreadPool(jobs)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/multiprocessing/pool.py\", line 732, in __init__\n        Pool.__init__(self, processes, initializer, initargs)\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/multiprocessing/pool.py\", line 187, in __init__\n        self._result_handler.start()\n      File \"/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/threading.py\", line 736, in start\n        _start_new_thread(self.__bootstrap, ())\n    thread.error: can't start new thread\n```\nSomething is wrong on high-cpu count machines, I think. Works on others.",
    "created_at": "2018-09-26T22:49:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388946",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:57'>Comment 57:</a>
This fails on kucalc (48-core linux 64-bit):

```
**********************************************************************
File "src/sage/misc/inline_fortran.py", line 134, in sage.misc.inline_fortran._import_module_from_path._import_module_from_path_impl
Failed example:
    fortran(code, globals())
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 659, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1070, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.inline_fortran._import_module_from_path._import_module_from_path_impl[1]>", line 1, in <module>
        fortran(code, globals())
      File "sage/misc/lazy_import.pyx", line 354, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3759)
        return self.get_object()(*args, **kwds)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/inline_fortran.py", line 96, in __call__
        return self.eval(*args, **kwds)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/sage/misc/inline_fortran.py", line 200, in eval
        log_string)
    RuntimeError: failed to compile Fortran code:
    Traceback (most recent call last):
      File "<string>", line 1, in <module>
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/f2py/f2py2e.py", line 648, in main
        run_compile()
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/f2py/f2py2e.py", line 633, in run_compile
        setup(ext_modules=[ext])
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/core.py", line 169, in setup
        return old_setup(**new_attr)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/core.py", line 151, in setup
        dist.run_commands()
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/dist.py", line 953, in run_commands
        self.run_command(cmd)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/dist.py", line 972, in run_command
        cmd_obj.run()
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/command/build.py", line 47, in run
        old_build.run(self)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/command/build.py", line 127, in run
        self.run_command(cmd_name)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/cmd.py", line 326, in run_command
        self.distribution.run_command(command)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/dist.py", line 972, in run_command
        cmd_obj.run()
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/command/build_ext.py", line 262, in run
        self.build_extensions()
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/distutils/command/build_ext.py", line 449, in build_extensions
        self.build_extension(ext)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/command/build_ext.py", line 380, in build_extension
        **kws)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/distutils/ccompiler.py", line 337, in CCompiler_compile
        pool = multiprocessing.pool.ThreadPool(jobs)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/multiprocessing/pool.py", line 732, in __init__
        Pool.__init__(self, processes, initializer, initargs)
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/multiprocessing/pool.py", line 187, in __init__
        self._result_handler.start()
      File "/var/lib/buildbot/slave/sage_git/build/local/lib/python2.7/threading.py", line 736, in start
        _start_new_thread(self.__bootstrap, ())
    thread.error: can't start new thread
```
Something is wrong on high-cpu count machines, I think. Works on others.



---

archive/issue_events_331532.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-26T22:49:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331532"
}
```



---

archive/issue_events_331533.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-26T22:49:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331533"
}
```



---

archive/issue_comments_388947.json:
```json
{
    "body": "<a id='comment:59'>Comment 59:</a>\nAny ideas how we could debug this? k8s has 48 cores so we could try to debug this there.\n\nI'll probably start by building there and running just the tests in `inline_fortran.py`. Maybe that's already enough to trigger the error.",
    "created_at": "2018-10-04T18:38:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388947",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:59'>Comment 59:</a>
Any ideas how we could debug this? k8s has 48 cores so we could try to debug this there.

I'll probably start by building there and running just the tests in `inline_fortran.py`. Maybe that's already enough to trigger the error.



---

archive/issue_comments_388948.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,6 @@\n \n - [NumPy releases](https://github.com/numpy/numpy/releases)\n \n-**Tarball**: https://github.com/numpy/numpy/archive/v1.15.2.tar.gz\n+**Tarball**: https://files.pythonhosted.org/packages/45/ba/2a781ebbb0cd7962cc1d12a6b65bd4eff57ffda449fdbbae4726dc05fbc3/numpy-1.15.2.zip\n \n Our last upgrade was to NumPy 1.13.3 in #24063.\n``````\n",
    "created_at": "2018-10-05T05:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388948",
    "user": "https://github.com/jdemeyer"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,6 @@
 
 - [NumPy releases](https://github.com/numpy/numpy/releases)
 
-**Tarball**: https://github.com/numpy/numpy/archive/v1.15.2.tar.gz
+**Tarball**: https://files.pythonhosted.org/packages/45/ba/2a781ebbb0cd7962cc1d12a6b65bd4eff57ffda449fdbbae4726dc05fbc3/numpy-1.15.2.zip
 
 Our last upgrade was to NumPy 1.13.3 in #24063.
``````




---

archive/issue_comments_388949.json:
```json
{
    "body": "<a id='comment:60'>Comment 60:</a>\nFor Python packages, the sources on PyPI should always be considered the official sources (unless the project specifically points to GitHub for their sources, which is not the case here).",
    "created_at": "2018-10-05T05:30:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388949",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:60'>Comment 60:</a>
For Python packages, the sources on PyPI should always be considered the official sources (unless the project specifically points to GitHub for their sources, which is not the case here).



---

archive/issue_comments_388950.json:
```json
{
    "body": "Changed commit from **[839e504](https://github.com/sagemath/sagetrac-mirror/commit/839e504978764dcd8062ac40ecc811c5c1013d2d)** to **[78057db](https://github.com/sagemath/sagetrac-mirror/commit/78057db66f6ecaf6c44b98b3ed682aae480d07e9)**",
    "created_at": "2018-10-05T05:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388950",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[839e504](https://github.com/sagemath/sagetrac-mirror/commit/839e504978764dcd8062ac40ecc811c5c1013d2d)** to **[78057db](https://github.com/sagemath/sagetrac-mirror/commit/78057db66f6ecaf6c44b98b3ed682aae480d07e9)**



---

archive/issue_comments_388951.json:
```json
{
    "body": "<a id='comment:61'>Comment 61:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78057db66f6ecaf6c44b98b3ed682aae480d07e9\">78057db</a></td><td><code>Upgrade numpy to v1.15.2</code></td></tr></table>\n",
    "created_at": "2018-10-05T05:37:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388951",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:61'>Comment 61:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78057db66f6ecaf6c44b98b3ed682aae480d07e9">78057db</a></td><td><code>Upgrade numpy to v1.15.2</code></td></tr></table>




---

archive/issue_comments_388952.json:
```json
{
    "body": "<a id='comment:62'>Comment 62:</a>\nI'm getting a timeout instead on that test:\n\n```\nDoctesting 1 file using 8 threads.\nsage -t --long src/sage/misc/inline_fortran.py\n    Timed out\n**********************************************************************\nTests run before process (pid=16924) timed out:\nsage: from sage.misc.inline_fortran import _import_module_from_path ## line 27 ##\nsage: modname = '___test__import_module_from_path' ## line 28 ##\nsage: tmpdir = tmp_dir() ## line 29 ##\nsage: filename = os.path.join(tmpdir, modname + '.py') ## line 30 ##\nsage: with open(filename, 'w') as fobj:\n    _ = fobj.write('foo = \"bar\"') ## line 31 ##\nsage: mod = _import_module_from_path(modname) ## line 33 ##\nsage: mod = _import_module_from_path('DoEsNoTeXiSt', path=[tmpdir]) ## line 37 ##\nsage: mod = _import_module_from_path(modname, path=[tmpdir]) ## line 41 ##\nsage: mod.foo ## line 42 ##   \n'bar'\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 44 ##\n0\nsage: code = '''\nC FILE: FIB1.F\n      SUBROUTINE FIB(A,N)\nC\nC     CALCULATE FIRST N FIBONACCI NUMBERS\nC\n      INTEGER N\n      REAL*8 A(N)\n      DO I=1,N\n         IF (I.EQ.1) THEN\n            A(I) = 0.0D0\n         ELSEIF (I.EQ.2) THEN \n            A(I) = 1.0D0\n         ELSE\n            A(I) = A(I-1) + A(I-2)\n         ENDIF\n      ENDDO\n      END\nC END FILE FIB1.F\n''' ## line 114 ##\nsage: fortran(code, globals()) ## line 134 ##\n------------------------------------------------------------------------\n/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x851c)[0x3fff7ea0851c]\n/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8638)[0x3fff7ea08638]\n/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0xd370)[0x3fff7ea0d370]\n[0x3fff7ffa04d8]\n/lib/powerpc64le-linux-gnu/libc.so.6(__read+0x58)[0x3fff7fc0e02c]\n[0x3fffd1c122b0]\n/lib/powerpc64le-linux-gnu/libc.so.6(_IO_file_read+0x64)[0x3fff7fb88674]\n/lib/powerpc64le-linux-gnu/libc.so.6(+0x8839c)[0x3fff7fb8839c]\n/lib/powerpc64le-linux-gnu/libc.so.6(_IO_sgetn+0x28)[0x3fff7fb8bac8]\n/lib/powerpc64le-linux-gnu/libc.so.6(fread+0xb4)[0x3fff7fb78a84]\n/home/jdemeyer/sage-git/local/lib/libpython2.7.so.1.0(Py_UniversalNewlineFread+0x1e8)[0x3fff7fdc2668]\n[...]\n----------------------------------------------------------------------\nsage -t --long src/sage/misc/inline_fortran.py  # Timed out\n----------------------------------------------------------------------\nTotal time for all tests: 1800.1 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```",
    "created_at": "2018-10-05T07:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388952",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:62'>Comment 62:</a>
I'm getting a timeout instead on that test:

```
Doctesting 1 file using 8 threads.
sage -t --long src/sage/misc/inline_fortran.py
    Timed out
**********************************************************************
Tests run before process (pid=16924) timed out:
sage: from sage.misc.inline_fortran import _import_module_from_path ## line 27 ##
sage: modname = '___test__import_module_from_path' ## line 28 ##
sage: tmpdir = tmp_dir() ## line 29 ##
sage: filename = os.path.join(tmpdir, modname + '.py') ## line 30 ##
sage: with open(filename, 'w') as fobj:
    _ = fobj.write('foo = "bar"') ## line 31 ##
sage: mod = _import_module_from_path(modname) ## line 33 ##
sage: mod = _import_module_from_path('DoEsNoTeXiSt', path=[tmpdir]) ## line 37 ##
sage: mod = _import_module_from_path(modname, path=[tmpdir]) ## line 41 ##
sage: mod.foo ## line 42 ##   
'bar'
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 44 ##
0
sage: code = '''
C FILE: FIB1.F
      SUBROUTINE FIB(A,N)
C
C     CALCULATE FIRST N FIBONACCI NUMBERS
C
      INTEGER N
      REAL*8 A(N)
      DO I=1,N
         IF (I.EQ.1) THEN
            A(I) = 0.0D0
         ELSEIF (I.EQ.2) THEN 
            A(I) = 1.0D0
         ELSE
            A(I) = A(I-1) + A(I-2)
         ENDIF
      ENDDO
      END
C END FILE FIB1.F
''' ## line 114 ##
sage: fortran(code, globals()) ## line 134 ##
------------------------------------------------------------------------
/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x851c)[0x3fff7ea0851c]
/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0x8638)[0x3fff7ea08638]
/home/jdemeyer/sage-git/local/lib/python2.7/site-packages/cysignals/signals.so(+0xd370)[0x3fff7ea0d370]
[0x3fff7ffa04d8]
/lib/powerpc64le-linux-gnu/libc.so.6(__read+0x58)[0x3fff7fc0e02c]
[0x3fffd1c122b0]
/lib/powerpc64le-linux-gnu/libc.so.6(_IO_file_read+0x64)[0x3fff7fb88674]
/lib/powerpc64le-linux-gnu/libc.so.6(+0x8839c)[0x3fff7fb8839c]
/lib/powerpc64le-linux-gnu/libc.so.6(_IO_sgetn+0x28)[0x3fff7fb8bac8]
/lib/powerpc64le-linux-gnu/libc.so.6(fread+0xb4)[0x3fff7fb78a84]
/home/jdemeyer/sage-git/local/lib/libpython2.7.so.1.0(Py_UniversalNewlineFread+0x1e8)[0x3fff7fdc2668]
[...]
----------------------------------------------------------------------
sage -t --long src/sage/misc/inline_fortran.py  # Timed out
----------------------------------------------------------------------
Total time for all tests: 1800.1 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```



---

archive/issue_comments_388953.json:
```json
{
    "body": "<a id='comment:63'>Comment 63:</a>\nRunning this under `strace` shows indeed that `f2py` is creating a huge number of threads which at some points leads to out-of-memory problems. For some reason, this is causing a hang for me instead of an exception.",
    "created_at": "2018-10-05T08:18:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388953",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:63'>Comment 63:</a>
Running this under `strace` shows indeed that `f2py` is creating a huge number of threads which at some points leads to out-of-memory problems. For some reason, this is causing a hang for me instead of an exception.



---

archive/issue_comments_388954.json:
```json
{
    "body": "<a id='comment:64'>Comment 64:</a>\nI reported the thread issue upstream: https://github.com/numpy/numpy/issues/12087",
    "created_at": "2018-10-05T09:18:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388954",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:64'>Comment 64:</a>
I reported the thread issue upstream: https://github.com/numpy/numpy/issues/12087



---

archive/issue_comments_388955.json:
```json
{
    "body": "<a id='comment:65'>Comment 65:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40f43182129eb1d593cfa68e438515fca5499e95\">40f4318</a></td><td><code>Use just 1 thread for compiling to prevent bombing the system</code></td></tr></table>\n",
    "created_at": "2018-10-05T09:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388955",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:65'>Comment 65:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40f43182129eb1d593cfa68e438515fca5499e95">40f4318</a></td><td><code>Use just 1 thread for compiling to prevent bombing the system</code></td></tr></table>




---

archive/issue_comments_388956.json:
```json
{
    "body": "Changed commit from **[78057db](https://github.com/sagemath/sagetrac-mirror/commit/78057db66f6ecaf6c44b98b3ed682aae480d07e9)** to **[40f4318](https://github.com/sagemath/sagetrac-mirror/commit/40f43182129eb1d593cfa68e438515fca5499e95)**",
    "created_at": "2018-10-05T09:30:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388956",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[78057db](https://github.com/sagemath/sagetrac-mirror/commit/78057db66f6ecaf6c44b98b3ed682aae480d07e9)** to **[40f4318](https://github.com/sagemath/sagetrac-mirror/commit/40f43182129eb1d593cfa68e438515fca5499e95)**



---

archive/issue_comments_388957.json:
```json
{
    "body": "Changed commit from **[40f4318](https://github.com/sagemath/sagetrac-mirror/commit/40f43182129eb1d593cfa68e438515fca5499e95)** to **[3508a05](https://github.com/sagemath/sagetrac-mirror/commit/3508a0515bd49f08d2fbc58953a8075dcc25c8c4)**",
    "created_at": "2018-10-05T09:47:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388957",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[40f4318](https://github.com/sagemath/sagetrac-mirror/commit/40f43182129eb1d593cfa68e438515fca5499e95)** to **[3508a05](https://github.com/sagemath/sagetrac-mirror/commit/3508a0515bd49f08d2fbc58953a8075dcc25c8c4)**



---

archive/issue_comments_388958.json:
```json
{
    "body": "<a id='comment:66'>Comment 66:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3508a0515bd49f08d2fbc58953a8075dcc25c8c4\">3508a05</a></td><td><code>Limit number of threads to prevent bombing the system</code></td></tr></table>\n",
    "created_at": "2018-10-05T09:47:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388958",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:66'>Comment 66:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3508a0515bd49f08d2fbc58953a8075dcc25c8c4">3508a05</a></td><td><code>Limit number of threads to prevent bombing the system</code></td></tr></table>




---

archive/issue_comments_388959.json:
```json
{
    "body": "Changed commit from **[3508a05](https://github.com/sagemath/sagetrac-mirror/commit/3508a0515bd49f08d2fbc58953a8075dcc25c8c4)** to **[b151634](https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f)**",
    "created_at": "2018-10-05T10:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388959",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[3508a05](https://github.com/sagemath/sagetrac-mirror/commit/3508a0515bd49f08d2fbc58953a8075dcc25c8c4)** to **[b151634](https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f)**



---

archive/issue_comments_388960.json:
```json
{
    "body": "<a id='comment:67'>Comment 67:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f\">b151634</a></td><td><code>Limit number of threads to prevent bombing the system</code></td></tr></table>\n",
    "created_at": "2018-10-05T10:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388960",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:67'>Comment 67:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f">b151634</a></td><td><code>Limit number of threads to prevent bombing the system</code></td></tr></table>




---

archive/issue_events_331534.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-10-05T10:15:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331534"
}
```



---

archive/issue_events_331535.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-10-05T10:15:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331535"
}
```



---

archive/issue_comments_388961.json:
```json
{
    "body": "<a id='comment:69'>Comment 69:</a>\nJust for the record I would prefer to monkey-patch instead (or maybe additionally). It seems to be a clear bug in this case and downstream distributions should probably patch, but I still think sage should do what it can to prevent errors even on an unpatched system.\n\nI know your views on this but still wanted to make that point.",
    "created_at": "2018-10-05T15:47:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388961",
    "user": "https://github.com/timokau"
}
```

<a id='comment:69'>Comment 69:</a>
Just for the record I would prefer to monkey-patch instead (or maybe additionally). It seems to be a clear bug in this case and downstream distributions should probably patch, but I still think sage should do what it can to prevent errors even on an unpatched system.

I know your views on this but still wanted to make that point.



---

archive/issue_events_331536.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-10-06T17:44:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331536"
}
```



---

archive/issue_events_331537.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-10-06T17:44:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331537"
}
```



---

archive/issue_comments_388962.json:
```json
{
    "body": "<a id='comment:70'>Comment 70:</a>\ngh-timokau, I would usually agree that we should monkey-patch. However, in this case, there seems to be nothing Sage specific going on so I do not see a strong reason to monkey-patch. In particular, this does not completely break Sage but just breaks things in some rare cases. As this is a numpy bug, distributions should backport it in their numpy if they care.\n\nProbably more importantly, this would be somewhat hard to monkey-patch. Numpy is not imported in a central spot in Sage as the import takes a while, so it is only loaded on demand. Therefore, there is not a single spot where the monkey-patching could happen.",
    "created_at": "2018-10-06T17:44:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388962",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:70'>Comment 70:</a>
gh-timokau, I would usually agree that we should monkey-patch. However, in this case, there seems to be nothing Sage specific going on so I do not see a strong reason to monkey-patch. In particular, this does not completely break Sage but just breaks things in some rare cases. As this is a numpy bug, distributions should backport it in their numpy if they care.

Probably more importantly, this would be somewhat hard to monkey-patch. Numpy is not imported in a central spot in Sage as the import takes a while, so it is only loaded on demand. Therefore, there is not a single spot where the monkey-patching could happen.



---

archive/issue_comments_388963.json:
```json
{
    "body": "<a id='comment:71'>Comment 71:</a>\nYes, I agree that the argument is a bit weak in this case. If it was easy I would still prefer it, but since its not its not that bad.",
    "created_at": "2018-10-06T17:56:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388963",
    "user": "https://github.com/timokau"
}
```

<a id='comment:71'>Comment 71:</a>
Yes, I agree that the argument is a bit weak in this case. If it was easy I would still prefer it, but since its not its not that bad.



---

archive/issue_comments_388964.json:
```json
{
    "body": "Upstream: **Fixed upstream, but not in a stable release.**",
    "created_at": "2018-10-09T09:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388964",
    "user": "https://github.com/jdemeyer"
}
```

Upstream: **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_388965.json:
```json
{
    "body": "<a id='comment:72'>Comment 72:</a>\nThe patch was accepted upstream.",
    "created_at": "2018-10-09T09:58:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388965",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:72'>Comment 72:</a>
The patch was accepted upstream.



---

archive/issue_comments_388966.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,11 @@\n **Tarball**: https://files.pythonhosted.org/packages/45/ba/2a781ebbb0cd7962cc1d12a6b65bd4eff57ffda449fdbbae4726dc05fbc3/numpy-1.15.2.zip\n \n Our last upgrade was to NumPy 1.13.3 in #24063.\n+\n+A bug introduced in NumPy 1.15 prevents building NumPy on machines with many CPUs.\n+\n+The issue is reported and solved upstream:\n+\n+- [NumPy issue 12087](https://github.com/numpy/numpy/issues/12087)\n+- [NumPy pull request 12088](https://github.com/numpy/numpy/pull/12088)\n+\n``````\n",
    "created_at": "2018-10-09T12:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388966",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,11 @@
 **Tarball**: https://files.pythonhosted.org/packages/45/ba/2a781ebbb0cd7962cc1d12a6b65bd4eff57ffda449fdbbae4726dc05fbc3/numpy-1.15.2.zip
 
 Our last upgrade was to NumPy 1.13.3 in #24063.
+
+A bug introduced in NumPy 1.15 prevents building NumPy on machines with many CPUs.
+
+The issue is reported and solved upstream:
+
+- [NumPy issue 12087](https://github.com/numpy/numpy/issues/12087)
+- [NumPy pull request 12088](https://github.com/numpy/numpy/pull/12088)
+
``````




---

archive/issue_comments_388967.json:
```json
{
    "body": "<a id='comment:73'>Comment 73:</a>\nShould we then upgrade to NumPy 1.14.6 now, or wait for NumPy 1.15.3 to be released?",
    "created_at": "2018-10-09T12:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388967",
    "user": "https://github.com/slel"
}
```

<a id='comment:73'>Comment 73:</a>
Should we then upgrade to NumPy 1.14.6 now, or wait for NumPy 1.15.3 to be released?



---

archive/issue_comments_388968.json:
```json
{
    "body": "<a id='comment:74'>Comment 74:</a>\nFrom a packaging perspective its preferable to upgrade to the latest version now. The latest version just requires a patch for some edge case. Without the upgrade sage is completely incompatible with newer numpy versions (which distros probably have by now).\n\nThank you for your efforts in fixing this upstream Jeroen!",
    "created_at": "2018-10-09T15:43:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388968",
    "user": "https://github.com/timokau"
}
```

<a id='comment:74'>Comment 74:</a>
From a packaging perspective its preferable to upgrade to the latest version now. The latest version just requires a patch for some edge case. Without the upgrade sage is completely incompatible with newer numpy versions (which distros probably have by now).

Thank you for your efforts in fixing this upstream Jeroen!



---

archive/issue_events_331538.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-10-20T11:59:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331538"
}
```



---

archive/issue_events_331539.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "9a5156a7dc6f74bc66d93f8b715f30dd675cde54",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-10-20T11:59:06Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331539"
}
```



---

archive/issue_comments_388969.json:
```json
{
    "body": "Changed branch from **[public/25260](https://github.com/sagemath/sagetrac-mirror/tree/public/25260)** to **[b151634](https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f)**",
    "created_at": "2018-10-20T11:59:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388969",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/25260](https://github.com/sagemath/sagetrac-mirror/tree/public/25260)** to **[b151634](https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f)**



---

archive/issue_comments_388970.json:
```json
{
    "body": "<a id='comment:76'>Comment 76:</a>\nThis should be re-targeted for 8.5.",
    "created_at": "2018-10-28T14:52:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388970",
    "user": "https://github.com/embray"
}
```

<a id='comment:76'>Comment 76:</a>
This should be re-targeted for 8.5.



---

archive/issue_events_331540.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T14:52:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331540"
}
```



---

archive/issue_events_331541.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-10-28T14:52:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "milestone_number": null,
    "milestone_title": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25260#event-331541"
}
```



---

archive/issue_comments_388971.json:
```json
{
    "body": "Changed commit from **[b151634](https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f)** to none",
    "created_at": "2018-11-05T14:21:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388971",
    "user": "https://github.com/slel"
}
```

Changed commit from **[b151634](https://github.com/sagemath/sagetrac-mirror/commit/b1516346ac15a136cf8ccdf99429feb799f4754f)** to none



---

archive/issue_comments_388972.json:
```json
{
    "body": "<a id='comment:77'>Comment 77:</a>\nNext NumPy upgrade at #26643.",
    "created_at": "2018-11-05T14:21:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388972",
    "user": "https://github.com/slel"
}
```

<a id='comment:77'>Comment 77:</a>
Next NumPy upgrade at #26643.



---

archive/issue_comments_388973.json:
```json
{
    "body": "<a id='comment:78'>Comment 78:</a>\nI get two doctest failures on OSX with [SageMath](../wiki/SageMath) version 8.5.beta2, which I believe are related to this ticket, please let me know what other information is helpful (or if I should ignore this).\n\n```\nFile \"src/sage/schemes/elliptic_curves/height.py\", line 1629, in sage.schemes.elliptic_curves.height.EllipticCurveCanonicalHeight.wp_on_grid\nFailed example:\n    H.wp_on_grid(v,4)\nExpected:\n    array([[25.43920182,  5.28760943,  5.28760943, 25.43920182],\n           [ 6.05099485,  1.83757786,  1.83757786,  6.05099485],\n           [ 6.05099485,  1.83757786,  1.83757786,  6.05099485],\n           [25.43920182,  5.28760943,  5.28760943, 25.43920182]])\nGot:\n    array([[ 25.43920182,   5.28760943,   5.28760943,  25.43920182],\n           [  6.05099485,   1.83757786,   1.83757786,   6.05099485],\n           [  6.05099485,   1.83757786,   1.83757786,   6.05099485],\n           [ 25.43920182,   5.28760943,   5.28760943,  25.43920182]])\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/height.py\", line 1637, in sage.schemes.elliptic_curves.height.EllipticCurveCanonicalHeight.wp_on_grid\nFailed example:\n    H.wp_on_grid(v,4,True)\nExpected:\n    array([[25.43920182,  5.28760943],\n           [ 6.05099485,  1.83757786],\n           [ 6.05099485,  1.83757786],\n           [25.43920182,  5.28760943]])\nGot:\n    array([[ 25.43920182,   5.28760943],\n           [  6.05099485,   1.83757786],\n           [  6.05099485,   1.83757786],\n           [ 25.43920182,   5.28760943]])\n**********************************************************************\n```",
    "created_at": "2018-11-11T22:12:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388973",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:78'>Comment 78:</a>
I get two doctest failures on OSX with [SageMath](../wiki/SageMath) version 8.5.beta2, which I believe are related to this ticket, please let me know what other information is helpful (or if I should ignore this).

```
File "src/sage/schemes/elliptic_curves/height.py", line 1629, in sage.schemes.elliptic_curves.height.EllipticCurveCanonicalHeight.wp_on_grid
Failed example:
    H.wp_on_grid(v,4)
Expected:
    array([[25.43920182,  5.28760943,  5.28760943, 25.43920182],
           [ 6.05099485,  1.83757786,  1.83757786,  6.05099485],
           [ 6.05099485,  1.83757786,  1.83757786,  6.05099485],
           [25.43920182,  5.28760943,  5.28760943, 25.43920182]])
Got:
    array([[ 25.43920182,   5.28760943,   5.28760943,  25.43920182],
           [  6.05099485,   1.83757786,   1.83757786,   6.05099485],
           [  6.05099485,   1.83757786,   1.83757786,   6.05099485],
           [ 25.43920182,   5.28760943,   5.28760943,  25.43920182]])
**********************************************************************
File "src/sage/schemes/elliptic_curves/height.py", line 1637, in sage.schemes.elliptic_curves.height.EllipticCurveCanonicalHeight.wp_on_grid
Failed example:
    H.wp_on_grid(v,4,True)
Expected:
    array([[25.43920182,  5.28760943],
           [ 6.05099485,  1.83757786],
           [ 6.05099485,  1.83757786],
           [25.43920182,  5.28760943]])
Got:
    array([[ 25.43920182,   5.28760943],
           [  6.05099485,   1.83757786],
           [  6.05099485,   1.83757786],
           [ 25.43920182,   5.28760943]])
**********************************************************************
```



---

archive/issue_comments_388974.json:
```json
{
    "body": "<a id='comment:79'>Comment 79:</a>\nI don't think it is the first time we have a formatting issue of that kind but I am not sure how to deal with it. The first thing that comes to mind is: are you using OS X' clang or sage's gcc?",
    "created_at": "2018-11-11T22:16:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388974",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:79'>Comment 79:</a>
I don't think it is the first time we have a formatting issue of that kind but I am not sure how to deal with it. The first thing that comes to mind is: are you using OS X' clang or sage's gcc?



---

archive/issue_comments_388975.json:
```json
{
    "body": "<a id='comment:80'>Comment 80:</a>\nI'm not 100% sure I'm looking in the right place but looks like homebrew gcc, version 8.2.0. As far as I know I haven't tried to change to clang for my sage install.\n\nI have this line in config.log `Configured with: ../configure --build=x86_64-apple-darwin17.7.0 --prefix=/usr/local/Cellar/gcc/8.2.0 --libdir=/usr/local/Cellar/gcc/8.2.0/lib/gcc/8 --enable-languages=c,c++,objc,obj-c++,fortran --program-suffix=-8 --with-gmp=/usr/local/opt/gmp --with-mpfr=/usr/local/opt/mpfr --with-mpc=/usr/local/opt/libmpc --with-isl=/usr/local/opt/isl --with-system-zlib --enable-checking=release --with-pkgversion='Homebrew GCC 8.2.0' --with-bugurl=https://github.com/Homebrew/homebrew-core/issues --disable-nls`",
    "created_at": "2018-11-11T22:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388975",
    "user": "https://github.com/alexjbest"
}
```

<a id='comment:80'>Comment 80:</a>
I'm not 100% sure I'm looking in the right place but looks like homebrew gcc, version 8.2.0. As far as I know I haven't tried to change to clang for my sage install.

I have this line in config.log `Configured with: ../configure --build=x86_64-apple-darwin17.7.0 --prefix=/usr/local/Cellar/gcc/8.2.0 --libdir=/usr/local/Cellar/gcc/8.2.0/lib/gcc/8 --enable-languages=c,c++,objc,obj-c++,fortran --program-suffix=-8 --with-gmp=/usr/local/opt/gmp --with-mpfr=/usr/local/opt/mpfr --with-mpc=/usr/local/opt/libmpc --with-isl=/usr/local/opt/isl --with-system-zlib --enable-checking=release --with-pkgversion='Homebrew GCC 8.2.0' --with-bugurl=https://github.com/Homebrew/homebrew-core/issues --disable-nls`



---

archive/issue_comments_388976.json:
```json
{
    "body": "<a id='comment:81'>Comment 81:</a>\nHum... Not sure. You should open a new ticket in any case. While numpy could be your culprit if numpy arrays are used it could be something else entirely.",
    "created_at": "2018-11-11T22:29:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25260",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25260#issuecomment-388976",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:81'>Comment 81:</a>
Hum... Not sure. You should open a new ticket in any case. While numpy could be your culprit if numpy arrays are used it could be something else entirely.
