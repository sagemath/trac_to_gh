# Issue 25079: Use _mul_long Matrix*int

archive/issues_024842.json:
```json
{
    "body": "sage.structure.element does support the use of _mul_long for a multiplication of the form Element*int. However, the multiplication of Matrix*int does not use that short-cut.\n\nIn fact, currently only one matrix type implements _mul_long, namely Matrix_gfpn_dense. Unfortunately it uses a conversion that does not coincide with the coercion into the base ring.\n\nSo, this ticket is about fixing both issues.\n\n**Keywords:** Matrix _mul_long\n\n**Branch/Commit:** [3c4a06d3080dd8528053be95b86154822d4d2b79](https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79)\n\n**Reviewer:** Jeroen Demeyer\n\n**Author:** Simon King\n\n**Dependencies:** #25476\n\nIssue created by migration from https://trac.sagemath.org/ticket/25079\n\n",
    "closed_at": "2018-06-07T22:15:15Z",
    "created_at": "2018-04-02T15:20:56Z",
    "labels": [
        "component: coercion",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Use _mul_long Matrix*int",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25079",
    "user": "https://github.com/simon-king-jena"
}
```
sage.structure.element does support the use of _mul_long for a multiplication of the form Element*int. However, the multiplication of Matrix*int does not use that short-cut.

In fact, currently only one matrix type implements _mul_long, namely Matrix_gfpn_dense. Unfortunately it uses a conversion that does not coincide with the coercion into the base ring.

So, this ticket is about fixing both issues.

**Keywords:** Matrix _mul_long

**Branch/Commit:** [3c4a06d3080dd8528053be95b86154822d4d2b79](https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79)

**Reviewer:** Jeroen Demeyer

**Author:** Simon King

**Dependencies:** #25476

Issue created by migration from https://trac.sagemath.org/ticket/25079





---

archive/issue_comments_456965.json:
```json
{
    "body": "**Branch:** [u/SimonKing/use__mul_long_matrix_int](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use__mul_long_matrix_int)",
    "created_at": "2018-04-02T15:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456965",
    "user": "https://github.com/simon-king-jena"
}
```

**Branch:** [u/SimonKing/use__mul_long_matrix_int](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use__mul_long_matrix_int)



---

archive/issue_comments_456966.json:
```json
{
    "body": "<a id='comment:2'></a>\nIn the current branch, I am basically copying relevant parts of `Element.__mul__` into `Matrix.__mul__`. The timings improve considerably, at least for Matrix_gfpn_dense.\n\nWithout the branch:\n\n```\nsage: M = random_matrix(GF(9,'x'), 64,51)\nsage: c = int(4)\nsage: %timeit M*c\nThe slowest run took 173.53 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 10.3 \u00b5s per loop\nsage: %timeit c*M\nThe slowest run took 34.51 times longer than the fastest. This could mean that an intermediate result is being cached.\n100000 loops, best of 3: 10.2 \u00b5s per loop\n```\n\nWith the branch:\n\n```\nsage: M = random_matrix(GF(9,'x'), 64,51)\nsage: c = int(4)\nsage: %timeit M*c\nThe slowest run took 25.57 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.53 \u00b5s per loop\nsage: %timeit c*M\nThe slowest run took 26.66 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.57 \u00b5s per loop\n```\n\nI didn't run the test suite yet, but for now I am asking for review...\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf9cefd138bb9fbb19c3c43a778ab230bf962902\">bf9cefd</a></td><td><code>New MatrixArgs object to deal with constructing matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cc828252def3e2631c7cca8db7bd6f972af4efc6\">cc82825</a></td><td><code>Merge branch 'u/jdemeyer/new_matrixinput_object_to_deal_with_constructing_matrices' of git://trac.sagemath.org/sage into t/25076/fix_matrix_gfpn_dense___int</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bed63f0a555cb1b8f291ec65428c0cf972fd40f8\">bed63f0</a></td><td><code>Add a test ensuring that #24742 remains fixed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f\">f0e97af</a></td><td><code>Modify the test that ensures that #24742 remains fixed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e81581c9cbcb518b7eba0e91639a521015875cce\">e81581c</a></td><td><code>Enable _mul_long for matrices</code></td></tr></table>\n",
    "created_at": "2018-04-02T15:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456966",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'></a>
In the current branch, I am basically copying relevant parts of `Element.__mul__` into `Matrix.__mul__`. The timings improve considerably, at least for Matrix_gfpn_dense.

Without the branch:

```
sage: M = random_matrix(GF(9,'x'), 64,51)
sage: c = int(4)
sage: %timeit M*c
The slowest run took 173.53 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 10.3 µs per loop
sage: %timeit c*M
The slowest run took 34.51 times longer than the fastest. This could mean that an intermediate result is being cached.
100000 loops, best of 3: 10.2 µs per loop
```

With the branch:

```
sage: M = random_matrix(GF(9,'x'), 64,51)
sage: c = int(4)
sage: %timeit M*c
The slowest run took 25.57 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.53 µs per loop
sage: %timeit c*M
The slowest run took 26.66 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.57 µs per loop
```

I didn't run the test suite yet, but for now I am asking for review...

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf9cefd138bb9fbb19c3c43a778ab230bf962902">bf9cefd</a></td><td><code>New MatrixArgs object to deal with constructing matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cc828252def3e2631c7cca8db7bd6f972af4efc6">cc82825</a></td><td><code>Merge branch 'u/jdemeyer/new_matrixinput_object_to_deal_with_constructing_matrices' of git://trac.sagemath.org/sage into t/25076/fix_matrix_gfpn_dense___int</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bed63f0a555cb1b8f291ec65428c0cf972fd40f8">bed63f0</a></td><td><code>Add a test ensuring that #24742 remains fixed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0e97af5a3dbffec014829eb2341abdaecb78e9f">f0e97af</a></td><td><code>Modify the test that ensures that #24742 remains fixed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e81581c9cbcb518b7eba0e91639a521015875cce">e81581c</a></td><td><code>Enable _mul_long for matrices</code></td></tr></table>




---

archive/issue_comments_456967.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-04-02T15:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456967",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_456968.json:
```json
{
    "body": "**Commit:** [e81581c9cbcb518b7eba0e91639a521015875cce](https://github.com/sagemath/sagetrac-mirror/commit/e81581c9cbcb518b7eba0e91639a521015875cce)",
    "created_at": "2018-04-02T15:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456968",
    "user": "https://github.com/simon-king-jena"
}
```

**Commit:** [e81581c9cbcb518b7eba0e91639a521015875cce](https://github.com/sagemath/sagetrac-mirror/commit/e81581c9cbcb518b7eba0e91639a521015875cce)



---

archive/issue_comments_456969.json:
```json
{
    "body": "**Author:** Simon King",
    "created_at": "2018-04-02T15:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456969",
    "user": "https://github.com/simon-king-jena"
}
```

**Author:** Simon King



---

archive/issue_comments_456970.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a6a63a9f70691d61ae964800c0ce00f0397769c5\">a6a63a9</a></td><td><code>Enable _mul_long for matrices</code></td></tr></table>\n",
    "created_at": "2018-04-02T15:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456970",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a6a63a9f70691d61ae964800c0ce00f0397769c5">a6a63a9</a></td><td><code>Enable _mul_long for matrices</code></td></tr></table>




---

archive/issue_comments_456971.json:
```json
{
    "body": "**Changing commit** from \"[e81581c9cbcb518b7eba0e91639a521015875cce](https://github.com/sagemath/sagetrac-mirror/commit/e81581c9cbcb518b7eba0e91639a521015875cce)\" to \"[a6a63a9f70691d61ae964800c0ce00f0397769c5](https://github.com/sagemath/sagetrac-mirror/commit/a6a63a9f70691d61ae964800c0ce00f0397769c5)\".",
    "created_at": "2018-04-02T15:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456971",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e81581c9cbcb518b7eba0e91639a521015875cce](https://github.com/sagemath/sagetrac-mirror/commit/e81581c9cbcb518b7eba0e91639a521015875cce)" to "[a6a63a9f70691d61ae964800c0ce00f0397769c5](https://github.com/sagemath/sagetrac-mirror/commit/a6a63a9f70691d61ae964800c0ce00f0397769c5)".



---

archive/issue_comments_456972.json:
```json
{
    "body": "**Changing commit** from \"[a6a63a9f70691d61ae964800c0ce00f0397769c5](https://github.com/sagemath/sagetrac-mirror/commit/a6a63a9f70691d61ae964800c0ce00f0397769c5)\" to \"[31f085e4c1ad2823bf30174781be12662192e573](https://github.com/sagemath/sagetrac-mirror/commit/31f085e4c1ad2823bf30174781be12662192e573)\".",
    "created_at": "2018-04-02T15:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456972",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a6a63a9f70691d61ae964800c0ce00f0397769c5](https://github.com/sagemath/sagetrac-mirror/commit/a6a63a9f70691d61ae964800c0ce00f0397769c5)" to "[31f085e4c1ad2823bf30174781be12662192e573](https://github.com/sagemath/sagetrac-mirror/commit/31f085e4c1ad2823bf30174781be12662192e573)".



---

archive/issue_comments_456973.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31f085e4c1ad2823bf30174781be12662192e573\">31f085e</a></td><td><code>Enable _mul_long for matrices</code></td></tr></table>\n",
    "created_at": "2018-04-02T15:52:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456973",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31f085e4c1ad2823bf30174781be12662192e573">31f085e</a></td><td><code>Enable _mul_long for matrices</code></td></tr></table>




---

archive/issue_comments_456974.json:
```json
{
    "body": "<a id='comment:5'></a>\nSorry, I had forgotten to add a test. So, I changed the last commit (sorry for the forced push, but nobody was using the old commit yet).\n\nHere is what happens for other matrix types:\nWith the branch:\n\n```\nsage: M = random_matrix(GF(3,'x'), 64,51)\nsage: %timeit c*M\nThe slowest run took 52.64 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 26 \u00b5s per loop\n```\nWithout the branch:\n\n```\nsage: M = random_matrix(GF(3,'x'), 64,51)\nsage: %timeit c*M\nThe slowest run took 123.98 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 24.4 \u00b5s per loop\n```\nSo, it seems that enabling _mul_long (which basically means: Using the existing default _mul_long) seems to not slow down the old code substantially.",
    "created_at": "2018-04-02T15:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456974",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'></a>
Sorry, I had forgotten to add a test. So, I changed the last commit (sorry for the forced push, but nobody was using the old commit yet).

Here is what happens for other matrix types:
With the branch:

```
sage: M = random_matrix(GF(3,'x'), 64,51)
sage: %timeit c*M
The slowest run took 52.64 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 26 µs per loop
```
Without the branch:

```
sage: M = random_matrix(GF(3,'x'), 64,51)
sage: %timeit c*M
The slowest run took 123.98 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 24.4 µs per loop
```
So, it seems that enabling _mul_long (which basically means: Using the existing default _mul_long) seems to not slow down the old code substantially.



---

archive/issue_comments_456975.json:
```json
{
    "body": "<a id='comment:6'></a>\nAll tests pass (with meataxe installed)...",
    "created_at": "2018-04-02T18:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456975",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'></a>
All tests pass (with meataxe installed)...



---

archive/issue_comments_456976.json:
```json
{
    "body": "<a id='comment:7'></a>\nI might review this, but I would rather do that after the dependencies have been merged.",
    "created_at": "2018-04-06T07:53:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456976",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:7'></a>
I might review this, but I would rather do that after the dependencies have been merged.



---

archive/issue_comments_456977.json:
```json
{
    "body": "<a id='comment:8'></a>\nAlready this comment is wrong:\n\n```\nMultiply an MTX matrix with a field element represented by a Python integer.\n```\nIt's certainly not a Python integer, it's a C `long`. It would be fine for me to keep the old wording (\"an integer\").",
    "created_at": "2018-04-06T07:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456977",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:8'></a>
Already this comment is wrong:

```
Multiply an MTX matrix with a field element represented by a Python integer.
```
It's certainly not a Python integer, it's a C `long`. It would be fine for me to keep the old wording ("an integer").



---

archive/issue_comments_456978.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-04-06T07:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456978",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_456979.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe code in `src/sage/structure/element.pyx` looks strange. It's certainly inefficient because `have_same_parent()` calls `classify_elements` so you're effectively calling `classify_elements` twice. It's also missing the typical `return NotImplemented` fallback that other operators have.",
    "created_at": "2018-04-06T07:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456979",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>
The code in `src/sage/structure/element.pyx` looks strange. It's certainly inefficient because `have_same_parent()` calls `classify_elements` so you're effectively calling `classify_elements` twice. It's also missing the typical `return NotImplemented` fallback that other operators have.



---

archive/issue_comments_456980.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jdemeyer](#comment%3A8):\n> Already this comment is wrong:\n> \n> ```\n> Multiply an MTX matrix with a field element represented by a Python integer.\n> ```\n> It's certainly not a Python integer, it's a C `long`. It would be fine for me to keep the old wording (\"an integer\").\n\n\nThis ticket is related with an error that was actually solved (but not via `_mul_long_`) and was of the form `M*int(1)`. That's why I wrote \"Python integer\".\n\nBut if you prefer \"C long\", I'm fine with it.",
    "created_at": "2018-04-06T10:37:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456980",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:10'></a>
Replying to [jdemeyer](#comment%3A8):
> Already this comment is wrong:
> 
> ```
> Multiply an MTX matrix with a field element represented by a Python integer.
> ```
> It's certainly not a Python integer, it's a C `long`. It would be fine for me to keep the old wording ("an integer").


This ticket is related with an error that was actually solved (but not via `_mul_long_`) and was of the form `M*int(1)`. That's why I wrote "Python integer".

But if you prefer "C long", I'm fine with it.



---

archive/issue_comments_456981.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [SimonKing](#comment%3A10):\n> This ticket is related with an error that was actually solved (but not via `_mul_long_`) and was of the form `M*int(1)`. That's why I wrote \"Python integer\".\n\n\nRight, this ticket fixes a problem involving a Python integer. But the function `_mul_long` itself has nothing to do with Python integers.\n\n> But if you prefer \"C long\", I'm fine with it.\n\n\nEither that or revert to the old wording.",
    "created_at": "2018-04-06T10:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456981",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>
Replying to [SimonKing](#comment%3A10):
> This ticket is related with an error that was actually solved (but not via `_mul_long_`) and was of the form `M*int(1)`. That's why I wrote "Python integer".


Right, this ticket fixes a problem involving a Python integer. But the function `_mul_long` itself has nothing to do with Python integers.

> But if you prefer "C long", I'm fine with it.


Either that or revert to the old wording.



---

archive/issue_comments_456982.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jdemeyer](#comment%3A9):\n> The code in `src/sage/structure/element.pyx` looks strange. It's certainly inefficient because `have_same_parent()` calls `classify_elements` so you're effectively calling `classify_elements` twice. It's also missing the typical `return NotImplemented` fallback that other operators have.\n\n\nI copied it from some other place of `element.pyx` and it may very well be that I did wrong. So, I should call `classify_elements` in the beginning and then call `HAVE_SAME_PARENT(cl)` instead of `have_same_parents`.\n\nAnd I'll return to the original wording.",
    "created_at": "2018-04-06T10:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456982",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:12'></a>
Replying to [jdemeyer](#comment%3A9):
> The code in `src/sage/structure/element.pyx` looks strange. It's certainly inefficient because `have_same_parent()` calls `classify_elements` so you're effectively calling `classify_elements` twice. It's also missing the typical `return NotImplemented` fallback that other operators have.


I copied it from some other place of `element.pyx` and it may very well be that I did wrong. So, I should call `classify_elements` in the beginning and then call `HAVE_SAME_PARENT(cl)` instead of `have_same_parents`.

And I'll return to the original wording.



---

archive/issue_comments_456983.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1103493866985a869f2a64d8a2c3b5ab4a74332d\">1103493</a></td><td><code>Use classify_elements more efficiently</code></td></tr></table>\n",
    "created_at": "2018-04-06T10:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456983",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1103493866985a869f2a64d8a2c3b5ab4a74332d">1103493</a></td><td><code>Use classify_elements more efficiently</code></td></tr></table>




---

archive/issue_comments_456984.json:
```json
{
    "body": "**Changing commit** from \"[31f085e4c1ad2823bf30174781be12662192e573](https://github.com/sagemath/sagetrac-mirror/commit/31f085e4c1ad2823bf30174781be12662192e573)\" to \"[1103493866985a869f2a64d8a2c3b5ab4a74332d](https://github.com/sagemath/sagetrac-mirror/commit/1103493866985a869f2a64d8a2c3b5ab4a74332d)\".",
    "created_at": "2018-04-06T10:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456984",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[31f085e4c1ad2823bf30174781be12662192e573](https://github.com/sagemath/sagetrac-mirror/commit/31f085e4c1ad2823bf30174781be12662192e573)" to "[1103493866985a869f2a64d8a2c3b5ab4a74332d](https://github.com/sagemath/sagetrac-mirror/commit/1103493866985a869f2a64d8a2c3b5ab4a74332d)".



---

archive/issue_comments_456985.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-04-06T10:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456985",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_456986.json:
```json
{
    "body": "<a id='comment:14'></a>\nDone!",
    "created_at": "2018-04-06T10:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456986",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:14'></a>
Done!



---

archive/issue_comments_456987.json:
```json
{
    "body": "<a id='comment:15'></a>\nPS: I repeated the timings that I provided in [comment:2](#comment%3A2) and [comment:5](#comment%3A5).\n\n```\nsage: M = random_matrix(GF(9,'x'), 64,51)\nsage: type(M)\n<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>\nsage: c = int(4)\nsage: %timeit M*c\nThe slowest run took 29.39 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.26 \u00b5s per loop\nsage: %timeit c*M\nThe slowest run took 15.87 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000000 loops, best of 3: 1.26 \u00b5s per loop\nsage: M = random_matrix(GF(3,'x'), 64,51)\nsage: type(M)\n<type 'sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float'>\nsage: %timeit M*c\nThe slowest run took 53.27 times longer than the fastest. This could mean that an intermediate result is being cached.\n10000 loops, best of 3: 20.7 \u00b5s per loop\nsage: %timeit c*M\n10000 loops, best of 3: 21 \u00b5s per loop\n```\n\nHence, there is now a slight improvement for Matrix_modn_dense_float (with the old branch, there was a small deterioration), and the improvement for Matrix_gfpn_dense is now even better. So, thank you for spotting the issue with `classify_elements` --- it had a noticeable effect.",
    "created_at": "2018-04-06T10:53:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456987",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:15'></a>
PS: I repeated the timings that I provided in [comment:2](#comment%3A2) and [comment:5](#comment%3A5).

```
sage: M = random_matrix(GF(9,'x'), 64,51)
sage: type(M)
<type 'sage.matrix.matrix_gfpn_dense.Matrix_gfpn_dense'>
sage: c = int(4)
sage: %timeit M*c
The slowest run took 29.39 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.26 µs per loop
sage: %timeit c*M
The slowest run took 15.87 times longer than the fastest. This could mean that an intermediate result is being cached.
1000000 loops, best of 3: 1.26 µs per loop
sage: M = random_matrix(GF(3,'x'), 64,51)
sage: type(M)
<type 'sage.matrix.matrix_modn_dense_float.Matrix_modn_dense_float'>
sage: %timeit M*c
The slowest run took 53.27 times longer than the fastest. This could mean that an intermediate result is being cached.
10000 loops, best of 3: 20.7 µs per loop
sage: %timeit c*M
10000 loops, best of 3: 21 µs per loop
```

Hence, there is now a slight improvement for Matrix_modn_dense_float (with the old branch, there was a small deterioration), and the improvement for Matrix_gfpn_dense is now even better. So, thank you for spotting the issue with `classify_elements` --- it had a noticeable effect.



---

archive/issue_comments_456988.json:
```json
{
    "body": "**Reviewer:** Jeroen Demeyer",
    "created_at": "2018-05-15T10:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456988",
    "user": "https://github.com/jdemeyer"
}
```

**Reviewer:** Jeroen Demeyer



---

archive/issue_comments_456989.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-05-15T10:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456989",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_456990.json:
```json
{
    "body": "<a id='comment:16'></a>\nCan you also add the `except TypeError: return NotImplemented` fallback from `Element.__mul__`",
    "created_at": "2018-05-15T10:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456990",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:16'></a>
Can you also add the `except TypeError: return NotImplemented` fallback from `Element.__mul__`



---

archive/issue_comments_456991.json:
```json
{
    "body": "**Changing commit** from \"[1103493866985a869f2a64d8a2c3b5ab4a74332d](https://github.com/sagemath/sagetrac-mirror/commit/1103493866985a869f2a64d8a2c3b5ab4a74332d)\" to \"[236024890ba6a7667006f073bd414904d8c22ba9](https://github.com/sagemath/sagetrac-mirror/commit/236024890ba6a7667006f073bd414904d8c22ba9)\".",
    "created_at": "2018-06-01T19:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456991",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1103493866985a869f2a64d8a2c3b5ab4a74332d](https://github.com/sagemath/sagetrac-mirror/commit/1103493866985a869f2a64d8a2c3b5ab4a74332d)" to "[236024890ba6a7667006f073bd414904d8c22ba9](https://github.com/sagemath/sagetrac-mirror/commit/236024890ba6a7667006f073bd414904d8c22ba9)".



---

archive/issue_comments_456992.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/236024890ba6a7667006f073bd414904d8c22ba9\">2360248</a></td><td><code>Return NotImplemented when a TypeError occurs in matrix times long</code></td></tr></table>\n",
    "created_at": "2018-06-01T19:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/236024890ba6a7667006f073bd414904d8c22ba9">2360248</a></td><td><code>Return NotImplemented when a TypeError occurs in matrix times long</code></td></tr></table>




---

archive/issue_comments_456993.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [jdemeyer](#comment%3A16):\n> Can you also add the `except TypeError: return NotImplemented` fallback from `Element.__mul__`\n\n\nDone, I think.",
    "created_at": "2018-06-01T19:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456993",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:18'></a>
Replying to [jdemeyer](#comment%3A16):
> Can you also add the `except TypeError: return NotImplemented` fallback from `Element.__mul__`


Done, I think.



---

archive/issue_comments_456994.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-06-01T19:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456994",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_456995.json:
```json
{
    "body": "<a id='comment:19'></a>\nDo you have any idea why the patchbot reports failing tests? I don't get those failures.",
    "created_at": "2018-06-02T15:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456995",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:19'></a>
Do you have any idea why the patchbot reports failing tests? I don't get those failures.



---

archive/issue_comments_456996.json:
```json
{
    "body": "**Changing dependencies** from \"#25076\" to \"\".",
    "created_at": "2018-06-04T07:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456996",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#25076" to "".



---

archive/issue_events_071185.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-04T07:48:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25079#event-71185"
}
```



---

archive/issue_comments_456997.json:
```json
{
    "body": "<a id='comment:21'></a>\nPlease add tests for multiplying with a **negative** integer.",
    "created_at": "2018-06-04T07:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456997",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:21'></a>
Please add tests for multiplying with a **negative** integer.



---

archive/issue_comments_456998.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-06-04T07:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456998",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_456999.json:
```json
{
    "body": "<a id='comment:22'></a>\nCode looks good to me. So once you add the negative integer tests for meataxe, I will run full doctests. If that passes => positive review",
    "created_at": "2018-06-04T07:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-456999",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:22'></a>
Code looks good to me. So once you add the negative integer tests for meataxe, I will run full doctests. If that passes => positive review



---

archive/issue_comments_457000.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [jdemeyer](#comment%3A22):\n> Code looks good to me. So once you add the negative integer tests for meataxe, I will run full doctests. If that passes => positive review\n\n\nGood catch --- there is in fact a bug for multiplication with a negative Python long.",
    "created_at": "2018-06-04T14:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457000",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:23'></a>
Replying to [jdemeyer](#comment%3A22):
> Code looks good to me. So once you add the negative integer tests for meataxe, I will run full doctests. If that passes => positive review


Good catch --- there is in fact a bug for multiplication with a negative Python long.



---

archive/issue_comments_457001.json:
```json
{
    "body": "<a id='comment:24'></a>\nProblem: Apparently `-1%3` evaluates to `-1`, not `2`. Is there an easy way to get a non-negative remainder?",
    "created_at": "2018-06-04T18:37:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457001",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:24'></a>
Problem: Apparently `-1%3` evaluates to `-1`, not `2`. Is there an easy way to get a non-negative remainder?



---

archive/issue_comments_457002.json:
```json
{
    "body": "<a id='comment:25'></a>\nStrange enough: I just tried to create cython code in which `-1%3` evaluates to `-1`, but I failed --- but in the MeatAxe wrapper it does evaluate to `-1`. Why?",
    "created_at": "2018-06-04T18:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457002",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:25'></a>
Strange enough: I just tried to create cython code in which `-1%3` evaluates to `-1`, but I failed --- but in the MeatAxe wrapper it does evaluate to `-1`. Why?



---

archive/issue_comments_457003.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [SimonKing](#comment%3A25):\n> Strange enough: I just tried to create cython code in which `-1%3` evaluates to `-1`, but I failed --- but in the MeatAxe wrapper it does evaluate to `-1`. Why?\n\n\nThe **Python** convention is rounding down, so -1 divided by 3 gives quotient -1 and remainder 2.\n\nThe **C** convention is truncating, so -1 divided by 3 gives quotient 0 and remainder -1.\n\nCython always uses the Python convention, unless the `cdivision=True` directive is set (which is not the default, but it is set in Sage) and one of the arguments is a C integer.\n\nExamples:\n\nPython integers, always Python convention:\n\n```\nsage: cython('''\n....: print((-1) % 3)\n....: ''')\n2\n```\n\nC integers, result depends on `cdivision`:\n\n```\nsage: cython('''\n....: print(<int>(-1) % <int>3)\n....: ''')\n2\n```\n\n```\nsage: cython('''\n....: cimport cython\n....: \n....: with cython.cdivision(True):\n....:     print(<int>(-1) % <int>3)\n....: ''')\n-1\n```\n\nIn fact, it suffices that one of the arguments is a C integer:\n\n```\nsage: cython('''\n....: cimport cython\n....: \n....: with cython.cdivision(True):\n....:     print(<int>(-1) % 3)\n....: ''')\n-1\nsage: cython('''\n....: cimport cython\n....: \n....: with cython.cdivision(True):\n....:     print((-1) % <int>3)\n....: ''')\n-1\n```\n\nSage is compiled with `cdivision=True` for historical reasons and for efficiency (`cdivision=False` adds a bit of overhead for every division of signed C integers).",
    "created_at": "2018-06-04T19:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457003",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:26'></a>
Replying to [SimonKing](#comment%3A25):
> Strange enough: I just tried to create cython code in which `-1%3` evaluates to `-1`, but I failed --- but in the MeatAxe wrapper it does evaluate to `-1`. Why?


The **Python** convention is rounding down, so -1 divided by 3 gives quotient -1 and remainder 2.

The **C** convention is truncating, so -1 divided by 3 gives quotient 0 and remainder -1.

Cython always uses the Python convention, unless the `cdivision=True` directive is set (which is not the default, but it is set in Sage) and one of the arguments is a C integer.

Examples:

Python integers, always Python convention:

```
sage: cython('''
....: print((-1) % 3)
....: ''')
2
```

C integers, result depends on `cdivision`:

```
sage: cython('''
....: print(<int>(-1) % <int>3)
....: ''')
2
```

```
sage: cython('''
....: cimport cython
....: 
....: with cython.cdivision(True):
....:     print(<int>(-1) % <int>3)
....: ''')
-1
```

In fact, it suffices that one of the arguments is a C integer:

```
sage: cython('''
....: cimport cython
....: 
....: with cython.cdivision(True):
....:     print(<int>(-1) % 3)
....: ''')
-1
sage: cython('''
....: cimport cython
....: 
....: with cython.cdivision(True):
....:     print((-1) % <int>3)
....: ''')
-1
```

Sage is compiled with `cdivision=True` for historical reasons and for efficiency (`cdivision=False` adds a bit of overhead for every division of signed C integers).



---

archive/issue_comments_457004.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [jdemeyer](#comment%3A26):\n> Sage is compiled with `cdivision=True` for historical reasons and for efficiency (`cdivision=False` adds a bit of overhead for every division of signed C integers).\n\n\nSo, the easiest way out is to use `with cython.cdivision(False)` in this single line of code, right?",
    "created_at": "2018-06-04T19:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457004",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:27'></a>
Replying to [jdemeyer](#comment%3A26):
> Sage is compiled with `cdivision=True` for historical reasons and for efficiency (`cdivision=False` adds a bit of overhead for every division of signed C integers).


So, the easiest way out is to use `with cython.cdivision(False)` in this single line of code, right?



---

archive/issue_comments_457005.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [SimonKing](#comment%3A27):\n> So, the easiest way out is to use `with cython.cdivision(False)` in this single line of code, right?\n\n\nSure.",
    "created_at": "2018-06-04T20:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457005",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:28'></a>
Replying to [SimonKing](#comment%3A27):
> So, the easiest way out is to use `with cython.cdivision(False)` in this single line of code, right?


Sure.



---

archive/issue_comments_457006.json:
```json
{
    "body": "**Changing commit** from \"[236024890ba6a7667006f073bd414904d8c22ba9](https://github.com/sagemath/sagetrac-mirror/commit/236024890ba6a7667006f073bd414904d8c22ba9)\" to \"[6b17d582db337fab1c87fd3bf0b28e11370ef013](https://github.com/sagemath/sagetrac-mirror/commit/6b17d582db337fab1c87fd3bf0b28e11370ef013)\".",
    "created_at": "2018-06-04T21:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457006",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[236024890ba6a7667006f073bd414904d8c22ba9](https://github.com/sagemath/sagetrac-mirror/commit/236024890ba6a7667006f073bd414904d8c22ba9)" to "[6b17d582db337fab1c87fd3bf0b28e11370ef013](https://github.com/sagemath/sagetrac-mirror/commit/6b17d582db337fab1c87fd3bf0b28e11370ef013)".



---

archive/issue_comments_457007.json:
```json
{
    "body": "<a id='comment:29'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6b17d582db337fab1c87fd3bf0b28e11370ef013\">6b17d58</a></td><td><code>Fix 'Matrix_gfpn_dense times negative int'</code></td></tr></table>\n",
    "created_at": "2018-06-04T21:21:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457007",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6b17d582db337fab1c87fd3bf0b28e11370ef013">6b17d58</a></td><td><code>Fix 'Matrix_gfpn_dense times negative int'</code></td></tr></table>




---

archive/issue_comments_457008.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2018-06-04T21:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457008",
    "user": "https://github.com/simon-king-jena"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_457009.json:
```json
{
    "body": "<a id='comment:30'></a>\nThank you for pointing me to the cdivision directive.\n\nI added a test showing that multiplication with a negative int works, and with that `make ptest` passes on my laptop. So, needs review.",
    "created_at": "2018-06-04T21:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457009",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:30'></a>
Thank you for pointing me to the cdivision directive.

I added a test showing that multiplication with a negative int works, and with that `make ptest` passes on my laptop. So, needs review.



---

archive/issue_comments_457010.json:
```json
{
    "body": "**Changing branch** from \"[u/SimonKing/use__mul_long_matrix_int](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use__mul_long_matrix_int)\" to \"[u/jdemeyer/use__mul_long_matrix_int](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use__mul_long_matrix_int)\".",
    "created_at": "2018-06-06T12:01:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457010",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/SimonKing/use__mul_long_matrix_int](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/use__mul_long_matrix_int)" to "[u/jdemeyer/use__mul_long_matrix_int](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use__mul_long_matrix_int)".



---

archive/issue_comments_457011.json:
```json
{
    "body": "<a id='comment:32'></a>\nRebased on top of #25476.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002\">4eae803</a></td><td><code>Making matrices use the new _echelon_in_place method.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d\">e2f0550</a></td><td><code>Specify that _echelon_in_place shall return the pivots</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79\">3c4a06d</a></td><td><code>Enable _mul_long for matrices</code></td></tr></table>\n",
    "created_at": "2018-06-06T12:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457011",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:32'></a>
Rebased on top of #25476.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002">4eae803</a></td><td><code>Making matrices use the new _echelon_in_place method.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d">e2f0550</a></td><td><code>Specify that _echelon_in_place shall return the pivots</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79">3c4a06d</a></td><td><code>Enable _mul_long for matrices</code></td></tr></table>




---

archive/issue_comments_457012.json:
```json
{
    "body": "**Dependencies:** #25476",
    "created_at": "2018-06-06T12:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457012",
    "user": "https://github.com/jdemeyer"
}
```

**Dependencies:** #25476



---

archive/issue_comments_457013.json:
```json
{
    "body": "**Changing commit** from \"[6b17d582db337fab1c87fd3bf0b28e11370ef013](https://github.com/sagemath/sagetrac-mirror/commit/6b17d582db337fab1c87fd3bf0b28e11370ef013)\" to \"[3c4a06d3080dd8528053be95b86154822d4d2b79](https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79)\".",
    "created_at": "2018-06-06T12:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457013",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[6b17d582db337fab1c87fd3bf0b28e11370ef013](https://github.com/sagemath/sagetrac-mirror/commit/6b17d582db337fab1c87fd3bf0b28e11370ef013)" to "[3c4a06d3080dd8528053be95b86154822d4d2b79](https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79)".



---

archive/issue_comments_457014.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2018-06-06T12:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457014",
    "user": "https://github.com/jdemeyer"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_457015.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/use__mul_long_matrix_int](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use__mul_long_matrix_int)\" to \"[3c4a06d3080dd8528053be95b86154822d4d2b79](https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79)\".",
    "created_at": "2018-06-07T22:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25079#issuecomment-457015",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jdemeyer/use__mul_long_matrix_int](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/use__mul_long_matrix_int)" to "[3c4a06d3080dd8528053be95b86154822d4d2b79](https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79)".



---

archive/issue_events_071186.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-07T22:15:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25079",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25079#event-71186"
}
```
