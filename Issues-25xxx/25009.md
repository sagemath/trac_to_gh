# Issue 25009: update and promote spkg primecount

archive/issues_024772.json:
```json
{
    "body": "The `prime_pi` function is currently a symbolic function that can hold its argument as in\n\n```\nsage: n = SR.var('n')\nsage: prime_pi(n)\nprime_pi(n)\n```\nthat also contains the Cython code for evaluating it\n\n```\nsage: prime_pi(13543)\n1603\n```\nUnfortunately, it is buggy, see #24960 (fixed in #32894, using this ticket). We will promote the spkg `primecount` to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.\n\n\nUpstream patch: https://github.com/kimwalisch/primesieve/pull/107 (rejected)\n\n---\nBelow is the original part, no longer too relevant.\n\n---\nWe move the evaluation part as a standalone function in `arith/` and provide alternative implementations\n- using `PARI/GP` (only efficient in the range of tabulated primes)\n- using the different algorithms in the library primecount that is packaged in #24966\n\n\n\n\nCC:  @mkoeppe @miguelmarco @isuruf\n\nBranch/Commit: b9b4eaf334c6dd5261ccd229ca825b01b600e6a6\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: Matthias Koeppe\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25009\n\n",
    "closed_at": "2021-12-12T15:09:01Z",
    "created_at": "2018-03-18T21:53:10Z",
    "labels": [
        "component: basic arithmetic"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "update and promote spkg primecount",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25009",
    "user": "https://github.com/videlec"
}
```
The `prime_pi` function is currently a symbolic function that can hold its argument as in

```
sage: n = SR.var('n')
sage: prime_pi(n)
prime_pi(n)
```
that also contains the Cython code for evaluating it

```
sage: prime_pi(13543)
1603
```
Unfortunately, it is buggy, see #24960 (fixed in #32894, using this ticket). We will promote the spkg `primecount` to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.


Upstream patch: https://github.com/kimwalisch/primesieve/pull/107 (rejected)

---
Below is the original part, no longer too relevant.

---
We move the evaluation part as a standalone function in `arith/` and provide alternative implementations
- using `PARI/GP` (only efficient in the range of tabulated primes)
- using the different algorithms in the library primecount that is packaged in #24966




CC:  @mkoeppe @miguelmarco @isuruf

Branch/Commit: b9b4eaf334c6dd5261ccd229ca825b01b600e6a6

Upstream: Fixed upstream, but not in a stable release.

Reviewer: Matthias Koeppe

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25009





---

archive/issue_comments_475758.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,5 +13,5 @@\n ```\n We move the evaluation part as a standalone function in `arith/` and provide alternative implementations\n - using `PARI/GP` (only efficient in the range of tabulated primes)\n-- using primecount that is packaged in #24966\n+- using the differenta algorithms from primecount that is packaged in #24966\n \n``````\n",
    "created_at": "2018-03-18T21:53:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475758",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,5 +13,5 @@
 ```
 We move the evaluation part as a standalone function in `arith/` and provide alternative implementations
 - using `PARI/GP` (only efficient in the range of tabulated primes)
-- using primecount that is packaged in #24966
+- using the differenta algorithms from primecount that is packaged in #24966
 
``````




---

archive/issue_comments_475759.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-The `prime_pi` function is currently a symbolic function that can holds its argument as in\n+The `prime_pi` function is currently a symbolic function that can hold its argument as in\n \n ```\n sage: n = SR.var('n')\n@@ -13,5 +13,5 @@\n ```\n We move the evaluation part as a standalone function in `arith/` and provide alternative implementations\n - using `PARI/GP` (only efficient in the range of tabulated primes)\n-- using the differenta algorithms from primecount that is packaged in #24966\n+- using the different algorithms in the library primecount that is packaged in #24966\n \n``````\n",
    "created_at": "2018-03-18T21:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475759",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-The `prime_pi` function is currently a symbolic function that can holds its argument as in
+The `prime_pi` function is currently a symbolic function that can hold its argument as in
 
 ```
 sage: n = SR.var('n')
@@ -13,5 +13,5 @@
 ```
 We move the evaluation part as a standalone function in `arith/` and provide alternative implementations
 - using `PARI/GP` (only efficient in the range of tabulated primes)
-- using the differenta algorithms from primecount that is packaged in #24966
+- using the different algorithms in the library primecount that is packaged in #24966
 
``````




---

archive/issue_comments_475760.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[1297aba](https://git.sagemath.org/sage.git/commit?id=1297abafb22446d85864691738cbcaa7117b4ec5)|`package primecount`|\n|[3e2d53d](https://git.sagemath.org/sage.git/commit?id=3e2d53dcbf308b397af6b2aa3a3236821ee40244)|`draft for 25009`|",
    "created_at": "2018-03-19T09:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475760",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[1297aba](https://git.sagemath.org/sage.git/commit?id=1297abafb22446d85864691738cbcaa7117b4ec5)|`package primecount`|
|[3e2d53d](https://git.sagemath.org/sage.git/commit?id=3e2d53dcbf308b397af6b2aa3a3236821ee40244)|`draft for 25009`|



---

archive/issue_comments_475761.json:
```json
{
    "body": "Changing commit from \"\" to \"3e2d53dcbf308b397af6b2aa3a3236821ee40244\"",
    "created_at": "2018-03-19T09:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475761",
    "user": "https://github.com/videlec"
}
```

Changing commit from "" to "3e2d53dcbf308b397af6b2aa3a3236821ee40244"



---

archive/issue_comments_475762.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vdelecroix/25009-draft\"",
    "created_at": "2018-03-19T09:14:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475762",
    "user": "https://github.com/videlec"
}
```

Changing branch from "" to "u/vdelecroix/25009-draft"



---

archive/issue_comments_475763.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe package `primecount` has been provided with Sage since version 8.3, has been updated several times and is already outdated https://repology.org/project/primecount/versions\n\nIs it time to start using it?\n\nBecause `sage.libs.primecount` uses an optional library, in the modularization of sagelib it would have to be split out to a separate package. But since `src/sage/libs/primecount.pxd` and `src/sage/interfaces/primecount.pyx` do not depend on Sage at all (except for a use of `sage.misc.superseded`), it would be best to make it a standalone Python library, like you did with `pplpy`.",
    "created_at": "2021-07-06T01:09:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475763",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
The package `primecount` has been provided with Sage since version 8.3, has been updated several times and is already outdated https://repology.org/project/primecount/versions

Is it time to start using it?

Because `sage.libs.primecount` uses an optional library, in the modularization of sagelib it would have to be split out to a separate package. But since `src/sage/libs/primecount.pxd` and `src/sage/interfaces/primecount.pyx` do not depend on Sage at all (except for a use of `sage.misc.superseded`), it would be best to make it a standalone Python library, like you did with `pplpy`.



---

archive/issue_events_062728.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-06T01:32:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25009#event-62728"
}
```



---

archive/issue_events_062729.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25009#event-62729"
}
```



---

archive/issue_events_062730.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25009#event-62730"
}
```



---

archive/issue_comments_475764.json:
```json
{
    "body": "<a id='comment:7'></a>\n`prime_pi` is slow, quite buggy (see #24960), and should be ditched in favour of calling `primecount`.",
    "created_at": "2021-11-12T22:39:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475764",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>
`prime_pi` is slow, quite buggy (see #24960), and should be ditched in favour of calling `primecount`.



---

archive/issue_comments_475765.json:
```json
{
    "body": "Changing dependencies from \"#24966\" to \"\"",
    "created_at": "2021-11-15T11:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475765",
    "user": "https://github.com/dimpase"
}
```

Changing dependencies from "#24966" to ""



---

archive/issue_comments_475766.json:
```json
{
    "body": "Changing commit from \"3e2d53dcbf308b397af6b2aa3a3236821ee40244\" to \"1e24a4a159f79bd3c3e18b819951caa7282eb925\"",
    "created_at": "2021-11-15T11:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475766",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "3e2d53dcbf308b397af6b2aa3a3236821ee40244" to "1e24a4a159f79bd3c3e18b819951caa7282eb925"



---

archive/issue_comments_475767.json:
```json
{
    "body": "<a id='comment:8'></a>\nbump to 7.1, and standard, remove deprecations\n\n---\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[1e24a4a](https://git.sagemath.org/sage.git/commit?id=1e24a4a159f79bd3c3e18b819951caa7282eb925)|`bump primecount to ver. 7.1, and standard`|",
    "created_at": "2021-11-15T11:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475767",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
bump to 7.1, and standard, remove deprecations

---
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[1e24a4a](https://git.sagemath.org/sage.git/commit?id=1e24a4a159f79bd3c3e18b819951caa7282eb925)|`bump primecount to ver. 7.1, and standard`|



---

archive/issue_comments_475768.json:
```json
{
    "body": "Changing branch from \"u/vdelecroix/25009-draft\" to \"u/dimpase/packages/primecount/update-to-standard\"",
    "created_at": "2021-11-15T11:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475768",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "u/vdelecroix/25009-draft" to "u/dimpase/packages/primecount/update-to-standard"



---

archive/issue_comments_475769.json:
```json
{
    "body": "<a id='comment:10'></a>\nthis is a start for fixing #24960",
    "created_at": "2021-11-15T11:33:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475769",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
this is a start for fixing #24960



---

archive/issue_comments_475770.json:
```json
{
    "body": "<a id='comment:11'></a>\nI am not sure whether there is much value in the branch `u/vdelecroix/25009-draft`, \nas functions mentioned there are no longer in `primecount.hpp`, they are in `primecount-internal.hpp`, cf. https://github.com/kimwalisch/primecount\n\nThat is, they are not for public consumption. Let us use this ticket to update and promote the package to standard.",
    "created_at": "2021-11-16T11:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475770",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
I am not sure whether there is much value in the branch `u/vdelecroix/25009-draft`, 
as functions mentioned there are no longer in `primecount.hpp`, they are in `primecount-internal.hpp`, cf. https://github.com/kimwalisch/primecount

That is, they are not for public consumption. Let us use this ticket to update and promote the package to standard.



---

archive/issue_comments_475771.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,6 +11,12 @@\n sage: prime_pi(13543)\n 1603\n ```\n+Unfortunately, it is buggy, see #24960. We will promote the spkg primecount to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.\n+\n+---\n+Below is the original part, no longer too relevant.\n+\n+---\n We move the evaluation part as a standalone function in `arith/` and provide alternative implementations\n - using `PARI/GP` (only efficient in the range of tabulated primes)\n - using the different algorithms in the library primecount that is packaged in #24966\n``````\n",
    "created_at": "2021-11-16T11:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475771",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,6 +11,12 @@
 sage: prime_pi(13543)
 1603
 ```
+Unfortunately, it is buggy, see #24960. We will promote the spkg primecount to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.
+
+---
+Below is the original part, no longer too relevant.
+
+---
 We move the evaluation part as a standalone function in `arith/` and provide alternative implementations
 - using `PARI/GP` (only efficient in the range of tabulated primes)
 - using the different algorithms in the library primecount that is packaged in #24966
``````




---

archive/issue_comments_475772.json:
```json
{
    "body": "Changing author from \"\" to \"Dima Pasechnik\"",
    "created_at": "2021-11-16T11:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475772",
    "user": "https://github.com/dimpase"
}
```

Changing author from "" to "Dima Pasechnik"



---

archive/issue_comments_475773.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-11-16T11:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475773",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_475774.json:
```json
{
    "body": "Changing commit from \"1e24a4a159f79bd3c3e18b819951caa7282eb925\" to \"a660ee48e378dae2a21212c165709ae7d4d88304\"",
    "created_at": "2021-11-16T13:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475774",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "1e24a4a159f79bd3c3e18b819951caa7282eb925" to "a660ee48e378dae2a21212c165709ae7d4d88304"



---

archive/issue_comments_475775.json:
```json
{
    "body": "<a id='comment:12'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|\n|[a660ee4](https://git.sagemath.org/sage.git/commit/?id=a660ee48e378dae2a21212c165709ae7d4d88304)|`removed deprecations`|",
    "created_at": "2021-11-16T13:56:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475775",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------|
|[a660ee4](https://git.sagemath.org/sage.git/commit/?id=a660ee48e378dae2a21212c165709ae7d4d88304)|`removed deprecations`|



---

archive/issue_comments_475776.json:
```json
{
    "body": "<a id='comment:13'></a>\nChanges from optional to standard require a vote on sage-devel",
    "created_at": "2021-11-16T17:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475776",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Changes from optional to standard require a vote on sage-devel



---

archive/issue_comments_475777.json:
```json
{
    "body": "<a id='comment:14'></a>\nIt fixes a serious bug, I can't imagine any objections. Feel free to call the vote, though.",
    "created_at": "2021-11-16T18:05:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475777",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
It fixes a serious bug, I can't imagine any objections. Feel free to call the vote, though.



---

archive/issue_comments_475778.json:
```json
{
    "body": "<a id='comment:15'></a>\nThe new version also needs portability testing",
    "created_at": "2021-11-16T18:12:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475778",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
The new version also needs portability testing



---

archive/issue_comments_475779.json:
```json
{
    "body": "<a id='comment:16'></a>\nfor what it's worth, it works on a 32-bit Ubuntu 18.04",
    "created_at": "2021-11-17T14:01:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475779",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
for what it's worth, it works on a 32-bit Ubuntu 18.04



---

archive/issue_comments_475780.json:
```json
{
    "body": "Changing commit from \"a660ee48e378dae2a21212c165709ae7d4d88304\" to \"e094a4a1221676e3b5f87ece361a38a4276b53d9\"",
    "created_at": "2021-11-17T14:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475780",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a660ee48e378dae2a21212c165709ae7d4d88304" to "e094a4a1221676e3b5f87ece361a38a4276b53d9"



---

archive/issue_comments_475781.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[e094a4a](https://git.sagemath.org/sage.git/commit/?id=e094a4a1221676e3b5f87ece361a38a4276b53d9)|`add primecount to various config files`|",
    "created_at": "2021-11-17T14:26:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475781",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[e094a4a](https://git.sagemath.org/sage.git/commit/?id=e094a4a1221676e3b5f87ece361a38a4276b53d9)|`add primecount to various config files`|



---

archive/issue_comments_475782.json:
```json
{
    "body": "<a id='comment:18'></a>\ndo we want to handle conversion to an external package here, or on a follow-up?",
    "created_at": "2021-11-17T14:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475782",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
do we want to handle conversion to an external package here, or on a follow-up?



---

archive/issue_comments_475783.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [dimpase](#comment%3A18):\n> do we want to handle conversion to an external package here, or on a follow-up?\n\n\nI think it's not totally trivial, as this would need `setup.py` code for calling cmake to build the C++ library (yuck).",
    "created_at": "2021-11-17T16:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475783",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
Replying to [dimpase](#comment%3A18):
> do we want to handle conversion to an external package here, or on a follow-up?


I think it's not totally trivial, as this would need `setup.py` code for calling cmake to build the C++ library (yuck).



---

archive/issue_comments_475784.json:
```json
{
    "body": "<a id='comment:20'></a>\nNo, the new Python package would not need to build the primecount library.\nJust like pplpy - which also does not build the ppl library.",
    "created_at": "2021-11-17T17:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475784",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
No, the new Python package would not need to build the primecount library.
Just like pplpy - which also does not build the ppl library.



---

archive/issue_comments_475785.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [mkoeppe](#comment%3A20):\n> No, the new Python package would not need to build the primecount library.\n> Just like pplpy - which also does not build the ppl library.\n\n\nreading https://gitlab.com/videlec/pplpy/-/blob/master/setup.py does not make me wiser, and anyway it's not a good example, as we're building it as a part of sagelib, anyway.\n\nAs primecount isn't always available as a system library, there should be some need for configuring paths, etc. \n\nThat all that can be done in 10 minutes is, hmm, a joke.",
    "created_at": "2021-11-17T17:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475785",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>
Replying to [mkoeppe](#comment%3A20):
> No, the new Python package would not need to build the primecount library.
> Just like pplpy - which also does not build the ppl library.


reading https://gitlab.com/videlec/pplpy/-/blob/master/setup.py does not make me wiser, and anyway it's not a good example, as we're building it as a part of sagelib, anyway.

As primecount isn't always available as a system library, there should be some need for configuring paths, etc. 

That all that can be done in 10 minutes is, hmm, a joke.



---

archive/issue_comments_475786.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [dimpase](#comment%3A21):\n> As primecount isn't always available as a system library, there should be some need for configuring paths\n\n\nNo, just assume that it's available and fail otherwise.",
    "created_at": "2021-11-17T17:18:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475786",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
Replying to [dimpase](#comment%3A21):
> As primecount isn't always available as a system library, there should be some need for configuring paths


No, just assume that it's available and fail otherwise.



---

archive/issue_comments_475787.json:
```json
{
    "body": "<a id='comment:23'></a>\nI've spent 180 minutes fighting idiotic Cython errors, in an attempt to make a stand-alone package. Something like\n\n```\nprimecount/primecount.pyx:66:6: Function signature does not match previous declaration\nwarning: primecount/primecount.pyx:86:6: Function 'phi' previously declared as 'cpdef'\n```\nIt's above my paygrade to create Cython setups, sorry. Put it on another ticket.\nThe Cython docs are a joke.",
    "created_at": "2021-11-17T19:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475787",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>
I've spent 180 minutes fighting idiotic Cython errors, in an attempt to make a stand-alone package. Something like

```
primecount/primecount.pyx:66:6: Function signature does not match previous declaration
warning: primecount/primecount.pyx:86:6: Function 'phi' previously declared as 'cpdef'
```
It's above my paygrade to create Cython setups, sorry. Put it on another ticket.
The Cython docs are a joke.



---

archive/issue_comments_475788.json:
```json
{
    "body": "<a id='comment:24'></a>\nYou may try https://github.com/dimpase/primecount at ./sage --buildsh prompt - that's as far as I got\n\n```\n$ python3 setup.py build_ext --inplace\nrunning build_ext\nCompiling primecount/primecount.pyx because it changed.\n[1/1] Cythonizing primecount/primecount.pyx\nwarning: primecount/primecount.pyx:66:6: Function 'nth_prime' previously declared as 'cpdef'\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n    sig_on()\n    ans = primecount.pi(s)\n    sig_off()\n    return PyInt_FromString(ans, NULL, 10)\n\ncpdef int64_t nth_prime(int64_t n) except -1:\n     ^\n------------------------------------------------------------\n\nprimecount/primecount.pyx:66:6: Function signature does not match previous declaration\nwarning: primecount/primecount.pyx:86:6: Function 'phi' previously declared as 'cpdef'\n\nError compiling Cython file:\n------------------------------------------------------------\n...\n    if _do_sig(n): sig_on()\n    ans = primecount.nth_prime(n)\n    if _do_sig(n): sig_off()\n    return ans\n\ncpdef int64_t phi(int64_t x, int64_t a):\n     ^\n------------------------------------------------------------\n\nprimecount/primecount.pyx:86:6: Function signature does not match previous declaration\nTraceback (most recent call last):\n  File \"/home/dimpase/work/primecount/setup.py\", line 28, in <module>\n    setup(\n  File \"/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/setuptools/__init__.py\", line 153, in setup\n    return distutils.core.setup(**attrs)\n  File \"/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/setuptools/_distutils/core.py\", line 148, in setup\n    dist.run_commands()\n  File \"/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/setuptools/_distutils/dist.py\", line 967, in run_commands\n    self.run_command(cmd)\n  File \"/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/setuptools/_distutils/dist.py\", line 986, in run_command\n    cmd_obj.run()\n  File \"/home/dimpase/work/primecount/setup.py\", line 9, in run\n    self.distribution.ext_modules[:] = cythonize(\n  File \"/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/Cython/Build/Dependencies.py\", line 1102, in cythonize\n    cythonize_one(*args)\n  File \"/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/Cython/Build/Dependencies.py\", line 1225, in cythonize_one\n    raise CompileError(None, pyx_file)\nCython.Compiler.Errors.CompileError: primecount/primecount.pyx\n(sage-buildsh) dimpase@penguin:primecount$ \n```",
    "created_at": "2021-11-17T20:16:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475788",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
You may try https://github.com/dimpase/primecount at ./sage --buildsh prompt - that's as far as I got

```
$ python3 setup.py build_ext --inplace
running build_ext
Compiling primecount/primecount.pyx because it changed.
[1/1] Cythonizing primecount/primecount.pyx
warning: primecount/primecount.pyx:66:6: Function 'nth_prime' previously declared as 'cpdef'

Error compiling Cython file:
------------------------------------------------------------
...
    sig_on()
    ans = primecount.pi(s)
    sig_off()
    return PyInt_FromString(ans, NULL, 10)

cpdef int64_t nth_prime(int64_t n) except -1:
     ^
------------------------------------------------------------

primecount/primecount.pyx:66:6: Function signature does not match previous declaration
warning: primecount/primecount.pyx:86:6: Function 'phi' previously declared as 'cpdef'

Error compiling Cython file:
------------------------------------------------------------
...
    if _do_sig(n): sig_on()
    ans = primecount.nth_prime(n)
    if _do_sig(n): sig_off()
    return ans

cpdef int64_t phi(int64_t x, int64_t a):
     ^
------------------------------------------------------------

primecount/primecount.pyx:86:6: Function signature does not match previous declaration
Traceback (most recent call last):
  File "/home/dimpase/work/primecount/setup.py", line 28, in <module>
    setup(
  File "/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
    return distutils.core.setup(**attrs)
  File "/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/setuptools/_distutils/core.py", line 148, in setup
    dist.run_commands()
  File "/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/setuptools/_distutils/dist.py", line 967, in run_commands
    self.run_command(cmd)
  File "/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/setuptools/_distutils/dist.py", line 986, in run_command
    cmd_obj.run()
  File "/home/dimpase/work/primecount/setup.py", line 9, in run
    self.distribution.ext_modules[:] = cythonize(
  File "/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/Cython/Build/Dependencies.py", line 1102, in cythonize
    cythonize_one(*args)
  File "/home/dimpase/work/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/Cython/Build/Dependencies.py", line 1225, in cythonize_one
    raise CompileError(None, pyx_file)
Cython.Compiler.Errors.CompileError: primecount/primecount.pyx
(sage-buildsh) dimpase@penguin:primecount$ 
```



---

archive/issue_comments_475789.json:
```json
{
    "body": "<a id='comment:25'></a>\nI've made it build, but the module doesn't have importable functions, for some reason.",
    "created_at": "2021-11-17T22:36:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475789",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>
I've made it build, but the module doesn't have importable functions, for some reason.



---

archive/issue_comments_475790.json:
```json
{
    "body": "<a id='comment:26'></a>\nThe followup in on #32894 - and needs Cython experts attention. It's far from trivial. \n\nLet's meanwhile get this ticket in.",
    "created_at": "2021-11-18T10:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475790",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>
The followup in on #32894 - and needs Cython experts attention. It's far from trivial. 

Let's meanwhile get this ticket in.



---

archive/issue_comments_475791.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-11-22T08:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475791",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475792.json:
```json
{
    "body": "Changing work_issues from \"\" to \"spin out primesieve\"",
    "created_at": "2021-11-22T08:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475792",
    "user": "https://github.com/dimpase"
}
```

Changing work_issues from "" to "spin out primesieve"



---

archive/issue_comments_475793.json:
```json
{
    "body": "<a id='comment:27'></a>\nOK, we actaully should spin off the library primesieve (https://repology.org/project/primesieve/versions) - which is a dependency here, and (by default primecount vendors it, but has an option not to).\n\nMany distros package primesieve separately, so in particular for using system packages it makes perfect sense. (Perhaps primesieve has potentially independent uses in Sage).",
    "created_at": "2021-11-22T08:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475793",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>
OK, we actaully should spin off the library primesieve (https://repology.org/project/primesieve/versions) - which is a dependency here, and (by default primecount vendors it, but has an option not to).

Many distros package primesieve separately, so in particular for using system packages it makes perfect sense. (Perhaps primesieve has potentially independent uses in Sage).



---

archive/issue_comments_475794.json:
```json
{
    "body": "<a id='comment:28'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[c99b691](https://git.sagemath.org/sage.git/commit/?id=c99b691f7eb839b7f4a6b63216215bfc465c380f)|`bump primecount to ver. 7.1, and standard`|\n|[09c4647](https://git.sagemath.org/sage.git/commit/?id=09c4647526badf0f7397b01ec039d3610c4772f7)|`removed deprecations`|\n|[e9cbcd1](https://git.sagemath.org/sage.git/commit/?id=e9cbcd11225b0c7583df792a4365e515722b452b)|`add primecount to various config files`|\n|[784f89d](https://git.sagemath.org/sage.git/commit/?id=784f89d9de3f0cc2f823b9895842dea35ee7c187)|`split primesieve off primecount`|",
    "created_at": "2021-11-22T14:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475794",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[c99b691](https://git.sagemath.org/sage.git/commit/?id=c99b691f7eb839b7f4a6b63216215bfc465c380f)|`bump primecount to ver. 7.1, and standard`|
|[09c4647](https://git.sagemath.org/sage.git/commit/?id=09c4647526badf0f7397b01ec039d3610c4772f7)|`removed deprecations`|
|[e9cbcd1](https://git.sagemath.org/sage.git/commit/?id=e9cbcd11225b0c7583df792a4365e515722b452b)|`add primecount to various config files`|
|[784f89d](https://git.sagemath.org/sage.git/commit/?id=784f89d9de3f0cc2f823b9895842dea35ee7c187)|`split primesieve off primecount`|



---

archive/issue_comments_475795.json:
```json
{
    "body": "Changing commit from \"e094a4a1221676e3b5f87ece361a38a4276b53d9\" to \"784f89d9de3f0cc2f823b9895842dea35ee7c187\"",
    "created_at": "2021-11-22T14:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475795",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e094a4a1221676e3b5f87ece361a38a4276b53d9" to "784f89d9de3f0cc2f823b9895842dea35ee7c187"



---

archive/issue_comments_475796.json:
```json
{
    "body": "Changing commit from \"784f89d9de3f0cc2f823b9895842dea35ee7c187\" to \"29447182575cb8d7adaa5d4a6f7858f98131c83e\"",
    "created_at": "2021-11-22T23:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475796",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "784f89d9de3f0cc2f823b9895842dea35ee7c187" to "29447182575cb8d7adaa5d4a6f7858f98131c83e"



---

archive/issue_comments_475797.json:
```json
{
    "body": "<a id='comment:29'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[31c2c2e](https://git.sagemath.org/sage.git/commit/?id=31c2c2e4c4abdc81f0ee3841ad8f8b240e5574cd)|`add spkg-configs for primecount/sieve`|\n|[2944718](https://git.sagemath.org/sage.git/commit/?id=29447182575cb8d7adaa5d4a6f7858f98131c83e)|`check version of primesieve in the  config of primecount`|",
    "created_at": "2021-11-22T23:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:29'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[31c2c2e](https://git.sagemath.org/sage.git/commit/?id=31c2c2e4c4abdc81f0ee3841ad8f8b240e5574cd)|`add spkg-configs for primecount/sieve`|
|[2944718](https://git.sagemath.org/sage.git/commit/?id=29447182575cb8d7adaa5d4a6f7858f98131c83e)|`check version of primesieve in the  config of primecount`|



---

archive/issue_comments_475798.json:
```json
{
    "body": "Changing commit from \"29447182575cb8d7adaa5d4a6f7858f98131c83e\" to \"5b30d1d7a12d82155d7c524fe7403affff36604f\"",
    "created_at": "2021-11-23T10:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "29447182575cb8d7adaa5d4a6f7858f98131c83e" to "5b30d1d7a12d82155d7c524fe7403affff36604f"



---

archive/issue_comments_475799.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|\n|[5b30d1d](https://git.sagemath.org/sage.git/commit/?id=5b30d1d7a12d82155d7c524fe7403affff36604f)|`distros info for primecount/sieve`|",
    "created_at": "2021-11-23T10:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------|
|[5b30d1d](https://git.sagemath.org/sage.git/commit/?id=5b30d1d7a12d82155d7c524fe7403affff36604f)|`distros info for primecount/sieve`|



---

archive/issue_comments_475800.json:
```json
{
    "body": "Changing commit from \"5b30d1d7a12d82155d7c524fe7403affff36604f\" to \"e8dbc402fe944247f79ba32faca93f561f336d21\"",
    "created_at": "2021-11-23T14:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5b30d1d7a12d82155d7c524fe7403affff36604f" to "e8dbc402fe944247f79ba32faca93f561f336d21"



---

archive/issue_comments_475801.json:
```json
{
    "body": "<a id='comment:31'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[e8dbc40](https://git.sagemath.org/sage.git/commit/?id=e8dbc402fe944247f79ba32faca93f561f336d21)|`distros info for primecount/sieve, correct m4s`|",
    "created_at": "2021-11-23T14:19:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[e8dbc40](https://git.sagemath.org/sage.git/commit/?id=e8dbc402fe944247f79ba32faca93f561f336d21)|`distros info for primecount/sieve, correct m4s`|



---

archive/issue_comments_475802.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [mkoeppe](#comment%3A13):\n> Changes from optional to standard require a vote on sage-devel\n> \n\nsee https://groups.google.com/g/sage-devel/c/tl_fxCJEh1Y/m/y1R2O7RVBgAJ",
    "created_at": "2021-11-23T14:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475802",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>
Replying to [mkoeppe](#comment%3A13):
> Changes from optional to standard require a vote on sage-devel
> 

see https://groups.google.com/g/sage-devel/c/tl_fxCJEh1Y/m/y1R2O7RVBgAJ



---

archive/issue_comments_475803.json:
```json
{
    "body": "<a id='comment:33'></a>\nthe patch build/pkgs/primecount/patches/sieve_version.patch is proposed to upstream, see\nhttps://github.com/kimwalisch/primecount/pull/47",
    "created_at": "2021-11-23T14:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475803",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:33'></a>
the patch build/pkgs/primecount/patches/sieve_version.patch is proposed to upstream, see
https://github.com/kimwalisch/primecount/pull/47



---

archive/issue_comments_475804.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Reported upstream. No feedback yet.\"",
    "created_at": "2021-11-23T14:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475804",
    "user": "https://github.com/dimpase"
}
```

Changing upstream from "N/A" to "Reported upstream. No feedback yet."



---

archive/issue_comments_475805.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-23T17:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475805",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475806.json:
```json
{
    "body": "<a id='comment:34'></a>\nMatthias, what is\n\n```\n# sage_setup: distribution = sagemath-primecount\n``` \nin the first line of `src/sage/interfaces/primecount.pyx`, and why I have to remove it in order for this branch to work?\n(I'm testing on Fedora 34, where primecount/sieve come from the system, if it matters)",
    "created_at": "2021-11-23T17:11:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475806",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:34'></a>
Matthias, what is

```
# sage_setup: distribution = sagemath-primecount
``` 
in the first line of `src/sage/interfaces/primecount.pyx`, and why I have to remove it in order for this branch to work?
(I'm testing on Fedora 34, where primecount/sieve come from the system, if it matters)



---

archive/issue_comments_475807.json:
```json
{
    "body": "<a id='comment:35'></a>\nIf it's there then the file in question is ignored by `make build`.\nIs it something for optional packages, and so should be removed?",
    "created_at": "2021-11-23T17:13:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475807",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:35'></a>
If it's there then the file in question is ignored by `make build`.
Is it something for optional packages, and so should be removed?



---

archive/issue_comments_475808.json:
```json
{
    "body": "Changing commit from \"e8dbc402fe944247f79ba32faca93f561f336d21\" to \"9ca1f677371aa9834b2094fe56e73b8f4c7f93f2\"",
    "created_at": "2021-11-23T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475808",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e8dbc402fe944247f79ba32faca93f561f336d21" to "9ca1f677371aa9834b2094fe56e73b8f4c7f93f2"



---

archive/issue_comments_475809.json:
```json
{
    "body": "<a id='comment:36'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[c655136](https://git.sagemath.org/sage.git/commit/?id=c6551362711bd09e8d21baf7fd477542eeddf5e5)|`remove sagemath-primecount declaration`|\n|[9ca1f67](https://git.sagemath.org/sage.git/commit/?id=9ca1f677371aa9834b2094fe56e73b8f4c7f93f2)|`misc config changes for primesieve`|",
    "created_at": "2021-11-23T17:29:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475809",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[c655136](https://git.sagemath.org/sage.git/commit/?id=c6551362711bd09e8d21baf7fd477542eeddf5e5)|`remove sagemath-primecount declaration`|
|[9ca1f67](https://git.sagemath.org/sage.git/commit/?id=9ca1f677371aa9834b2094fe56e73b8f4c7f93f2)|`misc config changes for primesieve`|



---

archive/issue_comments_475810.json:
```json
{
    "body": "<a id='comment:37'></a>\nThe changes to `setup.cfg.m4` and `pyproject.toml.m4` make no sense. These files are for declaring dependencies on Python packages\n\nIn the `dependencies` files, `cmake` should be an order-only dependency",
    "created_at": "2021-11-23T17:54:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475810",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
The changes to `setup.cfg.m4` and `pyproject.toml.m4` make no sense. These files are for declaring dependencies on Python packages

In the `dependencies` files, `cmake` should be an order-only dependency



---

archive/issue_comments_475811.json:
```json
{
    "body": "<a id='comment:38'></a>\nIn the `dependencies` of sagelib, it's probably not necessary to repeat `primesieve`",
    "created_at": "2021-11-23T17:57:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475811",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
In the `dependencies` of sagelib, it's probably not necessary to repeat `primesieve`



---

archive/issue_comments_475812.json:
```json
{
    "body": "<a id='comment:39'></a>\n`sdh_cmake` already sets `CMAKE_INSTALL_PREFIX`, no need to repeat it",
    "created_at": "2021-11-23T17:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475812",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
`sdh_cmake` already sets `CMAKE_INSTALL_PREFIX`, no need to repeat it



---

archive/issue_comments_475813.json:
```json
{
    "body": "Changing work_issues from \"spin out primesieve\" to \"\"",
    "created_at": "2021-11-23T17:58:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475813",
    "user": "https://github.com/mkoeppe"
}
```

Changing work_issues from "spin out primesieve" to ""



---

archive/issue_comments_475814.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [dimpase](#comment%3A34):\n> Matthias, what is\n> \n> ```\n> # sage_setup: distribution = sagemath-primecount\n> ``` \n> in the first line of `src/sage/interfaces/primecount.pyx`, and why I have to remove it in order for this branch to work?\n\n\nThe sagelib build system removes this file when `primecount` is not present.\nSee https://github.com/sagemath/sage/blob/develop/pkgs/sagemath-standard/setup.py#L76",
    "created_at": "2021-11-23T18:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475814",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Replying to [dimpase](#comment%3A34):
> Matthias, what is
> 
> ```
> # sage_setup: distribution = sagemath-primecount
> ``` 
> in the first line of `src/sage/interfaces/primecount.pyx`, and why I have to remove it in order for this branch to work?


The sagelib build system removes this file when `primecount` is not present.
See https://github.com/sagemath/sage/blob/develop/pkgs/sagemath-standard/setup.py#L76



---

archive/issue_comments_475815.json:
```json
{
    "body": "<a id='comment:42'></a>\nAnd this mechanism does not know anything about system packages.\n\nAs this ticket is making `primecount` a standard package, removing the `sage_setup: distribution` annotation is OK.",
    "created_at": "2021-11-23T18:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475815",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
And this mechanism does not know anything about system packages.

As this ticket is making `primecount` a standard package, removing the `sage_setup: distribution` annotation is OK.



---

archive/issue_comments_475816.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [mkoeppe](#comment%3A39):\n> `sdh_cmake` already sets `CMAKE_INSTALL_PREFIX`, no need to repeat it\n\n{{{\n$ git grep CMAKE_INSTALL_PREFIX \nbuild/bin/sage-dist-helpers:#    GNUInstallDirs module) so that `CMAKE_INSTALL_PREFIX` and\nbuild/bin/sage-dist-helpers:    cmake . -DCMAKE_INSTALL_PREFIX=\"${SAGE_INST_LOCAL}\" \\\nbuild/pkgs/primecount/spkg-install.in:    -DCMAKE_INSTALL_PREFIX=$SAGE_LOCAL \\\nbuild/pkgs/primesieve/spkg-install.in:    -DCMAKE_INSTALL_PREFIX=$SAGE_LOCAL \\\nbuild/pkgs/scipoptsuite/patches/0003-use-INSTALL_NAME_DIR-fix-for-libscip.patch:+    INSTALL_NAME_DIR \"${CMAKE_INSTALL_PREFIX}/lib\"\nbuild/pkgs/scipoptsuite/spkg-install.in:cmake .. -DCMAKE_INSTALL_PREFIX=\"${SAGE_LOCAL}\"/ -DCMAKE_VERBOSE_MAKEFILE=ON -DGMP_DIR=\"${SAGE_LOCAL}\" -DZLIB_ROOT=\"${SAGE_LOCAL}\" -DReadline_ROOT_DIR=\"${SAGE_LOCAL}\" -DBLISS_DIR=\"${SAGE_LOCAL}\" -DIPOPT=FALSE\nbuild/pkgs/symengine/spkg-install.in:cmake -DCMAKE_INSTALL_PREFIX=\"$SAGE_LOCAL\" \\\nsrc/doc/en/developer/packaging.rst:   that ``CMAKE_INSTALL_PREFIX`` and ``CMAKE_INSTALL_LIBDIR`` are set\n}}}\n\nso few other packages do this too - `symengine`, `scipoptsuite`",
    "created_at": "2021-11-23T18:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475816",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:43'></a>
Replying to [mkoeppe](#comment%3A39):
> `sdh_cmake` already sets `CMAKE_INSTALL_PREFIX`, no need to repeat it

{{{
$ git grep CMAKE_INSTALL_PREFIX 
build/bin/sage-dist-helpers:#    GNUInstallDirs module) so that `CMAKE_INSTALL_PREFIX` and
build/bin/sage-dist-helpers:    cmake . -DCMAKE_INSTALL_PREFIX="${SAGE_INST_LOCAL}" \
build/pkgs/primecount/spkg-install.in:    -DCMAKE_INSTALL_PREFIX=$SAGE_LOCAL \
build/pkgs/primesieve/spkg-install.in:    -DCMAKE_INSTALL_PREFIX=$SAGE_LOCAL \
build/pkgs/scipoptsuite/patches/0003-use-INSTALL_NAME_DIR-fix-for-libscip.patch:+    INSTALL_NAME_DIR "${CMAKE_INSTALL_PREFIX}/lib"
build/pkgs/scipoptsuite/spkg-install.in:cmake .. -DCMAKE_INSTALL_PREFIX="${SAGE_LOCAL}"/ -DCMAKE_VERBOSE_MAKEFILE=ON -DGMP_DIR="${SAGE_LOCAL}" -DZLIB_ROOT="${SAGE_LOCAL}" -DReadline_ROOT_DIR="${SAGE_LOCAL}" -DBLISS_DIR="${SAGE_LOCAL}" -DIPOPT=FALSE
build/pkgs/symengine/spkg-install.in:cmake -DCMAKE_INSTALL_PREFIX="$SAGE_LOCAL" \
src/doc/en/developer/packaging.rst:   that ``CMAKE_INSTALL_PREFIX`` and ``CMAKE_INSTALL_LIBDIR`` are set
}}}

so few other packages do this too - `symengine`, `scipoptsuite`



---

archive/issue_comments_475817.json:
```json
{
    "body": "<a id='comment:44'></a>\nThat can be cleaned up on this ticket as well, I think",
    "created_at": "2021-11-23T18:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475817",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
That can be cleaned up on this ticket as well, I think



---

archive/issue_comments_475818.json:
```json
{
    "body": "<a id='comment:45'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[d8e2cda](https://git.sagemath.org/sage.git/commit/?id=d8e2cda4f1efb33cfc028e24e6f6869226408ba5)|`adjust deps,remove stuff from cfg and toml`|",
    "created_at": "2021-11-23T18:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[d8e2cda](https://git.sagemath.org/sage.git/commit/?id=d8e2cda4f1efb33cfc028e24e6f6869226408ba5)|`adjust deps,remove stuff from cfg and toml`|



---

archive/issue_comments_475819.json:
```json
{
    "body": "Changing commit from \"9ca1f677371aa9834b2094fe56e73b8f4c7f93f2\" to \"d8e2cda4f1efb33cfc028e24e6f6869226408ba5\"",
    "created_at": "2021-11-23T18:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "9ca1f677371aa9834b2094fe56e73b8f4c7f93f2" to "d8e2cda4f1efb33cfc028e24e6f6869226408ba5"



---

archive/issue_comments_475820.json:
```json
{
    "body": "Changing commit from \"d8e2cda4f1efb33cfc028e24e6f6869226408ba5\" to \"abce309cd4ae20219c220ebd00a0c954146915fe\"",
    "created_at": "2021-11-23T18:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d8e2cda4f1efb33cfc028e24e6f6869226408ba5" to "abce309cd4ae20219c220ebd00a0c954146915fe"



---

archive/issue_comments_475821.json:
```json
{
    "body": "<a id='comment:46'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|\n|[3f1e441](https://git.sagemath.org/sage.git/commit/?id=3f1e441ba8bf1972d2d02e0f0e7f2313d69037b3)|`no need for CMAKE_INSTALL_PREFIX (it's in sdh_cmake)`|\n|[abce309](https://git.sagemath.org/sage.git/commit/?id=abce309cd4ae20219c220ebd00a0c954146915fe)|`flyby patch: remove CMAKE_INSTALL_PREFIX, as it's set in sdh_cmake`|",
    "created_at": "2021-11-23T18:39:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
|[3f1e441](https://git.sagemath.org/sage.git/commit/?id=3f1e441ba8bf1972d2d02e0f0e7f2313d69037b3)|`no need for CMAKE_INSTALL_PREFIX (it's in sdh_cmake)`|
|[abce309](https://git.sagemath.org/sage.git/commit/?id=abce309cd4ae20219c220ebd00a0c954146915fe)|`flyby patch: remove CMAKE_INSTALL_PREFIX, as it's set in sdh_cmake`|



---

archive/issue_comments_475822.json:
```json
{
    "body": "<a id='comment:47'></a>\ntesting revealed  a packaging bug in Debian - they don't install cmake configs for primesieve, and so primecount (to be built) can't find it. :-( \nHas reported this...\n\nWe can instead cook up something, perhaps patch CMakeList of primecount more,\nmake it rely on pkg-config instead? I don't know (recognising that this is broken without\nactually running cmake is no fun...)",
    "created_at": "2021-11-23T18:43:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475822",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:47'></a>
testing revealed  a packaging bug in Debian - they don't install cmake configs for primesieve, and so primecount (to be built) can't find it. :-( 
Has reported this...

We can instead cook up something, perhaps patch CMakeList of primecount more,
make it rely on pkg-config instead? I don't know (recognising that this is broken without
actually running cmake is no fun...)



---

archive/issue_comments_475823.json:
```json
{
    "body": "<a id='comment:48'></a>\nPerhaps unvendoring `primesieve` is not strictly necessary for this ticket?",
    "created_at": "2021-11-23T18:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475823",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>
Perhaps unvendoring `primesieve` is not strictly necessary for this ticket?



---

archive/issue_comments_475824.json:
```json
{
    "body": "<a id='comment:49'></a>\n... it does not seem to be a very important use case to cater to users on systems that have primesieve but not primecount...",
    "created_at": "2021-11-23T18:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475824",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
... it does not seem to be a very important use case to cater to users on systems that have primesieve but not primecount...



---

archive/issue_comments_475825.json:
```json
{
    "body": "<a id='comment:50'></a>\nwell, I don't mind banning broken system primesieves, but I don't know a sane way to test this. E.g. `cmake --find_package` should do the job, but e.g. on Fedora\n\n```\n$ cmake --find-package -DNAME=primesieve -DCOMPILER_ID=GNU -DLANGUAGE=C -DMODE=link\nCMake Error at /usr/share/cmake/Modules/FindThreads.cmake:66 (message):\n  FindThreads only works if either C or CXX language is enabled\nCall Stack (most recent call first):\n  /usr/share/cmake/Modules/CMakeFindDependencyMacro.cmake:47 (find_package)\n  /usr/lib64/cmake/primesieve/primesieveConfig.cmake:18 (find_dependency)\n  /usr/share/cmake/Modules/CMakeFindPackageMode.cmake:183 (find_package)\n\n\nprimesieve not found.\nCMake Error: Run 'cmake --help' for all supported options.\nclpc171[/home/scratch2/dimpase/sage/sage-clang]$ cmake --find-package -DNAME=primesieve -DCOMPILER_ID=GNU -DLANGUAGE=C -DMODE=LINK\nCMake Error at /usr/share/cmake/Modules/FindThreads.cmake:66 (message):\n  FindThreads only works if either C or CXX language is enabled\nCall Stack (most recent call first):\n  /usr/share/cmake/Modules/CMakeFindDependencyMacro.cmake:47 (find_package)\n  /usr/lib64/cmake/primesieve/primesieveConfig.cmake:18 (find_dependency)\n  /usr/share/cmake/Modules/CMakeFindPackageMode.cmake:183 (find_package)\n\n\nprimesieve not found.\nCMake Error: Run 'cmake --help' for all supported options.\n```",
    "created_at": "2021-11-23T19:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475825",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:50'></a>
well, I don't mind banning broken system primesieves, but I don't know a sane way to test this. E.g. `cmake --find_package` should do the job, but e.g. on Fedora

```
$ cmake --find-package -DNAME=primesieve -DCOMPILER_ID=GNU -DLANGUAGE=C -DMODE=link
CMake Error at /usr/share/cmake/Modules/FindThreads.cmake:66 (message):
  FindThreads only works if either C or CXX language is enabled
Call Stack (most recent call first):
  /usr/share/cmake/Modules/CMakeFindDependencyMacro.cmake:47 (find_package)
  /usr/lib64/cmake/primesieve/primesieveConfig.cmake:18 (find_dependency)
  /usr/share/cmake/Modules/CMakeFindPackageMode.cmake:183 (find_package)


primesieve not found.
CMake Error: Run 'cmake --help' for all supported options.
clpc171[/home/scratch2/dimpase/sage/sage-clang]$ cmake --find-package -DNAME=primesieve -DCOMPILER_ID=GNU -DLANGUAGE=C -DMODE=LINK
CMake Error at /usr/share/cmake/Modules/FindThreads.cmake:66 (message):
  FindThreads only works if either C or CXX language is enabled
Call Stack (most recent call first):
  /usr/share/cmake/Modules/CMakeFindDependencyMacro.cmake:47 (find_package)
  /usr/lib64/cmake/primesieve/primesieveConfig.cmake:18 (find_dependency)
  /usr/share/cmake/Modules/CMakeFindPackageMode.cmake:183 (find_package)


primesieve not found.
CMake Error: Run 'cmake --help' for all supported options.
```



---

archive/issue_comments_475826.json:
```json
{
    "body": "<a id='comment:51'></a>\nHow about, in case of failure of cmake in spkg-install of primecount, just trying running cmake without `-DBUILD_LIBPRIMESIEVE=OFF` - then primesieve will be built ?",
    "created_at": "2021-11-23T19:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475826",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:51'></a>
How about, in case of failure of cmake in spkg-install of primecount, just trying running cmake without `-DBUILD_LIBPRIMESIEVE=OFF` - then primesieve will be built ?



---

archive/issue_comments_475827.json:
```json
{
    "body": "Changing upstream from \"Reported upstream. No feedback yet.\" to \"Fixed upstream, but not in a stable release.\"",
    "created_at": "2021-11-23T20:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475827",
    "user": "https://github.com/dimpase"
}
```

Changing upstream from "Reported upstream. No feedback yet." to "Fixed upstream, but not in a stable release."



---

archive/issue_comments_475828.json:
```json
{
    "body": "<a id='comment:53'></a>\nDebian fixed it in the latest unstable.",
    "created_at": "2021-11-23T20:14:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475828",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:53'></a>
Debian fixed it in the latest unstable.



---

archive/issue_comments_475829.json:
```json
{
    "body": "<a id='comment:54'></a>\nWe actually have a catch-22 situation - we cannot reliably configure standard packages with `cmake`, as we don't guarantee its presence at the moment.\n\nSo cmake must be promoted to a hard pre-requisite.\n\nI don't mind this, though...",
    "created_at": "2021-11-24T00:34:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475829",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:54'></a>
We actually have a catch-22 situation - we cannot reliably configure standard packages with `cmake`, as we don't guarantee its presence at the moment.

So cmake must be promoted to a hard pre-requisite.

I don't mind this, though...



---

archive/issue_comments_475830.json:
```json
{
    "body": "<a id='comment:55'></a>\nWhen there's no system `cmake`, it makes no sense to look for system libraries' `cmake` information.",
    "created_at": "2021-11-24T00:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475830",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>
When there's no system `cmake`, it makes no sense to look for system libraries' `cmake` information.



---

archive/issue_comments_475831.json:
```json
{
    "body": "<a id='comment:56'></a>\nbut you can't configure/build a standard package which relies on `cmake` if there is no `cmake` on the system.\n\nWhile autotools can generate a configure script to be shipped, cmake only generated makefiles, not good enough for shipping.",
    "created_at": "2021-11-24T00:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475831",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:56'></a>
but you can't configure/build a standard package which relies on `cmake` if there is no `cmake` on the system.

While autotools can generate a configure script to be shipped, cmake only generated makefiles, not good enough for shipping.



---

archive/issue_comments_475832.json:
```json
{
    "body": "<a id='comment:57'></a>\nwe need to treat cmake spkg as we treat patch spkg.\n\nI'd rather just get rid of patch as well, and make it a pre-req, too, though.",
    "created_at": "2021-11-24T00:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475832",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:57'></a>
we need to treat cmake spkg as we treat patch spkg.

I'd rather just get rid of patch as well, and make it a pre-req, too, though.



---

archive/issue_comments_475833.json:
```json
{
    "body": "<a id='comment:58'></a>\nWhy do you think that we need `cmake` earlier than at the time of building packages?",
    "created_at": "2021-11-24T00:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475833",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
Why do you think that we need `cmake` earlier than at the time of building packages?



---

archive/issue_comments_475834.json:
```json
{
    "body": "<a id='comment:59'></a>\nReplying to [mkoeppe](#comment%3A58):\n> Why do you think that we need `cmake` earlier than at the time of building packages?\n\n\nah, right, I was actually using cmake in an spkg-configure.m4, but then decided it's too much trouble. But it's stuck in my mind that something fishy. Sorry for noise.",
    "created_at": "2021-11-24T00:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475834",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:59'></a>
Replying to [mkoeppe](#comment%3A58):
> Why do you think that we need `cmake` earlier than at the time of building packages?


ah, right, I was actually using cmake in an spkg-configure.m4, but then decided it's too much trouble. But it's stuck in my mind that something fishy. Sorry for noise.



---

archive/issue_comments_475835.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [dimpase](#comment%3A59):\n> using cmake in an spkg-configure.m4\n\n\nThis was what I was referring to in[comment:55](#comment%3A55). If there's no system cmake but finding a library has to depend on that library's installed cmake information, then the `spkg-configure.m4` should just fail.",
    "created_at": "2021-11-24T00:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475835",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>
Replying to [dimpase](#comment%3A59):
> using cmake in an spkg-configure.m4


This was what I was referring to in[comment:55](#comment%3A55). If there's no system cmake but finding a library has to depend on that library's installed cmake information, then the `spkg-configure.m4` should just fail.



---

archive/issue_comments_475836.json:
```json
{
    "body": "<a id='comment:61'></a>\nReplying to [dimpase](#comment%3A51):\n> How about, in case of failure of cmake in spkg-install of primecount, just trying running cmake without `-DBUILD_LIBPRIMESIEVE=OFF` - then primesieve will be built ?\n\n\nOK, here I need a shell programming advice. The problem I don't know how to solve is that cmake triggers an exit if it fails, so it teminates spkg-install script in case of failure. But I just want to know the result, and try something different if it fails.\n\nI hoped something like this would work:\n\n```\nprimc_config() {\necho \"Configuring primecount: building primesieve $1\"\nsdh_cmake -DCMAKE_VERBOSE_MAKEFILE=ON \\\n          -DBUILD_STATIC_LIBS=OFF \\\n          -DBUILD_SHARED_LIBS=ON \\\n          -DBUILD_TESTS=ON \\\n          -DBUILD_LIBPRIMESIEVE=$1 \\\n          -DCMAKE_FIND_ROOT_PATH=$SAGE_LOCAL/lib/cmake \\\n          -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=BOTH \\\n          -DCMAKE_INSTALL_PREFIX=$SAGE_LOCAL \\\n          ${EXTRA_OPTS} && echo OKOKOK && sdh_make_install\n}\n\nset -e\nprimc_config OFF || primc_config ON\n```\n\nbut no, if the 1st call to primc_config fails in cmake, it just terminates the script.",
    "created_at": "2021-11-24T00:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475836",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:61'></a>
Replying to [dimpase](#comment%3A51):
> How about, in case of failure of cmake in spkg-install of primecount, just trying running cmake without `-DBUILD_LIBPRIMESIEVE=OFF` - then primesieve will be built ?


OK, here I need a shell programming advice. The problem I don't know how to solve is that cmake triggers an exit if it fails, so it teminates spkg-install script in case of failure. But I just want to know the result, and try something different if it fails.

I hoped something like this would work:

```
primc_config() {
echo "Configuring primecount: building primesieve $1"
sdh_cmake -DCMAKE_VERBOSE_MAKEFILE=ON \
          -DBUILD_STATIC_LIBS=OFF \
          -DBUILD_SHARED_LIBS=ON \
          -DBUILD_TESTS=ON \
          -DBUILD_LIBPRIMESIEVE=$1 \
          -DCMAKE_FIND_ROOT_PATH=$SAGE_LOCAL/lib/cmake \
          -DCMAKE_FIND_ROOT_PATH_MODE_LIBRARY=BOTH \
          -DCMAKE_INSTALL_PREFIX=$SAGE_LOCAL \
          ${EXTRA_OPTS} && echo OKOKOK && sdh_make_install
}

set -e
primc_config OFF || primc_config ON
```

but no, if the 1st call to primc_config fails in cmake, it just terminates the script.



---

archive/issue_comments_475837.json:
```json
{
    "body": "<a id='comment:62'></a>\nuse a sub-shell: `(exit 1) || echo survived`",
    "created_at": "2021-11-24T01:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475837",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>
use a sub-shell: `(exit 1) || echo survived`



---

archive/issue_comments_475838.json:
```json
{
    "body": "Changing commit from \"abce309cd4ae20219c220ebd00a0c954146915fe\" to \"a6de7f427004aac442e177d58ad47a2ef2b637e8\"",
    "created_at": "2021-11-24T09:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475838",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "abce309cd4ae20219c220ebd00a0c954146915fe" to "a6de7f427004aac442e177d58ad47a2ef2b637e8"



---

archive/issue_comments_475839.json:
```json
{
    "body": "<a id='comment:63'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|\n|[a6de7f4](https://git.sagemath.org/sage.git/commit/?id=a6de7f427004aac442e177d58ad47a2ef2b637e8)|`check external primesieve with cmake`|",
    "created_at": "2021-11-24T09:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475839",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:63'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------|
|[a6de7f4](https://git.sagemath.org/sage.git/commit/?id=a6de7f427004aac442e177d58ad47a2ef2b637e8)|`check external primesieve with cmake`|



---

archive/issue_comments_475840.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [mkoeppe](#comment%3A62):\n> use a sub-shell: `(exit 1) || echo survived`\n\n\nOK, great, thanks. This helps.\n\nNow ready for review.",
    "created_at": "2021-11-24T09:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475840",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:64'></a>
Replying to [mkoeppe](#comment%3A62):
> use a sub-shell: `(exit 1) || echo survived`


OK, great, thanks. This helps.

Now ready for review.



---

archive/issue_comments_475841.json:
```json
{
    "body": "<a id='comment:65'></a>\nTime to ping more upstreams to package primecount and primesieve.\nDebian people are already busy with it.",
    "created_at": "2021-11-24T09:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475841",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:65'></a>
Time to ping more upstreams to package primecount and primesieve.
Debian people are already busy with it.



---

archive/issue_comments_475842.json:
```json
{
    "body": "<a id='comment:66'></a>\nNeeds portability testing",
    "created_at": "2021-11-24T17:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475842",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>
Needs portability testing



---

archive/issue_comments_475843.json:
```json
{
    "body": "<a id='comment:67'></a>\nReplying to [mkoeppe](#comment%3A66):\n> Needs portability testing\n\nrunning here: https://github.com/sagemath/sagetrac-mirror/actions/runs/1500740315",
    "created_at": "2021-11-24T18:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475843",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:67'></a>
Replying to [mkoeppe](#comment%3A66):
> Needs portability testing

running here: https://github.com/sagemath/sagetrac-mirror/actions/runs/1500740315



---

archive/issue_comments_475844.json:
```json
{
    "body": "Changing reviewer from \"\" to \"https://github.com/sagemath/sagetrac-mirror/actions/runs/1500740315\"",
    "created_at": "2021-11-24T18:44:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475844",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "https://github.com/sagemath/sagetrac-mirror/actions/runs/1500740315"



---

archive/issue_comments_475845.json:
```json
{
    "body": "<a id='comment:68'></a>\nsome tests are failing due to #32828",
    "created_at": "2021-11-25T11:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475845",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:68'></a>
some tests are failing due to #32828



---

archive/issue_comments_475846.json:
```json
{
    "body": "<a id='comment:69'></a>\nOn `fedora-30-standard` (https://github.com/sagemath/sagetrac-mirror/runs/4316021585?check_suite_focus=true): \n`Error: Unable to find a match: primecount primecount-devel`.\n\nThis means that you'll have to set `IGNORE_MISSING_SYSTEM_PACKAGES=yes` for `fedora-30` in `tox.ini`.",
    "created_at": "2021-11-26T21:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475846",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>
On `fedora-30-standard` (https://github.com/sagemath/sagetrac-mirror/runs/4316021585?check_suite_focus=true): 
`Error: Unable to find a match: primecount primecount-devel`.

This means that you'll have to set `IGNORE_MISSING_SYSTEM_PACKAGES=yes` for `fedora-30` in `tox.ini`.



---

archive/issue_comments_475847.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-11-26T21:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475847",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_475848.json:
```json
{
    "body": "<a id='comment:70'></a>\nwell, accoding to https://fedoraproject.org/wiki/End_of_life already 31 and 32 are past EOL. How many past-EOL releases should we go? OK, one or two, but three...",
    "created_at": "2021-11-26T22:27:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475848",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:70'></a>
well, accoding to https://fedoraproject.org/wiki/End_of_life already 31 and 32 are past EOL. How many past-EOL releases should we go? OK, one or two, but three...



---

archive/issue_comments_475849.json:
```json
{
    "body": "<a id='comment:71'></a>\nWe are supporting this version, and it is not within the scope of this ticket to break it.",
    "created_at": "2021-11-26T22:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475849",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>
We are supporting this version, and it is not within the scope of this ticket to break it.



---

archive/issue_comments_475850.json:
```json
{
    "body": "Changing commit from \"a6de7f427004aac442e177d58ad47a2ef2b637e8\" to \"f754d069812b65253cda1c9d29da092b02105bf4\"",
    "created_at": "2021-11-26T23:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475850",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a6de7f427004aac442e177d58ad47a2ef2b637e8" to "f754d069812b65253cda1c9d29da092b02105bf4"



---

archive/issue_comments_475851.json:
```json
{
    "body": "<a id='comment:72'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|\n|[f754d06](https://git.sagemath.org/sage.git/commit/?id=f754d069812b65253cda1c9d29da092b02105bf4)|`fedora 30 doesn't have primecount pkg`|",
    "created_at": "2021-11-26T23:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475851",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:72'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------|
|[f754d06](https://git.sagemath.org/sage.git/commit/?id=f754d069812b65253cda1c9d29da092b02105bf4)|`fedora 30 doesn't have primecount pkg`|



---

archive/issue_comments_475852.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,7 +11,7 @@\n sage: prime_pi(13543)\n 1603\n ```\n-Unfortunately, it is buggy, see #24960. We will promote the spkg primecount to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.\n+Unfortunately, it is buggy, see #24960 (fixed in #32894, using this ticket). We will promote the spkg primecount to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.\n \n ---\n Below is the original part, no longer too relevant.\n``````\n",
    "created_at": "2021-11-26T23:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475852",
    "user": "https://github.com/dimpase"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,7 +11,7 @@
 sage: prime_pi(13543)
 1603
 ```
-Unfortunately, it is buggy, see #24960. We will promote the spkg primecount to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.
+Unfortunately, it is buggy, see #24960 (fixed in #32894, using this ticket). We will promote the spkg primecount to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.
 
 ---
 Below is the original part, no longer too relevant.
``````




---

archive/issue_comments_475853.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-11-26T23:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475853",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_475854.json:
```json
{
    "body": "<a id='comment:74'></a>\n`primesieve` does not build on some of our still supported platforms. I have a patch (https://github.com/kimwalisch/primesieve/pull/107) for fixing most of them, but upstream does not want it. With the patch, there is one remaining failing platform, `debian-jessie` (https://github.com/kimwalisch/primesieve/issues/108), upstream indicates wontfix.",
    "created_at": "2021-11-28T19:32:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475854",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:74'></a>
`primesieve` does not build on some of our still supported platforms. I have a patch (https://github.com/kimwalisch/primesieve/pull/107) for fixing most of them, but upstream does not want it. With the patch, there is one remaining failing platform, `debian-jessie` (https://github.com/kimwalisch/primesieve/issues/108), upstream indicates wontfix.



---

archive/issue_comments_475855.json:
```json
{
    "body": "<a id='comment:75'></a>\ntime to drop gcc 4-based systems...",
    "created_at": "2021-11-28T19:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475855",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:75'></a>
time to drop gcc 4-based systems...



---

archive/issue_comments_475856.json:
```json
{
    "body": "<a id='comment:76'></a>\nPlease feel free to add patches.",
    "created_at": "2021-11-28T20:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475856",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:76'></a>
Please feel free to add patches.



---

archive/issue_comments_475857.json:
```json
{
    "body": "Changing branch from \"u/dimpase/packages/primecount/update-to-standard\" to \"u/mkoeppe/packages/primecount/update-to-standard\"",
    "created_at": "2021-11-28T20:31:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475857",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "u/dimpase/packages/primecount/update-to-standard" to "u/mkoeppe/packages/primecount/update-to-standard"



---

archive/issue_comments_475858.json:
```json
{
    "body": "<a id='comment:78'></a>\nReplying to [dimpase](#comment%3A75):\n> time to drop gcc 4-based systems...\n\nYes, soon, I'd say.\nIt would just feel a bit excessive to do so just for a single function.\n\nI'll see if the failure on `debian-jessie` is as easy to fix as the other failures were. If not, we can drop `debian-jessie` in 9.5 already, it seems to have a particularly messy compiler.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                         |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|\n|[b9b4eaf](https://git.sagemath.org/sage.git/commit?id=b9b4eaf334c6dd5261ccd229ca825b01b600e6a6)|`build/pkgs/primesieve: Add patch to support ubuntu-trusty, linuxmint-17`|",
    "created_at": "2021-11-28T20:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475858",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'></a>
Replying to [dimpase](#comment%3A75):
> time to drop gcc 4-based systems...

Yes, soon, I'd say.
It would just feel a bit excessive to do so just for a single function.

I'll see if the failure on `debian-jessie` is as easy to fix as the other failures were. If not, we can drop `debian-jessie` in 9.5 already, it seems to have a particularly messy compiler.

---
New commits:
|                                                                                                                                          |                                                                         |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------|
|[b9b4eaf](https://git.sagemath.org/sage.git/commit?id=b9b4eaf334c6dd5261ccd229ca825b01b600e6a6)|`build/pkgs/primesieve: Add patch to support ubuntu-trusty, linuxmint-17`|



---

archive/issue_comments_475859.json:
```json
{
    "body": "Changing commit from \"f754d069812b65253cda1c9d29da092b02105bf4\" to \"b9b4eaf334c6dd5261ccd229ca825b01b600e6a6\"",
    "created_at": "2021-11-28T20:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475859",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "f754d069812b65253cda1c9d29da092b02105bf4" to "b9b4eaf334c6dd5261ccd229ca825b01b600e6a6"



---

archive/issue_comments_475860.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -21,3 +21,5 @@\n - using `PARI/GP` (only efficient in the range of tabulated primes)\n - using the different algorithms in the library primecount that is packaged in #24966\n \n+\n+Upstream patch: https://github.com/kimwalisch/primesieve/pull/107 (rejected)\n``````\n",
    "created_at": "2021-11-28T20:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475860",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -21,3 +21,5 @@
 - using `PARI/GP` (only efficient in the range of tabulated primes)
 - using the different algorithms in the library primecount that is packaged in #24966
 
+
+Upstream patch: https://github.com/kimwalisch/primesieve/pull/107 (rejected)
``````




---

archive/issue_comments_475861.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -11,7 +11,10 @@\n sage: prime_pi(13543)\n 1603\n ```\n-Unfortunately, it is buggy, see #24960 (fixed in #32894, using this ticket). We will promote the spkg primecount to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.\n+Unfortunately, it is buggy, see #24960 (fixed in #32894, using this ticket). We will promote the spkg `primecount` to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.\n+\n+\n+Upstream patch: https://github.com/kimwalisch/primesieve/pull/107 (rejected)\n \n ---\n Below is the original part, no longer too relevant.\n@@ -22,4 +25,4 @@\n - using the different algorithms in the library primecount that is packaged in #24966\n \n \n-Upstream patch: https://github.com/kimwalisch/primesieve/pull/107 (rejected)\n+\n``````\n",
    "created_at": "2021-11-28T20:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475861",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -11,7 +11,10 @@
 sage: prime_pi(13543)
 1603
 ```
-Unfortunately, it is buggy, see #24960 (fixed in #32894, using this ticket). We will promote the spkg primecount to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.
+Unfortunately, it is buggy, see #24960 (fixed in #32894, using this ticket). We will promote the spkg `primecount` to standard and use it instead. This ticket does this part, and reverts deprecations from #32412. It also removes obsolete deprecation warning, and the corresponding no longer available parameter.
+
+
+Upstream patch: https://github.com/kimwalisch/primesieve/pull/107 (rejected)
 
 ---
 Below is the original part, no longer too relevant.
@@ -22,4 +25,4 @@
 - using the different algorithms in the library primecount that is packaged in #24966
 
 
-Upstream patch: https://github.com/kimwalisch/primesieve/pull/107 (rejected)
+
``````




---

archive/issue_comments_475862.json:
```json
{
    "body": "<a id='comment:81'></a>\nIMHO the patch for `std:align` should go into `gcc` spkg, not here.\nTest if it's there, if not, put it into `std` namespace, instead of patching around all the C++ code\naffected by it.\n\nWhile strictly speaking putting new functions into namespace `std` is undefined behaviour, with gcc is just works (IMHO).",
    "created_at": "2021-11-29T11:44:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475862",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:81'></a>
IMHO the patch for `std:align` should go into `gcc` spkg, not here.
Test if it's there, if not, put it into `std` namespace, instead of patching around all the C++ code
affected by it.

While strictly speaking putting new functions into namespace `std` is undefined behaviour, with gcc is just works (IMHO).



---

archive/issue_comments_475863.json:
```json
{
    "body": "<a id='comment:82'></a>\n`primesieve` is the only the package that needs it. \n\nAnd patching the system compiler sounds like a terrible idea.",
    "created_at": "2021-11-29T17:43:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475863",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:82'></a>
`primesieve` is the only the package that needs it. 

And patching the system compiler sounds like a terrible idea.



---

archive/issue_comments_475864.json:
```json
{
    "body": "<a id='comment:83'></a>\nthe compiler is OK in this case, it's STL that it's not.\n\nIf I recall correctly, that's how we patched STLs for CGAL back in 1999:\n\nAll you need to to is to put `-I foo/bar/` into CXXFLAGS, and put into `foo/bar` a file named `memory`, where one puts `#include <memory>` and an implementation of `align()` inside `namespace std {...}` block.",
    "created_at": "2021-11-29T19:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475864",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:83'></a>
the compiler is OK in this case, it's STL that it's not.

If I recall correctly, that's how we patched STLs for CGAL back in 1999:

All you need to to is to put `-I foo/bar/` into CXXFLAGS, and put into `foo/bar` a file named `memory`, where one puts `#include <memory>` and an implementation of `align()` inside `namespace std {...}` block.



---

archive/issue_comments_475865.json:
```json
{
    "body": "<a id='comment:84'></a>\nSure, that's another way to do this, but I don't think it's better than what's already done and tested",
    "created_at": "2021-11-29T19:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475865",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:84'></a>
Sure, that's another way to do this, but I don't think it's better than what's already done and tested



---

archive/issue_comments_475866.json:
```json
{
    "body": "<a id='comment:85'></a>\nOK, I've just rebased the branch of #32894 over the branch here, and will do a run on GH Actions there.\nIt will test this ticket along the way, too.",
    "created_at": "2021-11-29T20:19:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475866",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:85'></a>
OK, I've just rebased the branch of #32894 over the branch here, and will do a run on GH Actions there.
It will test this ticket along the way, too.



---

archive/issue_comments_475867.json:
```json
{
    "body": "<a id='comment:86'></a>\ntests on https://github.com/sagemath/sagetrac-mirror/actions/runs/1517758345 (with primecountpy)",
    "created_at": "2021-11-29T20:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475867",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:86'></a>
tests on https://github.com/sagemath/sagetrac-mirror/actions/runs/1517758345 (with primecountpy)



---

archive/issue_comments_475868.json:
```json
{
    "body": "Changing reviewer from \"https://github.com/sagemath/sagetrac-mirror/actions/runs/1500740315\" to \"Matthias Koeppe\"",
    "created_at": "2021-12-02T18:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475868",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "https://github.com/sagemath/sagetrac-mirror/actions/runs/1500740315" to "Matthias Koeppe"



---

archive/issue_comments_475869.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-02T18:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475869",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_475870.json:
```json
{
    "body": "<a id='comment:88'></a>\nCan you add `primecount` to `distros/conda.txt`?",
    "created_at": "2021-12-02T19:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475870",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:88'></a>
Can you add `primecount` to `distros/conda.txt`?



---

archive/issue_comments_475871.json:
```json
{
    "body": "<a id='comment:89'></a>\nReplying to [isuruf](#comment%3A88):\n> Can you add `primecount` to `distros/conda.txt`?\n\ndone on #32894 (to minimize rebasing :))",
    "created_at": "2021-12-02T20:42:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475871",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:89'></a>
Replying to [isuruf](#comment%3A88):
> Can you add `primecount` to `distros/conda.txt`?

done on #32894 (to minimize rebasing :))



---

archive/issue_events_062731.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-12-12T15:09:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25009#event-62731"
}
```



---

archive/issue_comments_475872.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/packages/primecount/update-to-standard\" to \"b9b4eaf334c6dd5261ccd229ca825b01b600e6a6\"",
    "created_at": "2021-12-12T15:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475872",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/packages/primecount/update-to-standard" to "b9b4eaf334c6dd5261ccd229ca825b01b600e6a6"



---

archive/issue_comments_475873.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-12-12T15:09:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25009",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25009#issuecomment-475873",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
