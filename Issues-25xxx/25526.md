# Issue 25526: Factor iterator in suffix tree of word

archive/issues_025289.json:
```json
{
    "body": "We improve the algorithm computing the factor iterator in the implicit suffix tree of a word.\n\nBEFORE:\n\n```\nsage: w = words.FibonacciWord([0,1])\nsage: it = w[:10000].suffix_tree().factor_iterator()\nsage: %time L = list(it)\nProcessus arr\u00eat\u00e9\n```\n\nAFTER:\n\n```\nsage: w = words.FibonacciWord([0,1])\nsage: it = w[:10000].suffix_tree().factor_iterator()\nsage: %time L = list(it)\nCPU times: user 14 s, sys: 504 ms, total: 14.5 s\nWall time: 14.5 s\nsage: len(L)\n24337601\n```\n\nCC:  @videlec @seblabbe\n\nKeywords: thursdaysbdx\n\nBranch/Commit: d7bcfdf912a443172e2a3a94adeaf0cd9c978b69\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Vincent Delecroix, \u00c9lise Vandomme\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25526\n\n",
    "closed_at": "2018-06-22T22:58:36Z",
    "created_at": "2018-06-07T09:42:04Z",
    "labels": [
        "component: combinatorics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Factor iterator in suffix tree of word",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25526",
    "user": "https://trac.sagemath.org/admin/accounts/users/evandomme"
}
```
We improve the algorithm computing the factor iterator in the implicit suffix tree of a word.

BEFORE:

```
sage: w = words.FibonacciWord([0,1])
sage: it = w[:10000].suffix_tree().factor_iterator()
sage: %time L = list(it)
Processus arrêté
```

AFTER:

```
sage: w = words.FibonacciWord([0,1])
sage: it = w[:10000].suffix_tree().factor_iterator()
sage: %time L = list(it)
CPU times: user 14 s, sys: 504 ms, total: 14.5 s
Wall time: 14.5 s
sage: len(L)
24337601
```

CC:  @videlec @seblabbe

Keywords: thursdaysbdx

Branch/Commit: d7bcfdf912a443172e2a3a94adeaf0cd9c978b69

Reviewer: Sébastien Labbé

Author: Vincent Delecroix, Élise Vandomme

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25526





---

archive/issue_comments_482603.json:
```json
{
    "body": "Changing branch from \"\" to \"u/evandomme/factor_iterator_in_suffix_tree_of_word\"",
    "created_at": "2018-06-07T13:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482603",
    "user": "https://trac.sagemath.org/admin/accounts/users/evandomme"
}
```

Changing branch from "" to "u/evandomme/factor_iterator_in_suffix_tree_of_word"



---

archive/issue_comments_482604.json:
```json
{
    "body": "Changing commit from \"\" to \"d7bcfdf912a443172e2a3a94adeaf0cd9c978b69\"",
    "created_at": "2018-06-21T08:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482604",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "" to "d7bcfdf912a443172e2a3a94adeaf0cd9c978b69"



---

archive/issue_comments_482605.json:
```json
{
    "body": "<a id='comment:2'></a>\nDoes the branch needs review?\n\n---\nNew commits:\n|                                                                                                                                          |                                                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|\n|[d7bcfdf](https://github.com/sagemath/sagetrac-mirror/commit/d7bcfdf912a443172e2a3a94adeaf0cd9c978b69)|`Better implmentation of the factor iterator in suffix tree of words`|",
    "created_at": "2018-06-21T08:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482605",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'></a>
Does the branch needs review?

---
New commits:
|                                                                                                                                          |                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------|
|[d7bcfdf](https://github.com/sagemath/sagetrac-mirror/commit/d7bcfdf912a443172e2a3a94adeaf0cd9c978b69)|`Better implmentation of the factor iterator in suffix tree of words`|



---

archive/issue_comments_482606.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-21T08:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482606",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_482607.json:
```json
{
    "body": "<a id='comment:3'></a>\nCan you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?",
    "created_at": "2018-06-21T08:33:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482607",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>
Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?



---

archive/issue_comments_482608.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-21T08:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482608",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_482609.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [slabbe](#comment%3A3):\n> Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?\n\n\nNo. The reason is that there is no guarantee that iterating through a dictionary via `iteritems` you always get the same order (you can check that in the doctests there are `sorted` everywhere). But before this ticket, it was clearly not a DFS\n\n```\nsage: for w in Word(\"cacao\").suffix_tree().factor_iterator(): print w\nc\na\nac\naca\nao\nacao\no\nca\ncac\ncaca\ncao\ncacao\n```\nWith this ticket it is\n\n```\nsage: for w in Word(\"cacao\").suffix_tree().factor_iterator(): print w\na\nao\nac\naca\nacao\no\nc\nca\ncao\ncac\ncaca\ncacao\n```",
    "created_at": "2018-06-21T08:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482609",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Replying to [slabbe](#comment%3A3):
> Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?


No. The reason is that there is no guarantee that iterating through a dictionary via `iteritems` you always get the same order (you can check that in the doctests there are `sorted` everywhere). But before this ticket, it was clearly not a DFS

```
sage: for w in Word("cacao").suffix_tree().factor_iterator(): print w
c
a
ac
aca
ao
acao
o
ca
cac
caca
cao
cacao
```
With this ticket it is

```
sage: for w in Word("cacao").suffix_tree().factor_iterator(): print w
a
ao
ac
aca
acao
o
c
ca
cao
cac
caca
cacao
```



---

archive/issue_comments_482610.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [vdelecroix](#comment%3A5):\n> Replying to [slabbe](#comment%3A3):\n> > Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?\n\n> \n> No. \n\n\nI was asking in the description of the ticket not in a doctest.",
    "created_at": "2018-06-21T12:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482610",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:6'></a>
Replying to [vdelecroix](#comment%3A5):
> Replying to [slabbe](#comment%3A3):
> > Can you provide an example in the description of the ticket that shows how better the code has become with the improvement you propose?

> 
> No. 


I was asking in the description of the ticket not in a doctest.



---

archive/issue_comments_482611.json:
```json
{
    "body": "<a id='comment:7'></a>\nBefore this ticket, this just eats all the memory and CPU:\n\n```\nsage: w = words.FibonacciWord([0,1])\nsage: it = w[:10000].suffix_tree().factor_iterator()\nsage: %time L = list(it)\nProcessus arr\u00eat\u00e9\n```\n\nWith the branch of this ticket, I get:\n\n```\nsage: w = words.FibonacciWord([0,1])\nsage: it = w[:10000].suffix_tree().factor_iterator()\nsage: %time L = list(it)\nCPU times: user 14 s, sys: 504 ms, total: 14.5 s\nWall time: 14.5 s\nsage: len(L)\n24337601\n```\n\nSo, it is definitely an improvement.",
    "created_at": "2018-06-21T13:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482611",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:7'></a>
Before this ticket, this just eats all the memory and CPU:

```
sage: w = words.FibonacciWord([0,1])
sage: it = w[:10000].suffix_tree().factor_iterator()
sage: %time L = list(it)
Processus arrêté
```

With the branch of this ticket, I get:

```
sage: w = words.FibonacciWord([0,1])
sage: it = w[:10000].suffix_tree().factor_iterator()
sage: %time L = list(it)
CPU times: user 14 s, sys: 504 ms, total: 14.5 s
Wall time: 14.5 s
sage: len(L)
24337601
```

So, it is definitely an improvement.



---

archive/issue_comments_482612.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-06-21T13:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482612",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_482613.json:
```json
{
    "body": "Changing reviewer from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2018-06-21T13:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482613",
    "user": "https://github.com/seblabbe"
}
```

Changing reviewer from "" to "Sébastien Labbé"



---

archive/issue_comments_482614.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,22 @@\n We improve the algorithm computing the factor iterator in the implicit suffix tree of a word.\n+\n+BEFORE:\n+\n+```\n+sage: w = words.FibonacciWord([0,1])\n+sage: it = w[:10000].suffix_tree().factor_iterator()\n+sage: %time L = list(it)\n+Processus arr\u00eat\u00e9\n+```\n+\n+AFTER:\n+\n+```\n+sage: w = words.FibonacciWord([0,1])\n+sage: it = w[:10000].suffix_tree().factor_iterator()\n+sage: %time L = list(it)\n+CPU times: user 14 s, sys: 504 ms, total: 14.5 s\n+Wall time: 14.5 s\n+sage: len(L)\n+24337601\n+```\n``````\n",
    "created_at": "2018-06-21T13:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482614",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,22 @@
 We improve the algorithm computing the factor iterator in the implicit suffix tree of a word.
+
+BEFORE:
+
+```
+sage: w = words.FibonacciWord([0,1])
+sage: it = w[:10000].suffix_tree().factor_iterator()
+sage: %time L = list(it)
+Processus arrêté
+```
+
+AFTER:
+
+```
+sage: w = words.FibonacciWord([0,1])
+sage: it = w[:10000].suffix_tree().factor_iterator()
+sage: %time L = list(it)
+CPU times: user 14 s, sys: 504 ms, total: 14.5 s
+Wall time: 14.5 s
+sage: len(L)
+24337601
+```
``````




---

archive/issue_comments_482615.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-22T22:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482615",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_482616.json:
```json
{
    "body": "Changing branch from \"u/evandomme/factor_iterator_in_suffix_tree_of_word\" to \"d7bcfdf912a443172e2a3a94adeaf0cd9c978b69\"",
    "created_at": "2018-06-22T22:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25526#issuecomment-482616",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/evandomme/factor_iterator_in_suffix_tree_of_word" to "d7bcfdf912a443172e2a3a94adeaf0cd9c978b69"



---

archive/issue_events_080612.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-22T22:58:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25526",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25526#event-80612"
}
```
