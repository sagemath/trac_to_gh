# Issue 25421: Clean factorial/multifactorial

archive/issues_025184.json:
```json
{
    "body": "- GMP has a `mpz_2fac_ui` and `mpz_mfac_uiui` that we use in the `multifactorial` method of integers.\n- we remove the conversion to symbolic ring of `factorial` method of integers and raise an `OverflowError` instead\n\n```\nsage: (2**64).factorial()\nfactorial(18446744073709551616)\n```\n  becomes\n\n```\nsage: (2**64).factorial()\nTraceback (most recent call last):\n...\nOverflowError: argument too large for factorial\n```\n- we fix the silent conversion of floating point to integers\n\n```\nsage: factorial(2.0)\n2\n```\n  becomes\n\n```\nsage: factorial(2.0)\n2.00000000000000\n```\n  and as a by product, factorial can be computed on real balls\n\n```\nsage: factorial(RBF(2)**64)\n[+/- 2.30e+347382171305201370464]\n```\n\nCC:  tmonteil\n\nKeywords: MathExp2018\n\nReviewer: Marc Mezzarobba\n\nAuthor: Vincent Delecroix\n\nBranch: 29155941146f37a45784de75ac1e0727bf55d84a\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25421\n\n",
    "closed_at": "2018-06-01T15:42:07Z",
    "created_at": "2018-05-22T08:24:15Z",
    "labels": [
        "component: number theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Clean factorial/multifactorial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25421",
    "user": "https://github.com/videlec"
}
```
- GMP has a `mpz_2fac_ui` and `mpz_mfac_uiui` that we use in the `multifactorial` method of integers.
- we remove the conversion to symbolic ring of `factorial` method of integers and raise an `OverflowError` instead

```
sage: (2**64).factorial()
factorial(18446744073709551616)
```
  becomes

```
sage: (2**64).factorial()
Traceback (most recent call last):
...
OverflowError: argument too large for factorial
```
- we fix the silent conversion of floating point to integers

```
sage: factorial(2.0)
2
```
  becomes

```
sage: factorial(2.0)
2.00000000000000
```
  and as a by product, factorial can be computed on real balls

```
sage: factorial(RBF(2)**64)
[+/- 2.30e+347382171305201370464]
```

CC:  tmonteil

Keywords: MathExp2018

Reviewer: Marc Mezzarobba

Author: Vincent Delecroix

Branch: 29155941146f37a45784de75ac1e0727bf55d84a

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25421





---

archive/issue_comments_354245.json:
```json
{
    "body": "Changing keywords from \"mathexp2018\" to \"MathExp2018\".",
    "created_at": "2018-05-22T11:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354245",
    "user": "https://github.com/videlec"
}
```

Changing keywords from "mathexp2018" to "MathExp2018".



---

archive/issue_comments_354246.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-29T10:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354246",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_354247.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2018-05-29T10:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354247",
    "user": "https://github.com/videlec"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_354248.json:
```json
{
    "body": "<a id='comment:5'></a>Hi Vincent,\n\nLGTM. Some minor remarks though:\n\n```\n+        -  ``n`` - a non-negative integer, a complex numberargument (except negative\n```\n\nMissing space.\n\n```\n         one it is the product of every k-th terms down from self to\n-        k. The recursive definition is used to extend this function to\n+        1. The recursive definition is used to extend this function to\n```\n\nMaybe move the 1 to the previous line.\n\n```\n+                try:\n+                    res = method()\n+                except Exception:\n+                    pass\n```\n\nAre you sure you want to catch all exceptions? I think `ValueError` and `ArithmeticError` should be enough.",
    "created_at": "2018-05-29T18:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354248",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:5'></a>Hi Vincent,

LGTM. Some minor remarks though:

```
+        -  ``n`` - a non-negative integer, a complex numberargument (except negative
```

Missing space.

```
         one it is the product of every k-th terms down from self to
-        k. The recursive definition is used to extend this function to
+        1. The recursive definition is used to extend this function to
```

Maybe move the 1 to the previous line.

```
+                try:
+                    res = method()
+                except Exception:
+                    pass
```

Are you sure you want to catch all exceptions? I think `ValueError` and `ArithmeticError` should be enough.



---

archive/issue_comments_354249.json:
```json
{
    "body": "<a id='comment:6'></a>Salut Marc!\n\nReplying to [comment:5 mmezzarobba]:\n> {{{\n> +                try:\n> +                    res = method()\n> +                except Exception:\n> +                    pass\n> }}}\n> \n> Are you sure you want to catch all exceptions? I think `ValueError` and `ArithmeticError` should be enough.\n\n\nHere I just wanted to catch the `OverflowError` from factorial...",
    "created_at": "2018-05-29T18:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354249",
    "user": "https://github.com/videlec"
}
```

<a id='comment:6'></a>Salut Marc!

Replying to [comment:5 mmezzarobba]:
> {{{
> +                try:
> +                    res = method()
> +                except Exception:
> +                    pass
> }}}
> 
> Are you sure you want to catch all exceptions? I think `ValueError` and `ArithmeticError` should be enough.


Here I just wanted to catch the `OverflowError` from factorial...



---

archive/issue_comments_354250.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-29T22:24:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354250",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_354251.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 vdelecroix]:\n> Salut Marc!\n> \n> Replying to [comment:5 mmezzarobba]:\n> > {{{\n> > +                try:\n> > +                    res = method()\n> > +                except Exception:\n> > +                    pass\n> > }}}\n> > \n> > Are you sure you want to catch all exceptions? I think `ValueError` and `ArithmeticError` should be enough.\n\n> \n> Here I just wanted to catch the `OverflowError` from factorial...\n\n\nI'm not sure I understand your reply. Isn't that a reason to restrict the exceptions you are catching? (Note that `OverflowError` is a subclass of `ArithmeticError`.)\n\n(And why did you remove the definition of the multifactorial in the last commit?)",
    "created_at": "2018-05-30T08:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354251",
    "user": "https://github.com/mezzarobba"
}
```

<a id='comment:8'></a>Replying to [comment:6 vdelecroix]:
> Salut Marc!
> 
> Replying to [comment:5 mmezzarobba]:
> > {{{
> > +                try:
> > +                    res = method()
> > +                except Exception:
> > +                    pass
> > }}}
> > 
> > Are you sure you want to catch all exceptions? I think `ValueError` and `ArithmeticError` should be enough.

> 
> Here I just wanted to catch the `OverflowError` from factorial...


I'm not sure I understand your reply. Isn't that a reason to restrict the exceptions you are catching? (Note that `OverflowError` is a subclass of `ArithmeticError`.)

(And why did you remove the definition of the multifactorial in the last commit?)



---

archive/issue_comments_354252.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-30T13:14:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_354253.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:8 mmezzarobba]:\n> Replying to [comment:6 vdelecroix]:\n> > Replying to [comment:5 mmezzarobba]:\n\n> (And why did you remove the definition of the multifactorial in the last commit?)\n\nNot always a good thing to work late at night :-)",
    "created_at": "2018-05-30T13:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354253",
    "user": "https://github.com/videlec"
}
```

<a id='comment:10'></a>Replying to [comment:8 mmezzarobba]:
> Replying to [comment:6 vdelecroix]:
> > Replying to [comment:5 mmezzarobba]:

> (And why did you remove the definition of the multifactorial in the last commit?)

Not always a good thing to work late at night :-)



---

archive/issue_comments_354254.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:8 mmezzarobba]:\n> Replying to [comment:6 vdelecroix]:\n> > Salut Marc!\n> > \n> > Replying to [comment:5 mmezzarobba]:\n> > > {{{\n> > > +                try:\n> > > +                    res = method()\n> > > +                except Exception:\n> > > +                    pass\n> > > }}}\n> > > \n> > > Are you sure you want to catch all exceptions? I think `ValueError` and `ArithmeticError` should be enough.\n\n> > \n> > Here I just wanted to catch the `OverflowError` from factorial...\n\n> \n> I'm not sure I understand your reply. Isn't that a reason to restrict the exceptions you are catching? (Note that `OverflowError` is a subclass of `ArithmeticError`.)\n\n\nWorks with the restricted version. I am happy with it.",
    "created_at": "2018-05-30T13:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354254",
    "user": "https://github.com/videlec"
}
```

<a id='comment:11'></a>Replying to [comment:8 mmezzarobba]:
> Replying to [comment:6 vdelecroix]:
> > Salut Marc!
> > 
> > Replying to [comment:5 mmezzarobba]:
> > > {{{
> > > +                try:
> > > +                    res = method()
> > > +                except Exception:
> > > +                    pass
> > > }}}
> > > 
> > > Are you sure you want to catch all exceptions? I think `ValueError` and `ArithmeticError` should be enough.

> > 
> > Here I just wanted to catch the `OverflowError` from factorial...

> 
> I'm not sure I understand your reply. Isn't that a reason to restrict the exceptions you are catching? (Note that `OverflowError` is a subclass of `ArithmeticError`.)


Works with the restricted version. I am happy with it.



---

archive/issue_comments_354255.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-05-30T13:16:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_354256.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-05-31T07:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354256",
    "user": "https://github.com/mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_354257.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-06-01T15:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354257",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063816.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-01T15:42:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25421#event-63816"
}
```



---

archive/issue_comments_354258.json:
```json
{
    "body": "<a id='comment:15'></a>Follow-up at #26749",
    "created_at": "2020-02-20T18:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25421",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25421#issuecomment-354258",
    "user": "https://github.com/slel"
}
```

<a id='comment:15'></a>Follow-up at #26749
