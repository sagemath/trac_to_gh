# Issue 25057: Building ecl-16.1.2 fails on some Cygwin versions

archive/issues_024820.json:
```json
{
    "body": "IIRC I've had this problem for a while but never made a report of it.\n\n```\n[ecl-16.1.2.p5] gcc -DECLDIR=\"\\\"/home/embray/src/sagemath/sage/local/lib/ecl-16.1.2\\\"\" -I. -I/home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/build -I/home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c -I../ecl/gc -DECL_API -DECL_NO_LEGACY   -I/home/embray/src/sagemath/sage/local/include  -g -O0   -Dcygwin -c -o ffi/backtrace.o ffi/backtrace.o.c\n[ecl-16.1.2.p5] /home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c/ffi/backtrace.d: In function 'backtrace_symbols':\n[ecl-16.1.2.p5] /home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c/ffi/backtrace.d:84:9: error: unknown type name 'Dl_info'\n[ecl-16.1.2.p5]          Dl_info data[1];\n[ecl-16.1.2.p5]          ^~~~~~~\n[ecl-16.1.2.p5] /home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c/ffi/backtrace.d:88:21: warning: implicit declaration of function 'dladdr' [-Wimplicit-function-declaration]\n[ecl-16.1.2.p5]                  if (dladdr(buffer[i], data)) {\n[ecl-16.1.2.p5]                      ^~~~~~\n[ecl-16.1.2.p5] /home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c/ffi/backtrace.d:89:42: error: request for member 'dli_sname' in something not a structure or union\n[ecl-16.1.2.p5]                          strings[i] = data->dli_sname;\n[ecl-16.1.2.p5]                                           ^~\n[ecl-16.1.2.p5] make[5]: *** [Makefile:86: ffi/backtrace.o] Error 1\n```\n\nIt works if I run `SAGE_DEBUG=no make ecl`.\n\nAssignee: @embray\n\nBranch/Commit: 981cca9415e4fcee8a1a00f08e50bb5ed6c9c5a3\n\nUpstream: Not yet reported upstream; Will do shortly.\n\nReviewer: Travis Scrimshaw\n\nAuthor: Erik Bray\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25057\n\n",
    "closed_at": "2018-09-27T17:41:19Z",
    "created_at": "2018-03-29T08:43:39Z",
    "labels": [
        "component: porting: cygwin",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Building ecl-16.1.2 fails on some Cygwin versions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25057",
    "user": "https://github.com/embray"
}
```
IIRC I've had this problem for a while but never made a report of it.

```
[ecl-16.1.2.p5] gcc -DECLDIR="\"/home/embray/src/sagemath/sage/local/lib/ecl-16.1.2\"" -I. -I/home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/build -I/home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c -I../ecl/gc -DECL_API -DECL_NO_LEGACY   -I/home/embray/src/sagemath/sage/local/include  -g -O0   -Dcygwin -c -o ffi/backtrace.o ffi/backtrace.o.c
[ecl-16.1.2.p5] /home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c/ffi/backtrace.d: In function 'backtrace_symbols':
[ecl-16.1.2.p5] /home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c/ffi/backtrace.d:84:9: error: unknown type name 'Dl_info'
[ecl-16.1.2.p5]          Dl_info data[1];
[ecl-16.1.2.p5]          ^~~~~~~
[ecl-16.1.2.p5] /home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c/ffi/backtrace.d:88:21: warning: implicit declaration of function 'dladdr' [-Wimplicit-function-declaration]
[ecl-16.1.2.p5]                  if (dladdr(buffer[i], data)) {
[ecl-16.1.2.p5]                      ^~~~~~
[ecl-16.1.2.p5] /home/embray/src/sagemath/sage/local/var/tmp/sage/build/ecl-16.1.2.p5/src/src/c/ffi/backtrace.d:89:42: error: request for member 'dli_sname' in something not a structure or union
[ecl-16.1.2.p5]                          strings[i] = data->dli_sname;
[ecl-16.1.2.p5]                                           ^~
[ecl-16.1.2.p5] make[5]: *** [Makefile:86: ffi/backtrace.o] Error 1
```

It works if I run `SAGE_DEBUG=no make ecl`.

Assignee: @embray

Branch/Commit: 981cca9415e4fcee8a1a00f08e50bb5ed6c9c5a3

Upstream: Not yet reported upstream; Will do shortly.

Reviewer: Travis Scrimshaw

Author: Erik Bray

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25057





---

archive/issue_comments_477087.json:
```json
{
    "body": "Set assignee to @embray.",
    "created_at": "2018-03-29T08:43:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477087",
    "user": "https://github.com/embray"
}
```

Set assignee to @embray.



---

archive/issue_comments_477088.json:
```json
{
    "body": "<a id='comment:2'></a>\nI feel like I've run into a problem with `Dl_info` on Cygwin before, but I can't recall where...",
    "created_at": "2018-03-29T15:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477088",
    "user": "https://github.com/embray"
}
```

<a id='comment:2'></a>
I feel like I've run into a problem with `Dl_info` on Cygwin before, but I can't recall where...



---

archive/issue_comments_477089.json:
```json
{
    "body": "<a id='comment:3'></a>\nI see, `Dl_info` is not defined unless the `_GNU_SOURCE` macro is defined--this the default on Linux, but on Cygwin it is not defined by default.  This should be fixed upstream, but we can also easily add it in.",
    "created_at": "2018-03-29T16:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477089",
    "user": "https://github.com/embray"
}
```

<a id='comment:3'></a>
I see, `Dl_info` is not defined unless the `_GNU_SOURCE` macro is defined--this the default on Linux, but on Cygwin it is not defined by default.  This should be fixed upstream, but we can also easily add it in.



---

archive/issue_comments_477090.json:
```json
{
    "body": "Changing upstream from \"N/A\" to \"Not yet reported upstream; Will do shortly.\"",
    "created_at": "2018-03-29T16:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477090",
    "user": "https://github.com/embray"
}
```

Changing upstream from "N/A" to "Not yet reported upstream; Will do shortly."



---

archive/issue_events_062864.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25057#event-62864"
}
```



---

archive/issue_events_062865.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:57:00Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25057#event-62865"
}
```



---

archive/issue_events_062866.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-07-18T11:57:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25057#event-62866"
}
```



---

archive/issue_comments_477091.json:
```json
{
    "body": "<a id='comment:6'></a>\nJust got this on the buildbot machine I'm trying to set up, mysteriously, even without SAGE_DEBUG defined.  In fact, I'm not sure why this was affected by SAGE_DEBUG in the first place...",
    "created_at": "2018-09-24T15:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477091",
    "user": "https://github.com/embray"
}
```

<a id='comment:6'></a>
Just got this on the buildbot machine I'm trying to set up, mysteriously, even without SAGE_DEBUG defined.  In fact, I'm not sure why this was affected by SAGE_DEBUG in the first place...



---

archive/issue_comments_477092.json:
```json
{
    "body": "<a id='comment:7'></a>\nMy only guess for why I don't get this on my local machine is that it must have something to do with ccache.  I haven't even seen this on the patchbot in a while, which also has a well-primed ccache.  I just have to wonder what's being missed from the ccache hash.  It's also possible this only stopped working on more recent cygwin versions but it's not obvious to me when that would have occurred...",
    "created_at": "2018-09-24T15:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477092",
    "user": "https://github.com/embray"
}
```

<a id='comment:7'></a>
My only guess for why I don't get this on my local machine is that it must have something to do with ccache.  I haven't even seen this on the patchbot in a while, which also has a well-primed ccache.  I just have to wonder what's being missed from the ccache hash.  It's also possible this only stopped working on more recent cygwin versions but it's not obvious to me when that would have occurred...



---

archive/issue_comments_477093.json:
```json
{
    "body": "<a id='comment:8'></a>\nWell, I tried re-building ecl with `CCACHE_DISABLE=1` and it still built, so it probably has something to do with the newlib version or gcc or something.  Very strange...",
    "created_at": "2018-09-25T09:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477093",
    "user": "https://github.com/embray"
}
```

<a id='comment:8'></a>
Well, I tried re-building ecl with `CCACHE_DISABLE=1` and it still built, so it probably has something to do with the newlib version or gcc or something.  Very strange...



---

archive/issue_comments_477094.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2018-09-25T09:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477094",
    "user": "https://github.com/embray"
}
```

Changing priority from major to blocker.



---

archive/issue_events_062867.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-25T09:17:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "milestone": "sage-wishlist",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25057#event-62867"
}
```



---

archive/issue_events_062868.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-09-25T09:17:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25057#event-62868"
}
```



---

archive/issue_comments_477095.json:
```json
{
    "body": "<a id='comment:9'></a>\nSetting this as a blocker since it's preventing building in general, at least, I'm guessing on newer Cygwins.  Fortunately it has an easy workaround.",
    "created_at": "2018-09-25T09:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477095",
    "user": "https://github.com/embray"
}
```

<a id='comment:9'></a>
Setting this as a blocker since it's preventing building in general, at least, I'm guessing on newer Cygwins.  Fortunately it has an easy workaround.



---

archive/issue_comments_477096.json:
```json
{
    "body": "<a id='comment:10'></a>\nFairly trivial fix.  In this case I deliberately did not bump the package version for a few reasons:\n\n1) The main purpose of doing so would be for testing on buildbots, however there is still not yet an automated Cygwin buildbot (ironically, this issue was hit in the process of trying to test and configure one).\n\n2) It only affects Sage on Cygwin--there is no need to waste buildbot time on other platforms that won't be affected by this change.\n\n3) Even on existing builds on Cygwin it is not necessary to re-build ECL due to this change; this will only fix an issue on systems where ECL could not be built in the first place.\n\nI'm happy to bump it anyways if anyone suggests otherwise, but I believe these are good arguments not to in this case.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|\n|[981cca9](https://git.sagemath.org/sage.git/commit?id=981cca9415e4fcee8a1a00f08e50bb5ed6c9c5a3)|`Trac #25057: fix building ECL on Cygwins where Dl_info is not defined without _GNU_SOURCE`|",
    "created_at": "2018-09-25T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477096",
    "user": "https://github.com/embray"
}
```

<a id='comment:10'></a>
Fairly trivial fix.  In this case I deliberately did not bump the package version for a few reasons:

1) The main purpose of doing so would be for testing on buildbots, however there is still not yet an automated Cygwin buildbot (ironically, this issue was hit in the process of trying to test and configure one).

2) It only affects Sage on Cygwin--there is no need to waste buildbot time on other platforms that won't be affected by this change.

3) Even on existing builds on Cygwin it is not necessary to re-build ECL due to this change; this will only fix an issue on systems where ECL could not be built in the first place.

I'm happy to bump it anyways if anyone suggests otherwise, but I believe these are good arguments not to in this case.

---
New commits:
|                                                                                                                                          |                                                                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------|
|[981cca9](https://git.sagemath.org/sage.git/commit?id=981cca9415e4fcee8a1a00f08e50bb5ed6c9c5a3)|`Trac #25057: fix building ECL on Cygwins where Dl_info is not defined without _GNU_SOURCE`|



---

archive/issue_comments_477097.json:
```json
{
    "body": "Changing author from \"\" to \"Erik Bray\"",
    "created_at": "2018-09-25T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477097",
    "user": "https://github.com/embray"
}
```

Changing author from "" to "Erik Bray"



---

archive/issue_comments_477098.json:
```json
{
    "body": "Changing branch from \"\" to \"u/embray/cygwin/ticket-25057\"",
    "created_at": "2018-09-25T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477098",
    "user": "https://github.com/embray"
}
```

Changing branch from "" to "u/embray/cygwin/ticket-25057"



---

archive/issue_comments_477099.json:
```json
{
    "body": "Changing commit from \"\" to \"981cca9415e4fcee8a1a00f08e50bb5ed6c9c5a3\"",
    "created_at": "2018-09-25T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477099",
    "user": "https://github.com/embray"
}
```

Changing commit from "" to "981cca9415e4fcee8a1a00f08e50bb5ed6c9c5a3"



---

archive/issue_comments_477100.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-25T09:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477100",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_477101.json:
```json
{
    "body": "<a id='comment:11'></a>\nWould it help to have a Windows (10? something else) Google CE host running  Cygwin patch/buildbots?\n(I have a grant from Google that lets me do this for the coming 5 months or so).",
    "created_at": "2018-09-25T11:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477101",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
Would it help to have a Windows (10? something else) Google CE host running  Cygwin patch/buildbots?
(I have a grant from Google that lets me do this for the coming 5 months or so).



---

archive/issue_comments_477102.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [dimpase](#comment%3A11):\n> Would it help to have a Windows (10? something else) Google CE host running  Cygwin patch/buildbots?\n> (I have a grant from Google that lets me do this for the coming 5 months or so).\n\n\nIt may or may not.  I've had a number of private conversations about possibilities for hosting such things.  The problem has consistently been that Cygwin under a virtualized host can be rather slow.  This slowness can be mitigated significantly with appropriate control over the VM host, but with cloud services we frequently don't even have that.  I tried setting up a VM on Azure, for example, and it was still rather slow.\n\nAnyways, we now (or will soon) have a buildbot running on a VM once all these blocker issues are fixed.  In the meantime the best thing is having a dedicated host.  We have had discussions about purchasing a machine with OpenDreamKit funds, but I don't know where that's at right now.",
    "created_at": "2018-09-25T12:58:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477102",
    "user": "https://github.com/embray"
}
```

<a id='comment:12'></a>
Replying to [dimpase](#comment%3A11):
> Would it help to have a Windows (10? something else) Google CE host running  Cygwin patch/buildbots?
> (I have a grant from Google that lets me do this for the coming 5 months or so).


It may or may not.  I've had a number of private conversations about possibilities for hosting such things.  The problem has consistently been that Cygwin under a virtualized host can be rather slow.  This slowness can be mitigated significantly with appropriate control over the VM host, but with cloud services we frequently don't even have that.  I tried setting up a VM on Azure, for example, and it was still rather slow.

Anyways, we now (or will soon) have a buildbot running on a VM once all these blocker issues are fixed.  In the meantime the best thing is having a dedicated host.  We have had discussions about purchasing a machine with OpenDreamKit funds, but I don't know where that's at right now.



---

archive/issue_comments_477103.json:
```json
{
    "body": "<a id='comment:13'></a>\nI was not hit with this, but Sage builds on my cygwin just fine with this and it doesn't affect other systems. So I am setting this to a positive review.",
    "created_at": "2018-09-26T03:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477103",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
I was not hit with this, but Sage builds on my cygwin just fine with this and it doesn't affect other systems. So I am setting this to a positive review.



---

archive/issue_comments_477104.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Travis Scrimshaw\"",
    "created_at": "2018-09-26T03:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477104",
    "user": "https://github.com/tscrim"
}
```

Changing reviewer from "" to "Travis Scrimshaw"



---

archive/issue_comments_477105.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-26T03:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477105",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_477106.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks for checking.  Indeed I'm still a little mystified as to why this was affecting this new machine I set up but not others.  But the basic underlying issue is clear.",
    "created_at": "2018-09-26T09:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477106",
    "user": "https://github.com/embray"
}
```

<a id='comment:14'></a>
Thanks for checking.  Indeed I'm still a little mystified as to why this was affecting this new machine I set up but not others.  But the basic underlying issue is clear.



---

archive/issue_events_062869.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-27T17:41:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25057#event-62869"
}
```



---

archive/issue_comments_477107.json:
```json
{
    "body": "Changing branch from \"u/embray/cygwin/ticket-25057\" to \"981cca9415e4fcee8a1a00f08e50bb5ed6c9c5a3\"",
    "created_at": "2018-09-27T17:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477107",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/embray/cygwin/ticket-25057" to "981cca9415e4fcee8a1a00f08e50bb5ed6c9c5a3"



---

archive/issue_comments_477108.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-27T17:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25057",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25057#issuecomment-477108",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
