# Issue 25084: change _invert_unit to inverse_of_unit on integer matrices

archive/issues_024847.json:
```json
{
    "body": "Inverting a ring element usually produces an element in its fraction field.\n\nWhen the ring element is invertible in its parent ring, it can be convenient\nto obtain the inverse as an element in the same ring.\n\nFor consistency with other rings in Sage, the matrix ring method\n`_invert_unit` should be renamed `inverse_of_unit`.\n\nCC:  @slel\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Vincent Delecroix\n\nBranch: 919f907babd1f64cdbd589a163429efb3e90c74f\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25084\n\n",
    "closed_at": "2018-11-01T00:58:57Z",
    "created_at": "2018-04-03T06:56:36Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "change _invert_unit to inverse_of_unit on integer matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25084",
    "user": "https://github.com/videlec"
}
```
Inverting a ring element usually produces an element in its fraction field.

When the ring element is invertible in its parent ring, it can be convenient
to obtain the inverse as an element in the same ring.

For consistency with other rings in Sage, the matrix ring method
`_invert_unit` should be renamed `inverse_of_unit`.

CC:  @slel

Reviewer: Frédéric Chapoton

Author: Vincent Delecroix

Branch: 919f907babd1f64cdbd589a163429efb3e90c74f

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25084





---

archive/issue_comments_371488.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-03T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371488",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_371489.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2018-04-03T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371489",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_371490.json:
```json
{
    "body": "<a id='comment:2'></a>These are not changes from this ticket, but while we're focused on this piece of code...\n\nWhen the matrix is not invertible in the ring, I raising a `ValueError` would make more sense than a `ZeroDivisionError`.\n\nI would replace the method's description at the start of the docstring from the current\n\n```\nIf self is a matrix with determinant `1` or `-1` return the inverse of\n``self`` as a matrix over `ZZ`.\n```\n\nto the following:\n\n```\nReturn the inverse of this matrix as a matrix over `ZZ`.\n\nIf the matrix is not invertible over `ZZ`, a value error is raised.\n```",
    "created_at": "2018-04-03T08:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371490",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>These are not changes from this ticket, but while we're focused on this piece of code...

When the matrix is not invertible in the ring, I raising a `ValueError` would make more sense than a `ZeroDivisionError`.

I would replace the method's description at the start of the docstring from the current

```
If self is a matrix with determinant `1` or `-1` return the inverse of
``self`` as a matrix over `ZZ`.
```

to the following:

```
Return the inverse of this matrix as a matrix over `ZZ`.

If the matrix is not invertible over `ZZ`, a value error is raised.
```



---

archive/issue_comments_371491.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,10 @@\n+Inverting a ring element usually produces an element in its fraction field.\n \n+When the ring element is invertible in its parent ring, it can be convenient\n+to obtain the inverse as an element in the same ring.\n+\n+For consistency with other rings in Sage, the matrix ring method\n+`_invert_unit` should be renamed `inverse_of_unit`.\n \n Author: Vincent Delecroix\n \n``````\n",
    "created_at": "2018-04-03T08:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371491",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,10 @@
+Inverting a ring element usually produces an element in its fraction field.
 
+When the ring element is invertible in its parent ring, it can be convenient
+to obtain the inverse as an element in the same ring.
+
+For consistency with other rings in Sage, the matrix ring method
+`_invert_unit` should be renamed `inverse_of_unit`.
 
 Author: Vincent Delecroix
 
``````




---

archive/issue_comments_371492.json:
```json
{
    "body": "<a id='comment:3'></a>I don't know, maybe I would keep the `ZeroDivisionError` like in those cases:\n\n```python\n>>> (0)**-1\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nZeroDivisionError: 0.0 cannot be raised to a negative power\n\nsage: 0^-1\nTraceback (most recent call last)\n...\nZeroDivisionError: rational division by zero\n\nsage: A = Integers(6)\nsage: a = A(2)\nsage: a^-1\nTraceback (most recent call last)\n...\nZeroDivisionError: Inverse does not exist.\n```",
    "created_at": "2018-04-03T19:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371492",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>I don't know, maybe I would keep the `ZeroDivisionError` like in those cases:

```python
>>> (0)**-1
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ZeroDivisionError: 0.0 cannot be raised to a negative power

sage: 0^-1
Traceback (most recent call last)
...
ZeroDivisionError: rational division by zero

sage: A = Integers(6)
sage: a = A(2)
sage: a^-1
Traceback (most recent call last)
...
ZeroDivisionError: Inverse does not exist.
```



---

archive/issue_comments_371493.json:
```json
{
    "body": "<a id='comment:4'></a>Thanks `@`slabbe for these illuminating comparisons. You are right...\nFailing to invert a matrix amounts to having to divide by zero in the\nechelonization and reduction process of the matrix augmented by the\nidentity matrix. Or, when applying a formula such as \"inverse of\ndeterminant times transpose of comatrix\", with a zero determinant,\nhaving to invert zero, ie dividing (the base ring's one) by zero\n(the determinant). So I withdraw my suggestion to replace\n`ZeroDivisionError` by `ValueError`.",
    "created_at": "2018-04-03T20:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371493",
    "user": "https://github.com/slel"
}
```

<a id='comment:4'></a>Thanks `@`slabbe for these illuminating comparisons. You are right...
Failing to invert a matrix amounts to having to divide by zero in the
echelonization and reduction process of the matrix augmented by the
identity matrix. Or, when applying a formula such as "inverse of
determinant times transpose of comatrix", with a zero determinant,
having to invert zero, ie dividing (the base ring's one) by zero
(the determinant). So I withdraw my suggestion to replace
`ZeroDivisionError` by `ValueError`.



---

archive/issue_comments_371494.json:
```json
{
    "body": "<a id='comment:5'></a>Sebastien's examples are different. The elements tested are divisors of zero, ie not even invertible in their fraction field. I am actually in favor of `ArithmeticError` as in\n\n```\nsage: 2.inverse_of_unit()\nTraceback (most recent call last):\n...\nArithmeticError: inverse does not exist\nsage: 0.inverse_of_unit()\nTraceback (most recent call last):\n...\nArithmeticError: inverse does not exist\n```",
    "created_at": "2018-04-03T22:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371494",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>Sebastien's examples are different. The elements tested are divisors of zero, ie not even invertible in their fraction field. I am actually in favor of `ArithmeticError` as in

```
sage: 2.inverse_of_unit()
Traceback (most recent call last):
...
ArithmeticError: inverse does not exist
sage: 0.inverse_of_unit()
Traceback (most recent call last):
...
ArithmeticError: inverse does not exist
```



---

archive/issue_comments_371495.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-04-03T22:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371495",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_events_062905.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-09-02T01:27:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-62905"
}
```



---

archive/issue_comments_371496.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-09-02T01:27:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371496",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_371497.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-02T01:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371497",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_371498.json:
```json
{
    "body": "<a id='comment:9'></a>rebased with doctests fixed",
    "created_at": "2018-09-02T01:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371498",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>rebased with doctests fixed



---

archive/issue_comments_371499.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-09-02T01:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371499",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_371500.json:
```json
{
    "body": "<a id='comment:10'></a>ok",
    "created_at": "2018-10-31T12:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371500",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>ok



---

archive/issue_comments_371501.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-31T12:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371501",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_062906.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-10-31T12:56:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-62906"
}
```



---

archive/issue_events_062907.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-10-31T12:56:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-62907"
}
```



---

archive/issue_comments_371502.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-11-01T00:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371502",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_062908.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-01T00:58:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-62908"
}
```



---

archive/issue_comments_371503.json:
```json
{
    "body": "<a id='comment:13'></a>Removed in #32417",
    "created_at": "2021-08-24T22:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-371503",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Removed in #32417
