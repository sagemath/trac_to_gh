# Issue 25084: change _invert_unit to inverse_of_unit on integer matrices

archive/issues_024847.json:
```json
{
    "body": "Inverting a ring element usually produces an element in its fraction field.\n\nWhen the ring element is invertible in its parent ring, it can be convenient\nto obtain the inverse as an element in the same ring.\n\nFor consistency with other rings in Sage, the matrix ring method\n`_invert_unit` should be renamed `inverse_of_unit`.\n\n**CC:**  @slel\n\n**Branch:** [919f907babd1f64cdbd589a163429efb3e90c74f](https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f)\n\n**Reviewer:** Fr\u00e9d\u00e9ric Chapoton\n\n**Author:** Vincent Delecroix\n\nIssue created by migration from https://trac.sagemath.org/ticket/25084\n\n",
    "closed_at": "2018-11-01T00:58:57Z",
    "created_at": "2018-04-03T06:56:36Z",
    "labels": [
        "component: linear algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "change _invert_unit to inverse_of_unit on integer matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25084",
    "user": "https://github.com/videlec"
}
```
Inverting a ring element usually produces an element in its fraction field.

When the ring element is invertible in its parent ring, it can be convenient
to obtain the inverse as an element in the same ring.

For consistency with other rings in Sage, the matrix ring method
`_invert_unit` should be renamed `inverse_of_unit`.

**CC:**  @slel

**Branch:** [919f907babd1f64cdbd589a163429efb3e90c74f](https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f)

**Reviewer:** Frédéric Chapoton

**Author:** Vincent Delecroix

Issue created by migration from https://trac.sagemath.org/ticket/25084





---

archive/issue_comments_386495.json:
```json
{
    "body": "**Commit:** [fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f](https://github.com/sagemath/sagetrac-mirror/commit/fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f)",
    "created_at": "2018-04-03T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386495",
    "user": "https://github.com/videlec"
}
```

**Commit:** [fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f](https://github.com/sagemath/sagetrac-mirror/commit/fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f)



---

archive/issue_comments_386496.json:
```json
{
    "body": "**Branch:** [u/vdelecroix/25084](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/25084)",
    "created_at": "2018-04-03T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386496",
    "user": "https://github.com/videlec"
}
```

**Branch:** [u/vdelecroix/25084](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/25084)



---

archive/issue_events_226396.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-04-03T07:02:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226396"
}
```



---

archive/issue_comments_386497.json:
```json
{
    "body": "<a id='comment:1'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f\">fc5dc15</a></td><td><code>_invert_unit -> inverse_of_unit</code></td></tr></table>\n",
    "created_at": "2018-04-03T07:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386497",
    "user": "https://github.com/videlec"
}
```

<a id='comment:1'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f">fc5dc15</a></td><td><code>_invert_unit -> inverse_of_unit</code></td></tr></table>




---

archive/issue_comments_386498.json:
```json
{
    "body": "<a id='comment:2'></a>\nThese are not changes from this ticket, but while we're focused on this piece of code...\n\nWhen the matrix is not invertible in the ring, I raising a `ValueError` would make more sense than a `ZeroDivisionError`.\n\nI would replace the method's description at the start of the docstring from the current\n\n```\nIf self is a matrix with determinant `1` or `-1` return the inverse of\n``self`` as a matrix over `ZZ`.\n```\n\nto the following:\n\n```\nReturn the inverse of this matrix as a matrix over `ZZ`.\n\nIf the matrix is not invertible over `ZZ`, a value error is raised.\n```",
    "created_at": "2018-04-03T08:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386498",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>
These are not changes from this ticket, but while we're focused on this piece of code...

When the matrix is not invertible in the ring, I raising a `ValueError` would make more sense than a `ZeroDivisionError`.

I would replace the method's description at the start of the docstring from the current

```
If self is a matrix with determinant `1` or `-1` return the inverse of
``self`` as a matrix over `ZZ`.
```

to the following:

```
Return the inverse of this matrix as a matrix over `ZZ`.

If the matrix is not invertible over `ZZ`, a value error is raised.
```



---

archive/issue_comments_386499.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,7 @@\n+Inverting a ring element usually produces an element in its fraction field.\n \n+When the ring element is invertible in its parent ring, it can be convenient\n+to obtain the inverse as an element in the same ring.\n+\n+For consistency with other rings in Sage, the matrix ring method\n+`_invert_unit` should be renamed `inverse_of_unit`.\n``````\n",
    "created_at": "2018-04-03T08:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386499",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,7 @@
+Inverting a ring element usually produces an element in its fraction field.
 
+When the ring element is invertible in its parent ring, it can be convenient
+to obtain the inverse as an element in the same ring.
+
+For consistency with other rings in Sage, the matrix ring method
+`_invert_unit` should be renamed `inverse_of_unit`.
``````




---

archive/issue_comments_386500.json:
```json
{
    "body": "<a id='comment:3'></a>\nI don't know, maybe I would keep the `ZeroDivisionError` like in those cases:\n\n```python\n>>> (0)**-1\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\nZeroDivisionError: 0.0 cannot be raised to a negative power\n\nsage: 0^-1\nTraceback (most recent call last)\n...\nZeroDivisionError: rational division by zero\n\nsage: A = Integers(6)\nsage: a = A(2)\nsage: a^-1\nTraceback (most recent call last)\n...\nZeroDivisionError: Inverse does not exist.\n```",
    "created_at": "2018-04-03T19:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386500",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>
I don't know, maybe I would keep the `ZeroDivisionError` like in those cases:

```python
>>> (0)**-1
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ZeroDivisionError: 0.0 cannot be raised to a negative power

sage: 0^-1
Traceback (most recent call last)
...
ZeroDivisionError: rational division by zero

sage: A = Integers(6)
sage: a = A(2)
sage: a^-1
Traceback (most recent call last)
...
ZeroDivisionError: Inverse does not exist.
```



---

archive/issue_comments_386501.json:
```json
{
    "body": "<a id='comment:4'></a>\nThanks @seblabbe for these illuminating comparisons. You are right...\nFailing to invert a matrix amounts to having to divide by zero in the\nechelonization and reduction process of the matrix augmented by the\nidentity matrix. Or, when applying a formula such as \"inverse of\ndeterminant times transpose of comatrix\", with a zero determinant,\nhaving to invert zero, ie dividing (the base ring's one) by zero\n(the determinant). So I withdraw my suggestion to replace\n`ZeroDivisionError` by `ValueError`.",
    "created_at": "2018-04-03T20:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386501",
    "user": "https://github.com/slel"
}
```

<a id='comment:4'></a>
Thanks @seblabbe for these illuminating comparisons. You are right...
Failing to invert a matrix amounts to having to divide by zero in the
echelonization and reduction process of the matrix augmented by the
identity matrix. Or, when applying a formula such as "inverse of
determinant times transpose of comatrix", with a zero determinant,
having to invert zero, ie dividing (the base ring's one) by zero
(the determinant). So I withdraw my suggestion to replace
`ZeroDivisionError` by `ValueError`.



---

archive/issue_comments_386502.json:
```json
{
    "body": "<a id='comment:5'></a>\nSebastien's examples are different. The elements tested are divisors of zero, ie not even invertible in their fraction field. I am actually in favor of `ArithmeticError` as in\n\n```\nsage: 2.inverse_of_unit()\nTraceback (most recent call last):\n...\nArithmeticError: inverse does not exist\nsage: 0.inverse_of_unit()\nTraceback (most recent call last):\n...\nArithmeticError: inverse does not exist\n```",
    "created_at": "2018-04-03T22:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386502",
    "user": "https://github.com/videlec"
}
```

<a id='comment:5'></a>
Sebastien's examples are different. The elements tested are divisors of zero, ie not even invertible in their fraction field. I am actually in favor of `ArithmeticError` as in

```
sage: 2.inverse_of_unit()
Traceback (most recent call last):
...
ArithmeticError: inverse does not exist
sage: 0.inverse_of_unit()
Traceback (most recent call last):
...
ArithmeticError: inverse does not exist
```



---

archive/issue_comments_386503.json:
```json
{
    "body": "**Changing commit** from \"[fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f](https://github.com/sagemath/sagetrac-mirror/commit/fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f)\" to \"[73b684668c1f3aa9df8ddf997196a0d73cb07897](https://github.com/sagemath/sagetrac-mirror/commit/73b684668c1f3aa9df8ddf997196a0d73cb07897)\".",
    "created_at": "2018-04-03T22:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f](https://github.com/sagemath/sagetrac-mirror/commit/fc5dc15eb7e80c53b69c311a3a4bd112b74ff45f)" to "[73b684668c1f3aa9df8ddf997196a0d73cb07897](https://github.com/sagemath/sagetrac-mirror/commit/73b684668c1f3aa9df8ddf997196a0d73cb07897)".



---

archive/issue_comments_386504.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/73b684668c1f3aa9df8ddf997196a0d73cb07897\">73b6846</a></td><td><code>_invert_unit -> inverse_of_unit</code></td></tr></table>\n",
    "created_at": "2018-04-03T22:48:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/73b684668c1f3aa9df8ddf997196a0d73cb07897">73b6846</a></td><td><code>_invert_unit -> inverse_of_unit</code></td></tr></table>




---

archive/issue_events_226397.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-09-02T01:27:16Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "milestone": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226397"
}
```



---

archive/issue_events_226398.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-09-02T01:27:16Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226398"
}
```



---

archive/issue_events_226399.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-09-02T01:27:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226399"
}
```



---

archive/issue_events_226400.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-09-02T01:27:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226400"
}
```



---

archive/issue_comments_386505.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f\">919f907</a></td><td><code>25084: _invert_unit -> inverse_of_unit</code></td></tr></table>\n",
    "created_at": "2018-09-02T01:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f">919f907</a></td><td><code>25084: _invert_unit -> inverse_of_unit</code></td></tr></table>




---

archive/issue_comments_386506.json:
```json
{
    "body": "**Changing commit** from \"[73b684668c1f3aa9df8ddf997196a0d73cb07897](https://github.com/sagemath/sagetrac-mirror/commit/73b684668c1f3aa9df8ddf997196a0d73cb07897)\" to \"[919f907babd1f64cdbd589a163429efb3e90c74f](https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f)\".",
    "created_at": "2018-09-02T01:37:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386506",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[73b684668c1f3aa9df8ddf997196a0d73cb07897](https://github.com/sagemath/sagetrac-mirror/commit/73b684668c1f3aa9df8ddf997196a0d73cb07897)" to "[919f907babd1f64cdbd589a163429efb3e90c74f](https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f)".



---

archive/issue_comments_386507.json:
```json
{
    "body": "<a id='comment:9'></a>\nrebased with doctests fixed",
    "created_at": "2018-09-02T01:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386507",
    "user": "https://github.com/videlec"
}
```

<a id='comment:9'></a>
rebased with doctests fixed



---

archive/issue_events_226401.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-09-02T01:38:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226401"
}
```



---

archive/issue_events_226402.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-09-02T01:38:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226402"
}
```



---

archive/issue_comments_386508.json:
```json
{
    "body": "<a id='comment:10'></a>\nok",
    "created_at": "2018-10-31T12:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386508",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>
ok



---

archive/issue_comments_386509.json:
```json
{
    "body": "**Reviewer:** Fr\u00e9d\u00e9ric Chapoton",
    "created_at": "2018-10-31T12:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386509",
    "user": "https://github.com/fchapoton"
}
```

**Reviewer:** Frédéric Chapoton



---

archive/issue_events_226403.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-10-31T12:26:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226403"
}
```



---

archive/issue_events_226404.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-10-31T12:26:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226404"
}
```



---

archive/issue_events_226405.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-10-31T12:56:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226405"
}
```



---

archive/issue_events_226406.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-10-31T12:56:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226406"
}
```



---

archive/issue_comments_386510.json:
```json
{
    "body": "**Changing branch** from \"[u/vdelecroix/25084](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/25084)\" to \"[919f907babd1f64cdbd589a163429efb3e90c74f](https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f)\".",
    "created_at": "2018-11-01T00:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386510",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/vdelecroix/25084](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/25084)" to "[919f907babd1f64cdbd589a163429efb3e90c74f](https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f)".



---

archive/issue_events_226407.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-01T00:58:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226407"
}
```



---

archive/issue_events_226408.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-11-01T00:58:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25084#event-226408"
}
```



---

archive/issue_comments_386511.json:
```json
{
    "body": "<a id='comment:13'></a>\nRemoved in #32417",
    "created_at": "2021-08-24T22:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386511",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Removed in #32417



---

archive/issue_comments_386512.json:
```json
{
    "body": "**Changing commit** from \"[919f907babd1f64cdbd589a163429efb3e90c74f](https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f)\" to \"\".",
    "created_at": "2021-08-24T22:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25084#issuecomment-386512",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[919f907babd1f64cdbd589a163429efb3e90c74f](https://github.com/sagemath/sagetrac-mirror/commit/919f907babd1f64cdbd589a163429efb3e90c74f)" to "".
