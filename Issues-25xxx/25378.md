# Issue 25378: I/O operation on closed file when sage -t --optional=sage,external --logfile is_provided.log

archive/issues_025141.json:
```json
{
    "assignees": [],
    "body": "From [8.3.beta1 post](https://groups.google.com/d/msg/sage-release/zh04lo8d44U/P6hrZEusAAAJ) on sage-release:\n\n```\nsage -t src/sage/misc/latex.py --optional=sage,external --logfile a.log\nRunning doctests with ID 2018-05-17-08-30-16-d8cc67d9.\nGit branch: develop\nUsing --optional=external,sage\nExternal software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab\nDoctesting 1 file.\nsage -t --warn-long 80.1 src/sage/misc/latex.py\n    [315 tests, 1.52 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.8 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 1.5 seconds\nExternal software detected for doctesting: latex\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/src/bin/sage-runtests\", line 127, in <module>\n    err = DC.run()\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 1176, in run\n    + ','.join(available_software.seen()))\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 583, in log\n    self.logger.write(s + end)\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 250, in write\n    f.write(x)\nValueError: I/O operation on closed file\n```\n\nThis confirms that the last line (`External software detected for doctesting: latex`) is not written to the log file because of I/O errors:\n\n```\n$ tail a.log\nExternal software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab\nDoctesting 1 file.\nsage -t --warn-long 80.1 src/sage/misc/latex.py\n    [315 tests, 1.52 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.8 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 1.5 seconds\n```\n\n\nThe error is not there if external software are not tested:\n\n```\nsage -t src/sage/misc/latex.py --optional=sage --logfile a.log\nRunning doctests with ID 2018-05-17-08-30-28-7b637155.\nGit branch: develop\nUsing --optional=sage\nDoctesting 1 file.\nsage -t --warn-long 80.1 src/sage/misc/latex.py\n    [310 tests, 1.14 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.2 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 1.1 seconds\n```\n\nThe error is not there if no log file is provided:\n\n```\nsage -t src/sage/misc/latex.py --optional=sage,external\nRunning doctests with ID 2018-05-17-08-30-40-21f560b3.\nGit branch: develop\nUsing --optional=external,sage\nExternal software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab\nDoctesting 1 file.\nsage -t --warn-long 80.1 src/sage/misc/latex.py\n    [315 tests, 1.45 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.7 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 1.4 seconds\nExternal software detected for doctesting: latex\n```\n\nCC:  @vinklein\n\nKeywords: **thursdaysbdx**\n\nBranch/Commit: **[`76f0177`](https://github.com/sagemath/sagetrac-mirror/commit/76f0177aae010a790ca31fdc17210109ccbffd5b)**\n\nReviewer: **S\u00e9bastien Labb\u00e9, Vincent Klein**\n\nAuthor: **Vincent Klein, S\u00e9bastien Labb\u00e9**\n\nComponent: **doctest framework**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25378_\n\n",
    "closed_at": "2018-09-21T22:20:36Z",
    "created_at": "2018-05-17T06:39:38Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "I/O operation on closed file when sage -t --optional=sage,external --logfile is_provided.log",
    "type": "issue",
    "updated_at": "2018-09-21T22:20:36Z",
    "url": "https://github.com/sagemath/sage/issues/25378",
    "user": "https://github.com/seblabbe"
}
```
From [8.3.beta1 post](https://groups.google.com/d/msg/sage-release/zh04lo8d44U/P6hrZEusAAAJ) on sage-release:

```
sage -t src/sage/misc/latex.py --optional=sage,external --logfile a.log
Running doctests with ID 2018-05-17-08-30-16-d8cc67d9.
Git branch: develop
Using --optional=external,sage
External software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab
Doctesting 1 file.
sage -t --warn-long 80.1 src/sage/misc/latex.py
    [315 tests, 1.52 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.8 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 1.5 seconds
External software detected for doctesting: latex
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/src/bin/sage-runtests", line 127, in <module>
    err = DC.run()
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1176, in run
    + ','.join(available_software.seen()))
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 583, in log
    self.logger.write(s + end)
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 250, in write
    f.write(x)
ValueError: I/O operation on closed file
```

This confirms that the last line (`External software detected for doctesting: latex`) is not written to the log file because of I/O errors:

```
$ tail a.log
External software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab
Doctesting 1 file.
sage -t --warn-long 80.1 src/sage/misc/latex.py
    [315 tests, 1.52 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.8 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 1.5 seconds
```


The error is not there if external software are not tested:

```
sage -t src/sage/misc/latex.py --optional=sage --logfile a.log
Running doctests with ID 2018-05-17-08-30-28-7b637155.
Git branch: develop
Using --optional=sage
Doctesting 1 file.
sage -t --warn-long 80.1 src/sage/misc/latex.py
    [310 tests, 1.14 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.2 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 1.1 seconds
```

The error is not there if no log file is provided:

```
sage -t src/sage/misc/latex.py --optional=sage,external
Running doctests with ID 2018-05-17-08-30-40-21f560b3.
Git branch: develop
Using --optional=external,sage
External software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab
Doctesting 1 file.
sage -t --warn-long 80.1 src/sage/misc/latex.py
    [315 tests, 1.45 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.7 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 1.4 seconds
External software detected for doctesting: latex
```

CC:  @vinklein

Keywords: **thursdaysbdx**

Branch/Commit: **[`76f0177`](https://github.com/sagemath/sagetrac-mirror/commit/76f0177aae010a790ca31fdc17210109ccbffd5b)**

Reviewer: **Sébastien Labbé, Vincent Klein**

Author: **Vincent Klein, Sébastien Labbé**

Component: **doctest framework**

_Issue created by migration from https://trac.sagemath.org/ticket/25378_





---

archive/issue_events_351176.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-05-17T06:39:38Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351176"
}
```



---

archive/issue_events_351177.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-05-17T06:39:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20doctest%20framework",
    "label_color": "000080",
    "label_name": "c: doctest framework",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351177"
}
```



---

archive/issue_events_351178.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-05-17T06:39:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351178"
}
```



---

archive/issue_events_351179.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-05-17T06:39:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351179"
}
```



---

archive/issue_comments_388414.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+From [8.3.beta1 post](https://groups.google.com/d/msg/sage-release/zh04lo8d44U/P6hrZEusAAAJ) on sage-release:\n \n ```\n sage -t src/sage/misc/latex.py --optional=sage,external --logfile a.log\n``````\n",
    "created_at": "2018-05-17T10:00:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388414",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+From [8.3.beta1 post](https://groups.google.com/d/msg/sage-release/zh04lo8d44U/P6hrZEusAAAJ) on sage-release:
 
 ```
 sage -t src/sage/misc/latex.py --optional=sage,external --logfile a.log
``````




---

archive/issue_comments_388415.json:
```json
{
    "body": "Branch: **[u/vklein/25378](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/25378)**",
    "created_at": "2018-07-05T12:23:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388415",
    "user": "https://github.com/vinklein"
}
```

Branch: **[u/vklein/25378](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/25378)**



---

archive/issue_comments_388416.json:
```json
{
    "body": "Commit: **[`6bccacc`](https://github.com/sagemath/sagetrac-mirror/commit/6bccacc656da232367d7d5b0a421a0313a912ec4)**",
    "created_at": "2018-07-05T12:24:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388416",
    "user": "https://github.com/vinklein"
}
```

Commit: **[`6bccacc`](https://github.com/sagemath/sagetrac-mirror/commit/6bccacc656da232367d7d5b0a421a0313a912ec4)**



---

archive/issue_events_351180.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-07-05T12:24:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351180"
}
```



---

archive/issue_comments_388417.json:
```json
{
    "body": "Author: **Vincent Klein**",
    "created_at": "2018-07-05T12:24:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388417",
    "user": "https://github.com/vinklein"
}
```

Author: **Vincent Klein**



---

archive/issue_events_351181.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-07-05T14:26:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351181"
}
```



---

archive/issue_events_351182.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-07-05T14:26:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351182"
}
```



---

archive/issue_comments_388418.json:
```json
{
    "body": "Changed commit from **[`6bccacc`](https://github.com/sagemath/sagetrac-mirror/commit/6bccacc656da232367d7d5b0a421a0313a912ec4)** to **[`221a7db`](https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50)**",
    "created_at": "2018-07-05T14:28:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388418",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6bccacc`](https://github.com/sagemath/sagetrac-mirror/commit/6bccacc656da232367d7d5b0a421a0313a912ec4)** to **[`221a7db`](https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50)**



---

archive/issue_comments_388419.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50\"><code>221a7db</code></a></td><td><code>Trac 25378: Don't close logfile before last message</code></td></tr></table>\n",
    "created_at": "2018-07-05T14:28:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388419",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50"><code>221a7db</code></a></td><td><code>Trac 25378: Don't close logfile before last message</code></td></tr></table>




---

archive/issue_events_351183.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-07-05T14:29:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351183"
}
```



---

archive/issue_events_351184.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-07-05T14:29:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351184"
}
```



---

archive/issue_comments_388420.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI found a way to raise the issue from sage:\n\n```\nsage: from sage.doctest.control import DocTestDefaults, DocTestController\nsage: DD = DocTestDefaults(optional=set(['sage', 'external']), logfile=tmp_filename())\nsage: filename = os.path.join(SAGE_SRC, \"sage\", \"misc\", \"latex.py\")\nsage: DC = DocTestController(DD, [filename])\nsage: DC.run()\n```\n\nThus, I added a commit with a doctest + a commit fixing the two pyflakes issues (see patchbot report).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f2d544b3f3e1ab335b4cd257dc01b532020914c\"><code>4f2d544</code></a></td><td><code>25378: adding a doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a\"><code>4eb2799</code></a></td><td><code>25378: fixing issues seen by pyflakes</code></td></tr></table>\n",
    "created_at": "2018-07-05T19:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388420",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:8" align="right">comment:8</div>

I found a way to raise the issue from sage:

```
sage: from sage.doctest.control import DocTestDefaults, DocTestController
sage: DD = DocTestDefaults(optional=set(['sage', 'external']), logfile=tmp_filename())
sage: filename = os.path.join(SAGE_SRC, "sage", "misc", "latex.py")
sage: DC = DocTestController(DD, [filename])
sage: DC.run()
```

Thus, I added a commit with a doctest + a commit fixing the two pyflakes issues (see patchbot report).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f2d544b3f3e1ab335b4cd257dc01b532020914c"><code>4f2d544</code></a></td><td><code>25378: adding a doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a"><code>4eb2799</code></a></td><td><code>25378: fixing issues seen by pyflakes</code></td></tr></table>




---

archive/issue_comments_388421.json:
```json
{
    "body": "Changed branch from **[u/vklein/25378](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/25378)** to **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)**",
    "created_at": "2018-07-05T19:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388421",
    "user": "https://github.com/seblabbe"
}
```

Changed branch from **[u/vklein/25378](https://github.com/sagemath/sagetrac-mirror/tree/u/vklein/25378)** to **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)**



---

archive/issue_comments_388422.json:
```json
{
    "body": "Changed commit from **[`221a7db`](https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50)** to **[`4eb2799`](https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a)**",
    "created_at": "2018-07-05T19:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388422",
    "user": "https://github.com/seblabbe"
}
```

Changed commit from **[`221a7db`](https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50)** to **[`4eb2799`](https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a)**



---

archive/issue_comments_388423.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2018-07-05T19:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388423",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_comments_388424.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI give positive review to commit \u200b221a7db. I let someone else review my two commits.",
    "created_at": "2018-07-05T19:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388424",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:9" align="right">comment:9</div>

I give positive review to commit ​221a7db. I let someone else review my two commits.



---

archive/issue_comments_388425.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOf course, \"someone else\" may include you Vincent Klein as this is often done, see #19494 :)",
    "created_at": "2018-07-06T14:11:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388425",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:10" align="right">comment:10</div>

Of course, "someone else" may include you Vincent Klein as this is often done, see #19494 :)



---

archive/issue_comments_388426.json:
```json
{
    "body": "Changed reviewer from **S\u00e9bastien Labb\u00e9** to **S\u00e9bastien Labb\u00e9, Vincent Klein**",
    "created_at": "2018-07-18T09:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388426",
    "user": "https://github.com/vinklein"
}
```

Changed reviewer from **Sébastien Labbé** to **Sébastien Labbé, Vincent Klein**



---

archive/issue_comments_388427.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI m ok for the last two commits.",
    "created_at": "2018-07-18T09:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388427",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:11" align="right">comment:11</div>

I m ok for the last two commits.



---

archive/issue_events_351185.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-07-18T09:35:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351185"
}
```



---

archive/issue_events_351186.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-07-18T09:35:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351186"
}
```



---

archive/issue_comments_388428.json:
```json
{
    "body": "Changed author from **Vincent Klein** to **Vincent Klein, S\u00e9bastien Labb\u00e9**",
    "created_at": "2018-07-18T09:35:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388428",
    "user": "https://github.com/vinklein"
}
```

Changed author from **Vincent Klein** to **Vincent Klein, Sébastien Labbé**



---

archive/issue_events_351187.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-30T12:19:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351187"
}
```



---

archive/issue_events_351188.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-07-30T12:19:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351188"
}
```



---

archive/issue_comments_388429.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n\n```\nFile \"src/sage/doctest/control.py\", line 1145, in sage.doctest.control.DocTestController.run\nFailed example:\n    DC.run()\nExpected:\n    Running doctests with ID ...\n    Using --optional=external,sage\n    External software to be detected: ...\n    Doctesting 1 file.\n    sage -t .../sage/misc/latex.py\n        [... tests, ... s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: ... seconds\n        cpu time: ... seconds\n        cumulative wall time: ... seconds\n    External software detected for doctesting: ...\n    0\nGot:\n    Running doctests with ID 2018-07-30-14-14-47-59620918.\n    Git branch: test\n    Using --optional=external,sage\n    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\n    Doctesting 1 file.\n    sage -t /mnt/disk/home/release/Sage/src/sage/misc/latex.py\n    **********************************************************************\n    File \"/mnt/disk/home/release/Sage/src/sage/misc/latex.py\", line 1548, in sage.misc.latex.Latex.add_package_to_preamble_if_available\n    Failed example:\n        latex.extra_preamble()       # optional - latex\n    Expected:\n        '\\\\usepackage{xypic}\\n'\n    Got:\n        ''\n    **********************************************************************\n    1 item had failures:\n       1 of   5 in sage.misc.latex.Latex.add_package_to_preamble_if_available\n        [316 tests, 1 failure, 1.29 s]\n    ----------------------------------------------------------------------\n    sage -t /mnt/disk/home/release/Sage/src/sage/misc/latex.py  # 1 doctest failed\n    ----------------------------------------------------------------------\n    Total time for all tests: 1.6 seconds\n        cpu time: 0.4 seconds\n        cumulative wall time: 1.3 seconds\n    External software detected for doctesting: imagemagick,latex\n    1\n**********************************************************************\n```",
    "created_at": "2018-07-30T12:19:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388429",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:12" align="right">comment:12</div>


```
File "src/sage/doctest/control.py", line 1145, in sage.doctest.control.DocTestController.run
Failed example:
    DC.run()
Expected:
    Running doctests with ID ...
    Using --optional=external,sage
    External software to be detected: ...
    Doctesting 1 file.
    sage -t .../sage/misc/latex.py
        [... tests, ... s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: ... seconds
        cpu time: ... seconds
        cumulative wall time: ... seconds
    External software detected for doctesting: ...
    0
Got:
    Running doctests with ID 2018-07-30-14-14-47-59620918.
    Git branch: test
    Using --optional=external,sage
    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
    Doctesting 1 file.
    sage -t /mnt/disk/home/release/Sage/src/sage/misc/latex.py
    **********************************************************************
    File "/mnt/disk/home/release/Sage/src/sage/misc/latex.py", line 1548, in sage.misc.latex.Latex.add_package_to_preamble_if_available
    Failed example:
        latex.extra_preamble()       # optional - latex
    Expected:
        '\\usepackage{xypic}\n'
    Got:
        ''
    **********************************************************************
    1 item had failures:
       1 of   5 in sage.misc.latex.Latex.add_package_to_preamble_if_available
        [316 tests, 1 failure, 1.29 s]
    ----------------------------------------------------------------------
    sage -t /mnt/disk/home/release/Sage/src/sage/misc/latex.py  # 1 doctest failed
    ----------------------------------------------------------------------
    Total time for all tests: 1.6 seconds
        cpu time: 0.4 seconds
        cumulative wall time: 1.3 seconds
    External software detected for doctesting: imagemagick,latex
    1
**********************************************************************
```



---

archive/issue_events_351189.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351189"
}
```



---

archive/issue_events_351190.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351190"
}
```



---

archive/issue_comments_388430.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nupdate milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388430",
    "user": "https://github.com/videlec"
}
```

<div id="comment:13" align="right">comment:13</div>

update milestone 8.3 -> 8.4



---

archive/issue_comments_388431.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nIn the doctest, I was testing that `sage -t --optional=sage,external --logfile a.log` works on a file inside the sage library containing at least one external doctest namely `sage/misc/latex.py`. Of course, this test way too much thing including all of the doctests inside of that file which may create other unrelated failures like the one obtained by Volker.\n\nI found a much simpler way to test that the error is fixed. Indeed, running the command on a empty file raises the failure:\n\n```\n$ touch a.py\n$ sage -t a.py --optional=sage,external --logfile a.log\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2018-08-22-14-45-05-4d9b505f.\nGit branch: develop\nUsing --optional=external,sage\nExternal software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\nDoctesting 1 file.\nsage -t a.py\n    [0 tests, 0.00 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.2 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\nExternal software detected for doctesting: \nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/src/bin/sage-runtests\", line 139, in <module>\n    err = DC.run()\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 1185, in run\n    + ','.join(available_software.seen()))\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 592, in log\n    self.logger.write(s + end)\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 255, in write\n    f.write(x)\nValueError: I/O operation on closed file\n```\n\nTherefore, I will update the doctest with this instead.",
    "created_at": "2018-08-22T12:49:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388431",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:14" align="right">comment:14</div>

In the doctest, I was testing that `sage -t --optional=sage,external --logfile a.log` works on a file inside the sage library containing at least one external doctest namely `sage/misc/latex.py`. Of course, this test way too much thing including all of the doctests inside of that file which may create other unrelated failures like the one obtained by Volker.

I found a much simpler way to test that the error is fixed. Indeed, running the command on a empty file raises the failure:

```
$ touch a.py
$ sage -t a.py --optional=sage,external --logfile a.log
too many failed tests, not using stored timings
Running doctests with ID 2018-08-22-14-45-05-4d9b505f.
Git branch: develop
Using --optional=external,sage
External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
Doctesting 1 file.
sage -t a.py
    [0 tests, 0.00 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.2 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
External software detected for doctesting: 
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/src/bin/sage-runtests", line 139, in <module>
    err = DC.run()
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1185, in run
    + ','.join(available_software.seen()))
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 592, in log
    self.logger.write(s + end)
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 255, in write
    f.write(x)
ValueError: I/O operation on closed file
```

Therefore, I will update the doctest with this instead.



---

archive/issue_comments_388432.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f8a7acefd6cf192238506b4e0dce72205db6a53\"><code>4f8a7ac</code></a></td><td><code>Merge branch 'public/25378' into 8.4.beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90\"><code>7c7e278</code></a></td><td><code>25378: better doctest</code></td></tr></table>\n",
    "created_at": "2018-08-22T13:01:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388432",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f8a7acefd6cf192238506b4e0dce72205db6a53"><code>4f8a7ac</code></a></td><td><code>Merge branch 'public/25378' into 8.4.beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90"><code>7c7e278</code></a></td><td><code>25378: better doctest</code></td></tr></table>




---

archive/issue_comments_388433.json:
```json
{
    "body": "Changed commit from **[`4eb2799`](https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a)** to **[`7c7e278`](https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90)**",
    "created_at": "2018-08-22T13:01:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388433",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4eb2799`](https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a)** to **[`7c7e278`](https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90)**



---

archive/issue_events_351191.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-08-22T13:02:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351191"
}
```



---

archive/issue_events_351192.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-08-22T13:02:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351192"
}
```



---

archive/issue_comments_388434.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFine for me",
    "created_at": "2018-08-22T13:41:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388434",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:17" align="right">comment:17</div>

Fine for me



---

archive/issue_events_351193.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-08-22T13:41:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351193"
}
```



---

archive/issue_events_351194.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-08-22T13:41:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351194"
}
```



---

archive/issue_events_351195.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-25T11:01:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351195"
}
```



---

archive/issue_events_351196.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-25T11:01:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351196"
}
```



---

archive/issue_comments_388435.json:
```json
{
    "body": "Changed branch from **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)** to **[`7c7e278`](https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90)**",
    "created_at": "2018-08-25T11:01:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388435",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)** to **[`7c7e278`](https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90)**



---

archive/issue_comments_388436.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThe test is fragile:\n\n```\nFile \"src/sage/doctest/control.py\", line 1161, in sage.doctest.control.DocTestController.run\nFailed example:\n    DC.run()\nExpected:\n    Running doctests with ID ...\n    Using --optional=external,sage\n    External software to be detected: ...\n    Doctesting 1 file.\n    sage -t ....py\n        [0 tests, 0.00 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.0 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    External software detected for doctesting:\n    0\nGot:\n    Running doctests with ID 2018-08-25-08-26-30-30c10539.\n    Git branch: develop\n    Using --optional=external,sage\n    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\n    Doctesting 1 file.\n    sage -t /var/lib/buildbot/slave/sage_git/dot_sage/temp/kucalc/29651/tmp_eWoSer.py\n        [0 tests, 0.00 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.0 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    External software detected for doctesting: latex\n    0\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.doctest.control.DocTestController.run\n    [206 tests, 1 failure, 4.48 s]\n**********************************************************************\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50\"><code>221a7db</code></a></td><td><code>Trac 25378: Don't close logfile before last message</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f2d544b3f3e1ab335b4cd257dc01b532020914c\"><code>4f2d544</code></a></td><td><code>25378: adding a doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a\"><code>4eb2799</code></a></td><td><code>25378: fixing issues seen by pyflakes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f8a7acefd6cf192238506b4e0dce72205db6a53\"><code>4f8a7ac</code></a></td><td><code>Merge branch 'public/25378' into 8.4.beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90\"><code>7c7e278</code></a></td><td><code>25378: better doctest</code></td></tr></table>\n",
    "created_at": "2018-08-25T15:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388436",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:19" align="right">comment:19</div>

The test is fragile:

```
File "src/sage/doctest/control.py", line 1161, in sage.doctest.control.DocTestController.run
Failed example:
    DC.run()
Expected:
    Running doctests with ID ...
    Using --optional=external,sage
    External software to be detected: ...
    Doctesting 1 file.
    sage -t ....py
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    External software detected for doctesting:
    0
Got:
    Running doctests with ID 2018-08-25-08-26-30-30c10539.
    Git branch: develop
    Using --optional=external,sage
    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
    Doctesting 1 file.
    sage -t /var/lib/buildbot/slave/sage_git/dot_sage/temp/kucalc/29651/tmp_eWoSer.py
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    External software detected for doctesting: latex
    0
**********************************************************************
1 item had failures:
   1 of  13 in sage.doctest.control.DocTestController.run
    [206 tests, 1 failure, 4.48 s]
**********************************************************************
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50"><code>221a7db</code></a></td><td><code>Trac 25378: Don't close logfile before last message</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f2d544b3f3e1ab335b4cd257dc01b532020914c"><code>4f2d544</code></a></td><td><code>25378: adding a doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a"><code>4eb2799</code></a></td><td><code>25378: fixing issues seen by pyflakes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f8a7acefd6cf192238506b4e0dce72205db6a53"><code>4f8a7ac</code></a></td><td><code>Merge branch 'public/25378' into 8.4.beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90"><code>7c7e278</code></a></td><td><code>25378: better doctest</code></td></tr></table>




---

archive/issue_comments_388437.json:
```json
{
    "body": "Changed branch from **[`7c7e278`](https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90)** to **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)**",
    "created_at": "2018-08-25T15:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388437",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[`7c7e278`](https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90)** to **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)**



---

archive/issue_comments_388438.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nuse the trac role <code>:trac:\\`25378\\`</code> instead of `#25378` in\n\n+        We check that #25378 is fixed (testing external packages while",
    "created_at": "2018-08-25T15:57:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388438",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:20" align="right">comment:20</div>

use the trac role <code>:trac:\`25378\`</code> instead of `#25378` in

+        We check that #25378 is fixed (testing external packages while



---

archive/issue_comments_388439.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca\"><code>1040475</code></a></td><td><code>25378: more robust doctest</code></td></tr></table>\n",
    "created_at": "2018-08-25T17:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388439",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca"><code>1040475</code></a></td><td><code>25378: more robust doctest</code></td></tr></table>




---

archive/issue_comments_388440.json:
```json
{
    "body": "Changed commit from **[`7c7e278`](https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90)** to **[`1040475`](https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca)**",
    "created_at": "2018-08-25T17:06:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388440",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7c7e278`](https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90)** to **[`1040475`](https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca)**



---

archive/issue_events_351197.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-08-25T17:12:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351197"
}
```



---

archive/issue_events_351198.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-25T22:48:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351198"
}
```



---

archive/issue_events_351199.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-25T22:48:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351199"
}
```



---

archive/issue_comments_388441.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOn OSX I get lots of failures of the form \n\n```\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 763, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular._eval_line_using_file('def a=3;')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line_using_file[3]>\", line 1, in <module>\n        singular._eval_line_using_file('def a=3;')\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 813, in _eval_line_using_file\n        self._synchronize()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1284, in _synchronize\n        self._sendstr(cmd)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1226, in _sendstr\n        self.quit()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 597, in quit\n        self._expect.close()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 327, in close\n        self.ptyproc.close(force=force)\n      File \"sage/interfaces/sagespawn.pyx\", line 202, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:3059)\n        self.fileobj.close()\n    IOError: [Errno 5] Input/output error\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 766, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular('a')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line_using_file[4]>\", line 1, in <module>\n        singular('a')\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 798, in __call__\n        return SingularElement(self, type, x, False)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 1279, in __init__\n        self._name = parent._create(value, type)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 759, in _create\n        self.set(type, name, value)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 702, in set\n        self.eval(cmd)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 655, in eval\n        s = Expect.eval(self, x, **kwds)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1354, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 942, in _eval_line\n        self._synchronize()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1284, in _synchronize\n        self._sendstr(cmd)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1226, in _sendstr\n        self.quit()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 597, in quit\n        self._expect.close()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 327, in close\n        self.ptyproc.close(force=force)\n      File \"sage/interfaces/sagespawn.pyx\", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)\n        self.write(str_to_bytes(self.quit_string))\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py\", line 562, in write\n        return self._writeb(s, flush=flush)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py\", line 552, in _writeb\n        n = self.fileobj.write(b)\n    ValueError: write to closed file\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 768, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular.eval('quit;')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line_using_file[5]>\", line 1, in <module>\n        singular.eval('quit;')\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 655, in eval\n        s = Expect.eval(self, x, **kwds)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1354, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 942, in _eval_line\n        self._synchronize()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1284, in _synchronize\n        self._sendstr(cmd)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1226, in _sendstr\n        self.quit()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 597, in quit\n        self._expect.close()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 327, in close\n        self.ptyproc.close(force=force)\n      File \"sage/interfaces/sagespawn.pyx\", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)\n        self.write(str_to_bytes(self.quit_string))\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py\", line 562, in write\n        return self._writeb(s, flush=flush)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py\", line 552, in _writeb\n        n = self.fileobj.write(b)\n    ValueError: write to closed file\n**********************************************************************\n```",
    "created_at": "2018-08-26T09:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388441",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:24" align="right">comment:24</div>

On OSX I get lots of failures of the form 

```
**********************************************************************
File "src/sage/interfaces/expect.py", line 763, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular._eval_line_using_file('def a=3;')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[3]>", line 1, in <module>
        singular._eval_line_using_file('def a=3;')
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 813, in _eval_line_using_file
        self._synchronize()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1284, in _synchronize
        self._sendstr(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1226, in _sendstr
        self.quit()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 597, in quit
        self._expect.close()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 327, in close
        self.ptyproc.close(force=force)
      File "sage/interfaces/sagespawn.pyx", line 202, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:3059)
        self.fileobj.close()
    IOError: [Errno 5] Input/output error
**********************************************************************
File "src/sage/interfaces/expect.py", line 766, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular('a')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[4]>", line 1, in <module>
        singular('a')
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 798, in __call__
        return SingularElement(self, type, x, False)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 1279, in __init__
        self._name = parent._create(value, type)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 759, in _create
        self.set(type, name, value)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 702, in set
        self.eval(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 655, in eval
        s = Expect.eval(self, x, **kwds)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1354, in eval
        for L in code.split('\n') if L != ''])
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 942, in _eval_line
        self._synchronize()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1284, in _synchronize
        self._sendstr(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1226, in _sendstr
        self.quit()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 597, in quit
        self._expect.close()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 327, in close
        self.ptyproc.close(force=force)
      File "sage/interfaces/sagespawn.pyx", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)
        self.write(str_to_bytes(self.quit_string))
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 562, in write
        return self._writeb(s, flush=flush)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 552, in _writeb
        n = self.fileobj.write(b)
    ValueError: write to closed file
**********************************************************************
File "src/sage/interfaces/expect.py", line 768, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular.eval('quit;')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[5]>", line 1, in <module>
        singular.eval('quit;')
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 655, in eval
        s = Expect.eval(self, x, **kwds)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1354, in eval
        for L in code.split('\n') if L != ''])
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 942, in _eval_line
        self._synchronize()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1284, in _synchronize
        self._sendstr(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1226, in _sendstr
        self.quit()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 597, in quit
        self._expect.close()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 327, in close
        self.ptyproc.close(force=force)
      File "sage/interfaces/sagespawn.pyx", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)
        self.write(str_to_bytes(self.quit_string))
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 562, in write
        return self._writeb(s, flush=flush)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 552, in _writeb
        n = self.fileobj.write(b)
    ValueError: write to closed file
**********************************************************************
```



---

archive/issue_events_351200.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-26T09:41:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351200"
}
```



---

archive/issue_events_351201.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-26T09:41:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351201"
}
```



---

archive/issue_events_351202.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-26T18:21:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351202"
}
```



---

archive/issue_events_351203.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-26T18:21:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351203"
}
```



---

archive/issue_comments_388442.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nMight have been due to other ticket, trying again",
    "created_at": "2018-08-26T18:21:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388442",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:25" align="right">comment:25</div>

Might have been due to other ticket, trying again



---

archive/issue_events_351204.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:25:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351204"
}
```



---

archive/issue_events_351205.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:25:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351205"
}
```



---

archive/issue_comments_388443.json:
```json
{
    "body": "Changed branch from **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)** to **[`1040475`](https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca)**",
    "created_at": "2018-08-30T22:25:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388443",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)** to **[`1040475`](https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca)**



---

archive/issue_comments_388444.json:
```json
{
    "body": "Changed commit from **[`1040475`](https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca)** to none",
    "created_at": "2018-09-01T07:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388444",
    "user": "https://github.com/vbraun"
}
```

Changed commit from **[`1040475`](https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca)** to none



---

archive/issue_comments_388445.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n\n```\n**********************************************************************\nFile \"src/sage/doctest/control.py\", line 1161, in sage.doctest.control.DocTestController.run\nFailed example:\n    DC.run()\nExpected:\n    Running doctests with ID ...\n    Using --optional=external,sage\n    External software to be detected: ...\n    Doctesting 1 file.\n    sage -t ....py\n        [0 tests, 0.00 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.0 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    External software detected for doctesting:...\n    0\nGot:\n    Running doctests with ID 2018-09-01-03-28-58-9687e9f6.\n    Git branch: develop\n    Using --optional=external,sage\n    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\n    Doctesting 1 file.\n    sage -t /home/buildbot/slave/sage_git/dot_sage/temp/sagebd07_64s02/8118/tmp_5ksam4.py\n        [0 tests, 0.00 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.1 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    External software detected for doctesting: \n    0\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.doctest.control.DocTestController.run\n    [206 tests, 1 failure, 4.49 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/doctest/control.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2018-09-01T07:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388445",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:27" align="right">comment:27</div>


```
**********************************************************************
File "src/sage/doctest/control.py", line 1161, in sage.doctest.control.DocTestController.run
Failed example:
    DC.run()
Expected:
    Running doctests with ID ...
    Using --optional=external,sage
    External software to be detected: ...
    Doctesting 1 file.
    sage -t ....py
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    External software detected for doctesting:...
    0
Got:
    Running doctests with ID 2018-09-01-03-28-58-9687e9f6.
    Git branch: develop
    Using --optional=external,sage
    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
    Doctesting 1 file.
    sage -t /home/buildbot/slave/sage_git/dot_sage/temp/sagebd07_64s02/8118/tmp_5ksam4.py
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.1 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    External software detected for doctesting: 
    0
**********************************************************************
1 item had failures:
   1 of  13 in sage.doctest.control.DocTestController.run
    [206 tests, 1 failure, 4.49 s]
----------------------------------------------------------------------
sage -t --long src/sage/doctest/control.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_388446.json:
```json
{
    "body": "Commit: **[`76f0177`](https://github.com/sagemath/sagetrac-mirror/commit/76f0177aae010a790ca31fdc17210109ccbffd5b)**",
    "created_at": "2018-09-01T09:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388446",
    "user": "https://github.com/seblabbe"
}
```

Commit: **[`76f0177`](https://github.com/sagemath/sagetrac-mirror/commit/76f0177aae010a790ca31fdc17210109ccbffd5b)**



---

archive/issue_comments_388447.json:
```json
{
    "body": "Changed branch from **[`1040475`](https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca)** to **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)**",
    "created_at": "2018-09-01T09:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388447",
    "user": "https://github.com/seblabbe"
}
```

Changed branch from **[`1040475`](https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca)** to **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)**



---

archive/issue_comments_388448.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50\"><code>221a7db</code></a></td><td><code>Trac 25378: Don't close logfile before last message</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f2d544b3f3e1ab335b4cd257dc01b532020914c\"><code>4f2d544</code></a></td><td><code>25378: adding a doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a\"><code>4eb2799</code></a></td><td><code>25378: fixing issues seen by pyflakes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f8a7acefd6cf192238506b4e0dce72205db6a53\"><code>4f8a7ac</code></a></td><td><code>Merge branch 'public/25378' into 8.4.beta1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90\"><code>7c7e278</code></a></td><td><code>25378: better doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca\"><code>1040475</code></a></td><td><code>25378: more robust doctest</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/76f0177aae010a790ca31fdc17210109ccbffd5b\"><code>76f0177</code></a></td><td><code>25378: doctesting an empty file can take time</code></td></tr></table>\n",
    "created_at": "2018-09-01T09:46:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388448",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:28"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/221a7db9befaa2ca6143a8191d3c2e8ee6694e50"><code>221a7db</code></a></td><td><code>Trac 25378: Don't close logfile before last message</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f2d544b3f3e1ab335b4cd257dc01b532020914c"><code>4f2d544</code></a></td><td><code>25378: adding a doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4eb279903c4e6052b21bf2f1f02d537c8247451a"><code>4eb2799</code></a></td><td><code>25378: fixing issues seen by pyflakes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f8a7acefd6cf192238506b4e0dce72205db6a53"><code>4f8a7ac</code></a></td><td><code>Merge branch 'public/25378' into 8.4.beta1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90"><code>7c7e278</code></a></td><td><code>25378: better doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1040475c94e846bdf343a154f342d4451f4a8cca"><code>1040475</code></a></td><td><code>25378: more robust doctest</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/76f0177aae010a790ca31fdc17210109ccbffd5b"><code>76f0177</code></a></td><td><code>25378: doctesting an empty file can take time</code></td></tr></table>




---

archive/issue_events_351206.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2018-09-01T09:46:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351206"
}
```



---

archive/issue_comments_388449.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nCan't the line `Git branch: develop` cause a doctest error too ?",
    "created_at": "2018-09-04T12:00:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388449",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:30" align="right">comment:30</div>

Can't the line `Git branch: develop` cause a doctest error too ?



---

archive/issue_events_351207.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-09-20T08:18:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351207"
}
```



---

archive/issue_events_351208.json:
```json
{
    "actor": "https://github.com/vinklein",
    "created_at": "2018-09-20T08:18:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351208"
}
```



---

archive/issue_comments_388450.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nNo it can't as end of line ellipsis marker allow to skip lines as regular ellipsis marker.",
    "created_at": "2018-09-20T08:18:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388450",
    "user": "https://github.com/vinklein"
}
```

<div id="comment:31" align="right">comment:31</div>

No it can't as end of line ellipsis marker allow to skip lines as regular ellipsis marker.



---

archive/issue_comments_388451.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nExactly, this is what I thought. Thanks for the review. Hopefully everything is okay now. Last 6 patchbots reports are green (or contain unrelated failures with `pbori.pyx` and `magma.py`).\n\nS\u00e9bastien",
    "created_at": "2018-09-20T08:43:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388451",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:32" align="right">comment:32</div>

Exactly, this is what I thought. Thanks for the review. Hopefully everything is okay now. Last 6 patchbots reports are green (or contain unrelated failures with `pbori.pyx` and `magma.py`).

Sébastien



---

archive/issue_events_351209.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-21T22:20:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351209"
}
```



---

archive/issue_events_351210.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "c7877f52e5076fcfee09e305c0fe8955082a72d4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-09-21T22:20:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25378#event-351210"
}
```



---

archive/issue_comments_388452.json:
```json
{
    "body": "Changed branch from **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)** to **[`76f0177`](https://github.com/sagemath/sagetrac-mirror/commit/76f0177aae010a790ca31fdc17210109ccbffd5b)**",
    "created_at": "2018-09-21T22:20:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25378#issuecomment-388452",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/25378](https://github.com/sagemath/sagetrac-mirror/tree/public/25378)** to **[`76f0177`](https://github.com/sagemath/sagetrac-mirror/commit/76f0177aae010a790ca31fdc17210109ccbffd5b)**
