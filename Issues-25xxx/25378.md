# Issue 25378: I/O operation on closed file when sage -t --optional=sage,external --logfile is_provided.log

archive/issues_025141.json:
```json
{
    "body": "From [8.3.beta1 post](https://groups.google.com/d/msg/sage-release/zh04lo8d44U/P6hrZEusAAAJ) on sage-release:\n\n```\nsage -t src/sage/misc/latex.py --optional=sage,external --logfile a.log\nRunning doctests with ID 2018-05-17-08-30-16-d8cc67d9.\nGit branch: develop\nUsing --optional=external,sage\nExternal software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab\nDoctesting 1 file.\nsage -t --warn-long 80.1 src/sage/misc/latex.py\n    [315 tests, 1.52 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.8 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 1.5 seconds\nExternal software detected for doctesting: latex\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/src/bin/sage-runtests\", line 127, in <module>\n    err = DC.run()\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 1176, in run\n    + ','.join(available_software.seen()))\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 583, in log\n    self.logger.write(s + end)\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 250, in write\n    f.write(x)\nValueError: I/O operation on closed file\n```\n\nThis confirms that the last line (`External software detected for doctesting: latex`) is not written to the log file because of I/O errors:\n\n```\n$ tail a.log\nExternal software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab\nDoctesting 1 file.\nsage -t --warn-long 80.1 src/sage/misc/latex.py\n    [315 tests, 1.52 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.8 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 1.5 seconds\n```\n\n\nThe error is not there if external software are not tested:\n\n```\nsage -t src/sage/misc/latex.py --optional=sage --logfile a.log\nRunning doctests with ID 2018-05-17-08-30-28-7b637155.\nGit branch: develop\nUsing --optional=sage\nDoctesting 1 file.\nsage -t --warn-long 80.1 src/sage/misc/latex.py\n    [310 tests, 1.14 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.2 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 1.1 seconds\n```\n\nThe error is not there if no log file is provided:\n\n```\nsage -t src/sage/misc/latex.py --optional=sage,external\nRunning doctests with ID 2018-05-17-08-30-40-21f560b3.\nGit branch: develop\nUsing --optional=external,sage\nExternal software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab\nDoctesting 1 file.\nsage -t --warn-long 80.1 src/sage/misc/latex.py\n    [315 tests, 1.45 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 1.7 seconds\n    cpu time: 0.5 seconds\n    cumulative wall time: 1.4 seconds\nExternal software detected for doctesting: latex\n```\n\nCC:  @vinklein\n\nKeywords: thursdaysbdx\n\nBranch/Commit: 76f0177aae010a790ca31fdc17210109ccbffd5b\n\nReviewer: S\u00e9bastien Labb\u00e9, Vincent Klein\n\nAuthor: Vincent Klein, S\u00e9bastien Labb\u00e9\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25378\n\n",
    "closed_at": "2018-09-21T22:20:36Z",
    "created_at": "2018-05-17T06:39:38Z",
    "labels": [
        "component: doctest framework",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "I/O operation on closed file when sage -t --optional=sage,external --logfile is_provided.log",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25378",
    "user": "https://github.com/seblabbe"
}
```
From [8.3.beta1 post](https://groups.google.com/d/msg/sage-release/zh04lo8d44U/P6hrZEusAAAJ) on sage-release:

```
sage -t src/sage/misc/latex.py --optional=sage,external --logfile a.log
Running doctests with ID 2018-05-17-08-30-16-d8cc67d9.
Git branch: develop
Using --optional=external,sage
External software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab
Doctesting 1 file.
sage -t --warn-long 80.1 src/sage/misc/latex.py
    [315 tests, 1.52 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.8 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 1.5 seconds
External software detected for doctesting: latex
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/src/bin/sage-runtests", line 127, in <module>
    err = DC.run()
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1176, in run
    + ','.join(available_software.seen()))
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 583, in log
    self.logger.write(s + end)
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 250, in write
    f.write(x)
ValueError: I/O operation on closed file
```

This confirms that the last line (`External software detected for doctesting: latex`) is not written to the log file because of I/O errors:

```
$ tail a.log
External software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab
Doctesting 1 file.
sage -t --warn-long 80.1 src/sage/misc/latex.py
    [315 tests, 1.52 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.8 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 1.5 seconds
```


The error is not there if external software are not tested:

```
sage -t src/sage/misc/latex.py --optional=sage --logfile a.log
Running doctests with ID 2018-05-17-08-30-28-7b637155.
Git branch: develop
Using --optional=sage
Doctesting 1 file.
sage -t --warn-long 80.1 src/sage/misc/latex.py
    [310 tests, 1.14 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.2 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 1.1 seconds
```

The error is not there if no log file is provided:

```
sage -t src/sage/misc/latex.py --optional=sage,external
Running doctests with ID 2018-05-17-08-30-40-21f560b3.
Git branch: develop
Using --optional=external,sage
External software to be detected: cplex,gurobi,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,scilab
Doctesting 1 file.
sage -t --warn-long 80.1 src/sage/misc/latex.py
    [315 tests, 1.45 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.7 seconds
    cpu time: 0.5 seconds
    cumulative wall time: 1.4 seconds
External software detected for doctesting: latex
```

CC:  @vinklein

Keywords: thursdaysbdx

Branch/Commit: 76f0177aae010a790ca31fdc17210109ccbffd5b

Reviewer: Sébastien Labbé, Vincent Klein

Author: Vincent Klein, Sébastien Labbé

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25378





---

archive/issue_comments_484932.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n+From [8.3.beta1 post](https://groups.google.com/d/msg/sage-release/zh04lo8d44U/P6hrZEusAAAJ) on sage-release:\n+\n ```\n sage -t src/sage/misc/latex.py --optional=sage,external --logfile a.log\n Running doctests with ID 2018-05-17-08-30-16-d8cc67d9.\n``````\n",
    "created_at": "2018-05-17T10:00:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484932",
    "user": "https://github.com/seblabbe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
+From [8.3.beta1 post](https://groups.google.com/d/msg/sage-release/zh04lo8d44U/P6hrZEusAAAJ) on sage-release:
+
 ```
 sage -t src/sage/misc/latex.py --optional=sage,external --logfile a.log
 Running doctests with ID 2018-05-17-08-30-16-d8cc67d9.
``````




---

archive/issue_comments_484933.json:
```json
{
    "body": "Changing branch from \"\" to \"u/vklein/25378\"",
    "created_at": "2018-07-05T12:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484933",
    "user": "https://github.com/vinklein"
}
```

Changing branch from "" to "u/vklein/25378"



---

archive/issue_comments_484934.json:
```json
{
    "body": "Changing commit from \"\" to \"6bccacc656da232367d7d5b0a421a0313a912ec4\"",
    "created_at": "2018-07-05T12:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484934",
    "user": "https://github.com/vinklein"
}
```

Changing commit from "" to "6bccacc656da232367d7d5b0a421a0313a912ec4"



---

archive/issue_comments_484935.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-05T12:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484935",
    "user": "https://github.com/vinklein"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_484936.json:
```json
{
    "body": "Changing author from \"\" to \"Vincent Klein\"",
    "created_at": "2018-07-05T12:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484936",
    "user": "https://github.com/vinklein"
}
```

Changing author from "" to "Vincent Klein"



---

archive/issue_comments_484937.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-05T14:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484937",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_484938.json:
```json
{
    "body": "Changing commit from \"6bccacc656da232367d7d5b0a421a0313a912ec4\" to \"221a7db9befaa2ca6143a8191d3c2e8ee6694e50\"",
    "created_at": "2018-07-05T14:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6bccacc656da232367d7d5b0a421a0313a912ec4" to "221a7db9befaa2ca6143a8191d3c2e8ee6694e50"



---

archive/issue_comments_484939.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-05T14:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484939",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484940.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-05T14:29:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484940",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_484941.json:
```json
{
    "body": "<a id='comment:8'></a>I found a way to raise the issue from sage:\n\n```\nsage: from sage.doctest.control import DocTestDefaults, DocTestController\nsage: DD = DocTestDefaults(optional=set(['sage', 'external']), logfile=tmp_filename())\nsage: filename = os.path.join(SAGE_SRC, \"sage\", \"misc\", \"latex.py\")\nsage: DC = DocTestController(DD, [filename])\nsage: DC.run()\n```\n\nThus, I added a commit with a doctest + a commit fixing the two pyflakes issues (see patchbot report).\n\n---\nNew commits:",
    "created_at": "2018-07-05T19:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484941",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:8'></a>I found a way to raise the issue from sage:

```
sage: from sage.doctest.control import DocTestDefaults, DocTestController
sage: DD = DocTestDefaults(optional=set(['sage', 'external']), logfile=tmp_filename())
sage: filename = os.path.join(SAGE_SRC, "sage", "misc", "latex.py")
sage: DC = DocTestController(DD, [filename])
sage: DC.run()
```

Thus, I added a commit with a doctest + a commit fixing the two pyflakes issues (see patchbot report).

---
New commits:



---

archive/issue_comments_484942.json:
```json
{
    "body": "Changing branch from \"u/vklein/25378\" to \"public/25378\"",
    "created_at": "2018-07-05T19:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484942",
    "user": "https://github.com/seblabbe"
}
```

Changing branch from "u/vklein/25378" to "public/25378"



---

archive/issue_comments_484943.json:
```json
{
    "body": "Changing commit from \"221a7db9befaa2ca6143a8191d3c2e8ee6694e50\" to \"4eb279903c4e6052b21bf2f1f02d537c8247451a\"",
    "created_at": "2018-07-05T19:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484943",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "221a7db9befaa2ca6143a8191d3c2e8ee6694e50" to "4eb279903c4e6052b21bf2f1f02d537c8247451a"



---

archive/issue_comments_484944.json:
```json
{
    "body": "Changing reviewer from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2018-07-05T19:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484944",
    "user": "https://github.com/seblabbe"
}
```

Changing reviewer from "" to "Sébastien Labbé"



---

archive/issue_comments_484945.json:
```json
{
    "body": "<a id='comment:9'></a>I give positive review to commit \u200b221a7db. I let someone else review my two commits.",
    "created_at": "2018-07-05T19:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484945",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:9'></a>I give positive review to commit ​221a7db. I let someone else review my two commits.



---

archive/issue_comments_484946.json:
```json
{
    "body": "<a id='comment:10'></a>Of course, \"someone else\" may include you Vincent Klein as this is often done, see #19494 :)",
    "created_at": "2018-07-06T14:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484946",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:10'></a>Of course, "someone else" may include you Vincent Klein as this is often done, see #19494 :)



---

archive/issue_comments_484947.json:
```json
{
    "body": "Changing reviewer from \"S\u00e9bastien Labb\u00e9\" to \"S\u00e9bastien Labb\u00e9, Vincent Klein\"",
    "created_at": "2018-07-18T09:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484947",
    "user": "https://github.com/vinklein"
}
```

Changing reviewer from "Sébastien Labbé" to "Sébastien Labbé, Vincent Klein"



---

archive/issue_comments_484948.json:
```json
{
    "body": "<a id='comment:11'></a>I m ok for the last two commits.",
    "created_at": "2018-07-18T09:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484948",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:11'></a>I m ok for the last two commits.



---

archive/issue_comments_484949.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-18T09:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484949",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_484950.json:
```json
{
    "body": "Changing author from \"Vincent Klein\" to \"Vincent Klein, S\u00e9bastien Labb\u00e9\"",
    "created_at": "2018-07-18T09:35:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484950",
    "user": "https://github.com/vinklein"
}
```

Changing author from "Vincent Klein" to "Vincent Klein, Sébastien Labbé"



---

archive/issue_comments_484951.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-07-30T12:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484951",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_484952.json:
```json
{
    "body": "<a id='comment:12'></a>\n```\nFile \"src/sage/doctest/control.py\", line 1145, in sage.doctest.control.DocTestController.run\nFailed example:\n    DC.run()\nExpected:\n    Running doctests with ID ...\n    Using --optional=external,sage\n    External software to be detected: ...\n    Doctesting 1 file.\n    sage -t .../sage/misc/latex.py\n        [... tests, ... s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: ... seconds\n        cpu time: ... seconds\n        cumulative wall time: ... seconds\n    External software detected for doctesting: ...\n    0\nGot:\n    Running doctests with ID 2018-07-30-14-14-47-59620918.\n    Git branch: test\n    Using --optional=external,sage\n    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\n    Doctesting 1 file.\n    sage -t /mnt/disk/home/release/Sage/src/sage/misc/latex.py\n    **********************************************************************\n    File \"/mnt/disk/home/release/Sage/src/sage/misc/latex.py\", line 1548, in sage.misc.latex.Latex.add_package_to_preamble_if_available\n    Failed example:\n        latex.extra_preamble()       # optional - latex\n    Expected:\n        '\\\\usepackage{xypic}\\n'\n    Got:\n        ''\n    **********************************************************************\n    1 item had failures:\n       1 of   5 in sage.misc.latex.Latex.add_package_to_preamble_if_available\n        [316 tests, 1 failure, 1.29 s]\n    ----------------------------------------------------------------------\n    sage -t /mnt/disk/home/release/Sage/src/sage/misc/latex.py  # 1 doctest failed\n    ----------------------------------------------------------------------\n    Total time for all tests: 1.6 seconds\n        cpu time: 0.4 seconds\n        cumulative wall time: 1.3 seconds\n    External software detected for doctesting: imagemagick,latex\n    1\n**********************************************************************\n```",
    "created_at": "2018-07-30T12:19:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484952",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:12'></a>
```
File "src/sage/doctest/control.py", line 1145, in sage.doctest.control.DocTestController.run
Failed example:
    DC.run()
Expected:
    Running doctests with ID ...
    Using --optional=external,sage
    External software to be detected: ...
    Doctesting 1 file.
    sage -t .../sage/misc/latex.py
        [... tests, ... s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: ... seconds
        cpu time: ... seconds
        cumulative wall time: ... seconds
    External software detected for doctesting: ...
    0
Got:
    Running doctests with ID 2018-07-30-14-14-47-59620918.
    Git branch: test
    Using --optional=external,sage
    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
    Doctesting 1 file.
    sage -t /mnt/disk/home/release/Sage/src/sage/misc/latex.py
    **********************************************************************
    File "/mnt/disk/home/release/Sage/src/sage/misc/latex.py", line 1548, in sage.misc.latex.Latex.add_package_to_preamble_if_available
    Failed example:
        latex.extra_preamble()       # optional - latex
    Expected:
        '\\usepackage{xypic}\n'
    Got:
        ''
    **********************************************************************
    1 item had failures:
       1 of   5 in sage.misc.latex.Latex.add_package_to_preamble_if_available
        [316 tests, 1 failure, 1.29 s]
    ----------------------------------------------------------------------
    sage -t /mnt/disk/home/release/Sage/src/sage/misc/latex.py  # 1 doctest failed
    ----------------------------------------------------------------------
    Total time for all tests: 1.6 seconds
        cpu time: 0.4 seconds
        cumulative wall time: 1.3 seconds
    External software detected for doctesting: imagemagick,latex
    1
**********************************************************************
```



---

archive/issue_events_063663.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25378#event-63663"
}
```



---

archive/issue_comments_484953.json:
```json
{
    "body": "<a id='comment:13'></a>update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484953",
    "user": "https://github.com/videlec"
}
```

<a id='comment:13'></a>update milestone 8.3 -> 8.4



---

archive/issue_comments_484954.json:
```json
{
    "body": "<a id='comment:14'></a>In the doctest, I was testing that `sage -t --optional=sage,external --logfile a.log` works on a file inside the sage library containing at least one external doctest namely `sage/misc/latex.py`. Of course, this test way too much thing including all of the doctests inside of that file which may create other unrelated failures like the one obtained by Volker.\n\nI found a much simpler way to test that the error is fixed. Indeed, running the command on a empty file raises the failure:\n\n```\n$ touch a.py\n$ sage -t a.py --optional=sage,external --logfile a.log\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2018-08-22-14-45-05-4d9b505f.\nGit branch: develop\nUsing --optional=external,sage\nExternal software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\nDoctesting 1 file.\nsage -t a.py\n    [0 tests, 0.00 s]\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 0.2 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\nExternal software detected for doctesting: \nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/src/bin/sage-runtests\", line 139, in <module>\n    err = DC.run()\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 1185, in run\n    + ','.join(available_software.seen()))\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 592, in log\n    self.logger.write(s + end)\n  File \"/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 255, in write\n    f.write(x)\nValueError: I/O operation on closed file\n```\n\nTherefore, I will update the doctest with this instead.",
    "created_at": "2018-08-22T12:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484954",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:14'></a>In the doctest, I was testing that `sage -t --optional=sage,external --logfile a.log` works on a file inside the sage library containing at least one external doctest namely `sage/misc/latex.py`. Of course, this test way too much thing including all of the doctests inside of that file which may create other unrelated failures like the one obtained by Volker.

I found a much simpler way to test that the error is fixed. Indeed, running the command on a empty file raises the failure:

```
$ touch a.py
$ sage -t a.py --optional=sage,external --logfile a.log
too many failed tests, not using stored timings
Running doctests with ID 2018-08-22-14-45-05-4d9b505f.
Git branch: develop
Using --optional=external,sage
External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
Doctesting 1 file.
sage -t a.py
    [0 tests, 0.00 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 0.2 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
External software detected for doctesting: 
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/src/bin/sage-runtests", line 139, in <module>
    err = DC.run()
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1185, in run
    + ','.join(available_software.seen()))
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 592, in log
    self.logger.write(s + end)
  File "/home/slabbe/GitBox/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 255, in write
    f.write(x)
ValueError: I/O operation on closed file
```

Therefore, I will update the doctest with this instead.



---

archive/issue_comments_484955.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-22T13:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484955",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484956.json:
```json
{
    "body": "Changing commit from \"4eb279903c4e6052b21bf2f1f02d537c8247451a\" to \"7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90\"",
    "created_at": "2018-08-22T13:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484956",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4eb279903c4e6052b21bf2f1f02d537c8247451a" to "7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90"



---

archive/issue_comments_484957.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-22T13:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484957",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_484958.json:
```json
{
    "body": "<a id='comment:17'></a>Fine for me",
    "created_at": "2018-08-22T13:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484958",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:17'></a>Fine for me



---

archive/issue_comments_484959.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-22T13:41:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484959",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_484960.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-25T11:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484960",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_063664.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-25T11:01:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25378#event-63664"
}
```



---

archive/issue_comments_484961.json:
```json
{
    "body": "Changing branch from \"public/25378\" to \"7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90\"",
    "created_at": "2018-08-25T11:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484961",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/25378" to "7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90"



---

archive/issue_comments_484962.json:
```json
{
    "body": "<a id='comment:19'></a>The test is fragile:\n\n```\nFile \"src/sage/doctest/control.py\", line 1161, in sage.doctest.control.DocTestController.run\nFailed example:\n    DC.run()\nExpected:\n    Running doctests with ID ...\n    Using --optional=external,sage\n    External software to be detected: ...\n    Doctesting 1 file.\n    sage -t ....py\n        [0 tests, 0.00 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.0 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    External software detected for doctesting:\n    0\nGot:\n    Running doctests with ID 2018-08-25-08-26-30-30c10539.\n    Git branch: develop\n    Using --optional=external,sage\n    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\n    Doctesting 1 file.\n    sage -t /var/lib/buildbot/slave/sage_git/dot_sage/temp/kucalc/29651/tmp_eWoSer.py\n        [0 tests, 0.00 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.0 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    External software detected for doctesting: latex\n    0\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.doctest.control.DocTestController.run\n    [206 tests, 1 failure, 4.48 s]\n**********************************************************************\n```\n\n---\nNew commits:",
    "created_at": "2018-08-25T15:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484962",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>The test is fragile:

```
File "src/sage/doctest/control.py", line 1161, in sage.doctest.control.DocTestController.run
Failed example:
    DC.run()
Expected:
    Running doctests with ID ...
    Using --optional=external,sage
    External software to be detected: ...
    Doctesting 1 file.
    sage -t ....py
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    External software detected for doctesting:
    0
Got:
    Running doctests with ID 2018-08-25-08-26-30-30c10539.
    Git branch: develop
    Using --optional=external,sage
    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
    Doctesting 1 file.
    sage -t /var/lib/buildbot/slave/sage_git/dot_sage/temp/kucalc/29651/tmp_eWoSer.py
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    External software detected for doctesting: latex
    0
**********************************************************************
1 item had failures:
   1 of  13 in sage.doctest.control.DocTestController.run
    [206 tests, 1 failure, 4.48 s]
**********************************************************************
```

---
New commits:



---

archive/issue_comments_484963.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2018-08-25T15:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484963",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_484964.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2018-08-25T15:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484964",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_063665.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-25T15:42:55Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25378#event-63665"
}
```



---

archive/issue_comments_484965.json:
```json
{
    "body": "Changing branch from \"7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90\" to \"public/25378\"",
    "created_at": "2018-08-25T15:42:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484965",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90" to "public/25378"



---

archive/issue_comments_484966.json:
```json
{
    "body": "<a id='comment:20'></a>use the trac role `:trac:`25378`` instead of `#25378` in\n\n+        We check that #25378 is fixed (testing external packages while",
    "created_at": "2018-08-25T15:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484966",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:20'></a>use the trac role `:trac:`25378`` instead of `#25378` in

+        We check that #25378 is fixed (testing external packages while



---

archive/issue_comments_484967.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-25T17:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484967",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_484968.json:
```json
{
    "body": "Changing commit from \"7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90\" to \"1040475c94e846bdf343a154f342d4451f4a8cca\"",
    "created_at": "2018-08-25T17:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484968",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7c7e278e3b73eba206cf5cbf5dd11bdbd4adee90" to "1040475c94e846bdf343a154f342d4451f4a8cca"



---

archive/issue_comments_484969.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-25T17:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484969",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_484970.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-08-25T22:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484970",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_484971.json:
```json
{
    "body": "<a id='comment:24'></a>On OSX I get lots of failures of the form \n\n```\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 763, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular._eval_line_using_file('def a=3;')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line_using_file[3]>\", line 1, in <module>\n        singular._eval_line_using_file('def a=3;')\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 813, in _eval_line_using_file\n        self._synchronize()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1284, in _synchronize\n        self._sendstr(cmd)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1226, in _sendstr\n        self.quit()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 597, in quit\n        self._expect.close()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 327, in close\n        self.ptyproc.close(force=force)\n      File \"sage/interfaces/sagespawn.pyx\", line 202, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:3059)\n        self.fileobj.close()\n    IOError: [Errno 5] Input/output error\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 766, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular('a')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line_using_file[4]>\", line 1, in <module>\n        singular('a')\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 798, in __call__\n        return SingularElement(self, type, x, False)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 1279, in __init__\n        self._name = parent._create(value, type)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 759, in _create\n        self.set(type, name, value)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 702, in set\n        self.eval(cmd)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 655, in eval\n        s = Expect.eval(self, x, **kwds)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1354, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 942, in _eval_line\n        self._synchronize()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1284, in _synchronize\n        self._sendstr(cmd)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1226, in _sendstr\n        self.quit()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 597, in quit\n        self._expect.close()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 327, in close\n        self.ptyproc.close(force=force)\n      File \"sage/interfaces/sagespawn.pyx\", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)\n        self.write(str_to_bytes(self.quit_string))\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py\", line 562, in write\n        return self._writeb(s, flush=flush)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py\", line 552, in _writeb\n        n = self.fileobj.write(b)\n    ValueError: write to closed file\n**********************************************************************\nFile \"src/sage/interfaces/expect.py\", line 768, in sage.interfaces.expect.Expect._eval_line_using_file\nFailed example:\n    singular.eval('quit;')\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 650, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1061, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.expect.Expect._eval_line_using_file[5]>\", line 1, in <module>\n        singular.eval('quit;')\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py\", line 655, in eval\n        s = Expect.eval(self, x, **kwds)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1354, in eval\n        for L in code.split('\\n') if L != ''])\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 942, in _eval_line\n        self._synchronize()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1284, in _synchronize\n        self._sendstr(cmd)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 1226, in _sendstr\n        self.quit()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py\", line 597, in quit\n        self._expect.close()\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py\", line 327, in close\n        self.ptyproc.close(force=force)\n      File \"sage/interfaces/sagespawn.pyx\", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)\n        self.write(str_to_bytes(self.quit_string))\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py\", line 562, in write\n        return self._writeb(s, flush=flush)\n      File \"/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py\", line 552, in _writeb\n        n = self.fileobj.write(b)\n    ValueError: write to closed file\n**********************************************************************\n```",
    "created_at": "2018-08-26T09:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484971",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>On OSX I get lots of failures of the form 

```
**********************************************************************
File "src/sage/interfaces/expect.py", line 763, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular._eval_line_using_file('def a=3;')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[3]>", line 1, in <module>
        singular._eval_line_using_file('def a=3;')
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 813, in _eval_line_using_file
        self._synchronize()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1284, in _synchronize
        self._sendstr(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1226, in _sendstr
        self.quit()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 597, in quit
        self._expect.close()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 327, in close
        self.ptyproc.close(force=force)
      File "sage/interfaces/sagespawn.pyx", line 202, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:3059)
        self.fileobj.close()
    IOError: [Errno 5] Input/output error
**********************************************************************
File "src/sage/interfaces/expect.py", line 766, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular('a')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[4]>", line 1, in <module>
        singular('a')
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 798, in __call__
        return SingularElement(self, type, x, False)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 1279, in __init__
        self._name = parent._create(value, type)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 759, in _create
        self.set(type, name, value)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 702, in set
        self.eval(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 655, in eval
        s = Expect.eval(self, x, **kwds)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1354, in eval
        for L in code.split('\n') if L != ''])
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 942, in _eval_line
        self._synchronize()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1284, in _synchronize
        self._sendstr(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1226, in _sendstr
        self.quit()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 597, in quit
        self._expect.close()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 327, in close
        self.ptyproc.close(force=force)
      File "sage/interfaces/sagespawn.pyx", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)
        self.write(str_to_bytes(self.quit_string))
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 562, in write
        return self._writeb(s, flush=flush)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 552, in _writeb
        n = self.fileobj.write(b)
    ValueError: write to closed file
**********************************************************************
File "src/sage/interfaces/expect.py", line 768, in sage.interfaces.expect.Expect._eval_line_using_file
Failed example:
    singular.eval('quit;')
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 650, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1061, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.expect.Expect._eval_line_using_file[5]>", line 1, in <module>
        singular.eval('quit;')
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/singular.py", line 655, in eval
        s = Expect.eval(self, x, **kwds)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1354, in eval
        for L in code.split('\n') if L != ''])
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 942, in _eval_line
        self._synchronize()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1284, in _synchronize
        self._sendstr(cmd)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 1226, in _sendstr
        self.quit()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/interfaces/expect.py", line 597, in quit
        self._expect.close()
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/pexpect/pty_spawn.py", line 327, in close
        self.ptyproc.close(force=force)
      File "sage/interfaces/sagespawn.pyx", line 199, in sage.interfaces.sagespawn.SagePtyProcess.close (build/cythonized/sage/interfaces/sagespawn.c:2940)
        self.write(str_to_bytes(self.quit_string))
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 562, in write
        return self._writeb(s, flush=flush)
      File "/Users/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/ptyprocess/ptyprocess.py", line 552, in _writeb
        n = self.fileobj.write(b)
    ValueError: write to closed file
**********************************************************************
```



---

archive/issue_comments_484972.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-08-26T09:41:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484972",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_484973.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-08-26T18:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484973",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_484974.json:
```json
{
    "body": "<a id='comment:25'></a>Might have been due to other ticket, trying again",
    "created_at": "2018-08-26T18:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484974",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>Might have been due to other ticket, trying again



---

archive/issue_events_063666.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-30T22:25:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25378#event-63666"
}
```



---

archive/issue_comments_484975.json:
```json
{
    "body": "Changing branch from \"public/25378\" to \"1040475c94e846bdf343a154f342d4451f4a8cca\"",
    "created_at": "2018-08-30T22:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484975",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/25378" to "1040475c94e846bdf343a154f342d4451f4a8cca"



---

archive/issue_comments_484976.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-30T22:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484976",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_484977.json:
```json
{
    "body": "Changing commit from \"1040475c94e846bdf343a154f342d4451f4a8cca\" to \"\"",
    "created_at": "2018-09-01T07:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484977",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "1040475c94e846bdf343a154f342d4451f4a8cca" to ""



---

archive/issue_comments_484978.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2018-09-01T07:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484978",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_484979.json:
```json
{
    "body": "<a id='comment:27'></a>\n```\n**********************************************************************\nFile \"src/sage/doctest/control.py\", line 1161, in sage.doctest.control.DocTestController.run\nFailed example:\n    DC.run()\nExpected:\n    Running doctests with ID ...\n    Using --optional=external,sage\n    External software to be detected: ...\n    Doctesting 1 file.\n    sage -t ....py\n        [0 tests, 0.00 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.0 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    External software detected for doctesting:...\n    0\nGot:\n    Running doctests with ID 2018-09-01-03-28-58-9687e9f6.\n    Git branch: develop\n    Using --optional=external,sage\n    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab\n    Doctesting 1 file.\n    sage -t /home/buildbot/slave/sage_git/dot_sage/temp/sagebd07_64s02/8118/tmp_5ksam4.py\n        [0 tests, 0.00 s]\n    ----------------------------------------------------------------------\n    All tests passed!\n    ----------------------------------------------------------------------\n    Total time for all tests: 0.1 seconds\n        cpu time: 0.0 seconds\n        cumulative wall time: 0.0 seconds\n    External software detected for doctesting: \n    0\n**********************************************************************\n1 item had failures:\n   1 of  13 in sage.doctest.control.DocTestController.run\n    [206 tests, 1 failure, 4.49 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/doctest/control.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2018-09-01T07:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484979",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:27'></a>
```
**********************************************************************
File "src/sage/doctest/control.py", line 1161, in sage.doctest.control.DocTestController.run
Failed example:
    DC.run()
Expected:
    Running doctests with ID ...
    Using --optional=external,sage
    External software to be detected: ...
    Doctesting 1 file.
    sage -t ....py
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.0 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    External software detected for doctesting:...
    0
Got:
    Running doctests with ID 2018-09-01-03-28-58-9687e9f6.
    Git branch: develop
    Using --optional=external,sage
    External software to be detected: cplex,ffmpeg,graphviz,gurobi,imagemagick,internet,latex,macaulay2,magma,maple,mathematica,matlab,octave,pandoc,scilab
    Doctesting 1 file.
    sage -t /home/buildbot/slave/sage_git/dot_sage/temp/sagebd07_64s02/8118/tmp_5ksam4.py
        [0 tests, 0.00 s]
    ----------------------------------------------------------------------
    All tests passed!
    ----------------------------------------------------------------------
    Total time for all tests: 0.1 seconds
        cpu time: 0.0 seconds
        cumulative wall time: 0.0 seconds
    External software detected for doctesting: 
    0
**********************************************************************
1 item had failures:
   1 of  13 in sage.doctest.control.DocTestController.run
    [206 tests, 1 failure, 4.49 s]
----------------------------------------------------------------------
sage -t --long src/sage/doctest/control.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_484980.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2018-09-01T07:55:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484980",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_063667.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-01T07:55:42Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25378#event-63667"
}
```



---

archive/issue_comments_484981.json:
```json
{
    "body": "Changing commit from \"\" to \"76f0177aae010a790ca31fdc17210109ccbffd5b\"",
    "created_at": "2018-09-01T09:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484981",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "" to "76f0177aae010a790ca31fdc17210109ccbffd5b"



---

archive/issue_comments_484982.json:
```json
{
    "body": "Changing branch from \"1040475c94e846bdf343a154f342d4451f4a8cca\" to \"public/25378\"",
    "created_at": "2018-09-01T09:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484982",
    "user": "https://github.com/seblabbe"
}
```

Changing branch from "1040475c94e846bdf343a154f342d4451f4a8cca" to "public/25378"



---

archive/issue_comments_484983.json:
```json
{
    "body": "<a id='comment:28'></a>New commits:",
    "created_at": "2018-09-01T09:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484983",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:28'></a>New commits:



---

archive/issue_comments_484984.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-09-01T09:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484984",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_484985.json:
```json
{
    "body": "<a id='comment:30'></a>Can't the line `Git branch: develop` cause a doctest error too ?",
    "created_at": "2018-09-04T12:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484985",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:30'></a>Can't the line `Git branch: develop` cause a doctest error too ?



---

archive/issue_comments_484986.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-20T08:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484986",
    "user": "https://github.com/vinklein"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_484987.json:
```json
{
    "body": "<a id='comment:31'></a>No it can't as end of line ellipsis marker allow to skip lines as regular ellipsis marker.",
    "created_at": "2018-09-20T08:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484987",
    "user": "https://github.com/vinklein"
}
```

<a id='comment:31'></a>No it can't as end of line ellipsis marker allow to skip lines as regular ellipsis marker.



---

archive/issue_comments_484988.json:
```json
{
    "body": "<a id='comment:32'></a>Exactly, this is what I thought. Thanks for the review. Hopefully everything is okay now. Last 6 patchbots reports are green (or contain unrelated failures with `pbori.pyx` and `magma.py`).\n\nS\u00e9bastien",
    "created_at": "2018-09-20T08:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484988",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:32'></a>Exactly, this is what I thought. Thanks for the review. Hopefully everything is okay now. Last 6 patchbots reports are green (or contain unrelated failures with `pbori.pyx` and `magma.py`).

Sébastien



---

archive/issue_events_063668.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-21T22:20:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25378#event-63668"
}
```



---

archive/issue_comments_484989.json:
```json
{
    "body": "Changing branch from \"public/25378\" to \"76f0177aae010a790ca31fdc17210109ccbffd5b\"",
    "created_at": "2018-09-21T22:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484989",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/25378" to "76f0177aae010a790ca31fdc17210109ccbffd5b"



---

archive/issue_comments_484990.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-21T22:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25378",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25378#issuecomment-484990",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
