# Issue 25840: py3: towards pdf-docbuild. some care for automethod

archive/issues_025603.json:
```json
{
    "assignees": [],
    "body": "\n\nCC:  @tscrim @jdemeyer\n\nBranch/Commit: **[`acad1de`](https://github.com/sagemath/sagetrac-mirror/commit/acad1de09068e2b664e35f5ac1f912bda64a813a)**\n\nReviewer: **John Palmieri**\n\nAuthor: **Fr\u00e9d\u00e9ric Chapoton**\n\nComponent: **python3**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25840_\n\n",
    "closed_at": "2018-08-17T21:14:10Z",
    "created_at": "2018-07-12T07:58:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20python3",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "py3: towards pdf-docbuild. some care for automethod",
    "type": "issue",
    "updated_at": "2018-08-17T21:14:10Z",
    "url": "https://github.com/sagemath/sage/issues/25840",
    "user": "https://github.com/fchapoton"
}
```


CC:  @tscrim @jdemeyer

Branch/Commit: **[`acad1de`](https://github.com/sagemath/sagetrac-mirror/commit/acad1de09068e2b664e35f5ac1f912bda64a813a)**

Reviewer: **John Palmieri**

Author: **Frédéric Chapoton**

Component: **python3**

_Issue created by migration from https://trac.sagemath.org/ticket/25840_





---

archive/issue_events_354155.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-12T07:58:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354155"
}
```



---

archive/issue_events_354156.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-12T07:58:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20python3",
    "label_color": "0000b0",
    "label_name": "c: python3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354156"
}
```



---

archive/issue_events_354157.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-12T07:58:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354157"
}
```



---

archive/issue_events_354158.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-12T07:58:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354158"
}
```



---

archive/issue_comments_397102.json:
```json
{
    "body": "Commit: **[`efc23b6`](https://github.com/sagemath/sagetrac-mirror/commit/efc23b64dc8dcd038d7fc6973a8d6a5a6d1c0faf)**",
    "created_at": "2018-07-12T08:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397102",
    "user": "https://github.com/fchapoton"
}
```

Commit: **[`efc23b6`](https://github.com/sagemath/sagetrac-mirror/commit/efc23b64dc8dcd038d7fc6973a8d6a5a6d1c0faf)**



---

archive/issue_comments_397103.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/efc23b64dc8dcd038d7fc6973a8d6a5a6d1c0faf\"><code>efc23b6</code></a></td><td><code>py3: fix use of automethod for pdf docbuild</code></td></tr></table>\n",
    "created_at": "2018-07-12T08:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397103",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/efc23b64dc8dcd038d7fc6973a8d6a5a6d1c0faf"><code>efc23b6</code></a></td><td><code>py3: fix use of automethod for pdf docbuild</code></td></tr></table>




---

archive/issue_comments_397104.json:
```json
{
    "body": "Branch: **[u/chapoton/25840](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/25840)**",
    "created_at": "2018-07-12T08:09:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397104",
    "user": "https://github.com/fchapoton"
}
```

Branch: **[u/chapoton/25840](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/25840)**



---

archive/issue_events_354159.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-07-12T08:09:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354159"
}
```



---

archive/issue_comments_397105.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nNot sure what to do. Is this a correct fix, or is this just curing the symptoms and not the disease ?",
    "created_at": "2018-07-12T09:43:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397105",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:2" align="right">comment:2</div>

Not sure what to do. Is this a correct fix, or is this just curing the symptoms and not the disease ?



---

archive/issue_comments_397106.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nany opinion on this one ?",
    "created_at": "2018-07-24T06:26:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397106",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

any opinion on this one ?



---

archive/issue_comments_397107.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI don't have any objections to this approach, and since no one else has spoken up, I say we go ahead. Two comments: first, I get an error with docbuilding (html, not pdf) with or without your change in about `__div__` in `structure.pyx`. Second, I also suggest this  change:\n\n```diff\ndiff --git a/src/sage_setup/docbuild/ext/multidocs.py b/src/sage_setup/docbuild/ext/multidocs.py\nindex 5dec201010..62d39461df 100644\n--- a/src/sage_setup/docbuild/ext/multidocs.py\n+++ b/src/sage_setup/docbuild/ext/multidocs.py\n@@ -236,7 +236,7 @@ def write_citations(app, citations):\n     \"\"\"\n     from sage.misc.temporary_file import atomic_write\n     outdir = citation_dir(app)\n-    with atomic_write(os.path.join(outdir, CITE_FILENAME)) as f:\n+    with atomic_write(os.path.join(outdir, CITE_FILENAME), binary=True) as f:\n         cPickle.dump(citations, f)\n     app.info(\"Saved pickle file: %s\" % CITE_FILENAME)\n \n```\n`atomic_write` has `binary=True` as default for Python 2 but not for Python 3, but we are writing binary data here regardless of the version of Python.",
    "created_at": "2018-08-07T20:52:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397107",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

I don't have any objections to this approach, and since no one else has spoken up, I say we go ahead. Two comments: first, I get an error with docbuilding (html, not pdf) with or without your change in about `__div__` in `structure.pyx`. Second, I also suggest this  change:

```diff
diff --git a/src/sage_setup/docbuild/ext/multidocs.py b/src/sage_setup/docbuild/ext/multidocs.py
index 5dec201010..62d39461df 100644
--- a/src/sage_setup/docbuild/ext/multidocs.py
+++ b/src/sage_setup/docbuild/ext/multidocs.py
@@ -236,7 +236,7 @@ def write_citations(app, citations):
     """
     from sage.misc.temporary_file import atomic_write
     outdir = citation_dir(app)
-    with atomic_write(os.path.join(outdir, CITE_FILENAME)) as f:
+    with atomic_write(os.path.join(outdir, CITE_FILENAME), binary=True) as f:
         cPickle.dump(citations, f)
     app.info("Saved pickle file: %s" % CITE_FILENAME)
 
```
`atomic_write` has `binary=True` as default for Python 2 but not for Python 3, but we are writing binary data here regardless of the version of Python.



---

archive/issue_comments_397108.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAlso regarding the docs, both html and pdf, I'm getting some weird error message about `numerical/backends/logging_backend.py`. I don't know a good way to fix that.\n\n```\n[docpdf]   File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.4.beta0/local/lib/python3.6/site-packages/sage/numerical/backends/logging_backend.py\", line 211, in _override_attr\n[docpdf]     _mm = types.MethodType(_make_wrapper(GenericBackend(), attr), None, LoggingBackend)\n[docpdf] TypeError: method expected 2 arguments, got 3\n```",
    "created_at": "2018-08-07T21:08:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397108",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:6" align="right">comment:6</div>

Also regarding the docs, both html and pdf, I'm getting some weird error message about `numerical/backends/logging_backend.py`. I don't know a good way to fix that.

```
[docpdf]   File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.4.beta0/local/lib/python3.6/site-packages/sage/numerical/backends/logging_backend.py", line 211, in _override_attr
[docpdf]     _mm = types.MethodType(_make_wrapper(GenericBackend(), attr), None, LoggingBackend)
[docpdf] TypeError: method expected 2 arguments, got 3
```



---

archive/issue_comments_397109.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI can get the PDF docs to build with the following changes, at least some of which are the wrong thing to do:\n\n```diff\ndiff --git a/src/doc/en/reference/notebook/index.rst b/src/doc/en/reference/notebook/index.rst\nindex 144b8c20e0..9196a59cdd 100644\n--- a/src/doc/en/reference/notebook/index.rst\n+++ b/src/doc/en/reference/notebook/index.rst\n@@ -9,59 +9,4 @@ default notebook to the `Jupyter notebook\n export service.)\n \n \n-Legacy Sage Notebook (sagenb)\n------------------------------\n-\n-.. toctree::\n-   :maxdepth: 2\n-\n-   sagenb/notebook/notebook_object\n-   sagenb/notebook/config\n-   sagenb/notebook/interact\n-   sagenb/notebook/cell\n-   sagenb/notebook/worksheet\n-   sagenb/notebook/notebook\n-   sagenb/notebook/js\n-   sagenb/notebook/css\n-   sagenb/notebook/template\n-\n-Other Servers\n--------------\n-\n-.. toctree::\n-   :maxdepth: 2\n-\n-   sagenb/notebook/challenge\n-\n-Miscellaneous\n--------------\n-\n-.. toctree::\n-   :maxdepth: 2\n-\n-   sagenb/misc/misc\n-   sagenb/misc/support\n-   sagenb/misc/introspect\n-   sagenb/misc/sageinspect\n-   sagenb/misc/sphinxify\n-   sagenb/notebook/docHTMLProcessor\n-\n-Storage\n--------\n-\n-.. toctree::\n-   :maxdepth: 2\n-\n-   sagenb/storage/abstract_storage\n-   sagenb/storage/filesystem_storage\n-\n-.. Commented out, for now.\n-\n-   Interfaces\n-   ----------\n-\n-   SKIP sagenb/interfaces/worksheet_process\n-   SKIP sagenb/interfaces/reference\n-   SKIP sagenb/interfaces/expect\n-\n .. include:: ../footer.txt\ndiff --git a/src/sage/geometry/polyhedron/backend_cdd.py b/src/sage/geometry/polyhedron/backend_cdd.py\nindex b4672e8f1b..9544cf197c 100644\n--- a/src/sage/geometry/polyhedron/backend_cdd.py\n+++ b/src/sage/geometry/polyhedron/backend_cdd.py\n@@ -218,7 +218,7 @@ class Polyhedron_cdd(Polyhedron_base):\n         cddout = cddout.splitlines()\n \n         def parse_indices(count, cdd_indices, cdd_indices_to_sage_indices=None):\n-            cdd_indices = map(int, cdd_indices)\n+            cdd_indices = list(map(int, cdd_indices))\n             if cdd_indices_to_sage_indices is None:\n                 cdd_indices_to_sage_indices = {i:i-1 for i in cdd_indices}\n             if count < 0:\n@@ -247,7 +247,7 @@ class Polyhedron_cdd(Polyhedron_base):\n             assert self.ambient_dim() == dimension - 1, \"Unexpected ambient dimension\"\n             assert len(data) == count, \"Unexpected number of lines\"\n             for i, line in enumerate(data):\n-                coefficients = map(self.base_ring(), line)\n+                coefficients = list(map(self.base_ring(), line))\n                 if coefficients[0] != 0 and all([e == 0 for e in coefficients[1:]]):\n                     # cddlib sometimes includes an implicit plane at infinity: 1 0 0 ... 0\n                     # We do not care about this entry.\ndiff --git a/src/sage/geometry/polyhedron/representation.py b/src/sage/geometry/polyhedron/representation.py\nindex 699c56e066..e53fee0921 100644\n--- a/src/sage/geometry/polyhedron/representation.py\n+++ b/src/sage/geometry/polyhedron/representation.py\n@@ -920,6 +920,7 @@ class Vrepresentation(PolyhedronRepresentation):\n             sage: TestSuite(pV).run(skip='_test_pickling')\n         \"\"\"\n         assert polyhedron.parent() is self._polyhedron_parent\n+        data = list(data)\n         if len(data) != self._vector.degree():\n             raise ValueError('V-representation data requires a list of length ambient_dim')\n \ndiff --git a/src/sage/numerical/backends/logging_backend.py b/src/sage/numerical/backends/logging_backend.py\nindex b2c56e9a6c..79a7b60610 100644\n--- a/src/sage/numerical/backends/logging_backend.py\n+++ b/src/sage/numerical/backends/logging_backend.py\n@@ -205,7 +205,7 @@ def _override_attr(attr):\n         sage: from sage.numerical.backends.logging_backend import _override_attr\n     \"\"\"\n     a = getattr(LoggingBackend, attr)\n-    if callable(a):\n+    if False and callable(a):\n         # make an unbound method\n         import types\n         _mm = types.MethodType(_make_wrapper(GenericBackend(), attr), None, LoggingBackend)\ndiff --git a/src/sage/sets/cartesian_product.py b/src/sage/sets/cartesian_product.py\nindex c84c44747b..f3354107fb 100644\n--- a/src/sage/sets/cartesian_product.py\n+++ b/src/sage/sets/cartesian_product.py\n@@ -46,7 +46,7 @@ class CartesianProduct(UniqueRepresentation, Parent):\n             and Category of Cartesian products of monoids\n             and Category of Cartesian products of finite enumerated sets\n \n-    .. automethod:: _cartesian_product_of_elements\n+    .. automethod:: CartesianProduct._cartesian_product_of_elements\n     \"\"\"\n     def __init__(self, sets, category, flatten=False):\n         r\"\"\"\ndiff --git a/src/sage/structure/element.pyx b/src/sage/structure/element.pyx\nindex f888c4f57a..989a04c8f0 100644\n--- a/src/sage/structure/element.pyx\n+++ b/src/sage/structure/element.pyx\n@@ -380,7 +380,6 @@ cdef class Element(SageObject):\n     .. automethod:: __sub__\n     .. automethod:: __neg__\n     .. automethod:: __mul__\n-    .. automethod:: Element.__div__\n     .. automethod:: __truediv__\n     .. automethod:: __floordiv__\n     .. automethod:: __mod__\ndiff --git a/src/sage_setup/docbuild/ext/multidocs.py b/src/sage_setup/docbuild/ext/multidocs.py\nindex 5dec201010..62d39461df 100644\n--- a/src/sage_setup/docbuild/ext/multidocs.py\n+++ b/src/sage_setup/docbuild/ext/multidocs.py\n@@ -236,7 +236,7 @@ def write_citations(app, citations):\n     \"\"\"\n     from sage.misc.temporary_file import atomic_write\n     outdir = citation_dir(app)\n-    with atomic_write(os.path.join(outdir, CITE_FILENAME)) as f:\n+    with atomic_write(os.path.join(outdir, CITE_FILENAME), binary=True) as f:\n         cPickle.dump(citations, f)\n     app.info(\"Saved pickle file: %s\" % CITE_FILENAME)\n```\nThe first one removes the `sagenb` pages from the reference manual. The second and third deal with `map` objects. The fifth is similar to others on this ticket. The seventh is the one I mentioned in [comment:5](#comment%3A5). The fourth (`logging_backend.py`) and sixth (`element.pyx`) are the wrong things to do, but I didn't know how to fix those problems.\n\nThe html docs don't build even with these changes:\n\n```\n[dochtml] OSError: [categorie] /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.4.beta0/src/doc/en/reference/categories/sage/categories/facade_sets.rst:4: WARNING: undefined label: facade-sets (if the link has no caption the label must precede a section header)\n```",
    "created_at": "2018-08-08T03:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397109",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:7" align="right">comment:7</div>

I can get the PDF docs to build with the following changes, at least some of which are the wrong thing to do:

```diff
diff --git a/src/doc/en/reference/notebook/index.rst b/src/doc/en/reference/notebook/index.rst
index 144b8c20e0..9196a59cdd 100644
--- a/src/doc/en/reference/notebook/index.rst
+++ b/src/doc/en/reference/notebook/index.rst
@@ -9,59 +9,4 @@ default notebook to the `Jupyter notebook
 export service.)
 
 
-Legacy Sage Notebook (sagenb)
------------------------------
-
-.. toctree::
-   :maxdepth: 2
-
-   sagenb/notebook/notebook_object
-   sagenb/notebook/config
-   sagenb/notebook/interact
-   sagenb/notebook/cell
-   sagenb/notebook/worksheet
-   sagenb/notebook/notebook
-   sagenb/notebook/js
-   sagenb/notebook/css
-   sagenb/notebook/template
-
-Other Servers
--------------
-
-.. toctree::
-   :maxdepth: 2
-
-   sagenb/notebook/challenge
-
-Miscellaneous
--------------
-
-.. toctree::
-   :maxdepth: 2
-
-   sagenb/misc/misc
-   sagenb/misc/support
-   sagenb/misc/introspect
-   sagenb/misc/sageinspect
-   sagenb/misc/sphinxify
-   sagenb/notebook/docHTMLProcessor
-
-Storage
--------
-
-.. toctree::
-   :maxdepth: 2
-
-   sagenb/storage/abstract_storage
-   sagenb/storage/filesystem_storage
-
-.. Commented out, for now.
-
-   Interfaces
-   ----------
-
-   SKIP sagenb/interfaces/worksheet_process
-   SKIP sagenb/interfaces/reference
-   SKIP sagenb/interfaces/expect
-
 .. include:: ../footer.txt
diff --git a/src/sage/geometry/polyhedron/backend_cdd.py b/src/sage/geometry/polyhedron/backend_cdd.py
index b4672e8f1b..9544cf197c 100644
--- a/src/sage/geometry/polyhedron/backend_cdd.py
+++ b/src/sage/geometry/polyhedron/backend_cdd.py
@@ -218,7 +218,7 @@ class Polyhedron_cdd(Polyhedron_base):
         cddout = cddout.splitlines()
 
         def parse_indices(count, cdd_indices, cdd_indices_to_sage_indices=None):
-            cdd_indices = map(int, cdd_indices)
+            cdd_indices = list(map(int, cdd_indices))
             if cdd_indices_to_sage_indices is None:
                 cdd_indices_to_sage_indices = {i:i-1 for i in cdd_indices}
             if count < 0:
@@ -247,7 +247,7 @@ class Polyhedron_cdd(Polyhedron_base):
             assert self.ambient_dim() == dimension - 1, "Unexpected ambient dimension"
             assert len(data) == count, "Unexpected number of lines"
             for i, line in enumerate(data):
-                coefficients = map(self.base_ring(), line)
+                coefficients = list(map(self.base_ring(), line))
                 if coefficients[0] != 0 and all([e == 0 for e in coefficients[1:]]):
                     # cddlib sometimes includes an implicit plane at infinity: 1 0 0 ... 0
                     # We do not care about this entry.
diff --git a/src/sage/geometry/polyhedron/representation.py b/src/sage/geometry/polyhedron/representation.py
index 699c56e066..e53fee0921 100644
--- a/src/sage/geometry/polyhedron/representation.py
+++ b/src/sage/geometry/polyhedron/representation.py
@@ -920,6 +920,7 @@ class Vrepresentation(PolyhedronRepresentation):
             sage: TestSuite(pV).run(skip='_test_pickling')
         """
         assert polyhedron.parent() is self._polyhedron_parent
+        data = list(data)
         if len(data) != self._vector.degree():
             raise ValueError('V-representation data requires a list of length ambient_dim')
 
diff --git a/src/sage/numerical/backends/logging_backend.py b/src/sage/numerical/backends/logging_backend.py
index b2c56e9a6c..79a7b60610 100644
--- a/src/sage/numerical/backends/logging_backend.py
+++ b/src/sage/numerical/backends/logging_backend.py
@@ -205,7 +205,7 @@ def _override_attr(attr):
         sage: from sage.numerical.backends.logging_backend import _override_attr
     """
     a = getattr(LoggingBackend, attr)
-    if callable(a):
+    if False and callable(a):
         # make an unbound method
         import types
         _mm = types.MethodType(_make_wrapper(GenericBackend(), attr), None, LoggingBackend)
diff --git a/src/sage/sets/cartesian_product.py b/src/sage/sets/cartesian_product.py
index c84c44747b..f3354107fb 100644
--- a/src/sage/sets/cartesian_product.py
+++ b/src/sage/sets/cartesian_product.py
@@ -46,7 +46,7 @@ class CartesianProduct(UniqueRepresentation, Parent):
             and Category of Cartesian products of monoids
             and Category of Cartesian products of finite enumerated sets
 
-    .. automethod:: _cartesian_product_of_elements
+    .. automethod:: CartesianProduct._cartesian_product_of_elements
     """
     def __init__(self, sets, category, flatten=False):
         r"""
diff --git a/src/sage/structure/element.pyx b/src/sage/structure/element.pyx
index f888c4f57a..989a04c8f0 100644
--- a/src/sage/structure/element.pyx
+++ b/src/sage/structure/element.pyx
@@ -380,7 +380,6 @@ cdef class Element(SageObject):
     .. automethod:: __sub__
     .. automethod:: __neg__
     .. automethod:: __mul__
-    .. automethod:: Element.__div__
     .. automethod:: __truediv__
     .. automethod:: __floordiv__
     .. automethod:: __mod__
diff --git a/src/sage_setup/docbuild/ext/multidocs.py b/src/sage_setup/docbuild/ext/multidocs.py
index 5dec201010..62d39461df 100644
--- a/src/sage_setup/docbuild/ext/multidocs.py
+++ b/src/sage_setup/docbuild/ext/multidocs.py
@@ -236,7 +236,7 @@ def write_citations(app, citations):
     """
     from sage.misc.temporary_file import atomic_write
     outdir = citation_dir(app)
-    with atomic_write(os.path.join(outdir, CITE_FILENAME)) as f:
+    with atomic_write(os.path.join(outdir, CITE_FILENAME), binary=True) as f:
         cPickle.dump(citations, f)
     app.info("Saved pickle file: %s" % CITE_FILENAME)
```
The first one removes the `sagenb` pages from the reference manual. The second and third deal with `map` objects. The fifth is similar to others on this ticket. The seventh is the one I mentioned in [comment:5](#comment%3A5). The fourth (`logging_backend.py`) and sixth (`element.pyx`) are the wrong things to do, but I didn't know how to fix those problems.

The html docs don't build even with these changes:

```
[dochtml] OSError: [categorie] /Users/palmieri/Desktop/Sage_stuff/sage_builds/PYTHON3/sage-8.4.beta0/src/doc/en/reference/categories/sage/categories/facade_sets.rst:4: WARNING: undefined label: facade-sets (if the link has no caption the label must precede a section header)
```



---

archive/issue_comments_397110.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI have split up a ticket with the changes in polyhedron/ : #26035",
    "created_at": "2018-08-09T15:12:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397110",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:8" align="right">comment:8</div>

I have split up a ticket with the changes in polyhedron/ : #26035



---

archive/issue_comments_397111.json:
```json
{
    "body": "Changed commit from **[`efc23b6`](https://github.com/sagemath/sagetrac-mirror/commit/efc23b64dc8dcd038d7fc6973a8d6a5a6d1c0faf)** to **[`40655f3`](https://github.com/sagemath/sagetrac-mirror/commit/40655f3f042587df916919f152a530796a7f38f1)**",
    "created_at": "2018-08-09T15:23:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397111",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`efc23b6`](https://github.com/sagemath/sagetrac-mirror/commit/efc23b64dc8dcd038d7fc6973a8d6a5a6d1c0faf)** to **[`40655f3`](https://github.com/sagemath/sagetrac-mirror/commit/40655f3f042587df916919f152a530796a7f38f1)**



---

archive/issue_comments_397112.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/788e460582b64d9c8835f0d1eefe30dbde6f2778\"><code>788e460</code></a></td><td><code>Merge branch 'u/chapoton/25840' in 8.4.b0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40655f3f042587df916919f152a530796a7f38f1\"><code>40655f3</code></a></td><td><code>more automethod fixes</code></td></tr></table>\n",
    "created_at": "2018-08-09T15:23:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397112",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/788e460582b64d9c8835f0d1eefe30dbde6f2778"><code>788e460</code></a></td><td><code>Merge branch 'u/chapoton/25840' in 8.4.b0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40655f3f042587df916919f152a530796a7f38f1"><code>40655f3</code></a></td><td><code>more automethod fixes</code></td></tr></table>




---

archive/issue_comments_397113.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nFor the sagenb problem, maybe we can just remove the `Miscellanous` part of the doc. but in another ticket.\n\nThe `__div__` problem is quite mysterious to me.",
    "created_at": "2018-08-09T15:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397113",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:10" align="right">comment:10</div>

For the sagenb problem, maybe we can just remove the `Miscellanous` part of the doc. but in another ticket.

The `__div__` problem is quite mysterious to me.



---

archive/issue_comments_397114.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@fchapoton](#comment%3A10):\n> For the sagenb problem, maybe we can just remove the `Miscellanous` part of the doc. but in another ticket.\n\nSounds good.\n \n> The `__div__` problem is quite mysterious to me.\n\nRight, me too.",
    "created_at": "2018-08-09T17:06:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397114",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@fchapoton](#comment%3A10):
> For the sagenb problem, maybe we can just remove the `Miscellanous` part of the doc. but in another ticket.

Sounds good.
 
> The `__div__` problem is quite mysterious to me.

Right, me too.



---

archive/issue_comments_397115.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nShould we accept this as is, perhaps without the change to `__div__` (since I don't think it helps)? It is certainly an improvement, even though it doesn't fix everything.\n\nRegarding `__div__`, could it be a Cython problem, perhaps to do with inheritance? I ran into something similar a few days ago when I was playing with the `matrix` directory and Python 3. In the file `matrix/matrix_integer_dense.pyx`, in the class `Matrix_integer_dense`, there is a method `__nonzero__`, but when you define a matrix in this class, it doesn't have this method:\n\n```\nsage: a = MatrixSpace(ZZ, 2, 3)(range(6))\nsage: type(a)\n<class 'sage.matrix.matrix_integer_dense.Matrix_integer_dense'>\nsage: a.__nonzero__()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-9-74dab0bd3f82> in <module>()\n----> 1 a.__nonzero__()\n\n    [snip]\n\nAttributeError: 'sage.matrix.matrix_integer_dense.Matrix_integer_dense' object has no attribute '__nonzero__'\n```\nIf I change the name of the method to anything else, e.g., `__nonzero2__`, then `a.__nonzero2__()` works.\n\nIn any case, the `__div__` problem may be complicated, so I would prefer to deal with it on a separate ticket.",
    "created_at": "2018-08-09T18:49:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397115",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Should we accept this as is, perhaps without the change to `__div__` (since I don't think it helps)? It is certainly an improvement, even though it doesn't fix everything.

Regarding `__div__`, could it be a Cython problem, perhaps to do with inheritance? I ran into something similar a few days ago when I was playing with the `matrix` directory and Python 3. In the file `matrix/matrix_integer_dense.pyx`, in the class `Matrix_integer_dense`, there is a method `__nonzero__`, but when you define a matrix in this class, it doesn't have this method:

```
sage: a = MatrixSpace(ZZ, 2, 3)(range(6))
sage: type(a)
<class 'sage.matrix.matrix_integer_dense.Matrix_integer_dense'>
sage: a.__nonzero__()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-9-74dab0bd3f82> in <module>()
----> 1 a.__nonzero__()

    [snip]

AttributeError: 'sage.matrix.matrix_integer_dense.Matrix_integer_dense' object has no attribute '__nonzero__'
```
If I change the name of the method to anything else, e.g., `__nonzero2__`, then `a.__nonzero2__()` works.

In any case, the `__div__` problem may be complicated, so I would prefer to deal with it on a separate ticket.



---

archive/issue_comments_397116.json:
```json
{
    "body": "Changed commit from **[`40655f3`](https://github.com/sagemath/sagetrac-mirror/commit/40655f3f042587df916919f152a530796a7f38f1)** to **[`acad1de`](https://github.com/sagemath/sagetrac-mirror/commit/acad1de09068e2b664e35f5ac1f912bda64a813a)**",
    "created_at": "2018-08-10T07:04:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397116",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`40655f3`](https://github.com/sagemath/sagetrac-mirror/commit/40655f3f042587df916919f152a530796a7f38f1)** to **[`acad1de`](https://github.com/sagemath/sagetrac-mirror/commit/acad1de09068e2b664e35f5ac1f912bda64a813a)**



---

archive/issue_comments_397117.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/acad1de09068e2b664e35f5ac1f912bda64a813a\"><code>acad1de</code></a></td><td><code>py3: fix use of automethod for pdf docbuild</code></td></tr></table>\n",
    "created_at": "2018-08-10T07:04:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397117",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/acad1de09068e2b664e35f5ac1f912bda64a813a"><code>acad1de</code></a></td><td><code>py3: fix use of automethod for pdf docbuild</code></td></tr></table>




---

archive/issue_comments_397118.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI have undone the change to `__div__` automethod. So this should be ready to go.",
    "created_at": "2018-08-10T07:05:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397118",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:14" align="right">comment:14</div>

I have undone the change to `__div__` automethod. So this should be ready to go.



---

archive/issue_events_354160.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-08-10T08:19:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354160"
}
```



---

archive/issue_events_354161.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2018-08-10T08:19:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "milestone_number": null,
    "milestone_title": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354161"
}
```



---

archive/issue_comments_397119.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2018-08-10T11:35:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397119",
    "user": "https://github.com/fchapoton"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_354162.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-10T18:10:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354162"
}
```



---

archive/issue_events_354163.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2018-08-10T18:10:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354163"
}
```



---

archive/issue_comments_397120.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nOkay, I'm happy with this. For other tickets: the `__div__` issue, plus I don't know what to do with `src/sage/numerical/backends/logging_backend.py`, mainly because I don't understand what that code is doing.",
    "created_at": "2018-08-10T18:10:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397120",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:17" align="right">comment:17</div>

Okay, I'm happy with this. For other tickets: the `__div__` issue, plus I don't know what to do with `src/sage/numerical/backends/logging_backend.py`, mainly because I don't understand what that code is doing.



---

archive/issue_comments_397121.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIsn't the problem with `__div__` simply that `__div__` does not exist on Python 3? Although that does not explain why `Element.__div__` does work.",
    "created_at": "2018-08-10T18:46:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397121",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:18" align="right">comment:18</div>

Isn't the problem with `__div__` simply that `__div__` does not exist on Python 3? Although that does not explain why `Element.__div__` does work.



---

archive/issue_comments_397122.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@jhpalmieri](#comment%3A17):\n> I don't know what to do with `src/sage/numerical/backends/logging_backend.py`\n\nI created #26043 for that.",
    "created_at": "2018-08-10T18:57:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397122",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@jhpalmieri](#comment%3A17):
> I don't know what to do with `src/sage/numerical/backends/logging_backend.py`

I created #26043 for that.



---

archive/issue_comments_397123.json:
```json
{
    "body": "Changed branch from **[u/chapoton/25840](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/25840)** to **[`acad1de`](https://github.com/sagemath/sagetrac-mirror/commit/acad1de09068e2b664e35f5ac1f912bda64a813a)**",
    "created_at": "2018-08-17T21:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25840#issuecomment-397123",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/chapoton/25840](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/25840)** to **[`acad1de`](https://github.com/sagemath/sagetrac-mirror/commit/acad1de09068e2b664e35f5ac1f912bda64a813a)**



---

archive/issue_events_354164.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-08-17T21:14:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354164"
}
```



---

archive/issue_events_354165.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8094d182b8be71c37d3197a187a5a82a4da17436",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-08-17T21:14:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25840",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25840#event-354165"
}
```
