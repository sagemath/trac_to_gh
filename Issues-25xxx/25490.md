# Issue 25490: Fix Matrix_gfpn_dense.rescale_row_c

archive/issues_025253.json:
```json
{
    "assignees": [],
    "body": "There are two problems with `Matrix_gfpn_dense.rescale_row_c`:\n1. The optional argument `start_col` is not supported - see also #25476.\n2. It is assumed that the field and the row size (which are global variables in MeatAxe) are correctly assigned to, but this assumption is easily violated:\n\n```\nsage: K.<x> = GF(25)\nsage: L.<y> = GF(81)\nsage: M = MatrixSpace(K,1,25)(sorted(list(K)))\nsage: N = MatrixSpace(L,5,5)(sorted(list(L))[:25])\nsage: M.rescale_row(0,2)\nsage: M\n[      0       2       1   x + 1   x + 3       x   x + 1   x + 2   x + 3   x + 4     2*x 2*x + 1 2*x + 2 2*x + 3 2*x + 4     3*x 3*x + 1 3*x + 2 3*x + 3 3*x + 4     4*x 4*x + 1 4*x + 2 4*x + 3 4*x + 4]\nsage: M = MatrixSpace(K,1,25)(sorted(list(K)))\nsage: M.rescale_row(0,2)\nsage: M\n[      0       2       4       1       3     2*x 2*x + 2 2*x + 4 2*x + 1 2*x + 3     4*x 4*x + 2 4*x + 4 4*x + 1 4*x + 3       x   x + 2   x + 4   x + 1   x + 3     3*x 3*x + 2 3*x + 4 3*x + 1 3*x + 3]\n```\nSo, in the first part of the example, creation of `N` makes MeatAxe believe that the current row size is 5 and the field has 81 elements, and therefore rescaling `M` is doomed.\n\nDepends on #25518\n\n**CC:**  @tscrim\n\n**Keywords:** MeatAxe rescale row, days94\n\n**Branch/Commit:** [1a97f39ec01d45fb9a59fe9512689e3e35245d52](https://github.com/sagemath/sagetrac-mirror/commit/1a97f39ec01d45fb9a59fe9512689e3e35245d52)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Simon King\n\nIssue created by migration from https://trac.sagemath.org/ticket/25490\n\n",
    "closed_at": "2018-06-30T15:21:16Z",
    "created_at": "2018-06-01T10:22:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix Matrix_gfpn_dense.rescale_row_c",
    "type": "issue",
    "updated_at": "2018-06-30T15:21:16Z",
    "url": "https://github.com/sagemath/sage/issues/25490",
    "user": "https://github.com/simon-king-jena"
}
```
There are two problems with `Matrix_gfpn_dense.rescale_row_c`:
1. The optional argument `start_col` is not supported - see also #25476.
2. It is assumed that the field and the row size (which are global variables in MeatAxe) are correctly assigned to, but this assumption is easily violated:

```
sage: K.<x> = GF(25)
sage: L.<y> = GF(81)
sage: M = MatrixSpace(K,1,25)(sorted(list(K)))
sage: N = MatrixSpace(L,5,5)(sorted(list(L))[:25])
sage: M.rescale_row(0,2)
sage: M
[      0       2       1   x + 1   x + 3       x   x + 1   x + 2   x + 3   x + 4     2*x 2*x + 1 2*x + 2 2*x + 3 2*x + 4     3*x 3*x + 1 3*x + 2 3*x + 3 3*x + 4     4*x 4*x + 1 4*x + 2 4*x + 3 4*x + 4]
sage: M = MatrixSpace(K,1,25)(sorted(list(K)))
sage: M.rescale_row(0,2)
sage: M
[      0       2       4       1       3     2*x 2*x + 2 2*x + 4 2*x + 1 2*x + 3     4*x 4*x + 2 4*x + 4 4*x + 1 4*x + 3       x   x + 2   x + 4   x + 1   x + 3     3*x 3*x + 2 3*x + 4 3*x + 1 3*x + 3]
```
So, in the first part of the example, creation of `N` makes MeatAxe believe that the current row size is 5 and the field has 81 elements, and therefore rescaling `M` is doomed.

Depends on #25518

**CC:**  @tscrim

**Keywords:** MeatAxe rescale row, days94

**Branch/Commit:** [1a97f39ec01d45fb9a59fe9512689e3e35245d52](https://github.com/sagemath/sagetrac-mirror/commit/1a97f39ec01d45fb9a59fe9512689e3e35245d52)

**Reviewer:** Travis Scrimshaw

**Author:** Simon King

Issue created by migration from https://trac.sagemath.org/ticket/25490





---

archive/issue_events_307564.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-06-01T10:22:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307564"
}
```



---

archive/issue_events_307565.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-06-01T10:22:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20optional",
    "label_color": "08517b",
    "label_name": "component: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307565"
}
```



---

archive/issue_events_307566.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-06-01T10:22:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307566"
}
```



---

archive/issue_comments_393476.json:
```json
{
    "body": "**Dependencies:** #25476",
    "created_at": "2018-06-01T10:33:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393476",
    "user": "https://github.com/simon-king-jena"
}
```

**Dependencies:** #25476



---

archive/issue_comments_393477.json:
```json
{
    "body": "<a id='comment:2'>**Comment 2:**</a>\nAs it turns out, there are several places in which I forgot to assign the field and/or row size before calling a `Ff*` function from MeatAxe. So, I am fixing these as well. Note that it is fine to call an `Ff*` function for a matrix after calling a `Mat*` function from MeatAxe, because the `Mat*` functions all assign the correct field and row size.",
    "created_at": "2018-06-01T10:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393477",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:2'>**Comment 2:**</a>
As it turns out, there are several places in which I forgot to assign the field and/or row size before calling a `Ff*` function from MeatAxe. So, I am fixing these as well. Note that it is fine to call an `Ff*` function for a matrix after calling a `Mat*` function from MeatAxe, because the `Mat*` functions all assign the correct field and row size.



---

archive/issue_comments_393478.json:
```json
{
    "body": "<a id='comment:3'>**Comment 3:**</a>\nSounds good.",
    "created_at": "2018-06-01T10:54:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393478",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:3'>**Comment 3:**</a>
Sounds good.



---

archive/issue_comments_393479.json:
```json
{
    "body": "**Branch:** [u/SimonKing/fix_matrix_gfpn_dense_rescale_row_c](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_matrix_gfpn_dense_rescale_row_c)",
    "created_at": "2018-06-01T17:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393479",
    "user": "https://github.com/simon-king-jena"
}
```

**Branch:** [u/SimonKing/fix_matrix_gfpn_dense_rescale_row_c](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_matrix_gfpn_dense_rescale_row_c)



---

archive/issue_comments_393480.json:
```json
{
    "body": "<a id='comment:5'>**Comment 5:**</a>\nI fixed a couple of places where field and row size are not assigned, and I enabled the use of the optional `start_col` argument of `add_multiple_of_row_c` and `rescale_row_c`. Tests in sage/matrix/ pass.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002\">4eae803</a></td><td><code>Making matrices use the new _echelon_in_place method.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9792b5377bd5fa19b11eb797cd0bb2fd4035dcee\">9792b53</a></td><td><code>Matrix_gfpn_dense: Fix field and row size assignments; use start_col argument</code></td></tr></table>\n",
    "created_at": "2018-06-01T17:26:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393480",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:5'>**Comment 5:**</a>
I fixed a couple of places where field and row size are not assigned, and I enabled the use of the optional `start_col` argument of `add_multiple_of_row_c` and `rescale_row_c`. Tests in sage/matrix/ pass.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4eae803913d67d3f46f58e56d3524c9b4f73b002">4eae803</a></td><td><code>Making matrices use the new _echelon_in_place method.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9792b5377bd5fa19b11eb797cd0bb2fd4035dcee">9792b53</a></td><td><code>Matrix_gfpn_dense: Fix field and row size assignments; use start_col argument</code></td></tr></table>




---

archive/issue_events_307567.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2018-06-01T17:26:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307567"
}
```



---

archive/issue_comments_393481.json:
```json
{
    "body": "**Author:** Simon King",
    "created_at": "2018-06-01T17:26:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393481",
    "user": "https://github.com/simon-king-jena"
}
```

**Author:** Simon King



---

archive/issue_comments_393482.json:
```json
{
    "body": "**Commit:** [9792b5377bd5fa19b11eb797cd0bb2fd4035dcee](https://github.com/sagemath/sagetrac-mirror/commit/9792b5377bd5fa19b11eb797cd0bb2fd4035dcee)",
    "created_at": "2018-06-01T17:26:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393482",
    "user": "https://github.com/simon-king-jena"
}
```

**Commit:** [9792b5377bd5fa19b11eb797cd0bb2fd4035dcee](https://github.com/sagemath/sagetrac-mirror/commit/9792b5377bd5fa19b11eb797cd0bb2fd4035dcee)



---

archive/issue_comments_393483.json:
```json
{
    "body": "<a id='comment:6'>**Comment 6:**</a>\nPS: I needed to import some additional stuff from SharedMeatAxe, which means that I needed to change sage/libs/meataxe.pxd as well.",
    "created_at": "2018-06-01T17:27:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393483",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:6'>**Comment 6:**</a>
PS: I needed to import some additional stuff from SharedMeatAxe, which means that I needed to change sage/libs/meataxe.pxd as well.



---

archive/issue_events_307568.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-06T12:41:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307568"
}
```



---

archive/issue_events_307569.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-06T12:41:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307569"
}
```



---

archive/issue_comments_393484.json:
```json
{
    "body": "**Changing dependencies** from \"#25476\" to \"#25518\".",
    "created_at": "2018-06-06T12:41:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393484",
    "user": "https://github.com/jdemeyer"
}
```

**Changing dependencies** from "#25476" to "#25518".



---

archive/issue_comments_393485.json:
```json
{
    "body": "**Changing branch** from \"[u/SimonKing/fix_matrix_gfpn_dense_rescale_row_c](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_matrix_gfpn_dense_rescale_row_c)\" to \"[u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c)\".",
    "created_at": "2018-06-06T13:09:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393485",
    "user": "https://github.com/jdemeyer"
}
```

**Changing branch** from "[u/SimonKing/fix_matrix_gfpn_dense_rescale_row_c](https://github.com/sagemath/sagetrac-mirror/tree/u/SimonKing/fix_matrix_gfpn_dense_rescale_row_c)" to "[u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c)".



---

archive/issue_comments_393486.json:
```json
{
    "body": "<a id='comment:9'>**Comment 9:**</a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d\">e2f0550</a></td><td><code>Specify that _echelon_in_place shall return the pivots</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79\">3c4a06d</a></td><td><code>Enable _mul_long for matrices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1eaed37b0176c911a8d1a7ce36814db13c9b4b8b\">1eaed37</a></td><td><code>More stuff in the meataxe interface, and a meataxe helper function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8a06c0f42b937e697e7585332383c69fbf7625cc\">8a06c0f</a></td><td><code>Fix docstring formatting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cef13b8f2aece9c723dfa10f221fc14ac67c22af\">cef13b8</a></td><td><code>Matrix_gfpn_dense: Fix field and row size assignments; use start_col argument</code></td></tr></table>\n",
    "created_at": "2018-06-06T13:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393486",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'>**Comment 9:**</a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2f0550696a5dbc9e0cd595d1eda7d9b9048d06d">e2f0550</a></td><td><code>Specify that _echelon_in_place shall return the pivots</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3c4a06d3080dd8528053be95b86154822d4d2b79">3c4a06d</a></td><td><code>Enable _mul_long for matrices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1eaed37b0176c911a8d1a7ce36814db13c9b4b8b">1eaed37</a></td><td><code>More stuff in the meataxe interface, and a meataxe helper function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8a06c0f42b937e697e7585332383c69fbf7625cc">8a06c0f</a></td><td><code>Fix docstring formatting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cef13b8f2aece9c723dfa10f221fc14ac67c22af">cef13b8</a></td><td><code>Matrix_gfpn_dense: Fix field and row size assignments; use start_col argument</code></td></tr></table>




---

archive/issue_events_307570.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-06T13:12:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307570"
}
```



---

archive/issue_events_307571.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-06T13:12:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307571"
}
```



---

archive/issue_comments_393487.json:
```json
{
    "body": "**Changing commit** from \"[9792b5377bd5fa19b11eb797cd0bb2fd4035dcee](https://github.com/sagemath/sagetrac-mirror/commit/9792b5377bd5fa19b11eb797cd0bb2fd4035dcee)\" to \"[cef13b8f2aece9c723dfa10f221fc14ac67c22af](https://github.com/sagemath/sagetrac-mirror/commit/cef13b8f2aece9c723dfa10f221fc14ac67c22af)\".",
    "created_at": "2018-06-06T13:12:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393487",
    "user": "https://github.com/jdemeyer"
}
```

**Changing commit** from "[9792b5377bd5fa19b11eb797cd0bb2fd4035dcee](https://github.com/sagemath/sagetrac-mirror/commit/9792b5377bd5fa19b11eb797cd0bb2fd4035dcee)" to "[cef13b8f2aece9c723dfa10f221fc14ac67c22af](https://github.com/sagemath/sagetrac-mirror/commit/cef13b8f2aece9c723dfa10f221fc14ac67c22af)".



---

archive/issue_comments_393488.json:
```json
{
    "body": "<a id='comment:10'>**Comment 10:**</a>\nReplying to [@simon-king-jena](#comment%3A6):\n> PS: I needed to import some additional stuff from SharedMeatAxe, which means that I needed to change sage/libs/meataxe.pxd as well.\n\nThis part has been moved to #25518.",
    "created_at": "2018-06-06T13:13:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393488",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:10'>**Comment 10:**</a>
Replying to [@simon-king-jena](#comment%3A6):
> PS: I needed to import some additional stuff from SharedMeatAxe, which means that I needed to change sage/libs/meataxe.pxd as well.

This part has been moved to #25518.



---

archive/issue_comments_393489.json:
```json
{
    "body": "<a id='comment:11'>**Comment 11:**</a>\nThis looks like a mistake:\n\n```diff\n@@ -1231,6 +1317,7 @@ cdef class Matrix_gfpn_dense(Matrix_dense):\n         \"\"\"\n         if self.Data == NULL:\n             raise ValueError(\"The matrix must not be empty\")\n+        FfSetField(self.Data.Field)\n         cdef Matrix_gfpn_dense left\n         FfSetField(self.Data.Field)\n         cdef FEL r\n```\n\nAlso, have you noticed a speed regression by not doing it purely in MeatAxe? In particular, I am wondering if it might be worthwhile to patch MeatAxe instead of implementing it in Sage.",
    "created_at": "2018-06-07T06:06:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393489",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'>**Comment 11:**</a>
This looks like a mistake:

```diff
@@ -1231,6 +1317,7 @@ cdef class Matrix_gfpn_dense(Matrix_dense):
         """
         if self.Data == NULL:
             raise ValueError("The matrix must not be empty")
+        FfSetField(self.Data.Field)
         cdef Matrix_gfpn_dense left
         FfSetField(self.Data.Field)
         cdef FEL r
```

Also, have you noticed a speed regression by not doing it purely in MeatAxe? In particular, I am wondering if it might be worthwhile to patch MeatAxe instead of implementing it in Sage.



---

archive/issue_events_307572.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-07T07:38:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307572"
}
```



---

archive/issue_events_307573.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2018-06-07T07:38:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307573"
}
```



---

archive/issue_comments_393490.json:
```json
{
    "body": "<a id='comment:12'>**Comment 12:**</a>\nReplying to [@tscrim](#comment%3A11):\n> This looks like a mistake\n\nYes, I guess the same patch was added on two different tickets (#25079 and #25490).",
    "created_at": "2018-06-07T07:38:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393490",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'>**Comment 12:**</a>
Replying to [@tscrim](#comment%3A11):
> This looks like a mistake

Yes, I guess the same patch was added on two different tickets (#25079 and #25490).



---

archive/issue_comments_393491.json:
```json
{
    "body": "<a id='comment:13'>**Comment 13:**</a>\nReplying to [@tscrim](#comment%3A11):\n> This looks like a mistake:\n> \n> ```diff\n> @@ -1231,6 +1317,7 @@ cdef class Matrix_gfpn_dense(Matrix_dense):\n>          \"\"\"\n>          if self.Data == NULL:\n>              raise ValueError(\"The matrix must not be empty\")\n> +        FfSetField(self.Data.Field)\n>          cdef Matrix_gfpn_dense left\n>          FfSetField(self.Data.Field)\n>          cdef FEL r\n> ```\n\nRight, setting the field twice is a mistake.\n\n> Also, have you noticed a speed regression by not doing it purely in MeatAxe? In particular, I am wondering if it might be worthwhile to patch MeatAxe instead of implementing it in Sage.\n\nPatching wouldn't be needed, as I am upstream for SharedMeatAxe. But I don't expect that it would be really worth-while in terms of speed. In the end, both approaches yield more or less the same C code.",
    "created_at": "2018-06-07T07:43:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393491",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:13'>**Comment 13:**</a>
Replying to [@tscrim](#comment%3A11):
> This looks like a mistake:
> 
> ```diff
> @@ -1231,6 +1317,7 @@ cdef class Matrix_gfpn_dense(Matrix_dense):
>          """
>          if self.Data == NULL:
>              raise ValueError("The matrix must not be empty")
> +        FfSetField(self.Data.Field)
>          cdef Matrix_gfpn_dense left
>          FfSetField(self.Data.Field)
>          cdef FEL r
> ```

Right, setting the field twice is a mistake.

> Also, have you noticed a speed regression by not doing it purely in MeatAxe? In particular, I am wondering if it might be worthwhile to patch MeatAxe instead of implementing it in Sage.

Patching wouldn't be needed, as I am upstream for SharedMeatAxe. But I don't expect that it would be really worth-while in terms of speed. In the end, both approaches yield more or less the same C code.



---

archive/issue_comments_393492.json:
```json
{
    "body": "<a id='comment:14'>**Comment 14:**</a>\nReplying to [@simon-king-jena](#comment%3A13):\n> Replying to [@tscrim](#comment%3A11):\n> > Also, have you noticed a speed regression by not doing it purely in MeatAxe? In particular, I am wondering if it might be worthwhile to patch MeatAxe instead of implementing it in Sage.\n\n> \n> Patching wouldn't be needed, as I am upstream for SharedMeatAxe. But I don't expect that it would be really worth-while in terms of speed. In the end, both approaches yield more or less the same C code.\n\nIt just seems to me everything I look into the Cython generated C code, it seems like there could be a bit of overhead (and this might be something the library might benefit from having internally). However, I am content with the current state here (modulo the double set).",
    "created_at": "2018-06-07T09:15:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393492",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'>**Comment 14:**</a>
Replying to [@simon-king-jena](#comment%3A13):
> Replying to [@tscrim](#comment%3A11):
> > Also, have you noticed a speed regression by not doing it purely in MeatAxe? In particular, I am wondering if it might be worthwhile to patch MeatAxe instead of implementing it in Sage.

> 
> Patching wouldn't be needed, as I am upstream for SharedMeatAxe. But I don't expect that it would be really worth-while in terms of speed. In the end, both approaches yield more or less the same C code.

It just seems to me everything I look into the Cython generated C code, it seems like there could be a bit of overhead (and this might be something the library might benefit from having internally). However, I am content with the current state here (modulo the double set).



---

archive/issue_comments_393493.json:
```json
{
    "body": "<a id='comment:15'>**Comment 15:**</a>\nReplying to [@tscrim](#comment%3A14):\n> It just seems to me everything I look into the Cython generated C code, it seems like there could be a bit of overhead\n\nIf you have concrete examples of this, I'm sure that Cython upstream would be interested in fixing that.",
    "created_at": "2018-06-07T09:17:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393493",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:15'>**Comment 15:**</a>
Replying to [@tscrim](#comment%3A14):
> It just seems to me everything I look into the Cython generated C code, it seems like there could be a bit of overhead

If you have concrete examples of this, I'm sure that Cython upstream would be interested in fixing that.



---

archive/issue_comments_393494.json:
```json
{
    "body": "<a id='comment:16'>**Comment 16:**</a>\nReplying to [@jdemeyer](#comment%3A15):\n> Replying to [@tscrim](#comment%3A14):\n> > It just seems to me everything I look into the Cython generated C code, it seems like there could be a bit of overhead\n\n> \n> If you have concrete examples of this, I'm sure that Cython upstream would be interested in fixing that.\n\nI am just referring to some of the unnecessary extra variables that are used or extra error checks. For instance, things like\n\n```c\n  /* \"sage/groups/perm_gps/permgroup_element.pyx\":244\n *     if isinstance(g, Permutation):\n *         return g.cycle_tuples()\n *     if isinstance(g, PermutationGroupElement):             # <<<<<<<<<<<<<<\n *         g = g.cycle_tuples()\n *     if isinstance(g, str):\n */\n  __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_g, __pyx_ptype_4sage_6groups_8perm_gps_17permgroup_element_PermutationGroupElement); \n  __pyx_t_4 = (__pyx_t_3 != 0);\n  if (__pyx_t_4) {\n```\nGranted, I suspect the compiler will optimize `__pyx_t_3` and `__pyx_t_4` away, but I still wonder if takes up a few extra CPU cycles, which multiplied by times they occur could result in faster code.",
    "created_at": "2018-06-07T09:52:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393494",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'>**Comment 16:**</a>
Replying to [@jdemeyer](#comment%3A15):
> Replying to [@tscrim](#comment%3A14):
> > It just seems to me everything I look into the Cython generated C code, it seems like there could be a bit of overhead

> 
> If you have concrete examples of this, I'm sure that Cython upstream would be interested in fixing that.

I am just referring to some of the unnecessary extra variables that are used or extra error checks. For instance, things like

```c
  /* "sage/groups/perm_gps/permgroup_element.pyx":244
 *     if isinstance(g, Permutation):
 *         return g.cycle_tuples()
 *     if isinstance(g, PermutationGroupElement):             # <<<<<<<<<<<<<<
 *         g = g.cycle_tuples()
 *     if isinstance(g, str):
 */
  __pyx_t_3 = __Pyx_TypeCheck(__pyx_v_g, __pyx_ptype_4sage_6groups_8perm_gps_17permgroup_element_PermutationGroupElement); 
  __pyx_t_4 = (__pyx_t_3 != 0);
  if (__pyx_t_4) {
```
Granted, I suspect the compiler will optimize `__pyx_t_3` and `__pyx_t_4` away, but I still wonder if takes up a few extra CPU cycles, which multiplied by times they occur could result in faster code.



---

archive/issue_comments_393495.json:
```json
{
    "body": "<a id='comment:17'>**Comment 17:**</a>\nI should make it clear I do not have any concrete example where I could write C code that would be definitely faster than Cython's version. Although I have not currently tried such a comparison.",
    "created_at": "2018-06-07T09:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393495",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'>**Comment 17:**</a>
I should make it clear I do not have any concrete example where I could write C code that would be definitely faster than Cython's version. Although I have not currently tried such a comparison.



---

archive/issue_events_307574.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-07T10:16:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "008080",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307574"
}
```



---

archive/issue_events_307575.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-07T10:16:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307575"
}
```



---

archive/issue_comments_393496.json:
```json
{
    "body": "**Changing branch** from \"[u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c)\" to \"[u/tscrim/fix_matrix_gfpn_dense_rescale_row_c-25490](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/fix_matrix_gfpn_dense_rescale_row_c-25490)\".",
    "created_at": "2018-06-07T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393496",
    "user": "https://github.com/tscrim"
}
```

**Changing branch** from "[u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c](https://github.com/sagemath/sagetrac-mirror/tree/u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c)" to "[u/tscrim/fix_matrix_gfpn_dense_rescale_row_c-25490](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/fix_matrix_gfpn_dense_rescale_row_c-25490)".



---

archive/issue_comments_393497.json:
```json
{
    "body": "**Changing commit** from \"[cef13b8f2aece9c723dfa10f221fc14ac67c22af](https://github.com/sagemath/sagetrac-mirror/commit/cef13b8f2aece9c723dfa10f221fc14ac67c22af)\" to \"[1a97f39ec01d45fb9a59fe9512689e3e35245d52](https://github.com/sagemath/sagetrac-mirror/commit/1a97f39ec01d45fb9a59fe9512689e3e35245d52)\".",
    "created_at": "2018-06-07T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393497",
    "user": "https://github.com/tscrim"
}
```

**Changing commit** from "[cef13b8f2aece9c723dfa10f221fc14ac67c22af](https://github.com/sagemath/sagetrac-mirror/commit/cef13b8f2aece9c723dfa10f221fc14ac67c22af)" to "[1a97f39ec01d45fb9a59fe9512689e3e35245d52](https://github.com/sagemath/sagetrac-mirror/commit/1a97f39ec01d45fb9a59fe9512689e3e35245d52)".



---

archive/issue_comments_393498.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2018-06-07T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393498",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_393499.json:
```json
{
    "body": "<a id='comment:18'>**Comment 18:**</a>\nFrom looking at the C code of the added here, the Cython really should not have any real overhead.\n\nI just removed the duplicate mentioned above. I suppose the proper thing is to have someone else check this rather than simply setting it to a positive review.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b59c597e1a271fecc782bce52906503263fbe9d5\">b59c597</a></td><td><code>Merge branch 'u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c' of git://trac.sagemath.org/sage into u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a97f39ec01d45fb9a59fe9512689e3e35245d52\">1a97f39</a></td><td><code>Removing duplicate FfSetField.</code></td></tr></table>\n",
    "created_at": "2018-06-07T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393499",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'>**Comment 18:**</a>
From looking at the C code of the added here, the Cython really should not have any real overhead.

I just removed the duplicate mentioned above. I suppose the proper thing is to have someone else check this rather than simply setting it to a positive review.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b59c597e1a271fecc782bce52906503263fbe9d5">b59c597</a></td><td><code>Merge branch 'u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c' of git://trac.sagemath.org/sage into u/jdemeyer/fix_matrix_gfpn_dense_rescale_row_c</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a97f39ec01d45fb9a59fe9512689e3e35245d52">1a97f39</a></td><td><code>Removing duplicate FfSetField.</code></td></tr></table>




---

archive/issue_comments_393500.json:
```json
{
    "body": "<a id='comment:19'>**Comment 19:**</a>\nReplying to [@tscrim](#comment%3A16):\n> Granted, I suspect the compiler will optimize `__pyx_t_3` and `__pyx_t_4` away\n\nI'm pretty sure that this is the case indeed. Recent compilers are very good at this.\n\nAnyway, I thought that you were referring to \"pure C\" code in Cython. When Python objects are involved, there is always some overhead because of refcounting for example.",
    "created_at": "2018-06-07T11:46:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393500",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:19'>**Comment 19:**</a>
Replying to [@tscrim](#comment%3A16):
> Granted, I suspect the compiler will optimize `__pyx_t_3` and `__pyx_t_4` away

I'm pretty sure that this is the case indeed. Recent compilers are very good at this.

Anyway, I thought that you were referring to "pure C" code in Cython. When Python objects are involved, there is always some overhead because of refcounting for example.



---

archive/issue_comments_393501.json:
```json
{
    "body": "<a id='comment:20'>**Comment 20:**</a>\nReplying to [@jdemeyer](#comment%3A19):\n> Anyway, I thought that you were referring to \"pure C\" code in Cython. When Python objects are involved, there is always some overhead because of refcounting for example.\n\nOnly in a very small part. Although it is nice to see with proper typing for everything that it basically is a straight translation to C.",
    "created_at": "2018-06-08T02:30:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393501",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:20'>**Comment 20:**</a>
Replying to [@jdemeyer](#comment%3A19):
> Anyway, I thought that you were referring to "pure C" code in Cython. When Python objects are involved, there is always some overhead because of refcounting for example.

Only in a very small part. Although it is nice to see with proper typing for everything that it basically is a straight translation to C.



---

archive/issue_comments_393502.json:
```json
{
    "body": "<a id='comment:21'>**Comment 21:**</a>\nCan someone verify my change? That is the only thing missing from a positive review here.",
    "created_at": "2018-06-29T09:49:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393502",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'>**Comment 21:**</a>
Can someone verify my change? That is the only thing missing from a positive review here.



---

archive/issue_comments_393503.json:
```json
{
    "body": "<a id='comment:22'>**Comment 22:**</a>\nReplying to [@tscrim](#comment%3A21):\n> Can someone verify my change? That is the only thing missing from a positive review here.\n\nAre you only talking about commit:1a97f39? That's of course totally fine, FfSetField was called twice where it should only be called once.\n\nSo, if that's the only issue, it is \"positive review\".",
    "created_at": "2018-06-29T12:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393503",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:22'>**Comment 22:**</a>
Replying to [@tscrim](#comment%3A21):
> Can someone verify my change? That is the only thing missing from a positive review here.

Are you only talking about commit:1a97f39? That's of course totally fine, FfSetField was called twice where it should only be called once.

So, if that's the only issue, it is "positive review".



---

archive/issue_comments_393504.json:
```json
{
    "body": "<a id='comment:23'>**Comment 23:**</a>\nYep, that was it.",
    "created_at": "2018-06-29T13:08:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393504",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'>**Comment 23:**</a>
Yep, that was it.



---

archive/issue_events_307576.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-29T13:08:09Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307576"
}
```



---

archive/issue_events_307577.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2018-06-29T13:08:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307577"
}
```



---

archive/issue_comments_393505.json:
```json
{
    "body": "**Changing keywords** from \"MeatAxe rescale row\" to \"MeatAxe rescale row, days94\".",
    "created_at": "2018-06-29T13:08:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393505",
    "user": "https://github.com/tscrim"
}
```

**Changing keywords** from "MeatAxe rescale row" to "MeatAxe rescale row, days94".



---

archive/issue_comments_393506.json:
```json
{
    "body": "**Changing branch** from \"[u/tscrim/fix_matrix_gfpn_dense_rescale_row_c-25490](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/fix_matrix_gfpn_dense_rescale_row_c-25490)\" to \"[1a97f39ec01d45fb9a59fe9512689e3e35245d52](https://github.com/sagemath/sagetrac-mirror/commit/1a97f39ec01d45fb9a59fe9512689e3e35245d52)\".",
    "created_at": "2018-06-30T15:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25490#issuecomment-393506",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tscrim/fix_matrix_gfpn_dense_rescale_row_c-25490](https://github.com/sagemath/sagetrac-mirror/tree/u/tscrim/fix_matrix_gfpn_dense_rescale_row_c-25490)" to "[1a97f39ec01d45fb9a59fe9512689e3e35245d52](https://github.com/sagemath/sagetrac-mirror/commit/1a97f39ec01d45fb9a59fe9512689e3e35245d52)".



---

archive/issue_events_307578.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-06-30T15:21:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307578"
}
```



---

archive/issue_events_307579.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "4cb96e31debc84c7efebff5c35d6c2ac3a1b0c52",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-06-30T15:21:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25490",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25490#event-307579"
}
```
