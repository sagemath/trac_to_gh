# Issue 25371: py3: towards docbuild, more details

archive/issues_025134.json:
```json
{
    "body": "\n\nCC:  @tscrim @jm58660\n\nReviewer: Jeroen Demeyer\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nBranch: a9abcc892862794aaf7bd7268aafec729053e08f\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25371\n\n",
    "closed_at": "2018-05-18T17:49:49Z",
    "created_at": "2018-05-16T09:25:48Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "py3: towards docbuild, more details",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25371",
    "user": "https://github.com/fchapoton"
}
```


CC:  @tscrim @jm58660

Reviewer: Jeroen Demeyer

Author: Frédéric Chapoton

Branch: a9abcc892862794aaf7bd7268aafec729053e08f

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25371





---

archive/issue_comments_484673.json:
```json
{
    "body": "Changing commit from \"\" to \"6685b1737d91b1810e5f8e5e0189cf5575c96781\"",
    "created_at": "2018-05-16T09:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484673",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "" to "6685b1737d91b1810e5f8e5e0189cf5575c96781"



---

archive/issue_comments_484674.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2018-05-16T09:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484674",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_484675.json:
```json
{
    "body": "Changing branch from \"\" to \"u/chapoton/25371\"",
    "created_at": "2018-05-16T09:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484675",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "" to "u/chapoton/25371"



---

archive/issue_comments_484676.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-16T09:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484676",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_484677.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-05-16T15:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484677",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_484678.json:
```json
{
    "body": "<a id='comment:2'></a>What's wrong with\n\n```\nP = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])\n```",
    "created_at": "2018-05-16T15:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484678",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:2'></a>What's wrong with

```
P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])
```



---

archive/issue_comments_484679.json:
```json
{
    "body": "<a id='comment:3'></a>\n```\n[dochtml] [plotting ] During handling of the above exception, another exception occurred:\n[dochtml] [plotting ] Traceback (most recent call last):\n[dochtml] [plotting ] File \"/home/chapoton/sage3/local/lib/python3.6/site-packages/matplotlib/sphinxext/plot_directive.py\", line 525, in run_code\n[dochtml] [plotting ] six.exec_(code, ns)\n[dochtml] [plotting ] File \"<string>\", line 1, in <module>\n[dochtml] [plotting ] File \"sage/symbolic/expression.pyx\", line 5721, in sage.symbolic.expression.Expression.__index__ (build/cythonized/sage/symbolic/expression.cpp:35714)\n[dochtml] [plotting ] File \"sage/symbolic/expression.pyx\", line 1073, in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9100)\n[dochtml] [plotting ] TypeError: unable to convert 20*pi + 1 to an integer\n```",
    "created_at": "2018-05-16T15:50:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484679",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>
```
[dochtml] [plotting ] During handling of the above exception, another exception occurred:
[dochtml] [plotting ] Traceback (most recent call last):
[dochtml] [plotting ] File "/home/chapoton/sage3/local/lib/python3.6/site-packages/matplotlib/sphinxext/plot_directive.py", line 525, in run_code
[dochtml] [plotting ] six.exec_(code, ns)
[dochtml] [plotting ] File "<string>", line 1, in <module>
[dochtml] [plotting ] File "sage/symbolic/expression.pyx", line 5721, in sage.symbolic.expression.Expression.__index__ (build/cythonized/sage/symbolic/expression.cpp:35714)
[dochtml] [plotting ] File "sage/symbolic/expression.pyx", line 1073, in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9100)
[dochtml] [plotting ] TypeError: unable to convert 20*pi + 1 to an integer
```



---

archive/issue_comments_484680.json:
```json
{
    "body": "<a id='comment:4'></a>Well, that's a genuine problem. Why shouldn't we no longer be allowed to use symbolic expressions in plots?",
    "created_at": "2018-05-17T10:12:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484680",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:4'></a>Well, that's a genuine problem. Why shouldn't we no longer be allowed to use symbolic expressions in plots?



---

archive/issue_comments_484681.json:
```json
{
    "body": "Changing branch from \"u/chapoton/25371\" to \"u/jdemeyer/25371\"",
    "created_at": "2018-05-17T10:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484681",
    "user": "https://github.com/jdemeyer"
}
```

Changing branch from "u/chapoton/25371" to "u/jdemeyer/25371"



---

archive/issue_comments_484682.json:
```json
{
    "body": "Changing commit from \"6685b1737d91b1810e5f8e5e0189cf5575c96781\" to \"a9abcc892862794aaf7bd7268aafec729053e08f\"",
    "created_at": "2018-05-17T10:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484682",
    "user": "https://github.com/jdemeyer"
}
```

Changing commit from "6685b1737d91b1810e5f8e5e0189cf5575c96781" to "a9abcc892862794aaf7bd7268aafec729053e08f"



---

archive/issue_comments_484683.json:
```json
{
    "body": "<a id='comment:6'></a>I reverted that because it tries to fix the doctest instead of the bug.\n\nThe other change gets positive review.\n\n---\nNew commits:",
    "created_at": "2018-05-17T10:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484683",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:6'></a>I reverted that because it tries to fix the doctest instead of the bug.

The other change gets positive review.

---
New commits:



---

archive/issue_comments_484684.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2018-05-17T10:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484684",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_comments_484685.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Jeroen Demeyer\"",
    "created_at": "2018-05-17T10:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484685",
    "user": "https://github.com/jdemeyer"
}
```

Changing reviewer from "" to "Jeroen Demeyer"



---

archive/issue_events_063629.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:49:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25371#event-63629"
}
```



---

archive/issue_comments_484686.json:
```json
{
    "body": "Changing branch from \"u/jdemeyer/25371\" to \"a9abcc892862794aaf7bd7268aafec729053e08f\"",
    "created_at": "2018-05-18T17:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484686",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jdemeyer/25371" to "a9abcc892862794aaf7bd7268aafec729053e08f"



---

archive/issue_comments_484687.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484687",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_484688.json:
```json
{
    "body": "<a id='comment:8'></a>Jeroen, see your own comment here: #24758#comment:2",
    "created_at": "2018-05-18T18:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484688",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>Jeroen, see your own comment here: #24758#comment:2



---

archive/issue_comments_484689.json:
```json
{
    "body": "Changing commit from \"a9abcc892862794aaf7bd7268aafec729053e08f\" to \"\"",
    "created_at": "2018-05-18T18:50:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484689",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "a9abcc892862794aaf7bd7268aafec729053e08f" to ""



---

archive/issue_comments_484690.json:
```json
{
    "body": "<a id='comment:9'></a>And the range behaviour itself is not working with python3. I do not think we should change that.\n\n```\nsage: list(range(20*pi+3))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9051)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.pyobject (build/cythonized/sage/symbolic/expression.cpp:6090)()\n\nTypeError: self must be a numeric expression\n\nDuring handling of the above exception, another exception occurred:\n\nTypeError                                 Traceback (most recent call last)\n<ipython-input-1-3c6188e69b81> in <module>()\n----> 1 list(range(Integer(20)*pi+Integer(3)))\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__index__ (build/cythonized/sage/symbolic/expression.cpp:35714)()\n\n/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9100)()\n\nTypeError: unable to convert 20*pi + 3 to an integer\n```",
    "created_at": "2018-05-28T06:58:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484690",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>And the range behaviour itself is not working with python3. I do not think we should change that.

```
sage: list(range(20*pi+3))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9051)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.pyobject (build/cythonized/sage/symbolic/expression.cpp:6090)()

TypeError: self must be a numeric expression

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-1-3c6188e69b81> in <module>()
----> 1 list(range(Integer(20)*pi+Integer(3)))

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__index__ (build/cythonized/sage/symbolic/expression.cpp:35714)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9100)()

TypeError: unable to convert 20*pi + 3 to an integer
```



---

archive/issue_comments_484691.json:
```json
{
    "body": "<a id='comment:10'></a>Jeroen, would you accept this change that you refused here (in another ticket):\n\n```patch\n-        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])\n+        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(floor(20*pi)+1)])\n```\nIt seems to me that there is no issue in sage, only the fact that python3 is more strict on what it accepts inside range.",
    "created_at": "2018-06-13T16:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484691",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>Jeroen, would you accept this change that you refused here (in another ticket):

```patch
-        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])
+        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(floor(20*pi)+1)])
```
It seems to me that there is no issue in sage, only the fact that python3 is more strict on what it accepts inside range.



---

archive/issue_comments_484692.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 chapoton]:\n> Jeroen, would you accept this change that you refused here (in another ticket):\n> \n> ```\n> #!patch\n> -        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])\n> +        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(floor(20*pi)+1)])\n> ```\n\n\nThat's not precisely the change that I rejected. You changed `20*pi` by `63` originally in multiple places.\n\nAnyway, let me figure out exactly what `range()` accepts on Python 2 and Python 3 and then I'll comment back.",
    "created_at": "2018-06-14T05:43:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484692",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:11'></a>Replying to [comment:10 chapoton]:
> Jeroen, would you accept this change that you refused here (in another ticket):
> 
> ```
> #!patch
> -        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])
> +        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(floor(20*pi)+1)])
> ```


That's not precisely the change that I rejected. You changed `20*pi` by `63` originally in multiple places.

Anyway, let me figure out exactly what `range()` accepts on Python 2 and Python 3 and then I'll comment back.



---

archive/issue_comments_484693.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 chapoton]:\n> It seems to me that there is no issue in sage, only the fact that python3 is more strict on what it accepts inside range.\n\n\nI agree. Python 2 essentially replaces `range(foo)` by `range(int(foo))`. Python 3 requires an integer as argument to `range()`.",
    "created_at": "2018-06-14T08:38:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484693",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:12'></a>Replying to [comment:10 chapoton]:
> It seems to me that there is no issue in sage, only the fact that python3 is more strict on what it accepts inside range.


I agree. Python 2 essentially replaces `range(foo)` by `range(int(foo))`. Python 3 requires an integer as argument to `range()`.



---

archive/issue_comments_484694.json:
```json
{
    "body": "<a id='comment:13'></a>Ok. I have made the ticket in #25578",
    "created_at": "2018-06-14T13:37:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25371",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25371#issuecomment-484694",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>Ok. I have made the ticket in #25578
