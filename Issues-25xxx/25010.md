# Issue 25010: Wrong results for principal_directions in ParametrizedSurface3d

archive/issues_024773.json:
```json
{
    "body": "The function principal_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.\nThe following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):\n\n```\nvar('u,v',domain='real')\nV=vector([u*cos(u+v),u*sin(u+v),u+v])\nS=ParametrizedSurface3D(V,(u,v))\ndN=S.shape_operator()\nU=[(i,j[0]) for i,j,k in S.principal_directions()]# A list with eigenvalues and eigenvectors.\n\n#Check if they are eigenvalues for the left action\n[(dN*j-i*j).simplify_full() for i,j in U]\n\n```\n\nOutput:\n\n\n\n```\n[((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),\n (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]\nFalse\n```\n\n```\n#Check if they are eigenvalues for the left action\n[(j*dN-i*j).simplify_full() for i,j in U]\n```\nOutput:\n\n```\n[(0, 0), (0, 0)]\nTrue\n```\n\nCC:  @egourgoulhon @jvkersch @tscrim\n\nKeywords: differential geometry, principal directions\n\nBranch/Commit: 856a12046efc3031a9b5d6653faf5f1ae684be03\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Enrique Artal\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25010\n\n",
    "closed_at": "2018-05-18T17:03:57Z",
    "created_at": "2018-03-19T08:10:02Z",
    "labels": [
        "component: geometry",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Wrong results for principal_directions in ParametrizedSurface3d",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25010",
    "user": "https://github.com/enriqueartal"
}
```
The function principal_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.
The following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):

```
var('u,v',domain='real')
V=vector([u*cos(u+v),u*sin(u+v),u+v])
S=ParametrizedSurface3D(V,(u,v))
dN=S.shape_operator()
U=[(i,j[0]) for i,j,k in S.principal_directions()]# A list with eigenvalues and eigenvectors.

#Check if they are eigenvalues for the left action
[(dN*j-i*j).simplify_full() for i,j in U]

```

Output:



```
[((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),
 (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]
False
```

```
#Check if they are eigenvalues for the left action
[(j*dN-i*j).simplify_full() for i,j in U]
```
Output:

```
[(0, 0), (0, 0)]
True
```

CC:  @egourgoulhon @jvkersch @tscrim

Keywords: differential geometry, principal directions

Branch/Commit: 856a12046efc3031a9b5d6653faf5f1ae684be03

Reviewer: Eric Gourgoulhon

Author: Enrique Artal

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25010





---

archive/issue_comments_370261.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2018-04-09T16:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370261",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_370262.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-09T16:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370262",
    "user": "https://github.com/enriqueartal"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_370263.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,5 +1,7 @@\n The function principa\u00f1_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.\n The following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):\n+\n+```\n var('u,v',domain='real')\n V=vector([u*cos(u+v),u*sin(u+v),u+v])\n S=ParametrizedSurface3D(V,(u,v))\n@@ -9,17 +11,28 @@\n #Check if they are eigenvalues for the left action\n [(dN*j-i*j).simplify_full() for i,j in U]\n \n+```\n+\n Output:\n+\n+\n+\n+```\n [((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),\n  (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]\n+False\n+```\n \n-False\n-\n+```\n #Check if they are eigenvalues for the left action\n [(j*dN-i*j).simplify_full() for i,j in U]\n+```\n Output:\n+\n+```\n [(0, 0), (0, 0)]\n True\n+```\n \n Comment: 1\n \n```\n",
    "created_at": "2018-04-09T16:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370263",
    "user": "https://github.com/enriqueartal"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,5 +1,7 @@
 The function principa√±_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.
 The following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):
+
+```
 var('u,v',domain='real')
 V=vector([u*cos(u+v),u*sin(u+v),u+v])
 S=ParametrizedSurface3D(V,(u,v))
@@ -9,17 +11,28 @@
 #Check if they are eigenvalues for the left action
 [(dN*j-i*j).simplify_full() for i,j in U]
 
+```
+
 Output:
+
+
+
+```
 [((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),
  (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]
+False
+```
 
-False
-
+```
 #Check if they are eigenvalues for the left action
 [(j*dN-i*j).simplify_full() for i,j in U]
+```
 Output:
+
+```
 [(0, 0), (0, 0)]
 True
+```
 
 Comment: 1
 
```




---

archive/issue_comments_370264.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,38 @@\n+The function principal_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.\n+The following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):\n \n+```\n+var('u,v',domain='real')\n+V=vector([u*cos(u+v),u*sin(u+v),u+v])\n+S=ParametrizedSurface3D(V,(u,v))\n+dN=S.shape_operator()\n+U=[(i,j[0]) for i,j,k in S.principal_directions()]# A list with eigenvalues and eigenvectors.\n+\n+#Check if they are eigenvalues for the left action\n+[(dN*j-i*j).simplify_full() for i,j in U]\n+\n+```\n+\n+Output:\n+\n+\n+\n+```\n+[((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),\n+ (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]\n+False\n+```\n+\n+```\n+#Check if they are eigenvalues for the left action\n+[(j*dN-i*j).simplify_full() for i,j in U]\n+```\n+Output:\n+\n+```\n+[(0, 0), (0, 0)]\n+True\n+```\n \n Comment: 1\n \n```\n",
    "created_at": "2018-04-09T16:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370264",
    "user": "https://github.com/enriqueartal"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,38 @@
+The function principal_directions in ParametrizedSurface3d may produce wrong results when the first fundamental form of the surface is not diagonal, or, more generally when its matrix does not commute with the matrix of the second fundamental form. I think it comes from the fact that the shape operator is constructed to act on the left on vectors but its eigenspaces are computed as if it was acting on the right on vectors.
+The following code shows the problem (it is a helicoid with a parametrization such that the first fundamental form is not diagonal):
 
+```
+var('u,v',domain='real')
+V=vector([u*cos(u+v),u*sin(u+v),u+v])
+S=ParametrizedSurface3D(V,(u,v))
+dN=S.shape_operator()
+U=[(i,j[0]) for i,j,k in S.principal_directions()]# A list with eigenvalues and eigenvectors.
+
+#Check if they are eigenvalues for the left action
+[(dN*j-i*j).simplify_full() for i,j in U]
+
+```
+
+Output:
+
+
+
+```
+[((2*u^2 - (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2)),
+ (-(2*u^2 + (2*u^2 + 1)*sqrt(u^2 + 1) + 1)/(u^4 + u^2), (2*u^2 + 1)/(u^2 + 1)^(3/2))]
+False
+```
+
+```
+#Check if they are eigenvalues for the left action
+[(j*dN-i*j).simplify_full() for i,j in U]
+```
+Output:
+
+```
+[(0, 0), (0, 0)]
+True
+```
 
 Comment: 1
 
```




---

archive/issue_comments_370265.json:
```json
{
    "body": "<a id='comment:4'></a>The solution is simply to replace `eigenvectors_left` by `eigenvectors_right` in the method `principal_directions`. \n\nIt is solved now.",
    "created_at": "2018-04-09T16:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370265",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:4'></a>The solution is simply to replace `eigenvectors_left` by `eigenvectors_right` in the method `principal_directions`. 

It is solved now.



---

archive/issue_comments_370266.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-04-18T18:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370266",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_370267.json:
```json
{
    "body": "<a id='comment:6'></a>You need to add a doctest to check that it does fix something.",
    "created_at": "2018-04-18T18:25:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370267",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>You need to add a doctest to check that it does fix something.



---

archive/issue_comments_370268.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-04-19T11:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_370269.json:
```json
{
    "body": "<a id='comment:8'></a>Doctest added.",
    "created_at": "2018-04-19T11:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370269",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:8'></a>Doctest added.



---

archive/issue_comments_370270.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-04-19T11:36:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370270",
    "user": "https://github.com/enriqueartal"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_370271.json:
```json
{
    "body": "<a id='comment:9'></a>LGTM. Thanks for the fix!",
    "created_at": "2018-04-25T14:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370271",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'></a>LGTM. Thanks for the fix!



---

archive/issue_comments_370272.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-25T14:55:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370272",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_062732.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2018-05-17T11:49:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25010#event-62732"
}
```



---

archive/issue_events_062733.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:03:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25010#event-62733"
}
```



---

archive/issue_comments_370273.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25010",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25010#issuecomment-370273",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
