# Issue 25866: Tensor series expansion

archive/issues_025629.json:
```json
{
    "body": "This ticket modifies the method `_simplify` of chart functions on manifolds to permit series expansion of tensor field, scalar field or connection.\n\nMost of the usual operations are already supported (except Lie derivative).\n\nBecause the expansion is performed at the lowest level, it provides a major improvement in performances for computing general perturbations (compared with simply expanding after the computation).\n\nA notebook example can be found [here](http://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Worksheets/series/First-order%20example.ipynb).\n\n\nThis is part of the \u200b[SageManifolds project](http://sagemanifolds.obspm.fr/); see the metaticket #18528 for an overview. \n\n**CC:**  @egourgoulhon\n\n**Keywords:** manifold, expansion, series, tensor\n\n**Branch/Commit:** [beaa20e9f75805a8a9a4476195b8aeaee34876aa](https://github.com/sagemath/sagetrac-mirror/commit/beaa20e9f75805a8a9a4476195b8aeaee34876aa)\n\n**Reviewer:** Eric Gourgoulhon, Travis Scrimshaw\n\n**Author:** Florentin Jaffredo\n\nIssue created by migration from https://trac.sagemath.org/ticket/25866\n\n",
    "closed_at": "2019-03-25T19:43:59Z",
    "created_at": "2018-07-17T09:09:48Z",
    "labels": [
        "component: geometry",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Tensor series expansion",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25866",
    "user": "https://github.com/FlorentinJ"
}
```
This ticket modifies the method `_simplify` of chart functions on manifolds to permit series expansion of tensor field, scalar field or connection.

Most of the usual operations are already supported (except Lie derivative).

Because the expansion is performed at the lowest level, it provides a major improvement in performances for computing general perturbations (compared with simply expanding after the computation).

A notebook example can be found [here](http://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Worksheets/series/First-order%20example.ipynb).


This is part of the â€‹[SageManifolds project](http://sagemanifolds.obspm.fr/); see the metaticket #18528 for an overview. 

**CC:**  @egourgoulhon

**Keywords:** manifold, expansion, series, tensor

**Branch/Commit:** [beaa20e9f75805a8a9a4476195b8aeaee34876aa](https://github.com/sagemath/sagetrac-mirror/commit/beaa20e9f75805a8a9a4476195b8aeaee34876aa)

**Reviewer:** Eric Gourgoulhon, Travis Scrimshaw

**Author:** Florentin Jaffredo

Issue created by migration from https://trac.sagemath.org/ticket/25866





---

archive/issue_comments_474112.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-08-06T09:46:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474112",
    "user": "https://github.com/FlorentinJ"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_474113.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-09-10T10:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474113",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_474114.json:
```json
{
    "body": "<a id='comment:2'></a>\nThank you very much for having added this new functionality!\nThe code looks basically good to me. There are some issues with the user interface and documentation though:\n- Method `ChartFunction.__init__()`: the new arguments `symbol` and `order` must added in the `INPUT` section of the documentation of `ChartFunction`; besides the name `symbol` is not explicit enough; it should be replaced by something like `expansion_symbol`\n- Method `TensorField.set_calc_order()`: no explicit call to that method appears in its doctests!\n- Method `TensorFieldParal.series()`: it would help the reader if you add the raw output of this method in the doctests, i.e. add\n\n```\n sage: g.series(e, 3)\n[(Field of symmetric bilinear forms on the 4-dimensional Lorentzian manifold M,\n  0),\n (Field of symmetric bilinear forms on the 4-dimensional Lorentzian manifold M,\n  1),\n (Field of symmetric bilinear forms on the 4-dimensional Lorentzian manifold M,\n  2)]\n```\n  before displaying the individual elements of the returned list\n- In the doctests of the same method and as well as in `truncate()` and `set_calc_order()`, note that you \n  can use \n\n```\nsage: g.set(g+e*h1+e**2*h2)\n```\n  as a shortcut for\n\n```\nsage: g.set_comp()[:] = (g+e*h1+e**2*h2)[:]\n```\n- Method `PseudoRiemannianMetric.inverse()`: the name `symbol` for the argument that triggers the expansion is not explicit enough: it should be changed to something like `expand_with_respect_to`. \n- Method `ScalarField.set_calc_order()`: the docstring (probably cut-and-pasted from the tensor field one) must be adapted to the scalar field case; in particular *components* has no meaning in the current context; besides *Tell the ...* does not look like a proper phrase for a reference manual...",
    "created_at": "2018-09-10T10:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474114",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:2'></a>
Thank you very much for having added this new functionality!
The code looks basically good to me. There are some issues with the user interface and documentation though:
- Method `ChartFunction.__init__()`: the new arguments `symbol` and `order` must added in the `INPUT` section of the documentation of `ChartFunction`; besides the name `symbol` is not explicit enough; it should be replaced by something like `expansion_symbol`
- Method `TensorField.set_calc_order()`: no explicit call to that method appears in its doctests!
- Method `TensorFieldParal.series()`: it would help the reader if you add the raw output of this method in the doctests, i.e. add

```
 sage: g.series(e, 3)
[(Field of symmetric bilinear forms on the 4-dimensional Lorentzian manifold M,
  0),
 (Field of symmetric bilinear forms on the 4-dimensional Lorentzian manifold M,
  1),
 (Field of symmetric bilinear forms on the 4-dimensional Lorentzian manifold M,
  2)]
```
  before displaying the individual elements of the returned list
- In the doctests of the same method and as well as in `truncate()` and `set_calc_order()`, note that you 
  can use 

```
sage: g.set(g+e*h1+e**2*h2)
```
  as a shortcut for

```
sage: g.set_comp()[:] = (g+e*h1+e**2*h2)[:]
```
- Method `PseudoRiemannianMetric.inverse()`: the name `symbol` for the argument that triggers the expansion is not explicit enough: it should be changed to something like `expand_with_respect_to`. 
- Method `ScalarField.set_calc_order()`: the docstring (probably cut-and-pasted from the tensor field one) must be adapted to the scalar field case; in particular *components* has no meaning in the current context; besides *Tell the ...* does not look like a proper phrase for a reference manual...



---

archive/issue_comments_474115.json:
```json
{
    "body": "**Reviewer:** Eric Gourgoulhon",
    "created_at": "2018-09-10T10:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474115",
    "user": "https://github.com/egourgoulhon"
}
```

**Reviewer:** Eric Gourgoulhon



---

archive/issue_comments_474116.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b20a0417f7be804493fcb245d892de8c2fb51fdb\">b20a041</a></td><td><code>Merge branch 'public/manifolds/series' of git://trac.sagemath.org/sage into public/manifolds/series</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/154314adada09e3a38a38a73476d7101e8653cc7\">154314a</a></td><td><code>Addressing Eric's comments.</code></td></tr></table>\n",
    "created_at": "2018-10-08T00:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474116",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b20a0417f7be804493fcb245d892de8c2fb51fdb">b20a041</a></td><td><code>Merge branch 'public/manifolds/series' of git://trac.sagemath.org/sage into public/manifolds/series</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/154314adada09e3a38a38a73476d7101e8653cc7">154314a</a></td><td><code>Addressing Eric's comments.</code></td></tr></table>




---

archive/issue_comments_474117.json:
```json
{
    "body": "**Changing commit** from \"[eea81a546948575d7b46870a6bb33780049fce59](https://github.com/sagemath/sagetrac-mirror/commit/eea81a546948575d7b46870a6bb33780049fce59)\" to \"[154314adada09e3a38a38a73476d7101e8653cc7](https://github.com/sagemath/sagetrac-mirror/commit/154314adada09e3a38a38a73476d7101e8653cc7)\".",
    "created_at": "2018-10-08T00:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474117",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[eea81a546948575d7b46870a6bb33780049fce59](https://github.com/sagemath/sagetrac-mirror/commit/eea81a546948575d7b46870a6bb33780049fce59)" to "[154314adada09e3a38a38a73476d7101e8653cc7](https://github.com/sagemath/sagetrac-mirror/commit/154314adada09e3a38a38a73476d7101e8653cc7)".



---

archive/issue_comments_474118.json:
```json
{
    "body": "<a id='comment:5'></a>\nThis should take care of [comment:2](#comment%3A2) Eric. However, the doctest for `set_calc_order` in `tensorfield.py` and `tensorfield_paral.py` are the same. Florentin, Eric, could one of you get a modified doctest that calls that method specifically?",
    "created_at": "2018-10-08T00:19:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474118",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:5'></a>
This should take care of [comment:2](#comment%3A2) Eric. However, the doctest for `set_calc_order` in `tensorfield.py` and `tensorfield_paral.py` are the same. Florentin, Eric, could one of you get a modified doctest that calls that method specifically?



---

archive/issue_comments_474119.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab5d29211bde9658ab9bd17d5e3d2c5803d8a897\">ab5d292</a></td><td><code>Merge branch 'public/manifolds/series' of git://trac.sagemath.org/sage into series_expansion</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86\">865c548</a></td><td><code>Correct some doctests in series expansions of tensor fields</code></td></tr></table>\n",
    "created_at": "2018-10-25T09:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab5d29211bde9658ab9bd17d5e3d2c5803d8a897">ab5d292</a></td><td><code>Merge branch 'public/manifolds/series' of git://trac.sagemath.org/sage into series_expansion</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86">865c548</a></td><td><code>Correct some doctests in series expansions of tensor fields</code></td></tr></table>




---

archive/issue_comments_474120.json:
```json
{
    "body": "**Changing commit** from \"[154314adada09e3a38a38a73476d7101e8653cc7](https://github.com/sagemath/sagetrac-mirror/commit/154314adada09e3a38a38a73476d7101e8653cc7)\" to \"[865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86](https://github.com/sagemath/sagetrac-mirror/commit/865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86)\".",
    "created_at": "2018-10-25T09:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[154314adada09e3a38a38a73476d7101e8653cc7](https://github.com/sagemath/sagetrac-mirror/commit/154314adada09e3a38a38a73476d7101e8653cc7)" to "[865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86](https://github.com/sagemath/sagetrac-mirror/commit/865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86)".



---

archive/issue_comments_474121.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [tscrim](#comment%3A5):\n> This should take care of [comment:2](#comment%3A2) Eric. However, the doctest for `set_calc_order` in `tensorfield.py` and `tensorfield_paral.py` are the same. Florentin, Eric, could one of you get a modified doctest that calls that method specifically?\n\n\nThanks for your changes and apologies for the delay in replying. The above commit fixes some doctests and provides a specific doctest for `set_calc_order` in `tensorfield.py`. There are still some documentation issues, that I shall address in a next commit...",
    "created_at": "2018-10-25T09:41:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474121",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>
Replying to [tscrim](#comment%3A5):
> This should take care of [comment:2](#comment%3A2) Eric. However, the doctest for `set_calc_order` in `tensorfield.py` and `tensorfield_paral.py` are the same. Florentin, Eric, could one of you get a modified doctest that calls that method specifically?


Thanks for your changes and apologies for the delay in replying. The above commit fixes some doctests and provides a specific doctest for `set_calc_order` in `tensorfield.py`. There are still some documentation issues, that I shall address in a next commit...



---

archive/issue_comments_474122.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75bc8cb90d7029e80ac21addb1a80489428087ec\">75bc8cb</a></td><td><code>Improvements in the documentation of series expansions of tensor fields</code></td></tr></table>\n",
    "created_at": "2018-10-25T21:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474122",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75bc8cb90d7029e80ac21addb1a80489428087ec">75bc8cb</a></td><td><code>Improvements in the documentation of series expansions of tensor fields</code></td></tr></table>




---

archive/issue_comments_474123.json:
```json
{
    "body": "**Changing commit** from \"[865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86](https://github.com/sagemath/sagetrac-mirror/commit/865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86)\" to \"[75bc8cb90d7029e80ac21addb1a80489428087ec](https://github.com/sagemath/sagetrac-mirror/commit/75bc8cb90d7029e80ac21addb1a80489428087ec)\".",
    "created_at": "2018-10-25T21:25:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474123",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86](https://github.com/sagemath/sagetrac-mirror/commit/865c5481e0f1ede6aa3ffa85395f56c1ca2b4a86)" to "[75bc8cb90d7029e80ac21addb1a80489428087ec](https://github.com/sagemath/sagetrac-mirror/commit/75bc8cb90d7029e80ac21addb1a80489428087ec)".



---

archive/issue_comments_474124.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [egourgoulhon](#comment%3A7):\n>There are still some documentation issues, that I shall address in a next commit...\n\nDone in the above commit. \n\nA question remains: the argument `order` of the various methods `set_calc_order`, as well as the attribute `_order`, is the order of the big O. As a result, to get an expansion to first order with respect to the parameter `epsilon`, we have to do `g.set_calc_order(epsilon, 2)`. This seems very counter-intuitive and error-prone to me: I would have expected `g.set_calc_order(epsilon, 1)` instead. I understand that the current setting follows the convention of the method `series` of symbolic expressions, while I would prefer that it follows the convention of `taylor`:\n\n```\nsage: exp(x).series(x, 2)\n1 + 1*x + Order(x^2)\nsage: exp(x).taylor(x, 0, 1)\nx + 1\n```\n(Btw, the above looks like a kind of inconsistency in Sage)\n\nWhat do you think?",
    "created_at": "2018-10-25T21:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474124",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:9'></a>
Replying to [egourgoulhon](#comment%3A7):
>There are still some documentation issues, that I shall address in a next commit...

Done in the above commit. 

A question remains: the argument `order` of the various methods `set_calc_order`, as well as the attribute `_order`, is the order of the big O. As a result, to get an expansion to first order with respect to the parameter `epsilon`, we have to do `g.set_calc_order(epsilon, 2)`. This seems very counter-intuitive and error-prone to me: I would have expected `g.set_calc_order(epsilon, 1)` instead. I understand that the current setting follows the convention of the method `series` of symbolic expressions, while I would prefer that it follows the convention of `taylor`:

```
sage: exp(x).series(x, 2)
1 + 1*x + Order(x^2)
sage: exp(x).taylor(x, 0, 1)
x + 1
```
(Btw, the above looks like a kind of inconsistency in Sage)

What do you think?



---

archive/issue_comments_474125.json:
```json
{
    "body": "**Changing status** from needs_work to needs_info.",
    "created_at": "2018-10-25T21:44:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474125",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing status** from needs_work to needs_info.



---

archive/issue_comments_474126.json:
```json
{
    "body": "<a id='comment:11'></a>\nI think Sage is not inconsistent as the input to `taylor` is `degree`, not `order`. However, I do agree that there is some ambiguity on which order it is referring too (i.e., first order approximation vs big O order). You could make the case either way. I don't have an opinion either way, but I think both ways are likely to lead to errors. It may be better to call it `set_calc_degree` to sidestep this issue. Although if you prefer to keep degree, I think either way is fine as long as it is documented with perhaps a `.. WARNING::` block or two.",
    "created_at": "2018-10-26T04:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474126",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
I think Sage is not inconsistent as the input to `taylor` is `degree`, not `order`. However, I do agree that there is some ambiguity on which order it is referring too (i.e., first order approximation vs big O order). You could make the case either way. I don't have an opinion either way, but I think both ways are likely to lead to errors. It may be better to call it `set_calc_degree` to sidestep this issue. Although if you prefer to keep degree, I think either way is fine as long as it is documented with perhaps a `.. WARNING::` block or two.



---

archive/issue_comments_474127.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [tscrim](#comment%3A11):\n> I think Sage is not inconsistent as the input to `taylor` is `degree`, not `order`. However, I do agree that there is some ambiguity on which order it is referring too (i.e., first order approximation vs big O order). You could make the case either way. I don't have an opinion either way, but I think both ways are likely to lead to errors. \n\n\nWell, at least in physics, I would say that the *order* of an expansion always stands for the degree of the polynomial that approximates the function, not for the degree of the big O. I am pretty sure that this is what the user has in mind when asking for a *n*-th order computation. Since in the currrent context the big O is not even displayed in the result, I would really favor this interpretation of `order`. \n\n> It may be better to call it `set_calc_degree` to sidestep this issue. Although if you prefer to keep degree, I think either way is fine as long as it is documented with perhaps a `.. WARNING::` block or two.\n\n\nIn the current context, *calculation degree* sounds awkward to me, contrary to *calculation order*. Speaking about `set_calc_order`, are we sure that this is a good name in the first place? This method is indeed the user interface to indicate that one wants to perform an approximate calculation. Would `set_series_expansion` or `use_series_expansion` or something else be a better name?",
    "created_at": "2018-10-26T14:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474127",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:12'></a>
Replying to [tscrim](#comment%3A11):
> I think Sage is not inconsistent as the input to `taylor` is `degree`, not `order`. However, I do agree that there is some ambiguity on which order it is referring too (i.e., first order approximation vs big O order). You could make the case either way. I don't have an opinion either way, but I think both ways are likely to lead to errors. 


Well, at least in physics, I would say that the *order* of an expansion always stands for the degree of the polynomial that approximates the function, not for the degree of the big O. I am pretty sure that this is what the user has in mind when asking for a *n*-th order computation. Since in the currrent context the big O is not even displayed in the result, I would really favor this interpretation of `order`. 

> It may be better to call it `set_calc_degree` to sidestep this issue. Although if you prefer to keep degree, I think either way is fine as long as it is documented with perhaps a `.. WARNING::` block or two.


In the current context, *calculation degree* sounds awkward to me, contrary to *calculation order*. Speaking about `set_calc_order`, are we sure that this is a good name in the first place? This method is indeed the user interface to indicate that one wants to perform an approximate calculation. Would `set_series_expansion` or `use_series_expansion` or something else be a better name?



---

archive/issue_comments_474128.json:
```json
{
    "body": "<a id='comment:13'></a>\nI don't really are which one we take, but if we use `order`, it just has to be well documented IMO. I am not sure about `series_expansion` as that doesn't feel like the correct thing; it is something I would never guess. I think `set_calc_order` is probably the best we can do; so just documenting what we mean should be enough.",
    "created_at": "2018-10-26T17:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474128",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>
I don't really are which one we take, but if we use `order`, it just has to be well documented IMO. I am not sure about `series_expansion` as that doesn't feel like the correct thing; it is something I would never guess. I think `set_calc_order` is probably the best we can do; so just documenting what we mean should be enough.



---

archive/issue_comments_474129.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/131ee7d7f8ae2797a3d6e09c8d04c1f6bc0fc62b\">131ee7d</a></td><td><code>Merge branch 'public/manifolds/series' of git://trac.sagemath.org/sage into Sage 8.7.beta7.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10356cf2d91040ad1a147c33e724a10ec1961d13\">10356cf</a></td><td><code>Set order to be the degree of the approximating polynomial in tensor series expansions; improve documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d\">b810011</a></td><td><code>Rename method series() to series_expansion() in tensor fields and make it return a list of tensor fields</code></td></tr></table>\n",
    "created_at": "2019-03-12T15:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/131ee7d7f8ae2797a3d6e09c8d04c1f6bc0fc62b">131ee7d</a></td><td><code>Merge branch 'public/manifolds/series' of git://trac.sagemath.org/sage into Sage 8.7.beta7.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10356cf2d91040ad1a147c33e724a10ec1961d13">10356cf</a></td><td><code>Set order to be the degree of the approximating polynomial in tensor series expansions; improve documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d">b810011</a></td><td><code>Rename method series() to series_expansion() in tensor fields and make it return a list of tensor fields</code></td></tr></table>




---

archive/issue_comments_474130.json:
```json
{
    "body": "**Changing commit** from \"[75bc8cb90d7029e80ac21addb1a80489428087ec](https://github.com/sagemath/sagetrac-mirror/commit/75bc8cb90d7029e80ac21addb1a80489428087ec)\" to \"[b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d](https://github.com/sagemath/sagetrac-mirror/commit/b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d)\".",
    "created_at": "2019-03-12T15:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[75bc8cb90d7029e80ac21addb1a80489428087ec](https://github.com/sagemath/sagetrac-mirror/commit/75bc8cb90d7029e80ac21addb1a80489428087ec)" to "[b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d](https://github.com/sagemath/sagetrac-mirror/commit/b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d)".



---

archive/issue_comments_474131.json:
```json
{
    "body": "<a id='comment:15'></a>\nSorry for the long delay in coming back to this!\nIn the above commits, I have \n\n- set `order` to be the degree of the polynomial in front of the big O, adding some warnings about this (cf. the discussion in [comment:12](#comment%3A12) and [comment:13](#comment%3A13))\n- simplified the output of the method `TensorFieldParal.series()` (there was not need to return a list of pairs with the second element of each pair being merely the index in the list)\n- add the arguments `expansion_symbol` and `order` to the method `Chart.function()` for consistency with  the constructor of a chart function\n- improved the documentation, in particular regarding the meaning of `order`\n\nBesides I've run some benchmarks to check that the new functionalities added by this ticket, which are essentially implemented in `ChartFunction._simplify()`, do not degrade significantly the tensor calculus performance when no series expansion is required.",
    "created_at": "2019-03-12T15:50:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474131",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:15'></a>
Sorry for the long delay in coming back to this!
In the above commits, I have 

- set `order` to be the degree of the polynomial in front of the big O, adding some warnings about this (cf. the discussion in [comment:12](#comment%3A12) and [comment:13](#comment%3A13))
- simplified the output of the method `TensorFieldParal.series()` (there was not need to return a list of pairs with the second element of each pair being merely the index in the list)
- add the arguments `expansion_symbol` and `order` to the method `Chart.function()` for consistency with  the constructor of a chart function
- improved the documentation, in particular regarding the meaning of `order`

Besides I've run some benchmarks to check that the new functionalities added by this ticket, which are essentially implemented in `ChartFunction._simplify()`, do not degrade significantly the tensor calculus performance when no series expansion is required.



---

archive/issue_comments_474132.json:
```json
{
    "body": "**Changing status** from needs_info to needs_review.",
    "created_at": "2019-03-12T15:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474132",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing status** from needs_info to needs_review.



---

archive/issue_events_073859.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2019-03-12T15:56:29Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25866#event-73859"
}
```



---

archive/issue_comments_474133.json:
```json
{
    "body": "<a id='comment:18'></a>\nI just have some nitpicks that once changed, you can set a positive review on my behalf.\n\nI think this will look at little better in the compiled doc:\n\n```diff\n-`f_0`, `f_1`, ..., `f_n`\n+`f_0, f_1, \\ldots, f_n`\n```\nand similarly for the `T`'s. (Although I am not sure I have actually ever checked this...)\n\nIn all of the `.. MATH::` (that are followed by a `where`), you should add a comma to the end of the formulas for grammatical correctness.\n\nI always think of big `O` with the `O` appearing as a math symbol, so I would say it should be formatted as <code>big \\`O\\`</code> in the doc.",
    "created_at": "2019-03-19T23:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474133",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>
I just have some nitpicks that once changed, you can set a positive review on my behalf.

I think this will look at little better in the compiled doc:

```diff
-`f_0`, `f_1`, ..., `f_n`
+`f_0, f_1, \ldots, f_n`
```
and similarly for the `T`'s. (Although I am not sure I have actually ever checked this...)

In all of the `.. MATH::` (that are followed by a `where`), you should add a comma to the end of the formulas for grammatical correctness.

I always think of big `O` with the `O` appearing as a math symbol, so I would say it should be formatted as <code>big \`O\`</code> in the doc.



---

archive/issue_comments_474134.json:
```json
{
    "body": "**Changing reviewer** from \"Eric Gourgoulhon\" to \"Eric Gourgoulhon, Travis Scrimshaw\".",
    "created_at": "2019-03-19T23:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474134",
    "user": "https://github.com/tscrim"
}
```

**Changing reviewer** from "Eric Gourgoulhon" to "Eric Gourgoulhon, Travis Scrimshaw".



---

archive/issue_comments_474135.json:
```json
{
    "body": "<a id='comment:20'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87a256bb56c8e09b6b09550ea2fe1c194b00aa5b\">87a256b</a></td><td><code>Improve documentation in series expansion of tensor fields</code></td></tr></table>\n",
    "created_at": "2019-03-20T12:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474135",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87a256bb56c8e09b6b09550ea2fe1c194b00aa5b">87a256b</a></td><td><code>Improve documentation in series expansion of tensor fields</code></td></tr></table>




---

archive/issue_comments_474136.json:
```json
{
    "body": "**Changing commit** from \"[b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d](https://github.com/sagemath/sagetrac-mirror/commit/b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d)\" to \"[87a256bb56c8e09b6b09550ea2fe1c194b00aa5b](https://github.com/sagemath/sagetrac-mirror/commit/87a256bb56c8e09b6b09550ea2fe1c194b00aa5b)\".",
    "created_at": "2019-03-20T12:25:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474136",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d](https://github.com/sagemath/sagetrac-mirror/commit/b8100119f3b9a5f7f7f8b8da6e24e201a7c9241d)" to "[87a256bb56c8e09b6b09550ea2fe1c194b00aa5b](https://github.com/sagemath/sagetrac-mirror/commit/87a256bb56c8e09b6b09550ea2fe1c194b00aa5b)".



---

archive/issue_comments_474137.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-03-20T14:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474137",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_474138.json:
```json
{
    "body": "<a id='comment:21'></a>\nThanks. LGTM.",
    "created_at": "2019-03-20T14:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474138",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>
Thanks. LGTM.



---

archive/issue_comments_474139.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [tscrim](#comment%3A21):\nThanks for [comment:18](#comment%3A18) and the review!",
    "created_at": "2019-03-20T14:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474139",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:22'></a>
Replying to [tscrim](#comment%3A21):
Thanks for [comment:18](#comment%3A18) and the review!



---

archive/issue_comments_474140.json:
```json
{
    "body": "<a id='comment:23'></a>\nWith the python3 version of Sage 8.7.rc0, building the documentation via\n\n```\n./sage -docbuild reference/manifolds html\n```\ngenerates the following warnings:\n\n```\n[manifolds] <unknown>:2105: DeprecationWarning: invalid escape sequence \\e\n[manifolds] <unknown>:2243: DeprecationWarning: invalid escape sequence \\e\n```\n(there was no such warning with the python2 version).\n\nI suspect the issue could be triggered by the `\\epsilon`'s introduced in the documentation. The documentation output looks fine though... Moreover the error message is not very explicit...",
    "created_at": "2019-03-20T15:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474140",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:23'></a>
With the python3 version of Sage 8.7.rc0, building the documentation via

```
./sage -docbuild reference/manifolds html
```
generates the following warnings:

```
[manifolds] <unknown>:2105: DeprecationWarning: invalid escape sequence \e
[manifolds] <unknown>:2243: DeprecationWarning: invalid escape sequence \e
```
(there was no such warning with the python2 version).

I suspect the issue could be triggered by the `\epsilon`'s introduced in the documentation. The documentation output looks fine though... Moreover the error message is not very explicit...



---

archive/issue_comments_474141.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2019-03-20T15:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474141",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_474142.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [egourgoulhon](#comment%3A23):\n> \n> I suspect the issue could be triggered by the `\\epsilon`'s introduced in the documentation. The documentation output looks fine though... Moreover the error message is not very explicit...\n\n\nThe offending file is `src/sage/manifolds/differentiable/tensorfield_paral.py` and the numbers 2105 and 2243 in the error message correspond to the ending lines of the docstring of the methods `series_expansion` and `set_calc_order` respectively.\nI looked through the file and did not find any obvious error... Again the html output is fine (all math formulas involving `\\epsilon` are correctly rendered).",
    "created_at": "2019-03-20T16:59:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474142",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:24'></a>
Replying to [egourgoulhon](#comment%3A23):
> 
> I suspect the issue could be triggered by the `\epsilon`'s introduced in the documentation. The documentation output looks fine though... Moreover the error message is not very explicit...


The offending file is `src/sage/manifolds/differentiable/tensorfield_paral.py` and the numbers 2105 and 2243 in the error message correspond to the ending lines of the docstring of the methods `series_expansion` and `set_calc_order` respectively.
I looked through the file and did not find any obvious error... Again the html output is fine (all math formulas involving `\epsilon` are correctly rendered).



---

archive/issue_comments_474143.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/beaa20e9f75805a8a9a4476195b8aeaee34876aa\">beaa20e</a></td><td><code>Correct docstrings opening in methods series_expansion and set_calc_order of tensorfield_paral.py</code></td></tr></table>\n",
    "created_at": "2019-03-20T17:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474143",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/beaa20e9f75805a8a9a4476195b8aeaee34876aa">beaa20e</a></td><td><code>Correct docstrings opening in methods series_expansion and set_calc_order of tensorfield_paral.py</code></td></tr></table>




---

archive/issue_comments_474144.json:
```json
{
    "body": "**Changing commit** from \"[87a256bb56c8e09b6b09550ea2fe1c194b00aa5b](https://github.com/sagemath/sagetrac-mirror/commit/87a256bb56c8e09b6b09550ea2fe1c194b00aa5b)\" to \"[beaa20e9f75805a8a9a4476195b8aeaee34876aa](https://github.com/sagemath/sagetrac-mirror/commit/beaa20e9f75805a8a9a4476195b8aeaee34876aa)\".",
    "created_at": "2019-03-20T17:46:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[87a256bb56c8e09b6b09550ea2fe1c194b00aa5b](https://github.com/sagemath/sagetrac-mirror/commit/87a256bb56c8e09b6b09550ea2fe1c194b00aa5b)" to "[beaa20e9f75805a8a9a4476195b8aeaee34876aa](https://github.com/sagemath/sagetrac-mirror/commit/beaa20e9f75805a8a9a4476195b8aeaee34876aa)".



---

archive/issue_comments_474145.json:
```json
{
    "body": "<a id='comment:26'></a>\nOK, I found the reason: the docstrings of the two involved methods were starting with `\"\"\"` instead of `r\"\"\"`.",
    "created_at": "2019-03-20T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474145",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:26'></a>
OK, I found the reason: the docstrings of the two involved methods were starting with `"""` instead of `r"""`.



---

archive/issue_comments_474146.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2019-03-20T17:48:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474146",
    "user": "https://github.com/egourgoulhon"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_474147.json:
```json
{
    "body": "<a id='comment:27'></a>\nPython3 is very strict about escape sequences, either it is one (which gives a rendering error in Python2) or it raises an error (whereas Python2 silently ignores it).",
    "created_at": "2019-03-20T22:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474147",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>
Python3 is very strict about escape sequences, either it is one (which gives a rendering error in Python2) or it raises an error (whereas Python2 silently ignores it).



---

archive/issue_comments_474148.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2019-03-20T22:18:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474148",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_073860.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "milestone": "sage-8.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25866#event-73860"
}
```



---

archive/issue_events_073861.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-03-25T10:56:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25866#event-73861"
}
```



---

archive/issue_comments_474149.json:
```json
{
    "body": "<a id='comment:28'></a>\nTicket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474149",
    "user": "https://github.com/embray"
}
```

<a id='comment:28'></a>
Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_events_073862.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-03-25T19:43:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25866#event-73862"
}
```



---

archive/issue_comments_474150.json:
```json
{
    "body": "**Changing branch** from \"[public/manifolds/series](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/series)\" to \"[beaa20e9f75805a8a9a4476195b8aeaee34876aa](https://github.com/sagemath/sagetrac-mirror/commit/beaa20e9f75805a8a9a4476195b8aeaee34876aa)\".",
    "created_at": "2019-03-25T19:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25866",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25866#issuecomment-474150",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/manifolds/series](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/series)" to "[beaa20e9f75805a8a9a4476195b8aeaee34876aa](https://github.com/sagemath/sagetrac-mirror/commit/beaa20e9f75805a8a9a4476195b8aeaee34876aa)".
