# Issue 25435: Global function fields: orders and ideals

archive/issues_025198.json:
```json
{
    "body": "This is part of the meta-ticket #22982. \n\nThe goal of the present ticket is to add code for computing finite and infinite maximal orders and ideals thereof. \n\nThe central engine for computing maximal orders is the Leonard-Pellikaan-Singh-Swanson algorithm implemented in Singular. Most algorithms for computing with ideals are from Cohen's book  A Course in Computational Algebraic Number Theory.\n\nBranch/Commit: 48100b41622d43e75c263cf62b32be9b335d88f6\n\nReviewer: Travis Scrimshaw\n\nAuthor: Kwankyu Lee\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25435\n\n",
    "closed_at": "2018-09-29T11:59:41Z",
    "created_at": "2018-05-24T01:14:38Z",
    "labels": [
        "component: algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.4",
    "title": "Global function fields: orders and ideals",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25435",
    "user": "https://github.com/kwankyu"
}
```
This is part of the meta-ticket #22982. 

The goal of the present ticket is to add code for computing finite and infinite maximal orders and ideals thereof. 

The central engine for computing maximal orders is the Leonard-Pellikaan-Singh-Swanson algorithm implemented in Singular. Most algorithms for computing with ideals are from Cohen's book  A Course in Computational Algebraic Number Theory.

Branch/Commit: 48100b41622d43e75c263cf62b32be9b335d88f6

Reviewer: Travis Scrimshaw

Author: Kwankyu Lee

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25435





---

archive/issue_comments_377705.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-24T01:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377706.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-25T01:46:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377707.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-26T02:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377708.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-05-26T02:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377708",
    "user": "https://github.com/kwankyu"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_377709.json:
```json
{
    "body": "<a id='comment:6'></a>There are some doctest failures according to the patchbot. Some of them come the file name change, which technically you should deprecate the old file name (see #19879 for an example how to do this) if you think people could be importing directly from the file.",
    "created_at": "2018-05-26T09:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377709",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:6'></a>There are some doctest failures according to the patchbot. Some of them come the file name change, which technically you should deprecate the old file name (see #19879 for an example how to do this) if you think people could be importing directly from the file.



---

archive/issue_comments_377710.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-27T09:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377711.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:6 tscrim]:\n> There are some doctest failures according to the patchbot. Some of them come the file name change, which technically you should deprecate the old file name (see #19879 for an example how to do this) if you think people could be importing directly from the file.\n\n\nI regard it as an internal change. So there is no need to deprecate.",
    "created_at": "2018-05-27T09:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377711",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:8'></a>Replying to [comment:6 tscrim]:
> There are some doctest failures according to the patchbot. Some of them come the file name change, which technically you should deprecate the old file name (see #19879 for an example how to do this) if you think people could be importing directly from the file.


I regard it as an internal change. So there is no need to deprecate.



---

archive/issue_comments_377712.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-05-29T07:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377712",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_377713.json:
```json
{
    "body": "<a id='comment:9'></a>The startup modules plugin complains that\n\n```\nNew:\n    _md5\n    _sha\n    _sha256\n    _sha512\n    sage.rings.function_field.element\n    sage.rings.function_field.ideal\n    sage.rings.function_field.order\nRemoved:\n    _hashlib\n    _ssl\n    sage.rings.function_field.function_field_element\n    ssl\n```\n\nI don't really understand what is happening and how to deal with it. I suspect that this is somehow related with `__hash__` method in the ideal or order modules...\n\nTravis, would you give me some tips?",
    "created_at": "2018-05-29T07:57:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377713",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:9'></a>The startup modules plugin complains that

```
New:
    _md5
    _sha
    _sha256
    _sha512
    sage.rings.function_field.element
    sage.rings.function_field.ideal
    sage.rings.function_field.order
Removed:
    _hashlib
    _ssl
    sage.rings.function_field.function_field_element
    ssl
```

I don't really understand what is happening and how to deal with it. I suspect that this is somehow related with `__hash__` method in the ideal or order modules...

Travis, would you give me some tips?



---

archive/issue_comments_377714.json:
```json
{
    "body": "<a id='comment:10'></a>So the last three extra imports are from this change to `function_field.py`:\n\n```diff\n+from .order import (\n+    FunctionFieldOrder_basis,\n+    FunctionFieldOrderInfinite_basis,\n+    FunctionFieldMaximalOrder_rational,\n+    FunctionFieldMaximalOrder_global,\n+    FunctionFieldMaximalOrderInfinite_rational,\n+    FunctionFieldMaximalOrderInfinite_global)\n```\nHowever, you seem to basically be doing these imports locally anyways. I would run `pyflakes` on the file to see what is being duplicated in terms of imports, and you should decide if they need to be at the module level.\n\nI probably wouldn't worry about the others as they seem to be unrelated.",
    "created_at": "2018-05-29T08:33:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377714",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>So the last three extra imports are from this change to `function_field.py`:

```diff
+from .order import (
+    FunctionFieldOrder_basis,
+    FunctionFieldOrderInfinite_basis,
+    FunctionFieldMaximalOrder_rational,
+    FunctionFieldMaximalOrder_global,
+    FunctionFieldMaximalOrderInfinite_rational,
+    FunctionFieldMaximalOrderInfinite_global)
```
However, you seem to basically be doing these imports locally anyways. I would run `pyflakes` on the file to see what is being duplicated in terms of imports, and you should decide if they need to be at the module level.

I probably wouldn't worry about the others as they seem to be unrelated.



---

archive/issue_comments_377715.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-29T11:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377715",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377716.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 tscrim]:\n> So the last three extra imports are from this change to `function_field.py`:\n> \n> ```diff\n> +from .order import (\n> +    FunctionFieldOrder_basis,\n> +    FunctionFieldOrderInfinite_basis,\n> +    FunctionFieldMaximalOrder_rational,\n> +    FunctionFieldMaximalOrder_global,\n> +    FunctionFieldMaximalOrderInfinite_rational,\n> +    FunctionFieldMaximalOrderInfinite_global)\n> ```\n> However, you seem to basically be doing these imports locally anyways. I would run `pyflakes` on the file to see what is being duplicated in terms of imports, and you should decide if they need to be at the module level.\n> \n> I probably wouldn't worry about the others as they seem to be unrelated.\n\n\nOk. Let's see what would happen with new commits, though still I don't understand where \n\n```\n   _md5\n    _sha\n    _sha256\n    _sha512\n```\ncome from...",
    "created_at": "2018-05-29T11:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377716",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:12'></a>Replying to [comment:10 tscrim]:
> So the last three extra imports are from this change to `function_field.py`:
> 
> ```diff
> +from .order import (
> +    FunctionFieldOrder_basis,
> +    FunctionFieldOrderInfinite_basis,
> +    FunctionFieldMaximalOrder_rational,
> +    FunctionFieldMaximalOrder_global,
> +    FunctionFieldMaximalOrderInfinite_rational,
> +    FunctionFieldMaximalOrderInfinite_global)
> ```
> However, you seem to basically be doing these imports locally anyways. I would run `pyflakes` on the file to see what is being duplicated in terms of imports, and you should decide if they need to be at the module level.
> 
> I probably wouldn't worry about the others as they seem to be unrelated.


Ok. Let's see what would happen with new commits, though still I don't understand where 

```
   _md5
    _sha
    _sha256
    _sha512
```
come from...



---

archive/issue_comments_377717.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 klee]:\n> Ok. Let's see what would happen with new commits, though still I don't understand where \n> \n> ```\n>    _md5\n>     _sha\n>     _sha256\n>     _sha512\n> ```\n> come from...\n\n\nI don't know either. I suspect it is an artifact or bug in the plugin.",
    "created_at": "2018-05-30T06:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377717",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Replying to [comment:12 klee]:
> Ok. Let's see what would happen with new commits, though still I don't understand where 
> 
> ```
>    _md5
>     _sha
>     _sha256
>     _sha512
> ```
> come from...


I don't know either. I suspect it is an artifact or bug in the plugin.



---

archive/issue_comments_377718.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-31T09:24:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377719.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-06-01T00:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377719",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_377720.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-05T08:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377721.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n This is part of the meta-ticket #22982. \n \n-The goal of the present ticket is to add code for computing finite and infinite maximal orders and ideals thereof. The central engine for computing maximal orders is the Leonard-Pellikaan-Singh-Swanson algorithm implemented in Singular. Most algorithms for computing with ideals are from Cohen's book  A Course in Computational Algebraic Number Theory.\n+The goal of the present ticket is to add code for computing finite and infinite maximal orders and ideals thereof. \n+\n+The central engine for computing maximal orders is the Leonard-Pellikaan-Singh-Swanson algorithm implemented in Singular. Most algorithms for computing with ideals are from Cohen's book  A Course in Computational Algebraic Number Theory.\n \n Author: Kwankyu Lee\n \n```\n",
    "created_at": "2018-06-05T08:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377721",
    "user": "https://github.com/kwankyu"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,8 @@
 This is part of the meta-ticket #22982. 
 
-The goal of the present ticket is to add code for computing finite and infinite maximal orders and ideals thereof. The central engine for computing maximal orders is the Leonard-Pellikaan-Singh-Swanson algorithm implemented in Singular. Most algorithms for computing with ideals are from Cohen's book  A Course in Computational Algebraic Number Theory.
+The goal of the present ticket is to add code for computing finite and infinite maximal orders and ideals thereof. 
+
+The central engine for computing maximal orders is the Leonard-Pellikaan-Singh-Swanson algorithm implemented in Singular. Most algorithms for computing with ideals are from Cohen's book  A Course in Computational Algebraic Number Theory.
 
 Author: Kwankyu Lee
 
```




---

archive/issue_comments_377722.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-07-11T08:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377722",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_377723.json:
```json
{
    "body": "<a id='comment:18'></a>Why do you copy Singular's library code here?\nThe latter is available in SAGE_LOCAL/share/singular/LIB/\n\nE.g. `normal.lib` with normalP is there.",
    "created_at": "2018-07-11T08:32:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377723",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>Why do you copy Singular's library code here?
The latter is available in SAGE_LOCAL/share/singular/LIB/

E.g. `normal.lib` with normalP is there.



---

archive/issue_comments_377724.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 dimpase]:\n> Why do you copy Singular's library code here?\n> The latter is available in SAGE_LOCAL/share/singular/LIB/\n> \n> E.g. `normal.lib` with normalP is there.\n\n\nThe code of this patch was written more than two years ago.  It might be the case that the normal.lib was then an experimental package. But I don't remember well.\n\nAnother reason that may still be relevant now is that the normalP in the singular library does more computations than necessary for my case. For example, it also computes delta invariants of the given ideal. So I decided to make a stripped-down light version of normalP just for the code in this ticket.",
    "created_at": "2018-07-11T12:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377724",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:19'></a>Replying to [comment:18 dimpase]:
> Why do you copy Singular's library code here?
> The latter is available in SAGE_LOCAL/share/singular/LIB/
> 
> E.g. `normal.lib` with normalP is there.


The code of this patch was written more than two years ago.  It might be the case that the normal.lib was then an experimental package. But I don't remember well.

Another reason that may still be relevant now is that the normalP in the singular library does more computations than necessary for my case. For example, it also computes delta invariants of the given ideal. So I decided to make a stripped-down light version of normalP just for the code in this ticket.



---

archive/issue_comments_377725.json:
```json
{
    "body": "Changing status from needs_info to needs_work.",
    "created_at": "2018-07-11T13:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377725",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_info to needs_work.



---

archive/issue_comments_377726.json:
```json
{
    "body": "<a id='comment:20'></a>If it's a different version than the one in Singular, this should be made clear in the file header. The functions and .lib files also should be named differently, to prevent name clashes with the ones from the Singular lib.",
    "created_at": "2018-07-11T13:31:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377726",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>If it's a different version than the one in Singular, this should be made clear in the file header. The functions and .lib files also should be named differently, to prevent name clashes with the ones from the Singular lib.



---

archive/issue_comments_377727.json:
```json
{
    "body": "<a id='comment:21'></a>Anyway, unless Singular's own version is significantly slower, you should rather use it.",
    "created_at": "2018-07-11T13:33:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377727",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>Anyway, unless Singular's own version is significantly slower, you should rather use it.



---

archive/issue_comments_377728.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:21 dimpase]:\n> Anyway, unless Singular's own version is significantly slower, you should rather use it. \n\n\nI am trying this approach. During computation, the Singular's version spits out many comments, each line starting with `//`, causing doctest failures. Do you know how to deal with this? \n\n```\nFailed example:\n    O = F.maximal_order()\nExpected nothing\nGot:\n    <BLANKLINE>\n    // ** WARNING: result is correct if ideal is prime (not checked) **\n    // disable option \"isPrim\" to decompose ideal into prime components\n    <BLANKLINE>\n    <BLANKLINE>\n    // 'normalP' computed a list, say nor, of two lists:\n    // To see the result, type\n         nor;\n    <BLANKLINE>\n    // * nor[1] is a list of 1 ideal(s), where each ideal nor[1][i] consists\n    // of elements g1..gk of the basering R such that gj/gk generate the integral\n    // closure of R/P_i (where P_i is a min. associated prime of the input ideal)\n    // as R-module in the quotient field of R/P_i;\n    <BLANKLINE>\n    // * nor[2] shows the delta-invariant of each component and of the input ideal\n    // (-1 means infinite, and 0 that R/P_i is normal).\n```",
    "created_at": "2018-07-14T03:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377728",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:22'></a>Replying to [comment:21 dimpase]:
> Anyway, unless Singular's own version is significantly slower, you should rather use it. 


I am trying this approach. During computation, the Singular's version spits out many comments, each line starting with `//`, causing doctest failures. Do you know how to deal with this? 

```
Failed example:
    O = F.maximal_order()
Expected nothing
Got:
    <BLANKLINE>
    // ** WARNING: result is correct if ideal is prime (not checked) **
    // disable option "isPrim" to decompose ideal into prime components
    <BLANKLINE>
    <BLANKLINE>
    // 'normalP' computed a list, say nor, of two lists:
    // To see the result, type
         nor;
    <BLANKLINE>
    // * nor[1] is a list of 1 ideal(s), where each ideal nor[1][i] consists
    // of elements g1..gk of the basering R such that gj/gk generate the integral
    // closure of R/P_i (where P_i is a min. associated prime of the input ideal)
    // as R-module in the quotient field of R/P_i;
    <BLANKLINE>
    // * nor[2] shows the delta-invariant of each component and of the input ideal
    // (-1 means infinite, and 0 that R/P_i is normal).
```



---

archive/issue_comments_377729.json:
```json
{
    "body": "<a id='comment:23'></a>A small timing for you. \n\nWith my version:\n\n```\nsage:  K.<x> = FunctionField(GF(2));\nsage: R.<t> = PolynomialRing(K);\nsage: F.<y> = K.extension(t^4 + x^12*t^2 + x^18*t + x^21 + x^18)\nsage: time F.maximal_order()\nCPU times: user 178 ms, sys: 27.3 ms, total: 205 ms\nWall time: 201 ms\n```\n\nWith Singular's version:\n\n```\nsage:  K.<x> = FunctionField(GF(2));\nsage: R.<t> = PolynomialRing(K);\nsage: F.<y> = K.extension(t^4 + x^12*t^2 + x^18*t + x^21 + x^18)\nsage: time F.maximal_order()\n//...\n...\n//...\nCPU times: user 222 ms, sys: 31.3 ms, total: 254 ms\nWall time: 249 ms\n```",
    "created_at": "2018-07-14T03:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377729",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:23'></a>A small timing for you. 

With my version:

```
sage:  K.<x> = FunctionField(GF(2));
sage: R.<t> = PolynomialRing(K);
sage: F.<y> = K.extension(t^4 + x^12*t^2 + x^18*t + x^21 + x^18)
sage: time F.maximal_order()
CPU times: user 178 ms, sys: 27.3 ms, total: 205 ms
Wall time: 201 ms
```

With Singular's version:

```
sage:  K.<x> = FunctionField(GF(2));
sage: R.<t> = PolynomialRing(K);
sage: F.<y> = K.extension(t^4 + x^12*t^2 + x^18*t + x^21 + x^18)
sage: time F.maximal_order()
//...
...
//...
CPU times: user 222 ms, sys: 31.3 ms, total: 254 ms
Wall time: 249 ms
```



---

archive/issue_comments_377730.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-20T10:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377730",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377731.json:
```json
{
    "body": "<a id='comment:25'></a>As using  Singular's version has some technical problems noted above, I switched to the alternative path to renaming the procedure in core.lib",
    "created_at": "2018-07-20T10:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377731",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:25'></a>As using  Singular's version has some technical problems noted above, I switched to the alternative path to renaming the procedure in core.lib



---

archive/issue_comments_377732.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-21T05:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377732",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_063838.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2018-08-06T06:07:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25435#event-63838"
}
```



---

archive/issue_comments_377733.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-04T09:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377733",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_377734.json:
```json
{
    "body": "<a id='comment:29'></a>I force-pushed two commits. The first commit contains all changes, and the second commit contains only filename changes.\n\nHopefully, a reviewer could see the changes against the devel branch more easily from the first commit.",
    "created_at": "2018-09-04T09:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377734",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:29'></a>I force-pushed two commits. The first commit contains all changes, and the second commit contains only filename changes.

Hopefully, a reviewer could see the changes against the devel branch more easily from the first commit.



---

archive/issue_comments_377735.json:
```json
{
    "body": "<a id='comment:30'></a>Can you do a rebase? If so, I will do the review for this in the next few days (now that I have freed up a bit of time).",
    "created_at": "2018-09-11T22:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377735",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:30'></a>Can you do a rebase? If so, I will do the review for this in the next few days (now that I have freed up a bit of time).



---

archive/issue_comments_377736.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-09-11T23:55:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377736",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_377737.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:30 tscrim]:\n> I will do the review for this in the next few days (now that I have freed up a bit of time).\n\n\nThank you, Travis. I thought of splitting this big patch into pieces, but it seemed difficult. If you find reviewing the patch annoying because of its size, let me know. Then I will try once again.",
    "created_at": "2018-09-12T00:04:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377737",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:32'></a>Replying to [comment:30 tscrim]:
> I will do the review for this in the next few days (now that I have freed up a bit of time).


Thank you, Travis. I thought of splitting this big patch into pieces, but it seemed difficult. If you find reviewing the patch annoying because of its size, let me know. Then I will try once again.



---

archive/issue_comments_377738.json:
```json
{
    "body": "<a id='comment:33'></a>I have been able to make it through the code. I cannot vouch so much for the mathematical correctness, but it does work as documented. Here are my comments about the code:\n\n- For `order_infinite_with_basis`, did you want `*basis` instead of `basis` as an input (in which case, you will have to have `check` be part of a `**kwds`)? Or do you expect people to pass a list with a single list of basis elements inside?\n- Can you construct `FunctionFieldMaximalOrder(Infinite)_global` with having a different basis? It feels like these classes should just take one input, `FunctionField(_global)`, which then has a hook to construct the corresponding basis (or maybe do this computation on-demand in the class itself). This would allow `FunctionFieldOrder` to inherit from `UniqueRepresentation` and `maximal_order_infinite()` to not be cached. I don't see how `FunctionFieldOrder` and subclasses are compared/hashed by default (the default `Parent.__hash__` using the string representation is a horrible hash too).\n- I am pretty sure there is a bug in the caching of `vector_space` as the key is always return `None`, so the `base` parameter is ignored. Actually, you do not need to have a key here because you error out when `base is not None`. Is this for compatibility with something else? Does `base**1` do something? I feel like it should just be `base`. I guess some of this is a hold-over from the old code, so it is not a big issue.\n- In all of the `__init__` tests, it would be good to have `TestSuite(I).run()` (especially over a `type(I)` call IMO). I would also move the `INPUT:` block outside of the `__init__` and into the class-level doc so that it is visible from the html doc.\n- `Returns` -> `Return` (in `base_ring()`).\n- Note that `_rmul_` (like `_lmul_`) can have general input as they are designed to be hooks for actions. (Not that this is necessarily wrong here, but I just want to make sure this has all of the behaviors you are expecting.)\n- I don't see the point of having `_gens_over_base`. It is only called from `gens_over_base` and could be moved into there.\n- Instead of handling your own custom cache with `_two_gens`, I would just ``@`cached_method` `gens_two`.\n- You should make sure the result of `basis_matrix` is an immutable matrix by adding `m.set_immutable()`.\n- I don't like avoiding `self`: it makes you have strange sentences like `Return the ideal below the ideal.`, which I might even argue is close to ill-defined (which ideal is the ideal?).\n- Same comment about custom cache for `_is_prime`.\n- A better way from `category or IntegralDomains()` to get the category might be `IntegralDomains().or_subcategory(category)` (works fine when `category=None`). You can also then tack on `category = category.Infinite()` and then remove the `is_finite` method.\n- You don't need to cache `ideal_monoid`, at least the `IdealMonoid` class is better as a `UniqueRepresentation`.\n- Error messages should start with a lowercase letter (as per our convention).\n- Some little doc formatting things:\n  {{{#!diff\n         - ``gens`` -- list of elements that are a basis for the\n-             ideal over the maximal order of the base field\n+           ideal over the maximal order of the base field\n  }}}\n  {{{#!diff\n- ``gens`` -- list of generators or an ideal in a ring which coerces\n-          to this order.\n+          to this order\n  }}}\n- Some micro-optimizations:\n  {{{#!diff\n-        basis = [V(sigma_a_pow[j]*beta_pow[i]) for i in range(s) for j in range(r)]\n+        basis = [V(sap * bp) for bp in beta_pow for sap in sigma_a_pow]\n         W = V.span_of_basis(basis)\n \n         def to_K(f):\n             coeffs = (f % q).list()\n-            return sum([sigma(coeffs[i]) * beta_pow[i] for i in range(len(coeffs))], K.zero())\n+            return sum((sigma(c) * beta_pow[i] for i, c in enumerate(coeffs)), K.zero())\n \n         if r == 1: # take care of the prime field case\n             def fr_K(g):\n                 co = W.coordinates(V(g),check=False)\n                 return R([k(co[j]) for j in range(s)])\n         else:\n-            t = r * s\n             def fr_K(g):\n                 co = W.coordinates(V(g),check=False)\n-                return R([k(co[i:i+r]) for i in range(0,t,r)])\n+                return R([k(co[i:i+r]) for i in range(0,r*s,r)])\n  }}}\n  (well, the last changes are for readability, less variables to keep track of).\n- Micro-optimization: in `mul_vecs`, you might want to move `self._mtable[i]` part out of the `for j in range(n):` loop to avoid the extra lookups.\n- I think it is bad form to use raises of errors to dictate program flow. I think a better way in `_ideal_from_vectors_and_denominator` (which should be faster too) is to have\n  {{{#!python\n                M = []\n                g = d\n                for v in vecs:\n                    for c in l:\n                        g = g.gcd(c)\n                        if g.is_one():\n                            break\n                    else:\n                        M += l\n                        continue\n                    break\n                else:\n                    d = d // g\n                    mat = matrix(R, len(vecs), [c // g for c in M])\n  }}}\n  where the `else` block is run iff the loop did not run to completion. You could also dispatch this to an internal function that would return `mat` or `None` upon failure.\n- Is there a clear benefit to having `mtable` a list of vectors, as opposed to a list of lists or a `Matrix` object?\n- Isn't this block of the `div` in Buchman-Lenstra algorithm just the same as `mul_vec`?\n  {{{\n                        c = 0\n                        for i in range(n):\n                            for j in range(n):\n                                c += a[i] * b[j] * mtable[i][j]\n  }}}\n  Perhaps there would be a benefit from cythonizing `mul_vec` considering how frequently it is used.",
    "created_at": "2018-09-12T05:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377738",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:33'></a>I have been able to make it through the code. I cannot vouch so much for the mathematical correctness, but it does work as documented. Here are my comments about the code:

- For `order_infinite_with_basis`, did you want `*basis` instead of `basis` as an input (in which case, you will have to have `check` be part of a `**kwds`)? Or do you expect people to pass a list with a single list of basis elements inside?
- Can you construct `FunctionFieldMaximalOrder(Infinite)_global` with having a different basis? It feels like these classes should just take one input, `FunctionField(_global)`, which then has a hook to construct the corresponding basis (or maybe do this computation on-demand in the class itself). This would allow `FunctionFieldOrder` to inherit from `UniqueRepresentation` and `maximal_order_infinite()` to not be cached. I don't see how `FunctionFieldOrder` and subclasses are compared/hashed by default (the default `Parent.__hash__` using the string representation is a horrible hash too).
- I am pretty sure there is a bug in the caching of `vector_space` as the key is always return `None`, so the `base` parameter is ignored. Actually, you do not need to have a key here because you error out when `base is not None`. Is this for compatibility with something else? Does `base**1` do something? I feel like it should just be `base`. I guess some of this is a hold-over from the old code, so it is not a big issue.
- In all of the `__init__` tests, it would be good to have `TestSuite(I).run()` (especially over a `type(I)` call IMO). I would also move the `INPUT:` block outside of the `__init__` and into the class-level doc so that it is visible from the html doc.
- `Returns` -> `Return` (in `base_ring()`).
- Note that `_rmul_` (like `_lmul_`) can have general input as they are designed to be hooks for actions. (Not that this is necessarily wrong here, but I just want to make sure this has all of the behaviors you are expecting.)
- I don't see the point of having `_gens_over_base`. It is only called from `gens_over_base` and could be moved into there.
- Instead of handling your own custom cache with `_two_gens`, I would just ``@`cached_method` `gens_two`.
- You should make sure the result of `basis_matrix` is an immutable matrix by adding `m.set_immutable()`.
- I don't like avoiding `self`: it makes you have strange sentences like `Return the ideal below the ideal.`, which I might even argue is close to ill-defined (which ideal is the ideal?).
- Same comment about custom cache for `_is_prime`.
- A better way from `category or IntegralDomains()` to get the category might be `IntegralDomains().or_subcategory(category)` (works fine when `category=None`). You can also then tack on `category = category.Infinite()` and then remove the `is_finite` method.
- You don't need to cache `ideal_monoid`, at least the `IdealMonoid` class is better as a `UniqueRepresentation`.
- Error messages should start with a lowercase letter (as per our convention).
- Some little doc formatting things:
  {{{#!diff
         - ``gens`` -- list of elements that are a basis for the
-             ideal over the maximal order of the base field
+           ideal over the maximal order of the base field
  }}}
  {{{#!diff
- ``gens`` -- list of generators or an ideal in a ring which coerces
-          to this order.
+          to this order
  }}}
- Some micro-optimizations:
  {{{#!diff
-        basis = [V(sigma_a_pow[j]*beta_pow[i]) for i in range(s) for j in range(r)]
+        basis = [V(sap * bp) for bp in beta_pow for sap in sigma_a_pow]
         W = V.span_of_basis(basis)
 
         def to_K(f):
             coeffs = (f % q).list()
-            return sum([sigma(coeffs[i]) * beta_pow[i] for i in range(len(coeffs))], K.zero())
+            return sum((sigma(c) * beta_pow[i] for i, c in enumerate(coeffs)), K.zero())
 
         if r == 1: # take care of the prime field case
             def fr_K(g):
                 co = W.coordinates(V(g),check=False)
                 return R([k(co[j]) for j in range(s)])
         else:
-            t = r * s
             def fr_K(g):
                 co = W.coordinates(V(g),check=False)
-                return R([k(co[i:i+r]) for i in range(0,t,r)])
+                return R([k(co[i:i+r]) for i in range(0,r*s,r)])
  }}}
  (well, the last changes are for readability, less variables to keep track of).
- Micro-optimization: in `mul_vecs`, you might want to move `self._mtable[i]` part out of the `for j in range(n):` loop to avoid the extra lookups.
- I think it is bad form to use raises of errors to dictate program flow. I think a better way in `_ideal_from_vectors_and_denominator` (which should be faster too) is to have
  {{{#!python
                M = []
                g = d
                for v in vecs:
                    for c in l:
                        g = g.gcd(c)
                        if g.is_one():
                            break
                    else:
                        M += l
                        continue
                    break
                else:
                    d = d // g
                    mat = matrix(R, len(vecs), [c // g for c in M])
  }}}
  where the `else` block is run iff the loop did not run to completion. You could also dispatch this to an internal function that would return `mat` or `None` upon failure.
- Is there a clear benefit to having `mtable` a list of vectors, as opposed to a list of lists or a `Matrix` object?
- Isn't this block of the `div` in Buchman-Lenstra algorithm just the same as `mul_vec`?
  {{{
                        c = 0
                        for i in range(n):
                            for j in range(n):
                                c += a[i] * b[j] * mtable[i][j]
  }}}
  Perhaps there would be a benefit from cythonizing `mul_vec` considering how frequently it is used.



---

archive/issue_comments_377739.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 tscrim]:\n> - For `order_infinite_with_basis`, did you want `*basis` instead of `basis` as an input (in which case, you will have to have `check` be part of a `**kwds`)? Or do you expect people to pass a list with a single list of basis elements inside?\n\n\nThe code seems to be intended to support these three cases:\n\n```\nL.order_infinite_with_basis([1/x,1/x*y, 1/x^2*y^2])\n\nL.order_infinite_with_basis([1/x])\n\nL.order_infinite_with_basis(1/x)\n```\n\nBut this is not described in the docstring. Also this is not consistent with `order_with_basis`. Hence I will remove the responsible code from `order_infinite_with_basis`. Happily, there is no doctest failure because of this.",
    "created_at": "2018-09-14T02:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377739",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:34'></a>Replying to [comment:33 tscrim]:
> - For `order_infinite_with_basis`, did you want `*basis` instead of `basis` as an input (in which case, you will have to have `check` be part of a `**kwds`)? Or do you expect people to pass a list with a single list of basis elements inside?


The code seems to be intended to support these three cases:

```
L.order_infinite_with_basis([1/x,1/x*y, 1/x^2*y^2])

L.order_infinite_with_basis([1/x])

L.order_infinite_with_basis(1/x)
```

But this is not described in the docstring. Also this is not consistent with `order_with_basis`. Hence I will remove the responsible code from `order_infinite_with_basis`. Happily, there is no doctest failure because of this.



---

archive/issue_comments_377740.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-14T02:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377740",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377741.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:33 tscrim]:\n> - Can you construct `FunctionFieldMaximalOrder(Infinite)_global` with having a different basis?\n\n\nNo.\n\n> It feels like these classes should just take one input, `FunctionField(_global)`, which then has a hook to construct the corresponding basis (or maybe do this computation on-demand in the class itself). This would allow `FunctionFieldOrder` to inherit from `UniqueRepresentation` and `maximal_order_infinite()` to not be cached. I don't see how `FunctionFieldOrder` and subclasses are compared/hashed by default (the default `Parent.__hash__` using the string representation is a horrible hash too).\n\n\nI followed your suggestion partially. Now `FunctionFieldMaximalOrder` class inherits `UniqueRepresentation`. So for `maximal_order()` and `maximal_order_infinite()` are not cached.\n\nOrders created with a basis do have unique representation behavior. They could have cached representation behavior. But I don't see a reason to force this.\n\nEquation orders can have unique representation behavior. But I leave them just to be cached. I don't see a compelling reason to avoid using ``@`cached_method` for these. Do you have?",
    "created_at": "2018-09-14T07:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377741",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:36'></a>Replying to [comment:33 tscrim]:
> - Can you construct `FunctionFieldMaximalOrder(Infinite)_global` with having a different basis?


No.

> It feels like these classes should just take one input, `FunctionField(_global)`, which then has a hook to construct the corresponding basis (or maybe do this computation on-demand in the class itself). This would allow `FunctionFieldOrder` to inherit from `UniqueRepresentation` and `maximal_order_infinite()` to not be cached. I don't see how `FunctionFieldOrder` and subclasses are compared/hashed by default (the default `Parent.__hash__` using the string representation is a horrible hash too).


I followed your suggestion partially. Now `FunctionFieldMaximalOrder` class inherits `UniqueRepresentation`. So for `maximal_order()` and `maximal_order_infinite()` are not cached.

Orders created with a basis do have unique representation behavior. They could have cached representation behavior. But I don't see a reason to force this.

Equation orders can have unique representation behavior. But I leave them just to be cached. I don't see a compelling reason to avoid using ``@`cached_method` for these. Do you have?



---

archive/issue_comments_377742.json:
```json
{
    "body": "<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-14T07:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377742",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377743.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:36 klee]:\n> Replying to [comment:33 tscrim]:\n> > - Can you construct `FunctionFieldMaximalOrder(Infinite)_global` with having a different basis?\n \n> \n> No.\n> \n> > It feels like these classes should just take one input, `FunctionField(_global)`, which then has a hook to construct the corresponding basis (or maybe do this computation on-demand in the class itself). This would allow `FunctionFieldOrder` to inherit from `UniqueRepresentation` and `maximal_order_infinite()` to not be cached. I don't see how `FunctionFieldOrder` and subclasses are compared/hashed by default (the default `Parent.__hash__` using the string representation is a horrible hash too).\n\n> \n> I followed your suggestion partially. Now `FunctionFieldMaximalOrder` class inherits `UniqueRepresentation`. So for `maximal_order()` and `maximal_order_infinite()` are not cached.\n> \n> Orders created with a basis do have unique representation behavior. They could have cached representation behavior. But I don't see a reason to force this.\n\n\nThank you.\n\n> Equation orders can have unique representation behavior. But I leave them just to be cached. I don't see a compelling reason to avoid using ``@`cached_method` for these. Do you have?\n\n\nThey are subclasses of `Parent`, correct? Things work faster/better in regard to, say, coercion and equality with `UniqueRepresentation`. It is also faster to compare for equality and hash (just use the `id` in both cases). Speaking of which, because of the MRO, it is better to have `UniqueRepresentation` as the first class.\n\nIt also means the cache is tied with the object itself rather than a creation method. Say, someone else creates a (maybe completely separate) class that wants to use the basis classes. They would also have to implement a cache, which would either create two copies of the same object or have to make the two caches interact; both of which I think are bad.\n\nFYI - if you do really only want cached behavior, there is a `CachedRepresentation` class you could use. However, I don't see a reason why not to upgrade to the `UniqueRepresentation` here.",
    "created_at": "2018-09-14T09:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377743",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:38'></a>Replying to [comment:36 klee]:
> Replying to [comment:33 tscrim]:
> > - Can you construct `FunctionFieldMaximalOrder(Infinite)_global` with having a different basis?
 
> 
> No.
> 
> > It feels like these classes should just take one input, `FunctionField(_global)`, which then has a hook to construct the corresponding basis (or maybe do this computation on-demand in the class itself). This would allow `FunctionFieldOrder` to inherit from `UniqueRepresentation` and `maximal_order_infinite()` to not be cached. I don't see how `FunctionFieldOrder` and subclasses are compared/hashed by default (the default `Parent.__hash__` using the string representation is a horrible hash too).

> 
> I followed your suggestion partially. Now `FunctionFieldMaximalOrder` class inherits `UniqueRepresentation`. So for `maximal_order()` and `maximal_order_infinite()` are not cached.
> 
> Orders created with a basis do have unique representation behavior. They could have cached representation behavior. But I don't see a reason to force this.


Thank you.

> Equation orders can have unique representation behavior. But I leave them just to be cached. I don't see a compelling reason to avoid using ``@`cached_method` for these. Do you have?


They are subclasses of `Parent`, correct? Things work faster/better in regard to, say, coercion and equality with `UniqueRepresentation`. It is also faster to compare for equality and hash (just use the `id` in both cases). Speaking of which, because of the MRO, it is better to have `UniqueRepresentation` as the first class.

It also means the cache is tied with the object itself rather than a creation method. Say, someone else creates a (maybe completely separate) class that wants to use the basis classes. They would also have to implement a cache, which would either create two copies of the same object or have to make the two caches interact; both of which I think are bad.

FYI - if you do really only want cached behavior, there is a `CachedRepresentation` class you could use. However, I don't see a reason why not to upgrade to the `UniqueRepresentation` here.



---

archive/issue_comments_377744.json:
```json
{
    "body": "<a id='comment:39'></a>Replying to [comment:38 tscrim]:\n> > Orders created with a basis do have unique representation behavior. They could have cached representation behavior. But I don't see a reason to force this.\n\n> \n> Thank you.\n\n\nThere was a typo here. I meant:\n\n`Order_basis` class does *not* have unique representation behavior. It could have cached representation behavior. But I don't see a reason to force this.\n\n> > Equation orders can have unique representation behavior. But I leave them just to be cached. I don't see a compelling reason to avoid using ``@`cached_method` for these. Do you have?\n\n> \n> They are subclasses of `Parent`, correct? Things work faster/better in regard to, say, coercion and equality with `UniqueRepresentation`. It is also faster to compare for equality and hash (just use the `id` in both cases). Speaking of which, because of the MRO, it is better to have `UniqueRepresentation` as the first class.\n\n\nOk. I will make this fix.\n\n> It also means the cache is tied with the object itself rather than a creation method. Say, someone else creates a (maybe completely separate) class that wants to use the basis classes. They would also have to implement a cache, which would either create two copies of the same object or have to make the two caches interact; both of which I think are bad.\n\n\nI agree. But `EquationOrder(Infinite)` class is something that I do not expect to be subclassed. Anyway now it occurs to me that I can just get rid of this class, and use the superclass`Order_basis`.",
    "created_at": "2018-09-14T09:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377744",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:39'></a>Replying to [comment:38 tscrim]:
> > Orders created with a basis do have unique representation behavior. They could have cached representation behavior. But I don't see a reason to force this.

> 
> Thank you.


There was a typo here. I meant:

`Order_basis` class does *not* have unique representation behavior. It could have cached representation behavior. But I don't see a reason to force this.

> > Equation orders can have unique representation behavior. But I leave them just to be cached. I don't see a compelling reason to avoid using ``@`cached_method` for these. Do you have?

> 
> They are subclasses of `Parent`, correct? Things work faster/better in regard to, say, coercion and equality with `UniqueRepresentation`. It is also faster to compare for equality and hash (just use the `id` in both cases). Speaking of which, because of the MRO, it is better to have `UniqueRepresentation` as the first class.


Ok. I will make this fix.

> It also means the cache is tied with the object itself rather than a creation method. Say, someone else creates a (maybe completely separate) class that wants to use the basis classes. They would also have to implement a cache, which would either create two copies of the same object or have to make the two caches interact; both of which I think are bad.


I agree. But `EquationOrder(Infinite)` class is something that I do not expect to be subclassed. Anyway now it occurs to me that I can just get rid of this class, and use the superclass`Order_basis`.



---

archive/issue_comments_377745.json:
```json
{
    "body": "<a id='comment:40'></a>Replying to [comment:39 klee]:\n> Replying to [comment:38 tscrim]:\n> > > Orders created with a basis do have unique representation behavior. They could have cached representation behavior. But I don't see a reason to force this.\n\n> > \n> > Thank you.\n\n> \n> There was a typo here. I meant:\n> \n> `Order_basis` class does *not* have unique representation behavior. It could have cached representation behavior. But I don't see a reason to force this.\n\n\nIf you expect to create elements of this class and implement coercions between them, then it makes the mechanisms in the coercion framework work a lot better and faster. In addition to the reasons given below. However, this is only a suggestion, and I don't have a strong preference (or a stake in the outcome). If you prefer it this way, then that is fine with me.\n\n> > It also means the cache is tied with the object itself rather than a creation method. Say, someone else creates a (maybe completely separate) class that wants to use the basis classes. They would also have to implement a cache, which would either create two copies of the same object or have to make the two caches interact; both of which I think are bad.\n\n> \n> I agree. But `EquationOrder(Infinite)` class is something that I do not expect to be subclassed. Anyway now it occurs to me that I can just get rid of this class, and use the superclass`Order_basis`.\n\n\nOkay, but someone might have a completely different class that would call it. For example, someone implements a 3rd party library for function fields that we tie into Sage, but you still would want to have a method, say, `equation_order` from that new implementation. This would give the situation I am describing above. Granted, this is not so likely, but it is better to future-proof when there is little cost to complexity IMO.",
    "created_at": "2018-09-14T10:46:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377745",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:40'></a>Replying to [comment:39 klee]:
> Replying to [comment:38 tscrim]:
> > > Orders created with a basis do have unique representation behavior. They could have cached representation behavior. But I don't see a reason to force this.

> > 
> > Thank you.

> 
> There was a typo here. I meant:
> 
> `Order_basis` class does *not* have unique representation behavior. It could have cached representation behavior. But I don't see a reason to force this.


If you expect to create elements of this class and implement coercions between them, then it makes the mechanisms in the coercion framework work a lot better and faster. In addition to the reasons given below. However, this is only a suggestion, and I don't have a strong preference (or a stake in the outcome). If you prefer it this way, then that is fine with me.

> > It also means the cache is tied with the object itself rather than a creation method. Say, someone else creates a (maybe completely separate) class that wants to use the basis classes. They would also have to implement a cache, which would either create two copies of the same object or have to make the two caches interact; both of which I think are bad.

> 
> I agree. But `EquationOrder(Infinite)` class is something that I do not expect to be subclassed. Anyway now it occurs to me that I can just get rid of this class, and use the superclass`Order_basis`.


Okay, but someone might have a completely different class that would call it. For example, someone implements a 3rd party library for function fields that we tie into Sage, but you still would want to have a method, say, `equation_order` from that new implementation. This would give the situation I am describing above. Granted, this is not so likely, but it is better to future-proof when there is little cost to complexity IMO.



---

archive/issue_comments_377746.json:
```json
{
    "body": "<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-17T07:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377746",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:41'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377747.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:33 tscrim]:\n\n>- I am pretty sure there is a bug in the caching of `vector_space` as the key is always return `None`, so the `base` parameter is ignored. Actually, you do not need to have a key here because you error out when `base is not None`. Is this for compatibility with something else? Does `base**1` do something? I feel like it should just be `base`. I guess some of this is a hold-over from the old code, so it is not a big issue.\n\n\nThis is not my code. But it seems not a bug to me.  The intention is to force base to `self` (a rational function field) if given, since `self` is the only reasonable base field for a rational function field. If F is a rational function field,\n\n```\nF.vector_space()  ---> Ok. The base is F.\nF.vector_space(F) ---> Ok. The base is F.\nF.vector_space(G) ---> Raise an error.\n```\nFor the first two cases, the cache key is `None`. On the other hand, `base**1` creates a vector space over `base` of dimension 1.",
    "created_at": "2018-09-17T07:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377747",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:42'></a>Replying to [comment:33 tscrim]:

>- I am pretty sure there is a bug in the caching of `vector_space` as the key is always return `None`, so the `base` parameter is ignored. Actually, you do not need to have a key here because you error out when `base is not None`. Is this for compatibility with something else? Does `base**1` do something? I feel like it should just be `base`. I guess some of this is a hold-over from the old code, so it is not a big issue.


This is not my code. But it seems not a bug to me.  The intention is to force base to `self` (a rational function field) if given, since `self` is the only reasonable base field for a rational function field. If F is a rational function field,

```
F.vector_space()  ---> Ok. The base is F.
F.vector_space(F) ---> Ok. The base is F.
F.vector_space(G) ---> Raise an error.
```
For the first two cases, the cache key is `None`. On the other hand, `base**1` creates a vector space over `base` of dimension 1.



---

archive/issue_comments_377748.json:
```json
{
    "body": "<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-19T02:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:43'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377749.json:
```json
{
    "body": "<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-19T02:07:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:44'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377750.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:42 klee]:\n> Replying to [comment:33 tscrim]:\n> \n> >- I am pretty sure there is a bug in the caching of `vector_space` as the key is always return `None`, so the `base` parameter is ignored. Actually, you do not need to have a key here because you error out when `base is not None`. Is this for compatibility with something else? Does `base**1` do something? I feel like it should just be `base`. I guess some of this is a hold-over from the old code, so it is not a big issue.\n \n> \n> This is not my code. But it seems not a bug to me.  The intention is to force base to `self` (a rational function field) if given, since `self` is the only reasonable base field for a rational function field. If F is a rational function field,\n> \n> ```\n> F.vector_space()  ---> Ok. The base is F.\n> F.vector_space(F) ---> Ok. The base is F.\n> F.vector_space(G) ---> Raise an error.\n> ```\n> For the first two cases, the cache key is `None`. On the other hand, `base**1` creates a vector space over `base` of dimension 1.\n\n\nAh, right, that shorthand. It would definitely improve readability to have it be `FreeModule(base, 1)`, but it is not important as it is just looks like a change because of the refactoring. I just do not see why `vector_space` should take an argument. Everything about that code says it should not have any arguments and you can should just replace `base` with `self`. Unless it is for some consistency or used in some other more general context?",
    "created_at": "2018-09-19T02:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377750",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:45'></a>Replying to [comment:42 klee]:
> Replying to [comment:33 tscrim]:
> 
> >- I am pretty sure there is a bug in the caching of `vector_space` as the key is always return `None`, so the `base` parameter is ignored. Actually, you do not need to have a key here because you error out when `base is not None`. Is this for compatibility with something else? Does `base**1` do something? I feel like it should just be `base`. I guess some of this is a hold-over from the old code, so it is not a big issue.
 
> 
> This is not my code. But it seems not a bug to me.  The intention is to force base to `self` (a rational function field) if given, since `self` is the only reasonable base field for a rational function field. If F is a rational function field,
> 
> ```
> F.vector_space()  ---> Ok. The base is F.
> F.vector_space(F) ---> Ok. The base is F.
> F.vector_space(G) ---> Raise an error.
> ```
> For the first two cases, the cache key is `None`. On the other hand, `base**1` creates a vector space over `base` of dimension 1.


Ah, right, that shorthand. It would definitely improve readability to have it be `FreeModule(base, 1)`, but it is not important as it is just looks like a change because of the refactoring. I just do not see why `vector_space` should take an argument. Everything about that code says it should not have any arguments and you can should just replace `base` with `self`. Unless it is for some consistency or used in some other more general context?



---

archive/issue_comments_377751.json:
```json
{
    "body": "<a id='comment:46'></a>Replying to [comment:45 tscrim]:\n> Replying to [comment:42 klee]:\n> > Replying to [comment:33 tscrim]:\n> > \n> > >- I am pretty sure there is a bug in the caching of `vector_space` as the key is always return `None`, so the `base` parameter is ignored. Actually, you do not need to have a key here because you error out when `base is not None`. Is this for compatibility with something else? Does `base**1` do something? I feel like it should just be `base`. I guess some of this is a hold-over from the old code, so it is not a big issue.\n \n> > \n> > This is not my code. But it seems not a bug to me.  The intention is to force base to `self` (a rational function field) if given, since `self` is the only reasonable base field for a rational function field. If F is a rational function field,\n> > \n> > ```\n> > F.vector_space()  ---> Ok. The base is F.\n> > F.vector_space(F) ---> Ok. The base is F.\n> > F.vector_space(G) ---> Raise an error.\n> > ```\n> > For the first two cases, the cache key is `None`. On the other hand, `base**1` creates a vector space over `base` of dimension 1.\n\n> \n> Ah, right, that shorthand. It would definitely improve readability to have it be `FreeModule(base, 1)`, but it is not important as it is just looks like a change because of the refactoring. I just do not see why `vector_space` should take an argument. Everything about that code says it should not have any arguments and you can should just replace `base` with `self`. Unless it is for some consistency or used in some other more general context?\n\n\nIt is for consistency. Note that general function fields also have `vector_space`, for which it is reasonable to take a `base` argument. Thus, perhaps, one can write generic code for function fields, rational or not. This is not my design.",
    "created_at": "2018-09-19T06:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377751",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:46'></a>Replying to [comment:45 tscrim]:
> Replying to [comment:42 klee]:
> > Replying to [comment:33 tscrim]:
> > 
> > >- I am pretty sure there is a bug in the caching of `vector_space` as the key is always return `None`, so the `base` parameter is ignored. Actually, you do not need to have a key here because you error out when `base is not None`. Is this for compatibility with something else? Does `base**1` do something? I feel like it should just be `base`. I guess some of this is a hold-over from the old code, so it is not a big issue.
 
> > 
> > This is not my code. But it seems not a bug to me.  The intention is to force base to `self` (a rational function field) if given, since `self` is the only reasonable base field for a rational function field. If F is a rational function field,
> > 
> > ```
> > F.vector_space()  ---> Ok. The base is F.
> > F.vector_space(F) ---> Ok. The base is F.
> > F.vector_space(G) ---> Raise an error.
> > ```
> > For the first two cases, the cache key is `None`. On the other hand, `base**1` creates a vector space over `base` of dimension 1.

> 
> Ah, right, that shorthand. It would definitely improve readability to have it be `FreeModule(base, 1)`, but it is not important as it is just looks like a change because of the refactoring. I just do not see why `vector_space` should take an argument. Everything about that code says it should not have any arguments and you can should just replace `base` with `self`. Unless it is for some consistency or used in some other more general context?


It is for consistency. Note that general function fields also have `vector_space`, for which it is reasonable to take a `base` argument. Thus, perhaps, one can write generic code for function fields, rational or not. This is not my design.



---

archive/issue_comments_377752.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:46 klee]:\n> It is for consistency. Note that general function fields also have `vector_space`, for which it is reasonable to take a `base` argument. Thus, perhaps, one can write generic code for function fields, rational or not. This is not my design.\n\n\nFair enough. I only really noticed it because of the refactoring.\n\nI think the only last thing to do is to have a doctest in each of the `__init__` methods that simply created the corresponding object and runs `TestSuite(foo).run()`. Otherwise, I think that takes care of everything. Thank you.",
    "created_at": "2018-09-19T08:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377752",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:47'></a>Replying to [comment:46 klee]:
> It is for consistency. Note that general function fields also have `vector_space`, for which it is reasonable to take a `base` argument. Thus, perhaps, one can write generic code for function fields, rational or not. This is not my design.


Fair enough. I only really noticed it because of the refactoring.

I think the only last thing to do is to have a doctest in each of the `__init__` methods that simply created the corresponding object and runs `TestSuite(foo).run()`. Otherwise, I think that takes care of everything. Thank you.



---

archive/issue_comments_377753.json:
```json
{
    "body": "<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-21T17:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:48'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377754.json:
```json
{
    "body": "<a id='comment:49'></a>It was instructive to add `TestSuites` for all parents. I could finally understand the basics of the interplay of Parents, Elements, and Categories. Thank you.\n\nI will take care of other comments after a week long national holidays.",
    "created_at": "2018-09-21T17:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377754",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:49'></a>It was instructive to add `TestSuites` for all parents. I could finally understand the basics of the interplay of Parents, Elements, and Categories. Thank you.

I will take care of other comments after a week long national holidays.



---

archive/issue_comments_377755.json:
```json
{
    "body": "<a id='comment:50'></a>Replying to [comment:49 klee]:\n> It was instructive to add `TestSuites` for all parents. I could finally understand the basics of the interplay of Parents, Elements, and Categories. Thank you.\n\n\nI am glad to hear you were able to learn some new stuff. It looks like you were able to reduce the redundancy.\n\nI have a few additional small comments:\n\nError messages should not be proper sentences (so not starting with a capital letter and ending with a period/full-stop):\n\n```diff\n-        if n != 0: raise IndexError(\"Only one generator.\")\n+        if n != 0:\n+            raise IndexError(\"only one generator\")\n         return self._gen\n```\n(This is a general Python convention.)\nSame also for `raise IndexError(\"Only {} generators\".format(self.ngens()))`.\n\nThese type of changes do not seem to be correct to me:\n\n```\n        m = self.ideal_monoid()\n        m.Element = FunctionFieldIdeal_rational\n```\nThe `Element` attribute should be set by the corresponding parent before `Parent.__init__` is called, as does the appropriate setup (e.g., constructing `element_class`). The thing do do would be to have a hook (via a attribute) that is looked at by `IdealMonoid` in its `__init__` which then sets its `Element` attribute, e.g.:\n\n```\nself.Element = R._ideal_class\n```\nAlso, is there a use-case for someone to pass an `ideal_class` to `ideal` or `ideal_with_gens_over_base`? If so, then this hook I mentioned above should be removed and the `ideal_class` should instead be an additional construction parameter for `IdealMonoid`.\n\nTrivial formatting:\n\n```diff\n         - ``gens`` -- list of elements that are a basis for the\n-              ideal over the maximal order of the base field\n+          ideal over the maximal order of the base field\n```\n\nIf you want to enforce a particular subcategory for input, you can do:\n\n```diff\n-category or IntegralDomains()\n+category = IntegralDomains().or_subcategory(category)\n```\n(for `None`, this becomes `IntegralDomains()`).\n\nI can also look into why the facade parents are not behaving well once the above is done.\n\n> I will take care of other comments after a week long national holidays. \n\n\nNo problem. Enjoy your holidays.",
    "created_at": "2018-09-21T23:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377755",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:50'></a>Replying to [comment:49 klee]:
> It was instructive to add `TestSuites` for all parents. I could finally understand the basics of the interplay of Parents, Elements, and Categories. Thank you.


I am glad to hear you were able to learn some new stuff. It looks like you were able to reduce the redundancy.

I have a few additional small comments:

Error messages should not be proper sentences (so not starting with a capital letter and ending with a period/full-stop):

```diff
-        if n != 0: raise IndexError("Only one generator.")
+        if n != 0:
+            raise IndexError("only one generator")
         return self._gen
```
(This is a general Python convention.)
Same also for `raise IndexError("Only {} generators".format(self.ngens()))`.

These type of changes do not seem to be correct to me:

```
        m = self.ideal_monoid()
        m.Element = FunctionFieldIdeal_rational
```
The `Element` attribute should be set by the corresponding parent before `Parent.__init__` is called, as does the appropriate setup (e.g., constructing `element_class`). The thing do do would be to have a hook (via a attribute) that is looked at by `IdealMonoid` in its `__init__` which then sets its `Element` attribute, e.g.:

```
self.Element = R._ideal_class
```
Also, is there a use-case for someone to pass an `ideal_class` to `ideal` or `ideal_with_gens_over_base`? If so, then this hook I mentioned above should be removed and the `ideal_class` should instead be an additional construction parameter for `IdealMonoid`.

Trivial formatting:

```diff
         - ``gens`` -- list of elements that are a basis for the
-              ideal over the maximal order of the base field
+          ideal over the maximal order of the base field
```

If you want to enforce a particular subcategory for input, you can do:

```diff
-category or IntegralDomains()
+category = IntegralDomains().or_subcategory(category)
```
(for `None`, this becomes `IntegralDomains()`).

I can also look into why the facade parents are not behaving well once the above is done.

> I will take care of other comments after a week long national holidays. 


No problem. Enjoy your holidays.



---

archive/issue_comments_377756.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T05:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377756",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377757.json:
```json
{
    "body": "<a id='comment:52'></a>Replying to [comment:50 tscrim]:\n> These type of changes do not seem to be correct to me:\n> \n> ```\n>         m = self.ideal_monoid()\n>         m.Element = FunctionFieldIdeal_rational\n> ```\n> The `Element` attribute should be set by the corresponding parent before `Parent.__init__` is called, as does the appropriate setup (e.g., constructing `element_class`). The thing to do would be to have a hook (via a attribute) that is looked at by `IdealMonoid` in its `__init__` which then sets its `Element` attribute, e.g.:\n> \n> ```\n> self.Element = R._ideal_class\n> ```\n\n\nOk.\n\n> Also, is there a use-case for someone to pass an `ideal_class` to `ideal` or `ideal_with_gens_over_base`? If so, then this hook I mentioned above should be removed and the `ideal_class` should instead be an additional construction parameter for `IdealMonoid`.\n\n\nPerhaps not. This is a left-over from existing code. I tried to clean this up.\n \n> I can also look into why the facade parents are not behaving well once the above is done.\n\n\nThe function field orders are facade parents, because the parent of elements of an order is just the function field. What seems to me a bug is that  some category tests intended for normal parents are still applied to facade parents. For example, `_test_one`, `_test_zero`.",
    "created_at": "2018-09-27T05:53:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377757",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:52'></a>Replying to [comment:50 tscrim]:
> These type of changes do not seem to be correct to me:
> 
> ```
>         m = self.ideal_monoid()
>         m.Element = FunctionFieldIdeal_rational
> ```
> The `Element` attribute should be set by the corresponding parent before `Parent.__init__` is called, as does the appropriate setup (e.g., constructing `element_class`). The thing to do would be to have a hook (via a attribute) that is looked at by `IdealMonoid` in its `__init__` which then sets its `Element` attribute, e.g.:
> 
> ```
> self.Element = R._ideal_class
> ```


Ok.

> Also, is there a use-case for someone to pass an `ideal_class` to `ideal` or `ideal_with_gens_over_base`? If so, then this hook I mentioned above should be removed and the `ideal_class` should instead be an additional construction parameter for `IdealMonoid`.


Perhaps not. This is a left-over from existing code. I tried to clean this up.
 
> I can also look into why the facade parents are not behaving well once the above is done.


The function field orders are facade parents, because the parent of elements of an order is just the function field. What seems to me a bug is that  some category tests intended for normal parents are still applied to facade parents. For example, `_test_one`, `_test_zero`.



---

archive/issue_comments_377758.json:
```json
{
    "body": "<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T06:14:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377758",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377759.json:
```json
{
    "body": "<a id='comment:54'></a>Replying to [comment:33 tscrim]:\n> - I don't see the point of having `_gens_over_base`. It is only called from `gens_over_base` and could be moved into there.\n\n\nI guess `_gens_over_base` was introduced for efficiency when I implemented \"places\" and \"divisors\" on top of orders and ideals. As that is not needed here, I removed it. I may reintroduce it in a later ticket.",
    "created_at": "2018-09-27T06:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377759",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:54'></a>Replying to [comment:33 tscrim]:
> - I don't see the point of having `_gens_over_base`. It is only called from `gens_over_base` and could be moved into there.


I guess `_gens_over_base` was introduced for efficiency when I implemented "places" and "divisors" on top of orders and ideals. As that is not needed here, I removed it. I may reintroduce it in a later ticket.



---

archive/issue_comments_377760.json:
```json
{
    "body": "<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T08:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377760",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:55'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377761.json:
```json
{
    "body": "<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T08:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377762.json:
```json
{
    "body": "<a id='comment:57'></a>Replying to [comment:33 tscrim]:\n\n> - I don't like avoiding `self`: it makes you have strange sentences like `Return the ideal below the ideal.`, which I might even argue is close to ill-defined (which ideal is the ideal?).\n\n\nI like to avoid `self`, at least to be consistent, and follow the developer manual. Anyway, I tried to remove the ambiguities you mentioned.",
    "created_at": "2018-09-27T08:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377762",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:57'></a>Replying to [comment:33 tscrim]:

> - I don't like avoiding `self`: it makes you have strange sentences like `Return the ideal below the ideal.`, which I might even argue is close to ill-defined (which ideal is the ideal?).


I like to avoid `self`, at least to be consistent, and follow the developer manual. Anyway, I tried to remove the ambiguities you mentioned.



---

archive/issue_comments_377763.json:
```json
{
    "body": "<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T08:28:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377763",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:58'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377764.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T09:18:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377764",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377765.json:
```json
{
    "body": "<a id='comment:60'></a>Replying to [comment:33 tscrim]:\n\n> - Micro-optimization: in `mul_vecs`, you might want to move `self._mtable[i]` part out of the `for j in range(n):` loop to avoid the extra lookups.\n\n\nThe benefit seems negligible. I left this as it is, for readability. \n\n> - Is there a clear benefit to having `mtable` a list of vectors, as opposed to a list of lists or a `Matrix` object?\n\n\nIt is a list of a list of vectors.\n\n>   Perhaps there would be a benefit from cythonizing `mul_vec` considering how frequently it is used.\n\n\nLocating parts to be cythonized is a general issue that I should tackle some day, after learning more cython.",
    "created_at": "2018-09-27T09:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377765",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:60'></a>Replying to [comment:33 tscrim]:

> - Micro-optimization: in `mul_vecs`, you might want to move `self._mtable[i]` part out of the `for j in range(n):` loop to avoid the extra lookups.


The benefit seems negligible. I left this as it is, for readability. 

> - Is there a clear benefit to having `mtable` a list of vectors, as opposed to a list of lists or a `Matrix` object?


It is a list of a list of vectors.

>   Perhaps there would be a benefit from cythonizing `mul_vec` considering how frequently it is used.


Locating parts to be cythonized is a general issue that I should tackle some day, after learning more cython.



---

archive/issue_comments_377766.json:
```json
{
    "body": "<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-27T09:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377767.json:
```json
{
    "body": "<a id='comment:62'></a>Thank you for all of your changes. LGTM.\n\nI don't think it is exactly fair to quote the developers manual when you were the one who rewrote that part of the developers manual on `self`.",
    "created_at": "2018-09-27T22:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377767",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:62'></a>Thank you for all of your changes. LGTM.

I don't think it is exactly fair to quote the developers manual when you were the one who rewrote that part of the developers manual on `self`.



---

archive/issue_comments_377768.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-27T22:48:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377768",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_377769.json:
```json
{
    "body": "<a id='comment:64'></a>Replying to [comment:62 tscrim]:\n> Thank you for all of your changes. LGTM.\n> \n> I don't think it is exactly fair to quote the developers manual when you were the one who rewrote that part of the developers manual on `self`.\n\n\nI feel sorry about that. I read the part again. It implicitly states `self` should be used if confusion incurs from not using it. So your recommendation above is quite legitimate, and so is my response :-)",
    "created_at": "2018-09-28T00:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377769",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:64'></a>Replying to [comment:62 tscrim]:
> Thank you for all of your changes. LGTM.
> 
> I don't think it is exactly fair to quote the developers manual when you were the one who rewrote that part of the developers manual on `self`.


I feel sorry about that. I read the part again. It implicitly states `self` should be used if confusion incurs from not using it. So your recommendation above is quite legitimate, and so is my response :-)



---

archive/issue_comments_377770.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2018-09-28T05:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377770",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_377771.json:
```json
{
    "body": "<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2018-09-28T05:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377771",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_377772.json:
```json
{
    "body": "<a id='comment:66'></a>Sorry for adding commits after review.  I worked a bit more while responding to patchbot plugin failures.",
    "created_at": "2018-09-28T05:52:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377772",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:66'></a>Sorry for adding commits after review.  I worked a bit more while responding to patchbot plugin failures.



---

archive/issue_comments_377773.json:
```json
{
    "body": "<a id='comment:67'></a>That is fine. One little thing with this change:\n\n```diff\n@@ -817,12 +821,9 @@ class FunctionFieldMaximalOrder_rational(FunctionFieldMaximalOrder):\n \n         TESTS:\n \n-        This class defines a facade parent. Thus it does not behave well with\n-        respect to elements.\n-\n             sage: K.<t> = FunctionField(QQ)\n             sage: O = K.maximal_order()\n-            sage: TestSuite(O).run(skip=['_test_euclidean_degree', '_test_gcd_vs_xgcd', '_test_one', '_test_zero'])\n+            sage: TestSuite(O).run(skip='_test_gcd_vs_xgcd')\n         \"\"\"\n         FunctionFieldMaximalOrder.__init__(self, field, ideal_class=FunctionFieldIdeal_rational,\n                                            category=EuclideanDomains())\n```\nShould become `TESTS::`.",
    "created_at": "2018-09-28T05:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377773",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:67'></a>That is fine. One little thing with this change:

```diff
@@ -817,12 +821,9 @@ class FunctionFieldMaximalOrder_rational(FunctionFieldMaximalOrder):
 
         TESTS:
 
-        This class defines a facade parent. Thus it does not behave well with
-        respect to elements.
-
             sage: K.<t> = FunctionField(QQ)
             sage: O = K.maximal_order()
-            sage: TestSuite(O).run(skip=['_test_euclidean_degree', '_test_gcd_vs_xgcd', '_test_one', '_test_zero'])
+            sage: TestSuite(O).run(skip='_test_gcd_vs_xgcd')
         """
         FunctionFieldMaximalOrder.__init__(self, field, ideal_class=FunctionFieldIdeal_rational,
                                            category=EuclideanDomains())
```
Should become `TESTS::`.



---

archive/issue_comments_377774.json:
```json
{
    "body": "<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-28T06:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377774",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:68'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377775.json:
```json
{
    "body": "<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-09-28T06:14:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377775",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_377776.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-28T21:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377776",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_377777.json:
```json
{
    "body": "<a id='comment:70'></a>Thank you.",
    "created_at": "2018-09-28T21:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377777",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:70'></a>Thank you.



---

archive/issue_comments_377778.json:
```json
{
    "body": "<a id='comment:71'></a>Replying to [comment:70 tscrim]:\n> Thank you.\n\n\nThank you for helping me step forward!",
    "created_at": "2018-09-28T21:56:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377778",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:71'></a>Replying to [comment:70 tscrim]:
> Thank you.


Thank you for helping me step forward!



---

archive/issue_comments_377779.json:
```json
{
    "body": "<a id='comment:72'></a>Replying to [comment:71 klee]:\n> Replying to [comment:70 tscrim]:\n> > Thank you.\n\n> \n> Thank you for helping me step forward!\n\n\nNo problem. Sorry it took so long for me to get to this.",
    "created_at": "2018-09-28T22:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377779",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:72'></a>Replying to [comment:71 klee]:
> Replying to [comment:70 tscrim]:
> > Thank you.

> 
> Thank you for helping me step forward!


No problem. Sorry it took so long for me to get to this.



---

archive/issue_events_063839.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-09-29T11:59:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25435#event-63839"
}
```



---

archive/issue_comments_377780.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-29T11:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25435",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25435#issuecomment-377780",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
