# Issue 25745: Periodic Proportion Homomorphism over Finite Fields

archive/issues_025508.json:
```json
{
    "body": " Given a homormorphism, a prime `p`, and a degree `n`. Returns a table of the ratio of periodic\n            points to the number of points in a field of size `p^n`, as it cycles through the range of `n` or through the primes up to `p`.\n            One can organize table by ascending primes or by ascending degree. Skips the prime 2. Only works over finite fields.\n\n            From paper by Zo\u00eb Bell, Karina Cho, Rebecca Lauren Miller, and Bianca Thompson.  Author Rebecca Lauren Miller. Implimented at\n            Sage Days 94, Algorithm developed as part of Sage Days 90.\n\n**CC:**  bthompson\n\n**Keywords:** dynamical systems, sagedays90, days94, days90\n\n**Branch:** [u/rlmiller/bianca](https://github.com/sagemath/sagetrac-mirror/tree/u/rlmiller/bianca)\n\n**Commit:** [32ffa3092164fc097cd77beeac91eb93902fa926](https://github.com/sagemath/sagetrac-mirror/commit/32ffa3092164fc097cd77beeac91eb93902fa926)\n\n**Reviewer:** Ben Hutz\n\n**Author:** Rebecca Lauren Miller\n\n**Status:** needs_work\n\nIssue created by migration from https://trac.sagemath.org/ticket/25745\n\n",
    "created_at": "2018-07-02T15:40:12Z",
    "labels": [
        "component: dynamics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Periodic Proportion Homomorphism over Finite Fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25745",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```
 Given a homormorphism, a prime `p`, and a degree `n`. Returns a table of the ratio of periodic
            points to the number of points in a field of size `p^n`, as it cycles through the range of `n` or through the primes up to `p`.
            One can organize table by ascending primes or by ascending degree. Skips the prime 2. Only works over finite fields.

            From paper by ZoÃ« Bell, Karina Cho, Rebecca Lauren Miller, and Bianca Thompson.  Author Rebecca Lauren Miller. Implimented at
            Sage Days 94, Algorithm developed as part of Sage Days 90.

**CC:**  bthompson

**Keywords:** dynamical systems, sagedays90, days94, days90

**Branch:** [u/rlmiller/bianca](https://github.com/sagemath/sagetrac-mirror/tree/u/rlmiller/bianca)

**Commit:** [32ffa3092164fc097cd77beeac91eb93902fa926](https://github.com/sagemath/sagetrac-mirror/commit/32ffa3092164fc097cd77beeac91eb93902fa926)

**Reviewer:** Ben Hutz

**Author:** Rebecca Lauren Miller

**Status:** needs_work

Issue created by migration from https://trac.sagemath.org/ticket/25745





---

archive/issue_comments_495630.json:
```json
{
    "body": "**Branch:** [u/rlmiller/bianca](https://github.com/sagemath/sagetrac-mirror/tree/u/rlmiller/bianca)",
    "created_at": "2018-07-02T15:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495630",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

**Branch:** [u/rlmiller/bianca](https://github.com/sagemath/sagetrac-mirror/tree/u/rlmiller/bianca)



---

archive/issue_comments_495631.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d\">a7597f5</a></td><td><code>25745 periodic proportion hoomorphism</code></td></tr></table>\n",
    "created_at": "2018-07-02T15:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495631",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d">a7597f5</a></td><td><code>25745 periodic proportion hoomorphism</code></td></tr></table>




---

archive/issue_comments_495632.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2018-07-02T15:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495632",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_495633.json:
```json
{
    "body": "**Commit:** [a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d](https://github.com/sagemath/sagetrac-mirror/commit/a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d)",
    "created_at": "2018-07-02T15:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495633",
    "user": "https://trac.sagemath.org/admin/accounts/users/rlmiller"
}
```

**Commit:** [a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d](https://github.com/sagemath/sagetrac-mirror/commit/a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d)



---

archive/issue_comments_495634.json:
```json
{
    "body": "<a id='comment:3'></a>\nI can't look at this for a few days, so if someone else wants to review in the mean time go right ahead.\n\nJust a couple quick comments\n\n- this seems to return a table not a homomorphism, so I would name the function differently.\n\n- It looks like you're expecting the field to be QQ (which is fine), but the docs should say where this should work and perhaps do a little input checking on the base field.\n\n- docstrings need to start with a single line description\n\n- paper should be added to reference file and referenced.\n\n- go ahead and put the input checking doctests into TESTS rather than EXAMPLES",
    "created_at": "2018-07-02T16:56:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495634",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:3'></a>
I can't look at this for a few days, so if someone else wants to review in the mean time go right ahead.

Just a couple quick comments

- this seems to return a table not a homomorphism, so I would name the function differently.

- It looks like you're expecting the field to be QQ (which is fine), but the docs should say where this should work and perhaps do a little input checking on the base field.

- docstrings need to start with a single line description

- paper should be added to reference file and referenced.

- go ahead and put the input checking doctests into TESTS rather than EXAMPLES



---

archive/issue_comments_495635.json:
```json
{
    "body": "<a id='comment:4'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32ffa3092164fc097cd77beeac91eb93902fa926\">32ffa30</a></td><td><code>25745 updated tests and description</code></td></tr></table>\n",
    "created_at": "2018-07-03T08:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495635",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32ffa3092164fc097cd77beeac91eb93902fa926">32ffa30</a></td><td><code>25745 updated tests and description</code></td></tr></table>




---

archive/issue_comments_495636.json:
```json
{
    "body": "**Changing commit** from \"[a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d](https://github.com/sagemath/sagetrac-mirror/commit/a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d)\" to \"[32ffa3092164fc097cd77beeac91eb93902fa926](https://github.com/sagemath/sagetrac-mirror/commit/32ffa3092164fc097cd77beeac91eb93902fa926)\".",
    "created_at": "2018-07-03T08:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495636",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d](https://github.com/sagemath/sagetrac-mirror/commit/a7597f58e880ef76c1e3ce8f9e6fa95c0571a82d)" to "[32ffa3092164fc097cd77beeac91eb93902fa926](https://github.com/sagemath/sagetrac-mirror/commit/32ffa3092164fc097cd77beeac91eb93902fa926)".



---

archive/issue_comments_495637.json:
```json
{
    "body": "**Reviewer:** Ben Hutz",
    "created_at": "2018-07-05T15:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495637",
    "user": "https://github.com/bhutz"
}
```

**Reviewer:** Ben Hutz



---

archive/issue_comments_495638.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2018-07-05T15:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495638",
    "user": "https://github.com/bhutz"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_495639.json:
```json
{
    "body": "<a id='comment:5'></a>\nI haven't built and checked values yet, since there are a bunch of things from looking through the code first:\n\n- 'orderByPrime' -- camel case is reserved for classes, so don't use it in a parameter\nor as a variable 'perRatio'\n\n- docs missing 's' -- Return a table of ratios of periodic point(s) to size of finite field.\n\n- seems like you might want to specify a list/range of primes/n as input.\n\n```\nf.periodic_proportion_table(p=[3,7,13],n=[1,3])\n```\nhaving the short cut\n\n```\nf.periodic_proportion_table(p=3, n=4)\n```\nmean all primes up to p and all exp up to n is fine\n\n\n- don't really understand the point of this test. The function isn't even in that class, so testing that the function isn't in the class is a little redundant since it will never fail.\n\n```\nsage: f.periodic_proportion_table(n=4)\nTraceback (most recent call last):\n...\nAttributeError: 'DynamicalSystem_projective' object has no attribute 'periodic_proportion_table'\n```\n\n- Inputs need a blank line between them.\n\n- I think the lines of the warning are not indented properly, but I didn't build the docs yet to check\n\n- for\n\n```\nif is_prime(p) == False:\n```\nshould be\n\n```\nif not is_prime():\n```\n\n- for\n\n```\nif n<=0 or not n in ZZ:\n```\nbetter as\n\n```\nn = ZZ(n)\nif n <= 0:\n```\n\n- there is a table constructor, so if you sy you return a table, you should be returning a table\n\n```\nsage: rows = [['a', 'b', 'c'], [100,2,3], [4,5,60]]\nsage: table(rows)\n```\n\n- space typos\n\n```\nNT. append([p, i+1, perRatio])\ng=fp.cyclegraph()\nPT. append([i, n, perRatio])\n```\n\n- the try/except seems to be just trying to catch indeterminacy locus issues and the error it raises seems to be specific to dimension 1.\n\ncyclegraph can handle indeterminacy, so I don't really understand why you need this block. The warning you have seems to say that having an indeterminancy is ok, so I'm not sure what you really want here since the docs say you want a morphism? In my opinion, you are writing a function that is just returning the values to fill out the table, whether those values having any meaning is not really your business, so if it works for rational maps as well as morphisms, I see no reason to restrict to morphisms.\n\nAlso, I see no reason this can't be made to work in higher dimensions (other than it will be slow). You just need to adjust the cardinality calculation.\n\n- you're comments in the doctests are not formatted properly\n\n```\ncomment::\n\ntest\n```\n\n- the [4] mapping example needs the line wrapped it is much too long\n\n- TESTS:: -- needs the double colon\n\n\n- the big one that would help this function is to do these calculations in parallel. You are computing each p/n pair as completely independent, so this is best split into separate processes. The possible_periods() function in projective_ds gives a fairly simple example of this.",
    "created_at": "2018-07-05T15:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25745",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25745#issuecomment-495639",
    "user": "https://github.com/bhutz"
}
```

<a id='comment:5'></a>
I haven't built and checked values yet, since there are a bunch of things from looking through the code first:

- 'orderByPrime' -- camel case is reserved for classes, so don't use it in a parameter
or as a variable 'perRatio'

- docs missing 's' -- Return a table of ratios of periodic point(s) to size of finite field.

- seems like you might want to specify a list/range of primes/n as input.

```
f.periodic_proportion_table(p=[3,7,13],n=[1,3])
```
having the short cut

```
f.periodic_proportion_table(p=3, n=4)
```
mean all primes up to p and all exp up to n is fine


- don't really understand the point of this test. The function isn't even in that class, so testing that the function isn't in the class is a little redundant since it will never fail.

```
sage: f.periodic_proportion_table(n=4)
Traceback (most recent call last):
...
AttributeError: 'DynamicalSystem_projective' object has no attribute 'periodic_proportion_table'
```

- Inputs need a blank line between them.

- I think the lines of the warning are not indented properly, but I didn't build the docs yet to check

- for

```
if is_prime(p) == False:
```
should be

```
if not is_prime():
```

- for

```
if n<=0 or not n in ZZ:
```
better as

```
n = ZZ(n)
if n <= 0:
```

- there is a table constructor, so if you sy you return a table, you should be returning a table

```
sage: rows = [['a', 'b', 'c'], [100,2,3], [4,5,60]]
sage: table(rows)
```

- space typos

```
NT. append([p, i+1, perRatio])
g=fp.cyclegraph()
PT. append([i, n, perRatio])
```

- the try/except seems to be just trying to catch indeterminacy locus issues and the error it raises seems to be specific to dimension 1.

cyclegraph can handle indeterminacy, so I don't really understand why you need this block. The warning you have seems to say that having an indeterminancy is ok, so I'm not sure what you really want here since the docs say you want a morphism? In my opinion, you are writing a function that is just returning the values to fill out the table, whether those values having any meaning is not really your business, so if it works for rational maps as well as morphisms, I see no reason to restrict to morphisms.

Also, I see no reason this can't be made to work in higher dimensions (other than it will be slow). You just need to adjust the cardinality calculation.

- you're comments in the doctests are not formatted properly

```
comment::

test
```

- the [4] mapping example needs the line wrapped it is much too long

- TESTS:: -- needs the double colon


- the big one that would help this function is to do these calculations in parallel. You are computing each p/n pair as completely independent, so this is best split into separate processes. The possible_periods() function in projective_ds gives a fairly simple example of this.
