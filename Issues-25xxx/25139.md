# Issue 25139: Add sage-spkg-uninstall script and use it when possible to remove packages

archive/issues_024902.json:
```json
{
    "assignees": [],
    "body": "This is a cleaned up an simplified version of a *portion* of the work originally done in #22510.  This ticket adds a few new features that I felt were fundamentally inseparable (in part due to peculiarities of specific packages meaning that uninstallation could not be supported without some additional work).\n\n1. Adds a new script `sage-spkg-uninstall` which is invoked like `sage-spkg-uninstall <pkgname>` to uninstall a single package from `$SAGE_LOCAL` (this also allows uninstalling standard packages, though we might prefer to prevent that by default).  This script handles all matters of package uninstallation, including the final step of removing the package stamp file from  under `$SAGE_SPKG_INST`.  There are two different ways a package can be uninstalled:\n\n\n   a. \"Modern\" uninstallation: if a package has staged-installation support (i.e. has been updated to support #22509), this means that its stamp file contains a manifest of *all* files installed by that package (minus any files created by the package's `spkg-postinst` script). Therefore \"modern\" uninstallation consists mainly of looping over those files and removing them from `$SAGE_LOCAL`.  Any directories left empty by this process are also removed.\n\n\n   b. \"Legacy\" uinstallation: many (though not all) packages have in their `spkg-install` script some code to perform an ad-hoc uninstallation of any previous versions of the package before installing the new version (this was sometimes necessary in particular for old versions of libraries).  Support for this functionality is retained in order to properly support upgrades from older versions of Sage, where most packages may not support \"modern\" uninstallation.\n\n      However, in order to support this properly, the legacy uninstall code for those packages should be moved out of their `spkg-install` scripts and into a new `spkg-legacy-uninstall` script which is called by `sage-spkg-uninstall` for these packages.  This ticket includes one such example for demonstration purposes, adding an `spkg-legacy-uninstall` for `brial`.\n\n      In the future we may be able to deprecate, and ultimately remove these scripts.  In the meantime all existing packages with uninstall code in their `spkg-install` should be updated (see followup ticket #25140).\n\n2. Another feature this adds which is handled by `sage-spkg-uninstall`, but with some required support from the `sage-spkg` script, are per-package `spkg-prerm` and `spkg-postrm` scripts that are run just before and just after a package is uninstalled.\n\n   This is needed in particular for some packages (namely `pkgconf` and `widgetsnbextension`) which really can't be removed properly without some pre/post-removal steps.  Other packages will need this as well, but less crucially.  I haven't found a specific use case yet for `spkg-postrm`, but it's included for symmetry.\n\n   Because these scripts are run during package uninstallation--of packages that are already installed--the scripts themselves need to be installed *somewhere* (e.g. Debian supports a similar feature, and keeps the scripts under `/var/lib/dpkg` somewhere).  In this case a new path `SAGE_SPKG_SCRIPTS` is added under `$SAGE_LOCAL/var/lib/sage/scripts` by default.  Any package-specific `prerm` and `postrm` scripts are stored there.  After the package is uninstalled the scripts are removed as well.\n\n3. The Makefile is updated so that the `<pkgname>-clean` rules for most packages call `sage-spkg-uninstall`, so that the packages are really thoroughly cleaned (rather than just removing their stamp files). \n\nDepends on #24645\nDepends on #25039\n\nKeywords: **uninstall**\n\nBranch/Commit: **[7a81e70](https://github.com/sagemath/sagetrac-mirror/commit/7a81e70eaebb7ec27f48614ab5232d7fccff4b74)**\n\nReviewer: **Julian R\u00fcth**\n\nAuthor: **Erik Bray**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/25139_\n\n",
    "closed_at": "2018-05-24T07:10:46Z",
    "created_at": "2018-04-10T17:11:12Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-8.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Add sage-spkg-uninstall script and use it when possible to remove packages",
    "type": "issue",
    "updated_at": "2018-05-24T07:10:46Z",
    "url": "https://github.com/sagemath/sage/issues/25139",
    "user": "https://github.com/embray"
}
```
This is a cleaned up an simplified version of a *portion* of the work originally done in #22510.  This ticket adds a few new features that I felt were fundamentally inseparable (in part due to peculiarities of specific packages meaning that uninstallation could not be supported without some additional work).

1. Adds a new script `sage-spkg-uninstall` which is invoked like `sage-spkg-uninstall <pkgname>` to uninstall a single package from `$SAGE_LOCAL` (this also allows uninstalling standard packages, though we might prefer to prevent that by default).  This script handles all matters of package uninstallation, including the final step of removing the package stamp file from  under `$SAGE_SPKG_INST`.  There are two different ways a package can be uninstalled:


   a. "Modern" uninstallation: if a package has staged-installation support (i.e. has been updated to support #22509), this means that its stamp file contains a manifest of *all* files installed by that package (minus any files created by the package's `spkg-postinst` script). Therefore "modern" uninstallation consists mainly of looping over those files and removing them from `$SAGE_LOCAL`.  Any directories left empty by this process are also removed.


   b. "Legacy" uinstallation: many (though not all) packages have in their `spkg-install` script some code to perform an ad-hoc uninstallation of any previous versions of the package before installing the new version (this was sometimes necessary in particular for old versions of libraries).  Support for this functionality is retained in order to properly support upgrades from older versions of Sage, where most packages may not support "modern" uninstallation.

      However, in order to support this properly, the legacy uninstall code for those packages should be moved out of their `spkg-install` scripts and into a new `spkg-legacy-uninstall` script which is called by `sage-spkg-uninstall` for these packages.  This ticket includes one such example for demonstration purposes, adding an `spkg-legacy-uninstall` for `brial`.

      In the future we may be able to deprecate, and ultimately remove these scripts.  In the meantime all existing packages with uninstall code in their `spkg-install` should be updated (see followup ticket #25140).

2. Another feature this adds which is handled by `sage-spkg-uninstall`, but with some required support from the `sage-spkg` script, are per-package `spkg-prerm` and `spkg-postrm` scripts that are run just before and just after a package is uninstalled.

   This is needed in particular for some packages (namely `pkgconf` and `widgetsnbextension`) which really can't be removed properly without some pre/post-removal steps.  Other packages will need this as well, but less crucially.  I haven't found a specific use case yet for `spkg-postrm`, but it's included for symmetry.

   Because these scripts are run during package uninstallation--of packages that are already installed--the scripts themselves need to be installed *somewhere* (e.g. Debian supports a similar feature, and keeps the scripts under `/var/lib/dpkg` somewhere).  In this case a new path `SAGE_SPKG_SCRIPTS` is added under `$SAGE_LOCAL/var/lib/sage/scripts` by default.  Any package-specific `prerm` and `postrm` scripts are stored there.  After the package is uninstalled the scripts are removed as well.

3. The Makefile is updated so that the `<pkgname>-clean` rules for most packages call `sage-spkg-uninstall`, so that the packages are really thoroughly cleaned (rather than just removing their stamp files). 

Depends on #24645
Depends on #25039

Keywords: **uninstall**

Branch/Commit: **[7a81e70](https://github.com/sagemath/sagetrac-mirror/commit/7a81e70eaebb7ec27f48614ab5232d7fccff4b74)**

Reviewer: **Julian RÃ¼th**

Author: **Erik Bray**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/25139_





---

archive/issue_events_347825.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-10T17:11:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347825"
}
```



---

archive/issue_events_347826.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-10T17:11:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347826"
}
```



---

archive/issue_events_347827.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-10T17:11:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347827"
}
```



---

archive/issue_events_347828.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-10T17:11:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347828"
}
```



---

archive/issue_events_347829.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-10T17:43:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347829"
}
```



---

archive/issue_comments_383803.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,7 +10,7 @@\n \n       However, in order to support this properly, the legacy uninstall code for those packages should be moved out of their `spkg-install` scripts and into a new `spkg-legacy-uninstall` script which is called by `sage-spkg-uninstall` for these packages.  This ticket includes one such example for demonstration purposes, adding an `spkg-legacy-uninstall` for `brial`.\n \n-      In the future we may be able to deprecate, and ultimately remove these scripts.  In the meantime all existing packages with uninstall code in their `spkg-install` should be updated (see followup ticket #?????).\n+      In the future we may be able to deprecate, and ultimately remove these scripts.  In the meantime all existing packages with uninstall code in their `spkg-install` should be updated (see followup ticket #25140).\n \n 2. Another feature this adds which is handled by `sage-spkg-uninstall`, but with some required support from the `sage-spkg` script, are per-package `spkg-prerm` and `spkg-postrm` scripts that are run just before and just after a package is uninstalled.\n \n``````\n",
    "created_at": "2018-04-10T17:48:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383803",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,7 +10,7 @@
 
       However, in order to support this properly, the legacy uninstall code for those packages should be moved out of their `spkg-install` scripts and into a new `spkg-legacy-uninstall` script which is called by `sage-spkg-uninstall` for these packages.  This ticket includes one such example for demonstration purposes, adding an `spkg-legacy-uninstall` for `brial`.
 
-      In the future we may be able to deprecate, and ultimately remove these scripts.  In the meantime all existing packages with uninstall code in their `spkg-install` should be updated (see followup ticket #?????).
+      In the future we may be able to deprecate, and ultimately remove these scripts.  In the meantime all existing packages with uninstall code in their `spkg-install` should be updated (see followup ticket #25140).
 
 2. Another feature this adds which is handled by `sage-spkg-uninstall`, but with some required support from the `sage-spkg` script, are per-package `spkg-prerm` and `spkg-postrm` scripts that are run just before and just after a package is uninstalled.
 
``````




---

archive/issue_comments_383804.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\n* There is a `TODO:` in your changeset. Should that be resolved now?\n* I know you just copied code over in `build/pkgs/pkgconf/spkg-postinst` but shouldn't all return values be checked (or a `set -e` be set?)\n* Should we check the return value in `build/pkgs/widgetsnbextension/spkg-prerm`?\n* Why did you push the patch level in `build/pkgs/widgetsnbextension/package-version.txt`\n* Why did you create a \"docstring\" here and not just a comment?\n\n```\n+PKGS = pth.join(SAGE_ROOT, 'build', 'pkgs')\n+\"\"\"Directory where all spkg sources are found.\"\"\"\n```\n* `SAGE_SPKG_INST` is always set, isn't it? Maybe it should then just be an error here if it isn't instead of copying the default from somewhere else?\n\n```\n+    spkg_inst = pth.join(sage_local, 'var', 'lib', 'sage', 'installed')\n+    spkg_inst = os.environ.get('SAGE_SPKG_INST', spkg_inst)\n```\n  and similarly for `SAGE_SPKG_SCRIPTS`.\n* `postrm` should read `prerm` here I guess?\n\n```\n+    # Run the package's postrm script, if it exists\n+    # If an error occurs here we abort the uninstallation for now\n+    run_spkg_script(spkg_name, spkg_scripts, 'prerm', 'pre-uninstall')\n```",
    "created_at": "2018-04-10T23:16:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383804",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:3" align="right">comment:3</div>

* There is a `TODO:` in your changeset. Should that be resolved now?
* I know you just copied code over in `build/pkgs/pkgconf/spkg-postinst` but shouldn't all return values be checked (or a `set -e` be set?)
* Should we check the return value in `build/pkgs/widgetsnbextension/spkg-prerm`?
* Why did you push the patch level in `build/pkgs/widgetsnbextension/package-version.txt`
* Why did you create a "docstring" here and not just a comment?

```
+PKGS = pth.join(SAGE_ROOT, 'build', 'pkgs')
+"""Directory where all spkg sources are found."""
```
* `SAGE_SPKG_INST` is always set, isn't it? Maybe it should then just be an error here if it isn't instead of copying the default from somewhere else?

```
+    spkg_inst = pth.join(sage_local, 'var', 'lib', 'sage', 'installed')
+    spkg_inst = os.environ.get('SAGE_SPKG_INST', spkg_inst)
```
  and similarly for `SAGE_SPKG_SCRIPTS`.
* `postrm` should read `prerm` here I guess?

```
+    # Run the package's postrm script, if it exists
+    # If an error occurs here we abort the uninstallation for now
+    run_spkg_script(spkg_name, spkg_scripts, 'prerm', 'pre-uninstall')
```



---

archive/issue_comments_383805.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOverall this looks good to me. It's great that we finally get a feature like that in Sage :)",
    "created_at": "2018-04-10T23:16:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383805",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:4" align="right">comment:4</div>

Overall this looks good to me. It's great that we finally get a feature like that in Sage :)



---

archive/issue_events_347830.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-04-10T23:17:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347830"
}
```



---

archive/issue_events_347831.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-04-10T23:17:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347831"
}
```



---

archive/issue_comments_383806.json:
```json
{
    "body": "Reviewer: **Julian R\u00fcth**",
    "created_at": "2018-04-10T23:17:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383806",
    "user": "https://github.com/saraedum"
}
```

Reviewer: **Julian RÃ¼th**



---

archive/issue_comments_383807.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThanks for having a look!\n\nReplying to [@saraedum](#comment:3):\n> * There is a `TODO:` in your changeset. Should that be resolved now?\n\nI don't think that should be resolved now--the comment was just a note that it would be the correct spot, most likely, to start implementing such functionality.  Thanks for reminding me about that though.  There should be a follow-up ticket for it.\n\n\n\n> * I know you just copied code over in `build/pkgs/pkgconf/spkg-postinst` but shouldn't all return values be checked (or a `set -e` be set?)\n\nI agree, there should be some error checking there.  It could also use `sdh_install` from #25039 for the copy, which would take care of error checking.\n\n\n\n\n> * Should we check the return value in `build/pkgs/widgetsnbextension/spkg-prerm`?\n\nI'm not really sure it's necessary or desirable.  There are various reasons it *could* fail, such as if that action had already (whether or not for good reasons) been performed by the user, or if the installation was otherwise broken somehow.  In this case other things *might* break too, but at the very least you want to still allow the rest of the package uninstallation to proceed.\n\n\n\n\n> * Why did you push the patch level in `build/pkgs/widgetsnbextension/package-version.txt`\n\nThe `pre/postrm` scripts have to be *installed*, so that means a version bump is needed here to make sure the package is upgraded in order to install them.\n\n\n\n\n> * Why did you create a \"docstring\" here and not just a comment?\n> \n> ```\n> +PKGS = pth.join(SAGE_ROOT, 'build', 'pkgs')\n> +\"\"\"Directory where all spkg sources are found.\"\"\"\n> ```\n\nIt's standard syntax understood by Sphinx for documenting module-level variables and class attributes.  [Some people don't like it](https://github.com/sagemath/sage/issues/24559#comment:24), apparently, but I'm personally quite partial to it for documenting variables, even in code that won't necessarily be processed by Sphinx.\n\n\n\n\n> * `SAGE_SPKG_INST` is always set, isn't it? Maybe it should then just be an error here if it isn't instead of copying the default from somewhere else?\n> \n> ```\n> +    spkg_inst = pth.join(sage_local, 'var', 'lib', 'sage', 'installed')\n> +    spkg_inst = os.environ.get('SAGE_SPKG_INST', spkg_inst)\n> ```\n>   and similarly for `SAGE_SPKG_SCRIPTS`.\n\nMaybe it's not necessary, but I wrote `sage-spkg-uninstall` such that it works without necessarily instantiating the full \"Sage environment\" (I don't like how many programs in Sage do rely on this).  In fact you can pass it the path to `$SAGE_LOCAL` as an optional argument (which is otherwise read out of the environment).  One thing I don't like about this is that we don't exactly have an easy-to-parse file providing the default values for various environment variables used by Sage and its tooling.  But that's something to resolve elsewhere...\n\n\n\n\n> * `postrm` should read `prerm` here I guess?\n> \n> ```\n> +    # Run the package's postrm script, if it exists\n> +    # If an error occurs here we abort the uninstallation for now\n> +    run_spkg_script(spkg_name, spkg_scripts, 'prerm', 'pre-uninstall')\n> ```\n\nYep. And since you pointed that out I also noticed some other fishy business going on at the bottom of the `modern_uninstall` function that it looks like I might have been sloppy about.",
    "created_at": "2018-04-11T13:04:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383807",
    "user": "https://github.com/embray"
}
```

<div id="comment:6" align="right">comment:6</div>

Thanks for having a look!

Replying to [@saraedum](#comment:3):
> * There is a `TODO:` in your changeset. Should that be resolved now?

I don't think that should be resolved now--the comment was just a note that it would be the correct spot, most likely, to start implementing such functionality.  Thanks for reminding me about that though.  There should be a follow-up ticket for it.



> * I know you just copied code over in `build/pkgs/pkgconf/spkg-postinst` but shouldn't all return values be checked (or a `set -e` be set?)

I agree, there should be some error checking there.  It could also use `sdh_install` from #25039 for the copy, which would take care of error checking.




> * Should we check the return value in `build/pkgs/widgetsnbextension/spkg-prerm`?

I'm not really sure it's necessary or desirable.  There are various reasons it *could* fail, such as if that action had already (whether or not for good reasons) been performed by the user, or if the installation was otherwise broken somehow.  In this case other things *might* break too, but at the very least you want to still allow the rest of the package uninstallation to proceed.




> * Why did you push the patch level in `build/pkgs/widgetsnbextension/package-version.txt`

The `pre/postrm` scripts have to be *installed*, so that means a version bump is needed here to make sure the package is upgraded in order to install them.




> * Why did you create a "docstring" here and not just a comment?
> 
> ```
> +PKGS = pth.join(SAGE_ROOT, 'build', 'pkgs')
> +"""Directory where all spkg sources are found."""
> ```

It's standard syntax understood by Sphinx for documenting module-level variables and class attributes.  [Some people don't like it](https://github.com/sagemath/sage/issues/24559#comment:24), apparently, but I'm personally quite partial to it for documenting variables, even in code that won't necessarily be processed by Sphinx.




> * `SAGE_SPKG_INST` is always set, isn't it? Maybe it should then just be an error here if it isn't instead of copying the default from somewhere else?
> 
> ```
> +    spkg_inst = pth.join(sage_local, 'var', 'lib', 'sage', 'installed')
> +    spkg_inst = os.environ.get('SAGE_SPKG_INST', spkg_inst)
> ```
>   and similarly for `SAGE_SPKG_SCRIPTS`.

Maybe it's not necessary, but I wrote `sage-spkg-uninstall` such that it works without necessarily instantiating the full "Sage environment" (I don't like how many programs in Sage do rely on this).  In fact you can pass it the path to `$SAGE_LOCAL` as an optional argument (which is otherwise read out of the environment).  One thing I don't like about this is that we don't exactly have an easy-to-parse file providing the default values for various environment variables used by Sage and its tooling.  But that's something to resolve elsewhere...




> * `postrm` should read `prerm` here I guess?
> 
> ```
> +    # Run the package's postrm script, if it exists
> +    # If an error occurs here we abort the uninstallation for now
> +    run_spkg_script(spkg_name, spkg_scripts, 'prerm', 'pre-uninstall')
> ```

Yep. And since you pointed that out I also noticed some other fishy business going on at the bottom of the `modern_uninstall` function that it looks like I might have been sloppy about.



---

archive/issue_comments_383808.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,7 +14,7 @@\n \n 2. Another feature this adds which is handled by `sage-spkg-uninstall`, but with some required support from the `sage-spkg` script, are per-package `spkg-prerm` and `spkg-postrm` scripts that are run just before and just after a package is uninstalled.\n \n-   This is needed in particular for some packages (namely `pkgconf` and `widgetsnbextension`) which really can't be removed properly without some post-removal steps.  Other packages will need this as well, but less crucially.  I haven't found a specific use case yet for `spkg-prerm`, but it's included for symmetry.\n+   This is needed in particular for some packages (namely `pkgconf` and `widgetsnbextension`) which really can't be removed properly without some pre/post-removal steps.  Other packages will need this as well, but less crucially.  I haven't found a specific use case yet for `spkg-postrm`, but it's included for symmetry.\n \n    Because these scripts are run during package uninstallation--of packages that are already installed--the scripts themselves need to be installed *somewhere* (e.g. Debian supports a similar feature, and keeps the scripts under `/var/lib/dpkg` somewhere).  In this case a new path `SAGE_SPKG_SCRIPTS` is added under `$SAGE_LOCAL/var/lib/sage/scripts` by default.  Any package-specific `prerm` and `postrm` scripts are stored there.  After the package is uninstalled the scripts are removed as well.\n \n``````\n",
    "created_at": "2018-04-11T13:04:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383808",
    "user": "https://github.com/embray"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,7 +14,7 @@
 
 2. Another feature this adds which is handled by `sage-spkg-uninstall`, but with some required support from the `sage-spkg` script, are per-package `spkg-prerm` and `spkg-postrm` scripts that are run just before and just after a package is uninstalled.
 
-   This is needed in particular for some packages (namely `pkgconf` and `widgetsnbextension`) which really can't be removed properly without some post-removal steps.  Other packages will need this as well, but less crucially.  I haven't found a specific use case yet for `spkg-prerm`, but it's included for symmetry.
+   This is needed in particular for some packages (namely `pkgconf` and `widgetsnbextension`) which really can't be removed properly without some pre/post-removal steps.  Other packages will need this as well, but less crucially.  I haven't found a specific use case yet for `spkg-postrm`, but it's included for symmetry.
 
    Because these scripts are run during package uninstallation--of packages that are already installed--the scripts themselves need to be installed *somewhere* (e.g. Debian supports a similar feature, and keeps the scripts under `/var/lib/dpkg` somewhere).  In this case a new path `SAGE_SPKG_SCRIPTS` is added under `$SAGE_LOCAL/var/lib/sage/scripts` by default.  Any package-specific `prerm` and `postrm` scripts are stored there.  After the package is uninstalled the scripts are removed as well.
 
``````




---

archive/issue_comments_383809.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86f34801df1417955a444a5d96cecd910aa238fd\">86f3480</a></td><td><code>Better handling of missing directories when uninstalling broken packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/799822347a94ae72fff36d2304f4719f91363ad2\">7998223</a></td><td><code>Add the ability for packages to have a pre-uninstall script too.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a26636649a77db34bc7db1856ec3f2da8f7a7bc\">3a26636</a></td><td><code>It seems the best way to handle notebook extensions is to disable them in a prerm script.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dad94938c71a1e8340247016d4ac36b9c891e870\">dad9493</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12265b7d694b5011e4e7b334d7d027ac8f4e98de\">12265b7</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6859b1d36b123c8820eb58c5d43c1e4f69cf3c0\">b6859b1</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/281ce2334b284e7aa8dcd94e4b02728da944f822\">281ce23</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7542de0857b29cdcfb909af98aee8044e0a1c7a\">c7542de</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee018bd5639bc1da753e5535cef89e7512dc27fe\">ee018bd</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20a57d430fd8bb9591dc47d4f8a317d95b23abf1\">20a57d4</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr></table>\n",
    "created_at": "2018-04-18T09:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383809",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86f34801df1417955a444a5d96cecd910aa238fd">86f3480</a></td><td><code>Better handling of missing directories when uninstalling broken packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/799822347a94ae72fff36d2304f4719f91363ad2">7998223</a></td><td><code>Add the ability for packages to have a pre-uninstall script too.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a26636649a77db34bc7db1856ec3f2da8f7a7bc">3a26636</a></td><td><code>It seems the best way to handle notebook extensions is to disable them in a prerm script.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dad94938c71a1e8340247016d4ac36b9c891e870">dad9493</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12265b7d694b5011e4e7b334d7d027ac8f4e98de">12265b7</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6859b1d36b123c8820eb58c5d43c1e4f69cf3c0">b6859b1</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/281ce2334b284e7aa8dcd94e4b02728da944f822">281ce23</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7542de0857b29cdcfb909af98aee8044e0a1c7a">c7542de</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee018bd5639bc1da753e5535cef89e7512dc27fe">ee018bd</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20a57d430fd8bb9591dc47d4f8a317d95b23abf1">20a57d4</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr></table>




---

archive/issue_comments_383810.json:
```json
{
    "body": "Changed commit from **[6184243](https://github.com/sagemath/sagetrac-mirror/commit/6184243794db7392581b602d120e8c060d7adf9a)** to **[20a57d4](https://github.com/sagemath/sagetrac-mirror/commit/20a57d430fd8bb9591dc47d4f8a317d95b23abf1)**",
    "created_at": "2018-04-18T09:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383810",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6184243](https://github.com/sagemath/sagetrac-mirror/commit/6184243794db7392581b602d120e8c060d7adf9a)** to **[20a57d4](https://github.com/sagemath/sagetrac-mirror/commit/20a57d430fd8bb9591dc47d4f8a317d95b23abf1)**



---

archive/issue_comments_383811.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86f34801df1417955a444a5d96cecd910aa238fd\">86f3480</a></td><td><code>Better handling of missing directories when uninstalling broken packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/799822347a94ae72fff36d2304f4719f91363ad2\">7998223</a></td><td><code>Add the ability for packages to have a pre-uninstall script too.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a26636649a77db34bc7db1856ec3f2da8f7a7bc\">3a26636</a></td><td><code>It seems the best way to handle notebook extensions is to disable them in a prerm script.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dad94938c71a1e8340247016d4ac36b9c891e870\">dad9493</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12265b7d694b5011e4e7b334d7d027ac8f4e98de\">12265b7</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6859b1d36b123c8820eb58c5d43c1e4f69cf3c0\">b6859b1</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/281ce2334b284e7aa8dcd94e4b02728da944f822\">281ce23</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c7542de0857b29cdcfb909af98aee8044e0a1c7a\">c7542de</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee018bd5639bc1da753e5535cef89e7512dc27fe\">ee018bd</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20a57d430fd8bb9591dc47d4f8a317d95b23abf1\">20a57d4</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr></table>\n",
    "created_at": "2018-04-18T09:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383811",
    "user": "https://github.com/embray"
}
```

<div id="comment:8" align="right">comment:8</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86f34801df1417955a444a5d96cecd910aa238fd">86f3480</a></td><td><code>Better handling of missing directories when uninstalling broken packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/799822347a94ae72fff36d2304f4719f91363ad2">7998223</a></td><td><code>Add the ability for packages to have a pre-uninstall script too.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a26636649a77db34bc7db1856ec3f2da8f7a7bc">3a26636</a></td><td><code>It seems the best way to handle notebook extensions is to disable them in a prerm script.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dad94938c71a1e8340247016d4ac36b9c891e870">dad9493</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12265b7d694b5011e4e7b334d7d027ac8f4e98de">12265b7</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6859b1d36b123c8820eb58c5d43c1e4f69cf3c0">b6859b1</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/281ce2334b284e7aa8dcd94e4b02728da944f822">281ce23</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c7542de0857b29cdcfb909af98aee8044e0a1c7a">c7542de</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee018bd5639bc1da753e5535cef89e7512dc27fe">ee018bd</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20a57d430fd8bb9591dc47d4f8a317d95b23abf1">20a57d4</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr></table>




---

archive/issue_comments_383812.json:
```json
{
    "body": "Changed dependencies from **#24645** to **#24645 #25039**",
    "created_at": "2018-04-18T09:08:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383812",
    "user": "https://github.com/embray"
}
```

Changed dependencies from **#24645** to **#24645 #25039**



---

archive/issue_comments_383813.json:
```json
{
    "body": "Changed commit from **[20a57d4](https://github.com/sagemath/sagetrac-mirror/commit/20a57d430fd8bb9591dc47d4f8a317d95b23abf1)** to **[8470eba](https://github.com/sagemath/sagetrac-mirror/commit/8470ebafa1b8a8e00b34409b2d14ec57843792e7)**",
    "created_at": "2018-04-18T09:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383813",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[20a57d4](https://github.com/sagemath/sagetrac-mirror/commit/20a57d430fd8bb9591dc47d4f8a317d95b23abf1)** to **[8470eba](https://github.com/sagemath/sagetrac-mirror/commit/8470ebafa1b8a8e00b34409b2d14ec57843792e7)**



---

archive/issue_comments_383814.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/213c039b389fb4a02e1be01a790c339d238bb1f4\">213c039</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1331c7315d8e8ea56047f14177d660c4b064ee22\">1331c73</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6c61d68af788147d943a30b981b00918617d1606\">6c61d68</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/654456da47dff1b1bb8a5005cd9a8d4faf8ac7bd\">654456d</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/760d98be4136f8ace609f5e4568cc1bb1fa74403\">760d98b</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7597001a8ab7f647426bb113f219d963939bec9d\">7597001</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d76043bc430f17f38b13379c3efe1e7f277bc28\">9d76043</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/554d47a94d1cb56cd3b974f3a8f77906759a3250\">554d47a</a></td><td><code>remove this TODO comment--I have opened an issue for this task at #25202</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f528d8914c8a540a9c33ef7e525a2315ba7049e\">3f528d8</a></td><td><code>Use appropariate sage-dist-helpers in the pkg-config postinst script</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8470ebafa1b8a8e00b34409b2d14ec57843792e7\">8470eba</a></td><td><code>Better error handling with spkg-prerm exits with an error (before it would have just had an unhandled exception and dumped a traceback)</code></td></tr></table>\n",
    "created_at": "2018-04-18T09:37:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383814",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/213c039b389fb4a02e1be01a790c339d238bb1f4">213c039</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1331c7315d8e8ea56047f14177d660c4b064ee22">1331c73</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6c61d68af788147d943a30b981b00918617d1606">6c61d68</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/654456da47dff1b1bb8a5005cd9a8d4faf8ac7bd">654456d</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/760d98be4136f8ace609f5e4568cc1bb1fa74403">760d98b</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7597001a8ab7f647426bb113f219d963939bec9d">7597001</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d76043bc430f17f38b13379c3efe1e7f277bc28">9d76043</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/554d47a94d1cb56cd3b974f3a8f77906759a3250">554d47a</a></td><td><code>remove this TODO comment--I have opened an issue for this task at #25202</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f528d8914c8a540a9c33ef7e525a2315ba7049e">3f528d8</a></td><td><code>Use appropariate sage-dist-helpers in the pkg-config postinst script</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8470ebafa1b8a8e00b34409b2d14ec57843792e7">8470eba</a></td><td><code>Better error handling with spkg-prerm exits with an error (before it would have just had an unhandled exception and dumped a traceback)</code></td></tr></table>




---

archive/issue_comments_383815.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95ed45ec061424d4708e724c425565e48faa479e\">95ed45e</a></td><td><code>minor correction to comment</code></td></tr></table>\n",
    "created_at": "2018-04-18T09:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383815",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95ed45ec061424d4708e724c425565e48faa479e">95ed45e</a></td><td><code>minor correction to comment</code></td></tr></table>




---

archive/issue_comments_383816.json:
```json
{
    "body": "Changed commit from **[8470eba](https://github.com/sagemath/sagetrac-mirror/commit/8470ebafa1b8a8e00b34409b2d14ec57843792e7)** to **[95ed45e](https://github.com/sagemath/sagetrac-mirror/commit/95ed45ec061424d4708e724c425565e48faa479e)**",
    "created_at": "2018-04-18T09:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383816",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[8470eba](https://github.com/sagemath/sagetrac-mirror/commit/8470ebafa1b8a8e00b34409b2d14ec57843792e7)** to **[95ed45e](https://github.com/sagemath/sagetrac-mirror/commit/95ed45ec061424d4708e724c425565e48faa479e)**



---

archive/issue_events_347832.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T09:41:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347832"
}
```



---

archive/issue_events_347833.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-18T09:41:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347833"
}
```



---

archive/issue_comments_383817.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI believe I addressed all your comments, and made all the code updates I agreed were needed (especially cleaning up `sage_bootstrap.uninstall` a bit).  If you don't agree with any of my responses above we can still discuss that though.  I'm not too hard-set on any of the details of this.",
    "created_at": "2018-04-18T09:41:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383817",
    "user": "https://github.com/embray"
}
```

<div id="comment:11" align="right">comment:11</div>

I believe I addressed all your comments, and made all the code updates I agreed were needed (especially cleaning up `sage_bootstrap.uninstall` a bit).  If you don't agree with any of my responses above we can still discuss that though.  I'm not too hard-set on any of the details of this.



---

archive/issue_comments_383818.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThough before anyone reviews this further they should probably look at #24645 first.",
    "created_at": "2018-04-18T09:42:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383818",
    "user": "https://github.com/embray"
}
```

<div id="comment:12" align="right">comment:12</div>

Though before anyone reviews this further they should probably look at #24645 first.



---

archive/issue_comments_383819.json:
```json
{
    "body": "Changed commit from **[95ed45e](https://github.com/sagemath/sagetrac-mirror/commit/95ed45ec061424d4708e724c425565e48faa479e)** to **[d364c6c](https://github.com/sagemath/sagetrac-mirror/commit/d364c6c1bcb9d21778917337e2f71cd0baeb7f3e)**",
    "created_at": "2018-04-26T09:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383819",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[95ed45e](https://github.com/sagemath/sagetrac-mirror/commit/95ed45ec061424d4708e724c425565e48faa479e)** to **[d364c6c](https://github.com/sagemath/sagetrac-mirror/commit/d364c6c1bcb9d21778917337e2f71cd0baeb7f3e)**



---

archive/issue_comments_383820.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db87c9b167a683719fc44aaa445aa9e80b4f3e60\">db87c9b</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf535f6cac0db00915145a42c2cb388a55e13abd\">bf535f6</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82b7be501e4524a304145614adb3aafb5549ebc4\">82b7be5</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec074d6d827e3b74aae4e5b66e078ea61dba6caa\">ec074d6</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bbdb221ffea937c11be160ba231c58d266bff50e\">bbdb221</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c17b46d7278383f11146aab5a6449ecb3f8fa915\">c17b46d</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89074580d748e1b77ca2fe615bc16d26ae0c6d83\">8907458</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98a1f8d497e92d48462d0c3d11cb2250a71a1aa7\">98a1f8d</a></td><td><code>Use appropariate sage-dist-helpers in the pkg-config postinst script</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8f500c67e6366a8ff2ce8272effae9f0630855aa\">8f500c6</a></td><td><code>Better error handling with spkg-prerm exits with an error (before it would have just had an unhandled exception and dumped a traceback)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d364c6c1bcb9d21778917337e2f71cd0baeb7f3e\">d364c6c</a></td><td><code>minor correction to comment</code></td></tr></table>\n",
    "created_at": "2018-04-26T09:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383820",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db87c9b167a683719fc44aaa445aa9e80b4f3e60">db87c9b</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf535f6cac0db00915145a42c2cb388a55e13abd">bf535f6</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82b7be501e4524a304145614adb3aafb5549ebc4">82b7be5</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec074d6d827e3b74aae4e5b66e078ea61dba6caa">ec074d6</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bbdb221ffea937c11be160ba231c58d266bff50e">bbdb221</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c17b46d7278383f11146aab5a6449ecb3f8fa915">c17b46d</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89074580d748e1b77ca2fe615bc16d26ae0c6d83">8907458</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98a1f8d497e92d48462d0c3d11cb2250a71a1aa7">98a1f8d</a></td><td><code>Use appropariate sage-dist-helpers in the pkg-config postinst script</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8f500c67e6366a8ff2ce8272effae9f0630855aa">8f500c6</a></td><td><code>Better error handling with spkg-prerm exits with an error (before it would have just had an unhandled exception and dumped a traceback)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d364c6c1bcb9d21778917337e2f71cd0baeb7f3e">d364c6c</a></td><td><code>minor correction to comment</code></td></tr></table>




---

archive/issue_comments_383821.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nSomething in the last patchbot build went awry with brial.  I'm not sure I understand the issue yet.",
    "created_at": "2018-04-26T09:16:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383821",
    "user": "https://github.com/embray"
}
```

<div id="comment:14" align="right">comment:14</div>

Something in the last patchbot build went awry with brial.  I'm not sure I understand the issue yet.



---

archive/issue_comments_383822.json:
```json
{
    "body": "Changed commit from **[d364c6c](https://github.com/sagemath/sagetrac-mirror/commit/d364c6c1bcb9d21778917337e2f71cd0baeb7f3e)** to **[1c8fca3](https://github.com/sagemath/sagetrac-mirror/commit/1c8fca3598b4978b0e5a28a391d7f5b4e39fbead)**",
    "created_at": "2018-04-26T10:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383822",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d364c6c](https://github.com/sagemath/sagetrac-mirror/commit/d364c6c1bcb9d21778917337e2f71cd0baeb7f3e)** to **[1c8fca3](https://github.com/sagemath/sagetrac-mirror/commit/1c8fca3598b4978b0e5a28a391d7f5b4e39fbead)**



---

archive/issue_comments_383823.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2faf376be96debe4a13b51e9452bcaf4b6722b34\">2faf376</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55c21de8236dd331ed110b3befb5f57732ad38d1\">55c21de</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ce6c8258bb53b1d0d3fa954495035b201db677e5\">ce6c825</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c2ae0c81d7fda5054abea60e9ef5833abe7680a\">8c2ae0c</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac5f16d1099f0f8599e387a25d6dcc4f04619cc8\">ac5f16d</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a31606d1220b53738ae44fd671c4f381d56ba96e\">a31606d</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/886b7cb069a6ed0b5dffce9794365cc28acbaff6\">886b7cb</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2f189bfb1e892439795012ac1fdba47114cc8db\">a2f189b</a></td><td><code>Use appropariate sage-dist-helpers in the pkg-config postinst script</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2c2152dd15eb7c66a8fbb461f4536531d553207a\">2c2152d</a></td><td><code>Better error handling with spkg-prerm exits with an error (before it would have just had an unhandled exception and dumped a traceback)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1c8fca3598b4978b0e5a28a391d7f5b4e39fbead\">1c8fca3</a></td><td><code>minor correction to comment</code></td></tr></table>\n",
    "created_at": "2018-04-26T10:05:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383823",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2faf376be96debe4a13b51e9452bcaf4b6722b34">2faf376</a></td><td><code>These packages should have their versions bumped now that they require installing pre/post-uninstall scripts.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55c21de8236dd331ed110b3befb5f57732ad38d1">55c21de</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ce6c8258bb53b1d0d3fa954495035b201db677e5">ce6c825</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c2ae0c81d7fda5054abea60e9ef5833abe7680a">8c2ae0c</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac5f16d1099f0f8599e387a25d6dcc4f04619cc8">ac5f16d</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a31606d1220b53738ae44fd671c4f381d56ba96e">a31606d</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/886b7cb069a6ed0b5dffce9794365cc28acbaff6">886b7cb</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2f189bfb1e892439795012ac1fdba47114cc8db">a2f189b</a></td><td><code>Use appropariate sage-dist-helpers in the pkg-config postinst script</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2c2152dd15eb7c66a8fbb461f4536531d553207a">2c2152d</a></td><td><code>Better error handling with spkg-prerm exits with an error (before it would have just had an unhandled exception and dumped a traceback)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1c8fca3598b4978b0e5a28a391d7f5b4e39fbead">1c8fca3</a></td><td><code>minor correction to comment</code></td></tr></table>




---

archive/issue_comments_383824.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOk, the issue is fixed in #24645.  The next patchbot build *should* be good but we'll see.",
    "created_at": "2018-04-26T10:07:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383824",
    "user": "https://github.com/embray"
}
```

<div id="comment:16" align="right">comment:16</div>

Ok, the issue is fixed in #24645.  The next patchbot build *should* be good but we'll see.



---

archive/issue_events_347834.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "milestone_number": null,
    "milestone_title": "sage-8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347834"
}
```



---

archive/issue_events_347835.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-04-26T12:13:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "milestone_number": null,
    "milestone_title": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347835"
}
```



---

archive/issue_events_347836.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-05-19T00:34:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347836"
}
```



---

archive/issue_events_347837.json:
```json
{
    "actor": "https://github.com/saraedum",
    "created_at": "2018-05-19T00:34:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347837"
}
```



---

archive/issue_comments_383825.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThe patchbot still seems to be unhappy. I do not understand what's going on there\u2026",
    "created_at": "2018-05-19T00:34:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383825",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:18" align="right">comment:18</div>

The patchbot still seems to be unhappy. I do not understand what's going on thereâ¦



---

archive/issue_comments_383826.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nLooks like just a merge conflict, yet again.",
    "created_at": "2018-05-21T11:37:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383826",
    "user": "https://github.com/embray"
}
```

<div id="comment:19" align="right">comment:19</div>

Looks like just a merge conflict, yet again.



---

archive/issue_comments_383827.json:
```json
{
    "body": "Changed commit from **[1c8fca3](https://github.com/sagemath/sagetrac-mirror/commit/1c8fca3598b4978b0e5a28a391d7f5b4e39fbead)** to **[7a81e70](https://github.com/sagemath/sagetrac-mirror/commit/7a81e70eaebb7ec27f48614ab5232d7fccff4b74)**",
    "created_at": "2018-05-21T11:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383827",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[1c8fca3](https://github.com/sagemath/sagetrac-mirror/commit/1c8fca3598b4978b0e5a28a391d7f5b4e39fbead)** to **[7a81e70](https://github.com/sagemath/sagetrac-mirror/commit/7a81e70eaebb7ec27f48614ab5232d7fccff4b74)**



---

archive/issue_comments_383828.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45e39e5708480225300e020d53d8e40251508d31\">45e39e5</a></td><td><code>Add the ability for packages to have a pre-uninstall script too.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c1675051f826f24e8e2282ab88dac2b540e22185\">c167505</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df2af7dcb77ba133d65a5a0a20e11cd5d075e300\">df2af7d</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7207157e13c160668dcc22a33c9601638b84891\">d720715</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4721f40ad3d59d85938326b55f3b13a01792c1a0\">4721f40</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/700f7645a7ad909dc67f58e8caec565ca3387665\">700f764</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2ef70eed3cddd39093fa77d5e906721f420128e\">f2ef70e</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e8d06a5ceb9e53efe8ccc55736f8b7ab04e2bffe\">e8d06a5</a></td><td><code>Use appropariate sage-dist-helpers in the pkg-config postinst script</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10def6cce0cbfd52a6a792beb978aa0051880df1\">10def6c</a></td><td><code>Better error handling with spkg-prerm exits with an error (before it would have just had an unhandled exception and dumped a traceback)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a81e70eaebb7ec27f48614ab5232d7fccff4b74\">7a81e70</a></td><td><code>minor correction to comment</code></td></tr></table>\n",
    "created_at": "2018-05-21T11:55:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383828",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45e39e5708480225300e020d53d8e40251508d31">45e39e5</a></td><td><code>Add the ability for packages to have a pre-uninstall script too.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c1675051f826f24e8e2282ab88dac2b540e22185">c167505</a></td><td><code>Move execution of spkg- scripts to a simple utility function, avoiding a bit of boilerplate</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df2af7dcb77ba133d65a5a0a20e11cd5d075e300">df2af7d</a></td><td><code>Read the path to SAGE_SPKG_INST from the environment if possible; otherwise use the hard-coded default path</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7207157e13c160668dcc22a33c9601638b84891">d720715</a></td><td><code>similarly, this variable should be read out of the environment if possible</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4721f40ad3d59d85938326b55f3b13a01792c1a0">4721f40</a></td><td><code>Add a 'verbose' flag, and changed some informative output messages to stdout instead of stderr</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/700f7645a7ad909dc67f58e8caec565ca3387665">700f764</a></td><td><code>Simplify directory removal</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2ef70eed3cddd39093fa77d5e906721f420128e">f2ef70e</a></td><td><code>use brial as an example of splitting an spkg-legacy-uninstall script out from an spkg-install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e8d06a5ceb9e53efe8ccc55736f8b7ab04e2bffe">e8d06a5</a></td><td><code>Use appropariate sage-dist-helpers in the pkg-config postinst script</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10def6cce0cbfd52a6a792beb978aa0051880df1">10def6c</a></td><td><code>Better error handling with spkg-prerm exits with an error (before it would have just had an unhandled exception and dumped a traceback)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a81e70eaebb7ec27f48614ab5232d7fccff4b74">7a81e70</a></td><td><code>minor correction to comment</code></td></tr></table>




---

archive/issue_comments_383829.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nRebased, and removed the stuff related with `widgetsnbextension` which as jdemeyer pointed out in #24646 should no longer be relevant.",
    "created_at": "2018-05-21T11:58:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383829",
    "user": "https://github.com/embray"
}
```

<div id="comment:21" align="right">comment:21</div>

Rebased, and removed the stuff related with `widgetsnbextension` which as jdemeyer pointed out in #24646 should no longer be relevant.



---

archive/issue_events_347838.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-21T13:10:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347838"
}
```



---

archive/issue_events_347839.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-21T13:10:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347839"
}
```



---

archive/issue_comments_383830.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nLooks good to me. I have not tested this though. If you are confident that this works, feel free to set it to positive review.",
    "created_at": "2018-05-21T16:21:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383830",
    "user": "https://github.com/saraedum"
}
```

<div id="comment:23" align="right">comment:23</div>

Looks good to me. I have not tested this though. If you are confident that this works, feel free to set it to positive review.



---

archive/issue_events_347840.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-21T17:37:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347840"
}
```



---

archive/issue_events_347841.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2018-05-21T17:37:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347841"
}
```



---

archive/issue_comments_383831.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nWill be interesting to see what the buildbots do with it, especially OSX.  I expect it will be fine.",
    "created_at": "2018-05-21T17:37:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383831",
    "user": "https://github.com/embray"
}
```

<div id="comment:24" align="right">comment:24</div>

Will be interesting to see what the buildbots do with it, especially OSX.  I expect it will be fine.



---

archive/issue_comments_383832.json:
```json
{
    "body": "Changed branch from **[u/embray/build/spkg-uninstall/script](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/spkg-uninstall/script)** to **[7a81e70](https://github.com/sagemath/sagetrac-mirror/commit/7a81e70eaebb7ec27f48614ab5232d7fccff4b74)**",
    "created_at": "2018-05-24T07:10:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/25139#issuecomment-383832",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/embray/build/spkg-uninstall/script](https://github.com/sagemath/sagetrac-mirror/tree/u/embray/build/spkg-uninstall/script)** to **[7a81e70](https://github.com/sagemath/sagetrac-mirror/commit/7a81e70eaebb7ec27f48614ab5232d7fccff4b74)**



---

archive/issue_events_347842.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-24T07:10:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347842"
}
```



---

archive/issue_events_347843.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8891f050a047862e7014acd23d8b9199f8e8b653",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2018-05-24T07:10:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/25139",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/25139#event-347843"
}
```
