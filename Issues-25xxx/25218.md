# Issue 25218: Extract roots in NumberField if possible

archive/issues_024981.json:
```json
{
    "body": "NumberField previously evaluated integral powers in the NumberField, and evaluated all fractional powers in the symbolic ring.\n\nThis patch makes NumberField attempt to evaluate the fractional power within the field, and only falls back on the symbolic ring if this fails.\n\nThere's a few interesting changes in the test suite.\n\nOld code:\n\n```\nsage: QQbar((2*I)^(1/2))\n1 + 1*I\nsage: (2*I)^(1/2)\nsqrt(2*I)\nsage: I^(2/3)\nI^(2/3)\n```\n\nNew code:\n\n```\nsage: QQbar((2*I)^(1/2))\nI + 1\nsage: (2*I)^(1/2)\nI + 1\nsage: I^(2/3)\n-1\n```\n\nThe first change is just cosmetic.  The second makes good sense, as Sage is now evaluating an expression it didn't before.  The third change is more troubling.\n\nThe explanation lies in the definition of I:\n\n```\nsage: I.parent()\nSymbolic Ring\nsage: I.pyobject().parent()\nNumber Field in I with defining polynomial x^2 + 1\n```\n\nIn this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.\n\nMy opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.\n\nCC:  @slel\n\nKeywords: NumberField\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Brent Baccala\n\nBranch: 17b93d604a5c2d45a136d171db513681a320f58f\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/25218\n\n",
    "closed_at": "2018-05-18T17:49:14Z",
    "created_at": "2018-04-20T04:16:42Z",
    "labels": [
        "component: algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Extract roots in NumberField if possible",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25218",
    "user": "https://github.com/BrentBaccala"
}
```
NumberField previously evaluated integral powers in the NumberField, and evaluated all fractional powers in the symbolic ring.

This patch makes NumberField attempt to evaluate the fractional power within the field, and only falls back on the symbolic ring if this fails.

There's a few interesting changes in the test suite.

Old code:

```
sage: QQbar((2*I)^(1/2))
1 + 1*I
sage: (2*I)^(1/2)
sqrt(2*I)
sage: I^(2/3)
I^(2/3)
```

New code:

```
sage: QQbar((2*I)^(1/2))
I + 1
sage: (2*I)^(1/2)
I + 1
sage: I^(2/3)
-1
```

The first change is just cosmetic.  The second makes good sense, as Sage is now evaluating an expression it didn't before.  The third change is more troubling.

The explanation lies in the definition of I:

```
sage: I.parent()
Symbolic Ring
sage: I.pyobject().parent()
Number Field in I with defining polynomial x^2 + 1
```

In this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.

My opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.

CC:  @slel

Keywords: NumberField

Reviewer: Sébastien Labbé

Author: Brent Baccala

Branch: 17b93d604a5c2d45a136d171db513681a320f58f

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/25218





---

archive/issue_comments_483497.json:
```json
{
    "body": "Changing author from \"\" to \"Brent Baccala\"",
    "created_at": "2018-04-20T04:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483497",
    "user": "https://github.com/BrentBaccala"
}
```

Changing author from "" to "Brent Baccala"



---

archive/issue_comments_483498.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                                 |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|\n|[75a46a0](https://github.com/sagemath/sagetrac-mirror/commit/75a46a060c5f9e389bafe502d17a50b7e6fa4aee)|`Trac #25218: NumberField attempts to evaluate fractional powers`|\n|[087174b](https://github.com/sagemath/sagetrac-mirror/commit/087174bfe499b07ed66ea60c4f6eb2c9a0aee7a3)|`Trac #25218: update test cases altered by this patch`|",
    "created_at": "2018-04-20T04:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483498",
    "user": "https://github.com/BrentBaccala"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                                 |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------|
|[75a46a0](https://github.com/sagemath/sagetrac-mirror/commit/75a46a060c5f9e389bafe502d17a50b7e6fa4aee)|`Trac #25218: NumberField attempts to evaluate fractional powers`|
|[087174b](https://github.com/sagemath/sagetrac-mirror/commit/087174bfe499b07ed66ea60c4f6eb2c9a0aee7a3)|`Trac #25218: update test cases altered by this patch`|



---

archive/issue_comments_483499.json:
```json
{
    "body": "Changing commit from \"\" to \"087174bfe499b07ed66ea60c4f6eb2c9a0aee7a3\"",
    "created_at": "2018-04-20T04:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483499",
    "user": "https://github.com/BrentBaccala"
}
```

Changing commit from "" to "087174bfe499b07ed66ea60c4f6eb2c9a0aee7a3"



---

archive/issue_comments_483500.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-BrentBaccala/25218\"",
    "created_at": "2018-04-20T04:26:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483500",
    "user": "https://github.com/BrentBaccala"
}
```

Changing branch from "" to "u/gh-BrentBaccala/25218"



---

archive/issue_comments_483501.json:
```json
{
    "body": "<a id='comment:2'></a>\nRegarding the suggestion that\n\n> perhaps `I` should be defined in QQbar, not in a NumberField,\n\n\nsee also #18036.",
    "created_at": "2018-04-20T09:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483501",
    "user": "https://github.com/slel"
}
```

<a id='comment:2'></a>
Regarding the suggestion that

> perhaps `I` should be defined in QQbar, not in a NumberField,


see also #18036.



---

archive/issue_comments_483502.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe following tickets are possibly related.\n\n- #7545: Gaussian and Eisenstein integers\n  #7545\n\n- #18036: I.parent() should not be the symbolic ring\n  #18036\n\n- #22208: Conversion from SR to number fields\n  #22208\n\n- #25178: SR('I') is not consistent\n  #25178\n\n- #25218: Extract roots in NumberField if possible\n  #25218",
    "created_at": "2018-04-20T09:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483502",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>
The following tickets are possibly related.

- #7545: Gaussian and Eisenstein integers
  #7545

- #18036: I.parent() should not be the symbolic ring
  #18036

- #22208: Conversion from SR to number fields
  #22208

- #25178: SR('I') is not consistent
  #25178

- #25218: Extract roots in NumberField if possible
  #25218



---

archive/issue_comments_483503.json:
```json
{
    "body": "Changing commit from \"087174bfe499b07ed66ea60c4f6eb2c9a0aee7a3\" to \"592e263482a364ed1987db67aa41c6f2897b8e95\"",
    "created_at": "2018-04-20T17:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483503",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "087174bfe499b07ed66ea60c4f6eb2c9a0aee7a3" to "592e263482a364ed1987db67aa41c6f2897b8e95"



---

archive/issue_comments_483504.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[592e263](https://github.com/sagemath/sagetrac-mirror/commit/592e263482a364ed1987db67aa41c6f2897b8e95)|`Trac #25218: fix typo`|",
    "created_at": "2018-04-20T17:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483504",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[592e263](https://github.com/sagemath/sagetrac-mirror/commit/592e263482a364ed1987db67aa41c6f2897b8e95)|`Trac #25218: fix typo`|



---

archive/issue_comments_483505.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-04-20T19:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483505",
    "user": "https://github.com/BrentBaccala"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_483506.json:
```json
{
    "body": "Changing reviewer from \"\" to \"S\u00e9bastien Labb\u00e9\"",
    "created_at": "2018-04-26T09:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483506",
    "user": "https://github.com/seblabbe"
}
```

Changing reviewer from "" to "Sébastien Labbé"



---

archive/issue_comments_483507.json:
```json
{
    "body": "Changing commit from \"592e263482a364ed1987db67aa41c6f2897b8e95\" to \"17b93d604a5c2d45a136d171db513681a320f58f\"",
    "created_at": "2018-04-26T09:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483507",
    "user": "https://github.com/seblabbe"
}
```

Changing commit from "592e263482a364ed1987db67aa41c6f2897b8e95" to "17b93d604a5c2d45a136d171db513681a320f58f"



---

archive/issue_comments_483508.json:
```json
{
    "body": "<a id='comment:6'></a>\nI did small spaces fixes. If you agree with my changes, please change the status to positive review.\n\n---\nNew commits:\n|                                                                                                                                          |                    |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|\n|[17b93d6](https://github.com/sagemath/sagetrac-mirror/commit/17b93d604a5c2d45a136d171db513681a320f58f)|`25218: space fixes`|",
    "created_at": "2018-04-26T09:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483508",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:6'></a>
I did small spaces fixes. If you agree with my changes, please change the status to positive review.

---
New commits:
|                                                                                                                                          |                    |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------|
|[17b93d6](https://github.com/sagemath/sagetrac-mirror/commit/17b93d604a5c2d45a136d171db513681a320f58f)|`25218: space fixes`|



---

archive/issue_comments_483509.json:
```json
{
    "body": "Changing branch from \"u/gh-BrentBaccala/25218\" to \"u/slabbe/25218\"",
    "created_at": "2018-04-26T09:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483509",
    "user": "https://github.com/seblabbe"
}
```

Changing branch from "u/gh-BrentBaccala/25218" to "u/slabbe/25218"



---

archive/issue_comments_483510.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-26T17:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483510",
    "user": "https://github.com/BrentBaccala"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_071952.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2018-05-17T11:05:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "milestone": "sage-8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25218#event-71952"
}
```



---

archive/issue_events_071953.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-18T17:49:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25218#event-71953"
}
```



---

archive/issue_comments_483511.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-18T17:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483511",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_483512.json:
```json
{
    "body": "Changing branch from \"u/slabbe/25218\" to \"17b93d604a5c2d45a136d171db513681a320f58f\"",
    "created_at": "2018-05-18T17:49:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483512",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/slabbe/25218" to "17b93d604a5c2d45a136d171db513681a320f58f"



---

archive/issue_comments_483513.json:
```json
{
    "body": "Replying to [ticket:25218 gh-BrentBaccala]:\n> The third change is more troubling.\n> \n> The explanation lies in the definition of I:\n> \n> \n> ```\n> sage: I.parent()\n> Symbolic Ring\n> sage: I.pyobject().parent()\n> Number Field in I with defining polynomial x^2 + 1\n> ```\n> \n> In this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.\n> \n> My opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.\n\n\nI think this is **very** unfortunate. In Sage, QQ[i] automatically comes with a complex embedding, for which i<sup>2/3</sup> (= exp(i\u03c0/3)) is perfectly well defined. It is really confusing to have a basic operator like `^` (whose evaluation normally uses the coercion framework) that is incompatible with the embedding.\n\nSee #30783.",
    "created_at": "2020-10-17T16:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483513",
    "user": "https://github.com/mezzarobba"
}
```

Replying to [ticket:25218 gh-BrentBaccala]:
> The third change is more troubling.
> 
> The explanation lies in the definition of I:
> 
> 
> ```
> sage: I.parent()
> Symbolic Ring
> sage: I.pyobject().parent()
> Number Field in I with defining polynomial x^2 + 1
> ```
> 
> In this number field, there is a single cube root of `I` (`-I`).  Squaring `-I` gives us `-1`, so `I^(2/3)=-1`.
> 
> My opinion is that the new behavior of NumberField is correct and preferred, but perhaps `I` should be defined in QQbar, not in a NumberField.


I think this is **very** unfortunate. In Sage, QQ[i] automatically comes with a complex embedding, for which i<sup>2/3</sup> (= exp(iπ/3)) is perfectly well defined. It is really confusing to have a basic operator like `^` (whose evaluation normally uses the coercion framework) that is incompatible with the embedding.

See #30783.



---

archive/issue_comments_483514.json:
```json
{
    "body": "Changing commit from \"17b93d604a5c2d45a136d171db513681a320f58f\" to \"\"",
    "created_at": "2020-10-17T16:48:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25218",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25218#issuecomment-483514",
    "user": "https://github.com/mezzarobba"
}
```

Changing commit from "17b93d604a5c2d45a136d171db513681a320f58f" to ""
